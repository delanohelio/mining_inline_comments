{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMjkyMTQ0", "number": 4153, "title": "DHFPROD-5272: Cypress integration test fail on develop", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-06-25T22:40:28Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153", "merged": true, "mergeCommit": {"oid": "c54e939c81528f14a9529d679c791cc14b74ea5b"}, "closed": true, "closedAt": "2020-06-26T20:30:35Z", "author": {"login": "timur-isangulov"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcu2lo3gBqjM0ODQ0MDQzMzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvIpnSgFqTQzODU1MjgzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ef0c67b9aad6dfcdcff7177d4b04bddae8ea0c8", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9ef0c67b9aad6dfcdcff7177d4b04bddae8ea0c8", "committedDate": "2020-06-25T22:37:08Z", "message": "DHFPROD-5272: Cypress integration test fail on develop"}, "afterCommit": {"oid": "4a5611b61a782d19c176b2b6d862cba9dc681c0d", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/4a5611b61a782d19c176b2b6d862cba9dc681c0d", "committedDate": "2020-06-25T22:42:12Z", "message": "DHFPROD-5272: Cypress integration test fail on develop"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a5611b61a782d19c176b2b6d862cba9dc681c0d", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/4a5611b61a782d19c176b2b6d862cba9dc681c0d", "committedDate": "2020-06-25T22:42:12Z", "message": "DHFPROD-5272: Cypress integration test fail on develop"}, "afterCommit": {"oid": "e9642b633238820cbaaccd60dd82f2631a40d1e7", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e9642b633238820cbaaccd60dd82f2631a40d1e7", "committedDate": "2020-06-25T23:32:51Z", "message": "DHFPROD-5272: Cypress integration test fail on develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTIxMzU3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#pullrequestreview-437921357", "createdAt": "2020-06-25T23:18:30Z", "commit": {"oid": "4a5611b61a782d19c176b2b6d862cba9dc681c0d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMzoxODozMFrOGpO65Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMzo1OTo1MlrOGpPoEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg4OTI1Mw==", "bodyText": "Is it necessary to use waitUntil for these tests. How often have they failed in Jenkins due to load timing issue?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#discussion_r445889253", "createdAt": "2020-06-25T23:18:30Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/integration/authorization.spec.tsx", "diffHunk": "@@ -76,12 +76,15 @@ describe('login', () => {\n         //All tiles but Explore, should show a tooltip that says contact your administrator\n       ['Load', 'Model', 'Curate', 'Run'].forEach((tile) => {\n           toolbar.getToolBarIcon(tile).trigger('mouseover');\n-          cy.contains(`${tile}: Contact your security administrator to get the roles and permissions required to access this functionality.`);\n+        //   cy.contains(`${tile}: Contact your security administrator to get the roles and permissions required to access this functionality.`);\n+          cy.waitUntil(() => cy.contains(`${tile}: Contact your security administrator to get the roles and permissions required to access this functionality.`))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a5611b61a782d19c176b2b6d862cba9dc681c0d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5MTc4OQ==", "bodyText": "I think we agreed to remove \"View Entities\" test. Can we pls remove this commented out describe block instead of updating the tests which shouldnt be run.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#discussion_r445891789", "createdAt": "2020-06-25T23:27:04Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/integration/scenarios.json.tsx", "diffHunk": "@@ -14,7 +15,7 @@ xdescribe('json scenario on view entities page', () => {\n     cy.visit('/');\n     cy.contains(Application.title);\n     cy.loginAsDeveloper();\n-    cy.wait(1000);\n+    cy.location('pathname', { timeout: 10000 }).should('include', '/tiles');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a5611b61a782d19c176b2b6d862cba9dc681c0d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5Mjg3OQ==", "bodyText": "We can delete all the \"View Instance\" tests as agreed instead of skipping them.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#discussion_r445892879", "createdAt": "2020-06-25T23:30:46Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/integration/scenarios.json.tsx", "diffHunk": "@@ -166,7 +164,7 @@ describe('json scenario for snippet on browse documents page', () => {\n     browsePage.getDocumentFileType(0).should('exist')\n   });\n \n-  it('verify instance view of the document', () => {\n+  xit('verify instance view of the document', () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a5611b61a782d19c176b2b6d862cba9dc681c0d"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5MzQ2MA==", "bodyText": "since this is a before Each block, its probably ok to use waitUntil here. For getTotalDocuments which is a browsePage locator, I would add waitUntil in the page object itself, so we dont have to call waitUntil on every use of that locator in the test.\nThat way we can keep the tests clean and readable.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#discussion_r445893460", "createdAt": "2020-06-25T23:32:47Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/integration/scenarios.json.tsx", "diffHunk": "@@ -54,19 +55,17 @@ describe('json scenario for snippet on browse documents page', () => {\n     cy.visit('/');\n     cy.contains(Application.title);\n     cy.loginAsDeveloper().withRequest();\n-    toolbar.getExploreToolbarIcon().should('exist');\n-    toolbar.getExploreToolbarIcon().click();\n-    browsePage.getExploreButton().should('exist');\n-    browsePage.getExploreButton().click();\n+    cy.location('pathname', { timeout: 10000 }).should('include', '/tiles');\n     cy.wait(200);\n+    cy.waitUntil(() => toolbar.getExploreToolbarIcon()).click();\n+    cy.waitUntil(() => browsePage.getExploreButton()).click();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a5611b61a782d19c176b2b6d862cba9dc681c0d"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5NTYwNg==", "bodyText": "same as above. Lets delete these skipped view entities test than updating them.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#discussion_r445895606", "createdAt": "2020-06-25T23:41:00Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/integration/scenarios.xml.tsx", "diffHunk": "@@ -15,11 +15,12 @@ xdescribe('xml scenario on view entities page', () => {\n     cy.visit('/');\n     cy.contains(Application.title);\n     cy.loginAsDeveloper().withRequest();\n-    // temporary change as tile is not working\n-    homePage.getTitle().click();\n-    cy.wait(500);\n-    // temporary change end here\n-    homePage.getViewEntities().click();\n+    cy.location('pathname', { timeout: 10000 }).should('include', '/tiles');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9642b633238820cbaaccd60dd82f2631a40d1e7"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5NTk3OA==", "bodyText": "We can delete this test file itself since the tests here are for obsolete \"View Entities\"", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#discussion_r445895978", "createdAt": "2020-06-25T23:42:22Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/integration/view-entities.validation.tsx", "diffHunk": "@@ -11,6 +12,7 @@ xdescribe('view page validation', () => {\n     cy.visit('/');\n     cy.contains(Application.title);\n     cy.loginAsDeveloper().withRequest();\n+    cy.location('pathname', { timeout: 10000 }).should('include', '/tiles');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9642b633238820cbaaccd60dd82f2631a40d1e7"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg5OTU1MA==", "bodyText": "cy.findByText('Manage Queries') is a better option. We should try using such locators through out existing tests as well, than using implementation detail for locators. Can we try with that for few runs before using waitUntil and explicit waits. Its just a lot of waits here.\nThe usage of waitUntil in the locator here is again a better approach than using them in tests. This is what I have suggested for getTotalDocuments. It should be applied to other changes in this PR if the same thing is being used in more than one place.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#discussion_r445899550", "createdAt": "2020-06-25T23:55:18Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/support/pages/browse.tsx", "diffHunk": "@@ -336,8 +338,11 @@ class BrowsePage {\n   }\n \n   getManageQueriesModalOpened(){\n-    cy.get('.fa-cog').click();\n-    cy.get('.ant-dropdown-menu-item').click();\n+    cy.wait(200);\n+    cy.waitUntil(() => cy.get('.fa-cog')).click();\n+    cy.wait(200);\n+    cy.waitUntil(() => cy.get('.ant-dropdown-menu-item')).click();\n+    cy.wait(200);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9642b633238820cbaaccd60dd82f2631a40d1e7"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwMDgxOA==", "bodyText": "I dont see a usage of this in test anywhere. Is the intent here to wait until the spinner disappears or wait for spinner to appear. If we have usage for both then we should have 2 different locator methods for this purpose to be used in the test later.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#discussion_r445900818", "createdAt": "2020-06-25T23:59:52Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/support/pages/browse.tsx", "diffHunk": "@@ -396,6 +401,10 @@ class BrowsePage {\n     return cy.get('[data-cy=explore]');\n }\n \n+getLoadingSpinner(){\n+  return cy.get('[data-cy=spinner]');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9642b633238820cbaaccd60dd82f2631a40d1e7"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9642b633238820cbaaccd60dd82f2631a40d1e7", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e9642b633238820cbaaccd60dd82f2631a40d1e7", "committedDate": "2020-06-25T23:32:51Z", "message": "DHFPROD-5272: Cypress integration test fail on develop"}, "afterCommit": {"oid": "06971d5a28e8796d0f6ecc32ecdd00783e4be8dd", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/06971d5a28e8796d0f6ecc32ecdd00783e4be8dd", "committedDate": "2020-06-26T01:07:10Z", "message": "DHFPROD-5272: Cypress integration test fail on develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83aff97d98acb5daaa36c07995eb3c33bc6b87de", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/83aff97d98acb5daaa36c07995eb3c33bc6b87de", "committedDate": "2020-06-26T16:48:47Z", "message": "DHFPROD-5272: Cypress integration test fail on develop"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06971d5a28e8796d0f6ecc32ecdd00783e4be8dd", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/06971d5a28e8796d0f6ecc32ecdd00783e4be8dd", "committedDate": "2020-06-26T01:07:10Z", "message": "DHFPROD-5272: Cypress integration test fail on develop"}, "afterCommit": {"oid": "83aff97d98acb5daaa36c07995eb3c33bc6b87de", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/83aff97d98acb5daaa36c07995eb3c33bc6b87de", "committedDate": "2020-06-26T16:48:47Z", "message": "DHFPROD-5272: Cypress integration test fail on develop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDg2MjIw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#pullrequestreview-438486220", "createdAt": "2020-06-26T17:50:48Z", "commit": {"oid": "83aff97d98acb5daaa36c07995eb3c33bc6b87de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1MDo0OFrOGppomA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNzo1MDo0OFrOGppomA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMyNjkzNg==", "bodyText": "Going to give this a pass now, since tests seem to pass.\nBut if they do fail again in Jenkins, the best approach for locators is just to return the element back and take action on them in the test. We shouldnt be doing click action in the locator and certainly avoid using callbacks which leads to brittle tests like we see today.\nIdeally we would want to split this out into \"selectEntityDropDown()\" and \"selectEntityType(entityType: string)\" and return cy.findByText(entityType). Then the test will look like\nbrowsePage.selectEntityDropDown().click();\nbrowsePage.selectEntityType('Customer').click()", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#discussion_r446326936", "createdAt": "2020-06-26T17:50:48Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/support/pages/browse.tsx", "diffHunk": "@@ -1,22 +1,28 @@\n+import 'cypress-wait-until';\n+\n class BrowsePage {\n \n   getSelectedEntity() {\n     return cy.get('.ant-select-selection-selected-value').invoke('text')\n   }\n \n   selectEntity(entity: string) {\n-    cy.get('#entity-select').click();\n-    return cy.get('[data-cy=entity-option]').each(function (item) {\n+    cy.waitUntil(() => cy.get('#entity-select')).click();\n+    return cy.waitUntil(() => cy.get('[data-cy=entity-option]')).each(function (item) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83aff97d98acb5daaa36c07995eb3c33bc6b87de"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDg5MDYz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#pullrequestreview-438489063", "createdAt": "2020-06-26T17:55:21Z", "commit": {"oid": "83aff97d98acb5daaa36c07995eb3c33bc6b87de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDkyNTY5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#pullrequestreview-438492569", "createdAt": "2020-06-26T18:00:52Z", "commit": {"oid": "83aff97d98acb5daaa36c07995eb3c33bc6b87de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NTUyODM3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4153#pullrequestreview-438552837", "createdAt": "2020-06-26T19:45:13Z", "commit": {"oid": "83aff97d98acb5daaa36c07995eb3c33bc6b87de"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2582, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}