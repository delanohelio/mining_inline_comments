{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMDU1MTU1", "number": 4778, "title": "DHFPROD-6163:Add the AWS Glue job info in the job document.", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-10-27T20:50:03Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778", "merged": true, "mergeCommit": {"oid": "01f8748c490f6cdeb3c9da4954311747d51f87e7"}, "closed": true, "closedAt": "2020-10-28T19:28:10Z", "author": {"login": "anu3990"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWvVZsgBqjM5MjgxMDk2Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXBx7aAFqTUxODk2MjU4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7ac1cc4ad6f099a2cf057e8c3d6eb7b3efa75e1", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c7ac1cc4ad6f099a2cf057e8c3d6eb7b3efa75e1", "committedDate": "2020-10-27T20:48:24Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}, "afterCommit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb", "committedDate": "2020-10-27T20:52:04Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MTcyOTI1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518172925", "createdAt": "2020-10-27T21:41:31Z", "commit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMTo0MTozMVrOHpSFBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMTo0MTozMVrOHpSFBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA0OTg2Mw==", "bodyText": "why do we need to set this to null explicitly if user does not configure?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#discussion_r513049863", "createdAt": "2020-10-27T21:41:31Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -237,14 +237,17 @@ private DocumentMetadataHandle buildDocumentMetadata() {\n     private String initializeJob(StructType schema) {\n         loadJobEndpoints();\n \n-        ObjectNode sparkMetadata = objectMapper.createObjectNode();\n+        ObjectNode externalMetadata = objectMapper.createObjectNode();\n         try {\n-            sparkMetadata.set(\"schema\", objectMapper.readTree(schema.json()));\n+            externalMetadata.set(\"additionalExternalMetadata\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MTc0MjU5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518174259", "createdAt": "2020-10-27T21:43:40Z", "commit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MTc1Mjk4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518175298", "createdAt": "2020-10-27T21:45:30Z", "commit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMTo0NTozMFrOHpSMkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMTo0NTozMFrOHpSMkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA1MTc5Mg==", "bodyText": "you might need to regenerate the service class again.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#discussion_r513051792", "createdAt": "2020-10-27T21:45:30Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/dataservices/SparkService.java", "diffHunk": "@@ -103,7 +103,7 @@ private String initializeJob(BaseProxy.DBFunctionRequest request, com.fasterxml.\n               return BaseProxy.StringType.toString(\n                 request\n                       .withParams(\n-                          BaseProxy.documentParam(\"sparkMetadata\", true, BaseProxy.JsonDocumentType.fromJsonNode(sparkMetadata))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MTg5MjQw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518189240", "createdAt": "2020-10-27T22:10:16Z", "commit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMjoxMDoxNlrOHpS41A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QyMjoxNjozNVrOHpTDHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA2MzEyNA==", "bodyText": "I'll edit the JIRA ticket with my proposal - I don't think we should force an \"additionalExternalMetadata\" key to exist. Instead, each key from the additionalexternalmetadata object should be added to the externalMetadata object.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#discussion_r513063124", "createdAt": "2020-10-27T22:10:16Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -237,14 +237,17 @@ private DocumentMetadataHandle buildDocumentMetadata() {\n     private String initializeJob(StructType schema) {\n         loadJobEndpoints();\n \n-        ObjectNode sparkMetadata = objectMapper.createObjectNode();\n+        ObjectNode externalMetadata = objectMapper.createObjectNode();\n         try {\n-            sparkMetadata.set(\"schema\", objectMapper.readTree(schema.json()));\n+            externalMetadata.set(\"additionalExternalMetadata\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA0OTg2Mw=="}, "originalCommit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA2NTE1OA==", "bodyText": "The story isn't calling for this, so I don't think we should add more logging here. I don't think this logging is solving any problem either. Ernie already knows what the Run ID of the Glue job is; he can use that to find the DHF job document.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#discussion_r513065158", "createdAt": "2020-10-27T22:15:08Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/writer/HubDataWriter.java", "diffHunk": "@@ -80,6 +82,8 @@ public WriterCommitMessage commit() {\n         bulkInputCaller.awaitCompletion();\n         if (writeException != null) {\n             logger.info(\"At least one write failed\");\n+            logger.info(\"Additional External Metadata - \"+ options.get(\"additionalexternalmetadata\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA2NTcwOA==", "bodyText": "Let's add a \"desc\" to this to make it clear what the purpose of this is. How about: \"JSON object that, if not null, will be added to the job document with a key of 'externalMetadata'\".", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#discussion_r513065708", "createdAt": "2020-10-27T22:16:26Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/marklogic-data-hub-spark-connector/initializeJob.api", "diffHunk": "@@ -2,7 +2,7 @@\n   \"functionName\" : \"initializeJob\",\n   \"desc\" : \"Creates a job document with the given sparkMetadata as a property\",\n   \"params\" : [ {\n-    \"name\" : \"sparkMetadata\",\n+    \"name\" : \"externalMetadata\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA2NTc1OQ==", "bodyText": "Need to rename to externalMetadata", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#discussion_r513065759", "createdAt": "2020-10-27T22:16:35Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/marklogic-data-hub-spark-connector/initializeJob.api", "diffHunk": "@@ -2,7 +2,7 @@\n   \"functionName\" : \"initializeJob\",\n   \"desc\" : \"Creates a job document with the given sparkMetadata as a property\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb"}, "originalPosition": 2}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/65a4f6b30d3c8fe6fdd515dcb13eee10a5623cdb", "committedDate": "2020-10-27T20:52:04Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}, "afterCommit": {"oid": "d0b6ff9f3fd834cea4649faeba58d2532abd8d66", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d0b6ff9f3fd834cea4649faeba58d2532abd8d66", "committedDate": "2020-10-28T04:26:34Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NjAzNjIy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518603622", "createdAt": "2020-10-28T12:24:28Z", "commit": {"oid": "d0b6ff9f3fd834cea4649faeba58d2532abd8d66"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODE5NTA4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518819508", "createdAt": "2020-10-28T15:54:41Z", "commit": {"oid": "d0b6ff9f3fd834cea4649faeba58d2532abd8d66"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODQwMjM5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518840239", "createdAt": "2020-10-28T16:13:03Z", "commit": {"oid": "d0b6ff9f3fd834cea4649faeba58d2532abd8d66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNjoxMzowM1rOHpyIlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNjoxMzowM1rOHpyIlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU3NTA2MA==", "bodyText": "@SameeraPriyathamTadikonda it is here.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#discussion_r513575060", "createdAt": "2020-10-28T16:13:03Z", "author": {"login": "anu3990"}, "path": "specs/models/Job.schema.json", "diffHunk": "@@ -35,7 +35,7 @@\n       \"type\": \"string\",\n       \"description\": \"dateTime at which the job ended\"\n     },\n-    \"sparkMetadata\": {\n+    \"externalMetadata\": {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0b6ff9f3fd834cea4649faeba58d2532abd8d66"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODQzMTM5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518843139", "createdAt": "2020-10-28T16:15:54Z", "commit": {"oid": "d0b6ff9f3fd834cea4649faeba58d2532abd8d66"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODY4NDU1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518868455", "createdAt": "2020-10-28T16:40:00Z", "commit": {"oid": "d0b6ff9f3fd834cea4649faeba58d2532abd8d66"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0b6ff9f3fd834cea4649faeba58d2532abd8d66", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d0b6ff9f3fd834cea4649faeba58d2532abd8d66", "committedDate": "2020-10-28T04:26:34Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}, "afterCommit": {"oid": "235c4243481bc9a36430672090efd9aee501f98b", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/235c4243481bc9a36430672090efd9aee501f98b", "committedDate": "2020-10-28T16:45:48Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODc4Mjkw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518878290", "createdAt": "2020-10-28T16:49:20Z", "commit": {"oid": "235c4243481bc9a36430672090efd9aee501f98b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODgwNTU0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518880554", "createdAt": "2020-10-28T16:51:40Z", "commit": {"oid": "235c4243481bc9a36430672090efd9aee501f98b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "235c4243481bc9a36430672090efd9aee501f98b", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/235c4243481bc9a36430672090efd9aee501f98b", "committedDate": "2020-10-28T16:45:48Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}, "afterCommit": {"oid": "08c4b34fe6e25efc4ad36f280a6b951f88e89ff3", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/08c4b34fe6e25efc4ad36f280a6b951f88e89ff3", "committedDate": "2020-10-28T17:09:27Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4OTAyNDgy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518902482", "createdAt": "2020-10-28T17:14:07Z", "commit": {"oid": "08c4b34fe6e25efc4ad36f280a6b951f88e89ff3"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7481f90414523b3c04310256acb94c08a67bbaa", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d7481f90414523b3c04310256acb94c08a67bbaa", "committedDate": "2020-10-28T18:07:42Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08c4b34fe6e25efc4ad36f280a6b951f88e89ff3", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/08c4b34fe6e25efc4ad36f280a6b951f88e89ff3", "committedDate": "2020-10-28T17:09:27Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}, "afterCommit": {"oid": "d7481f90414523b3c04310256acb94c08a67bbaa", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d7481f90414523b3c04310256acb94c08a67bbaa", "committedDate": "2020-10-28T18:07:42Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4OTU1OTQ4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518955948", "createdAt": "2020-10-28T18:13:23Z", "commit": {"oid": "d7481f90414523b3c04310256acb94c08a67bbaa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4OTYyNTgz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4778#pullrequestreview-518962583", "createdAt": "2020-10-28T18:21:56Z", "commit": {"oid": "d7481f90414523b3c04310256acb94c08a67bbaa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1822, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}