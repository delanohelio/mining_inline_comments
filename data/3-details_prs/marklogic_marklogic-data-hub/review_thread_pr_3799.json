{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMDEwNTUz", "number": 3799, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOToxMDowMVrODwILQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTo0Mzo0MVrODwLTXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzkyMTkzOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/mappings.sjs", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOToxMDowMVrOGC9I6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMDowOToxNFrOGC_Edw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1MjA0MA==", "bodyText": "Shouldn't there be a unit test against getArtifactSettings for a mapping to verify that the defaults are returned if there aren't settings yet?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#discussion_r405752040", "createdAt": "2020-04-08T19:10:01Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/mappings.sjs", "diffHunk": "@@ -91,5 +102,6 @@ module.exports = {\n     getPermissions,\n     getArtifactNode,\n     validateArtifact,\n-    getArtifactSettingNode\n+    getArtifactSettingNode,\n+    defaultArtifactSettings", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bfb86814af7278ed68940f5c6ee2d0076db8dc8"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc4MzY3MQ==", "bodyText": "Added to the ML unit test to test the retrieval of default settings.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#discussion_r405783671", "createdAt": "2020-04-08T20:09:14Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/mappings.sjs", "diffHunk": "@@ -91,5 +102,6 @@ module.exports = {\n     getPermissions,\n     getArtifactNode,\n     validateArtifact,\n-    getArtifactSettingNode\n+    getArtifactSettingNode,\n+    defaultArtifactSettings", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1MjA0MA=="}, "originalCommit": {"oid": "1bfb86814af7278ed68940f5c6ee2d0076db8dc8"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNzk0MjI1OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/flow/impl/FlowRunnerImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOToxNTo0MFrOGC9VJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMDowODowMlrOGC_CHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NTE3Mw==", "bodyText": "I think verifyThatLoadDataSettingsAreAppliedToStepConfig in FlowRunnerTest should be expanded to cover these fixes.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#discussion_r405755173", "createdAt": "2020-04-08T19:15:40Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/flow/impl/FlowRunnerImpl.java", "diffHunk": "@@ -657,17 +657,32 @@ protected void applyArtifactSettings(Step step, Map<String, Object> stepConfig)\n                     if (artifactSettingsJson.hasNonNull(\"customHook\")) {\n                         step.setCustomHook(artifactSettingsJson.get(\"customHook\"));\n                     }\n-                    List<String> stepOptionProperties = Arrays.asList(\"collections\", \"permissions\");\n                     ObjectMapper mapper = new ObjectMapper();\n+                    List<String> collections = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bfb86814af7278ed68940f5c6ee2d0076db8dc8"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc4MzA2OA==", "bodyText": "done", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#discussion_r405783068", "createdAt": "2020-04-08T20:08:02Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/flow/impl/FlowRunnerImpl.java", "diffHunk": "@@ -657,17 +657,32 @@ protected void applyArtifactSettings(Step step, Map<String, Object> stepConfig)\n                     if (artifactSettingsJson.hasNonNull(\"customHook\")) {\n                         step.setCustomHook(artifactSettingsJson.get(\"customHook\"));\n                     }\n-                    List<String> stepOptionProperties = Arrays.asList(\"collections\", \"permissions\");\n                     ObjectMapper mapper = new ObjectMapper();\n+                    List<String> collections = new ArrayList<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NTE3Mw=="}, "originalCommit": {"oid": "1bfb86814af7278ed68940f5c6ee2d0076db8dc8"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODQzNDIwOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/mappings.sjs", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTo0Mzo0MVrOGDCEnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTo0ODozMVrOGDCMjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgzMjg2Mw==", "bodyText": "@ryanjdew wondering if this should be default-mapping or entity-services-mapping?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#discussion_r405832863", "createdAt": "2020-04-08T21:43:41Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/mappings.sjs", "diffHunk": "@@ -83,6 +83,17 @@ function getArtifactSettingNode(collectionName, artifactName, artifactVersion) {\n   return fn.head(results);\n }\n \n+function defaultArtifactSettings(artifactName) {\n+    return {\n+        artifactName,\n+        collections: ['default-mapping'],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98ac376b72dbb9aac2f89a7bbee0dfb5d6087dcf"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgzNDg5Mw==", "bodyText": "default-mapping is the collection set by entity-services-mapping step definition.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#discussion_r405834893", "createdAt": "2020-04-08T21:48:31Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/mappings.sjs", "diffHunk": "@@ -83,6 +83,17 @@ function getArtifactSettingNode(collectionName, artifactName, artifactVersion) {\n   return fn.head(results);\n }\n \n+function defaultArtifactSettings(artifactName) {\n+    return {\n+        artifactName,\n+        collections: ['default-mapping'],", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgzMjg2Mw=="}, "originalCommit": {"oid": "98ac376b72dbb9aac2f89a7bbee0dfb5d6087dcf"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3387, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}