{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NjkzMjY4", "number": 3966, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMTowODo0NFrOD9jatA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMToxNzo1N1rOD9jkxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODcwMDA0OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/util/data-conversion.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMTowODo0NFrOGXHj4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMjoxMToyMlrOGXJI8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NDMwNg==", "bodyText": "data-conversion file is meant to be a file where payloads are parsed. If you have JSX or React code, it's better to keep it within the component for maintaining, testing and debugging", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426894306", "createdAt": "2020-05-18T21:08:44Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/util/data-conversion.tsx", "diffHunk": "@@ -1,4 +1,8 @@\n import { xmlParser } from './../util/xml-parser';\n+import { Tooltip } from 'antd';\n+import React, { useState, useContext } from 'react';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkyMDE3OA==", "bodyText": "Fixed. Thanks!", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426920178", "createdAt": "2020-05-18T22:11:22Z", "author": {"login": "timur-isangulov"}, "path": "marklogic-data-hub-central/ui/src/util/data-conversion.tsx", "diffHunk": "@@ -1,4 +1,8 @@\n import { xmlParser } from './../util/xml-parser';\n+import { Tooltip } from 'antd';\n+import React, { useState, useContext } from 'react';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NDMwNg=="}, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODcxMjMxOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/api/queries.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMToxMzoxMFrOGXHr0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMjoxNzowN1rOGXJRMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NjMzOA==", "bodyText": "@timur-isangulov any reason for checking status less than 300 ?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426896338", "createdAt": "2020-05-18T21:13:10Z", "author": {"login": "Sanjeevani19"}, "path": "marklogic-data-hub-central/ui/src/api/queries.tsx", "diffHunk": "@@ -60,6 +60,61 @@ export const exportQuery = (query, limit) => {\n   mapForm.reset();\n }\n \n+export const getExportQueryPreview = async (query) => {\n+  let queryString = JSON.stringify(query)\n+  const mapForm = document.createElement(\"form\");\n+  mapForm.id = \"exportForm\";\n+  const mapInput = document.createElement(\"input\");\n+  mapInput.type = \"hidden\";\n+  mapInput.name = \"fileType\";\n+  mapInput.value = \"csv\";\n+  const mapInput2 = document.createElement(\"input\");\n+  mapInput2.type = \"hidden\";\n+  mapInput2.name = \"limit\";\n+  mapInput2.value = '2';\n+  const mapInput3 = document.createElement(\"input\");\n+  mapInput3.type = \"hidden\";\n+  mapInput3.name = \"queryDocument\";\n+  mapInput3.value = queryString;\n+  mapForm.appendChild(mapInput);\n+  mapForm.appendChild(mapInput2);\n+  mapForm.appendChild(mapInput3);\n+  document.body.appendChild(mapForm);\n+\n+  return new Promise(function (resolve, reject) {\n+    let xhr = new XMLHttpRequest();\n+    xhr.open(\"POST\", \"/api/entitySearch/export\");\n+    xhr.onload = function () {\n+        if (this.status >= 200 && this.status < 300) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkyMjI4OQ==", "bodyText": "Checking for range of success status codes.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426922289", "createdAt": "2020-05-18T22:17:07Z", "author": {"login": "timur-isangulov"}, "path": "marklogic-data-hub-central/ui/src/api/queries.tsx", "diffHunk": "@@ -60,6 +60,61 @@ export const exportQuery = (query, limit) => {\n   mapForm.reset();\n }\n \n+export const getExportQueryPreview = async (query) => {\n+  let queryString = JSON.stringify(query)\n+  const mapForm = document.createElement(\"form\");\n+  mapForm.id = \"exportForm\";\n+  const mapInput = document.createElement(\"input\");\n+  mapInput.type = \"hidden\";\n+  mapInput.name = \"fileType\";\n+  mapInput.value = \"csv\";\n+  const mapInput2 = document.createElement(\"input\");\n+  mapInput2.type = \"hidden\";\n+  mapInput2.name = \"limit\";\n+  mapInput2.value = '2';\n+  const mapInput3 = document.createElement(\"input\");\n+  mapInput3.type = \"hidden\";\n+  mapInput3.name = \"queryDocument\";\n+  mapInput3.value = queryString;\n+  mapForm.appendChild(mapInput);\n+  mapForm.appendChild(mapInput2);\n+  mapForm.appendChild(mapInput3);\n+  document.body.appendChild(mapForm);\n+\n+  return new Promise(function (resolve, reject) {\n+    let xhr = new XMLHttpRequest();\n+    xhr.open(\"POST\", \"/api/entitySearch/export\");\n+    xhr.onload = function () {\n+        if (this.status >= 200 && this.status < 300) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NjMzOA=="}, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODcxMjUwOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/queries/managing/manage-query-modal/manage-query.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMToxMzoxM1rOGXHr7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMToxMzoxM1rOGXHr7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NjM2Nw==", "bodyText": "I don't think you need this useEffect. Call getPreview() in displayExportModal() function", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426896367", "createdAt": "2020-05-18T21:13:13Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/queries/managing/manage-query-modal/manage-query.tsx", "diffHunk": "@@ -32,6 +35,10 @@ const QueryModal = (props) => {\n         getQueries();\n     }, [mainModalVisibility, editModalVisibility, deleteModalVisibility]);\n \n+    useEffect(() => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODcxNjI2OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/queries/managing/manage-query-modal/manage-query.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMToxNDo0MFrOGXHuTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMjoxMTo0OVrOGXJJmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5Njk3Mg==", "bodyText": "this is inefficient because you are calling getQueries() anytime these 3 booleans change. If I click \"cancel\" on delete or edit, or main modals, it will do a network request.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426896972", "createdAt": "2020-05-18T21:14:40Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/queries/managing/manage-query-modal/manage-query.tsx", "diffHunk": "@@ -32,6 +35,10 @@ const QueryModal = (props) => {\n         getQueries();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkyMDM0Ng==", "bodyText": "Fixed. Thanks.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426920346", "createdAt": "2020-05-18T22:11:49Z", "author": {"login": "timur-isangulov"}, "path": "marklogic-data-hub-central/ui/src/components/queries/managing/manage-query-modal/manage-query.tsx", "diffHunk": "@@ -32,6 +35,10 @@ const QueryModal = (props) => {\n         getQueries();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5Njk3Mg=="}, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODcyNTgwOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/query-export/query-export-modal/query-export-modal.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMToxNzo1N1rOGXHz8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMjoxMTo1OVrOGXJJ1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5ODQxOQ==", "bodyText": "no reason to create the exportConfirmation variable. just return the JSX.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426898419", "createdAt": "2020-05-18T21:17:57Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/query-export/query-export-modal/query-export-modal.tsx", "diffHunk": "@@ -120,6 +127,15 @@ const QueryExportModal = (props) => {\n             </div>\n             }\n         </Form>\n+\n+        {props.hasStructured && <div>\n+            <Collapse bordered={false} className={styles.collapseCustomPanel} style={{ border: '0px', color: 'blue' }}>\n+                <Panel id='export-panel' header=\"Show Preview\" key=\"1\" style={{ border: '0px', color: 'blue' }}>\n+                    <Table data-testid='export-preview-table'className={styles.exportTable} dataSource={props.tableData} columns={props.tableColumns} pagination={false} size='small' scroll={{ x: 500 }} bordered />\n+                </Panel>\n+            </Collapse>\n+        </div>}\n+\n     </Modal>\n \n     return (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkyMDQwNA==", "bodyText": "Changed. Thanks.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426920404", "createdAt": "2020-05-18T22:11:59Z", "author": {"login": "timur-isangulov"}, "path": "marklogic-data-hub-central/ui/src/components/query-export/query-export-modal/query-export-modal.tsx", "diffHunk": "@@ -120,6 +127,15 @@ const QueryExportModal = (props) => {\n             </div>\n             }\n         </Form>\n+\n+        {props.hasStructured && <div>\n+            <Collapse bordered={false} className={styles.collapseCustomPanel} style={{ border: '0px', color: 'blue' }}>\n+                <Panel id='export-panel' header=\"Show Preview\" key=\"1\" style={{ border: '0px', color: 'blue' }}>\n+                    <Table data-testid='export-preview-table'className={styles.exportTable} dataSource={props.tableData} columns={props.tableColumns} pagination={false} size='small' scroll={{ x: 500 }} bordered />\n+                </Panel>\n+            </Collapse>\n+        </div>}\n+\n     </Modal>\n \n     return (", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5ODQxOQ=="}, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 73}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4141, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}