{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNzkwMzMx", "number": 4162, "title": "DHFPROD-4812: UI: Clear user data from Hub Central", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-06-26T21:17:04Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4162", "merged": true, "mergeCommit": {"oid": "f054f2980f6c1d81e96b2fd4ed6596d3a2d7952b"}, "closed": true, "closedAt": "2020-06-30T07:52:40Z", "author": {"login": "AkshayBajajML"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcv1oTngFqTQzODgyMDY3OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwK9mhgFqTQzOTU5ODU5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4ODIwNjc4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4162#pullrequestreview-438820678", "createdAt": "2020-06-28T23:00:09Z", "commit": {"oid": "e9f2547393888fda72468aff7fed5544e9157b57"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQyMzowMDowOVrOGqA9mQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMDowOToyMVrOGqBaDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjcwOTE0NQ==", "bodyText": "I think we should probably refactor all the tests for this component such that text assertions are not repeated.\n\n\"should verify project info display, user with \"Download\" and \"Clear\" button disabled'\" with authority [], to verify all the text, like service name, DH/ML version, Download/Clear texts alongwith Download and Clear button disabled.\n\"verify project info display, user with \"Download\" button enabled\" with authority [downloadProjectFiles] that asserts Download is enabled, Clear is disabled and click Download and verify alert message\n\"verify project info display, user with \"Clear\" button enabled\" with authority [clearUserData] that asserts Download is disabled, Clear is enabled and click Clear and verify alert message.\n\nAdditionally a test to verify error response for Clear when status != 200. You can refer login tests for this purpose.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4162#discussion_r446709145", "createdAt": "2020-06-28T23:00:09Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/header/system-info.test.tsx", "diffHunk": "@@ -26,18 +27,19 @@ describe('Update data load settings component', () => {\n         expect(getByText('MarkLogic version:')).toBeInTheDocument();\n         expect(getByText(data.environment.marklogicVersion)).toBeInTheDocument();\n         expect(getByText('Download Configuration Files')).toBeInTheDocument();\n-        expect(getByText('Clear All User Data')).toBeInTheDocument();\n+        expect(getByTestId('clearData')).toBeInTheDocument();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9f2547393888fda72468aff7fed5544e9157b57"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjcxNTQ1Ng==", "bodyText": "Clear data alert has display:'none', so the alert might show up in the DOM passing this assertion even when alert message doesnt appear.\ntoBeVisible() may be better suited in this situation. To verify using the text which has inline bold tags, refer getSubElements() in Run.test.tsx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4162#discussion_r446715456", "createdAt": "2020-06-29T00:00:51Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/header/system-info.test.tsx", "diffHunk": "@@ -47,8 +49,36 @@ describe('Update data load settings component', () => {\n         expect(getByText('MarkLogic version:')).toBeInTheDocument();\n         expect(getByText(data.environment.marklogicVersion)).toBeInTheDocument();\n         expect(getByText('Download Configuration Files')).toBeInTheDocument();\n-        expect(getByText('Clear All User Data')).toBeInTheDocument();\n+        expect(getByTestId('clearData')).toBeInTheDocument();\n         expect(getByText('Download')).toBeDisabled();\n+        expect(getByText('Clear')).toBeDisabled();\n+    });\n+\n+    test('verify project info display, user with \"Clear\" button enabled', async () => {\n+        const authorityService = new AuthoritiesService();\n+        authorityService.setAuthorities(['clearUserData']);\n+        const { getByText,getByTestId } = render(<Router><AuthoritiesContext.Provider value={authorityService}>\n+            <SystemInfo {...data.environment}\n+                        systemInfoVisible={true}\n+                        setSystemInfoVisible={jest.fn()}\n+            />\n+        </AuthoritiesContext.Provider></Router>);\n+        expect(getByText(data.environment.serviceName)).toBeInTheDocument();\n+        expect(getByText('Data Hub version:')).toBeInTheDocument();\n+        expect(getByText(data.environment.dataHubVersion)).toBeInTheDocument();\n+        expect(getByText('MarkLogic version:')).toBeInTheDocument();\n+        expect(getByText(data.environment.marklogicVersion)).toBeInTheDocument();\n+        expect(getByText('Download Configuration Files')).toBeInTheDocument();\n+        expect(getByTestId('clearData')).toBeInTheDocument();\n+        expect(getByText('Download a zip file containing flow definitions, step definitions and other user artifacts created or modified by Hub Central.')).toBeInTheDocument();\n+        expect(getByText('Delete all user data in STAGING, FINAL, and JOBS databases.')).toBeInTheDocument();\n+        expect(getByText('Download')).toBeDisabled();\n+        expect(getByText('Clear')).toBeEnabled();\n+        let clearBtn = getByText('Clear');\n+        await wait (()=> {\n+            fireEvent.submit(clearBtn);\n+        });\n+        expect(getByTestId('alertTrue')).toBeInTheDocument();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9f2547393888fda72468aff7fed5544e9157b57"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjcxNjQyOA==", "bodyText": "If getByText('Clear All User Data') works we can get rid of the data-testid here. data-testid should be used as a last resort. RTL encourages good testing practices with the primary guiding principle:\nThe more your tests resemble the way your software is used, the more confidence they can give you.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4162#discussion_r446716428", "createdAt": "2020-06-29T00:09:21Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/header/system-info.tsx", "diffHunk": "@@ -55,48 +77,58 @@ const SystemInfo = (props) => {\n             className={styles.systemModal}\n             destroyOnClose={true}\n         >\n-        <div className={styles.systemContainer}>\n-            <div className={styles.serviceName}>{serviceName}</div>\n-            <div className={styles.version}>\n-                <div className={styles.label}>Data Hub version:</div>\n-                <div className={styles.value}>{dataHubVersion}</div>\n-            </div>\n-            <div className={styles.version}>\n-                <div className={styles.label}>MarkLogic version:</div>\n-                <div className={styles.value}>{marklogicVersion}</div>\n-            </div>\n-            <div className={styles.cardsContainer}>\n-                <div className={styles.cards}>\n-                    <Row gutter={16} type=\"flex\" >\n+            <div className={styles.systemContainer}>\n+                <div data-testid=\"alertTrue\" className={styles.alertPosition} style={message.show ? {display: 'block'} : {display: 'none'}}>\n+                    <Alert message={<p><b>Clear All User Data </b>completed successfully</p>} type='success' showIcon />\n+                </div>\n+                <div className={styles.serviceName}>{serviceName}</div>\n+                <div className={styles.version}>\n+                    <div className={styles.label}>Data Hub version:</div>\n+                    <div className={styles.value}>{dataHubVersion}</div>\n+                </div>\n+                <div className={styles.version}>\n+                    <div className={styles.label}>MarkLogic version:</div>\n+                    <div className={styles.value}>{marklogicVersion}</div>\n+                </div>\n+                <div className={styles.cardsContainer}>\n+                    <div className={styles.cards}>\n+                        <Row gutter={16} type=\"flex\" >\n \n-                        <Col>\n-                            <Card size=\"small\" className={styles.download} >\n-                                <div className={styles.title}>Download Configuration Files</div>\n-                                <p>Download a zip file containing flow definitions, step definitions and other user artifacts created or modified by Hub Central.</p>\n-                                <div className={styles.buttonContainer}>\n-                                    <Button \n-                                        type=\"primary\" \n-                                        disabled = {! authorityService.canDownloadProjectFiles()}\n-                                        onClick={download}\n-                                    >Download</Button>\n-                                </div>\n-                            </Card>\n-                        </Col>\n+                            <Col>\n+                                <Card size=\"small\" className={styles.download} >\n+                                    <div className={styles.title}>Download Configuration Files</div>\n+                                    <p>Download a zip file containing flow definitions, step definitions and other user artifacts created or modified by Hub Central.</p>\n+                                    <div className={styles.buttonContainer}>\n+                                        <Button\n+                                            type=\"primary\"\n+                                            disabled = {! authorityService.canDownloadProjectFiles()}\n+                                            onClick={download}\n+                                        >Download</Button>\n+                                    </div>\n+                                </Card>\n+                            </Col>\n \n-                        <Col>\n-                            <Card size=\"small\" className={styles.clearAll} >\n-                                <div className={styles.title}>Clear All User Data</div>\n-                                <p>Delete all user data in STAGING, FINAL, and JOBS databases.</p>\n-                                <div className={styles.buttonContainer}>\n-                                    <Button type=\"primary\">Clear</Button>\n-                                </div>\n-                            </Card>\n-                        </Col>\n+                            <Col>\n+                                <Card size=\"small\" className={styles.clearAll}>\n+                                    {isLoading === true ? <div className={styles.spinRunning}>\n+                                         <Spin size={\"large\"} />\n+                                    </div>: ''}\n+                                    <div className={styles.title} data-testid=\"clearData\">Clear All User Data</div>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9f2547393888fda72468aff7fed5544e9157b57"}, "originalPosition": 129}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9f2547393888fda72468aff7fed5544e9157b57", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e9f2547393888fda72468aff7fed5544e9157b57", "committedDate": "2020-06-26T21:08:16Z", "message": "DHFPROD-4812: UI: Clear user data from Hub Central"}, "afterCommit": {"oid": "260ba405954e24fd1b9137c27164c0da455652a8", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/260ba405954e24fd1b9137c27164c0da455652a8", "committedDate": "2020-06-29T19:17:03Z", "message": "DHFPROD-4812: UI: Clear user data from Hub Central"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTI1NjUx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4162#pullrequestreview-439525651", "createdAt": "2020-06-29T21:50:51Z", "commit": {"oid": "260ba405954e24fd1b9137c27164c0da455652a8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ee7c0080afad8b7699f592d186d9f2351188ab6", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/3ee7c0080afad8b7699f592d186d9f2351188ab6", "committedDate": "2020-06-29T22:39:57Z", "message": "DHFPROD-4812: UI: Clear user data from Hub Central"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "260ba405954e24fd1b9137c27164c0da455652a8", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/260ba405954e24fd1b9137c27164c0da455652a8", "committedDate": "2020-06-29T19:17:03Z", "message": "DHFPROD-4812: UI: Clear user data from Hub Central"}, "afterCommit": {"oid": "3ee7c0080afad8b7699f592d186d9f2351188ab6", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/3ee7c0080afad8b7699f592d186d9f2351188ab6", "committedDate": "2020-06-29T22:39:57Z", "message": "DHFPROD-4812: UI: Clear user data from Hub Central"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTU4MTY3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4162#pullrequestreview-439558167", "createdAt": "2020-06-29T22:59:08Z", "commit": {"oid": "3ee7c0080afad8b7699f592d186d9f2351188ab6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTgzMTI4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4162#pullrequestreview-439583128", "createdAt": "2020-06-30T00:10:31Z", "commit": {"oid": "3ee7c0080afad8b7699f592d186d9f2351188ab6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTk4NTky", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4162#pullrequestreview-439598592", "createdAt": "2020-06-30T01:00:47Z", "commit": {"oid": "3ee7c0080afad8b7699f592d186d9f2351188ab6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2591, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}