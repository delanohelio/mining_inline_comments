{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMTE4ODM3", "number": 3746, "title": "DHFPROD-4559: Explorer returns empty results when there is no data", "bodyText": "Checklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-03-24T16:51:45Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3746", "merged": true, "mergeCommit": {"oid": "44156345adf86530d7bba235f3f92819918e1c57"}, "closed": true, "closedAt": "2020-03-27T17:27:36Z", "author": {"login": "rahulvudutala"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ3AhQgFqTM4MDU3NjYxOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRzu13gFqTM4MzA0MDE2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNTc2NjE5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3746#pullrequestreview-380576619", "createdAt": "2020-03-24T18:14:09Z", "commit": {"oid": "940a592494cfe84c0688bcbdbd28f994532482f1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODoxNDowOVrOF69Ldg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODoxNDowOVrOF69Ldg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2NDA4Ng==", "bodyText": "This seems like something we can check on before trying to do the search, right?\nAlso, I'd say we should add a test - but it doesn't look like SearchHelper is actually being tested at all??? I see in SearchManagerTest that it's being mocked.\nWhy is SearchHelper separate from SearchManager? SearchManager isn't doing anything other than delegating to SearchHelper.\nI recommend trying to write a real test here. This one is easy, because you don't need any data - just pass in a SearchQuery with no entity names, and verify you get back an empty StringHandle.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3746#discussion_r397364086", "createdAt": "2020-03-24T18:14:09Z", "author": {"login": "rjrudin"}, "path": "one-ui/src/main/java/com/marklogic/hub/oneui/util/SearchHelper.java", "diffHunk": "@@ -96,6 +99,12 @@ public StringHandle search(SearchQuery searchQuery) {\n \n         }\n         catch (MarkLogicServerException e) {\n+            // If there are no entityTypes to search, return empty result set", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "940a592494cfe84c0688bcbdbd28f994532482f1"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "940a592494cfe84c0688bcbdbd28f994532482f1", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/940a592494cfe84c0688bcbdbd28f994532482f1", "committedDate": "2020-03-24T16:48:37Z", "message": "DHFPROD-4559: Explorer returns empty results when there is no data"}, "afterCommit": {"oid": "0c4bcdcd60a72f039553034d9381bf58f80c7858", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/0c4bcdcd60a72f039553034d9381bf58f80c7858", "committedDate": "2020-03-26T16:00:55Z", "message": "DHFPROD-4559: Refactoring SearchHelper, SearchManager classes and deprecated content"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c4bcdcd60a72f039553034d9381bf58f80c7858", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/0c4bcdcd60a72f039553034d9381bf58f80c7858", "committedDate": "2020-03-26T16:00:55Z", "message": "DHFPROD-4559: Refactoring SearchHelper, SearchManager classes and deprecated content"}, "afterCommit": {"oid": "d275aec2d5d2a1189b088b8db6a922f039521e74", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d275aec2d5d2a1189b088b8db6a922f039521e74", "committedDate": "2020-03-26T17:06:31Z", "message": "DHFPROD-4559: Refactoring SearchHelper, SearchManager classes and deprecated content"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMjY2OTkx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3746#pullrequestreview-382266991", "createdAt": "2020-03-26T17:56:41Z", "commit": {"oid": "d275aec2d5d2a1189b088b8db6a922f039521e74"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNzo1Njo0MVrOF8TbKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNzo1Nzo1MVrOF8TeGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc3NzEyOA==", "bodyText": "This is a lot of redundant logging for an exception. If the point is to make it clear what query failed, just rethrow the exception:\nthrow new RuntimeException(\"Failed to run query:  \" + query,e);", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3746#discussion_r398777128", "createdAt": "2020-03-26T17:56:41Z", "author": {"login": "rjrudin"}, "path": "one-ui/src/test/java/com/marklogic/hub/oneui/TestHelper.java", "diffHunk": "@@ -188,11 +190,35 @@ private void assignRoleToUser(String username, String role) {\n         user.save();\n     }\n \n-    protected GenericDocumentManager getFinalGenericDocumentManager(DatabaseKind databaseKind) {\n-        return getFinalClient(databaseKind).newDocumentManager();\n+    protected EvalResultIterator runJsInDatabase(String query, String databaseName) {\n+        try {\n+            return getServerEval(databaseName).javascript(query).eval();\n+        }\n+        catch(FailedRequestException e) {\n+            logger.error(\"Failed run code: \" + query, e);\n+            e.printStackTrace();\n+            throw e;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d275aec2d5d2a1189b088b8db6a922f039521e74"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc3Nzg4Mw==", "bodyText": "This is worth adding a unit test for - why escapeXml10 and not escapeXml? What scenario is this handling, such that it would break if we didn't call escapeXml10?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3746#discussion_r398777883", "createdAt": "2020-03-26T17:57:51Z", "author": {"login": "rjrudin"}, "path": "one-ui/src/main/java/com/marklogic/hub/oneui/util/SearchOptionBuilder.java", "diffHunk": "@@ -51,7 +51,7 @@ public String buildSearchOptions(String query, SearchQuery searchQuery) throws I\n         // Setting search string if provided by user\n         if (StringUtils.isNotEmpty(searchQuery.getQuery().getSearchStr())) {\n             sb.append(\"<qtext>\")\n-                .append(StringEscapeUtils.escapeXml(searchQuery.getQuery().getSearchStr()))\n+                .append(StringEscapeUtils.escapeXml10(searchQuery.getQuery().getSearchStr()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d275aec2d5d2a1189b088b8db6a922f039521e74"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecf5e23ca76632897f2795411a531f1bda0f4d5f", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ecf5e23ca76632897f2795411a531f1bda0f4d5f", "committedDate": "2020-03-27T01:50:39Z", "message": "DHFPROD-4559: Explorer returns empty results when there is no data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6452684d6a4b82dfedb8ff68f190cf6eeae97ae0", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6452684d6a4b82dfedb8ff68f190cf6eeae97ae0", "committedDate": "2020-03-27T01:50:39Z", "message": "DHFPROD-4559: Refactoring SearchHelper, SearchManager classes and deprecated content"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d275aec2d5d2a1189b088b8db6a922f039521e74", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d275aec2d5d2a1189b088b8db6a922f039521e74", "committedDate": "2020-03-26T17:06:31Z", "message": "DHFPROD-4559: Refactoring SearchHelper, SearchManager classes and deprecated content"}, "afterCommit": {"oid": "6452684d6a4b82dfedb8ff68f190cf6eeae97ae0", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6452684d6a4b82dfedb8ff68f190cf6eeae97ae0", "committedDate": "2020-03-27T01:50:39Z", "message": "DHFPROD-4559: Refactoring SearchHelper, SearchManager classes and deprecated content"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyODgyNjI1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3746#pullrequestreview-382882625", "createdAt": "2020-03-27T14:00:04Z", "commit": {"oid": "6452684d6a4b82dfedb8ff68f190cf6eeae97ae0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMDQwMTY0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3746#pullrequestreview-383040164", "createdAt": "2020-03-27T16:59:07Z", "commit": {"oid": "6452684d6a4b82dfedb8ff68f190cf6eeae97ae0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3220, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}