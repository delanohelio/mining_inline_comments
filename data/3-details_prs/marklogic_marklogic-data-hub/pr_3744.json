{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNzg2NDk1", "number": 3744, "title": "DHFPROD-4531: Handle runFlow exception to return a proper message to the caller", "bodyText": "Sometimes, noticing inconsistent behavior when the Function App is throwing exception and is not being handled properly by the Logic App. This PR is to return an appropriate message to the caller - either successful or exception message.\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-03-24T05:33:42Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744", "merged": true, "mergeCommit": {"oid": "ca4047f915d228b80d9cfaa21449a3d9bc4fd593"}, "closed": true, "closedAt": "2020-03-24T21:42:47Z", "author": {"login": "vgouraba"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQsOn8AFqTM4MDAxMjM0MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ3A4sgFqTM4MDU3Njk2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDEyMzQx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#pullrequestreview-380012341", "createdAt": "2020-03-24T05:40:40Z", "commit": {"oid": "f146825e65a3966d3841eca0da2dc01beb068037"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDEzNzg4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#pullrequestreview-380013788", "createdAt": "2020-03-24T05:45:27Z", "commit": {"oid": "f146825e65a3966d3841eca0da2dc01beb068037"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNTo0NToyOFrOF6htBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNTo0ODoxOFrOF6hvvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxMzkyNw==", "bodyText": "\"error\" seems like the better logging level here", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#discussion_r396913927", "createdAt": "2020-03-24T05:45:28Z", "author": {"login": "srinathgit"}, "path": "azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java", "diffHunk": "@@ -38,20 +38,25 @@ public HttpResponseMessage run(\n         } else {\n             // Write the name to the message queue.\n             msg.setValue(name);\n-\n-            runFlow();\n-            return request.createResponseBuilder(HttpStatus.OK).body(\"Hello, \" + name).build();\n+            String runFlowMessage = \"Flow <\" + name + \"> successfully executed.\"; //default message\n+            try {\n+                runFlow(name);\n+            } catch (Exception ex) {\n+                context.getLogger().info(\"Exception caught: \" + ex.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f146825e65a3966d3841eca0da2dc01beb068037"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxNDYyMQ==", "bodyText": "'RunFlowResponse' object.toString() returns a JSON string which provides details of every step that ran in the flow, along with the stats. Will that be more useful to the user ?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#discussion_r396914621", "createdAt": "2020-03-24T05:48:18Z", "author": {"login": "srinathgit"}, "path": "azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java", "diffHunk": "@@ -38,20 +38,25 @@ public HttpResponseMessage run(\n         } else {\n             // Write the name to the message queue.\n             msg.setValue(name);\n-\n-            runFlow();\n-            return request.createResponseBuilder(HttpStatus.OK).body(\"Hello, \" + name).build();\n+            String runFlowMessage = \"Flow <\" + name + \"> successfully executed.\"; //default message", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f146825e65a3966d3841eca0da2dc01beb068037"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMjQ0MzQz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#pullrequestreview-380244343", "createdAt": "2020-03-24T12:05:17Z", "commit": {"oid": "25c8a846d3af4a0052739b072a7968b22ec8a5fe"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjowNToxOFrOF6tKSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjowNjowM1rOF6tL-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEwMTY0Mg==", "bodyText": "Small nit - can you name is \"data-hub-sample\" instead of \"dhf-sample\"? We try to use \"data-hub\" instead of \"dhf\" wherever possible.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#discussion_r397101642", "createdAt": "2020-03-24T12:05:18Z", "author": {"login": "rjrudin"}, "path": "azure/flow-runner-function/README.md", "diffHunk": "@@ -34,7 +34,7 @@ Then deploy your function (this can take many seconds to finish):\n \n Then get your HTTP trigger URL and test the endpoint - your URL should be similar to what's shown below:\n \n-    curl -w \"\\n\" https://az-functions-20200227122602814.azurewebsites.net/api/HttpExampleDhfFlow --data flowNameDoesntMatterYet\n+    curl -w \"\\n\" https://az-functions-dhf-sample-v1.azurewebsites.net/api/HttpExampleDhfFlow --data flowNameDoesntMatterYet", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25c8a846d3af4a0052739b072a7968b22ec8a5fe"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEwMjA3NQ==", "bodyText": "Same thing, can you do DataHubFlow? Or - just rename this in the next JIRA ticket. Either approach is fine.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#discussion_r397102075", "createdAt": "2020-03-24T12:06:03Z", "author": {"login": "rjrudin"}, "path": "azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java", "diffHunk": "@@ -18,9 +18,9 @@\n  */\n public class FunctionDhfFlow {\n     /**\n-     * This function listens at endpoint \"/api/HttpExample\". Two ways to invoke it using \"curl\" command in bash:\n-     * 1. curl -d \"HTTP Body\" {your host}/api/HttpExample\n-     * 2. curl \"{your host}/api/HttpExample?name=HTTP%20Query\"\n+     * This function listens at endpoint \"/api/HttpExampleDhfFlow\". Two ways to invoke it using \"curl\" command in bash:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25c8a846d3af4a0052739b072a7968b22ec8a5fe"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "547783b3fadcdbf320b5522311c855fd86335ce1", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/547783b3fadcdbf320b5522311c855fd86335ce1", "committedDate": "2020-03-24T17:17:55Z", "message": "handle runflow exception to return a proper message to the caller\n\nchange logger message from info to severe\n\nDHFPROD-4531: rename function names from Dhf to DataHub"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNTQwMDg3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#pullrequestreview-380540087", "createdAt": "2020-03-24T17:28:53Z", "commit": {"oid": "547783b3fadcdbf320b5522311c855fd86335ce1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNTc2OTYx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#pullrequestreview-380576961", "createdAt": "2020-03-24T18:14:37Z", "commit": {"oid": "547783b3fadcdbf320b5522311c855fd86335ce1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3216, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}