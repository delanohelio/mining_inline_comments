{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4NDQ3OTE1", "number": 3788, "title": "DHFPROD-4532: impl for invoking the flow by taking params from req body", "bodyText": "DHFPROD-4532: added asserts for test methods\nrename the method to buildFlowInputs\nDescription\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-04-04T01:36:36Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3788", "merged": true, "mergeCommit": {"oid": "8f2f4567f5671d0ed06da24817bf084aed540934"}, "closed": true, "closedAt": "2020-04-07T22:25:57Z", "author": {"login": "vgouraba"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVBBd8AFqTM4ODQwMjg4MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVahB3AFqTM4OTUxNjkwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NDAyODgw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3788#pullrequestreview-388402880", "createdAt": "2020-04-06T16:10:00Z", "commit": {"oid": "da529424a4931453d88e6c544a104bf9a2696f2f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODE2MjM1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3788#pullrequestreview-387816235", "createdAt": "2020-04-05T12:56:58Z", "commit": {"oid": "da529424a4931453d88e6c544a104bf9a2696f2f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMjo1Njo1OFrOGA_y5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMjo1ODozOVrOGA_zwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY5ODQwNQ==", "bodyText": "Can you use Jackson for JSON parsing instead? That's already included via the ML Java Client and we use it throughout DHF.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3788#discussion_r403698405", "createdAt": "2020-04-05T12:56:58Z", "author": {"login": "rjrudin"}, "path": "azure/flow-runner-function/pom.xml", "diffHunk": "@@ -100,6 +100,11 @@\n             <artifactId>mockito-core</artifactId>\n             <scope>test</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>org.json</groupId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da529424a4931453d88e6c544a104bf9a2696f2f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY5ODQ5Mg==", "bodyText": "This is good - is it the default that multiple params will be sent as a JSON object to a Function? I know that's how Lambda works in AWS.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3788#discussion_r403698492", "createdAt": "2020-04-05T12:57:42Z", "author": {"login": "rjrudin"}, "path": "azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDataHubFlow.java", "diffHunk": "@@ -25,49 +28,108 @@\n     @FunctionName(\"HttpExampleDataHubFlow\")\n     public HttpResponseMessage run(\n             @HttpTrigger(name = \"req\", methods = {HttpMethod.GET, HttpMethod.POST}, authLevel = AuthorizationLevel.ANONYMOUS) HttpRequestMessage<Optional<String>> request,\n-            @QueueOutput(name = \"msg\", queueName = \"dhf-queue\", connection = \"AzureWebJobsStorage\") OutputBinding<String> msg,\n+            @QueueOutput(name = \"msg\", queueName = \"dhf-queue-az\", connection = \"AzureWebJobsStorage\") OutputBinding<String> msg,\n             final ExecutionContext context) {\n         context.getLogger().info(\"Java HTTP trigger processed a request.\");\n \n-        // Parse query parameter\n-        String query = request.getQueryParameters().get(\"name\");\n-        String name = request.getBody().orElse(query);\n+        context.getLogger().info(\"Preparing jsonObj.\");\n+        JSONObject jsonObj = new JSONObject(request.getBody().orElse(null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da529424a4931453d88e6c544a104bf9a2696f2f"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY5ODYyNA==", "bodyText": "For consistency elsewhere, can you use these names for the params - \"host\", \"username\", \"password\", \"flowName\", and \"steps.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3788#discussion_r403698624", "createdAt": "2020-04-05T12:58:39Z", "author": {"login": "rjrudin"}, "path": "azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDataHubFlow.java", "diffHunk": "@@ -25,49 +28,108 @@\n     @FunctionName(\"HttpExampleDataHubFlow\")\n     public HttpResponseMessage run(\n             @HttpTrigger(name = \"req\", methods = {HttpMethod.GET, HttpMethod.POST}, authLevel = AuthorizationLevel.ANONYMOUS) HttpRequestMessage<Optional<String>> request,\n-            @QueueOutput(name = \"msg\", queueName = \"dhf-queue\", connection = \"AzureWebJobsStorage\") OutputBinding<String> msg,\n+            @QueueOutput(name = \"msg\", queueName = \"dhf-queue-az\", connection = \"AzureWebJobsStorage\") OutputBinding<String> msg,\n             final ExecutionContext context) {\n         context.getLogger().info(\"Java HTTP trigger processed a request.\");\n \n-        // Parse query parameter\n-        String query = request.getQueryParameters().get(\"name\");\n-        String name = request.getBody().orElse(query);\n+        context.getLogger().info(\"Preparing jsonObj.\");\n+        JSONObject jsonObj = new JSONObject(request.getBody().orElse(null));\n+        context.getLogger().info(\"Done Preparing jsonObj <\" + jsonObj + \">\");\n+        context.getLogger().info(\"json < \" + jsonObj + \">\");  //don't do this to avoid logging password\n+\n+        // Parse request parameters\n+        String mlHost = getValueFromJson (jsonObj, \"ml-host\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da529424a4931453d88e6c544a104bf9a2696f2f"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b87e8e3279a6f9417e68e7b63ae0ee81bd906c3b", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b87e8e3279a6f9417e68e7b63ae0ee81bd906c3b", "committedDate": "2020-04-07T06:16:30Z", "message": "DHFPROD-4532: impl for invoking the flow by taking params from req body\n\nDHFPROD-4532: added asserts for test methods\n\nDHRPROD-4532: rename the method to buildFlowInputs\n\nDHFPROD-4532: use jackson for json; change attributes names for consistency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MDk1MzQx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3788#pullrequestreview-389095341", "createdAt": "2020-04-07T13:06:42Z", "commit": {"oid": "b87e8e3279a6f9417e68e7b63ae0ee81bd906c3b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTE2OTAw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3788#pullrequestreview-389516900", "createdAt": "2020-04-07T21:52:06Z", "commit": {"oid": "b87e8e3279a6f9417e68e7b63ae0ee81bd906c3b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2992, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}