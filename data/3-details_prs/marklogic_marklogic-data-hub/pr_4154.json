{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMzExMTk3", "number": 4154, "title": "DHFPROD-5277: Fix ML-9.0-12 tests", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-06-25T23:48:03Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154", "merged": true, "mergeCommit": {"oid": "39abeaefbf328f1bddb2ec465fa9a07753437807"}, "closed": true, "closedAt": "2020-06-29T22:36:55Z", "author": {"login": "ryanjdew"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvFVp3AFqTQzODQwOTE2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwIspLgFqTQzOTU0MjYwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NDA5MTY4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#pullrequestreview-438409168", "createdAt": "2020-06-26T15:53:42Z", "commit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo1Mzo0MlrOGpmB4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo1Mzo0MlrOGpmB4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2Nzg3Mw==", "bodyText": "Unfortunately, the spread syntax isn't supported in ML 9.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446267873", "createdAt": "2020-06-26T15:53:42Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/entities/entity-search-lib.sjs", "diffHunk": "@@ -127,7 +127,7 @@ function buildAllMetadata(parentPropertyName, entityModel, entityName) {\n       propertyMetadata[\"properties\"] = metaData[\"allPropertiesMetadata\"];\n       propertyMetadataObject[\"properties\"] = metaData[\"allPropertiesMetadata\"];\n \n-      granularPropertyMetadata = {...granularPropertyMetadata, ...metaData[\"granularPropertyMetadata\"]};\n+      granularPropertyMetadata = Object.assign({},granularPropertyMetadata, metaData[\"granularPropertyMetadata\"]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MjQ4NDk5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#pullrequestreview-438248499", "createdAt": "2020-06-26T12:20:37Z", "commit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMDozOFrOGpezCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMjo0MlrOGpe25Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0OTM4Nw==", "bodyText": "I believe this waitForTasksToFinish can be removed since there aren't any post-commit triggers on the modules database. We only need it after loading entity models.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446149387", "createdAt": "2020-06-26T12:20:38Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/testFixtures/java/com/marklogic/hub/test/AbstractHubTest.java", "diffHunk": "@@ -289,26 +289,33 @@ protected void installUserModulesAndArtifacts(HubConfig hubConfig, boolean force\n         loadUserModulesCommand.setLoadQueryOptions(loadQueryOptions);\n         commands.add(loadUserModulesCommand);\n \n-        LoadUserArtifactsCommand loadUserArtifactsCommand = new LoadUserArtifactsCommand(hubConfig);\n-        loadUserArtifactsCommand.setForceLoad(forceLoad);\n-        commands.add(loadUserArtifactsCommand);\n-\n         SimpleAppDeployer deployer = new SimpleAppDeployer(hubConfig.getManageClient(), hubConfig.getAdminManager());\n         deployer.setCommands(commands);\n         deployer.deploy(hubConfig.getAppConfig());\n \n-        // Wait for post-commit triggers to finish\n         waitForTasksToFinish();\n-\n+        // Generate function metadata must occur after loading modules", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0OTkwNQ==", "bodyText": "If this is needed, then just change this class to extend AbstractHubCoreTest instead of HubTestBase, as AHCT is calling resetHubProject. Can remove the Spring annotations from this test class too.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446149905", "createdAt": "2020-06-26T12:21:48Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/cli/client/RunFlowViaMainTest.java", "diffHunk": "@@ -36,6 +33,11 @@ public static void cleanUp() {\n         new Installer().deleteProjectDir();\n     }\n \n+    @BeforeEach\n+    public void beforeEach() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE1MDM3Mw==", "bodyText": "This is never used anywhere, does it need to be added?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446150373", "createdAt": "2020-06-26T12:22:42Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/HubClientImpl.java", "diffHunk": "@@ -38,6 +40,7 @@ public HubClientImpl(HubConfigImpl hubConfig, Map<DatabaseKind, String> database\n         jobsClient = hubConfig.newJobDbClient();\n         this.databaseNames = databaseNames;\n         this.manageClient = hubConfig.getManageClient();\n+        this.modulesClient = hubConfig.newModulesDbClient();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/84ccffdcb7f2235c0c281d863751b1d1c9c65ab2", "committedDate": "2020-06-25T23:46:23Z", "message": "DHFPROD-5277: Fix ML-9.0-12 tests"}, "afterCommit": {"oid": "c91ed5cb541d4faa4ab46dc3ba0db5bbfc4f8962", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c91ed5cb541d4faa4ab46dc3ba0db5bbfc4f8962", "committedDate": "2020-06-26T19:41:37Z", "message": "DHFPROD-5277: Fix ML-9.0-12 tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c91ed5cb541d4faa4ab46dc3ba0db5bbfc4f8962", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c91ed5cb541d4faa4ab46dc3ba0db5bbfc4f8962", "committedDate": "2020-06-26T19:41:37Z", "message": "DHFPROD-5277: Fix ML-9.0-12 tests"}, "afterCommit": {"oid": "e9ea8a8484e1a4b5db70c43ae7707ff421fe5242", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e9ea8a8484e1a4b5db70c43ae7707ff421fe5242", "committedDate": "2020-06-26T22:50:18Z", "message": "DHFPROD-5277: Fix ML-9.0-12 tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9ea8a8484e1a4b5db70c43ae7707ff421fe5242", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e9ea8a8484e1a4b5db70c43ae7707ff421fe5242", "committedDate": "2020-06-26T22:50:18Z", "message": "DHFPROD-5277: Fix ML-9.0-12 tests"}, "afterCommit": {"oid": "d198b65d536f9d547326ebb6d028fc7303d90aec", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d198b65d536f9d547326ebb6d028fc7303d90aec", "committedDate": "2020-06-26T23:22:04Z", "message": "DHFPROD-5277: Fix ML-9.0-12 tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjQzMDMy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#pullrequestreview-438643032", "createdAt": "2020-06-26T23:23:40Z", "commit": {"oid": "d198b65d536f9d547326ebb6d028fc7303d90aec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMzoyMzo0MVrOGpxIsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMzoyMzo0MVrOGpxIsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0OTg0MA==", "bodyText": "Also, Object.entries is not available in ML 9.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446449840", "createdAt": "2020-06-26T23:23:41Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/data-services/customStep/getCustomStep.sjs", "diffHunk": "@@ -22,9 +22,9 @@ let dataHubOptions = [\"sourceQuery\", \"sourceQueryIsScript\", \"constrainSourceQuer\n let additionalSettings = {};\n let step = Artifacts.getArtifact(\"custom\", stepName)\n let options = Artifacts.convertStepReferenceToInlineStep(step.stepId).options;\n-for (let [key, value] of Object.entries(options)) {\n+for (let key of Object.keys(options)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d198b65d536f9d547326ebb6d028fc7303d90aec"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d198b65d536f9d547326ebb6d028fc7303d90aec", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d198b65d536f9d547326ebb6d028fc7303d90aec", "committedDate": "2020-06-26T23:22:04Z", "message": "DHFPROD-5277: Fix ML-9.0-12 tests"}, "afterCommit": {"oid": "853a5e4f8dcfb343db24a8eae0f9fff0f7137fc2", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/853a5e4f8dcfb343db24a8eae0f9fff0f7137fc2", "committedDate": "2020-06-26T23:25:56Z", "message": "DHFPROD-5277: Fix ML-9.0-12 tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzA2Njk0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#pullrequestreview-438706694", "createdAt": "2020-06-27T15:45:40Z", "commit": {"oid": "853a5e4f8dcfb343db24a8eae0f9fff0f7137fc2"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNTo0NTo0MFrOGp2loQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNTo0NjozOFrOGp2l5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzOTE2OQ==", "bodyText": "This can still be removed right?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446539169", "createdAt": "2020-06-27T15:45:40Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/HubClientImpl.java", "diffHunk": "@@ -28,6 +28,8 @@\n     private DatabaseClient stagingClient;\n     private DatabaseClient finalClient;\n     private DatabaseClient jobsClient;\n+    private DatabaseClient modulesClient;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "853a5e4f8dcfb343db24a8eae0f9fff0f7137fc2"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzOTIzOQ==", "bodyText": "I'm thinking we should make a list of the strings that won't work in ML 9, and we can then have a JUnit test that scans each SJS file and throws an error if any are found. So far, we have at least Object.entries and \"{...\", right? I can write up a JIRA ticket for it, and we can always add to the list.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446539239", "createdAt": "2020-06-27T15:46:38Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/data-services/customStep/getCustomStep.sjs", "diffHunk": "@@ -22,9 +22,9 @@ let dataHubOptions = [\"sourceQuery\", \"sourceQueryIsScript\", \"constrainSourceQuer\n let additionalSettings = {};\n let step = Artifacts.getArtifact(\"custom\", stepName)\n let options = Artifacts.convertStepReferenceToInlineStep(step.stepId).options;\n-for (let [key, value] of Object.entries(options)) {\n+for (let key of Object.keys(options)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0OTg0MA=="}, "originalCommit": {"oid": "d198b65d536f9d547326ebb6d028fc7303d90aec"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cfad16da5ee8e68dd82d1fa763b8e2ef109e6b4", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/2cfad16da5ee8e68dd82d1fa763b8e2ef109e6b4", "committedDate": "2020-06-29T05:37:02Z", "message": "DHFPROD-5277: Fix ML-9.0-12 tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "853a5e4f8dcfb343db24a8eae0f9fff0f7137fc2", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/853a5e4f8dcfb343db24a8eae0f9fff0f7137fc2", "committedDate": "2020-06-26T23:25:56Z", "message": "DHFPROD-5277: Fix ML-9.0-12 tests"}, "afterCommit": {"oid": "2cfad16da5ee8e68dd82d1fa763b8e2ef109e6b4", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/2cfad16da5ee8e68dd82d1fa763b8e2ef109e6b4", "committedDate": "2020-06-29T05:37:02Z", "message": "DHFPROD-5277: Fix ML-9.0-12 tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTA3Nzc4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#pullrequestreview-439507778", "createdAt": "2020-06-29T21:18:23Z", "commit": {"oid": "2cfad16da5ee8e68dd82d1fa763b8e2ef109e6b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTQyNjA1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#pullrequestreview-439542605", "createdAt": "2020-06-29T22:22:27Z", "commit": {"oid": "2cfad16da5ee8e68dd82d1fa763b8e2ef109e6b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2585, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}