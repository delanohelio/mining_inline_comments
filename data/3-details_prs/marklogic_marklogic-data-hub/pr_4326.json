{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMzU0MjEx", "number": 4326, "title": "DHFPROD-5371: Navigate away prompt for modeling", "bodyText": "Description\nupdated @testing-library/user-event to v12 for type method no longer being async\nhttps://github.com/testing-library/user-event/releases/tag/v12.0.0\nadded @testing-library/dom -> new dependency for user-event\nadded model reader e2e test\nPersist model between tiles + navigation warn when logout: https://drive.google.com/file/d/15jSoV-fe7JgRWs4xeaYaJEBHTmNDrzQY/view\nNavigate away with edits: https://drive.google.com/file/d/1eI-cDhw0GlTXd0YDSGvjnVzWsTWjmaOu/view\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-07-31T17:46:13Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326", "merged": true, "mergeCommit": {"oid": "f571b369c4b9ffcf085a8359d1944279325ec8ee"}, "closed": true, "closedAt": "2020-08-10T21:23:14Z", "author": {"login": "brucean52"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7_Tj-ABqjM2MjU4NzQzOTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9loEdgFqTQ2NDQyOTIzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ef42373776aed25e9acdc01ca0353d3660a1963", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9ef42373776aed25e9acdc01ca0353d3660a1963", "committedDate": "2020-07-31T17:40:34Z", "message": "DHFPROD-5371: Navigate away prompt for modeling"}, "afterCommit": {"oid": "977c635a8ba2b04f90cde942baca6af64ba990d3", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/977c635a8ba2b04f90cde942baca6af64ba990d3", "committedDate": "2020-08-05T17:08:35Z", "message": "DHFPROD-5371: Navigate away with Modeling edits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDQwMjc3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#pullrequestreview-462040277", "createdAt": "2020-08-05T21:34:16Z", "commit": {"oid": "977c635a8ba2b04f90cde942baca6af64ba990d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMTozNDoxNlrOG8bb5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMTozNDoxNlrOG8bb5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAxNzI1Mw==", "bodyText": "wondering why you had to use force: true option.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#discussion_r466017253", "createdAt": "2020-08-05T21:34:16Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/integration/modeling/reader.spec.tsx", "diffHunk": "@@ -0,0 +1,93 @@\n+/// <reference types=\"cypress\"/>\n+\n+import modelPage from '../../support/pages/model';\n+import {\n+  entityTypeModal,\n+  entityTypeTable,\n+  propertyModal,\n+  propertyTable,\n+} from '../../support/components/model/index';\n+import { confirmationModal, toolbar, tiles } from '../../support/components/common/index';\n+import { Application } from '../../support/application.config';\n+import browsePage from '../../support/pages/browse'\n+import 'cypress-wait-until';\n+\n+describe('Entity Modeling: Reader Role', () => {\n+\n+  //login with valid account\n+  beforeEach(() => {\n+    cy.visit('/');\n+    cy.contains(Application.title);\n+    console.log(Cypress.env('mlHost'));\n+    cy.loginAsTestUserWithRoles(\"hub-central-entity-model-reader\").withRequest()\n+    cy.waitUntil(() => toolbar.getModelToolbarIcon()).click();\n+    entityTypeTable.waitForTableToLoad();\n+  });\n+\n+  after(() => {\n+      //resetting the test user back to only have 'hub-central-user' role\n+      cy.resetTestUser();\n+  });\n+\n+  it('can navigate by clicking instance count and last processed, can not create, edit, or delete entity models', () => {\n+    cy.waitUntil(() => entityTypeTable.getEntityLastProcessed('Person')).click();\n+    cy.url().should('include', '/tiles/explore');\n+    tiles.getExploreTile().should('exist');\n+    cy.waitUntil(() => browsePage.getSelectedEntity()).should('eq', 'Person');\n+    browsePage.getClearAllButton().should('exist');\n+    \n+    toolbar.getModelToolbarIcon().click();\n+    cy.url().should('include', '/tiles/model');\n+    tiles.getModelTile().should('exist');\n+\n+    cy.waitUntil(() => entityTypeTable.getEntityInstanceCount('Order')).click();\n+    cy.url().should('include', '/tiles/explore');\n+    tiles.getExploreTile().should('exist');\n+    cy.waitUntil(() => browsePage.getSelectedEntity().should('eq', 'Order'));\n+    browsePage.getClearAllButton().should('not.exist');\n+\n+    cy.go('back');\n+    cy.url().should('include', '/tiles/model');\n+    tiles.getModelTile().should('exist');\n+\n+    modelPage.getAddEntityButton().click({ force: true });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977c635a8ba2b04f90cde942baca6af64ba990d3"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDUzODIz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#pullrequestreview-462053823", "createdAt": "2020-08-05T21:59:46Z", "commit": {"oid": "977c635a8ba2b04f90cde942baca6af64ba990d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMTo1OTo0NlrOG8cHog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMTo1OTo0NlrOG8cHog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAyODQ1MA==", "bodyText": "can we verify the actual message here?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#discussion_r466028450", "createdAt": "2020-08-05T21:59:46Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.test.tsx", "diffHunk": "@@ -304,5 +296,39 @@ describe('Confirmation Modal Component', () => {\n     userEvent.click(getByText('Yes'));\n     expect(confirmAction).toBeCalledTimes(1);\n   });\n+\n+  test('can render navigation away confirmation', () => {\n+    let toggleModal = jest.fn();\n+    let confirmAction = jest.fn();\n+\n+    const { queryByLabelText, getByText, rerender, getByLabelText } =  render(\n+      <ConfirmationModal\n+        isVisible={false}\n+        type={ConfirmationType.NavigationWarn}\n+        boldTextArray={[]}\n+        toggleModal={toggleModal}\n+        confirmAction={confirmAction}\n+      />\n+    );\n+\n+    expect(queryByLabelText('navigation-warn-text')).toBeNull();\n+\n+    rerender(<ConfirmationModal\n+      isVisible={true}\n+      type={ConfirmationType.NavigationWarn}\n+      boldTextArray={[]}\n+      toggleModal={toggleModal}\n+      confirmAction={confirmAction}\n+    />);\n+\n+    expect(getByText('Unsaved Changes')).toBeInTheDocument();\n+    expect(getByLabelText('navigation-warn-text')).toBeInTheDocument();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977c635a8ba2b04f90cde942baca6af64ba990d3"}, "originalPosition": 245}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "977c635a8ba2b04f90cde942baca6af64ba990d3", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/977c635a8ba2b04f90cde942baca6af64ba990d3", "committedDate": "2020-08-05T17:08:35Z", "message": "DHFPROD-5371: Navigate away with Modeling edits"}, "afterCommit": {"oid": "e1dff8a927e8dfa73fb8999ccfc7c10b58f24497", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e1dff8a927e8dfa73fb8999ccfc7c10b58f24497", "committedDate": "2020-08-06T16:59:00Z", "message": "DHFPROD-5371: Navigate away prompt for modeling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1dff8a927e8dfa73fb8999ccfc7c10b58f24497", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e1dff8a927e8dfa73fb8999ccfc7c10b58f24497", "committedDate": "2020-08-06T16:59:00Z", "message": "DHFPROD-5371: Navigate away prompt for modeling"}, "afterCommit": {"oid": "d9656a7519495f454f79ac0a328c9bd81893bb19", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d9656a7519495f454f79ac0a328c9bd81893bb19", "committedDate": "2020-08-07T18:16:02Z", "message": "DHFPROD-5371: Navigate away prompt for modeling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNjU0NTAx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#pullrequestreview-463654501", "createdAt": "2020-08-07T21:40:04Z", "commit": {"oid": "d9656a7519495f454f79ac0a328c9bd81893bb19"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNjU2NjQz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#pullrequestreview-463656643", "createdAt": "2020-08-07T21:45:54Z", "commit": {"oid": "d9656a7519495f454f79ac0a328c9bd81893bb19"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "102131518621fce24759d3f22ef66b48a6e2562e", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/102131518621fce24759d3f22ef66b48a6e2562e", "committedDate": "2020-08-10T17:01:19Z", "message": "DHFPROD-5371: Navigate away prompt for modeling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9656a7519495f454f79ac0a328c9bd81893bb19", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d9656a7519495f454f79ac0a328c9bd81893bb19", "committedDate": "2020-08-07T18:16:02Z", "message": "DHFPROD-5371: Navigate away prompt for modeling"}, "afterCommit": {"oid": "102131518621fce24759d3f22ef66b48a6e2562e", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/102131518621fce24759d3f22ef66b48a6e2562e", "committedDate": "2020-08-10T17:01:19Z", "message": "DHFPROD-5371: Navigate away prompt for modeling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDE5MDcz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#pullrequestreview-464419073", "createdAt": "2020-08-10T17:11:03Z", "commit": {"oid": "102131518621fce24759d3f22ef66b48a6e2562e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDIyODgw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#pullrequestreview-464422880", "createdAt": "2020-08-10T17:16:30Z", "commit": {"oid": "102131518621fce24759d3f22ef66b48a6e2562e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDI5MjM4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4326#pullrequestreview-464429238", "createdAt": "2020-08-10T17:25:43Z", "commit": {"oid": "102131518621fce24759d3f22ef66b48a6e2562e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2529, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}