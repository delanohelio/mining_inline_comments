{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMDAwMTcx", "number": 4336, "title": "DHFPROD-5512: Save and delete entity type", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-08-04T20:49:20Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336", "merged": true, "mergeCommit": {"oid": "23f69ad2adf0c48b2171ed0127ebf7caee7b70d9"}, "closed": true, "closedAt": "2020-08-11T16:38:30Z", "author": {"login": "akshaysonvane"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8BuQXAFqTQ2MjAxMTk4OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc95IAoAFqTQ2NTIxNzM4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMDExOTg4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#pullrequestreview-462011988", "createdAt": "2020-08-05T20:47:52Z", "commit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDo0Nzo1MlrOG8aC5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMTowMTozNFrOG8adnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5NDQ2OQ==", "bodyText": "I recommend changing these from id to aria-label. I made change this in my PR for DHFPROD-5371 so I can use 'findByLabelText' in the RTL tests.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r465994469", "createdAt": "2020-08-05T20:47:52Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.tsx", "diffHunk": "@@ -101,6 +101,47 @@ const ConfirmationModal: React.FC<Props> = (props) => {\n         </>\n       )}\n \n+      {props.type === ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn && (\n+        <>\n+          <MLAlert\n+            className={styles.alert}\n+            closable={false}\n+            description={\"There are existing entity type relationships, and outstanding edits that need to be saved.\"}\n+            showIcon\n+            type=\"warning\"\n+          />\n+          <p id=\"delete-relationship-edit-text\">The <b>{props.boldTextArray[0]}</b> entity type is related to one or", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5NTU3Nw==", "bodyText": "FYI, the 'title' for the confirmation modal has been removed in my PR for DHFPROD-5371", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r465995577", "createdAt": "2020-08-05T20:50:07Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.test.tsx", "diffHunk": "@@ -165,6 +165,86 @@ describe('Confirmation Modal Component', () => {\n     expect(toggleModal).toBeCalledTimes(1);\n   });\n \n+  test('can render delete type entity relation with outstanding edit warn confirmation', () => {\n+    let entityName = 'PersonXML';\n+    let arrayValues = ['Person-Mapping-XML']\n+    let toggleModal = jest.fn();\n+    let confirmAction = jest.fn();\n+\n+    const { queryByText, getByText, getAllByText, rerender } =  render(\n+      <ConfirmationModal\n+        isVisible={false}\n+        type={ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn}\n+        boldTextArray={[entityName]}\n+        arrayValues={arrayValues}\n+        toggleModal={toggleModal}\n+        confirmAction={confirmAction}\n+      />\n+    );\n+\n+    expect(queryByText('Confirmation')).toBeNull();\n+\n+    rerender(<ConfirmationModal\n+      isVisible={true}\n+      type={ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn}\n+      boldTextArray={[entityName]}\n+      arrayValues={arrayValues}\n+      toggleModal={toggleModal}\n+      confirmAction={confirmAction}\n+    />);\n+\n+    expect(getByText('Confirmation')).toBeInTheDocument();\n+    expect(getAllByText(entityName)).toHaveLength(4);\n+    expect(getByText('There are existing entity type relationships, and outstanding edits that need to be saved.')).toBeInTheDocument();\n+    expect(getByText(arrayValues[0])).toBeInTheDocument();\n+\n+    userEvent.click(getByText('No'));\n+    expect(toggleModal).toBeCalledTimes(1);\n+\n+    userEvent.click(getByText('Yes'));\n+    expect(confirmAction).toBeCalledTimes(1);\n+  });\n+\n+  test('can render delete type outstanding edit warn confirmation', () => {\n+    let entityName = 'PersonXML';\n+    let arrayValues = ['Person-Mapping-XML']\n+    let toggleModal = jest.fn();\n+    let confirmAction = jest.fn();\n+\n+    const { queryByText, getByText, getAllByText, rerender } =  render(\n+      <ConfirmationModal\n+        isVisible={false}\n+        type={ConfirmationType.DeleteEntityNoRelationshipOutstandingEditWarn}\n+        boldTextArray={[entityName]}\n+        arrayValues={arrayValues}\n+        toggleModal={toggleModal}\n+        confirmAction={confirmAction}\n+      />\n+    );\n+\n+    expect(queryByText('Confirmation')).toBeNull();\n+\n+    rerender(<ConfirmationModal\n+      isVisible={true}\n+      type={ConfirmationType.DeleteEntityNoRelationshipOutstandingEditWarn}\n+      boldTextArray={[entityName]}\n+      arrayValues={arrayValues}\n+      toggleModal={toggleModal}\n+      confirmAction={confirmAction}\n+    />);\n+\n+    expect(getByText('Confirmation')).toBeInTheDocument();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwMTMxMQ==", "bodyText": "I don't think this needs to be it's own state variable. You should use 'modelingOptions.isModified' directly and use the context functions to do mutations", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466001311", "createdAt": "2020-08-05T21:01:34Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/modeling/entity-type-table/entity-type-table.tsx", "diffHunk": "@@ -37,7 +37,7 @@ const EntityTypeTable: React.FC<Props> = (props) => {\n \n   const [showConfirmModal, toggleConfirmModal] = useState(false);\n   const [confirmBoldTextArray, setConfirmBoldTextArray] = useState<string[]>([]);\n-  const [stepValuesArray, setStepValuesArray] = useState<string[]>([]);\n+  const [arrayValues, setArrayValues] = useState<string[]>([]);\n   const [confirmType, setConfirmType] = useState<ConfirmationType>(ConfirmationType.DeleteEntity);\n   const [isAnyEntityModified, toggleAnyEntityModified] = useState(modelingOptions.isModified);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/7445218052df50150d401701b5c6e5711ccb0a5f", "committedDate": "2020-08-04T18:00:39Z", "message": "DHFPROD-5512: Save and delete entity type"}, "afterCommit": {"oid": "5bf63f99b231541a5af965c3a0c17eca9fd6c727", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/5bf63f99b231541a5af965c3a0c17eca9fd6c727", "committedDate": "2020-08-10T22:26:32Z", "message": "DHFPROD-5512: Save and delete entity type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NjU2MzQx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#pullrequestreview-464656341", "createdAt": "2020-08-10T23:38:09Z", "commit": {"oid": "5bf63f99b231541a5af965c3a0c17eca9fd6c727"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzozODowOVrOG-jT2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzozODowOVrOG-jT2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI0MzQxNg==", "bodyText": "Seeing failures running this on my local system. Please try increasing this.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r468243416", "createdAt": "2020-08-10T23:38:09Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/support/components/common/confirmation-modal.tsx", "diffHunk": "@@ -33,6 +33,15 @@ class ConfirmationModal {\n   getDeleteEntityRelationshipText() {\n     return cy.findByLabelText('delete-relationship-text', {timeout: 15000});\n   }\n+\n+  getDeleteEntityRelationshipEditText() {\n+    return cy.findByLabelText('delete-relationship-edit-text', {timeout: 15000});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bf63f99b231541a5af965c3a0c17eca9fd6c727"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6205912fc6ca14924f9053d381a57c0052146a5", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b6205912fc6ca14924f9053d381a57c0052146a5", "committedDate": "2020-08-11T00:00:12Z", "message": "DHFPROD-5512: Save and delete entity type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5bf63f99b231541a5af965c3a0c17eca9fd6c727", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/5bf63f99b231541a5af965c3a0c17eca9fd6c727", "committedDate": "2020-08-10T22:26:32Z", "message": "DHFPROD-5512: Save and delete entity type"}, "afterCommit": {"oid": "b6205912fc6ca14924f9053d381a57c0052146a5", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b6205912fc6ca14924f9053d381a57c0052146a5", "committedDate": "2020-08-11T00:00:12Z", "message": "DHFPROD-5512: Save and delete entity type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NjY4Mzc1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#pullrequestreview-464668375", "createdAt": "2020-08-11T00:15:49Z", "commit": {"oid": "b6205912fc6ca14924f9053d381a57c0052146a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MjE3Mzg5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#pullrequestreview-465217389", "createdAt": "2020-08-11T16:08:48Z", "commit": {"oid": "b6205912fc6ca14924f9053d381a57c0052146a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2236, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}