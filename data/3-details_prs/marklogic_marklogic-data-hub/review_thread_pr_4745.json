{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NzU2OTMz", "number": 4745, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjoyNDo0N1rOEw2N6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjoyNDo0N1rOEw2N6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjU1NDAxOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/test/ml-modules/root/test/suites/data-hub/5/data-services/entitySearch/getRecordTest.sjs", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjoyNDo0N1rOHmp_iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjo0NzowN1rOHmq4wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI5NTk0Nw==", "bodyText": "Should these be uncommented now? It doesn't appear that anything is being tested here.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4745#discussion_r510295947", "createdAt": "2020-10-22T16:24:47Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/test/ml-modules/root/test/suites/data-hub/5/data-services/entitySearch/getRecordTest.sjs", "diffHunk": "@@ -0,0 +1,95 @@\n+const test = require(\"/test/test-helper.xqy\");\n+const entitySearchService = require(\"/test/suites/data-hub/5/data-services/lib/entitySearchService.sjs\");\n+\n+function getJsonRecordTest() {\n+  const docUri = \"/content/jane.json\";\n+  xdmp.invokeFunction(function() {\n+    declareUpdate();\n+    xdmp.documentSetMetadata(\"/content/jane.json\",\n+        {\n+          \"datahubCreatedByStep\": \"map-step\",\n+          \"datahubCreatedInFlow\": \"CurateCustomerJSON\",\n+          \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+        });\n+  });\n+\n+  const record = entitySearchService.getRecord(docUri);\n+  const expectedMetadata = JSON.stringify({\n+    \"datahubCreatedByStep\": \"map-step\",\n+    \"datahubCreatedInFlow\": \"CurateCustomerJSON\",\n+    \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+  });\n+\n+  return[\n+    test.assertEqual(fn.doc(docUri), record.data),\n+    test.assertEqual(expectedMetadata, JSON.stringify(record.recordMetadata)),\n+    test.assertEqual(true, record.isHubEntityInstance),\n+    test.assertEqual(\"json\", record.recordType)\n+  ];\n+}\n+\n+function getXmlRecordTest() {\n+  const docUri = \"/content/jane.xml\";\n+  xdmp.invokeFunction(function() {\n+    declareUpdate();\n+    xdmp.documentSetMetadata(\"/content/jane.xml\",\n+        {\n+          \"datahubCreatedByStep\": \"map-step\",\n+          \"datahubCreatedInFlow\": \"CurateCustomerXML\",\n+          \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+        });\n+  });\n+\n+  const record = entitySearchService.getRecord(docUri);\n+  const expectedMetadata = JSON.stringify({\n+    \"datahubCreatedByStep\": \"map-step\",\n+    \"datahubCreatedInFlow\": \"CurateCustomerXML\",\n+    \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+  });\n+\n+  return[\n+    test.assertEqual(fn.doc(docUri), record.data),\n+    test.assertEqual(expectedMetadata, JSON.stringify(record.recordMetadata)),\n+    test.assertEqual(true, record.isHubEntityInstance),\n+    test.assertEqual(\"xml\", record.recordType)\n+  ];\n+}\n+\n+function getTextRecordTest() {\n+  const docUri = \"/content/jane.txt\";\n+  xdmp.invokeFunction(function() {\n+    declareUpdate();\n+    xdmp.documentSetMetadata(\"/content/jane.txt\",\n+        {\n+          \"datahubCreatedByStep\": \"ingest-step\",\n+          \"datahubCreatedInFlow\": \"ingestText\",\n+          \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+        });\n+  });\n+\n+  const record = entitySearchService.getRecord(docUri);\n+  const expectedMetadata = JSON.stringify({\n+    \"datahubCreatedByStep\": \"ingest-step\",\n+    \"datahubCreatedInFlow\": \"ingestText\",\n+    \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+  });\n+\n+  return[\n+    test.assertEqual(fn.doc(docUri), record.data),\n+    test.assertEqual(expectedMetadata, JSON.stringify(record.recordMetadata)),\n+    test.assertEqual(false, record.isHubEntityInstance),\n+    test.assertEqual(\"text\", record.recordType)\n+  ];\n+}\n+\n+function getNonExistentRecordTest() {\n+  const docUri = \"/content/nonExistentRecord.json\";\n+  const record = entitySearchService.getRecord(docUri);\n+  console.log(record);\n+}\n+\n+[]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f5fc255bb62af21daf67ccc3e662f30e06bb72c"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxMDU5NA==", "bodyText": "Thank you for noticing it. I updated it", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4745#discussion_r510310594", "createdAt": "2020-10-22T16:47:07Z", "author": {"login": "rahulvudutala"}, "path": "marklogic-data-hub/src/test/ml-modules/root/test/suites/data-hub/5/data-services/entitySearch/getRecordTest.sjs", "diffHunk": "@@ -0,0 +1,95 @@\n+const test = require(\"/test/test-helper.xqy\");\n+const entitySearchService = require(\"/test/suites/data-hub/5/data-services/lib/entitySearchService.sjs\");\n+\n+function getJsonRecordTest() {\n+  const docUri = \"/content/jane.json\";\n+  xdmp.invokeFunction(function() {\n+    declareUpdate();\n+    xdmp.documentSetMetadata(\"/content/jane.json\",\n+        {\n+          \"datahubCreatedByStep\": \"map-step\",\n+          \"datahubCreatedInFlow\": \"CurateCustomerJSON\",\n+          \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+        });\n+  });\n+\n+  const record = entitySearchService.getRecord(docUri);\n+  const expectedMetadata = JSON.stringify({\n+    \"datahubCreatedByStep\": \"map-step\",\n+    \"datahubCreatedInFlow\": \"CurateCustomerJSON\",\n+    \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+  });\n+\n+  return[\n+    test.assertEqual(fn.doc(docUri), record.data),\n+    test.assertEqual(expectedMetadata, JSON.stringify(record.recordMetadata)),\n+    test.assertEqual(true, record.isHubEntityInstance),\n+    test.assertEqual(\"json\", record.recordType)\n+  ];\n+}\n+\n+function getXmlRecordTest() {\n+  const docUri = \"/content/jane.xml\";\n+  xdmp.invokeFunction(function() {\n+    declareUpdate();\n+    xdmp.documentSetMetadata(\"/content/jane.xml\",\n+        {\n+          \"datahubCreatedByStep\": \"map-step\",\n+          \"datahubCreatedInFlow\": \"CurateCustomerXML\",\n+          \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+        });\n+  });\n+\n+  const record = entitySearchService.getRecord(docUri);\n+  const expectedMetadata = JSON.stringify({\n+    \"datahubCreatedByStep\": \"map-step\",\n+    \"datahubCreatedInFlow\": \"CurateCustomerXML\",\n+    \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+  });\n+\n+  return[\n+    test.assertEqual(fn.doc(docUri), record.data),\n+    test.assertEqual(expectedMetadata, JSON.stringify(record.recordMetadata)),\n+    test.assertEqual(true, record.isHubEntityInstance),\n+    test.assertEqual(\"xml\", record.recordType)\n+  ];\n+}\n+\n+function getTextRecordTest() {\n+  const docUri = \"/content/jane.txt\";\n+  xdmp.invokeFunction(function() {\n+    declareUpdate();\n+    xdmp.documentSetMetadata(\"/content/jane.txt\",\n+        {\n+          \"datahubCreatedByStep\": \"ingest-step\",\n+          \"datahubCreatedInFlow\": \"ingestText\",\n+          \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+        });\n+  });\n+\n+  const record = entitySearchService.getRecord(docUri);\n+  const expectedMetadata = JSON.stringify({\n+    \"datahubCreatedByStep\": \"ingest-step\",\n+    \"datahubCreatedInFlow\": \"ingestText\",\n+    \"datahubCreatedOn\": \"2020-10-08T15:14:28.772612-07:00\"\n+  });\n+\n+  return[\n+    test.assertEqual(fn.doc(docUri), record.data),\n+    test.assertEqual(expectedMetadata, JSON.stringify(record.recordMetadata)),\n+    test.assertEqual(false, record.isHubEntityInstance),\n+    test.assertEqual(\"text\", record.recordType)\n+  ];\n+}\n+\n+function getNonExistentRecordTest() {\n+  const docUri = \"/content/nonExistentRecord.json\";\n+  const record = entitySearchService.getRecord(docUri);\n+  console.log(record);\n+}\n+\n+[]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI5NTk0Nw=="}, "originalCommit": {"oid": "6f5fc255bb62af21daf67ccc3e662f30e06bb72c"}, "originalPosition": 91}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3164, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}