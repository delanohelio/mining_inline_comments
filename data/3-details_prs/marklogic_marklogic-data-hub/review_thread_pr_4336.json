{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMDAwMTcx", "number": 4336, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDo0Nzo1MlrOEVklNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzozODowOVrOEW__5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMDU0OTAwOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDo0Nzo1MlrOG8aC5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzo1ODoyMFrOG8-W6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5NDQ2OQ==", "bodyText": "I recommend changing these from id to aria-label. I made change this in my PR for DHFPROD-5371 so I can use 'findByLabelText' in the RTL tests.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r465994469", "createdAt": "2020-08-05T20:47:52Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.tsx", "diffHunk": "@@ -101,6 +101,47 @@ const ConfirmationModal: React.FC<Props> = (props) => {\n         </>\n       )}\n \n+      {props.type === ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn && (\n+        <>\n+          <MLAlert\n+            className={styles.alert}\n+            closable={false}\n+            description={\"There are existing entity type relationships, and outstanding edits that need to be saved.\"}\n+            showIcon\n+            type=\"warning\"\n+          />\n+          <p id=\"delete-relationship-edit-text\">The <b>{props.boldTextArray[0]}</b> entity type is related to one or", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4OTQxNg==", "bodyText": "Okay, I'll update the PR once your PR gets merged.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466589416", "createdAt": "2020-08-06T17:58:20Z", "author": {"login": "akshaysonvane"}, "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.tsx", "diffHunk": "@@ -101,6 +101,47 @@ const ConfirmationModal: React.FC<Props> = (props) => {\n         </>\n       )}\n \n+      {props.type === ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn && (\n+        <>\n+          <MLAlert\n+            className={styles.alert}\n+            closable={false}\n+            description={\"There are existing entity type relationships, and outstanding edits that need to be saved.\"}\n+            showIcon\n+            type=\"warning\"\n+          />\n+          <p id=\"delete-relationship-edit-text\">The <b>{props.boldTextArray[0]}</b> entity type is related to one or", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5NDQ2OQ=="}, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMDU1NTgyOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.test.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDo1MDowN1rOG8aHOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzo1OTowMFrOG8-YmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5NTU3Nw==", "bodyText": "FYI, the 'title' for the confirmation modal has been removed in my PR for DHFPROD-5371", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r465995577", "createdAt": "2020-08-05T20:50:07Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.test.tsx", "diffHunk": "@@ -165,6 +165,86 @@ describe('Confirmation Modal Component', () => {\n     expect(toggleModal).toBeCalledTimes(1);\n   });\n \n+  test('can render delete type entity relation with outstanding edit warn confirmation', () => {\n+    let entityName = 'PersonXML';\n+    let arrayValues = ['Person-Mapping-XML']\n+    let toggleModal = jest.fn();\n+    let confirmAction = jest.fn();\n+\n+    const { queryByText, getByText, getAllByText, rerender } =  render(\n+      <ConfirmationModal\n+        isVisible={false}\n+        type={ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn}\n+        boldTextArray={[entityName]}\n+        arrayValues={arrayValues}\n+        toggleModal={toggleModal}\n+        confirmAction={confirmAction}\n+      />\n+    );\n+\n+    expect(queryByText('Confirmation')).toBeNull();\n+\n+    rerender(<ConfirmationModal\n+      isVisible={true}\n+      type={ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn}\n+      boldTextArray={[entityName]}\n+      arrayValues={arrayValues}\n+      toggleModal={toggleModal}\n+      confirmAction={confirmAction}\n+    />);\n+\n+    expect(getByText('Confirmation')).toBeInTheDocument();\n+    expect(getAllByText(entityName)).toHaveLength(4);\n+    expect(getByText('There are existing entity type relationships, and outstanding edits that need to be saved.')).toBeInTheDocument();\n+    expect(getByText(arrayValues[0])).toBeInTheDocument();\n+\n+    userEvent.click(getByText('No'));\n+    expect(toggleModal).toBeCalledTimes(1);\n+\n+    userEvent.click(getByText('Yes'));\n+    expect(confirmAction).toBeCalledTimes(1);\n+  });\n+\n+  test('can render delete type outstanding edit warn confirmation', () => {\n+    let entityName = 'PersonXML';\n+    let arrayValues = ['Person-Mapping-XML']\n+    let toggleModal = jest.fn();\n+    let confirmAction = jest.fn();\n+\n+    const { queryByText, getByText, getAllByText, rerender } =  render(\n+      <ConfirmationModal\n+        isVisible={false}\n+        type={ConfirmationType.DeleteEntityNoRelationshipOutstandingEditWarn}\n+        boldTextArray={[entityName]}\n+        arrayValues={arrayValues}\n+        toggleModal={toggleModal}\n+        confirmAction={confirmAction}\n+      />\n+    );\n+\n+    expect(queryByText('Confirmation')).toBeNull();\n+\n+    rerender(<ConfirmationModal\n+      isVisible={true}\n+      type={ConfirmationType.DeleteEntityNoRelationshipOutstandingEditWarn}\n+      boldTextArray={[entityName]}\n+      arrayValues={arrayValues}\n+      toggleModal={toggleModal}\n+      confirmAction={confirmAction}\n+    />);\n+\n+    expect(getByText('Confirmation')).toBeInTheDocument();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU4OTg0OA==", "bodyText": "Thanks for the heads-up. I'll update once your PR gets merged.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466589848", "createdAt": "2020-08-06T17:59:00Z", "author": {"login": "akshaysonvane"}, "path": "marklogic-data-hub-central/ui/src/components/confirmation-modal/confirmation-modal.test.tsx", "diffHunk": "@@ -165,6 +165,86 @@ describe('Confirmation Modal Component', () => {\n     expect(toggleModal).toBeCalledTimes(1);\n   });\n \n+  test('can render delete type entity relation with outstanding edit warn confirmation', () => {\n+    let entityName = 'PersonXML';\n+    let arrayValues = ['Person-Mapping-XML']\n+    let toggleModal = jest.fn();\n+    let confirmAction = jest.fn();\n+\n+    const { queryByText, getByText, getAllByText, rerender } =  render(\n+      <ConfirmationModal\n+        isVisible={false}\n+        type={ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn}\n+        boldTextArray={[entityName]}\n+        arrayValues={arrayValues}\n+        toggleModal={toggleModal}\n+        confirmAction={confirmAction}\n+      />\n+    );\n+\n+    expect(queryByText('Confirmation')).toBeNull();\n+\n+    rerender(<ConfirmationModal\n+      isVisible={true}\n+      type={ConfirmationType.DeleteEntityRelationshipOutstandingEditWarn}\n+      boldTextArray={[entityName]}\n+      arrayValues={arrayValues}\n+      toggleModal={toggleModal}\n+      confirmAction={confirmAction}\n+    />);\n+\n+    expect(getByText('Confirmation')).toBeInTheDocument();\n+    expect(getAllByText(entityName)).toHaveLength(4);\n+    expect(getByText('There are existing entity type relationships, and outstanding edits that need to be saved.')).toBeInTheDocument();\n+    expect(getByText(arrayValues[0])).toBeInTheDocument();\n+\n+    userEvent.click(getByText('No'));\n+    expect(toggleModal).toBeCalledTimes(1);\n+\n+    userEvent.click(getByText('Yes'));\n+    expect(confirmAction).toBeCalledTimes(1);\n+  });\n+\n+  test('can render delete type outstanding edit warn confirmation', () => {\n+    let entityName = 'PersonXML';\n+    let arrayValues = ['Person-Mapping-XML']\n+    let toggleModal = jest.fn();\n+    let confirmAction = jest.fn();\n+\n+    const { queryByText, getByText, getAllByText, rerender } =  render(\n+      <ConfirmationModal\n+        isVisible={false}\n+        type={ConfirmationType.DeleteEntityNoRelationshipOutstandingEditWarn}\n+        boldTextArray={[entityName]}\n+        arrayValues={arrayValues}\n+        toggleModal={toggleModal}\n+        confirmAction={confirmAction}\n+      />\n+    );\n+\n+    expect(queryByText('Confirmation')).toBeNull();\n+\n+    rerender(<ConfirmationModal\n+      isVisible={true}\n+      type={ConfirmationType.DeleteEntityNoRelationshipOutstandingEditWarn}\n+      boldTextArray={[entityName]}\n+      arrayValues={arrayValues}\n+      toggleModal={toggleModal}\n+      confirmAction={confirmAction}\n+    />);\n+\n+    expect(getByText('Confirmation')).toBeInTheDocument();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5NTU3Nw=="}, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 90}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMDU5MzA2OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/modeling/entity-type-table/entity-type-table.tsx", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMTowMTozNFrOG8adnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxODoyNTo1OFrOG8_SWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwMTMxMQ==", "bodyText": "I don't think this needs to be it's own state variable. You should use 'modelingOptions.isModified' directly and use the context functions to do mutations", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466001311", "createdAt": "2020-08-05T21:01:34Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/modeling/entity-type-table/entity-type-table.tsx", "diffHunk": "@@ -37,7 +37,7 @@ const EntityTypeTable: React.FC<Props> = (props) => {\n \n   const [showConfirmModal, toggleConfirmModal] = useState(false);\n   const [confirmBoldTextArray, setConfirmBoldTextArray] = useState<string[]>([]);\n-  const [stepValuesArray, setStepValuesArray] = useState<string[]>([]);\n+  const [arrayValues, setArrayValues] = useState<string[]>([]);\n   const [confirmType, setConfirmType] = useState<ConfirmationType>(ConfirmationType.DeleteEntity);\n   const [isAnyEntityModified, toggleAnyEntityModified] = useState(modelingOptions.isModified);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU5MTgzNQ==", "bodyText": "This isn't introducing a new state variable. It's just renaming the existing one from stepValuesArray to arrayValues since we are using that to pass both steps and model names.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466591835", "createdAt": "2020-08-06T18:02:24Z", "author": {"login": "akshaysonvane"}, "path": "marklogic-data-hub-central/ui/src/components/modeling/entity-type-table/entity-type-table.tsx", "diffHunk": "@@ -37,7 +37,7 @@ const EntityTypeTable: React.FC<Props> = (props) => {\n \n   const [showConfirmModal, toggleConfirmModal] = useState(false);\n   const [confirmBoldTextArray, setConfirmBoldTextArray] = useState<string[]>([]);\n-  const [stepValuesArray, setStepValuesArray] = useState<string[]>([]);\n+  const [arrayValues, setArrayValues] = useState<string[]>([]);\n   const [confirmType, setConfirmType] = useState<ConfirmationType>(ConfirmationType.DeleteEntity);\n   const [isAnyEntityModified, toggleAnyEntityModified] = useState(modelingOptions.isModified);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwMTMxMQ=="}, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU5NDc2NA==", "bodyText": "Sorry, I was actually referring to \"isAnyEntityModified\". You can use \"modelingOptions.isModified\" directly instead. See \"pages/Modeling.tsx\" if you need an example", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466594764", "createdAt": "2020-08-06T18:07:49Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/modeling/entity-type-table/entity-type-table.tsx", "diffHunk": "@@ -37,7 +37,7 @@ const EntityTypeTable: React.FC<Props> = (props) => {\n \n   const [showConfirmModal, toggleConfirmModal] = useState(false);\n   const [confirmBoldTextArray, setConfirmBoldTextArray] = useState<string[]>([]);\n-  const [stepValuesArray, setStepValuesArray] = useState<string[]>([]);\n+  const [arrayValues, setArrayValues] = useState<string[]>([]);\n   const [confirmType, setConfirmType] = useState<ConfirmationType>(ConfirmationType.DeleteEntity);\n   const [isAnyEntityModified, toggleAnyEntityModified] = useState(modelingOptions.isModified);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwMTMxMQ=="}, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwMDE2MQ==", "bodyText": "I had to add isAnyEntityModified as a state variable so that react would update the save and revert icons based on the operations performed on both the parent and the current component.\nSo when we revert all / save all from the parent component then the state change makes React to rerender the save/revert icons on the entity-type-table page.\nclassName={(!props.canWriteEntityModel && props.canReadEntityModel) || !isAnyEntityModified || !isEntityModified(text) ? styles.iconSaveReadOnly : styles.iconSave}", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466600161", "createdAt": "2020-08-06T18:17:48Z", "author": {"login": "akshaysonvane"}, "path": "marklogic-data-hub-central/ui/src/components/modeling/entity-type-table/entity-type-table.tsx", "diffHunk": "@@ -37,7 +37,7 @@ const EntityTypeTable: React.FC<Props> = (props) => {\n \n   const [showConfirmModal, toggleConfirmModal] = useState(false);\n   const [confirmBoldTextArray, setConfirmBoldTextArray] = useState<string[]>([]);\n-  const [stepValuesArray, setStepValuesArray] = useState<string[]>([]);\n+  const [arrayValues, setArrayValues] = useState<string[]>([]);\n   const [confirmType, setConfirmType] = useState<ConfirmationType>(ConfirmationType.DeleteEntity);\n   const [isAnyEntityModified, toggleAnyEntityModified] = useState(modelingOptions.isModified);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwMTMxMQ=="}, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwNDYzMw==", "bodyText": "Ok got it. That makes sense.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r466604633", "createdAt": "2020-08-06T18:25:58Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/modeling/entity-type-table/entity-type-table.tsx", "diffHunk": "@@ -37,7 +37,7 @@ const EntityTypeTable: React.FC<Props> = (props) => {\n \n   const [showConfirmModal, toggleConfirmModal] = useState(false);\n   const [confirmBoldTextArray, setConfirmBoldTextArray] = useState<string[]>([]);\n-  const [stepValuesArray, setStepValuesArray] = useState<string[]>([]);\n+  const [arrayValues, setArrayValues] = useState<string[]>([]);\n   const [confirmType, setConfirmType] = useState<ConfirmationType>(ConfirmationType.DeleteEntity);\n   const [isAnyEntityModified, toggleAnyEntityModified] = useState(modelingOptions.isModified);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAwMTMxMQ=="}, "originalCommit": {"oid": "7445218052df50150d401701b5c6e5711ccb0a5f"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTUyNjc3OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/e2e/cypress/support/components/common/confirmation-modal.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzozODowOVrOG-jT2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDowMTo0OVrOG-jwJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI0MzQxNg==", "bodyText": "Seeing failures running this on my local system. Please try increasing this.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r468243416", "createdAt": "2020-08-10T23:38:09Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/support/components/common/confirmation-modal.tsx", "diffHunk": "@@ -33,6 +33,15 @@ class ConfirmationModal {\n   getDeleteEntityRelationshipText() {\n     return cy.findByLabelText('delete-relationship-text', {timeout: 15000});\n   }\n+\n+  getDeleteEntityRelationshipEditText() {\n+    return cy.findByLabelText('delete-relationship-edit-text', {timeout: 15000});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5bf63f99b231541a5af965c3a0c17eca9fd6c727"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI1MDY2MA==", "bodyText": "Increased the timeout value to 25000", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4336#discussion_r468250660", "createdAt": "2020-08-11T00:01:49Z", "author": {"login": "akshaysonvane"}, "path": "marklogic-data-hub-central/ui/e2e/cypress/support/components/common/confirmation-modal.tsx", "diffHunk": "@@ -33,6 +33,15 @@ class ConfirmationModal {\n   getDeleteEntityRelationshipText() {\n     return cy.findByLabelText('delete-relationship-text', {timeout: 15000});\n   }\n+\n+  getDeleteEntityRelationshipEditText() {\n+    return cy.findByLabelText('delete-relationship-edit-text', {timeout: 15000});", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI0MzQxNg=="}, "originalCommit": {"oid": "5bf63f99b231541a5af965c3a0c17eca9fd6c727"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3761, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}