{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0OTY5NzYx", "number": 3925, "title": "DHFPROD-4185: Fixing the event bubbling issue in dropdown component", "bodyText": "Description\nThis PR fixes the dropdown issues in the Function selector and Source selector in Mapping UI.\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-05-07T23:30:14Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3925", "merged": true, "mergeCommit": {"oid": "3c0de3b3ea6cf59840ab18ca82ee5738e74a1dc9"}, "closed": true, "closedAt": "2020-05-08T22:53:36Z", "author": {"login": "xnikhil08"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfXV2YgBqjMzMTgyMTM2NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfZxeWAFqTQwODU2NTIwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c752dc86a740290fdde0f03bf10bc06a8d784dcf", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c752dc86a740290fdde0f03bf10bc06a8d784dcf", "committedDate": "2020-05-07T23:27:20Z", "message": "DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Fixing the failing test (+1 squashed commit)\nSquashed commits:\n[2f9a9abee] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\nDHFPROD-4185: Test for Function dropdown (+1 squashed commit)\nSquashed commits:\n[72115fb02] DHFPROD-4185: Fixing the event bubbling issue in dropdown component"}, "afterCommit": {"oid": "311326f13ffb964afc92e60f99747efec0da15ab", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/311326f13ffb964afc92e60f99747efec0da15ab", "committedDate": "2020-05-08T19:49:07Z", "message": "DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Rearranging the comments and code in the test case for Function dropdown (+1 squashed commit)\nSquashed commits:\n[c752dc86a] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Fixing the failing test (+1 squashed commit)\nSquashed commits:\n[2f9a9abee] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\nDHFPROD-4185: Test for Function dropdown (+1 squashed commit)\nSquashed commits:\n[72115fb02] DHFPROD-4185: Fixing the event bubbling issue in dropdown component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18a9931edad821bdb04834dc0cbf578c7a5e7591", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/18a9931edad821bdb04834dc0cbf578c7a5e7591", "committedDate": "2020-05-08T19:49:53Z", "message": "DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Rearranging the comments and code in the test case for Function dropdown (+1 squashed commit)\nSquashed commits:\n[c752dc86a] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Fixing the failing test (+1 squashed commit)\nSquashed commits:\n[2f9a9abee] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\nDHFPROD-4185: Test for Function dropdown (+1 squashed commit)\nSquashed commits:\n[72115fb02] DHFPROD-4185: Fixing the event bubbling issue in dropdown component"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "311326f13ffb964afc92e60f99747efec0da15ab", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/311326f13ffb964afc92e60f99747efec0da15ab", "committedDate": "2020-05-08T19:49:07Z", "message": "DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Rearranging the comments and code in the test case for Function dropdown (+1 squashed commit)\nSquashed commits:\n[c752dc86a] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Fixing the failing test (+1 squashed commit)\nSquashed commits:\n[2f9a9abee] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\nDHFPROD-4185: Test for Function dropdown (+1 squashed commit)\nSquashed commits:\n[72115fb02] DHFPROD-4185: Fixing the event bubbling issue in dropdown component"}, "afterCommit": {"oid": "18a9931edad821bdb04834dc0cbf578c7a5e7591", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/18a9931edad821bdb04834dc0cbf578c7a5e7591", "committedDate": "2020-05-08T19:49:53Z", "message": "DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Rearranging the comments and code in the test case for Function dropdown (+1 squashed commit)\nSquashed commits:\n[c752dc86a] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\n\nDHFPROD-4185: Fixing the failing test (+1 squashed commit)\nSquashed commits:\n[2f9a9abee] DHFPROD-4185: Fixing the event bubbling issue in dropdown component\nDHFPROD-4185: Test for Function dropdown (+1 squashed commit)\nSquashed commits:\n[72115fb02] DHFPROD-4185: Fixing the event bubbling issue in dropdown component"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MDM5Mzg4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3925#pullrequestreview-408039388", "createdAt": "2020-05-08T06:59:17Z", "commit": {"oid": "c752dc86a740290fdde0f03bf10bc06a8d784dcf"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNjo1OToxN1rOGSbdBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNToyODo1NFrOGSpnYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTk3NzM1MQ==", "bodyText": "concat is already available in the expression. So lets look for some other function which isnt in the document already", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3925#discussion_r421977351", "createdAt": "2020-05-08T06:59:17Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.test.tsx", "diffHunk": "@@ -482,6 +482,74 @@ describe('RTL Source-to-entity map tests', () => {\n         expect(onClosestTableRow(firstName)?.style.display).toBe('none');\n         expect(onClosestTableRow(lastName)?.style.display).toBe('none');\n     });\n+    \n+    test('Function selector dropdown in entity table', async () => {\n+\n+        axiosMock.post['mockImplementation'](jest.fn(() => Promise.resolve({ status: 200, data: data.testJSONResponseWithFunctions })));\n+        const { getByText, getByTestId, getAllByRole, debug, queryByText } = render(<SourceToEntityMap {...data.mapProps} mappingVisible={true} />);\n+\n+        //Prepare the map expression field for function signature later\n+        let propAttributeExpression = getByTestId('propAttribute-mapexpression')\n+        fireEvent.change(propAttributeExpression, { target: { value: \"\" } });\n+        fireEvent.blur(propAttributeExpression);\n+\n+        //Grab and click on the function (fx) button\n+        let functionSelector = getByTestId(\"propAttribute-3-functionIcon\");\n+        fireEvent.click(functionSelector);\n+\n+        await (waitForElement(() => getAllByRole(\"option\"), { \"timeout\": 200 }))\n+        let concat = getByText(\"concat\");\n+        let documentLookup = getByText('documentLookup');\n+        //Both of the functions below should be visible\n+        expect(concat).toBeInTheDocument();\n+        expect(documentLookup).toBeInTheDocument();\n+\n+        //Search input box to look for functions\n+        let inputBox = getByText(\n+            (_content, element) =>\n+                element.className != null &&\n+                element.className === \"ant-select-search__field\"\n+        );\n+\n+        fireEvent.click(inputBox) // focus on the search box\n+\n+        // Filter out the funcitons list to get to concat function\n+        fireEvent.change(inputBox, { target: { value: \"conc\" } }); \n+\n+        expect(concat).toBeInTheDocument(); // Still should be visible\n+        expect(queryByText('documentLookup')).not.toBeInTheDocument(); // Should not be visible since we filtered only concat\n+\n+        //Choose the concat function\n+        fireEvent.keyDown(inputBox, { key: 'Enter', code: 'Enter', keyCode: 13, charCode: 13 })\n+\n+        //Map Expression is populated with function signature\n+        expect(propAttributeExpression).toHaveTextContent(\"concat(xs:anyAtomicType?)\");\n+\n+         //Click again on the same function button to verify if it opens up again with the list of functions\n+         fireEvent.click(functionSelector);\n+         await (waitForElement(() => getAllByRole(\"option\"), { \"timeout\": 200 }));\n+         //Function should be visible again\n+         expect(concat).toBeInTheDocument();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c752dc86a740290fdde0f03bf10bc06a8d784dcf"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwOTM3Nw==", "bodyText": "Can we change this to \"Lookup\" to verify multiple matches are returned", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3925#discussion_r422209377", "createdAt": "2020-05-08T15:28:54Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.test.tsx", "diffHunk": "@@ -482,6 +482,74 @@ describe('RTL Source-to-entity map tests', () => {\n         expect(onClosestTableRow(firstName)?.style.display).toBe('none');\n         expect(onClosestTableRow(lastName)?.style.display).toBe('none');\n     });\n+    \n+    test('Function selector dropdown in entity table', async () => {\n+\n+        axiosMock.post['mockImplementation'](jest.fn(() => Promise.resolve({ status: 200, data: data.testJSONResponseWithFunctions })));\n+        const { getByText, getByTestId, getAllByRole, debug, queryByText } = render(<SourceToEntityMap {...data.mapProps} mappingVisible={true} />);\n+\n+        //Prepare the map expression field for function signature later\n+        let propAttributeExpression = getByTestId('propAttribute-mapexpression')\n+        fireEvent.change(propAttributeExpression, { target: { value: \"\" } });\n+        fireEvent.blur(propAttributeExpression);\n+\n+        //Grab and click on the function (fx) button\n+        let functionSelector = getByTestId(\"propAttribute-3-functionIcon\");\n+        fireEvent.click(functionSelector);\n+\n+        await (waitForElement(() => getAllByRole(\"option\"), { \"timeout\": 200 }))\n+        let concat = getByText(\"concat\");\n+        let documentLookup = getByText('documentLookup');\n+        //Both of the functions below should be visible\n+        expect(concat).toBeInTheDocument();\n+        expect(documentLookup).toBeInTheDocument();\n+\n+        //Search input box to look for functions\n+        let inputBox = getByText(\n+            (_content, element) =>\n+                element.className != null &&\n+                element.className === \"ant-select-search__field\"\n+        );\n+\n+        fireEvent.click(inputBox) // focus on the search box\n+\n+        // Filter out the funcitons list to get to concat function\n+        fireEvent.change(inputBox, { target: { value: \"conc\" } }); ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c752dc86a740290fdde0f03bf10bc06a8d784dcf"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NTY1MjA1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3925#pullrequestreview-408565205", "createdAt": "2020-05-08T22:39:24Z", "commit": {"oid": "18a9931edad821bdb04834dc0cbf578c7a5e7591"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2870, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}