{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0MDU3NDcy", "number": 4955, "title": "DEVO-110:Update DHF Develop pipeline to include palamida scan", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-12-08T01:35:16Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955", "merged": true, "mergeCommit": {"oid": "0ee22467bb88ab9f6614b550948a7609e0a9175a"}, "closed": true, "closedAt": "2020-12-16T16:06:41Z", "author": {"login": "yafeldman"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkMKlkAFqTU0NzM2NTQwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmfrUmAFqTU1MjgwNzExNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MzY1NDA0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-547365404", "createdAt": "2020-12-08T15:48:09Z", "commit": {"oid": "d679476d02cb31fa1f00187ba9d3e819790424fe"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNTo0ODowOVrOIBkuBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNTo0ODowOVrOIBkuBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODUyMTA5Mg==", "bodyText": "Add these to Jenkins credentials and use Jenkins credentials plugin to extract these", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#discussion_r538521092", "createdAt": "2020-12-08T15:48:09Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "Jenkinsfile", "diffHunk": "@@ -636,7 +636,70 @@ pipeline{\n                   }\n                   }\n \t\t}\n-            stage('publishAnddhs'){\n+        stage('FlexCodeScan'){\n+            when {\n+                expression{\n+                    node('dhmaster'){\n+                        props = readProperties file:'data-hub/pipeline.properties';\n+                        println(props['ExecutionBranch'])\n+                        return (env.BRANCH_NAME==props['ExecutionBranch'])\n+                    }\n+                }\n+            }\n+            agent {label 'dhfLinuxAgent'}\n+            steps{\n+                script {\n+\n+                    def palamida_url=\"http://palamida-2.marklogic.com:8888\"\n+                    def jwt=\"eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJwYWxhbWlkYSIsInVzZXJJZCI6MywiaWF0IjoxNjA1NTYxMTc5fQ.5NaV_E4FHSe6vJMTX1siZa6f0U-uKm3ssZIfmsPEPzmdkDvtnNxsXRxI1Mj4mHq0i9cBNEHW_ePYKdFh97Sd9Q\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d679476d02cb31fa1f00187ba9d3e819790424fe"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "615c240ac986537c839a25d2be1371c4ed05843e", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/615c240ac986537c839a25d2be1371c4ed05843e", "committedDate": "2020-12-09T18:11:20Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "6790f82021563024768cd4675f6d69c4ba05ce52", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6790f82021563024768cd4675f6d69c4ba05ce52", "committedDate": "2020-12-10T00:15:47Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6790f82021563024768cd4675f6d69c4ba05ce52", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6790f82021563024768cd4675f6d69c4ba05ce52", "committedDate": "2020-12-10T00:15:47Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "a3abbc7ab6c1c61c986845788d43d27bdf62eb7f", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/a3abbc7ab6c1c61c986845788d43d27bdf62eb7f", "committedDate": "2020-12-11T04:26:29Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3abbc7ab6c1c61c986845788d43d27bdf62eb7f", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/a3abbc7ab6c1c61c986845788d43d27bdf62eb7f", "committedDate": "2020-12-11T04:26:29Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "5a41ec74491732a638816c0e87d61328613abc8b", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/5a41ec74491732a638816c0e87d61328613abc8b", "committedDate": "2020-12-11T05:18:36Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMzEzNTE0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-550313514", "createdAt": "2020-12-11T17:15:16Z", "commit": {"oid": "5a41ec74491732a638816c0e87d61328613abc8b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxNToxNlrOIECKIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxNzo0M1rOIECP3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEwMDU3Ng==", "bodyText": "you don't need to send the email twice. An email will be sent in the post stage. If required include Kavitha to the recipient list.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#discussion_r541100576", "createdAt": "2020-12-11T17:15:16Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "Jenkinsfile", "diffHunk": "@@ -229,6 +229,161 @@ def runCypressE2e(){\n         junit '**/e2e/**/*.xml'\n     }\n }\n+\n+void postFailureFiexcodeScanAndReport(){\n+    def email=''\n+    if(env.CHANGE_AUTHOR){\n+        def author=env.CHANGE_AUTHOR.toString().trim().toLowerCase()\n+        email=getEmailFromGITUser author\n+    }\n+    else {\n+       email=Email\n+    }\n+    sendMail email,\"<h3>Pipeline FAILED in stage ${STAGE_NAME} <a href=${BUILD_URL}/console> Check Console Output Here</a></h4>\",false,\" pipeline Failed in ${STAGE_NAME} \"\n+}\n+\n+void fiexcodeScanAndReport(){\n+    def palamida_url=\"http://palamida-2.marklogic.com:8888\"\n+    def inventoriesRprt=''\n+\n+    withCredentials([string(credentialsId: 'palamida_jwt', variable: 'jwt')]) {\n+\n+        StartScan(baseUrl: palamida_url, projectName: 'ml-dhf', token: jwt)\n+\n+        inventoriesRprt = sh(returnStdout: true, script: '''curl -X GET ''' + palamida_url + '''/codeinsight/api/project/inventory/21 -H \"Authorization: Bearer $jwt\" ''')\n+    }\n+\n+    writeFile(file: 'inventoriesRprt.report.json', text: inventoriesRprt)\n+\n+    def slurper = new JsonSlurperClassic().parseText(inventoriesRprt.toString().trim())\n+\n+    def failures = []\n+    slurper.inventoryItems.each { key, value ->\n+        key.vulnerabilities.each { key1, value1 ->\n+            if(key1.vulnerabilityCvssV3Severity == 'CRITICAL' || key1.vulnerabilityCvssV3Severity == 'HIGH'){\n+                def msg = \" inventory name: $key.name  volnarability name: $key1.vulnerabilityName with Severity V2: $key1.vulnerabilityCvssV2Severity with Severity V3: $key1.vulnerabilityCvssV3Severity \"\n+                failures.add(msg)\n+\n+            }\n+        }}\n+\n+    archiveArtifacts artifacts: 'inventoriesRprt.report.json'\n+\n+    //Send email\n+    if(failures.size()!=0){\n+        def body=''\n+        failures.each { msg -> body=body+msg + '\\n' }\n+        sendMail 'Kavitha.Sivagnanam@marklogic.com,yakov.feldman@marklogic.com', body,false,'Flexcode FAILED. HIGH vulnerabilities','inventoriesRprt.report.json'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a41ec74491732a638816c0e87d61328613abc8b"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEwMDk3Ng==", "bodyText": "Add an OR check for DEVO project too.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#discussion_r541100976", "createdAt": "2020-12-11T17:15:59Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "Jenkinsfile", "diffHunk": "@@ -229,6 +229,161 @@ def runCypressE2e(){\n         junit '**/e2e/**/*.xml'\n     }\n }\n+\n+void postFailureFiexcodeScanAndReport(){\n+    def email=''\n+    if(env.CHANGE_AUTHOR){\n+        def author=env.CHANGE_AUTHOR.toString().trim().toLowerCase()\n+        email=getEmailFromGITUser author\n+    }\n+    else {\n+       email=Email\n+    }\n+    sendMail email,\"<h3>Pipeline FAILED in stage ${STAGE_NAME} <a href=${BUILD_URL}/console> Check Console Output Here</a></h4>\",false,\" pipeline Failed in ${STAGE_NAME} \"\n+}\n+\n+void fiexcodeScanAndReport(){\n+    def palamida_url=\"http://palamida-2.marklogic.com:8888\"\n+    def inventoriesRprt=''\n+\n+    withCredentials([string(credentialsId: 'palamida_jwt', variable: 'jwt')]) {\n+\n+        StartScan(baseUrl: palamida_url, projectName: 'ml-dhf', token: jwt)\n+\n+        inventoriesRprt = sh(returnStdout: true, script: '''curl -X GET ''' + palamida_url + '''/codeinsight/api/project/inventory/21 -H \"Authorization: Bearer $jwt\" ''')\n+    }\n+\n+    writeFile(file: 'inventoriesRprt.report.json', text: inventoriesRprt)\n+\n+    def slurper = new JsonSlurperClassic().parseText(inventoriesRprt.toString().trim())\n+\n+    def failures = []\n+    slurper.inventoryItems.each { key, value ->\n+        key.vulnerabilities.each { key1, value1 ->\n+            if(key1.vulnerabilityCvssV3Severity == 'CRITICAL' || key1.vulnerabilityCvssV3Severity == 'HIGH'){\n+                def msg = \" inventory name: $key.name  volnarability name: $key1.vulnerabilityName with Severity V2: $key1.vulnerabilityCvssV2Severity with Severity V3: $key1.vulnerabilityCvssV3Severity \"\n+                failures.add(msg)\n+\n+            }\n+        }}\n+\n+    archiveArtifacts artifacts: 'inventoriesRprt.report.json'\n+\n+    //Send email\n+    if(failures.size()!=0){\n+        def body=''\n+        failures.each { msg -> body=body+msg + '\\n' }\n+        sendMail 'Kavitha.Sivagnanam@marklogic.com,yakov.feldman@marklogic.com', body,false,'Flexcode FAILED. HIGH vulnerabilities','inventoriesRprt.report.json'\n+        sh 'exit 1'\n+    }\n+}\n+\n+void UnitTest(){\n+    script{\n+        props = readProperties file:'data-hub/pipeline.properties';\n+        copyRPM 'Release','10.0-5'\n+        setUpML '$WORKSPACE/xdmp/src/Mark*.rpm'\n+        sh 'export JAVA_HOME=`eval echo \"$JAVA_HOME_DIR\"`;export GRADLE_USER_HOME=$WORKSPACE$GRADLE_DIR;export M2_HOME=$MAVEN_HOME/bin;export PATH=$JAVA_HOME/bin:$GRADLE_USER_HOME:$PATH:$MAVEN_HOME/bin;cd $WORKSPACE/data-hub;rm -rf $GRADLE_USER_HOME/caches;set +e;./gradlew clean;./gradlew marklogic-data-hub:bootstrap -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew marklogic-data-hub-central:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/ |& tee console.log;sleep 10s;./gradlew ml-data-hub:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;./gradlew web:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew marklogic-data-hub-spark-connector:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;'\n+        junit '**/TEST-*.xml'\n+        cobertura coberturaReportFile: '**/cobertura-coverage.xml'\n+        jacoco()\n+        def output=readFile 'data-hub/console.log'\n+        def result=false;\n+        if(output.contains(\"npm ERR!\")){\n+            result=true;\n+        }\n+        if(result){\n+            currentBuild.result='UNSTABLE'\n+        }\n+        if(env.CHANGE_TITLE){\n+            JIRA_ID=env.CHANGE_TITLE.split(':')[0]\n+            jiraAddComment comment: 'Jenkins Unit Test Results For PR Available', idOrKey: JIRA_ID, site: 'JIRA'\n+        }\n+        if(!env.CHANGE_URL){\n+            env.CHANGE_URL=\" \"\n+        }\n+    }\n+}\n+\n+void PreBuildCheck() {\n+    script{\n+        if(env.CHANGE_ID){\n+            if(PRDraftCheck()){\n+                sh 'exit 1'\n+            }\n+            def reviewState=getReviewState()\n+            if((!env.CHANGE_TITLE.startsWith(\"DHFPROD-\"))){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a41ec74491732a638816c0e87d61328613abc8b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEwMjA0NQ==", "bodyText": "These stages FlexCodeScan and PUblishAnddhs should run in parallel.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#discussion_r541102045", "createdAt": "2020-12-11T17:17:43Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "Jenkinsfile", "diffHunk": "@@ -636,7 +719,22 @@ pipeline{\n                   }\n                   }\n \t\t}\n-            stage('publishAnddhs'){\n+        stage('FlexCodeScan'){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a41ec74491732a638816c0e87d61328613abc8b"}, "originalPosition": 275}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a41ec74491732a638816c0e87d61328613abc8b", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/5a41ec74491732a638816c0e87d61328613abc8b", "committedDate": "2020-12-11T05:18:36Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "dab3ae4d7e2ef69f6beb3e92d344ca8cd00f39ce", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/dab3ae4d7e2ef69f6beb3e92d344ca8cd00f39ce", "committedDate": "2020-12-12T00:57:26Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNjQ2OTk0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-551646994", "createdAt": "2020-12-14T17:13:55Z", "commit": {"oid": "dab3ae4d7e2ef69f6beb3e92d344ca8cd00f39ce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNzI1NTQ0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-551725544", "createdAt": "2020-12-14T17:55:24Z", "commit": {"oid": "dab3ae4d7e2ef69f6beb3e92d344ca8cd00f39ce"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNzo1NToyNFrOIFc6YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNzo1NToyNFrOIFc6YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU4NzQ4OA==", "bodyText": "Should be || instead of &&", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#discussion_r542587488", "createdAt": "2020-12-14T17:55:24Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "Jenkinsfile", "diffHunk": "@@ -229,6 +230,152 @@ def runCypressE2e(){\n         junit '**/e2e/**/*.xml'\n     }\n }\n+\n+void postFailureFiexcodeScanAndReport(def vulnerabilities){\n+    def email=''\n+    if(env.CHANGE_AUTHOR){\n+        def author=env.CHANGE_AUTHOR.toString().trim().toLowerCase()\n+        email=getEmailFromGITUser author\n+    }\n+    else { email=Email }\n+\n+    def body=''\n+    vulnerabilities.each { msg -> body=body+msg + '<p>' }\n+    body = body + '<p>scan report is attached.'\n+\n+    sendMail email,\"<h3>Pipeline FAILED in stage ${STAGE_NAME} <a href=${BUILD_URL}/console> Check Console Output Here</a></h4>  High vulneribilities: <p> $body\",false,\" pipeline FAILED in ${STAGE_NAME} \", 'inventoriesRprt.report.json'\n+}\n+\n+def fiexcodeScanAndReport(){\n+\n+    def palamida_url=\"http://palamida-2.marklogic.com:8888\"\n+    def inventoriesRprt=''\n+\n+    withCredentials([string(credentialsId: 'palamida_jwt', variable: 'jwt')]) {\n+\n+        StartScan(baseUrl: palamida_url, projectName: 'ml-dhf', token: jwt)\n+\n+        inventoriesRprt = sh(returnStdout: true, script: '''curl -X GET ''' + palamida_url + '''/codeinsight/api/project/inventory/21 -H \"Authorization: Bearer $jwt\" ''')\n+    }\n+\n+    writeFile(file: 'inventoriesRprt.report.json', text: inventoriesRprt)\n+\n+    def slurper = new JsonSlurperClassic().parseText(inventoriesRprt.toString().trim())\n+\n+    def vulnerabilities = []\n+    slurper.inventoryItems.each { key, value ->\n+        key.vulnerabilities.each { key1, value1 ->\n+            if(key1.vulnerabilityCvssV3Severity == 'CRITICAL' || key1.vulnerabilityCvssV3Severity == 'HIGH'){\n+                def msg = \"    inventory name: $key.name; volnarability name: $key1.vulnerabilityName; with Severity V2: $key1.vulnerabilityCvssV2Severity; with Severity V3: $key1.vulnerabilityCvssV3Severity; \"\n+                vulnerabilities.add(msg)\n+            }\n+        }}\n+\n+    archiveArtifacts artifacts: 'inventoriesRprt.report.json'\n+\n+    return vulnerabilities\n+\n+}\n+\n+void UnitTest(){\n+    script{\n+        props = readProperties file:'data-hub/pipeline.properties';\n+        copyRPM 'Release','10.0-5'\n+        setUpML '$WORKSPACE/xdmp/src/Mark*.rpm'\n+        sh 'export JAVA_HOME=`eval echo \"$JAVA_HOME_DIR\"`;export GRADLE_USER_HOME=$WORKSPACE$GRADLE_DIR;export M2_HOME=$MAVEN_HOME/bin;export PATH=$JAVA_HOME/bin:$GRADLE_USER_HOME:$PATH:$MAVEN_HOME/bin;cd $WORKSPACE/data-hub;rm -rf $GRADLE_USER_HOME/caches;set +e;./gradlew clean;./gradlew marklogic-data-hub:bootstrap -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew marklogic-data-hub-central:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/ |& tee console.log;sleep 10s;./gradlew ml-data-hub:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;./gradlew web:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew marklogic-data-hub-spark-connector:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;'\n+        junit '**/TEST-*.xml'\n+        cobertura coberturaReportFile: '**/cobertura-coverage.xml'\n+        jacoco()\n+        def output=readFile 'data-hub/console.log'\n+        def result=false;\n+        if(output.contains(\"npm ERR!\")){\n+            result=true;\n+        }\n+        if(result){\n+            currentBuild.result='UNSTABLE'\n+        }\n+        if(env.CHANGE_TITLE){\n+            JIRA_ID=env.CHANGE_TITLE.split(':')[0]\n+            jiraAddComment comment: 'Jenkins Unit Test Results For PR Available', idOrKey: JIRA_ID, site: 'JIRA'\n+        }\n+        if(!env.CHANGE_URL){\n+            env.CHANGE_URL=\" \"\n+        }\n+    }\n+}\n+\n+void PreBuildCheck() {\n+ if(env.CHANGE_ID){\n+   if(PRDraftCheck()){ sh 'exit 1' }\n+   def reviewState=getReviewState()\n+   if((!env.CHANGE_TITLE.startsWith(\"DHFPROD-\")) && (!env.CHANGE_TITLE.startsWith(\"DEVO-\"))){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dab3ae4d7e2ef69f6beb3e92d344ca8cd00f39ce"}, "originalPosition": 127}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNzg1NDk1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-551785495", "createdAt": "2020-12-14T18:39:51Z", "commit": {"oid": "dab3ae4d7e2ef69f6beb3e92d344ca8cd00f39ce"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dab3ae4d7e2ef69f6beb3e92d344ca8cd00f39ce", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/dab3ae4d7e2ef69f6beb3e92d344ca8cd00f39ce", "committedDate": "2020-12-12T00:57:26Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "93aa3cca0faf3d73cbf57afba1943f11833a5306", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/93aa3cca0faf3d73cbf57afba1943f11833a5306", "committedDate": "2020-12-14T18:49:52Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93aa3cca0faf3d73cbf57afba1943f11833a5306", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/93aa3cca0faf3d73cbf57afba1943f11833a5306", "committedDate": "2020-12-14T18:49:52Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "2a675a6963a40e026252a8a4bf2992ac3ce74273", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/2a675a6963a40e026252a8a4bf2992ac3ce74273", "committedDate": "2020-12-14T19:15:14Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a675a6963a40e026252a8a4bf2992ac3ce74273", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/2a675a6963a40e026252a8a4bf2992ac3ce74273", "committedDate": "2020-12-14T19:15:14Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "0f7d8c057444c059c9de4fea6543517e6d3260db", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/0f7d8c057444c059c9de4fea6543517e6d3260db", "committedDate": "2020-12-14T19:23:45Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f7d8c057444c059c9de4fea6543517e6d3260db", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/0f7d8c057444c059c9de4fea6543517e6d3260db", "committedDate": "2020-12-14T19:23:45Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "7d9655d418876ba4a8e5274afaa072b200e5212a", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/7d9655d418876ba4a8e5274afaa072b200e5212a", "committedDate": "2020-12-14T19:27:08Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d9655d418876ba4a8e5274afaa072b200e5212a", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/7d9655d418876ba4a8e5274afaa072b200e5212a", "committedDate": "2020-12-14T19:27:08Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "379e3ca50621d7fd875529fd80a809f2c91996cc", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/379e3ca50621d7fd875529fd80a809f2c91996cc", "committedDate": "2020-12-14T21:03:48Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "379e3ca50621d7fd875529fd80a809f2c91996cc", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/379e3ca50621d7fd875529fd80a809f2c91996cc", "committedDate": "2020-12-14T21:03:48Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "73579cffca2cccdb224f75e3c85a5c5cb5fd07ec", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/73579cffca2cccdb224f75e3c85a5c5cb5fd07ec", "committedDate": "2020-12-14T21:10:04Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "73579cffca2cccdb224f75e3c85a5c5cb5fd07ec", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/73579cffca2cccdb224f75e3c85a5c5cb5fd07ec", "committedDate": "2020-12-14T21:10:04Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "ef3c325b4afdc8fb122541700db81f2ac1908f13", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ef3c325b4afdc8fb122541700db81f2ac1908f13", "committedDate": "2020-12-14T21:15:19Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNTY0NTI3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-552564527", "createdAt": "2020-12-15T15:15:23Z", "commit": {"oid": "ef3c325b4afdc8fb122541700db81f2ac1908f13"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNToxNToyM1rOIGQh9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNToxNToyM1rOIGQh9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQzMzIwNA==", "bodyText": "Why are these changed?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#discussion_r543433204", "createdAt": "2020-12-15T15:15:23Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "Jenkinsfile", "diffHunk": "@@ -21,17 +22,18 @@ def dhflinuxTests(String mlVersion,String type){\n     \t\tprops = readProperties file:'data-hub/pipeline.properties';\n     \t\tcopyRPM type,mlVersion\n     \t\tdef dockerhost=setupMLDockerCluster 3\n-    \t\tsh 'docker exec -u builder -i '+dockerhost+' /bin/sh -c \"su -builder;export JAVA_HOME=`eval echo \"$JAVA_HOME_DIR\"`;export GRADLE_USER_HOME=$WORKSPACE$GRADLE_DIR;export M2_HOME=$MAVEN_HOME/bin;export PATH=$JAVA_HOME/bin:$GRADLE_USER_HOME:$PATH:$MAVEN_HOME/bin;cd $WORKSPACE/data-hub;rm -rf $GRADLE_USER_HOME/caches;./gradlew clean;set +e;./gradlew marklogic-data-hub:bootstrapAndTest -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew marklogic-data-hub-central:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/ |& tee console.log;sleep 10s;./gradlew ml-data-hub:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew web:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew marklogic-data-hub-spark-connector:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s; ./gradlew marklogic-data-hub:testBootstrap -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew ml-data-hub:testFullCycle -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;\"'\n+    \t\tsh 'docker exec -u builder -i '+dockerhost+' /bin/sh -c \"su -builder;export JAVA_HOME=`eval echo \"$JAVA_HOME_DIR\"`;export GRADLE_USER_HOME=$WORKSPACE$GRADLE_DIR;export M2_HOME=$MAVEN_HOME/bin;export PATH=$JAVA_HOME/bin:$GRADLE_USER_HOME:$PATH:$MAVEN_HOME/bin;cd $WORKSPACE/data-hub;rm -rf $GRADLE_USER_HOME/caches;./gradlew clean;set +e;./gradlew marklogic-data-hub:bootstrapAndTest -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew marklogic-data-hub-central:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/ |& tee console.log;sleep 10s;./gradlew ml-data-hub:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew web:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew marklogic-data-hub-spark-connector:test -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;./gradlew ml-data-hub:testFullCycle -i --stacktrace -PnodeDistributionBaseUrl=http://node-mirror.eng.marklogic.com:8080/;sleep 10s;\"'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef3c325b4afdc8fb122541700db81f2ac1908f13"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNTY2MTA5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-552566109", "createdAt": "2020-12-15T15:16:53Z", "commit": {"oid": "ef3c325b4afdc8fb122541700db81f2ac1908f13"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNzI5NDY3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-552729467", "createdAt": "2020-12-15T18:05:28Z", "commit": {"oid": "ef3c325b4afdc8fb122541700db81f2ac1908f13"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxODowNToyOFrOIGYzVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxODowNToyOFrOIGYzVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2ODcyNw==", "bodyText": "Should it be Flex instead of Fiex?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#discussion_r543568727", "createdAt": "2020-12-15T18:05:28Z", "author": {"login": "akshaysonvane"}, "path": "Jenkinsfile", "diffHunk": "@@ -229,6 +231,154 @@ def runCypressE2e(){\n         junit '**/e2e/**/*.xml'\n     }\n }\n+\n+void postFailureFiexcodeScanAndReport(def vulnerabilities){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef3c325b4afdc8fb122541700db81f2ac1908f13"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef3c325b4afdc8fb122541700db81f2ac1908f13", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ef3c325b4afdc8fb122541700db81f2ac1908f13", "committedDate": "2020-12-14T21:15:19Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "e6ae46404b4ea6884a9473a4449ae3cdf60c8bbe", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e6ae46404b4ea6884a9473a4449ae3cdf60c8bbe", "committedDate": "2020-12-15T18:28:21Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNzU4NjUx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-552758651", "createdAt": "2020-12-15T18:41:44Z", "commit": {"oid": "e6ae46404b4ea6884a9473a4449ae3cdf60c8bbe"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNzgyMzA1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-552782305", "createdAt": "2020-12-15T19:08:36Z", "commit": {"oid": "e6ae46404b4ea6884a9473a4449ae3cdf60c8bbe"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODozNlrOIGbiKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTowODozNlrOIGbiKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYxMzQ4MQ==", "bodyText": "Need the typo fix here as well.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#discussion_r543613481", "createdAt": "2020-12-15T19:08:36Z", "author": {"login": "akshaysonvane"}, "path": "Jenkinsfile", "diffHunk": "@@ -229,6 +231,154 @@ def runCypressE2e(){\n         junit '**/e2e/**/*.xml'\n     }\n }\n+\n+void postFailureFlexcodeScanAndReport(def vulnerabilities){\n+    def email=''\n+    if(env.CHANGE_AUTHOR){\n+        def author=env.CHANGE_AUTHOR.toString().trim().toLowerCase()\n+        email=getEmailFromGITUser author\n+    }\n+    else { email=Email }\n+\n+    email = email + ',Kavitha.Sivagnanam@marklogic.com'\n+\n+    def body=''\n+    vulnerabilities.each { msg -> body=body+msg + '<p>' }\n+    body = body + '<p>scan report is attached.'\n+\n+    sendMail email,\"<h3>Pipeline FAILED in stage ${STAGE_NAME} <a href=${BUILD_URL}/console> Check Console Output Here</a></h4>  High vulneribilities: <p> $body\",false,\" pipeline FAILED in ${STAGE_NAME} \", 'inventoriesRprt.report.json'\n+}\n+\n+def fiexcodeScanAndReport(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6ae46404b4ea6884a9473a4449ae3cdf60c8bbe"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf534f1913595df26148ed6e718bc597d2ce287c", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/cf534f1913595df26148ed6e718bc597d2ce287c", "committedDate": "2020-12-15T19:13:29Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e6ae46404b4ea6884a9473a4449ae3cdf60c8bbe", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e6ae46404b4ea6884a9473a4449ae3cdf60c8bbe", "committedDate": "2020-12-15T18:28:21Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}, "afterCommit": {"oid": "cf534f1913595df26148ed6e718bc597d2ce287c", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/cf534f1913595df26148ed6e718bc597d2ce287c", "committedDate": "2020-12-15T19:13:29Z", "message": "DEVO-110:Update DHF Develop pipeline to include palamida scan"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNzg3NTgx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-552787581", "createdAt": "2020-12-15T19:15:37Z", "commit": {"oid": "cf534f1913595df26148ed6e718bc597d2ce287c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyODA3MTE2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4955#pullrequestreview-552807116", "createdAt": "2020-12-15T19:40:44Z", "commit": {"oid": "cf534f1913595df26148ed6e718bc597d2ce287c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1536, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}