{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5ODc2MDQ0", "number": 5002, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzozMjowMVrOFFltkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzozMjowMVrOFFltkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNDA1MDc1OnYy", "diffSide": "LEFT", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/com.marklogic.smart-mastering/impl/process.xqy", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMzozMjowMVrOIGLBXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNzoyMDoyOVrOIGWykg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM0Mjk0MA==", "bodyText": "Is this removed because it was not having any impact? I looked at the surrounding code - since \"$key\" comes from map:keys($all-matches), it looks like this would never resolve to true and thus never call lock-for-update - right?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/5002#discussion_r543342940", "createdAt": "2020-12-15T13:32:01Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/com.marklogic.smart-mastering/impl/process.xqy", "diffHunk": "@@ -325,7 +325,6 @@ declare function proc-impl:consolidate-notifies($all-matches as map:map, $merged\n     let $updated-notification-uris :=\n       for $key-notification in $key-notifications[@threshold = $key-threshold]\n       let $key-uri as xs:string := $key-notification/@uri\n-      let $_lock-on-uri := if (fn:not(map:contains($all-matches, $key))) then merge-impl:lock-for-update($key-uri) else ()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16f20ead552fe0afb8aa418dfe5ae19505b1dcca"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUzNTc2Mg==", "bodyText": "Yes, if it was going to do anything it should have been $key-uri, but it doesn't really make sense to lock for a URI in the notification document anyway since it doesn't write to those URIs.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/5002#discussion_r543535762", "createdAt": "2020-12-15T17:20:29Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/com.marklogic.smart-mastering/impl/process.xqy", "diffHunk": "@@ -325,7 +325,6 @@ declare function proc-impl:consolidate-notifies($all-matches as map:map, $merged\n     let $updated-notification-uris :=\n       for $key-notification in $key-notifications[@threshold = $key-threshold]\n       let $key-uri as xs:string := $key-notification/@uri\n-      let $_lock-on-uri := if (fn:not(map:contains($all-matches, $key))) then merge-impl:lock-for-update($key-uri) else ()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM0Mjk0MA=="}, "originalCommit": {"oid": "16f20ead552fe0afb8aa418dfe5ae19505b1dcca"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3054, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}