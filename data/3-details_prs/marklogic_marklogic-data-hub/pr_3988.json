{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxOTY3ODIz", "number": 3988, "title": "DHFPROD-4953: Downloaded project files are now pretty printed", "bodyText": "Also did some renaming from \"configuration-files\" to \"project-files\", as \"project\" is a much more meaningful term than \"configuration\".\nDescription\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-05-22T14:58:58Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3988", "merged": true, "mergeCommit": {"oid": "acddc600dcb3ab477f2bffbded32de6b5f1fd139"}, "closed": true, "closedAt": "2020-05-22T21:47:59Z", "author": {"login": "rjrudin"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcj0F8LgBqjMzNjUxOTk0MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcj5P2cAFqTQxNzE5NDU3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "788337ffbe9c5c6868ae5ba7c7a4f603564cc22b", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/788337ffbe9c5c6868ae5ba7c7a4f603564cc22b", "committedDate": "2020-05-22T14:57:14Z", "message": "DHFPROD-4953: Downloaded project files are now pretty printed\n\nAlso did some renaming from \"configuration-files\" to \"project-files\", as \"project\" is a much more meaningful term than \"configuration\"."}, "afterCommit": {"oid": "40a14e3f31dc21b14c20dea745ada9acfdf70bc6", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/40a14e3f31dc21b14c20dea745ada9acfdf70bc6", "committedDate": "2020-05-22T15:34:50Z", "message": "DHFPROD-4953: Downloaded project files are now pretty printed\n\nAlso did some renaming from \"configuration-files\" to \"project-files\", as \"project\" is a much more meaningful term than \"configuration\"."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MDMwMzc3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3988#pullrequestreview-417030377", "createdAt": "2020-05-22T16:18:15Z", "commit": {"oid": "40a14e3f31dc21b14c20dea745ada9acfdf70bc6"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MDg3Mjcw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3988#pullrequestreview-417087270", "createdAt": "2020-05-22T17:49:50Z", "commit": {"oid": "40a14e3f31dc21b14c20dea745ada9acfdf70bc6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo0OTo1MFrOGZfOTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo0OTo1MFrOGZfOTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3OTE0OA==", "bodyText": "We probably need to remove this.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3988#discussion_r429379148", "createdAt": "2020-05-22T17:49:50Z", "author": {"login": "akshaysonvane"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/ArtifactManagerImpl.java", "diffHunk": "@@ -90,12 +97,70 @@ protected ArtifactService getArtifactService() {\n \n     public ArtifactTypeInfo getArtifactTypeInfo(String artifactType) {\n         ArtifactTypeInfo artifactTypeInfo = null;\n-        for (ArtifactTypeInfo typeInfo: getArtifactTypeInfoList()) {\n+        for (ArtifactTypeInfo typeInfo : getArtifactTypeInfoList()) {\n             if (typeInfo.getType().equals(artifactType)) {\n                 artifactTypeInfo = typeInfo;\n                 break;\n             }\n         }\n         return artifactTypeInfo;\n     }\n+\n+    public void writeProjectArtifactsAsZip(OutputStream outputStream) {\n+        ArrayNode artifacts = (ArrayNode) ArtifactService.on(hubClient.getStagingClient()).getArtifactsWithProjectPaths();\n+\n+        final ZipOutputStream zipOutputStream = new ZipOutputStream(outputStream);\n+        final ObjectWriter prettyWriter = buildPrettyWriter();\n+\n+        try {\n+            artifacts.forEach(artifact -> {\n+                ZipEntry entry = new ZipEntry(artifact.get(\"path\").asText());\n+                try {\n+                    zipOutputStream.putNextEntry(entry);\n+                    if (artifact.has(\"xml\")) {\n+                        byte[] bytes = artifact.get(\"xml\").asText().getBytes();\n+                        zipOutputStream.write(bytes, 0, bytes.length);\n+                    } else {\n+                        byte[] bytes = prettyWriter.writeValueAsString(artifact.get(\"json\")).getBytes();\n+                        System.out.println(\"JSON: \" + new String(bytes));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40a14e3f31dc21b14c20dea745ada9acfdf70bc6"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c025739776b65d32c19031e12b9d9b59c0de540", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1c025739776b65d32c19031e12b9d9b59c0de540", "committedDate": "2020-05-22T19:17:35Z", "message": "DHFPROD-4953: Downloaded project files are now pretty printed\n\nAlso did some renaming from \"configuration-files\" to \"project-files\", as \"project\" is a much more meaningful term than \"configuration\"."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40a14e3f31dc21b14c20dea745ada9acfdf70bc6", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/40a14e3f31dc21b14c20dea745ada9acfdf70bc6", "committedDate": "2020-05-22T15:34:50Z", "message": "DHFPROD-4953: Downloaded project files are now pretty printed\n\nAlso did some renaming from \"configuration-files\" to \"project-files\", as \"project\" is a much more meaningful term than \"configuration\"."}, "afterCommit": {"oid": "1c025739776b65d32c19031e12b9d9b59c0de540", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1c025739776b65d32c19031e12b9d9b59c0de540", "committedDate": "2020-05-22T19:17:35Z", "message": "DHFPROD-4953: Downloaded project files are now pretty printed\n\nAlso did some renaming from \"configuration-files\" to \"project-files\", as \"project\" is a much more meaningful term than \"configuration\"."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MTUxNjA5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3988#pullrequestreview-417151609", "createdAt": "2020-05-22T19:46:31Z", "commit": {"oid": "1c025739776b65d32c19031e12b9d9b59c0de540"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MTk0NTcx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3988#pullrequestreview-417194571", "createdAt": "2020-05-22T21:35:20Z", "commit": {"oid": "1c025739776b65d32c19031e12b9d9b59c0de540"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2946, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}