{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NzA3MjU3", "number": 4112, "title": "DHFPROD-4843: Display service name in header, system-info dialog", "bodyText": "Add service name to UI (replacing project name) using new systemInfo endpoint.\nScreencast: https://drive.google.com/file/d/1gkfchbMGSUZzR5UgqRpds5dHTvjsvtpU/view\nAlso:\n\nRefactor project-page component, use new /api/environment/systemInfo endpoint.\nRename ProjectPage component to SystemInfo\nMove SystemInfo component into header component directory since only Header calls SystemInfo\nRefactor mocked user-context data and associated types.\nFix some typing issues in test mocks.\nTest for service name in: header.test, system-info.test\n\nFrom @rjrudin:\n\n/api/environment/project-info is now /api/environment/systemInfo.\nRemoving /api/info - sessionTimeout is now part of systemInfo.\nNo longer including projectName in the authentication response either, to avoid redundancy.\n\nThinking that SystemService.getVersions should be renamed to SystemService.getSystemInfo too, but will tackle that later in a separate PR to minimize the amount of changes here.\nDescription\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-06-18T19:03:55Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112", "merged": true, "mergeCommit": {"oid": "292077cbfe6d250adc6064c73934c7c35d4c50b7"}, "closed": true, "closedAt": "2020-06-19T22:38:33Z", "author": {"login": "wooldridge"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsj1q7gFqTQzMzU5MTgyNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcs5zihAFqTQzNDM0NjQ5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNTkxODI2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#pullrequestreview-433591826", "createdAt": "2020-06-18T19:39:59Z", "commit": {"oid": "af98d85e9c4973a934b57b7f4426cd56c450350a"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxOTo0MDowMFrOGl9n8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxOTo0MDowMFrOGl9n8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ2MDE0NA==", "bodyText": "This is good. I would probably add systemInfoVisible: true, setSystemInfoVisible: jest.fn() in system-info.data.ts and use that here like so: {...data.environment}", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#discussion_r442460144", "createdAt": "2020-06-18T19:40:00Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/header/system-info.test.tsx", "diffHunk": "@@ -0,0 +1,60 @@\n+import React from 'react';\n+import {render, cleanup, } from \"@testing-library/react\";\n+import SystemInfo from './system-info';\n+import {AuthoritiesContext, AuthoritiesService} from \"../../util/authorities\";\n+import {BrowserRouter as Router} from \"react-router-dom\";\n+import data from '../../assets/mock-data/system-info.data';\n+\n+describe('Update data load settings component', () => {\n+\n+    afterEach(() => {\n+        cleanup();\n+    });\n+\n+    test('verify project info display, user with \"Download\" button enabled', async () => {\n+        const authorityService = new AuthoritiesService();\n+        authorityService.setAuthorities(['downloadProjectFiles']);\n+        const { getByText } = render(<Router><AuthoritiesContext.Provider value={authorityService}>\n+            <SystemInfo \n+                serviceName={data.environment.serviceName}\n+                dataHubVersion={data.environment.dataHubVersion}\n+                marklogicVersion={data.environment.marklogicVersion}\n+                systemInfoVisible={true} \n+                setSystemInfoVisible={jest.fn()}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af98d85e9c4973a934b57b7f4426cd56c450350a"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MDQ3NjE1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#pullrequestreview-434047615", "createdAt": "2020-06-19T12:45:43Z", "commit": {"oid": "af98d85e9c4973a934b57b7f4426cd56c450350a"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMjo0NTo0M1rOGmTiRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMjo0Njo0N1rOGmTkYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjgxOTE0Mw==", "bodyText": "One thought I've had for the future is to standardize on (I think) \"system\" instead of using \"environment\" and \"system\" interchangeably, as having those separate terms raises the question of - What does each one mean? \"serviceName\" adds a little more confusion to because it implies there's the concept of a \"service\" that is separate from \"system\". Really, system = environment = service, so in the future, I think we'll simplify the naming here.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#discussion_r442819143", "createdAt": "2020-06-19T12:45:43Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/ui/src/util/environment.tsx", "diffHunk": "@@ -1,16 +1,15 @@\n import axios from 'axios';\n \n const defaultEnv = {\n-    projectName: '',\n+    serviceName: '',\n     dataHubVersion: '',\n     markLogicVersion: ''\n }\n \n export function setEnvironment()  {\n-    axios.get('/api/environment/project-info')\n+    axios.get('/api/environment/systemInfo')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af98d85e9c4973a934b57b7f4426cd56c450350a"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjgxOTY4MQ==", "bodyText": "I expect to rename this to SystemInfo in a future JIRA ticket as well, didn't want to increase the blast radius of this PR though. Also note that \"clusterName\" is appropriate here because this is a DHF class, and it doesn't know specifically about DHS, which is where the concept of \"serviceName\" exists.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#discussion_r442819681", "createdAt": "2020-06-19T12:46:47Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/VersionInfo.java", "diffHunk": "@@ -16,18 +16,21 @@\n \n     private String hubVersion;\n     private String markLogicVersion;\n+    private String clusterName;\n \n     public static VersionInfo newVersionInfo(HubClient hubClient) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af98d85e9c4973a934b57b7f4426cd56c450350a"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76de656a598e71405858754738457d9df68a0ca9", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/76de656a598e71405858754738457d9df68a0ca9", "committedDate": "2020-06-19T20:17:58Z", "message": "DHFPROD-4843: Display service name in header, dialog\n\n- Refactor project-page component, use new /api/environment/systemInfo endpoint.\n- Rename ProjectPage component to SystemInfo\n- Move SystemInfo component with Header component since only Header calls SystemInfo\n- Refactor mocked user-context data and associated types.\n- Fix some typing issues in test mocks.\n- Test for service name in: header.test, system-info.test\n- /api/environment/project-info is now /api/environment/systemInfo.\n- Removing /api/info - sessionTimeout is now part of systemInfo.\n- No longer including projectName in the authentication response either, to avoid redundancy.\n\nThinking that SystemService.getVersions should be renamed to SystemService.getSystemInfo too, but will tackle that later in a separate PR to minimize the amount of changes here.\n\nDHFPROD-4843: Update Cypress custom command to use the new endpoint"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af98d85e9c4973a934b57b7f4426cd56c450350a", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/af98d85e9c4973a934b57b7f4426cd56c450350a", "committedDate": "2020-06-18T19:00:48Z", "message": "DHFPROD-4843: Display service name in header, dialog\n\n- Refactor project-page component, use new /api/environment/systemInfo endpoint.\n- Rename ProjectPage component to SystemInfo\n- Move SystemInfo component with Header component since only Header calls SystemInfo\n- Refactor mocked user-context data and associated types.\n- Fix some typing issues in test mocks.\n- Test for service name in: header.test, system-info.test\n- /api/environment/project-info is now /api/environment/systemInfo.\n- Removing /api/info - sessionTimeout is now part of systemInfo.\n- No longer including projectName in the authentication response either, to avoid redundancy.\n\nThinking that SystemService.getVersions should be renamed to SystemService.getSystemInfo too, but will tackle that later in a separate PR to minimize the amount of changes here."}, "afterCommit": {"oid": "76de656a598e71405858754738457d9df68a0ca9", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/76de656a598e71405858754738457d9df68a0ca9", "committedDate": "2020-06-19T20:17:58Z", "message": "DHFPROD-4843: Display service name in header, dialog\n\n- Refactor project-page component, use new /api/environment/systemInfo endpoint.\n- Rename ProjectPage component to SystemInfo\n- Move SystemInfo component with Header component since only Header calls SystemInfo\n- Refactor mocked user-context data and associated types.\n- Fix some typing issues in test mocks.\n- Test for service name in: header.test, system-info.test\n- /api/environment/project-info is now /api/environment/systemInfo.\n- Removing /api/info - sessionTimeout is now part of systemInfo.\n- No longer including projectName in the authentication response either, to avoid redundancy.\n\nThinking that SystemService.getVersions should be renamed to SystemService.getSystemInfo too, but will tackle that later in a separate PR to minimize the amount of changes here.\n\nDHFPROD-4843: Update Cypress custom command to use the new endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MzIxNjA4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#pullrequestreview-434321608", "createdAt": "2020-06-19T20:19:15Z", "commit": {"oid": "76de656a598e71405858754738457d9df68a0ca9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MzQ2NDk1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4112#pullrequestreview-434346495", "createdAt": "2020-06-19T21:19:38Z", "commit": {"oid": "76de656a598e71405858754738457d9df68a0ca9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2816, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}