{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5Njg3ODY1", "number": 3535, "title": "DHFPROD-4096: Middle-tier Update load data API to store settings", "bodyText": "https://project.marklogic.com/jira/browse/DHFPROD-4096", "createdAt": "2020-01-31T17:29:36Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535", "merged": true, "mergeCommit": {"oid": "347a9d01010d1ac03e4a17584f126918ccbbc823"}, "closed": true, "closedAt": "2020-02-03T23:41:58Z", "author": {"login": "hao1st"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_zbqiAFqTM1MTY4NTAzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcA1OuWAFqTM1MjYyNzExNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNjg1MDM2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535#pullrequestreview-351685036", "createdAt": "2020-01-31T18:15:33Z", "commit": {"oid": "a54f4c6302a9aec1e2e2ea599f09bfa186b5a3ef"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxODoxNTozM1rOFkTpvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxODoyNToxNlrOFkT6aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxNTAzNg==", "bodyText": "What's the difference between a \"loadData\" artifact and a \"loadDataSettings\" artifact? I'm reading DHFPROD-4096, and the purpose of the new endpoints is to support only modifying the \"settings\" of a \"loadData\" config. That doesn't seem like it would mean that \"settings\" is a separate artifact type though, right?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535#discussion_r373615036", "createdAt": "2020-01-31T18:15:33Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/core.mjs", "diffHunk": "@@ -26,7 +27,8 @@ const cachedArtifacts = {};\n const registeredArtifactTypes = {\n     loadData: LoadData,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a54f4c6302a9aec1e2e2ea599f09bfa186b5a3ef"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYxOTMwNQ==", "bodyText": "Tiny nit - I think it's better just to return the result, there's no value in defining a variable here and then returning it.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535#discussion_r373619305", "createdAt": "2020-01-31T18:25:16Z", "author": {"login": "rjrudin"}, "path": "one-ui/src/main/java/com/marklogic/hub/curation/controllers/LoadDataController.java", "diffHunk": "@@ -108,6 +108,19 @@ public String getArtifactType() {\n         return \"loadData\";\n     }\n \n+    @RequestMapping(value = \"/{artifactName}/settings\", method = RequestMethod.GET)\n+    @ResponseBody\n+    public ResponseEntity<JsonNode> getArtifactSettings(@PathVariable String artifactName) {\n+        ResponseEntity<JsonNode> resp = super.getArtifactSettings(artifactName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a54f4c6302a9aec1e2e2ea599f09bfa186b5a3ef"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxODI4OTYx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535#pullrequestreview-351828961", "createdAt": "2020-01-31T23:12:35Z", "commit": {"oid": "32812b1f41e9e6bb92da2763dd89fc7c3a5a3795"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxODMwNTQx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535#pullrequestreview-351830541", "createdAt": "2020-01-31T23:18:08Z", "commit": {"oid": "32812b1f41e9e6bb92da2763dd89fc7c3a5a3795"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMzoxODowOFrOFkaeGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMzoxODowOFrOFkaeGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcyNjc0NQ==", "bodyText": "@ryanjdew ,\nShould the permissions here be \"data-hub-load-data-reader,read,data-hub-load-data-reader,update\" ? If so, this change has to be made for all the artifacts ?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535#discussion_r373726745", "createdAt": "2020-01-31T23:18:08Z", "author": {"login": "srinathgit"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/loadDataSettings.mjs", "diffHunk": "@@ -0,0 +1,68 @@\n+/**\n+ Copyright 2012-2019 MarkLogic Corporation\n+\n+ Licensed under the Apache License, Version 2.0 (the \"License\");\n+ you may not use this file except in compliance with the License.\n+ You may obtain a copy of the License at\n+\n+ http://www.apache.org/licenses/LICENSE-2.0\n+\n+ Unless required by applicable law or agreed to in writing, software\n+ distributed under the License is distributed on an \"AS IS\" BASIS,\n+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ See the License for the specific language governing permissions and\n+ limitations under the License.\n+ */\n+'use strict';\n+\n+const DataHubSingleton = require('/data-hub/5/datahub-singleton.sjs');\n+\n+// define constants for caching expensive operations\n+const dataHub = DataHubSingleton.instance();\n+\n+const collections = ['http://marklogic.com/data-hub/load-data-artifact/settings'];\n+const databases = [dataHub.config.STAGINGDATABASE, dataHub.config.FINALDATABASE];\n+const permissions = [xdmp.permission(dataHub.consts.DATA_HUB_DEVELOPER_ROLE, 'update'), xdmp.permission(dataHub.consts.DATA_HUB_OPERATOR_ROLE, 'read')];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32812b1f41e9e6bb92da2763dd89fc7c3a5a3795"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81a60895bfcbcf2a7fa77d015a26635353e8d4c9", "author": {"user": {"login": "hao1st", "name": "Hao Liu"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/81a60895bfcbcf2a7fa77d015a26635353e8d4c9", "committedDate": "2020-02-02T18:51:27Z", "message": "DHFPROD-4096: Middle-tier Update load data API to store settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf9e99d1847d679376993859b95e6501e2fc1645", "author": {"user": {"login": "hao1st", "name": "Hao Liu"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/bf9e99d1847d679376993859b95e6501e2fc1645", "committedDate": "2020-02-02T18:51:27Z", "message": "DHFPROD-4096: Fixed test cases failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fd7e056c8cfc7278576d24533f1b014e0e78958", "author": {"user": {"login": "hao1st", "name": "Hao Liu"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/4fd7e056c8cfc7278576d24533f1b014e0e78958", "committedDate": "2020-02-02T18:51:27Z", "message": "DHFPROD-4096: Added a new server-side test case for loaddata settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb583c9d140754a5428393bf7b9b5214a0c2ab72", "author": {"user": {"login": "hao1st", "name": "Hao Liu"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/cb583c9d140754a5428393bf7b9b5214a0c2ab72", "committedDate": "2020-02-02T21:22:49Z", "message": "DHFPROD-4096: Remove LoadDataSetting as an artifact"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89b53d11bdf46f5110a03eb18d448a2d60717c21", "author": {"user": {"login": "hao1st", "name": "Hao Liu"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/89b53d11bdf46f5110a03eb18d448a2d60717c21", "committedDate": "2020-02-01T04:26:11Z", "message": "Merge branch 'feature/5.3.0' into hao/DHFPROD-4096"}, "afterCommit": {"oid": "cb583c9d140754a5428393bf7b9b5214a0c2ab72", "author": {"user": {"login": "hao1st", "name": "Hao Liu"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/cb583c9d140754a5428393bf7b9b5214a0c2ab72", "committedDate": "2020-02-02T21:22:49Z", "message": "DHFPROD-4096: Remove LoadDataSetting as an artifact"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMjc1MzI5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535#pullrequestreview-352275329", "createdAt": "2020-02-03T14:05:04Z", "commit": {"oid": "cb583c9d140754a5428393bf7b9b5214a0c2ab72"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNDowNTowNVrOFkybbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNDowNjoxMlrOFkydsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDExOTI3Nw==", "bodyText": "Is the issue that loadData has a separate settings document, but other artifacts do not? If so, why is it a separate document? Conceptually, I would think that the \"settings\" of a \"loadData\" would be part of the \"loadData\" document.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535#discussion_r374119277", "createdAt": "2020-02-03T14:05:05Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/core.mjs", "diffHunk": "@@ -67,10 +67,30 @@ export function getArtifacts(artifactType) {\n export function deleteArtifact(artifactType, artifactName, artifactVersion = 'latest') {\n     const artifactKey = generateArtifactKey(artifactType, artifactName, artifactVersion);\n     const artifactLibrary =  getArtifactTypeLibrary(artifactType);\n+\n     // Currently there is no versioning for loadData artifacts\n     const node = getArtifactNode(artifactType, artifactName, artifactVersion);\n+\n+    let settingNode = {};\n+    if (artifactType == 'loadData') {\n+        //delete related config file if existed\n+        settingNode = artifactLibrary.getArtifactSettingNode(artifactName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb583c9d140754a5428393bf7b9b5214a0c2ab72"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDExOTg1OQ==", "bodyText": "Given that this is setting collections that are specific to loadData, shouldn't this have a loadData-specific name?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535#discussion_r374119859", "createdAt": "2020-02-03T14:06:12Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/core.mjs", "diffHunk": "@@ -106,6 +126,42 @@ export function setArtifact(artifactType, artifactName, artifact) {\n     return artifact;\n }\n \n+export function getArtifactSettings(artifactType, artifactName, artifactVersion = 'latest') {\n+    const artifactSettingKey = generateArtifactKey(artifactType + 'Settings', artifactName);\n+    if (!cachedArtifacts[artifactSettingKey]) {\n+        const settingLibrary = getArtifactTypeLibrary(artifactType);\n+        const settingNode = settingLibrary.getArtifactSettingNode(artifactName, artifactVersion);\n+\n+        if (fn.empty(settingNode)) {\n+            return {};\n+        }\n+        cachedArtifacts[artifactSettingKey] = settingNode.toObject();\n+    }\n+    return cachedArtifacts[artifactSettingKey];\n+}\n+\n+export function setArtifactSettings(artifactType, artifactName, settings) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb583c9d140754a5428393bf7b9b5214a0c2ab72"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "600d8378507323c61edf3e41ea6a442742a71e8e", "author": {"user": {"login": "hao1st", "name": "Hao Liu"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/600d8378507323c61edf3e41ea6a442742a71e8e", "committedDate": "2020-02-03T22:50:13Z", "message": "DHFPROD-4096: Modify collection name of artifact setting docs & refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjI1MDM2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535#pullrequestreview-352625036", "createdAt": "2020-02-03T23:02:08Z", "commit": {"oid": "600d8378507323c61edf3e41ea6a442742a71e8e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjI3MTE3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3535#pullrequestreview-352627117", "createdAt": "2020-02-03T23:07:08Z", "commit": {"oid": "600d8378507323c61edf3e41ea6a442742a71e8e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2405, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}