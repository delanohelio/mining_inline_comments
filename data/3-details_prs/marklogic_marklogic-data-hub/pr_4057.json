{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NzU4MDU0", "number": 4057, "title": "DHFPROD-4670: Add hub-central-flow-writer role", "bodyText": "Description\nAlso:\n\nadjusted the privileges to data-hub-common to be able to call mlHubversion extension\nfixed an issue where flow-operator was needed in addition to hub-central-step-runner on ML 9.0-12\n\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-06-05T21:02:49Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057", "merged": true, "mergeCommit": {"oid": "f5fd795e5601f5a72c0f999fe119b51092fd456f"}, "closed": true, "closedAt": "2020-06-09T01:42:58Z", "author": {"login": "ryanjdew"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoa6hDAFqTQyNTY3Mjk2Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpZudagFqTQyNjcwNTYxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NjcyOTYy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-425672962", "createdAt": "2020-06-05T23:04:30Z", "commit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMzowNDozMFrOGf_knA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMzowNDozMFrOGf_knA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwMDYwNA==", "bodyText": "Is this change intentional. Srinath fixed it so test will pass in 9.0-12.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#discussion_r436200604", "createdAt": "2020-06-05T23:04:30Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/controllers/FlowMvcTest.java", "diffHunk": "@@ -25,12 +25,7 @@\n     @Test\n     void runIngestionStep() throws Exception {\n         installReferenceModelProject();\n-        if(isVersionCompatibleWith520Roles()) {\n-            loginAsTestUserWithRoles(\"hub-central-step-runner\");\n-        }\n-        else {\n-            loginAsTestUserWithRoles(\"hub-central-step-runner\", \"flow-operator-role\");\n-        }\n+        loginAsTestUserWithRoles(\"hub-central-step-runner\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1Njc3NDc2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-425677476", "createdAt": "2020-06-05T23:23:50Z", "commit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMzoyMzo1MFrOGf_z6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMzoyMzo1MFrOGf_z6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwNDUyMw==", "bodyText": "Currently we have tests for Run tile in Run.test.tsx, but they are run as developer and operator. Should we run them as flow-writer and step runner instead, so we would have verified a flow can be run with a lesser and more appropriate authority?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#discussion_r436204523", "createdAt": "2020-06-05T23:23:50Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/pages/Run.tsx", "diffHunk": "@@ -34,7 +34,7 @@ const Run: React.FC = () => {\n     const authorityService = useContext(AuthoritiesContext);\n     const canReadFlow = authorityService.canReadStep();\n     const canWriteFlow = authorityService.canWriteStep();\n-    const hasOperatorRole = authorityService.hasOperatorRole();\n+    const hasOperatorRole = authorityService.canRunStep();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1Njc5MzY0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-425679364", "createdAt": "2020-06-05T23:32:14Z", "commit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMzozMjoxNFrOGf_68A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMzozMjoxNFrOGf_68A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwNjMyMA==", "bodyText": "Nice. I should probably comment after am done reviewing everything top down.\nWith this I think we can keep the Run tests as is and you can ignore my comment earlier regarding Run.test.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#discussion_r436206320", "createdAt": "2020-06-05T23:32:14Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/pages/TilesView.test.tsx", "diffHunk": "@@ -106,8 +106,10 @@ describe('TilesView component', () => {\n \n     });\n \n-    test('Verify Run tile displays from toolbar', async () => {\n-        const {getByLabelText, getByText, queryByText, getByTestId} = await render(<AuthoritiesContext.Provider value={ mockDevRolesService}><TilesView/></AuthoritiesContext.Provider>);\n+    test('Verify Run tile displays from toolbar and can create/edit/delete with writeStep authority', async () => {\n+        const authorityService = new AuthoritiesService();\n+        authorityService.setAuthorities(['readStep','writeStep','runStep']);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1Njc5NTk4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-425679598", "createdAt": "2020-06-05T23:33:31Z", "commit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMzozMzozMVrOGf_7zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMzozMzozMVrOGf_7zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwNjU0Mw==", "bodyText": "Can we add a custom step to run.config and verify it shows up in Run tile for these authorities?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#discussion_r436206543", "createdAt": "2020-06-05T23:33:31Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/pages/TilesView.test.tsx", "diffHunk": "@@ -136,7 +138,7 @@ describe('TilesView component', () => {\n         expect(getByTestId('runStep-1')).toBeInTheDocument();\n     });\n \n-    test('Verify run tile cannot edit with only readStep authority', async () => {\n+    test('Verify run tile cannot edit or run with only readStep authority', async () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzAyOTQ4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-425702948", "createdAt": "2020-06-06T01:43:24Z", "commit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1ODY5OTg3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-425869987", "createdAt": "2020-06-08T00:58:28Z", "commit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwMDo1ODoyOFrOGgM7hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwMDo1OTozNlrOGgM71Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQxOTQ2Mg==", "bodyText": "I think this needs to be writeFlow. I had asked Shannon to change step-writer to flow-writer because the role allows for modifying flows, not steps. We have separate roles - one per step type - that control who can write a step.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#discussion_r436419462", "createdAt": "2020-06-08T00:58:28Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/controllers/FlowController.java", "diffHunk": "@@ -54,32 +54,37 @@\n     @RequestMapping(method = RequestMethod.POST)\n     @ResponseBody\n     @ApiOperation(value = \"Create a flow\", response = FlowInfo.class)\n+    @Secured(\"ROLE_writeStep\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQxOTU0MQ==", "bodyText": "I think \"runStep\" is fine, because ultimately the user is running a step that's defined within a particular flow.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#discussion_r436419541", "createdAt": "2020-06-08T00:59:36Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/ui/src/config/authorities.config.ts", "diffHunk": "@@ -49,7 +49,7 @@ class DeveloperRolesService implements IAuthoritiesContextInterface{\n     public isSavedQueryUser:() => boolean = () => {\n         return true;\n     };\n-    public hasOperatorRole:() => boolean = () => {\n+    public canRunStep:() => boolean = () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/67a97c24dfbc6b1fa4d5a974a1547f51a09fcb90", "committedDate": "2020-06-05T20:58:49Z", "message": "DHFPROD-4670: Add hub-central-flow-writer role"}, "afterCommit": {"oid": "ecd0ccd0a15f380499a0d80a6fa561b847c3e634", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ecd0ccd0a15f380499a0d80a6fa561b847c3e634", "committedDate": "2020-06-08T05:53:14Z", "message": "DHFPROD-4670: Add hub-central-flow-writer role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MjgyMjMz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-426282233", "createdAt": "2020-06-08T14:10:51Z", "commit": {"oid": "ecd0ccd0a15f380499a0d80a6fa561b847c3e634"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MzAxMjAz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-426301203", "createdAt": "2020-06-08T14:30:23Z", "commit": {"oid": "ecd0ccd0a15f380499a0d80a6fa561b847c3e634"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MzA5Mzkz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-426309393", "createdAt": "2020-06-08T14:39:00Z", "commit": {"oid": "ecd0ccd0a15f380499a0d80a6fa561b847c3e634"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ecd0ccd0a15f380499a0d80a6fa561b847c3e634", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ecd0ccd0a15f380499a0d80a6fa561b847c3e634", "committedDate": "2020-06-08T05:53:14Z", "message": "DHFPROD-4670: Add hub-central-flow-writer role"}, "afterCommit": {"oid": "9d314bba281b78a0386d1e9deda8f824dd6aa976", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9d314bba281b78a0386d1e9deda8f824dd6aa976", "committedDate": "2020-06-08T17:12:29Z", "message": "DHFPROD-4670: Add hub-central-flow-writer role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NDYzMDg3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-426463087", "createdAt": "2020-06-08T17:31:24Z", "commit": {"oid": "9d314bba281b78a0386d1e9deda8f824dd6aa976"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d314bba281b78a0386d1e9deda8f824dd6aa976", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9d314bba281b78a0386d1e9deda8f824dd6aa976", "committedDate": "2020-06-08T17:12:29Z", "message": "DHFPROD-4670: Add hub-central-flow-writer role"}, "afterCommit": {"oid": "0897f9b6a2eefcb0c022b85ee1a8758f4095de7b", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/0897f9b6a2eefcb0c022b85ee1a8758f4095de7b", "committedDate": "2020-06-08T20:27:08Z", "message": "DHFPROD-4670: Add hub-central-flow-writer role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjYwNTk0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-426660594", "createdAt": "2020-06-08T22:18:28Z", "commit": {"oid": "0897f9b6a2eefcb0c022b85ee1a8758f4095de7b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "990e3ea628d8ffe6b556b54f85e2f28a9ac61ccf", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/990e3ea628d8ffe6b556b54f85e2f28a9ac61ccf", "committedDate": "2020-06-08T23:55:21Z", "message": "DHFPROD-4670: Add hub-central-flow-writer role"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0897f9b6a2eefcb0c022b85ee1a8758f4095de7b", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/0897f9b6a2eefcb0c022b85ee1a8758f4095de7b", "committedDate": "2020-06-08T20:27:08Z", "message": "DHFPROD-4670: Add hub-central-flow-writer role"}, "afterCommit": {"oid": "990e3ea628d8ffe6b556b54f85e2f28a9ac61ccf", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/990e3ea628d8ffe6b556b54f85e2f28a9ac61ccf", "committedDate": "2020-06-08T23:55:21Z", "message": "DHFPROD-4670: Add hub-central-flow-writer role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2Njk5OTQx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-426699941", "createdAt": "2020-06-08T23:58:23Z", "commit": {"oid": "990e3ea628d8ffe6b556b54f85e2f28a9ac61ccf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzAzMDUx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-426703051", "createdAt": "2020-06-09T00:07:43Z", "commit": {"oid": "990e3ea628d8ffe6b556b54f85e2f28a9ac61ccf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzA1NjE3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4057#pullrequestreview-426705617", "createdAt": "2020-06-09T00:15:21Z", "commit": {"oid": "990e3ea628d8ffe6b556b54f85e2f28a9ac61ccf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2727, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}