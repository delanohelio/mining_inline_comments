{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MDMwNzAz", "number": 4123, "title": "DHFPROD-4421:After mapping step is run, I should be able to easily view my results in Explorer", "bodyText": "Description\n\nThis PR has both backend and FE changes hence the two commits\nFixed integration tests which were failing on develop previously\nhttps://jenkins.marklogic.com/blue/organizations/jenkins/Datahub_CI/detail/develop/1046/tests\n\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-06-22T15:48:01Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123", "merged": true, "mergeCommit": {"oid": "922458ffcc59b2329f44e98dfe1782d9f55da2ad"}, "closed": true, "closedAt": "2020-06-23T23:32:52Z", "author": {"login": "Sanjeevani19"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctzOMQAFqTQzNTA3NjMwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuNchVgFqTQzNjIxMDk2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MDc2MzA0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123#pullrequestreview-435076304", "createdAt": "2020-06-22T16:13:08Z", "commit": {"oid": "0bb003755e6e0e23fee909a3d906797c1b398ea5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNjoxMzowOFrOGnHrUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNjoxMzowOFrOGnHrUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY3MzQyNw==", "bodyText": "If the purpose of having targetEntityType on the Job document is to construct a link for exploring search results for a particular entity name, it'd be much easier for the backend to provide that in the initial RunFlowResponse that is returned by running a step. That avoids having to persist additional data, particularly since we'd only be persisting it for a very narrow UI concern.\nIn addition, because a Job document may encompass multiple steps, and each step may be associated with a different entity type, we can't have a single \"targetEntityType\" on a Job document, because we may need multiple values.\nBut the RunFlowResponse returned by running a step has a Map of step responses, so we can have a targetEntityType on each step response (if one exists).\nWe also have multiple scenarios to account for here - 1) running a mapping step with a legacy mapping (can't happen in HC, but we need to account for it); 2) running a mapping step via HC; 3) running a matching/merging/mastering step that currently uses \"targetEntity\" instead of \"targetEntityType\". Regardless of the approach we take, we need to account for all of these scenarios so that users aren't confused when targetEntityType is only set some of the time.\nI recommend opening up a backend task for this, as we'll need to properly define it for the scenarios listed above.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123#discussion_r443673427", "createdAt": "2020-06-22T16:13:08Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/ui/src/pages/Run.tsx", "diffHunk": "@@ -317,19 +338,25 @@ const Run = (props) => {\n                         return axios.get('/api/jobs/' + jobId);\n                     }, pollConfig.interval)\n                     .then(function(response: any) {\n+                        let entityName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bb003755e6e0e23fee909a3d906797c1b398ea5"}, "originalPosition": 108}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b01742ed22b86eed1b894804a41539133fe3c7a7", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b01742ed22b86eed1b894804a41539133fe3c7a7", "committedDate": "2020-06-22T20:07:57Z", "message": "DHFPROD-4421: set targetEntityType in run step response"}, "afterCommit": {"oid": "b4951465d5ea55a633e71986d810752d23c76597", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b4951465d5ea55a633e71986d810752d23c76597", "committedDate": "2020-06-22T20:31:57Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b4951465d5ea55a633e71986d810752d23c76597", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b4951465d5ea55a633e71986d810752d23c76597", "committedDate": "2020-06-22T20:31:57Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}, "afterCommit": {"oid": "3d1f4e8f9577047695e4eb25b27d82cdeaefac2b", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/3d1f4e8f9577047695e4eb25b27d82cdeaefac2b", "committedDate": "2020-06-22T21:18:12Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d1f4e8f9577047695e4eb25b27d82cdeaefac2b", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/3d1f4e8f9577047695e4eb25b27d82cdeaefac2b", "committedDate": "2020-06-22T21:18:12Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}, "afterCommit": {"oid": "5b1361ecd5a96e0f1b12895b2a6c0b650053d16e", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/5b1361ecd5a96e0f1b12895b2a6c0b650053d16e", "committedDate": "2020-06-22T21:33:13Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b1361ecd5a96e0f1b12895b2a6c0b650053d16e", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/5b1361ecd5a96e0f1b12895b2a6c0b650053d16e", "committedDate": "2020-06-22T21:33:13Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}, "afterCommit": {"oid": "b6112dab190b73de3385ca8eac2fde3019bf9444", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b6112dab190b73de3385ca8eac2fde3019bf9444", "committedDate": "2020-06-22T22:01:18Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6112dab190b73de3385ca8eac2fde3019bf9444", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b6112dab190b73de3385ca8eac2fde3019bf9444", "committedDate": "2020-06-22T22:01:18Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}, "afterCommit": {"oid": "ec0ee59cf992760a38a9c2a5af95cefc7538f958", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ec0ee59cf992760a38a9c2a5af95cefc7538f958", "committedDate": "2020-06-22T22:47:14Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MzQ3MzUy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123#pullrequestreview-435347352", "createdAt": "2020-06-22T23:47:39Z", "commit": {"oid": "ec0ee59cf992760a38a9c2a5af95cefc7538f958"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0NzozOVrOGnUiQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo0NzozOVrOGnUiQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4NDA5Ng==", "bodyText": "Is there a reason to add caching here - do we know if there's a performance issue here? My understanding is that since this is only called by the mlJobs endpoint, it's only going to be called once in a given transaction, and thus the caching won't have any impact, correct?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123#discussion_r443884096", "createdAt": "2020-06-22T23:47:39Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/impl/jobs.sjs", "diffHunk": "@@ -343,11 +355,7 @@ module.exports.updateJob = module.amp(\n           // a better error will be thrown later when the step is run and the module cannot be found.\n         }\n         if (jobsReportFun) {\n-          let flowStep = fn.head(datahub.hubUtils.queryLatest(function () {\n-              return datahub.flow.getFlow(stepResp.flowName).steps[step];\n-            },\n-            datahub.config.FINALDATABASE\n-          ));\n+          let flowStep = getFlowStep(datahub, stepResp.flowName, step);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec0ee59cf992760a38a9c2a5af95cefc7538f958"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NDQ2MjY3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123#pullrequestreview-435446267", "createdAt": "2020-06-23T05:15:18Z", "commit": {"oid": "ec0ee59cf992760a38a9c2a5af95cefc7538f958"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec0ee59cf992760a38a9c2a5af95cefc7538f958", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ec0ee59cf992760a38a9c2a5af95cefc7538f958", "committedDate": "2020-06-22T22:47:14Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}, "afterCommit": {"oid": "afcd98debcc998ce273297637a58dfe67b27d982", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/afcd98debcc998ce273297637a58dfe67b27d982", "committedDate": "2020-06-23T15:42:38Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTE1OTMz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123#pullrequestreview-435915933", "createdAt": "2020-06-23T15:45:25Z", "commit": {"oid": "afcd98debcc998ce273297637a58dfe67b27d982"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTIxNjEw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123#pullrequestreview-435921610", "createdAt": "2020-06-23T15:51:35Z", "commit": {"oid": "afcd98debcc998ce273297637a58dfe67b27d982"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTM3MTU3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123#pullrequestreview-435937157", "createdAt": "2020-06-23T16:08:31Z", "commit": {"oid": "afcd98debcc998ce273297637a58dfe67b27d982"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0b87de766d48a35d55c7e3011263a321ea98df0", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/a0b87de766d48a35d55c7e3011263a321ea98df0", "committedDate": "2020-06-23T19:11:13Z", "message": "DHFPROD-4421: explore after mapping"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "afcd98debcc998ce273297637a58dfe67b27d982", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/afcd98debcc998ce273297637a58dfe67b27d982", "committedDate": "2020-06-23T15:42:38Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}, "afterCommit": {"oid": "dfa12f16a00730ca139627213b57216da3d60d42", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/dfa12f16a00730ca139627213b57216da3d60d42", "committedDate": "2020-06-23T20:01:12Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTc4MDYy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123#pullrequestreview-436178062", "createdAt": "2020-06-23T21:40:15Z", "commit": {"oid": "dfa12f16a00730ca139627213b57216da3d60d42"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64a032456e2d74c0f9f49045bc50eca072dd6df7", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/64a032456e2d74c0f9f49045bc50eca072dd6df7", "committedDate": "2020-06-23T22:20:28Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dfa12f16a00730ca139627213b57216da3d60d42", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/dfa12f16a00730ca139627213b57216da3d60d42", "committedDate": "2020-06-23T20:01:12Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}, "afterCommit": {"oid": "64a032456e2d74c0f9f49045bc50eca072dd6df7", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/64a032456e2d74c0f9f49045bc50eca072dd6df7", "committedDate": "2020-06-23T22:20:28Z", "message": "DHFPROD-4421: Add targetEntityType to Job documents\n\nDHFPROD-4421: set targetEntityType in run step response"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MjA1MDEw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123#pullrequestreview-436205010", "createdAt": "2020-06-23T22:32:02Z", "commit": {"oid": "64a032456e2d74c0f9f49045bc50eca072dd6df7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MjEwOTY1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4123#pullrequestreview-436210965", "createdAt": "2020-06-23T22:46:31Z", "commit": {"oid": "64a032456e2d74c0f9f49045bc50eca072dd6df7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2545, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}