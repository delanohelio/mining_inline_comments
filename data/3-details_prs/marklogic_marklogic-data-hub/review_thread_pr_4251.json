{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0MjA2Njg2", "number": 4251, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzo1Mzo1N1rOEQol1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxOToxMjowMlrOERLtCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODc3NzE5OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/load/load-list.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzo1Mzo1N1rOG05GGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzo1Mzo1N1rOG05GGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExNDU4Ng==", "bodyText": "Can we change this to use aria-label instead: {<div aria-label=\"Yes\">Yes</div>}", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4251#discussion_r458114586", "createdAt": "2020-07-21T13:53:57Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/load/load-list.tsx", "diffHunk": "@@ -70,8 +81,82 @@ const LoadList: React.FC<Props> = (props) => {\n \n     const onCancel = () => {\n         setDialogVisible(false);\n+        setAddDialogVisible(false);\n+    }\n+\n+\n+    function handleSelect(obj) {\n+        handleStepAdd(obj.loadName, obj.flowName);\n+    }\n+\n+\n+    const handleStepAdd = (loadName, flowName) => {\n+        setAddDialogVisible(true);\n+        setLoadArtifactName(loadName);\n+        setFlowName(flowName);\n+    }\n+\n+    const onAddOk = async (lName, fName) => {\n+        await props.addStepToFlow(lName, fName)\n+        setAddDialogVisible(false);\n+\n+        history.push({\n+            pathname: '/tiles/run/add',\n+            state: {\n+                flowName: fName,\n+                flowsDefaultKey: [props.flows.findIndex(el => el.name === fName)],\n+                existingFlow: true\n+            }\n+        })\n     }\n \n+    const addConfirmation = (\n+        <Modal\n+            visible={addDialogVisible}\n+            okText={<div data-testid={`${loadArtifactName}-to-${flowName}-Confirm`}>Yes</div>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c76c5aedf8c15e5d60ec225fe3b8dfacd686c600"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODc3OTE5OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/load/load-list.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzo1NDoyNVrOG05HXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzo1NDoyNVrOG05HXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExNDkwOA==", "bodyText": "Pls replace with {<div aria-label=\"No\">No</div>}", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4251#discussion_r458114908", "createdAt": "2020-07-21T13:54:25Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/load/load-list.tsx", "diffHunk": "@@ -70,8 +81,82 @@ const LoadList: React.FC<Props> = (props) => {\n \n     const onCancel = () => {\n         setDialogVisible(false);\n+        setAddDialogVisible(false);\n+    }\n+\n+\n+    function handleSelect(obj) {\n+        handleStepAdd(obj.loadName, obj.flowName);\n+    }\n+\n+\n+    const handleStepAdd = (loadName, flowName) => {\n+        setAddDialogVisible(true);\n+        setLoadArtifactName(loadName);\n+        setFlowName(flowName);\n+    }\n+\n+    const onAddOk = async (lName, fName) => {\n+        await props.addStepToFlow(lName, fName)\n+        setAddDialogVisible(false);\n+\n+        history.push({\n+            pathname: '/tiles/run/add',\n+            state: {\n+                flowName: fName,\n+                flowsDefaultKey: [props.flows.findIndex(el => el.name === fName)],\n+                existingFlow: true\n+            }\n+        })\n     }\n \n+    const addConfirmation = (\n+        <Modal\n+            visible={addDialogVisible}\n+            okText={<div data-testid={`${loadArtifactName}-to-${flowName}-Confirm`}>Yes</div>}\n+            cancelText='No'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c76c5aedf8c15e5d60ec225fe3b8dfacd686c600"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODc5NDMxOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/load/load-list.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzo1NzoyMlrOG05QZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMzo1NzoyMlrOG05QZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODExNzIyMA==", "bodyText": "Pls add aria-label={f.name}. Need this for e2e.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4251#discussion_r458117220", "createdAt": "2020-07-21T13:57:22Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/load/load-list.tsx", "diffHunk": "@@ -70,8 +81,82 @@ const LoadList: React.FC<Props> = (props) => {\n \n     const onCancel = () => {\n         setDialogVisible(false);\n+        setAddDialogVisible(false);\n+    }\n+\n+\n+    function handleSelect(obj) {\n+        handleStepAdd(obj.loadName, obj.flowName);\n+    }\n+\n+\n+    const handleStepAdd = (loadName, flowName) => {\n+        setAddDialogVisible(true);\n+        setLoadArtifactName(loadName);\n+        setFlowName(flowName);\n+    }\n+\n+    const onAddOk = async (lName, fName) => {\n+        await props.addStepToFlow(lName, fName)\n+        setAddDialogVisible(false);\n+\n+        history.push({\n+            pathname: '/tiles/run/add',\n+            state: {\n+                flowName: fName,\n+                flowsDefaultKey: [props.flows.findIndex(el => el.name === fName)],\n+                existingFlow: true\n+            }\n+        })\n     }\n \n+    const addConfirmation = (\n+        <Modal\n+            visible={addDialogVisible}\n+            okText={<div data-testid={`${loadArtifactName}-to-${flowName}-Confirm`}>Yes</div>}\n+            cancelText='No'\n+            onOk={() => onAddOk(loadArtifactName, flowName)}\n+            onCancel={() => onCancel()}\n+            width={350}\n+            maskClosable={false}\n+        >\n+            <div style={{fontSize: '16px', padding: '10px'}}>\n+                Are you sure you want to add \"{loadArtifactName}\" to flow \"{flowName}\"?\n+            </div>\n+        </Modal>\n+    );\n+\n+    const menu = (name) => (\n+        <Menu style={{right: '80px'}}>\n+            <Menu.Item key=\"0\">\n+                { <Link data-testid=\"link\" id=\"tiles-run-add\" to={\n+                                        {pathname: '/tiles/run/add',\n+                                        state: {\n+                                            stepToAdd : name,\n+                                            stepDefinitionType : 'ingestion',\n+                                            existingFlow : false\n+                                        }}}><div className={styles.stepLink} data-testid={`${name}-toNewFlow`}>Add step to a new flow</div></Link>}\n+            </Menu.Item>\n+            <Menu.Item key=\"1\">\n+                <div className={styles.stepLink} data-testid={`${name}-toExistingFlow`}>Add step to an existing flow \n+                    <div className={styles.stepLinkSelect} onClick={(event) => { event.stopPropagation(); event.preventDefault(); }}>\n+                        <Select\n+                            style={{ width: '100%' }}\n+                            onChange={(flowName) => handleSelect({flowName: flowName, loadName: name})}\n+                            placeholder=\"Select Flow\"\n+                            defaultActiveFirstOption={false}\n+                            disabled={!props.canWriteFlow}\n+                            data-testid={`${name}-flowsList`}\n+                        >\n+                            { props.flows && props.flows.length > 0 ? props.flows.map((f,i) => (\n+                                <Option value={f.name} key={i}>{f.name}</Option>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c76c5aedf8c15e5d60ec225fe3b8dfacd686c600"}, "originalPosition": 122}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODg0MjQ5OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/load/load-list.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDowNzo0MlrOG05u1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDowNzo0MlrOG05u1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEyNTAxNQ==", "bodyText": "Replace with data-testid={`${row.name}-dropdown`}", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4251#discussion_r458125015", "createdAt": "2020-07-21T14:07:42Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/load/load-list.tsx", "diffHunk": "@@ -133,6 +218,9 @@ const LoadList: React.FC<Props> = (props) => {\n             key: 'actions',\n             render: (text, row) => (\n                 <span>\n+                    <Dropdown data-testid = \"dropdown\" overlay={menu(row.name)} trigger={['hover']} disabled = {!props.canWriteFlow}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c76c5aedf8c15e5d60ec225fe3b8dfacd686c600"}, "originalPosition": 137}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODg1NjI4OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/load/load-list.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDoxMDo0OFrOG053rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDoxMDo0OFrOG053rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEyNzI3Nw==", "bodyText": "Replace aria-label(s) for add-icon and disabled-add-icon to include row.name", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4251#discussion_r458127277", "createdAt": "2020-07-21T14:10:48Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/load/load-list.tsx", "diffHunk": "@@ -133,6 +218,9 @@ const LoadList: React.FC<Props> = (props) => {\n             key: 'actions',\n             render: (text, row) => (\n                 <span>\n+                    <Dropdown data-testid = \"dropdown\" overlay={menu(row.name)} trigger={['hover']} disabled = {!props.canWriteFlow}>\n+                        {props.canWriteFlow ? <span className={'AddToFlowIcon'} aria-label = \"add-icon\"></span> : <MLTooltip title={'Add to Flow'} placement=\"bottom\"><span aria-label = \"disabled-add-icon\" className={'disabledAddToFlowIcon'}></span></MLTooltip>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c76c5aedf8c15e5d60ec225fe3b8dfacd686c600"}, "originalPosition": 138}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1ODg5MDAwOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/pages/Load.tsx", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDoxODowNlrOG06M9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDoxODowNlrOG06M9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEzMjcyNQ==", "bodyText": "Can you pls verify Load.test if it needs some changes. It sets default view to be list and asserts the same.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4251#discussion_r458132725", "createdAt": "2020-07-21T14:18:06Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/pages/Load.tsx", "diffHunk": "@@ -10,7 +10,7 @@ import { AuthoritiesContext } from \"../util/authorities\";\n \n export type ViewType =  'card' | 'list';\n \n-const INITIAL_VIEW: ViewType = 'list';\n+const INITIAL_VIEW: ViewType = 'card';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c76c5aedf8c15e5d60ec225fe3b8dfacd686c600"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NDUzMDAwOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/load/load-list.test.tsx", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxOToxMjowMlrOG1whug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxOTozMjo0OFrOG1xNQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAyMjc3OA==", "bodyText": "Is the \"add to new\" testable now? Looks like we do something similar already in load-card.test.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4251#discussion_r459022778", "createdAt": "2020-07-22T19:12:02Z", "author": {"login": "wooldridge"}, "path": "marklogic-data-hub-central/ui/src/components/load/load-list.test.tsx", "diffHunk": "@@ -109,4 +119,152 @@ describe('Load data component', () => {\n     expect(getByText(AdvancedSettingsMessages.targetPermissions.incorrectFormat)).toBeInTheDocument();\n \n   })\n+\n+  test('Load List - Add step to an existing Flow', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readIngestion', 'writeIngestion', 'writeFlow']);\n+    const { getByText, getByLabelText, getByTestId } = render(\n+      <MemoryRouter>\n+        <AuthoritiesContext.Provider value={authorityService}>\n+          <LoadList \n+            {...data.loadData}\n+            flows={data.flows}\n+            canWriteFlow={true}\n+            addStepToFlow={jest.fn()}\n+            addStepToNew={jest.fn()} />\n+        </AuthoritiesContext.Provider>\n+      </MemoryRouter>\n+    )\n+\n+    //Check if the list is rendered properly\n+    expect(getByText('testLoadXML')).toBeInTheDocument();\n+\n+    fireEvent.mouseOver(getByLabelText('testLoadXML-add-icon')); // Hover over the Add to Flow Icon to get more options\n+\n+    //Verify if the flow related options are availble on mouseOver\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toNewFlow`))); // check if option 'Add to a new Flow' is visible\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toExistingFlow`))); // check if option 'Add to an existing Flow' is visible\n+\n+    //Click on the select field to open the list of existing flows.\n+    fireEvent.click(getByTestId('testLoadXML-flowsList')); \n+\n+    //Choose FlowA from the dropdown\n+    fireEvent.click(getByText('FlowA'));\n+    \n+    //Click on 'Yes' button\n+    fireEvent.click(getByLabelText('Yes'));\n+\n+    //Check if the /tiles/run/add route has been called\n+    wait(() => {\n+      expect(mockHistoryPush).toHaveBeenCalledWith('/tiles/run/add');\n+    })\n+    //TODO- E2E test to check if the Run tile is loaded or not.\n+\n+  })\n+\n+  test('Load List - Add step to an new Flow', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readIngestion', 'writeIngestion', 'writeFlow']);\n+    const { getByText, getByLabelText, getByTestId } = render(\n+      <MemoryRouter>\n+        <AuthoritiesContext.Provider value={authorityService}>\n+          <LoadList \n+            {...data.loadData}\n+            flows={data.flows}\n+            canWriteFlow={true}\n+            addStepToFlow={jest.fn()}\n+            addStepToNew={jest.fn()} />\n+        </AuthoritiesContext.Provider>\n+      </MemoryRouter>\n+    )\n+\n+    //Check if the list is rendered properly\n+    expect(getByText('testLoadXML')).toBeInTheDocument();\n+\n+    fireEvent.mouseOver(getByLabelText('testLoadXML-add-icon')); // Hover over the Add to Flow Icon to get more options\n+\n+    //Verify if the flow related options are availble on mouseOver\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toNewFlow`))); // check if option 'Add to a new Flow' is visible\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toExistingFlow`))); // check if option 'Add to an existing Flow' is visible\n+\n+    //Click on the select field to open the list of existing flows.\n+    fireEvent.click(getByTestId('testLoadXML-toNewFlow')); \n+\n+    //Check if the /tiles/run/add route has been called\n+    wait(() => {\n+      expect(mockHistoryPush).toHaveBeenCalledWith('/tiles/run/add');\n+    })\n+    //TODO- E2E test to check if the Run tile is loaded or not.\n+\n+  })\n+\n+  test('Verify Load list allows step to be added to flow with writeFlow authority', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readIngestion','writeFlow']);\n+    const mockAddStepToFlow = jest.fn();\n+    const mockAddStepToNew = jest.fn();\n+    const mockCreateLoadArtifact = jest.fn();\n+    const mockDeleteLoadArtifact = jest.fn();\n+    const {getByText, getByLabelText, getByTestId} = render(<MemoryRouter><AuthoritiesContext.Provider value={authorityService}><LoadList\n+      addStepToFlow={mockAddStepToFlow}\n+      addStepToNew={mockAddStepToNew}\n+      canReadOnly={authorityService.canReadLoad()}\n+      canReadWrite={authorityService.canWriteLoad()}\n+      canWriteFlow={authorityService.canWriteFlow()}\n+      createLoadArtifact={mockCreateLoadArtifact}\n+      data={data.loadData.data}\n+      deleteLoadArtifact={mockDeleteLoadArtifact}\n+      flows={data.flows}/>\n+    </AuthoritiesContext.Provider></MemoryRouter>);\n+\n+    const loadStepName = data.loadData.data[0].name;\n+\n+    fireEvent.mouseOver(getByLabelText('testLoad-add-icon'));\n+\n+    //verify components and text appear on hover\n+    await waitForElement(() => expect(getByTestId(`${loadStepName}-toNewFlow`)));\n+    await waitForElement(() => expect(getByTestId(`${loadStepName}-toExistingFlow`)));\n+    await waitForElement(() => expect(getByTestId(`${loadStepName}-flowsList`)));\n+    await waitForElement(() => expect(getByText('Add step to a new flow')));\n+    await waitForElement(() => expect(getByText('Add step to an existing flow')));\n+\n+    // test adding to existing flow\n+    fireEvent.click(getByTestId(`${loadStepName}-flowsList`));\n+    fireEvent.click(getByText(data.flows[0].name));\n+    fireEvent.click(getByText('Yes'));\n+    expect(mockAddStepToFlow).toBeCalledTimes(1);\n+\n+    //TODO: Mock addStepToNew not implemented yet", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c20b9250073c795b53ecbb68201653796fc2abde"}, "originalPosition": 146}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAzMDE1Ng==", "bodyText": "@wooldridge Right, was referring to the load-card.test where it is also still a 'TODO'. Seems like while the POST for addStepToFlow is supported and testable, the POST for addStepToNew is not implemented yet for us to test. Instead, adding a step to a new flow is done with a Link to /tiles/run/add. Not 100% sure but I think it makes sense, can refer to here as well.\n\n  \n    \n      marklogic-data-hub/marklogic-data-hub-central/ui/src/pages/Load.tsx\n    \n    \n         Line 112\n      in\n      aea4246\n    \n    \n    \n    \n\n        \n          \n           const addStepToNew = async () => {", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4251#discussion_r459030156", "createdAt": "2020-07-22T19:25:50Z", "author": {"login": "briantang"}, "path": "marklogic-data-hub-central/ui/src/components/load/load-list.test.tsx", "diffHunk": "@@ -109,4 +119,152 @@ describe('Load data component', () => {\n     expect(getByText(AdvancedSettingsMessages.targetPermissions.incorrectFormat)).toBeInTheDocument();\n \n   })\n+\n+  test('Load List - Add step to an existing Flow', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readIngestion', 'writeIngestion', 'writeFlow']);\n+    const { getByText, getByLabelText, getByTestId } = render(\n+      <MemoryRouter>\n+        <AuthoritiesContext.Provider value={authorityService}>\n+          <LoadList \n+            {...data.loadData}\n+            flows={data.flows}\n+            canWriteFlow={true}\n+            addStepToFlow={jest.fn()}\n+            addStepToNew={jest.fn()} />\n+        </AuthoritiesContext.Provider>\n+      </MemoryRouter>\n+    )\n+\n+    //Check if the list is rendered properly\n+    expect(getByText('testLoadXML')).toBeInTheDocument();\n+\n+    fireEvent.mouseOver(getByLabelText('testLoadXML-add-icon')); // Hover over the Add to Flow Icon to get more options\n+\n+    //Verify if the flow related options are availble on mouseOver\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toNewFlow`))); // check if option 'Add to a new Flow' is visible\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toExistingFlow`))); // check if option 'Add to an existing Flow' is visible\n+\n+    //Click on the select field to open the list of existing flows.\n+    fireEvent.click(getByTestId('testLoadXML-flowsList')); \n+\n+    //Choose FlowA from the dropdown\n+    fireEvent.click(getByText('FlowA'));\n+    \n+    //Click on 'Yes' button\n+    fireEvent.click(getByLabelText('Yes'));\n+\n+    //Check if the /tiles/run/add route has been called\n+    wait(() => {\n+      expect(mockHistoryPush).toHaveBeenCalledWith('/tiles/run/add');\n+    })\n+    //TODO- E2E test to check if the Run tile is loaded or not.\n+\n+  })\n+\n+  test('Load List - Add step to an new Flow', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readIngestion', 'writeIngestion', 'writeFlow']);\n+    const { getByText, getByLabelText, getByTestId } = render(\n+      <MemoryRouter>\n+        <AuthoritiesContext.Provider value={authorityService}>\n+          <LoadList \n+            {...data.loadData}\n+            flows={data.flows}\n+            canWriteFlow={true}\n+            addStepToFlow={jest.fn()}\n+            addStepToNew={jest.fn()} />\n+        </AuthoritiesContext.Provider>\n+      </MemoryRouter>\n+    )\n+\n+    //Check if the list is rendered properly\n+    expect(getByText('testLoadXML')).toBeInTheDocument();\n+\n+    fireEvent.mouseOver(getByLabelText('testLoadXML-add-icon')); // Hover over the Add to Flow Icon to get more options\n+\n+    //Verify if the flow related options are availble on mouseOver\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toNewFlow`))); // check if option 'Add to a new Flow' is visible\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toExistingFlow`))); // check if option 'Add to an existing Flow' is visible\n+\n+    //Click on the select field to open the list of existing flows.\n+    fireEvent.click(getByTestId('testLoadXML-toNewFlow')); \n+\n+    //Check if the /tiles/run/add route has been called\n+    wait(() => {\n+      expect(mockHistoryPush).toHaveBeenCalledWith('/tiles/run/add');\n+    })\n+    //TODO- E2E test to check if the Run tile is loaded or not.\n+\n+  })\n+\n+  test('Verify Load list allows step to be added to flow with writeFlow authority', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readIngestion','writeFlow']);\n+    const mockAddStepToFlow = jest.fn();\n+    const mockAddStepToNew = jest.fn();\n+    const mockCreateLoadArtifact = jest.fn();\n+    const mockDeleteLoadArtifact = jest.fn();\n+    const {getByText, getByLabelText, getByTestId} = render(<MemoryRouter><AuthoritiesContext.Provider value={authorityService}><LoadList\n+      addStepToFlow={mockAddStepToFlow}\n+      addStepToNew={mockAddStepToNew}\n+      canReadOnly={authorityService.canReadLoad()}\n+      canReadWrite={authorityService.canWriteLoad()}\n+      canWriteFlow={authorityService.canWriteFlow()}\n+      createLoadArtifact={mockCreateLoadArtifact}\n+      data={data.loadData.data}\n+      deleteLoadArtifact={mockDeleteLoadArtifact}\n+      flows={data.flows}/>\n+    </AuthoritiesContext.Provider></MemoryRouter>);\n+\n+    const loadStepName = data.loadData.data[0].name;\n+\n+    fireEvent.mouseOver(getByLabelText('testLoad-add-icon'));\n+\n+    //verify components and text appear on hover\n+    await waitForElement(() => expect(getByTestId(`${loadStepName}-toNewFlow`)));\n+    await waitForElement(() => expect(getByTestId(`${loadStepName}-toExistingFlow`)));\n+    await waitForElement(() => expect(getByTestId(`${loadStepName}-flowsList`)));\n+    await waitForElement(() => expect(getByText('Add step to a new flow')));\n+    await waitForElement(() => expect(getByText('Add step to an existing flow')));\n+\n+    // test adding to existing flow\n+    fireEvent.click(getByTestId(`${loadStepName}-flowsList`));\n+    fireEvent.click(getByText(data.flows[0].name));\n+    fireEvent.click(getByText('Yes'));\n+    expect(mockAddStepToFlow).toBeCalledTimes(1);\n+\n+    //TODO: Mock addStepToNew not implemented yet", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAyMjc3OA=="}, "originalCommit": {"oid": "c20b9250073c795b53ecbb68201653796fc2abde"}, "originalPosition": 146}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAzMzkyMQ==", "bodyText": "Thanks!", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4251#discussion_r459033921", "createdAt": "2020-07-22T19:32:48Z", "author": {"login": "wooldridge"}, "path": "marklogic-data-hub-central/ui/src/components/load/load-list.test.tsx", "diffHunk": "@@ -109,4 +119,152 @@ describe('Load data component', () => {\n     expect(getByText(AdvancedSettingsMessages.targetPermissions.incorrectFormat)).toBeInTheDocument();\n \n   })\n+\n+  test('Load List - Add step to an existing Flow', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readIngestion', 'writeIngestion', 'writeFlow']);\n+    const { getByText, getByLabelText, getByTestId } = render(\n+      <MemoryRouter>\n+        <AuthoritiesContext.Provider value={authorityService}>\n+          <LoadList \n+            {...data.loadData}\n+            flows={data.flows}\n+            canWriteFlow={true}\n+            addStepToFlow={jest.fn()}\n+            addStepToNew={jest.fn()} />\n+        </AuthoritiesContext.Provider>\n+      </MemoryRouter>\n+    )\n+\n+    //Check if the list is rendered properly\n+    expect(getByText('testLoadXML')).toBeInTheDocument();\n+\n+    fireEvent.mouseOver(getByLabelText('testLoadXML-add-icon')); // Hover over the Add to Flow Icon to get more options\n+\n+    //Verify if the flow related options are availble on mouseOver\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toNewFlow`))); // check if option 'Add to a new Flow' is visible\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toExistingFlow`))); // check if option 'Add to an existing Flow' is visible\n+\n+    //Click on the select field to open the list of existing flows.\n+    fireEvent.click(getByTestId('testLoadXML-flowsList')); \n+\n+    //Choose FlowA from the dropdown\n+    fireEvent.click(getByText('FlowA'));\n+    \n+    //Click on 'Yes' button\n+    fireEvent.click(getByLabelText('Yes'));\n+\n+    //Check if the /tiles/run/add route has been called\n+    wait(() => {\n+      expect(mockHistoryPush).toHaveBeenCalledWith('/tiles/run/add');\n+    })\n+    //TODO- E2E test to check if the Run tile is loaded or not.\n+\n+  })\n+\n+  test('Load List - Add step to an new Flow', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readIngestion', 'writeIngestion', 'writeFlow']);\n+    const { getByText, getByLabelText, getByTestId } = render(\n+      <MemoryRouter>\n+        <AuthoritiesContext.Provider value={authorityService}>\n+          <LoadList \n+            {...data.loadData}\n+            flows={data.flows}\n+            canWriteFlow={true}\n+            addStepToFlow={jest.fn()}\n+            addStepToNew={jest.fn()} />\n+        </AuthoritiesContext.Provider>\n+      </MemoryRouter>\n+    )\n+\n+    //Check if the list is rendered properly\n+    expect(getByText('testLoadXML')).toBeInTheDocument();\n+\n+    fireEvent.mouseOver(getByLabelText('testLoadXML-add-icon')); // Hover over the Add to Flow Icon to get more options\n+\n+    //Verify if the flow related options are availble on mouseOver\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toNewFlow`))); // check if option 'Add to a new Flow' is visible\n+    await waitForElement(() => expect(getByTestId(`testLoadXML-toExistingFlow`))); // check if option 'Add to an existing Flow' is visible\n+\n+    //Click on the select field to open the list of existing flows.\n+    fireEvent.click(getByTestId('testLoadXML-toNewFlow')); \n+\n+    //Check if the /tiles/run/add route has been called\n+    wait(() => {\n+      expect(mockHistoryPush).toHaveBeenCalledWith('/tiles/run/add');\n+    })\n+    //TODO- E2E test to check if the Run tile is loaded or not.\n+\n+  })\n+\n+  test('Verify Load list allows step to be added to flow with writeFlow authority', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readIngestion','writeFlow']);\n+    const mockAddStepToFlow = jest.fn();\n+    const mockAddStepToNew = jest.fn();\n+    const mockCreateLoadArtifact = jest.fn();\n+    const mockDeleteLoadArtifact = jest.fn();\n+    const {getByText, getByLabelText, getByTestId} = render(<MemoryRouter><AuthoritiesContext.Provider value={authorityService}><LoadList\n+      addStepToFlow={mockAddStepToFlow}\n+      addStepToNew={mockAddStepToNew}\n+      canReadOnly={authorityService.canReadLoad()}\n+      canReadWrite={authorityService.canWriteLoad()}\n+      canWriteFlow={authorityService.canWriteFlow()}\n+      createLoadArtifact={mockCreateLoadArtifact}\n+      data={data.loadData.data}\n+      deleteLoadArtifact={mockDeleteLoadArtifact}\n+      flows={data.flows}/>\n+    </AuthoritiesContext.Provider></MemoryRouter>);\n+\n+    const loadStepName = data.loadData.data[0].name;\n+\n+    fireEvent.mouseOver(getByLabelText('testLoad-add-icon'));\n+\n+    //verify components and text appear on hover\n+    await waitForElement(() => expect(getByTestId(`${loadStepName}-toNewFlow`)));\n+    await waitForElement(() => expect(getByTestId(`${loadStepName}-toExistingFlow`)));\n+    await waitForElement(() => expect(getByTestId(`${loadStepName}-flowsList`)));\n+    await waitForElement(() => expect(getByText('Add step to a new flow')));\n+    await waitForElement(() => expect(getByText('Add step to an existing flow')));\n+\n+    // test adding to existing flow\n+    fireEvent.click(getByTestId(`${loadStepName}-flowsList`));\n+    fireEvent.click(getByText(data.flows[0].name));\n+    fireEvent.click(getByText('Yes'));\n+    expect(mockAddStepToFlow).toBeCalledTimes(1);\n+\n+    //TODO: Mock addStepToNew not implemented yet", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAyMjc3OA=="}, "originalCommit": {"oid": "c20b9250073c795b53ecbb68201653796fc2abde"}, "originalPosition": 146}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3855, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}