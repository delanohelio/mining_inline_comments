{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1MDE4NDUy", "number": 4496, "title": "DHFPROD-5682:5788: Retrieve and apply keystore from cloud services", "bodyText": "Description\nIntroduced two new spring profiles specific to Azure and AWS which when activated will try to fetch the certificate artifacts from Azure/AWS services using the configured properties.\nFollowing properties are needed for configuration:\nAWS properties\nspring.profiles.active=aws\naws.s3.bucketName=\naws.s3.keyName=\n\nAzure properties\nspring.profiles.active=azure\nazure.keyvault.uri=\nazure.storage.endpoint=\nazure.storage.containerName=\nazure.storage.blobName=\n\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n[N/A] Added Tests\n\n\nReviewer:\n\n\n[N/A] Reviewed Tests", "createdAt": "2020-08-28T00:27:18Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496", "merged": true, "mergeCommit": {"oid": "a9e139f949e485bafd4c71ba58659df42a02970b"}, "closed": true, "closedAt": "2020-09-02T02:55:50Z", "author": {"login": "akshaysonvane"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDVWR6gFqTQ3NzcyNzk2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEo_hVgFqTQ3OTg1MzQ0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3NzI3OTY4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#pullrequestreview-477727968", "createdAt": "2020-08-28T13:28:34Z", "commit": {"oid": "1ab1cd940020685bb4174eabcfd80be07ceb0d22"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMzoyODozNFrOHJFg3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMzo0OTozM1rOHJGs9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI4OTU2Nw==", "bodyText": "Very helpful comment, thanks", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#discussion_r479289567", "createdAt": "2020-08-28T13:28:34Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/build.gradle", "diffHunk": "@@ -68,6 +68,15 @@ dependencies {\n         exclude group: \"com.squareup.okhttp3\", module: \"okhttp\"\n         exclude group: \"com.squareup.okhttp3\", module: \"logging-interceptor\"\n     }\n+\n+    // Excluding okhttp3 dependency as it bumps down the dependency from 4.4.0 to 3.x", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab1cd940020685bb4174eabcfd80be07ceb0d22"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI5NjE0Mw==", "bodyText": "I don't think you need this, as there's no client for this interface.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#discussion_r479296143", "createdAt": "2020-08-28T13:35:53Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/keystore/KeyStoreInit.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.central.keystore;\n+\n+import java.io.InputStream;\n+\n+public interface KeyStoreInit {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab1cd940020685bb4174eabcfd80be07ceb0d22"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI5OTAxNw==", "bodyText": "Just do \"containerName\" and \"blobName\", unless we think we're going to have other properties on objects named \"container\" and \"blob\".", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#discussion_r479299017", "createdAt": "2020-08-28T13:38:58Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/keystore/AzureKeyStoreInit.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.central.keystore;\n+\n+import com.azure.identity.DefaultAzureCredentialBuilder;\n+import com.azure.storage.blob.BlobClient;\n+import com.azure.storage.blob.BlobClientBuilder;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.stereotype.Component;\n+\n+import java.io.InputStream;\n+\n+@Component\n+@Profile(\"azure\")\n+public class AzureKeyStoreInit extends AbstractKeyStoreInit {\n+\n+    @Value(\"${key-store-password}\")\n+    private String keyStorePassword;\n+\n+    @Value(\"${azure.storage.endpoint}\")\n+    private String endpoint;\n+\n+    @Value(\"${azure.storage.container.name}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab1cd940020685bb4174eabcfd80be07ceb0d22"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwMDA5MA==", "bodyText": "Just use \"bucketName\" and \"keyName\" unless we're certain that we'll have other properties on objects named \"bucket\" and \"key\".", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#discussion_r479300090", "createdAt": "2020-08-28T13:40:05Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/keystore/AWSKeyStoreInit.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.central.keystore;\n+\n+import com.amazonaws.services.s3.AmazonS3ClientBuilder;\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagementClientBuilder;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParameterRequest;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.stereotype.Component;\n+\n+import java.io.InputStream;\n+\n+@Component\n+@Profile(\"aws\")\n+public class AWSKeyStoreInit extends AbstractKeyStoreInit {\n+\n+    @Value(\"${aws.s3.bucket.name}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab1cd940020685bb4174eabcfd80be07ceb0d22"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwMzA4MA==", "bodyText": "Shouldn't this be e.g. \"azure.storage.keyStorePassword\"? It's the password that's specific to the keystore for Azure, right?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#discussion_r479303080", "createdAt": "2020-08-28T13:43:13Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/keystore/AzureKeyStoreInit.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.central.keystore;\n+\n+import com.azure.identity.DefaultAzureCredentialBuilder;\n+import com.azure.storage.blob.BlobClient;\n+import com.azure.storage.blob.BlobClientBuilder;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.stereotype.Component;\n+\n+import java.io.InputStream;\n+\n+@Component\n+@Profile(\"azure\")\n+public class AzureKeyStoreInit extends AbstractKeyStoreInit {\n+\n+    @Value(\"${key-store-password}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab1cd940020685bb4174eabcfd80be07ceb0d22"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwODE4Mw==", "bodyText": "I believe this and the Azure class should really be Configuration classes, as they need to configure the app when Spring is starting up. We're likely to have other AWS/Azure-specific beans, so I think this should be AWSConfiguration and the other class should be AzureConfiguration. And they should be in the com.marklogic.hub.central.cloud.(aws|azure) package.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#discussion_r479308183", "createdAt": "2020-08-28T13:48:33Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/keystore/AWSKeyStoreInit.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.central.keystore;\n+\n+import com.amazonaws.services.s3.AmazonS3ClientBuilder;\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagementClientBuilder;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParameterRequest;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.annotation.Profile;\n+import org.springframework.stereotype.Component;\n+\n+import java.io.InputStream;\n+\n+@Component", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab1cd940020685bb4174eabcfd80be07ceb0d22"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwOTA0NQ==", "bodyText": "\"@bean\" is not inheritable, so I'm curious how these would work.\nI think the better approach is to declare both of these Bean methods on AWSConfiguration and AzureConfiguration, and then move this reusable logic into a CloudProviderUtil class in the com.marklogic.hub.central.cloud package (with the AWS class in cloud.aws and the Azure class in cloud.azure).\nGenerally, for reusing functionality, it's better to use composition instead of inheritance. Inheritance can be handy for reusing state - i.e. fields defined in a parent class.\nCloudProviderUtil would then have two methods - buildServerProperties(keyStorePassword) and configureSslStoreProvider(tomcatServletWebServerFactory, keyStorePassword, keyStoreFile).", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#discussion_r479309045", "createdAt": "2020-08-28T13:49:33Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/keystore/AbstractKeyStoreInit.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.central.keystore;\n+\n+import org.springframework.boot.autoconfigure.web.ServerProperties;\n+import org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory;\n+import org.springframework.boot.web.server.Ssl;\n+import org.springframework.boot.web.server.SslStoreProvider;\n+import org.springframework.boot.web.server.WebServerFactoryCustomizer;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Profile;\n+\n+import java.io.InputStream;\n+import java.security.KeyStore;\n+\n+@Profile({\"azure\", \"aws\"})\n+public abstract class AbstractKeyStoreInit implements KeyStoreInit {\n+\n+    public static String KEY_STORE_TYPE = \"PKCS12\";\n+\n+    @Bean\n+    public ServerProperties serverProperties() {\n+        final ServerProperties serverProperties = new ServerProperties();\n+        final Ssl ssl = new Ssl();\n+        final String keystorePassword = getKeyStorePassword();\n+        System.setProperty(\"server.ssl.key-store-password\", keystorePassword);\n+        ssl.setKeyPassword(keystorePassword);\n+        serverProperties.setSsl(ssl);\n+        return serverProperties;\n+    }\n+\n+    @Bean", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab1cd940020685bb4174eabcfd80be07ceb0d22"}, "originalPosition": 46}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ab1cd940020685bb4174eabcfd80be07ceb0d22", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1ab1cd940020685bb4174eabcfd80be07ceb0d22", "committedDate": "2020-08-28T00:26:11Z", "message": "DHFPROD-5682:5788: Retrieve and apply keystore from cloud services"}, "afterCommit": {"oid": "ebf7c9c2c692ea8e99cd48a2f70c62b87163ace1", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ebf7c9c2c692ea8e99cd48a2f70c62b87163ace1", "committedDate": "2020-08-28T22:41:01Z", "message": "DHFPROD-5682:5788: Retrieve and apply keystore from cloud services"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ebf7c9c2c692ea8e99cd48a2f70c62b87163ace1", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ebf7c9c2c692ea8e99cd48a2f70c62b87163ace1", "committedDate": "2020-08-28T22:41:01Z", "message": "DHFPROD-5682:5788: Retrieve and apply keystore from cloud services"}, "afterCommit": {"oid": "3a61c93c8e6090d681452c80b54ac14d91e5e21d", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/3a61c93c8e6090d681452c80b54ac14d91e5e21d", "committedDate": "2020-08-28T22:54:27Z", "message": "DHFPROD-5682:5788: Retrieve and apply keystore from cloud services"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MTE5MjE5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#pullrequestreview-478119219", "createdAt": "2020-08-29T11:15:18Z", "commit": {"oid": "3a61c93c8e6090d681452c80b54ac14d91e5e21d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxMToxNToxOFrOHJa1ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxMToxOTowOVrOHJa3ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzODkwNw==", "bodyText": "I gave bad advice on this class package. It doesn't have anything to do with cloud providers, but it is web-specific and SSL-specific. So let's call this SslUtil and toss it com.marklogic.hub.central.web (and at some point, we probably ought to move our controllers there, but that's a separate matter).", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#discussion_r479638907", "createdAt": "2020-08-29T11:15:18Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/cloud/CloudProviderUtil.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.central.cloud;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a61c93c8e6090d681452c80b54ac14d91e5e21d"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYzOTQ1OQ==", "bodyText": "Let's add logging to both of these private methods. Nothing special - just at the start of each method, log \"Retrieving keystore password\", and then at the end, \"Retrieved keystore password\". And call this method \"retrieveKeyStorePassword\" to make it clear that this is not a getter (I like for \"get\" to imply that it's only returning the value of a local variable).\nSame for the file - \"Retrieving keystore file\" and then \"Retrieved keystore file\".\nThe two benefits are - easy confirmation that the system is using the correct profile, and we can also see how long the calls are taking too.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#discussion_r479639459", "createdAt": "2020-08-29T11:19:09Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/cloud/aws/AWSConfiguration.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.central.cloud.aws;\n+\n+import com.amazonaws.services.s3.AmazonS3ClientBuilder;\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagementClientBuilder;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParameterRequest;\n+import com.marklogic.hub.central.cloud.CloudProviderUtil;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.autoconfigure.web.ServerProperties;\n+import org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory;\n+import org.springframework.boot.web.server.WebServerFactoryCustomizer;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Profile;\n+\n+import java.io.InputStream;\n+\n+@Configuration\n+@Profile(\"aws\")\n+public class AWSConfiguration {\n+\n+    @Value(\"${aws.s3.bucketName}\")\n+    private String bucketName;\n+\n+    @Value(\"${aws.s3.keyName}\")\n+    private String keyName;\n+\n+    @Bean\n+    public ServerProperties serverProperties() {\n+        return CloudProviderUtil.buildServerProperties(getKeyStorePassword());\n+    }\n+\n+    @Bean\n+    public WebServerFactoryCustomizer<TomcatServletWebServerFactory> tomcatSslStoreCustomizer() {\n+        return CloudProviderUtil.configureSslStoreProvider(getKeyStorePassword(), getKeyStoreFile());\n+    }\n+\n+    private String getKeyStorePassword() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a61c93c8e6090d681452c80b54ac14d91e5e21d"}, "originalPosition": 53}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a61c93c8e6090d681452c80b54ac14d91e5e21d", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/3a61c93c8e6090d681452c80b54ac14d91e5e21d", "committedDate": "2020-08-28T22:54:27Z", "message": "DHFPROD-5682:5788: Retrieve and apply keystore from cloud services"}, "afterCommit": {"oid": "1d15885654e4064350bb7748b0e54db738e66676", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1d15885654e4064350bb7748b0e54db738e66676", "committedDate": "2020-08-31T16:19:18Z", "message": "DHFPROD-5682:5788: Retrieve and apply keystore from cloud services"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4Nzg1MjE3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#pullrequestreview-478785217", "createdAt": "2020-08-31T17:00:14Z", "commit": {"oid": "1d15885654e4064350bb7748b0e54db738e66676"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4ODU5MjYx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#pullrequestreview-478859261", "createdAt": "2020-08-31T18:51:12Z", "commit": {"oid": "1d15885654e4064350bb7748b0e54db738e66676"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODo1MToxMlrOHKEi1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODo1MTo0M1rOHKEj4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMyMjI2MQ==", "bodyText": "For consistency, just extend LoggingObject, which defines this for you.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#discussion_r480322261", "createdAt": "2020-08-31T18:51:12Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/cloud/aws/AWSConfiguration.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.central.cloud.aws;\n+\n+import com.amazonaws.services.s3.AmazonS3ClientBuilder;\n+import com.amazonaws.services.simplesystemsmanagement.AWSSimpleSystemsManagementClientBuilder;\n+import com.amazonaws.services.simplesystemsmanagement.model.GetParameterRequest;\n+import com.marklogic.hub.central.web.SslUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.autoconfigure.web.ServerProperties;\n+import org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory;\n+import org.springframework.boot.web.server.WebServerFactoryCustomizer;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Profile;\n+\n+import java.io.InputStream;\n+\n+@Configuration\n+@Profile(\"aws\")\n+public class AWSConfiguration {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AWSConfiguration.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d15885654e4064350bb7748b0e54db738e66676"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMyMjUzMA==", "bodyText": "Same, just extend LoggingObject.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#discussion_r480322530", "createdAt": "2020-08-31T18:51:43Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/cloud/azure/AzureConfiguration.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.central.cloud.azure;\n+\n+import com.azure.identity.DefaultAzureCredentialBuilder;\n+import com.azure.storage.blob.BlobClientBuilder;\n+import com.marklogic.hub.central.web.SslUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.autoconfigure.web.ServerProperties;\n+import org.springframework.boot.web.embedded.tomcat.TomcatServletWebServerFactory;\n+import org.springframework.boot.web.server.WebServerFactoryCustomizer;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Profile;\n+\n+import java.io.InputStream;\n+\n+@Configuration\n+@Profile(\"azure\")\n+public class AzureConfiguration {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AzureConfiguration.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d15885654e4064350bb7748b0e54db738e66676"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08ba5f9f0fe5b4dc95460fe79e5e23b48297e530", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/08ba5f9f0fe5b4dc95460fe79e5e23b48297e530", "committedDate": "2020-08-31T23:51:17Z", "message": "DHFPROD-5682:5788: Retrieve and apply keystore from cloud services"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1d15885654e4064350bb7748b0e54db738e66676", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1d15885654e4064350bb7748b0e54db738e66676", "committedDate": "2020-08-31T16:19:18Z", "message": "DHFPROD-5682:5788: Retrieve and apply keystore from cloud services"}, "afterCommit": {"oid": "08ba5f9f0fe5b4dc95460fe79e5e23b48297e530", "author": {"user": {"login": "akshaysonvane", "name": "Akshay Sonvane"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/08ba5f9f0fe5b4dc95460fe79e5e23b48297e530", "committedDate": "2020-08-31T23:51:17Z", "message": "DHFPROD-5682:5788: Retrieve and apply keystore from cloud services"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NzQzNjIw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#pullrequestreview-479743620", "createdAt": "2020-09-01T13:32:03Z", "commit": {"oid": "08ba5f9f0fe5b4dc95460fe79e5e23b48297e530"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5ODUzNDQ4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4496#pullrequestreview-479853448", "createdAt": "2020-09-01T15:18:31Z", "commit": {"oid": "08ba5f9f0fe5b4dc95460fe79e5e23b48297e530"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2182, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}