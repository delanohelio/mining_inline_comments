{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyNzU5MzA0", "number": 4716, "title": "DHFPROD-4659: Visualize metadata of the document in card view.", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-10-13T19:49:44Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716", "merged": true, "mergeCommit": {"oid": "18dfaab2a88eadb013a206d88dd2043219efbfed"}, "closed": true, "closedAt": "2020-10-13T22:51:36Z", "author": {"login": "timur-isangulov"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSOGoPgBqjM4NzMyNTU4Njk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSQnSeAFqTUwNzg4MjEzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c84e4b892f448d004bb4b6956e15bed91b03ff0c", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c84e4b892f448d004bb4b6956e15bed91b03ff0c", "committedDate": "2020-10-13T19:45:04Z", "message": "DHFPROD-4659: Visualize metadata of the document in card view"}, "afterCommit": {"oid": "68085e390ba3e53549961e51b27d74e8f465ac35", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/68085e390ba3e53549961e51b27d74e8f465ac35", "committedDate": "2020-10-13T19:53:31Z", "message": "DHFPROD-4659: Visualize metadata of the document in card view"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODE1MTA0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#pullrequestreview-507815104", "createdAt": "2020-10-13T20:45:41Z", "commit": {"oid": "68085e390ba3e53549961e51b27d74e8f465ac35"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODE1OTUw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#pullrequestreview-507815950", "createdAt": "2020-10-13T20:47:00Z", "commit": {"oid": "68085e390ba3e53549961e51b27d74e8f465ac35"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMDo0NzowMVrOHg444Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMDo0NzowMVrOHg444Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI0ODU0NQ==", "bodyText": "Can this be RecordCardView?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#discussion_r504248545", "createdAt": "2020-10-13T20:47:01Z", "author": {"login": "rahulvudutala"}, "path": "marklogic-data-hub-central/ui/src/components/record-view/record-view.test.tsx", "diffHunk": "@@ -1,13 +1,13 @@\n import React from 'react';\n import { render, fireEvent, waitForElement } from '@testing-library/react';\n-import { entitySearch } from \"../../../assets/mock-data/explore/entity-search\";\n+import { entitySearch } from \"../../assets/mock-data/explore/entity-search\";\n import { BrowserRouter as Router } from 'react-router-dom';\n-import RawDataCardView from './raw-data-card-view';\n+import RawDataCardView from './record-view';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68085e390ba3e53549961e51b27d74e8f465ac35"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68085e390ba3e53549961e51b27d74e8f465ac35", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/68085e390ba3e53549961e51b27d74e8f465ac35", "committedDate": "2020-10-13T19:53:31Z", "message": "DHFPROD-4659: Visualize metadata of the document in card view"}, "afterCommit": {"oid": "e814d8686534a3f8ee6b244d53d5590816df97d1", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e814d8686534a3f8ee6b244d53d5590816df97d1", "committedDate": "2020-10-13T20:49:11Z", "message": "DHFPROD-4659: Visualize metadata of the document in card view"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e814d8686534a3f8ee6b244d53d5590816df97d1", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e814d8686534a3f8ee6b244d53d5590816df97d1", "committedDate": "2020-10-13T20:49:11Z", "message": "DHFPROD-4659: Visualize metadata of the document in card view"}, "afterCommit": {"oid": "a3ca5818bfd31ef80d8b0785f8a9fee9ba323ba5", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/a3ca5818bfd31ef80d8b0785f8a9fee9ba323ba5", "committedDate": "2020-10-13T20:51:13Z", "message": "DHFPROD-4659: Visualize metadata of the document in card view"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODE3NzE4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#pullrequestreview-507817718", "createdAt": "2020-10-13T20:49:32Z", "commit": {"oid": "68085e390ba3e53549961e51b27d74e8f465ac35"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMDo1MzoxNlrOHg5Fkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QyMDo1NDo0OFrOHg5I6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1MTc5NQ==", "bodyText": "Its still RawDataCardView", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#discussion_r504251795", "createdAt": "2020-10-13T20:53:16Z", "author": {"login": "rahulvudutala"}, "path": "marklogic-data-hub-central/ui/src/components/record-view/record-view.test.tsx", "diffHunk": "@@ -1,13 +1,13 @@\n import React from 'react';\n import { render, fireEvent, waitForElement } from '@testing-library/react';\n-import { entitySearch } from \"../../../assets/mock-data/explore/entity-search\";\n+import { entitySearch } from \"../../assets/mock-data/explore/entity-search\";\n import { BrowserRouter as Router } from 'react-router-dom';\n-import RawDataCardView from './raw-data-card-view';\n+import RawDataCardView from './record-view';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI0ODU0NQ=="}, "originalCommit": {"oid": "68085e390ba3e53549961e51b27d74e8f465ac35"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI1MjY1MQ==", "bodyText": "Can we rename it to RecordCardView?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#discussion_r504252651", "createdAt": "2020-10-13T20:54:48Z", "author": {"login": "rahulvudutala"}, "path": "marklogic-data-hub-central/ui/src/components/record-view/record-view.tsx", "diffHunk": "@@ -0,0 +1,147 @@\n+import React, { CSSProperties, useContext } from 'react';\n+import styles from './record-view.module.scss';\n+import { Card, Icon, Row, Col, Popover } from 'antd';\n+import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n+import { faExternalLinkAlt } from '@fortawesome/free-solid-svg-icons';\n+import { AuthoritiesContext } from \"../../util/authorities\";\n+import { formatCardUri } from '../../util/conversionFunctions';\n+import sourceFormatOptions from '../../config/formats.config';\n+import ReactHtmlParser from 'react-html-parser';\n+import { FileOutlined } from '@ant-design/icons';\n+import { OverflowTooltip } from '../overflow-tooltip/overflow-tooltip';\n+import { MLTooltip, MLPopover } from '@marklogic/design-system';\n+import { CardViewDateConverter } from '../../util/date-conversion';\n+\n+const RawDataCardView = (props) => {\n+  const authorityService = useContext(AuthoritiesContext);\n+\n+  const handleDetailViewNavigation = () => {\n+  }\n+\n+  // Custom CSS for source Format\n+  const sourceFormatStyle = (sourceFmt) => {\n+    let customStyles: CSSProperties = {\n+      display: 'inline-flex',\n+      alignItems: 'center',\n+      justifyContent: 'center',\n+      height: '20px',\n+      width: '20px',\n+      lineHeight: '20px',\n+      backgroundColor: sourceFormatOptions[sourceFmt].color,\n+      fontSize: sourceFmt === 'json' ? '8px' : '8.5px',\n+      borderRadius: '50%',\n+      textAlign: 'center',\n+      color: '#ffffff',\n+      verticalAlign: 'middle',\n+      marginRight: '8px'\n+    }\n+    return customStyles;\n+  }\n+\n+  const displayUri = (uri) => {\n+    return formatCardUri(uri);\n+  }\n+\n+  const displaySnippet = (item) => {\n+    if (['json', 'xml', 'text'].includes(item.format)) {\n+      let str = '';\n+      item.matches.forEach(item => {\n+        item['match-text'].forEach(element => {\n+          if (typeof element === 'object') {\n+            str = str.concat('<b>').concat(element.highlight).concat('</b>').concat('...');\n+          } else {\n+            str = str.concat(element);\n+          }\n+        });\n+      })\n+      return <p>{ReactHtmlParser(str)}</p>;\n+    } else if ('binary' === item.format) {\n+      return (\n+        <div className={styles.binaryCard} >\n+          <FileOutlined className={styles.binaryIcon} />\n+          <div className={styles.binaryText} data-testid={item.uri + '-noPreview'}> No preview available</div>\n+        </div>\n+      )\n+    }\n+  }\n+\n+  const displayRecordSources = (item) => {\n+    let sources = item.hubMetadata?.sources.map((record) => {\n+      return record.name;\n+    }).join(\", \");\n+    return sources;\n+  }\n+\n+  const emptyField = (\n+    <p className={styles.textDisabled}>none</p>\n+  )\n+\n+  const displayRecordMetadata = (item) => {\n+    return (\n+      <div className={styles.popover} data-testid={item.uri + '-popover'}>\n+        <div className={styles.colKey}>\n+          <p>Source:</p>\n+          <p>Flow:</p>\n+          <p>Step:</p>\n+          <p>Created On:</p>\n+        </div>\n+        <div className={styles.colValue}>\n+          {item.hubMetadata?.sources?.length > 0 ? <span className={styles.valText} data-testid={item.uri + '-sources'}>\n+            <OverflowTooltip title={displayRecordSources(item)} placement={\"bottom\"} content={displayRecordSources(item).substring(0, 28)} width={\"200px\"} />\n+          </span> : emptyField}\n+          {item.hubMetadata?.lastProcessedByFlow ? <span className={styles.valText} data-testid={item.uri + '-lastProcessedByFlow'}>\n+            <OverflowTooltip title={item.hubMetadata?.lastProcessedByFlow} placement={\"bottom\"} content={item.hubMetadata?.lastProcessedByFlow} width={\"200px\"} />\n+          </span> : emptyField}\n+          {item.hubMetadata?.lastProcessedByStep ? <span className={styles.valText} data-testid={item.uri + '-lastProcessedByStep'}>\n+            <OverflowTooltip title={item.hubMetadata.lastProcessedByStep} placement={\"bottom\"} content={item.hubMetadata.lastProcessedByStep} width={\"200px\"} />\n+          </span> : emptyField}\n+          {item.hubMetadata?.lastProcessedDateTime ? <span className={styles.valText} data-testid={item.uri + '-lastProcessedDateTime'}>\n+            {CardViewDateConverter(item.hubMetadata?.lastProcessedDateTime)}\n+          </span> : emptyField}\n+        </div>\n+      </div>\n+    );\n+  }\n+\n+  return (\n+    <div id=\"record-data-card\" aria-label=\"record-data-card\" className={styles.rawDataCard}>\n+      <Row gutter={24} type=\"flex\" >\n+        {props.data && props.data.length > 0 ? props.data.map((elem, index) => (\n+          <Col key={index}>\n+            <div >\n+              <Card\n+                className={styles.cardStyle}\n+                size=\"small\"\n+              >\n+                <div className={styles.cardMetadataContainer}>\n+                  <span className={styles.uriContainer} data-testid={elem.uri + '-URI'}>URI: <span className={styles.uri}>\n+                    <MLTooltip title={elem.uri} placement=\"bottom\">{displayUri(elem.uri)}</MLTooltip></span></span>\n+                  <span className={styles.cardIcons}>\n+                    <MLPopover getPopupContainer={trigger => trigger.parentElement} content={displayRecordMetadata(elem)} placement=\"bottomRight\" trigger=\"click\">\n+                      <span>\n+                        <MLTooltip title={\"View info\"} placement=\"bottom\">\n+                          <span className={styles.infoIcon}><Icon type=\"info-circle\" theme=\"filled\" data-testid={elem.uri + '-InfoIcon'} /></span>\n+                        </MLTooltip>\n+                      </span>\n+                    </MLPopover>\n+                    <span className={styles.sourceFormat}\n+                      style={sourceFormatStyle(elem.format)}\n+                      data-testid={elem.uri + '-sourceFormat'}\n+                    >{sourceFormatOptions[elem.format].label}</span>\n+                    <MLTooltip title={'Detail view'} placement=\"bottom\"\n+                    ><i role=\"detail-link icon\" data-testid={elem.uri + '-detailViewIcon'}><FontAwesomeIcon icon={faExternalLinkAlt} className={elem.format === 'binary' ? styles.detailLinkIconDisabled : styles.detailLinkIcon} size=\"lg\" /></i>\n+                    </MLTooltip>\n+                  </span>\n+                </div>\n+                <div className={styles.snippetContainer} data-testid={elem.uri + '-snippet'} >\n+                  {displaySnippet(elem)}\n+                </div>\n+              </Card>\n+            </div>\n+          </Col>)) : <span></span>}\n+      </Row>\n+    </div>\n+  );\n+}\n+\n+export default RawDataCardView;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3ca5818bfd31ef80d8b0785f8a9fee9ba323ba5"}, "originalPosition": 147}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3ca5818bfd31ef80d8b0785f8a9fee9ba323ba5", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/a3ca5818bfd31ef80d8b0785f8a9fee9ba323ba5", "committedDate": "2020-10-13T20:51:13Z", "message": "DHFPROD-4659: Visualize metadata of the document in card view"}, "afterCommit": {"oid": "6e27bf41dfedd4c4277c74ee42c92d0b610278bd", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6e27bf41dfedd4c4277c74ee42c92d0b610278bd", "committedDate": "2020-10-13T20:57:35Z", "message": "DHFPROD-4659: Visualize metadata of the document in card view"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODI1MDU5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#pullrequestreview-507825059", "createdAt": "2020-10-13T21:00:22Z", "commit": {"oid": "6e27bf41dfedd4c4277c74ee42c92d0b610278bd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODI5MTk5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#pullrequestreview-507829199", "createdAt": "2020-10-13T21:07:09Z", "commit": {"oid": "6e27bf41dfedd4c4277c74ee42c92d0b610278bd"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5e6ff519b2f47af0970e97a1eab451fa195731a", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c5e6ff519b2f47af0970e97a1eab451fa195731a", "committedDate": "2020-10-13T21:28:10Z", "message": "DHFPROD-4659: Visualize metadata of the document in card view"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e27bf41dfedd4c4277c74ee42c92d0b610278bd", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6e27bf41dfedd4c4277c74ee42c92d0b610278bd", "committedDate": "2020-10-13T20:57:35Z", "message": "DHFPROD-4659: Visualize metadata of the document in card view"}, "afterCommit": {"oid": "c5e6ff519b2f47af0970e97a1eab451fa195731a", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c5e6ff519b2f47af0970e97a1eab451fa195731a", "committedDate": "2020-10-13T21:28:10Z", "message": "DHFPROD-4659: Visualize metadata of the document in card view"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODQzNzUy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#pullrequestreview-507843752", "createdAt": "2020-10-13T21:31:14Z", "commit": {"oid": "c5e6ff519b2f47af0970e97a1eab451fa195731a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODgyMTMx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4716#pullrequestreview-507882131", "createdAt": "2020-10-13T22:49:16Z", "commit": {"oid": "c5e6ff519b2f47af0970e97a1eab451fa195731a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1740, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}