{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxOTY0MTk0", "number": 4868, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoxNjowMVrOE5wpRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwNDo0NDoyNVrOE52QYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MDAxMjg2OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/4/transforms/mlcp-flow-transform.sjs", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoxNjowMVrOH0bDUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODo0NzoyM1rOH1EDLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczMTIxOA==", "bodyText": "Let's convert this to use ds-util.sjs too. That library of course is a little mis-named now - we may want to rename it to \"http-util.sjs\", since the functions are generic to HTTP. But the more error handling that's routed through those functions, the better, as it makes it easier for us to track where we're throwing errors. And of course, it reduces duplication of the usage of RESTAPI-SRVEXERR.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r524731218", "createdAt": "2020-11-16T23:16:01Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/4/transforms/mlcp-flow-transform.sjs", "diffHunk": "@@ -49,7 +49,7 @@ function transform(content, context) {\n   let flow = flowlib.getFlow(entityName, flowName, consts.INPUT_FLOW);\n \n   if (!flow) {\n-    fn.error(null, \"RESTAPI-SRVEXERR\", \"The specified flow \" + params.flow + \" is missing.\");\n+    fn.error(null, \"RESTAPI-SRVEXERR\", Sequence.from([404, \"Not Found\", \"The specified flow \" + params.flow + \" is missing.\"]));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5246e8319604604921b8bdf5759c02d88eeb50e3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgwNjA5NQ==", "bodyText": "The uri of http-utils.sjs will be /data-hub/5/data-services/http-utils.sjs . Should that be changed to /data-hub/5/impl/http-utils.sjs or /data-hub/5/http-utils.sjs ? I have moved it to /data-hub/5/impl/http-utils.sjs in my latest commit.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r524806095", "createdAt": "2020-11-17T00:29:27Z", "author": {"login": "srinathgit"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/4/transforms/mlcp-flow-transform.sjs", "diffHunk": "@@ -49,7 +49,7 @@ function transform(content, context) {\n   let flow = flowlib.getFlow(entityName, flowName, consts.INPUT_FLOW);\n \n   if (!flow) {\n-    fn.error(null, \"RESTAPI-SRVEXERR\", \"The specified flow \" + params.flow + \" is missing.\");\n+    fn.error(null, \"RESTAPI-SRVEXERR\", Sequence.from([404, \"Not Found\", \"The specified flow \" + params.flow + \" is missing.\"]));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczMTIxOA=="}, "originalCommit": {"oid": "5246e8319604604921b8bdf5759c02d88eeb50e3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTE1MDEyNw==", "bodyText": "Oh I was saying - don't rename it now, let's take care of that in a separate PR. Sorry for the confusion.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r525150127", "createdAt": "2020-11-17T13:25:33Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/4/transforms/mlcp-flow-transform.sjs", "diffHunk": "@@ -49,7 +49,7 @@ function transform(content, context) {\n   let flow = flowlib.getFlow(entityName, flowName, consts.INPUT_FLOW);\n \n   if (!flow) {\n-    fn.error(null, \"RESTAPI-SRVEXERR\", \"The specified flow \" + params.flow + \" is missing.\");\n+    fn.error(null, \"RESTAPI-SRVEXERR\", Sequence.from([404, \"Not Found\", \"The specified flow \" + params.flow + \" is missing.\"]));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczMTIxOA=="}, "originalCommit": {"oid": "5246e8319604604921b8bdf5759c02d88eeb50e3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM2NDI5OQ==", "bodyText": "Since we are using it outside of ds, is it ok to rename in this PR itself ?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r525364299", "createdAt": "2020-11-17T17:49:53Z", "author": {"login": "srinathgit"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/4/transforms/mlcp-flow-transform.sjs", "diffHunk": "@@ -49,7 +49,7 @@ function transform(content, context) {\n   let flow = flowlib.getFlow(entityName, flowName, consts.INPUT_FLOW);\n \n   if (!flow) {\n-    fn.error(null, \"RESTAPI-SRVEXERR\", \"The specified flow \" + params.flow + \" is missing.\");\n+    fn.error(null, \"RESTAPI-SRVEXERR\", Sequence.from([404, \"Not Found\", \"The specified flow \" + params.flow + \" is missing.\"]));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczMTIxOA=="}, "originalCommit": {"oid": "5246e8319604604921b8bdf5759c02d88eeb50e3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQwMTE2Mg==", "bodyText": "Sure, that's fine. I'm not a fan of the \"impl\" directory (since \"impl\" is meaningless), but putting it in there is consistent with \"hub-utils\" and \"flow-utils\", so that'll work for now.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r525401162", "createdAt": "2020-11-17T18:44:40Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/4/transforms/mlcp-flow-transform.sjs", "diffHunk": "@@ -49,7 +49,7 @@ function transform(content, context) {\n   let flow = flowlib.getFlow(entityName, flowName, consts.INPUT_FLOW);\n \n   if (!flow) {\n-    fn.error(null, \"RESTAPI-SRVEXERR\", \"The specified flow \" + params.flow + \" is missing.\");\n+    fn.error(null, \"RESTAPI-SRVEXERR\", Sequence.from([404, \"Not Found\", \"The specified flow \" + params.flow + \" is missing.\"]));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczMTIxOA=="}, "originalCommit": {"oid": "5246e8319604604921b8bdf5759c02d88eeb50e3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQwMjkyNQ==", "bodyText": "I think the PR is ready for review then", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r525402925", "createdAt": "2020-11-17T18:47:23Z", "author": {"login": "srinathgit"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/4/transforms/mlcp-flow-transform.sjs", "diffHunk": "@@ -49,7 +49,7 @@ function transform(content, context) {\n   let flow = flowlib.getFlow(entityName, flowName, consts.INPUT_FLOW);\n \n   if (!flow) {\n-    fn.error(null, \"RESTAPI-SRVEXERR\", \"The specified flow \" + params.flow + \" is missing.\");\n+    fn.error(null, \"RESTAPI-SRVEXERR\", Sequence.from([404, \"Not Found\", \"The specified flow \" + params.flow + \" is missing.\"]));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczMTIxOA=="}, "originalCommit": {"oid": "5246e8319604604921b8bdf5759c02d88eeb50e3"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MDA0MTI4OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/transforms/mlcp-flow-transform.sjs", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoxOToxNFrOH0bYmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoxOToxNFrOH0bYmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczNjY2NQ==", "bodyText": "For these, let's add throwNotFoundWithArray(args) and throwBadRequestWithArray(args) so that when a client wants to return multiple things, it's easy to do so.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r524736665", "createdAt": "2020-11-16T23:19:14Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/transforms/mlcp-flow-transform.sjs", "diffHunk": "@@ -62,7 +62,7 @@ function transform(content, context = {}) {\n \n     if (!flow) {\n       datahub.debug.log({message: params, type: 'error'});\n-      fn.error(null, \"RESTAPI-SRVEXERR\", Sequence.from([\"DH-FLOWMISSING\", \"The specified flow \" + flowName + \" is missing.\", content.uri]));\n+      fn.error(null, \"RESTAPI-SRVEXERR\", Sequence.from([404, \"DH-FLOWMISSING\", \"The specified flow \" + flowName + \" is missing.\", content.uri]));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5246e8319604604921b8bdf5759c02d88eeb50e3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MDkzMjE4OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/entities/search/EntitySearchManagerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwNDo0NDoyNVrOH0kM-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDo1MjowNVrOH1K_lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg4MTE0Nw==", "bodyText": "@rahulvudutala ,\nIn entity-search-lib.sjs line 48, I changed the HTTP error code from 500 to 404. It causes this endpoint to return null instead of exception it used to throw earlier ? let me know if that's ok.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r524881147", "createdAt": "2020-11-17T04:44:25Z", "author": {"login": "srinathgit"}, "path": "marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/entities/search/EntitySearchManagerTest.java", "diffHunk": "@@ -96,7 +96,7 @@ public void testSearchResultsOnNonExistentEntityModel() {\n \n         SearchQuery searchQuery = new SearchQuery();\n         searchQuery.getQuery().setEntityTypeIds(Arrays.asList(\"Some-entityType\"));\n-        assertThrows(MarkLogicServerException.class, () -> new EntitySearchManager(getHubClient()).search(searchQuery), \"Entity Model with name Some-entityType doesn't exist \");\n+        assertNull(new EntitySearchManager(getHubClient()).search(searchQuery), \"Entity Model with name Some-entityType doesn't exist \");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f74ea547eac25878a862785dcac03462d6df9e3f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUxNjY5NA==", "bodyText": "Yeah it should be ok.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r525516694", "createdAt": "2020-11-17T20:52:05Z", "author": {"login": "rahulvudutala"}, "path": "marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/entities/search/EntitySearchManagerTest.java", "diffHunk": "@@ -96,7 +96,7 @@ public void testSearchResultsOnNonExistentEntityModel() {\n \n         SearchQuery searchQuery = new SearchQuery();\n         searchQuery.getQuery().setEntityTypeIds(Arrays.asList(\"Some-entityType\"));\n-        assertThrows(MarkLogicServerException.class, () -> new EntitySearchManager(getHubClient()).search(searchQuery), \"Entity Model with name Some-entityType doesn't exist \");\n+        assertNull(new EntitySearchManager(getHubClient()).search(searchQuery), \"Entity Model with name Some-entityType doesn't exist \");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg4MTE0Nw=="}, "originalCommit": {"oid": "f74ea547eac25878a862785dcac03462d6df9e3f"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3116, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}