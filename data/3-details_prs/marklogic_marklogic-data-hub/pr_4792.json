{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNDY3NjUy", "number": 4792, "title": "DHFPROD-6163:Add the AWS Glue job info in the job document.", "bodyText": "Description - Adding exception.  Thrown when additionalExternalMetadata is invalid.\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-10-29T18:13:38Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4792", "merged": true, "mergeCommit": {"oid": "1167862d8183ee54ff24d23bf32c6504216c8b26"}, "closed": true, "closedAt": "2020-10-29T20:54:33Z", "author": {"login": "anu3990"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXW2ZKgFqTUxOTk3OTI1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXXhpuAFqTUyMDAxMzQ2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5OTc5MjU0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4792#pullrequestreview-519979254", "createdAt": "2020-10-29T18:54:43Z", "commit": {"oid": "b5fb89d1e9a6defdd099f8a14e29af3f5b0d6e04"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxODo1NDo0M1rOHqqKzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxODo1NDo0M1rOHqqKzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ5MzEzMg==", "bodyText": "I think this should still be a warning and not cause an error. The reasoning is that Ernie can fix a problem with additionalexternalmetadata - he's in control of that. But if for some reason we can't read the Spark StructType as JSON, it's not likely that Ernie can fix that, and now he can't ingest any data.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4792#discussion_r514493132", "createdAt": "2020-10-29T18:54:43Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -249,10 +249,15 @@ private String initializeJob(StructType schema) {\n             if(options.get(\"additionalexternalmetadata\")!=null) {\n                 externalMetadata = (ObjectNode) objectMapper.readTree(options.get(\"additionalexternalmetadata\"));\n             }\n+        } catch(Exception e) {\n+                throw new IllegalArgumentException(\"Unable to parse additionalExternalMetadata option as a JSON object; \" +\n+                    \"cause: \" + e.getMessage(), e);\n+        }\n+        try{\n             externalMetadata.set(\"sparkSchema\", objectMapper.readTree(schema.json()));\n \n         } catch (Exception e) {\n-            logger.warn(\"Unable to read Spark schema as a JSON object; cause: \" + e.getMessage() + \"; the schema will not \" +\n+            throw new IllegalArgumentException(\"Unable to read Spark schema as a JSON object; cause: \" + e.getMessage() + \"; the schema will not \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5fb89d1e9a6defdd099f8a14e29af3f5b0d6e04"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54d6f773ac9bea2db28c4986376aa4c18fb6eaec", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/54d6f773ac9bea2db28c4986376aa4c18fb6eaec", "committedDate": "2020-10-29T19:11:49Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5fb89d1e9a6defdd099f8a14e29af3f5b0d6e04", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b5fb89d1e9a6defdd099f8a14e29af3f5b0d6e04", "committedDate": "2020-10-29T18:11:29Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}, "afterCommit": {"oid": "54d6f773ac9bea2db28c4986376aa4c18fb6eaec", "author": {"user": {"login": "anu3990", "name": "Anushree Sinha"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/54d6f773ac9bea2db28c4986376aa4c18fb6eaec", "committedDate": "2020-10-29T19:11:49Z", "message": "DHFPROD-6163:Add the AWS Glue job info in the job document."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5OTk1OTA2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4792#pullrequestreview-519995906", "createdAt": "2020-10-29T19:17:03Z", "commit": {"oid": "54d6f773ac9bea2db28c4986376aa4c18fb6eaec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMDEzNDYx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4792#pullrequestreview-520013461", "createdAt": "2020-10-29T19:42:04Z", "commit": {"oid": "54d6f773ac9bea2db28c4986376aa4c18fb6eaec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1837, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}