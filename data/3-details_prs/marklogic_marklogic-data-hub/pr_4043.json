{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2ODgwMzEy", "number": 4043, "title": "DHFPROD-4669: Add hub-central-step-runner role", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-06-02T23:29:44Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043", "merged": true, "mergeCommit": {"oid": "da6e9c53b47cd8f5467b09165e964cacd835d258"}, "closed": true, "closedAt": "2020-06-05T02:10:14Z", "author": {"login": "ryanjdew"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnd8NAAFqTQyMzEzNDQyMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoI9TPgFqTQyNDk1MTMzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMTM0NDIz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#pullrequestreview-423134423", "createdAt": "2020-06-03T00:02:08Z", "commit": {"oid": "d77628649901ed784eaacfa395b1b01f490831a3"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d77628649901ed784eaacfa395b1b01f490831a3", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d77628649901ed784eaacfa395b1b01f490831a3", "committedDate": "2020-06-02T23:28:02Z", "message": "DHFPROD-4669: Add hub-central-step-runner role"}, "afterCommit": {"oid": "790fbee705fba5ef24a57e0c99e91ffe00336d69", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/790fbee705fba5ef24a57e0c99e91ffe00336d69", "committedDate": "2020-06-03T16:02:58Z", "message": "DHFPROD-4669: Add hub-central-step-runner role"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "790fbee705fba5ef24a57e0c99e91ffe00336d69", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/790fbee705fba5ef24a57e0c99e91ffe00336d69", "committedDate": "2020-06-03T16:02:58Z", "message": "DHFPROD-4669: Add hub-central-step-runner role"}, "afterCommit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1a377f8bdd33b99dabc4c13481c2b3a7c1953f39", "committedDate": "2020-06-03T19:35:36Z", "message": "DHFPROD-4669: Add hub-central-step-runner role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzODgwNjc3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#pullrequestreview-423880677", "createdAt": "2020-06-03T19:52:27Z", "commit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzOTc5OTQx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#pullrequestreview-423979941", "createdAt": "2020-06-03T22:25:42Z", "commit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMjoyNTo0MlrOGevrrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMjoyNTo0MlrOGevrrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg5MTY5NQ==", "bodyText": "can we try using getByLabelText. If it works then we might not need data-testid", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#discussion_r434891695", "createdAt": "2020-06-03T22:25:42Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/flows/flows.tsx", "diffHunk": "@@ -256,6 +258,7 @@ const Flows: React.FC<Props> = (props) => {\n                                         <div\n                                             className={styles.run}\n                                             aria-label={'runStep-' + stepNumber}\n+                                            data-testid={'runStep-' + stepNumber}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzOTgxOTkx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#pullrequestreview-423981991", "createdAt": "2020-06-03T22:30:15Z", "commit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMjozMDoxNVrOGevxug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMjozMDoxNVrOGevxug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg5MzI0Mg==", "bodyText": "same comment applies here. Can we try using getByLabelText and maybe replace row number \"i\" in line 145 above and line 159 below with flow/stepName if possible.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#discussion_r434893242", "createdAt": "2020-06-03T22:30:15Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/flows/flows.tsx", "diffHunk": "@@ -150,6 +150,7 @@ const Flows: React.FC<Props> = (props) => {\n                                 event.stopPropagation(); // Do not trigger collapse\n                                 handleFlowDelete(name);\n                             }}\n+                            data-testid={'deleteFlow-' + i}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDM2MDYw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#pullrequestreview-424036060", "createdAt": "2020-06-04T01:12:01Z", "commit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwMToxMjowMVrOGeyfnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwMToxMjowMVrOGeyfnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkzNzc1Nw==", "bodyText": "Can we pls add some more assertions per test plan.\n\nin TilesView.test to check step runner is not able to delete a step\nin Load.test and Curate.test to check step-runner is not able to add steps to a flow\nin Load.test and Curate.test same tests as the ones for ingestion/mapping reader authority but using readStep authority. Additionally these tests will have checks to verify that readStep auth can see Match/Merge and Custom tabs. So corresponding configs needs to be added in runConfig.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#discussion_r434937757", "createdAt": "2020-06-04T01:12:01Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/pages/TilesView.test.tsx", "diffHunk": "@@ -121,6 +121,69 @@ describe('TilesView component', () => {\n         expect(document.querySelector('#flows-container')).toBeInTheDocument();\n         expect(getByText('Create Flow')).toBeInTheDocument();\n         expect(getByText('testFlow')).toBeInTheDocument();\n+        // delete should work\n+        fireEvent.click(getByTestId('deleteFlow-0'));\n+        // testing that confirmation modal appears\n+        expect(queryByText('Yes')).toBeInTheDocument();\n+        fireEvent.click(getByText('No'));\n+\n+        // test description\n+        fireEvent.click(getByText('testFlow'));\n+        expect(getByText('Save')).not.toBeDisabled();\n+        fireEvent.click(getByText('Cancel'));\n+        // test run\n+        fireEvent.click(getByLabelText('icon: right'));\n+        expect(getByTestId('runStep-1')).toBeInTheDocument();\n+    });\n+\n+    test('Verify run tile cannot edit with only readStep authority', async () => {\n+        const authorityService = new AuthoritiesService();\n+        authorityService.setAuthorities(['readStep']);\n+        const {getByLabelText, getByText, queryByText, getByTestId} = render(<AuthoritiesContext.Provider value={authorityService}><TilesView/></AuthoritiesContext.Provider>);\n+\n+\n+        // Run tile not shown initially\n+        expect(queryByText(\"icon-run\")).not.toBeInTheDocument();\n+        expect(queryByText(\"title-run\")).not.toBeInTheDocument();\n+\n+        fireEvent.click(getByLabelText(\"tool-run\"));\n+\n+        // Run tile shown with entityTypes after click\n+        expect(await(waitForElement(() => getByLabelText(\"icon-run\")))).toBeInTheDocument();\n+        expect(getByLabelText(\"title-run\")).toBeInTheDocument();\n+        expect(document.querySelector('#flows-container')).toBeInTheDocument();\n+        expect(getByText('testFlow')).toBeInTheDocument();\n+        // create flow shouldn't be provided\n+        expect(queryByText('Create Flow')).toBeDisabled();\n+        // delete should not work\n+        fireEvent.click(getByTestId('deleteFlow-0'));\n+        // testing that confirmation modal didn't appear\n+        expect(queryByText('Yes')).not.toBeInTheDocument();\n+        // test description\n+        fireEvent.click(getByText('testFlow'));\n+        expect(queryByText('Save')).not.toBeInTheDocument();\n+        fireEvent.click(getByText('Close'));\n+\n+        // test run\n+        fireEvent.click(getByLabelText('icon: right'));\n+        expect(getByTestId('runStepDisabled-1')).toBeInTheDocument();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MDM3NjI3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#pullrequestreview-424037627", "createdAt": "2020-06-04T01:17:09Z", "commit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwMToxNzowOVrOGeykcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwMToxNzowOVrOGeykcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkzODk5Mg==", "bodyText": "should include data-hub-match-merge-reader and data-hub-custom-reader per HC roles wiki.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#discussion_r434938992", "createdAt": "2020-06-04T01:17:09Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/roles/hub-central-step-runner.json", "diffHunk": "@@ -0,0 +1,39 @@\n+{\n+  \"role-name\": \"hub-central-step-runner\",\n+  \"description\": \"Permits reading/reviewing mapping steps in Hub Central\",\n+  \"role\": [\n+    \"hub-central-user\",\n+    \"data-hub-common-writer\",\n+    \"data-hub-flow-reader\",\n+    \"data-hub-ingestion-reader\",\n+    \"data-hub-mapping-reader\",\n+    \"data-hub-step-definition-reader\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1a377f8bdd33b99dabc4c13481c2b3a7c1953f39", "committedDate": "2020-06-03T19:35:36Z", "message": "DHFPROD-4669: Add hub-central-step-runner role"}, "afterCommit": {"oid": "1709bc5622a19d7a40e34d2688c9ed19c3ec0597", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1709bc5622a19d7a40e34d2688c9ed19c3ec0597", "committedDate": "2020-06-04T15:44:52Z", "message": "DHFPROD-4669: Add hub-central-step-runner role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjEzMjQz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#pullrequestreview-424613243", "createdAt": "2020-06-04T16:14:05Z", "commit": {"oid": "1709bc5622a19d7a40e34d2688c9ed19c3ec0597"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0Njc2Mzg4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#pullrequestreview-424676388", "createdAt": "2020-06-04T17:33:57Z", "commit": {"oid": "1709bc5622a19d7a40e34d2688c9ed19c3ec0597"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53589c925f2733400408719232a73505d0edcf6c", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/53589c925f2733400408719232a73505d0edcf6c", "committedDate": "2020-06-04T20:30:05Z", "message": "DHFPROD-4669: Add hub-central-step-runner role"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1709bc5622a19d7a40e34d2688c9ed19c3ec0597", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1709bc5622a19d7a40e34d2688c9ed19c3ec0597", "committedDate": "2020-06-04T15:44:52Z", "message": "DHFPROD-4669: Add hub-central-step-runner role"}, "afterCommit": {"oid": "53589c925f2733400408719232a73505d0edcf6c", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/53589c925f2733400408719232a73505d0edcf6c", "committedDate": "2020-06-04T20:30:05Z", "message": "DHFPROD-4669: Add hub-central-step-runner role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0ODA2OTAw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#pullrequestreview-424806900", "createdAt": "2020-06-04T20:33:47Z", "commit": {"oid": "53589c925f2733400408719232a73505d0edcf6c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQyMDozMzo0N1rOGfWytA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQyMDozMzo0N1rOGfWytA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTUzMjQ2OA==", "bodyText": "While the Wiki states that, the Wiki is communicating the end state. Since we don't have referenced custom/match/merge steps in 5.3, I don't think we need to create the roles, nor have them here. It's fine if the work is done already, just pointing out that the Wiki is problematic as a definition of scope when it references many tickets.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#discussion_r435532468", "createdAt": "2020-06-04T20:33:47Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/roles/hub-central-step-runner.json", "diffHunk": "@@ -0,0 +1,39 @@\n+{\n+  \"role-name\": \"hub-central-step-runner\",\n+  \"description\": \"Permits reading/reviewing mapping steps in Hub Central\",\n+  \"role\": [\n+    \"hub-central-user\",\n+    \"data-hub-common-writer\",\n+    \"data-hub-flow-reader\",\n+    \"data-hub-ingestion-reader\",\n+    \"data-hub-mapping-reader\",\n+    \"data-hub-step-definition-reader\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkzODk5Mg=="}, "originalCommit": {"oid": "1a377f8bdd33b99dabc4c13481c2b3a7c1953f39"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0OTUxMzM2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4043#pullrequestreview-424951336", "createdAt": "2020-06-05T02:09:15Z", "commit": {"oid": "53589c925f2733400408719232a73505d0edcf6c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2700, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}