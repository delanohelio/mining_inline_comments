{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5MzQ1MjUz", "number": 4529, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxNTo1Nzo1NlrOEg-0Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTowOToxOFrOEh3BKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDE5MTAzOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/auth/WebSecurityConfiguration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxNTo1Nzo1NlrOHOD1Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMjoxNzoyNlrOHOINfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNDg4Ng==", "bodyText": "noticed a lot of redirect requests for /websocket when running e2e. Filtering /websocket alongwith /api gets rid of the issue. Will probably push the changes after running some more e2e tests", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r484504886", "createdAt": "2020-09-07T15:57:56Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/auth/WebSecurityConfiguration.java", "diffHunk": "@@ -55,7 +59,13 @@ protected void configure(HttpSecurity http) throws Exception {\n             .addFilterAfter(new AuthenticationFilter(hubCentral, hubClientProvider), LogoutFilter.class)\n             .csrf().disable()\n             // Need to setStatus, sendError causes issues. see https://stackoverflow.com/a/34911131\n-            .exceptionHandling().authenticationEntryPoint(((request, response, authException) -> response.setStatus(HttpServletResponse.SC_UNAUTHORIZED)))\n+            .exceptionHandling().authenticationEntryPoint(((request, response, authException) -> {\n+                if (request.getRequestURI().startsWith(\"/api/\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5899c981dac988aba90cd95521388b57047124a3"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU3NjYzOQ==", "bodyText": "This is fixed now.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r484576639", "createdAt": "2020-09-07T22:17:26Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/auth/WebSecurityConfiguration.java", "diffHunk": "@@ -55,7 +59,13 @@ protected void configure(HttpSecurity http) throws Exception {\n             .addFilterAfter(new AuthenticationFilter(hubCentral, hubClientProvider), LogoutFilter.class)\n             .csrf().disable()\n             // Need to setStatus, sendError causes issues. see https://stackoverflow.com/a/34911131\n-            .exceptionHandling().authenticationEntryPoint(((request, response, authException) -> response.setStatus(HttpServletResponse.SC_UNAUTHORIZED)))\n+            .exceptionHandling().authenticationEntryPoint(((request, response, authException) -> {\n+                if (request.getRequestURI().startsWith(\"/api/\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNDg4Ng=="}, "originalCommit": {"oid": "5899c981dac988aba90cd95521388b57047124a3"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDE5MjczOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/App.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxNTo1ODo0NFrOHOD2Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMjoxNzozNlrOHOINmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNTE2Mw==", "bodyText": "location should probably be loc @wooldridge ?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r484505163", "createdAt": "2020-09-07T15:58:44Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/App.tsx", "diffHunk": "@@ -41,6 +41,16 @@ const App: React.FC<Props> = ({history, location}) => {\n     )}/>\n   );\n \n+  const getPageRoute = (loc) => {\n+    if (loc.search && loc.search.startsWith(\"?from=\")) {\n+      return decodeURIComponent(loc.search.substring(6));\n+    } else if (location.pathname !== '/' && location.pathname !== '/noresponse') {\n+      return location.pathname", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5899c981dac988aba90cd95521388b57047124a3"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU3NjY2NA==", "bodyText": "Fixed.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r484576664", "createdAt": "2020-09-07T22:17:36Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/App.tsx", "diffHunk": "@@ -41,6 +41,16 @@ const App: React.FC<Props> = ({history, location}) => {\n     )}/>\n   );\n \n+  const getPageRoute = (loc) => {\n+    if (loc.search && loc.search.startsWith(\"?from=\")) {\n+      return decodeURIComponent(loc.search.substring(6));\n+    } else if (location.pathname !== '/' && location.pathname !== '/noresponse') {\n+      return location.pathname", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNTE2Mw=="}, "originalCommit": {"oid": "5899c981dac988aba90cd95521388b57047124a3"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDI2NTUyOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/App.tsx", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxNjozMjowNVrOHOEgEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMToxMDoyNlrOHPacDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxNTg1OA==", "bodyText": "If bookmark url contains /tiles/explore/detail, authentication leads to 500 Internal Server Error, since docUri seems to be undefined: http://localhost:3000/api/entitySearch?docUri=undefined\nDetail component gets the uri from either location.state or from user preferences in LocalStorage. If the LocalStorage for the user doesnt include uri, we will get 500 Internal Server Error. Pinging @rahulvudutala  and @Sanjeevani19 for awarerness.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r484515858", "createdAt": "2020-09-07T16:32:05Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/App.tsx", "diffHunk": "@@ -53,9 +63,8 @@ const App: React.FC<Props> = ({history, location}) => {\n     } else {\n       if (user.error.type !== '') {\n         history.push('/error');\n-      } else if (location.pathname !== '/' && location.pathname !== '/noresponse') {\n-        user.pageRoute = location.pathname;\n       }\n+      user.pageRoute = getPageRoute(location);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5899c981dac988aba90cd95521388b57047124a3"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxODI2MA==", "bodyText": "Recently @xnikhil08 made changes to the uri as a part of this PR #4489, he might have a better idea about this.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r484518260", "createdAt": "2020-09-07T16:40:22Z", "author": {"login": "Sanjeevani19"}, "path": "marklogic-data-hub-central/ui/src/App.tsx", "diffHunk": "@@ -53,9 +63,8 @@ const App: React.FC<Props> = ({history, location}) => {\n     } else {\n       if (user.error.type !== '') {\n         history.push('/error');\n-      } else if (location.pathname !== '/' && location.pathname !== '/noresponse') {\n-        user.pageRoute = location.pathname;\n       }\n+      user.pageRoute = getPageRoute(location);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxNTg1OA=="}, "originalCommit": {"oid": "5899c981dac988aba90cd95521388b57047124a3"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY0NTExOQ==", "bodyText": "@bsrikan - are you still facing this issue?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r484645119", "createdAt": "2020-09-08T04:37:04Z", "author": {"login": "xnikhil08"}, "path": "marklogic-data-hub-central/ui/src/App.tsx", "diffHunk": "@@ -53,9 +63,8 @@ const App: React.FC<Props> = ({history, location}) => {\n     } else {\n       if (user.error.type !== '') {\n         history.push('/error');\n-      } else if (location.pathname !== '/' && location.pathname !== '/noresponse') {\n-        user.pageRoute = location.pathname;\n       }\n+      user.pageRoute = getPageRoute(location);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxNTg1OA=="}, "originalCommit": {"oid": "5899c981dac988aba90cd95521388b57047124a3"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAwNjg3OA==", "bodyText": "@xnikhil08 yes, I am able to reproduce the 500 error when trying to login as a user who saved the bookmark, when there is no local storage. Its also easily reproducible when the bookmark is used by a different user.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r485006878", "createdAt": "2020-09-08T15:24:06Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/App.tsx", "diffHunk": "@@ -53,9 +63,8 @@ const App: React.FC<Props> = ({history, location}) => {\n     } else {\n       if (user.error.type !== '') {\n         history.push('/error');\n-      } else if (location.pathname !== '/' && location.pathname !== '/noresponse') {\n-        user.pageRoute = location.pathname;\n       }\n+      user.pageRoute = getPageRoute(location);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxNTg1OA=="}, "originalCommit": {"oid": "5899c981dac988aba90cd95521388b57047124a3"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA1NTA3Ng==", "bodyText": "Can we fix this by either 1. moving necessary information to the URL or 2. redirecting to a different page if the docUri is undefined?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r485055076", "createdAt": "2020-09-08T16:38:14Z", "author": {"login": "wooldridge"}, "path": "marklogic-data-hub-central/ui/src/App.tsx", "diffHunk": "@@ -53,9 +63,8 @@ const App: React.FC<Props> = ({history, location}) => {\n     } else {\n       if (user.error.type !== '') {\n         history.push('/error');\n-      } else if (location.pathname !== '/' && location.pathname !== '/noresponse') {\n-        user.pageRoute = location.pathname;\n       }\n+      user.pageRoute = getPageRoute(location);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxNTg1OA=="}, "originalCommit": {"oid": "5899c981dac988aba90cd95521388b57047124a3"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI1MzkwNw==", "bodyText": "@bsrikan I addressed this error by redirecting to Explore when there is no URI accessible for the Detail view.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r485253907", "createdAt": "2020-09-08T23:41:56Z", "author": {"login": "wooldridge"}, "path": "marklogic-data-hub-central/ui/src/App.tsx", "diffHunk": "@@ -53,9 +63,8 @@ const App: React.FC<Props> = ({history, location}) => {\n     } else {\n       if (user.error.type !== '') {\n         history.push('/error');\n-      } else if (location.pathname !== '/' && location.pathname !== '/noresponse') {\n-        user.pageRoute = location.pathname;\n       }\n+      user.pageRoute = getPageRoute(location);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxNTg1OA=="}, "originalCommit": {"oid": "5899c981dac988aba90cd95521388b57047124a3"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyMzg1Mg==", "bodyText": "Thanks @wooldridge . Fixed login e2e test to reflect the change.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r485923852", "createdAt": "2020-09-09T21:10:26Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/App.tsx", "diffHunk": "@@ -53,9 +63,8 @@ const App: React.FC<Props> = ({history, location}) => {\n     } else {\n       if (user.error.type !== '') {\n         history.push('/error');\n-      } else if (location.pathname !== '/' && location.pathname !== '/noresponse') {\n-        user.pageRoute = location.pathname;\n       }\n+      user.pageRoute = getPageRoute(location);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxNTg1OA=="}, "originalCommit": {"oid": "5899c981dac988aba90cd95521388b57047124a3"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzMDcxMjUzOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/pages/noMatchRedirect.tsx", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QyMjoxNTo0NFrOHOIMpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNjo0MzowNVrOHPQrLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU3NjQyMg==", "bodyText": "Fixed this redirect on 404 to /tiles from /home for \"Back Home\" button", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r484576422", "createdAt": "2020-09-07T22:15:44Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/pages/noMatchRedirect.tsx", "diffHunk": "@@ -14,16 +14,16 @@ const NoMatchRedirect = ({history}) => {\n   }, []);\n \n   const backToHomePage = () => {\n-    return user.authenticated ? history.push('/home') : history.push('/');\n+    return user.authenticated ? history.push('/tiles') : history.push('/');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c513445113b7487884e5d5a1078653c220482084"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTc2Mzg4Ng==", "bodyText": "Thanks for fixing this.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r485763886", "createdAt": "2020-09-09T16:43:05Z", "author": {"login": "wooldridge"}, "path": "marklogic-data-hub-central/ui/src/pages/noMatchRedirect.tsx", "diffHunk": "@@ -14,16 +14,16 @@ const NoMatchRedirect = ({history}) => {\n   }, []);\n \n   const backToHomePage = () => {\n-    return user.authenticated ? history.push('/home') : history.push('/');\n+    return user.authenticated ? history.push('/tiles') : history.push('/');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU3NjQyMg=="}, "originalCommit": {"oid": "c513445113b7487884e5d5a1078653c220482084"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzOTM5ODgzOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/assets/mock-data/user-context-mock.ts", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTowOToxOFrOHPaZ9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTowOToxOFrOHPaZ9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkyMzMxOQ==", "bodyText": "@ryanjdew @brucean52 @wooldridge I made this change to mock user context, since an authenticated user will have /tiles as landing page route.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4529#discussion_r485923319", "createdAt": "2020-09-09T21:09:18Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/assets/mock-data/user-context-mock.ts", "diffHunk": "@@ -34,7 +34,7 @@ export const userAuthenticated: IUserContextInterface = Object.assign(defaultUse\n     error : {\n       type: ''\n     },\n-    pageRoute: '/',\n+    pageRoute: '/tiles',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1096b27c398a43533dfa7ff95003f7ee19edfa"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3755, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}