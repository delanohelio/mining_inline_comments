{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4NDUwNDM2", "number": 3789, "title": "DHFPROD-3649: View list of personal queries previously saved", "bodyText": "Description\n\n\nRefactoring explorer search features as entity search\n\n\nView list of personal queries previously saved\n\n\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-04-04T01:56:53Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3789", "merged": true, "mergeCommit": {"oid": "d8c26f2b09f62dee4bf2f598d3fb9b4e87ec07e2"}, "closed": true, "closedAt": "2020-04-07T19:26:29Z", "author": {"login": "rahulvudutala"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUbPj2ABqjMyMDA0Nzg4ODI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVX0e5AFqTM4OTM5Mjc3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "739c2a63678c4e401bae2e5b79a1e3344acd1558", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/739c2a63678c4e401bae2e5b79a1e3344acd1558", "committedDate": "2020-04-04T00:56:09Z", "message": "DHFPROD-3649: View list of personal queries previously saved"}, "afterCommit": {"oid": "e3b36d1a6ae981103788a82d1296ffb4c0ba3581", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e3b36d1a6ae981103788a82d1296ffb4c0ba3581", "committedDate": "2020-04-04T18:47:28Z", "message": "DHFPROD-3649: View list of personal queries previously saved"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODE1Mzk4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3789#pullrequestreview-387815398", "createdAt": "2020-04-05T12:47:54Z", "commit": {"oid": "e3b36d1a6ae981103788a82d1296ffb4c0ba3581"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMjo0Nzo1NFrOGA_uvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMjo0OToyMFrOGA_vgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY5NzM0MA==", "bodyText": "I don't think these annotations are needed - they seem redundant with what the method is already doing, which is building a request-based EntitySearchManager with a session-based hubConfig.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3789#discussion_r403697340", "createdAt": "2020-04-05T12:47:54Z", "author": {"login": "rjrudin"}, "path": "one-ui/src/main/java/com/marklogic/hub/oneui/controllers/EntitySearchController.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.oneui.controllers;\n+\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.marklogic.hub.dataservices.EntitySearchService;\n+import com.marklogic.hub.oneui.managers.EntitySearchManager;\n+import com.marklogic.hub.oneui.models.Document;\n+import com.marklogic.hub.oneui.models.HubConfigSession;\n+import com.marklogic.hub.oneui.models.SearchQuery;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.context.annotation.ScopedProxyMode;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestMethod;\n+import org.springframework.web.bind.annotation.RequestParam;\n+import org.springframework.web.bind.annotation.ResponseBody;\n+\n+import java.util.Optional;\n+\n+\n+@Controller\n+@RequestMapping(value = \"/api/entitySearch\")\n+public class EntitySearchController {\n+\n+    @Autowired\n+    private HubConfigSession hubConfig;\n+\n+    @Autowired\n+    private EntitySearchManager entitySearchManager;\n+\n+    @Bean\n+    @Scope(proxyMode = ScopedProxyMode.TARGET_CLASS, value = \"request\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3b36d1a6ae981103788a82d1296ffb4c0ba3581"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY5NzM3OQ==", "bodyText": "Shouldn't need this, since you have the method below this to construct an EntitySearchManager.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3789#discussion_r403697379", "createdAt": "2020-04-05T12:48:24Z", "author": {"login": "rjrudin"}, "path": "one-ui/src/main/java/com/marklogic/hub/oneui/controllers/EntitySearchController.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*\n+ * Copyright 2012-2020 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.oneui.controllers;\n+\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.marklogic.hub.dataservices.EntitySearchService;\n+import com.marklogic.hub.oneui.managers.EntitySearchManager;\n+import com.marklogic.hub.oneui.models.Document;\n+import com.marklogic.hub.oneui.models.HubConfigSession;\n+import com.marklogic.hub.oneui.models.SearchQuery;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.context.annotation.ScopedProxyMode;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.RequestBody;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestMethod;\n+import org.springframework.web.bind.annotation.RequestParam;\n+import org.springframework.web.bind.annotation.ResponseBody;\n+\n+import java.util.Optional;\n+\n+\n+@Controller\n+@RequestMapping(value = \"/api/entitySearch\")\n+public class EntitySearchController {\n+\n+    @Autowired\n+    private HubConfigSession hubConfig;\n+\n+    @Autowired\n+    private EntitySearchManager entitySearchManager;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3b36d1a6ae981103788a82d1296ffb4c0ba3581"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY5NzUzNg==", "bodyText": "If you need a method that returns an ArrayNode, let's not modify this - just add a \"readJsonArray\" method.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3789#discussion_r403697536", "createdAt": "2020-04-05T12:49:20Z", "author": {"login": "rjrudin"}, "path": "one-ui/src/test/java/com/marklogic/hub/oneui/AbstractOneUiTest.java", "diffHunk": "@@ -124,6 +124,11 @@ protected File getFileFromClasspath(String resourceName) {\n \n     protected ObjectNode readJsonObject(String json) {\n         try {\n+            if(objectMapper.readTree(json).isArray()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3b36d1a6ae981103788a82d1296ffb4c0ba3581"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3b36d1a6ae981103788a82d1296ffb4c0ba3581", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e3b36d1a6ae981103788a82d1296ffb4c0ba3581", "committedDate": "2020-04-04T18:47:28Z", "message": "DHFPROD-3649: View list of personal queries previously saved"}, "afterCommit": {"oid": "937b4dedd867c9a320313125fd5287995bfd2700", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/937b4dedd867c9a320313125fd5287995bfd2700", "committedDate": "2020-04-05T23:37:12Z", "message": "DHFPROD-3649: View list of personal queries previously saved"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NDA2MTgy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3789#pullrequestreview-388406182", "createdAt": "2020-04-06T16:13:54Z", "commit": {"oid": "937b4dedd867c9a320313125fd5287995bfd2700"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNjoxMzo1NFrOGBfYPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNjoxMzo1NFrOGBfYPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIxNTg2OQ==", "bodyText": "Can we handle possible NPE's?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3789#discussion_r404215869", "createdAt": "2020-04-06T16:13:54Z", "author": {"login": "akshaysonvane"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/data-services/entitySearch/getMatchingPropertyValues.sjs", "diffHunk": "@@ -1,13 +1,25 @@\n const lib = require('/data-hub/5/impl/hub-es.sjs');\n \n-var entityTypeId;\n-var propertyPath;\n-var referenceType;\n-var pattern;\n-var limit;\n+var facetValuesSearchQuery;\n \n+let queryObj = JSON.parse(facetValuesSearchQuery);\n+let entityTypeId = queryObj.facetInfo.entityTypeId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "937b4dedd867c9a320313125fd5287995bfd2700"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a44c2c6d4e16c1e0dff28a975b842726b3016c8", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6a44c2c6d4e16c1e0dff28a975b842726b3016c8", "committedDate": "2020-04-06T19:20:16Z", "message": "DHFPROD-3649: Refactoring explorer search features as entity search\n\nDHFPROD-3649: facet values endpoint changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2ab02eac254537ac9e1ad8fb7fe5f7dc7ed69f9", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/a2ab02eac254537ac9e1ad8fb7fe5f7dc7ed69f9", "committedDate": "2020-04-06T19:20:26Z", "message": "DHFPROD-3649: Refactoring search endpoints to entitySearch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "937b4dedd867c9a320313125fd5287995bfd2700", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/937b4dedd867c9a320313125fd5287995bfd2700", "committedDate": "2020-04-05T23:37:12Z", "message": "DHFPROD-3649: View list of personal queries previously saved"}, "afterCommit": {"oid": "4ad04507802f86340bff072b594f6119edec2342", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/4ad04507802f86340bff072b594f6119edec2342", "committedDate": "2020-04-06T19:20:37Z", "message": "DHFPROD-3649: View list of personal queries previously saved"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NzA0NDQ3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3789#pullrequestreview-388704447", "createdAt": "2020-04-07T00:17:38Z", "commit": {"oid": "4ad04507802f86340bff072b594f6119edec2342"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMDoxNzozOFrOGBuhkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMDoxNzozOFrOGBuhkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ2NDAxNw==", "bodyText": "It seems you expect an ArrayNode back, right? So just make this \"readJsonArray\" and have it return an ArrayNode.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3789#discussion_r404464017", "createdAt": "2020-04-07T00:17:38Z", "author": {"login": "rjrudin"}, "path": "one-ui/src/test/java/com/marklogic/hub/oneui/AbstractOneUiTest.java", "diffHunk": "@@ -130,6 +130,16 @@ protected ObjectNode readJsonObject(String json) {\n         }\n     }\n \n+    protected ObjectNode readJsonArrayObject(String json) {\n+        try {\n+            ObjectNode objectNode = objectMapper.createObjectNode();\n+            objectNode.putArray(\"arrayKey\").add(objectMapper.readTree(json));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ad04507802f86340bff072b594f6119edec2342"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "249b56c5657d33fcf9eeaff9fbfad39a8c2c3273", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/249b56c5657d33fcf9eeaff9fbfad39a8c2c3273", "committedDate": "2020-04-07T01:18:35Z", "message": "DHFPROD-3649: View list of personal queries previously saved"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ad04507802f86340bff072b594f6119edec2342", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/4ad04507802f86340bff072b594f6119edec2342", "committedDate": "2020-04-06T19:20:37Z", "message": "DHFPROD-3649: View list of personal queries previously saved"}, "afterCommit": {"oid": "249b56c5657d33fcf9eeaff9fbfad39a8c2c3273", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/249b56c5657d33fcf9eeaff9fbfad39a8c2c3273", "committedDate": "2020-04-07T01:18:35Z", "message": "DHFPROD-3649: View list of personal queries previously saved"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MzE2NjYx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3789#pullrequestreview-389316661", "createdAt": "2020-04-07T17:02:20Z", "commit": {"oid": "249b56c5657d33fcf9eeaff9fbfad39a8c2c3273"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MzkyNzcx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3789#pullrequestreview-389392771", "createdAt": "2020-04-07T18:43:38Z", "commit": {"oid": "249b56c5657d33fcf9eeaff9fbfad39a8c2c3273"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2994, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}