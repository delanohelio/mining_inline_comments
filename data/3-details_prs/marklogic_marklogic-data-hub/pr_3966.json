{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NjkzMjY4", "number": 3966, "title": "DHFPROD-4225: Check and confirm before starting the export", "bodyText": "Description\nIncludes : https://project.marklogic.com/jira/browse/DHFPROD-4718\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-05-18T19:18:40Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966", "merged": true, "mergeCommit": {"oid": "a6f74f8d1e20fe6b74e9129487278b34256451b7"}, "closed": true, "closedAt": "2020-05-19T18:04:43Z", "author": {"login": "timur-isangulov"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcil4FLgBqjMzNDg5OTU0NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci3FYlAFqTQxNDYyMjEzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14a44f957b002687216def3f5a81223fa4a467ce", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/14a44f957b002687216def3f5a81223fa4a467ce", "committedDate": "2020-05-18T19:03:25Z", "message": "DHFPROD-4225: Check and confirm before starting the export"}, "afterCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/791540fa11badd6eac5689174afefa95c967bc62", "committedDate": "2020-05-18T20:26:32Z", "message": "DHFPROD-4225: Check and confirm before starting the export"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTQwNDE3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#pullrequestreview-413940417", "createdAt": "2020-05-18T21:08:44Z", "commit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "state": "DISMISSED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMTowODo0NFrOGXHj4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMToxNzo1N1rOGXHz8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NDMwNg==", "bodyText": "data-conversion file is meant to be a file where payloads are parsed. If you have JSX or React code, it's better to keep it within the component for maintaining, testing and debugging", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426894306", "createdAt": "2020-05-18T21:08:44Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/util/data-conversion.tsx", "diffHunk": "@@ -1,4 +1,8 @@\n import { xmlParser } from './../util/xml-parser';\n+import { Tooltip } from 'antd';\n+import React, { useState, useContext } from 'react';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NjM2Nw==", "bodyText": "I don't think you need this useEffect. Call getPreview() in displayExportModal() function", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426896367", "createdAt": "2020-05-18T21:13:13Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/queries/managing/manage-query-modal/manage-query.tsx", "diffHunk": "@@ -32,6 +35,10 @@ const QueryModal = (props) => {\n         getQueries();\n     }, [mainModalVisibility, editModalVisibility, deleteModalVisibility]);\n \n+    useEffect(() => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5Njk3Mg==", "bodyText": "this is inefficient because you are calling getQueries() anytime these 3 booleans change. If I click \"cancel\" on delete or edit, or main modals, it will do a network request.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426896972", "createdAt": "2020-05-18T21:14:40Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/queries/managing/manage-query-modal/manage-query.tsx", "diffHunk": "@@ -32,6 +35,10 @@ const QueryModal = (props) => {\n         getQueries();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5ODQxOQ==", "bodyText": "no reason to create the exportConfirmation variable. just return the JSX.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426898419", "createdAt": "2020-05-18T21:17:57Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/query-export/query-export-modal/query-export-modal.tsx", "diffHunk": "@@ -120,6 +127,15 @@ const QueryExportModal = (props) => {\n             </div>\n             }\n         </Form>\n+\n+        {props.hasStructured && <div>\n+            <Collapse bordered={false} className={styles.collapseCustomPanel} style={{ border: '0px', color: 'blue' }}>\n+                <Panel id='export-panel' header=\"Show Preview\" key=\"1\" style={{ border: '0px', color: 'blue' }}>\n+                    <Table data-testid='export-preview-table'className={styles.exportTable} dataSource={props.tableData} columns={props.tableColumns} pagination={false} size='small' scroll={{ x: 500 }} bordered />\n+                </Panel>\n+            </Collapse>\n+        </div>}\n+\n     </Modal>\n \n     return (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTQyOTY2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#pullrequestreview-413942966", "createdAt": "2020-05-18T21:13:10Z", "commit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMToxMzoxMFrOGXHr0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMToxMzoxMFrOGXHr0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg5NjMzOA==", "bodyText": "@timur-isangulov any reason for checking status less than 300 ?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#discussion_r426896338", "createdAt": "2020-05-18T21:13:10Z", "author": {"login": "Sanjeevani19"}, "path": "marklogic-data-hub-central/ui/src/api/queries.tsx", "diffHunk": "@@ -60,6 +60,61 @@ export const exportQuery = (query, limit) => {\n   mapForm.reset();\n }\n \n+export const getExportQueryPreview = async (query) => {\n+  let queryString = JSON.stringify(query)\n+  const mapForm = document.createElement(\"form\");\n+  mapForm.id = \"exportForm\";\n+  const mapInput = document.createElement(\"input\");\n+  mapInput.type = \"hidden\";\n+  mapInput.name = \"fileType\";\n+  mapInput.value = \"csv\";\n+  const mapInput2 = document.createElement(\"input\");\n+  mapInput2.type = \"hidden\";\n+  mapInput2.name = \"limit\";\n+  mapInput2.value = '2';\n+  const mapInput3 = document.createElement(\"input\");\n+  mapInput3.type = \"hidden\";\n+  mapInput3.name = \"queryDocument\";\n+  mapInput3.value = queryString;\n+  mapForm.appendChild(mapInput);\n+  mapForm.appendChild(mapInput2);\n+  mapForm.appendChild(mapInput3);\n+  document.body.appendChild(mapForm);\n+\n+  return new Promise(function (resolve, reject) {\n+    let xhr = new XMLHttpRequest();\n+    xhr.open(\"POST\", \"/api/entitySearch/export\");\n+    xhr.onload = function () {\n+        if (this.status >= 200 && this.status < 300) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62"}, "originalPosition": 77}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "791540fa11badd6eac5689174afefa95c967bc62", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/791540fa11badd6eac5689174afefa95c967bc62", "committedDate": "2020-05-18T20:26:32Z", "message": "DHFPROD-4225: Check and confirm before starting the export"}, "afterCommit": {"oid": "3031cdc8ce161d4b75df8dd2782848894ad23fb3", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/3031cdc8ce161d4b75df8dd2782848894ad23fb3", "committedDate": "2020-05-18T22:09:59Z", "message": "DHFPROD-4225: Check and confirm before starting the export"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTg1NjI1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#pullrequestreview-413985625", "createdAt": "2020-05-18T22:42:07Z", "commit": {"oid": "3031cdc8ce161d4b75df8dd2782848894ad23fb3"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTkwNDE0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#pullrequestreview-413990414", "createdAt": "2020-05-18T22:54:05Z", "commit": {"oid": "3031cdc8ce161d4b75df8dd2782848894ad23fb3"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f9dabbdf1b7aca8b4a581ec7754686132dfa17c", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/2f9dabbdf1b7aca8b4a581ec7754686132dfa17c", "committedDate": "2020-05-19T16:26:19Z", "message": "DHFPROD-4225: Check and confirm before starting the export"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3031cdc8ce161d4b75df8dd2782848894ad23fb3", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/3031cdc8ce161d4b75df8dd2782848894ad23fb3", "committedDate": "2020-05-18T22:09:59Z", "message": "DHFPROD-4225: Check and confirm before starting the export"}, "afterCommit": {"oid": "2f9dabbdf1b7aca8b4a581ec7754686132dfa17c", "author": {"user": null}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/2f9dabbdf1b7aca8b4a581ec7754686132dfa17c", "committedDate": "2020-05-19T16:26:19Z", "message": "DHFPROD-4225: Check and confirm before starting the export"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjIwODg5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#pullrequestreview-414620889", "createdAt": "2020-05-19T16:28:39Z", "commit": {"oid": "2f9dabbdf1b7aca8b4a581ec7754686132dfa17c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjIyMTMy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3966#pullrequestreview-414622132", "createdAt": "2020-05-19T16:30:10Z", "commit": {"oid": "2f9dabbdf1b7aca8b4a581ec7754686132dfa17c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2925, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}