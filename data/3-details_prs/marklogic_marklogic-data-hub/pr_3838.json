{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NzM3NTc3", "number": 3838, "title": "DHFPROD-4720: Core project now publishes a test fixture for reusability", "bodyText": "Intent is to remove duplication of test plumbing between core and central. Summary of changes:\n\n\nAdded new AbstractHubTest as a base class for HubTestBase and AbstractHubCentralTest. It has logic for resetting the project before a test runs, and for load project files. This is accomplished via the new \"testFixturesApi\" - \"java-test-fixture\" is a new feature in Gradle 5.6 for this exact use case, where test fixtures in core can be reused in the other DH projects.\n\n\nLoadHubArtifactsCommand no longer has a \"force\" property to it; artifacts are always loaded. Modified it to ensure it never loads two documents with the same URI at the same time, which happens in some scenarios in our tests.\n\n\nModified LoadHubModuledCommand to default to a batch size of 10. In some scenarios when bootstrapping the test app, the config.sjs/config.xqy modules are being loaded twice, which causes a conflicting updates error. This prevents that.\n\n\nThe Installer program always install the test application. I changed this primarily for local convenience, as I often need to install the test app after e.g. adding a role, and the fact that the test app Installer doesn't run if it thinks DH is already installed is not helpful.\n\n\nReplaced temporal-document-write.sjs with WriteDocumentsTest.\n\n\nMoved jaeger-config dependency from core into QuickStart, as it's only used there.\n\n\nRemoved spring-integration dependency from core; it's not needed anywhere.\n8ed615\n\n\nDescription\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-04-19T21:28:58Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3838", "merged": true, "mergeCommit": {"oid": "3bb9174570c63231d2c325a42976e87198d23b82"}, "closed": true, "closedAt": "2020-04-20T17:05:47Z", "author": {"login": "rjrudin"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZUipYABqjMyNDk3MTU5NzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZiMfKAFqTM5NjY0NTY2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7989b9c3f2a53fa8f49eefb6e9e991c795c70eb", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c7989b9c3f2a53fa8f49eefb6e9e991c795c70eb", "committedDate": "2020-04-19T21:29:01Z", "message": "DHFPROD-4720: Core project now publishes a test fixture for reusability\n\nIntent is to remove duplication of test plumbing between core and central. Summary of changes:\n\n- Added new AbstractHubTest as a base class for HubTestBase and AbstractHubCentralTest. It has logic for resetting the project before a test runs, and for load project files. This is accomplished via the new \"testFixturesApi\" - \"java-test-fixture\" is a new feature in Gradle 5.6 for this exact use case, where test fixtures in core can be reused in the other DH projects. \n\n- LoadHubArtifactsCommand no longer has a \"force\" property to it; artifacts are always loaded. Modified it to ensure it never loads two documents with the same URI at the same time, which happens in some scenarios in our tests. \n\n- Modified LoadHubModuledCommand to default to a batch size of 10. In some scenarios when bootstrapping the test app, the config.sjs/config.xqy modules are being loaded twice, which causes a conflicting updates error. This prevents that. \n\n- The Installer program always install the test application. I changed this primarily for local convenience, as I often need to install the test app after e.g. adding a role, and the fact that the test app Installer doesn't run if it thinks DH is already installed is not helpful. \n\n- Replaced temporal-document-write.sjs with WriteDocumentsTest. \n\n- Moved jaeger-config dependency from core into QuickStart, as it's only used there. \n\n- Removed spring-integration dependency from core; it's not needed anywhere. \n8ed615"}, "afterCommit": {"oid": "afb556cc1f81262711905154f5f76739f69f7869", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/afb556cc1f81262711905154f5f76739f69f7869", "committedDate": "2020-04-20T01:10:24Z", "message": "DHFPROD-4720: Core project now publishes a test fixture for reusability\n\nIntent is to remove duplication of test plumbing between core and central. Summary of changes:\n\n- Added new AbstractHubTest as a base class for HubTestBase and AbstractHubCentralTest. It has logic for resetting the project before a test runs, and for load project files. This is accomplished via the new \"testFixturesApi\" - \"java-test-fixture\" is a new feature in Gradle 5.6 for this exact use case, where test fixtures in core can be reused in the other DH projects. \n\n- LoadHubArtifactsCommand no longer has a \"force\" property to it; artifacts are always loaded. Modified it to ensure it never loads two documents with the same URI at the same time, which happens in some scenarios in our tests. \n\n- Modified LoadHubModuledCommand to default to a batch size of 10. In some scenarios when bootstrapping the test app, the config.sjs/config.xqy modules are being loaded twice, which causes a conflicting updates error. This prevents that. \n\n- The Installer program always install the test application. I changed this primarily for local convenience, as I often need to install the test app after e.g. adding a role, and the fact that the test app Installer doesn't run if it thinks DH is already installed is not helpful. \n\n- Replaced temporal-document-write.sjs with WriteDocumentsTest. \n\n- Moved jaeger-config dependency from core into QuickStart, as it's only used there. \n\n- Removed spring-integration dependency from core; it's not needed anywhere."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "afb556cc1f81262711905154f5f76739f69f7869", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/afb556cc1f81262711905154f5f76739f69f7869", "committedDate": "2020-04-20T01:10:24Z", "message": "DHFPROD-4720: Core project now publishes a test fixture for reusability\n\nIntent is to remove duplication of test plumbing between core and central. Summary of changes:\n\n- Added new AbstractHubTest as a base class for HubTestBase and AbstractHubCentralTest. It has logic for resetting the project before a test runs, and for load project files. This is accomplished via the new \"testFixturesApi\" - \"java-test-fixture\" is a new feature in Gradle 5.6 for this exact use case, where test fixtures in core can be reused in the other DH projects. \n\n- LoadHubArtifactsCommand no longer has a \"force\" property to it; artifacts are always loaded. Modified it to ensure it never loads two documents with the same URI at the same time, which happens in some scenarios in our tests. \n\n- Modified LoadHubModuledCommand to default to a batch size of 10. In some scenarios when bootstrapping the test app, the config.sjs/config.xqy modules are being loaded twice, which causes a conflicting updates error. This prevents that. \n\n- The Installer program always install the test application. I changed this primarily for local convenience, as I often need to install the test app after e.g. adding a role, and the fact that the test app Installer doesn't run if it thinks DH is already installed is not helpful. \n\n- Replaced temporal-document-write.sjs with WriteDocumentsTest. \n\n- Moved jaeger-config dependency from core into QuickStart, as it's only used there. \n\n- Removed spring-integration dependency from core; it's not needed anywhere."}, "afterCommit": {"oid": "dae01734c747230e385258c1d38b1e61a2bf0e6e", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/dae01734c747230e385258c1d38b1e61a2bf0e6e", "committedDate": "2020-04-20T12:35:55Z", "message": "DHFPROD-4720: Core project now publishes a test fixture for reusability\n\nIntent is to remove duplication of test plumbing between core and central. Summary of changes:\n\n- Added new AbstractHubTest as a base class for HubTestBase and AbstractHubCentralTest. It has logic for resetting the project before a test runs, and for load project files. This is accomplished via the new \"testFixturesApi\" - \"java-test-fixture\" is a new feature in Gradle 5.6 for this exact use case, where test fixtures in core can be reused in the other DH projects. \n\n- LoadHubArtifactsCommand no longer has a \"force\" property to it; artifacts are always loaded. Modified it to ensure it never loads two documents with the same URI at the same time, which happens in some scenarios in our tests. \n\n- Modified LoadHubModuledCommand to default to a batch size of 10. In some scenarios when bootstrapping the test app, the config.sjs/config.xqy modules are being loaded twice, which causes a conflicting updates error. This prevents that. \n\n- The Installer program always install the test application. I changed this primarily for local convenience, as I often need to install the test app after e.g. adding a role, and the fact that the test app Installer doesn't run if it thinks DH is already installed is not helpful. \n\n- Replaced temporal-document-write.sjs with WriteDocumentsTest. \n\n- Moved jaeger-config dependency from core into QuickStart, as it's only used there. \n\n- Removed spring-integration dependency from core; it's not needed anywhere."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dae01734c747230e385258c1d38b1e61a2bf0e6e", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/dae01734c747230e385258c1d38b1e61a2bf0e6e", "committedDate": "2020-04-20T12:35:55Z", "message": "DHFPROD-4720: Core project now publishes a test fixture for reusability\n\nIntent is to remove duplication of test plumbing between core and central. Summary of changes:\n\n- Added new AbstractHubTest as a base class for HubTestBase and AbstractHubCentralTest. It has logic for resetting the project before a test runs, and for load project files. This is accomplished via the new \"testFixturesApi\" - \"java-test-fixture\" is a new feature in Gradle 5.6 for this exact use case, where test fixtures in core can be reused in the other DH projects. \n\n- LoadHubArtifactsCommand no longer has a \"force\" property to it; artifacts are always loaded. Modified it to ensure it never loads two documents with the same URI at the same time, which happens in some scenarios in our tests. \n\n- Modified LoadHubModuledCommand to default to a batch size of 10. In some scenarios when bootstrapping the test app, the config.sjs/config.xqy modules are being loaded twice, which causes a conflicting updates error. This prevents that. \n\n- The Installer program always install the test application. I changed this primarily for local convenience, as I often need to install the test app after e.g. adding a role, and the fact that the test app Installer doesn't run if it thinks DH is already installed is not helpful. \n\n- Replaced temporal-document-write.sjs with WriteDocumentsTest. \n\n- Moved jaeger-config dependency from core into QuickStart, as it's only used there. \n\n- Removed spring-integration dependency from core; it's not needed anywhere."}, "afterCommit": {"oid": "6c00ebad27672a64f78a47e1ee8b53a05404eb54", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6c00ebad27672a64f78a47e1ee8b53a05404eb54", "committedDate": "2020-04-20T14:21:30Z", "message": "DHFPROD-4720: Core project now publishes a test fixture for reusability\n\nIntent is to remove duplication of test plumbing between core and central. Summary of changes:\n\n- Added new AbstractHubTest as a base class for HubTestBase and AbstractHubCentralTest. It has logic for resetting the project before a test runs, and for load project files. This is accomplished via the new \"testFixturesApi\" - \"java-test-fixture\" is a new feature in Gradle 5.6 for this exact use case, where test fixtures in core can be reused in the other DH projects. \n\n- LoadHubArtifactsCommand no longer has a \"force\" property to it; artifacts are always loaded. Modified it to ensure it never loads two documents with the same URI at the same time, which happens in some scenarios in our tests. \n\n- Modified LoadHubModuledCommand to default to a batch size of 10. In some scenarios when bootstrapping the test app, the config.sjs/config.xqy modules are being loaded twice, which causes a conflicting updates error. This prevents that. \n\n- The Installer program always install the test application. I changed this primarily for local convenience, as I often need to install the test app after e.g. adding a role, and the fact that the test app Installer doesn't run if it thinks DH is already installed is not helpful. \n\n- Replaced temporal-document-write.sjs with WriteDocumentsTest. \n\n- Moved jaeger-config dependency from core into QuickStart, as it's only used there. \n\n- Removed spring-integration dependency from core; it's not needed anywhere. \n\n- Removed calls to installHubModules except where hub modules had clearly been modified. No test should have to worry about hub modules being properly installed; if a test modifies hub modules, it's up to that test to undo its changes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c00ebad27672a64f78a47e1ee8b53a05404eb54", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6c00ebad27672a64f78a47e1ee8b53a05404eb54", "committedDate": "2020-04-20T14:21:30Z", "message": "DHFPROD-4720: Core project now publishes a test fixture for reusability\n\nIntent is to remove duplication of test plumbing between core and central. Summary of changes:\n\n- Added new AbstractHubTest as a base class for HubTestBase and AbstractHubCentralTest. It has logic for resetting the project before a test runs, and for load project files. This is accomplished via the new \"testFixturesApi\" - \"java-test-fixture\" is a new feature in Gradle 5.6 for this exact use case, where test fixtures in core can be reused in the other DH projects. \n\n- LoadHubArtifactsCommand no longer has a \"force\" property to it; artifacts are always loaded. Modified it to ensure it never loads two documents with the same URI at the same time, which happens in some scenarios in our tests. \n\n- Modified LoadHubModuledCommand to default to a batch size of 10. In some scenarios when bootstrapping the test app, the config.sjs/config.xqy modules are being loaded twice, which causes a conflicting updates error. This prevents that. \n\n- The Installer program always install the test application. I changed this primarily for local convenience, as I often need to install the test app after e.g. adding a role, and the fact that the test app Installer doesn't run if it thinks DH is already installed is not helpful. \n\n- Replaced temporal-document-write.sjs with WriteDocumentsTest. \n\n- Moved jaeger-config dependency from core into QuickStart, as it's only used there. \n\n- Removed spring-integration dependency from core; it's not needed anywhere. \n\n- Removed calls to installHubModules except where hub modules had clearly been modified. No test should have to worry about hub modules being properly installed; if a test modifies hub modules, it's up to that test to undo its changes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NjI5NDcw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3838#pullrequestreview-396629470", "createdAt": "2020-04-20T16:43:28Z", "commit": {"oid": "6c00ebad27672a64f78a47e1ee8b53a05404eb54"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NjQzMjI1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3838#pullrequestreview-396643225", "createdAt": "2020-04-20T17:01:25Z", "commit": {"oid": "6c00ebad27672a64f78a47e1ee8b53a05404eb54"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNzowMToyNVrOGIefrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNzowMToyNVrOGIefrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU0MTQyMw==", "bodyText": "Not required now but we should remove the count from the message.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3838#discussion_r411541423", "createdAt": "2020-04-20T17:01:25Z", "author": {"login": "akshaysonvane"}, "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/deploy/commands/BuildAssetFileLoaderTest.java", "diffHunk": "@@ -19,12 +19,10 @@ public void withCustomBatchSize() {\n         CommandContext context = new CommandContext(appConfig, null, null);\n \n         TestAssetFileLoader loader = new TestAssetFileLoader(null);\n-        command.prepareAssetFileLoader(loader, context);\n-        assertNull(loader.batchSize, \"The batch size should still be null because it is null on the AppConfig object\");\n \n-        appConfig.setModulesLoaderBatchSize(10);\n+        appConfig.setModulesLoaderBatchSize(7);\n         command.prepareAssetFileLoader(loader, context);\n-        assertEquals(10, (int) loader.batchSize, \"The batch size should now be 10; this gives the user a way to load hub \" +\n+        assertEquals(7, (int) loader.batchSize, \"The batch size should now be 10; this gives the user a way to load hub \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c00ebad27672a64f78a47e1ee8b53a05404eb54"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NjQ1NjY5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3838#pullrequestreview-396645669", "createdAt": "2020-04-20T17:04:36Z", "commit": {"oid": "6c00ebad27672a64f78a47e1ee8b53a05404eb54"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3052, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}