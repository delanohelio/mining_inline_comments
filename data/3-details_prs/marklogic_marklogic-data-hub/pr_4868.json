{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxOTY0MTk0", "number": 4868, "title": "DHFPROD-6218:Throw 404 or 400 instead of 500 when backend operation cannot find something", "bodyText": "Description\nThrow 404 or 400 instead of 500 when backend operation cannot find something. Not sure if it requires any new tests. The existing tests should run fine.\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n[ n/a] Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-11-16T21:19:18Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868", "merged": true, "mergeCommit": {"oid": "20d5b3f11ec5caf0b274cb9091a930d6909c82d1"}, "closed": true, "closedAt": "2020-11-18T17:35:32Z", "author": {"login": "srinathgit"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddNbFHgFqTUzMTkwMDI3Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddw-rygFqTUzMzY0NDk4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTAwMjcz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#pullrequestreview-531900273", "createdAt": "2020-11-16T23:16:01Z", "commit": {"oid": "5246e8319604604921b8bdf5759c02d88eeb50e3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoxNjowMVrOH0bDUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMzoxOToxNFrOH0bYmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczMTIxOA==", "bodyText": "Let's convert this to use ds-util.sjs too. That library of course is a little mis-named now - we may want to rename it to \"http-util.sjs\", since the functions are generic to HTTP. But the more error handling that's routed through those functions, the better, as it makes it easier for us to track where we're throwing errors. And of course, it reduces duplication of the usage of RESTAPI-SRVEXERR.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r524731218", "createdAt": "2020-11-16T23:16:01Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/4/transforms/mlcp-flow-transform.sjs", "diffHunk": "@@ -49,7 +49,7 @@ function transform(content, context) {\n   let flow = flowlib.getFlow(entityName, flowName, consts.INPUT_FLOW);\n \n   if (!flow) {\n-    fn.error(null, \"RESTAPI-SRVEXERR\", \"The specified flow \" + params.flow + \" is missing.\");\n+    fn.error(null, \"RESTAPI-SRVEXERR\", Sequence.from([404, \"Not Found\", \"The specified flow \" + params.flow + \" is missing.\"]));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5246e8319604604921b8bdf5759c02d88eeb50e3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDczNjY2NQ==", "bodyText": "For these, let's add throwNotFoundWithArray(args) and throwBadRequestWithArray(args) so that when a client wants to return multiple things, it's easy to do so.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r524736665", "createdAt": "2020-11-16T23:19:14Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/transforms/mlcp-flow-transform.sjs", "diffHunk": "@@ -62,7 +62,7 @@ function transform(content, context = {}) {\n \n     if (!flow) {\n       datahub.debug.log({message: params, type: 'error'});\n-      fn.error(null, \"RESTAPI-SRVEXERR\", Sequence.from([\"DH-FLOWMISSING\", \"The specified flow \" + flowName + \" is missing.\", content.uri]));\n+      fn.error(null, \"RESTAPI-SRVEXERR\", Sequence.from([404, \"DH-FLOWMISSING\", \"The specified flow \" + flowName + \" is missing.\", content.uri]));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5246e8319604604921b8bdf5759c02d88eeb50e3"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5246e8319604604921b8bdf5759c02d88eeb50e3", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/5246e8319604604921b8bdf5759c02d88eeb50e3", "committedDate": "2020-11-16T21:17:05Z", "message": "DHFPROD-6218:Throw 404 or 400 instead of 500 when backend operation cannot find something"}, "afterCommit": {"oid": "f74ea547eac25878a862785dcac03462d6df9e3f", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/f74ea547eac25878a862785dcac03462d6df9e3f", "committedDate": "2020-11-17T04:41:03Z", "message": "DHFPROD-6218:Throw 404 or 400 instead of 500 when backend operation cannot find something"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMDE4MDM4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#pullrequestreview-532018038", "createdAt": "2020-11-17T04:44:25Z", "commit": {"oid": "f74ea547eac25878a862785dcac03462d6df9e3f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwNDo0NDoyNVrOH0kM-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwNDo0NDoyNVrOH0kM-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg4MTE0Nw==", "bodyText": "@rahulvudutala ,\nIn entity-search-lib.sjs line 48, I changed the HTTP error code from 500 to 404. It causes this endpoint to return null instead of exception it used to throw earlier ? let me know if that's ok.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#discussion_r524881147", "createdAt": "2020-11-17T04:44:25Z", "author": {"login": "srinathgit"}, "path": "marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/entities/search/EntitySearchManagerTest.java", "diffHunk": "@@ -96,7 +96,7 @@ public void testSearchResultsOnNonExistentEntityModel() {\n \n         SearchQuery searchQuery = new SearchQuery();\n         searchQuery.getQuery().setEntityTypeIds(Arrays.asList(\"Some-entityType\"));\n-        assertThrows(MarkLogicServerException.class, () -> new EntitySearchManager(getHubClient()).search(searchQuery), \"Entity Model with name Some-entityType doesn't exist \");\n+        assertNull(new EntitySearchManager(getHubClient()).search(searchQuery), \"Entity Model with name Some-entityType doesn't exist \");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f74ea547eac25878a862785dcac03462d6df9e3f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNzUwNjIy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#pullrequestreview-532750622", "createdAt": "2020-11-17T19:43:05Z", "commit": {"oid": "f74ea547eac25878a862785dcac03462d6df9e3f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f74ea547eac25878a862785dcac03462d6df9e3f", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/f74ea547eac25878a862785dcac03462d6df9e3f", "committedDate": "2020-11-17T04:41:03Z", "message": "DHFPROD-6218:Throw 404 or 400 instead of 500 when backend operation cannot find something"}, "afterCommit": {"oid": "719ccc9958d1098ca4af126bc2c3d0b5ce54611d", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/719ccc9958d1098ca4af126bc2c3d0b5ce54611d", "committedDate": "2020-11-17T20:59:39Z", "message": "DHFPROD-6218:Throw 404 or 400 instead of 500 when backend operation cannot find something"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyODIzNjE5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#pullrequestreview-532823619", "createdAt": "2020-11-17T21:23:19Z", "commit": {"oid": "719ccc9958d1098ca4af126bc2c3d0b5ce54611d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75225834e6db8824340d8ed0f183ea917030b66f", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/75225834e6db8824340d8ed0f183ea917030b66f", "committedDate": "2020-11-18T00:10:49Z", "message": "DHFPROD-6218:Throw 404 or 400 instead of 500 when backend operation cannot find something"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "719ccc9958d1098ca4af126bc2c3d0b5ce54611d", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/719ccc9958d1098ca4af126bc2c3d0b5ce54611d", "committedDate": "2020-11-17T20:59:39Z", "message": "DHFPROD-6218:Throw 404 or 400 instead of 500 when backend operation cannot find something"}, "afterCommit": {"oid": "75225834e6db8824340d8ed0f183ea917030b66f", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/75225834e6db8824340d8ed0f183ea917030b66f", "committedDate": "2020-11-18T00:10:49Z", "message": "DHFPROD-6218:Throw 404 or 400 instead of 500 when backend operation cannot find something"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyOTI0NTY2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#pullrequestreview-532924566", "createdAt": "2020-11-18T00:33:29Z", "commit": {"oid": "75225834e6db8824340d8ed0f183ea917030b66f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNjQ0OTgw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4868#pullrequestreview-533644980", "createdAt": "2020-11-18T16:44:57Z", "commit": {"oid": "75225834e6db8824340d8ed0f183ea917030b66f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1686, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}