{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNjg5MDg5", "number": 4798, "title": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps", "bodyText": "Description\n\nAdded option to run a Load/Curate step in a new flow or run in an existing flow from Card view via Run icon\nAdded RTL and Cypress tests for the respective scenarios\nDesign reviewed by @jbelonoj, note: Run tooltip will briefly cover the Run menu, but discussed that this is the best option for now.\nnote: There is a known bug with adding/running a same step to an existing flow where job details get corrupted. @srinathgit is working on a fix.\n\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-10-30T00:46:05Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798", "merged": true, "mergeCommit": {"oid": "95f5d9c8f8066e70ff1852d8243fdd79e681492d"}, "closed": true, "closedAt": "2020-11-02T19:55:45Z", "author": {"login": "briantang"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXpDO-AFqTUyMDgxNzEzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYoy1sgBqjM5NDk0OTAxMDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwODE3MTM2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#pullrequestreview-520817136", "createdAt": "2020-10-30T16:07:08Z", "commit": {"oid": "98b36d9a8ebb1b7850f2ddb1635a434ad15772b6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98b36d9a8ebb1b7850f2ddb1635a434ad15772b6", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/98b36d9a8ebb1b7850f2ddb1635a434ad15772b6", "committedDate": "2020-10-30T00:44:13Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}, "afterCommit": {"oid": "9fa09072144959fb65c04349e17e9359cd6fc061", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9fa09072144959fb65c04349e17e9359cd6fc061", "committedDate": "2020-10-30T16:40:24Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9fa09072144959fb65c04349e17e9359cd6fc061", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9fa09072144959fb65c04349e17e9359cd6fc061", "committedDate": "2020-10-30T16:40:24Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}, "afterCommit": {"oid": "8d1ea9fe34658c21668be7d5143ceb12ed67962c", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/8d1ea9fe34658c21668be7d5143ceb12ed67962c", "committedDate": "2020-10-30T18:38:46Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d1ea9fe34658c21668be7d5143ceb12ed67962c", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/8d1ea9fe34658c21668be7d5143ceb12ed67962c", "committedDate": "2020-10-30T18:38:46Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}, "afterCommit": {"oid": "85b76d8f23b9eac8204ce558f35d73f2ceec6779", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/85b76d8f23b9eac8204ce558f35d73f2ceec6779", "committedDate": "2020-10-30T19:47:10Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85b76d8f23b9eac8204ce558f35d73f2ceec6779", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/85b76d8f23b9eac8204ce558f35d73f2ceec6779", "committedDate": "2020-10-30T19:47:10Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}, "afterCommit": {"oid": "477fd873bc1c4b7b6e58a3f53b8e8841d6be785d", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/477fd873bc1c4b7b6e58a3f53b8e8841d6be785d", "committedDate": "2020-10-30T19:48:30Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "477fd873bc1c4b7b6e58a3f53b8e8841d6be785d", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/477fd873bc1c4b7b6e58a3f53b8e8841d6be785d", "committedDate": "2020-10-30T19:48:30Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}, "afterCommit": {"oid": "ac964bb1465df761406a4a1c13aba153c4cb8588", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ac964bb1465df761406a4a1c13aba153c4cb8588", "committedDate": "2020-10-30T20:58:38Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDQwMjY0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#pullrequestreview-521040264", "createdAt": "2020-10-30T21:15:07Z", "commit": {"oid": "ac964bb1465df761406a4a1c13aba153c4cb8588"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDgyMDIy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#pullrequestreview-521082022", "createdAt": "2020-10-30T23:17:26Z", "commit": {"oid": "ac964bb1465df761406a4a1c13aba153c4cb8588"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac964bb1465df761406a4a1c13aba153c4cb8588", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ac964bb1465df761406a4a1c13aba153c4cb8588", "committedDate": "2020-10-30T20:58:38Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}, "afterCommit": {"oid": "521157046f5e00b0801a914f2ed6c5fb9ab351a6", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/521157046f5e00b0801a914f2ed6c5fb9ab351a6", "committedDate": "2020-10-31T02:55:44Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "521157046f5e00b0801a914f2ed6c5fb9ab351a6", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/521157046f5e00b0801a914f2ed6c5fb9ab351a6", "committedDate": "2020-10-31T02:55:44Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}, "afterCommit": {"oid": "a1cb2a35782b7c7933353d7ac5a76fa513114e02", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/a1cb2a35782b7c7933353d7ac5a76fa513114e02", "committedDate": "2020-10-31T07:36:15Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDQxMDQ1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#pullrequestreview-521041045", "createdAt": "2020-10-30T21:16:50Z", "commit": {"oid": "ac964bb1465df761406a4a1c13aba153c4cb8588"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMToxNjo1MFrOHrgt0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMToxODo0M1rOHrgwdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4NjgzNA==", "bodyText": "Can we fix the CSS code styling here so we have a space between the selector and the curly brace, e.g.: .stepLink {", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#discussion_r515386834", "createdAt": "2020-10-30T21:16:50Z", "author": {"login": "wooldridge"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/mapping-card.module.scss", "diffHunk": "@@ -114,3 +119,16 @@\n     margin-top: 7px;\n     margin-bottom: 10px;\n }\n+\n+.stepLink{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac964bb1465df761406a4a1c13aba153c4cb8588"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4NzIyOQ==", "bodyText": "Can we fix the code styling here so we have a space after the if and before the curly brace, e.g.: if (addRun) {", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#discussion_r515387229", "createdAt": "2020-10-30T21:17:51Z", "author": {"login": "wooldridge"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/mapping-card.tsx", "diffHunk": "@@ -602,17 +612,63 @@ const MappingCard: React.FC<Props> = (props) => {\n     const onAddOk = async (lName, fName) => {\n         await props.addStepToFlow(lName, fName, 'mapping')\n         setAddDialogVisible(false);\n-\n-        history.push({\n-            pathname: '/tiles/run/add',\n-            state: {\n-                flowName: fName,\n-                flowsDefaultKey: [props.flows.findIndex(el => el.name === fName)],\n-                existingFlow: true\n-            }\n-        })\n+        \n+        if(addRun){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac964bb1465df761406a4a1c13aba153c4cb8588"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4NzM5MA==", "bodyText": "Add spaces, see above comment?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#discussion_r515387390", "createdAt": "2020-10-30T21:18:25Z", "author": {"login": "wooldridge"}, "path": "marklogic-data-hub-central/ui/src/components/flows/flows.tsx", "diffHunk": "@@ -73,18 +74,50 @@ const Flows: React.FC<Props> = (props) => {\n     const [openNewFlow, setOpenNewFlow] = useState(props.newStepToFlowOptions?.addingStepToFlow && !props.newStepToFlowOptions?.existingFlow);\n     const [activeKeys, setActiveKeys] = useState(JSON.stringify(props.newStepToFlowOptions?.flowsDefaultKey) !== JSON.stringify([\"-1\"]) ? props.newStepToFlowOptions?.flowsDefaultKey : ['-1']);\n     const [showLinks, setShowLinks] = useState('');\n+    const [startRun, setStartRun] = useState(false);\n     const [latestJobData, setLatestJobData] = useState<any>({});\n     const [createAdd, setCreateAdd] = useState(true);\n \n \n     useEffect(() => {\n-        if (JSON.stringify(props.flowsDefaultActiveKey) !== JSON.stringify([])) {\n+        if (JSON.stringify(props.flowsDefaultActiveKey) !== JSON.stringify([]) && props.flowsDefaultActiveKey.length >= activeKeys.length) {\n             setActiveKeys([...props.flowsDefaultActiveKey]);\n         }\n         // Get the latest job info when a step is added to an existing flow from Curate or Load Tile\n         if(JSON.stringify(props.flows) !== JSON.stringify([])){\n-            if(props.newStepToFlowOptions && props.newStepToFlowOptions.flowsDefaultKey && props.newStepToFlowOptions.flowsDefaultKey != -1){\n+            if(props.newStepToFlowOptions && props.newStepToFlowOptions.addingStepToFlow && props.newStepToFlowOptions.flowsDefaultKey && props.newStepToFlowOptions.flowsDefaultKey != -1){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac964bb1465df761406a4a1c13aba153c4cb8588"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4NzUwOA==", "bodyText": "Add spaces?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#discussion_r515387508", "createdAt": "2020-10-30T21:18:43Z", "author": {"login": "wooldridge"}, "path": "marklogic-data-hub-central/ui/src/components/flows/flows.tsx", "diffHunk": "@@ -73,18 +74,50 @@ const Flows: React.FC<Props> = (props) => {\n     const [openNewFlow, setOpenNewFlow] = useState(props.newStepToFlowOptions?.addingStepToFlow && !props.newStepToFlowOptions?.existingFlow);\n     const [activeKeys, setActiveKeys] = useState(JSON.stringify(props.newStepToFlowOptions?.flowsDefaultKey) !== JSON.stringify([\"-1\"]) ? props.newStepToFlowOptions?.flowsDefaultKey : ['-1']);\n     const [showLinks, setShowLinks] = useState('');\n+    const [startRun, setStartRun] = useState(false);\n     const [latestJobData, setLatestJobData] = useState<any>({});\n     const [createAdd, setCreateAdd] = useState(true);\n \n \n     useEffect(() => {\n-        if (JSON.stringify(props.flowsDefaultActiveKey) !== JSON.stringify([])) {\n+        if (JSON.stringify(props.flowsDefaultActiveKey) !== JSON.stringify([]) && props.flowsDefaultActiveKey.length >= activeKeys.length) {\n             setActiveKeys([...props.flowsDefaultActiveKey]);\n         }\n         // Get the latest job info when a step is added to an existing flow from Curate or Load Tile\n         if(JSON.stringify(props.flows) !== JSON.stringify([])){\n-            if(props.newStepToFlowOptions && props.newStepToFlowOptions.flowsDefaultKey && props.newStepToFlowOptions.flowsDefaultKey != -1){\n+            if(props.newStepToFlowOptions && props.newStepToFlowOptions.addingStepToFlow && props.newStepToFlowOptions.flowsDefaultKey && props.newStepToFlowOptions.flowsDefaultKey != -1){\n                 getFlowWithJobInfo(props.newStepToFlowOptions.flowsDefaultKey);\n+                if(startRun && props.newStepToFlowOptions.existingFlow){\n+                        //run step after step is added to an existing flow\n+                        if(props.newStepToFlowOptions.stepDefinitionType === 'ingestion'){\n+                            setShowUploadError(false);\n+                            setRunningStep(props.flows[props.newStepToFlowOptions.flowsDefaultKey].steps[props.flows[props.newStepToFlowOptions.flowsDefaultKey].steps.length - 1]);\n+                            setRunningFlow(props.newStepToFlowOptions?.flowName);\n+                            openFilePicker();\n+                            setStartRun(false);\n+                        }else{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac964bb1465df761406a4a1c13aba153c4cb8588"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1cb2a35782b7c7933353d7ac5a76fa513114e02", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/a1cb2a35782b7c7933353d7ac5a76fa513114e02", "committedDate": "2020-10-31T07:36:15Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}, "afterCommit": {"oid": "397039104b27ed5df00ed5dc21e236bf807b1ad3", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/397039104b27ed5df00ed5dc21e236bf807b1ad3", "committedDate": "2020-11-01T18:01:26Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d56132f5cf3e01507c21be25390fc934cf12eb4c", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d56132f5cf3e01507c21be25390fc934cf12eb4c", "committedDate": "2020-11-02T06:49:58Z", "message": "Merge pull request #1 from wooldridge/DHFPROD-5961\n\nDHFPROD-5961: Spacing fixes in JS code"}, "afterCommit": {"oid": "b5002d16331293a0c63c20af574c11702a9ac735", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b5002d16331293a0c63c20af574c11702a9ac735", "committedDate": "2020-11-02T06:53:21Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMzg0OTM5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#pullrequestreview-521384939", "createdAt": "2020-11-02T07:36:49Z", "commit": {"oid": "b5002d16331293a0c63c20af574c11702a9ac735"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNjgwNjQz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4798#pullrequestreview-521680643", "createdAt": "2020-11-02T14:32:31Z", "commit": {"oid": "b5002d16331293a0c63c20af574c11702a9ac735"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01df895fc558dca4da775d6c4d7992af64ffaac3", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/01df895fc558dca4da775d6c4d7992af64ffaac3", "committedDate": "2020-11-02T18:22:40Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5002d16331293a0c63c20af574c11702a9ac735", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b5002d16331293a0c63c20af574c11702a9ac735", "committedDate": "2020-11-02T06:53:21Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}, "afterCommit": {"oid": "01df895fc558dca4da775d6c4d7992af64ffaac3", "author": {"user": {"login": "briantang", "name": "Brian Tang"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/01df895fc558dca4da775d6c4d7992af64ffaac3", "committedDate": "2020-11-02T18:22:40Z", "message": "DHFPROD-5961: Add run icon and 'run in flow' menu to all steps"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1841, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}