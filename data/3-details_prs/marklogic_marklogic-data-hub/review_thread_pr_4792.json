{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNDY3NjUy", "number": 4792, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxODo1NDo0M1rOEzcBiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxODo1NDo0M1rOEzcBiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMzcxOTc2OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxODo1NDo0M1rOHqqKzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxOToxMzoxNlrOHqq1sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ5MzEzMg==", "bodyText": "I think this should still be a warning and not cause an error. The reasoning is that Ernie can fix a problem with additionalexternalmetadata - he's in control of that. But if for some reason we can't read the Spark StructType as JSON, it's not likely that Ernie can fix that, and now he can't ingest any data.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4792#discussion_r514493132", "createdAt": "2020-10-29T18:54:43Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -249,10 +249,15 @@ private String initializeJob(StructType schema) {\n             if(options.get(\"additionalexternalmetadata\")!=null) {\n                 externalMetadata = (ObjectNode) objectMapper.readTree(options.get(\"additionalexternalmetadata\"));\n             }\n+        } catch(Exception e) {\n+                throw new IllegalArgumentException(\"Unable to parse additionalExternalMetadata option as a JSON object; \" +\n+                    \"cause: \" + e.getMessage(), e);\n+        }\n+        try{\n             externalMetadata.set(\"sparkSchema\", objectMapper.readTree(schema.json()));\n \n         } catch (Exception e) {\n-            logger.warn(\"Unable to read Spark schema as a JSON object; cause: \" + e.getMessage() + \"; the schema will not \" +\n+            throw new IllegalArgumentException(\"Unable to read Spark schema as a JSON object; cause: \" + e.getMessage() + \"; the schema will not \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5fb89d1e9a6defdd099f8a14e29af3f5b0d6e04"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUwNDExNQ==", "bodyText": "Done", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4792#discussion_r514504115", "createdAt": "2020-10-29T19:13:16Z", "author": {"login": "anu3990"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -249,10 +249,15 @@ private String initializeJob(StructType schema) {\n             if(options.get(\"additionalexternalmetadata\")!=null) {\n                 externalMetadata = (ObjectNode) objectMapper.readTree(options.get(\"additionalexternalmetadata\"));\n             }\n+        } catch(Exception e) {\n+                throw new IllegalArgumentException(\"Unable to parse additionalExternalMetadata option as a JSON object; \" +\n+                    \"cause: \" + e.getMessage(), e);\n+        }\n+        try{\n             externalMetadata.set(\"sparkSchema\", objectMapper.readTree(schema.json()));\n \n         } catch (Exception e) {\n-            logger.warn(\"Unable to read Spark schema as a JSON object; cause: \" + e.getMessage() + \"; the schema will not \" +\n+            throw new IllegalArgumentException(\"Unable to read Spark schema as a JSON object; cause: \" + e.getMessage() + \"; the schema will not \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ5MzEzMg=="}, "originalCommit": {"oid": "b5fb89d1e9a6defdd099f8a14e29af3f5b0d6e04"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3202, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}