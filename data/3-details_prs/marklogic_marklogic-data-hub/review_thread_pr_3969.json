{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NzczMjA2", "number": 3969, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzowMToyN1rOD9lHoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMjoyNjowNFrOD9nTmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODk3ODg4OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/privileges/data-hub-write-mapping.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzowMToyN1rOGXKNfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzowMToyN1rOGXKNfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkzNzcyNQ==", "bodyText": "Thoughts on using xdmp.securityAssert in the step endpoints? Would require conditionals on stepDefinitionType", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3969#discussion_r426937725", "createdAt": "2020-05-18T23:01:27Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/privileges/data-hub-write-mapping.json", "diffHunk": "@@ -0,0 +1,5 @@\n+{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90facb1530c5af13f88787acc405da281828c0ca"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTAxNTIwOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-central/ui/src/components/tiles/toolbar.tsx", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMzoxODo1NlrOGXKjOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNjoxODozOFrOGXoPhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk0MzI5MA==", "bodyText": "So even a hub-central-user can access Explore tile?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3969#discussion_r426943290", "createdAt": "2020-05-18T23:18:56Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/tiles/toolbar.tsx", "diffHunk": "@@ -12,23 +14,39 @@ interface Props {\n const Toolbar: React.FC<Props>  = (props) => {\n \n     const tiles = props.tiles; // config/tiles.config.ts\n+    const authorityService = useContext(AuthoritiesContext);\n+    const idToAuthoritiesNeeded = {\n+        load: () => authorityService.canReadLoadData(),\n+        model: () => authorityService.canReadEntityModel(),\n+        curate: () => authorityService.canReadMapping(),\n+        run: () => authorityService.canReadFlow(),\n+        explore: () => true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90facb1530c5af13f88787acc405da281828c0ca"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQwMTU4OQ==", "bodyText": "I think that makes sense for now, until we have requirements stating otherwise.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3969#discussion_r427401589", "createdAt": "2020-05-19T15:39:09Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/ui/src/components/tiles/toolbar.tsx", "diffHunk": "@@ -12,23 +14,39 @@ interface Props {\n const Toolbar: React.FC<Props>  = (props) => {\n \n     const tiles = props.tiles; // config/tiles.config.ts\n+    const authorityService = useContext(AuthoritiesContext);\n+    const idToAuthoritiesNeeded = {\n+        load: () => authorityService.canReadLoadData(),\n+        model: () => authorityService.canReadEntityModel(),\n+        curate: () => authorityService.canReadMapping(),\n+        run: () => authorityService.canReadFlow(),\n+        explore: () => true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk0MzI5MA=="}, "originalCommit": {"oid": "90facb1530c5af13f88787acc405da281828c0ca"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQxNTA4Nw==", "bodyText": "@ryanjdew  @xnikhil08 Does this basically take care of the UI portion of https://project.marklogic.com/jira/browse/DHFPROD-4820 - i.e. don't show the Model tile unless canReadEntityModel returns true?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3969#discussion_r427415087", "createdAt": "2020-05-19T15:57:51Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/ui/src/components/tiles/toolbar.tsx", "diffHunk": "@@ -12,23 +14,39 @@ interface Props {\n const Toolbar: React.FC<Props>  = (props) => {\n \n     const tiles = props.tiles; // config/tiles.config.ts\n+    const authorityService = useContext(AuthoritiesContext);\n+    const idToAuthoritiesNeeded = {\n+        load: () => authorityService.canReadLoadData(),\n+        model: () => authorityService.canReadEntityModel(),\n+        curate: () => authorityService.canReadMapping(),\n+        run: () => authorityService.canReadFlow(),\n+        explore: () => true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk0MzI5MA=="}, "originalCommit": {"oid": "90facb1530c5af13f88787acc405da281828c0ca"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQyOTc2NA==", "bodyText": "@rjrudin It shows the tile still without the authority, but the tooltip states they need to contact their security admin to get access, and selecting the tile does nothing in that case. See comments in https://project.marklogic.com/jira/browse/DHFPROD-4673", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3969#discussion_r427429764", "createdAt": "2020-05-19T16:18:38Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub-central/ui/src/components/tiles/toolbar.tsx", "diffHunk": "@@ -12,23 +14,39 @@ interface Props {\n const Toolbar: React.FC<Props>  = (props) => {\n \n     const tiles = props.tiles; // config/tiles.config.ts\n+    const authorityService = useContext(AuthoritiesContext);\n+    const idToAuthoritiesNeeded = {\n+        load: () => authorityService.canReadLoadData(),\n+        model: () => authorityService.canReadEntityModel(),\n+        curate: () => authorityService.canReadMapping(),\n+        run: () => authorityService.canReadFlow(),\n+        explore: () => true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk0MzI5MA=="}, "originalCommit": {"oid": "90facb1530c5af13f88787acc405da281828c0ca"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTMzNTcyOnYy", "diffSide": "RIGHT", "path": "examples/reference-entity-model/src/main/ml-config/security/users/hub-developer.json", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMjoyNToxNFrOGXNmAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMjoyNToxNFrOGXNmAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk5MzE1Mw==", "bodyText": "I think data-hub-developer should gain the data-hub:writeMapping privilege, which then means we don't have to modify these users or the cypress users that already have data-hub-developer. That privilege can then be used in xdmp.securityAssert calls in the DS endpoints.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3969#discussion_r426993153", "createdAt": "2020-05-19T02:25:14Z", "author": {"login": "rjrudin"}, "path": "examples/reference-entity-model/src/main/ml-config/security/users/hub-developer.json", "diffHunk": "@@ -4,6 +4,7 @@\n   \"password\": \"%%testPassword%%\",\n   \"role\": [\n     \"data-hub-developer\",\n-    \"hub-central-user\"\n+    \"hub-central-user\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f81a10bd4f6a70ce614c9e3b0575e62a19ae93d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTMzNzIyOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/roles/data-hub-mapping-writer.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMjoyNjowNVrOGXNm9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNjoyNDo1N1rOGXogNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk5MzM5Ng==", "bodyText": "I am wondering if this role should gain the data-hub:writeMapping privilege. Then we don't even need to modify data-hub-developer. It would seem surprising if this role doesn't inherit that privilege - thoughts?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3969#discussion_r426993396", "createdAt": "2020-05-19T02:26:05Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/roles/data-hub-mapping-writer.json", "diffHunk": "@@ -1,4 +1,5 @@\n {\n   \"role-name\": \"data-hub-mapping-writer\",\n-  \"description\": \"Permits updating mapping documents\"\n+  \"description\": \"Permits updating mapping documents\",\n+  \"privilege\": []", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f81a10bd4f6a70ce614c9e3b0575e62a19ae93d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQzNDAzOA==", "bodyText": "@rjrudin The only issue I have with that is that if we added the privileges to the lower-level data-hub-* roles then that means that for example when the hub-central-step-runner gets the reader roles necessary the privileges will come over with them. With the current roles defined, we could potentially have the writer privileges on the lower level roles and not the read.\nI'm thinking doing any assert on reading documents would be redundant anyway given the document permissions we're setting on the documents.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3969#discussion_r427434038", "createdAt": "2020-05-19T16:24:57Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/roles/data-hub-mapping-writer.json", "diffHunk": "@@ -1,4 +1,5 @@\n {\n   \"role-name\": \"data-hub-mapping-writer\",\n-  \"description\": \"Permits updating mapping documents\"\n+  \"description\": \"Permits updating mapping documents\",\n+  \"privilege\": []", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk5MzM5Ng=="}, "originalCommit": {"oid": "5f81a10bd4f6a70ce614c9e3b0575e62a19ae93d"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4143, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}