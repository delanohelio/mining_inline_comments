{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MTUzMDEy", "number": 4759, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxOTowNTo1M1rOExVJdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMDozNTozOVrOEyE74g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwMTYyMTY1OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxOTowNTo1M1rOHnaYbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxOTozNDo0NVrOHnbySg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA4ODc0OQ==", "bodyText": "Do these need to move as part of this PR? I'm planning on moving buildHubClientConfig out of here soon - the Reader will need it. In which case these two methods can stay put.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r511088749", "createdAt": "2020-10-23T19:05:53Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -75,17 +64,28 @@ public static HubClientConfig buildHubClientConfig(Map<String, String> options)\n         hubClientConfig.applyProperties(props);\n         return hubClientConfig;\n     }\n+\n+    @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19896d0c0fbbbf399e8f067c6602fc0f9fb5486e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTExMTc1NA==", "bodyText": "The changes are just formatting in this PR.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r511111754", "createdAt": "2020-10-23T19:34:45Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -75,17 +64,28 @@ public static HubClientConfig buildHubClientConfig(Map<String, String> options)\n         hubClientConfig.applyProperties(props);\n         return hubClientConfig;\n     }\n+\n+    @Override", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA4ODc0OQ=="}, "originalCommit": {"oid": "19896d0c0fbbbf399e8f067c6602fc0f9fb5486e"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwMTcwMDIwOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxOToxOTowMVrOHna_iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMDowMDoxNVrOHnc05w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA5ODc2MA==", "bodyText": "I think it's worth making another private method to avoid the duplication of the \"if\" check and the error handling - e.g. \"loadEndpointsIfNotPresent\".", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r511098760", "createdAt": "2020-10-23T19:19:01Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -216,6 +214,16 @@ private DocumentMetadataHandle buildDocumentMetadata() {\n     }\n \n     private String initializeJob(StructType schema) {\n+        String apiPath = \"/marklogic-data-hub-spark-connector/initializeJob.api\";\n+        String scriptPath = \"/marklogic-data-hub-spark-connector/initializeJob.sjs\";\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19896d0c0fbbbf399e8f067c6602fc0f9fb5486e"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEyODgwNw==", "bodyText": "Updated the method to check and load.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r511128807", "createdAt": "2020-10-23T20:00:15Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -216,6 +214,16 @@ private DocumentMetadataHandle buildDocumentMetadata() {\n     }\n \n     private String initializeJob(StructType schema) {\n+        String apiPath = \"/marklogic-data-hub-spark-connector/initializeJob.api\";\n+        String scriptPath = \"/marklogic-data-hub-spark-connector/initializeJob.sjs\";\n+        try {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA5ODc2MA=="}, "originalCommit": {"oid": "19896d0c0fbbbf399e8f067c6602fc0f9fb5486e"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwMTcwMjMzOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxOToxOToxOVrOHnbAig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxOTo1OTo1NlrOHnc0SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA5OTAxOA==", "bodyText": "Just throw a RuntimeException here - IllegalArgumentException is for when the user provided some argument that's not valid, which isn't the case here.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r511099018", "createdAt": "2020-10-23T19:19:19Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -216,6 +214,16 @@ private DocumentMetadataHandle buildDocumentMetadata() {\n     }\n \n     private String initializeJob(StructType schema) {\n+        String apiPath = \"/marklogic-data-hub-spark-connector/initializeJob.api\";\n+        String scriptPath = \"/marklogic-data-hub-spark-connector/initializeJob.sjs\";\n+        try {\n+            if (endpointExists(apiPath)) {\n+                loadEndpoint(scriptPath, apiPath);\n+            }\n+        } catch (IOException e) {\n+            throw new IllegalArgumentException(\"Unable to load initializeJob Endpoint, cause: \" + e.getMessage(), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19896d0c0fbbbf399e8f067c6602fc0f9fb5486e"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEyODY0OQ==", "bodyText": "Done.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r511128649", "createdAt": "2020-10-23T19:59:56Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -216,6 +214,16 @@ private DocumentMetadataHandle buildDocumentMetadata() {\n     }\n \n     private String initializeJob(StructType schema) {\n+        String apiPath = \"/marklogic-data-hub-spark-connector/initializeJob.api\";\n+        String scriptPath = \"/marklogic-data-hub-spark-connector/initializeJob.sjs\";\n+        try {\n+            if (endpointExists(apiPath)) {\n+                loadEndpoint(scriptPath, apiPath);\n+            }\n+        } catch (IOException e) {\n+            throw new IllegalArgumentException(\"Unable to load initializeJob Endpoint, cause: \" + e.getMessage(), e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA5OTAxOA=="}, "originalCommit": {"oid": "19896d0c0fbbbf399e8f067c6602fc0f9fb5486e"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwMTcwNjQyOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxOToxOTo1MlrOHnbCew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMDowMDoyOVrOHnc1WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA5OTUxNQ==", "bodyText": "Need to check both the api and the sjs separately - it's conceivable that one exists but the other does not.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r511099515", "createdAt": "2020-10-23T19:19:52Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -155,10 +155,11 @@ private JsonNode determineIngestionEndpointParams(Map<String, String> options) {\n \n         if (doesNotHaveApiPath) {\n             String apiPath = \"/marklogic-data-hub-spark-connector/bulkIngester.api\";\n+            String scriptPath = \"/marklogic-data-hub-spark-connector/bulkIngester.sjs\";\n \n-            if(hubClient.getModulesClient().newJSONDocumentManager().exists(apiPath) == null) {\n+            if (endpointExists(apiPath)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19896d0c0fbbbf399e8f067c6602fc0f9fb5486e"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEyODkyMQ==", "bodyText": "Checking both the files.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r511128921", "createdAt": "2020-10-23T20:00:29Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -155,10 +155,11 @@ private JsonNode determineIngestionEndpointParams(Map<String, String> options) {\n \n         if (doesNotHaveApiPath) {\n             String apiPath = \"/marklogic-data-hub-spark-connector/bulkIngester.api\";\n+            String scriptPath = \"/marklogic-data-hub-spark-connector/bulkIngester.sjs\";\n \n-            if(hubClient.getModulesClient().newJSONDocumentManager().exists(apiPath) == null) {\n+            if (endpointExists(apiPath)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA5OTUxNQ=="}, "originalCommit": {"oid": "19896d0c0fbbbf399e8f067c6602fc0f9fb5486e"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwMjM1ODUzOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMzoyNzo1NVrOHng7bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODo0Mzo1NlrOHodjcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE5NjAxNQ==", "bodyText": "To be safe, we really need to do one document at a time. If someone how module exists but the other doesn't, this will throw an error. The efficiency of writing 2 at a time isn't important here; this is going to finish in a very small amount of time no matter what, and it's a one-time operation.\nSo this method should just handle a single module. It just needs to know the path and the Format.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r511196015", "createdAt": "2020-10-23T23:27:55Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -190,16 +185,19 @@ private void applyOptionsToEndpointConstants(ObjectNode endpointConstants, Map<S\n         });\n     }\n \n-    private void loadEndpoints() throws IOException {\n-        String scriptPath = \"marklogic-data-hub-spark-connector/bulkIngester.sjs\";\n-        String apiPath = \"marklogic-data-hub-spark-connector/bulkIngester.api\";\n-\n-        TextDocumentManager modMgr = hubClient.getModulesClient().newTextDocumentManager();\n-        DocumentWriteSet writeSet = modMgr.newWriteSet();\n-        DocumentMetadataHandle metadata = buildDocumentMetadata();\n-        writeSet.add(\"/\" + apiPath, metadata, new InputStreamHandle(new ClassPathResource(apiPath).getInputStream()).withFormat(Format.JSON));\n-        writeSet.add(\"/\" + scriptPath, metadata, new InputStreamHandle(new ClassPathResource(scriptPath).getInputStream()).withFormat(Format.TEXT));\n-        modMgr.write(writeSet);\n+    private void loadEndpointsIfNotPresent(String scriptPath, String apiPath) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cad37ad54bff6463ef8b5cb008e991ef6a1b1f6"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE4OTI5OQ==", "bodyText": "Done.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r512189299", "createdAt": "2020-10-26T18:43:56Z", "author": {"login": "SameeraPriyathamTadikonda"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -190,16 +185,19 @@ private void applyOptionsToEndpointConstants(ObjectNode endpointConstants, Map<S\n         });\n     }\n \n-    private void loadEndpoints() throws IOException {\n-        String scriptPath = \"marklogic-data-hub-spark-connector/bulkIngester.sjs\";\n-        String apiPath = \"marklogic-data-hub-spark-connector/bulkIngester.api\";\n-\n-        TextDocumentManager modMgr = hubClient.getModulesClient().newTextDocumentManager();\n-        DocumentWriteSet writeSet = modMgr.newWriteSet();\n-        DocumentMetadataHandle metadata = buildDocumentMetadata();\n-        writeSet.add(\"/\" + apiPath, metadata, new InputStreamHandle(new ClassPathResource(apiPath).getInputStream()).withFormat(Format.JSON));\n-        writeSet.add(\"/\" + scriptPath, metadata, new InputStreamHandle(new ClassPathResource(scriptPath).getInputStream()).withFormat(Format.TEXT));\n-        modMgr.write(writeSet);\n+    private void loadEndpointsIfNotPresent(String scriptPath, String apiPath) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTE5NjAxNQ=="}, "originalCommit": {"oid": "9cad37ad54bff6463ef8b5cb008e991ef6a1b1f6"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTQ0NTIyOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMDozMzo1OVrOHohSag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMDozMzo1OVrOHohSag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1MDQ3NA==", "bodyText": "Can you rename this to \"loadModuleIfNotPresent\" and rename \"scriptPath\" to \"modulePath\"?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r512250474", "createdAt": "2020-10-26T20:33:59Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -204,16 +201,18 @@ private void applyOptionsToEndpointConstants(ObjectNode endpointConstants, Map<S\n         });\n     }\n \n-    private void loadEndpoints() throws IOException {\n-        String scriptPath = \"marklogic-data-hub-spark-connector/bulkIngester.sjs\";\n-        String apiPath = \"marklogic-data-hub-spark-connector/bulkIngester.api\";\n-\n-        TextDocumentManager modMgr = hubClient.getModulesClient().newTextDocumentManager();\n-        DocumentWriteSet writeSet = modMgr.newWriteSet();\n-        DocumentMetadataHandle metadata = buildDocumentMetadata();\n-        writeSet.add(\"/\" + apiPath, metadata, new InputStreamHandle(new ClassPathResource(apiPath).getInputStream()).withFormat(Format.JSON));\n-        writeSet.add(\"/\" + scriptPath, metadata, new InputStreamHandle(new ClassPathResource(scriptPath).getInputStream()).withFormat(Format.TEXT));\n-        modMgr.write(writeSet);\n+    private void loadEndpointsIfNotPresent(String scriptPath, Format format) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b818ac964adc509c19ce0e8ae6d88d67bec75292"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTQ0NzAwOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMDozNDoyNVrOHohTfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMDozNDoyNVrOHohTfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1MDc1MA==", "bodyText": "No need for a DocumentWriteSet since we're only writing one doc. Also, do \"newDocumentManager\" so it doesn't look like we expect these to be text documents.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r512250750", "createdAt": "2020-10-26T20:34:25Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -204,16 +201,18 @@ private void applyOptionsToEndpointConstants(ObjectNode endpointConstants, Map<S\n         });\n     }\n \n-    private void loadEndpoints() throws IOException {\n-        String scriptPath = \"marklogic-data-hub-spark-connector/bulkIngester.sjs\";\n-        String apiPath = \"marklogic-data-hub-spark-connector/bulkIngester.api\";\n-\n-        TextDocumentManager modMgr = hubClient.getModulesClient().newTextDocumentManager();\n-        DocumentWriteSet writeSet = modMgr.newWriteSet();\n-        DocumentMetadataHandle metadata = buildDocumentMetadata();\n-        writeSet.add(\"/\" + apiPath, metadata, new InputStreamHandle(new ClassPathResource(apiPath).getInputStream()).withFormat(Format.JSON));\n-        writeSet.add(\"/\" + scriptPath, metadata, new InputStreamHandle(new ClassPathResource(scriptPath).getInputStream()).withFormat(Format.TEXT));\n-        modMgr.write(writeSet);\n+    private void loadEndpointsIfNotPresent(String scriptPath, Format format) {\n+        if (!endpointExists(scriptPath)) {\n+            try {\n+                TextDocumentManager modMgr = hubClient.getModulesClient().newTextDocumentManager();\n+                DocumentWriteSet writeSet = modMgr.newWriteSet();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b818ac964adc509c19ce0e8ae6d88d67bec75292"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwOTQ1MTIyOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMDozNTozOVrOHohWIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMDozNTozOVrOHohWIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjI1MTQyNA==", "bodyText": "I think we need to initialize these modules before we create the job document. That ensures we fail fast if there's any problem - i.e. we don't want to load a bunch of data and then have an error if we can't write these modules for some reason.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4759#discussion_r512251424", "createdAt": "2020-10-26T20:35:39Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-spark-connector/src/main/java/com/marklogic/hub/spark/sql/sources/v2/DefaultSource.java", "diffHunk": "@@ -246,13 +250,23 @@ private void addJobIdToEndpointConstants() {\n         if (endpointParams != null && endpointParams.has(\"endpointConstants\")) {\n             JsonNode endpointConstants = endpointParams.get(\"endpointConstants\");\n             if (endpointConstants instanceof ObjectNode) {\n-                ((ObjectNode)endpointConstants).put(\"jobId\", this.jobId);\n+                ((ObjectNode) endpointConstants).put(\"jobId\", this.jobId);\n             }\n         }\n     }\n \n     private void finalizeJob(String status) {\n+        String apiPath = \"/marklogic-data-hub-spark-connector/finalizeJob.api\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b818ac964adc509c19ce0e8ae6d88d67bec75292"}, "originalPosition": 87}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3179, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}