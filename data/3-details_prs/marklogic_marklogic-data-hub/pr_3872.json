{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NzkyMjI4", "number": 3872, "title": "DHFPROD-4198:Create Save Query UI Component,DHFPROD-4628:Handle \"save\" and \"save as\" when there are unapplied changes", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-04-24T22:27:30Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872", "merged": true, "mergeCommit": {"oid": "6cadf5ac408e5c607c98ca1c75645044fc350d27"}, "closed": true, "closedAt": "2020-04-27T20:31:43Z", "author": {"login": "Sanjeevani19"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABca56zkAFqTQwMDMyMDA0MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcb0cbSgFqTQwMTI2MDA3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMzIwMDQx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#pullrequestreview-400320041", "createdAt": "2020-04-24T23:16:55Z", "commit": {"oid": "66dbb694308c4230f72a0cd71959f10606d727c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMzoxNjo1NVrOGLsU3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMzoxNjo1NVrOGLsU3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkxMzc1Nw==", "bodyText": "Can you make Save button disabled if the query name input field is empty?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#discussion_r414913757", "createdAt": "2020-04-24T23:16:55Z", "author": {"login": "timur-isangulov"}, "path": "marklogic-data-hub-central/ui/src/components/queries/saving/save-query-modal/save-query-modal.tsx", "diffHunk": "@@ -0,0 +1,150 @@\n+import React, {useState, useContext} from 'react';\n+import {Modal, Form, Input, Radio, Button} from 'antd';\n+import {SearchContext} from \"../../../../util/search-context\";\n+import styles from './save-query-modal.module.scss';\n+\n+interface Props {\n+    setSaveModalVisibility: () => void;\n+    saveNewQuery: (queryName: string, queryDescription: string,facets:{}) => void;\n+    greyFacets:any[];\n+    toggleApply: (clicked:boolean) => void;\n+    toggleApplyClicked: (clicked:boolean) => void;\n+}\n+\n+\n+const SaveQueryModal: React.FC<Props> = (props) => {\n+\n+    const {\n+        clearAllGreyFacets,\n+        greyedOptions,\n+        setAllSearchFacets,\n+        searchOptions,\n+    } = useContext(SearchContext);\n+\n+\n+    const [queryName, setQueryName] = useState('');\n+    const [queryDescription, setQueryDescription] = useState('');\n+    const [radioOptionClicked, setRadioOptionClicked] = useState(0);\n+    const [queryEmpty, isQueryEmpty] = useState<any>('');\n+\n+    const layout = {\n+        labelCol: { span: 6 },\n+        wrapperCol: { span: 18 },\n+    };\n+\n+    const onCancel = () => {\n+        props.setSaveModalVisibility();\n+    }\n+\n+    const onOk = () => {\n+        let facets = {...searchOptions.selectedFacets}\n+        switch(radioOptionClicked) {\n+            case 1:\n+                setAllSearchFacets(searchOptions.selectedFacets);\n+                setAllSearchFacets(greyedOptions.selectedFacets);\n+                facets = {...facets,...greyedOptions.selectedFacets};\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+                break;\n+            case 2:\n+                break;\n+            case 3:\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+        }\n+\n+        if(queryName.length > 0 ){\n+            props.saveNewQuery(queryName, queryDescription, facets);\n+        } else {\n+            isQueryEmpty('error')\n+        }\n+    }\n+\n+    const handleChange = (event) => {\n+        if (event.target.id === 'save-query-name') {\n+           setQueryName(event.target.value);\n+        }\n+        if (event.target.id === 'save-query-description') {\n+           setQueryDescription(event.target.value);\n+        }\n+    }\n+\n+    const unAppliedFacets = (e) => {\n+        setRadioOptionClicked(e.target.value)\n+    }\n+\n+\n+    return (\n+        <Modal\n+            visible={true}\n+            title={'Save Query'}\n+            closable={true}\n+            onCancel={() => onCancel()}\n+            onOk={() => onOk()}\n+            maskClosable={true}\n+            footer={null}\n+            data-testid='save-query-modal'\n+        >\n+            <Form\n+                name=\"basic\"\n+                {...layout}\n+            >\n+                <Form.Item\n+                    colon={false}\n+                    label={<span className={styles.text}>\n+                           Name:&nbsp;<span className={styles.asterisk}>*</span>&nbsp;\n+                        </span>}\n+                    labelAlign=\"left\"\n+                    validateStatus={queryEmpty}\n+                    help={ queryEmpty === 'error' ? 'Query name is required' : ''}\n+                    data-testid='save-query-name'\n+                >\n+                    <Input\n+                        id=\"save-query-name\"\n+                        value={queryName}\n+                        placeholder={'Enter query name'}\n+                        onChange={handleChange}\n+                    />\n+                </Form.Item>\n+                <Form.Item\n+                    colon={false}\n+                    label='Description:'\n+                    labelAlign=\"left\"\n+                    data-testid='save-query-description'\n+                >\n+                    <Input\n+                        id=\"save-query-description\"\n+                        value={queryDescription}\n+                        onChange={handleChange}\n+                        placeholder={'Enter query description'}\n+                    />\n+                </Form.Item>\n+                {props.greyFacets.length > 0  && <Form.Item\n+                    colon={false}\n+                    label='Unapplied Facets:'\n+                    labelAlign=\"left\"\n+                    data-testid='unapplied-radio-options'\n+                >\n+                    <Radio.Group onChange={unAppliedFacets} style={{'marginTop': '11px'}}>\n+                        <Radio value={1}> Apply before saving</Radio>\n+                        <Radio value={2}> Save as is, keep unapplied facets</Radio>\n+                        <Radio value={3}> Discard unapplied facets</Radio>\n+                    </Radio.Group>\n+                </Form.Item>}\n+                <Form.Item>\n+                    <div className={styles.submitButtons}>\n+                        <Button onClick={() => onCancel()}>Cancel</Button>\n+                        &nbsp;&nbsp;\n+                        <Button type=\"primary\" htmlType=\"submit\" onClick={()=> onOk()} id='save-query-button'>Save</Button>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66dbb694308c4230f72a0cd71959f10606d727c4"}, "originalPosition": 140}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66dbb694308c4230f72a0cd71959f10606d727c4", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/66dbb694308c4230f72a0cd71959f10606d727c4", "committedDate": "2020-04-24T22:25:04Z", "message": "DHFPROD-4198:save queries"}, "afterCommit": {"oid": "d07459f725cc0752a77460cae69bb9eeba5fe655", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d07459f725cc0752a77460cae69bb9eeba5fe655", "committedDate": "2020-04-24T23:23:19Z", "message": "DHFPROD-4198:save queries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d07459f725cc0752a77460cae69bb9eeba5fe655", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d07459f725cc0752a77460cae69bb9eeba5fe655", "committedDate": "2020-04-24T23:23:19Z", "message": "DHFPROD-4198:save queries"}, "afterCommit": {"oid": "42b8ed486163855dbc8ce976d557115534595c2e", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/42b8ed486163855dbc8ce976d557115534595c2e", "committedDate": "2020-04-25T03:01:35Z", "message": "DHFPROD-4198:save queries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "42b8ed486163855dbc8ce976d557115534595c2e", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/42b8ed486163855dbc8ce976d557115534595c2e", "committedDate": "2020-04-25T03:01:35Z", "message": "DHFPROD-4198:save queries"}, "afterCommit": {"oid": "600fcdc3da776a450e1621ba572c962c650883b6", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/600fcdc3da776a450e1621ba572c962c650883b6", "committedDate": "2020-04-26T23:26:37Z", "message": "DHFPROD-4198:save queries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMDczMDM0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#pullrequestreview-401073034", "createdAt": "2020-04-27T15:35:14Z", "commit": {"oid": "600fcdc3da776a450e1621ba572c962c650883b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNTozNToxNFrOGMpoGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNTozNToxNFrOGMpoGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkxODEwNA==", "bodyText": "We are not supposed to be testing with admin. So can we remove/update all such references?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#discussion_r415918104", "createdAt": "2020-04-27T15:35:14Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/assets/mock-data/query.js", "diffHunk": "@@ -1,121 +1,159 @@\n //GET\n export const getQueriesResponse = [\n-    {\n-        \"savedQuery\": {\n-            \"id\": \"edf7b2d1-62d2-481d-9bb0-2145b023ca5e\",\n-            \"name\": \"Order\",\n-            \"description\": \"saved order query\",\n-            \"query\": {\n-                \"searchText\": \"10253\",\n-                \"entityTypeIds\": [\n-                    \"Order\"\n-                ],\n-                \"selectedFacets\": {\n-                    \"orderDate\": {\n-                        \"dataType\": \"date\",\n-                        \"rangeValues\": {\n-                            \"lowerBound\": \"1994-03-01\",\n-                            \"upperBound\": \"2020-05-01\"\n-                        }\n-                    },\n-                    \"city\": {\n-                        \"dataType\": \"xs:string\",\n-                        \"stringValues\": [\n-                            \"Rio de Janeiro\"\n-                        ]\n-                    }\n-                }\n-            },\n-            \"propertiesToDisplay\": [\n-                \"facet1\",\n-                \"EntityTypeProperty1\"\n-            ],\n-            \"owner\": \"admin\",\n-            \"systemMetadata\": {\n-                \"createdBy\": \"admin\",\n-                \"createdDateTime\": \"2020-04-20T16:37:19.603846-07:00\",\n-                \"lastUpdatedBy\": \"admin\",\n-                \"lastUpdatedDateTime\": \"2020-04-20T16:37:19.603846-07:00\"\n+  {\n+    \"savedQuery\": {\n+      \"id\": \"edf7b2d1-62d2-481d-9bb0-2145b023ca5e\",\n+      \"name\": \"Order\",\n+      \"description\": \"saved order query\",\n+      \"query\": {\n+        \"searchText\": \"10253\",\n+        \"entityTypeIds\": [\n+          \"Order\"\n+        ],\n+        \"selectedFacets\": {\n+          \"orderDate\": {\n+            \"dataType\": \"date\",\n+            \"rangeValues\": {\n+              \"lowerBound\": \"1994-03-01\",\n+              \"upperBound\": \"2020-05-01\"\n             }\n+          },\n+          \"city\": {\n+            \"dataType\": \"xs:string\",\n+            \"stringValues\": [\n+              \"Rio de Janeiro\"\n+            ]\n+          }\n         }\n-    }]\n+      },\n+      \"propertiesToDisplay\": [\n+        \"facet1\",\n+        \"EntityTypeProperty1\"\n+      ],\n+      \"owner\": \"admin\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "600fcdc3da776a450e1621ba572c962c650883b6"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMDczNzE3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#pullrequestreview-401073717", "createdAt": "2020-04-27T15:35:58Z", "commit": {"oid": "600fcdc3da776a450e1621ba572c962c650883b6"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNTozNTo1OFrOGMpqiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNTo0MzoxOFrOGMqChg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkxODcyOQ==", "bodyText": "I think there needs to be some basic validation for the name field. If save a query as an empty string, it doesn't show up in the save query dropdown, but it shows in the manage queries table.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#discussion_r415918729", "createdAt": "2020-04-27T15:35:58Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/queries/saving/save-query-modal/save-query-modal.tsx", "diffHunk": "@@ -0,0 +1,154 @@\n+import React, {useState, useContext} from 'react';\n+import {Modal, Form, Input, Radio, Button} from 'antd';\n+import {SearchContext} from \"../../../../util/search-context\";\n+import styles from './save-query-modal.module.scss';\n+\n+interface Props {\n+    setSaveModalVisibility: () => void;\n+    saveNewQuery: (queryName: string, queryDescription: string,facets:{}) => void;\n+    greyFacets:any[];\n+    toggleApply: (clicked:boolean) => void;\n+    toggleApplyClicked: (clicked:boolean) => void;\n+}\n+\n+\n+const SaveQueryModal: React.FC<Props> = (props) => {\n+\n+    const {\n+        clearAllGreyFacets,\n+        greyedOptions,\n+        setAllSearchFacets,\n+        searchOptions,\n+    } = useContext(SearchContext);\n+\n+\n+    const [queryName, setQueryName] = useState('');\n+    const [queryDescription, setQueryDescription] = useState('');\n+    const [radioOptionClicked, setRadioOptionClicked] = useState(0);\n+    const [queryEmpty, isQueryEmpty] = useState<any>('');\n+\n+    const layout = {\n+        labelCol: { span: 6 },\n+        wrapperCol: { span: 18 },\n+    };\n+\n+    const onCancel = () => {\n+        props.setSaveModalVisibility();\n+    }\n+\n+    const onOk = () => {\n+        let facets = {...searchOptions.selectedFacets}\n+        switch(radioOptionClicked) {\n+            case 1:\n+                setAllSearchFacets(searchOptions.selectedFacets);\n+                setAllSearchFacets(greyedOptions.selectedFacets);\n+                facets = {...facets,...greyedOptions.selectedFacets};\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+                break;\n+            case 2:\n+                break;\n+            case 3:\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+        }\n+\n+        if(queryName.length > 0 ){\n+            props.saveNewQuery(queryName, queryDescription, facets);\n+        } else {\n+            isQueryEmpty('error')\n+        }\n+    }\n+\n+    const handleChange = (event) => {\n+        if (event.target.id === 'save-query-name') {\n+           setQueryName(event.target.value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "600fcdc3da776a450e1621ba572c962c650883b6"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkyNDg3MA==", "bodyText": "I think the save query dropdown should be cleared whenever a search request is made. See examples.\nhttps://drive.google.com/file/d/1lZWZGKOkRsbywOsd6R2W1A9H7JHAiWlH/view\nhttps://drive.google.com/file/d/1BmWFT9ifZ45-ld3uit6sgoyTIs6Ip2Yy/view", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#discussion_r415924870", "createdAt": "2020-04-27T15:43:18Z", "author": {"login": "brucean52"}, "path": "marklogic-data-hub-central/ui/src/components/queries/saving/save-queries-dropdown/save-queries-dropdown.tsx", "diffHunk": "@@ -0,0 +1,84 @@\n+import {Select} from \"antd\"\n+import React, {useContext} from 'react';\n+import styles from './save-queries-dropdown.module.scss';\n+import { UserContext } from \"../../../../util/user-context\";\n+import { SearchContext } from \"../../../../util/search-context\";\n+import {fetchQueryById} from \"../../../../api/queries\";\n+\n+\n+interface Props {\n+    savedQueryList: any[];\n+    toggleApply: (clicked:boolean) => void;\n+    greyFacets: any[];\n+};\n+\n+\n+const SaveQueriesDropdown: React.FC<Props> = (props) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "600fcdc3da776a450e1621ba572c962c650883b6"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "600fcdc3da776a450e1621ba572c962c650883b6", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/600fcdc3da776a450e1621ba572c962c650883b6", "committedDate": "2020-04-26T23:26:37Z", "message": "DHFPROD-4198:save queries"}, "afterCommit": {"oid": "32ce09ed82b827cce6573b9f175913c234f27cd5", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/32ce09ed82b827cce6573b9f175913c234f27cd5", "committedDate": "2020-04-27T15:44:31Z", "message": "DHFPROD-4198:save queries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMDc0OTUz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#pullrequestreview-401074953", "createdAt": "2020-04-27T15:37:18Z", "commit": {"oid": "600fcdc3da776a450e1621ba572c962c650883b6"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNTozNzoxOFrOGMpu0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNjowMDowOFrOGMrAIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkxOTgyNQ==", "bodyText": "since you have a placeholder, I dont think you would need data-testid. Please try and use getByPlaceholderText instead.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#discussion_r415919825", "createdAt": "2020-04-27T15:37:18Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/queries/saving/save-queries-dropdown/save-queries-dropdown.tsx", "diffHunk": "@@ -0,0 +1,84 @@\n+import {Select} from \"antd\"\n+import React, {useContext} from 'react';\n+import styles from './save-queries-dropdown.module.scss';\n+import { UserContext } from \"../../../../util/user-context\";\n+import { SearchContext } from \"../../../../util/search-context\";\n+import {fetchQueryById} from \"../../../../api/queries\";\n+\n+\n+interface Props {\n+    savedQueryList: any[];\n+    toggleApply: (clicked:boolean) => void;\n+    greyFacets: any[];\n+};\n+\n+\n+const SaveQueriesDropdown: React.FC<Props> = (props) => {\n+\n+    const {Option} = Select;\n+\n+    const {\n+        handleError,\n+        resetSessionTime\n+    } = useContext(UserContext);\n+    const {\n+        applySaveQuery,\n+        clearAllGreyFacets,\n+    } = useContext(SearchContext);\n+\n+    const savedQueryOptions = props.savedQueryList.map((key) => key.savedQuery.name);\n+\n+    const options = savedQueryOptions.map((query, index) =>\n+        <Option value={query} key={index}>{query}</Option>\n+    );\n+\n+\n+    const onItemSelect = (e) => {\n+        for(let key of props.savedQueryList)\n+        {\n+            if(key.savedQuery.name === e){\n+                getSaveQueryWithId(key);\n+                break;\n+            }\n+        }\n+    }\n+\n+    const getSaveQueryWithId = async (key) => {\n+        let searchText:string = '';\n+        let entityTypeIds:string[] = [];\n+        let selectedFacets:{} = {};\n+        try {\n+            const response = await fetchQueryById(key);\n+            if (response.data) {\n+                searchText = response.data.savedQuery.query.searchText;\n+                entityTypeIds = response.data.savedQuery.query.entityTypeIds;\n+                selectedFacets = response.data.savedQuery.query.selectedFacets;\n+                applySaveQuery(searchText, entityTypeIds, selectedFacets);\n+                if(props.greyFacets.length > 0){\n+                    clearAllGreyFacets();\n+                }\n+                props.toggleApply(false);\n+            }\n+        } catch (error) {\n+            handleError(error)\n+        } finally {\n+            resetSessionTime()\n+        }\n+    }\n+\n+    return (\n+        <Select\n+            id=\"dropdownList\"\n+            placeholder={'select a query'}\n+            defaultValue={'select a query'}\n+            className={styles.dropDownStyle}\n+            onChange={onItemSelect}\n+            data-testid={'drop-down-list'}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "600fcdc3da776a450e1621ba572c962c650883b6"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkyMzI4NQ==", "bodyText": "Above test \"renders without crashing\" is redundant since this one validates its fields. If it does crash, both these tests will fail for same reason.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#discussion_r415923285", "createdAt": "2020-04-27T15:41:24Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/queries/saving/save-query-modal/save-query-modal.test.tsx", "diffHunk": "@@ -0,0 +1,41 @@\n+import React from 'react';\n+import {fireEvent, render, wait} from \"@testing-library/react\";\n+import SaveQueryModal from './save-query-modal';\n+\n+describe(\"<SaveQueryModal/>\", () => {\n+\n+    let queryField, queryDescription\n+\n+    test(\"Save query modal renders without crashing\", async () => {\n+        const { getByTestId } = render(<SaveQueryModal\n+            setSaveModalVisibility={jest.fn()}\n+            saveNewQuery={jest.fn()}\n+            greyFacets= {\u00a0[{constraint:\u00a0\"lastname\",\u00a0facet:\u00a0\"Adams\",\u00a0displayName:\u00a0''},\n+            {constraint:\u00a0\"lastname\",\u00a0facet:\u00a0\"Coleman\",\u00a0displayName:\u00a0''}]}\n+            toggleApply= {jest.fn()}\n+            toggleApplyClicked={jest.fn()}\n+        />)\n+\n+        expect(getByTestId(\"save-query-name\")).toBeInTheDocument();\n+        expect(getByTestId(\"save-query-description\")).toBeInTheDocument();\n+        expect(getByTestId(\"unapplied-radio-options\")).toBeInTheDocument();\n+    });\n+\n+    test(\"Verify Save modal fields are rendered and can take input\", async () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "600fcdc3da776a450e1621ba572c962c650883b6"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkzODg3Mg==", "bodyText": "A bunch of data-testid with no corresponding test usage. Lets try to use data-testid as a last resort. Can you pls try using getByTitle instead.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#discussion_r415938872", "createdAt": "2020-04-27T15:57:56Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/queries/saving/save-query-modal/save-query-modal.tsx", "diffHunk": "@@ -0,0 +1,154 @@\n+import React, {useState, useContext} from 'react';\n+import {Modal, Form, Input, Radio, Button} from 'antd';\n+import {SearchContext} from \"../../../../util/search-context\";\n+import styles from './save-query-modal.module.scss';\n+\n+interface Props {\n+    setSaveModalVisibility: () => void;\n+    saveNewQuery: (queryName: string, queryDescription: string,facets:{}) => void;\n+    greyFacets:any[];\n+    toggleApply: (clicked:boolean) => void;\n+    toggleApplyClicked: (clicked:boolean) => void;\n+}\n+\n+\n+const SaveQueryModal: React.FC<Props> = (props) => {\n+\n+    const {\n+        clearAllGreyFacets,\n+        greyedOptions,\n+        setAllSearchFacets,\n+        searchOptions,\n+    } = useContext(SearchContext);\n+\n+\n+    const [queryName, setQueryName] = useState('');\n+    const [queryDescription, setQueryDescription] = useState('');\n+    const [radioOptionClicked, setRadioOptionClicked] = useState(0);\n+    const [queryEmpty, isQueryEmpty] = useState<any>('');\n+\n+    const layout = {\n+        labelCol: { span: 6 },\n+        wrapperCol: { span: 18 },\n+    };\n+\n+    const onCancel = () => {\n+        props.setSaveModalVisibility();\n+    }\n+\n+    const onOk = () => {\n+        let facets = {...searchOptions.selectedFacets}\n+        switch(radioOptionClicked) {\n+            case 1:\n+                setAllSearchFacets(searchOptions.selectedFacets);\n+                setAllSearchFacets(greyedOptions.selectedFacets);\n+                facets = {...facets,...greyedOptions.selectedFacets};\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+                break;\n+            case 2:\n+                break;\n+            case 3:\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+        }\n+\n+        if(queryName.length > 0 ){\n+            props.saveNewQuery(queryName, queryDescription, facets);\n+        } else {\n+            isQueryEmpty('error')\n+        }\n+    }\n+\n+    const handleChange = (event) => {\n+        if (event.target.id === 'save-query-name') {\n+           setQueryName(event.target.value);\n+        }\n+        if (event.target.id === 'save-query-description') {\n+           setQueryDescription(event.target.value);\n+        }\n+    }\n+\n+    const unAppliedFacets = (e) => {\n+        setRadioOptionClicked(e.target.value)\n+    }\n+\n+\n+    return (\n+        <Modal\n+            visible={true}\n+            title={'Save Query'}\n+            closable={true}\n+            onCancel={() => onCancel()}\n+            onOk={() => onOk()}\n+            maskClosable={true}\n+            footer={null}\n+            data-testid='save-query-modal'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32ce09ed82b827cce6573b9f175913c234f27cd5"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkzOTIxNw==", "bodyText": "Form labels dont need data-tetstid IMO.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#discussion_r415939217", "createdAt": "2020-04-27T15:58:22Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/queries/saving/save-query-modal/save-query-modal.tsx", "diffHunk": "@@ -0,0 +1,154 @@\n+import React, {useState, useContext} from 'react';\n+import {Modal, Form, Input, Radio, Button} from 'antd';\n+import {SearchContext} from \"../../../../util/search-context\";\n+import styles from './save-query-modal.module.scss';\n+\n+interface Props {\n+    setSaveModalVisibility: () => void;\n+    saveNewQuery: (queryName: string, queryDescription: string,facets:{}) => void;\n+    greyFacets:any[];\n+    toggleApply: (clicked:boolean) => void;\n+    toggleApplyClicked: (clicked:boolean) => void;\n+}\n+\n+\n+const SaveQueryModal: React.FC<Props> = (props) => {\n+\n+    const {\n+        clearAllGreyFacets,\n+        greyedOptions,\n+        setAllSearchFacets,\n+        searchOptions,\n+    } = useContext(SearchContext);\n+\n+\n+    const [queryName, setQueryName] = useState('');\n+    const [queryDescription, setQueryDescription] = useState('');\n+    const [radioOptionClicked, setRadioOptionClicked] = useState(0);\n+    const [queryEmpty, isQueryEmpty] = useState<any>('');\n+\n+    const layout = {\n+        labelCol: { span: 6 },\n+        wrapperCol: { span: 18 },\n+    };\n+\n+    const onCancel = () => {\n+        props.setSaveModalVisibility();\n+    }\n+\n+    const onOk = () => {\n+        let facets = {...searchOptions.selectedFacets}\n+        switch(radioOptionClicked) {\n+            case 1:\n+                setAllSearchFacets(searchOptions.selectedFacets);\n+                setAllSearchFacets(greyedOptions.selectedFacets);\n+                facets = {...facets,...greyedOptions.selectedFacets};\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+                break;\n+            case 2:\n+                break;\n+            case 3:\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+        }\n+\n+        if(queryName.length > 0 ){\n+            props.saveNewQuery(queryName, queryDescription, facets);\n+        } else {\n+            isQueryEmpty('error')\n+        }\n+    }\n+\n+    const handleChange = (event) => {\n+        if (event.target.id === 'save-query-name') {\n+           setQueryName(event.target.value);\n+        }\n+        if (event.target.id === 'save-query-description') {\n+           setQueryDescription(event.target.value);\n+        }\n+    }\n+\n+    const unAppliedFacets = (e) => {\n+        setRadioOptionClicked(e.target.value)\n+    }\n+\n+\n+    return (\n+        <Modal\n+            visible={true}\n+            title={'Save Query'}\n+            closable={true}\n+            onCancel={() => onCancel()}\n+            onOk={() => onOk()}\n+            maskClosable={true}\n+            footer={null}\n+            data-testid='save-query-modal'\n+        >\n+            <Form\n+                name=\"basic\"\n+                {...layout}\n+            >\n+                <Form.Item\n+                    colon={false}\n+                    label={<span className={styles.text}>\n+                           Name:&nbsp;<span className={styles.asterisk}>*</span>&nbsp;\n+                        </span>}\n+                    labelAlign=\"left\"\n+                    validateStatus={queryEmpty}\n+                    help={ queryEmpty === 'error' ? 'Query name is required' : ''}\n+                    data-testid='save-query-name'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32ce09ed82b827cce6573b9f175913c234f27cd5"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk0MDQzMA==", "bodyText": "Same as above. Dont think form labels need data-testid, when the input field or the field we need to interact with in a test can be uniquely identified using non data-testid selectors.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#discussion_r415940430", "createdAt": "2020-04-27T15:59:51Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/queries/saving/save-query-modal/save-query-modal.tsx", "diffHunk": "@@ -0,0 +1,154 @@\n+import React, {useState, useContext} from 'react';\n+import {Modal, Form, Input, Radio, Button} from 'antd';\n+import {SearchContext} from \"../../../../util/search-context\";\n+import styles from './save-query-modal.module.scss';\n+\n+interface Props {\n+    setSaveModalVisibility: () => void;\n+    saveNewQuery: (queryName: string, queryDescription: string,facets:{}) => void;\n+    greyFacets:any[];\n+    toggleApply: (clicked:boolean) => void;\n+    toggleApplyClicked: (clicked:boolean) => void;\n+}\n+\n+\n+const SaveQueryModal: React.FC<Props> = (props) => {\n+\n+    const {\n+        clearAllGreyFacets,\n+        greyedOptions,\n+        setAllSearchFacets,\n+        searchOptions,\n+    } = useContext(SearchContext);\n+\n+\n+    const [queryName, setQueryName] = useState('');\n+    const [queryDescription, setQueryDescription] = useState('');\n+    const [radioOptionClicked, setRadioOptionClicked] = useState(0);\n+    const [queryEmpty, isQueryEmpty] = useState<any>('');\n+\n+    const layout = {\n+        labelCol: { span: 6 },\n+        wrapperCol: { span: 18 },\n+    };\n+\n+    const onCancel = () => {\n+        props.setSaveModalVisibility();\n+    }\n+\n+    const onOk = () => {\n+        let facets = {...searchOptions.selectedFacets}\n+        switch(radioOptionClicked) {\n+            case 1:\n+                setAllSearchFacets(searchOptions.selectedFacets);\n+                setAllSearchFacets(greyedOptions.selectedFacets);\n+                facets = {...facets,...greyedOptions.selectedFacets};\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+                break;\n+            case 2:\n+                break;\n+            case 3:\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+        }\n+\n+        if(queryName.length > 0 ){\n+            props.saveNewQuery(queryName, queryDescription, facets);\n+        } else {\n+            isQueryEmpty('error')\n+        }\n+    }\n+\n+    const handleChange = (event) => {\n+        if (event.target.id === 'save-query-name') {\n+           setQueryName(event.target.value);\n+        }\n+        if (event.target.id === 'save-query-description') {\n+           setQueryDescription(event.target.value);\n+        }\n+    }\n+\n+    const unAppliedFacets = (e) => {\n+        setRadioOptionClicked(e.target.value)\n+    }\n+\n+\n+    return (\n+        <Modal\n+            visible={true}\n+            title={'Save Query'}\n+            closable={true}\n+            onCancel={() => onCancel()}\n+            onOk={() => onOk()}\n+            maskClosable={true}\n+            footer={null}\n+            data-testid='save-query-modal'\n+        >\n+            <Form\n+                name=\"basic\"\n+                {...layout}\n+            >\n+                <Form.Item\n+                    colon={false}\n+                    label={<span className={styles.text}>\n+                           Name:&nbsp;<span className={styles.asterisk}>*</span>&nbsp;\n+                        </span>}\n+                    labelAlign=\"left\"\n+                    validateStatus={queryEmpty}\n+                    help={ queryEmpty === 'error' ? 'Query name is required' : ''}\n+                    data-testid='save-query-name'\n+                >\n+                    <Input\n+                        id=\"save-query-name\"\n+                        value={queryName}\n+                        placeholder={'Enter query name'}\n+                        onChange={handleChange}\n+                    />\n+                </Form.Item>\n+                <Form.Item\n+                    colon={false}\n+                    label='Description:'\n+                    labelAlign=\"left\"\n+                    data-testid='save-query-description'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32ce09ed82b827cce6573b9f175913c234f27cd5"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk0MDY0Mw==", "bodyText": "Same as above.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#discussion_r415940643", "createdAt": "2020-04-27T16:00:08Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/queries/saving/save-query-modal/save-query-modal.tsx", "diffHunk": "@@ -0,0 +1,154 @@\n+import React, {useState, useContext} from 'react';\n+import {Modal, Form, Input, Radio, Button} from 'antd';\n+import {SearchContext} from \"../../../../util/search-context\";\n+import styles from './save-query-modal.module.scss';\n+\n+interface Props {\n+    setSaveModalVisibility: () => void;\n+    saveNewQuery: (queryName: string, queryDescription: string,facets:{}) => void;\n+    greyFacets:any[];\n+    toggleApply: (clicked:boolean) => void;\n+    toggleApplyClicked: (clicked:boolean) => void;\n+}\n+\n+\n+const SaveQueryModal: React.FC<Props> = (props) => {\n+\n+    const {\n+        clearAllGreyFacets,\n+        greyedOptions,\n+        setAllSearchFacets,\n+        searchOptions,\n+    } = useContext(SearchContext);\n+\n+\n+    const [queryName, setQueryName] = useState('');\n+    const [queryDescription, setQueryDescription] = useState('');\n+    const [radioOptionClicked, setRadioOptionClicked] = useState(0);\n+    const [queryEmpty, isQueryEmpty] = useState<any>('');\n+\n+    const layout = {\n+        labelCol: { span: 6 },\n+        wrapperCol: { span: 18 },\n+    };\n+\n+    const onCancel = () => {\n+        props.setSaveModalVisibility();\n+    }\n+\n+    const onOk = () => {\n+        let facets = {...searchOptions.selectedFacets}\n+        switch(radioOptionClicked) {\n+            case 1:\n+                setAllSearchFacets(searchOptions.selectedFacets);\n+                setAllSearchFacets(greyedOptions.selectedFacets);\n+                facets = {...facets,...greyedOptions.selectedFacets};\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+                break;\n+            case 2:\n+                break;\n+            case 3:\n+                clearAllGreyFacets();\n+                props.toggleApplyClicked(true);\n+                props.toggleApply(false);\n+        }\n+\n+        if(queryName.length > 0 ){\n+            props.saveNewQuery(queryName, queryDescription, facets);\n+        } else {\n+            isQueryEmpty('error')\n+        }\n+    }\n+\n+    const handleChange = (event) => {\n+        if (event.target.id === 'save-query-name') {\n+           setQueryName(event.target.value);\n+        }\n+        if (event.target.id === 'save-query-description') {\n+           setQueryDescription(event.target.value);\n+        }\n+    }\n+\n+    const unAppliedFacets = (e) => {\n+        setRadioOptionClicked(e.target.value)\n+    }\n+\n+\n+    return (\n+        <Modal\n+            visible={true}\n+            title={'Save Query'}\n+            closable={true}\n+            onCancel={() => onCancel()}\n+            onOk={() => onOk()}\n+            maskClosable={true}\n+            footer={null}\n+            data-testid='save-query-modal'\n+        >\n+            <Form\n+                name=\"basic\"\n+                {...layout}\n+            >\n+                <Form.Item\n+                    colon={false}\n+                    label={<span className={styles.text}>\n+                           Name:&nbsp;<span className={styles.asterisk}>*</span>&nbsp;\n+                        </span>}\n+                    labelAlign=\"left\"\n+                    validateStatus={queryEmpty}\n+                    help={ queryEmpty === 'error' ? 'Query name is required' : ''}\n+                    data-testid='save-query-name'\n+                >\n+                    <Input\n+                        id=\"save-query-name\"\n+                        value={queryName}\n+                        placeholder={'Enter query name'}\n+                        onChange={handleChange}\n+                    />\n+                </Form.Item>\n+                <Form.Item\n+                    colon={false}\n+                    label='Description:'\n+                    labelAlign=\"left\"\n+                    data-testid='save-query-description'\n+                >\n+                    <Input\n+                        id=\"save-query-description\"\n+                        value={queryDescription}\n+                        onChange={handleChange}\n+                        placeholder={'Enter query description'}\n+                    />\n+                </Form.Item>\n+                {props.greyFacets.length > 0  && <Form.Item\n+                    colon={false}\n+                    label='Unapplied Facets:'\n+                    labelAlign=\"left\"\n+                    data-testid='unapplied-radio-options'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32ce09ed82b827cce6573b9f175913c234f27cd5"}, "originalPosition": 128}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32ce09ed82b827cce6573b9f175913c234f27cd5", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/32ce09ed82b827cce6573b9f175913c234f27cd5", "committedDate": "2020-04-27T15:44:31Z", "message": "DHFPROD-4198:save queries"}, "afterCommit": {"oid": "f4a130644a2b112355d005d849279cb491289746", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/f4a130644a2b112355d005d849279cb491289746", "committedDate": "2020-04-27T16:44:45Z", "message": "DHFPROD-4198:save queries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4a130644a2b112355d005d849279cb491289746", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/f4a130644a2b112355d005d849279cb491289746", "committedDate": "2020-04-27T16:44:45Z", "message": "DHFPROD-4198:save queries"}, "afterCommit": {"oid": "95ff19a2619e295ce4a720a8922cde3236ed7d8a", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/95ff19a2619e295ce4a720a8922cde3236ed7d8a", "committedDate": "2020-04-27T18:11:14Z", "message": "DHFPROD-4198:save queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcbdd38948ffb3a5971ac3d4c00b855ef5d3b159", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/fcbdd38948ffb3a5971ac3d4c00b855ef5d3b159", "committedDate": "2020-04-27T18:59:15Z", "message": "DHFPROD-4198:save queries"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95ff19a2619e295ce4a720a8922cde3236ed7d8a", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/95ff19a2619e295ce4a720a8922cde3236ed7d8a", "committedDate": "2020-04-27T18:11:14Z", "message": "DHFPROD-4198:save queries"}, "afterCommit": {"oid": "fcbdd38948ffb3a5971ac3d4c00b855ef5d3b159", "author": {"user": {"login": "Sanjeevani19", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/fcbdd38948ffb3a5971ac3d4c00b855ef5d3b159", "committedDate": "2020-04-27T18:59:15Z", "message": "DHFPROD-4198:save queries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMjQ2ODY1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#pullrequestreview-401246865", "createdAt": "2020-04-27T19:09:47Z", "commit": {"oid": "fcbdd38948ffb3a5971ac3d4c00b855ef5d3b159"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMjYwMDc2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3872#pullrequestreview-401260076", "createdAt": "2020-04-27T19:28:09Z", "commit": {"oid": "fcbdd38948ffb3a5971ac3d4c00b855ef5d3b159"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3119, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}