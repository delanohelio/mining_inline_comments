{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0Nzk0NjEw", "number": 3830, "title": "DHFPROD-3650: Delete saved personal queries feature", "bodyText": "Description\nDelete saved personal queries feature\nRefactoring Search API to match with SavedQueries feature\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-04-16T22:23:02Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3830", "merged": true, "mergeCommit": {"oid": "7d46624824836574367126e9a6720153d7c24811"}, "closed": true, "closedAt": "2020-04-17T17:14:06Z", "author": {"login": "rahulvudutala"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYWMAAgFqTM5NTA4NTg2NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYkYnYAFqTM5NTYyNTAxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDg1ODY0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3830#pullrequestreview-395085864", "createdAt": "2020-04-17T00:26:23Z", "commit": {"oid": "8f176af8a985cc27278a98c02b48095dc128b877"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwMDoyNjoyNFrOGG7wnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwMDoyOTo1MlrOGG70xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkyMzc0MA==", "bodyText": "I'm of the opinion that it's perfectly fine just to toss the test of deletion onto an existing test method, like the existing createThenUpdate test. Fewer test methods means less time setting up tests, which means our test suite is faster.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3830#discussion_r409923740", "createdAt": "2020-04-17T00:26:24Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/controllers/EntitySearchControllerTest.java", "diffHunk": "@@ -110,4 +110,38 @@ void getSavedQuery() throws Exception {\n                     assertEquals(savedQueryResponse.get(\"savedQuery\").get(\"id\").asText(), response.get(\"savedQuery\").get(\"id\").asText());\n                 });\n     }\n+\n+    @Test\n+    void deleteSavedQuery() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f176af8a985cc27278a98c02b48095dc128b877"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkyNDgwNA==", "bodyText": "For deleting a document, since we know what the URI should be, just do:\nif (cts.exists(cts.documentQuery(uri)) then delete the uri\n\nWe only want to use cts.search when we want the document back.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3830#discussion_r409924804", "createdAt": "2020-04-17T00:29:52Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/data-services/entitySearch/deleteSavedQuery.sjs", "diffHunk": "@@ -0,0 +1,12 @@\n+'use strict';\n+declareUpdate();\n+\n+var id;\n+\n+let savedQuery = cts.search(cts.andQuery([cts.collectionQuery(\"http://marklogic.com/data-hub/saved-query\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f176af8a985cc27278a98c02b48095dc128b877"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af7024da2af0e2cc9389b1e22b4d0c71c806da18", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/af7024da2af0e2cc9389b1e22b4d0c71c806da18", "committedDate": "2020-04-17T02:32:21Z", "message": "DHFPROD-3650: Delete saved personal queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3e2e34607c2cca813187f3b822215ea73449138", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d3e2e34607c2cca813187f3b822215ea73449138", "committedDate": "2020-04-17T02:32:37Z", "message": "DHFPROD-3650: Refactoring Search API to match with SavedQueries feature"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8f176af8a985cc27278a98c02b48095dc128b877", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/8f176af8a985cc27278a98c02b48095dc128b877", "committedDate": "2020-04-16T18:16:26Z", "message": "DHFPROD-3650: Refactoring Search API to match with SavedQueries feature"}, "afterCommit": {"oid": "d3e2e34607c2cca813187f3b822215ea73449138", "author": {"user": {"login": "rahulvudutala", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d3e2e34607c2cca813187f3b822215ea73449138", "committedDate": "2020-04-17T02:32:37Z", "message": "DHFPROD-3650: Refactoring Search API to match with SavedQueries feature"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MzY2NzYz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3830#pullrequestreview-395366763", "createdAt": "2020-04-17T11:13:26Z", "commit": {"oid": "d3e2e34607c2cca813187f3b822215ea73449138"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMToxMzoyNlrOGHJ7KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMToxMzoyNlrOGHJ7KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE1NTgxNg==", "bodyText": "Pinging @ryanjdew on this - I am wondering what is needed for security here. Just occurred to me that we presumably at least need a check on the owner of the saved query being the same as the MarkLogic user that's connecting, right? Otherwise one user could delete anyone's saved query.\n@rahulvudutala Is there a role required for creating/deleting saved queries? If so, I believe we want an xdmp.securityAssert check here. I defer to @ryanjdew on whether we want to start requiring this now or wait a couple more stories, as @ryanjdew is getting a policy into place where we secure all of our DS endpoints with an xdmp.securityAssert check.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3830#discussion_r410155816", "createdAt": "2020-04-17T11:13:26Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/data-services/entitySearch/deleteSavedQuery.sjs", "diffHunk": "@@ -0,0 +1,10 @@\n+'use strict';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3e2e34607c2cca813187f3b822215ea73449138"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MzY3MDIz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3830#pullrequestreview-395367023", "createdAt": "2020-04-17T11:13:54Z", "commit": {"oid": "d3e2e34607c2cca813187f3b822215ea73449138"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NjIxNzkw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3830#pullrequestreview-395621790", "createdAt": "2020-04-17T16:58:53Z", "commit": {"oid": "d3e2e34607c2cca813187f3b822215ea73449138"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NjI1MDEz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3830#pullrequestreview-395625013", "createdAt": "2020-04-17T17:03:44Z", "commit": {"oid": "d3e2e34607c2cca813187f3b822215ea73449138"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3035, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}