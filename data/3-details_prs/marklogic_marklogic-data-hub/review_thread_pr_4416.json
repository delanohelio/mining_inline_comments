{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4ODUwNjQ3", "number": 4416, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDoxMTo0MlrOEZEBUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNzoxNDoyNlrOEZIxFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzE1NzMwOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/migration/FlowMigrator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDoxMTo0MlrOHBqdJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToxMTowMVrOHBs5nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUwNjIxMg==", "bodyText": "While I'd normally say it's good to add methods like this to Step, I want to get away from classes like Step, which are incomplete representations of JSON objects. For the purpose of FlowMigrator, just check the original ObjectNode to see if it only has one key, and if the name of that key is stepId.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4416#discussion_r471506212", "createdAt": "2020-08-17T14:11:42Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/migration/FlowMigrator.java", "diffHunk": "@@ -149,6 +149,10 @@ public void migrateFlows() {\n             ObjectNode newSteps = nodeFactory.objectNode();\n             for (Map.Entry<String, Step> entry : steps.entrySet()) {\n                 Step step = entry.getValue();\n+                if (step.getIsOnlyStepId()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73e8c6ec9278a4339e978a6f5c77c1b277882236"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0NjI2OQ==", "bodyText": "There was no way to get to the JSON after getLocalFlow() executed, so I had to save a reference to the JsonNode in Step. (and hid it from serialization with an attribute)", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4416#discussion_r471546269", "createdAt": "2020-08-17T15:11:01Z", "author": {"login": "fsnow"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/migration/FlowMigrator.java", "diffHunk": "@@ -149,6 +149,10 @@ public void migrateFlows() {\n             ObjectNode newSteps = nodeFactory.objectNode();\n             for (Map.Entry<String, Step> entry : steps.entrySet()) {\n                 Step step = entry.getValue();\n+                if (step.getIsOnlyStepId()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUwNjIxMg=="}, "originalCommit": {"oid": "73e8c6ec9278a4339e978a6f5c77c1b277882236"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzU5NTg2OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/migration/FlowMigrator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTo1MjoyMVrOHBunsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjowOToxMFrOHBvRhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU3NDQ1MQ==", "bodyText": "Argh, sorry, I didn't realize the ObjectNode wasn't available. I think it's fine then to add stepId to the Step class. FlowMigrator can just say - if stepId is populated, then I don't need to migrate it. Then you don't need the stepJson JsonNode in Step.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4416#discussion_r471574451", "createdAt": "2020-08-17T15:52:21Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/migration/FlowMigrator.java", "diffHunk": "@@ -149,6 +149,11 @@ public void migrateFlows() {\n             ObjectNode newSteps = nodeFactory.objectNode();\n             for (Map.Entry<String, Step> entry : steps.entrySet()) {\n                 Step step = entry.getValue();\n+                JsonNode stepJson = step.getStepJson();\n+                if (stepJson.has(\"stepId\") && stepJson.size() == 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b19a5419ee8be30bc07a72c933340d04aa5ec285"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4NTE1Nw==", "bodyText": "ok, I modified it to test for stepId not null.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4416#discussion_r471585157", "createdAt": "2020-08-17T16:09:10Z", "author": {"login": "fsnow"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/migration/FlowMigrator.java", "diffHunk": "@@ -149,6 +149,11 @@ public void migrateFlows() {\n             ObjectNode newSteps = nodeFactory.objectNode();\n             for (Map.Entry<String, Step> entry : steps.entrySet()) {\n                 Step step = entry.getValue();\n+                JsonNode stepJson = step.getStepJson();\n+                if (stepJson.has(\"stepId\") && stepJson.size() == 1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU3NDQ1MQ=="}, "originalCommit": {"oid": "b19a5419ee8be30bc07a72c933340d04aa5ec285"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzkzNDkzOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/migration/FlowMigrator.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNzoxNDoyNlrOHBx-6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNzozNToyNVrOHBzUag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYyOTU0NA==", "bodyText": "The flow document is migrated and hence steps will already have  \"stepId\" . So, do we have to set \"stepId\" again in the flow ?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4416#discussion_r471629544", "createdAt": "2020-08-17T17:14:26Z", "author": {"login": "srinathgit"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/migration/FlowMigrator.java", "diffHunk": "@@ -149,6 +149,10 @@ public void migrateFlows() {\n             ObjectNode newSteps = nodeFactory.objectNode();\n             for (Map.Entry<String, Step> entry : steps.entrySet()) {\n                 Step step = entry.getValue();\n+                if (step.getStepId() != null) {\n+                    newSteps.set(entry.getKey(), nodeFactory.objectNode().put(\"stepId\", step.getStepId()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53762be987e768df3b1d88d16b24c1a6f83592b0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYzNDQzNQ==", "bodyText": "I believe so, since \"newSteps\" is assigned to the flow.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4416#discussion_r471634435", "createdAt": "2020-08-17T17:18:29Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/migration/FlowMigrator.java", "diffHunk": "@@ -149,6 +149,10 @@ public void migrateFlows() {\n             ObjectNode newSteps = nodeFactory.objectNode();\n             for (Map.Entry<String, Step> entry : steps.entrySet()) {\n                 Step step = entry.getValue();\n+                if (step.getStepId() != null) {\n+                    newSteps.set(entry.getKey(), nodeFactory.objectNode().put(\"stepId\", step.getStepId()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYyOTU0NA=="}, "originalCommit": {"oid": "53762be987e768df3b1d88d16b24c1a6f83592b0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY0MDYyNA==", "bodyText": "But since the flow is already migrated, shouldn't it already have 'stepId' rather than inline steps ? so, we don't have to set 'stepId's in flow again right ?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4416#discussion_r471640624", "createdAt": "2020-08-17T17:23:23Z", "author": {"login": "srinathgit"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/migration/FlowMigrator.java", "diffHunk": "@@ -149,6 +149,10 @@ public void migrateFlows() {\n             ObjectNode newSteps = nodeFactory.objectNode();\n             for (Map.Entry<String, Step> entry : steps.entrySet()) {\n                 Step step = entry.getValue();\n+                if (step.getStepId() != null) {\n+                    newSteps.set(entry.getKey(), nodeFactory.objectNode().put(\"stepId\", step.getStepId()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYyOTU0NA=="}, "originalCommit": {"oid": "53762be987e768df3b1d88d16b24c1a6f83592b0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY1MTQzNA==", "bodyText": "Yes, because it is building a new flow. You have to transfer the minimal {\"1\": \"stepId\"} to the new flow.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4416#discussion_r471651434", "createdAt": "2020-08-17T17:35:25Z", "author": {"login": "fsnow"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/hubcentral/migration/FlowMigrator.java", "diffHunk": "@@ -149,6 +149,10 @@ public void migrateFlows() {\n             ObjectNode newSteps = nodeFactory.objectNode();\n             for (Map.Entry<String, Step> entry : steps.entrySet()) {\n                 Step step = entry.getValue();\n+                if (step.getStepId() != null) {\n+                    newSteps.set(entry.getKey(), nodeFactory.objectNode().put(\"stepId\", step.getStepId()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYyOTU0NA=="}, "originalCommit": {"oid": "53762be987e768df3b1d88d16b24c1a6f83592b0"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3806, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}