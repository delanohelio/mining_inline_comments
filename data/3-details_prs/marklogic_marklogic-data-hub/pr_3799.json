{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMDEwNTUz", "number": 3799, "title": "DHFPROD-4173: Apply additional settings in flow runner", "bodyText": "Description\nCertain settings weren't being accounted for when running a data load. Reading in those settings now. I also added the missing target format on the mapping settings form.\nhttps://drive.google.com/open?id=1ymeBD_m5KvOnUBtLo3d_DVFFbEJFErW4\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-04-08T18:34:43Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799", "merged": true, "mergeCommit": {"oid": "db432ac090479a1704239d25edb7024ea40240cb"}, "closed": true, "closedAt": "2020-04-13T16:38:15Z", "author": {"login": "ryanjdew"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVsVSbABqjMyMTUzNTMzNDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXGmDUAFqTM5MTk0MDEwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c84f1d72920c90b010c2d24400349641eee3c926", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c84f1d72920c90b010c2d24400349641eee3c926", "committedDate": "2020-04-08T18:24:09Z", "message": "DHFPROD-4173: Apply additional settings in flow runner"}, "afterCommit": {"oid": "1bfb86814af7278ed68940f5c6ee2d0076db8dc8", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1bfb86814af7278ed68940f5c6ee2d0076db8dc8", "committedDate": "2020-04-08T18:37:17Z", "message": "DHFPROD-4173: Apply additional settings in flow runner"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMjU1NDI3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#pullrequestreview-390255427", "createdAt": "2020-04-08T19:10:01Z", "commit": {"oid": "1bfb86814af7278ed68940f5c6ee2d0076db8dc8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOToxMDowMVrOGC9I6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOToxNTo0MFrOGC9VJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1MjA0MA==", "bodyText": "Shouldn't there be a unit test against getArtifactSettings for a mapping to verify that the defaults are returned if there aren't settings yet?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#discussion_r405752040", "createdAt": "2020-04-08T19:10:01Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/mappings.sjs", "diffHunk": "@@ -91,5 +102,6 @@ module.exports = {\n     getPermissions,\n     getArtifactNode,\n     validateArtifact,\n-    getArtifactSettingNode\n+    getArtifactSettingNode,\n+    defaultArtifactSettings", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bfb86814af7278ed68940f5c6ee2d0076db8dc8"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NTE3Mw==", "bodyText": "I think verifyThatLoadDataSettingsAreAppliedToStepConfig in FlowRunnerTest should be expanded to cover these fixes.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#discussion_r405755173", "createdAt": "2020-04-08T19:15:40Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/flow/impl/FlowRunnerImpl.java", "diffHunk": "@@ -657,17 +657,32 @@ protected void applyArtifactSettings(Step step, Map<String, Object> stepConfig)\n                     if (artifactSettingsJson.hasNonNull(\"customHook\")) {\n                         step.setCustomHook(artifactSettingsJson.get(\"customHook\"));\n                     }\n-                    List<String> stepOptionProperties = Arrays.asList(\"collections\", \"permissions\");\n                     ObjectMapper mapper = new ObjectMapper();\n+                    List<String> collections = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bfb86814af7278ed68940f5c6ee2d0076db8dc8"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bfb86814af7278ed68940f5c6ee2d0076db8dc8", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1bfb86814af7278ed68940f5c6ee2d0076db8dc8", "committedDate": "2020-04-08T18:37:17Z", "message": "DHFPROD-4173: Apply additional settings in flow runner"}, "afterCommit": {"oid": "98ac376b72dbb9aac2f89a7bbee0dfb5d6087dcf", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/98ac376b72dbb9aac2f89a7bbee0dfb5d6087dcf", "committedDate": "2020-04-08T20:06:35Z", "message": "DHFPROD-4173: Apply additional settings in flow runner"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzA2MjM5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#pullrequestreview-390306239", "createdAt": "2020-04-08T20:27:13Z", "commit": {"oid": "98ac376b72dbb9aac2f89a7bbee0dfb5d6087dcf"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzA5MTYz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#pullrequestreview-390309163", "createdAt": "2020-04-08T20:31:38Z", "commit": {"oid": "98ac376b72dbb9aac2f89a7bbee0dfb5d6087dcf"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzUxNjcz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#pullrequestreview-390351673", "createdAt": "2020-04-08T21:39:46Z", "commit": {"oid": "98ac376b72dbb9aac2f89a7bbee0dfb5d6087dcf"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzUzNzQ3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#pullrequestreview-390353747", "createdAt": "2020-04-08T21:43:41Z", "commit": {"oid": "98ac376b72dbb9aac2f89a7bbee0dfb5d6087dcf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTo0Mzo0MVrOGDCEnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTo0Mzo0MVrOGDCEnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgzMjg2Mw==", "bodyText": "@ryanjdew wondering if this should be default-mapping or entity-services-mapping?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#discussion_r405832863", "createdAt": "2020-04-08T21:43:41Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/artifacts/mappings.sjs", "diffHunk": "@@ -83,6 +83,17 @@ function getArtifactSettingNode(collectionName, artifactName, artifactVersion) {\n   return fn.head(results);\n }\n \n+function defaultArtifactSettings(artifactName) {\n+    return {\n+        artifactName,\n+        collections: ['default-mapping'],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98ac376b72dbb9aac2f89a7bbee0dfb5d6087dcf"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98ac376b72dbb9aac2f89a7bbee0dfb5d6087dcf", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/98ac376b72dbb9aac2f89a7bbee0dfb5d6087dcf", "committedDate": "2020-04-08T20:06:35Z", "message": "DHFPROD-4173: Apply additional settings in flow runner"}, "afterCommit": {"oid": "856b315dade6f23cd27dde5ba1b58ad41b9b95d0", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/856b315dade6f23cd27dde5ba1b58ad41b9b95d0", "committedDate": "2020-04-08T22:08:57Z", "message": "DHFPROD-4173: Apply additional settings in flow runner"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNDE0ODUw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#pullrequestreview-390414850", "createdAt": "2020-04-09T00:17:36Z", "commit": {"oid": "856b315dade6f23cd27dde5ba1b58ad41b9b95d0"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNDQwMzk0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#pullrequestreview-390440394", "createdAt": "2020-04-09T01:46:48Z", "commit": {"oid": "856b315dade6f23cd27dde5ba1b58ad41b9b95d0"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "856b315dade6f23cd27dde5ba1b58ad41b9b95d0", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/856b315dade6f23cd27dde5ba1b58ad41b9b95d0", "committedDate": "2020-04-08T22:08:57Z", "message": "DHFPROD-4173: Apply additional settings in flow runner"}, "afterCommit": {"oid": "643a4ae543e6fe32f967371fe729f394d0a7a37f", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/643a4ae543e6fe32f967371fe729f394d0a7a37f", "committedDate": "2020-04-09T16:15:22Z", "message": "DHFPROD-4173: Apply additional settings in flow runner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "601d6087322feac123649c4a17793c5fe1584f93", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/601d6087322feac123649c4a17793c5fe1584f93", "committedDate": "2020-04-09T20:41:55Z", "message": "DHFPROD-4173: Apply additional settings in flow runner"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "643a4ae543e6fe32f967371fe729f394d0a7a37f", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/643a4ae543e6fe32f967371fe729f394d0a7a37f", "committedDate": "2020-04-09T16:15:22Z", "message": "DHFPROD-4173: Apply additional settings in flow runner"}, "afterCommit": {"oid": "601d6087322feac123649c4a17793c5fe1584f93", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/601d6087322feac123649c4a17793c5fe1584f93", "committedDate": "2020-04-09T20:41:55Z", "message": "DHFPROD-4173: Apply additional settings in flow runner"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMTgzOTAz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#pullrequestreview-391183903", "createdAt": "2020-04-09T22:58:53Z", "commit": {"oid": "601d6087322feac123649c4a17793c5fe1584f93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxOTQwMTA1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3799#pullrequestreview-391940105", "createdAt": "2020-04-13T03:47:20Z", "commit": {"oid": "601d6087322feac123649c4a17793c5fe1584f93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3007, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}