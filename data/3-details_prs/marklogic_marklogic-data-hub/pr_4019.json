{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0Njc0Nzkw", "number": 4019, "title": "DHFPROD-4672: Add hub-central-load-writer role", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-05-28T19:03:00Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019", "merged": true, "mergeCommit": {"oid": "7a98381678a9474fa9a50343280bad7bb8334c7e"}, "closed": true, "closedAt": "2020-06-02T15:35:18Z", "author": {"login": "ryanjdew"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmFIVbAFqTQyMTExMDA5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnT-38AFqTQyMjYyMjgyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMTEwMDkx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#pullrequestreview-421110091", "createdAt": "2020-05-29T16:33:49Z", "commit": {"oid": "963a458401d6d6714caf7e980223b40f9322215d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNjozMzo1MFrOGcj75Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxNjozMzo1MFrOGcj75Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYwMjA4NQ==", "bodyText": "should data-hub-ingestion-writer get data-hub-common-writer role just like data-hub-mapping-writer", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#discussion_r432602085", "createdAt": "2020-05-29T16:33:50Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/roles/data-hub-ingestion-writer.json", "diffHunk": "@@ -1,4 +1,7 @@\n {\n   \"role-name\": \"data-hub-ingestion-writer\",\n-  \"description\": \"Permits reading a load data configuration\"\n+  \"description\": \"Permits reading a load data configuration\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "963a458401d6d6714caf7e980223b40f9322215d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDI1NDMw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#pullrequestreview-421425430", "createdAt": "2020-05-30T16:20:40Z", "commit": {"oid": "963a458401d6d6714caf7e980223b40f9322215d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxNjoyMDo0MFrOGc0Iqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxNjoyMzowMFrOGc0JPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg2NzQ5OQ==", "bodyText": "One downside to JSON is we don't have a way to have inline comments about why a privilege is needed. I've used README.md files in the same directory as JSON files before to provide those comments. But those can be difficult to keep in sync - someone has to remember to update them.\nIn theory though, if someone wonders why this privilege is set, they could remove it and run the test suite and something should fail, which would point out what code needs the privilege, right?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#discussion_r432867499", "createdAt": "2020-05-30T16:20:40Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/roles/data-hub-common-writer.json", "diffHunk": "@@ -29,6 +29,11 @@\n       \"privilege-name\": \"rest-writer\",\n       \"action\": \"http://marklogic.com/xdmp/privileges/rest-writer\",\n       \"kind\": \"execute\"\n+    },\n+    {\n+      \"privilege-name\": \"xdmp:invoke\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "963a458401d6d6714caf7e980223b40f9322215d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg2NzUwNQ==", "bodyText": "I think that's a good idea.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#discussion_r432867505", "createdAt": "2020-05-30T16:20:48Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/roles/data-hub-ingestion-writer.json", "diffHunk": "@@ -1,4 +1,7 @@\n {\n   \"role-name\": \"data-hub-ingestion-writer\",\n-  \"description\": \"Permits reading a load data configuration\"\n+  \"description\": \"Permits reading a load data configuration\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYwMjA4NQ=="}, "originalCommit": {"oid": "963a458401d6d6714caf7e980223b40f9322215d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg2NzU2Nw==", "bodyText": "Oh wait I take that back - I think we're just using this as a \"data\" role, while the hub-central-* roles are \"privilege\" roles.\nThe description does need to be modified though - change \"reading\" to \"writing\".", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#discussion_r432867567", "createdAt": "2020-05-30T16:21:44Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/roles/data-hub-ingestion-writer.json", "diffHunk": "@@ -1,4 +1,7 @@\n {\n   \"role-name\": \"data-hub-ingestion-writer\",\n-  \"description\": \"Permits reading a load data configuration\"\n+  \"description\": \"Permits reading a load data configuration\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjYwMjA4NQ=="}, "originalCommit": {"oid": "963a458401d6d6714caf7e980223b40f9322215d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg2NzY0NA==", "bodyText": "Are these assertions necessary since you have the tests on the controller, which verifies that the ROLE_* stuff works, which means the right authorities are being returned?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#discussion_r432867644", "createdAt": "2020-05-30T16:23:00Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/test/ml-modules/root/test/suites/data-hub/5/impl/security/getAuthoritiesTest.sjs", "diffHunk": "@@ -45,6 +45,15 @@ hubTest.runWithRolesAndPrivileges(['hub-central-load-reader'], [], function() {\n     assertions.push(test.assertFalse(authorities.includes('writeIngestion'), 'hub-central-load-reader should not have \"writeIngestion\"'));\n });\n \n+// Test hub-central-load-writer\n+hubTest.runWithRolesAndPrivileges(['hub-central-load-writer'], [], function() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "963a458401d6d6714caf7e980223b40f9322215d"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "963a458401d6d6714caf7e980223b40f9322215d", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/963a458401d6d6714caf7e980223b40f9322215d", "committedDate": "2020-05-28T19:01:32Z", "message": "DHFPROD-4672: Add hub-central-load-writer role"}, "afterCommit": {"oid": "c5469d7880b6fe419c5354a9987f99a6fb257cdb", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c5469d7880b6fe419c5354a9987f99a6fb257cdb", "committedDate": "2020-06-01T19:45:49Z", "message": "DHFPROD-4672: Add hub-central-load-writer role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMTM0MjIz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#pullrequestreview-422134223", "createdAt": "2020-06-01T19:51:40Z", "commit": {"oid": "c5469d7880b6fe419c5354a9987f99a6fb257cdb"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMTM1NzAz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#pullrequestreview-422135703", "createdAt": "2020-06-01T19:53:57Z", "commit": {"oid": "c5469d7880b6fe419c5354a9987f99a6fb257cdb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxOTo1Mzo1OFrOGdX9rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxOTo1Mzo1OFrOGdX9rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ1NDUwOQ==", "bodyText": "With Mike's latest changes, I believe we refactored all the mock responses for the test under config/mocks.config.ts.\nCan this mock delete be moved as well?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#discussion_r433454509", "createdAt": "2020-06-01T19:53:58Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/pages/Load.test.tsx", "diffHunk": "@@ -27,58 +27,91 @@ describe('Load component', () => {\n         const authorityService = new AuthoritiesService();\n         authorityService.setAuthorities(['readIngestion']);\n \n-        const { getByText, getByLabelText, getByTestId, debug } = render(<AuthoritiesContext.Provider value={authorityService}><Load/></AuthoritiesContext.Provider>);\n-            debug();\n-        expect(await(waitForElement(() => getByLabelText('load-list')))).toBeInTheDocument();\n+        const { getByText, getByTitle, getByLabelText, getByTestId, queryByTestId, queryByText, queryByTitle } = render(<AuthoritiesContext.Provider value={authorityService}><Load/></AuthoritiesContext.Provider>);\n+\n+        expect(await(waitForElement(() => getByLabelText('switch-view-list')))).toBeInTheDocument();\n \n         // Check for steps to be populated\n         expect(axiosMock.get).toBeCalledWith('/api/steps/ingestion');\n         expect(getByText('testLoad')).toBeInTheDocument();\n \n         // Check list view\n         await fireEvent.click(getByLabelText('switch-view-list'));\n+        // test 'Add New' button\n+        expect(queryByText('Add New')).not.toBeInTheDocument();\n \n         await fireEvent.click(getByTestId('testLoad-settings'));\n         expect(await(waitForElement(() => getByText('Target Database:')))).toBeInTheDocument();\n \n         expect(getByText('Save')).toBeDisabled();\n         await fireEvent.click(getByText('Cancel'));\n-        // Check card view\n+        // test delete\n+        expect(queryByTestId('testLoad-delete')).not.toBeInTheDocument();\n+\n+        // Check card layout\n         await fireEvent.click(getByLabelText('switch-view-card'));\n \n+        // test 'Add New' button\n+        expect(queryByText('Add New')).not.toBeInTheDocument();\n+\n+        // test settings\n         await fireEvent.click(getByLabelText('icon: setting'));\n         expect(await(waitForElement(() => getByText('Target Database:')))).toBeInTheDocument();\n         expect(getByText('Save')).toBeDisabled();\n         await fireEvent.click(getByText('Cancel'));\n+\n+        // test delete\n+        expect(queryByTitle('delete')).not.toBeInTheDocument();\n     });\n \n-    test('Verify can edit with readIngestion and writeIngestion authorities', async () => {\n+    test('Verify edit with readIngestion and writeIngestion authorities', async () => {\n         const authorityService = new AuthoritiesService();\n         authorityService.setAuthorities(['readIngestion','writeIngestion']);\n \n-        const { getByText, getByLabelText, getByTestId } = render(<AuthoritiesContext.Provider value={authorityService}><Load/></AuthoritiesContext.Provider>);\n+        axiosMock.delete['mockImplementation']((url) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5469d7880b6fe419c5354a9987f99a6fb257cdb"}, "originalPosition": 51}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c5469d7880b6fe419c5354a9987f99a6fb257cdb", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c5469d7880b6fe419c5354a9987f99a6fb257cdb", "committedDate": "2020-06-01T19:45:49Z", "message": "DHFPROD-4672: Add hub-central-load-writer role"}, "afterCommit": {"oid": "1597425e4e6acf88217d44ac816e7d8260d0ba9e", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1597425e4e6acf88217d44ac816e7d8260d0ba9e", "committedDate": "2020-06-01T20:55:18Z", "message": "DHFPROD-4672: Add hub-central-load-writer role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjA5MDY0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#pullrequestreview-422209064", "createdAt": "2020-06-01T21:54:34Z", "commit": {"oid": "1597425e4e6acf88217d44ac816e7d8260d0ba9e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjIxNDA3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#pullrequestreview-422221407", "createdAt": "2020-06-01T22:21:25Z", "commit": {"oid": "1597425e4e6acf88217d44ac816e7d8260d0ba9e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1597425e4e6acf88217d44ac816e7d8260d0ba9e", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1597425e4e6acf88217d44ac816e7d8260d0ba9e", "committedDate": "2020-06-01T20:55:18Z", "message": "DHFPROD-4672: Add hub-central-load-writer role"}, "afterCommit": {"oid": "2ecfeedebd415cebe131713ed1da1981211906a9", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/2ecfeedebd415cebe131713ed1da1981211906a9", "committedDate": "2020-06-01T22:43:56Z", "message": "DHFPROD-4672: Add hub-central-load-writer role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjMxNjgw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#pullrequestreview-422231680", "createdAt": "2020-06-01T22:47:44Z", "commit": {"oid": "2ecfeedebd415cebe131713ed1da1981211906a9"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe8ad25bf3720ba244274d74e8c41480cd4982e0", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/fe8ad25bf3720ba244274d74e8c41480cd4982e0", "committedDate": "2020-06-01T22:48:56Z", "message": "DHFPROD-4672: Add hub-central-load-writer role"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2ecfeedebd415cebe131713ed1da1981211906a9", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/2ecfeedebd415cebe131713ed1da1981211906a9", "committedDate": "2020-06-01T22:43:56Z", "message": "DHFPROD-4672: Add hub-central-load-writer role"}, "afterCommit": {"oid": "fe8ad25bf3720ba244274d74e8c41480cd4982e0", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/fe8ad25bf3720ba244274d74e8c41480cd4982e0", "committedDate": "2020-06-01T22:48:56Z", "message": "DHFPROD-4672: Add hub-central-load-writer role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjMzMjQx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#pullrequestreview-422233241", "createdAt": "2020-06-01T22:51:43Z", "commit": {"oid": "fe8ad25bf3720ba244274d74e8c41480cd4982e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNjIyODI4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4019#pullrequestreview-422622828", "createdAt": "2020-06-02T12:26:00Z", "commit": {"oid": "fe8ad25bf3720ba244274d74e8c41480cd4982e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2664, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}