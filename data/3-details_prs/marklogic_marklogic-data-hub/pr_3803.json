{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNDQ3MjI4", "number": 3803, "title": "DHFPROD-4440: Improving how resetProject works in HubTestBase", "bodyText": "Submitting this as part of DHFPROD-4440, which involves step processors. I started writing a JUnit test for this and realized that our tests can be sped up by not having to load hub artifacts all the time (because clearDatabases no longer needs them) and by not having to generate and deploy entity-based search options, which are never used.\nMain change is that clearDatabases in HubTestBase no longer deletes the hub-core-artifact collection. That keeps all DH core artifacts present. Had to improve some legacy tests that were assuming that the database was empty after calling clear (making assertions on the number of docs in a database leads to brittle tests).\nAlso made a tweak to LoadUserModulesCommand that both speeds up tests and fixes a long-standing issue when running \"mlWatch\", which is - when you run mlWatch, DHF generates and deploys entity-based search options over and over and over. That also adds some time to every test, and none of our tests depend on LoadUserModulesCommand deploying entity-based search options.\nDescription\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-04-09T14:11:10Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3803", "merged": true, "mergeCommit": {"oid": "28b0f05f457ebb499209def70d7e3d8e88bd3366"}, "closed": true, "closedAt": "2020-04-09T21:46:06Z", "author": {"login": "rjrudin"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV9G4YgH2gAyNDAxNDQ3MjI4OmJlMzY5OGYzOGMwN2M5MTIzZDFjNTc2MDY2ZGYzNDM3OTcxNzg4Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWCdZSAFqTM5MTEwNjU3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be3698f38c07c9123d1c576066df343797178877", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/be3698f38c07c9123d1c576066df343797178877", "committedDate": "2020-04-09T14:10:13Z", "message": "DHFPROD-4440: Improving how resetProject works in HubTestBase\n\nMain change is that clearDatabases in HubTestBase no longer deletes the hub-core-artifact collection. That keeps all DH core artifacts present. Had to improve some legacy tests that were assuming that the database was empty after calling clear (making assertions on the number of docs in a database leads to brittle tests).\n\nAlso made a tweak to LoadUserModulesCommand that both speeds up tests and fixes a long-standing issue when running \"mlWatch\", which is - when you run mlWatch, DHF generates and deploys entity-based search options over and over and over. That also adds some time to every test, and none of our tests depend on LoadUserModulesCommand deploying entity-based search options."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTcwMDI1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3803#pullrequestreview-390970025", "createdAt": "2020-04-09T16:58:14Z", "commit": {"oid": "be3698f38c07c9123d1c576066df343797178877"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjo1ODoxNFrOGDhUSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjo1ODoxNFrOGDhUSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM0NDc3Nw==", "bodyText": "A small typo here. Other than that everything looks good.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3803#discussion_r406344777", "createdAt": "2020-04-09T16:58:14Z", "author": {"login": "srinathgit"}, "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/AbstractHubTest.java", "diffHunk": "@@ -1,16 +1,20 @@\n package com.marklogic.hub;\n \n-import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.extension.ExtendWith;\n import org.springframework.test.context.ContextConfiguration;\n import org.springframework.test.context.junit.jupiter.SpringExtension;\n \n /**\n- * Adding this so that a class can subclass HubTestBase without having to define the same two Spring annotations\n+ * Adding this so that a class can subclass HubTestBase without hing to define the same two Spring annotations", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be3698f38c07c9123d1c576066df343797178877"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDk1ODQ5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3803#pullrequestreview-391095849", "createdAt": "2020-04-09T20:06:39Z", "commit": {"oid": "be3698f38c07c9123d1c576066df343797178877"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMTA2NTc0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3803#pullrequestreview-391106574", "createdAt": "2020-04-09T20:24:20Z", "commit": {"oid": "be3698f38c07c9123d1c576066df343797178877"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3009, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}