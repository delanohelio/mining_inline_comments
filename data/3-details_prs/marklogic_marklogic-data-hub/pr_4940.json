{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyNzkzMjE4", "number": 4940, "title": "DHFPROD-6284:Throw 4xx error when using fn:error if appropriate", "bodyText": "Description\nThrow 4xx error when using fn:error if appropriate\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-12-04T21:17:06Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940", "merged": true, "mergeCommit": {"oid": "1eaf576df6fcc4a9f9e3fdb3884523b79f28d386"}, "closed": true, "closedAt": "2020-12-08T18:12:53Z", "author": {"login": "srinathgit"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdi-nUJgFqTU0NTMwNzUzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkOK1kgFqTU0NzQ5NjQ0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzA3NTM2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940#pullrequestreview-545307536", "createdAt": "2020-12-04T21:27:43Z", "commit": {"oid": "065c4aee9cbe30766ddb908e02383d96920b9920"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1OTMxNTk4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940#pullrequestreview-545931598", "createdAt": "2020-12-07T08:44:07Z", "commit": {"oid": "065c4aee9cbe30766ddb908e02383d96920b9920"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwODo0NDowN1rOIAbr7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwODo0NDowN1rOIAbr7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzMyNDUyNg==", "bodyText": "@rjrudin ,\nThis change and a similar change in flow-lib.sjs in dhfprod-6284 are causing a number of test failures (These failures are for changes in flow-lib.sjs https://jenkins.marklogic.com/blue/organizations/jenkins/Datahub_CI/detail/develop/1692/tests/  alone). Should we not make this change in dhf 4 modules ? I am seeing that no matter a 4.x flow flow succeeds or fails, it always returns a http 200.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940#discussion_r537324526", "createdAt": "2020-12-07T08:44:07Z", "author": {"login": "srinathgit"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/4/impl/flow-lib.xqy", "diffHunk": "@@ -1023,7 +1026,7 @@ declare function flow:safe-run($func)\n     catch($ex) {\n       debug:log(xdmp:describe($ex, (), ())),\n       trace:error-trace($rfc:item-context, $ex, xdmp:elapsed-time() - $before),\n-      fn:error((), \"DATAHUB-PLUGIN-ERROR\", $ex)\n+      httputils:throw-bad-request((), $ex)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "065c4aee9cbe30766ddb908e02383d96920b9920"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MTU4MDIw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940#pullrequestreview-546158020", "createdAt": "2020-12-07T13:43:09Z", "commit": {"oid": "065c4aee9cbe30766ddb908e02383d96920b9920"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMzo0MzoxMFrOIAnUpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMzo0Mzo0OFrOIAnWQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxNTE3NA==", "bodyText": "Can you test this to see what error you get in the client that calls an endpoint that invokes this trigger? I am thinking that the first argument adds no value and should be returned. We don't have some list of error codes that a user can refer to, and returning something that looks like an error code implies that we do keep a list like that. I'm thinking it's less confusing if we just return the error message starting with \"Unable to validate\".", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940#discussion_r537515174", "createdAt": "2020-12-07T13:43:10Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/4/triggers/entity-model-validate-trigger.xqy", "diffHunk": "@@ -84,7 +86,7 @@ let $uber-model :=\n     (: build uber model with original info :)\n     return hent:uber-model((xdmp:to-json($entity-def-map)/object-node(), $supporting-entity-defs)) => map:with(\"info\", $info-map)\n   } catch ($e) {\n-    fn:error(xs:QName(\"INVALID-MODEL\"), \"Unable to validate entity model at URI: \" || $trgr:uri || \"; cause: \" || xdmp:quote($e))\n+    httputils:throw-bad-request(xs:QName(\"INVALID-MODEL\"), \"Unable to validate entity model at URI: \" || $trgr:uri || \"; cause: \" || xdmp:quote($e))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "065c4aee9cbe30766ddb908e02383d96920b9920"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxNTU4NQ==", "bodyText": "Why include \"()\" as the first arg here?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940#discussion_r537515585", "createdAt": "2020-12-07T13:43:48Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/services/mlFlow.xqy", "diffHunk": "@@ -69,7 +72,7 @@ declare function get(\n           return\n             if (fn:exists($flow)) then $flow\n             else\n-              fn:error((),\"RESTAPI-SRVEXERR\", (404, \"Not Found\", \"The requested flow was not found\"))\n+              httputils:throw-not-found((), \"The requested flow was not found\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "065c4aee9cbe30766ddb908e02383d96920b9920"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NDEyMDQy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940#pullrequestreview-546412042", "createdAt": "2020-12-07T18:17:16Z", "commit": {"oid": "065c4aee9cbe30766ddb908e02383d96920b9920"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "065c4aee9cbe30766ddb908e02383d96920b9920", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/065c4aee9cbe30766ddb908e02383d96920b9920", "committedDate": "2020-12-04T20:06:14Z", "message": "DHFPROD-6284:Throw 4xx error when using fn:error if appropriate"}, "afterCommit": {"oid": "9094005b9c6aed009cdccb6b3832c9974c4bc63e", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9094005b9c6aed009cdccb6b3832c9974c4bc63e", "committedDate": "2020-12-07T23:41:37Z", "message": "DHFPROD-6284:Throw 4xx error when using fn:error if appropriate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NjM3NDk2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940#pullrequestreview-546637496", "createdAt": "2020-12-07T23:52:29Z", "commit": {"oid": "9094005b9c6aed009cdccb6b3832c9974c4bc63e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1e8e07c6e046e2fd49e070ee79db065fa57e31f", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b1e8e07c6e046e2fd49e070ee79db065fa57e31f", "committedDate": "2020-12-08T02:23:58Z", "message": "DHFPROD-6284:Throw 4xx error when using fn:error if appropriate"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9094005b9c6aed009cdccb6b3832c9974c4bc63e", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9094005b9c6aed009cdccb6b3832c9974c4bc63e", "committedDate": "2020-12-07T23:41:37Z", "message": "DHFPROD-6284:Throw 4xx error when using fn:error if appropriate"}, "afterCommit": {"oid": "b1e8e07c6e046e2fd49e070ee79db065fa57e31f", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b1e8e07c6e046e2fd49e070ee79db065fa57e31f", "committedDate": "2020-12-08T02:23:58Z", "message": "DHFPROD-6284:Throw 4xx error when using fn:error if appropriate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjYxMjUy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940#pullrequestreview-547261252", "createdAt": "2020-12-08T14:02:40Z", "commit": {"oid": "b1e8e07c6e046e2fd49e070ee79db065fa57e31f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NDYzODk2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940#pullrequestreview-547463896", "createdAt": "2020-12-08T17:29:29Z", "commit": {"oid": "b1e8e07c6e046e2fd49e070ee79db065fa57e31f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NDk2NDQ4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4940#pullrequestreview-547496448", "createdAt": "2020-12-08T18:09:01Z", "commit": {"oid": "b1e8e07c6e046e2fd49e070ee79db065fa57e31f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1517, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}