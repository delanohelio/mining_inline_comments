{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4OTU4Mjc3", "number": 3791, "title": "DHFPROD-4399:See up to 10 mapping errors after step runs", "bodyText": "Description\nSee up to 10 mapping errors after step runs\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-04-05T08:04:41Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791", "merged": true, "mergeCommit": {"oid": "fa470417f3d564335c347ca4e80067d5643cac64"}, "closed": true, "closedAt": "2020-04-08T19:56:52Z", "author": {"login": "srinathgit"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU_lePgFqTM4ODI5NDA3MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVtcusAFqTM5MDI4NTAwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4Mjk0MDcw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#pullrequestreview-388294070", "createdAt": "2020-04-06T14:16:50Z", "commit": {"oid": "9f7d8a9d2cde625be66b864edfde0f730716a700"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNDoxNjo1MFrOGBZ6MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxNDoyODowNlrOGBadSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEyNjI1Nw==", "bodyText": "MockRolesService is something that can be reused by other \"pages\" in test, so we should probably create a separate module. There is a __mocks__ folder under src/api to store mock functions", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#discussion_r404126257", "createdAt": "2020-04-06T14:16:50Z", "author": {"login": "bsrikan"}, "path": "one-ui/ui/src/pages/Bench.test.tsx", "diffHunk": "@@ -1,9 +1,185 @@\n import React from 'react';\n-import { shallow } from 'enzyme';\n-import Bench from './Bench';\n-\n-describe('Bench component', () => {\n-  it('should render correctly', () => {\n-    shallow(<Bench />);\n-  });\n-});\n\\ No newline at end of file\n+import { render, fireEvent, waitForElement, cleanup } from '@testing-library/react'\n+import '@testing-library/jest-dom/extend-expect'\n+import axiosMock from 'axios'\n+import  Bench from '../pages/Bench';\n+import {IRolesContextInterface, RolesContext} from '../util/roles';\n+\n+jest.mock('axios');\n+\n+class MockRolesService implements IRolesContextInterface{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f7d8a9d2cde625be66b864edfde0f730716a700"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEzNTI0Mw==", "bodyText": "Mock responses below can also be reused. Can you pls move them into data.config.\nAlso pls change the flow/step name and uri", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#discussion_r404135243", "createdAt": "2020-04-06T14:28:06Z", "author": {"login": "bsrikan"}, "path": "one-ui/ui/src/pages/Bench.test.tsx", "diffHunk": "@@ -1,9 +1,185 @@\n import React from 'react';\n-import { shallow } from 'enzyme';\n-import Bench from './Bench';\n-\n-describe('Bench component', () => {\n-  it('should render correctly', () => {\n-    shallow(<Bench />);\n-  });\n-});\n\\ No newline at end of file\n+import { render, fireEvent, waitForElement, cleanup } from '@testing-library/react'\n+import '@testing-library/jest-dom/extend-expect'\n+import axiosMock from 'axios'\n+import  Bench from '../pages/Bench';\n+import {IRolesContextInterface, RolesContext} from '../util/roles';\n+\n+jest.mock('axios');\n+\n+class MockRolesService implements IRolesContextInterface{\n+    public roles: string[] = [];\n+\n+    public setRoles: (roles: string[]) => void = (roles: string[]) => {\n+        this.roles = roles;\n+    };\n+    public canReadMappings:() => boolean = () => {\n+        return false;\n+    };\n+    public canWriteMappings:() => boolean = () => {\n+        return false;\n+    };\n+    public canReadMatchMerge:() => boolean = () => {\n+        return false;\n+    };\n+    public canWriteMatchMerge:() => boolean = () => {\n+        return false;\n+    };\n+    public canReadLoadData:() => boolean = () => {\n+        return true;\n+    };\n+    public canWriteLoadData:() => boolean = () => {\n+        return true;\n+    };\n+    public canReadEntityModels:() => boolean = () => {\n+        return false;\n+    };\n+    public canWriteEntityModels:() => boolean = () => {\n+        return false;\n+    };\n+    public canReadFlows:() => boolean = () => {\n+        return true;\n+    };\n+    public canWriteFlows:() => boolean = () => {\n+        return true;\n+    };\n+    public canReadStepDefinitions:() => boolean = () => {\n+        return false;\n+    };\n+    public canWriteStepDefinitions:() => boolean = () => {\n+        return false;\n+    };\n+    public hasOperatorRole:() => boolean = () => {\n+        return true;\n+    };\n+}\n+\n+//Mock Responses", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f7d8a9d2cde625be66b864edfde0f730716a700"}, "originalPosition": 66}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9f7d8a9d2cde625be66b864edfde0f730716a700", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9f7d8a9d2cde625be66b864edfde0f730716a700", "committedDate": "2020-04-05T08:02:13Z", "message": "DHFPROD-4399:See up to 10 mapping errors after step runs"}, "afterCommit": {"oid": "f8796dc8f0b20029ca2ef1a073758f8bd1e92bc9", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/f8796dc8f0b20029ca2ef1a073758f8bd1e92bc9", "committedDate": "2020-04-06T22:37:47Z", "message": "DHFPROD-4399:See up to 10 mapping errors after step runs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49a1a479a11f9464858c3fb65b02622931a16e88", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/49a1a479a11f9464858c3fb65b02622931a16e88", "committedDate": "2020-04-07T00:24:21Z", "message": "DHFPROD-4399:See up to 10 mapping errors after step runs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f8796dc8f0b20029ca2ef1a073758f8bd1e92bc9", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/f8796dc8f0b20029ca2ef1a073758f8bd1e92bc9", "committedDate": "2020-04-06T22:37:47Z", "message": "DHFPROD-4399:See up to 10 mapping errors after step runs"}, "afterCommit": {"oid": "49a1a479a11f9464858c3fb65b02622931a16e88", "author": {"user": {"login": "srinathgit", "name": "Srinath S"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/49a1a479a11f9464858c3fb65b02622931a16e88", "committedDate": "2020-04-07T00:24:21Z", "message": "DHFPROD-4399:See up to 10 mapping errors after step runs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTY5MTg3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#pullrequestreview-390169187", "createdAt": "2020-04-08T17:09:26Z", "commit": {"oid": "49a1a479a11f9464858c3fb65b02622931a16e88"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTc5MTMw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#pullrequestreview-390179130", "createdAt": "2020-04-08T17:23:01Z", "commit": {"oid": "49a1a479a11f9464858c3fb65b02622931a16e88"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoyMzowMVrOGC5UGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoyMzowMVrOGC5UGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4OTM2OA==", "bodyText": "Should the stepName and definitions be mapping since its a test for mapping story. We have to create a similar one for ingestion as well and have a separate story for that.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#discussion_r405689368", "createdAt": "2020-04-08T17:23:01Z", "author": {"login": "bsrikan"}, "path": "one-ui/ui/src/config/bench.config.ts", "diffHunk": "@@ -0,0 +1,145 @@\n+import {IRolesContextInterface} from \"../util/roles\";\n+\n+class MockRolesService implements IRolesContextInterface{\n+  public roles: string[] = [];\n+\n+  public setRoles: (roles: string[]) => void = (roles: string[]) => {\n+    this.roles = roles;\n+  };\n+  public canReadMappings:() => boolean = () => {\n+    return false;\n+  };\n+  public canWriteMappings:() => boolean = () => {\n+    return false;\n+  };\n+  public canReadMatchMerge:() => boolean = () => {\n+    return false;\n+  };\n+  public canWriteMatchMerge:() => boolean = () => {\n+    return false;\n+  };\n+  public canReadLoadData:() => boolean = () => {\n+    return true;\n+  };\n+  public canWriteLoadData:() => boolean = () => {\n+    return true;\n+  };\n+  public canReadEntityModels:() => boolean = () => {\n+    return false;\n+  };\n+  public canWriteEntityModels:() => boolean = () => {\n+    return false;\n+  };\n+  public canReadFlows:() => boolean = () => {\n+    return true;\n+  };\n+  public canWriteFlows:() => boolean = () => {\n+    return true;\n+  };\n+  public canReadStepDefinitions:() => boolean = () => {\n+    return false;\n+  };\n+  public canWriteStepDefinitions:() => boolean = () => {\n+    return false;\n+  };\n+  public hasOperatorRole:() => boolean = () => {\n+    return true;\n+  };\n+}\n+\n+const response = {\"data\":{\"jobId\": \"350da405-c1e9-4fa7-8269-d9aefe3b4b9a\"}, \"status\": 200};\n+const jobResp = {\n+  \"data\": {\n+    \"jobId\": \"350da405-c1e9-4fa7-8269-d9aefe3b4b9a\",\n+    \"flow\": \"testFlow\",\n+    \"user\": \"admin\",\n+    \"lastAttemptedStep\": \"1\",\n+    \"lastCompletedStep\": \"1\",\n+    \"timeStarted\": \"2020-04-04T01:17:44.918282-07:00\",\n+    \"timeEnded\": \"2020-04-04T01:17:45.012137-07:00\",\n+    \"stepResponses\": {\n+      \"1\": {\n+        \"flowName\": \"testFlow\",\n+        \"stepName\": \"failedIngest\",\n+        \"stepDefinitionName\": \"default-ingestion\",\n+        \"stepDefinitionType\": \"ingestion\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49a1a479a11f9464858c3fb65b02622931a16e88"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMjI1NzM5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#pullrequestreview-390225739", "createdAt": "2020-04-08T18:28:04Z", "commit": {"oid": "49a1a479a11f9464858c3fb65b02622931a16e88"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMjg1MDA5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3791#pullrequestreview-390285009", "createdAt": "2020-04-08T19:55:36Z", "commit": {"oid": "49a1a479a11f9464858c3fb65b02622931a16e88"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2999, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}