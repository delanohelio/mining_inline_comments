{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4NjE2ODEy", "number": 4310, "title": "DHFPROD-5043: Incorrect collection name shows up in mapping UI", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-07-29T18:45:04Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310", "merged": true, "mergeCommit": {"oid": "f5a1bc51b89e1d0086868938128e54be4710aedd"}, "closed": true, "closedAt": "2020-08-06T01:27:03Z", "author": {"login": "AkshayBajajML"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5vrl1gFqTQ1Nzc5OTA2NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8ALMhAFqTQ2MTk1MDQxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3Nzk5MDY0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#pullrequestreview-457799064", "createdAt": "2020-07-29T18:52:55Z", "commit": {"oid": "b3a78cf055d7423ff3f2bb9e307fe7a858d8ebd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODo1Mjo1NVrOG5FuTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxODo1Mjo1NVrOG5FuTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUxNTc5MA==", "bodyText": "I think a test is needed for cts.collectionQuery('testCollection') as well, as single quotes are valid.\nThere's also nothing prohibiting a user from having e.g. cts.collectionQuery([\"one\", \"two\"]) . I am assuming that if that's the case, then [\"one\", \"two\"] will show up?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#discussion_r462515790", "createdAt": "2020-07-29T18:52:55Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/create-edit-mapping-dialog/create-edit-mapping-dialog.test.tsx", "diffHunk": "@@ -89,7 +89,9 @@ describe('Create/Edit Mapping Step artifact component', () => {\n     const queryInput = getByPlaceholderText('Enter Source Query');\n     fireEvent.change(queryInput, { target: {value: 'cts.collectionQuery([\"testCollection\"])'}});\n     expect(queryInput).toHaveTextContent('cts.collectionQuery([\"testCollection\"])');\n-\n+    fireEvent.change(queryInput, { target: {value: 'cts.collectionQuery(\"testCollection\")'}});\n+    expect(queryInput).toHaveTextContent('cts.collectionQuery(\"testCollection\")');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3a78cf055d7423ff3f2bb9e307fe7a858d8ebd4"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3a78cf055d7423ff3f2bb9e307fe7a858d8ebd4", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b3a78cf055d7423ff3f2bb9e307fe7a858d8ebd4", "committedDate": "2020-07-29T18:42:24Z", "message": "DHFPROD-5043: Incorrect collection name shows up in mapping UI"}, "afterCommit": {"oid": "b77bed7b2d93702dbcfb9be48d16c99034555ae0", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b77bed7b2d93702dbcfb9be48d16c99034555ae0", "committedDate": "2020-07-29T19:35:36Z", "message": "DHFPROD-5043: Incorrect collection name shows up in mapping UI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NjQ0OTU4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#pullrequestreview-458644958", "createdAt": "2020-07-30T18:16:31Z", "commit": {"oid": "b77bed7b2d93702dbcfb9be48d16c99034555ae0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxODoxNjozMlrOG5ugLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxODoxNjozMlrOG5ugLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE4MzkxNg==", "bodyText": "I think the real issue here is that sourceQuery is expecting a list when it should expect a singular value.\nThe input field was a \"select\" list in QuickStart with a typeahead showing existing collections in STAGING. For HubCentral I think we decided not to provide type ahead and go with 1 collection.\n@rjrudin  @xnikhil08 please correct me if I am wrong.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#discussion_r463183916", "createdAt": "2020-07-30T18:16:32Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/create-edit-mapping-dialog/create-edit-mapping-dialog.tsx", "diffHunk": "@@ -37,11 +37,20 @@ const CreateEditMappingDialog = (props) => {\n       setSrcQuery(props.mapData.sourceQuery);\n       setSelectedSource(props.mapData.selectedSource);\n       if(props.mapData.selectedSource === 'collection'){\n-      let srcCollection = props.mapData.sourceQuery.substring(\n-          props.mapData.sourceQuery.lastIndexOf(\"[\") + 2, \n-          props.mapData.sourceQuery.lastIndexOf(\"]\") - 1\n-      );\n-      setCollections(srcCollection);\n+      if(props.mapData.sourceQuery.includes('[') && props.mapData.sourceQuery.includes(']')) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b77bed7b2d93702dbcfb9be48d16c99034555ae0"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b77bed7b2d93702dbcfb9be48d16c99034555ae0", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b77bed7b2d93702dbcfb9be48d16c99034555ae0", "committedDate": "2020-07-29T19:35:36Z", "message": "DHFPROD-5043: Incorrect collection name shows up in mapping UI"}, "afterCommit": {"oid": "f960058797fc06c030367beb8b4983a530f04dfb", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/f960058797fc06c030367beb8b4983a530f04dfb", "committedDate": "2020-07-31T20:26:54Z", "message": "DHFPROD-5043: Incorrect collection name shows up in mapping UI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzUzMzMy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#pullrequestreview-460353332", "createdAt": "2020-08-03T21:28:57Z", "commit": {"oid": "f960058797fc06c030367beb8b4983a530f04dfb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "899f039635b9bfea13771a6c3d8a88d08995ccff", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/899f039635b9bfea13771a6c3d8a88d08995ccff", "committedDate": "2020-08-03T21:51:14Z", "message": "DHFPROD-5043: Incorrect collection name shows up in mapping UI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f960058797fc06c030367beb8b4983a530f04dfb", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/f960058797fc06c030367beb8b4983a530f04dfb", "committedDate": "2020-07-31T20:26:54Z", "message": "DHFPROD-5043: Incorrect collection name shows up in mapping UI"}, "afterCommit": {"oid": "899f039635b9bfea13771a6c3d8a88d08995ccff", "author": {"user": {"login": "AkshayBajajML", "name": "Akshay Bajaj"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/899f039635b9bfea13771a6c3d8a88d08995ccff", "committedDate": "2020-08-03T21:51:14Z", "message": "DHFPROD-5043: Incorrect collection name shows up in mapping UI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzc1NzYw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#pullrequestreview-460375760", "createdAt": "2020-08-03T22:16:56Z", "commit": {"oid": "899f039635b9bfea13771a6c3d8a88d08995ccff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMDUzODkx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#pullrequestreview-461053891", "createdAt": "2020-08-04T18:13:29Z", "commit": {"oid": "899f039635b9bfea13771a6c3d8a88d08995ccff"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxODQ3NTM4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#pullrequestreview-461847538", "createdAt": "2020-08-05T16:51:05Z", "commit": {"oid": "899f039635b9bfea13771a6c3d8a88d08995ccff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNjo1MTowNVrOG8SOPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNjo1MTowNVrOG8SOPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg2NjMwMQ==", "bodyText": "@AkshayBajajML do we need this code block here if the issue is taken care of by handling it in conversionFunctions?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#discussion_r465866301", "createdAt": "2020-08-05T16:51:05Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/create-edit-mapping-dialog/create-edit-mapping-dialog.tsx", "diffHunk": "@@ -37,11 +37,20 @@ const CreateEditMappingDialog = (props) => {\n       setSrcQuery(props.mapData.sourceQuery);\n       setSelectedSource(props.mapData.selectedSource);\n       if(props.mapData.selectedSource === 'collection'){\n-      let srcCollection = props.mapData.sourceQuery.substring(\n-          props.mapData.sourceQuery.lastIndexOf(\"[\") + 2, \n-          props.mapData.sourceQuery.lastIndexOf(\"]\") - 1\n-      );\n-      setCollections(srcCollection);\n+      if(props.mapData.sourceQuery.includes('[') && props.mapData.sourceQuery.includes(']')) {\n+          let srcCollection = props.mapData.sourceQuery.substring(\n+              props.mapData.sourceQuery.lastIndexOf(\"[\") + 2,\n+              props.mapData.sourceQuery.lastIndexOf(\"]\") - 1\n+          );\n+          setCollections(srcCollection);\n+      }\n+      else{\n+          let srcCollection = props.mapData.sourceQuery.substring(\n+            props.mapData.sourceQuery.lastIndexOf(\"(\") + 2,\n+            props.mapData.sourceQuery.lastIndexOf(\")\") - 1\n+          );\n+          setCollections(srcCollection);\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "899f039635b9bfea13771a6c3d8a88d08995ccff"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTUwMTky", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#pullrequestreview-461950192", "createdAt": "2020-08-05T19:13:24Z", "commit": {"oid": "899f039635b9bfea13771a6c3d8a88d08995ccff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxOToxMzoyNFrOG8XETw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxOToxMzoyNFrOG8XETw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk0NTY3OQ==", "bodyText": "I will file a separate bug for the following issue. If you change the query to \"test\", collInput will still show up as \"testCollection\" ie change in sourceQuery is not reflected in sourceCollection", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#discussion_r465945679", "createdAt": "2020-08-05T19:13:24Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/create-edit-mapping-dialog/create-edit-mapping-dialog.test.tsx", "diffHunk": "@@ -89,7 +89,15 @@ describe('Create/Edit Mapping Step artifact component', () => {\n     const queryInput = getByPlaceholderText('Enter Source Query');\n     fireEvent.change(queryInput, { target: {value: 'cts.collectionQuery([\"testCollection\"])'}});\n     expect(queryInput).toHaveTextContent('cts.collectionQuery([\"testCollection\"])');\n-\n+    fireEvent.change(queryInput, { target: {value: 'cts.collectionQuery(\"testCollection\")'}});\n+    expect(queryInput).toHaveTextContent('cts.collectionQuery(\"testCollection\")');\n+    expect(collInput).toHaveValue(\"testCollection\");\n+    fireEvent.change(queryInput, { target: {value: \"cts.collectionQuery(['testCollection'])\"}});\n+    expect(queryInput).toHaveTextContent(\"cts.collectionQuery(['testCollection'])\");\n+    expect(collInput).toHaveValue('testCollection');\n+    fireEvent.change(queryInput, { target: {value: \"cts.collectionQuery('testCollection')\"}});\n+    expect(queryInput).toHaveTextContent(\"cts.collectionQuery('testCollection')\");\n+    expect(collInput).toHaveValue('testCollection');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "899f039635b9bfea13771a6c3d8a88d08995ccff"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTUwNDE4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4310#pullrequestreview-461950418", "createdAt": "2020-08-05T19:13:46Z", "commit": {"oid": "899f039635b9bfea13771a6c3d8a88d08995ccff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2494, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}