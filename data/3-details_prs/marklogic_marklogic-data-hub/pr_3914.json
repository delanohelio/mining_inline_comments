{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMjA1NTgx", "number": 3914, "title": "DHFPROD-4668: Add hub-central-user role", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-05-04T21:54:16Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914", "merged": true, "mergeCommit": {"oid": "bde49cf1bbea7aa989b4601ab8b2aa96349305b3"}, "closed": true, "closedAt": "2020-05-08T16:27:07Z", "author": {"login": "ryanjdew"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceIteHgFqTQwNTQyNzcwMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfRSI6AFqTQwODIxMjExMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDI3NzAx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#pullrequestreview-405427701", "createdAt": "2020-05-05T00:08:24Z", "commit": {"oid": "074d80d76f676a1b9b7b6f24c732a8a7598aeead"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwMDowODoyNVrOGQWe0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwMDoxMDozN1rOGQWhfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc5ODczNg==", "bodyText": "Little typo - have, not has", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#discussion_r419798736", "createdAt": "2020-05-05T00:08:25Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/auth/AuthenticationFilter.java", "diffHunk": "@@ -99,13 +99,16 @@ protected AuthenticationToken authenticateUser(String username, String password)\n             }\n             throw e;\n         }\n-\n         List<GrantedAuthority> authorities = new ArrayList<>();\n+        final boolean[] hasLoginAuthority = {false};\n         response.get(\"authorities\").iterator().forEachRemaining(node -> {\n             String authority = node.asText();\n+            hasLoginAuthority[0] = (\"loginToHubCentral\".equals(authority)) || hasLoginAuthority[0];\n             authorities.add(new SimpleGrantedAuthority(\"ROLE_\" + authority));\n         });\n-\n+        if (!hasLoginAuthority[0]) {\n+            throw new InsufficientAuthenticationException(\"User doesn't has necessary privileges to access Hub Central\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "074d80d76f676a1b9b7b6f24c732a8a7598aeead"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc5OTQyMQ==", "bodyText": "I don't think the writer roles are actually needed, as they don't confer any privileges. And technically, we don't want this role to be able to overwrite any of these things - the role only needs to be able to clear the database and then do an initial insert of them.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#discussion_r419799421", "createdAt": "2020-05-05T00:10:37Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/hub-internal-config/security/roles/hub-central-clear-user-data.json", "diffHunk": "@@ -2,13 +2,20 @@\n   \"role-name\": \"hub-central-clear-user-data\",\n   \"description\": \"This temporarily inherits data-hub-developer so it has the necessary privileges to use Data Hub and to insert artifacts. Will rework this once the new 5.3.0 roles are available.\",\n   \"role\": [\n+    \"hub-central-user\",\n     \"data-hub-developer\",\n     \"data-hub-entity-model-reader\",\n     \"data-hub-flow-reader\",\n     \"data-hub-load-data-reader\",\n     \"data-hub-mapping-reader\",\n     \"data-hub-match-merge-reader\",\n-    \"data-hub-step-definition-reader\"\n+    \"data-hub-step-definition-reader\",\n+    \"data-hub-entity-model-writer\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "074d80d76f676a1b9b7b6f24c732a8a7598aeead"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "074d80d76f676a1b9b7b6f24c732a8a7598aeead", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/074d80d76f676a1b9b7b6f24c732a8a7598aeead", "committedDate": "2020-05-04T21:43:14Z", "message": "DHFPROD-4668: Add hub-central-user role"}, "afterCommit": {"oid": "099ead27d090c093b5d6ff721978f8326d19449b", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/099ead27d090c093b5d6ff721978f8326d19449b", "committedDate": "2020-05-05T15:28:45Z", "message": "DHFPROD-4668: Add hub-central-user role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1OTA1Mzgw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#pullrequestreview-405905380", "createdAt": "2020-05-05T15:32:02Z", "commit": {"oid": "099ead27d090c093b5d6ff721978f8326d19449b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDcwMzA4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#pullrequestreview-406070308", "createdAt": "2020-05-05T18:58:36Z", "commit": {"oid": "099ead27d090c093b5d6ff721978f8326d19449b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MjA5MDMy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#pullrequestreview-406209032", "createdAt": "2020-05-05T22:51:14Z", "commit": {"oid": "099ead27d090c093b5d6ff721978f8326d19449b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQyMjo1MToxNFrOGQ-chA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQyMjo1MToxNFrOGQ-chA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ1MzUwOA==", "bodyText": "will this and other *-user privileges impact running of tests in DHS?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#discussion_r420453508", "createdAt": "2020-05-05T22:51:14Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub/src/test/ml-config/security/roles/data-hub-test-internal.json", "diffHunk": "@@ -0,0 +1,56 @@\n+{\n+  \"role-name\": \"data-hub-test-internal\",\n+  \"description\": \"Used to test different roles/privileges at the server level\",\n+  \"privilege\": [\n+    {\n+      \"privilege-name\": \"privilege-add-roles\",\n+      \"action\": \"http://marklogic.com/xdmp/privileges/privilege-add-roles\",\n+      \"kind\": \"execute\"\n+    },\n+    {\n+      \"privilege-name\": \"grant-my-roles\",\n+      \"action\": \"http://marklogic.com/xdmp/privileges/grant-my-roles\",\n+      \"kind\": \"execute\"\n+    },\n+    {\n+      \"privilege-name\": \"grant-all-roles\",\n+      \"action\": \"http://marklogic.com/xdmp/privileges/grant-all-roles\",\n+      \"kind\": \"execute\"\n+    },\n+    {\n+      \"privilege-name\": \"get-role\",\n+      \"action\": \"http://marklogic.com/xdmp/privileges/get-role\",\n+      \"kind\": \"execute\"\n+    },\n+    {\n+      \"privilege-name\": \"create-role\",\n+      \"action\": \"http://marklogic.com/xdmp/privileges/create-role\",\n+      \"kind\": \"execute\"\n+    },\n+    {\n+      \"privilege-name\": \"remove-role\",\n+      \"action\": \"http://marklogic.com/xdmp/privileges/remove-role\",\n+      \"kind\": \"execute\"\n+    },\n+    {\n+      \"privilege-name\": \"get-user\",\n+      \"action\": \"http://marklogic.com/xdmp/privileges/get-user\",\n+      \"kind\": \"execute\"\n+    },\n+    {\n+      \"privilege-name\": \"create-user\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "099ead27d090c093b5d6ff721978f8326d19449b"}, "originalPosition": 41}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "099ead27d090c093b5d6ff721978f8326d19449b", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/099ead27d090c093b5d6ff721978f8326d19449b", "committedDate": "2020-05-05T15:28:45Z", "message": "DHFPROD-4668: Add hub-central-user role"}, "afterCommit": {"oid": "4c66b430a575acc4a23b97a256a5daeb117be41f", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/4c66b430a575acc4a23b97a256a5daeb117be41f", "committedDate": "2020-05-06T16:31:36Z", "message": "DHFPROD-4668: Add hub-central-user role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2ODA3Nzcz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#pullrequestreview-406807773", "createdAt": "2020-05-06T16:57:22Z", "commit": {"oid": "4c66b430a575acc4a23b97a256a5daeb117be41f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2ODMwMDcy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#pullrequestreview-406830072", "createdAt": "2020-05-06T17:25:05Z", "commit": {"oid": "4c66b430a575acc4a23b97a256a5daeb117be41f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2ODQwNzQw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#pullrequestreview-406840740", "createdAt": "2020-05-06T17:38:57Z", "commit": {"oid": "4c66b430a575acc4a23b97a256a5daeb117be41f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c66b430a575acc4a23b97a256a5daeb117be41f", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/4c66b430a575acc4a23b97a256a5daeb117be41f", "committedDate": "2020-05-06T16:31:36Z", "message": "DHFPROD-4668: Add hub-central-user role"}, "afterCommit": {"oid": "ea8641a7b01424bf0685dbf070bb74107987e5a6", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ea8641a7b01424bf0685dbf070bb74107987e5a6", "committedDate": "2020-05-07T21:14:39Z", "message": "DHFPROD-4668: Add hub-central-user role"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "372de2f0de719c18933def822ffa65f51ffbdcee", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/372de2f0de719c18933def822ffa65f51ffbdcee", "committedDate": "2020-05-07T23:48:56Z", "message": "DHFPROD-4668: Add hub-central-user role"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea8641a7b01424bf0685dbf070bb74107987e5a6", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ea8641a7b01424bf0685dbf070bb74107987e5a6", "committedDate": "2020-05-07T21:14:39Z", "message": "DHFPROD-4668: Add hub-central-user role"}, "afterCommit": {"oid": "372de2f0de719c18933def822ffa65f51ffbdcee", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/372de2f0de719c18933def822ffa65f51ffbdcee", "committedDate": "2020-05-07T23:48:56Z", "message": "DHFPROD-4668: Add hub-central-user role"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3OTM0NDU0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#pullrequestreview-407934454", "createdAt": "2020-05-08T01:08:34Z", "commit": {"oid": "372de2f0de719c18933def822ffa65f51ffbdcee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMTowODozNFrOGSVg1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMTowODozNFrOGSVg1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg4MDAyMQ==", "bodyText": "was this exception causing the clearUserData test to fail?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#discussion_r421880021", "createdAt": "2020-05-08T01:08:34Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/auth/LoginFailureHandler.java", "diffHunk": "@@ -37,7 +38,11 @@ public void onAuthenticationFailure(HttpServletRequest request, HttpServletRespo\n         String json = node.toString();\n         response.setContentType(\"application/json\");\n         response.setCharacterEncoding(\"UTF-8\");\n-        response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\n+        if (exception instanceof InsufficientAuthenticationException) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "372de2f0de719c18933def822ffa65f51ffbdcee"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3OTU3NTQy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#pullrequestreview-407957542", "createdAt": "2020-05-08T02:30:17Z", "commit": {"oid": "372de2f0de719c18933def822ffa65f51ffbdcee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MjEyMTEw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3914#pullrequestreview-408212110", "createdAt": "2020-05-08T12:45:56Z", "commit": {"oid": "372de2f0de719c18933def822ffa65f51ffbdcee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2854, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}