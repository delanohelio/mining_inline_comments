{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMzExMTk3", "number": 4154, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMDozOFrOEJHLsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNTo0NTo0MFrOEJW_EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3OTkwMzIyOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/testFixtures/java/com/marklogic/hub/test/AbstractHubTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMDozOFrOGpezCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMDozOFrOGpezCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0OTM4Nw==", "bodyText": "I believe this waitForTasksToFinish can be removed since there aren't any post-commit triggers on the modules database. We only need it after loading entity models.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446149387", "createdAt": "2020-06-26T12:20:38Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/testFixtures/java/com/marklogic/hub/test/AbstractHubTest.java", "diffHunk": "@@ -289,26 +289,33 @@ protected void installUserModulesAndArtifacts(HubConfig hubConfig, boolean force\n         loadUserModulesCommand.setLoadQueryOptions(loadQueryOptions);\n         commands.add(loadUserModulesCommand);\n \n-        LoadUserArtifactsCommand loadUserArtifactsCommand = new LoadUserArtifactsCommand(hubConfig);\n-        loadUserArtifactsCommand.setForceLoad(forceLoad);\n-        commands.add(loadUserArtifactsCommand);\n-\n         SimpleAppDeployer deployer = new SimpleAppDeployer(hubConfig.getManageClient(), hubConfig.getAdminManager());\n         deployer.setCommands(commands);\n         deployer.deploy(hubConfig.getAppConfig());\n \n-        // Wait for post-commit triggers to finish\n         waitForTasksToFinish();\n-\n+        // Generate function metadata must occur after loading modules", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3OTkwNjM1OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/cli/client/RunFlowViaMainTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMTo0OFrOGpe1EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMzoyNDo0NlrOGpxJfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0OTkwNQ==", "bodyText": "If this is needed, then just change this class to extend AbstractHubCoreTest instead of HubTestBase, as AHCT is calling resetHubProject. Can remove the Spring annotations from this test class too.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446149905", "createdAt": "2020-06-26T12:21:48Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/cli/client/RunFlowViaMainTest.java", "diffHunk": "@@ -36,6 +33,11 @@ public static void cleanUp() {\n         new Installer().deleteProjectDir();\n     }\n \n+    @BeforeEach\n+    public void beforeEach() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ1MDA0Ng==", "bodyText": "recommended changes made", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446450046", "createdAt": "2020-06-26T23:24:46Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/cli/client/RunFlowViaMainTest.java", "diffHunk": "@@ -36,6 +33,11 @@ public static void cleanUp() {\n         new Installer().deleteProjectDir();\n     }\n \n+    @BeforeEach\n+    public void beforeEach() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE0OTkwNQ=="}, "originalCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3OTkwOTMxOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/HubClientImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMjo0MlrOGpe25Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMjoyMjo0MlrOGpe25Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE1MDM3Mw==", "bodyText": "This is never used anywhere, does it need to be added?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446150373", "createdAt": "2020-06-26T12:22:42Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/HubClientImpl.java", "diffHunk": "@@ -38,6 +40,7 @@ public HubClientImpl(HubConfigImpl hubConfig, Map<DatabaseKind, String> database\n         jobsClient = hubConfig.newJobDbClient();\n         this.databaseNames = databaseNames;\n         this.manageClient = hubConfig.getManageClient();\n+        this.modulesClient = hubConfig.newModulesDbClient();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDYzMzY2OnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/entities/entity-search-lib.sjs", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNTo1Mzo0MlrOGpmB4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMzoyNDoyN1rOGpxJRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2Nzg3Mw==", "bodyText": "Unfortunately, the spread syntax isn't supported in ML 9.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446267873", "createdAt": "2020-06-26T15:53:42Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/entities/entity-search-lib.sjs", "diffHunk": "@@ -127,7 +127,7 @@ function buildAllMetadata(parentPropertyName, entityModel, entityName) {\n       propertyMetadata[\"properties\"] = metaData[\"allPropertiesMetadata\"];\n       propertyMetadataObject[\"properties\"] = metaData[\"allPropertiesMetadata\"];\n \n-      granularPropertyMetadata = {...granularPropertyMetadata, ...metaData[\"granularPropertyMetadata\"]};\n+      granularPropertyMetadata = Object.assign({},granularPropertyMetadata, metaData[\"granularPropertyMetadata\"]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI3NzM3Ng==", "bodyText": "In 'manageCustomStep.sjs' , I used spread operator. I believe that should fail as well in 9.0-12", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446277376", "createdAt": "2020-06-26T16:10:50Z", "author": {"login": "srinathgit"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/entities/entity-search-lib.sjs", "diffHunk": "@@ -127,7 +127,7 @@ function buildAllMetadata(parentPropertyName, entityModel, entityName) {\n       propertyMetadata[\"properties\"] = metaData[\"allPropertiesMetadata\"];\n       propertyMetadataObject[\"properties\"] = metaData[\"allPropertiesMetadata\"];\n \n-      granularPropertyMetadata = {...granularPropertyMetadata, ...metaData[\"granularPropertyMetadata\"]};\n+      granularPropertyMetadata = Object.assign({},granularPropertyMetadata, metaData[\"granularPropertyMetadata\"]);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2Nzg3Mw=="}, "originalCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0OTk5MQ==", "bodyText": "updated there now as well.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446449991", "createdAt": "2020-06-26T23:24:27Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/entities/entity-search-lib.sjs", "diffHunk": "@@ -127,7 +127,7 @@ function buildAllMetadata(parentPropertyName, entityModel, entityName) {\n       propertyMetadata[\"properties\"] = metaData[\"allPropertiesMetadata\"];\n       propertyMetadataObject[\"properties\"] = metaData[\"allPropertiesMetadata\"];\n \n-      granularPropertyMetadata = {...granularPropertyMetadata, ...metaData[\"granularPropertyMetadata\"]};\n+      granularPropertyMetadata = Object.assign({},granularPropertyMetadata, metaData[\"granularPropertyMetadata\"]);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2Nzg3Mw=="}, "originalCommit": {"oid": "84ccffdcb7f2235c0c281d863751b1d1c9c65ab2"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MTc2NzQyOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/data-services/customStep/getCustomStep.sjs", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMzoyMzo0MVrOGpxIsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNTo0NjozOFrOGp2l5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0OTg0MA==", "bodyText": "Also, Object.entries is not available in ML 9.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446449840", "createdAt": "2020-06-26T23:23:41Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/data-services/customStep/getCustomStep.sjs", "diffHunk": "@@ -22,9 +22,9 @@ let dataHubOptions = [\"sourceQuery\", \"sourceQueryIsScript\", \"constrainSourceQuer\n let additionalSettings = {};\n let step = Artifacts.getArtifact(\"custom\", stepName)\n let options = Artifacts.convertStepReferenceToInlineStep(step.stepId).options;\n-for (let [key, value] of Object.entries(options)) {\n+for (let key of Object.keys(options)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d198b65d536f9d547326ebb6d028fc7303d90aec"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzOTIzOQ==", "bodyText": "I'm thinking we should make a list of the strings that won't work in ML 9, and we can then have a JUnit test that scans each SJS file and throws an error if any are found. So far, we have at least Object.entries and \"{...\", right? I can write up a JIRA ticket for it, and we can always add to the list.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446539239", "createdAt": "2020-06-27T15:46:38Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/data-services/customStep/getCustomStep.sjs", "diffHunk": "@@ -22,9 +22,9 @@ let dataHubOptions = [\"sourceQuery\", \"sourceQueryIsScript\", \"constrainSourceQuer\n let additionalSettings = {};\n let step = Artifacts.getArtifact(\"custom\", stepName)\n let options = Artifacts.convertStepReferenceToInlineStep(step.stepId).options;\n-for (let [key, value] of Object.entries(options)) {\n+for (let key of Object.keys(options)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0OTg0MA=="}, "originalCommit": {"oid": "d198b65d536f9d547326ebb6d028fc7303d90aec"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MjQ5MjMyOnYy", "diffSide": "RIGHT", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/HubClientImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxNTo0NTo0MFrOGp2loQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNjowNDoxN1rOGqX0Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzOTE2OQ==", "bodyText": "This can still be removed right?", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r446539169", "createdAt": "2020-06-27T15:45:40Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/HubClientImpl.java", "diffHunk": "@@ -28,6 +28,8 @@\n     private DatabaseClient stagingClient;\n     private DatabaseClient finalClient;\n     private DatabaseClient jobsClient;\n+    private DatabaseClient modulesClient;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "853a5e4f8dcfb343db24a8eae0f9fff0f7137fc2"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA4MzU2Mg==", "bodyText": "removed", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4154#discussion_r447083562", "createdAt": "2020-06-29T16:04:17Z", "author": {"login": "ryanjdew"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/HubClientImpl.java", "diffHunk": "@@ -28,6 +28,8 @@\n     private DatabaseClient stagingClient;\n     private DatabaseClient finalClient;\n     private DatabaseClient jobsClient;\n+    private DatabaseClient modulesClient;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUzOTE2OQ=="}, "originalCommit": {"oid": "853a5e4f8dcfb343db24a8eae0f9fff0f7137fc2"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3946, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}