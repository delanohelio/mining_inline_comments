{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5OTQ3NzAw", "number": 5040, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMTowNTo1MlrODde1XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMzozNDoyN1rODerbgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjQwNDc3OnYy", "diffSide": "RIGHT", "path": "pinot-broker/src/main/java/org/apache/pinot/broker/requesthandler/BaseBrokerRequestHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMTowNTo1MlrOFmHJmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMTowNTo1MlrOFmHJmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUwNzM1NA==", "bodyText": "we dont need to set the variable in PinotQueryParserFactory. Just change the brokerrequest using the config", "url": "https://github.com/apache/pinot/pull/5040#discussion_r375507354", "createdAt": "2020-02-05T21:05:52Z", "author": {"login": "kishoreg"}, "path": "pinot-broker/src/main/java/org/apache/pinot/broker/requesthandler/BaseBrokerRequestHandler.java", "diffHunk": "@@ -122,6 +123,9 @@ public BaseBrokerRequestHandler(Configuration config, RoutingTable routingTable,\n     } else {\n       _tableCache = null;\n     }\n+\n+    PinotQueryParserFactory.MAX_QUERY_SELECTION_LIMIT = _config.getInt(CommonConstants.Helix.MAX_QUERY_SELECTION_LIMIT_KEY, CommonConstants.Helix.DEFAULT_MAX_QUERY_SELECTION_LIMIT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365eede5b75d8882d39f926b29d2ec8ccba0f191"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjQwNzY2OnYy", "diffSide": "RIGHT", "path": "pinot-common/src/main/java/org/apache/pinot/pql/parsers/pql2/ast/SelectAstNode.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMTowNjo0MlrOFmHLOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMTowNjo0MlrOFmHLOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTUwNzc3MQ==", "bodyText": "this code can be moved to basebrokerrequesthandler", "url": "https://github.com/apache/pinot/pull/5040#discussion_r375507771", "createdAt": "2020-02-05T21:06:42Z", "author": {"login": "kishoreg"}, "path": "pinot-common/src/main/java/org/apache/pinot/pql/parsers/pql2/ast/SelectAstNode.java", "diffHunk": "@@ -166,6 +167,11 @@ public void updateBrokerRequest(BrokerRequest brokerRequest) {\n     } else {\n       brokerRequest.setLimit(DEFAULT_RECORD_LIMIT);\n     }\n+    // Update Selection query limit if MAX_QUERY_SELECTION_LIMIT is set.\n+    int limit = brokerRequest.getLimit();\n+    if ((PinotQueryParserFactory.MAX_QUERY_SELECTION_LIMIT > 0) && (limit > PinotQueryParserFactory.MAX_QUERY_SELECTION_LIMIT)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365eede5b75d8882d39f926b29d2ec8ccba0f191"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMTQ1Njk4OnYy", "diffSide": "RIGHT", "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/CommonConstants.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNjo0Mjo1N1rOFnbcfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNjo0Mjo1N1rOFnbcfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg4ODQ0NQ==", "bodyText": "Can you please move this under class Broker instead of Helix? Also, I would recommend changing it to CONFIG_OF_ENABLE_QUERY_LIMIT_OVERRIDE to be consistent with other configs.", "url": "https://github.com/apache/pinot/pull/5040#discussion_r376888445", "createdAt": "2020-02-10T06:42:57Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/CommonConstants.java", "diffHunk": "@@ -42,7 +42,7 @@\n \n     public static final String LEAD_CONTROLLER_RESOURCE_ENABLED_KEY = \"RESOURCE_ENABLED\";\n     public static final String ENABLE_CASE_INSENSITIVE_PQL_KEY = \"enable.case.insensitive.pql\";\n-\n+    public static final String ENABLE_BROKER_QUERY_LIMIT_OVERRIDE_KEY = \"enable.broker.query.limit.override\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c6bc6c22da9f5e813e5d7db0dd8c4625b46cc0d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNDk1MDgyOnYy", "diffSide": "RIGHT", "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/CommonConstants.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMzozMDo1NlrOFn8tsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMzozMDo1NlrOFn8tsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQzMzUyMg==", "bodyText": "pinot.broker.enable.query.limit.override for consistency", "url": "https://github.com/apache/pinot/pull/5040#discussion_r377433522", "createdAt": "2020-02-11T03:30:56Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/CommonConstants.java", "diffHunk": "@@ -166,6 +165,7 @@ public ServerType getServerType() {\n     public static final String CONFIG_OF_BROKER_MIN_RESOURCE_PERCENT_FOR_START =\n         \"pinot.broker.startup.minResourcePercent\";\n     public static final double DEFAULT_BROKER_MIN_RESOURCE_PERCENT_FOR_START = 100.0;\n+    public static final String CONFIG_OF_ENABLE_QUERY_LIMIT_OVERRIDE = \"enable.broker.query.limit.override\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e90639832128926e5194c78bd9f19fdd94e295df"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNDk1MTkxOnYy", "diffSide": "RIGHT", "path": "pinot-broker/src/main/java/org/apache/pinot/broker/requesthandler/BaseBrokerRequestHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMzozMjowNFrOFn8uZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMzozMjowNFrOFn8uZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQzMzcwMA==", "bodyText": "(nit) CommonConstants.Broker is already imported so you can directly use Broker.CONFIG_OF_ENABLE_QUERY_LIMIT_OVERRIDE", "url": "https://github.com/apache/pinot/pull/5040#discussion_r377433700", "createdAt": "2020-02-11T03:32:04Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-broker/src/main/java/org/apache/pinot/broker/requesthandler/BaseBrokerRequestHandler.java", "diffHunk": "@@ -122,6 +122,9 @@ public BaseBrokerRequestHandler(Configuration config, RoutingTable routingTable,\n     } else {\n       _tableCache = null;\n     }\n+\n+    _enableBrokerQueryLimitOverride = _config.getBoolean(CommonConstants.Broker.CONFIG_OF_ENABLE_QUERY_LIMIT_OVERRIDE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e90639832128926e5194c78bd9f19fdd94e295df"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNDk1NDA1OnYy", "diffSide": "RIGHT", "path": "pinot-broker/src/main/java/org/apache/pinot/broker/broker/helix/HelixBrokerStarter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMzozNDowN1rOFn8vsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMzozNDowN1rOFn8vsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQzNDAzMg==", "bodyText": "(nit) enableQueryLimitOverride", "url": "https://github.com/apache/pinot/pull/5040#discussion_r377434032", "createdAt": "2020-02-11T03:34:07Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-broker/src/main/java/org/apache/pinot/broker/broker/helix/HelixBrokerStarter.java", "diffHunk": "@@ -182,7 +181,8 @@ public void start()\n         new HelixConfigScopeBuilder(HelixConfigScope.ConfigScopeProperty.CLUSTER).forCluster(_clusterName).build();\n     String enableCaseInsensitivePql = configAccessor.get(helixConfigScope, Helix.ENABLE_CASE_INSENSITIVE_PQL_KEY);\n     _brokerConf.setProperty(Helix.ENABLE_CASE_INSENSITIVE_PQL_KEY, Boolean.valueOf(enableCaseInsensitivePql));\n-\n+    String enableBrokerQueryLimitOverride = configAccessor.get(helixConfigScope, Broker.CONFIG_OF_ENABLE_QUERY_LIMIT_OVERRIDE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e90639832128926e5194c78bd9f19fdd94e295df"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNDk1NDI2OnYy", "diffSide": "RIGHT", "path": "pinot-broker/src/main/java/org/apache/pinot/broker/requesthandler/BaseBrokerRequestHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMzozNDoyN1rOFn8v3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwMzozNDoyN1rOFn8v3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQzNDA3Ng==", "bodyText": "(nit) _enableQueryLimitOverride?", "url": "https://github.com/apache/pinot/pull/5040#discussion_r377434076", "createdAt": "2020-02-11T03:34:27Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-broker/src/main/java/org/apache/pinot/broker/requesthandler/BaseBrokerRequestHandler.java", "diffHunk": "@@ -104,6 +103,7 @@\n   private final AtomicInteger _numDroppedLog;\n \n   private final boolean _enableCaseInsensitivePql;\n+  private final boolean _enableBrokerQueryLimitOverride;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e90639832128926e5194c78bd9f19fdd94e295df"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3668, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}