{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3NjM1Mzkz", "number": 5961, "title": "[TE] Added helm deployment for ThirdEye", "bodyText": "Description\nCreating a helm application for ThirdEye to work with pinot quickstart\nright off the box. The current change installs MySQL with the initial\nset of tables. This creates thirdeye frontend and backend pods\nCaveats\n\nThe initdb.sql needs to be updated regularly which is an overhead. To be refactored later.\nUsing the create-schema.sql is not possible at the moment since the script has errors with MySQL 5.7.\n\nNo backward incompatible changes.", "createdAt": "2020-09-02T07:41:06Z", "url": "https://github.com/apache/pinot/pull/5961", "merged": true, "mergeCommit": {"oid": "4c20bb567dfc57805de1cb089ba902468879d34d"}, "closed": true, "closedAt": "2020-09-02T21:23:41Z", "author": {"login": "suvodeep-pyne"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdE3Bj8gH2gAyNDc3NjM1MzkzOjMxNWE5NTcxMWE5NGZkN2ZjMGFmZGExMTM5YjhmNjgyM2Y3MWZmZDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFCzpqgFqTQ4MTMxMDYwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "315a95711a94fd7fc0afda1139b8f6823f71ffd1", "author": {"user": {"login": "suvodeep-pyne", "name": "Suvodeep Pyne"}}, "url": "https://github.com/apache/pinot/commit/315a95711a94fd7fc0afda1139b8f6823f71ffd1", "committedDate": "2020-09-02T07:39:25Z", "message": "[TE] Added helm deployment for ThirdEye\n\nCreating a helm application for ThirdEye to work with pinot quickstart\nright off the box. The current change installs MySQL with the initial\nset of tables. This creates thirdeye frontend and backend pods\n\nCaveats:\n - The initdb.sql needs to be updated regularly which is an overhead\n - Using the create-schema.sql is not possible at the moment since the script has errors with MySQL 5.7. This is to be refactored."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd0c7395d2cea2f29fa4815b88618814f0e3b5b3", "author": {"user": {"login": "suvodeep-pyne", "name": "Suvodeep Pyne"}}, "url": "https://github.com/apache/pinot/commit/fd0c7395d2cea2f29fa4815b88618814f0e3b5b3", "committedDate": "2020-09-02T17:36:56Z", "message": "[TE] Added helm deployment for ThirdEye\n\nRefactored/cleaned up values.yaml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMDg5MjM1", "url": "https://github.com/apache/pinot/pull/5961#pullrequestreview-481089235", "createdAt": "2020-09-02T17:50:55Z", "commit": {"oid": "fd0c7395d2cea2f29fa4815b88618814f0e3b5b3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNzo1MDo1NVrOHL6nwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNzo1ODoyMlrOHL64lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1NjgzNA==", "bodyText": "We'll need separate \"detector.yml\" files for the scheduler backend and regular worker backends. Scheduler can be a worker too, but there can only be one scheduler active at a time.\nScheduler\nalert: true\nautoload: true\nclassifier: true\nholidayEventsLoader: true\nmonitor: true\nscheduler: true\nworker: true/false (should be configurable)\ndetectionPipeline: true\ndetectionAlert: true\nmockEventsLoader: true/false (should be configurable)\nWorker\nalert: false\nautoload: false\nclassifier: false\nholidayEventsLoader: false\nmonitor: false\nscheduler: false\nworker: true\ndetectionPipeline: false\ndetectionAlert: false\nmockEventsLoader: false", "url": "https://github.com/apache/pinot/pull/5961#discussion_r482256834", "createdAt": "2020-09-02T17:50:55Z", "author": {"login": "apucher"}, "path": "kubernetes/helm/thirdeye/templates/common/configmap.yaml", "diffHunk": "@@ -0,0 +1,252 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: thirdeye-pinot-quickstart-datasource-config\n+data:\n+  persistence.yml: |-\n+    databaseConfiguration:\n+      url: jdbc:mysql://{{ .Release.Name }}-mysql/thirdeye\n+      user: {{ .Values.mysql.mysqlUser }}\n+      password: {{ .Values.mysql.mysqlPassword }}\n+      driver: com.mysql.jdbc.Driver\n+  dashboard.yml: |-\n+    authConfig:\n+      authEnabled: false\n+      authKey: \"\"\n+      ldapUrl: \"\"\n+      domainSuffix: []\n+      cacheTTL: 3600\n+      cookieTTL: 604800\n+    resourceConfig: []\n+    rootCause:\n+      definitionsPath: rca.yml\n+      parallelism: 5\n+      formatters:\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.AnomalyEventFormatter\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.ThirdEyeEventFormatter\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.MetricEntityFormatter\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.DimensionEntityFormatter\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.ServiceEntityFormatter\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.DefaultEventEntityFormatter\n+    dashboardHost: \"http://localhost:1426\"\n+    failureFromAddress: thirdeye@localhost\n+    failureToAddress: user@localhost\n+    alerterConfiguration:\n+      smtpConfiguration:\n+        smtpHost: localhost\n+        smtpPort: 25\n+    logging:\n+      level: INFO\n+      loggers:\n+        org.apache.pinot: INFO\n+\n+    server:\n+      type: default\n+      applicationConnectors:\n+        - type: http\n+          port: 1426\n+      adminConnectors:\n+        - type: http\n+          port: 1427\n+      requestLog:\n+        type: external\n+    whitelistDatasets: []\n+    swagger:\n+      resourcePackage: \"org.apache.pinot.thirdeye.dashboard.resources,org.apache.pinot.thirdeye.dashboard.resources.v2,org.apache.pinot.thirdeye.anomaly.onboard,org.apache.pinot.thirdeye.detection,org.apache.pinot.thirdeye.detection.yaml\"\n+\n+  detector.yml: |-\n+    logging:\n+      level: INFO\n+      loggers:\n+        org.hibernate.engine.internal: WARN\n+    server:\n+      type: default\n+      rootPath: '/api/*'\n+      applicationContextPath: /\n+      adminContextPath: /admin\n+      applicationConnectors:\n+        - type: http\n+          port: 1867\n+      adminConnectors:\n+        - type: http\n+          port: 1868\n+    alert: false\n+    autoload: true\n+    # autoOnboardConfiguration:\n+    #   runFrequency: 10s\n+\n+    classifier: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd0c7395d2cea2f29fa4815b88618814f0e3b5b3"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1NzgyOA==", "bodyText": "also, worker CAN omit holidayLoaderConfiguration and SHOULD omit mockEventsLoaderconfiguration", "url": "https://github.com/apache/pinot/pull/5961#discussion_r482257828", "createdAt": "2020-09-02T17:52:36Z", "author": {"login": "apucher"}, "path": "kubernetes/helm/thirdeye/templates/common/configmap.yaml", "diffHunk": "@@ -0,0 +1,252 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: thirdeye-pinot-quickstart-datasource-config\n+data:\n+  persistence.yml: |-\n+    databaseConfiguration:\n+      url: jdbc:mysql://{{ .Release.Name }}-mysql/thirdeye\n+      user: {{ .Values.mysql.mysqlUser }}\n+      password: {{ .Values.mysql.mysqlPassword }}\n+      driver: com.mysql.jdbc.Driver\n+  dashboard.yml: |-\n+    authConfig:\n+      authEnabled: false\n+      authKey: \"\"\n+      ldapUrl: \"\"\n+      domainSuffix: []\n+      cacheTTL: 3600\n+      cookieTTL: 604800\n+    resourceConfig: []\n+    rootCause:\n+      definitionsPath: rca.yml\n+      parallelism: 5\n+      formatters:\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.AnomalyEventFormatter\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.ThirdEyeEventFormatter\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.MetricEntityFormatter\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.DimensionEntityFormatter\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.ServiceEntityFormatter\n+        - org.apache.pinot.thirdeye.dashboard.resources.v2.rootcause.DefaultEventEntityFormatter\n+    dashboardHost: \"http://localhost:1426\"\n+    failureFromAddress: thirdeye@localhost\n+    failureToAddress: user@localhost\n+    alerterConfiguration:\n+      smtpConfiguration:\n+        smtpHost: localhost\n+        smtpPort: 25\n+    logging:\n+      level: INFO\n+      loggers:\n+        org.apache.pinot: INFO\n+\n+    server:\n+      type: default\n+      applicationConnectors:\n+        - type: http\n+          port: 1426\n+      adminConnectors:\n+        - type: http\n+          port: 1427\n+      requestLog:\n+        type: external\n+    whitelistDatasets: []\n+    swagger:\n+      resourcePackage: \"org.apache.pinot.thirdeye.dashboard.resources,org.apache.pinot.thirdeye.dashboard.resources.v2,org.apache.pinot.thirdeye.anomaly.onboard,org.apache.pinot.thirdeye.detection,org.apache.pinot.thirdeye.detection.yaml\"\n+\n+  detector.yml: |-\n+    logging:\n+      level: INFO\n+      loggers:\n+        org.hibernate.engine.internal: WARN\n+    server:\n+      type: default\n+      rootPath: '/api/*'\n+      applicationContextPath: /\n+      adminContextPath: /admin\n+      applicationConnectors:\n+        - type: http\n+          port: 1867\n+      adminConnectors:\n+        - type: http\n+          port: 1868\n+    alert: false\n+    autoload: true\n+    # autoOnboardConfiguration:\n+    #   runFrequency: 10s\n+\n+    classifier: false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1NjgzNA=="}, "originalCommit": {"oid": "fd0c7395d2cea2f29fa4815b88618814f0e3b5b3"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1ODc1MA==", "bodyText": "should be configurable", "url": "https://github.com/apache/pinot/pull/5961#discussion_r482258750", "createdAt": "2020-09-02T17:54:20Z", "author": {"login": "apucher"}, "path": "kubernetes/helm/thirdeye/templates/frontend/service.yaml", "diffHunk": "@@ -0,0 +1,38 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+apiVersion: v1\n+kind: Service\n+metadata:\n+  name: {{ include \"thirdeye.frontend.fullname\" . }}\n+  labels:\n+    app: {{ include \"thirdeye.name\" . }}\n+    chart: {{ include \"thirdeye.chart\" . }}\n+    component: {{ .Values.frontend.name }}\n+    release: {{ .Release.Name }}\n+    heritage: {{ .Release.Service }}\n+spec:\n+  type: LoadBalancer", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd0c7395d2cea2f29fa4815b88618814f0e3b5b3"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI2MTE0Mg==", "bodyText": "this part is pretty ugly. I wonder what's the best practice for retaining the mysql secret over redeploy without exposing this here", "url": "https://github.com/apache/pinot/pull/5961#discussion_r482261142", "createdAt": "2020-09-02T17:58:22Z", "author": {"login": "apucher"}, "path": "kubernetes/helm/thirdeye/values.yaml", "diffHunk": "@@ -0,0 +1,73 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+# Default values for ThirdEye Deployment\n+\n+image:\n+  repository: apachepinot/thirdeye\n+  tag: latest\n+  pullPolicy: IfNotPresent\n+\n+frontend:\n+  enabled: true\n+  name: frontend\n+  replicaCount: 1\n+  port: 1426\n+  adminport: 1427\n+\n+  resources: {}\n+  nodeSelector: {}\n+  tolerations: []\n+  affinity: {}\n+  podAnnotations: {}\n+\n+\n+backend:\n+  enabled: true\n+  name: backend\n+  replicaCount: 1\n+  port: 1867\n+  adminport: 1868\n+\n+  resources: {}\n+  nodeSelector: {}\n+  tolerations: []\n+  affinity: {}\n+  podAnnotations: {}\n+\n+# Persistence layer configuration\n+mysql:\n+  mysqlRootPassword: password", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd0c7395d2cea2f29fa4815b88618814f0e3b5b3"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2edd2885c3377f6263a483522f8407938bedbed9", "author": {"user": {"login": "suvodeep-pyne", "name": "Suvodeep Pyne"}}, "url": "https://github.com/apache/pinot/commit/2edd2885c3377f6263a483522f8407938bedbed9", "committedDate": "2020-09-02T19:38:22Z", "message": "[TE] Added helm deployment for ThirdEye\n\nExposing service type in template. +refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9532203b3a2ecb2d464eee1c53de4eb4ea2baff", "author": {"user": {"login": "suvodeep-pyne", "name": "Suvodeep Pyne"}}, "url": "https://github.com/apache/pinot/commit/b9532203b3a2ecb2d464eee1c53de4eb4ea2baff", "committedDate": "2020-09-02T20:10:49Z", "message": "[TE] Added helm deployment for ThirdEye\n\nChanges\n- Added README.md.\n- ./install.sh enhanced to send all command line args to helm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af1445f71413f948c5a3dda9f49e4e57c057a2a3", "author": {"user": {"login": "suvodeep-pyne", "name": "Suvodeep Pyne"}}, "url": "https://github.com/apache/pinot/commit/af1445f71413f948c5a3dda9f49e4e57c057a2a3", "committedDate": "2020-09-02T20:15:25Z", "message": "[TE] Added helm deployment for ThirdEye\n\nChanges\n- Enabling alert, classifier switches in detector.yaml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMzEwNjA5", "url": "https://github.com/apache/pinot/pull/5961#pullrequestreview-481310609", "createdAt": "2020-09-02T21:23:05Z", "commit": {"oid": "af1445f71413f948c5a3dda9f49e4e57c057a2a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1701, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}