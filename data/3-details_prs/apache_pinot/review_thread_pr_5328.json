{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTU5NzY1", "number": 5328, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMTo0Mzo0OVrOD5LSQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNDo1MjoyOFrOD5QGrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjgwMzIyOnYy", "diffSide": "RIGHT", "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/dociditerators/AndDocIdIterator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMTo0Mzo0OVrOGQTVhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjowOTowOVrOGQUB5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0NzIwNA==", "bodyText": "Can you restructure the (outer) loop so that it is a while with some condition rather than a for(i = ..) in which we change the loop counter? I understand it was already that way.", "url": "https://github.com/apache/pinot/pull/5328#discussion_r419747204", "createdAt": "2020-05-04T21:43:49Z", "author": {"login": "mcvsubbu"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/dociditerators/AndDocIdIterator.java", "diffHunk": "@@ -102,6 +102,17 @@ public int next() {\n           i = -1;\n         }\n       }\n+      if (hasScanBasedIterators && i == docIdIterators.length - 1) {\n+        // this means we found the docId common to all nonScanBased iterators, now we need to ensure\n+        // that its also found in scanBasedIterator, if not matched, we restart the intersection\n+        for (ScanBasedDocIdIterator iterator : scanBasedDocIdIterators) {\n+          if (!iterator.isMatch(currentMax)) {\n+            i = -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cdf280e4a28adc9db762c4196b0cb0fb9f8b8b9"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1ODU2NQ==", "bodyText": "@mcvsubbu Planning to do some clean-up in the following pr. Wanted to keep this pr small and focus on the bug fix.", "url": "https://github.com/apache/pinot/pull/5328#discussion_r419758565", "createdAt": "2020-05-04T22:09:09Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/dociditerators/AndDocIdIterator.java", "diffHunk": "@@ -102,6 +102,17 @@ public int next() {\n           i = -1;\n         }\n       }\n+      if (hasScanBasedIterators && i == docIdIterators.length - 1) {\n+        // this means we found the docId common to all nonScanBased iterators, now we need to ensure\n+        // that its also found in scanBasedIterator, if not matched, we restart the intersection\n+        for (ScanBasedDocIdIterator iterator : scanBasedDocIdIterators) {\n+          if (!iterator.isMatch(currentMax)) {\n+            i = -1;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0NzIwNA=="}, "originalCommit": {"oid": "6cdf280e4a28adc9db762c4196b0cb0fb9f8b8b9"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMzU5Mjc2OnYy", "diffSide": "RIGHT", "path": "pinot-integration-tests/src/test/java/org/apache/pinot/integration/tests/BaseClusterIntegrationTestSet.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNDo1MjoyOVrOGQaW_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNjo1NzozNlrOGQcrGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg2MjI3MA==", "bodyText": "Is it the test case mentioned in the description section? It doesn't seem matched with SELECT ... WHERE (filterA OR filterB) AND filterC though.", "url": "https://github.com/apache/pinot/pull/5328#discussion_r419862270", "createdAt": "2020-05-05T04:52:29Z", "author": {"login": "jackjlli"}, "path": "pinot-integration-tests/src/test/java/org/apache/pinot/integration/tests/BaseClusterIntegrationTestSet.java", "diffHunk": "@@ -137,6 +137,9 @@ public void testHardcodedQueries()\n     query = \"SELECT MAX(ArrTime), MIN(ArrTime) FROM mytable WHERE DaysSinceEpoch >= 16312\";\n     testQuery(query, Arrays.asList(\"SELECT MAX(ArrTime) FROM mytable WHERE DaysSinceEpoch >= 15312\",\n         \"SELECT MIN(ArrTime) FROM mytable WHERE DaysSinceEpoch >= 15312\"));\n+    query =\n+        \"SELECT SUM(TotalAddGTime) FROM mytable WHERE DivArrDelay NOT IN (67, 260) AND Carrier IN ('F9', 'B6') OR DepTime BETWEEN 2144 AND 1926\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cdf280e4a28adc9db762c4196b0cb0fb9f8b8b9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkwMDE4Ng==", "bodyText": "@jackjlli Yes, for hybrid use case, there will be an implicit time filter appended. This is the query that failed before.\nDo we have an issue opened for this?", "url": "https://github.com/apache/pinot/pull/5328#discussion_r419900186", "createdAt": "2020-05-05T06:57:36Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-integration-tests/src/test/java/org/apache/pinot/integration/tests/BaseClusterIntegrationTestSet.java", "diffHunk": "@@ -137,6 +137,9 @@ public void testHardcodedQueries()\n     query = \"SELECT MAX(ArrTime), MIN(ArrTime) FROM mytable WHERE DaysSinceEpoch >= 16312\";\n     testQuery(query, Arrays.asList(\"SELECT MAX(ArrTime) FROM mytable WHERE DaysSinceEpoch >= 15312\",\n         \"SELECT MIN(ArrTime) FROM mytable WHERE DaysSinceEpoch >= 15312\"));\n+    query =\n+        \"SELECT SUM(TotalAddGTime) FROM mytable WHERE DivArrDelay NOT IN (67, 260) AND Carrier IN ('F9', 'B6') OR DepTime BETWEEN 2144 AND 1926\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg2MjI3MA=="}, "originalCommit": {"oid": "6cdf280e4a28adc9db762c4196b0cb0fb9f8b8b9"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3224, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}