{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4ODY2ODIw", "number": 5506, "title": "Moved StreamPartitionMsgOffset to be an interface", "bodyText": "Changed StreamPartitionMsgOffset class to be an interface.\nIntroduced a LongMsgOffsetFactory class that can be used for Kafka. Other\nstreams will need to provide their own factory to create offsets of\nvarious types. Keeping LongMsgOffsetFactory in spi, so we can also use\nit in tests. Alternative was to introduce this for each test, but implement\none in kafka that does the same thing.\nIntroduced a new config 'stream..partition.offset.factory.class.name'\nStream providers need to set the offset factory class with this config key.\nAll classes now use StreamPartitionMsgOffset instead of 'long', except for\ncases where the offset is received from the stream or the offset is being\nread or written to persistent zk metadata.\nMarked TODOs explicity on items still to be done to complete impleemntation\nof generic offsets.\n\nIssue #5359\nDescription\nAdd a description of your PR here.\nA good description should include pointers to an issue or design document, etc.\nUpgrade Notes\nDoes this PR prevent a zero down-time upgrade? (Assume upgrade order: Controller, Broker, Server, Minion)\n\n Yes (Please label as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR fix a zero-downtime upgrade introduced earlier?\n\n Yes (Please label this as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR otherwise need attention when creating release notes? Things to consider:\n\nNew configuration options\nDeprecation of configurations\nSignature changes to public methods/interfaces\nNew plugins added or old plugins removed\n\n\n Yes (Please label this PR as release-notes and complete the section on Release Notes)\n\nRelease Notes\nIf you have tagged this as either backward-incompat or release-notes,\nyou MUST add text here that you would like to see appear in release notes of the\nnext release.\nIf you have a series of commits adding or enabling a feature, then\nadd this section only in final commit that marks the feature completed.\nRefer to earlier release notes to see examples of text\nDocumentation\nIf you have introduced a new feature or configuration, please add it to the documentation as well.\nSee https://docs.pinot.apache.org/developers/developers-and-contributors/update-document", "createdAt": "2020-06-06T00:14:19Z", "url": "https://github.com/apache/pinot/pull/5506", "merged": true, "mergeCommit": {"oid": "957b28dbdee7cc90bb272be50ea2db6f28c99e53"}, "closed": true, "closedAt": "2020-06-09T16:28:09Z", "author": {"login": "mcvsubbu"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcobW1jAH2gAyNDI4ODY2ODIwOmZjM2E5ZTYxYWYxMWRlZGYxMDgwN2JiZDQ3OTJhNmE3MmMxNGIzOTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpnbViAFqTQyNzMyNTU1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fc3a9e61af11dedf10807bbd4792a6a72c14b397", "author": {"user": {"login": "mcvsubbu", "name": "Subbu Subramaniam"}}, "url": "https://github.com/apache/pinot/commit/fc3a9e61af11dedf10807bbd4792a6a72c14b397", "committedDate": "2020-06-05T23:35:26Z", "message": "Moved StreamPartitionMsgOffset to be an interface\n\n- Changed StreamPartitionMsgOffset class to be an interface.\n- Introduced a LongMsgOffsetFactory class that can be used for Kafka. Other\n  streams will need to provide their own factory to create offsets of\n  various types. Keeping LongMsgOffsetFactory in spi, so we can also use\n  it in tests. Alternative was to introduce this for each test, but implement\n  one in kafka that does the same thing.\n- Introduced a new config 'stream.<type>.partition.offset.factory.class.name'\n  Stream providers need to set the offset factory class with this config key.\n- All classes now use StreamPartitionMsgOffset instead of 'long', except for\n  cases where the offset is received from the stream or the offset is being\n  read or written to persistent zk metadata.\n- Marked TODOs explicity on items still to be done to complete impleemntation\n  of generic offsets.\n\nIssue #5359"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9aa45ee08dbed056dd7002c016f2551cbee753f6", "author": {"user": {"login": "mcvsubbu", "name": "Subbu Subramaniam"}}, "url": "https://github.com/apache/pinot/commit/9aa45ee08dbed056dd7002c016f2551cbee753f6", "committedDate": "2020-06-07T00:06:59Z", "message": "Enabled parsing stream partition msg offset in protocol\n\nAnd also added a backward cmpatibility test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb6a33795f3db3013cbe0dfa2c63126f046f7e2a", "author": {"user": {"login": "mcvsubbu", "name": "Subbu Subramaniam"}}, "url": "https://github.com/apache/pinot/commit/bb6a33795f3db3013cbe0dfa2c63126f046f7e2a", "committedDate": "2020-06-07T14:52:49Z", "message": "Fix unit test failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzU3OTc5", "url": "https://github.com/apache/pinot/pull/5506#pullrequestreview-426757979", "createdAt": "2020-06-09T03:06:03Z", "commit": {"oid": "bb6a33795f3db3013cbe0dfa2c63126f046f7e2a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMzowNjowM1rOGg3NwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMzowNjowM1rOGg3NwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExMjI1Ng==", "bodyText": "will we introduce new methods for setting offset in the metadata? What happens to old segments?", "url": "https://github.com/apache/pinot/pull/5506#discussion_r437112256", "createdAt": "2020-06-09T03:06:03Z", "author": {"login": "npawar"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/realtime/PinotLLCRealtimeSegmentManager.java", "diffHunk": "@@ -515,7 +519,8 @@ private void createNewSegmentZKMetadata(TableConfig tableConfig, PartitionLevelS\n     newSegmentZKMetadata.setTableName(realtimeTableName);\n     newSegmentZKMetadata.setSegmentName(segmentName);\n     newSegmentZKMetadata.setCreationTime(creationTimeMs);\n-    newSegmentZKMetadata.setStartOffset(startOffset);\n+    // TODO Issue 5953 Use string offset in the metadata\n+    newSegmentZKMetadata.setStartOffset(Long.parseLong(startOffset.toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb6a33795f3db3013cbe0dfa2c63126f046f7e2a"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MzI1NTUy", "url": "https://github.com/apache/pinot/pull/5506#pullrequestreview-427325552", "createdAt": "2020-06-09T16:13:08Z", "commit": {"oid": "bb6a33795f3db3013cbe0dfa2c63126f046f7e2a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 907, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}