{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MjQxODcw", "number": 5478, "title": "Add a new table config field for peer segment download.", "bodyText": "Description\nAdd a new optional string field peerSegmentDownloadScheme to the SegmentsValidationAndRetentionConfig in the TableConfig. The value can be http or https.\nThe field will enable download of segments for both realtime and offline table segments from peer servers. In the beginning, only realtime table segments download will be supported. The design details can be found in this section of the cwiki doc.\n@mcvsubbu\nUpgrade Notes\nDoes this PR prevent a zero down-time upgrade? (Assume upgrade order: Controller, Broker, Server, Minion)\n\n Yes (Please label as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR fix a zero-downtime upgrade introduced earlier?\n\n Yes (Please label this as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR otherwise need attention when creating release notes? Things to consider:\n\nNew configuration options\nDeprecation of configurations\nSignature changes to public methods/interfaces\nNew plugins added or old plugins removed\n\n\n Yes (Please label this PR as release-notes and complete the section on Release Notes)\n\nRelease Notes\nAdd a new optional string field peerSegmentDownloadScheme to the SegmentsValidationAndRetentionConfig in the TableConfig. The value can be http or https.\nThe field will enable download of segments for both realtime and offline table segments from peer servers. Currently, only realtime table segment download during LLC segment completion protocol will be supported. For more details, please refer to the cwiki design doc \"By-passing deepstore requirement for realtime segment completion\".\nDocumentation\nIf you have introduced a new feature or configuration, please add it to the documentation as well.\nSee https://docs.pinot.apache.org/developers/developers-and-contributors/update-document", "createdAt": "2020-06-01T22:12:53Z", "url": "https://github.com/apache/pinot/pull/5478", "merged": true, "mergeCommit": {"oid": "8a3eb4315df59d6d73a4ec11308d30eab1c51042"}, "closed": true, "closedAt": "2020-06-02T21:00:48Z", "author": {"login": "chenboat"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnHudygH2gAyNDI2MjQxODcwOjllMDM1YjY2MmUwYWVkYmFhMjVkMWYyMjdmN2IwNDA4NmZhMTM2ZGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnYRHsgH2gAyNDI2MjQxODcwOmNiNjgyNjMyNzc4YTA1NjhlY2VhYzExYzE1ZjhhNWE3MmJiOWM3NjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9e035b662e0aedbaa25d1f227f7b04086fa136da", "author": {"user": {"login": "chenboat", "name": "Ting Chen"}}, "url": "https://github.com/apache/pinot/commit/9e035b662e0aedbaa25d1f227f7b04086fa136da", "committedDate": "2020-06-01T22:09:13Z", "message": "Add a new table config field for peer segment download."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjI4MjIz", "url": "https://github.com/apache/pinot/pull/5478#pullrequestreview-422228223", "createdAt": "2020-06-01T22:38:30Z", "commit": {"oid": "9e035b662e0aedbaa25d1f227f7b04086fa136da"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73509668f6e18446c2851307d1698d55c88670b7", "author": {"user": {"login": "chenboat", "name": "Ting Chen"}}, "url": "https://github.com/apache/pinot/commit/73509668f6e18446c2851307d1698d55c88670b7", "committedDate": "2020-06-02T05:06:22Z", "message": "Address feedbacks."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyODAzNzY3", "url": "https://github.com/apache/pinot/pull/5478#pullrequestreview-422803767", "createdAt": "2020-06-02T15:36:08Z", "commit": {"oid": "73509668f6e18446c2851307d1698d55c88670b7"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNTozNjowOFrOGd3bbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNTozODowM1rOGd3glA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk3MDAyOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!\"http\".equals(peerSegmentDownloadScheme) && !\"https\".equals(peerSegmentDownloadScheme)) {\n          \n          \n            \n                    if (!\"http\".equalsIgnoreCase(peerSegmentDownloadScheme) && !\"https\".equalsIgnoreCase(peerSegmentDownloadScheme)) {", "url": "https://github.com/apache/pinot/pull/5478#discussion_r433970028", "createdAt": "2020-06-02T15:36:08Z", "author": {"login": "mcvsubbu"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/config/TableConfigUtils.java", "diffHunk": "@@ -201,4 +207,16 @@ public static void validate(TableConfig tableConfig) {\n       }\n     }\n   }\n+\n+  private static void validateValidationConfig(TableConfig tableConfig) {\n+    SegmentsValidationAndRetentionConfig validationConfig = tableConfig.getValidationConfig();\n+    if (validationConfig != null) {\n+      String peerSegmentDownloadScheme = validationConfig.getPeerSegmentDownloadScheme();\n+      if (peerSegmentDownloadScheme != null) {\n+        if (!\"http\".equals(peerSegmentDownloadScheme) && !\"https\".equals(peerSegmentDownloadScheme)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73509668f6e18446c2851307d1698d55c88670b7"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk3MTM0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      throw new IllegalStateException(\"peerSegmentDownloadScheme: \" + peerSegmentDownloadScheme + \" is not http nor https\" );\n          \n          \n            \n                      throw new IllegalStateException(\"Invalid value '\" + peerSegmentDownloadScheme + \"' for peerSegmentDownloadScheme. Must be one of http nor https\" );", "url": "https://github.com/apache/pinot/pull/5478#discussion_r433971348", "createdAt": "2020-06-02T15:38:03Z", "author": {"login": "mcvsubbu"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/config/TableConfigUtils.java", "diffHunk": "@@ -201,4 +207,16 @@ public static void validate(TableConfig tableConfig) {\n       }\n     }\n   }\n+\n+  private static void validateValidationConfig(TableConfig tableConfig) {\n+    SegmentsValidationAndRetentionConfig validationConfig = tableConfig.getValidationConfig();\n+    if (validationConfig != null) {\n+      String peerSegmentDownloadScheme = validationConfig.getPeerSegmentDownloadScheme();\n+      if (peerSegmentDownloadScheme != null) {\n+        if (!\"http\".equals(peerSegmentDownloadScheme) && !\"https\".equals(peerSegmentDownloadScheme)) {\n+          throw new IllegalStateException(\"peerSegmentDownloadScheme: \" + peerSegmentDownloadScheme + \" is not http nor https\" );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73509668f6e18446c2851307d1698d55c88670b7"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4baeff5addd28e36f5d28e126fe4eaaf7a949ee5", "author": {"user": {"login": "chenboat", "name": "Ting Chen"}}, "url": "https://github.com/apache/pinot/commit/4baeff5addd28e36f5d28e126fe4eaaf7a949ee5", "committedDate": "2020-06-02T17:24:56Z", "message": "Update pinot-common/src/main/java/org/apache/pinot/common/utils/config/TableConfigUtils.java\n\nCo-authored-by: Subbu Subramaniam <mcvsubbu@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb682632778a0568eceac11c15f8a5a72bb9c760", "author": {"user": {"login": "chenboat", "name": "Ting Chen"}}, "url": "https://github.com/apache/pinot/commit/cb682632778a0568eceac11c15f8a5a72bb9c760", "committedDate": "2020-06-02T17:25:33Z", "message": "Update pinot-common/src/main/java/org/apache/pinot/common/utils/config/TableConfigUtils.java\n\nCo-authored-by: Subbu Subramaniam <mcvsubbu@users.noreply.github.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 880, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}