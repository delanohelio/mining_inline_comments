{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNzA3MDEy", "number": 5234, "title": "[TE] add rate limiter to batch alert onboarding", "bodyText": "Add a rate limiter to the create alert API. The QPS permit can be set in Thirdeye configs. If the QPS is above the permit, it will return an error message to the users. This is to prevent the users who are using API to create alerts at a high throughput which could bring down the system.", "createdAt": "2020-04-10T00:37:51Z", "url": "https://github.com/apache/pinot/pull/5234", "merged": true, "mergeCommit": {"oid": "8b1cde88a592cca42fdacfd2f9455da650b2a276"}, "closed": true, "closedAt": "2020-04-13T19:01:15Z", "author": {"login": "jihaozh"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWFhvsAH2gAyNDAxNzA3MDEyOjVkYjFkZjIzMWMwNjJlNzliYmYxYTA2MmJmNzI3MjUzMzhmZjMwNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXSqnpgH2gAyNDAxNzA3MDEyOjMwZTRlOTlmZDdiNjM2ZGMyM2E4NWE4YTNhYmYwZGQ2MjM0NTc5MmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5db1df231c062e79bbf1a062bf72725338ff3060", "author": {"user": {"login": "jihaozh", "name": "Jihao Zhang"}}, "url": "https://github.com/apache/pinot/commit/5db1df231c062e79bbf1a062bf72725338ff3060", "committedDate": "2020-04-09T23:58:48Z", "message": "[TE] add rate limiter on alert onboarding"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODIwNjgx", "url": "https://github.com/apache/pinot/pull/5234#pullrequestreview-391820681", "createdAt": "2020-04-12T04:30:36Z", "commit": {"oid": "5db1df231c062e79bbf1a062bf72725338ff3060"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwNDozMDozNlrOGESHZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwNDozMDozNlrOGESHZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzE0NDI5NA==", "bodyText": "Can you put the rate limit in the error message?", "url": "https://github.com/apache/pinot/pull/5234#discussion_r407144294", "createdAt": "2020-04-12T04:30:36Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/yaml/YamlResource.java", "diffHunk": "@@ -366,6 +369,11 @@ long createDetectionConfig(@NotNull String yamlDetectionConfig) throws Exception\n   }\n \n   long createDetectionConfig(@NotNull String payload, long startTime, long endTime) throws Exception {\n+    // if can't acquire alert onboarding QPS permit, throw an exception\n+    if (!this.onboardingRateLimiter.tryAcquire()) {\n+      throw new RuntimeException(\"Server is busy handling create detection requests. Please retry later.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5db1df231c062e79bbf1a062bf72725338ff3060"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODIwNjg5", "url": "https://github.com/apache/pinot/pull/5234#pullrequestreview-391820689", "createdAt": "2020-04-12T04:30:44Z", "commit": {"oid": "5db1df231c062e79bbf1a062bf72725338ff3060"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30e4e99fd7b636dc23a85a8a3abf0dd62345792d", "author": {"user": {"login": "jihaozh", "name": "Jihao Zhang"}}, "url": "https://github.com/apache/pinot/commit/30e4e99fd7b636dc23a85a8a3abf0dd62345792d", "committedDate": "2020-04-13T17:51:11Z", "message": "address comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1203, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}