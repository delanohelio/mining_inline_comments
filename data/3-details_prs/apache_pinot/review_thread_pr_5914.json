{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNzU0NTQ5", "number": 5914, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMjo1NjoyMlrOEbxPug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMjo1NjoyMlrOEbxPug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NTUzODUwOnYy", "diffSide": "RIGHT", "path": "docker/images/pinot-thirdeye/bin/start-thirdeye.sh", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMjo1NjoyMlrOHF5Alw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQwMDowNDo0MFrOHF7uJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzODk2Nw==", "bodyText": "maybe add a start_database function for h2 specifically, so it can be started just like front and backend. imo otherwise start_all has an \"unexpected\" side-effect of bringing up a db", "url": "https://github.com/apache/pinot/pull/5914#discussion_r475938967", "createdAt": "2020-08-24T22:56:22Z", "author": {"login": "apucher"}, "path": "docker/images/pinot-thirdeye/bin/start-thirdeye.sh", "diffHunk": "@@ -18,32 +18,64 @@\n # under the License.\n #\n \n+# Script Usage\n+# ---------------------------------------------\n+# ./start-thirdeye.sh ${CONFIG_DIR} ${MODE}\n+#\n+# - CONFIG_DIR: path to the thirdeye configuration director\n+# - MODE: Choices: {frontend, backend, * }\n+#       frontend: Start the frontend server only\n+#       backend: Start the backend server only\n+#       For any other value, defaults to starting all services with an h2 db.\n+#\n+\n if [[ \"$#\" -gt 0 ]]\n then\n   CONFIG_DIR=\"./config/$1\"\n else\n   CONFIG_DIR=\"./config/default\"\n fi\n \n-echo \"Starting H2 database server\"\n-java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.Server -tcp -baseDir \"${CONFIG_DIR}/..\" &\n-sleep 1\n \n-echo \"Creating ThirdEye database schema\"\n-java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.RunScript -user \"sa\" -password \"sa\" -url \"jdbc:h2:tcp:localhost/h2db\" -script \"zip:./bin/thirdeye-pinot.jar!/schema/create-schema.sql\"\n+function start_server {\n+  class_ref=$1\n+  config_dir=$2\n+  java -Dlog4j.configurationFile=log4j2.xml -cp \"./bin/thirdeye-pinot.jar\" ${class_ref} \"${config_dir}\"\n+}\n \n-if [ -f \"${CONFIG_DIR}/bootstrap.sql\" ]; then\n-  echo \"Running database bootstrap script ${CONFIG_DIR}/bootstrap.sql\"\n-  java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.RunScript -user \"sa\" -password \"sa\" -url \"jdbc:h2:tcp:localhost/h2db\" -script \"${CONFIG_DIR}/bootstrap.sql\"\n-fi\n+function start_frontend {\n+  echo \"Running Thirdeye frontend config: ${CONFIG_DIR}\"\n+  start_server org.apache.pinot.thirdeye.dashboard.ThirdEyeDashboardApplication \"${CONFIG_DIR}\"\n+}\n+\n+function start_backend {\n+  echo \"Running Thirdeye backend config: ${CONFIG_DIR}\"\n+  start_server  org.apache.pinot.thirdeye.anomaly.ThirdEyeAnomalyApplication \"${CONFIG_DIR}\"\n+}\n+\n+function start_all {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43953c8c1b45abd32bb2bf78c8af93ab5a87169b"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk1NjQ1Ng==", "bodyText": "The h2 launch doesn't seem to be a background job in the first place. I'm not sure whether the current setup launches the db server in a separate process and how it works. Ideally, starting multiple services in a single docker itself has some issues. So, I am not refactoring that part which I'm not able to test. I think launching a MySQL DB instead of H2 should just simplify things a lot.", "url": "https://github.com/apache/pinot/pull/5914#discussion_r475956456", "createdAt": "2020-08-24T23:26:11Z", "author": {"login": "suvodeep-pyne"}, "path": "docker/images/pinot-thirdeye/bin/start-thirdeye.sh", "diffHunk": "@@ -18,32 +18,64 @@\n # under the License.\n #\n \n+# Script Usage\n+# ---------------------------------------------\n+# ./start-thirdeye.sh ${CONFIG_DIR} ${MODE}\n+#\n+# - CONFIG_DIR: path to the thirdeye configuration director\n+# - MODE: Choices: {frontend, backend, * }\n+#       frontend: Start the frontend server only\n+#       backend: Start the backend server only\n+#       For any other value, defaults to starting all services with an h2 db.\n+#\n+\n if [[ \"$#\" -gt 0 ]]\n then\n   CONFIG_DIR=\"./config/$1\"\n else\n   CONFIG_DIR=\"./config/default\"\n fi\n \n-echo \"Starting H2 database server\"\n-java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.Server -tcp -baseDir \"${CONFIG_DIR}/..\" &\n-sleep 1\n \n-echo \"Creating ThirdEye database schema\"\n-java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.RunScript -user \"sa\" -password \"sa\" -url \"jdbc:h2:tcp:localhost/h2db\" -script \"zip:./bin/thirdeye-pinot.jar!/schema/create-schema.sql\"\n+function start_server {\n+  class_ref=$1\n+  config_dir=$2\n+  java -Dlog4j.configurationFile=log4j2.xml -cp \"./bin/thirdeye-pinot.jar\" ${class_ref} \"${config_dir}\"\n+}\n \n-if [ -f \"${CONFIG_DIR}/bootstrap.sql\" ]; then\n-  echo \"Running database bootstrap script ${CONFIG_DIR}/bootstrap.sql\"\n-  java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.RunScript -user \"sa\" -password \"sa\" -url \"jdbc:h2:tcp:localhost/h2db\" -script \"${CONFIG_DIR}/bootstrap.sql\"\n-fi\n+function start_frontend {\n+  echo \"Running Thirdeye frontend config: ${CONFIG_DIR}\"\n+  start_server org.apache.pinot.thirdeye.dashboard.ThirdEyeDashboardApplication \"${CONFIG_DIR}\"\n+}\n+\n+function start_backend {\n+  echo \"Running Thirdeye backend config: ${CONFIG_DIR}\"\n+  start_server  org.apache.pinot.thirdeye.anomaly.ThirdEyeAnomalyApplication \"${CONFIG_DIR}\"\n+}\n+\n+function start_all {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzODk2Nw=="}, "originalCommit": {"oid": "43953c8c1b45abd32bb2bf78c8af93ab5a87169b"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk3Mzg0Nw==", "bodyText": "H2 does start in the background on line 58. The other calls on line 62 and 66 create the schema and bootstrap some metadata, respectively.", "url": "https://github.com/apache/pinot/pull/5914#discussion_r475973847", "createdAt": "2020-08-24T23:50:45Z", "author": {"login": "apucher"}, "path": "docker/images/pinot-thirdeye/bin/start-thirdeye.sh", "diffHunk": "@@ -18,32 +18,64 @@\n # under the License.\n #\n \n+# Script Usage\n+# ---------------------------------------------\n+# ./start-thirdeye.sh ${CONFIG_DIR} ${MODE}\n+#\n+# - CONFIG_DIR: path to the thirdeye configuration director\n+# - MODE: Choices: {frontend, backend, * }\n+#       frontend: Start the frontend server only\n+#       backend: Start the backend server only\n+#       For any other value, defaults to starting all services with an h2 db.\n+#\n+\n if [[ \"$#\" -gt 0 ]]\n then\n   CONFIG_DIR=\"./config/$1\"\n else\n   CONFIG_DIR=\"./config/default\"\n fi\n \n-echo \"Starting H2 database server\"\n-java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.Server -tcp -baseDir \"${CONFIG_DIR}/..\" &\n-sleep 1\n \n-echo \"Creating ThirdEye database schema\"\n-java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.RunScript -user \"sa\" -password \"sa\" -url \"jdbc:h2:tcp:localhost/h2db\" -script \"zip:./bin/thirdeye-pinot.jar!/schema/create-schema.sql\"\n+function start_server {\n+  class_ref=$1\n+  config_dir=$2\n+  java -Dlog4j.configurationFile=log4j2.xml -cp \"./bin/thirdeye-pinot.jar\" ${class_ref} \"${config_dir}\"\n+}\n \n-if [ -f \"${CONFIG_DIR}/bootstrap.sql\" ]; then\n-  echo \"Running database bootstrap script ${CONFIG_DIR}/bootstrap.sql\"\n-  java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.RunScript -user \"sa\" -password \"sa\" -url \"jdbc:h2:tcp:localhost/h2db\" -script \"${CONFIG_DIR}/bootstrap.sql\"\n-fi\n+function start_frontend {\n+  echo \"Running Thirdeye frontend config: ${CONFIG_DIR}\"\n+  start_server org.apache.pinot.thirdeye.dashboard.ThirdEyeDashboardApplication \"${CONFIG_DIR}\"\n+}\n+\n+function start_backend {\n+  echo \"Running Thirdeye backend config: ${CONFIG_DIR}\"\n+  start_server  org.apache.pinot.thirdeye.anomaly.ThirdEyeAnomalyApplication \"${CONFIG_DIR}\"\n+}\n+\n+function start_all {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzODk2Nw=="}, "originalCommit": {"oid": "43953c8c1b45abd32bb2bf78c8af93ab5a87169b"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTk4MzM5OQ==", "bodyText": "I see. My bad. Let me update this.", "url": "https://github.com/apache/pinot/pull/5914#discussion_r475983399", "createdAt": "2020-08-25T00:04:40Z", "author": {"login": "suvodeep-pyne"}, "path": "docker/images/pinot-thirdeye/bin/start-thirdeye.sh", "diffHunk": "@@ -18,32 +18,64 @@\n # under the License.\n #\n \n+# Script Usage\n+# ---------------------------------------------\n+# ./start-thirdeye.sh ${CONFIG_DIR} ${MODE}\n+#\n+# - CONFIG_DIR: path to the thirdeye configuration director\n+# - MODE: Choices: {frontend, backend, * }\n+#       frontend: Start the frontend server only\n+#       backend: Start the backend server only\n+#       For any other value, defaults to starting all services with an h2 db.\n+#\n+\n if [[ \"$#\" -gt 0 ]]\n then\n   CONFIG_DIR=\"./config/$1\"\n else\n   CONFIG_DIR=\"./config/default\"\n fi\n \n-echo \"Starting H2 database server\"\n-java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.Server -tcp -baseDir \"${CONFIG_DIR}/..\" &\n-sleep 1\n \n-echo \"Creating ThirdEye database schema\"\n-java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.RunScript -user \"sa\" -password \"sa\" -url \"jdbc:h2:tcp:localhost/h2db\" -script \"zip:./bin/thirdeye-pinot.jar!/schema/create-schema.sql\"\n+function start_server {\n+  class_ref=$1\n+  config_dir=$2\n+  java -Dlog4j.configurationFile=log4j2.xml -cp \"./bin/thirdeye-pinot.jar\" ${class_ref} \"${config_dir}\"\n+}\n \n-if [ -f \"${CONFIG_DIR}/bootstrap.sql\" ]; then\n-  echo \"Running database bootstrap script ${CONFIG_DIR}/bootstrap.sql\"\n-  java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.RunScript -user \"sa\" -password \"sa\" -url \"jdbc:h2:tcp:localhost/h2db\" -script \"${CONFIG_DIR}/bootstrap.sql\"\n-fi\n+function start_frontend {\n+  echo \"Running Thirdeye frontend config: ${CONFIG_DIR}\"\n+  start_server org.apache.pinot.thirdeye.dashboard.ThirdEyeDashboardApplication \"${CONFIG_DIR}\"\n+}\n+\n+function start_backend {\n+  echo \"Running Thirdeye backend config: ${CONFIG_DIR}\"\n+  start_server  org.apache.pinot.thirdeye.anomaly.ThirdEyeAnomalyApplication \"${CONFIG_DIR}\"\n+}\n+\n+function start_all {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzODk2Nw=="}, "originalCommit": {"oid": "43953c8c1b45abd32bb2bf78c8af93ab5a87169b"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4049, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}