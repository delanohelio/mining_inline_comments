{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyNzE2ODUz", "number": 6213, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNjo1NDoxNFrOEzq5ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNjo1NDoxNFrOEzq5ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjE1NzEwOnYy", "diffSide": "RIGHT", "path": "pinot-core/src/main/java/org/apache/pinot/core/upsert/PartitionUpsertMetadataManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNjo1NDoxNFrOHrDIXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNzo1Njo1MlrOHraZoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDkwMjEwOQ==", "bodyText": "Can you update this line of comments? It is a bit hard to understand. Do you mean:\n\"\u2026, where we want to\" =>. In this case, we want to update the record location when there is a tie\u2026\nalso when this is a tie, how to you update the record location? Should it be determined by docID?", "url": "https://github.com/apache/pinot/pull/6213#discussion_r514902109", "createdAt": "2020-10-30T06:54:14Z", "author": {"login": "chenboat"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/upsert/PartitionUpsertMetadataManager.java", "diffHunk": "@@ -83,34 +87,34 @@ public ThreadSafeMutableRoaringBitmap addSegment(String segmentName, Iterator<Re\n           if (segmentName.equals(currentRecordLocation.getSegmentName())) {\n             // The current record location has the same segment name\n \n-            if (validDocIds == currentRecordLocation.getValidDocIds()) {\n-              // The current record location is pointing to the new segment being loaded\n-\n-              // Update the record location when getting a newer timestamp\n-              if (recordInfo._timestamp > currentRecordLocation.getTimestamp()) {\n+            // Update the record location when the new timestamp is greater than or equal to the current timestamp.\n+            // There are 2 scenarios:\n+            //   1. The current record location is pointing to the new segment being loaded, where we want to update the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "089dac2b0f2b97865b4c8f17fd5ce2b6a730cfd5"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI4MzM2MA==", "bodyText": "Rephrased the comments.\nThe iterator will return records with incremental doc ids, so we don't need to compare docId here.", "url": "https://github.com/apache/pinot/pull/6213#discussion_r515283360", "createdAt": "2020-10-30T17:56:52Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/upsert/PartitionUpsertMetadataManager.java", "diffHunk": "@@ -83,34 +87,34 @@ public ThreadSafeMutableRoaringBitmap addSegment(String segmentName, Iterator<Re\n           if (segmentName.equals(currentRecordLocation.getSegmentName())) {\n             // The current record location has the same segment name\n \n-            if (validDocIds == currentRecordLocation.getValidDocIds()) {\n-              // The current record location is pointing to the new segment being loaded\n-\n-              // Update the record location when getting a newer timestamp\n-              if (recordInfo._timestamp > currentRecordLocation.getTimestamp()) {\n+            // Update the record location when the new timestamp is greater than or equal to the current timestamp.\n+            // There are 2 scenarios:\n+            //   1. The current record location is pointing to the new segment being loaded, where we want to update the", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDkwMjEwOQ=="}, "originalCommit": {"oid": "089dac2b0f2b97865b4c8f17fd5ce2b6a730cfd5"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3813, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}