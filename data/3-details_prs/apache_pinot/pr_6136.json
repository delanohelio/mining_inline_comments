{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyNzAxMTEw", "number": 6136, "title": "add query runner support for query file resampling", "bodyText": "Description\nWe add support for resampling of the query input file to the pinot-tools QueryRunner. This enables us to easily expand a small set of queries proportionally to run performance benchmarks at scale. Also adds tracking of query exceptions. All changes are fully backwards-compatible.\nUpgrade Notes\nDoes this PR prevent a zero down-time upgrade? (Assume upgrade order: Controller, Broker, Server, Minion)\nNo\nDoes this PR fix a zero-downtime upgrade introduced earlier?\nNo\nDoes this PR otherwise need attention when creating release notes? Things to consider:\nNo", "createdAt": "2020-10-13T18:54:20Z", "url": "https://github.com/apache/pinot/pull/6136", "merged": true, "mergeCommit": {"oid": "30bed9b141d5896d4692dfc7f4be4e1e986c0e50"}, "closed": true, "closedAt": "2020-10-15T19:42:17Z", "author": {"login": "apucher"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSNY-XgFqTUwNzc0NDQ1Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdS2gJ4AH2gAyNTAyNzAxMTEwOjc3MzdkMTU0MTUwMTc1M2M0NjM5NmZmZjlmNjI2NjJlNDIyYTE2YmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzQ0NDUz", "url": "https://github.com/apache/pinot/pull/6136#pullrequestreview-507744453", "createdAt": "2020-10-13T19:03:55Z", "commit": {"oid": "b635bac6a63d6229d33d0f9ef45761794fb8b09b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOTowMzo1NVrOHg1Uaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOTowMzo1NVrOHg1Uaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE5MDA1OQ==", "bodyText": "full|sample?", "url": "https://github.com/apache/pinot/pull/6136#discussion_r504190059", "createdAt": "2020-10-13T19:03:55Z", "author": {"login": "xiangfu0"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/perf/QueryRunner.java", "diffHunk": "@@ -49,6 +53,10 @@\n   private String _mode;\n   @Option(name = \"-queryFile\", required = true, metaVar = \"<String>\", usage = \"Path to query file.\")\n   private String _queryFile;\n+  @Option(name = \"-queryMode\", required = false, metaVar = \"<String>\", usage = \"Mode of query generator (list|sample).\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b635bac6a63d6229d33d0f9ef45761794fb8b09b"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzQ1MzUy", "url": "https://github.com/apache/pinot/pull/6136#pullrequestreview-507745352", "createdAt": "2020-10-13T19:05:11Z", "commit": {"oid": "b635bac6a63d6229d33d0f9ef45761794fb8b09b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzQ1MDEz", "url": "https://github.com/apache/pinot/pull/6136#pullrequestreview-507745013", "createdAt": "2020-10-13T19:04:43Z", "commit": {"oid": "b635bac6a63d6229d33d0f9ef45761794fb8b09b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOTowNDo0M1rOHg1WOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOTowNDo0M1rOHg1WOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE5MDUyMw==", "bodyText": "This hashCode could be quite expensive, maybe just use new Random(0)?", "url": "https://github.com/apache/pinot/pull/6136#discussion_r504190523", "createdAt": "2020-10-13T19:04:43Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/perf/QueryRunner.java", "diffHunk": "@@ -622,6 +632,22 @@ public static void increasingQPSQueryRunner(PerfBenchmarkDriverConf conf, String\n     }\n   }\n \n+  private static Stream<String> makeQueries(List<String> inputs, QueryMode queryMode, int queryCount) {\n+    queryCount = queryCount > 0 ? queryCount : inputs.size();\n+\n+    switch (queryMode) {\n+      case LIST:\n+        return inputs.stream().limit(queryCount);\n+\n+      case SAMPLE:\n+        Random r = new Random(inputs.hashCode()); // anything deterministic will do", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b635bac6a63d6229d33d0f9ef45761794fb8b09b"}, "originalPosition": 246}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c6948e41dace0653410f2149ed260dad57c3029", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/1c6948e41dace0653410f2149ed260dad57c3029", "committedDate": "2020-10-15T01:39:25Z", "message": "add query runner support for query file resampling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09313062a3723d9df9200056e7b2434c265580f3", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/09313062a3723d9df9200056e7b2434c265580f3", "committedDate": "2020-10-15T01:39:25Z", "message": "review fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0546110a6460ae68fe513ebce9aa3319060c3e59", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/0546110a6460ae68fe513ebce9aa3319060c3e59", "committedDate": "2020-10-15T01:39:25Z", "message": "track exception counts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "338af06ea22c59e0eced05ff992d20b49aceb9da", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/338af06ea22c59e0eced05ff992d20b49aceb9da", "committedDate": "2020-10-13T20:29:47Z", "message": "track exception counts"}, "afterCommit": {"oid": "0546110a6460ae68fe513ebce9aa3319060c3e59", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/0546110a6460ae68fe513ebce9aa3319060c3e59", "committedDate": "2020-10-15T01:39:25Z", "message": "track exception counts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7737d1541501753c46396fff9f62662e422a16ba", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/7737d1541501753c46396fff9f62662e422a16ba", "committedDate": "2020-10-15T18:57:52Z", "message": "increase targetQPS accuracy"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1591, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}