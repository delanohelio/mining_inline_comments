{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MzQ5NDc1", "number": 6152, "title": "Support using ordinals in GROUP BY and ORDER BY clause", "bodyText": "Description\nSupport Ordinal position in the query for GROUP BY and ORDER BY clause.\nSo we can support queries like:\nSELECT foo, bar, count(*) FROM myTable GROUP BY 1, 2 ORDER BY 1, 2 DESC\n\nRelease Notes\nSupport Ordinal position in the query for GROUP BY and ORDER BY clause.", "createdAt": "2020-10-17T21:25:32Z", "url": "https://github.com/apache/pinot/pull/6152", "merged": true, "mergeCommit": {"oid": "08c46a835829587efa6d9447c2d1f8b5a8ac67d6"}, "closed": true, "closedAt": "2020-10-20T22:02:58Z", "author": {"login": "xiangfu0"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTh1k5gBqjM4ODk2ODAwMzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUHVijgFqTUxMTk3NzgyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0dc43e473389d043bb2f5bb35f9df743310f2488", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/0dc43e473389d043bb2f5bb35f9df743310f2488", "committedDate": "2020-10-17T21:19:59Z", "message": "Support using ordinals in GROUP BY and ORDER BY clause"}, "afterCommit": {"oid": "3ba0d7f665d5f626e27d686c9bd92635c53896ee", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/3ba0d7f665d5f626e27d686c9bd92635c53896ee", "committedDate": "2020-10-17T21:27:03Z", "message": "Support using ordinals in GROUP BY and ORDER BY clause"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMDE2ODQx", "url": "https://github.com/apache/pinot/pull/6152#pullrequestreview-511016841", "createdAt": "2020-10-17T21:37:28Z", "commit": {"oid": "3ba0d7f665d5f626e27d686c9bd92635c53896ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QyMTozNzoyOFrOHjgA3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QyMTozNzoyOFrOHjgA3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk4NjcxNg==", "bodyText": "Would it be possible to make it all or nothing? For example, when you go over the group by expression list and to get the long literal for ordinal position, if the first group by expression doesn't happen to be ordinal then we simply break out of this function immediately rather than going over the rest of the expressions.\nIn other words, if the first group by expression is not an ordinal reference, then remaining one's aren't too", "url": "https://github.com/apache/pinot/pull/6152#discussion_r506986716", "createdAt": "2020-10-17T21:37:28Z", "author": {"login": "siddharthteotia"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -364,6 +367,42 @@ private static void queryRewrite(PinotQuery pinotQuery) {\n     validate(aliasMap, pinotQuery);\n   }\n \n+  private static void applyOrdinals(PinotQuery pinotQuery) {\n+    // handle GROUP BY clause\n+    for (int i = 0; i < pinotQuery.getGroupByListSize(); i++) {\n+      final Expression groupByExpr = pinotQuery.getGroupByList().get(i);\n+      if (groupByExpr.isSetLiteral() && groupByExpr.getLiteral().isSetLongValue()) {\n+        final int ordinal = (int) groupByExpr.getLiteral().getLongValue();\n+        pinotQuery.getGroupByList().set(i, getExpressionFromOrdinal(pinotQuery.getSelectList(), ordinal));\n+      }\n+    }\n+\n+    // handle ORDER BY clause\n+    for (int i = 0; i < pinotQuery.getOrderByListSize(); i++) {\n+      final Expression orderByExpr = pinotQuery.getOrderByList().get(i).getFunctionCall().getOperands().get(0);\n+      if (orderByExpr.isSetLiteral() && orderByExpr.getLiteral().isSetLongValue()) {\n+        final int ordinal = (int) orderByExpr.getLiteral().getLongValue();\n+        pinotQuery.getOrderByList().get(i).getFunctionCall()\n+            .setOperands(Arrays.asList(getExpressionFromOrdinal(pinotQuery.getSelectList(), ordinal)));\n+      }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ba0d7f665d5f626e27d686c9bd92635c53896ee"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b854209022d01a5c8607e404c95963002536e67b", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/b854209022d01a5c8607e404c95963002536e67b", "committedDate": "2020-10-17T22:28:49Z", "message": "Support using ordinals in GROUP BY and ORDER BY clause"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ba0d7f665d5f626e27d686c9bd92635c53896ee", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/3ba0d7f665d5f626e27d686c9bd92635c53896ee", "committedDate": "2020-10-17T21:27:03Z", "message": "Support using ordinals in GROUP BY and ORDER BY clause"}, "afterCommit": {"oid": "b854209022d01a5c8607e404c95963002536e67b", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/b854209022d01a5c8607e404c95963002536e67b", "committedDate": "2020-10-17T22:28:49Z", "message": "Support using ordinals in GROUP BY and ORDER BY clause"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExOTc3ODIy", "url": "https://github.com/apache/pinot/pull/6152#pullrequestreview-511977822", "createdAt": "2020-10-19T17:08:35Z", "commit": {"oid": "b854209022d01a5c8607e404c95963002536e67b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1610, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}