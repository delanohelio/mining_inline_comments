{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MjE1ODky", "number": 6109, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTo1MDowMVrOErVT6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTo1MTowMFrOErVVPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzODczMzg2OnYy", "diffSide": "RIGHT", "path": "pinot-core/src/main/java/org/apache/pinot/core/startree/operator/StarTreeFilterOperator.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTo1MDowMVrOHeDDFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMjoyNDoxNVrOHeLvJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTI2OA==", "bodyText": "do we need to make a copy of groupByColumns?", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501269268", "createdAt": "2020-10-07T19:50:01Z", "author": {"login": "xiangfu0"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/startree/operator/StarTreeFilterOperator.java", "diffHunk": "@@ -121,81 +117,23 @@\n \n   // Star-tree\n   private final StarTreeV2 _starTreeV2;\n-  // Set of group-by columns\n-  private final Set<String> _groupByColumns;\n   // Map from column to predicate evaluators\n   private final Map<String, List<PredicateEvaluator>> _predicateEvaluatorsMap;\n-  // Map from column to matching dictionary ids\n-  private final Map<String, IntSet> _matchingDictIdsMap;\n+  // Set of group-by columns\n+  private final Set<String> _groupByColumns;\n \n   private final Map<String, String> _debugOptions;\n   boolean _resultEmpty = false;\n \n-  public StarTreeFilterOperator(StarTreeV2 starTreeV2, @Nullable FilterContext filter,\n-      @Nullable Set<String> groupByColumns, @Nullable Map<String, String> debugOptions) {\n+  public StarTreeFilterOperator(StarTreeV2 starTreeV2, Map<String, List<PredicateEvaluator>> predicateEvaluatorsMap,\n+      Set<String> groupByColumns, @Nullable Map<String, String> debugOptions) {\n     _starTreeV2 = starTreeV2;\n-    _groupByColumns = groupByColumns != null ? new HashSet<>(groupByColumns) : Collections.emptySet();\n+    _predicateEvaluatorsMap = predicateEvaluatorsMap;\n+    _groupByColumns = groupByColumns;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6519f22df04d8174715530f16c101ae86841024b"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQxMDkzOA==", "bodyText": "We don't because it is not used by the caller. Added some comments on the caller side", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501410938", "createdAt": "2020-10-08T02:21:03Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/startree/operator/StarTreeFilterOperator.java", "diffHunk": "@@ -121,81 +117,23 @@\n \n   // Star-tree\n   private final StarTreeV2 _starTreeV2;\n-  // Set of group-by columns\n-  private final Set<String> _groupByColumns;\n   // Map from column to predicate evaluators\n   private final Map<String, List<PredicateEvaluator>> _predicateEvaluatorsMap;\n-  // Map from column to matching dictionary ids\n-  private final Map<String, IntSet> _matchingDictIdsMap;\n+  // Set of group-by columns\n+  private final Set<String> _groupByColumns;\n \n   private final Map<String, String> _debugOptions;\n   boolean _resultEmpty = false;\n \n-  public StarTreeFilterOperator(StarTreeV2 starTreeV2, @Nullable FilterContext filter,\n-      @Nullable Set<String> groupByColumns, @Nullable Map<String, String> debugOptions) {\n+  public StarTreeFilterOperator(StarTreeV2 starTreeV2, Map<String, List<PredicateEvaluator>> predicateEvaluatorsMap,\n+      Set<String> groupByColumns, @Nullable Map<String, String> debugOptions) {\n     _starTreeV2 = starTreeV2;\n-    _groupByColumns = groupByColumns != null ? new HashSet<>(groupByColumns) : Collections.emptySet();\n+    _predicateEvaluatorsMap = predicateEvaluatorsMap;\n+    _groupByColumns = groupByColumns;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTI2OA=="}, "originalCommit": {"oid": "6519f22df04d8174715530f16c101ae86841024b"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQxMTYyMA==", "bodyText": "After consideration, decide to make a copy in case the caller needs to use it in the future", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501411620", "createdAt": "2020-10-08T02:24:15Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/startree/operator/StarTreeFilterOperator.java", "diffHunk": "@@ -121,81 +117,23 @@\n \n   // Star-tree\n   private final StarTreeV2 _starTreeV2;\n-  // Set of group-by columns\n-  private final Set<String> _groupByColumns;\n   // Map from column to predicate evaluators\n   private final Map<String, List<PredicateEvaluator>> _predicateEvaluatorsMap;\n-  // Map from column to matching dictionary ids\n-  private final Map<String, IntSet> _matchingDictIdsMap;\n+  // Set of group-by columns\n+  private final Set<String> _groupByColumns;\n \n   private final Map<String, String> _debugOptions;\n   boolean _resultEmpty = false;\n \n-  public StarTreeFilterOperator(StarTreeV2 starTreeV2, @Nullable FilterContext filter,\n-      @Nullable Set<String> groupByColumns, @Nullable Map<String, String> debugOptions) {\n+  public StarTreeFilterOperator(StarTreeV2 starTreeV2, Map<String, List<PredicateEvaluator>> predicateEvaluatorsMap,\n+      Set<String> groupByColumns, @Nullable Map<String, String> debugOptions) {\n     _starTreeV2 = starTreeV2;\n-    _groupByColumns = groupByColumns != null ? new HashSet<>(groupByColumns) : Collections.emptySet();\n+    _predicateEvaluatorsMap = predicateEvaluatorsMap;\n+    _groupByColumns = groupByColumns;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTI2OA=="}, "originalCommit": {"oid": "6519f22df04d8174715530f16c101ae86841024b"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzODczNzI3OnYy", "diffSide": "RIGHT", "path": "pinot-core/src/main/java/org/apache/pinot/core/startree/operator/StarTreeFilterOperator.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxOTo1MTowMFrOHeDFIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMzoyMzo1MFrOHeMn9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTc5Mw==", "bodyText": "while (searchEntry = queue.poll() != null) {", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501269793", "createdAt": "2020-10-07T19:51:00Z", "author": {"login": "xiangfu0"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/startree/operator/StarTreeFilterOperator.java", "diffHunk": "@@ -267,19 +206,19 @@ private StarTreeResult traverseStarTree() {\n     // Use BFS to traverse the star tree\n     Queue<SearchEntry> queue = new LinkedList<>();\n     queue.add(new SearchEntry(starTreeRootNode, _predicateEvaluatorsMap.keySet(), _groupByColumns));\n-    while (!queue.isEmpty()) {\n-      SearchEntry searchEntry = queue.remove();\n+    SearchEntry searchEntry;\n+    while ((searchEntry = queue.poll()) != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6519f22df04d8174715530f16c101ae86841024b"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQxMDU5MA==", "bodyText": "The parentheses can not be removed, or it will try to assign the boolean value to searchEntry", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501410590", "createdAt": "2020-10-08T02:19:27Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/startree/operator/StarTreeFilterOperator.java", "diffHunk": "@@ -267,19 +206,19 @@ private StarTreeResult traverseStarTree() {\n     // Use BFS to traverse the star tree\n     Queue<SearchEntry> queue = new LinkedList<>();\n     queue.add(new SearchEntry(starTreeRootNode, _predicateEvaluatorsMap.keySet(), _groupByColumns));\n-    while (!queue.isEmpty()) {\n-      SearchEntry searchEntry = queue.remove();\n+    SearchEntry searchEntry;\n+    while ((searchEntry = queue.poll()) != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTc5Mw=="}, "originalCommit": {"oid": "6519f22df04d8174715530f16c101ae86841024b"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQyNjE2NA==", "bodyText": "got it", "url": "https://github.com/apache/pinot/pull/6109#discussion_r501426164", "createdAt": "2020-10-08T03:23:50Z", "author": {"login": "xiangfu0"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/startree/operator/StarTreeFilterOperator.java", "diffHunk": "@@ -267,19 +206,19 @@ private StarTreeResult traverseStarTree() {\n     // Use BFS to traverse the star tree\n     Queue<SearchEntry> queue = new LinkedList<>();\n     queue.add(new SearchEntry(starTreeRootNode, _predicateEvaluatorsMap.keySet(), _groupByColumns));\n-    while (!queue.isEmpty()) {\n-      SearchEntry searchEntry = queue.remove();\n+    SearchEntry searchEntry;\n+    while ((searchEntry = queue.poll()) != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2OTc5Mw=="}, "originalCommit": {"oid": "6519f22df04d8174715530f16c101ae86841024b"}, "originalPosition": 134}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3709, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}