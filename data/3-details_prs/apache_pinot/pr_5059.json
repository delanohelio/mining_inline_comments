{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNTQwODYy", "number": 5059, "title": "[TE] Adjust dectection window using expected delay", "bodyText": "Add detection expected delay when setting the detection window.\nThis is useful since some datasets have pretty large delay (e.g, 8 days). Using the default look back window can't catch the data.", "createdAt": "2020-02-07T18:23:55Z", "url": "https://github.com/apache/pinot/pull/5059", "merged": true, "mergeCommit": {"oid": "c613f4687a3a91bc8a91d3c09b78b0adfba03c1f"}, "closed": true, "closedAt": "2020-02-19T22:49:26Z", "author": {"login": "xiaohui-sun"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCDw7GgFqTM1NTM1NDA5Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcF7oX2ABqjMwNTMwNzAzNjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MzU0MDkz", "url": "https://github.com/apache/pinot/pull/5059#pullrequestreview-355354093", "createdAt": "2020-02-07T18:35:15Z", "commit": {"oid": "734dbeddf882e0f8d420771997a348dda4f0c879"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODozNToxNVrOFnGViA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODozNToxNVrOFnGViA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0MjYwMA==", "bodyText": "Shall we change it in the DataAvailabilityTaskScheduler too?", "url": "https://github.com/apache/pinot/pull/5059#discussion_r376542600", "createdAt": "2020-02-07T18:35:15Z", "author": {"login": "jihaozh"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionPipelineJob.java", "diffHunk": "@@ -56,9 +57,10 @@ public void execute(JobExecutionContext jobExecutionContext) throws JobExecution\n     Long id = getIdFromJobKey(jobKey.getName());\n     DetectionConfigDTO configDTO = detectionDAO.findById(id);\n \n-    // Make sure start time is not out of DETECTION_TASK_MAX_LOOKBACK_WINDOW\n+    // Get the time window for the detection job.\n+    long delay = getDetectionExpectedDelay(configDTO);\n     long end = System.currentTimeMillis();\n-    long start = Math.max(configDTO.getLastTimestamp(), end  - ThirdEyeUtils.DETECTION_TASK_MAX_LOOKBACK_WINDOW);\n+    long start = Math.max(configDTO.getLastTimestamp(), end - ThirdEyeUtils.DETECTION_TASK_MAX_LOOKBACK_WINDOW - delay);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734dbeddf882e0f8d420771997a348dda4f0c879"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MzYyNjc2", "url": "https://github.com/apache/pinot/pull/5059#pullrequestreview-355362676", "createdAt": "2020-02-07T18:50:05Z", "commit": {"oid": "734dbeddf882e0f8d420771997a348dda4f0c879"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDA3NDEy", "url": "https://github.com/apache/pinot/pull/5059#pullrequestreview-355407412", "createdAt": "2020-02-07T20:07:43Z", "commit": {"oid": "abef85064ce949d6836d86c223a8d421a12d5f73"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDA4OTM3", "url": "https://github.com/apache/pinot/pull/5059#pullrequestreview-355408937", "createdAt": "2020-02-07T20:10:40Z", "commit": {"oid": "abef85064ce949d6836d86c223a8d421a12d5f73"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56678bcd845f9634c6f661d5afda375e8856b58c", "author": {"user": {"login": "xiaohui-sun", "name": "Xiaohui Sun"}}, "url": "https://github.com/apache/pinot/commit/56678bcd845f9634c6f661d5afda375e8856b58c", "committedDate": "2020-02-19T19:22:50Z", "message": "[TE] Adjust dectection window using expected delay"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33f78cedebec1a0f8ee8abcb4166f8cd34a401ee", "author": {"user": {"login": "xiaohui-sun", "name": "Xiaohui Sun"}}, "url": "https://github.com/apache/pinot/commit/33f78cedebec1a0f8ee8abcb4166f8cd34a401ee", "committedDate": "2020-02-19T19:23:44Z", "message": "[TE] Adjust dectection window using expected delay for data availability task scheduler"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abef85064ce949d6836d86c223a8d421a12d5f73", "author": {"user": {"login": "xiaohui-sun", "name": "Xiaohui Sun"}}, "url": "https://github.com/apache/pinot/commit/abef85064ce949d6836d86c223a8d421a12d5f73", "committedDate": "2020-02-07T18:59:42Z", "message": "[TE] Adjust dectection window using expected delay for data availability task scheduler"}, "afterCommit": {"oid": "33f78cedebec1a0f8ee8abcb4166f8cd34a401ee", "author": {"user": {"login": "xiaohui-sun", "name": "Xiaohui Sun"}}, "url": "https://github.com/apache/pinot/commit/33f78cedebec1a0f8ee8abcb4166f8cd34a401ee", "committedDate": "2020-02-19T19:23:44Z", "message": "[TE] Adjust dectection window using expected delay for data availability task scheduler"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1270, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}