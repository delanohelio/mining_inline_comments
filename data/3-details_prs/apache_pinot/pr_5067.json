{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NjA1MzU5", "number": 5067, "title": "Update rate limiter when table config updated on controller (Part 2)", "bodyText": "Currently table's rate limiter gets updated only when there is a table creation/deletion, or the EV of brokerResource gets changed. There is no way to add new rate limiter for existing tables without restarting pinot brokers.\nThis PR checks if table config contains query quota, controller will send out an update msg to brokers, so that brokers can update the rate limiter on the fly.\nThis is the 2nd part of this improvement in pinot-controller. Here is the 1st part in pinot-broker: #5066", "createdAt": "2020-02-13T00:13:06Z", "url": "https://github.com/apache/pinot/pull/5067", "merged": true, "mergeCommit": {"oid": "ef75b027d7af09f625eabb9f192bea7ca109e8eb"}, "closed": true, "closedAt": "2020-03-04T17:38:04Z", "author": {"login": "jackjlli"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDwBmpgBqjMwMzMwMTIyNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKJAqwAFqTM2ODMyOTI5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d67add4d30314dea00b4544c3d029e1dcf1f4388", "author": {"user": {"login": "jackjlli", "name": "Jialiang Li"}}, "url": "https://github.com/apache/pinot/commit/d67add4d30314dea00b4544c3d029e1dcf1f4388", "committedDate": "2020-02-13T00:06:10Z", "message": "[Part 2] Update rate limiter when table config updated"}, "afterCommit": {"oid": "dfa07333f514e7b4224d194fa6ebefee22baf70b", "author": {"user": {"login": "jackjlli", "name": "Jialiang Li"}}, "url": "https://github.com/apache/pinot/commit/dfa07333f514e7b4224d194fa6ebefee22baf70b", "committedDate": "2020-02-13T00:44:42Z", "message": "[Part 2] Update rate limiter when table config updated"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dfa07333f514e7b4224d194fa6ebefee22baf70b", "author": {"user": {"login": "jackjlli", "name": "Jialiang Li"}}, "url": "https://github.com/apache/pinot/commit/dfa07333f514e7b4224d194fa6ebefee22baf70b", "committedDate": "2020-02-13T00:44:42Z", "message": "[Part 2] Update rate limiter when table config updated"}, "afterCommit": {"oid": "857b26afc0c0a5a19941b191bd7a9ea587c6eee8", "author": {"user": {"login": "jackjlli", "name": "Jialiang Li"}}, "url": "https://github.com/apache/pinot/commit/857b26afc0c0a5a19941b191bd7a9ea587c6eee8", "committedDate": "2020-02-29T19:53:56Z", "message": "Rebase from master branch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NjU3MjYx", "url": "https://github.com/apache/pinot/pull/5067#pullrequestreview-367657261", "createdAt": "2020-03-03T02:01:25Z", "commit": {"oid": "857b26afc0c0a5a19941b191bd7a9ea587c6eee8"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NjU3Njgw", "url": "https://github.com/apache/pinot/pull/5067#pullrequestreview-367657680", "createdAt": "2020-03-03T02:02:57Z", "commit": {"oid": "857b26afc0c0a5a19941b191bd7a9ea587c6eee8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMjowMjo1OFrOFw19PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMjowMjo1OFrOFw19PA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc1OTk5Ng==", "bodyText": "If the original table config had query quota but it has been removed, don't you want to send the message?", "url": "https://github.com/apache/pinot/pull/5067#discussion_r386759996", "createdAt": "2020-03-03T02:02:58Z", "author": {"login": "mcvsubbu"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/PinotHelixResourceManager.java", "diffHunk": "@@ -1720,6 +1726,41 @@ private void sendSegmentRefreshMessage(String offlineTableName, String segmentNa\n     }\n   }\n \n+  private void sendUpdateQueryQuotaMessage(TableConfig tableConfig) {\n+    QuotaConfig quotaConfig = tableConfig.getQuotaConfig();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "857b26afc0c0a5a19941b191bd7a9ea587c6eee8"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1598303a9cc6836b9c160b333565cf46fa6a50f6", "author": {"user": {"login": "jackjlli", "name": "Jialiang Li"}}, "url": "https://github.com/apache/pinot/commit/1598303a9cc6836b9c160b333565cf46fa6a50f6", "committedDate": "2020-03-03T17:40:02Z", "message": "[Part 2] Update rate limiter when table config updated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0f58cd89afccabd956bdd7eac25f539d26cfdd5", "author": {"user": {"login": "jackjlli", "name": "Jialiang Li"}}, "url": "https://github.com/apache/pinot/commit/f0f58cd89afccabd956bdd7eac25f539d26cfdd5", "committedDate": "2020-03-03T17:40:36Z", "message": "Rebase from master branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ae3c01159300c01b00cc365ff6216ec6e2d8ac9", "author": {"user": {"login": "jackjlli", "name": "Jialiang Li"}}, "url": "https://github.com/apache/pinot/commit/6ae3c01159300c01b00cc365ff6216ec6e2d8ac9", "committedDate": "2020-03-03T18:18:47Z", "message": "Address PR comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "857b26afc0c0a5a19941b191bd7a9ea587c6eee8", "author": {"user": {"login": "jackjlli", "name": "Jialiang Li"}}, "url": "https://github.com/apache/pinot/commit/857b26afc0c0a5a19941b191bd7a9ea587c6eee8", "committedDate": "2020-02-29T19:53:56Z", "message": "Rebase from master branch"}, "afterCommit": {"oid": "6ae3c01159300c01b00cc365ff6216ec6e2d8ac9", "author": {"user": {"login": "jackjlli", "name": "Jialiang Li"}}, "url": "https://github.com/apache/pinot/commit/6ae3c01159300c01b00cc365ff6216ec6e2d8ac9", "committedDate": "2020-03-03T18:18:47Z", "message": "Address PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MzI5Mjk0", "url": "https://github.com/apache/pinot/pull/5067#pullrequestreview-368329294", "createdAt": "2020-03-03T21:15:12Z", "commit": {"oid": "6ae3c01159300c01b00cc365ff6216ec6e2d8ac9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1282, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}