{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0MDY5NDc3", "number": 6331, "title": "Add a Controller endpoint to return table creation time", "bodyText": "Description\nAdded a GET endpoint on Controller to return metadata info/stats about a table. For now only table creation time is in the TableStats object. Later on, more info can be added to this object.\nTesting Done\nRan quick-start-hybrid.sh locally and hit the endpoint:\n\u279c  ~ curl 'localhost:9000/tables/airlineStats/stats' | jq .\n{\n  \"OFFLINE\": {\n    \"creationTime\": \"20201210T105708Z\"\n  },\n  \"REALTIME\": {\n    \"creationTime\": \"20201210T105712Z\"\n  }\n}\n\u279c  ~ curl 'localhost:9000/tables/airlineStats/stats?type=realtime' | jq .\n{\n  \"REALTIME\": {\n    \"creationTime\": \"20201210T105712Z\"\n  }\n}\n-------------- Previous Description --------------\n[Didn't delete so that  the conversation on the PR makes sense]\nDescription\nAdded a GET endpoint on Controller to return table creation time.\nFor one of our clusters, some admin tools need to delete the tables two weeks after the creation time. Therefore the table creation time API is exposed in this PR.\nTesting Done\nRan quick-start-batch.sh locally and hit the endpoint:\n\u279c  ~ curl 'localhost:9000/tables/baseballStats/creationTime?type=offline'\n1607392187128\n\u279c  ~ date -r 1607392187\nMon Dec  7 17:49:47 PST 2020\n\u279c  ~ curl 'localhost:9000/tables/baseballStats/creationTime'\n{\"code\":400,\"error\":\"Illegal table type: null\"}\nHere is the ZooInspector snapshot for the same table which verifies the creation time returned by the endpoint:", "createdAt": "2020-12-08T02:16:03Z", "url": "https://github.com/apache/pinot/pull/6331", "merged": true, "mergeCommit": {"oid": "75f9fd3e94b42f30e2a54ae3ee98ed340d5fae10"}, "closed": true, "closedAt": "2020-12-11T02:18:46Z", "author": {"login": "sajjad-moradi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkAQ9bAH2gAyNTM0MDY5NDc3OmJjYzZmYzk5ZjkzNzE3OGVjOGNjMzJmZDM4NzQwZDJjNDg5YjhlNTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdk4r6AgFqTU0OTU0MTI2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bcc6fc99f937178ec8cc32fd38740d2c489b8e56", "author": {"user": {"login": "sajjad-moradi", "name": "Sajjad Moradi"}}, "url": "https://github.com/apache/pinot/commit/bcc6fc99f937178ec8cc32fd38740d2c489b8e56", "committedDate": "2020-12-08T01:57:02Z", "message": "Add a Controller endpoint to return table creation time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6aebf2b5b4a1e94631cd2c026518f637e8e5001", "author": {"user": {"login": "sajjad-moradi", "name": "Sajjad Moradi"}}, "url": "https://github.com/apache/pinot/commit/d6aebf2b5b4a1e94631cd2c026518f637e8e5001", "committedDate": "2020-12-08T02:01:24Z", "message": "Make exception generic to catch NPE on null values of tableTypeStr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e76d5a401dd37bbc4893d1d755928b4ec3bd227f", "author": {"user": {"login": "sajjad-moradi", "name": "Sajjad Moradi"}}, "url": "https://github.com/apache/pinot/commit/e76d5a401dd37bbc4893d1d755928b4ec3bd227f", "committedDate": "2020-12-10T16:48:05Z", "message": "Make the new API more generic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NDQ2NDkx", "url": "https://github.com/apache/pinot/pull/6331#pullrequestreview-549446491", "createdAt": "2020-12-10T17:39:10Z", "commit": {"oid": "e76d5a401dd37bbc4893d1d755928b4ec3bd227f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzozOToxMFrOIDVV7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNzozOToxMFrOIDVV7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM2NjMxNw==", "bodyText": "It occurred to me that it may be better to return a long , in seconds since epoch. Better granularity, less parsing and code on either side (read: easier for automation and scripts)", "url": "https://github.com/apache/pinot/pull/6331#discussion_r540366317", "createdAt": "2020-12-10T17:39:10Z", "author": {"login": "mcvsubbu"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/PinotHelixResourceManager.java", "diffHunk": "@@ -2573,6 +2577,13 @@ private void waitForSegmentsBecomeOnline(String tableNameWithType, Set<String> s\n     return onlineSegments;\n   }\n \n+  public TableStats getTableStats(String tableNameWithType) {\n+    String zkPath = ZKMetadataProvider.constructPropertyStorePathForResourceConfig(tableNameWithType);\n+    ZNRecord znRecord = ZKMetadataProvider.getZnRecord(_propertyStore, zkPath);\n+    String creationTime = SIMPLE_DATE_FORMAT.format(znRecord.getCreationTime());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e76d5a401dd37bbc4893d1d755928b4ec3bd227f"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd8cb46f8b17ea9e1e48df308839ead79cbaacb9", "author": {"user": {"login": "sajjad-moradi", "name": "Sajjad Moradi"}}, "url": "https://github.com/apache/pinot/commit/dd8cb46f8b17ea9e1e48df308839ead79cbaacb9", "committedDate": "2020-12-10T18:59:54Z", "message": "Add seconds to the returned creation time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b864ca0388a0f5f8b17b0d3afa27848b03c246e", "author": {"user": {"login": "sajjad-moradi", "name": "Sajjad Moradi"}}, "url": "https://github.com/apache/pinot/commit/1b864ca0388a0f5f8b17b0d3afa27848b03c246e", "committedDate": "2020-12-10T19:24:31Z", "message": "Convert time zone to UTC"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NTQxMjYw", "url": "https://github.com/apache/pinot/pull/6331#pullrequestreview-549541260", "createdAt": "2020-12-10T19:41:09Z", "commit": {"oid": "1b864ca0388a0f5f8b17b0d3afa27848b03c246e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1614, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}