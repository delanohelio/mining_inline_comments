{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MTE4NzM1", "number": 6096, "title": "add upsert related configs", "bodyText": "Description\nPart of a series of PRs for #4261\nCheck this doc out for the new design\n\nAdded the primary key definition in the schema\nChanged the upsert config in table config. For the first phase, only support the full update mode.\n\nDoes this PR otherwise need attention when creating release notes? Things to consider:\n\nNew configuration options\nconfigurations related to upsert\n\nIf you have a series of commits adding or enabling a feature, then\nadd this section only in final commit that marks the feature completed.\nRefer to earlier release notes to see examples of text\nDocumentation\nIf you have introduced a new feature or configuration, please add it to the documentation as well.\nSee https://docs.pinot.apache.org/developers/developers-and-contributors/update-document", "createdAt": "2020-10-02T20:24:20Z", "url": "https://github.com/apache/pinot/pull/6096", "merged": true, "mergeCommit": {"oid": "93238c9df378c4b8a64c4aae27b56b76f5587c9d"}, "closed": true, "closedAt": "2020-10-05T17:36:09Z", "author": {"login": "yupeng9"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOr4V5AH2gAyNDk3MTE4NzM1OjYyYTQxMWZiY2E0OWYwYWEwZDIyZjEyY2ZhYzE0NTMxM2E5ZmExYmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPGhitAH2gAyNDk3MTE4NzM1OmQ0NzcyOWIyYWY5NTI2NmJlNTJmOTZiYWYxYzYyNTZhYzhhYTE1ZTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "62a411fbca49f0aa0d22f12cfac145313a9fa1ba", "author": {"user": {"login": "yupeng9", "name": "Yupeng Fu"}}, "url": "https://github.com/apache/pinot/commit/62a411fbca49f0aa0d22f12cfac145313a9fa1ba", "committedDate": "2020-10-02T20:19:38Z", "message": "add upsert related configs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTExNjQz", "url": "https://github.com/apache/pinot/pull/6096#pullrequestreview-501511643", "createdAt": "2020-10-03T01:49:44Z", "commit": {"oid": "62a411fbca49f0aa0d22f12cfac145313a9fa1ba"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QwMTo0OTo0NFrOHb-9KA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QwMTo1MTo1N1rOHb-92g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwNTA2NA==", "bodyText": "This should not be part of the schema, but the upsert config", "url": "https://github.com/apache/pinot/pull/6096#discussion_r499105064", "createdAt": "2020-10-03T01:49:44Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/Schema.java", "diffHunk": "@@ -66,6 +66,9 @@\n   private TimeFieldSpec _timeFieldSpec;\n   private final List<DateTimeFieldSpec> _dateTimeFieldSpecs = new ArrayList<>();\n   private final List<ComplexFieldSpec> _complexFieldSpecs = new ArrayList<>();\n+  // names of the columns that used as primary keys\n+  // TODO: add validation checks like duplicate columns and use of time column\n+  private List<String> _primaryKeyColumns;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62a411fbca49f0aa0d22f12cfac145313a9fa1ba"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwNTIxMg==", "bodyText": "Recommend not putting NONE as a mode. Upsert is disabled when the UpsertConfig is null in the table config (more intuitive IMO)", "url": "https://github.com/apache/pinot/pull/6096#discussion_r499105212", "createdAt": "2020-10-03T01:51:41Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/UpsertConfig.java", "diffHunk": "@@ -27,44 +27,22 @@\n \n \n public class UpsertConfig extends BaseJsonConfig {\n-  // names of the columns that used as primary keys of an upsert table\n-  private final List<String> _primaryKeyColumns;\n-  // name of the column that we are going to store the offset value to\n-  private final String _offsetColumn;\n-  // name of the virtual column that we are going to store the validFrom value to\n-  private final String _validFromColumn;\n-  // name of the virtual column that we are going to store the validUntil value to\n-  private final String _validUntilColumn;\n+  public static final String MODE_KEY = \"mode\";\n \n-  @JsonCreator\n-  public UpsertConfig(@JsonProperty(value = \"primaryKeyColumns\") List<String> primaryKeyColumns,\n-      @JsonProperty(value = \"offsetColumn\") String offsetColumn,\n-      @JsonProperty(value = \"validFromColumn\") String validFromColumn,\n-      @JsonProperty(value = \"validUntilColumn\") String validUntilColumn) {\n-    Preconditions.checkArgument(primaryKeyColumns != null && primaryKeyColumns.size() == 1,\n-        \"'primaryKeyColumns' must be configured with exact one column\");\n-    Preconditions.checkArgument(StringUtils.isNotEmpty(offsetColumn), \"'offsetColumn' must be configured\");\n-    Preconditions.checkArgument(StringUtils.isNotEmpty(validFromColumn), \"'validFromColumn' must be configured\");\n-    Preconditions.checkArgument(StringUtils.isNotEmpty(validUntilColumn), \"'validUntilColumn' must be configured\");\n-    _primaryKeyColumns = primaryKeyColumns;\n-    _offsetColumn = offsetColumn;\n-    _validFromColumn = validFromColumn;\n-    _validUntilColumn = validUntilColumn;\n+  public enum Mode {\n+    FULL, PARTIAL, NONE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62a411fbca49f0aa0d22f12cfac145313a9fa1ba"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwNTI0Mg==", "bodyText": "Not sure if this method is needed", "url": "https://github.com/apache/pinot/pull/6096#discussion_r499105242", "createdAt": "2020-10-03T01:51:57Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/TableConfig.java", "diffHunk": "@@ -265,4 +266,9 @@ public void setIngestionConfig(IngestionConfig ingestionConfig) {\n   public void setTierConfigsList(List<TierConfig> tierConfigsList) {\n     _tierConfigsList = tierConfigsList;\n   }\n+\n+  @JsonIgnore\n+  public UpsertConfig.Mode getUpsertMode() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62a411fbca49f0aa0d22f12cfac145313a9fa1ba"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTY3MzY0", "url": "https://github.com/apache/pinot/pull/6096#pullrequestreview-501567364", "createdAt": "2020-10-03T19:02:11Z", "commit": {"oid": "62a411fbca49f0aa0d22f12cfac145313a9fa1ba"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxOTowMjoxMlrOHcDH9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wM1QxOTowNDowMlrOHcDIfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE3MzM2NQ==", "bodyText": "(nit) put getter before setter for consistency", "url": "https://github.com/apache/pinot/pull/6096#discussion_r499173365", "createdAt": "2020-10-03T19:02:12Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/Schema.java", "diffHunk": "@@ -99,6 +102,14 @@ public void setSchemaName(String schemaName) {\n     _schemaName = schemaName;\n   }\n \n+  public void setPrimaryKeyColumns(List<String> primaryKeyColumns) {\n+    _primaryKeyColumns = primaryKeyColumns;\n+  }\n+\n+  public List<String> getPrimaryKeyColumns() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62a411fbca49f0aa0d22f12cfac145313a9fa1ba"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE3MzUwMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public SchemaBuilder addPrimaryKeyColumns(List<String> primaryKeyColumns) {\n          \n          \n            \n                public SchemaBuilder setPrimaryKeyColumns(List<String> primaryKeyColumns) {", "url": "https://github.com/apache/pinot/pull/6096#discussion_r499173500", "createdAt": "2020-10-03T19:04:02Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/Schema.java", "diffHunk": "@@ -558,6 +576,11 @@ public SchemaBuilder addComplex(String name, DataType dataType) {\n       return this;\n     }\n \n+    public SchemaBuilder addPrimaryKeyColumns(List<String> primaryKeyColumns) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62a411fbca49f0aa0d22f12cfac145313a9fa1ba"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d47729b2af95266be52f96baf1c6256ac8aa15e7", "author": {"user": {"login": "yupeng9", "name": "Yupeng Fu"}}, "url": "https://github.com/apache/pinot/commit/d47729b2af95266be52f96baf1c6256ac8aa15e7", "committedDate": "2020-10-04T03:22:10Z", "message": "address comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1517, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}