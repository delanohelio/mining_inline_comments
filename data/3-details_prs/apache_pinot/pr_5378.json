{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MDMxMjc5", "number": 5378, "title": "The last of the getTimeFieldSpec calls", "bodyText": "#2756\nRemoving the last of the getTimeFieldSpec calls.\n\nSegmentGeneratorConfig now uses the new getSpecForTimeColumn() call, which returns a DateTimeFieldSpec. Time column is expected in table config if it is to be considered when creating segment. (this also sets the stage for allowing a DateTimeFieldSpec to be a primary time column)\nRemoving TimeFieldSpec special handling from RealtimeSegmentConverter.getUpdatedSchema. There is no need to remove the incoming time spec. Neither the recordReader nor the dataSource require the updated schema. Plus, the record transformer is a pass through.\nRemoving special casing for TimeFieldSpec in Schema.isBackwardCompatible() method. The for loop for all specs includes time", "createdAt": "2020-05-12T23:42:36Z", "url": "https://github.com/apache/pinot/pull/5378", "merged": true, "mergeCommit": {"oid": "430d48e3fb97ad66905b9fad117fd7de3ad2952e"}, "closed": true, "closedAt": "2020-05-15T22:53:02Z", "author": {"login": "npawar"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchkv3jgH2gAyNDE3MDMxMjc5OmJkNTZjN2VjMmIxODA2N2JiOWVhOTE4OTljNjM2ODkyY2MwYWRiYmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchpXfegFqTQxMjk5MDMyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bd56c7ec2b18067bb9ea91899c636892cc0adbbf", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/bd56c7ec2b18067bb9ea91899c636892cc0adbbf", "committedDate": "2020-05-15T16:34:27Z", "message": "The last of the getTimeFieldSpec calls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3820502f69ae70724cc06136485ed2668513123", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/b3820502f69ae70724cc06136485ed2668513123", "committedDate": "2020-05-15T16:34:27Z", "message": "Use right call"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "540db6c3217fc5eeffe9c61013ae6c1e6072f424", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/540db6c3217fc5eeffe9c61013ae6c1e6072f424", "committedDate": "2020-05-15T16:48:08Z", "message": "Fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9f15ed0a2efdd425e26373e386d3b835d833e79", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/d9f15ed0a2efdd425e26373e386d3b835d833e79", "committedDate": "2020-05-12T23:35:40Z", "message": "Use right call"}, "afterCommit": {"oid": "540db6c3217fc5eeffe9c61013ae6c1e6072f424", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/540db6c3217fc5eeffe9c61013ae6c1e6072f424", "committedDate": "2020-05-15T16:48:08Z", "message": "Fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyOTQ0ODcz", "url": "https://github.com/apache/pinot/pull/5378#pullrequestreview-412944873", "createdAt": "2020-05-15T20:25:21Z", "commit": {"oid": "540db6c3217fc5eeffe9c61013ae6c1e6072f424"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQyMDoyNToyMVrOGWS0QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQyMDozMjoyN1rOGWS_1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAzMDE0NA==", "bodyText": "We need to remove the time transform here because the time has already been transformed.\nPlease also update the javadoc", "url": "https://github.com/apache/pinot/pull/5378#discussion_r426030144", "createdAt": "2020-05-15T20:25:21Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/realtime/converter/RealtimeSegmentConverter.java", "diffHunk": "@@ -156,20 +156,8 @@ public void build(@Nullable SegmentVersion segmentVersion, ServerMetrics serverM\n   @VisibleForTesting\n   public Schema getUpdatedSchema(Schema original) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "540db6c3217fc5eeffe9c61013ae6c1e6072f424"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAzMTQ0Mw==", "bodyText": "Annotate timeColumnName as nullable or check it on the caller side", "url": "https://github.com/apache/pinot/pull/5378#discussion_r426031443", "createdAt": "2020-05-15T20:28:21Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/indexsegment/generator/SegmentGeneratorConfig.java", "diffHunk": "@@ -182,42 +180,21 @@ public SegmentGeneratorConfig(TableConfig tableConfig, Schema schema) {\n   }\n \n   /**\n-   * Set time column details using the given time column. If not found, use schema\n+   * Set time column details using the given time column\n    */\n   public void setTime(String timeColumnName, Schema schema) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "540db6c3217fc5eeffe9c61013ae6c1e6072f424"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAzMTgyOQ==", "bodyText": "Remove this line?", "url": "https://github.com/apache/pinot/pull/5378#discussion_r426031829", "createdAt": "2020-05-15T20:29:21Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/test/java/org/apache/pinot/core/indexsegment/generator/SegmentGeneratorConfigTest.java", "diffHunk": "@@ -48,14 +48,12 @@ public void testEpochTime() {\n     assertNull(segmentGeneratorConfig.getSimpleDateFormat());\n \n     // table config not provided", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "540db6c3217fc5eeffe9c61013ae6c1e6072f424"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAzMTg1OQ==", "bodyText": "Remove this line?", "url": "https://github.com/apache/pinot/pull/5378#discussion_r426031859", "createdAt": "2020-05-15T20:29:24Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/test/java/org/apache/pinot/core/indexsegment/generator/SegmentGeneratorConfigTest.java", "diffHunk": "@@ -74,14 +72,12 @@ public void testSimpleDateFormat() {\n     assertEquals(segmentGeneratorConfig.getSimpleDateFormat(), \"yyyyMMdd\");\n \n     // Table config not provided", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "540db6c3217fc5eeffe9c61013ae6c1e6072f424"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAzMjQzMQ==", "bodyText": "Do we still want this support? (Realtime table without time column)", "url": "https://github.com/apache/pinot/pull/5378#discussion_r426032431", "createdAt": "2020-05-15T20:30:46Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/test/java/org/apache/pinot/realtime/converter/RealtimeSegmentConverterTest.java", "diffHunk": "@@ -46,28 +46,11 @@ public void testNoVirtualColumnsInSchema() {\n     String segmentName = \"segment1\";\n     VirtualColumnProviderFactory.addBuiltInVirtualColumnsToSegmentSchema(schema, segmentName);\n     Assert.assertEquals(schema.getColumnNames().size(), 5);\n-    Assert.assertEquals(schema.getTimeFieldSpec().getIncomingGranularitySpec().getTimeType(), TimeUnit.MILLISECONDS);\n \n     RealtimeSegmentConverter converter =\n         new RealtimeSegmentConverter(null, \"\", schema, \"testTable\", tableConfig, segmentName, \"col1\");\n \n     Schema newSchema = converter.getUpdatedSchema(schema);\n     Assert.assertEquals(newSchema.getColumnNames().size(), 2);\n-    Assert.assertEquals(newSchema.getTimeFieldSpec().getIncomingGranularitySpec().getTimeType(), TimeUnit.DAYS);\n-  }\n-\n-  @Test\n-  public void testNoTimeColumnsInSchema() {\n-    Schema schema = new Schema();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "540db6c3217fc5eeffe9c61013ae6c1e6072f424"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjAzMzEwOA==", "bodyText": "Move getColumnNames() out of the loop", "url": "https://github.com/apache/pinot/pull/5378#discussion_r426033108", "createdAt": "2020-05-15T20:32:27Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/Schema.java", "diffHunk": "@@ -582,10 +582,6 @@ public boolean equals(Object o) {\n    */\n \n   public boolean isBackwardCompatibleWith(Schema oldSchema) {\n-    if (!EqualityUtils.isEqual(_timeFieldSpec, oldSchema.getTimeFieldSpec()) || !EqualityUtils\n-        .isEqual(_dateTimeFieldSpecs, oldSchema.getDateTimeFieldSpecs())) {\n-      return false;\n-    }\n     for (Map.Entry<String, FieldSpec> entry : oldSchema.getFieldSpecMap().entrySet()) {\n       if (!getColumnNames().contains(entry.getKey())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "540db6c3217fc5eeffe9c61013ae6c1e6072f424"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a272a8d897241cf405c6f32971a49441dabcb951", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/a272a8d897241cf405c6f32971a49441dabcb951", "committedDate": "2020-05-15T21:49:25Z", "message": "Review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyOTkwMzIy", "url": "https://github.com/apache/pinot/pull/5378#pullrequestreview-412990322", "createdAt": "2020-05-15T21:57:21Z", "commit": {"oid": "a272a8d897241cf405c6f32971a49441dabcb951"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1040, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}