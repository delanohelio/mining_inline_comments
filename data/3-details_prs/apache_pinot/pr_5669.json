{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NTUzOTc1", "number": 5669, "title": "Fixing code to fetch the fsConfig from the right parent", "bodyText": "Description\nWe were initializing the pinot fs class with incorrect configuration.\nBefore:\n\nGot scheme s3, initializing class org.apache.pinot.plugin.filesystem.LocalFS with config : {=org.apache.pinot.plugin.filesystem.LocalFS}\n\nAfter\n\nGot scheme s3, initializing class org.apache.pinot.plugin.filesystem.LocalFS with config : {secretkey=secret, accesskey=access, region=myregion}\n\nAdded test case\nUpgrade Notes\nDoes this PR prevent a zero down-time upgrade? (Assume upgrade order: Controller, Broker, Server, Minion)\n\n Yes (Please label as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR fix a zero-downtime upgrade introduced earlier?\n\n Yes (Please label this as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR otherwise need attention when creating release notes? Things to consider:\n\nNew configuration options\nDeprecation of configurations\nSignature changes to public methods/interfaces\nNew plugins added or old plugins removed\n\n\n Yes (Please label this PR as release-notes and complete the section on Release Notes)\n\nRelease Notes\nIf you have tagged this as either backward-incompat or release-notes,\nyou MUST add text here that you would like to see appear in release notes of the\nnext release.\nIf you have a series of commits adding or enabling a feature, then\nadd this section only in final commit that marks the feature completed.\nRefer to earlier release notes to see examples of text\nDocumentation\nIf you have introduced a new feature or configuration, please add it to the documentation as well.\nSee https://docs.pinot.apache.org/developers/developers-and-contributors/update-document", "createdAt": "2020-07-09T00:43:35Z", "url": "https://github.com/apache/pinot/pull/5669", "merged": true, "mergeCommit": {"oid": "2dc72a50db41dfc117d1a965022468d949888701"}, "closed": true, "closedAt": "2020-07-10T17:48:18Z", "author": {"login": "kishoreg"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczD-qpgH2gAyNDQ2NTUzOTc1OjRjM2VlZDg2NTVhM2I1ZDFjZDZmNzAyYWYyZjc1NDFiNWM2ODhjZTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczkgyggH2gAyNDQ2NTUzOTc1OmUzOTAwY2YzNTIxZmRlMTFmMTE1ZDJhYWVjYjYyMDQ4OTRlZDhhNjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4c3eed8655a3b5d1cd6f702af2f7541b5c688ce1", "author": {"user": {"login": "kishoreg", "name": "Kishore Gopalakrishna"}}, "url": "https://github.com/apache/pinot/commit/4c3eed8655a3b5d1cd6f702af2f7541b5c688ce1", "committedDate": "2020-07-09T00:34:23Z", "message": "Fixing code to fetch the fsConfig from the right parent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9745c9a0f3f809bdeff7830be2ad92e28782367", "author": {"user": {"login": "kishoreg", "name": "Kishore Gopalakrishna"}}, "url": "https://github.com/apache/pinot/commit/d9745c9a0f3f809bdeff7830be2ad92e28782367", "committedDate": "2020-07-09T00:43:11Z", "message": "Adding test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MjIwMTk4", "url": "https://github.com/apache/pinot/pull/5669#pullrequestreview-445220198", "createdAt": "2020-07-09T00:50:47Z", "commit": {"oid": "d9745c9a0f3f809bdeff7830be2ad92e28782367"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwMDo1MDo0N1rOGu98-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwMDo1MDo0N1rOGu98-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTkwMjcxNQ==", "bodyText": "I see all non-test callers of this api are calling it with fsConfig. Is that expected? Would be good to add javadoc based on what we find.", "url": "https://github.com/apache/pinot/pull/5669#discussion_r451902715", "createdAt": "2020-07-09T00:50:47Z", "author": {"login": "mayankshriv"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/filesystem/PinotFSFactory.java", "diffHunk": "@@ -60,19 +60,19 @@ public static void register(String scheme, String fsClassName, PinotConfiguratio\n     }\n   }\n \n-  public static void init(PinotConfiguration fsConfig) {\n+  public static void init(PinotConfiguration config) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9745c9a0f3f809bdeff7830be2ad92e28782367"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MjIwMzA1", "url": "https://github.com/apache/pinot/pull/5669#pullrequestreview-445220305", "createdAt": "2020-07-09T00:51:08Z", "commit": {"oid": "d9745c9a0f3f809bdeff7830be2ad92e28782367"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwMDo1MTowOFrOGu99Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwMDo1MTowOFrOGu99Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTkwMjgwMw==", "bodyText": "Let's not log the configs probably as they might contain sensitive content (e.g. password)", "url": "https://github.com/apache/pinot/pull/5669#discussion_r451902803", "createdAt": "2020-07-09T00:51:08Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/filesystem/PinotFSFactory.java", "diffHunk": "@@ -60,19 +60,19 @@ public static void register(String scheme, String fsClassName, PinotConfiguratio\n     }\n   }\n \n-  public static void init(PinotConfiguration fsConfig) {\n+  public static void init(PinotConfiguration config) {\n     // Get schemes and their respective classes\n-    PinotConfiguration schemesConfiguration = fsConfig.subset(CLASS);\n+    PinotConfiguration schemesConfiguration = config.subset(CLASS);\n     List<String> schemes = schemesConfiguration.getKeys();\n     if (!schemes.isEmpty()) {\n       LOGGER.info(\"Did not find any fs classes in the configuration\");\n     }\n     \n     for(String scheme : schemes){\n-      String fsClassName = (String) schemesConfiguration.getProperty(scheme);\n-      \n-      LOGGER.info(\"Got scheme {}, classname {}, starting to initialize\", scheme, fsClassName);\n-      register(scheme, fsClassName, schemesConfiguration.subset(scheme));\n+      String fsClassName = schemesConfiguration.getProperty(scheme);\n+      PinotConfiguration fsConfiguration = config.subset(scheme);\n+      LOGGER.info(\"Got scheme {}, initializing class {} with config : {} \", scheme, fsClassName, fsConfiguration.toMap());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9745c9a0f3f809bdeff7830be2ad92e28782367"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c70392426c4346dc5a49afe0ec46896dbd1cfe7b", "author": {"user": {"login": "kishoreg", "name": "Kishore Gopalakrishna"}}, "url": "https://github.com/apache/pinot/commit/c70392426c4346dc5a49afe0ec46896dbd1cfe7b", "committedDate": "2020-07-09T04:16:21Z", "message": "addressing comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3900cf3521fde11f115d2aaecb6204894ed8a67", "author": {"user": {"login": "daniellavoie", "name": "Daniel Lavoie"}}, "url": "https://github.com/apache/pinot/commit/e3900cf3521fde11f115d2aaecb6204894ed8a67", "committedDate": "2020-07-10T14:28:37Z", "message": "Pinot fs bug fix (#5674)\n\n* Fixed missing registration for Hadoop JobRunner\r\n\r\n* Caused by Phase 1 of configuration refactor\r\n\r\n* Fixed base configuration constructor for PinotConfiguration\r\n\r\n* Fixed the PinotConfiguration constructor that accepts a Commons\r\nConfiguration.\r\n* Full test coverage of PinotConfiguration"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 300, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}