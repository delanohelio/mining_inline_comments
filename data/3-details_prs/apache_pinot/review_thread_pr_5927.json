{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczODgzNjM1", "number": 5927, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMDoxNzo0NFrOEcu5tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMDoyMjo1MVrOEcvATQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NTY0MDIxOnYy", "diffSide": "RIGHT", "path": "pinot-plugins/pinot-batch-ingestion/pinot-batch-ingestion-spark/src/main/java/org/apache/pinot/plugin/ingestion/batch/spark/SparkSegmentGenerationJobRunner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMDoxNzo0NFrOHHcM1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMDoxNzo0NFrOHHcM1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU2NDExNw==", "bodyText": "expend the .*", "url": "https://github.com/apache/pinot/pull/5927#discussion_r477564117", "createdAt": "2020-08-26T20:17:44Z", "author": {"login": "xiangfu0"}, "path": "pinot-plugins/pinot-batch-ingestion/pinot-batch-ingestion-spark/src/main/java/org/apache/pinot/plugin/ingestion/batch/spark/SparkSegmentGenerationJobRunner.java", "diffHunk": "@@ -29,12 +30,10 @@\n import java.io.Serializable;\n import java.net.URI;\n import java.nio.file.FileSystems;\n+import java.nio.file.Path;\n import java.nio.file.PathMatcher;\n import java.nio.file.Paths;\n-import java.util.ArrayList;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.UUID;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64c2336df41a9d327d4641d0d61b512d24ac991a"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NTY1NzA5OnYy", "diffSide": "RIGHT", "path": "pinot-plugins/pinot-batch-ingestion/pinot-batch-ingestion-spark/src/main/java/org/apache/pinot/plugin/ingestion/batch/spark/SparkSegmentGenerationJobRunner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMDoyMjo1MlrOHHcXCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMDoyMjo1MlrOHHcXCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU2NjczMA==", "bodyText": "suggest to sort siblingFiles list, so rerun segment creation job will give same segments list", "url": "https://github.com/apache/pinot/pull/5927#discussion_r477566730", "createdAt": "2020-08-26T20:22:52Z", "author": {"login": "xiangfu0"}, "path": "pinot-plugins/pinot-batch-ingestion/pinot-batch-ingestion-spark/src/main/java/org/apache/pinot/plugin/ingestion/batch/spark/SparkSegmentGenerationJobRunner.java", "diffHunk": "@@ -200,8 +199,30 @@ public void run()\n       }\n \n       List<String> pathAndIdxList = new ArrayList<>();\n-      for (int i = 0; i < filteredFiles.size(); i++) {\n-        pathAndIdxList.add(String.format(\"%s %d\", filteredFiles.get(i), i));\n+      String localDirectorySequenceIdString = _spec.getSegmentNameGeneratorSpec().getConfigs().get(LOCAL_DIRECTORY_SEQUENCE_ID);\n+      boolean localDirectorySequenceId = false;\n+      if (localDirectorySequenceIdString != null) {\n+        localDirectorySequenceId = Boolean.parseBoolean(localDirectorySequenceIdString);\n+      }\n+      if (localDirectorySequenceId) {\n+        Map<String, List<String>> localDirIndex = new HashMap<>();\n+        for (String filteredFile : filteredFiles) {\n+          Path filteredParentPath = Paths.get(filteredFile).getParent();\n+          if (!localDirIndex.containsKey(filteredParentPath.toString())) {\n+            localDirIndex.put(filteredParentPath.toString(), new ArrayList<>());\n+          }\n+          localDirIndex.get(filteredParentPath.toString()).add(filteredFile);\n+        }\n+        for (String parentPath: localDirIndex.keySet()){\n+          List<String> siblingFiles = localDirIndex.get(parentPath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64c2336df41a9d327d4641d0d61b512d24ac991a"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4068, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}