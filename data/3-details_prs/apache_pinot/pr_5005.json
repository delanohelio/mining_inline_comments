{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MTk0OTMx", "number": 5005, "title": "Calcite SQL compiler syntax support for order by expression and set LENIENT SQL conformance", "bodyText": "To support query with order by expressions like:\n\nselect group_city, sum(rsvp_count), count(*) from meetupRsvp group by group_city order by sum(rsvp_count), count(*) limit 10\n\n\n\nUse LIMIT with GROUP BY to display records.\n\n\nSet SQL conformance LENIENT to make below query syntax works:\n\n\n\nSupport LIMIT offset,count in Calcite Parser\nSupport != as not equal in Calcite Parser", "createdAt": "2020-01-23T06:01:14Z", "url": "https://github.com/apache/pinot/pull/5005", "merged": true, "mergeCommit": {"oid": "995ad8331ccde0cc4e5d85dde7f326a61e2ba1e6"}, "closed": true, "closedAt": "2020-01-24T01:00:03Z", "author": {"login": "xiangfu0"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9Es_IAFqTM0NzA4NzY5Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9jXKOgFqTM0ODE0NTUwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MDg3Njk3", "url": "https://github.com/apache/pinot/pull/5005#pullrequestreview-347087697", "createdAt": "2020-01-23T06:52:52Z", "commit": {"oid": "3558d265c12d477088167536e74b106588f57c44"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNjo1Mjo1M1rOFg0QAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNjo1Mjo1M1rOFg0QAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk1NDgxOA==", "bodyText": "Should we add ascending as well for readability?", "url": "https://github.com/apache/pinot/pull/5005#discussion_r369954818", "createdAt": "2020-01-23T06:52:53Z", "author": {"login": "kishoreg"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -224,17 +224,16 @@ private static Expression convertOrderBy(SqlNode node) {\n     final SqlKind kind = node.getKind();\n     Expression expression;\n     switch (kind) {\n-      case IDENTIFIER:\n-        expression = RequestUtils.getFunctionExpression(\"ASC\");\n-        expression.getFunctionCall().addToOperands(toExpression(node));\n-        break;\n       case DESCENDING:\n         SqlBasicCall basicCall = (SqlBasicCall) node;\n         expression = RequestUtils.getFunctionExpression(\"DESC\");\n         expression.getFunctionCall().addToOperands(toExpression(basicCall.getOperands()[0]));\n         break;\n+      case IDENTIFIER:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3558d265c12d477088167536e74b106588f57c44"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3558d265c12d477088167536e74b106588f57c44", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/3558d265c12d477088167536e74b106588f57c44", "committedDate": "2020-01-23T05:55:17Z", "message": "Make calcite parser support order by expression"}, "afterCommit": {"oid": "cadbd0d96d88b8e08d62508af41ff89c548feed2", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/cadbd0d96d88b8e08d62508af41ff89c548feed2", "committedDate": "2020-01-23T09:07:39Z", "message": "Make calcite parser support order by expression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38ee79816f44b740a3fcbb313de07f0d247b8e7f", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/38ee79816f44b740a3fcbb313de07f0d247b8e7f", "committedDate": "2020-01-23T10:29:35Z", "message": "Make calcite parser support order by expression"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cadbd0d96d88b8e08d62508af41ff89c548feed2", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/cadbd0d96d88b8e08d62508af41ff89c548feed2", "committedDate": "2020-01-23T09:07:39Z", "message": "Make calcite parser support order by expression"}, "afterCommit": {"oid": "38ee79816f44b740a3fcbb313de07f0d247b8e7f", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/38ee79816f44b740a3fcbb313de07f0d247b8e7f", "committedDate": "2020-01-23T10:29:35Z", "message": "Make calcite parser support order by expression"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3Njg2Njcz", "url": "https://github.com/apache/pinot/pull/5005#pullrequestreview-347686673", "createdAt": "2020-01-24T00:01:27Z", "commit": {"oid": "ff0209333108947e907b679ea062625ce17b3743"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwMDowMToyN1rOFhQgGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwMDowMToyN1rOFhQgGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxNzY5MA==", "bodyText": "Why is this needed?", "url": "https://github.com/apache/pinot/pull/5005#discussion_r370417690", "createdAt": "2020-01-24T00:01:27Z", "author": {"login": "siddharthteotia"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -111,6 +112,7 @@ private static void setOptions(PinotQuery pinotQuery, List<String> optionsStatem\n   private static PinotQuery compileCalciteSqlToPinotQuery(String sql) {\n     SqlParser.ConfigBuilder parserBuilder = SqlParser.configBuilder();\n     parserBuilder.setLex(PINOT_LEX);\n+    parserBuilder.setConformance(SqlConformanceEnum.LENIENT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff0209333108947e907b679ea062625ce17b3743"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa4001c165613bd0140f5b6f6f7d06a214c4d397", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/fa4001c165613bd0140f5b6f6f7d06a214c4d397", "committedDate": "2020-01-24T00:09:02Z", "message": "Set SqlConformanceEnum.LENIENT to CalciteParser"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff0209333108947e907b679ea062625ce17b3743", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/ff0209333108947e907b679ea062625ce17b3743", "committedDate": "2020-01-23T23:40:59Z", "message": "Set SqlConformanceEnum.LENIENT to CalciteParser"}, "afterCommit": {"oid": "fa4001c165613bd0140f5b6f6f7d06a214c4d397", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/fa4001c165613bd0140f5b6f6f7d06a214c4d397", "committedDate": "2020-01-24T00:09:02Z", "message": "Set SqlConformanceEnum.LENIENT to CalciteParser"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3Njk5NDc5", "url": "https://github.com/apache/pinot/pull/5005#pullrequestreview-347699479", "createdAt": "2020-01-24T00:44:14Z", "commit": {"oid": "fa4001c165613bd0140f5b6f6f7d06a214c4d397"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NzAwODA1", "url": "https://github.com/apache/pinot/pull/5005#pullrequestreview-347700805", "createdAt": "2020-01-24T00:49:00Z", "commit": {"oid": "fa4001c165613bd0140f5b6f6f7d06a214c4d397"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MTQ1NTA4", "url": "https://github.com/apache/pinot/pull/5005#pullrequestreview-348145508", "createdAt": "2020-01-24T18:36:06Z", "commit": {"oid": "fa4001c165613bd0140f5b6f6f7d06a214c4d397"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxODozNjowNlrOFhmqEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxODozNjowNlrOFhmqEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc4MDY5MQ==", "bodyText": "Is it possible to just have one variable for TOP/LIMIT? Or does LIMIT imply that there may not be any sorting if ORDERBY not provided?", "url": "https://github.com/apache/pinot/pull/5005#discussion_r370780691", "createdAt": "2020-01-24T18:36:06Z", "author": {"login": "mayankshriv"}, "path": "pinot-common/src/main/java/org/apache/pinot/pql/parsers/pql2/ast/SelectAstNode.java", "diffHunk": "@@ -31,12 +31,12 @@\n  * AST node for a SELECT statement.\n  */\n public class SelectAstNode extends BaseAstNode {\n+  public static final int DEFAULT_RECORD_LIMIT = 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa4001c165613bd0140f5b6f6f7d06a214c4d397"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1515, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}