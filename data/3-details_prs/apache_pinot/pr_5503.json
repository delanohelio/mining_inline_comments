{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NzYyOTIw", "number": 5503, "title": "Config for raw index writer version", "bodyText": "Description\nIn PR #5285,  the raw index writer format was changed to use 8 byte offset for each chunk in the file header. The writer version was bumped to 3. This was done to support > 2GB indexes. The change was backward compatible to continue the support for reading existing/old segments using 4-byte offsets\nWhile there is no problem with PR 5285, it prevents rollback. So if there is any orthogonal issue while rolling out a release, we can't rollback to older Pinot release since segments already\ngenerated with 8-byte offsets can't be read by old code.\nThis PR introduces a config option to set the writer version (2 for using old 4-byte chunk offset and 3 which is latest for 8-byte chunk offset). This config option is temporary. To deploy a new version of our internal offline segment creation/push job, we would like this format to be disabled temporarily to have the flexibility of dealing with issues by rolling back the release at will. Once the roll-out is complete, this config option will be removed.\nUpgrade Notes\nDoes this PR prevent a zero down-time upgrade? (Assume upgrade order: Controller, Broker, Server, Minion)\nNo\nDoes this PR fix a zero-downtime upgrade introduced earlier?\nNo\nDoes this PR otherwise need attention when creating release notes? Things to consider:\n\nNew configuration options\nDeprecation of configurations\nSignature changes to public methods/interfaces\nNew plugins added or old plugins removed\n\n\n Yes (Please label this PR as release-notes and complete the section on Release Notes)\n\nRelease Notes\nDocumentation", "createdAt": "2020-06-05T21:10:22Z", "url": "https://github.com/apache/pinot/pull/5503", "merged": true, "mergeCommit": {"oid": "04e12bd847b4a04e14d17e05e294680d396826d5"}, "closed": true, "closedAt": "2020-06-08T16:14:23Z", "author": {"login": "siddharthteotia"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoY0mvAH2gAyNDI4NzYyOTIwOmU1MWQ3ZTNlNzRiN2NhYmQwYjBjMjdkZjk2OTJlM2VlNzU1NTQ4NDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoiCEUgH2gAyNDI4NzYyOTIwOjQ1NDAyZmQ3NWI4NGZjNGE5MDE3ODA1ZmRjNDM1Y2VmNjM0ZDk4MDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/e51d7e3e74b7cabd0b0c27df9692e3ee75554843", "committedDate": "2020-06-05T20:38:14Z", "message": "In PR https://github.com/apache/incubator-pinot/pull/5285,\nthe raw index writer format was changed to use 8 byte offset\nfor each chunk in the file header. The writer version\nwas bumped to 3. This was done to support > 2GB indexes.\nThe change was backward compatible to continue the support\nfor reading existing/old segments using 4-byte offsets\n\nWhile there is no problem with the change, it prevents rollback.\nSo if there is any orthogonal issue while rolling out a release,\nwe can't rollback to older Pinot release since segments already\ngenerated with 8-byte offsets can't be read by old code.\n\nThis config option is temporary to help with internal roll-out\nby keeping the 8-byte format disabled by default thus allowing\nrollback due to any issues. In the next couple of weeks after\ninternal rollout, we plan to remove this option."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NjUwMzQy", "url": "https://github.com/apache/pinot/pull/5503#pullrequestreview-425650342", "createdAt": "2020-06-05T21:57:32Z", "commit": {"oid": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMTo1NzozMlrOGf-b2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMTo1NzozMlrOGf-b2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4MTk3OA==", "bodyText": "Why are we changing this? This is backward-incompatible change right?", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436181978", "createdAt": "2020-06-05T21:57:32Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/FieldConfig.java", "diffHunk": "@@ -33,15 +33,16 @@\n   private final IndexType _indexType;\n   private final Map<String, String> _properties;\n \n-  public static String BLOOM_FILTER_COLUMN_KEY = \"bloom.filter\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NjI4Njcz", "url": "https://github.com/apache/pinot/pull/5503#pullrequestreview-425628673", "createdAt": "2020-06-05T21:13:10Z", "commit": {"oid": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMToxMzoxMVrOGf9gcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMjozMjozOVrOGf_HRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2Njc3MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public static final int DEFAULT_VERSION = 2;\n          \n          \n            \n              public static final int DEFAULT_WRITER_VERSION = 2;", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436166770", "createdAt": "2020-06-05T21:13:11Z", "author": {"login": "mcvsubbu"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/io/writer/impl/v1/BaseChunkSingleValueWriter.java", "diffHunk": "@@ -36,6 +37,9 @@\n  * Base class for fixed and variable byte writer implementations.\n  */\n public abstract class BaseChunkSingleValueWriter implements SingleColumnSingleValueWriter {\n+  public static final int DEFAULT_VERSION = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE5MjkzNA==", "bodyText": "Maybe add a TODO or create an issue to remove this before 0.5.0 and put a pointer here to the issue?", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436192934", "createdAt": "2020-06-05T22:31:59Z", "author": {"login": "mcvsubbu"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/io/writer/impl/v1/BaseChunkSingleValueWriter.java", "diffHunk": "@@ -36,6 +37,9 @@\n  * Base class for fixed and variable byte writer implementations.\n  */\n public abstract class BaseChunkSingleValueWriter implements SingleColumnSingleValueWriter {\n+  public static final int DEFAULT_VERSION = 2;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2Njc3MA=="}, "originalCommit": {"oid": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE5MzA1NA==", "bodyText": "this comment may not hold in the long term, so just leave it as is", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436193054", "createdAt": "2020-06-05T22:32:28Z", "author": {"login": "mcvsubbu"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/io/writer/impl/v1/BaseChunkSingleValueWriter.java", "diffHunk": "@@ -60,12 +64,13 @@\n    * @param numDocsPerChunk Number of docs per data chunk\n    * @param chunkSize Size of chunk\n    * @param sizeOfEntry Size of entry (in bytes), max size for variable byte implementation.\n-   * @param version Version of file\n+   * @param version format version used to determine whether to use 8 or 4 byte chunk offsets", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE5MzA5NQ==", "bodyText": "same", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436193095", "createdAt": "2020-06-05T22:32:39Z", "author": {"login": "mcvsubbu"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/io/writer/impl/v1/FixedByteChunkSingleValueWriter.java", "diffHunk": "@@ -64,15 +62,15 @@\n    * @param compressionType Type of compression to use.\n    * @param totalDocs Total number of docs to write.\n    * @param numDocsPerChunk Number of documents per chunk.\n-   * @param sizeOfEntry Size of entry (in bytes).\n+   * @param sizeOfEntry Size of entry (in bytes)\n+   * @param writerVersion writer version used to determine whether to use 8 or 4 byte chunk offsets", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45402fd75b84fc4a9017805fdc435cef634d9804", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/45402fd75b84fc4a9017805fdc435cef634d9804", "committedDate": "2020-06-06T07:22:05Z", "message": "address review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 904, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}