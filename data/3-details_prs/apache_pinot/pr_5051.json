{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMDA1Mzg0", "number": 5051, "title": "Add forceDelete option for task queue deletion", "bodyText": "By default, force delete is set to false as it can corrupt the Helix\nTask Framework cache. We keep this as an expert only option to force\ndeleting the task queue without going through the Helix transitions\nin case we need to perform some cleanups. In normal case, this flag\nshould always be false.", "createdAt": "2020-02-04T19:16:03Z", "url": "https://github.com/apache/pinot/pull/5051", "merged": true, "mergeCommit": {"oid": "b4b1512f5dbb7ec9f52c46478890c868b6f6cf90"}, "closed": true, "closedAt": "2020-02-04T21:38:35Z", "author": {"login": "Jackie-Jiang"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBGd19AH2gAyMzcxMDA1Mzg0OmIxY2FlNmZjMDM4Y2Y5ZTU4NjgzMDNhODgyYmVhOGViYzBkYzA2YjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBIjOFgH2gAyMzcxMDA1Mzg0OmM1YjgzODg1YmUwOTg2Mzc3ZGU1OWIwYzUzZTMxYWE2ZjFhZjAwYWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b1cae6fc038cf9e5868303a882bea8ebc0dc06b0", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/b1cae6fc038cf9e5868303a882bea8ebc0dc06b0", "committedDate": "2020-02-04T19:12:02Z", "message": "Add forceDelete option for task queue deletion\n\nBy default, force delete is set to false as it can corrupt the Helix\nTask Framework cache. We keep this as an expert only option to force\ndeleting the task queue without going through the Helix transitions\nin case we need to perform some cleanups. In normal case, this flag\nshould always be false."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjM4NTkx", "url": "https://github.com/apache/pinot/pull/5051#pullrequestreview-353238591", "createdAt": "2020-02-04T19:24:02Z", "commit": {"oid": "b1cae6fc038cf9e5868303a882bea8ebc0dc06b0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToyNDowMlrOFlgfRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToyNDowMlrOFlgfRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg3MzkyNQ==", "bodyText": "Extract the timeout and make it as a constant.", "url": "https://github.com/apache/pinot/pull/5051#discussion_r374873925", "createdAt": "2020-02-04T19:24:02Z", "author": {"login": "jackjlli"}, "path": "pinot-integration-tests/src/test/java/org/apache/pinot/integration/tests/SimpleMinionClusterIntegrationTest.java", "diffHunk": "@@ -174,10 +173,12 @@ public void testStopAndResumeTaskQueue()\n     }, 60_000L, \"Failed to get all tasks COMPLETED\");\n \n     // Delete the task queue\n-    // Note: Comment out the api for now since there is a known race condition\n-    // where helix controller might write a deleted workflow back to ZK because it's still caching it.\n-    // TODO: revert this after merging the fix\n-//    _helixTaskResourceManager.deleteTaskQueue(TestTaskGenerator.TASK_TYPE);\n+    _helixTaskResourceManager.deleteTaskQueue(TestTaskGenerator.TASK_TYPE, false);\n+\n+    // Wait at most 60 seconds for task queue to be deleted\n+    TestUtils.waitForCondition(input -> {\n+      return !_helixTaskResourceManager.getTaskTypes().contains(TestTaskGenerator.TASK_TYPE);\n+    }, 60_000L, \"Failed to delete the task queue\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1cae6fc038cf9e5868303a882bea8ebc0dc06b0"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5b83885be0986377de59b0c53e31aa6f1af00af", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/c5b83885be0986377de59b0c53e31aa6f1af00af", "committedDate": "2020-02-04T21:37:43Z", "message": "Address comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1258, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}