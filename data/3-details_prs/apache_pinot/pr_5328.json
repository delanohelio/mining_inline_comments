{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTU5NzY1", "number": 5328, "title": "Fix the bug introduced in #5132 where ScanBasedDocIdIterator.isMatch() is still required", "bodyText": "ScanBasedDocIdIterator.isMatch() is still required when the query is in the following format:\nSELECT ... WHERE (filterA OR filterB) AND filterC\nAnd filterC is working on a scan-based column (column without inverted index)\nEnhance the HybridClusterIntegrationTest to catch this issue", "createdAt": "2020-05-04T20:11:19Z", "url": "https://github.com/apache/pinot/pull/5328", "merged": true, "mergeCommit": {"oid": "0ccb389b7bbc70e902c6b2e215c09dfb373cea12"}, "closed": true, "closedAt": "2020-05-05T06:57:46Z", "author": {"login": "Jackie-Jiang"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceFQFLAH2gAyNDEzMTU5NzY1OjZjZGYyODBlNGEyOGFkYzlkYjc2MmM0MTk2YjBjYjBmYjlmOGI4Yjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceMwH1AFqTQwNTQ5MTg3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6cdf280e4a28adc9db762c4196b0cb0fb9f8b8b9", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/6cdf280e4a28adc9db762c4196b0cb0fb9f8b8b9", "committedDate": "2020-05-04T20:10:54Z", "message": "Fix the bug introduced in #5132 where ScanBasedDocIdIterator.isMatch() is still required\n\nScanBasedDocIdIterator.isMatch() is still required when the query is in the following format:\nSELECT ... WHERE (filterA OR filterB) AND filterC\nAnd filterC is working on a scan-based column (column without inverted index)\n\nEnhance the HybridClusterIntegrationTest to catch this issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzcwMDYw", "url": "https://github.com/apache/pinot/pull/5328#pullrequestreview-405370060", "createdAt": "2020-05-04T21:43:49Z", "commit": {"oid": "6cdf280e4a28adc9db762c4196b0cb0fb9f8b8b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMTo0Mzo0OVrOGQTVhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMTo0Mzo0OVrOGQTVhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0NzIwNA==", "bodyText": "Can you restructure the (outer) loop so that it is a while with some condition rather than a for(i = ..) in which we change the loop counter? I understand it was already that way.", "url": "https://github.com/apache/pinot/pull/5328#discussion_r419747204", "createdAt": "2020-05-04T21:43:49Z", "author": {"login": "mcvsubbu"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/dociditerators/AndDocIdIterator.java", "diffHunk": "@@ -102,6 +102,17 @@ public int next() {\n           i = -1;\n         }\n       }\n+      if (hasScanBasedIterators && i == docIdIterators.length - 1) {\n+        // this means we found the docId common to all nonScanBased iterators, now we need to ensure\n+        // that its also found in scanBasedIterator, if not matched, we restart the intersection\n+        for (ScanBasedDocIdIterator iterator : scanBasedDocIdIterators) {\n+          if (!iterator.isMatch(currentMax)) {\n+            i = -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cdf280e4a28adc9db762c4196b0cb0fb9f8b8b9"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDkxMjIx", "url": "https://github.com/apache/pinot/pull/5328#pullrequestreview-405491221", "createdAt": "2020-05-05T04:52:28Z", "commit": {"oid": "6cdf280e4a28adc9db762c4196b0cb0fb9f8b8b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNDo1MjoyOVrOGQaW_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNDo1MjoyOVrOGQaW_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg2MjI3MA==", "bodyText": "Is it the test case mentioned in the description section? It doesn't seem matched with SELECT ... WHERE (filterA OR filterB) AND filterC though.", "url": "https://github.com/apache/pinot/pull/5328#discussion_r419862270", "createdAt": "2020-05-05T04:52:29Z", "author": {"login": "jackjlli"}, "path": "pinot-integration-tests/src/test/java/org/apache/pinot/integration/tests/BaseClusterIntegrationTestSet.java", "diffHunk": "@@ -137,6 +137,9 @@ public void testHardcodedQueries()\n     query = \"SELECT MAX(ArrTime), MIN(ArrTime) FROM mytable WHERE DaysSinceEpoch >= 16312\";\n     testQuery(query, Arrays.asList(\"SELECT MAX(ArrTime) FROM mytable WHERE DaysSinceEpoch >= 15312\",\n         \"SELECT MIN(ArrTime) FROM mytable WHERE DaysSinceEpoch >= 15312\"));\n+    query =\n+        \"SELECT SUM(TotalAddGTime) FROM mytable WHERE DivArrDelay NOT IN (67, 260) AND Carrier IN ('F9', 'B6') OR DepTime BETWEEN 2144 AND 1926\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cdf280e4a28adc9db762c4196b0cb0fb9f8b8b9"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDkxODcz", "url": "https://github.com/apache/pinot/pull/5328#pullrequestreview-405491873", "createdAt": "2020-05-05T04:55:14Z", "commit": {"oid": "6cdf280e4a28adc9db762c4196b0cb0fb9f8b8b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 976, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}