{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNTQwODYy", "number": 5059, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODozNToxNVrODeHNSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODozNToxNVrODeHNSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyOTAxOTYyOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionPipelineJob.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxODozNToxNVrOFnGViA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxOToxNzo1M1rOFnHgiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0MjYwMA==", "bodyText": "Shall we change it in the DataAvailabilityTaskScheduler too?", "url": "https://github.com/apache/pinot/pull/5059#discussion_r376542600", "createdAt": "2020-02-07T18:35:15Z", "author": {"login": "jihaozh"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionPipelineJob.java", "diffHunk": "@@ -56,9 +57,10 @@ public void execute(JobExecutionContext jobExecutionContext) throws JobExecution\n     Long id = getIdFromJobKey(jobKey.getName());\n     DetectionConfigDTO configDTO = detectionDAO.findById(id);\n \n-    // Make sure start time is not out of DETECTION_TASK_MAX_LOOKBACK_WINDOW\n+    // Get the time window for the detection job.\n+    long delay = getDetectionExpectedDelay(configDTO);\n     long end = System.currentTimeMillis();\n-    long start = Math.max(configDTO.getLastTimestamp(), end  - ThirdEyeUtils.DETECTION_TASK_MAX_LOOKBACK_WINDOW);\n+    long start = Math.max(configDTO.getLastTimestamp(), end - ThirdEyeUtils.DETECTION_TASK_MAX_LOOKBACK_WINDOW - delay);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "734dbeddf882e0f8d420771997a348dda4f0c879"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU1MzE5MQ==", "bodyText": "Good point. I am looking into that.", "url": "https://github.com/apache/pinot/pull/5059#discussion_r376553191", "createdAt": "2020-02-07T18:58:15Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionPipelineJob.java", "diffHunk": "@@ -56,9 +57,10 @@ public void execute(JobExecutionContext jobExecutionContext) throws JobExecution\n     Long id = getIdFromJobKey(jobKey.getName());\n     DetectionConfigDTO configDTO = detectionDAO.findById(id);\n \n-    // Make sure start time is not out of DETECTION_TASK_MAX_LOOKBACK_WINDOW\n+    // Get the time window for the detection job.\n+    long delay = getDetectionExpectedDelay(configDTO);\n     long end = System.currentTimeMillis();\n-    long start = Math.max(configDTO.getLastTimestamp(), end  - ThirdEyeUtils.DETECTION_TASK_MAX_LOOKBACK_WINDOW);\n+    long start = Math.max(configDTO.getLastTimestamp(), end - ThirdEyeUtils.DETECTION_TASK_MAX_LOOKBACK_WINDOW - delay);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0MjYwMA=="}, "originalCommit": {"oid": "734dbeddf882e0f8d420771997a348dda4f0c879"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU1OTA1OQ==", "bodyText": "I almost finished this change in DataAvailabilityTaskScheduler and am sending a PR on this.", "url": "https://github.com/apache/pinot/pull/5059#discussion_r376559059", "createdAt": "2020-02-07T19:11:30Z", "author": {"login": "vincentchenjl"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionPipelineJob.java", "diffHunk": "@@ -56,9 +57,10 @@ public void execute(JobExecutionContext jobExecutionContext) throws JobExecution\n     Long id = getIdFromJobKey(jobKey.getName());\n     DetectionConfigDTO configDTO = detectionDAO.findById(id);\n \n-    // Make sure start time is not out of DETECTION_TASK_MAX_LOOKBACK_WINDOW\n+    // Get the time window for the detection job.\n+    long delay = getDetectionExpectedDelay(configDTO);\n     long end = System.currentTimeMillis();\n-    long start = Math.max(configDTO.getLastTimestamp(), end  - ThirdEyeUtils.DETECTION_TASK_MAX_LOOKBACK_WINDOW);\n+    long start = Math.max(configDTO.getLastTimestamp(), end - ThirdEyeUtils.DETECTION_TASK_MAX_LOOKBACK_WINDOW - delay);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0MjYwMA=="}, "originalCommit": {"oid": "734dbeddf882e0f8d420771997a348dda4f0c879"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU2MTgwMw==", "bodyText": "I am thinking of we can simplify this logic. Let's sync offline.", "url": "https://github.com/apache/pinot/pull/5059#discussion_r376561803", "createdAt": "2020-02-07T19:17:53Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionPipelineJob.java", "diffHunk": "@@ -56,9 +57,10 @@ public void execute(JobExecutionContext jobExecutionContext) throws JobExecution\n     Long id = getIdFromJobKey(jobKey.getName());\n     DetectionConfigDTO configDTO = detectionDAO.findById(id);\n \n-    // Make sure start time is not out of DETECTION_TASK_MAX_LOOKBACK_WINDOW\n+    // Get the time window for the detection job.\n+    long delay = getDetectionExpectedDelay(configDTO);\n     long end = System.currentTimeMillis();\n-    long start = Math.max(configDTO.getLastTimestamp(), end  - ThirdEyeUtils.DETECTION_TASK_MAX_LOOKBACK_WINDOW);\n+    long start = Math.max(configDTO.getLastTimestamp(), end - ThirdEyeUtils.DETECTION_TASK_MAX_LOOKBACK_WINDOW - delay);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0MjYwMA=="}, "originalCommit": {"oid": "734dbeddf882e0f8d420771997a348dda4f0c879"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3437, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}