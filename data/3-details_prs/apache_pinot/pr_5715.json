{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyMTU3ODU2", "number": 5715, "title": "Support alias name to be same as selection", "bodyText": "Description\nA fix to support query like:\nSELECT c1 AS c1 FROM myTable", "createdAt": "2020-07-18T21:40:38Z", "url": "https://github.com/apache/pinot/pull/5715", "merged": true, "mergeCommit": {"oid": "04bb73ff9d156076dc268e55794fec308efe9961"}, "closed": true, "closedAt": "2020-07-21T09:38:50Z", "author": {"login": "xiangfu0"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2PkongBqjM1NjE2NzUxNDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3CEL9AH2gAyNDUyMTU3ODU2OjA3YWQyODRhYjBiZGJiZTg3OWQ5Yjg1YzA0MTY0ODhmZDg5ZjZkMzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "25afcabc5021927ccf002007379c75bb5a972361", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/25afcabc5021927ccf002007379c75bb5a972361", "committedDate": "2020-07-18T21:39:00Z", "message": "Support alias name to be same as selection"}, "afterCommit": {"oid": "799a75a1bd340635d88b0af4fefde9b73b05abce", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/799a75a1bd340635d88b0af4fefde9b73b05abce", "committedDate": "2020-07-18T21:46:25Z", "message": "Support alias name to be same as selection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxODc4MDYx", "url": "https://github.com/apache/pinot/pull/5715#pullrequestreview-451878061", "createdAt": "2020-07-20T19:01:10Z", "commit": {"oid": "799a75a1bd340635d88b0af4fefde9b73b05abce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOTowMToxMVrOG0bVZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOTowMToxMVrOG0bVZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYyNjk4MA==", "bodyText": "We should not remove the sanity check on usage of alias reference\nE.g. we should reject the following query:\nSELECT colA AS a, foo(a, colB) FROM table\n\nAnother way is to replace the alias reference in selection as well", "url": "https://github.com/apache/pinot/pull/5715#discussion_r457626980", "createdAt": "2020-07-20T19:01:11Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -113,32 +113,11 @@ private static void validateSelectionClause(Map<Identifier, Expression> aliasMap\n     // Sanity check on selection expression shouldn't use alias reference.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "799a75a1bd340635d88b0af4fefde9b73b05abce"}, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "799a75a1bd340635d88b0af4fefde9b73b05abce", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/799a75a1bd340635d88b0af4fefde9b73b05abce", "committedDate": "2020-07-18T21:46:25Z", "message": "Support alias name to be same as selection"}, "afterCommit": {"oid": "e572e681d2506869ba880ade3453189a833b69f9", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/e572e681d2506869ba880ade3453189a833b69f9", "committedDate": "2020-07-20T23:54:26Z", "message": "Support alias name to be same as selection"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e572e681d2506869ba880ade3453189a833b69f9", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/e572e681d2506869ba880ade3453189a833b69f9", "committedDate": "2020-07-20T23:54:26Z", "message": "Support alias name to be same as selection"}, "afterCommit": {"oid": "dc12545a0db406f0a1da841da455f51df2904bb3", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/dc12545a0db406f0a1da841da455f51df2904bb3", "committedDate": "2020-07-21T04:27:13Z", "message": "Support alias name to be same as selection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5178e4b4eb764202590f02971db43e6be44c0db", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/e5178e4b4eb764202590f02971db43e6be44c0db", "committedDate": "2020-07-21T04:39:49Z", "message": "Support alias name to be same as selection"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc12545a0db406f0a1da841da455f51df2904bb3", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/dc12545a0db406f0a1da841da455f51df2904bb3", "committedDate": "2020-07-21T04:27:13Z", "message": "Support alias name to be same as selection"}, "afterCommit": {"oid": "e5178e4b4eb764202590f02971db43e6be44c0db", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/e5178e4b4eb764202590f02971db43e6be44c0db", "committedDate": "2020-07-21T04:39:49Z", "message": "Support alias name to be same as selection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMTM5NzEx", "url": "https://github.com/apache/pinot/pull/5715#pullrequestreview-452139711", "createdAt": "2020-07-21T05:39:34Z", "commit": {"oid": "e5178e4b4eb764202590f02971db43e6be44c0db"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNTozOTozNVrOG0o2Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwNTozOTozNVrOG0o2Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg0ODM5NQ==", "bodyText": "(nit)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  if (aliasKeys.contains(aliasName)) {\n          \n          \n            \n                    throw new SqlCompilationException(\"Duplicated alias name found.\");\n          \n          \n            \n                  }\n          \n          \n            \n                  aliasKeys.add(aliasName);\n          \n          \n            \n                  if (!aliasKeys.add(aliasName)) {\n          \n          \n            \n                    throw new SqlCompilationException(\"Duplicated alias name found.\");\n          \n          \n            \n                  }", "url": "https://github.com/apache/pinot/pull/5715#discussion_r457848395", "createdAt": "2020-07-21T05:39:35Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -113,7 +113,11 @@ private static void validateSelectionClause(Map<Identifier, Expression> aliasMap\n     // Sanity check on selection expression shouldn't use alias reference.\n     Set<String> aliasKeys = new HashSet<>();\n     for (Identifier identifier : aliasMap.keySet()) {\n-      aliasKeys.add(identifier.getName().toLowerCase());\n+      String aliasName = identifier.getName().toLowerCase();\n+      if (aliasKeys.contains(aliasName)) {\n+        throw new SqlCompilationException(\"Duplicated alias name found.\");\n+      }\n+      aliasKeys.add(aliasName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5178e4b4eb764202590f02971db43e6be44c0db"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07ad284ab0bdbbe879d9b85c0416488fd89f6d38", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/07ad284ab0bdbbe879d9b85c0416488fd89f6d38", "committedDate": "2020-07-21T08:36:18Z", "message": "Update pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java\n\nCo-authored-by: Xiaotian (Jackie) Jiang <17555551+Jackie-Jiang@users.noreply.github.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 379, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}