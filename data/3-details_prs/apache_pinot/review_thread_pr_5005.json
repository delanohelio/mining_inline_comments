{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MTk0OTMx", "number": 5005, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNjo1Mjo1M1rODaEY7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxODozNjowNlrODakwWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjYxNDg2OnYy", "diffSide": "RIGHT", "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNjo1Mjo1M1rOFg0QAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNzozMjoyNlrOFg00_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk1NDgxOA==", "bodyText": "Should we add ascending as well for readability?", "url": "https://github.com/apache/pinot/pull/5005#discussion_r369954818", "createdAt": "2020-01-23T06:52:53Z", "author": {"login": "kishoreg"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -224,17 +224,16 @@ private static Expression convertOrderBy(SqlNode node) {\n     final SqlKind kind = node.getKind();\n     Expression expression;\n     switch (kind) {\n-      case IDENTIFIER:\n-        expression = RequestUtils.getFunctionExpression(\"ASC\");\n-        expression.getFunctionCall().addToOperands(toExpression(node));\n-        break;\n       case DESCENDING:\n         SqlBasicCall basicCall = (SqlBasicCall) node;\n         expression = RequestUtils.getFunctionExpression(\"DESC\");\n         expression.getFunctionCall().addToOperands(toExpression(basicCall.getOperands()[0]));\n         break;\n+      case IDENTIFIER:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3558d265c12d477088167536e74b106588f57c44"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk1NTQwMQ==", "bodyText": "there is no ascending key word in calcite sql", "url": "https://github.com/apache/pinot/pull/5005#discussion_r369955401", "createdAt": "2020-01-23T06:55:41Z", "author": {"login": "xiangfu0"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -224,17 +224,16 @@ private static Expression convertOrderBy(SqlNode node) {\n     final SqlKind kind = node.getKind();\n     Expression expression;\n     switch (kind) {\n-      case IDENTIFIER:\n-        expression = RequestUtils.getFunctionExpression(\"ASC\");\n-        expression.getFunctionCall().addToOperands(toExpression(node));\n-        break;\n       case DESCENDING:\n         SqlBasicCall basicCall = (SqlBasicCall) node;\n         expression = RequestUtils.getFunctionExpression(\"DESC\");\n         expression.getFunctionCall().addToOperands(toExpression(basicCall.getOperands()[0]));\n         break;\n+      case IDENTIFIER:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk1NDgxOA=="}, "originalCommit": {"oid": "3558d265c12d477088167536e74b106588f57c44"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk2NDI4Ng==", "bodyText": "basically by default, it's ascending already", "url": "https://github.com/apache/pinot/pull/5005#discussion_r369964286", "createdAt": "2020-01-23T07:32:26Z", "author": {"login": "xiangfu0"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -224,17 +224,16 @@ private static Expression convertOrderBy(SqlNode node) {\n     final SqlKind kind = node.getKind();\n     Expression expression;\n     switch (kind) {\n-      case IDENTIFIER:\n-        expression = RequestUtils.getFunctionExpression(\"ASC\");\n-        expression.getFunctionCall().addToOperands(toExpression(node));\n-        break;\n       case DESCENDING:\n         SqlBasicCall basicCall = (SqlBasicCall) node;\n         expression = RequestUtils.getFunctionExpression(\"DESC\");\n         expression.getFunctionCall().addToOperands(toExpression(basicCall.getOperands()[0]));\n         break;\n+      case IDENTIFIER:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk1NDgxOA=="}, "originalCommit": {"oid": "3558d265c12d477088167536e74b106588f57c44"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4OTU2Nzk3OnYy", "diffSide": "RIGHT", "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwMDowMToyN1rOFhQgGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwMDo1MToyOFrOFhRQIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxNzY5MA==", "bodyText": "Why is this needed?", "url": "https://github.com/apache/pinot/pull/5005#discussion_r370417690", "createdAt": "2020-01-24T00:01:27Z", "author": {"login": "siddharthteotia"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -111,6 +112,7 @@ private static void setOptions(PinotQuery pinotQuery, List<String> optionsStatem\n   private static PinotQuery compileCalciteSqlToPinotQuery(String sql) {\n     SqlParser.ConfigBuilder parserBuilder = SqlParser.configBuilder();\n     parserBuilder.setLex(PINOT_LEX);\n+    parserBuilder.setConformance(SqlConformanceEnum.LENIENT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff0209333108947e907b679ea062625ce17b3743"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxODAyNw==", "bodyText": "I think I committed another change for supporting LIMIT offset,count into this.", "url": "https://github.com/apache/pinot/pull/5005#discussion_r370418027", "createdAt": "2020-01-24T00:02:44Z", "author": {"login": "xiangfu0"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -111,6 +112,7 @@ private static void setOptions(PinotQuery pinotQuery, List<String> optionsStatem\n   private static PinotQuery compileCalciteSqlToPinotQuery(String sql) {\n     SqlParser.ConfigBuilder parserBuilder = SqlParser.configBuilder();\n     parserBuilder.setLex(PINOT_LEX);\n+    parserBuilder.setConformance(SqlConformanceEnum.LENIENT);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxNzY5MA=="}, "originalCommit": {"oid": "ff0209333108947e907b679ea062625ce17b3743"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxODI3OA==", "bodyText": "basically calcite parser cannot parse LIMIT X,Y until this conformance is added.", "url": "https://github.com/apache/pinot/pull/5005#discussion_r370418278", "createdAt": "2020-01-24T00:03:43Z", "author": {"login": "xiangfu0"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -111,6 +112,7 @@ private static void setOptions(PinotQuery pinotQuery, List<String> optionsStatem\n   private static PinotQuery compileCalciteSqlToPinotQuery(String sql) {\n     SqlParser.ConfigBuilder parserBuilder = SqlParser.configBuilder();\n     parserBuilder.setLex(PINOT_LEX);\n+    parserBuilder.setConformance(SqlConformanceEnum.LENIENT);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxNzY5MA=="}, "originalCommit": {"oid": "ff0209333108947e907b679ea062625ce17b3743"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQyNzQyNQ==", "bodyText": "@siddharthteotia we did an exercise at LI wherein we passed all possible used queries though Calcite parser. We caught certain things which do not pass under the default sql conformance level (!= and LIMIT offset, count). One of the solutions for that we discussed was to set the conformance to be more lenient.", "url": "https://github.com/apache/pinot/pull/5005#discussion_r370427425", "createdAt": "2020-01-24T00:40:26Z", "author": {"login": "npawar"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -111,6 +112,7 @@ private static void setOptions(PinotQuery pinotQuery, List<String> optionsStatem\n   private static PinotQuery compileCalciteSqlToPinotQuery(String sql) {\n     SqlParser.ConfigBuilder parserBuilder = SqlParser.configBuilder();\n     parserBuilder.setLex(PINOT_LEX);\n+    parserBuilder.setConformance(SqlConformanceEnum.LENIENT);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxNzY5MA=="}, "originalCommit": {"oid": "ff0209333108947e907b679ea062625ce17b3743"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQyOTk4Ng==", "bodyText": "Got it. Thanks", "url": "https://github.com/apache/pinot/pull/5005#discussion_r370429986", "createdAt": "2020-01-24T00:51:28Z", "author": {"login": "siddharthteotia"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -111,6 +112,7 @@ private static void setOptions(PinotQuery pinotQuery, List<String> optionsStatem\n   private static PinotQuery compileCalciteSqlToPinotQuery(String sql) {\n     SqlParser.ConfigBuilder parserBuilder = SqlParser.configBuilder();\n     parserBuilder.setLex(PINOT_LEX);\n+    parserBuilder.setConformance(SqlConformanceEnum.LENIENT);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQxNzY5MA=="}, "originalCommit": {"oid": "ff0209333108947e907b679ea062625ce17b3743"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MTkxNzcxOnYy", "diffSide": "RIGHT", "path": "pinot-common/src/main/java/org/apache/pinot/pql/parsers/pql2/ast/SelectAstNode.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxODozNjowNlrOFhmqEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxOToyMTozMVrOFhn5Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc4MDY5MQ==", "bodyText": "Is it possible to just have one variable for TOP/LIMIT? Or does LIMIT imply that there may not be any sorting if ORDERBY not provided?", "url": "https://github.com/apache/pinot/pull/5005#discussion_r370780691", "createdAt": "2020-01-24T18:36:06Z", "author": {"login": "mayankshriv"}, "path": "pinot-common/src/main/java/org/apache/pinot/pql/parsers/pql2/ast/SelectAstNode.java", "diffHunk": "@@ -31,12 +31,12 @@\n  * AST node for a SELECT statement.\n  */\n public class SelectAstNode extends BaseAstNode {\n+  public static final int DEFAULT_RECORD_LIMIT = 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa4001c165613bd0140f5b6f6f7d06a214c4d397"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc5MzYzNg==", "bodyText": "Yes LIMIT implies no sorting/ordering unless ORDER BY is specified. In fact in MySql, both LIMIT and TOP are synonymous.\nI think we should eventually move to LIMIT -- now that we have GROUP BY with ORDER BY and are also converging towards standard SQL, we should have two variants (1) LIMIT and (2) LIMIT with ORDER BY", "url": "https://github.com/apache/pinot/pull/5005#discussion_r370793636", "createdAt": "2020-01-24T19:04:35Z", "author": {"login": "siddharthteotia"}, "path": "pinot-common/src/main/java/org/apache/pinot/pql/parsers/pql2/ast/SelectAstNode.java", "diffHunk": "@@ -31,12 +31,12 @@\n  * AST node for a SELECT statement.\n  */\n public class SelectAstNode extends BaseAstNode {\n+  public static final int DEFAULT_RECORD_LIMIT = 10;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc4MDY5MQ=="}, "originalCommit": {"oid": "fa4001c165613bd0140f5b6f6f7d06a214c4d397"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwMDk1OA==", "bodyText": "Wondering what is a good use case for non ordered response? And/or if we should consider a default ordering?", "url": "https://github.com/apache/pinot/pull/5005#discussion_r370800958", "createdAt": "2020-01-24T19:21:31Z", "author": {"login": "mayankshriv"}, "path": "pinot-common/src/main/java/org/apache/pinot/pql/parsers/pql2/ast/SelectAstNode.java", "diffHunk": "@@ -31,12 +31,12 @@\n  * AST node for a SELECT statement.\n  */\n public class SelectAstNode extends BaseAstNode {\n+  public static final int DEFAULT_RECORD_LIMIT = 10;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc4MDY5MQ=="}, "originalCommit": {"oid": "fa4001c165613bd0140f5b6f6f7d06a214c4d397"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3624, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}