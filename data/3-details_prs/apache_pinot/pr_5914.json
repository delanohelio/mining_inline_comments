{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNzU0NTQ5", "number": 5914, "title": "[TE] Updated ThirdEye docker launch script to accept MODE as a second arg", "bodyText": "This enhances the launch script of the thirdeye docker image.  The launch script now accepts a second argument called MODE. The MODE param decides on whether TE launches the frontend, backend, database or all services.\n ./start-thirdeye.sh ${CONFIG_DIR} ${MODE}\n\n - CONFIG_DIR: path to the thirdeye configuration director\n - MODE: Choices: {frontend, backend, * }\n       frontend: Start the frontend server only\n       backend: Start the backend server only\n       database: Start the H@ db service. Also initializes the db with the required tables\n       For any other value, defaults to starting all services with an h2 db.", "createdAt": "2020-08-24T20:41:52Z", "url": "https://github.com/apache/pinot/pull/5914", "merged": true, "mergeCommit": {"oid": "a8974c77bd2f3d3a064228889512fbe2e5014a65"}, "closed": true, "closedAt": "2020-08-25T01:18:42Z", "author": {"login": "suvodeep-pyne"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCIyHkAH2gAyNDcyNzU0NTQ5OjBmZThmMDdlMzdlZjQ2MjVlOWI5MDlhYjhlZDA4MjdhZTIwMDgzZWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCLw3kgH2gAyNDcyNzU0NTQ5OjMwMTE3MTRmMmUzNzllMDkwNjVlMmM0MDZjOTgxNmRjOTE1ZmE2ZTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0fe8f07e37ef4625e9b909ab8ed0827ae20083ee", "author": {"user": {"login": "suvodeep-pyne", "name": "Suvodeep Pyne"}}, "url": "https://github.com/apache/pinot/commit/0fe8f07e37ef4625e9b909ab8ed0827ae20083ee", "committedDate": "2020-08-24T20:39:04Z", "message": "[TE] Added Docker Images for a distributed ThirdEye setup\n\nAdded separate docker images for a"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e7ad258561b43d4017f7519f73cd4cdefe2ccf4", "author": {"user": {"login": "suvodeep-pyne", "name": "Suvodeep Pyne"}}, "url": "https://github.com/apache/pinot/commit/6e7ad258561b43d4017f7519f73cd4cdefe2ccf4", "committedDate": "2020-08-24T20:42:25Z", "message": "[TE] Added Docker Images for a distributed ThirdEye setup\n\nFixed Dockerfile base image tag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68791b1305f07da5e33e7033c9462d4b8feb2b42", "author": {"user": {"login": "suvodeep-pyne", "name": "Suvodeep Pyne"}}, "url": "https://github.com/apache/pinot/commit/68791b1305f07da5e33e7033c9462d4b8feb2b42", "committedDate": "2020-08-24T22:42:31Z", "message": "[TE] Updated docker launch script to accept MODE as a second parameter\n\nThe MODE param decides on whether TE launches the frontend, backend or all services\n\n```\n ./start-thirdeye.sh ${CONFIG_DIR} ${MODE}\n\n - CONFIG_DIR: path to the thirdeye configuration director\n - MODE: Choices: {frontend, backend, * }\n       frontend: Start the frontend server only\n       backend: Start the backend server only\n       For any other value, defaults to starting all services with an h2 db.\n```"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43953c8c1b45abd32bb2bf78c8af93ab5a87169b", "author": {"user": {"login": "suvodeep-pyne", "name": "Suvodeep Pyne"}}, "url": "https://github.com/apache/pinot/commit/43953c8c1b45abd32bb2bf78c8af93ab5a87169b", "committedDate": "2020-08-24T22:46:10Z", "message": "[TE] Updated docker launch script to accept MODE as a second parameter\n\nThe MODE param decides on whether TE launches the frontend, backend or all services\n\n```\n ./start-thirdeye.sh ${CONFIG_DIR} ${MODE}\n\n - CONFIG_DIR: path to the thirdeye configuration director\n - MODE: Choices: {frontend, backend, * }\n       frontend: Start the frontend server only\n       backend: Start the backend server only\n       For any other value, defaults to starting all services with an h2 db.\n```"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczOTY5NzI1", "url": "https://github.com/apache/pinot/pull/5914#pullrequestreview-473969725", "createdAt": "2020-08-24T22:56:22Z", "commit": {"oid": "43953c8c1b45abd32bb2bf78c8af93ab5a87169b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMjo1NjoyMlrOHF5Alw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMjo1NjoyMlrOHF5Alw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzODk2Nw==", "bodyText": "maybe add a start_database function for h2 specifically, so it can be started just like front and backend. imo otherwise start_all has an \"unexpected\" side-effect of bringing up a db", "url": "https://github.com/apache/pinot/pull/5914#discussion_r475938967", "createdAt": "2020-08-24T22:56:22Z", "author": {"login": "apucher"}, "path": "docker/images/pinot-thirdeye/bin/start-thirdeye.sh", "diffHunk": "@@ -18,32 +18,64 @@\n # under the License.\n #\n \n+# Script Usage\n+# ---------------------------------------------\n+# ./start-thirdeye.sh ${CONFIG_DIR} ${MODE}\n+#\n+# - CONFIG_DIR: path to the thirdeye configuration director\n+# - MODE: Choices: {frontend, backend, * }\n+#       frontend: Start the frontend server only\n+#       backend: Start the backend server only\n+#       For any other value, defaults to starting all services with an h2 db.\n+#\n+\n if [[ \"$#\" -gt 0 ]]\n then\n   CONFIG_DIR=\"./config/$1\"\n else\n   CONFIG_DIR=\"./config/default\"\n fi\n \n-echo \"Starting H2 database server\"\n-java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.Server -tcp -baseDir \"${CONFIG_DIR}/..\" &\n-sleep 1\n \n-echo \"Creating ThirdEye database schema\"\n-java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.RunScript -user \"sa\" -password \"sa\" -url \"jdbc:h2:tcp:localhost/h2db\" -script \"zip:./bin/thirdeye-pinot.jar!/schema/create-schema.sql\"\n+function start_server {\n+  class_ref=$1\n+  config_dir=$2\n+  java -Dlog4j.configurationFile=log4j2.xml -cp \"./bin/thirdeye-pinot.jar\" ${class_ref} \"${config_dir}\"\n+}\n \n-if [ -f \"${CONFIG_DIR}/bootstrap.sql\" ]; then\n-  echo \"Running database bootstrap script ${CONFIG_DIR}/bootstrap.sql\"\n-  java -cp \"./bin/thirdeye-pinot.jar\" org.h2.tools.RunScript -user \"sa\" -password \"sa\" -url \"jdbc:h2:tcp:localhost/h2db\" -script \"${CONFIG_DIR}/bootstrap.sql\"\n-fi\n+function start_frontend {\n+  echo \"Running Thirdeye frontend config: ${CONFIG_DIR}\"\n+  start_server org.apache.pinot.thirdeye.dashboard.ThirdEyeDashboardApplication \"${CONFIG_DIR}\"\n+}\n+\n+function start_backend {\n+  echo \"Running Thirdeye backend config: ${CONFIG_DIR}\"\n+  start_server  org.apache.pinot.thirdeye.anomaly.ThirdEyeAnomalyApplication \"${CONFIG_DIR}\"\n+}\n+\n+function start_all {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43953c8c1b45abd32bb2bf78c8af93ab5a87169b"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3011714f2e379e09065e2c406c9816dc915fa6e7", "author": {"user": {"login": "suvodeep-pyne", "name": "Suvodeep Pyne"}}, "url": "https://github.com/apache/pinot/commit/3011714f2e379e09065e2c406c9816dc915fa6e7", "committedDate": "2020-08-25T00:07:25Z", "message": "[TE] Updated docker launch script to accept MODE as a second parameter\n\nThe MODE param decides on whether TE launches the frontend, backend, database or all services\n\n```\n ./start-thirdeye.sh ${CONFIG_DIR} ${MODE}\n\n - CONFIG_DIR: path to the thirdeye configuration director\n - MODE: Choices: {frontend, backend, * }\n       frontend: Start the frontend server only\n       backend: Start the backend server only\n       database: Start the H@ db service. Also initializes the db with the required tables\n       For any other value, defaults to starting all services with an h2 db.\n```"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 262, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}