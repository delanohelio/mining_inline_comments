{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMDcxMTE4", "number": 5052, "title": "[TE] weekly detection - Holt winter algorithm prediction window alignment", "bodyText": "This PR fixes the Holt winter algorithm prediction window alignment. Previously, it only aligns the training window, but not the testing window, which might miss some anomalies in the gap.", "createdAt": "2020-02-04T21:58:05Z", "url": "https://github.com/apache/pinot/pull/5052", "merged": true, "mergeCommit": {"oid": "0a1c17a42cfb7115f45e828c6b742045780bdade"}, "closed": true, "closedAt": "2020-02-04T22:55:19Z", "author": {"login": "jihaozh"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBHG-xAH2gAyMzcxMDcxMTE4OmIxODhlZWM5OTZlNmYyNmYzZWU0OTBhZjRhNGZlYzczMzU1MGJlNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBJqAXAFqTM1MzM2MTQzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b188eec996e6f26f3ee490af4a4fec733550be44", "author": {"user": {"login": "jihaozh", "name": "Jihao Zhang"}}, "url": "https://github.com/apache/pinot/commit/b188eec996e6f26f3ee490af4a4fec733550be44", "committedDate": "2020-02-04T19:56:58Z", "message": "[TE] weekly detection - holt winter algorithm prediction window alignment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzM0NTQ4", "url": "https://github.com/apache/pinot/pull/5052#pullrequestreview-353334548", "createdAt": "2020-02-04T22:03:38Z", "commit": {"oid": "b188eec996e6f26f3ee490af4a4fec733550be44"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMjowMzozOVrOFllERQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMjowMzozOVrOFllERQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk0ODkzMw==", "bodyText": "If user doesn't define a weekStart we should use a default value. Isn't it?", "url": "https://github.com/apache/pinot/pull/5052#discussion_r374948933", "createdAt": "2020-02-04T22:03:39Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/components/HoltWintersDetector.java", "diffHunk": "@@ -152,24 +153,30 @@ public TimeSeries computePredictedTimeSeries(MetricSlice slice) {\n     return TimeSeries.fromDataFrame(resultDF);\n   }\n \n-  private DateTime getTrainingStartTime(Interval window) {\n+  private DateTime getTrainingStartTime(DateTime windowStart) {\n     DateTime trainStart;\n     if (isMultiDayGranularity()) {\n-      trainStart = window.getStart().minusDays(timeGranularity.getSize() * LOOKBACK);\n+      trainStart = windowStart.minusDays(timeGranularity.getSize() * LOOKBACK);\n     } else if (this.monitoringGranularity.endsWith(TimeGranularity.MONTHS)) {\n-      trainStart = window.getStart().minusMonths(LOOKBACK);\n+      trainStart = windowStart.minusMonths(LOOKBACK);\n     } else if (this.monitoringGranularity.endsWith(TimeGranularity.WEEKS)) {\n-      trainStart = window.getStart().withTimeAtStartOfDay().withDayOfWeek(weekStart.getValue()).minusWeeks(LOOKBACK);\n+      trainStart = windowStart.minusWeeks(LOOKBACK);\n     } else {\n-      trainStart = window.getStart().minusDays(LOOKBACK);\n+      trainStart = windowStart.minusDays(LOOKBACK);\n     }\n     return trainStart;\n   }\n \n   @Override\n   public DetectionResult runDetection(Interval window, String metricUrn) {\n     MetricEntity metricEntity = MetricEntity.fromURN(metricUrn);\n-    DateTime trainStart = getTrainingStartTime(window);\n+    DateTime windowStart = window.getStart();\n+    // align start day to the user specified week start\n+    if (Objects.nonNull(this.weekStart)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b188eec996e6f26f3ee490af4a4fec733550be44"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzU1ODk2", "url": "https://github.com/apache/pinot/pull/5052#pullrequestreview-353355896", "createdAt": "2020-02-04T22:43:38Z", "commit": {"oid": "b188eec996e6f26f3ee490af4a4fec733550be44"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzYxNDMx", "url": "https://github.com/apache/pinot/pull/5052#pullrequestreview-353361431", "createdAt": "2020-02-04T22:55:02Z", "commit": {"oid": "b188eec996e6f26f3ee490af4a4fec733550be44"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1260, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}