{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1Njk1MTU1", "number": 6239, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwMjoxNzo0NlrOE1d_jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTowNjowM1rOE2NG4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NTAxMzg5OnYy", "diffSide": "LEFT", "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/segment/SegmentZKMetadata.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwMjoxNzo0NlrOHtwpRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxODozNDo0NlrOHuRAIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzc0NDk2Ng==", "bodyText": "For consuming segment, neither start nor end time will be set.", "url": "https://github.com/apache/pinot/pull/6239#discussion_r517744966", "createdAt": "2020-11-05T02:17:46Z", "author": {"login": "mcvsubbu"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/segment/SegmentZKMetadata.java", "diffHunk": "@@ -105,54 +97,40 @@ public void setSegmentName(String segmentName) {\n     _segmentName = segmentName;\n   }\n \n-  @Deprecated\n-  public String getTableName() {\n-    return _tableName;\n+  public SegmentType getSegmentType() {\n+    return _segmentType;\n   }\n \n-  @Deprecated\n-  public void setTableName(String tableName) {\n-    _tableName = tableName;\n+  public void setSegmentType(SegmentType segmentType) {\n+    _segmentType = segmentType;\n   }\n \n-  public long getStartTime() {\n-    return _startTime;\n+  public long getStartTimeMs() {\n+    if (_startTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_startTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setStartTime(long startTime) {\n     _startTime = startTime;\n   }\n \n-  public long getEndTime() {\n-    return _endTime;\n+  public long getEndTimeMs() {\n+    if (_endTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_endTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setEndTime(long endTime) {\n     _endTime = endTime;\n   }\n \n-  public TimeUnit getTimeUnit() {\n-    return _timeUnit;\n-  }\n-\n-  /**\n-   * NOTE: should be called after setting start and end time.\n-   */\n-  public void setTimeUnit(@Nonnull TimeUnit timeUnit) {\n+  public void setTimeUnit(TimeUnit timeUnit) {\n     _timeUnit = timeUnit;\n-    _timeGranularity = new Duration(_timeUnit.toMillis(1));\n-    // For consuming segment, end time might not be set", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a38db3231b296cfcaae4bdfd9ff501c4f21b41b5"}, "originalPosition": 152}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI3NTEwNQ==", "bodyText": "True, time unit won't be set as well.\nThe new code doesn't have the requirement of setting start/end before time unit.", "url": "https://github.com/apache/pinot/pull/6239#discussion_r518275105", "createdAt": "2020-11-05T18:34:46Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/segment/SegmentZKMetadata.java", "diffHunk": "@@ -105,54 +97,40 @@ public void setSegmentName(String segmentName) {\n     _segmentName = segmentName;\n   }\n \n-  @Deprecated\n-  public String getTableName() {\n-    return _tableName;\n+  public SegmentType getSegmentType() {\n+    return _segmentType;\n   }\n \n-  @Deprecated\n-  public void setTableName(String tableName) {\n-    _tableName = tableName;\n+  public void setSegmentType(SegmentType segmentType) {\n+    _segmentType = segmentType;\n   }\n \n-  public long getStartTime() {\n-    return _startTime;\n+  public long getStartTimeMs() {\n+    if (_startTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_startTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setStartTime(long startTime) {\n     _startTime = startTime;\n   }\n \n-  public long getEndTime() {\n-    return _endTime;\n+  public long getEndTimeMs() {\n+    if (_endTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_endTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setEndTime(long endTime) {\n     _endTime = endTime;\n   }\n \n-  public TimeUnit getTimeUnit() {\n-    return _timeUnit;\n-  }\n-\n-  /**\n-   * NOTE: should be called after setting start and end time.\n-   */\n-  public void setTimeUnit(@Nonnull TimeUnit timeUnit) {\n+  public void setTimeUnit(TimeUnit timeUnit) {\n     _timeUnit = timeUnit;\n-    _timeGranularity = new Duration(_timeUnit.toMillis(1));\n-    // For consuming segment, end time might not be set", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzc0NDk2Ng=="}, "originalCommit": {"oid": "a38db3231b296cfcaae4bdfd9ff501c4f21b41b5"}, "originalPosition": 152}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MjcyMjAwOnYy", "diffSide": "LEFT", "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/segment/SegmentZKMetadata.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTowMjozMFrOHu6AHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTozNDo1M1rOHwsk_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk0Njg0Ng==", "bodyText": "Can we put @Deprecated annotation instead of removing the function?", "url": "https://github.com/apache/pinot/pull/6239#discussion_r518946846", "createdAt": "2020-11-06T19:02:30Z", "author": {"login": "snleee"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/segment/SegmentZKMetadata.java", "diffHunk": "@@ -105,54 +97,40 @@ public void setSegmentName(String segmentName) {\n     _segmentName = segmentName;\n   }\n \n-  @Deprecated\n-  public String getTableName() {\n-    return _tableName;\n+  public SegmentType getSegmentType() {\n+    return _segmentType;\n   }\n \n-  @Deprecated\n-  public void setTableName(String tableName) {\n-    _tableName = tableName;\n+  public void setSegmentType(SegmentType segmentType) {\n+    _segmentType = segmentType;\n   }\n \n-  public long getStartTime() {\n-    return _startTime;\n+  public long getStartTimeMs() {\n+    if (_startTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_startTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setStartTime(long startTime) {\n     _startTime = startTime;\n   }\n \n-  public long getEndTime() {\n-    return _endTime;\n+  public long getEndTimeMs() {\n+    if (_endTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_endTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setEndTime(long endTime) {\n     _endTime = endTime;\n   }\n \n-  public TimeUnit getTimeUnit() {\n-    return _timeUnit;\n-  }\n-\n-  /**\n-   * NOTE: should be called after setting start and end time.\n-   */\n-  public void setTimeUnit(@Nonnull TimeUnit timeUnit) {\n+  public void setTimeUnit(TimeUnit timeUnit) {\n     _timeUnit = timeUnit;\n-    _timeGranularity = new Duration(_timeUnit.toMillis(1));\n-    // For consuming segment, end time might not be set\n-    if (_startTime >= 0 && _startTime <= _endTime) {\n-      _timeInterval = new Interval(_timeUnit.toMillis(_startTime), _timeUnit.toMillis(_endTime));\n-    }\n-  }\n-\n-  public Duration getTimeGranularity() {\n-    return _timeGranularity;\n-  }\n-\n-  public Interval getTimeInterval() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a38db3231b296cfcaae4bdfd9ff501c4f21b41b5"}, "originalPosition": 162}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgyNDA2MA==", "bodyText": "Done", "url": "https://github.com/apache/pinot/pull/6239#discussion_r520824060", "createdAt": "2020-11-10T19:34:53Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/segment/SegmentZKMetadata.java", "diffHunk": "@@ -105,54 +97,40 @@ public void setSegmentName(String segmentName) {\n     _segmentName = segmentName;\n   }\n \n-  @Deprecated\n-  public String getTableName() {\n-    return _tableName;\n+  public SegmentType getSegmentType() {\n+    return _segmentType;\n   }\n \n-  @Deprecated\n-  public void setTableName(String tableName) {\n-    _tableName = tableName;\n+  public void setSegmentType(SegmentType segmentType) {\n+    _segmentType = segmentType;\n   }\n \n-  public long getStartTime() {\n-    return _startTime;\n+  public long getStartTimeMs() {\n+    if (_startTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_startTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setStartTime(long startTime) {\n     _startTime = startTime;\n   }\n \n-  public long getEndTime() {\n-    return _endTime;\n+  public long getEndTimeMs() {\n+    if (_endTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_endTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setEndTime(long endTime) {\n     _endTime = endTime;\n   }\n \n-  public TimeUnit getTimeUnit() {\n-    return _timeUnit;\n-  }\n-\n-  /**\n-   * NOTE: should be called after setting start and end time.\n-   */\n-  public void setTimeUnit(@Nonnull TimeUnit timeUnit) {\n+  public void setTimeUnit(TimeUnit timeUnit) {\n     _timeUnit = timeUnit;\n-    _timeGranularity = new Duration(_timeUnit.toMillis(1));\n-    // For consuming segment, end time might not be set\n-    if (_startTime >= 0 && _startTime <= _endTime) {\n-      _timeInterval = new Interval(_timeUnit.toMillis(_startTime), _timeUnit.toMillis(_endTime));\n-    }\n-  }\n-\n-  public Duration getTimeGranularity() {\n-    return _timeGranularity;\n-  }\n-\n-  public Interval getTimeInterval() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk0Njg0Ng=="}, "originalCommit": {"oid": "a38db3231b296cfcaae4bdfd9ff501c4f21b41b5"}, "originalPosition": 162}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MjcyMzc3OnYy", "diffSide": "LEFT", "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/segment/SegmentZKMetadata.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTowMzowOVrOHu6BMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTozNDo1OFrOHwslKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk0NzEyMQ==", "bodyText": "Can we put @Deprecated  annotation instead of removing this?", "url": "https://github.com/apache/pinot/pull/6239#discussion_r518947121", "createdAt": "2020-11-06T19:03:09Z", "author": {"login": "snleee"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/segment/SegmentZKMetadata.java", "diffHunk": "@@ -105,54 +97,40 @@ public void setSegmentName(String segmentName) {\n     _segmentName = segmentName;\n   }\n \n-  @Deprecated\n-  public String getTableName() {\n-    return _tableName;\n+  public SegmentType getSegmentType() {\n+    return _segmentType;\n   }\n \n-  @Deprecated\n-  public void setTableName(String tableName) {\n-    _tableName = tableName;\n+  public void setSegmentType(SegmentType segmentType) {\n+    _segmentType = segmentType;\n   }\n \n-  public long getStartTime() {\n-    return _startTime;\n+  public long getStartTimeMs() {\n+    if (_startTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_startTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setStartTime(long startTime) {\n     _startTime = startTime;\n   }\n \n-  public long getEndTime() {\n-    return _endTime;\n+  public long getEndTimeMs() {\n+    if (_endTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_endTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setEndTime(long endTime) {\n     _endTime = endTime;\n   }\n \n-  public TimeUnit getTimeUnit() {\n-    return _timeUnit;\n-  }\n-\n-  /**\n-   * NOTE: should be called after setting start and end time.\n-   */\n-  public void setTimeUnit(@Nonnull TimeUnit timeUnit) {\n+  public void setTimeUnit(TimeUnit timeUnit) {\n     _timeUnit = timeUnit;\n-    _timeGranularity = new Duration(_timeUnit.toMillis(1));\n-    // For consuming segment, end time might not be set\n-    if (_startTime >= 0 && _startTime <= _endTime) {\n-      _timeInterval = new Interval(_timeUnit.toMillis(_startTime), _timeUnit.toMillis(_endTime));\n-    }\n-  }\n-\n-  public Duration getTimeGranularity() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a38db3231b296cfcaae4bdfd9ff501c4f21b41b5"}, "originalPosition": 158}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgyNDEwNg==", "bodyText": "Done", "url": "https://github.com/apache/pinot/pull/6239#discussion_r520824106", "createdAt": "2020-11-10T19:34:58Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/metadata/segment/SegmentZKMetadata.java", "diffHunk": "@@ -105,54 +97,40 @@ public void setSegmentName(String segmentName) {\n     _segmentName = segmentName;\n   }\n \n-  @Deprecated\n-  public String getTableName() {\n-    return _tableName;\n+  public SegmentType getSegmentType() {\n+    return _segmentType;\n   }\n \n-  @Deprecated\n-  public void setTableName(String tableName) {\n-    _tableName = tableName;\n+  public void setSegmentType(SegmentType segmentType) {\n+    _segmentType = segmentType;\n   }\n \n-  public long getStartTime() {\n-    return _startTime;\n+  public long getStartTimeMs() {\n+    if (_startTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_startTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setStartTime(long startTime) {\n     _startTime = startTime;\n   }\n \n-  public long getEndTime() {\n-    return _endTime;\n+  public long getEndTimeMs() {\n+    if (_endTime > 0 && _timeUnit != null) {\n+      return _timeUnit.toMillis(_endTime);\n+    } else {\n+      return -1;\n+    }\n   }\n \n   public void setEndTime(long endTime) {\n     _endTime = endTime;\n   }\n \n-  public TimeUnit getTimeUnit() {\n-    return _timeUnit;\n-  }\n-\n-  /**\n-   * NOTE: should be called after setting start and end time.\n-   */\n-  public void setTimeUnit(@Nonnull TimeUnit timeUnit) {\n+  public void setTimeUnit(TimeUnit timeUnit) {\n     _timeUnit = timeUnit;\n-    _timeGranularity = new Duration(_timeUnit.toMillis(1));\n-    // For consuming segment, end time might not be set\n-    if (_startTime >= 0 && _startTime <= _endTime) {\n-      _timeInterval = new Interval(_timeUnit.toMillis(_startTime), _timeUnit.toMillis(_endTime));\n-    }\n-  }\n-\n-  public Duration getTimeGranularity() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk0NzEyMQ=="}, "originalCommit": {"oid": "a38db3231b296cfcaae4bdfd9ff501c4f21b41b5"}, "originalPosition": 158}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MjczMzE0OnYy", "diffSide": "RIGHT", "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/minion/generator/RealtimeToOfflineSegmentsTaskGenerator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTowNjowM1rOHu6G6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTozNzo0OVrOHwsrzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk0ODU4NQ==", "bodyText": "Do we want to add\nPreconditions.checkState(minStartTimeMs != Long.MAX_VALUE);\n\nto throw the exception at the same condition?", "url": "https://github.com/apache/pinot/pull/6239#discussion_r518948585", "createdAt": "2020-11-06T19:06:03Z", "author": {"login": "snleee"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/minion/generator/RealtimeToOfflineSegmentsTaskGenerator.java", "diffHunk": "@@ -287,21 +284,14 @@ private long getWatermarkMs(String realtimeTableName, List<LLCRealtimeSegmentZKM\n       long watermarkMs;\n \n       // Find the smallest time from all segments\n-      RealtimeSegmentZKMetadata minSegmentZkMetadata = null;\n+      long minStartTimeMs = Long.MAX_VALUE;\n       for (LLCRealtimeSegmentZKMetadata realtimeSegmentZKMetadata : completedSegmentsMetadata) {\n-        if (minSegmentZkMetadata == null || realtimeSegmentZKMetadata.getStartTime() < minSegmentZkMetadata\n-            .getStartTime()) {\n-          minSegmentZkMetadata = realtimeSegmentZKMetadata;\n-        }\n+        minStartTimeMs = Math.min(minStartTimeMs, realtimeSegmentZKMetadata.getStartTimeMs());\n       }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a38db3231b296cfcaae4bdfd9ff501c4f21b41b5"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgyNTgwNg==", "bodyText": "It's not really possible with the current code, but added it in case the code changes in the future", "url": "https://github.com/apache/pinot/pull/6239#discussion_r520825806", "createdAt": "2020-11-10T19:37:49Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/minion/generator/RealtimeToOfflineSegmentsTaskGenerator.java", "diffHunk": "@@ -287,21 +284,14 @@ private long getWatermarkMs(String realtimeTableName, List<LLCRealtimeSegmentZKM\n       long watermarkMs;\n \n       // Find the smallest time from all segments\n-      RealtimeSegmentZKMetadata minSegmentZkMetadata = null;\n+      long minStartTimeMs = Long.MAX_VALUE;\n       for (LLCRealtimeSegmentZKMetadata realtimeSegmentZKMetadata : completedSegmentsMetadata) {\n-        if (minSegmentZkMetadata == null || realtimeSegmentZKMetadata.getStartTime() < minSegmentZkMetadata\n-            .getStartTime()) {\n-          minSegmentZkMetadata = realtimeSegmentZKMetadata;\n-        }\n+        minStartTimeMs = Math.min(minStartTimeMs, realtimeSegmentZKMetadata.getStartTimeMs());\n       }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk0ODU4NQ=="}, "originalCommit": {"oid": "a38db3231b296cfcaae4bdfd9ff501c4f21b41b5"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3099, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}