{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNzc1NTIy", "number": 5175, "title": "add pinot upsert features to pinot common", "bodyText": "This diff will create necessary pinot schema/constant value changes to support pinot upsert features.\nThe following will be changed:\n\nadd IngestionModeConfig field to schema and table definition:\nThis field will contains several sub-fields:\na. ingestionMode:\ningestion mode could be either upsert/append.\nb. primaryKeys:\na list of string that indicate which columns would be use as primary key of the current upsert table. However we are going to enforce primary key to be one only only one column. In the future we can explore the support for multiple primary keys\nc. offsetKey:\na string that indicate which column would be use as offset of the current pinot upsert table.\n\ndesign doc for pinot upsert feature:\nhttps://cwiki.apache.org/confluence/display/PINOT/%5BProposal%5D+Pinot+upsert+design+doc\nthis change focus on the changes in pinot common repo", "createdAt": "2020-03-24T04:55:17Z", "url": "https://github.com/apache/pinot/pull/5175", "merged": true, "mergeCommit": {"oid": "22865e6dbd0f90674b1bd2172002e7cbd9373823"}, "closed": true, "closedAt": "2020-04-24T21:39:35Z", "author": {"login": "jamesyfshao"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQrZtOAH2gAyMzkyNzc1NTIyOjcyM2YwOGFhMTIwNzRmODNhYzMxZmRmZTA5YjhkYzFmMDI1NGY5NDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABca33VgAFqTQwMDI2MzUxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/723f08aa12074f83ac31fdfe09b8dc1f0254f942", "committedDate": "2020-03-24T04:42:52Z", "message": "update pinot upsert features to pinot common"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDAzNjUw", "url": "https://github.com/apache/pinot/pull/5175#pullrequestreview-380003650", "createdAt": "2020-03-24T05:10:35Z", "commit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNToxMDozNVrOF6hLgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNTo0OTo0NVrOF6hxJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNTM0NA==", "bodyText": "rename to IngestMode or just have a boolean enableUpsert?", "url": "https://github.com/apache/pinot/pull/5175#discussion_r396905344", "createdAt": "2020-03-24T05:10:35Z", "author": {"login": "kishoreg"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/config/TableConfig.java", "diffHunk": "@@ -75,6 +79,9 @@\n   private Map<InstancePartitionsType, InstanceAssignmentConfig> _instanceAssignmentConfigMap;\n   private List<FieldConfig> _fieldConfigList;\n \n+  @JsonPropertyDescription(value = \"The update semantic of the table, either append or upsert, default as append\")\n+  private UpdateSemantic _updateSemantic;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNTgwMQ==", "bodyText": "where is this used?", "url": "https://github.com/apache/pinot/pull/5175#discussion_r396905801", "createdAt": "2020-03-24T05:12:33Z", "author": {"login": "kishoreg"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/config/TableNameBuilder.java", "diffHunk": "@@ -132,4 +132,19 @@ public static boolean isOfflineTableResource(String resourceName) {\n   public static boolean isRealtimeTableResource(String resourceName) {\n     return REALTIME.tableHasTypeSuffix(resourceName);\n   }\n+\n+  /**\n+   * ensure that table name ends with type info, if no, create one with the given type\n+   * @param tableName the name of the table\n+   * @param type the type of the table for it to fill in if the type info is missing\n+   * @return the table type name with the type info\n+   */\n+  public static String ensureTableNameWithType(String tableName, TableType type) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNjAwNg==", "bodyText": "what does this represent?", "url": "https://github.com/apache/pinot/pull/5175#discussion_r396906006", "createdAt": "2020-03-24T05:13:21Z", "author": {"login": "kishoreg"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/metrics/BrokerGauge.java", "diffHunk": "@@ -26,7 +26,8 @@\n  *\n  */\n public enum BrokerGauge implements AbstractMetrics.Gauge {\n-  QUERY_QUOTA_CAPACITY_UTILIZATION_RATE(\"tables\", false), NETTY_CONNECTION_CONNECT_TIME_MS(\"nettyConnection\", true);\n+  QUERY_QUOTA_CAPACITY_UTILIZATION_RATE(\"tables\", false), NETTY_CONNECTION_CONNECT_TIME_MS(\"nettyConnection\", true),\n+  TABLE_MIN_LOW_WATER_MARK(\"tables\", false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNzc3Mw==", "bodyText": "what if the primary key is made up of two columns?", "url": "https://github.com/apache/pinot/pull/5175#discussion_r396907773", "createdAt": "2020-03-24T05:21:20Z", "author": {"login": "kishoreg"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/Schema.java", "diffHunk": "@@ -59,13 +65,28 @@\n   private static final Logger LOGGER = LoggerFactory.getLogger(Schema.class);\n \n   private String _schemaName;\n+\n+  // upsert related config\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private String _primaryKey;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxMzc3Mg==", "bodyText": "or multiple", "url": "https://github.com/apache/pinot/pull/5175#discussion_r396913772", "createdAt": "2020-03-24T05:45:00Z", "author": {"login": "kishoreg"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/Schema.java", "diffHunk": "@@ -59,13 +65,28 @@\n   private static final Logger LOGGER = LoggerFactory.getLogger(Schema.class);\n \n   private String _schemaName;\n+\n+  // upsert related config\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private String _primaryKey;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNzc3Mw=="}, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxNDM1OQ==", "bodyText": "do we need all these things in Schema? What if we create a UpsertConfig in TableConfig to provide all the necessary information.", "url": "https://github.com/apache/pinot/pull/5175#discussion_r396914359", "createdAt": "2020-03-24T05:47:19Z", "author": {"login": "kishoreg"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/Schema.java", "diffHunk": "@@ -59,13 +65,28 @@\n   private static final Logger LOGGER = LoggerFactory.getLogger(Schema.class);\n \n   private String _schemaName;\n+\n+  // upsert related config\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private String _primaryKey;\n+  // offset key refers to the column name that we are going to store the offset value to\n+  private String _offsetKey;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxNDc2Mw==", "bodyText": "why is this needed? it will be great if we can avoid static methods in config objects. We can probably move this SchemaUtil", "url": "https://github.com/apache/pinot/pull/5175#discussion_r396914763", "createdAt": "2020-03-24T05:48:52Z", "author": {"login": "kishoreg"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/Schema.java", "diffHunk": "@@ -631,4 +751,50 @@ public int hashCode() {\n     result = EqualityUtils.hashCodeOf(result, _dateTimeFieldSpecs);\n     return result;\n   }\n+\n+  public boolean isVirtualColumn(String columnName) {\n+    return columnName.startsWith(\"$\") || (getFieldSpecFor(columnName).getVirtualColumnProvider() != null\n+        && !getFieldSpecFor(columnName).getVirtualColumnProvider().isEmpty());\n+  }\n+\n+\n+  @JsonIgnore\n+  public static byte[] getByteArrayFromField(Object value, DimensionFieldSpec fieldSpec) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 209}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxNDk4Mw==", "bodyText": "Do we need this at compile time?", "url": "https://github.com/apache/pinot/pull/5175#discussion_r396914983", "createdAt": "2020-03-24T05:49:45Z", "author": {"login": "kishoreg"}, "path": "pom.xml", "diffHunk": "@@ -132,6 +132,9 @@\n     <log4j.version>2.11.2</log4j.version>\n     <netty.version>4.1.42.Final</netty.version>\n \n+    <!-- dependency for upsert component -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNTY1OTU3", "url": "https://github.com/apache/pinot/pull/5175#pullrequestreview-380565957", "createdAt": "2020-03-24T18:00:25Z", "commit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODowMDoyNVrOF68qRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODoxMDo1MFrOF69DSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM1NTU5MA==", "bodyText": "Wrong import", "url": "https://github.com/apache/pinot/pull/5175#discussion_r397355590", "createdAt": "2020-03-24T18:00:25Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/config/TableConfig.java", "diffHunk": "@@ -30,17 +30,21 @@\n import java.util.List;\n import java.util.Map;\n import javax.annotation.Nullable;\n+import javax.validation.constraints.Null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM1ODAwNA==", "bodyText": "This can cause NPE", "url": "https://github.com/apache/pinot/pull/5175#discussion_r397358004", "createdAt": "2020-03-24T18:04:11Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/config/TableConfig.java", "diffHunk": "@@ -354,6 +387,7 @@ public ZNRecord toZNRecord()\n     }\n \n     ZNRecord znRecord = new ZNRecord(_tableName);\n+    simpleFields.put(UPDATE_SEMANTIC_CONFIG_KEY, _updateSemantic.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MDIzMw==", "bodyText": "Is this for real-time? We already have push type of either APPEND or REFRESH for offline; aggregateMetrics for real-time. What does UPSERT stand for?", "url": "https://github.com/apache/pinot/pull/5175#discussion_r397360233", "createdAt": "2020-03-24T18:08:01Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/config/TableConfig.java", "diffHunk": "@@ -75,6 +79,9 @@\n   private Map<InstancePartitionsType, InstanceAssignmentConfig> _instanceAssignmentConfigMap;\n   private List<FieldConfig> _fieldConfigList;\n \n+  @JsonPropertyDescription(value = \"The update semantic of the table, either append or upsert, default as append\")\n+  private UpdateSemantic _updateSemantic;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNTM0NA=="}, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MTY5Mg==", "bodyText": "Please use TableNameBuilder.forType(type).tableNameWithType(tableName)", "url": "https://github.com/apache/pinot/pull/5175#discussion_r397361692", "createdAt": "2020-03-24T18:10:21Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/config/TableNameBuilder.java", "diffHunk": "@@ -132,4 +132,19 @@ public static boolean isOfflineTableResource(String resourceName) {\n   public static boolean isRealtimeTableResource(String resourceName) {\n     return REALTIME.tableHasTypeSuffix(resourceName);\n   }\n+\n+  /**\n+   * ensure that table name ends with type info, if no, create one with the given type\n+   * @param tableName the name of the table\n+   * @param type the type of the table for it to fill in if the type info is missing\n+   * @return the table type name with the type info\n+   */\n+  public static String ensureTableNameWithType(String tableName, TableType type) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkwNTgwMQ=="}, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2MTk5NA==", "bodyText": "Wrong order, please revert", "url": "https://github.com/apache/pinot/pull/5175#discussion_r397361994", "createdAt": "2020-03-24T18:10:50Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/metrics/AbstractMetrics.java", "diffHunk": "@@ -21,16 +21,17 @@\n import com.google.common.annotations.VisibleForTesting;\n import com.yammer.metrics.core.MetricName;\n import com.yammer.metrics.core.MetricsRegistry;\n+import org.apache.pinot.common.Utils;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "723f08aa12074f83ac31fdfe09b8dc1f0254f942"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c3120146aed820387734b946f6ee32ac01411d7", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/5c3120146aed820387734b946f6ee32ac01411d7", "committedDate": "2020-03-25T02:39:36Z", "message": "frst update per cr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0f4fba2808b036d9a725deac9cad14b182b6bb2", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/a0f4fba2808b036d9a725deac9cad14b182b6bb2", "committedDate": "2020-03-31T01:13:29Z", "message": "adjust how schema work for upsert"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MDQ3NTU3", "url": "https://github.com/apache/pinot/pull/5175#pullrequestreview-386047557", "createdAt": "2020-04-02T01:04:13Z", "commit": {"oid": "a0f4fba2808b036d9a725deac9cad14b182b6bb2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwMTowNDoxM1rOF_X4-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwMTowNTowNFrOF_X56Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk5NjAyNw==", "bodyText": "Can we change the name of this class like I had suggested before?", "url": "https://github.com/apache/pinot/pull/5175#discussion_r401996027", "createdAt": "2020-04-02T01:04:13Z", "author": {"login": "mcvsubbu"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/CommonConstants.java", "diffHunk": "@@ -308,6 +320,23 @@ public ServerType getServerType() {\n     public static final String PREFIX_OF_CONFIG_OF_PINOT_CRYPTER = \"crypter\";\n   }\n \n+  public static class Grigio {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0f4fba2808b036d9a725deac9cad14b182b6bb2"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk5NjI2NQ==", "bodyText": "Please add comments on each of these. What does APPEND mean, vs what UPSERT means. Feel free to point to the design doc", "url": "https://github.com/apache/pinot/pull/5175#discussion_r401996265", "createdAt": "2020-04-02T01:05:04Z", "author": {"login": "mcvsubbu"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/CommonConstants.java", "diffHunk": "@@ -378,4 +407,23 @@ public ServerType getServerType() {\n     @Deprecated\n     public static final String TABLE_NAME = \"segment.table.name\";\n   }\n+\n+  public enum UpdateSemantic {\n+    APPEND,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a0f4fba2808b036d9a725deac9cad14b182b6bb2"}, "originalPosition": 79}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "553598e18953a0c5bc4b4ffad43c5e926ae03285", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/553598e18953a0c5bc4b4ffad43c5e926ae03285", "committedDate": "2020-04-02T21:38:39Z", "message": "enable multiple primary key support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2OTY0NjQ1", "url": "https://github.com/apache/pinot/pull/5175#pullrequestreview-386964645", "createdAt": "2020-04-03T06:27:04Z", "commit": {"oid": "553598e18953a0c5bc4b4ffad43c5e926ae03285"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNjoyNzowNVrOGAGmmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNjoyNzowNVrOGAGmmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc2MTM3MQ==", "bodyText": "let's avoid adding additional utility methods to config classes if possible", "url": "https://github.com/apache/pinot/pull/5175#discussion_r402761371", "createdAt": "2020-04-03T06:27:05Z", "author": {"login": "kishoreg"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/config/TableConfig.java", "diffHunk": "@@ -470,6 +505,18 @@ public void setInstanceAssignmentConfigMap(\n     return _fieldConfigList;\n   }\n \n+  public UpdateSemantic getUpdateSemantic() {\n+    return _updateSemantic;\n+  }\n+\n+  public void setUpdateSemantic(UpdateSemantic updateSemantic) {\n+    _updateSemantic = updateSemantic;\n+  }\n+\n+  public boolean isTableForUpsert() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "553598e18953a0c5bc4b4ffad43c5e926ae03285"}, "originalPosition": 120}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5306aa567037e4b7ca4f6f807c61974afcc68f36", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/5306aa567037e4b7ca4f6f807c61974afcc68f36", "committedDate": "2020-04-09T21:50:53Z", "message": "move upsert config mostly to table config now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17801a29868499bb77be93d3e2abae4f4e1875b6", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/17801a29868499bb77be93d3e2abae4f4e1875b6", "committedDate": "2020-04-17T04:16:26Z", "message": "add validFrom & validUntil definition to upsert table config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7c8047584fcb400ff6d6fa95f14123acddd1473", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/e7c8047584fcb400ff6d6fa95f14123acddd1473", "committedDate": "2020-04-17T04:34:50Z", "message": "update table config per meeting feedback, move other pinot common diff to later diff to ensure better review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/d78868093be43c4d117c4ece5b976f0781df16fc", "committedDate": "2020-04-17T05:26:39Z", "message": "Merge remote-tracking branch 'upstream/master' into upsert-pr-land"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NjU5NDUy", "url": "https://github.com/apache/pinot/pull/5175#pullrequestreview-395659452", "createdAt": "2020-04-17T17:55:08Z", "commit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "state": "COMMENTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNzo1NTowOVrOGHXqpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxODowNTowMVrOGHX_Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4MDk2NQ==", "bodyText": "Can we call this UpsertConfig?", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410380965", "createdAt": "2020-04-17T17:55:09Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4MjQyNg==", "bodyText": "Can we avoid adding this for now? We can treat the presence of UpsertConfig as enabling upsert for Reatltime-only use cases (that you are handling now). It is therefore implied that the table push style is APPEND.\nIf, in future, we add multiple types of handling upserts, we can always add an enum (", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410382426", "createdAt": "2020-04-17T17:57:54Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4Mjg5Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private List<String> _primaryKeys;\n          \n          \n            \n              private List<String> _primaryKeyColumns;", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410382893", "createdAt": "2020-04-17T17:58:47Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private List<String> _primaryKeys;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4MzA4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private String _offsetKey;\n          \n          \n            \n              private String _offsetColumn;", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410383081", "createdAt": "2020-04-17T17:59:06Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private List<String> _primaryKeys;\n+  // offset key refers to the column name that we are going to store the offset value to\n+  private String _offsetKey;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4MzIzNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private String _validFromKey;\n          \n          \n            \n              private String _validFromColumn;", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410383235", "createdAt": "2020-04-17T17:59:24Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private List<String> _primaryKeys;\n+  // offset key refers to the column name that we are going to store the offset value to\n+  private String _offsetKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validFromKey;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4MzMzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private String _validUntilKey;\n          \n          \n            \n              private String _validUntilColumn;", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410383337", "createdAt": "2020-04-17T17:59:35Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private List<String> _primaryKeys;\n+  // offset key refers to the column name that we are going to store the offset value to\n+  private String _offsetKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validFromKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validUntilKey;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4MzU3MQ==", "bodyText": "we should not need these two for now", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410383571", "createdAt": "2020-04-17T18:00:01Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private List<String> _primaryKeys;\n+  // offset key refers to the column name that we are going to store the offset value to\n+  private String _offsetKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validFromKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validUntilKey;\n+\n+  public static final String UPSERT_TABLE_CONFIG_VALUE = \"upsert\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4NDA0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      \"pinot upsert require one and only one primary key\");\n          \n          \n            \n                      \"Upsert feature supports only one primary key\");", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410384041", "createdAt": "2020-04-17T18:00:59Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private List<String> _primaryKeys;\n+  // offset key refers to the column name that we are going to store the offset value to\n+  private String _offsetKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validFromKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validUntilKey;\n+\n+  public static final String UPSERT_TABLE_CONFIG_VALUE = \"upsert\";\n+  public static final String APPEND_TABLE_CONFIG_VALUE = \"append\";\n+\n+  public static final IngestionModeConfig DEFAULT_APPEND_INGESTION_MODE =\n+      new IngestionModeConfig(APPEND_TABLE_CONFIG_VALUE, null, null, null,\n+          null);\n+\n+  @JsonCreator\n+  public IngestionModeConfig(\n+      @JsonProperty(value=\"ingestionMode\") @Nullable String ingestionMode,\n+      @JsonProperty(value=\"primaryKeys\") @Nullable List<String> primaryKeys,\n+      @JsonProperty(value=\"offsetKey\") @Nullable String offsetKey,\n+      @JsonProperty(value=\"validFromKey\") @Nullable String validFromKey,\n+      @JsonProperty(value=\"validUntilKey\") @Nullable String validUntilKey) {\n+    if (StringUtils.isEmpty(ingestionMode)) {\n+      _ingestionMode = APPEND_TABLE_CONFIG_VALUE;\n+    } else {\n+      _ingestionMode = ingestionMode.toLowerCase();\n+    }\n+    if (primaryKeys == null) {\n+      _primaryKeys = ImmutableList.of();\n+    } else {\n+      _primaryKeys = primaryKeys;\n+    }\n+    _offsetKey = offsetKey;\n+    _validFromKey = validFromKey;\n+    _validUntilKey = validUntilKey;\n+\n+    if (UPSERT_TABLE_CONFIG_VALUE.equals(_ingestionMode)) {\n+      Preconditions.checkState(_primaryKeys.size() == 1,\n+          \"pinot upsert require one and only one primary key\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4NDQ5NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      \"pinot upsert require one offset key\");\n          \n          \n            \n                      \"Upsert feature requires \\\"offsetColumn\\\" to be set\");", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410384495", "createdAt": "2020-04-17T18:01:57Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private List<String> _primaryKeys;\n+  // offset key refers to the column name that we are going to store the offset value to\n+  private String _offsetKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validFromKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validUntilKey;\n+\n+  public static final String UPSERT_TABLE_CONFIG_VALUE = \"upsert\";\n+  public static final String APPEND_TABLE_CONFIG_VALUE = \"append\";\n+\n+  public static final IngestionModeConfig DEFAULT_APPEND_INGESTION_MODE =\n+      new IngestionModeConfig(APPEND_TABLE_CONFIG_VALUE, null, null, null,\n+          null);\n+\n+  @JsonCreator\n+  public IngestionModeConfig(\n+      @JsonProperty(value=\"ingestionMode\") @Nullable String ingestionMode,\n+      @JsonProperty(value=\"primaryKeys\") @Nullable List<String> primaryKeys,\n+      @JsonProperty(value=\"offsetKey\") @Nullable String offsetKey,\n+      @JsonProperty(value=\"validFromKey\") @Nullable String validFromKey,\n+      @JsonProperty(value=\"validUntilKey\") @Nullable String validUntilKey) {\n+    if (StringUtils.isEmpty(ingestionMode)) {\n+      _ingestionMode = APPEND_TABLE_CONFIG_VALUE;\n+    } else {\n+      _ingestionMode = ingestionMode.toLowerCase();\n+    }\n+    if (primaryKeys == null) {\n+      _primaryKeys = ImmutableList.of();\n+    } else {\n+      _primaryKeys = primaryKeys;\n+    }\n+    _offsetKey = offsetKey;\n+    _validFromKey = validFromKey;\n+    _validUntilKey = validUntilKey;\n+\n+    if (UPSERT_TABLE_CONFIG_VALUE.equals(_ingestionMode)) {\n+      Preconditions.checkState(_primaryKeys.size() == 1,\n+          \"pinot upsert require one and only one primary key\");\n+      Preconditions.checkState(StringUtils.isNotEmpty(_offsetKey),\n+          \"pinot upsert require one offset key\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4NTY2NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      \"pinot upsert require one validFrom key\");\n          \n          \n            \n                      \"Upsert feature requires \\\"validFromColumn\\\" to be set\");", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410385665", "createdAt": "2020-04-17T18:04:04Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private List<String> _primaryKeys;\n+  // offset key refers to the column name that we are going to store the offset value to\n+  private String _offsetKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validFromKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validUntilKey;\n+\n+  public static final String UPSERT_TABLE_CONFIG_VALUE = \"upsert\";\n+  public static final String APPEND_TABLE_CONFIG_VALUE = \"append\";\n+\n+  public static final IngestionModeConfig DEFAULT_APPEND_INGESTION_MODE =\n+      new IngestionModeConfig(APPEND_TABLE_CONFIG_VALUE, null, null, null,\n+          null);\n+\n+  @JsonCreator\n+  public IngestionModeConfig(\n+      @JsonProperty(value=\"ingestionMode\") @Nullable String ingestionMode,\n+      @JsonProperty(value=\"primaryKeys\") @Nullable List<String> primaryKeys,\n+      @JsonProperty(value=\"offsetKey\") @Nullable String offsetKey,\n+      @JsonProperty(value=\"validFromKey\") @Nullable String validFromKey,\n+      @JsonProperty(value=\"validUntilKey\") @Nullable String validUntilKey) {\n+    if (StringUtils.isEmpty(ingestionMode)) {\n+      _ingestionMode = APPEND_TABLE_CONFIG_VALUE;\n+    } else {\n+      _ingestionMode = ingestionMode.toLowerCase();\n+    }\n+    if (primaryKeys == null) {\n+      _primaryKeys = ImmutableList.of();\n+    } else {\n+      _primaryKeys = primaryKeys;\n+    }\n+    _offsetKey = offsetKey;\n+    _validFromKey = validFromKey;\n+    _validUntilKey = validUntilKey;\n+\n+    if (UPSERT_TABLE_CONFIG_VALUE.equals(_ingestionMode)) {\n+      Preconditions.checkState(_primaryKeys.size() == 1,\n+          \"pinot upsert require one and only one primary key\");\n+      Preconditions.checkState(StringUtils.isNotEmpty(_offsetKey),\n+          \"pinot upsert require one offset key\");\n+      Preconditions.checkState(StringUtils.isNotEmpty(_validFromKey),\n+          \"pinot upsert require one validFrom key\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4NTc3OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      \"pinot upsert require one validUntil key\");\n          \n          \n            \n                      \"Upsert feature requires \\\"validUntilColumn\\\"  to be set\");", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410385779", "createdAt": "2020-04-17T18:04:15Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private List<String> _primaryKeys;\n+  // offset key refers to the column name that we are going to store the offset value to\n+  private String _offsetKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validFromKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validUntilKey;\n+\n+  public static final String UPSERT_TABLE_CONFIG_VALUE = \"upsert\";\n+  public static final String APPEND_TABLE_CONFIG_VALUE = \"append\";\n+\n+  public static final IngestionModeConfig DEFAULT_APPEND_INGESTION_MODE =\n+      new IngestionModeConfig(APPEND_TABLE_CONFIG_VALUE, null, null, null,\n+          null);\n+\n+  @JsonCreator\n+  public IngestionModeConfig(\n+      @JsonProperty(value=\"ingestionMode\") @Nullable String ingestionMode,\n+      @JsonProperty(value=\"primaryKeys\") @Nullable List<String> primaryKeys,\n+      @JsonProperty(value=\"offsetKey\") @Nullable String offsetKey,\n+      @JsonProperty(value=\"validFromKey\") @Nullable String validFromKey,\n+      @JsonProperty(value=\"validUntilKey\") @Nullable String validUntilKey) {\n+    if (StringUtils.isEmpty(ingestionMode)) {\n+      _ingestionMode = APPEND_TABLE_CONFIG_VALUE;\n+    } else {\n+      _ingestionMode = ingestionMode.toLowerCase();\n+    }\n+    if (primaryKeys == null) {\n+      _primaryKeys = ImmutableList.of();\n+    } else {\n+      _primaryKeys = primaryKeys;\n+    }\n+    _offsetKey = offsetKey;\n+    _validFromKey = validFromKey;\n+    _validUntilKey = validUntilKey;\n+\n+    if (UPSERT_TABLE_CONFIG_VALUE.equals(_ingestionMode)) {\n+      Preconditions.checkState(_primaryKeys.size() == 1,\n+          \"pinot upsert require one and only one primary key\");\n+      Preconditions.checkState(StringUtils.isNotEmpty(_offsetKey),\n+          \"pinot upsert require one offset key\");\n+      Preconditions.checkState(StringUtils.isNotEmpty(_validFromKey),\n+          \"pinot upsert require one validFrom key\");\n+      Preconditions.checkState(StringUtils.isNotEmpty(_validUntilKey),\n+          \"pinot upsert require one validUntil key\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4NjIwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public static final String INGESTION_MODE_CONFIG_KEY = \"ingestionModeConfig\";\n          \n          \n            \n              public static final String UPSERT_CONFIG_KEY = \"upsertConfig\";", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410386203", "createdAt": "2020-04-17T18:05:01Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/TableConfig.java", "diffHunk": "@@ -44,6 +45,7 @@\n   public static final String QUERY_CONFIG_KEY = \"query\";\n   public static final String INSTANCE_ASSIGNMENT_CONFIG_MAP_KEY = \"instanceAssignmentConfigMap\";\n   public static final String FIELD_CONFIG_LIST_KEY = \"fieldConfigList\";\n+  public static final String INGESTION_MODE_CONFIG_KEY = \"ingestionModeConfig\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODA4Nzk0", "url": "https://github.com/apache/pinot/pull/5175#pullrequestreview-395808794", "createdAt": "2020-04-17T22:31:30Z", "commit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjozMTozMVrOGHe75w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjozNToyN1rOGHfAIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwMDA3MQ==", "bodyText": "+1. I think this config is only for upsert feature, and not applicable for general ingestion. When this config exist, we can assume the upsert feature is on.", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410500071", "createdAt": "2020-04-17T22:31:31Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4MDk2NQ=="}, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwMDYwMw==", "bodyText": "Also, please extends BaseJsonConfig, which handles the Json ser-de and common methods like hashCode(), equals() and toString(). You can refer to RoutingConfig which is similar to this one.", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410500603", "createdAt": "2020-04-17T22:33:33Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4MDk2NQ=="}, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwMDk3MA==", "bodyText": "+1. You can also make it final. Same for other places", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410500970", "createdAt": "2020-04-17T22:34:45Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private List<String> _primaryKeys;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDM4Mjg5Mw=="}, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwMTE1NQ==", "bodyText": "If this config is for upsert only, I think all arguments are required", "url": "https://github.com/apache/pinot/pull/5175#discussion_r410501155", "createdAt": "2020-04-17T22:35:27Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/IngestionModeConfig.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class IngestionModeConfig {\n+  // new config key to indicate if a table is for upsert. If this is define as upsert, it would be an upsert table\n+  // for other value it would be append value for now\n+  private String _ingestionMode;\n+  // primary key refers to the column name that is the primary key of this upsert table\n+  private List<String> _primaryKeys;\n+  // offset key refers to the column name that we are going to store the offset value to\n+  private String _offsetKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validFromKey;\n+  // validFrom key refers to the column name that we are going to store the validFrom value to\n+  private String _validUntilKey;\n+\n+  public static final String UPSERT_TABLE_CONFIG_VALUE = \"upsert\";\n+  public static final String APPEND_TABLE_CONFIG_VALUE = \"append\";\n+\n+  public static final IngestionModeConfig DEFAULT_APPEND_INGESTION_MODE =\n+      new IngestionModeConfig(APPEND_TABLE_CONFIG_VALUE, null, null, null,\n+          null);\n+\n+  @JsonCreator\n+  public IngestionModeConfig(\n+      @JsonProperty(value=\"ingestionMode\") @Nullable String ingestionMode,\n+      @JsonProperty(value=\"primaryKeys\") @Nullable List<String> primaryKeys,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d78868093be43c4d117c4ece5b976f0781df16fc"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9695773720de6761bb705c3fbd6c30a82280ee7", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/c9695773720de6761bb705c3fbd6c30a82280ee7", "committedDate": "2020-04-22T05:11:24Z", "message": "update per pr feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "729f377833de2edba3af761ccbf581d02b3b2247", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/729f377833de2edba3af761ccbf581d02b3b2247", "committedDate": "2020-04-22T05:24:52Z", "message": "Merge branch 'upstream-master' into upsert-pr-land"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f7ce4bdf5cca63337a4076834076351a0337fa2", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/0f7ce4bdf5cca63337a4076834076351a0337fa2", "committedDate": "2020-04-22T05:43:49Z", "message": "update docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NDYzODQ0", "url": "https://github.com/apache/pinot/pull/5175#pullrequestreview-398463844", "createdAt": "2020-04-22T18:27:40Z", "commit": {"oid": "0f7ce4bdf5cca63337a4076834076351a0337fa2"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxODoyNzo0MFrOGKE3Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxODozNDowNlrOGKFIYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzIxODYzNQ==", "bodyText": "(nit) extra empty line", "url": "https://github.com/apache/pinot/pull/5175#discussion_r413218635", "createdAt": "2020-04-22T18:27:40Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/config/TableConfigUtils.java", "diffHunk": "@@ -116,8 +117,16 @@ public static TableConfig fromZNRecord(ZNRecord znRecord)\n       });\n     }\n \n+    UpsertConfig upsertConfig = null;\n+    String upsertConfigString = simpleFields.get(TableConfig.UPSERT_CONFIG_KEY);\n+    if (upsertConfigString != null) {\n+      upsertConfig = JsonUtils.stringToObject(upsertConfigString, UpsertConfig.class);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7ce4bdf5cca63337a4076834076351a0337fa2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzIxOTA1OQ==", "bodyText": "Prefer using Collections.singletonList()", "url": "https://github.com/apache/pinot/pull/5175#discussion_r413219059", "createdAt": "2020-04-22T18:28:17Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/test/java/org/apache/pinot/common/utils/config/TableConfigSerDeTest.java", "diffHunk": "@@ -231,6 +234,17 @@ public void testSerDe()\n       assertEquals(tableConfigToCompare, tableConfig);\n       checkFieldConfig(tableConfigToCompare);\n     }\n+    {\n+      // with upsert config\n+      UpsertConfig upsertConfig = new UpsertConfig(ImmutableList.of(\"pk\"), \"offset\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7ce4bdf5cca63337a4076834076351a0337fa2"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzIyMjE2Mg==", "bodyText": "Can you make this similar to other config check? Pass in a  table config and check the actual value inside the config. Then serialize and deserialize (both string and ZNRecord) and check again", "url": "https://github.com/apache/pinot/pull/5175#discussion_r413222162", "createdAt": "2020-04-22T18:32:50Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/test/java/org/apache/pinot/common/utils/config/TableConfigSerDeTest.java", "diffHunk": "@@ -367,4 +381,12 @@ private void checkFieldConfig(TableConfig tableConfig) {\n     assertNull(secondFieldConfig.getIndexType());\n     assertNull(secondFieldConfig.getProperties());\n   }\n+\n+  private void checkTableConfigWithUpsertConfig(TableConfig tableConfig, TableConfig tableConfigToCompare) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7ce4bdf5cca63337a4076834076351a0337fa2"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzIyMzAwOQ==", "bodyText": "(nit) empty line", "url": "https://github.com/apache/pinot/pull/5175#discussion_r413223009", "createdAt": "2020-04-22T18:34:06Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/test/java/org/apache/pinot/spi/config/UpsertConfigTest.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+import com.google.common.collect.ImmutableList;\n+import org.testng.annotations.Test;\n+\n+import static org.testng.Assert.*;\n+\n+public class UpsertConfigTest {\n+\n+  @Test\n+  public void testUpsertConfig() {\n+    UpsertConfig upsertConfig;\n+\n+    // test regular upsert table\n+    upsertConfig = new UpsertConfig(ImmutableList.of(\"primaryKey\"), \"offset\", \"validFrom\",\n+        \"validUntil\");\n+    assertEquals(1, upsertConfig.getPrimaryKeyColumns().size());\n+    assertEquals(\"primaryKey\", upsertConfig.getPrimaryKeyColumns().get(0));\n+    assertEquals(\"offset\", upsertConfig.getOffsetColumn());\n+    assertEquals(\"validFrom\", upsertConfig.getValidFromColumn());\n+    assertEquals(\"validUntil\", upsertConfig.getValidUntilColumn());\n+\n+    // test sanity check\n+    try {\n+      upsertConfig = new UpsertConfig(null,\n+          \"offset\", \"validFrom\", \"validUntil\");\n+      fail();\n+    } catch (RuntimeException ex) {}\n+\n+    try {\n+      upsertConfig = new UpsertConfig(ImmutableList.of(\"pk1\", \"pk2\"),\n+          \"offset\", \"validFrom\", \"validUntil\");\n+      fail();\n+    } catch (RuntimeException ex) {}\n+\n+    try {\n+      upsertConfig = new UpsertConfig(ImmutableList.of(\"pk1\"),\n+          null, \"validFrom\", \"validUntil\");\n+      fail();\n+    } catch (RuntimeException ex) {}\n+\n+    try {\n+      upsertConfig = new UpsertConfig(ImmutableList.of(\"pk1\"),\n+          \"offset\", null, \"validUntil\");\n+      fail();\n+    } catch (RuntimeException ex) {}\n+\n+    try {\n+      upsertConfig = new UpsertConfig(ImmutableList.of(\"pk1\"),\n+          \"offset\", \"validFrom\", null);\n+      fail();\n+    } catch (RuntimeException ex) {}\n+  }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f7ce4bdf5cca63337a4076834076351a0337fa2"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4f4f464d820127e4b03c78da76783b0febdc93f", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/f4f4f464d820127e4b03c78da76783b0febdc93f", "committedDate": "2020-04-23T20:29:40Z", "message": "more update per feedback and fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5fd4b9dea816cea973e6ceaf19462a170af207b", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/a5fd4b9dea816cea973e6ceaf19462a170af207b", "committedDate": "2020-04-23T21:41:38Z", "message": "more doc, and trigger build again to see if it fixed tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMTk1OTk3", "url": "https://github.com/apache/pinot/pull/5175#pullrequestreview-400195997", "createdAt": "2020-04-24T18:56:08Z", "commit": {"oid": "a5fd4b9dea816cea973e6ceaf19462a170af207b"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODo1NjowOFrOGLlDMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODo1Njo1OFrOGLlFBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc5NDU0Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"upsert feature support only one primary key column\");\n          \n          \n            \n                    \"Upsert feature supports only one primary key column\");", "url": "https://github.com/apache/pinot/pull/5175#discussion_r414794546", "createdAt": "2020-04-24T18:56:08Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/UpsertConfig.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class UpsertConfig extends BaseJsonConfig {\n+  // names of the columns that used as primary keys of an upsert table\n+  private final List<String> _primaryKeyColumns;\n+  // name of the column that we are going to store the offset value to\n+  private final String _offsetColumn;\n+  // name of the virtual column that we are going to store the validFrom value to\n+  private final String _validFromColumn;\n+  // name of the virtual column that we are going to store the validUntil value to\n+  private final String _validUntilColumn;\n+\n+  @JsonCreator\n+  public UpsertConfig(\n+      @JsonProperty(value=\"primaryKeyColumns\") List<String> primaryKeyColumns,\n+      @JsonProperty(value=\"offsetColumn\") String offsetColumn,\n+      @JsonProperty(value=\"validFromColumn\") String validFromColumn,\n+      @JsonProperty(value=\"validUntilColumn\") String validUntilColumn) {\n+\n+    _primaryKeyColumns = primaryKeyColumns;\n+    _offsetColumn = offsetColumn;\n+    _validFromColumn = validFromColumn;\n+    _validUntilColumn = validUntilColumn;\n+\n+    Preconditions.checkState(_primaryKeyColumns.size() == 1,\n+        \"upsert feature support only one primary key column\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5fd4b9dea816cea973e6ceaf19462a170af207b"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc5NDc0OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"upsert feature requires \\\"offsetColumn\\\" to be set \");\n          \n          \n            \n                    \"Upsert feature requires \\\"offsetColumn\\\" to be set \");", "url": "https://github.com/apache/pinot/pull/5175#discussion_r414794749", "createdAt": "2020-04-24T18:56:28Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/UpsertConfig.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class UpsertConfig extends BaseJsonConfig {\n+  // names of the columns that used as primary keys of an upsert table\n+  private final List<String> _primaryKeyColumns;\n+  // name of the column that we are going to store the offset value to\n+  private final String _offsetColumn;\n+  // name of the virtual column that we are going to store the validFrom value to\n+  private final String _validFromColumn;\n+  // name of the virtual column that we are going to store the validUntil value to\n+  private final String _validUntilColumn;\n+\n+  @JsonCreator\n+  public UpsertConfig(\n+      @JsonProperty(value=\"primaryKeyColumns\") List<String> primaryKeyColumns,\n+      @JsonProperty(value=\"offsetColumn\") String offsetColumn,\n+      @JsonProperty(value=\"validFromColumn\") String validFromColumn,\n+      @JsonProperty(value=\"validUntilColumn\") String validUntilColumn) {\n+\n+    _primaryKeyColumns = primaryKeyColumns;\n+    _offsetColumn = offsetColumn;\n+    _validFromColumn = validFromColumn;\n+    _validUntilColumn = validUntilColumn;\n+\n+    Preconditions.checkState(_primaryKeyColumns.size() == 1,\n+        \"upsert feature support only one primary key column\");\n+    Preconditions.checkState(StringUtils.isNotEmpty(_offsetColumn),\n+        \"upsert feature requires \\\"offsetColumn\\\" to be set \");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5fd4b9dea816cea973e6ceaf19462a170af207b"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc5NDgzMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"upsert feature requires \\\"validFromColumn\\\" to be set\");\n          \n          \n            \n                    \"Upsert feature requires \\\"validFromColumn\\\" to be set\");", "url": "https://github.com/apache/pinot/pull/5175#discussion_r414794830", "createdAt": "2020-04-24T18:56:38Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/UpsertConfig.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class UpsertConfig extends BaseJsonConfig {\n+  // names of the columns that used as primary keys of an upsert table\n+  private final List<String> _primaryKeyColumns;\n+  // name of the column that we are going to store the offset value to\n+  private final String _offsetColumn;\n+  // name of the virtual column that we are going to store the validFrom value to\n+  private final String _validFromColumn;\n+  // name of the virtual column that we are going to store the validUntil value to\n+  private final String _validUntilColumn;\n+\n+  @JsonCreator\n+  public UpsertConfig(\n+      @JsonProperty(value=\"primaryKeyColumns\") List<String> primaryKeyColumns,\n+      @JsonProperty(value=\"offsetColumn\") String offsetColumn,\n+      @JsonProperty(value=\"validFromColumn\") String validFromColumn,\n+      @JsonProperty(value=\"validUntilColumn\") String validUntilColumn) {\n+\n+    _primaryKeyColumns = primaryKeyColumns;\n+    _offsetColumn = offsetColumn;\n+    _validFromColumn = validFromColumn;\n+    _validUntilColumn = validUntilColumn;\n+\n+    Preconditions.checkState(_primaryKeyColumns.size() == 1,\n+        \"upsert feature support only one primary key column\");\n+    Preconditions.checkState(StringUtils.isNotEmpty(_offsetColumn),\n+        \"upsert feature requires \\\"offsetColumn\\\" to be set \");\n+    Preconditions.checkState(StringUtils.isNotEmpty(_validFromColumn),\n+        \"upsert feature requires \\\"validFromColumn\\\" to be set\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5fd4b9dea816cea973e6ceaf19462a170af207b"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc5NTAxNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"upsert feature requires \\\"validUntilColumn\\\" to be set\");\n          \n          \n            \n                    \"Upsert feature requires \\\"validUntilColumn\\\" to be set\");", "url": "https://github.com/apache/pinot/pull/5175#discussion_r414795014", "createdAt": "2020-04-24T18:56:58Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/UpsertConfig.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.lang.StringUtils;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@SuppressWarnings(\"unused\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+public class UpsertConfig extends BaseJsonConfig {\n+  // names of the columns that used as primary keys of an upsert table\n+  private final List<String> _primaryKeyColumns;\n+  // name of the column that we are going to store the offset value to\n+  private final String _offsetColumn;\n+  // name of the virtual column that we are going to store the validFrom value to\n+  private final String _validFromColumn;\n+  // name of the virtual column that we are going to store the validUntil value to\n+  private final String _validUntilColumn;\n+\n+  @JsonCreator\n+  public UpsertConfig(\n+      @JsonProperty(value=\"primaryKeyColumns\") List<String> primaryKeyColumns,\n+      @JsonProperty(value=\"offsetColumn\") String offsetColumn,\n+      @JsonProperty(value=\"validFromColumn\") String validFromColumn,\n+      @JsonProperty(value=\"validUntilColumn\") String validUntilColumn) {\n+\n+    _primaryKeyColumns = primaryKeyColumns;\n+    _offsetColumn = offsetColumn;\n+    _validFromColumn = validFromColumn;\n+    _validUntilColumn = validUntilColumn;\n+\n+    Preconditions.checkState(_primaryKeyColumns.size() == 1,\n+        \"upsert feature support only one primary key column\");\n+    Preconditions.checkState(StringUtils.isNotEmpty(_offsetColumn),\n+        \"upsert feature requires \\\"offsetColumn\\\" to be set \");\n+    Preconditions.checkState(StringUtils.isNotEmpty(_validFromColumn),\n+        \"upsert feature requires \\\"validFromColumn\\\" to be set\");\n+    Preconditions.checkState(StringUtils.isNotEmpty(_validUntilColumn),\n+        \"upsert feature requires \\\"validUntilColumn\\\" to be set\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5fd4b9dea816cea973e6ceaf19462a170af207b"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67c453042abfd21cdc45fa76a026035ea4adcb7b", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/67c453042abfd21cdc45fa76a026035ea4adcb7b", "committedDate": "2020-04-24T20:22:10Z", "message": "Update pinot-spi/src/main/java/org/apache/pinot/spi/config/UpsertConfig.java\n\nCo-Authored-By: Subbu Subramaniam <mcvsubbu@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97370a4ab3d7264df9fd7e8fd318a8f7d7651695", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/97370a4ab3d7264df9fd7e8fd318a8f7d7651695", "committedDate": "2020-04-24T20:22:48Z", "message": "Update pinot-spi/src/main/java/org/apache/pinot/spi/config/UpsertConfig.java\n\nCo-Authored-By: Subbu Subramaniam <mcvsubbu@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f56905e1293ee72b21af73a5189d980e94cecb22", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/f56905e1293ee72b21af73a5189d980e94cecb22", "committedDate": "2020-04-24T20:22:59Z", "message": "Update pinot-spi/src/main/java/org/apache/pinot/spi/config/UpsertConfig.java\n\nCo-Authored-By: Subbu Subramaniam <mcvsubbu@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c0bd60350ad6c00c6f571aac9818412d7380169", "author": {"user": {"login": "jamesyfshao", "name": "James Shao"}}, "url": "https://github.com/apache/pinot/commit/6c0bd60350ad6c00c6f571aac9818412d7380169", "committedDate": "2020-04-24T20:23:19Z", "message": "Update pinot-spi/src/main/java/org/apache/pinot/spi/config/UpsertConfig.java\n\nCo-Authored-By: Subbu Subramaniam <mcvsubbu@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjYzNTE2", "url": "https://github.com/apache/pinot/pull/5175#pullrequestreview-400263516", "createdAt": "2020-04-24T20:53:20Z", "commit": {"oid": "6c0bd60350ad6c00c6f571aac9818412d7380169"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1091, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}