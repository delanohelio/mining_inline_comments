{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4MDEzMTEw", "number": 5962, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOToyMTowMFrOEgf70A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMjozMDowN1rOEhb7hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTEzMTA0OnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionResource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxOToyMTowMFrOHNZNwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxODoyMDoyNVrOHOo2zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNjY1OA==", "bodyText": "Why are we not checking if the corresponding entry exists for the anomalies?", "url": "https://github.com/apache/pinot/pull/5962#discussion_r483806658", "createdAt": "2020-09-04T19:21:00Z", "author": {"login": "vincentchenjl"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionResource.java", "diffHunk": "@@ -570,4 +574,19 @@ public Response getDetectionHealth(@PathParam(\"id\") @ApiParam(\"detection config\n     }\n     return Response.ok(health).build();\n   }\n+\n+  @POST\n+  @Path(value = \"/re-notify\")\n+  @ApiOperation(\"Resend the notification for the anomalies to the subscribed notification groups, if the subscription group supports re-notify\")\n+  public Response alert(@QueryParam(\"id\") List<Long> anomalyIds) {\n+    List<MergedAnomalyResultDTO> anomalies = this.anomalyDAO.findByIds(anomalyIds);\n+    for (MergedAnomalyResultDTO anomaly : anomalies) {\n+      AnomalySubscriptionGroupNotificationDTO anomalySubscriptionGroupNotificationDTO =\n+          new AnomalySubscriptionGroupNotificationDTO();\n+      anomalySubscriptionGroupNotificationDTO.setAnomalyId(anomaly.getId());\n+      anomalySubscriptionGroupNotificationDTO.setDetectionConfigId(anomaly.getDetectionConfigId());\n+      anomalySubscriptionGroupNotificationManager.save(anomalySubscriptionGroupNotificationDTO);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55117218c4008a8d5a3893f0b29892a52e5d9608"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExMTUwMw==", "bodyText": "good catch. updated!", "url": "https://github.com/apache/pinot/pull/5962#discussion_r485111503", "createdAt": "2020-09-08T18:20:25Z", "author": {"login": "jihaozh"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionResource.java", "diffHunk": "@@ -570,4 +574,19 @@ public Response getDetectionHealth(@PathParam(\"id\") @ApiParam(\"detection config\n     }\n     return Response.ok(health).build();\n   }\n+\n+  @POST\n+  @Path(value = \"/re-notify\")\n+  @ApiOperation(\"Resend the notification for the anomalies to the subscribed notification groups, if the subscription group supports re-notify\")\n+  public Response alert(@QueryParam(\"id\") List<Long> anomalyIds) {\n+    List<MergedAnomalyResultDTO> anomalies = this.anomalyDAO.findByIds(anomalyIds);\n+    for (MergedAnomalyResultDTO anomaly : anomalies) {\n+      AnomalySubscriptionGroupNotificationDTO anomalySubscriptionGroupNotificationDTO =\n+          new AnomalySubscriptionGroupNotificationDTO();\n+      anomalySubscriptionGroupNotificationDTO.setAnomalyId(anomaly.getId());\n+      anomalySubscriptionGroupNotificationDTO.setDetectionConfigId(anomaly.getDetectionConfigId());\n+      anomalySubscriptionGroupNotificationManager.save(anomalySubscriptionGroupNotificationDTO);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzgwNjY1OA=="}, "originalCommit": {"oid": "55117218c4008a8d5a3893f0b29892a52e5d9608"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTM5NTIxOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionPipelineTaskRunner.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMToxNDo0N1rOHNbpwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxODoyMDo1MFrOHOo3ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzg0NjU5NA==", "bodyText": "Do we expect that new anomalies also have renotify flag as true? Or this should only apply for existing anomalies?", "url": "https://github.com/apache/pinot/pull/5962#discussion_r483846594", "createdAt": "2020-09-04T21:14:47Z", "author": {"login": "vincentchenjl"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionPipelineTaskRunner.java", "diffHunk": "@@ -167,6 +175,14 @@ public DetectionPipelineTaskRunner(DetectionConfigManager detectionDAO, MergedAn\n       }\n       this.detectionDAO.update(config);\n \n+      // re-notify the anomalies if any\n+      for (MergedAnomalyResultDTO anomaly : result.getAnomalies()) {\n+        // if an anomaly should be re-notified, update the notification lookup table in the database\n+        if (anomaly.shouldRenotify()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55117218c4008a8d5a3893f0b29892a52e5d9608"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTExMTcxNQ==", "bodyText": "no. the renotify flag only applies to exist anomalies.", "url": "https://github.com/apache/pinot/pull/5962#discussion_r485111715", "createdAt": "2020-09-08T18:20:50Z", "author": {"login": "jihaozh"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/DetectionPipelineTaskRunner.java", "diffHunk": "@@ -167,6 +175,14 @@ public DetectionPipelineTaskRunner(DetectionConfigManager detectionDAO, MergedAn\n       }\n       this.detectionDAO.update(config);\n \n+      // re-notify the anomalies if any\n+      for (MergedAnomalyResultDTO anomaly : result.getAnomalies()) {\n+        // if an anomaly should be re-notified, update the notification lookup table in the database\n+        if (anomaly.shouldRenotify()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzg0NjU5NA=="}, "originalCommit": {"oid": "55117218c4008a8d5a3893f0b29892a52e5d9608"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNTQzNjkzOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/constant/AnomalySeverity.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMTozNToxN1rOHNcBtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQyMTozNToxN1rOHNcBtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzg1MjcyNQ==", "bodyText": "There's a conflict here between this PR and mine. The labeler in the other PR relies on the order of the severity.", "url": "https://github.com/apache/pinot/pull/5962#discussion_r483852725", "createdAt": "2020-09-04T21:35:17Z", "author": {"login": "vincentchenjl"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/constant/AnomalySeverity.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ *\n+ */\n+\n+package org.apache.pinot.thirdeye.constant;\n+\n+public enum AnomalySeverity {\n+  LOW(\"low\"), MODERATE(\"moderate\"), HIGH(\"high\"), CRITICAL(\"critical\"), DEFAULT(\"default\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55117218c4008a8d5a3893f0b29892a52e5d9608"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNDk1NjQwOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/datalayer/bao/AnomalySubscriptionGroupNotificationManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMjoyODoxNlrOHOwEeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMjoyODoxNlrOHOwEeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIyOTY4OQ==", "bodyText": "pls include some javadocs", "url": "https://github.com/apache/pinot/pull/5962#discussion_r485229689", "createdAt": "2020-09-08T22:28:16Z", "author": {"login": "akshayrai"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/datalayer/bao/AnomalySubscriptionGroupNotificationManager.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ *\n+ */\n+\n+package org.apache.pinot.thirdeye.datalayer.bao;\n+\n+import org.apache.pinot.thirdeye.datalayer.dto.AnomalySubscriptionGroupNotificationDTO;\n+\n+\n+public interface AnomalySubscriptionGroupNotificationManager", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c95c341feb0c699d7d7fd2fc50f45afcef3fa9eb"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNDk2MDcwOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/constant/AnomalySeverity.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMjozMDowN1rOHOwG-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMjozMDowN1rOHOwG-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIzMDMzMQ==", "bodyText": "javadocs", "url": "https://github.com/apache/pinot/pull/5962#discussion_r485230331", "createdAt": "2020-09-08T22:30:07Z", "author": {"login": "akshayrai"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/constant/AnomalySeverity.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ *\n+ */\n+\n+package org.apache.pinot.thirdeye.constant;\n+\n+public enum AnomalySeverity {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c95c341feb0c699d7d7fd2fc50f45afcef3fa9eb"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3829, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}