{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MDQ4MTI1", "number": 5152, "title": "[TE][subscription] update subscription watermarks to use anomaly create time instead of end time", "bodyText": "Problem Statement:\nThe current subscription watermarks are designed to notify an anomaly only once (even if merged) and we maintain this by keeping track of the last notified anomaly end time (watermark). However, the assumption here was that newer anomalies will always be detected on newer data (that is, newer anomalies can never have start time < watermark). This puts the restriction when dealing with backfilled data and also in the case of missing data where the actual deviation anomalies on the data might be detected later. This PR tries to remove this restriction by leveraging the anomaly create time in the watermark.\nProposed changes:\n\nReplace the anomaly end time with the anomaly create time in the vector clock.\nRemove highWaterMark field from subscription config - As of today, we maintain 2 watermarks, namely the last notified anomaly ID(highWaterMark) and the anomaly end time watermark(vector clocks) to ensure that each anomaly is notified only once. The main purpose of the highWaterMark is to filter out merged anomalies from the time window. This is no longer required once we start relying on the anomaly create time.", "createdAt": "2020-03-13T23:03:00Z", "url": "https://github.com/apache/pinot/pull/5152", "merged": true, "mergeCommit": {"oid": "2cfbe7e17ebc4a9ed6b119209b905adf91d8ae0f"}, "closed": true, "closedAt": "2020-03-23T16:04:21Z", "author": {"login": "akshayrai"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOnWG4AFqTM3NjMxNTI5Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPjcwbAFqTM3ODY1MzA0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MzE1Mjk3", "url": "https://github.com/apache/pinot/pull/5152#pullrequestreview-376315297", "createdAt": "2020-03-17T18:50:48Z", "commit": {"oid": "497bfef1a6e5b4a21fa062236a7ea1eef2d74ae0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxODo1MDo0OFrOF3pr5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxODo1MDo0OFrOF3pr5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg5ODk4Mw==", "bodyText": "Are we removing this? Seems unrelated.", "url": "https://github.com/apache/pinot/pull/5152#discussion_r393898983", "createdAt": "2020-03-17T18:50:48Z", "author": {"login": "jihaozh"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/validators/SubscriptionConfigValidator.java", "diffHunk": "@@ -90,10 +90,6 @@ public void validateConfig(DetectionAlertConfigDTO alertConfig) throws IllegalAr\n    */\n   @Override\n   public void validateYaml(Map<String, Object> config) throws IllegalArgumentException {\n-    // Make sure recipients are configured at the right place\n-    Preconditions.checkArgument(!config.containsKey(PROP_RECIPIENTS),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "497bfef1a6e5b4a21fa062236a7ea1eef2d74ae0"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e776ef8cd8015d2eac31a066a479fcbd76cf921f", "author": {"user": {"login": "akshayrai", "name": "Akshay Rai"}}, "url": "https://github.com/apache/pinot/commit/e776ef8cd8015d2eac31a066a479fcbd76cf921f", "committedDate": "2020-03-18T20:58:47Z", "message": "[TE][subscription] update subscription watermarks to use anomaly create time instead of end time"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "497bfef1a6e5b4a21fa062236a7ea1eef2d74ae0", "author": {"user": {"login": "akshayrai", "name": "Akshay Rai"}}, "url": "https://github.com/apache/pinot/commit/497bfef1a6e5b4a21fa062236a7ea1eef2d74ae0", "committedDate": "2020-03-13T23:02:10Z", "message": "[TE][subscription] update subscription watermarks to use anomaly create time instead of end time"}, "afterCommit": {"oid": "e776ef8cd8015d2eac31a066a479fcbd76cf921f", "author": {"user": {"login": "akshayrai", "name": "Akshay Rai"}}, "url": "https://github.com/apache/pinot/commit/e776ef8cd8015d2eac31a066a479fcbd76cf921f", "committedDate": "2020-03-18T20:58:47Z", "message": "[TE][subscription] update subscription watermarks to use anomaly create time instead of end time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8924bfdefc0b12fa609f2796e4b3ad1faa426e52", "author": {"user": {"login": "akshayrai", "name": "Akshay Rai"}}, "url": "https://github.com/apache/pinot/commit/8924bfdefc0b12fa609f2796e4b3ad1faa426e52", "committedDate": "2020-03-19T22:28:09Z", "message": "address comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a6e82608474ee86949ac40d5019dd59cbf8d323", "author": {"user": {"login": "akshayrai", "name": "Akshay Rai"}}, "url": "https://github.com/apache/pinot/commit/5a6e82608474ee86949ac40d5019dd59cbf8d323", "committedDate": "2020-03-19T22:50:59Z", "message": "Added some docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NjUzMDQx", "url": "https://github.com/apache/pinot/pull/5152#pullrequestreview-378653041", "createdAt": "2020-03-20T16:53:02Z", "commit": {"oid": "5a6e82608474ee86949ac40d5019dd59cbf8d323"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1395, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}