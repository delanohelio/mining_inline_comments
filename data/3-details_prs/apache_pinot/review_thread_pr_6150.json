{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0OTc0NjMx", "number": 6150, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxOTo0MToxMlrOEuqUCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxOTo1MDowMFrOEuqdyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MzYzMjEwOnYy", "diffSide": "RIGHT", "path": "pinot-controller/src/main/java/org/apache/pinot/controller/api/resources/PinotInstanceRestletResource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxOTo0MToxMlrOHjNpLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMjowMTo1NlrOHjQ9Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY4NTc0Mg==", "bodyText": "Not related to this PR, but we might want to provide a new API to return the Instance to be in-sync with the setter API.", "url": "https://github.com/apache/pinot/pull/6150#discussion_r506685742", "createdAt": "2020-10-16T19:41:12Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/api/resources/PinotInstanceRestletResource.java", "diffHunk": "@@ -101,6 +101,7 @@ public String getInstance(\n     response.put(\"port\", instanceConfig.getPort());\n     response.set(\"tags\", JsonUtils.objectToJsonNode(instanceConfig.getTags()));\n     response.set(\"pools\", JsonUtils.objectToJsonNode(instanceConfig.getRecord().getMapField(InstanceUtils.POOL_KEY)));\n+    response.put(\"grpcPort\", instanceConfig.getRecord().getSimpleField(InstanceUtils.GRPC_PORT_KEY));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9796cbfcebe167ad6c5ad4f8029c85fa266614af"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc0MDA0Nw==", "bodyText": "Agree, we should have a consistent object.", "url": "https://github.com/apache/pinot/pull/6150#discussion_r506740047", "createdAt": "2020-10-16T22:01:56Z", "author": {"login": "xiangfu0"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/api/resources/PinotInstanceRestletResource.java", "diffHunk": "@@ -101,6 +101,7 @@ public String getInstance(\n     response.put(\"port\", instanceConfig.getPort());\n     response.set(\"tags\", JsonUtils.objectToJsonNode(instanceConfig.getTags()));\n     response.set(\"pools\", JsonUtils.objectToJsonNode(instanceConfig.getRecord().getMapField(InstanceUtils.POOL_KEY)));\n+    response.put(\"grpcPort\", instanceConfig.getRecord().getSimpleField(InstanceUtils.GRPC_PORT_KEY));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY4NTc0Mg=="}, "originalCommit": {"oid": "9796cbfcebe167ad6c5ad4f8029c85fa266614af"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MzYzNzEyOnYy", "diffSide": "RIGHT", "path": "pinot-controller/src/test/java/org/apache/pinot/controller/api/PinotInstanceRestletResourceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxOTo0MzowNFrOHjNsQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxOTo0MzowNFrOHjNsQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY4NjUzMA==", "bodyText": "Remove the static import\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                checkInstanceInfo(instanceName, hostName, port, tags, pools, poolValues, NOT_SET_GRPC_PORT_VALUE);\n          \n          \n            \n                checkInstanceInfo(instanceName, hostName, port, tags, pools, poolValues, Instance.NOT_SET_GRPC_PORT_VALUE);", "url": "https://github.com/apache/pinot/pull/6150#discussion_r506686530", "createdAt": "2020-10-16T19:43:04Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-controller/src/test/java/org/apache/pinot/controller/api/PinotInstanceRestletResourceTest.java", "diffHunk": "@@ -144,14 +148,18 @@ public void testInstanceListingAndCreation()\n     String serverInstanceUpdateTagsUrl = _controllerRequestURLBuilder.forInstanceUpdateTags(serverInstanceId,\n         Lists.newArrayList(\"tag_REALTIME\", \"newTag_OFFLINE\", \"newTag_REALTIME\"));\n     sendPutRequest(serverInstanceUpdateTagsUrl);\n-    checkInstanceInfo(brokerInstanceId, \"Broker_1.2.3.4\", 1234, new String[]{\"tag_BROKER\", \"newTag_BROKER\"}, null,\n-        null);\n+    checkInstanceInfo(brokerInstanceId, \"Broker_1.2.3.4\", 1234, new String[]{\"tag_BROKER\", \"newTag_BROKER\"}, null, null);\n     checkInstanceInfo(serverInstanceId, \"Server_1.2.3.4\", 2345,\n-        new String[]{\"tag_REALTIME\", \"newTag_OFFLINE\", \"newTag_REALTIME\"}, null, null);\n+        new String[]{\"tag_REALTIME\", \"newTag_OFFLINE\", \"newTag_REALTIME\"}, null, null, 28090);\n   }\n \n   private void checkInstanceInfo(String instanceName, String hostName, int port, String[] tags, String[] pools,\n       int[] poolValues) {\n+    checkInstanceInfo(instanceName, hostName, port, tags, pools, poolValues, NOT_SET_GRPC_PORT_VALUE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9796cbfcebe167ad6c5ad4f8029c85fa266614af"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MzY0OTAzOnYy", "diffSide": "RIGHT", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/instance/Instance.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxOTo0NzoxNFrOHjNzdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxOTo0NzoxNFrOHjNzdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY4ODM3Mg==", "bodyText": "This will be set to 0 from the json if grpcPort is not set. You can check for 0 and put -1", "url": "https://github.com/apache/pinot/pull/6150#discussion_r506688372", "createdAt": "2020-10-16T19:47:14Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/instance/Instance.java", "diffHunk": "@@ -38,29 +38,40 @@\n  *   \"tags\": [\"example_OFFLINE\"],\n  *   \"pools\": {\n  *     \"example_OFFLINE\": 0\n- *   }\n+ *   },\n+ *   \"grpcPort\": 8090\n  * }\n  * </pre>\n  */\n public class Instance extends BaseJsonConfig {\n+  public static int NOT_SET_GRPC_PORT_VALUE = -1;\n+\n   private final String _host;\n   private final int _port;\n   private final InstanceType _type;\n   private final List<String> _tags;\n   private final Map<String, Integer> _pools;\n+  private final int _grpcPort;\n+\n+\n+  public Instance(String host, int port, InstanceType type, List<String> tags, Map<String, Integer> pools) {\n+    this(host, port, type, tags, pools, NOT_SET_GRPC_PORT_VALUE);\n+  }\n \n   @JsonCreator\n   public Instance(@JsonProperty(value = \"host\", required = true) String host,\n       @JsonProperty(value = \"port\", required = true) int port,\n       @JsonProperty(value = \"type\", required = true) InstanceType type,\n-      @JsonProperty(\"tags\") @Nullable List<String> tags, @JsonProperty(\"pools\") @Nullable Map<String, Integer> pools) {\n+      @JsonProperty(\"tags\") @Nullable List<String> tags, @JsonProperty(\"pools\") @Nullable Map<String, Integer> pools,\n+      @JsonProperty(\"grpcPort\") int grpcPort) {\n     Preconditions.checkArgument(host != null, \"'host' must be configured\");\n     Preconditions.checkArgument(type != null, \"'type' must be configured\");\n     _host = host;\n     _port = port;\n     _type = type;\n     _tags = tags;\n     _pools = pools;\n+    _grpcPort = grpcPort;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9796cbfcebe167ad6c5ad4f8029c85fa266614af"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MzY1NzA2OnYy", "diffSide": "RIGHT", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/instance/Instance.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxOTo1MDowMFrOHjN4eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxOTo1MDowMFrOHjN4eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY4OTY1OA==", "bodyText": "Recommend removing this constructor. This class is always deserialized from json", "url": "https://github.com/apache/pinot/pull/6150#discussion_r506689658", "createdAt": "2020-10-16T19:50:00Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/instance/Instance.java", "diffHunk": "@@ -38,29 +38,40 @@\n  *   \"tags\": [\"example_OFFLINE\"],\n  *   \"pools\": {\n  *     \"example_OFFLINE\": 0\n- *   }\n+ *   },\n+ *   \"grpcPort\": 8090\n  * }\n  * </pre>\n  */\n public class Instance extends BaseJsonConfig {\n+  public static int NOT_SET_GRPC_PORT_VALUE = -1;\n+\n   private final String _host;\n   private final int _port;\n   private final InstanceType _type;\n   private final List<String> _tags;\n   private final Map<String, Integer> _pools;\n+  private final int _grpcPort;\n+\n+\n+  public Instance(String host, int port, InstanceType type, List<String> tags, Map<String, Integer> pools) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9796cbfcebe167ad6c5ad4f8029c85fa266614af"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3755, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}