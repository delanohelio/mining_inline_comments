{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0OTUzMDc5", "number": 5266, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjowNDoyOVrOD6Az9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMzoyMjo0MVrOD7edqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTU3MzAyOnYy", "diffSide": "RIGHT", "path": "pinot-tools/src/main/java/org/apache/pinot/tools/service/api/resources/PinotServiceManagerInstanceResource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjowNDoyOVrOGRnFeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwODoyNDo0NlrOGZO5EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTExOTM1Mg==", "bodyText": "remove static imports?", "url": "https://github.com/apache/pinot/pull/5266#discussion_r421119352", "createdAt": "2020-05-06T22:04:29Z", "author": {"login": "npawar"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/service/api/resources/PinotServiceManagerInstanceResource.java", "diffHunk": "@@ -0,0 +1,241 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.pinot.tools.service.api.resources;\n+\n+import io.swagger.annotations.Api;\n+import io.swagger.annotations.ApiOperation;\n+import io.swagger.annotations.ApiParam;\n+import io.swagger.annotations.ApiResponse;\n+import io.swagger.annotations.ApiResponses;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import javax.inject.Inject;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import org.apache.commons.configuration.Configuration;\n+import org.apache.commons.configuration.PropertiesConfiguration;\n+import org.apache.pinot.common.utils.CommonConstants;\n+import org.apache.pinot.common.utils.NetUtil;\n+import org.apache.pinot.controller.ControllerConf;\n+import org.apache.pinot.spi.services.ServiceRole;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+import org.apache.pinot.tools.service.PinotServiceManager;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.pinot.common.utils.CommonConstants.Controller.CONFIG_OF_CONTROLLER_METRICS_PREFIX;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTExMTU2OQ==", "bodyText": "done", "url": "https://github.com/apache/pinot/pull/5266#discussion_r429111569", "createdAt": "2020-05-22T08:24:46Z", "author": {"login": "xiangfu0"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/service/api/resources/PinotServiceManagerInstanceResource.java", "diffHunk": "@@ -0,0 +1,241 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.pinot.tools.service.api.resources;\n+\n+import io.swagger.annotations.Api;\n+import io.swagger.annotations.ApiOperation;\n+import io.swagger.annotations.ApiParam;\n+import io.swagger.annotations.ApiResponse;\n+import io.swagger.annotations.ApiResponses;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import javax.inject.Inject;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import org.apache.commons.configuration.Configuration;\n+import org.apache.commons.configuration.PropertiesConfiguration;\n+import org.apache.pinot.common.utils.CommonConstants;\n+import org.apache.pinot.common.utils.NetUtil;\n+import org.apache.pinot.controller.ControllerConf;\n+import org.apache.pinot.spi.services.ServiceRole;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+import org.apache.pinot.tools.service.PinotServiceManager;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.pinot.common.utils.CommonConstants.Controller.CONFIG_OF_CONTROLLER_METRICS_PREFIX;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTExOTM1Mg=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTYwMDk3OnYy", "diffSide": "RIGHT", "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjoxNDo0MFrOGRnWCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwODoyNDo0MVrOGZO47w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEyMzU5NQ==", "bodyText": "Could you add an example in the description of how to run this command\n\nWhen providing multiple bootstrapConfigPath\nWhen starting multiple roles with default configs\n\nOr if there's any documentation, having the link here also works", "url": "https://github.com/apache/pinot/pull/5266#discussion_r421123595", "createdAt": "2020-05-06T22:14:40Z", "author": {"login": "npawar"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "diffHunk": "@@ -0,0 +1,213 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.tools.admin.command;\n+\n+import java.io.File;\n+import java.net.SocketException;\n+import java.net.UnknownHostException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.commons.configuration.Configuration;\n+import org.apache.pinot.common.utils.CommonConstants;\n+import org.apache.pinot.controller.ControllerConf;\n+import org.apache.pinot.spi.services.ServiceRole;\n+import org.apache.pinot.tools.Command;\n+import org.apache.pinot.tools.service.PinotServiceManager;\n+import org.apache.pinot.tools.utils.PinotConfigUtils;\n+import org.kohsuke.args4j.Option;\n+import org.kohsuke.args4j.spi.StringArrayOptionHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.pinot.common.utils.CommonConstants.Helix.PINOT_SERVICE_ROLE;\n+\n+\n+/**\n+ * Class to implement StartPinotService command.\n+ *\n+ */\n+public class StartServiceManagerCommand extends AbstractBaseAdminCommand implements Command {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTExMTUzNQ==", "bodyText": "added examples", "url": "https://github.com/apache/pinot/pull/5266#discussion_r429111535", "createdAt": "2020-05-22T08:24:41Z", "author": {"login": "xiangfu0"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "diffHunk": "@@ -0,0 +1,213 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.tools.admin.command;\n+\n+import java.io.File;\n+import java.net.SocketException;\n+import java.net.UnknownHostException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.commons.configuration.Configuration;\n+import org.apache.pinot.common.utils.CommonConstants;\n+import org.apache.pinot.controller.ControllerConf;\n+import org.apache.pinot.spi.services.ServiceRole;\n+import org.apache.pinot.tools.Command;\n+import org.apache.pinot.tools.service.PinotServiceManager;\n+import org.apache.pinot.tools.utils.PinotConfigUtils;\n+import org.kohsuke.args4j.Option;\n+import org.kohsuke.args4j.spi.StringArrayOptionHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.pinot.common.utils.CommonConstants.Helix.PINOT_SERVICE_ROLE;\n+\n+\n+/**\n+ * Class to implement StartPinotService command.\n+ *\n+ */\n+public class StartServiceManagerCommand extends AbstractBaseAdminCommand implements Command {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEyMzU5NQ=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTYwOTY1OnYy", "diffSide": "RIGHT", "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjoxODowN1rOGRnbVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwODoyNDowM1rOGZO3yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEyNDk1MA==", "bodyText": "this description is not very clear. \"Starts the PinotServiceManager...\" ?", "url": "https://github.com/apache/pinot/pull/5266#discussion_r421124950", "createdAt": "2020-05-06T22:18:07Z", "author": {"login": "npawar"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "diffHunk": "@@ -0,0 +1,213 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.tools.admin.command;\n+\n+import java.io.File;\n+import java.net.SocketException;\n+import java.net.UnknownHostException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.commons.configuration.Configuration;\n+import org.apache.pinot.common.utils.CommonConstants;\n+import org.apache.pinot.controller.ControllerConf;\n+import org.apache.pinot.spi.services.ServiceRole;\n+import org.apache.pinot.tools.Command;\n+import org.apache.pinot.tools.service.PinotServiceManager;\n+import org.apache.pinot.tools.utils.PinotConfigUtils;\n+import org.kohsuke.args4j.Option;\n+import org.kohsuke.args4j.spi.StringArrayOptionHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.pinot.common.utils.CommonConstants.Helix.PINOT_SERVICE_ROLE;\n+\n+\n+/**\n+ * Class to implement StartPinotService command.\n+ *\n+ */\n+public class StartServiceManagerCommand extends AbstractBaseAdminCommand implements Command {\n+  private static final Logger LOGGER = LoggerFactory.getLogger(StartServiceManagerCommand.class);\n+  private final List<Configuration> _bootstrapConfigurations = new ArrayList<>();\n+  private final String[] BOOTSTRAP_SERVICES = new String[]{\"CONTROLLER\", \"BROKER\", \"SERVER\"};\n+\n+  @Option(name = \"-help\", required = false, help = true, aliases = {\"-h\", \"--h\", \"--help\"}, usage = \"Print this message.\")\n+  private boolean _help;\n+  @Option(name = \"-zkAddress\", required = true, metaVar = \"<http>\", usage = \"Http address of Zookeeper.\")\n+  private String _zkAddress = DEFAULT_ZK_ADDRESS;\n+  @Option(name = \"-clusterName\", required = true, metaVar = \"<String>\", usage = \"Pinot cluster name.\")\n+  private String _clusterName = DEFAULT_CLUSTER_NAME;\n+  @Option(name = \"-port\", required = true, metaVar = \"<int>\", usage = \"Pinot service manager admin port, -1 means disable, 0 means a random available port.\")\n+  private int _port;\n+  @Option(name = \"-bootstrapConfigPaths\", handler = StringArrayOptionHandler.class, required = false, usage = \"A list of Pinot service config file paths. Each config file requires an extra config: 'pinot.service.role' to indicate which service to start.\", forbids = {\"-bootstrapServices\"})\n+  private String[] _bootstrapConfigPaths;\n+  @Option(name = \"-bootstrapServices\", handler = StringArrayOptionHandler.class, required = false, usage = \"A list of Pinot service roles to start with default config. E.g. CONTROLLER/BROKER/SERVER\", forbids = {\"-bootstrapConfigPaths\"})\n+  private String[] _bootstrapServices = BOOTSTRAP_SERVICES;\n+\n+  private PinotServiceManager _pinotServiceManager;\n+\n+  public String getZkAddress() {\n+    return _zkAddress;\n+  }\n+\n+  public StartServiceManagerCommand setZkAddress(String zkAddress) {\n+    _zkAddress = zkAddress;\n+    return this;\n+  }\n+\n+  public String getClusterName() {\n+    return _clusterName;\n+  }\n+\n+  public StartServiceManagerCommand setClusterName(String clusterName) {\n+    _clusterName = clusterName;\n+    return this;\n+  }\n+\n+  public int getPort() {\n+    return _port;\n+  }\n+\n+  public StartServiceManagerCommand setPort(int port) {\n+    _port = port;\n+    return this;\n+  }\n+\n+  public String[] getBootstrapConfigPaths() {\n+    return _bootstrapConfigPaths;\n+  }\n+\n+  public StartServiceManagerCommand setBootstrapConfigPaths(String[] bootstrapConfigPaths) {\n+    _bootstrapConfigPaths = bootstrapConfigPaths;\n+    return this;\n+  }\n+\n+  public String[] getBootstrapServices() {\n+    return _bootstrapServices;\n+  }\n+\n+  public StartServiceManagerCommand setBootstrapServices(String[] bootstrapServices) {\n+    _bootstrapServices = bootstrapServices;\n+    return this;\n+  }\n+\n+  @Override\n+  public boolean getHelp() {\n+    return _help;\n+  }\n+\n+  public void setHelp(boolean help) {\n+    _help = help;\n+  }\n+\n+  @Override\n+  public String getName() {\n+    return \"StartPinotService\";\n+  }\n+\n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder()\n+        .append(\"StartServiceManager -clusterName \" + _clusterName + \" -zkAddress \" + _zkAddress + \" -port \" + _port);\n+    if (_bootstrapConfigPaths != null) {\n+      sb.append(\" -bootstrapConfigPaths \" + Arrays.toString(_bootstrapConfigPaths));\n+    } else if (_bootstrapServices != null) {\n+      sb.append(\" -bootstrapServices \" + Arrays.toString(_bootstrapServices));\n+    }\n+\n+    return sb.toString();\n+  }\n+\n+  @Override\n+  public void cleanup() {\n+  }\n+\n+  @Override\n+  public String description() {\n+    return \"Start the Pinot Service Process at the specified port.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 144}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQzODQ1NA==", "bodyText": "Yes. Let's please add documentation here describing the usage of this command", "url": "https://github.com/apache/pinot/pull/5266#discussion_r423438454", "createdAt": "2020-05-12T03:19:50Z", "author": {"login": "siddharthteotia"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "diffHunk": "@@ -0,0 +1,213 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.tools.admin.command;\n+\n+import java.io.File;\n+import java.net.SocketException;\n+import java.net.UnknownHostException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.commons.configuration.Configuration;\n+import org.apache.pinot.common.utils.CommonConstants;\n+import org.apache.pinot.controller.ControllerConf;\n+import org.apache.pinot.spi.services.ServiceRole;\n+import org.apache.pinot.tools.Command;\n+import org.apache.pinot.tools.service.PinotServiceManager;\n+import org.apache.pinot.tools.utils.PinotConfigUtils;\n+import org.kohsuke.args4j.Option;\n+import org.kohsuke.args4j.spi.StringArrayOptionHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.pinot.common.utils.CommonConstants.Helix.PINOT_SERVICE_ROLE;\n+\n+\n+/**\n+ * Class to implement StartPinotService command.\n+ *\n+ */\n+public class StartServiceManagerCommand extends AbstractBaseAdminCommand implements Command {\n+  private static final Logger LOGGER = LoggerFactory.getLogger(StartServiceManagerCommand.class);\n+  private final List<Configuration> _bootstrapConfigurations = new ArrayList<>();\n+  private final String[] BOOTSTRAP_SERVICES = new String[]{\"CONTROLLER\", \"BROKER\", \"SERVER\"};\n+\n+  @Option(name = \"-help\", required = false, help = true, aliases = {\"-h\", \"--h\", \"--help\"}, usage = \"Print this message.\")\n+  private boolean _help;\n+  @Option(name = \"-zkAddress\", required = true, metaVar = \"<http>\", usage = \"Http address of Zookeeper.\")\n+  private String _zkAddress = DEFAULT_ZK_ADDRESS;\n+  @Option(name = \"-clusterName\", required = true, metaVar = \"<String>\", usage = \"Pinot cluster name.\")\n+  private String _clusterName = DEFAULT_CLUSTER_NAME;\n+  @Option(name = \"-port\", required = true, metaVar = \"<int>\", usage = \"Pinot service manager admin port, -1 means disable, 0 means a random available port.\")\n+  private int _port;\n+  @Option(name = \"-bootstrapConfigPaths\", handler = StringArrayOptionHandler.class, required = false, usage = \"A list of Pinot service config file paths. Each config file requires an extra config: 'pinot.service.role' to indicate which service to start.\", forbids = {\"-bootstrapServices\"})\n+  private String[] _bootstrapConfigPaths;\n+  @Option(name = \"-bootstrapServices\", handler = StringArrayOptionHandler.class, required = false, usage = \"A list of Pinot service roles to start with default config. E.g. CONTROLLER/BROKER/SERVER\", forbids = {\"-bootstrapConfigPaths\"})\n+  private String[] _bootstrapServices = BOOTSTRAP_SERVICES;\n+\n+  private PinotServiceManager _pinotServiceManager;\n+\n+  public String getZkAddress() {\n+    return _zkAddress;\n+  }\n+\n+  public StartServiceManagerCommand setZkAddress(String zkAddress) {\n+    _zkAddress = zkAddress;\n+    return this;\n+  }\n+\n+  public String getClusterName() {\n+    return _clusterName;\n+  }\n+\n+  public StartServiceManagerCommand setClusterName(String clusterName) {\n+    _clusterName = clusterName;\n+    return this;\n+  }\n+\n+  public int getPort() {\n+    return _port;\n+  }\n+\n+  public StartServiceManagerCommand setPort(int port) {\n+    _port = port;\n+    return this;\n+  }\n+\n+  public String[] getBootstrapConfigPaths() {\n+    return _bootstrapConfigPaths;\n+  }\n+\n+  public StartServiceManagerCommand setBootstrapConfigPaths(String[] bootstrapConfigPaths) {\n+    _bootstrapConfigPaths = bootstrapConfigPaths;\n+    return this;\n+  }\n+\n+  public String[] getBootstrapServices() {\n+    return _bootstrapServices;\n+  }\n+\n+  public StartServiceManagerCommand setBootstrapServices(String[] bootstrapServices) {\n+    _bootstrapServices = bootstrapServices;\n+    return this;\n+  }\n+\n+  @Override\n+  public boolean getHelp() {\n+    return _help;\n+  }\n+\n+  public void setHelp(boolean help) {\n+    _help = help;\n+  }\n+\n+  @Override\n+  public String getName() {\n+    return \"StartPinotService\";\n+  }\n+\n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder()\n+        .append(\"StartServiceManager -clusterName \" + _clusterName + \" -zkAddress \" + _zkAddress + \" -port \" + _port);\n+    if (_bootstrapConfigPaths != null) {\n+      sb.append(\" -bootstrapConfigPaths \" + Arrays.toString(_bootstrapConfigPaths));\n+    } else if (_bootstrapServices != null) {\n+      sb.append(\" -bootstrapServices \" + Arrays.toString(_bootstrapServices));\n+    }\n+\n+    return sb.toString();\n+  }\n+\n+  @Override\n+  public void cleanup() {\n+  }\n+\n+  @Override\n+  public String description() {\n+    return \"Start the Pinot Service Process at the specified port.\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEyNDk1MA=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 144}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTExMTI0MA==", "bodyText": "added", "url": "https://github.com/apache/pinot/pull/5266#discussion_r429111240", "createdAt": "2020-05-22T08:24:03Z", "author": {"login": "xiangfu0"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "diffHunk": "@@ -0,0 +1,213 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.tools.admin.command;\n+\n+import java.io.File;\n+import java.net.SocketException;\n+import java.net.UnknownHostException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.commons.configuration.Configuration;\n+import org.apache.pinot.common.utils.CommonConstants;\n+import org.apache.pinot.controller.ControllerConf;\n+import org.apache.pinot.spi.services.ServiceRole;\n+import org.apache.pinot.tools.Command;\n+import org.apache.pinot.tools.service.PinotServiceManager;\n+import org.apache.pinot.tools.utils.PinotConfigUtils;\n+import org.kohsuke.args4j.Option;\n+import org.kohsuke.args4j.spi.StringArrayOptionHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.pinot.common.utils.CommonConstants.Helix.PINOT_SERVICE_ROLE;\n+\n+\n+/**\n+ * Class to implement StartPinotService command.\n+ *\n+ */\n+public class StartServiceManagerCommand extends AbstractBaseAdminCommand implements Command {\n+  private static final Logger LOGGER = LoggerFactory.getLogger(StartServiceManagerCommand.class);\n+  private final List<Configuration> _bootstrapConfigurations = new ArrayList<>();\n+  private final String[] BOOTSTRAP_SERVICES = new String[]{\"CONTROLLER\", \"BROKER\", \"SERVER\"};\n+\n+  @Option(name = \"-help\", required = false, help = true, aliases = {\"-h\", \"--h\", \"--help\"}, usage = \"Print this message.\")\n+  private boolean _help;\n+  @Option(name = \"-zkAddress\", required = true, metaVar = \"<http>\", usage = \"Http address of Zookeeper.\")\n+  private String _zkAddress = DEFAULT_ZK_ADDRESS;\n+  @Option(name = \"-clusterName\", required = true, metaVar = \"<String>\", usage = \"Pinot cluster name.\")\n+  private String _clusterName = DEFAULT_CLUSTER_NAME;\n+  @Option(name = \"-port\", required = true, metaVar = \"<int>\", usage = \"Pinot service manager admin port, -1 means disable, 0 means a random available port.\")\n+  private int _port;\n+  @Option(name = \"-bootstrapConfigPaths\", handler = StringArrayOptionHandler.class, required = false, usage = \"A list of Pinot service config file paths. Each config file requires an extra config: 'pinot.service.role' to indicate which service to start.\", forbids = {\"-bootstrapServices\"})\n+  private String[] _bootstrapConfigPaths;\n+  @Option(name = \"-bootstrapServices\", handler = StringArrayOptionHandler.class, required = false, usage = \"A list of Pinot service roles to start with default config. E.g. CONTROLLER/BROKER/SERVER\", forbids = {\"-bootstrapConfigPaths\"})\n+  private String[] _bootstrapServices = BOOTSTRAP_SERVICES;\n+\n+  private PinotServiceManager _pinotServiceManager;\n+\n+  public String getZkAddress() {\n+    return _zkAddress;\n+  }\n+\n+  public StartServiceManagerCommand setZkAddress(String zkAddress) {\n+    _zkAddress = zkAddress;\n+    return this;\n+  }\n+\n+  public String getClusterName() {\n+    return _clusterName;\n+  }\n+\n+  public StartServiceManagerCommand setClusterName(String clusterName) {\n+    _clusterName = clusterName;\n+    return this;\n+  }\n+\n+  public int getPort() {\n+    return _port;\n+  }\n+\n+  public StartServiceManagerCommand setPort(int port) {\n+    _port = port;\n+    return this;\n+  }\n+\n+  public String[] getBootstrapConfigPaths() {\n+    return _bootstrapConfigPaths;\n+  }\n+\n+  public StartServiceManagerCommand setBootstrapConfigPaths(String[] bootstrapConfigPaths) {\n+    _bootstrapConfigPaths = bootstrapConfigPaths;\n+    return this;\n+  }\n+\n+  public String[] getBootstrapServices() {\n+    return _bootstrapServices;\n+  }\n+\n+  public StartServiceManagerCommand setBootstrapServices(String[] bootstrapServices) {\n+    _bootstrapServices = bootstrapServices;\n+    return this;\n+  }\n+\n+  @Override\n+  public boolean getHelp() {\n+    return _help;\n+  }\n+\n+  public void setHelp(boolean help) {\n+    _help = help;\n+  }\n+\n+  @Override\n+  public String getName() {\n+    return \"StartPinotService\";\n+  }\n+\n+  @Override\n+  public String toString() {\n+    StringBuilder sb = new StringBuilder()\n+        .append(\"StartServiceManager -clusterName \" + _clusterName + \" -zkAddress \" + _zkAddress + \" -port \" + _port);\n+    if (_bootstrapConfigPaths != null) {\n+      sb.append(\" -bootstrapConfigPaths \" + Arrays.toString(_bootstrapConfigPaths));\n+    } else if (_bootstrapServices != null) {\n+      sb.append(\" -bootstrapServices \" + Arrays.toString(_bootstrapServices));\n+    }\n+\n+    return sb.toString();\n+  }\n+\n+  @Override\n+  public void cleanup() {\n+  }\n+\n+  @Override\n+  public String description() {\n+    return \"Start the Pinot Service Process at the specified port.\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEyNDk1MA=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 144}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTYzMTc2OnYy", "diffSide": "RIGHT", "path": "pinot-tools/src/main/java/org/apache/pinot/tools/service/PinotServiceManagerAdminApiApplication.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjoyNjo0M1rOGRnoZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwODoyMzo1OVrOGZO3lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEyODI5Mw==", "bodyText": "Some javadoc?", "url": "https://github.com/apache/pinot/pull/5266#discussion_r421128293", "createdAt": "2020-05-06T22:26:43Z", "author": {"login": "npawar"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/service/PinotServiceManagerAdminApiApplication.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.pinot.tools.service;\n+\n+import com.google.common.base.Preconditions;\n+import io.swagger.jaxrs.config.BeanConfig;\n+import java.net.URI;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import org.glassfish.grizzly.http.server.CLStaticHttpHandler;\n+import org.glassfish.grizzly.http.server.HttpHandler;\n+import org.glassfish.grizzly.http.server.HttpServer;\n+import org.glassfish.hk2.utilities.binding.AbstractBinder;\n+import org.glassfish.jersey.grizzly2.httpserver.GrizzlyHttpServerFactory;\n+import org.glassfish.jersey.jackson.JacksonFeature;\n+import org.glassfish.jersey.server.ResourceConfig;\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTExMTE5MA==", "bodyText": "added", "url": "https://github.com/apache/pinot/pull/5266#discussion_r429111190", "createdAt": "2020-05-22T08:23:59Z", "author": {"login": "xiangfu0"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/service/PinotServiceManagerAdminApiApplication.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.pinot.tools.service;\n+\n+import com.google.common.base.Preconditions;\n+import io.swagger.jaxrs.config.BeanConfig;\n+import java.net.URI;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import org.glassfish.grizzly.http.server.CLStaticHttpHandler;\n+import org.glassfish.grizzly.http.server.HttpHandler;\n+import org.glassfish.grizzly.http.server.HttpServer;\n+import org.glassfish.hk2.utilities.binding.AbstractBinder;\n+import org.glassfish.jersey.grizzly2.httpserver.GrizzlyHttpServerFactory;\n+import org.glassfish.jersey.jackson.JacksonFeature;\n+import org.glassfish.jersey.server.ResourceConfig;\n+\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEyODI5Mw=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTY1MDg3OnYy", "diffSide": "RIGHT", "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/EnumArrayOptionHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjozNDozM1rOGRnz7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwODoyMzo1MVrOGZO3Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzMTI0NA==", "bodyText": "Some javadoc for this?\nAlso, where is it used?", "url": "https://github.com/apache/pinot/pull/5266#discussion_r421131244", "createdAt": "2020-05-06T22:34:33Z", "author": {"login": "npawar"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/EnumArrayOptionHandler.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.tools.admin.command;\n+\n+import org.kohsuke.args4j.CmdLineException;\n+import org.kohsuke.args4j.CmdLineParser;\n+import org.kohsuke.args4j.OptionDef;\n+import org.kohsuke.args4j.spi.OptionHandler;\n+import org.kohsuke.args4j.spi.Parameters;\n+import org.kohsuke.args4j.spi.Setter;\n+\n+\n+public class EnumArrayOptionHandler<T extends Enum<T>> extends OptionHandler<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTExMTEwMg==", "bodyText": "this is not used. will delete", "url": "https://github.com/apache/pinot/pull/5266#discussion_r429111102", "createdAt": "2020-05-22T08:23:51Z", "author": {"login": "xiangfu0"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/EnumArrayOptionHandler.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.tools.admin.command;\n+\n+import org.kohsuke.args4j.CmdLineException;\n+import org.kohsuke.args4j.CmdLineParser;\n+import org.kohsuke.args4j.OptionDef;\n+import org.kohsuke.args4j.spi.OptionHandler;\n+import org.kohsuke.args4j.spi.Parameters;\n+import org.kohsuke.args4j.spi.Setter;\n+\n+\n+public class EnumArrayOptionHandler<T extends Enum<T>> extends OptionHandler<T> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzMTI0NA=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTY1MTcyOnYy", "diffSide": "RIGHT", "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/EnumArrayOptionHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjozNDo0OVrOGRn0aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjozNDo0OVrOGRn0aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzMTM2OQ==", "bodyText": "new line", "url": "https://github.com/apache/pinot/pull/5266#discussion_r421131369", "createdAt": "2020-05-06T22:34:49Z", "author": {"login": "npawar"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/EnumArrayOptionHandler.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.tools.admin.command;\n+\n+import org.kohsuke.args4j.CmdLineException;\n+import org.kohsuke.args4j.CmdLineParser;\n+import org.kohsuke.args4j.OptionDef;\n+import org.kohsuke.args4j.spi.OptionHandler;\n+import org.kohsuke.args4j.spi.Parameters;\n+import org.kohsuke.args4j.spi.Setter;\n+\n+\n+public class EnumArrayOptionHandler<T extends Enum<T>> extends OptionHandler<T> {\n+\n+  public EnumArrayOptionHandler(CmdLineParser parser, OptionDef option, Setter<T> setter) {\n+    super(parser, option, setter);\n+  }\n+\n+  /**\n+   * Returns {@code \"T[]\"}.\n+   *\n+   * @return return \"T[]\";\n+   */\n+  @Override\n+  public String getDefaultMetaVariable() {\n+    return setter.getType().getName() + \"[]\";\n+  }\n+\n+  /**\n+   * Tries to parse {@code String[]} argument from {@link Parameters}.\n+   */\n+  @Override\n+  public int parseArguments(Parameters params)\n+      throws CmdLineException {\n+    int counter = 0;\n+    for (; counter < params.size(); counter++) {\n+      String param = params.getParameter(counter);\n+\n+      if (param.startsWith(\"-\")) {\n+        break;\n+      }\n+\n+      for (String p : param.split(\" \")) {\n+        Class<T> t = (Class<T>) setter.getType();\n+        setter.addValue(Enum.valueOf(t, p));\n+      }\n+    }\n+\n+    return counter;\n+  }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTY3NDU1OnYy", "diffSide": "RIGHT", "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjo0NDozM1rOGRoCaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwODoyMzozOVrOGZO23w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzNDk1Mg==", "bodyText": "I couldn't find the logic which handles port=-1.\nI see port being set as -1 in StartControllerCommnad, StartBrokerCommand etc. But in PinotServiceManager I didn't find any special handling for it?", "url": "https://github.com/apache/pinot/pull/5266#discussion_r421134952", "createdAt": "2020-05-06T22:44:33Z", "author": {"login": "npawar"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "diffHunk": "@@ -0,0 +1,213 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.tools.admin.command;\n+\n+import java.io.File;\n+import java.net.SocketException;\n+import java.net.UnknownHostException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.commons.configuration.Configuration;\n+import org.apache.pinot.common.utils.CommonConstants;\n+import org.apache.pinot.controller.ControllerConf;\n+import org.apache.pinot.spi.services.ServiceRole;\n+import org.apache.pinot.tools.Command;\n+import org.apache.pinot.tools.service.PinotServiceManager;\n+import org.apache.pinot.tools.utils.PinotConfigUtils;\n+import org.kohsuke.args4j.Option;\n+import org.kohsuke.args4j.spi.StringArrayOptionHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.pinot.common.utils.CommonConstants.Helix.PINOT_SERVICE_ROLE;\n+\n+\n+/**\n+ * Class to implement StartPinotService command.\n+ *\n+ */\n+public class StartServiceManagerCommand extends AbstractBaseAdminCommand implements Command {\n+  private static final Logger LOGGER = LoggerFactory.getLogger(StartServiceManagerCommand.class);\n+  private final List<Configuration> _bootstrapConfigurations = new ArrayList<>();\n+  private final String[] BOOTSTRAP_SERVICES = new String[]{\"CONTROLLER\", \"BROKER\", \"SERVER\"};\n+\n+  @Option(name = \"-help\", required = false, help = true, aliases = {\"-h\", \"--h\", \"--help\"}, usage = \"Print this message.\")\n+  private boolean _help;\n+  @Option(name = \"-zkAddress\", required = true, metaVar = \"<http>\", usage = \"Http address of Zookeeper.\")\n+  private String _zkAddress = DEFAULT_ZK_ADDRESS;\n+  @Option(name = \"-clusterName\", required = true, metaVar = \"<String>\", usage = \"Pinot cluster name.\")\n+  private String _clusterName = DEFAULT_CLUSTER_NAME;\n+  @Option(name = \"-port\", required = true, metaVar = \"<int>\", usage = \"Pinot service manager admin port, -1 means disable, 0 means a random available port.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTExMTAwNw==", "bodyText": "it's in PinotServiceManager", "url": "https://github.com/apache/pinot/pull/5266#discussion_r429111007", "createdAt": "2020-05-22T08:23:39Z", "author": {"login": "xiangfu0"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "diffHunk": "@@ -0,0 +1,213 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.tools.admin.command;\n+\n+import java.io.File;\n+import java.net.SocketException;\n+import java.net.UnknownHostException;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import org.apache.commons.configuration.Configuration;\n+import org.apache.pinot.common.utils.CommonConstants;\n+import org.apache.pinot.controller.ControllerConf;\n+import org.apache.pinot.spi.services.ServiceRole;\n+import org.apache.pinot.tools.Command;\n+import org.apache.pinot.tools.service.PinotServiceManager;\n+import org.apache.pinot.tools.utils.PinotConfigUtils;\n+import org.kohsuke.args4j.Option;\n+import org.kohsuke.args4j.spi.StringArrayOptionHandler;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.pinot.common.utils.CommonConstants.Helix.PINOT_SERVICE_ROLE;\n+\n+\n+/**\n+ * Class to implement StartPinotService command.\n+ *\n+ */\n+public class StartServiceManagerCommand extends AbstractBaseAdminCommand implements Command {\n+  private static final Logger LOGGER = LoggerFactory.getLogger(StartServiceManagerCommand.class);\n+  private final List<Configuration> _bootstrapConfigurations = new ArrayList<>();\n+  private final String[] BOOTSTRAP_SERVICES = new String[]{\"CONTROLLER\", \"BROKER\", \"SERVER\"};\n+\n+  @Option(name = \"-help\", required = false, help = true, aliases = {\"-h\", \"--h\", \"--help\"}, usage = \"Print this message.\")\n+  private boolean _help;\n+  @Option(name = \"-zkAddress\", required = true, metaVar = \"<http>\", usage = \"Http address of Zookeeper.\")\n+  private String _zkAddress = DEFAULT_ZK_ADDRESS;\n+  @Option(name = \"-clusterName\", required = true, metaVar = \"<String>\", usage = \"Pinot cluster name.\")\n+  private String _clusterName = DEFAULT_CLUSTER_NAME;\n+  @Option(name = \"-port\", required = true, metaVar = \"<int>\", usage = \"Pinot service manager admin port, -1 means disable, 0 means a random available port.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzNDk1Mg=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTcwMDk0OnYy", "diffSide": "RIGHT", "path": "pinot-tools/src/main/java/org/apache/pinot/tools/service/api/resources/PinotServiceManagerInstanceResource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQyMjo1NToyNlrOGRoSJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwODo0MTo1MFrOGZPYyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzODk4Mw==", "bodyText": "is it possible to add \"stopAllServers\" \"stopAllBrokers\" etc, and \"stopAll\"", "url": "https://github.com/apache/pinot/pull/5266#discussion_r421138983", "createdAt": "2020-05-06T22:55:26Z", "author": {"login": "npawar"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/service/api/resources/PinotServiceManagerInstanceResource.java", "diffHunk": "@@ -0,0 +1,241 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.pinot.tools.service.api.resources;\n+\n+import io.swagger.annotations.Api;\n+import io.swagger.annotations.ApiOperation;\n+import io.swagger.annotations.ApiParam;\n+import io.swagger.annotations.ApiResponse;\n+import io.swagger.annotations.ApiResponses;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import javax.inject.Inject;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import org.apache.commons.configuration.Configuration;\n+import org.apache.commons.configuration.PropertiesConfiguration;\n+import org.apache.pinot.common.utils.CommonConstants;\n+import org.apache.pinot.common.utils.NetUtil;\n+import org.apache.pinot.controller.ControllerConf;\n+import org.apache.pinot.spi.services.ServiceRole;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+import org.apache.pinot.tools.service.PinotServiceManager;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.pinot.common.utils.CommonConstants.Controller.CONFIG_OF_CONTROLLER_METRICS_PREFIX;\n+import static org.apache.pinot.common.utils.CommonConstants.Controller.DEFAULT_METRICS_PREFIX;\n+import static org.apache.pinot.tools.utils.PinotConfigUtils.TMP_DIR;\n+import static org.apache.pinot.tools.utils.PinotConfigUtils.getAvailablePort;\n+\n+\n+@Api(tags = \"Startable\")\n+@Path(\"/\")\n+public class PinotServiceManagerInstanceResource {\n+\n+  private static final Logger LOGGER = LoggerFactory.getLogger(PinotServiceManagerInstanceResource.class);\n+\n+  @Inject\n+  private PinotServiceManager _pinotServiceManager;\n+\n+  @GET\n+  @Produces(MediaType.APPLICATION_JSON)\n+  @Path(\"/instances\")\n+  @ApiOperation(value = \"Get Pinot Instances Status\")\n+  @ApiResponses(value = {@ApiResponse(code = 200, message = \"Instance Status\"), @ApiResponse(code = 500, message = \"Internal server error\")})\n+  public Map<String, PinotInstanceStatus> getPinotAllInstancesStatus() {\n+    Map<String, PinotInstanceStatus> results = new HashMap<>();\n+    for (String instanceId : _pinotServiceManager.getRunningInstanceIds()) {\n+      results.put(instanceId, _pinotServiceManager.getInstanceStatus(instanceId));\n+    }\n+    return results;\n+  }\n+\n+  @GET\n+  @Produces(MediaType.APPLICATION_JSON)\n+  @Path(\"/instances/{instanceName}\")\n+  @ApiOperation(value = \"Get Pinot Instance Status\")\n+  @ApiResponses(value = {@ApiResponse(code = 200, message = \"Instance Status\"), @ApiResponse(code = 404, message = \"Instance Not Found\"), @ApiResponse(code = 500, message = \"Internal server error\")})\n+  public PinotInstanceStatus getPinotInstanceStatus(\n+      @ApiParam(value = \"Name of the instance\") @PathParam(\"instanceName\") String instanceName) {\n+    List<String> instanceIds = _pinotServiceManager.getRunningInstanceIds();\n+    if (instanceIds.contains(instanceName)) {\n+      return _pinotServiceManager.getInstanceStatus(instanceName);\n+    }\n+    throw new WebApplicationException(String.format(\"Instance [%s] not found.\", instanceName),\n+        Response.Status.NOT_FOUND);\n+  }\n+\n+  @DELETE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTExOTY5MA==", "bodyText": "added stopAllPinotInstances and stopPinotInstancesByRole", "url": "https://github.com/apache/pinot/pull/5266#discussion_r429119690", "createdAt": "2020-05-22T08:41:50Z", "author": {"login": "xiangfu0"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/service/api/resources/PinotServiceManagerInstanceResource.java", "diffHunk": "@@ -0,0 +1,241 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.pinot.tools.service.api.resources;\n+\n+import io.swagger.annotations.Api;\n+import io.swagger.annotations.ApiOperation;\n+import io.swagger.annotations.ApiParam;\n+import io.swagger.annotations.ApiResponse;\n+import io.swagger.annotations.ApiResponses;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import javax.inject.Inject;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.WebApplicationException;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import org.apache.commons.configuration.Configuration;\n+import org.apache.commons.configuration.PropertiesConfiguration;\n+import org.apache.pinot.common.utils.CommonConstants;\n+import org.apache.pinot.common.utils.NetUtil;\n+import org.apache.pinot.controller.ControllerConf;\n+import org.apache.pinot.spi.services.ServiceRole;\n+import org.apache.pinot.spi.utils.JsonUtils;\n+import org.apache.pinot.tools.service.PinotServiceManager;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.apache.pinot.common.utils.CommonConstants.Controller.CONFIG_OF_CONTROLLER_METRICS_PREFIX;\n+import static org.apache.pinot.common.utils.CommonConstants.Controller.DEFAULT_METRICS_PREFIX;\n+import static org.apache.pinot.tools.utils.PinotConfigUtils.TMP_DIR;\n+import static org.apache.pinot.tools.utils.PinotConfigUtils.getAvailablePort;\n+\n+\n+@Api(tags = \"Startable\")\n+@Path(\"/\")\n+public class PinotServiceManagerInstanceResource {\n+\n+  private static final Logger LOGGER = LoggerFactory.getLogger(PinotServiceManagerInstanceResource.class);\n+\n+  @Inject\n+  private PinotServiceManager _pinotServiceManager;\n+\n+  @GET\n+  @Produces(MediaType.APPLICATION_JSON)\n+  @Path(\"/instances\")\n+  @ApiOperation(value = \"Get Pinot Instances Status\")\n+  @ApiResponses(value = {@ApiResponse(code = 200, message = \"Instance Status\"), @ApiResponse(code = 500, message = \"Internal server error\")})\n+  public Map<String, PinotInstanceStatus> getPinotAllInstancesStatus() {\n+    Map<String, PinotInstanceStatus> results = new HashMap<>();\n+    for (String instanceId : _pinotServiceManager.getRunningInstanceIds()) {\n+      results.put(instanceId, _pinotServiceManager.getInstanceStatus(instanceId));\n+    }\n+    return results;\n+  }\n+\n+  @GET\n+  @Produces(MediaType.APPLICATION_JSON)\n+  @Path(\"/instances/{instanceName}\")\n+  @ApiOperation(value = \"Get Pinot Instance Status\")\n+  @ApiResponses(value = {@ApiResponse(code = 200, message = \"Instance Status\"), @ApiResponse(code = 404, message = \"Instance Not Found\"), @ApiResponse(code = 500, message = \"Internal server error\")})\n+  public PinotInstanceStatus getPinotInstanceStatus(\n+      @ApiParam(value = \"Name of the instance\") @PathParam(\"instanceName\") String instanceName) {\n+    List<String> instanceIds = _pinotServiceManager.getRunningInstanceIds();\n+    if (instanceIds.contains(instanceName)) {\n+      return _pinotServiceManager.getInstanceStatus(instanceName);\n+    }\n+    throw new WebApplicationException(String.format(\"Instance [%s] not found.\", instanceName),\n+        Response.Status.NOT_FOUND);\n+  }\n+\n+  @DELETE", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTEzODk4Mw=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 96}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTEzMjU3OnYy", "diffSide": "RIGHT", "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/ServiceStatus.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNjowODowM1rOGTjHhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwODo0Mzo0NVrOGZPcXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1MTQ5NQ==", "bodyText": "This should never happen. Can you add an error log here with the exception stack?\nAlso, please modify the return string to be \"Exception while getting service status: \" + e.getMessage()", "url": "https://github.com/apache/pinot/pull/5266#discussion_r423151495", "createdAt": "2020-05-11T16:08:03Z", "author": {"login": "mcvsubbu"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/ServiceStatus.java", "diffHunk": "@@ -43,17 +44,79 @@\n  */\n @SuppressWarnings(\"unused\")\n public class ServiceStatus {\n+  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n+  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n+  public static final String STATUS_DESCRIPTION_STARTED = \"Started\";\n+  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n   private static final Logger LOGGER = LoggerFactory.getLogger(ServiceStatus.class);\n+  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  private static final Map<String, ServiceStatusCallback> serviceStatusCallbackMap = new ConcurrentHashMap<>();\n+  private static final ServiceStatusCallback serviceStatusCallback =\n+      new MapBasedMultipleCallbackServiceStatusCallback(serviceStatusCallbackMap);\n \n-  public enum Status {\n-    STARTING, GOOD, BAD\n+  public static void setServiceStatusCallback(String name, ServiceStatusCallback serviceStatusCallback) {\n+    ServiceStatus.serviceStatusCallbackMap.put(name, serviceStatusCallback);\n   }\n \n-  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n-  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n-  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n+  public static void removeServiceStatusCallback(String name) {\n+    ServiceStatus.serviceStatusCallbackMap.remove(name);\n+  }\n \n-  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  public static Status getServiceStatus() {\n+    return getServiceStatus(serviceStatusCallback);\n+  }\n+\n+  public static Status getServiceStatus(String name) {\n+    if (serviceStatusCallbackMap.containsKey(name)) {\n+      return getServiceStatus(serviceStatusCallbackMap.get(name));\n+    } else {\n+      return Status.NOT_STARTED;\n+    }\n+  }\n+\n+  private static Status getServiceStatus(ServiceStatusCallback callback) {\n+    try {\n+      return callback.getServiceStatus();\n+    } catch (Exception e) {\n+      LOGGER.warn(\"Caught exception while reading the service status\", e);\n+      return Status.BAD;\n+    }\n+  }\n+\n+  public static String getStatusDescription() {\n+    return getStatusDescription(serviceStatusCallback);\n+  }\n+\n+  public static String getStatusDescription(String name) {\n+    if (serviceStatusCallbackMap.containsKey(name)) {\n+      return getStatusDescription(serviceStatusCallbackMap.get(name));\n+    } else {\n+      return STATUS_DESCRIPTION_NONE;\n+    }\n+  }\n+\n+  private static String getStatusDescription(ServiceStatusCallback callback) {\n+    try {\n+      return callback.getStatusDescription();\n+    } catch (Exception e) {\n+      return \"Exception: \" + e.getMessage();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEyMDYwNg==", "bodyText": "done", "url": "https://github.com/apache/pinot/pull/5266#discussion_r429120606", "createdAt": "2020-05-22T08:43:45Z", "author": {"login": "xiangfu0"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/ServiceStatus.java", "diffHunk": "@@ -43,17 +44,79 @@\n  */\n @SuppressWarnings(\"unused\")\n public class ServiceStatus {\n+  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n+  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n+  public static final String STATUS_DESCRIPTION_STARTED = \"Started\";\n+  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n   private static final Logger LOGGER = LoggerFactory.getLogger(ServiceStatus.class);\n+  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  private static final Map<String, ServiceStatusCallback> serviceStatusCallbackMap = new ConcurrentHashMap<>();\n+  private static final ServiceStatusCallback serviceStatusCallback =\n+      new MapBasedMultipleCallbackServiceStatusCallback(serviceStatusCallbackMap);\n \n-  public enum Status {\n-    STARTING, GOOD, BAD\n+  public static void setServiceStatusCallback(String name, ServiceStatusCallback serviceStatusCallback) {\n+    ServiceStatus.serviceStatusCallbackMap.put(name, serviceStatusCallback);\n   }\n \n-  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n-  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n-  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n+  public static void removeServiceStatusCallback(String name) {\n+    ServiceStatus.serviceStatusCallbackMap.remove(name);\n+  }\n \n-  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  public static Status getServiceStatus() {\n+    return getServiceStatus(serviceStatusCallback);\n+  }\n+\n+  public static Status getServiceStatus(String name) {\n+    if (serviceStatusCallbackMap.containsKey(name)) {\n+      return getServiceStatus(serviceStatusCallbackMap.get(name));\n+    } else {\n+      return Status.NOT_STARTED;\n+    }\n+  }\n+\n+  private static Status getServiceStatus(ServiceStatusCallback callback) {\n+    try {\n+      return callback.getServiceStatus();\n+    } catch (Exception e) {\n+      LOGGER.warn(\"Caught exception while reading the service status\", e);\n+      return Status.BAD;\n+    }\n+  }\n+\n+  public static String getStatusDescription() {\n+    return getStatusDescription(serviceStatusCallback);\n+  }\n+\n+  public static String getStatusDescription(String name) {\n+    if (serviceStatusCallbackMap.containsKey(name)) {\n+      return getStatusDescription(serviceStatusCallbackMap.get(name));\n+    } else {\n+      return STATUS_DESCRIPTION_NONE;\n+    }\n+  }\n+\n+  private static String getStatusDescription(ServiceStatusCallback callback) {\n+    try {\n+      return callback.getStatusDescription();\n+    } catch (Exception e) {\n+      return \"Exception: \" + e.getMessage();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1MTQ5NQ=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTE1ODk3OnYy", "diffSide": "RIGHT", "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/ServiceStatus.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNjoxNTowMVrOGTjYrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwODowMDozMFrOGa9zsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1NTg4NQ==", "bodyText": "We add it to the map when we call start() and remove it from the map when we call stop(). So,  the status here can either be NOT_STARTED, or SHUTTING_DOWN.\nI suggest you add it to the map in the constructor, and return SHUTTING_DOWN here once you remove from the map.", "url": "https://github.com/apache/pinot/pull/5266#discussion_r423155885", "createdAt": "2020-05-11T16:15:01Z", "author": {"login": "mcvsubbu"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/ServiceStatus.java", "diffHunk": "@@ -43,17 +44,79 @@\n  */\n @SuppressWarnings(\"unused\")\n public class ServiceStatus {\n+  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n+  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n+  public static final String STATUS_DESCRIPTION_STARTED = \"Started\";\n+  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n   private static final Logger LOGGER = LoggerFactory.getLogger(ServiceStatus.class);\n+  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  private static final Map<String, ServiceStatusCallback> serviceStatusCallbackMap = new ConcurrentHashMap<>();\n+  private static final ServiceStatusCallback serviceStatusCallback =\n+      new MapBasedMultipleCallbackServiceStatusCallback(serviceStatusCallbackMap);\n \n-  public enum Status {\n-    STARTING, GOOD, BAD\n+  public static void setServiceStatusCallback(String name, ServiceStatusCallback serviceStatusCallback) {\n+    ServiceStatus.serviceStatusCallbackMap.put(name, serviceStatusCallback);\n   }\n \n-  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n-  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n-  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n+  public static void removeServiceStatusCallback(String name) {\n+    ServiceStatus.serviceStatusCallbackMap.remove(name);\n+  }\n \n-  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  public static Status getServiceStatus() {\n+    return getServiceStatus(serviceStatusCallback);\n+  }\n+\n+  public static Status getServiceStatus(String name) {\n+    if (serviceStatusCallbackMap.containsKey(name)) {\n+      return getServiceStatus(serviceStatusCallbackMap.get(name));\n+    } else {\n+      return Status.NOT_STARTED;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEyMzI1Ng==", "bodyText": "We  have status of NOT_STARTED, STARTING, GOOD, BAD for now.\nI feel it's ok to say NOT_STARTED after we stop an instance, as it's still possible to start a new instance later on.", "url": "https://github.com/apache/pinot/pull/5266#discussion_r429123256", "createdAt": "2020-05-22T08:49:19Z", "author": {"login": "xiangfu0"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/ServiceStatus.java", "diffHunk": "@@ -43,17 +44,79 @@\n  */\n @SuppressWarnings(\"unused\")\n public class ServiceStatus {\n+  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n+  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n+  public static final String STATUS_DESCRIPTION_STARTED = \"Started\";\n+  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n   private static final Logger LOGGER = LoggerFactory.getLogger(ServiceStatus.class);\n+  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  private static final Map<String, ServiceStatusCallback> serviceStatusCallbackMap = new ConcurrentHashMap<>();\n+  private static final ServiceStatusCallback serviceStatusCallback =\n+      new MapBasedMultipleCallbackServiceStatusCallback(serviceStatusCallbackMap);\n \n-  public enum Status {\n-    STARTING, GOOD, BAD\n+  public static void setServiceStatusCallback(String name, ServiceStatusCallback serviceStatusCallback) {\n+    ServiceStatus.serviceStatusCallbackMap.put(name, serviceStatusCallback);\n   }\n \n-  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n-  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n-  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n+  public static void removeServiceStatusCallback(String name) {\n+    ServiceStatus.serviceStatusCallbackMap.remove(name);\n+  }\n \n-  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  public static Status getServiceStatus() {\n+    return getServiceStatus(serviceStatusCallback);\n+  }\n+\n+  public static Status getServiceStatus(String name) {\n+    if (serviceStatusCallbackMap.containsKey(name)) {\n+      return getServiceStatus(serviceStatusCallbackMap.get(name));\n+    } else {\n+      return Status.NOT_STARTED;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1NTg4NQ=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDgzODE5MQ==", "bodyText": "But then the shut down sequence is not instantaneous. You call shutdown and then wait for it to shutdown. During that time, the status should be SHUTTING_DOWN. And then you can change it to NOT_STARTED when the shutdown is complete.", "url": "https://github.com/apache/pinot/pull/5266#discussion_r430838191", "createdAt": "2020-05-27T03:32:38Z", "author": {"login": "mcvsubbu"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/ServiceStatus.java", "diffHunk": "@@ -43,17 +44,79 @@\n  */\n @SuppressWarnings(\"unused\")\n public class ServiceStatus {\n+  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n+  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n+  public static final String STATUS_DESCRIPTION_STARTED = \"Started\";\n+  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n   private static final Logger LOGGER = LoggerFactory.getLogger(ServiceStatus.class);\n+  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  private static final Map<String, ServiceStatusCallback> serviceStatusCallbackMap = new ConcurrentHashMap<>();\n+  private static final ServiceStatusCallback serviceStatusCallback =\n+      new MapBasedMultipleCallbackServiceStatusCallback(serviceStatusCallbackMap);\n \n-  public enum Status {\n-    STARTING, GOOD, BAD\n+  public static void setServiceStatusCallback(String name, ServiceStatusCallback serviceStatusCallback) {\n+    ServiceStatus.serviceStatusCallbackMap.put(name, serviceStatusCallback);\n   }\n \n-  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n-  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n-  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n+  public static void removeServiceStatusCallback(String name) {\n+    ServiceStatus.serviceStatusCallbackMap.remove(name);\n+  }\n \n-  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  public static Status getServiceStatus() {\n+    return getServiceStatus(serviceStatusCallback);\n+  }\n+\n+  public static Status getServiceStatus(String name) {\n+    if (serviceStatusCallbackMap.containsKey(name)) {\n+      return getServiceStatus(serviceStatusCallbackMap.get(name));\n+    } else {\n+      return Status.NOT_STARTED;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1NTg4NQ=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkyODgxNw==", "bodyText": "Got it. Added SHUTTING_DOWN status.\nMy feeling is that during shutting down phase, the getServiceStatus(serviceStatusCallbackMap.get(name)) should return SHUTTING_DOWN.\nOnce server is completely shutdown, it will be removed from the serviceStatusCallbackMap so the status will be NOT_STARTED", "url": "https://github.com/apache/pinot/pull/5266#discussion_r430928817", "createdAt": "2020-05-27T08:00:30Z", "author": {"login": "xiangfu0"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/utils/ServiceStatus.java", "diffHunk": "@@ -43,17 +44,79 @@\n  */\n @SuppressWarnings(\"unused\")\n public class ServiceStatus {\n+  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n+  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n+  public static final String STATUS_DESCRIPTION_STARTED = \"Started\";\n+  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n   private static final Logger LOGGER = LoggerFactory.getLogger(ServiceStatus.class);\n+  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  private static final Map<String, ServiceStatusCallback> serviceStatusCallbackMap = new ConcurrentHashMap<>();\n+  private static final ServiceStatusCallback serviceStatusCallback =\n+      new MapBasedMultipleCallbackServiceStatusCallback(serviceStatusCallbackMap);\n \n-  public enum Status {\n-    STARTING, GOOD, BAD\n+  public static void setServiceStatusCallback(String name, ServiceStatusCallback serviceStatusCallback) {\n+    ServiceStatus.serviceStatusCallbackMap.put(name, serviceStatusCallback);\n   }\n \n-  public static final String STATUS_DESCRIPTION_NONE = \"None\";\n-  public static final String STATUS_DESCRIPTION_INIT = \"Init\";\n-  public static final String STATUS_DESCRIPTION_NO_HELIX_STATE = \"Helix state does not exist\";\n+  public static void removeServiceStatusCallback(String name) {\n+    ServiceStatus.serviceStatusCallbackMap.remove(name);\n+  }\n \n-  private static final int MAX_RESOURCE_NAMES_TO_LOG = 5;\n+  public static Status getServiceStatus() {\n+    return getServiceStatus(serviceStatusCallback);\n+  }\n+\n+  public static Status getServiceStatus(String name) {\n+    if (serviceStatusCallbackMap.containsKey(name)) {\n+      return getServiceStatus(serviceStatusCallbackMap.get(name));\n+    } else {\n+      return Status.NOT_STARTED;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1NTg4NQ=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNjkwMjg3OnYy", "diffSide": "RIGHT", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/services/ServiceRole.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMzoxMzoyN1rOGT0iQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMzoxMzoyN1rOGT0iQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQzNjg2NQ==", "bodyText": "Let's enhance this by saying these are the roles that a node in pinot cluster can take?", "url": "https://github.com/apache/pinot/pull/5266#discussion_r423436865", "createdAt": "2020-05-12T03:13:27Z", "author": {"login": "siddharthteotia"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/services/ServiceRole.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.services;\n+\n+/**\n+ * ServiceRole defines a role that Pinot Service could start/stop.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNjkxNjkwOnYy", "diffSide": "RIGHT", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/services/ServiceStartable.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMzoyMjo0MVrOGT0rAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxOTozMjo0MlrOGZh2VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQzOTEwNQ==", "bodyText": "Can we just have this as Service or may be StartableService?", "url": "https://github.com/apache/pinot/pull/5266#discussion_r423439105", "createdAt": "2020-05-12T03:22:41Z", "author": {"login": "siddharthteotia"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/services/ServiceStartable.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.services;\n+\n+import org.apache.commons.configuration.Configuration;\n+\n+\n+/**\n+ * ServiceStartable is the general interface to manage a Pinot instance lifecycle for a specific ServiceRole.\n+ * E.g. Controller/Broker/Server/Minion.\n+ *\n+ */\n+public interface ServiceStartable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyMjE2NQ==", "bodyText": "Changed to StartableService", "url": "https://github.com/apache/pinot/pull/5266#discussion_r429422165", "createdAt": "2020-05-22T19:32:42Z", "author": {"login": "xiangfu0"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/services/ServiceStartable.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.services;\n+\n+import org.apache.commons.configuration.Configuration;\n+\n+\n+/**\n+ * ServiceStartable is the general interface to manage a Pinot instance lifecycle for a specific ServiceRole.\n+ * E.g. Controller/Broker/Server/Minion.\n+ *\n+ */\n+public interface ServiceStartable {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQzOTEwNQ=="}, "originalCommit": {"oid": "80a943501464d983396ae935b1ca7061d94ade37"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3418, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}