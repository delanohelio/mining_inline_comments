{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MTA1OTYy", "number": 5930, "title": "[TE] ThirdEye User Configuration Validation - detection and subscription yaml", "bodyText": "ThirdEye uses YAML files to manage the configuration of alerts and subscription groups. This approach enables employees across engineering and non-engineering, to configure simple to complex rules in an efficient way. However, mistakes in such files are easily made. These mistakes could lead to detection/subscription errors and fail to detect & notify a critical anomaly.\nThis PR tackles and addresses this issue by introducing schema based validations on user configs. I have used the json-schema-validator to achieve this. You will find the validation schema defined in detection-config-schema.json and subscription-config-schema.json\nChanges:\n\nRefactored the validation interfaces with - static and semantic validation\nIntroduced the json schema based validation of detection and subscription config\n\nTests:\n\nAdded unit testing of configs\nDeployed and tested locally if the validation messages are displayed to the user", "createdAt": "2020-08-26T19:22:30Z", "url": "https://github.com/apache/pinot/pull/5930", "merged": true, "mergeCommit": {"oid": "1b38909de87326f92498f22c4f6b9ec81a0dbb2d"}, "closed": true, "closedAt": "2020-08-26T22:44:31Z", "author": {"login": "akshayrai"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCwxx7AH2gAyNDc0MTA1OTYyOjA1YjM4MDc0YjA0YzRjMzAwODNkYTM3ZjZmYzNlNTY1NTQ5YzVhMDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCzklSAFqTQ3NTk2MzMxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "05b38074b04c4c30083da37f6fc3e565549c5a06", "author": {"user": {"login": "akshayrai", "name": "Akshay Rai"}}, "url": "https://github.com/apache/pinot/commit/05b38074b04c4c30083da37f6fc3e565549c5a06", "committedDate": "2020-08-26T19:14:54Z", "message": "[TE] ThirdEye User Config (Yaml) Validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1OTUwNTc2", "url": "https://github.com/apache/pinot/pull/5930#pullrequestreview-475950576", "createdAt": "2020-08-26T22:26:15Z", "commit": {"oid": "05b38074b04c4c30083da37f6fc3e565549c5a06"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1OTU3MjEy", "url": "https://github.com/apache/pinot/pull/5930#pullrequestreview-475957212", "createdAt": "2020-08-26T22:28:19Z", "commit": {"oid": "05b38074b04c4c30083da37f6fc3e565549c5a06"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMjoyODoxOVrOHHf3lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMjoyODoxOVrOHHf3lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYyNDIxNA==", "bodyText": "shall the rule type be an enum?", "url": "https://github.com/apache/pinot/pull/5930#discussion_r477624214", "createdAt": "2020-08-26T22:28:19Z", "author": {"login": "jihaozh"}, "path": "thirdeye/thirdeye-pinot/src/main/resources/validators/detection/detection-config-schema.json", "diffHunk": "@@ -0,0 +1,214 @@\n+{\n+  \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n+  \"title\": \"Detection Config Schema\",\n+\n+  \"type\": \"object\",\n+  \"description\": \"YAML representation of metric or composite detection config\",\n+\n+  \"required\": [ \"detectionName\" ],\n+\n+  \"properties\": {\n+    \"detectionName\": {\n+      \"type\": \"string\"\n+    },\n+    \"description\": {\n+      \"type\": \"string\"\n+    },\n+    \"type\": {\n+      \"type\": \"string\",\n+      \"description\": \"detection pipeline type\",\n+      \"enum\": [\n+        \"METRIC_ALERT\",\n+        \"COMPOSITE_ALERT\"\n+      ]\n+    },\n+    \"metric\": {\n+      \"type\": \"string\"\n+    },\n+    \"dataset\": {\n+      \"type\": \"string\"\n+    },\n+    \"active\": {\n+      \"type\": \"boolean\"\n+    },\n+    \"cron\": {\n+      \"type\": \"string\"\n+    },\n+    \"filters\": {\n+      \"$ref\": \"#/definitions/filters\"\n+    },\n+    \"dimensionExploration\": {\n+      \"$ref\": \"#/definitions/dimensionExploration\"\n+    },\n+    \"rules\": {\n+      \"$ref\": \"#/definitions/rules\"\n+    },\n+    \"alerts\": {\n+      \"$ref\": \"#/definitions/alerts\"\n+    },\n+    \"merger\": {\n+      \"$ref\": \"#/definitions/merger\"\n+    },\n+    \"grouper\": {\n+      \"$ref\": \"#/definitions/grouper\"\n+    }\n+  },\n+\n+  \"definitions\": {\n+    \"alerts\": {\n+      \"type\": \"array\",\n+      \"items\": {\n+        \"$ref\": \"#/definitions/subEntity\"\n+      }\n+    },\n+\n+    \"subEntity\": {\n+      \"type\": \"object\",\n+      \"description\": \"a sub-entity detection config\",\n+      \"required\": [ \"name\", \"type\" ],\n+      \"properties\": {\n+        \"name\": {\n+          \"type\": \"string\"\n+        },\n+        \"description\": {\n+          \"type\": \"string\"\n+        },\n+        \"type\": {\n+          \"type\": \"string\",\n+          \"description\": \"detection pipeline type\",\n+          \"enum\": [\n+            \"COMPOSITE_ALERT\",\n+            \"METRIC_ALERT\"\n+          ]\n+        },\n+        \"alerts\": {\n+          \"$ref\": \"#/definitions/alerts\"\n+        },\n+        \"metric\": {\n+          \"type\": \"string\"\n+        },\n+        \"dataset\": {\n+          \"type\": \"string\"\n+        },\n+        \"filters\": {\n+          \"$ref\": \"#/definitions/filters\"\n+        },\n+        \"dimensionExploration\": {\n+          \"$ref\": \"#/definitions/dimensionExploration\"\n+        },\n+        \"rules\": {\n+          \"$ref\": \"#/definitions/rules\"\n+        },\n+        \"merger\": {\n+          \"$ref\": \"#/definitions/merger\"\n+        },\n+        \"grouper\": {\n+          \"$ref\": \"#/definitions/grouper\"\n+        }\n+      },\n+      \"additionalProperties\": false\n+    },\n+\n+    \"dimensionExploration\": {\n+      \"type\": \"object\",\n+      \"description\": \"exploration combination of dimension values\",\n+      \"properties\": {\n+        \"dimensions\": {\n+          \"type\": \"array\",\n+          \"description\": \"dimension column names\",\n+          \"items\": {\n+            \"type\": \"string\"\n+          }\n+        },\n+        \"dimensionFilterMetric\": {\n+          \"type\": \"string\"\n+        }\n+      },\n+      \"patternProperties\": {\n+        \"k|minValue|minContribution|minValueHourly|maxValueHourly|minValueDaily|maxValueDaily\": {\n+          \"type\": \"number\"\n+        }\n+      },\n+      \"additionalProperties\": false\n+    },\n+\n+    \"filters\": {\n+      \"type\": \"object\",\n+      \"description\": \"dimension filters\",\n+      \"patternProperties\": {\n+        \".*\": {\n+          \"type\": \"array\",\n+          \"description\": \"dimension filter values\",\n+          \"items\": {\n+            \"type\": \"string\"\n+          }\n+        }\n+      }\n+    },\n+\n+    \"eachComponent\": {\n+      \"type\": \"array\",\n+      \"items\": {\n+        \"type\": \"object\",\n+        \"required\": [ \"type\", \"name\" ],\n+        \"properties\": {\n+          \"type\": {\n+            \"type\": \"string\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05b38074b04c4c30083da37f6fc3e565549c5a06"}, "originalPosition": 156}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1OTYzMzEx", "url": "https://github.com/apache/pinot/pull/5930#pullrequestreview-475963311", "createdAt": "2020-08-26T22:30:12Z", "commit": {"oid": "05b38074b04c4c30083da37f6fc3e565549c5a06"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMjozMDoxMlrOHHf6eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMjozMDoxMlrOHHf6eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzYyNDk1Mw==", "bodyText": "shall the subscription group type be an enum type?", "url": "https://github.com/apache/pinot/pull/5930#discussion_r477624953", "createdAt": "2020-08-26T22:30:12Z", "author": {"login": "jihaozh"}, "path": "thirdeye/thirdeye-pinot/src/main/resources/validators/subscription/subscription-config-schema.json", "diffHunk": "@@ -0,0 +1,110 @@\n+{\n+  \"$schema\": \"http://json-schema.org/draft-04/schema#\",\n+  \"title\": \"Subscription Config Schema\",\n+\n+  \"type\": \"object\",\n+  \"description\": \"YAML representation of a subscription group config\",\n+  \"required\": [ \"subscriptionGroupName\", \"subscribedDetections\", \"application\", \"alertSchemes\" ],\n+\n+  \"properties\": {\n+    \"subscriptionGroupName\": {\n+      \"type\": \"string\"\n+    },\n+    \"application\": {\n+      \"type\": \"string\"\n+    },\n+    \"type\": {\n+      \"type\": \"string\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05b38074b04c4c30083da37f6fc3e565549c5a06"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 287, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}