{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NDIzMDY4", "number": 5155, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDo1NTowNVrODof4xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDo1NzowNVrODof7XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzkyMDcxOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/model/download/ModelDownloaderManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDo1NTowNVrOF3Fbqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxOTowNDo1M1rOF3qJbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwNTAwMg==", "bodyText": "nit: license header", "url": "https://github.com/apache/pinot/pull/5155#discussion_r393305002", "createdAt": "2020-03-16T20:55:05Z", "author": {"login": "akshayrai"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/model/download/ModelDownloaderManager.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package org.apache.pinot.thirdeye.model.download;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a031ae1c7a4a1d3e1f6c732b8d06531fb073a4"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwNjU0Mw==", "bodyText": "added", "url": "https://github.com/apache/pinot/pull/5155#discussion_r393906543", "createdAt": "2020-03-17T19:04:53Z", "author": {"login": "jihaozh"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/model/download/ModelDownloaderManager.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package org.apache.pinot.thirdeye.model.download;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwNTAwMg=="}, "originalCommit": {"oid": "90a031ae1c7a4a1d3e1f6c732b8d06531fb073a4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzkyNzMzOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/model/download/ModelDownloaderManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMDo1NzowNVrOF3FfzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMToyMzowOFrOF3GObQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwNjA2MQ==", "bodyText": "Where will this run? every worker?", "url": "https://github.com/apache/pinot/pull/5155#discussion_r393306061", "createdAt": "2020-03-16T20:57:05Z", "author": {"login": "akshayrai"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/model/download/ModelDownloaderManager.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package org.apache.pinot.thirdeye.model.download;\n+\n+import java.lang.reflect.Constructor;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import org.apache.pinot.thirdeye.auto.onboard.AutoOnboardService;\n+import org.apache.pinot.thirdeye.common.time.TimeGranularity;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+/**\n+ * The model downloader manager. This class manages the life cycle of the model downloader.\n+ * It constructs the model downloader, and then schedules the model downloader to run periodically and downloads the\n+ * models into a local destination path. The class names, the run frequency and the download path can be configured.\n+ */\n+public class ModelDownloaderManager {\n+  private static final Logger LOG = LoggerFactory.getLogger(AutoOnboardService.class);\n+\n+  private final List<ModelDownloaderConfiguration> configs;\n+  private final Map<String, ModelDownloader> modelDownloaders;\n+  private ScheduledExecutorService scheduledExecutorService;\n+\n+  public ModelDownloaderManager(List<ModelDownloaderConfiguration> modelDownloaderConfigs) {\n+    this.configs = modelDownloaderConfigs;\n+    this.modelDownloaders = new HashMap<>();\n+    this.scheduledExecutorService = Executors.newScheduledThreadPool(5);\n+\n+    constructModelDownloaders();\n+  }\n+\n+  private void constructModelDownloaders() {\n+    for (ModelDownloaderConfiguration config : this.configs) {\n+      try {\n+        Constructor<?> constructor = Class.forName(config.getClassName()).getConstructor(Map.class);\n+        ModelDownloader downloader = (ModelDownloader) constructor.newInstance(config.getProperties());\n+        this.modelDownloaders.put(config.getClassName(), downloader);\n+      } catch (Exception e) {\n+        LOG.warn(\"Failed to initialize model downloader {}\", config.getClassName(), e);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * start the model downloader manager\n+   */\n+  public void start() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a031ae1c7a4a1d3e1f6c732b8d06531fb073a4"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMxNzk5Nw==", "bodyText": "yes. every worker that needs to run the model", "url": "https://github.com/apache/pinot/pull/5155#discussion_r393317997", "createdAt": "2020-03-16T21:23:08Z", "author": {"login": "jihaozh"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/model/download/ModelDownloaderManager.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package org.apache.pinot.thirdeye.model.download;\n+\n+import java.lang.reflect.Constructor;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import org.apache.pinot.thirdeye.auto.onboard.AutoOnboardService;\n+import org.apache.pinot.thirdeye.common.time.TimeGranularity;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+/**\n+ * The model downloader manager. This class manages the life cycle of the model downloader.\n+ * It constructs the model downloader, and then schedules the model downloader to run periodically and downloads the\n+ * models into a local destination path. The class names, the run frequency and the download path can be configured.\n+ */\n+public class ModelDownloaderManager {\n+  private static final Logger LOG = LoggerFactory.getLogger(AutoOnboardService.class);\n+\n+  private final List<ModelDownloaderConfiguration> configs;\n+  private final Map<String, ModelDownloader> modelDownloaders;\n+  private ScheduledExecutorService scheduledExecutorService;\n+\n+  public ModelDownloaderManager(List<ModelDownloaderConfiguration> modelDownloaderConfigs) {\n+    this.configs = modelDownloaderConfigs;\n+    this.modelDownloaders = new HashMap<>();\n+    this.scheduledExecutorService = Executors.newScheduledThreadPool(5);\n+\n+    constructModelDownloaders();\n+  }\n+\n+  private void constructModelDownloaders() {\n+    for (ModelDownloaderConfiguration config : this.configs) {\n+      try {\n+        Constructor<?> constructor = Class.forName(config.getClassName()).getConstructor(Map.class);\n+        ModelDownloader downloader = (ModelDownloader) constructor.newInstance(config.getProperties());\n+        this.modelDownloaders.put(config.getClassName(), downloader);\n+      } catch (Exception e) {\n+        LOG.warn(\"Failed to initialize model downloader {}\", config.getClassName(), e);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * start the model downloader manager\n+   */\n+  public void start() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMwNjA2MQ=="}, "originalCommit": {"oid": "90a031ae1c7a4a1d3e1f6c732b8d06531fb073a4"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3533, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}