{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NDA0Mzkw", "number": 4960, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMDo0MTowNlrODWFJ-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMDo0MTowNlrODWFJ-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NDc5NzM5OnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/components/ThresholdRuleDetector.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMDo0MTowNlrOFaopNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNzozMToyMVrOFaxpyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ3MzIwNw==", "bodyText": "Why we want to change the baseline value?\nIf it is threshold algorithm we should not show upper/lower bounds.\nPlease take a look at this doc: https://docs.google.com/document/d/12bE6e_fIbk3pp0oPCrOHOPFid4NEMguZ-dF3IVjF3xQ/edit", "url": "https://github.com/apache/pinot/pull/4960#discussion_r363473207", "createdAt": "2020-01-06T20:41:06Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/components/ThresholdRuleDetector.java", "diffHunk": "@@ -101,15 +100,24 @@ public TimeSeries computePredictedTimeSeries(MetricSlice slice) {\n     InputData data =\n         this.dataFetcher.fetchData(new InputDataSpec().withTimeseriesSlices(Collections.singletonList(slice)));\n     DataFrame df = data.getTimeseries().get(slice);\n-    return TimeSeries.fromDataFrame(constructThresholdBoundaries(df));\n+    return TimeSeries.fromDataFrame(constructBaselineAndBoundaries(df));\n   }\n \n-  private DataFrame constructThresholdBoundaries(DataFrame df) {\n+  /**\n+   * Populate the dataframe with upper/lower boundaries and baseline\n+   */\n+  private DataFrame constructBaselineAndBoundaries(DataFrame df) {\n+    // Set default baseline as the actual value\n+    df.addSeries(COL_VALUE, df.getDoubles(COL_CURRENT));\n     if (!Double.isNaN(this.min)) {\n       df.addSeries(COL_LOWER_BOUND, DoubleSeries.fillValues(df.size(), this.min));\n+      // set baseline value as the lower bound when actual value across below the mark\n+      df.mapInPlace(DoubleSeries.MAX, COL_VALUE, COL_LOWER_BOUND, COL_VALUE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c371b4b2aa3ab7c2cfe4f0c7c131ca467b2dcce"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYyMDgxMA==", "bodyText": "Why we want to change the baseline value?\nI updated the description. Pls take a look there. This is addressing user ticket APA-11365. This PR is not proposing any changes to upper/lower bounds.", "url": "https://github.com/apache/pinot/pull/4960#discussion_r363620810", "createdAt": "2020-01-07T07:31:21Z", "author": {"login": "akshayrai"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/components/ThresholdRuleDetector.java", "diffHunk": "@@ -101,15 +100,24 @@ public TimeSeries computePredictedTimeSeries(MetricSlice slice) {\n     InputData data =\n         this.dataFetcher.fetchData(new InputDataSpec().withTimeseriesSlices(Collections.singletonList(slice)));\n     DataFrame df = data.getTimeseries().get(slice);\n-    return TimeSeries.fromDataFrame(constructThresholdBoundaries(df));\n+    return TimeSeries.fromDataFrame(constructBaselineAndBoundaries(df));\n   }\n \n-  private DataFrame constructThresholdBoundaries(DataFrame df) {\n+  /**\n+   * Populate the dataframe with upper/lower boundaries and baseline\n+   */\n+  private DataFrame constructBaselineAndBoundaries(DataFrame df) {\n+    // Set default baseline as the actual value\n+    df.addSeries(COL_VALUE, df.getDoubles(COL_CURRENT));\n     if (!Double.isNaN(this.min)) {\n       df.addSeries(COL_LOWER_BOUND, DoubleSeries.fillValues(df.size(), this.min));\n+      // set baseline value as the lower bound when actual value across below the mark\n+      df.mapInPlace(DoubleSeries.MAX, COL_VALUE, COL_LOWER_BOUND, COL_VALUE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ3MzIwNw=="}, "originalCommit": {"oid": "9c371b4b2aa3ab7c2cfe4f0c7c131ca467b2dcce"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3557, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}