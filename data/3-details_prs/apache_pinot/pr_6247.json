{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MDA5Nzk4", "number": 6247, "title": "Add stream and batch to ingestionConfig", "bodyText": "Description\n#6242\nMoving streamConfigs to the ingestionConfig.\nAdding batchConfig, very similar to streamConfig into the ingestionConfig.\nMoved segmentPushType and segmentPushFrequency to the batchConfig.\nRelease Notes\nMoved streamConfigs to ingestionConfigs.\nAdded batchConfigs, which are very similar to streamConfigs, but for batch sources.\nDeprecated indexingConfig -> streamConfigs, segmentsConfig -> segmentPushType and segmentsConfig -> segmentPushFrequency.", "createdAt": "2020-11-06T22:29:35Z", "url": "https://github.com/apache/pinot/pull/6247", "merged": true, "mergeCommit": {"oid": "9eaea998fc74d4b66f5dc9ea6c2de9b8f758aae5"}, "closed": true, "closedAt": "2020-11-18T04:02:48Z", "author": {"login": "npawar"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbmD2HgFqTUyODU5Mzc4OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddifEmgH2gAyNTE3MDA5Nzk4OmJmZDUxOTNiZDU2ZTdjNDQ5NmE1YTdlYjJmNGIwZjVjZmM0YmYwMGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NTkzNzg4", "url": "https://github.com/apache/pinot/pull/6247#pullrequestreview-528593788", "createdAt": "2020-11-11T22:53:47Z", "commit": {"oid": "983ec268de7655b9223ef430a0ee0399cff8abe0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMjo1Mzo0N1rOHxhOUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMjo1Mzo0N1rOHxhOUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY4NjYxMQ==", "bodyText": "one high level question: shall we keep this utils method in pinot-core or we should move it to pinot-spi or pinot-common?", "url": "https://github.com/apache/pinot/pull/6247#discussion_r521686611", "createdAt": "2020-11-11T22:53:47Z", "author": {"login": "xiangfu0"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/util/IngestionUtils.java", "diffHunk": "@@ -114,4 +122,68 @@ public static Long extractTimeValue(Comparable time) {\n     }\n     return null;\n   }\n+\n+  /**\n+   * Fetches the streamConfig from the given realtime table.\n+   * First, the ingestionConfigs->stream->streamConfigs will be checked.\n+   * If not found, the indexingConfig->streamConfigs will be checked (which is deprecated).\n+   * @param tableConfig realtime table config\n+   * @return streamConfigs map\n+   */\n+  public static Map<String, String> getStreamConfigsMap(TableConfig tableConfig) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "983ec268de7655b9223ef430a0ee0399cff8abe0"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbe127638dbd7de657b6a65eabe376c55666d7da", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/fbe127638dbd7de657b6a65eabe376c55666d7da", "committedDate": "2020-11-11T23:31:43Z", "message": "Add stream and batch to ingestionConfig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af6449c9d915abdf22a8483077f139e4801f873a", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/af6449c9d915abdf22a8483077f139e4801f873a", "committedDate": "2020-11-11T23:31:43Z", "message": "streamConfigs json propertu name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "983ec268de7655b9223ef430a0ee0399cff8abe0", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/983ec268de7655b9223ef430a0ee0399cff8abe0", "committedDate": "2020-11-06T22:46:53Z", "message": "streamConfigs json propertu name"}, "afterCommit": {"oid": "af6449c9d915abdf22a8483077f139e4801f873a", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/af6449c9d915abdf22a8483077f139e4801f873a", "committedDate": "2020-11-11T23:31:43Z", "message": "streamConfigs json propertu name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NjE0MzAy", "url": "https://github.com/apache/pinot/pull/6247#pullrequestreview-528614302", "createdAt": "2020-11-11T23:33:13Z", "commit": {"oid": "983ec268de7655b9223ef430a0ee0399cff8abe0"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMzozODowOVrOHxiYKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwMToxMTo0M1rOHxlcvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTcwNTUxMg==", "bodyText": "verifyStreamConfig()? We might want to add more checks in the future", "url": "https://github.com/apache/pinot/pull/6247#discussion_r521705512", "createdAt": "2020-11-11T23:38:09Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/PinotHelixResourceManager.java", "diffHunk": "@@ -1307,9 +1307,9 @@ public void registerPinotLLCRealtimeSegmentManager(PinotLLCRealtimeSegmentManage\n     _pinotLLCRealtimeSegmentManager = pinotLLCRealtimeSegmentManager;\n   }\n \n-  private void verifyIndexingConfig(String tableNameWithType, IndexingConfig indexingConfig) {\n+  private void checkForHLC(String tableNameWithType, TableConfig tableConfig) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af6449c9d915abdf22a8483077f139e4801f873a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTcwODU4NQ==", "bodyText": "+1 on moving this to spi. Maybe adding an IngestionConfigUtils class for the backward-compatibility handling", "url": "https://github.com/apache/pinot/pull/6247#discussion_r521708585", "createdAt": "2020-11-11T23:45:57Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/util/IngestionUtils.java", "diffHunk": "@@ -114,4 +122,68 @@ public static Long extractTimeValue(Comparable time) {\n     }\n     return null;\n   }\n+\n+  /**\n+   * Fetches the streamConfig from the given realtime table.\n+   * First, the ingestionConfigs->stream->streamConfigs will be checked.\n+   * If not found, the indexingConfig->streamConfigs will be checked (which is deprecated).\n+   * @param tableConfig realtime table config\n+   * @return streamConfigs map\n+   */\n+  public static Map<String, String> getStreamConfigsMap(TableConfig tableConfig) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY4NjYxMQ=="}, "originalCommit": {"oid": "983ec268de7655b9223ef430a0ee0399cff8abe0"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTcxMDYxMA==", "bodyText": "(nit)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public static Map<String, String> getStreamConfigsMap(TableConfig tableConfig) {\n          \n          \n            \n              public static Map<String, String> getStreamConfigMap(TableConfig tableConfig) {", "url": "https://github.com/apache/pinot/pull/6247#discussion_r521710610", "createdAt": "2020-11-11T23:52:08Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/util/IngestionUtils.java", "diffHunk": "@@ -114,4 +122,68 @@ public static Long extractTimeValue(Comparable time) {\n     }\n     return null;\n   }\n+\n+  /**\n+   * Fetches the streamConfig from the given realtime table.\n+   * First, the ingestionConfigs->stream->streamConfigs will be checked.\n+   * If not found, the indexingConfig->streamConfigs will be checked (which is deprecated).\n+   * @param tableConfig realtime table config\n+   * @return streamConfigs map\n+   */\n+  public static Map<String, String> getStreamConfigsMap(TableConfig tableConfig) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af6449c9d915abdf22a8483077f139e4801f873a"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc1MjQ2OQ==", "bodyText": "Suggest renaming it to BatchIngestionConfig. Batch can cause confusion IMO", "url": "https://github.com/apache/pinot/pull/6247#discussion_r521752469", "createdAt": "2020-11-12T01:04:27Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/ingestion/Batch.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config.table.ingestion;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonPropertyDescription;\n+import java.util.List;\n+import java.util.Map;\n+import javax.annotation.Nullable;\n+import org.apache.pinot.spi.config.BaseJsonConfig;\n+\n+\n+/**\n+ * Contains all configs related to the batch sources for ingestion.\n+ */\n+public class Batch extends BaseJsonConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af6449c9d915abdf22a8483077f139e4801f873a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc1MjY4OQ==", "bodyText": "Suggest renaming it to StreamIngestionConfig", "url": "https://github.com/apache/pinot/pull/6247#discussion_r521752689", "createdAt": "2020-11-12T01:04:47Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/ingestion/Stream.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config.table.ingestion;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonPropertyDescription;\n+import java.util.List;\n+import java.util.Map;\n+import javax.annotation.Nullable;\n+import org.apache.pinot.spi.config.BaseJsonConfig;\n+\n+\n+/**\n+ * Contains all the configs related to the streams for ingestion\n+ */\n+public class Stream extends BaseJsonConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af6449c9d915abdf22a8483077f139e4801f873a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc1NTUwOA==", "bodyText": "Don't make the argument nullable. If batch ingestion config is provided, these fields should not be null. This can simplify the null handling", "url": "https://github.com/apache/pinot/pull/6247#discussion_r521755508", "createdAt": "2020-11-12T01:10:26Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/ingestion/Batch.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config.table.ingestion;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonPropertyDescription;\n+import java.util.List;\n+import java.util.Map;\n+import javax.annotation.Nullable;\n+import org.apache.pinot.spi.config.BaseJsonConfig;\n+\n+\n+/**\n+ * Contains all configs related to the batch sources for ingestion.\n+ */\n+public class Batch extends BaseJsonConfig {\n+\n+  @JsonPropertyDescription(\"Configs for all the batch sources to ingest from\")\n+  private final List<Map<String, String>> _batchConfigs;\n+\n+  @JsonPropertyDescription(\"Push type APPEND or REFRESH\")\n+  private final String _segmentPushType;\n+\n+  @JsonPropertyDescription(\"Push frequency HOURLY or DAILY\")\n+  private final String _segmentPushFrequency;\n+\n+  @JsonCreator\n+  public Batch(@JsonProperty(\"batchConfigs\") @Nullable List<Map<String, String>> batchConfigs,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af6449c9d915abdf22a8483077f139e4801f873a"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc1NTgzOA==", "bodyText": "streamConfigs should not be null if stream ingestion config is provided. Also suggest renaming it to streamConfigMaps to differentiate it from StreamConfig", "url": "https://github.com/apache/pinot/pull/6247#discussion_r521755838", "createdAt": "2020-11-12T01:11:43Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/ingestion/Stream.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config.table.ingestion;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonPropertyDescription;\n+import java.util.List;\n+import java.util.Map;\n+import javax.annotation.Nullable;\n+import org.apache.pinot.spi.config.BaseJsonConfig;\n+\n+\n+/**\n+ * Contains all the configs related to the streams for ingestion\n+ */\n+public class Stream extends BaseJsonConfig {\n+\n+  @JsonPropertyDescription(\"All configs for the streams from which to ingest\")\n+  private final List<Map<String, String>> _streamConfigs;\n+\n+  @JsonCreator\n+  public Stream(@JsonProperty(\"streamConfigs\") @Nullable List<Map<String, String>> streamConfigs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af6449c9d915abdf22a8483077f139e4801f873a"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3829b085a063ec82c0dc3ce5da8ebf2a94e2567", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/b3829b085a063ec82c0dc3ce5da8ebf2a94e2567", "committedDate": "2020-11-12T19:24:15Z", "message": "Review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78edfcc03f84991e1968cf7877855e3cad74fcfb", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/78edfcc03f84991e1968cf7877855e3cad74fcfb", "committedDate": "2020-11-12T19:34:48Z", "message": "s/getStream/getStreamIngestionConfig in integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/7591172003e34e61426e1b3e0437dcdbe1aa3057", "committedDate": "2020-11-13T00:55:06Z", "message": "s/constructStreamProperty/constructBatchProperty"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMzAyMTcz", "url": "https://github.com/apache/pinot/pull/6247#pullrequestreview-530302173", "createdAt": "2020-11-13T18:20:02Z", "commit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxODoyMDowMlrOHy5-ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMzoxNzoyN1rOHzChrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE0MDcwOQ==", "bodyText": "can we also check and disallow the co-existence with the legacy stream config in index config?", "url": "https://github.com/apache/pinot/pull/6247#discussion_r523140709", "createdAt": "2020-11-13T18:20:02Z", "author": {"login": "yupeng9"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/util/TableConfigUtils.java", "diffHunk": "@@ -179,9 +181,34 @@ private static void validateValidationConfig(TableConfig tableConfig, @Nullable\n    * 4. validity of transform function string\n    * 5. checks for source fields used in destination columns\n    */\n-  private static void validateIngestionConfig(@Nullable IngestionConfig ingestionConfig, @Nullable Schema schema) {\n+  public static void validateIngestionConfig(String tableNameWithType, @Nullable IngestionConfig ingestionConfig,\n+      @Nullable Schema schema) {\n     if (ingestionConfig != null) {\n \n+      // Batch\n+      if (ingestionConfig.getBatchIngestionConfig() != null) {\n+        List<Map<String, String>> batchConfigMaps = ingestionConfig.getBatchIngestionConfig().getBatchConfigMaps();\n+        Preconditions.checkState(batchConfigMaps.size() > 0, \"Could not find batch config map\");\n+        try {\n+            // Validate that BatchConfig can be created\n+            batchConfigMaps.forEach(b -> new BatchConfig(tableNameWithType, b));\n+        } catch (Exception e) {\n+          throw new IllegalStateException(\"Could not create BatchConfig using the batchConfig map\", e);\n+        }\n+      }\n+\n+      // Stream\n+      if (ingestionConfig.getStreamIngestionConfig() != null) {\n+        List<Map<String, String>> streamConfigMaps = ingestionConfig.getStreamIngestionConfig().getStreamConfigMaps();\n+        Preconditions.checkState(streamConfigMaps.size() == 1, \"Only 1 stream is supported in REALTIME table\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3OTIyMA==", "bodyText": "can you add docs on the replacemet?", "url": "https://github.com/apache/pinot/pull/6247#discussion_r523279220", "createdAt": "2020-11-13T23:11:23Z", "author": {"login": "yupeng9"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/SegmentsValidationAndRetentionConfig.java", "diffHunk": "@@ -22,14 +22,17 @@\n import java.util.concurrent.TimeUnit;\n \n import org.apache.pinot.spi.config.BaseJsonConfig;\n+import org.apache.pinot.spi.config.table.ingestion.IngestionConfig;\n import org.apache.pinot.spi.utils.TimeUtils;\n \n \n // TODO: Consider break this config into multiple configs\n public class SegmentsValidationAndRetentionConfig extends BaseJsonConfig {\n   private String _retentionTimeUnit;\n   private String _retentionTimeValue;\n+  @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3OTI0MA==", "bodyText": "can you add docs on the replacemet?", "url": "https://github.com/apache/pinot/pull/6247#discussion_r523279240", "createdAt": "2020-11-13T23:11:27Z", "author": {"login": "yupeng9"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/SegmentsValidationAndRetentionConfig.java", "diffHunk": "@@ -22,14 +22,17 @@\n import java.util.concurrent.TimeUnit;\n \n import org.apache.pinot.spi.config.BaseJsonConfig;\n+import org.apache.pinot.spi.config.table.ingestion.IngestionConfig;\n import org.apache.pinot.spi.utils.TimeUtils;\n \n \n // TODO: Consider break this config into multiple configs\n public class SegmentsValidationAndRetentionConfig extends BaseJsonConfig {\n   private String _retentionTimeUnit;\n   private String _retentionTimeValue;\n+  @Deprecated\n   private String _segmentPushFrequency; // DO NOT REMOVE, this is used in internal segment generation management\n+  @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI3OTMyNA==", "bodyText": "not needed?", "url": "https://github.com/apache/pinot/pull/6247#discussion_r523279324", "createdAt": "2020-11-13T23:11:45Z", "author": {"login": "yupeng9"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/TableConfig.java", "diffHunk": "@@ -29,6 +29,7 @@\n import org.apache.pinot.spi.config.BaseJsonConfig;\n import org.apache.pinot.spi.config.table.assignment.InstanceAssignmentConfig;\n import org.apache.pinot.spi.config.table.assignment.InstancePartitionsType;\n+import org.apache.pinot.spi.config.table.ingestion.IngestionConfig;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI4MDI4MA==", "bodyText": "shall we have @JsonProperty?", "url": "https://github.com/apache/pinot/pull/6247#discussion_r523280280", "createdAt": "2020-11-13T23:15:24Z", "author": {"login": "yupeng9"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/ingestion/BatchIngestionConfig.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.config.table.ingestion;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonPropertyDescription;\n+import java.util.List;\n+import java.util.Map;\n+import javax.annotation.Nullable;\n+import org.apache.pinot.spi.config.BaseJsonConfig;\n+\n+\n+/**\n+ * Contains all configs related to the batch sources for ingestion.\n+ */\n+public class BatchIngestionConfig extends BaseJsonConfig {\n+\n+  @JsonPropertyDescription(\"Configs for all the batch sources to ingest from\")\n+  private final List<Map<String, String>> _batchConfigMaps;\n+\n+  @JsonPropertyDescription(\"Push type APPEND or REFRESH\")\n+  private final String _segmentPushType;\n+\n+  @JsonPropertyDescription(\"Push frequency HOURLY or DAILY\")\n+  private final String _segmentPushFrequency;\n+\n+  @JsonCreator\n+  public BatchIngestionConfig(@JsonProperty(\"batchConfigMaps\") List<Map<String, String>> batchConfigMaps,\n+      @JsonProperty(\"segmentPushType\") String segmentPushType,\n+      @JsonProperty(\"segmentPushFrequency\") String segmentPushFrequency) {\n+    _batchConfigMaps = batchConfigMaps;\n+    _segmentPushType = segmentPushType;\n+    _segmentPushFrequency = segmentPushFrequency;\n+  }\n+\n+  public List<Map<String, String>> getBatchConfigMaps() {\n+    return _batchConfigMaps;\n+  }\n+\n+  public String getSegmentPushType() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI4MDgxNA==", "bodyText": "why is this not in the same project as IngestionConfigUtils in spi?", "url": "https://github.com/apache/pinot/pull/6247#discussion_r523280814", "createdAt": "2020-11-13T23:17:27Z", "author": {"login": "yupeng9"}, "path": "pinot-core/src/test/java/org/apache/pinot/core/util/IngestionUtilsTest.java", "diffHunk": "@@ -22,17 +22,27 @@\n import com.google.common.collect.Sets;\n import java.util.ArrayList;\n import java.util.Arrays;\n+import java.util.HashMap;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDgxMzk1", "url": "https://github.com/apache/pinot/pull/6247#pullrequestreview-530481395", "createdAt": "2020-11-13T23:41:11Z", "commit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMzo0MToxMVrOHzC5bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMzo0NToxOFrOHzC9EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI4Njg5Mg==", "bodyText": "+1", "url": "https://github.com/apache/pinot/pull/6247#discussion_r523286892", "createdAt": "2020-11-13T23:41:11Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/test/java/org/apache/pinot/core/util/IngestionUtilsTest.java", "diffHunk": "@@ -22,17 +22,27 @@\n import com.google.common.collect.Sets;\n import java.util.ArrayList;\n import java.util.Arrays;\n+import java.util.HashMap;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI4MDgxNA=="}, "originalCommit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI4NzQ3OQ==", "bodyText": "Update the comment", "url": "https://github.com/apache/pinot/pull/6247#discussion_r523287479", "createdAt": "2020-11-13T23:43:57Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/IndexingConfig.java", "diffHunk": "@@ -33,6 +34,7 @@\n   private List<String> _bloomFilterColumns;\n   private Map<String, BloomFilterConfig> _bloomFilterConfigs;\n   private String _loadMode;\n+  @Deprecated // Moved to IngestionConfigs#Stream", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI4NzgyNA==", "bodyText": "(nit)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * @deprecated Use <code>segmentPushFrequency</code> from {@link IngestionConfig#getBatchIngestionConfig()}\n          \n          \n            \n               * @deprecated Use {@code segmentPushFrequency} from {@link IngestionConfig#getBatchIngestionConfig()}", "url": "https://github.com/apache/pinot/pull/6247#discussion_r523287824", "createdAt": "2020-11-13T23:45:18Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/SegmentsValidationAndRetentionConfig.java", "diffHunk": "@@ -91,6 +94,9 @@ public void setRetentionTimeValue(String retentionTimeValue) {\n     _retentionTimeValue = retentionTimeValue;\n   }\n \n+  /**\n+   * @deprecated Use <code>segmentPushFrequency</code> from {@link IngestionConfig#getBatchIngestionConfig()}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7591172003e34e61426e1b3e0437dcdbe1aa3057"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8c2fb0db800161fa785f821552939ff26a80427", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/f8c2fb0db800161fa785f821552939ff26a80427", "committedDate": "2020-11-17T22:24:25Z", "message": "Review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61c0b52e3779e74a1af95ed2f4da62b7c97a0b98", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/61c0b52e3779e74a1af95ed2f4da62b7c97a0b98", "committedDate": "2020-11-17T23:36:50Z", "message": "Nullable batchConfigMaps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfd5193bd56e7c4496a5a7eb2f4b0f5cfc4bf00e", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/bfd5193bd56e7c4496a5a7eb2f4b0f5cfc4bf00e", "committedDate": "2020-11-17T23:51:45Z", "message": "Fix integration test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1755, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}