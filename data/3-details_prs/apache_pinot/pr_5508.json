{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4ODg0Mzc3", "number": 5508, "title": "Enhance quickstart script for CI tests", "bodyText": "For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\nUse TERM signal instead of KILL so that process can execute the shutdown hook\nWait for process to fully terminate before starting the next one\nCorrectly handle query response before the table being ready", "createdAt": "2020-06-06T00:42:34Z", "url": "https://github.com/apache/pinot/pull/5508", "merged": true, "mergeCommit": {"oid": "2d28c0f8fce781e094dacd8d53b6299ee42c5979"}, "closed": true, "closedAt": "2020-06-10T04:42:51Z", "author": {"login": "Jackie-Jiang"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcocqh_gBqjM0MTM4ODkyMTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpv9PCABqjM0Mjc0OTc1MTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80d45a448ebc71b2277ed51713ac737224fae7b2", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/80d45a448ebc71b2277ed51713ac737224fae7b2", "committedDate": "2020-06-06T00:40:06Z", "message": "In Travis quickstart, wait for process finishing clean up and terminate\n\nUse TERM signal instead of KILL so that process can execute the shutdown hook of cleaning up\nWait for process to be terminated before starting the next one"}, "afterCommit": {"oid": "936329917a996f1357054f9a03a5914dc9a8ef18", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/936329917a996f1357054f9a03a5914dc9a8ef18", "committedDate": "2020-06-06T01:04:52Z", "message": "In Travis quickstart, wait for process finishing clean up and terminate\n\nUse TERM signal instead of KILL so that process can execute the shutdown hook\nWait for process to fully terminate before starting the next one\n\nFor all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NDgyOTM3", "url": "https://github.com/apache/pinot/pull/5508#pullrequestreview-426482937", "createdAt": "2020-06-08T17:57:51Z", "commit": {"oid": "936329917a996f1357054f9a03a5914dc9a8ef18"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzo1Nzo1MVrOGgpviA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNzo1Nzo1MVrOGgpviA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg5MTUyOA==", "bodyText": "this is still not tolerant of failure in curl. The way to do this will be something like\nx=$(curl ...); if [ $? -ne 0 ]; then continue; fi; echo \"$x\" | jq ...", "url": "https://github.com/apache/pinot/pull/5508#discussion_r436891528", "createdAt": "2020-06-08T17:57:51Z", "author": {"login": "mcvsubbu"}, "path": ".travis/.travis_quickstart.sh", "diffHunk": "@@ -69,7 +75,7 @@ sleep 30\n for i in $(seq 1 200)\n do\n   COUNT_STAR_RES=`curl -X POST --header 'Accept: application/json'  -d '{\"sql\":\"select count(*) from meetupRsvp limit 1\",\"trace\":false}' http://localhost:8000/query/sql | jq '.resultTable.rows[0][0]'`\n- if [[ \"${COUNT_STAR_RES}\" =~ ^[0-9]+$ ]]; then\n+  if [[ \"${COUNT_STAR_RES}\" =~ ^[0-9]+$ ]]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "936329917a996f1357054f9a03a5914dc9a8ef18"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "936329917a996f1357054f9a03a5914dc9a8ef18", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/936329917a996f1357054f9a03a5914dc9a8ef18", "committedDate": "2020-06-06T01:04:52Z", "message": "In Travis quickstart, wait for process finishing clean up and terminate\n\nUse TERM signal instead of KILL so that process can execute the shutdown hook\nWait for process to fully terminate before starting the next one\n\nFor all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed"}, "afterCommit": {"oid": "7103132afc07f1a329b11fd91d77657ae74315f7", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/7103132afc07f1a329b11fd91d77657ae74315f7", "committedDate": "2020-06-08T22:34:29Z", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7103132afc07f1a329b11fd91d77657ae74315f7", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/7103132afc07f1a329b11fd91d77657ae74315f7", "committedDate": "2020-06-08T22:34:29Z", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test"}, "afterCommit": {"oid": "8aec8aba5b1e24d700e2292b6678807a27ea68e6", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/8aec8aba5b1e24d700e2292b6678807a27ea68e6", "committedDate": "2020-06-08T22:47:28Z", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8aec8aba5b1e24d700e2292b6678807a27ea68e6", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/8aec8aba5b1e24d700e2292b6678807a27ea68e6", "committedDate": "2020-06-08T22:47:28Z", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test"}, "afterCommit": {"oid": "d9c610f096da05bdd52b0831fdbe68f88c0c2dd4", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/d9c610f096da05bdd52b0831fdbe68f88c0c2dd4", "committedDate": "2020-06-08T22:59:53Z", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb4b26e96e6cc4f6fb1f9fd1d5516d52a78046fc", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/fb4b26e96e6cc4f6fb1f9fd1d5516d52a78046fc", "committedDate": "2020-06-08T23:15:52Z", "message": "batch build"}, "afterCommit": {"oid": "d9c610f096da05bdd52b0831fdbe68f88c0c2dd4", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/d9c610f096da05bdd52b0831fdbe68f88c0c2dd4", "committedDate": "2020-06-08T22:59:53Z", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a95e1a1b26fc4ebbee69b7fe076b6cc0dda534d3", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/a95e1a1b26fc4ebbee69b7fe076b6cc0dda534d3", "committedDate": "2020-06-08T23:38:35Z", "message": "Batch tests"}, "afterCommit": {"oid": "8771647d55163866f9c9db431c8de64cc6755ede", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/8771647d55163866f9c9db431c8de64cc6755ede", "committedDate": "2020-06-09T00:15:25Z", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8771647d55163866f9c9db431c8de64cc6755ede", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/8771647d55163866f9c9db431c8de64cc6755ede", "committedDate": "2020-06-09T00:15:25Z", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test"}, "afterCommit": {"oid": "d2747115fcae822eef35ce269a755d15f68ef3d8", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/d2747115fcae822eef35ce269a755d15f68ef3d8", "committedDate": "2020-06-09T00:44:28Z", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzgwNTI1", "url": "https://github.com/apache/pinot/pull/5508#pullrequestreview-426780525", "createdAt": "2020-06-09T04:29:28Z", "commit": {"oid": "d2747115fcae822eef35ce269a755d15f68ef3d8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwNDoyOToyOVrOGg4Wjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwNDoyOToyOVrOGg4Wjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzEzMDg5NQ==", "bodyText": "how about sleep 2 or 3 seconds instead of just 1 ?", "url": "https://github.com/apache/pinot/pull/5508#discussion_r437130895", "createdAt": "2020-06-09T04:29:29Z", "author": {"login": "xiangfu0"}, "path": ".travis/.travis_quickstart.sh", "diffHunk": "@@ -30,60 +30,75 @@ java -version\n \n # Quickstart\n DIST_BIN_DIR=`ls -d pinot-distribution/target/apache-pinot-*/apache-pinot-*`\n-cd ${DIST_BIN_DIR}\n+cd \"${DIST_BIN_DIR}\"\n \n # Test quick-start-batch\n bin/quick-start-batch.sh &\n PID=$!\n \n PASS=0\n+\n+# Wait for 30 seconds for table to be set up, then at most 5 minutes to reach the desired state\n sleep 30\n-for i in $(seq 1 200)\n+for i in $(seq 1 300)\n do\n-  COUNT_STAR_RES=`curl -X POST --header 'Accept: application/json'  -d '{\"sql\":\"select count(*) from baseballStats limit 1\",\"trace\":false}' http://localhost:8000/query/sql | jq '.resultTable.rows[0][0]'`\n-  if [[ \"${COUNT_STAR_RES}\" =~ ^[0-9]+$ ]]; then\n-    if [ \"${COUNT_STAR_RES}\" -eq 97889 ]; then\n+  QUERY_RES=`curl -X POST --header 'Accept: application/json'  -d '{\"sql\":\"select count(*) from baseballStats limit 1\",\"trace\":false}' http://localhost:8000/query/sql`\n+  if [ $? -eq 0 ]; then\n+    COUNT_STAR_RES=`echo \"${QUERY_RES}\" | jq '.resultTable.rows[0][0]'`\n+    if [[ \"${COUNT_STAR_RES}\" =~ ^[0-9]+$ ]] && [ \"${COUNT_STAR_RES}\" -eq 97889 ]; then\n       PASS=1\n       break\n     fi\n   fi\n   sleep 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2747115fcae822eef35ce269a755d15f68ef3d8"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2747115fcae822eef35ce269a755d15f68ef3d8", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/d2747115fcae822eef35ce269a755d15f68ef3d8", "committedDate": "2020-06-09T00:44:28Z", "message": "Fix Travis quickstart tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready\n- Break each JDK version into a different test"}, "afterCommit": {"oid": "d3414f9ce2dc56ee99ba35f4f8bcd1bacb93c2bd", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/d3414f9ce2dc56ee99ba35f4f8bcd1bacb93c2bd", "committedDate": "2020-06-09T23:12:59Z", "message": "Enhance quickstart script for CI tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjE5NDM5", "url": "https://github.com/apache/pinot/pull/5508#pullrequestreview-427619439", "createdAt": "2020-06-09T23:46:52Z", "commit": {"oid": "d3414f9ce2dc56ee99ba35f4f8bcd1bacb93c2bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3414f9ce2dc56ee99ba35f4f8bcd1bacb93c2bd", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/d3414f9ce2dc56ee99ba35f4f8bcd1bacb93c2bd", "committedDate": "2020-06-09T23:12:59Z", "message": "Enhance quickstart script for CI tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready"}, "afterCommit": {"oid": "53f2bee1bfce5c445d5f0038dcd17612546bd126", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/53f2bee1bfce5c445d5f0038dcd17612546bd126", "committedDate": "2020-06-10T01:16:04Z", "message": "Enhance quickstart script for CI tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "475b6934f7b70e54987311dd25b969fd2e8fbae0", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/475b6934f7b70e54987311dd25b969fd2e8fbae0", "committedDate": "2020-06-10T02:09:09Z", "message": "Enhance quickstart script for CI tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53f2bee1bfce5c445d5f0038dcd17612546bd126", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/53f2bee1bfce5c445d5f0038dcd17612546bd126", "committedDate": "2020-06-10T01:16:04Z", "message": "Enhance quickstart script for CI tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready"}, "afterCommit": {"oid": "475b6934f7b70e54987311dd25b969fd2e8fbae0", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/475b6934f7b70e54987311dd25b969fd2e8fbae0", "committedDate": "2020-06-10T02:09:09Z", "message": "Enhance quickstart script for CI tests\n\n- For all the Quickstarts, add shutdown hook once the instances are set up so that the hook can always be executed\n- Use TERM signal instead of KILL so that process can execute the shutdown hook\n- Wait for process to fully terminate before starting the next one\n- Correctly handle query response before the table being ready"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 912, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}