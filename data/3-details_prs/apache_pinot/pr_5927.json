{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczODgzNjM1", "number": 5927, "title": "support for local.directory.sequence.id", "bodyText": "There is support for the same using PinotSparkJobLauncher. But not using the LaunchDataIngestionJobCommand.", "createdAt": "2020-08-26T12:48:55Z", "url": "https://github.com/apache/pinot/pull/5927", "merged": true, "mergeCommit": {"oid": "e71622d258c27fe28ef62398b143c1ee1145b0a4"}, "closed": true, "closedAt": "2020-08-27T20:55:44Z", "author": {"login": "mr-agrwal"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCrOobgH2gAyNDczODgzNjM1OjFlOTI3MjcwYTQ4NDU4YWI0NTBmYWViYjRiMTE0Zjk0MTQ5NTgyNTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDBAJ-gH2gAyNDczODgzNjM1OjMyYmNkODI3OWI1ZDVkZWJiOGZkZGU4ZTAwY2JhODExZjhjODYyM2Y=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1e927270a48458ab450faebb4b114f9414958256", "author": {"user": {"login": "mr-agrwal", "name": "Yash Agarwal"}}, "url": "https://github.com/apache/pinot/commit/1e927270a48458ab450faebb4b114f9414958256", "committedDate": "2020-08-26T12:46:59Z", "message": "support for local.directory.sequence.id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64c2336df41a9d327d4641d0d61b512d24ac991a", "author": {"user": {"login": "mr-agrwal", "name": "Yash Agarwal"}}, "url": "https://github.com/apache/pinot/commit/64c2336df41a9d327d4641d0d61b512d24ac991a", "committedDate": "2020-08-26T12:51:54Z", "message": "add null check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1ODI3MjU1", "url": "https://github.com/apache/pinot/pull/5927#pullrequestreview-475827255", "createdAt": "2020-08-26T20:17:44Z", "commit": {"oid": "64c2336df41a9d327d4641d0d61b512d24ac991a"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMDoxNzo0NFrOHHcM1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMDoyMjo1MlrOHHcXCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU2NDExNw==", "bodyText": "expend the .*", "url": "https://github.com/apache/pinot/pull/5927#discussion_r477564117", "createdAt": "2020-08-26T20:17:44Z", "author": {"login": "xiangfu0"}, "path": "pinot-plugins/pinot-batch-ingestion/pinot-batch-ingestion-spark/src/main/java/org/apache/pinot/plugin/ingestion/batch/spark/SparkSegmentGenerationJobRunner.java", "diffHunk": "@@ -29,12 +30,10 @@\n import java.io.Serializable;\n import java.net.URI;\n import java.nio.file.FileSystems;\n+import java.nio.file.Path;\n import java.nio.file.PathMatcher;\n import java.nio.file.Paths;\n-import java.util.ArrayList;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.UUID;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64c2336df41a9d327d4641d0d61b512d24ac991a"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU2NjczMA==", "bodyText": "suggest to sort siblingFiles list, so rerun segment creation job will give same segments list", "url": "https://github.com/apache/pinot/pull/5927#discussion_r477566730", "createdAt": "2020-08-26T20:22:52Z", "author": {"login": "xiangfu0"}, "path": "pinot-plugins/pinot-batch-ingestion/pinot-batch-ingestion-spark/src/main/java/org/apache/pinot/plugin/ingestion/batch/spark/SparkSegmentGenerationJobRunner.java", "diffHunk": "@@ -200,8 +199,30 @@ public void run()\n       }\n \n       List<String> pathAndIdxList = new ArrayList<>();\n-      for (int i = 0; i < filteredFiles.size(); i++) {\n-        pathAndIdxList.add(String.format(\"%s %d\", filteredFiles.get(i), i));\n+      String localDirectorySequenceIdString = _spec.getSegmentNameGeneratorSpec().getConfigs().get(LOCAL_DIRECTORY_SEQUENCE_ID);\n+      boolean localDirectorySequenceId = false;\n+      if (localDirectorySequenceIdString != null) {\n+        localDirectorySequenceId = Boolean.parseBoolean(localDirectorySequenceIdString);\n+      }\n+      if (localDirectorySequenceId) {\n+        Map<String, List<String>> localDirIndex = new HashMap<>();\n+        for (String filteredFile : filteredFiles) {\n+          Path filteredParentPath = Paths.get(filteredFile).getParent();\n+          if (!localDirIndex.containsKey(filteredParentPath.toString())) {\n+            localDirIndex.put(filteredParentPath.toString(), new ArrayList<>());\n+          }\n+          localDirIndex.get(filteredParentPath.toString()).add(filteredFile);\n+        }\n+        for (String parentPath: localDirIndex.keySet()){\n+          List<String> siblingFiles = localDirIndex.get(parentPath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64c2336df41a9d327d4641d0d61b512d24ac991a"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32bcd8279b5d5debb8fdde8e00cba811f8c8623f", "author": {"user": {"login": "mr-agrwal", "name": "Yash Agarwal"}}, "url": "https://github.com/apache/pinot/commit/32bcd8279b5d5debb8fdde8e00cba811f8c8623f", "committedDate": "2020-08-27T14:09:05Z", "message": "Fix based on review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 283, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}