{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyMzUyNjU3", "number": 6211, "title": "add api for cluster manager to get table state", "bodyText": "Description\nAdd API endpoint for cluster manager to get the table current state. fixes Issue 6169.\nUpgrade Notes\nDoes this PR prevent a zero down-time upgrade? (Assume upgrade order: Controller, Broker, Server, Minion)\n\n Yes (Please label as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR fix a zero-downtime upgrade introduced earlier?\n\n Yes (Please label this as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR otherwise need attention when creating release notes? Things to consider:\n\nNew configuration options\nDeprecation of configurations\nSignature changes to public methods/interfaces\nNew plugins added or old plugins removed\n\n\n Yes (Please label this PR as release-notes and complete the section on Release Notes)\n\nRelease Notes\nIf you have tagged this as either backward-incompat or release-notes,\nyou MUST add text here that you would like to see appear in release notes of the\nnext release.\nIf you have a series of commits adding or enabling a feature, then\nadd this section only in final commit that marks the feature completed.\nRefer to earlier release notes to see examples of text\nDocumentation\nIf you have introduced a new feature or configuration, please add it to the documentation as well.\nSee https://docs.pinot.apache.org/developers/developers-and-contributors/update-document", "createdAt": "2020-10-29T15:18:34Z", "url": "https://github.com/apache/pinot/pull/6211", "merged": true, "mergeCommit": {"oid": "4a6e0945e2442fdb630dbe9a1d687a8906484f87"}, "closed": true, "closedAt": "2020-11-20T22:07:46Z", "author": {"login": "galalen"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYouiTgFqTUyMTg4NDY2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeeyFKgFqTUzNTgwODg0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxODg0NjY3", "url": "https://github.com/apache/pinot/pull/6211#pullrequestreview-521884667", "createdAt": "2020-11-02T18:18:26Z", "commit": {"oid": "48fc2fbb4d773f2352de7f08357bf111a937fb71"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxODoxODoyNlrOHsQb7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxODoxODoyNlrOHsQb7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE2ODY4NQ==", "bodyText": "Let's keep this method's return type a boolean - isTableEnabled.", "url": "https://github.com/apache/pinot/pull/6211#discussion_r516168685", "createdAt": "2020-11-02T18:18:26Z", "author": {"login": "npawar"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/PinotHelixResourceManager.java", "diffHunk": "@@ -1981,6 +1981,16 @@ public boolean hasRealtimeTable(String tableName) {\n     return hasTable(TableNameBuilder.REALTIME.tableNameWithType(tableName));\n   }\n \n+  /**\n+   * Gets the current state of the table\n+   * @param tableNameWithType Table name with suffix\n+   * @return String enabled | disabled\n+   */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48fc2fbb4d773f2352de7f08357bf111a937fb71"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxODg1NTQy", "url": "https://github.com/apache/pinot/pull/6211#pullrequestreview-521885542", "createdAt": "2020-11-02T18:19:44Z", "commit": {"oid": "48fc2fbb4d773f2352de7f08357bf111a937fb71"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxODoxOTo0NVrOHsQe8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxODoxOTo0NVrOHsQe8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE2OTQ1Nw==", "bodyText": "current state\" has a different meaning in helix/pinot. I would suggest saying something about it being enabled ot not.", "url": "https://github.com/apache/pinot/pull/6211#discussion_r516169457", "createdAt": "2020-11-02T18:19:45Z", "author": {"login": "npawar"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/PinotHelixResourceManager.java", "diffHunk": "@@ -1981,6 +1981,16 @@ public boolean hasRealtimeTable(String tableName) {\n     return hasTable(TableNameBuilder.REALTIME.tableNameWithType(tableName));\n   }\n \n+  /**\n+   * Gets the current state of the table", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48fc2fbb4d773f2352de7f08357bf111a937fb71"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxODkxNDg3", "url": "https://github.com/apache/pinot/pull/6211#pullrequestreview-521891487", "createdAt": "2020-11-02T18:28:18Z", "commit": {"oid": "48fc2fbb4d773f2352de7f08357bf111a937fb71"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxODoyODoxOVrOHsQxIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxODoyODoxOVrOHsQxIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE3NDExMw==", "bodyText": "Let's just make type as required, and keep return type binary, instead of introducing a json blurb here.", "url": "https://github.com/apache/pinot/pull/6211#discussion_r516174113", "createdAt": "2020-11-02T18:28:19Z", "author": {"login": "npawar"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/api/resources/PinotTableRestletResource.java", "diffHunk": "@@ -558,4 +558,54 @@ public RebalanceResult rebalance(\n       throw new ControllerApplicationException(LOGGER, e.getMessage(), Response.Status.NOT_FOUND);\n     }\n   }\n+\n+  @GET\n+  @Produces(MediaType.APPLICATION_JSON)\n+  @Path(\"/tables/{tableName}/state\")\n+  @ApiOperation(value = \"Get current table state\", notes = \"Get current table state\")\n+  public String getTableState(\n+      @ApiParam(value = \"Name of the table to get its state\", required = true) @PathParam(\"tableName\") String tableName,\n+      @ApiParam(value = \"realtime|offline\") @QueryParam(\"type\") String tableTypeStr", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48fc2fbb4d773f2352de7f08357bf111a937fb71"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48fc2fbb4d773f2352de7f08357bf111a937fb71", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/48fc2fbb4d773f2352de7f08357bf111a937fb71", "committedDate": "2020-10-29T15:17:24Z", "message": "add api for cluster manager to get table state\n\nremove unused file"}, "afterCommit": {"oid": "7ecc7e0b6bf752dd960283034d2ef0001593b01a", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/7ecc7e0b6bf752dd960283034d2ef0001593b01a", "committedDate": "2020-11-02T21:09:30Z", "message": "update getTableCurrentState to return binary"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ecc7e0b6bf752dd960283034d2ef0001593b01a", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/7ecc7e0b6bf752dd960283034d2ef0001593b01a", "committedDate": "2020-11-02T21:09:30Z", "message": "update getTableCurrentState to return binary"}, "afterCommit": {"oid": "094066457f49b44a4c850df788b2bd455293619f", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/094066457f49b44a4c850df788b2bd455293619f", "committedDate": "2020-11-03T10:01:11Z", "message": "check table state unit test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "094066457f49b44a4c850df788b2bd455293619f", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/094066457f49b44a4c850df788b2bd455293619f", "committedDate": "2020-11-03T10:01:11Z", "message": "check table state unit test"}, "afterCommit": {"oid": "3aafefd38e049c5f816c6237ce2ca26ea9c4ca43", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/3aafefd38e049c5f816c6237ce2ca26ea9c4ca43", "committedDate": "2020-11-03T10:01:11Z", "message": "api for checking table state [enabled/disabled]"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3aafefd38e049c5f816c6237ce2ca26ea9c4ca43", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/3aafefd38e049c5f816c6237ce2ca26ea9c4ca43", "committedDate": "2020-11-03T10:01:11Z", "message": "api for checking table state [enabled/disabled]"}, "afterCommit": {"oid": "4dfc7b4b9181e207a4967a7d068277eca7bfe00e", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/4dfc7b4b9181e207a4967a7d068277eca7bfe00e", "committedDate": "2020-11-03T15:24:19Z", "message": "api for checking table state [enabled/disabled]"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4dfc7b4b9181e207a4967a7d068277eca7bfe00e", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/4dfc7b4b9181e207a4967a7d068277eca7bfe00e", "committedDate": "2020-11-03T15:24:19Z", "message": "api for checking table state [enabled/disabled]"}, "afterCommit": {"oid": "e3180c260d6a3f97b00631bc13399bdc31e7ff98", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/e3180c260d6a3f97b00631bc13399bdc31e7ff98", "committedDate": "2020-11-03T17:38:36Z", "message": "api for checking table state [enabled/disabled]\n\nchance return to enabled / disabled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzODI3OTM3", "url": "https://github.com/apache/pinot/pull/6211#pullrequestreview-523827937", "createdAt": "2020-11-05T00:15:11Z", "commit": {"oid": "e3180c260d6a3f97b00631bc13399bdc31e7ff98"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwMDoxNToxMVrOHtuURw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwMDoxNToxMVrOHtuURw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzcwNjgyMw==", "bodyText": "we dont need to again return tableName in the response do we? You can just return \"enabled\" or \"disabled\".", "url": "https://github.com/apache/pinot/pull/6211#discussion_r517706823", "createdAt": "2020-11-05T00:15:11Z", "author": {"login": "npawar"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/api/resources/PinotTableRestletResource.java", "diffHunk": "@@ -558,4 +558,32 @@ public RebalanceResult rebalance(\n       throw new ControllerApplicationException(LOGGER, e.getMessage(), Response.Status.NOT_FOUND);\n     }\n   }\n+\n+  @GET\n+  @Produces(MediaType.APPLICATION_JSON)\n+  @Path(\"/tables/{tableName}/state\")\n+  @ApiOperation(value = \"Get current table state\", notes = \"Get current table state\")\n+  public String getTableState(\n+      @ApiParam(value = \"Name of the table to get its state\", required = true) @PathParam(\"tableName\") String tableName,\n+      @ApiParam(value = \"realtime|offline\", required = true) @QueryParam(\"type\") String tableTypeStr\n+  ) {\n+    TableType tableType;\n+    try {\n+      tableType = TableType.valueOf(tableTypeStr.toUpperCase());\n+    } catch (IllegalArgumentException e) {\n+      throw new ControllerApplicationException(LOGGER, \"Illegal table type: \" + tableTypeStr,\n+          Response.Status.BAD_REQUEST);\n+    }\n+\n+    String tableNameWithType = TableNameBuilder.forType(tableType).tableNameWithType(tableName);\n+    try {\n+      ObjectNode data = JsonUtils.newObjectNode();\n+      data.put(\"tableName\", tableNameWithType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3180c260d6a3f97b00631bc13399bdc31e7ff98"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3180c260d6a3f97b00631bc13399bdc31e7ff98", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/e3180c260d6a3f97b00631bc13399bdc31e7ff98", "committedDate": "2020-11-03T17:38:36Z", "message": "api for checking table state [enabled/disabled]\n\nchance return to enabled / disabled"}, "afterCommit": {"oid": "2b17b038044f61404f3f15689397d52b976be3b2", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/2b17b038044f61404f3f15689397d52b976be3b2", "committedDate": "2020-11-05T10:55:52Z", "message": "make cluser manager check state api only return the state [enabled/disabled]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88c5e311fd7b5d66a3aa95caf1f883a312c6a47a", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/88c5e311fd7b5d66a3aa95caf1f883a312c6a47a", "committedDate": "2020-11-06T05:36:05Z", "message": "api for checking table state [enabled/disabled]\n\nchance return to enabled / disabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ed209c4f07782993166a7560bedf9346bda8c2a", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/7ed209c4f07782993166a7560bedf9346bda8c2a", "committedDate": "2020-11-06T05:36:05Z", "message": "make cluser manager check state api only return the state [enabled/disabled]"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b17b038044f61404f3f15689397d52b976be3b2", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/2b17b038044f61404f3f15689397d52b976be3b2", "committedDate": "2020-11-05T10:55:52Z", "message": "make cluser manager check state api only return the state [enabled/disabled]"}, "afterCommit": {"oid": "968396a0978a1d2a23ca7470993fc15da8a3b853", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/968396a0978a1d2a23ca7470993fc15da8a3b853", "committedDate": "2020-11-06T05:36:05Z", "message": "add unit tests to cluster manager check table state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96ad6a511bd5c2bdda5a690f3b20bf5463723015", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/96ad6a511bd5c2bdda5a690f3b20bf5463723015", "committedDate": "2020-11-06T08:15:58Z", "message": "add unit tests to cluster manager check table state\n\nupdate table name in unit test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "968396a0978a1d2a23ca7470993fc15da8a3b853", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/968396a0978a1d2a23ca7470993fc15da8a3b853", "committedDate": "2020-11-06T05:36:05Z", "message": "add unit tests to cluster manager check table state"}, "afterCommit": {"oid": "96ad6a511bd5c2bdda5a690f3b20bf5463723015", "author": {"user": {"login": "galalen", "name": "Mohammed Galalen"}}, "url": "https://github.com/apache/pinot/commit/96ad6a511bd5c2bdda5a690f3b20bf5463723015", "committedDate": "2020-11-06T08:15:58Z", "message": "add unit tests to cluster manager check table state\n\nupdate table name in unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODA4Njc1", "url": "https://github.com/apache/pinot/pull/6211#pullrequestreview-535808675", "createdAt": "2020-11-20T22:06:29Z", "commit": {"oid": "96ad6a511bd5c2bdda5a690f3b20bf5463723015"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODA4ODQ0", "url": "https://github.com/apache/pinot/pull/6211#pullrequestreview-535808844", "createdAt": "2020-11-20T22:06:49Z", "commit": {"oid": "96ad6a511bd5c2bdda5a690f3b20bf5463723015"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1670, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}