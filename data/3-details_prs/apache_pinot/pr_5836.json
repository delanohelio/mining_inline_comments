{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MzkxOTA3", "number": 5836, "title": "Fix data ingestion from Amazon S3 bucket", "bodyText": "This PR fixes the issue #5835 of ingesting data from S3.\nThe fix involves the following changes\n\n\nReturn full paths along with scheme in listFiles functions instead of path after the bucket.\nThis change is needed because the output of the listFiles in passed to isDirectory function which throws Exception since the path doesn't contain the bucket\n\n\nTake only the path instead of the full URI in segment generation job runner while creating a local file.\nThe segment generator throws the error inputFileURI doesn't start with file:// on creating the local file. This small change of taking inputFileURI.getPath() instead of inputFileURI fixes this issue.\n\n\nThe changes have been verified by running a standalone job to ingest as well as upload data in S3.", "createdAt": "2020-08-10T09:43:12Z", "url": "https://github.com/apache/pinot/pull/5836", "merged": true, "mergeCommit": {"oid": "d8264c144f9655ebfa90059b5c9f74a007363f54"}, "closed": true, "closedAt": "2020-08-11T10:08:33Z", "author": {"login": "KKcorps"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9e2jWAH2gAyNDY1MzkxOTA3OmM0NjJlNjFiYmI5ZTI3YzE1OTAxNGYyNzg1MzlhM2ViZDc1YzZjOTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9ySS9AH2gAyNDY1MzkxOTA3OjgwYzk2OTMxMjY1ZDI1ZGVjYTI0NDYzZWFjOTc1YTMwNWExNDNiNjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c462e61bbb9e27c159014f278539a3ebd75c6c91", "author": {"user": {"login": "KKcorps", "name": "Kartik Khare"}}, "url": "https://github.com/apache/pinot/commit/c462e61bbb9e27c159014f278539a3ebd75c6c91", "committedDate": "2020-08-10T09:32:12Z", "message": "return full paths along with scheme in listFiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff999f65757ecbb46334a5d615fe379817a7d668", "author": {"user": {"login": "KKcorps", "name": "Kartik Khare"}}, "url": "https://github.com/apache/pinot/commit/ff999f65757ecbb46334a5d615fe379817a7d668", "committedDate": "2020-08-10T09:32:52Z", "message": "take only path instead of URI to create local file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MjU2MTE2", "url": "https://github.com/apache/pinot/pull/5836#pullrequestreview-464256116", "createdAt": "2020-08-10T14:02:11Z", "commit": {"oid": "ff999f65757ecbb46334a5d615fe379817a7d668"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDM3MjE2", "url": "https://github.com/apache/pinot/pull/5836#pullrequestreview-464437216", "createdAt": "2020-08-10T17:37:46Z", "commit": {"oid": "ff999f65757ecbb46334a5d615fe379817a7d668"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzozNzo0NlrOG-Ypfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNzozNzo0NlrOG-Ypfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA2ODczNQ==", "bodyText": "nit: if (fileKey.startsWith(DELIMITER)) {", "url": "https://github.com/apache/pinot/pull/5836#discussion_r468068735", "createdAt": "2020-08-10T17:37:46Z", "author": {"login": "xiangfu0"}, "path": "pinot-plugins/pinot-file-system/pinot-s3/src/main/java/org/apache/pinot/plugin/filesystem/S3PinotFS.java", "diffHunk": "@@ -391,7 +393,11 @@ public long length(URI fileUri)\n       listObjectsV2Response.contents().stream().forEach(object -> {\n         //Only add files and not directories\n         if (!object.key().equals(fileUri.getPath()) && !object.key().endsWith(DELIMITER)) {\n-          builder.add(object.key());\n+          String fileKey = object.key();\n+          if(fileKey.startsWith(DELIMITER)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff999f65757ecbb46334a5d615fe379817a7d668"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NTM3NDY1", "url": "https://github.com/apache/pinot/pull/5836#pullrequestreview-464537465", "createdAt": "2020-08-10T20:00:26Z", "commit": {"oid": "ff999f65757ecbb46334a5d615fe379817a7d668"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowMDoyNlrOG-dg4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMDowMDoyNlrOG-dg4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0ODQ1MQ==", "bodyText": "do we need those imports?", "url": "https://github.com/apache/pinot/pull/5836#discussion_r468148451", "createdAt": "2020-08-10T20:00:26Z", "author": {"login": "xiangfu0"}, "path": "pinot-plugins/pinot-file-system/pinot-s3/src/test/java/org/apache/pinot/plugin/filesystem/S3PinotFSTest.java", "diffHunk": "@@ -28,12 +28,16 @@\n import java.util.Arrays;\n import java.util.List;\n import org.apache.commons.io.IOUtils;\n+import org.apache.pinot.spi.env.PinotConfiguration;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff999f65757ecbb46334a5d615fe379817a7d668"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4deddbf9776942478e39a78a1eae1f2dd16468cc", "author": {"user": {"login": "KKcorps", "name": "Kartik Khare"}}, "url": "https://github.com/apache/pinot/commit/4deddbf9776942478e39a78a1eae1f2dd16468cc", "committedDate": "2020-08-11T08:07:47Z", "message": "removing unused imports from test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80c96931265d25deca24463eac975a305a143b67", "author": {"user": {"login": "KKcorps", "name": "Kartik Khare"}}, "url": "https://github.com/apache/pinot/commit/80c96931265d25deca24463eac975a305a143b67", "committedDate": "2020-08-11T08:10:42Z", "message": "formatting fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 152, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}