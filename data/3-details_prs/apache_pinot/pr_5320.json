{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExMDYwNzQ0", "number": 5320, "title": "Use time column from table config instead of schema", "bodyText": "This is an item for this project: #2756\nOne of the initial steps is - in all places where primary time column is needed, refer to timeColumnName in tableConfig, instead of from schema. Then use the timeColumnName to fetch the fieldSpec from schema.\nMajor changes:\n\nRemoving SegmentGeneratorConfig(Schema schema) constructor. Enforcing the usage of SegmentGeneratorConfig(TableConfig tableConfig, Schema schema) instead. This allows us to read time from table config.\nIf table config is not available, reading timeSpec. This will change to reading 1st dateTimeFieldSpec soon. This will fail if we have multiple dateTimeFieldSpecs and no table config defined.\n\nPending:\n1) Haven't figured out how to bring table config to SegmentPurger", "createdAt": "2020-04-30T01:29:15Z", "url": "https://github.com/apache/pinot/pull/5320", "merged": true, "mergeCommit": {"oid": "997853d6cd7dcd2c974072424bf003e015d61a92"}, "closed": true, "closedAt": "2020-05-01T00:51:34Z", "author": {"login": "npawar"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcciPp7AH2gAyNDExMDYwNzQ0Ojk0ZGU2MzJlMzdlNDc5YzIxMTFhYjkwOTA4YWM4NWZlYzA3ZDcxZDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcc2Ls6gH2gAyNDExMDYwNzQ0OmU3YzA2YmI0Y2U0MzgzODI2YzNjODk0YmY1MDRlZDBjMDIxMzYxYjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "94de632e37e479c2111ab90908ac85fec07d71d9", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/94de632e37e479c2111ab90908ac85fec07d71d9", "committedDate": "2020-04-30T00:49:50Z", "message": "Use time column from table config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bd4db87445364d7efb6bc91a2093a1ca2e64a53", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/5bd4db87445364d7efb6bc91a2093a1ca2e64a53", "committedDate": "2020-04-30T01:51:12Z", "message": "Better handle PinotOutputFormat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "553d75f82ece189f71d7ded8b7ae9b81155808c0", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/553d75f82ece189f71d7ded8b7ae9b81155808c0", "committedDate": "2020-04-30T17:11:46Z", "message": "Fix table name in tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNzY3MzIy", "url": "https://github.com/apache/pinot/pull/5320#pullrequestreview-403767322", "createdAt": "2020-04-30T18:19:39Z", "commit": {"oid": "553d75f82ece189f71d7ded8b7ae9b81155808c0"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxODoxOTozOVrOGO1C9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxODoyNzoyMVrOGO1TWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIwMjM1OQ==", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    _logger.warn(\"Metrics aggregation cannot be turned ON in presence of no-dictionary datetime columns, eg: {}\",\n          \n          \n            \n                    _logger.warn(\"Metrics aggregation cannot be turned on in presence of no-dictionary datetime columns, eg: {}\",", "url": "https://github.com/apache/pinot/pull/5320#discussion_r418202359", "createdAt": "2020-04-30T18:19:39Z", "author": {"login": "mcvsubbu"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/indexsegment/mutable/MutableSegmentImpl.java", "diffHunk": "@@ -860,6 +876,17 @@ private int getOrCreateDocId(Map<String, Object> dictIdMap) {\n       }\n     }\n \n+    // Date time columns should be dictionary encoded.\n+    for (FieldSpec fieldSpec : _physicalDateTimeFieldSpecs) {\n+      String dateTimeColumn = fieldSpec.getName();\n+      if (noDictionaryColumns.contains(dateTimeColumn)) {\n+        _logger.warn(\"Metrics aggregation cannot be turned ON in presence of no-dictionary datetime columns, eg: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "553d75f82ece189f71d7ded8b7ae9b81155808c0"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIwMzY0MQ==", "bodyText": "create an  issue for this and add the issue number here?", "url": "https://github.com/apache/pinot/pull/5320#discussion_r418203641", "createdAt": "2020-04-30T18:21:57Z", "author": {"login": "mcvsubbu"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/minion/SegmentPurger.java", "diffHunk": "@@ -85,7 +85,10 @@ public File purgeSegment()\n       }\n \n       Schema schema = purgeRecordReader.getSchema();\n-      SegmentGeneratorConfig config = new SegmentGeneratorConfig(schema);\n+      // FIXME: figure out how to get table config here.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "553d75f82ece189f71d7ded8b7ae9b81155808c0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIwNjU1NQ==", "bodyText": "remove the  the other unneeded arguments as well (tableName, sortedColumn, inv index columns, text index columnms, etc.). Another PR is also fine", "url": "https://github.com/apache/pinot/pull/5320#discussion_r418206555", "createdAt": "2020-04-30T18:27:21Z", "author": {"login": "mcvsubbu"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/realtime/converter/RealtimeSegmentConverter.java", "diffHunk": "@@ -35,114 +35,116 @@\n import org.apache.pinot.core.segment.creator.impl.SegmentIndexCreationDriverImpl;\n import org.apache.pinot.spi.config.table.ColumnPartitionConfig;\n import org.apache.pinot.spi.config.table.SegmentPartitionConfig;\n+import org.apache.pinot.spi.config.table.TableConfig;\n import org.apache.pinot.spi.data.FieldSpec;\n import org.apache.pinot.spi.data.Schema;\n import org.apache.pinot.spi.data.TimeFieldSpec;\n import org.apache.pinot.spi.data.TimeGranularitySpec;\n \n \n public class RealtimeSegmentConverter {\n-  private MutableSegmentImpl realtimeSegmentImpl;\n-  private String outputPath;\n-  private Schema dataSchema;\n-  private String tableName;\n-  private String timeColumnName;\n-  private String segmentName;\n-  private String sortedColumn;\n-  private List<String> invertedIndexColumns;\n-  private List<String> textIndexColumns;\n-  private List<String> noDictionaryColumns;\n-  private List<String> varLengthDictionaryColumns;\n+  private MutableSegmentImpl _realtimeSegmentImpl;\n+  private final String _outputPath;\n+  private final Schema _dataSchema;\n+  private final String _tableName;\n+  private final TableConfig _tableConfig;\n+  private final String _segmentName;\n+  private final String _sortedColumn;\n+  private final List<String> _invertedIndexColumns;\n+  private final List<String> _textIndexColumns;\n+  private final List<String> _noDictionaryColumns;\n+  private final List<String> _varLengthDictionaryColumns;\n   private final boolean _nullHandlingEnabled;\n \n   public RealtimeSegmentConverter(MutableSegmentImpl realtimeSegment, String outputPath, Schema schema,\n-      String tableName, String timeColumnName, String segmentName, String sortedColumn,\n+      String tableName, TableConfig tableConfig, String segmentName, String sortedColumn,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "553d75f82ece189f71d7ded8b7ae9b81155808c0"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6555a5065c8a2200307030a4ed308dc1a779f91", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/f6555a5065c8a2200307030a4ed308dc1a779f91", "committedDate": "2020-04-30T18:34:46Z", "message": "Fix file name in test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a56d6015bdf79c5a0ada1360f271c20785443fa1", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/a56d6015bdf79c5a0ada1360f271c20785443fa1", "committedDate": "2020-04-30T19:24:33Z", "message": "Make timeColumnName available to SegmentPurger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7c06bb4ce4383826c3c894bf504ed0c021361b3", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/e7c06bb4ce4383826c3c894bf504ed0c021361b3", "committedDate": "2020-05-01T00:03:37Z", "message": "Remove time column from SegmentPurge"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 960, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}