{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMzc4ODkx", "number": 5641, "title": "Allow star-tree creation during segment load", "bodyText": "Description\nAllow star-tree creation during segment load (and reload).\nWith this, star-tree can be added on the fly after updating the table config via reload.\nNOTE:\n\nThis feature only applies to adding star-tree index config and generate star-trees to the existing segments (modifying/removing star-tree index config is not supported now)\nBecause the star-tree creation could consume a lot of system resources, added a boolean config enableDynamicStarTreeeCreation in IndexingConfig to enable/disable this feature (disabled by default).\nThis feature should only be enabled for testing purpose or in cluster without too much load on the servers and with relatively small segments and simple star-tree index config (servers need to have free system resources to create the star-tree).\n\nOther changes:\n\nPass in enableDefaultStarTree into MultipleTreesBuilder instead of using null as a placeholder for default star-tree to enhance the readability\nMake MultipleTreesBuilder closeable to close the segment properly\n\nRelease Notes\nIntroduced a new boolean config enableDynamicStarTreeeCreation in IndexingConfig to enable/disable star-tree creation during segment load.", "createdAt": "2020-07-01T01:00:24Z", "url": "https://github.com/apache/pinot/pull/5641", "merged": true, "mergeCommit": {"oid": "903282c371ef7f154119699a1dd7f5dab3a627a7"}, "closed": true, "closedAt": "2020-07-07T22:44:35Z", "author": {"login": "Jackie-Jiang"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyc6MYAFqTQ0MzIyNDQwMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcytydGABqjM1MjI1OTMyMTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjI0NDAx", "url": "https://github.com/apache/pinot/pull/5641#pullrequestreview-443224401", "createdAt": "2020-07-06T16:20:58Z", "commit": {"oid": "0605dcf82e16673b4b31bba819eb97fdc028be0b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNjoyMDo1OFrOGteTaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNjoyMDo1OFrOGteTaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDMzNTU5Mg==", "bodyText": "why should add null for default star tree?", "url": "https://github.com/apache/pinot/pull/5641#discussion_r450335592", "createdAt": "2020-07-06T16:20:58Z", "author": {"login": "kishoreg"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/segment/index/loader/IndexLoadingConfig.java", "diffHunk": "@@ -126,6 +128,18 @@ private void extractFromTableConfig(@Nonnull TableConfig tableConfig) {\n       _onHeapDictionaryColumns.addAll(onHeapDictionaryColumns);\n     }\n \n+    if (indexingConfig.isAllowStarTreeCreationDuringSegmentLoad()) {\n+      List<StarTreeIndexConfig> starTreeIndexConfigs = indexingConfig.getStarTreeIndexConfigs();\n+      if (starTreeIndexConfigs != null) {\n+        for (StarTreeIndexConfig starTreeIndexConfig : starTreeIndexConfigs) {\n+          _starTreeV2BuilderConfigs.add(StarTreeV2BuilderConfig.fromIndexConfig(starTreeIndexConfig));\n+        }\n+      }\n+      if (indexingConfig.isEnableDefaultStarTree()) {\n+        _starTreeV2BuilderConfigs.add(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0605dcf82e16673b4b31bba819eb97fdc028be0b"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNTMyNDA1", "url": "https://github.com/apache/pinot/pull/5641#pullrequestreview-443532405", "createdAt": "2020-07-07T03:10:13Z", "commit": {"oid": "0605dcf82e16673b4b31bba819eb97fdc028be0b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMzoxMDoxM1rOGttq9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMzoxMDoxM1rOGttq9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU4NzM4Mw==", "bodyText": "why do we need this config. can we put this at the cluster level or something?\nalso, if we really need this, rename the variable to enableDynamicStarTreeCreation", "url": "https://github.com/apache/pinot/pull/5641#discussion_r450587383", "createdAt": "2020-07-07T03:10:13Z", "author": {"login": "kishoreg"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/IndexingConfig.java", "diffHunk": "@@ -191,6 +192,14 @@ public void setStarTreeIndexConfigs(List<StarTreeIndexConfig> starTreeIndexConfi\n     _starTreeIndexConfigs = starTreeIndexConfigs;\n   }\n \n+  public boolean isAllowStarTreeCreationDuringSegmentLoad() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0605dcf82e16673b4b31bba819eb97fdc028be0b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNTU3OTIx", "url": "https://github.com/apache/pinot/pull/5641#pullrequestreview-443557921", "createdAt": "2020-07-07T04:42:58Z", "commit": {"oid": "0605dcf82e16673b4b31bba819eb97fdc028be0b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0605dcf82e16673b4b31bba819eb97fdc028be0b", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/0605dcf82e16673b4b31bba819eb97fdc028be0b", "committedDate": "2020-07-01T00:51:13Z", "message": "Allow star-tree creation during segment load\n\nAllow star-tree creation during segment load (and reload).\nWith this, star-tree can be created for COMPLETED realtime segments.\n\nBecause the star-tree creation could consume a lot of system resources,\nadded a boolean config 'allowStarTreeCreationDuringSegmentLoad' in\nIndexingConfig to enable/disable this feature."}, "afterCommit": {"oid": "e96bc956c945c10fb9cda78d845824774f1bba4c", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/e96bc956c945c10fb9cda78d845824774f1bba4c", "committedDate": "2020-07-07T20:13:59Z", "message": "Allow star-tree creation during segment load\n\nAllow star-tree creation during segment load (and reload).\nWith this, star-tree can be created for COMPLETED realtime segments.\n\nBecause the star-tree creation could consume a lot of system resources, added a boolean config 'enableDynamicStarTreeeCreation' in IndexingConfig to enable/disable this feature.\n\nOther changes:\n- Pass in `enableDefaultStarTree` into MultipleTreesBuilder instead of using null as a placeholder for default star-tree to enhance the readability\n- Make MultipleTreesBuilder closeable to close the segment properly"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e96bc956c945c10fb9cda78d845824774f1bba4c", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/e96bc956c945c10fb9cda78d845824774f1bba4c", "committedDate": "2020-07-07T20:13:59Z", "message": "Allow star-tree creation during segment load\n\nAllow star-tree creation during segment load (and reload).\nWith this, star-tree can be created for COMPLETED realtime segments.\n\nBecause the star-tree creation could consume a lot of system resources, added a boolean config 'enableDynamicStarTreeeCreation' in IndexingConfig to enable/disable this feature.\n\nOther changes:\n- Pass in `enableDefaultStarTree` into MultipleTreesBuilder instead of using null as a placeholder for default star-tree to enhance the readability\n- Make MultipleTreesBuilder closeable to close the segment properly"}, "afterCommit": {"oid": "3c2e73e16d6cdb5b5154af7addb88d699e32851d", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/3c2e73e16d6cdb5b5154af7addb88d699e32851d", "committedDate": "2020-07-07T21:19:32Z", "message": "Allow star-tree creation during segment load\n\nAllow star-tree creation during segment load (and reload).\nWith this, star-tree can be created for COMPLETED realtime segments.\n\nBecause the star-tree creation could consume a lot of system resources, added a boolean config 'enableDynamicStarTreeeCreation' in IndexingConfig to enable/disable this feature.\n\nOther changes:\n- Pass in `enableDefaultStarTree` into MultipleTreesBuilder instead of using null as a placeholder for default star-tree to enhance the readability\n- Make MultipleTreesBuilder closeable to close the segment properly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6172078ac67bf972d26f14b4b5709f8d6f0a4e7a", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/6172078ac67bf972d26f14b4b5709f8d6f0a4e7a", "committedDate": "2020-07-07T22:42:53Z", "message": "Allow star-tree creation during segment load\n\nAllow star-tree creation during segment load (and reload).\nWith this, star-tree can be created for COMPLETED realtime segments.\n\nBecause the star-tree creation could consume a lot of system resources, added a boolean config 'enableDynamicStarTreeeCreation' in IndexingConfig to enable/disable this feature.\n\nOther changes:\n- Pass in `enableDefaultStarTree` into MultipleTreesBuilder instead of using null as a placeholder for default star-tree to enhance the readability\n- Make MultipleTreesBuilder closeable to close the segment properly"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c2e73e16d6cdb5b5154af7addb88d699e32851d", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/3c2e73e16d6cdb5b5154af7addb88d699e32851d", "committedDate": "2020-07-07T21:19:32Z", "message": "Allow star-tree creation during segment load\n\nAllow star-tree creation during segment load (and reload).\nWith this, star-tree can be created for COMPLETED realtime segments.\n\nBecause the star-tree creation could consume a lot of system resources, added a boolean config 'enableDynamicStarTreeeCreation' in IndexingConfig to enable/disable this feature.\n\nOther changes:\n- Pass in `enableDefaultStarTree` into MultipleTreesBuilder instead of using null as a placeholder for default star-tree to enhance the readability\n- Make MultipleTreesBuilder closeable to close the segment properly"}, "afterCommit": {"oid": "6172078ac67bf972d26f14b4b5709f8d6f0a4e7a", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/6172078ac67bf972d26f14b4b5709f8d6f0a4e7a", "committedDate": "2020-07-07T22:42:53Z", "message": "Allow star-tree creation during segment load\n\nAllow star-tree creation during segment load (and reload).\nWith this, star-tree can be created for COMPLETED realtime segments.\n\nBecause the star-tree creation could consume a lot of system resources, added a boolean config 'enableDynamicStarTreeeCreation' in IndexingConfig to enable/disable this feature.\n\nOther changes:\n- Pass in `enableDefaultStarTree` into MultipleTreesBuilder instead of using null as a placeholder for default star-tree to enhance the readability\n- Make MultipleTreesBuilder closeable to close the segment properly"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 739, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}