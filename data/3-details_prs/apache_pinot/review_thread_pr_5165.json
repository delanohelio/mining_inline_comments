{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNzQ3MTE1", "number": 5165, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNzoyNzozM1rODpm0sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNzoyNzozM1rODpm0sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0OTU0MjkxOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "isResolved": true, "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNzoyNzozM1rOF449dA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMzoxNDozNFrOF6bizw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg==", "bodyText": "Why we generate the window larger than endTime?\nShould we fix the window generation logic instead of patching here?", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395197812", "createdAt": "2020-03-19T17:27:33Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "diffHunk": "@@ -290,6 +291,16 @@ long getLastTimeStamp() {\n           DateTime startTime = endTime.minus(windowSizePeriod);\n           monitoringWindows.add(new Interval(startTime, endTime));\n         }\n+        if (isSpeedUp) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4351b6d9c8d1b62ee749c84763b4938a06b154a4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM3Mzg0NA==", "bodyText": "Good point. Changed it.", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395373844", "createdAt": "2020-03-19T23:25:29Z", "author": {"login": "vincentchenjl"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "diffHunk": "@@ -290,6 +291,16 @@ long getLastTimeStamp() {\n           DateTime startTime = endTime.minus(windowSizePeriod);\n           monitoringWindows.add(new Interval(startTime, endTime));\n         }\n+        if (isSpeedUp) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, "originalCommit": {"oid": "4351b6d9c8d1b62ee749c84763b4938a06b154a4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM3NTE2NQ==", "bodyText": "Thanks for the change. I mean can we change getMonitoringWindows()?\nThis is the original place we generate the windows.", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395375165", "createdAt": "2020-03-19T23:30:07Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "diffHunk": "@@ -290,6 +291,16 @@ long getLastTimeStamp() {\n           DateTime startTime = endTime.minus(windowSizePeriod);\n           monitoringWindows.add(new Interval(startTime, endTime));\n         }\n+        if (isSpeedUp) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, "originalCommit": {"oid": "4351b6d9c8d1b62ee749c84763b4938a06b154a4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM3NzAyNw==", "bodyText": "Yes, that's where I added the check.", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395377027", "createdAt": "2020-03-19T23:36:25Z", "author": {"login": "vincentchenjl"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "diffHunk": "@@ -290,6 +291,16 @@ long getLastTimeStamp() {\n           DateTime startTime = endTime.minus(windowSizePeriod);\n           monitoringWindows.add(new Interval(startTime, endTime));\n         }\n+        if (isSpeedUp) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, "originalCommit": {"oid": "4351b6d9c8d1b62ee749c84763b4938a06b154a4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcxOTMxOA==", "bodyText": "Sorry I didn't notice that.\nSince here is the place all the windows are generated. I don't see a reason why you need to modify existing windows instead of adding the check when generating the windows.\nCan we just change L289 from\nDateTime endTime = monitoringEndTime.minus(windowDelayPeriod);\nTo:\nDateTime windowEndTime = Math.min(monitoringEndTime.minus(windowDelayPeriod), endTime)?", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395719318", "createdAt": "2020-03-20T15:36:44Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "diffHunk": "@@ -290,6 +291,16 @@ long getLastTimeStamp() {\n           DateTime startTime = endTime.minus(windowSizePeriod);\n           monitoringWindows.add(new Interval(startTime, endTime));\n         }\n+        if (isSpeedUp) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, "originalCommit": {"oid": "4351b6d9c8d1b62ee749c84763b4938a06b154a4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwODA1Mw==", "bodyText": "We cannot change the endTime here directly, as it can generate windows that overlaps the previous windows. Either we change the endTime of latest interval or we need to change the logic of generating the windows completely.", "url": "https://github.com/apache/pinot/pull/5165#discussion_r395908053", "createdAt": "2020-03-20T21:58:40Z", "author": {"login": "vincentchenjl"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "diffHunk": "@@ -290,6 +291,16 @@ long getLastTimeStamp() {\n           DateTime startTime = endTime.minus(windowSizePeriod);\n           monitoringWindows.add(new Interval(startTime, endTime));\n         }\n+        if (isSpeedUp) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, "originalCommit": {"oid": "4351b6d9c8d1b62ee749c84763b4938a06b154a4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjAwMjYzMg==", "bodyText": "Why it can generate windows that overlaps the previous windows? Can we sync offline?", "url": "https://github.com/apache/pinot/pull/5165#discussion_r396002632", "createdAt": "2020-03-21T15:40:50Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "diffHunk": "@@ -290,6 +291,16 @@ long getLastTimeStamp() {\n           DateTime startTime = endTime.minus(windowSizePeriod);\n           monitoringWindows.add(new Interval(startTime, endTime));\n         }\n+        if (isSpeedUp) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, "originalCommit": {"oid": "4351b6d9c8d1b62ee749c84763b4938a06b154a4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjAwNDcwMw==", "bodyText": "I got your point. Then we can do a little trick - modify endTime after using it.\nHow about the following? @vincentchenjl\nList monitoringWindows = new ArrayList<>();\nList monitoringWindowEndTimes = getMonitoringWindowEndTimes();\nDateTime detectionEndTime = new DateTime(endTime, dateTimeZone).minus(windowDelayPeriod);\nfor (DateTime monitoringEndTime : monitoringWindowEndTimes) {\nDateTime endTime = monitoringEndTime.minus(windowDelayPeriod);\nDateTime startTime = endTime.minus(windowSizePeriod);\nendTime = endTime.isAfter(detectionEndTime) ? detectionEndTime : endTime;\nmonitoringWindows.add(new Interval(startTime, endTime));\n}", "url": "https://github.com/apache/pinot/pull/5165#discussion_r396004703", "createdAt": "2020-03-21T16:07:35Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "diffHunk": "@@ -290,6 +291,16 @@ long getLastTimeStamp() {\n           DateTime startTime = endTime.minus(windowSizePeriod);\n           monitoringWindows.add(new Interval(startTime, endTime));\n         }\n+        if (isSpeedUp) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, "originalCommit": {"oid": "4351b6d9c8d1b62ee749c84763b4938a06b154a4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc2MjY4Mw==", "bodyText": "Done.", "url": "https://github.com/apache/pinot/pull/5165#discussion_r396762683", "createdAt": "2020-03-23T21:18:12Z", "author": {"login": "vincentchenjl"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "diffHunk": "@@ -290,6 +291,16 @@ long getLastTimeStamp() {\n           DateTime startTime = endTime.minus(windowSizePeriod);\n           monitoringWindows.add(new Interval(startTime, endTime));\n         }\n+        if (isSpeedUp) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, "originalCommit": {"oid": "4351b6d9c8d1b62ee749c84763b4938a06b154a4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjgxMzAwNw==", "bodyText": "Great.  Let's not fix for the symptom. Fix for the root cause, as early as possible.", "url": "https://github.com/apache/pinot/pull/5165#discussion_r396813007", "createdAt": "2020-03-23T23:14:34Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/detection/wrapper/AnomalyDetectorWrapper.java", "diffHunk": "@@ -290,6 +291,16 @@ long getLastTimeStamp() {\n           DateTime startTime = endTime.minus(windowSizePeriod);\n           monitoringWindows.add(new Interval(startTime, endTime));\n         }\n+        if (isSpeedUp) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzgxMg=="}, "originalCommit": {"oid": "4351b6d9c8d1b62ee749c84763b4938a06b154a4"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3291, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}