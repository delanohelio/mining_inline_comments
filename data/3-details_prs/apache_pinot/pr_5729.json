{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1MTU3ODE2", "number": 5729, "title": "Adding support for ingestion job spec as JSON", "bodyText": "This PR addresses the Issue #5725\nBoth Table and Schema are currently taken as JSON so it makes sense to have ingestion job spec also in JSON format rather than currently supported YAML format.\nThe YAML format has been kept as default to maintain backward compatibility.", "createdAt": "2020-07-22T14:32:46Z", "url": "https://github.com/apache/pinot/pull/5729", "merged": true, "mergeCommit": {"oid": "f95ef04401e04bde9c04478d5785cfc45e3fda0c"}, "closed": true, "closedAt": "2020-07-23T19:08:39Z", "author": {"login": "KKcorps"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3bumNgH2gAyNDU1MTU3ODE2OjFhNTcyY2Q4Nzc4ODI3YjMxMjE1ZGY2YzA0YWNlOTdhMWMwY2E4YjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3zDTagH2gAyNDU1MTU3ODE2OmRjMGY1Zjk3YWZiMTE2Y2U1YjBjMmY3Zjg5NzkzNzk3YTFjMGUxZDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1a572cd8778827b31215df6c04ace97a1c0ca8b0", "author": {"user": {"login": "KKcorps", "name": "Kartik Khare"}}, "url": "https://github.com/apache/pinot/commit/1a572cd8778827b31215df6c04ace97a1c0ca8b0", "committedDate": "2020-07-22T14:30:15Z", "message": "adding support for ingestion job spec as JSON"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNDAxNTk5", "url": "https://github.com/apache/pinot/pull/5729#pullrequestreview-453401599", "createdAt": "2020-07-22T14:56:47Z", "commit": {"oid": "1a572cd8778827b31215df6c04ace97a1c0ca8b0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f313cd73cb7f9e1e4c9d5a1b997504aaab8c0de7", "author": {"user": {"login": "KKcorps", "name": "Kartik Khare"}}, "url": "https://github.com/apache/pinot/commit/f313cd73cb7f9e1e4c9d5a1b997504aaab8c0de7", "committedDate": "2020-07-22T16:07:33Z", "message": "changing output path for test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "608a001b62d91303ca76ec1b21d55500d9e6beb4", "author": {"user": {"login": "KKcorps", "name": "Kartik Khare"}}, "url": "https://github.com/apache/pinot/commit/608a001b62d91303ca76ec1b21d55500d9e6beb4", "committedDate": "2020-07-22T16:55:47Z", "message": "removing typo in test file json name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNzM5MDY0", "url": "https://github.com/apache/pinot/pull/5729#pullrequestreview-453739064", "createdAt": "2020-07-22T22:53:14Z", "commit": {"oid": "608a001b62d91303ca76ec1b21d55500d9e6beb4"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMjo1MzoxNFrOG12-Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQyMzowMjoxNFrOG13KSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyODM1OA==", "bodyText": "nit: new line.", "url": "https://github.com/apache/pinot/pull/5729#discussion_r459128358", "createdAt": "2020-07-22T22:53:14Z", "author": {"login": "xiangfu0"}, "path": "pinot-spi/src/test/resources/job_json.config", "diffHunk": "@@ -0,0 +1,23 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+#\n+\n+year=2020\n+month=07\n+day=22\n+job-spec-format=json", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "608a001b62d91303ca76ec1b21d55500d9e6beb4"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyODQ3Ng==", "bodyText": "nit: new line", "url": "https://github.com/apache/pinot/pull/5729#discussion_r459128476", "createdAt": "2020-07-22T22:53:35Z", "author": {"login": "xiangfu0"}, "path": "pinot-spi/src/test/resources/ingestionJobSpecTemplate.json", "diffHunk": "@@ -0,0 +1,38 @@\n+{\n+  \"executionFrameworkSpec\": {\n+    \"name\": \"standalone\",\n+    \"segmentGenerationJobRunnerClassName\": \"org.apache.pinot.plugin.ingestion.batch.standalone.SegmentGenerationJobRunner\",\n+    \"segmentTarPushJobRunnerClassName\": \"org.apache.pinot.plugin.ingestion.batch.standalone.SegmentTarPushJobRunner\",\n+    \"segmentUriPushJobRunnerClassName\": \"org.apache.pinot.plugin.ingestion.batch.standalone.SegmentUriPushJobRunner\"\n+  },\n+  \"jobType\": \"SegmentCreationAndTarPush\",\n+  \"inputDirURI\": \"file:///path/to/input/${ year }/${ month }/${ day }\",\n+  \"includeFileNamePattern\": \"glob:**/*.parquet\",\n+  \"excludeFileNamePattern\": \"glob:**/*.avro\",\n+  \"outputDirURI\": \"file:///path/to/output/${year}/${month}/${day}\",\n+  \"overwriteOutput\": true,\n+  \"pinotFSSpecs\": [\n+    {\n+      \"scheme\": \"file\",\n+      \"className\": \"org.apache.pinot.spi.filesystem.LocalPinotFS\"\n+    }\n+  ],\n+  \"recordReaderSpec\": {\n+    \"dataFormat\": \"parquet\",\n+    \"className\": \"org.apache.pinot.parquet.data.readers.ParquetRecordReader\"\n+  },\n+  \"tableSpec\": {\n+    \"tableName\": \"myTable\",\n+    \"schemaURI\": \"http://localhost:9000/tables/myTable/schema\",\n+    \"tableConfigURI\": \"http://localhost:9000/tables/myTable\"\n+  },\n+  \"pinotClusterSpecs\": [\n+    {\n+      \"controllerURI\": \"localhost:9000\"\n+    }\n+  ],\n+  \"pushJobSpec\": {\n+    \"pushAttempts\": 2,\n+    \"pushRetryIntervalMillis\": 1000\n+  }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "608a001b62d91303ca76ec1b21d55500d9e6beb4"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEzMTQ2NQ==", "bodyText": "use propertiesMap", "url": "https://github.com/apache/pinot/pull/5729#discussion_r459131465", "createdAt": "2020-07-22T23:02:14Z", "author": {"login": "xiangfu0"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/ingestion/batch/IngestionJobLauncher.java", "diffHunk": "@@ -57,21 +61,33 @@ public static SegmentGenerationJobSpec getSegmentGenerationJobSpec(String jobSpe\n     if (context != null) {\n       propertiesMap.putAll(context);\n     }\n-    String yamlTemplate;\n+    String jobSpecTemplate;\n     try {\n-      yamlTemplate = IOUtils.toString(new BufferedReader(new FileReader(jobSpecFilePath)));\n+      jobSpecTemplate = IOUtils.toString(new BufferedReader(new FileReader(jobSpecFilePath)));\n     } catch (IOException e) {\n       throw new RuntimeException(String.format(\"Unable to read ingestion job spec file [%s].\", jobSpecFilePath), e);\n     }\n-    String yamlStr;\n+    String jobSpecStr;\n     try {\n-      yamlStr = GroovyTemplateUtils.renderTemplate(yamlTemplate, propertiesMap);\n+      jobSpecStr = GroovyTemplateUtils.renderTemplate(jobSpecTemplate, propertiesMap);\n     } catch (Exception e) {\n       throw new RuntimeException(String\n           .format(\"Unable to render templates on ingestion job spec template file - [%s] with propertiesMap - [%s].\",\n               jobSpecFilePath, Arrays.toString(propertiesMap.entrySet().toArray())), e);\n     }\n-    return new Yaml().loadAs(yamlStr, SegmentGenerationJobSpec.class);\n+\n+    String jobSpecFormat = properties.getProperty(JOB_SPEC_FORMAT, YAML);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "608a001b62d91303ca76ec1b21d55500d9e6beb4"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c8a973b39daa7ff7d63d149c31a16d57887e227", "author": {"user": {"login": "KKcorps", "name": "Kartik Khare"}}, "url": "https://github.com/apache/pinot/commit/7c8a973b39daa7ff7d63d149c31a16d57887e227", "committedDate": "2020-07-23T17:13:31Z", "message": "removing camel case from file name and using propertiesMap instead of properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc0f5f97afb116ce5b0c2f7f89793797a1c0e1d5", "author": {"user": {"login": "KKcorps", "name": "Kartik Khare"}}, "url": "https://github.com/apache/pinot/commit/dc0f5f97afb116ce5b0c2f7f89793797a1c0e1d5", "committedDate": "2020-07-23T17:40:41Z", "message": "unit test fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 419, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}