{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyNTE3MDU1", "number": 5798, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNzowODo1N1rOEVFzRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNzowODo1N1rOEVFzRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwNTUwNTk2OnYy", "diffSide": "RIGHT", "path": "pinot-core/src/main/java/org/apache/pinot/core/query/aggregation/function/DistinctCountThetaSketchAggregationFunction.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNzowODo1N1rOG7ppWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMDowMTowNFrOG7vfzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIwMTQ5OQ==", "bodyText": "Is the caller already good with null? I mean it doesn't have to be changed to handle null return from this function?", "url": "https://github.com/apache/pinot/pull/5798#discussion_r465201499", "createdAt": "2020-08-04T17:08:57Z", "author": {"login": "siddharthteotia"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/query/aggregation/function/DistinctCountThetaSketchAggregationFunction.java", "diffHunk": "@@ -387,12 +386,17 @@ public void aggregateGroupByMV(int length, int[][] groupKeysArray, GroupByResult\n   public Map<String, Sketch> extractAggregationResult(AggregationResultHolder aggregationResultHolder) {\n     Map<Predicate, Union> unionMap = aggregationResultHolder.getResult();\n     if (unionMap == null || unionMap.isEmpty()) {\n-      return Collections.emptyMap();\n+      return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf915bdf9b7406bb4b6701aac70b9e131c8463e2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI5NDM0Nw==", "bodyText": "Yes, see merge(), there's a null check there. I had added Collections.emptyMap() in the previous PR, only to realize that it could be null. You are right it doesn't have to be null, but having it null saves a few cpu cycles in merge, I guess (not that it improves anything).", "url": "https://github.com/apache/pinot/pull/5798#discussion_r465294347", "createdAt": "2020-08-04T19:55:16Z", "author": {"login": "mayankshriv"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/query/aggregation/function/DistinctCountThetaSketchAggregationFunction.java", "diffHunk": "@@ -387,12 +386,17 @@ public void aggregateGroupByMV(int length, int[][] groupKeysArray, GroupByResult\n   public Map<String, Sketch> extractAggregationResult(AggregationResultHolder aggregationResultHolder) {\n     Map<Predicate, Union> unionMap = aggregationResultHolder.getResult();\n     if (unionMap == null || unionMap.isEmpty()) {\n-      return Collections.emptyMap();\n+      return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIwMTQ5OQ=="}, "originalCommit": {"oid": "cf915bdf9b7406bb4b6701aac70b9e131c8463e2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI5NzM1Nw==", "bodyText": "On second thought, perhaps emptyMap() is better to avoid null checks in callers. Updated.", "url": "https://github.com/apache/pinot/pull/5798#discussion_r465297357", "createdAt": "2020-08-04T20:01:04Z", "author": {"login": "mayankshriv"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/query/aggregation/function/DistinctCountThetaSketchAggregationFunction.java", "diffHunk": "@@ -387,12 +386,17 @@ public void aggregateGroupByMV(int length, int[][] groupKeysArray, GroupByResult\n   public Map<String, Sketch> extractAggregationResult(AggregationResultHolder aggregationResultHolder) {\n     Map<Predicate, Union> unionMap = aggregationResultHolder.getResult();\n     if (unionMap == null || unionMap.isEmpty()) {\n-      return Collections.emptyMap();\n+      return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIwMTQ5OQ=="}, "originalCommit": {"oid": "cf915bdf9b7406bb4b6701aac70b9e131c8463e2"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3934, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}