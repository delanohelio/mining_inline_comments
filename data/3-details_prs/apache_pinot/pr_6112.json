{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NzM4ODU5", "number": 6112, "title": "add max length support in schema builder", "bodyText": "Description\nAdd one more API to set maxLength in schemaBuilder. #6106\nUpgrade Notes\nDoes this PR prevent a zero down-time upgrade? (Assume upgrade order: Controller, Broker, Server, Minion)\n\n Yes (Please label as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR fix a zero-downtime upgrade introduced earlier?\n\n Yes (Please label this as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR otherwise need attention when creating release notes? Things to consider:\n\nNew configuration options\nDeprecation of configurations\nSignature changes to public methods/interfaces\nNew plugins added or old plugins removed\n\n\n Yes (Please label this PR as release-notes and complete the section on Release Notes)\n\nRelease Notes\nIf you have tagged this as either backward-incompat or release-notes,\nyou MUST add text here that you would like to see appear in release notes of the\nnext release.\nIf you have a series of commits adding or enabling a feature, then\nadd this section only in final commit that marks the feature completed.\nRefer to earlier release notes to see examples of text\nDocumentation\nIf you have introduced a new feature or configuration, please add it to the documentation as well.\nSee https://docs.pinot.apache.org/developers/developers-and-contributors/update-document", "createdAt": "2020-10-06T18:13:02Z", "url": "https://github.com/apache/pinot/pull/6112", "merged": true, "mergeCommit": {"oid": "65be8bd6ae5fc83c9d485245679e4d58b320e355"}, "closed": true, "closedAt": "2020-10-14T01:06:29Z", "author": {"login": "deemoliu"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQCBwSgFqTUwMzQ1MTI3MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSQSfagH2gAyNDk4NzM4ODU5OjA0ODcxMDE3Y2RlYjE4Nzc2YjBmNjViZTYzYWMzZmU2YmQ4N2VhOTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNDUxMjcw", "url": "https://github.com/apache/pinot/pull/6112#pullrequestreview-503451270", "createdAt": "2020-10-07T00:40:25Z", "commit": {"oid": "92cca5b9106b0cde81579592a98e30c145e4d706"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwMDo0MDoyNlrOHdepIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwMDo0MDo0NFrOHdepiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY3MjgwMw==", "bodyText": "Please reformat this", "url": "https://github.com/apache/pinot/pull/6112#discussion_r500672803", "createdAt": "2020-10-07T00:40:26Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/Schema.java", "diffHunk": "@@ -499,6 +499,15 @@ public SchemaBuilder addSingleValueDimension(String dimensionName, DataType data\n       return this;\n     }\n \n+    /**\n+     * Add single value dimensionFieldSpec with maxLength and a defaultNullValue\n+     */\n+    public SchemaBuilder addSingleValueDimension(String dimensionName, DataType dataType, int maxLength,\n+                                                 Object defaultNullValue) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92cca5b9106b0cde81579592a98e30c145e4d706"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY3MjkwNA==", "bodyText": "Reformat this", "url": "https://github.com/apache/pinot/pull/6112#discussion_r500672904", "createdAt": "2020-10-07T00:40:44Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/Schema.java", "diffHunk": "@@ -508,13 +517,22 @@ public SchemaBuilder addMultiValueDimension(String dimensionName, DataType dataT\n     }\n \n     /**\n-     * Add single value dimensionFieldSpec with defaultNullValue\n+     * Add multi value dimensionFieldSpec with defaultNullValue\n      */\n     public SchemaBuilder addMultiValueDimension(String dimensionName, DataType dataType, Object defaultNullValue) {\n       _schema.addField(new DimensionFieldSpec(dimensionName, dataType, false, defaultNullValue));\n       return this;\n     }\n \n+    /**\n+     * Add multi value dimensionFieldSpec with maxLength and a defaultNullValue\n+     */\n+    public SchemaBuilder addMultiValueDimension(String dimensionName, DataType dataType, int maxLength,\n+                                                Object defaultNullValue) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92cca5b9106b0cde81579592a98e30c145e4d706"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MDM2OTg2", "url": "https://github.com/apache/pinot/pull/6112#pullrequestreview-504036986", "createdAt": "2020-10-07T16:01:44Z", "commit": {"oid": "92cca5b9106b0cde81579592a98e30c145e4d706"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNjowMTo0NVrOHd6lTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxNjowMTo0NVrOHd6lTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTEzMDU3NA==", "bodyText": "Why do fixed length data types (BOOLEAN/int/float/etc) need maxLength? If not, then we should not allow setting max-length for those and only apply to variable length data types (String/Bytes).", "url": "https://github.com/apache/pinot/pull/6112#discussion_r501130574", "createdAt": "2020-10-07T16:01:45Z", "author": {"login": "mayankshriv"}, "path": "pinot-common/src/test/java/org/apache/pinot/common/data/FieldSpecTest.java", "diffHunk": "@@ -80,6 +80,18 @@ public void testFieldSpec() {\n     Assert.assertEquals(fieldSpec1.hashCode(), fieldSpec2.hashCode());\n     Assert.assertEquals(fieldSpec1.getDefaultNullValue(), \"false\");\n \n+    // Single-value boolean type dimension field with max length and default null value.\n+    fieldSpec1 = new DimensionFieldSpec();\n+    fieldSpec1.setName(\"svDimension\");\n+    fieldSpec1.setDataType(BOOLEAN);\n+    fieldSpec1.setDefaultNullValue(false);\n+    fieldSpec1.setMaxLength(20000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92cca5b9106b0cde81579592a98e30c145e4d706"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDY0MTIx", "url": "https://github.com/apache/pinot/pull/6112#pullrequestreview-506064121", "createdAt": "2020-10-10T04:12:08Z", "commit": {"oid": "27f43268f6f3a49b672f1b0131df4f032f5ee79c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwNDoxMjowOVrOHfdA3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQwNDoxMjowOVrOHfdA3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc0MzI2MA==", "bodyText": "the maxLength should be applicable only to String type only as discussed earlier. You can add a Precondition Check here to make sure dataType is String.", "url": "https://github.com/apache/pinot/pull/6112#discussion_r502743260", "createdAt": "2020-10-10T04:12:09Z", "author": {"login": "chenboat"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/Schema.java", "diffHunk": "@@ -499,6 +499,15 @@ public SchemaBuilder addSingleValueDimension(String dimensionName, DataType data\n       return this;\n     }\n \n+    /**\n+     * Add single value dimensionFieldSpec with maxLength and a defaultNullValue\n+     */\n+    public SchemaBuilder addSingleValueDimension(String dimensionName, DataType dataType, int maxLength,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27f43268f6f3a49b672f1b0131df4f032f5ee79c"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3ODQ5Mzk3", "url": "https://github.com/apache/pinot/pull/6112#pullrequestreview-507849397", "createdAt": "2020-10-13T21:41:27Z", "commit": {"oid": "5b16876f94635b8aca7b70bd0aec3a3b06fc60ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d38038668a9a0924b2805634f26c61effe226ab", "author": {"user": {"login": "deemoliu", "name": null}}, "url": "https://github.com/apache/pinot/commit/9d38038668a9a0924b2805634f26c61effe226ab", "committedDate": "2020-10-13T22:26:31Z", "message": "add max length support in schema builder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f507cdb528131b8d8c2cec20f44feb81df99041a", "author": {"user": {"login": "deemoliu", "name": null}}, "url": "https://github.com/apache/pinot/commit/f507cdb528131b8d8c2cec20f44feb81df99041a", "committedDate": "2020-10-13T22:26:32Z", "message": "fix the default value of metric fields in unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "581bc6c5dd1869e02bb197b334a140c329c99aa7", "author": {"user": {"login": "deemoliu", "name": null}}, "url": "https://github.com/apache/pinot/commit/581bc6c5dd1869e02bb197b334a140c329c99aa7", "committedDate": "2020-10-13T22:26:32Z", "message": "fix a unit test to aviod maxlength on boolean fields, reformat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d441387624a21e3f838ee83ae7df50712f48f22c", "author": {"user": {"login": "deemoliu", "name": null}}, "url": "https://github.com/apache/pinot/commit/d441387624a21e3f838ee83ae7df50712f48f22c", "committedDate": "2020-10-13T22:26:33Z", "message": "add precondition check for add fields with max length."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04871017cdeb18776b0f65be63ac3fe6bd87ea98", "author": {"user": {"login": "deemoliu", "name": null}}, "url": "https://github.com/apache/pinot/commit/04871017cdeb18776b0f65be63ac3fe6bd87ea98", "committedDate": "2020-10-13T22:26:33Z", "message": "remove add string metric with max length"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1544, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}