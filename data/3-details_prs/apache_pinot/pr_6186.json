{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5Mzg4MTE5", "number": 6186, "title": "Added recursive functions validation check for group by", "bodyText": "Description\nThe current validation rule for select-inside-groupby currently only consider exact match and Alias function.\nThere are many cases where composite functions are used in select-groupby too e.g. select concat(foo,bar,'-'), count(*) ... group by foo, bar is a valid query.\nUpgrade Notes\nDoes this PR prevent a zero down-time upgrade? (Assume upgrade order: Controller, Broker, Server, Minion)\n\n Yes (Please label as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR fix a zero-downtime upgrade introduced earlier?\n\n Yes (Please label this as backward-incompat, and complete the section below on Release Notes)\n\nDoes this PR otherwise need attention when creating release notes? Things to consider:\n\nNew configuration options\nDeprecation of configurations\nSignature changes to public methods/interfaces\nNew plugins added or old plugins removed\n\n\n Yes (Please label this PR as release-notes and complete the section on Release Notes)\n\nRelease Notes\nIf you have tagged this as either backward-incompat or release-notes,\nyou MUST add text here that you would like to see appear in release notes of the\nnext release.\nIf you have a series of commits adding or enabling a feature, then\nadd this section only in final commit that marks the feature completed.\nRefer to earlier release notes to see examples of text\nDocumentation\nIf you have introduced a new feature or configuration, please add it to the documentation as well.\nSee https://docs.pinot.apache.org/developers/developers-and-contributors/update-document", "createdAt": "2020-10-24T07:28:58Z", "url": "https://github.com/apache/pinot/pull/6186", "merged": true, "mergeCommit": {"oid": "7e7a4bb36af84e2f4aef6d1dfe4126bf1f18a23b"}, "closed": true, "closedAt": "2020-10-25T23:54:26Z", "author": {"login": "hotienvu"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVl_ieAH2gAyNTA5Mzg4MTE5Ojg0NTQ5OWJhMDJkNGExNTAyZGMyZmFlNTBiMWM5YjY2MmFlM2I3N2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdV5H7zAH2gAyNTA5Mzg4MTE5OmZjNjhjN2I4OGRmOTBiMjAwMThmYzlkNTE5YjM5OTYxZWNiMTgwZGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "845499ba02d4a1502dc2fae50b1c9b662ae3b77c", "author": {"user": {"login": "hotienvu", "name": "Ho Tien Vu"}}, "url": "https://github.com/apache/pinot/commit/845499ba02d4a1502dc2fae50b1c9b662ae3b77c", "committedDate": "2020-10-24T07:25:32Z", "message": "Added recursive functions validation check for group by\n\nThe current validation rule for select-inside-groupby currently only consider exact match and Alias function.\nThere are many cases where composite functions are used in select-groupby too e.g. \"select concat(foo,bar,'-'), count(*) ... group by foo, bar\" is a valid query."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MzIxMzI5", "url": "https://github.com/apache/pinot/pull/6186#pullrequestreview-516321329", "createdAt": "2020-10-25T03:14:07Z", "commit": {"oid": "845499ba02d4a1502dc2fae50b1c9b662ae3b77c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MzI0NzQ0", "url": "https://github.com/apache/pinot/pull/6186#pullrequestreview-516324744", "createdAt": "2020-10-25T04:50:19Z", "commit": {"oid": "845499ba02d4a1502dc2fae50b1c9b662ae3b77c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQwNDo1MDoxOVrOHn2WwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQwNDo1MDoxOVrOHn2WwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU0NzA3Mw==", "bodyText": "Will this groupByExprs.contains(expr) handles functions or just for identifiers?", "url": "https://github.com/apache/pinot/pull/6186#discussion_r511547073", "createdAt": "2020-10-25T04:50:19Z", "author": {"login": "xiangfu0"}, "path": "pinot-common/src/main/java/org/apache/pinot/sql/parsers/CalciteSqlParser.java", "diffHunk": "@@ -187,6 +174,22 @@ private static void validateGroupByClause(PinotQuery pinotQuery)\n     }\n   }\n \n+  private static boolean expressionOutsideGroupByList(Expression expr, Set<Expression> groupByExprs) {\n+    if (expr.getType() == ExpressionType.LITERAL || isAggregateExpression(expr) || groupByExprs.contains(expr)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "845499ba02d4a1502dc2fae50b1c9b662ae3b77c"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc68c7b88df90b20018fc9d519b39961ecb180db", "author": {"user": {"login": "hotienvu", "name": "Ho Tien Vu"}}, "url": "https://github.com/apache/pinot/commit/fc68c7b88df90b20018fc9d519b39961ecb180db", "committedDate": "2020-10-25T05:42:54Z", "message": "added javadoc and comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1649, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}