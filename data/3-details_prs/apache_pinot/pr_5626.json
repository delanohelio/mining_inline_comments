{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNzM5Mzc5", "number": 5626, "title": "[TE] alert search - search by both metrics and datasets", "bodyText": "Previously, the alert search will return an empty result when querying with the metric and dataset name at the same time. This PR fixes the issue.", "createdAt": "2020-06-26T18:58:27Z", "url": "https://github.com/apache/pinot/pull/5626", "merged": true, "mergeCommit": {"oid": "2cfa42d208bea1e7a23fc8995aeb24e8246fa488"}, "closed": true, "closedAt": "2020-06-29T23:00:04Z", "author": {"login": "jihaozh"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvKAa9AFqTQzODYwMTIzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwJNwUgFqTQzOTU1Nzk1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjAxMjM2", "url": "https://github.com/apache/pinot/pull/5626#pullrequestreview-438601236", "createdAt": "2020-06-26T21:19:03Z", "commit": {"oid": "b426baad2f209af14041167d569bb3e92871ea32"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMToxOTowM1rOGpu_hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMToxOTowM1rOGpu_hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQxNDcyNA==", "bodyText": "Can we have comments somewhere to make it clear that we are using AND or OR relationship between filters?", "url": "https://github.com/apache/pinot/pull/5626#discussion_r446414724", "createdAt": "2020-06-26T21:19:03Z", "author": {"login": "vincentchenjl"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/dashboard/resources/v2/alerts/AlertSearcher.java", "diffHunk": "@@ -194,15 +194,23 @@ public AlertSearcher() {\n     Set<Long> metricIds = new HashSet<>();\n     if (!searchFilter.getMetrics().isEmpty()) {\n       for (String metric : searchFilter.getMetrics()) {\n-        metricIds =\n-            this.metricDAO.findByMetricName(metric).stream().map(AbstractDTO::getId).collect(Collectors.toSet());\n+        metricIds.addAll(\n+            this.metricDAO.findByMetricName(metric).stream().map(AbstractDTO::getId).collect(Collectors.toSet()));\n       }\n     }\n \n     if (!searchFilter.getDatasets().isEmpty()) {\n+      Set<Long> metricIdsFromDataset = new HashSet<>();\n       for (String dataset : searchFilter.getDatasets()) {\n-        metricIds.retainAll(\n-            this.metricDAO.findByDataset(dataset).stream().map(AbstractDTO::getId).collect(Collectors.toSet()));\n+        metricIdsFromDataset.addAll(this.metricDAO.findByPredicate(Predicate.LIKE(\"dataset\", \"%\" + dataset + \"%\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b426baad2f209af14041167d569bb3e92871ea32"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "346af797ddcd513c5feecdf2d66f356c30e692d6", "author": {"user": {"login": "jihaozh", "name": "Jihao Zhang"}}, "url": "https://github.com/apache/pinot/commit/346af797ddcd513c5feecdf2d66f356c30e692d6", "committedDate": "2020-06-29T21:32:40Z", "message": "[TE] alert search - allow search by both metrics and datasets"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b426baad2f209af14041167d569bb3e92871ea32", "author": {"user": {"login": "jihaozh", "name": "Jihao Zhang"}}, "url": "https://github.com/apache/pinot/commit/b426baad2f209af14041167d569bb3e92871ea32", "committedDate": "2020-06-25T18:29:14Z", "message": "[TE] alert search - allow search by both metrics and datasets"}, "afterCommit": {"oid": "e86005847a155b066bcc0eeb4b158f142b193a51", "author": {"user": {"login": "jihaozh", "name": "Jihao Zhang"}}, "url": "https://github.com/apache/pinot/commit/e86005847a155b066bcc0eeb4b158f142b193a51", "committedDate": "2020-06-29T22:35:34Z", "message": "address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b77685baa56f0aeb5a0804b27e7084799c7e58e3", "author": {"user": {"login": "jihaozh", "name": "Jihao Zhang"}}, "url": "https://github.com/apache/pinot/commit/b77685baa56f0aeb5a0804b27e7084799c7e58e3", "committedDate": "2020-06-29T22:38:19Z", "message": "address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e86005847a155b066bcc0eeb4b158f142b193a51", "author": {"user": {"login": "jihaozh", "name": "Jihao Zhang"}}, "url": "https://github.com/apache/pinot/commit/e86005847a155b066bcc0eeb4b158f142b193a51", "committedDate": "2020-06-29T22:35:34Z", "message": "address comments"}, "afterCommit": {"oid": "b77685baa56f0aeb5a0804b27e7084799c7e58e3", "author": {"user": {"login": "jihaozh", "name": "Jihao Zhang"}}, "url": "https://github.com/apache/pinot/commit/b77685baa56f0aeb5a0804b27e7084799c7e58e3", "committedDate": "2020-06-29T22:38:19Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTU3OTUx", "url": "https://github.com/apache/pinot/pull/5626#pullrequestreview-439557951", "createdAt": "2020-06-29T22:58:37Z", "commit": {"oid": "b77685baa56f0aeb5a0804b27e7084799c7e58e3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 718, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}