{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NDA2Mjg4", "number": 5077, "title": "Reduce the non-determinism in Lucene integration test", "bodyText": "The lucene cluster integration test is written to test both offline and realtime (primarily) text index functionality. The goal of the test is to be able to see an increasingly number of hits/matches in the index for the same query (run in a tight loop 2000 times).\nThe test runs the query 2000 times and starts checking for more than 0 hits from 300th query onwards. It also compares the number of hits (count *) with that of previous query. However, based on how fast the queries are completed, how quickly the documents are ingested and how quickly the realtime segments get refreshed, the check fails and we start to see greater than 0 hits a little after 300th query.\nThe current PR puts a 10ms sleep time between queries to reduce the non-determinism.\nThe test has blocked our internal release builds. I'd like to think about to how to make this more deterministic and address that in a follow-up. For now, this fix should get us going.\nMy original desired goal with the test is to see the final total number of hits (17k) only for the last few hundred queries. Until then we should only be seeing an increasing number of hits. The sleep time compromises this goal since we are going to see the total number of hits sooner. I will address this later.", "createdAt": "2020-02-18T04:04:18Z", "url": "https://github.com/apache/pinot/pull/5077", "merged": true, "mergeCommit": {"oid": "9c65deba0056d668ee9522f286442a8ebec7d4d2"}, "closed": true, "closedAt": "2020-02-18T04:55:42Z", "author": {"login": "siddharthteotia"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFaAYTgFqTM2MDA2MTg3MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFaECrgFqTM2MDA2MjY4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMDYxODcw", "url": "https://github.com/apache/pinot/pull/5077#pullrequestreview-360061870", "createdAt": "2020-02-18T04:13:38Z", "commit": {"oid": "75994c80771cd77fea6bb548fd342dcd08edf2bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNDoxMzozOFrOFq0qQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwNDoxMzozOFrOFq0qQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ0NzI5Nw==", "bodyText": "This was by mistake. Removing it", "url": "https://github.com/apache/pinot/pull/5077#discussion_r380447297", "createdAt": "2020-02-18T04:13:38Z", "author": {"login": "siddharthteotia"}, "path": "pinot-integration-tests/src/test/java/org/apache/pinot/integration/tests/LuceneRealtimeClusterIntegrationTest.java", "diffHunk": "@@ -177,11 +177,13 @@ public void testTextSearchCountQuery() throws Exception {\n       TextNode textNode = (TextNode)pinotResponse.get(\"aggregationResults\").get(0).get(\"value\");\n       int result = Integer.valueOf(textNode.textValue());\n       // TODO: see if this can be made more deterministic\n+      System.out.println(\"query: \" + i + \" result: \" + result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75994c80771cd77fea6bb548fd342dcd08edf2bb"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6fe4e6c63fd6660fba39f39453de5287879f1a9", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/a6fe4e6c63fd6660fba39f39453de5287879f1a9", "committedDate": "2020-02-18T04:15:18Z", "message": "Reduce the non-determinism in lucene integration test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f35d51a11404df9a22ef82a6c4c80e6c91c55ffa", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/f35d51a11404df9a22ef82a6c4c80e6c91c55ffa", "committedDate": "2020-02-18T04:14:10Z", "message": "fix doc"}, "afterCommit": {"oid": "a6fe4e6c63fd6660fba39f39453de5287879f1a9", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/a6fe4e6c63fd6660fba39f39453de5287879f1a9", "committedDate": "2020-02-18T04:15:18Z", "message": "Reduce the non-determinism in lucene integration test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMDYyNjg3", "url": "https://github.com/apache/pinot/pull/5077#pullrequestreview-360062687", "createdAt": "2020-02-18T04:17:39Z", "commit": {"oid": "f35d51a11404df9a22ef82a6c4c80e6c91c55ffa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1303, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}