{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2OTI2NDMy", "number": 5487, "title": "Add multi-value support to SegmentDumpTool", "bodyText": "Also, add the segment dump tool as part of the pinot-tool.sh script\nCurrently segment dump tool supports single-value only. This change adds the multi-value support. It also makes segment dump tool a subcommand in pinot-tool.sh script.", "createdAt": "2020-06-03T02:34:29Z", "url": "https://github.com/apache/pinot/pull/5487", "merged": true, "mergeCommit": {"oid": "5474c4209ce7dcb694ab1122a233d7d6ad7f1ece"}, "closed": true, "closedAt": "2020-06-04T09:08:42Z", "author": {"login": "yupeng9"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnX9pmgH2gAyNDI2OTI2NDMyOmFlOTFjN2IwNGNkNjFiYmQyYTYyNDEyNTFjOGVmOWRmZDIzMjAxMjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcniQU4AFqTQyMzIxOTkzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ae91c7b04cd61bbd2a6241251c8ef9dfd2320128", "author": {"user": {"login": "yupeng9", "name": "Yupeng Fu"}}, "url": "https://github.com/apache/pinot/commit/ae91c7b04cd61bbd2a6241251c8ef9dfd2320128", "committedDate": "2020-06-02T17:04:17Z", "message": "Add multi-value support to SegmentDumpTool\n\nAlso, add segment dump tool as part of the pinot-tool.sh script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMTkxMzE4", "url": "https://github.com/apache/pinot/pull/5487#pullrequestreview-423191318", "createdAt": "2020-06-03T03:18:27Z", "commit": {"oid": "ae91c7b04cd61bbd2a6241251c8ef9dfd2320128"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMTk1MjU3", "url": "https://github.com/apache/pinot/pull/5487#pullrequestreview-423195257", "createdAt": "2020-06-03T03:33:03Z", "commit": {"oid": "ae91c7b04cd61bbd2a6241251c8ef9dfd2320128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwMzozMzowM1rOGeK4sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwMzozMzowM1rOGeK4sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI4ODgxNg==", "bodyText": "add a System.out.print(\"\\t\");?", "url": "https://github.com/apache/pinot/pull/5487#discussion_r434288816", "createdAt": "2020-06-03T03:33:03Z", "author": {"login": "xiangfu0"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/SegmentDumpTool.java", "diffHunk": "@@ -91,11 +102,27 @@ public void doMain(String[] args)\n       System.out.print(i);\n       System.out.print(\"\\t\");\n       for (String columnName : columnNames) {\n-        BlockSingleValIterator itr = iterators.get(columnName);\n-        int encodedValue = itr.nextIntVal();\n-        Object value = dictionaries.get(columnName).get(encodedValue);\n-        System.out.print(value);\n-        System.out.print(\"\\t\");\n+        BlockValIterator itr = iterators.get(columnName);\n+        if (itr instanceof BlockSingleValIterator) {\n+          int encodedValue = ((BlockSingleValIterator) itr).nextIntVal();\n+          Object value = dictionaries.get(columnName).get(encodedValue);\n+          System.out.print(value);\n+          System.out.print(\"\\t\");\n+        } else {\n+          BlockMultiValIterator mItr = (BlockMultiValIterator) itr;\n+          int maxNumValuesPerMVEntry =\n+              indexSegment.getDataSource(columnName).getDataSourceMetadata().getMaxNumValuesPerMVEntry();\n+          int[] intArray = new int[maxNumValuesPerMVEntry];\n+          int length = mItr.nextIntVal(intArray);\n+          System.out.print(\"[\");\n+          for (int j = 0; j < length; j++) {\n+            System.out.print(dictionaries.get(columnName).get(intArray[j]));\n+            if (j != length - 1) {\n+              System.out.print(\",\");\n+            }\n+          }\n+          System.out.print(\"]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae91c7b04cd61bbd2a6241251c8ef9dfd2320128"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMTk1NTEy", "url": "https://github.com/apache/pinot/pull/5487#pullrequestreview-423195512", "createdAt": "2020-06-03T03:33:59Z", "commit": {"oid": "ae91c7b04cd61bbd2a6241251c8ef9dfd2320128"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b20fc5e979c7248c3626a9bcf24bbbe46020ea42", "author": {"user": {"login": "yupeng9", "name": "Yupeng Fu"}}, "url": "https://github.com/apache/pinot/commit/b20fc5e979c7248c3626a9bcf24bbbe46020ea42", "committedDate": "2020-06-03T04:56:59Z", "message": "comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjE5OTMw", "url": "https://github.com/apache/pinot/pull/5487#pullrequestreview-423219930", "createdAt": "2020-06-03T05:03:44Z", "commit": {"oid": "ae91c7b04cd61bbd2a6241251c8ef9dfd2320128"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 898, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}