{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NDEzMjQ0", "number": 5575, "title": "Function to round a time value", "bodyText": "Adding a basic function to round any time value.\nFor example, to round millis to nearest 15 minutes bucket use\n\"transformFunction\": \"round(timestamp, 900000)\"", "createdAt": "2020-06-16T19:07:47Z", "url": "https://github.com/apache/pinot/pull/5575", "merged": true, "mergeCommit": {"oid": "159e24e6200c276704e683a9324a1351a35bb533"}, "closed": true, "closedAt": "2020-06-16T21:46:24Z", "author": {"login": "npawar"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcr6FebAH2gAyNDM1NDEzMjQ0OjVhZmZjMTU3MmU3OWQ4N2Q4Y2ZlNzAyNTVhMjdiMjA5NzlkNGY4ZjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr7xXsgFqTQzMTg4OTUxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5affc1572e79d87d8cfe70255a27b20979d4f8f4", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/5affc1572e79d87d8cfe70255a27b20979d4f8f4", "committedDate": "2020-06-16T19:05:18Z", "message": "Function to round a time value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODIyMDQ1", "url": "https://github.com/apache/pinot/pull/5575#pullrequestreview-431822045", "createdAt": "2020-06-16T19:22:10Z", "commit": {"oid": "5affc1572e79d87d8cfe70255a27b20979d4f8f4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOToyMjoxMFrOGkp4TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOToyMjoxMFrOGkp4TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA4ODA3Nw==", "bodyText": "Use roundToNearest.longValue() and cache it for performance concern.", "url": "https://github.com/apache/pinot/pull/5575#discussion_r441088077", "createdAt": "2020-06-16T19:22:10Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/function/DateTimeFunctions.java", "diffHunk": "@@ -241,6 +241,15 @@ static Long fromDateTime(String dateTimeString, String pattern) {\n     return DateTimePatternHandler.parseDateTimeStringToEpochMillis(dateTimeString, pattern);\n   }\n \n+\n+  /**\n+   * Round the given time value to nearest rounding bucket\n+   */\n+  @ScalarFunction\n+  static Long round(Long timeValue, Number roundToNearest) {\n+    return (timeValue / roundToNearest.intValue()) * roundToNearest.intValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5affc1572e79d87d8cfe70255a27b20979d4f8f4"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODY4ODUx", "url": "https://github.com/apache/pinot/pull/5575#pullrequestreview-431868851", "createdAt": "2020-06-16T20:32:00Z", "commit": {"oid": "5affc1572e79d87d8cfe70255a27b20979d4f8f4"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDozMjowMVrOGksE9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDozMzozOFrOGksI0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEyNDA4Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Round the given time value to nearest rounding bucket\n          \n          \n            \n               * Round the given time value to nearest multiple\n          \n          \n            \n               * @return the original value but rounded to the nearest multiple of @param roundToNearest", "url": "https://github.com/apache/pinot/pull/5575#discussion_r441124087", "createdAt": "2020-06-16T20:32:01Z", "author": {"login": "mcvsubbu"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/function/DateTimeFunctions.java", "diffHunk": "@@ -241,6 +241,15 @@ static Long fromDateTime(String dateTimeString, String pattern) {\n     return DateTimePatternHandler.parseDateTimeStringToEpochMillis(dateTimeString, pattern);\n   }\n \n+\n+  /**\n+   * Round the given time value to nearest rounding bucket", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5affc1572e79d87d8cfe70255a27b20979d4f8f4"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEyNDgwMw==", "bodyText": "We apply this on the stream, which presumably has different input values coming in (e.g. millis). Not sure how we can cache it?", "url": "https://github.com/apache/pinot/pull/5575#discussion_r441124803", "createdAt": "2020-06-16T20:33:07Z", "author": {"login": "mcvsubbu"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/function/DateTimeFunctions.java", "diffHunk": "@@ -241,6 +241,15 @@ static Long fromDateTime(String dateTimeString, String pattern) {\n     return DateTimePatternHandler.parseDateTimeStringToEpochMillis(dateTimeString, pattern);\n   }\n \n+\n+  /**\n+   * Round the given time value to nearest rounding bucket\n+   */\n+  @ScalarFunction\n+  static Long round(Long timeValue, Number roundToNearest) {\n+    return (timeValue / roundToNearest.intValue()) * roundToNearest.intValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA4ODA3Nw=="}, "originalCommit": {"oid": "5affc1572e79d87d8cfe70255a27b20979d4f8f4"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEyNTA3NQ==", "bodyText": "But using long is better, yes.", "url": "https://github.com/apache/pinot/pull/5575#discussion_r441125075", "createdAt": "2020-06-16T20:33:38Z", "author": {"login": "mcvsubbu"}, "path": "pinot-common/src/main/java/org/apache/pinot/common/function/DateTimeFunctions.java", "diffHunk": "@@ -241,6 +241,15 @@ static Long fromDateTime(String dateTimeString, String pattern) {\n     return DateTimePatternHandler.parseDateTimeStringToEpochMillis(dateTimeString, pattern);\n   }\n \n+\n+  /**\n+   * Round the given time value to nearest rounding bucket\n+   */\n+  @ScalarFunction\n+  static Long round(Long timeValue, Number roundToNearest) {\n+    return (timeValue / roundToNearest.intValue()) * roundToNearest.intValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA4ODA3Nw=="}, "originalCommit": {"oid": "5affc1572e79d87d8cfe70255a27b20979d4f8f4"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66f5a7e4c88e030828ed40890cceaa1ed5df76be", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/66f5a7e4c88e030828ed40890cceaa1ed5df76be", "committedDate": "2020-06-16T20:50:58Z", "message": "review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f72d7eec5ceec6d106e0c4064cb30461b74322ff", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/f72d7eec5ceec6d106e0c4064cb30461b74322ff", "committedDate": "2020-06-16T20:51:59Z", "message": "Update pinot-common/src/main/java/org/apache/pinot/common/function/DateTimeFunctions.java\n\nCo-authored-by: Subbu Subramaniam <mcvsubbu@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODg5NTE2", "url": "https://github.com/apache/pinot/pull/5575#pullrequestreview-431889516", "createdAt": "2020-06-16T21:03:09Z", "commit": {"oid": "f72d7eec5ceec6d106e0c4064cb30461b74322ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 626, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}