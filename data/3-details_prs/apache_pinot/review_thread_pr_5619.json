{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NzQyNDQ3", "number": 5619, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDoxMDoyNFrOEI6F3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDoxOToxM1rOEI6QPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Nzc1ODM4OnYy", "diffSide": "RIGHT", "path": "pinot-core/src/main/java/org/apache/pinot/core/common/DataFetcher.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDoxMDoyNFrOGpKGFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMToxOTo0M1rOGpMLfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMDE5Nw==", "bodyText": "Revert this line", "url": "https://github.com/apache/pinot/pull/5619#discussion_r445810197", "createdAt": "2020-06-25T20:10:24Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/common/DataFetcher.java", "diffHunk": "@@ -62,7 +62,7 @@ public DataFetcher(Map<String, DataSource> dataSourceMap) {\n       DataSource dataSource = entry.getValue();\n       _dictionaryMap.put(column, dataSource.getDictionary());\n       DataSourceMetadata dataSourceMetadata = dataSource.getDataSourceMetadata();\n-      BlockValSet blockValueSet = dataSource.nextBlock().getBlockValueSet();\n+      BlockValSet blockValueSet = dataSourceMap.get(column).nextBlock().getBlockValueSet();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5c5660ca371d704c6cc11a9a3eed0dc3d42049f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg0NDM0OQ==", "bodyText": "done", "url": "https://github.com/apache/pinot/pull/5619#discussion_r445844349", "createdAt": "2020-06-25T21:19:43Z", "author": {"login": "siddharthteotia"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/common/DataFetcher.java", "diffHunk": "@@ -62,7 +62,7 @@ public DataFetcher(Map<String, DataSource> dataSourceMap) {\n       DataSource dataSource = entry.getValue();\n       _dictionaryMap.put(column, dataSource.getDictionary());\n       DataSourceMetadata dataSourceMetadata = dataSource.getDataSourceMetadata();\n-      BlockValSet blockValueSet = dataSource.nextBlock().getBlockValueSet();\n+      BlockValSet blockValueSet = dataSourceMap.get(column).nextBlock().getBlockValueSet();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMDE5Nw=="}, "originalCommit": {"oid": "f5c5660ca371d704c6cc11a9a3eed0dc3d42049f"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Nzc2MzE0OnYy", "diffSide": "RIGHT", "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/blocks/MultiValueBlock.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDoxMjowMVrOGpKJHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMToxOTozM1rOGpMLSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMDk3NA==", "bodyText": "(nit) put this line after line 37", "url": "https://github.com/apache/pinot/pull/5619#discussion_r445810974", "createdAt": "2020-06-25T20:12:01Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/blocks/MultiValueBlock.java", "diffHunk": "@@ -31,12 +31,15 @@\n \n @SuppressWarnings(\"rawtypes\")\n public final class MultiValueBlock implements Block {\n-  private final BlockValSet _blockValSet;\n+  private final SingleColumnMultiValueReader _reader;\n+  private final FieldSpec.DataType _dataType;\n+  private BlockValSet _blockValSet;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5c5660ca371d704c6cc11a9a3eed0dc3d42049f"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg0NDI5OA==", "bodyText": "done", "url": "https://github.com/apache/pinot/pull/5619#discussion_r445844298", "createdAt": "2020-06-25T21:19:33Z", "author": {"login": "siddharthteotia"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/blocks/MultiValueBlock.java", "diffHunk": "@@ -31,12 +31,15 @@\n \n @SuppressWarnings(\"rawtypes\")\n public final class MultiValueBlock implements Block {\n-  private final BlockValSet _blockValSet;\n+  private final SingleColumnMultiValueReader _reader;\n+  private final FieldSpec.DataType _dataType;\n+  private BlockValSet _blockValSet;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMDk3NA=="}, "originalCommit": {"oid": "f5c5660ca371d704c6cc11a9a3eed0dc3d42049f"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Nzc2NDkzOnYy", "diffSide": "RIGHT", "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/blocks/SingleValueBlock.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDoxMjozNlrOGpKKNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMToxOTozOFrOGpMLZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMTI1NA==", "bodyText": "(nit) Put this line after line 37", "url": "https://github.com/apache/pinot/pull/5619#discussion_r445811254", "createdAt": "2020-06-25T20:12:36Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/blocks/SingleValueBlock.java", "diffHunk": "@@ -32,13 +32,14 @@\n @SuppressWarnings(\"rawtypes\")\n public final class SingleValueBlock implements Block {\n   private final SingleColumnSingleValueReader _reader;\n-  private final BlockValSet _blockValSet;\n+  private final FieldSpec.DataType _dataType;\n+  private BlockValSet _blockValSet;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5c5660ca371d704c6cc11a9a3eed0dc3d42049f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg0NDMyNw==", "bodyText": "done", "url": "https://github.com/apache/pinot/pull/5619#discussion_r445844327", "createdAt": "2020-06-25T21:19:38Z", "author": {"login": "siddharthteotia"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/blocks/SingleValueBlock.java", "diffHunk": "@@ -32,13 +32,14 @@\n @SuppressWarnings(\"rawtypes\")\n public final class SingleValueBlock implements Block {\n   private final SingleColumnSingleValueReader _reader;\n-  private final BlockValSet _blockValSet;\n+  private final FieldSpec.DataType _dataType;\n+  private BlockValSet _blockValSet;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxMTI1NA=="}, "originalCommit": {"oid": "f5c5660ca371d704c6cc11a9a3eed0dc3d42049f"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Nzc4NDk0OnYy", "diffSide": "RIGHT", "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/blocks/MultiValueBlock.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDoxOToxM1rOGpKXDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMTozMDowM1rOGpMeww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxNDU0MQ==", "bodyText": "@Jackie-Jiang , I am concerned about the invocation of this in multi-threaded scenario. From the code, it doesn't look like it will happen since each query will create it's own. Thoughts?", "url": "https://github.com/apache/pinot/pull/5619#discussion_r445814541", "createdAt": "2020-06-25T20:19:13Z", "author": {"login": "siddharthteotia"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/blocks/MultiValueBlock.java", "diffHunk": "@@ -47,6 +50,9 @@ public BlockDocIdSet getBlockDocIdSet() {\n \n   @Override\n   public BlockValSet getBlockValueSet() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5c5660ca371d704c6cc11a9a3eed0dc3d42049f"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTg0OTI4Mw==", "bodyText": "@siddharthteotia There is no multi-threading for the blocks. All the blocks are processed by one thread", "url": "https://github.com/apache/pinot/pull/5619#discussion_r445849283", "createdAt": "2020-06-25T21:30:03Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/operator/blocks/MultiValueBlock.java", "diffHunk": "@@ -47,6 +50,9 @@ public BlockDocIdSet getBlockDocIdSet() {\n \n   @Override\n   public BlockValSet getBlockValueSet() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgxNDU0MQ=="}, "originalCommit": {"oid": "f5c5660ca371d704c6cc11a9a3eed0dc3d42049f"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4387, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}