{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3Mzg4MTY4", "number": 6103, "title": "Fix missing segment count reporting for realtime llc segment", "bodyText": "Description\nFix Pinot segment count metric reporting for llc segment manager.\nBelow is a segment count metric for pinot realtime server, the realtime segment count keeps going down as the consuming segment got persisted and moved to offline server.\n\nAfter this change, we can see that number of segments become positive for realtime server:", "createdAt": "2020-10-04T07:06:46Z", "url": "https://github.com/apache/pinot/pull/6103", "merged": true, "mergeCommit": {"oid": "2afea5c70f2561d041d6444f5b05fea04ddfa0d8"}, "closed": true, "closedAt": "2020-10-05T23:00:23Z", "author": {"login": "xiangfu0"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPJwtfgH2gAyNDk3Mzg4MTY4OmJiMmE4Yzk1YzBlMGVlM2ZjZmQyYjAwMjYzOTAxZWRjMzY2YTYwZGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPoeDuAFqTUwMjMzMjM5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bb2a8c95c0e0ee3fcfd2b00263901edc366a60da", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/bb2a8c95c0e0ee3fcfd2b00263901edc366a60da", "committedDate": "2020-10-04T07:08:27Z", "message": "Fix missing segment count reporting for realtime llc segment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a40afe784e671c849c9eab8958b03e4019112ae5", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/a40afe784e671c849c9eab8958b03e4019112ae5", "committedDate": "2020-10-04T07:04:05Z", "message": "Fix missing segment count reporting for realtime llc segment"}, "afterCommit": {"oid": "bb2a8c95c0e0ee3fcfd2b00263901edc366a60da", "author": {"user": {"login": "xiangfu0", "name": "Xiang Fu"}}, "url": "https://github.com/apache/pinot/commit/bb2a8c95c0e0ee3fcfd2b00263901edc366a60da", "committedDate": "2020-10-04T07:08:27Z", "message": "Fix missing segment count reporting for realtime llc segment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMzA0MjM3", "url": "https://github.com/apache/pinot/pull/6103#pullrequestreview-502304237", "createdAt": "2020-10-05T18:15:25Z", "commit": {"oid": "bb2a8c95c0e0ee3fcfd2b00263901edc366a60da"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxODoxNToyNVrOHcoYgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxODoxNToyNVrOHcoYgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc4MzgxMQ==", "bodyText": "This one should be added inside the else block in line 237, or we will double counting because this gauge will also be updated in addSegment(ImmutableSegmentLoader.load(indexDir, indexLoadingConfig, schema));", "url": "https://github.com/apache/pinot/pull/6103#discussion_r499783811", "createdAt": "2020-10-05T18:15:25Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/RealtimeTableDataManager.java", "diffHunk": "@@ -269,6 +270,7 @@ public void addSegment(String segmentName, TableConfig tableConfig, IndexLoading\n       }\n       _logger.info(\"Initialize RealtimeSegmentDataManager - \" + segmentName);\n       _segmentDataManagerMap.put(segmentName, manager);\n+      _serverMetrics.addValueToTableGauge(_tableNameWithType, ServerGauge.SEGMENT_COUNT, 1L);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb2a8c95c0e0ee3fcfd2b00263901edc366a60da"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMzMyMzkx", "url": "https://github.com/apache/pinot/pull/6103#pullrequestreview-502332391", "createdAt": "2020-10-05T18:55:08Z", "commit": {"oid": "bb2a8c95c0e0ee3fcfd2b00263901edc366a60da"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1528, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}