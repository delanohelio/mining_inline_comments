{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3ODQ0NjIz", "number": 5208, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMDo0NTo1MVrODwKMPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMToxMzoyOFrODwKviw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODI1MjE0OnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMDo0NTo1MVrOGDATgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwNTowNDo1OVrOGESReQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMzkwNQ==", "bodyText": "log the exception.", "url": "https://github.com/apache/pinot/pull/5208#discussion_r405803905", "createdAt": "2020-04-08T20:45:51Z", "author": {"login": "akshayrai"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "diffHunk": "@@ -120,11 +134,62 @@ private void executeMonitorUpdate(MonitorTaskInfo monitorTaskInfo) {\n \n       // update detection health\n       updateDetectionHealth();\n+\n+      // disable alerts that failed consecutively for a long time\n+      disableLongFailedAlerts();\n+\n     } catch (Exception e) {\n       LOG.error(\"Exception in monitor update task\", e);\n     }\n   }\n \n+  /**\n+   * Disable the alert if it was updated before {@MAX_TASK_FAIL_DAYS} but there is no success run since then.\n+   */\n+  private void disableLongFailedAlerts() {\n+    DetectionConfigManager detectionDAO = DAO_REGISTRY.getDetectionConfigManager();\n+    List<DetectionConfigDTO> detectionConfigs = detectionDAO.findAllActive();\n+    long currentTimeMills = System.currentTimeMillis();\n+    long maxTaskFailMills = TimeUnit.DAYS.toMillis(MAX_FAILED_DISABLE_DAYS);\n+    for (DetectionConfigDTO config : detectionConfigs) {\n+      try {\n+        Timestamp updateTime = config.getUpdateTime();\n+        if (updateTime != null && config.getHealth() != null && config.getHealth().getDetectionTaskStatus() != null) {\n+          long lastTaskExecutionTime = config.getHealth().getDetectionTaskStatus().getLastTaskExecutionTime();\n+          if (updateTime.getTime() <= currentTimeMills - maxTaskFailMills && (lastTaskExecutionTime == -1L\n+              || lastTaskExecutionTime <= currentTimeMills - maxTaskFailMills)) {\n+            config.setActive(false);\n+            detectionDAO.update(config);\n+            sendDisableAlertNotificationEmail(config);\n+            LOG.info(\"Disabled alert \" + config.getId() + \" since it failed more than \" + MAX_FAILED_DISABLE_DAYS + \" days\");\n+            LOG.info(\"Task last update time: \" + config.getUpdateTime());\n+            LOG.info(\"Last success task execution time: \" + lastTaskExecutionTime);\n+          }\n+        }\n+      } catch (Exception e) {\n+        LOG.error(\"Exception in disabling alert \", config.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "010a571405362815894629caeebf5cd4f344d50a"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzE0Njg3Mw==", "bodyText": "fixed", "url": "https://github.com/apache/pinot/pull/5208#discussion_r407146873", "createdAt": "2020-04-12T05:04:59Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "diffHunk": "@@ -120,11 +134,62 @@ private void executeMonitorUpdate(MonitorTaskInfo monitorTaskInfo) {\n \n       // update detection health\n       updateDetectionHealth();\n+\n+      // disable alerts that failed consecutively for a long time\n+      disableLongFailedAlerts();\n+\n     } catch (Exception e) {\n       LOG.error(\"Exception in monitor update task\", e);\n     }\n   }\n \n+  /**\n+   * Disable the alert if it was updated before {@MAX_TASK_FAIL_DAYS} but there is no success run since then.\n+   */\n+  private void disableLongFailedAlerts() {\n+    DetectionConfigManager detectionDAO = DAO_REGISTRY.getDetectionConfigManager();\n+    List<DetectionConfigDTO> detectionConfigs = detectionDAO.findAllActive();\n+    long currentTimeMills = System.currentTimeMillis();\n+    long maxTaskFailMills = TimeUnit.DAYS.toMillis(MAX_FAILED_DISABLE_DAYS);\n+    for (DetectionConfigDTO config : detectionConfigs) {\n+      try {\n+        Timestamp updateTime = config.getUpdateTime();\n+        if (updateTime != null && config.getHealth() != null && config.getHealth().getDetectionTaskStatus() != null) {\n+          long lastTaskExecutionTime = config.getHealth().getDetectionTaskStatus().getLastTaskExecutionTime();\n+          if (updateTime.getTime() <= currentTimeMills - maxTaskFailMills && (lastTaskExecutionTime == -1L\n+              || lastTaskExecutionTime <= currentTimeMills - maxTaskFailMills)) {\n+            config.setActive(false);\n+            detectionDAO.update(config);\n+            sendDisableAlertNotificationEmail(config);\n+            LOG.info(\"Disabled alert \" + config.getId() + \" since it failed more than \" + MAX_FAILED_DISABLE_DAYS + \" days\");\n+            LOG.info(\"Task last update time: \" + config.getUpdateTime());\n+            LOG.info(\"Last success task execution time: \" + lastTaskExecutionTime);\n+          }\n+        }\n+      } catch (Exception e) {\n+        LOG.error(\"Exception in disabling alert \", config.getId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwMzkwNQ=="}, "originalCommit": {"oid": "010a571405362815894629caeebf5cd4f344d50a"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODMwMTYyOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTowMDowNFrOGDAyYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwNTowNjowN1rOGESRwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxMTgxMQ==", "bodyText": "Can we include some unit tests for this?", "url": "https://github.com/apache/pinot/pull/5208#discussion_r405811811", "createdAt": "2020-04-08T21:00:04Z", "author": {"login": "akshayrai"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "diffHunk": "@@ -120,11 +134,62 @@ private void executeMonitorUpdate(MonitorTaskInfo monitorTaskInfo) {\n \n       // update detection health\n       updateDetectionHealth();\n+\n+      // disable alerts that failed consecutively for a long time\n+      disableLongFailedAlerts();\n+\n     } catch (Exception e) {\n       LOG.error(\"Exception in monitor update task\", e);\n     }\n   }\n \n+  /**\n+   * Disable the alert if it was updated before {@MAX_TASK_FAIL_DAYS} but there is no success run since then.\n+   */\n+  private void disableLongFailedAlerts() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "010a571405362815894629caeebf5cd4f344d50a"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzE0Njk0Ng==", "bodyText": "Currently we don't have a good way to test it. The only way would be integration test. But having more than one integration tests running may cause conflicts. That's why I have to add sequence number in our local integration test.", "url": "https://github.com/apache/pinot/pull/5208#discussion_r407146946", "createdAt": "2020-04-12T05:06:07Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "diffHunk": "@@ -120,11 +134,62 @@ private void executeMonitorUpdate(MonitorTaskInfo monitorTaskInfo) {\n \n       // update detection health\n       updateDetectionHealth();\n+\n+      // disable alerts that failed consecutively for a long time\n+      disableLongFailedAlerts();\n+\n     } catch (Exception e) {\n       LOG.error(\"Exception in monitor update task\", e);\n     }\n   }\n \n+  /**\n+   * Disable the alert if it was updated before {@MAX_TASK_FAIL_DAYS} but there is no success run since then.\n+   */\n+  private void disableLongFailedAlerts() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxMTgxMQ=="}, "originalCommit": {"oid": "010a571405362815894629caeebf5cd4f344d50a"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODMxNTMzOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTowNDozOVrOGDA7MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwNTowNDo1MlrOGESRZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxNDA2NA==", "bodyText": "nit: typo currentTimeMillis & maxTaskFailMillis", "url": "https://github.com/apache/pinot/pull/5208#discussion_r405814064", "createdAt": "2020-04-08T21:04:39Z", "author": {"login": "akshayrai"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "diffHunk": "@@ -120,11 +134,62 @@ private void executeMonitorUpdate(MonitorTaskInfo monitorTaskInfo) {\n \n       // update detection health\n       updateDetectionHealth();\n+\n+      // disable alerts that failed consecutively for a long time\n+      disableLongFailedAlerts();\n+\n     } catch (Exception e) {\n       LOG.error(\"Exception in monitor update task\", e);\n     }\n   }\n \n+  /**\n+   * Disable the alert if it was updated before {@MAX_TASK_FAIL_DAYS} but there is no success run since then.\n+   */\n+  private void disableLongFailedAlerts() {\n+    DetectionConfigManager detectionDAO = DAO_REGISTRY.getDetectionConfigManager();\n+    List<DetectionConfigDTO> detectionConfigs = detectionDAO.findAllActive();\n+    long currentTimeMills = System.currentTimeMillis();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "010a571405362815894629caeebf5cd4f344d50a"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzE0Njg1Mg==", "bodyText": "fixed", "url": "https://github.com/apache/pinot/pull/5208#discussion_r407146852", "createdAt": "2020-04-12T05:04:52Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "diffHunk": "@@ -120,11 +134,62 @@ private void executeMonitorUpdate(MonitorTaskInfo monitorTaskInfo) {\n \n       // update detection health\n       updateDetectionHealth();\n+\n+      // disable alerts that failed consecutively for a long time\n+      disableLongFailedAlerts();\n+\n     } catch (Exception e) {\n       LOG.error(\"Exception in monitor update task\", e);\n     }\n   }\n \n+  /**\n+   * Disable the alert if it was updated before {@MAX_TASK_FAIL_DAYS} but there is no success run since then.\n+   */\n+  private void disableLongFailedAlerts() {\n+    DetectionConfigManager detectionDAO = DAO_REGISTRY.getDetectionConfigManager();\n+    List<DetectionConfigDTO> detectionConfigs = detectionDAO.findAllActive();\n+    long currentTimeMills = System.currentTimeMillis();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxNDA2NA=="}, "originalCommit": {"oid": "010a571405362815894629caeebf5cd4f344d50a"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODMyMjM3OnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTowNzowMFrOGDA_sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwNDo0Mjo0M1rOGESKmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxNTIxOQ==", "bodyText": "Can we skip the lastTaskExecutionTime == -1L check?\nIsn't that already covered by lastTaskExecutionTime <= currentTimeMills - maxTaskFailMills?", "url": "https://github.com/apache/pinot/pull/5208#discussion_r405815219", "createdAt": "2020-04-08T21:07:00Z", "author": {"login": "akshayrai"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "diffHunk": "@@ -120,11 +134,62 @@ private void executeMonitorUpdate(MonitorTaskInfo monitorTaskInfo) {\n \n       // update detection health\n       updateDetectionHealth();\n+\n+      // disable alerts that failed consecutively for a long time\n+      disableLongFailedAlerts();\n+\n     } catch (Exception e) {\n       LOG.error(\"Exception in monitor update task\", e);\n     }\n   }\n \n+  /**\n+   * Disable the alert if it was updated before {@MAX_TASK_FAIL_DAYS} but there is no success run since then.\n+   */\n+  private void disableLongFailedAlerts() {\n+    DetectionConfigManager detectionDAO = DAO_REGISTRY.getDetectionConfigManager();\n+    List<DetectionConfigDTO> detectionConfigs = detectionDAO.findAllActive();\n+    long currentTimeMills = System.currentTimeMillis();\n+    long maxTaskFailMills = TimeUnit.DAYS.toMillis(MAX_FAILED_DISABLE_DAYS);\n+    for (DetectionConfigDTO config : detectionConfigs) {\n+      try {\n+        Timestamp updateTime = config.getUpdateTime();\n+        if (updateTime != null && config.getHealth() != null && config.getHealth().getDetectionTaskStatus() != null) {\n+          long lastTaskExecutionTime = config.getHealth().getDetectionTaskStatus().getLastTaskExecutionTime();\n+          if (updateTime.getTime() <= currentTimeMills - maxTaskFailMills && (lastTaskExecutionTime == -1L", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "010a571405362815894629caeebf5cd4f344d50a"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzE0NTExNA==", "bodyText": "lastTaskExecutionTime == -1L is used for backward compatibility.\nCurrently we have many long failing alerts have -1L.", "url": "https://github.com/apache/pinot/pull/5208#discussion_r407145114", "createdAt": "2020-04-12T04:42:43Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "diffHunk": "@@ -120,11 +134,62 @@ private void executeMonitorUpdate(MonitorTaskInfo monitorTaskInfo) {\n \n       // update detection health\n       updateDetectionHealth();\n+\n+      // disable alerts that failed consecutively for a long time\n+      disableLongFailedAlerts();\n+\n     } catch (Exception e) {\n       LOG.error(\"Exception in monitor update task\", e);\n     }\n   }\n \n+  /**\n+   * Disable the alert if it was updated before {@MAX_TASK_FAIL_DAYS} but there is no success run since then.\n+   */\n+  private void disableLongFailedAlerts() {\n+    DetectionConfigManager detectionDAO = DAO_REGISTRY.getDetectionConfigManager();\n+    List<DetectionConfigDTO> detectionConfigs = detectionDAO.findAllActive();\n+    long currentTimeMills = System.currentTimeMillis();\n+    long maxTaskFailMills = TimeUnit.DAYS.toMillis(MAX_FAILED_DISABLE_DAYS);\n+    for (DetectionConfigDTO config : detectionConfigs) {\n+      try {\n+        Timestamp updateTime = config.getUpdateTime();\n+        if (updateTime != null && config.getHealth() != null && config.getHealth().getDetectionTaskStatus() != null) {\n+          long lastTaskExecutionTime = config.getHealth().getDetectionTaskStatus().getLastTaskExecutionTime();\n+          if (updateTime.getTime() <= currentTimeMills - maxTaskFailMills && (lastTaskExecutionTime == -1L", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxNTIxOQ=="}, "originalCommit": {"oid": "010a571405362815894629caeebf5cd4f344d50a"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODMyODIyOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTowODo1MVrOGDBDaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTowODo1MVrOGDBDaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxNjE2OQ==", "bodyText": "Clubbing them into one log statement might be easier to debug.", "url": "https://github.com/apache/pinot/pull/5208#discussion_r405816169", "createdAt": "2020-04-08T21:08:51Z", "author": {"login": "akshayrai"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "diffHunk": "@@ -120,11 +134,62 @@ private void executeMonitorUpdate(MonitorTaskInfo monitorTaskInfo) {\n \n       // update detection health\n       updateDetectionHealth();\n+\n+      // disable alerts that failed consecutively for a long time\n+      disableLongFailedAlerts();\n+\n     } catch (Exception e) {\n       LOG.error(\"Exception in monitor update task\", e);\n     }\n   }\n \n+  /**\n+   * Disable the alert if it was updated before {@MAX_TASK_FAIL_DAYS} but there is no success run since then.\n+   */\n+  private void disableLongFailedAlerts() {\n+    DetectionConfigManager detectionDAO = DAO_REGISTRY.getDetectionConfigManager();\n+    List<DetectionConfigDTO> detectionConfigs = detectionDAO.findAllActive();\n+    long currentTimeMills = System.currentTimeMillis();\n+    long maxTaskFailMills = TimeUnit.DAYS.toMillis(MAX_FAILED_DISABLE_DAYS);\n+    for (DetectionConfigDTO config : detectionConfigs) {\n+      try {\n+        Timestamp updateTime = config.getUpdateTime();\n+        if (updateTime != null && config.getHealth() != null && config.getHealth().getDetectionTaskStatus() != null) {\n+          long lastTaskExecutionTime = config.getHealth().getDetectionTaskStatus().getLastTaskExecutionTime();\n+          if (updateTime.getTime() <= currentTimeMills - maxTaskFailMills && (lastTaskExecutionTime == -1L\n+              || lastTaskExecutionTime <= currentTimeMills - maxTaskFailMills)) {\n+            config.setActive(false);\n+            detectionDAO.update(config);\n+            sendDisableAlertNotificationEmail(config);\n+            LOG.info(\"Disabled alert \" + config.getId() + \" since it failed more than \" + MAX_FAILED_DISABLE_DAYS + \" days\");\n+            LOG.info(\"Task last update time: \" + config.getUpdateTime());\n+            LOG.info(\"Last success task execution time: \" + lastTaskExecutionTime);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "010a571405362815894629caeebf5cd4f344d50a"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODM0MjUxOnYy", "diffSide": "RIGHT", "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMToxMzoyOVrOGDBMYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQwNDo1NjoyM1rOGESPBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxODQ2NA==", "bodyText": "What if the alert was updated(after receiving the below notification) and it still continues to fail? We don't want to disable & notify them again?", "url": "https://github.com/apache/pinot/pull/5208#discussion_r405818464", "createdAt": "2020-04-08T21:13:29Z", "author": {"login": "akshayrai"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "diffHunk": "@@ -120,11 +134,62 @@ private void executeMonitorUpdate(MonitorTaskInfo monitorTaskInfo) {\n \n       // update detection health\n       updateDetectionHealth();\n+\n+      // disable alerts that failed consecutively for a long time\n+      disableLongFailedAlerts();\n+\n     } catch (Exception e) {\n       LOG.error(\"Exception in monitor update task\", e);\n     }\n   }\n \n+  /**\n+   * Disable the alert if it was updated before {@MAX_TASK_FAIL_DAYS} but there is no success run since then.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "010a571405362815894629caeebf5cd4f344d50a"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzE0NjI0NQ==", "bodyText": "Yes we want to handle it more conservatively. Give them 30 days grace period.", "url": "https://github.com/apache/pinot/pull/5208#discussion_r407146245", "createdAt": "2020-04-12T04:56:23Z", "author": {"login": "xiaohui-sun"}, "path": "thirdeye/thirdeye-pinot/src/main/java/org/apache/pinot/thirdeye/anomaly/monitor/MonitorTaskRunner.java", "diffHunk": "@@ -120,11 +134,62 @@ private void executeMonitorUpdate(MonitorTaskInfo monitorTaskInfo) {\n \n       // update detection health\n       updateDetectionHealth();\n+\n+      // disable alerts that failed consecutively for a long time\n+      disableLongFailedAlerts();\n+\n     } catch (Exception e) {\n       LOG.error(\"Exception in monitor update task\", e);\n     }\n   }\n \n+  /**\n+   * Disable the alert if it was updated before {@MAX_TASK_FAIL_DAYS} but there is no success run since then.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxODQ2NA=="}, "originalCommit": {"oid": "010a571405362815894629caeebf5cd4f344d50a"}, "originalPosition": 65}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3348, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}