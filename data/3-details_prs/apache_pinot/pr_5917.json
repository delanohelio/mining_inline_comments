{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMTk0NzYw", "number": 5917, "title": "Starts Broker and Server in parallel when using ServiceManager", "bodyText": "Description\nThis makes PinotServiceManager start services in the following order end ensures the process exit code is 1 on failure.\n\nPinotServiceManager\nBootstrap services in role ServiceRole.CONTROLLER\nAll remaining bootstrap services in parallel\n\nFixes #5876\nUpgrade Notes\nDoes this PR prevent a zero down-time upgrade? No\nDoes this PR fix a zero-downtime upgrade introduced earlier? No\nDoes this PR otherwise need attention when creating release notes? Yes\nRelease Notes\nPinotServiceManager now services in the following order end ensures the process exit code is 1 on failure.\n\nPinotServiceManager\nBootstrap services in role ServiceRole.CONTROLLER\nAll remaining bootstrap services in parallel\n\nDocumentation\nN/A", "createdAt": "2020-08-25T13:12:08Z", "url": "https://github.com/apache/pinot/pull/5917", "merged": true, "mergeCommit": {"oid": "21a372b2f58f9c6e27fe9710d6952ed519342061"}, "closed": true, "closedAt": "2020-08-27T17:14:32Z", "author": {"login": "codefromthecrypt"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCW9GcAH2gAyNDczMTk0NzYwOjEzNzE4MGY1NTQ0MTI5NWZhODAzMmEwYWJjMmRjZjlmNzlkY2FjM2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDDlKhgFqTQ3NjkyMDk2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "137180f55441295fa8032a0abc2dcf9f79dcac3a", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/137180f55441295fa8032a0abc2dcf9f79dcac3a", "committedDate": "2020-08-25T13:09:44Z", "message": "Starts Broker and Server in parallel when using ServiceManager\n\nFixes #5876"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NDcxOTQw", "url": "https://github.com/apache/pinot/pull/5917#pullrequestreview-474471940", "createdAt": "2020-08-25T13:19:15Z", "commit": {"oid": "137180f55441295fa8032a0abc2dcf9f79dcac3a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoxOToxNlrOHGXr0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMzoxOToxNlrOHGXr0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0MTU1Mw==", "bodyText": "intentionally left controller out of here as it seemed there was some reason to. Otherwise, I'd like to put it in :D", "url": "https://github.com/apache/pinot/pull/5917#discussion_r476441553", "createdAt": "2020-08-25T13:19:16Z", "author": {"login": "codefromthecrypt"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "diffHunk": "@@ -192,7 +192,20 @@ public boolean execute()\n   }\n \n   private void startPinotService(Map<String, Object> properties) {\n-    startPinotService(ServiceRole.valueOf(properties.get(PINOT_SERVICE_ROLE).toString()), properties);\n+    ServiceRole role = ServiceRole.valueOf(properties.get(PINOT_SERVICE_ROLE).toString());\n+    switch (role) {\n+      // Broker and Server can be started in parallel always\n+      case BROKER:\n+      case SERVER:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "137180f55441295fa8032a0abc2dcf9f79dcac3a"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MDQyNDY3", "url": "https://github.com/apache/pinot/pull/5917#pullrequestreview-475042467", "createdAt": "2020-08-25T23:01:53Z", "commit": {"oid": "137180f55441295fa8032a0abc2dcf9f79dcac3a"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMzowMTo1M1rOHGvPqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMzowMjo1OVrOHGvUgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjgyNzU2MA==", "bodyText": "I dont think there is any reason to not add controller. @fx19880617", "url": "https://github.com/apache/pinot/pull/5917#discussion_r476827560", "createdAt": "2020-08-25T23:01:53Z", "author": {"login": "kishoreg"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "diffHunk": "@@ -192,7 +192,20 @@ public boolean execute()\n   }\n \n   private void startPinotService(Map<String, Object> properties) {\n-    startPinotService(ServiceRole.valueOf(properties.get(PINOT_SERVICE_ROLE).toString()), properties);\n+    ServiceRole role = ServiceRole.valueOf(properties.get(PINOT_SERVICE_ROLE).toString());\n+    switch (role) {\n+      // Broker and Server can be started in parallel always\n+      case BROKER:\n+      case SERVER:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ0MTU1Mw=="}, "originalCommit": {"oid": "137180f55441295fa8032a0abc2dcf9f79dcac3a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjgyODgwMg==", "bodyText": "Add a log before starting the service and another one after the service is started and measure log the time it took to start", "url": "https://github.com/apache/pinot/pull/5917#discussion_r476828802", "createdAt": "2020-08-25T23:02:59Z", "author": {"login": "kishoreg"}, "path": "pinot-tools/src/main/java/org/apache/pinot/tools/admin/command/StartServiceManagerCommand.java", "diffHunk": "@@ -192,7 +192,20 @@ public boolean execute()\n   }\n \n   private void startPinotService(Map<String, Object> properties) {\n-    startPinotService(ServiceRole.valueOf(properties.get(PINOT_SERVICE_ROLE).toString()), properties);\n+    ServiceRole role = ServiceRole.valueOf(properties.get(PINOT_SERVICE_ROLE).toString());\n+    switch (role) {\n+      // Broker and Server can be started in parallel always\n+      case BROKER:\n+      case SERVER:\n+        new Thread(\"Starting \" + role) {\n+          @Override public void run() {\n+            startPinotService(role, properties);\n+          }\n+        }.start();\n+        break;\n+      default:\n+        startPinotService(role, properties);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "137180f55441295fa8032a0abc2dcf9f79dcac3a"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4460cd7909e6e93b841fbf14c69a8488ebb6cc81", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/4460cd7909e6e93b841fbf14c69a8488ebb6cc81", "committedDate": "2020-08-26T06:14:20Z", "message": "rejig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c3850c7aa433d5c5f94ec46d821c4d252cd0ac9", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/7c3850c7aa433d5c5f94ec46d821c4d252cd0ac9", "committedDate": "2020-08-26T07:43:57Z", "message": "also time SM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab7306fc9f4453536aa2d84e2c2c42200a1d32b9", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/ab7306fc9f4453536aa2d84e2c2c42200a1d32b9", "committedDate": "2020-08-26T09:24:59Z", "message": "block until services complete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3508311f31a79d45a279d3a2fe1437bdfd2358be", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/3508311f31a79d45a279d3a2fe1437bdfd2358be", "committedDate": "2020-08-26T09:30:17Z", "message": "getZKHelixManager can throw"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42ea513a77800ac853ece200c9e92b2a5cfca711", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/42ea513a77800ac853ece200c9e92b2a5cfca711", "committedDate": "2020-08-26T09:46:49Z", "message": "Don't check helix as it spams logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33ce4636bf0aaf95d5d48fab392b0e11a4366587", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/33ce4636bf0aaf95d5d48fab392b0e11a4366587", "committedDate": "2020-08-26T09:53:08Z", "message": "matches case format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6a7fb624c88b8f881973004ccb45e1602aac4fb", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/b6a7fb624c88b8f881973004ccb45e1602aac4fb", "committedDate": "2020-08-27T00:58:43Z", "message": "Ensures any failure results in exit code 1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTIwOTY2", "url": "https://github.com/apache/pinot/pull/5917#pullrequestreview-476920966", "createdAt": "2020-08-27T17:09:19Z", "commit": {"oid": "b6a7fb624c88b8f881973004ccb45e1602aac4fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 266, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}