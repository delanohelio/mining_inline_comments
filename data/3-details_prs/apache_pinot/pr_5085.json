{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MDY5NTY2", "number": 5085, "title": "Support text index load for V1 segment format", "bodyText": "Currently in Pinot, the segments are always generated in V1 and later during post-creation processing, if SegmentGeneratorConfig has segmentVersion as V3, we convert it to V3. This is also true for text indexes in segments. The converter already supports V1 -> V3 for text indexes.\nUpon segment load, we need to address the following scenarios:\nCASE 1:  If IndexLoadingConfig specifies a segment version to load and if it is different than\nthe on-disk version of the segment, then ImmutableSegmentLoader will take care of up-converting the on-disk segment to V3 before load. The converter already has support for converting V1 text index to V3. So the text index can be loaded from segmentIndexDir/V3/ since V3 sub-directory would have already been created\nCASE 2: However, if IndexLoadingConfig doesn't specify the segment version to load or if the specified version is same as the on-disk version of the segment (could be either V1, V2 or V3), then ImmutableSegmentLoader will load whatever the version of segment is on disk.\nThe text index reader created as part of segment load should be agnostic of above cases.\nAdded a test to cover all cases in LoaderTest", "createdAt": "2020-02-21T02:15:33Z", "url": "https://github.com/apache/pinot/pull/5085", "merged": true, "mergeCommit": {"oid": "21850ba17132c52f175d85930ca561849a1218b5"}, "closed": true, "closedAt": "2020-02-21T08:35:33Z", "author": {"login": "siddharthteotia"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGWrhygFqTM2MjM3MjA3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGbU97AFqTM2MjQ2MDgwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMzcyMDc2", "url": "https://github.com/apache/pinot/pull/5085#pullrequestreview-362372076", "createdAt": "2020-02-21T02:54:31Z", "commit": {"oid": "f7d8407085a474462f69d1d8e8ade780964bbe89"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwMjo1NDozMVrOFsqLgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwMjo1NDozMVrOFsqLgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM3MjczOQ==", "bodyText": "Change this to:\n@Nullable\npublic static File getTextIndexFile(File indexDir, String column) {\n  return findFormatFile(indexDir, column + LuceneTextIndexCreator.LUCENE_TEXT_INDEX_FILE_EXTENSION);\n}", "url": "https://github.com/apache/pinot/pull/5085#discussion_r382372739", "createdAt": "2020-02-21T02:54:31Z", "author": {"login": "Jackie-Jiang"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/segment/store/SegmentDirectoryPaths.java", "diffHunk": "@@ -78,6 +79,20 @@ public static File findStarTreeFile(@Nonnull File indexDir) {\n     return findFormatFile(indexDir, V1Constants.STAR_TREE_INDEX_FILE);\n   }\n \n+  public static File getTextIndexIndexFile(File indexDir, SegmentVersion segmentVersion, String column) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d8407085a474462f69d1d8e8ade780964bbe89"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfbbc6ddea984908f74fc87a852bc5ea3414f74c", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/bfbbc6ddea984908f74fc87a852bc5ea3414f74c", "committedDate": "2020-02-21T06:47:57Z", "message": "Support text index load for V1 segment format"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7d8407085a474462f69d1d8e8ade780964bbe89", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/f7d8407085a474462f69d1d8e8ade780964bbe89", "committedDate": "2020-02-21T02:09:01Z", "message": "Support text index load for V1 segments"}, "afterCommit": {"oid": "bfbbc6ddea984908f74fc87a852bc5ea3414f74c", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/bfbbc6ddea984908f74fc87a852bc5ea3414f74c", "committedDate": "2020-02-21T06:47:57Z", "message": "Support text index load for V1 segment format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab59298a770a6ab09d120abeacd6e85258074fc8", "author": {"user": null}, "url": "https://github.com/apache/pinot/commit/ab59298a770a6ab09d120abeacd6e85258074fc8", "committedDate": "2020-02-21T06:56:21Z", "message": "Fix formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDYwODA3", "url": "https://github.com/apache/pinot/pull/5085#pullrequestreview-362460807", "createdAt": "2020-02-21T08:19:58Z", "commit": {"oid": "ab59298a770a6ab09d120abeacd6e85258074fc8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1315, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}