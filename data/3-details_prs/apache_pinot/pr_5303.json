{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4OTkyMjA5", "number": 5303, "title": "Pull the source fields Set out of the RecordReader/Decoder", "bodyText": "Adding the source field names HashSet to the init of RecordReader and Decoder, thus removing it from inside the Reader/Decoder.\nUltimate goal is to move ExpressionEvaluators and SchemaFieldExtractorUtils to pinot-core.\nThis change will also help take us in the direction of further removing the Schema from init of RecordReader and Decoder.", "createdAt": "2020-04-26T00:30:20Z", "url": "https://github.com/apache/pinot/pull/5303", "merged": true, "mergeCommit": {"oid": "bfddb7a34dc60c80c059facaf0df3f7247fe81f9"}, "closed": true, "closedAt": "2020-04-27T18:48:54Z", "author": {"login": "npawar"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbMVEvgH2gAyNDA4OTkyMjA5OjdiYWVmNWUzZTk0NDYxNTdjMTk1YjM4ZGIwMDg0Y2FhZjVhZDJmNmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbzL94AFqTQwMTE5NTExNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7baef5e3e9446157c195b38db0084caaf5ad2f6b", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/7baef5e3e9446157c195b38db0084caaf5ad2f6b", "committedDate": "2020-04-25T20:43:55Z", "message": "Pull source fields set outside RecordReader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f79e719ac44652284e75c1716f44bfddb7c1871f", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/f79e719ac44652284e75c1716f44bfddb7c1871f", "committedDate": "2020-04-25T23:57:33Z", "message": "Pull sourceFields Set outside of StreamMessageDecoder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44473f02c1b92d8ee9760e41a339f68551baba0e", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/44473f02c1b92d8ee9760e41a339f68551baba0e", "committedDate": "2020-04-26T00:26:35Z", "message": "Fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNDUwNzY0", "url": "https://github.com/apache/pinot/pull/5303#pullrequestreview-400450764", "createdAt": "2020-04-26T02:39:44Z", "commit": {"oid": "44473f02c1b92d8ee9760e41a339f68551baba0e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQwMjozOTo0NFrOGL9hgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNlQwMjozOTo0NFrOGL9hgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTE5NTUyMg==", "bodyText": "java docs", "url": "https://github.com/apache/pinot/pull/5303#discussion_r415195522", "createdAt": "2020-04-26T02:39:44Z", "author": {"login": "kishoreg"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/stream/StreamMessageDecoder.java", "diffHunk": "@@ -40,7 +41,7 @@\n    * @param props\n    * @throws Exception\n    */\n-  void init(Map<String, String> props, Schema indexingSchema, String topicName)\n+  void init(Map<String, String> props, Schema indexingSchema, String topicName, Set<String> fields)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44473f02c1b92d8ee9760e41a339f68551baba0e"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eac9565fc3ac2b1bf2d7a7547bab3a61a87d2ede", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/eac9565fc3ac2b1bf2d7a7547bab3a61a87d2ede", "committedDate": "2020-04-26T22:30:22Z", "message": "Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "650e105f2503c03d5616e4a186047f6c2a49d21c", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/650e105f2503c03d5616e4a186047f6c2a49d21c", "committedDate": "2020-04-26T22:38:39Z", "message": "Remove stray commit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTQ3MTgz", "url": "https://github.com/apache/pinot/pull/5303#pullrequestreview-401147183", "createdAt": "2020-04-27T16:58:52Z", "commit": {"oid": "650e105f2503c03d5616e4a186047f6c2a49d21c"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNjo1ODo1MlrOGMtxuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzowNTozNVrOGMuENQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4NjEwNA==", "bodyText": "Please fix the javadoc above", "url": "https://github.com/apache/pinot/pull/5303#discussion_r415986104", "createdAt": "2020-04-27T16:58:52Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/stream/StreamConsumerFactory.java", "diffHunk": "@@ -52,7 +53,7 @@ void init(StreamConfig streamConfig) {\n    * @return\n    */\n   public abstract StreamLevelConsumer createStreamLevelConsumer(String clientId, String tableName, Schema schema,\n-      String groupId);\n+      String groupId, Set<String> sourceFields);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "650e105f2503c03d5616e4a186047f6c2a49d21c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4NjU2NA==", "bodyText": "please fix the javadoc above", "url": "https://github.com/apache/pinot/pull/5303#discussion_r415986564", "createdAt": "2020-04-27T16:59:28Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/stream/StreamDecoderProvider.java", "diffHunk": "@@ -35,13 +36,13 @@\n    * @param schema\n    * @return\n    */\n-  public static StreamMessageDecoder create(StreamConfig streamConfig, Schema schema) {\n+  public static StreamMessageDecoder create(StreamConfig streamConfig, Schema schema, Set<String> fields) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "650e105f2503c03d5616e4a186047f6c2a49d21c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4NzA1OQ==", "bodyText": "why remove the static final?", "url": "https://github.com/apache/pinot/pull/5303#discussion_r415987059", "createdAt": "2020-04-27T17:00:10Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/stream/StreamMessageDecoder.java", "diffHunk": "@@ -33,14 +34,17 @@\n @InterfaceStability.Stable\n public interface StreamMessageDecoder<T> {\n \n-  static final String RECORD_EXTRACTOR_CONFIG_KEY = \"recordExtractorClass\";\n+  String RECORD_EXTRACTOR_CONFIG_KEY = \"recordExtractorClass\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "650e105f2503c03d5616e4a186047f6c2a49d21c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4ODMxNg==", "bodyText": "it is not clear whether these are the fields that we should pay attention to in the  source (incoming data) or these are the fields that we need in the schema. I suppose your next step is to remove the schema argument, so then the doc becomes more important.", "url": "https://github.com/apache/pinot/pull/5303#discussion_r415988316", "createdAt": "2020-04-27T17:01:53Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/stream/StreamMessageDecoder.java", "diffHunk": "@@ -33,14 +34,17 @@\n @InterfaceStability.Stable\n public interface StreamMessageDecoder<T> {\n \n-  static final String RECORD_EXTRACTOR_CONFIG_KEY = \"recordExtractorClass\";\n+  String RECORD_EXTRACTOR_CONFIG_KEY = \"recordExtractorClass\";\n \n   /**\n-   * Initialize the decoder with decoder properties map, the stream topic name and stream schema\n-   * @param props\n+   * Initialize the decoder\n+   * @param props decoder properties extracted from the {@link StreamConfig}\n+   * @param indexingSchema the Pinot schema\n+   * @param topicName topic name of the stream\n+   * @param fields the fields to be extracted from the record", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "650e105f2503c03d5616e4a186047f6c2a49d21c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4OTEwNA==", "bodyText": "Shouldnt this be destination fields instead of source fields? Or, am I missing something?", "url": "https://github.com/apache/pinot/pull/5303#discussion_r415989104", "createdAt": "2020-04-27T17:03:01Z", "author": {"login": "mcvsubbu"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/data/manager/realtime/HLRealtimeSegmentDataManager.java", "diffHunk": "@@ -167,8 +168,10 @@ public HLRealtimeSegmentDataManager(final RealtimeSegmentZKMetadata realtimeSegm\n     // create and init stream level consumer\n     _streamConsumerFactory = StreamConsumerFactoryProvider.create(_streamConfig);\n     String clientId = HLRealtimeSegmentDataManager.class.getSimpleName() + \"-\" + _streamConfig.getTopicName();\n+    Set<String> sourceFields = SchemaFieldExtractorUtils.extract(schema);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "650e105f2503c03d5616e4a186047f6c2a49d21c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk5MDgzNw==", "bodyText": "there are two methods here extract and extractSource. I believe extractSource is for testing purpose only. Can you move it to the test, or in some way, get rid of it (e.g. maybe by contriving the data in test schema). There are no comments on either of these methods, and it can be confusing.\nI understand it came from a previous commit, but please fix it.\nThanks", "url": "https://github.com/apache/pinot/pull/5303#discussion_r415990837", "createdAt": "2020-04-27T17:05:35Z", "author": {"login": "mcvsubbu"}, "path": "pinot-spi/src/main/java/org/apache/pinot/spi/utils/SchemaFieldExtractorUtils.java", "diffHunk": "@@ -19,17 +19,15 @@\n package org.apache.pinot.spi.utils;\n \n import com.google.common.annotations.VisibleForTesting;\n-import com.google.common.base.Preconditions;\n-import java.util.ArrayList;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Set;\n+import org.apache.pinot.spi.data.function.evaluators.ExpressionEvaluator;\n+import org.apache.pinot.spi.data.function.evaluators.ExpressionEvaluatorFactory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "650e105f2503c03d5616e4a186047f6c2a49d21c"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e1f18180927efe4281ebe4da2ea4359b0dad7d6", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/8e1f18180927efe4281ebe4da2ea4359b0dad7d6", "committedDate": "2020-04-27T17:48:43Z", "message": "Review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d7673a75c722c7067f56bd90628743e3eabbe5b", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/0d7673a75c722c7067f56bd90628743e3eabbe5b", "committedDate": "2020-04-27T17:51:08Z", "message": "Rename fields to sourceFields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59ed9badb07ea8a3aa17b86e3cfe3b0b4d2ea68a", "author": {"user": {"login": "npawar", "name": "Neha Pawar"}}, "url": "https://github.com/apache/pinot/commit/59ed9badb07ea8a3aa17b86e3cfe3b0b4d2ea68a", "committedDate": "2020-04-27T17:52:07Z", "message": "Rename fields to sourceFields in recordReader"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTk1MTE2", "url": "https://github.com/apache/pinot/pull/5303#pullrequestreview-401195116", "createdAt": "2020-04-27T18:00:16Z", "commit": {"oid": "59ed9badb07ea8a3aa17b86e3cfe3b0b4d2ea68a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 939, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}