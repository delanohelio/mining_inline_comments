{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNzUyNTMw", "number": 5538, "title": "In ServerQueryRequest and ColumnValueSegmentPruner, replace BrokerRequest with QueryContext", "bodyText": "ColumnValueSegmentPruner can directly use the Predicate in QueryContext instead of creating new ones for each segment", "createdAt": "2020-06-10T23:27:53Z", "url": "https://github.com/apache/pinot/pull/5538", "merged": true, "mergeCommit": {"oid": "d8764cc8646e54c5d5d9a68df01b6c0dc6e52784"}, "closed": true, "closedAt": "2020-06-15T23:50:08Z", "author": {"login": "Jackie-Jiang"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqZW6IgBqjM0MzY2NDkyNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrpgMjAFqTQzMTA2NTU0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50a95dc0a79b52b8cdb72ca38a44df0d7ec5645d", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/50a95dc0a79b52b8cdb72ca38a44df0d7ec5645d", "committedDate": "2020-06-10T23:21:38Z", "message": "In ServerQueryRequest and ColumnValueSegmentPruner, replace BrokerRequest with QueryContext\n\nColumnValueSegmentPruner can directly use the Predicate in QueryContext instead of creating new ones for each segment"}, "afterCommit": {"oid": "3c611bd129ca2ab40aa1b4aa0161165d8740c1a7", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/3c611bd129ca2ab40aa1b4aa0161165d8740c1a7", "committedDate": "2020-06-12T02:22:19Z", "message": "In ServerQueryRequest and ColumnValueSegmentPruner, replace BrokerRequest with QueryContext\n\nColumnValueSegmentPruner can directly use the Predicate in QueryContext instead of creating new ones for each segment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c611bd129ca2ab40aa1b4aa0161165d8740c1a7", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/3c611bd129ca2ab40aa1b4aa0161165d8740c1a7", "committedDate": "2020-06-12T02:22:19Z", "message": "In ServerQueryRequest and ColumnValueSegmentPruner, replace BrokerRequest with QueryContext\n\nColumnValueSegmentPruner can directly use the Predicate in QueryContext instead of creating new ones for each segment"}, "afterCommit": {"oid": "aae47713a2dfa1ff47181c32d302af65c38365a5", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/aae47713a2dfa1ff47181c32d302af65c38365a5", "committedDate": "2020-06-12T18:53:17Z", "message": "In ServerQueryRequest and ColumnValueSegmentPruner, replace BrokerRequest with QueryContext\n\nColumnValueSegmentPruner can directly use the Predicate in QueryContext instead of creating new ones for each segment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aae47713a2dfa1ff47181c32d302af65c38365a5", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/aae47713a2dfa1ff47181c32d302af65c38365a5", "committedDate": "2020-06-12T18:53:17Z", "message": "In ServerQueryRequest and ColumnValueSegmentPruner, replace BrokerRequest with QueryContext\n\nColumnValueSegmentPruner can directly use the Predicate in QueryContext instead of creating new ones for each segment"}, "afterCommit": {"oid": "a66de6fb518ee9f14cffadf92a76b7614a5f76f6", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/a66de6fb518ee9f14cffadf92a76b7614a5f76f6", "committedDate": "2020-06-13T00:00:02Z", "message": "In ServerQueryRequest and ColumnValueSegmentPruner, replace BrokerRequest with QueryContext\n\nColumnValueSegmentPruner can directly use the Predicate in QueryContext instead of creating new ones for each segment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a8506b7c04b9ceab935fcbceab9c3d224683524", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/7a8506b7c04b9ceab935fcbceab9c3d224683524", "committedDate": "2020-06-15T18:05:05Z", "message": "In ServerQueryRequest and ColumnValueSegmentPruner, replace BrokerRequest with QueryContext\n\nColumnValueSegmentPruner can directly use the Predicate in QueryContext instead of creating new ones for each segment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a66de6fb518ee9f14cffadf92a76b7614a5f76f6", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/a66de6fb518ee9f14cffadf92a76b7614a5f76f6", "committedDate": "2020-06-13T00:00:02Z", "message": "In ServerQueryRequest and ColumnValueSegmentPruner, replace BrokerRequest with QueryContext\n\nColumnValueSegmentPruner can directly use the Predicate in QueryContext instead of creating new ones for each segment"}, "afterCommit": {"oid": "7a8506b7c04b9ceab935fcbceab9c3d224683524", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/7a8506b7c04b9ceab935fcbceab9c3d224683524", "committedDate": "2020-06-15T18:05:05Z", "message": "In ServerQueryRequest and ColumnValueSegmentPruner, replace BrokerRequest with QueryContext\n\nColumnValueSegmentPruner can directly use the Predicate in QueryContext instead of creating new ones for each segment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDQ2ODkx", "url": "https://github.com/apache/pinot/pull/5538#pullrequestreview-431046891", "createdAt": "2020-06-15T22:55:24Z", "commit": {"oid": "7a8506b7c04b9ceab935fcbceab9c3d224683524"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMjo1NToyNVrOGkFbSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMjo1NToyNVrOGkFbSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ5MDgyNg==", "bodyText": "Is this because of step by step migration to QueryContext? We have already converted BrokerRequest to QueryContext at this point but for code that hasn't yet switched to QueryContext, a backward reference to broker request is still maintained inside QueryRequest to help with components that will still use BrokerRequest. Is this correct?", "url": "https://github.com/apache/pinot/pull/5538#discussion_r440490826", "createdAt": "2020-06-15T22:55:25Z", "author": {"login": "siddharthteotia"}, "path": "pinot-core/src/main/java/org/apache/pinot/core/query/executor/ServerQueryExecutorV1Impl.java", "diffHunk": "@@ -205,8 +205,9 @@ public DataTable processQuery(ServerQueryRequest queryRequest, ExecutorService e\n         metadata.put(DataTable.NUM_SEGMENTS_MATCHED, \"0\");\n       } else {\n         TimerContext.Timer planBuildTimer = timerContext.startNewPhaseTimer(ServerQueryPhase.BUILD_QUERY_PLAN);\n-        Plan globalQueryPlan =\n-            _planMaker.makeInterSegmentPlan(segmentDataManagers, brokerRequest, executorService, remainingTimeMs);\n+        Plan globalQueryPlan = _planMaker\n+            .makeInterSegmentPlan(segmentDataManagers, queryContext.getBrokerRequest(), executorService,\n+                remainingTimeMs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8506b7c04b9ceab935fcbceab9c3d224683524"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDY1NTQ3", "url": "https://github.com/apache/pinot/pull/5538#pullrequestreview-431065547", "createdAt": "2020-06-15T23:46:06Z", "commit": {"oid": "7a8506b7c04b9ceab935fcbceab9c3d224683524"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 577, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}