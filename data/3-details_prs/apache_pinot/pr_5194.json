{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MDA5MjQy", "number": 5194, "title": "Move table config into pinot-spi", "bodyText": "Motivation:\n\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\n\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\n\nRefactor DataSizeUtils (from DataSize), integrate StorageQuotaChecker and HelixExternalViewBasedQueryQuotaManager with the POJO like QuotaConfig\nTextIndexConfigValidator is integrated into TableConfigUtils.validate(TableConfig tableConfig)\n\nBACKWARD-INCOMPATIBILITY:\n\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no \\\" inside the json)", "createdAt": "2020-03-27T23:29:58Z", "url": "https://github.com/apache/pinot/pull/5194", "merged": true, "mergeCommit": {"oid": "00fcb1d27f8daec48c1d87d46abfc8b60cfb32cf"}, "closed": true, "closedAt": "2020-03-30T00:03:56Z", "author": {"login": "Jackie-Jiang"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR5bregBqjMxNzQ0MDI2NjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcShlF3AFqTM4MzM0NTE5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6fc4e921f3e38b92c586e623d2275f54f29485d", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/a6fc4e921f3e38b92c586e623d2275f54f29485d", "committedDate": "2020-03-27T23:29:41Z", "message": "Move table config into pinot-spi\n\nMotivation:\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\nRefactor StorageQuotaCheckerTest to integrate with POJO like QuotaConfig\n\nBACKWARD-INCOMPATIBILITY:\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}, "afterCommit": {"oid": "1e055048c4f6c918553adebb8331d70dfc450cae", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/1e055048c4f6c918553adebb8331d70dfc450cae", "committedDate": "2020-03-27T23:36:31Z", "message": "Move table config into pinot-spi\n\nMotivation:\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\nRefactor StorageQuotaCheckerTest to integrate with POJO like QuotaConfig\nTextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMjY2Nzc1", "url": "https://github.com/apache/pinot/pull/5194#pullrequestreview-383266775", "createdAt": "2020-03-28T00:56:46Z", "commit": {"oid": "1e055048c4f6c918553adebb8331d70dfc450cae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e055048c4f6c918553adebb8331d70dfc450cae", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/1e055048c4f6c918553adebb8331d70dfc450cae", "committedDate": "2020-03-27T23:36:31Z", "message": "Move table config into pinot-spi\n\nMotivation:\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\nRefactor StorageQuotaCheckerTest to integrate with POJO like QuotaConfig\nTextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}, "afterCommit": {"oid": "c39a2df1393cad7eb2b75decc0904765e45ec273", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/c39a2df1393cad7eb2b75decc0904765e45ec273", "committedDate": "2020-03-28T08:03:25Z", "message": "Move table config into pinot-spi\n\nMotivation:\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\nRefactor StorageQuotaCheckerTest to integrate with POJO like QuotaConfig\nTextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c39a2df1393cad7eb2b75decc0904765e45ec273", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/c39a2df1393cad7eb2b75decc0904765e45ec273", "committedDate": "2020-03-28T08:03:25Z", "message": "Move table config into pinot-spi\n\nMotivation:\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\nRefactor StorageQuotaCheckerTest to integrate with POJO like QuotaConfig\nTextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}, "afterCommit": {"oid": "30ea5f47ad16e4115263003cb4bd9bb7dbac06d5", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/30ea5f47ad16e4115263003cb4bd9bb7dbac06d5", "committedDate": "2020-03-28T21:32:41Z", "message": "Move table config into pinot-spi\n\nMotivation:\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\nRefactor StorageQuotaCheckerTest to integrate with POJO like QuotaConfig\nTextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30ea5f47ad16e4115263003cb4bd9bb7dbac06d5", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/30ea5f47ad16e4115263003cb4bd9bb7dbac06d5", "committedDate": "2020-03-28T21:32:41Z", "message": "Move table config into pinot-spi\n\nMotivation:\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\nRefactor StorageQuotaCheckerTest to integrate with POJO like QuotaConfig\nTextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}, "afterCommit": {"oid": "0e719fcbfa72bb09439a6bce4ef8bf50b18618a7", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/0e719fcbfa72bb09439a6bce4ef8bf50b18618a7", "committedDate": "2020-03-29T00:37:55Z", "message": "Move table config into pinot-spi\n\nMotivation:\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\nRefactor DataSizeUtils (from DataSize), integrate StorageQuotaChecker and HelixExternalViewBasedQueryQuotaManager with the POJO like QuotaConfig\nTextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e719fcbfa72bb09439a6bce4ef8bf50b18618a7", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/0e719fcbfa72bb09439a6bce4ef8bf50b18618a7", "committedDate": "2020-03-29T00:37:55Z", "message": "Move table config into pinot-spi\n\nMotivation:\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\nRefactor DataSizeUtils (from DataSize), integrate StorageQuotaChecker and HelixExternalViewBasedQueryQuotaManager with the POJO like QuotaConfig\nTextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}, "afterCommit": {"oid": "8ea3f803c246ee2d636bf227201a175a87844e41", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/8ea3f803c246ee2d636bf227201a175a87844e41", "committedDate": "2020-03-29T01:42:32Z", "message": "Move table config into pinot-spi\n\nMotivation:\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\nRefactor DataSizeUtils (from DataSize), integrate StorageQuotaChecker and HelixExternalViewBasedQueryQuotaManager with the POJO like QuotaConfig\nTextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e3bdafacfed6f62f8917832d5960ae8cba6c232", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/0e3bdafacfed6f62f8917832d5960ae8cba6c232", "committedDate": "2020-03-29T03:04:57Z", "message": "Move table config into pinot-spi\n\nMotivation:\n- Table config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\n- Make all configs POJO like, and Json serializable for backward-compatibility\n- De-couple the Helix properties and utils from the configs\n- Add the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\n- Refactor DataSizeUtils (from DataSize), integrate StorageQuotaChecker and HelixExternalViewBasedQueryQuotaManager with the POJO like QuotaConfig\n- TextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\n- TableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ea3f803c246ee2d636bf227201a175a87844e41", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/8ea3f803c246ee2d636bf227201a175a87844e41", "committedDate": "2020-03-29T01:42:32Z", "message": "Move table config into pinot-spi\n\nMotivation:\nTable config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\nMake all configs POJO like, and Json serializable for backward-compatibility\nDe-couple the Helix properties and utils from the configs\nAdd the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\nRefactor DataSizeUtils (from DataSize), integrate StorageQuotaChecker and HelixExternalViewBasedQueryQuotaManager with the POJO like QuotaConfig\nTextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\nTableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}, "afterCommit": {"oid": "0e3bdafacfed6f62f8917832d5960ae8cba6c232", "author": {"user": {"login": "Jackie-Jiang", "name": "Xiaotian (Jackie) Jiang"}}, "url": "https://github.com/apache/pinot/commit/0e3bdafacfed6f62f8917832d5960ae8cba6c232", "committedDate": "2020-03-29T03:04:57Z", "message": "Move table config into pinot-spi\n\nMotivation:\n- Table config should be moved to pinot-spi so that user interface can access it (e.g. segment generation spec)\n\nChanges:\n- Make all configs POJO like, and Json serializable for backward-compatibility\n- De-couple the Helix properties and utils from the configs\n- Add the TableConfigSerDeTest to check all the serialization/de-serialization\n\nSide changes:\n- Refactor DataSizeUtils (from DataSize), integrate StorageQuotaChecker and HelixExternalViewBasedQueryQuotaManager with the POJO like QuotaConfig\n- TextIndexConfigValidator is integrated into `TableConfigUtils.validate(TableConfig tableConfig)`\n\nBACKWARD-INCOMPATIBILITY:\n- TableConfig no longer support de-serialization from json string of nested json string (i.e. no `\\\"` inside the json)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzQ1MTkx", "url": "https://github.com/apache/pinot/pull/5194#pullrequestreview-383345191", "createdAt": "2020-03-28T20:05:59Z", "commit": {"oid": "c39a2df1393cad7eb2b75decc0904765e45ec273"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQyMDowNjowMFrOF9L_Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQyMDoxMTowN1rOF9MBJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcwMzkwMw==", "bodyText": "parseDouble would throw NumberFormatException if the the input string isn't a valid number.", "url": "https://github.com/apache/pinot/pull/5194#discussion_r399703903", "createdAt": "2020-03-28T20:06:00Z", "author": {"login": "jackjlli"}, "path": "pinot-broker/src/main/java/org/apache/pinot/broker/queryquota/HelixExternalViewBasedQueryQuotaManager.java", "diffHunk": "@@ -200,14 +201,7 @@ private void createRateLimiter(String tableNameWithType, ExternalView brokerReso\n     LOGGER.info(\"The number of online brokers for table {} is {}\", tableNameWithType, onlineCount);\n \n     // Get the dynamic rate\n-    double overallRate;\n-    if (quotaConfig.isMaxQueriesPerSecondValid()) {\n-      overallRate = Double.parseDouble(quotaConfig.getMaxQueriesPerSecond());\n-    } else {\n-      LOGGER.error(\"Failed to init qps quota: error when parsing qps quota: {} for table: {}\",\n-          quotaConfig.getMaxQueriesPerSecond(), tableNameWithType);\n-      return;\n-    }\n+    double overallRate = Double.parseDouble(quotaConfig.getMaxQueriesPerSecond());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c39a2df1393cad7eb2b75decc0904765e45ec273"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcwNDA1MA==", "bodyText": "Why does the builder need to be a public class instead of an inner class?", "url": "https://github.com/apache/pinot/pull/5194#discussion_r399704050", "createdAt": "2020-03-28T20:07:44Z", "author": {"login": "jackjlli"}, "path": "pinot-broker/src/test/java/org/apache/pinot/broker/broker/HelixBrokerStarterTest.java", "diffHunk": "@@ -83,11 +84,11 @@ public void setUp()\n         .addTime(TIME_COLUMN_NAME, TimeUnit.DAYS, FieldSpec.DataType.INT).build();\n     _helixResourceManager.addSchema(schema, true);\n     TableConfig offlineTableConfig =\n-        new TableConfig.Builder(TableType.OFFLINE).setTableName(RAW_TABLE_NAME).setTimeColumnName(TIME_COLUMN_NAME)\n+        new TableConfigBuilder(TableType.OFFLINE).setTableName(RAW_TABLE_NAME).setTimeColumnName(TIME_COLUMN_NAME)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c39a2df1393cad7eb2b75decc0904765e45ec273"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcwNDM1Ng==", "bodyText": "There are multiple ways to convert to TableConfig, like TableConfigUtils and Builder. Can they be unified to one class?", "url": "https://github.com/apache/pinot/pull/5194#discussion_r399704356", "createdAt": "2020-03-28T20:11:07Z", "author": {"login": "jackjlli"}, "path": "pinot-controller/src/main/java/org/apache/pinot/controller/util/TableRetentionValidator.java", "diffHunk": "@@ -184,7 +185,7 @@ public void run()\n \n   private TableConfig getTableConfig(String tableName)\n       throws Exception {\n-    return TableConfig.fromZnRecord(\n+    return TableConfigUtils.fromZNRecord(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c39a2df1393cad7eb2b75decc0904765e45ec273"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1132, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}