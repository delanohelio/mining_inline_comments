{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3ODEyOTkz", "number": 977, "title": "Create abstraction for library dependencies for instrumentation.", "bodyText": "Adds three configurations library, testLibrary, latestDepTest library as described here\nWhen Gradle is run with -PtestLatestDeps=true, the standard testImplementation configuration is overridden with the latest dep test wildcards. Without the property, it's as if the wildcards don't exist. This means IntelliJ won't read the wildcard versions anymore. The bottom-left corner of IDE with all the external libraries is still huge, but far smaller than before, presuambly speeding up some IntelliJ indexing / refactoring operations. Most importantly, now IntelliJ won't ever freeze to refresh dynamic versions in the middle of development.", "createdAt": "2020-08-14T07:07:55Z", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/977", "merged": true, "mergeCommit": {"oid": "bbfdbb39c00e0edafcbd45abc9bd7c8c1928ca7a"}, "closed": true, "closedAt": "2020-08-18T23:57:32Z", "author": {"login": "anuraaga"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-vKK5AH2gAyNDY3ODEyOTkzOjZlMDk0MzA3ZWQyMjM4NTIyYWNhYTU0YWM0ZTllZjA3MjdlY2M5ZTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAPYtYAH2gAyNDY3ODEyOTkzOjM3MWZkZjhlNDVmYTc4YWNhYjQwY2FiNzVhNmNkMWQ4YjllZjVmYmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6e094307ed2238522acaa54ac4e9ef0727ecc9e2", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/6e094307ed2238522acaa54ac4e9ef0727ecc9e2", "committedDate": "2020-08-14T07:06:02Z", "message": "Create abstraction for library dependencies for instrumentation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MzU2NzIz", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/977#pullrequestreview-467356723", "createdAt": "2020-08-14T07:17:29Z", "commit": {"oid": "6e094307ed2238522acaa54ac4e9ef0727ecc9e2"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0377e326d40f74b3f05083d5fb443291e0a00861", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/0377e326d40f74b3f05083d5fb443291e0a00861", "committedDate": "2020-08-15T07:25:07Z", "message": "Migrate more latestdeptest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23764ec7303a300370f404e71844f53e171c184f", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/23764ec7303a300370f404e71844f53e171c184f", "committedDate": "2020-08-17T05:00:01Z", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into latestdeptest-abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6b588313b6484db1559d14189f72ee23ea37a49", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a6b588313b6484db1559d14189f72ee23ea37a49", "committedDate": "2020-08-17T07:17:20Z", "message": "More"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ded466f4f5790cca307631aecadf2a5060a86d5f", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ded466f4f5790cca307631aecadf2a5060a86d5f", "committedDate": "2020-08-17T07:23:28Z", "message": "More"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5a69d85deef551caee403d439bbaa796ae5bba5", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c5a69d85deef551caee403d439bbaa796ae5bba5", "committedDate": "2020-08-17T08:14:07Z", "message": "Progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c1a98f2973ae0dfd24258eaaa2fbeb753c76707", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/9c1a98f2973ae0dfd24258eaaa2fbeb753c76707", "committedDate": "2020-08-17T08:47:13Z", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into latestdeptest-abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08b98baf353a842d33d153a1d3411932b838262a", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/08b98baf353a842d33d153a1d3411932b838262a", "committedDate": "2020-08-17T08:49:44Z", "message": "More"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71c463c0e4ec3f9452a817c0292f7fd49795d667", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/71c463c0e4ec3f9452a817c0292f7fd49795d667", "committedDate": "2020-08-17T09:14:23Z", "message": "More"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e979ce60f4e8b9ac407b21e3ab851e4d757aa972", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e979ce60f4e8b9ac407b21e3ab851e4d757aa972", "committedDate": "2020-08-18T04:37:03Z", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into latestdeptest-abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdfe115c0e88bac4ea87bf34ac74b28952381115", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/cdfe115c0e88bac4ea87bf34ac74b28952381115", "committedDate": "2020-08-18T04:59:22Z", "message": "More"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efdebbeb3d15b58a5b7a0a71b1656714d20afdfa", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/efdebbeb3d15b58a5b7a0a71b1656714d20afdfa", "committedDate": "2020-08-18T05:56:58Z", "message": "Most"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adba99e5bf804b392188f66b8d294d721f8ef878", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/adba99e5bf804b392188f66b8d294d721f8ef878", "committedDate": "2020-08-18T05:57:05Z", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into latestdeptest-abstraction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64d0547c8b4489123bd388e577ef26ea09f5a677", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/64d0547c8b4489123bd388e577ef26ea09f5a677", "committedDate": "2020-08-18T06:04:12Z", "message": "More"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dac2746136ac58364af1662513bb3eae00c71019", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/dac2746136ac58364af1662513bb3eae00c71019", "committedDate": "2020-08-18T07:44:16Z", "message": "More"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "425eed63f504edc5519b11e639bd53082c1651b7", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/425eed63f504edc5519b11e639bd53082c1651b7", "committedDate": "2020-08-18T08:00:17Z", "message": "Done?"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c172fcf5bf21d6c54bd8456ac1b94b088a70fd2f", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c172fcf5bf21d6c54bd8456ac1b94b088a70fd2f", "committedDate": "2020-08-18T08:13:34Z", "message": "Drift"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5ODE0OTQ5", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/977#pullrequestreview-469814949", "createdAt": "2020-08-18T20:41:10Z", "commit": {"oid": "c172fcf5bf21d6c54bd8456ac1b94b088a70fd2f"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMDo0MToxMFrOHCl5ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMjoxMjoxOVrOHCofVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ4MDE4Ng==", "bodyText": "Does 2.x work also?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             *   example to restrict to just a major version by specifying `2.x`.\n          \n          \n            \n             *   example to restrict to just a major version by specifying `2.+`.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/977#discussion_r472480186", "createdAt": "2020-08-18T20:41:10Z", "author": {"login": "trask"}, "path": "gradle/instrumentation-common.gradle", "diffHunk": "@@ -0,0 +1,76 @@\n+/** Common setup for manual instrumentation of libraries and auto instrumentation. */\n+\n+\n+/**\n+ * We define three dependency configurations to use when adding dependencies to libraries being\n+ * instrumented.\n+ *\n+ * - library: A dependency on the instrumented library. Results in the dependency being added to\n+ *     compileOnly and testImplementation. If the build is run with -PtestLatestDeps=true, the\n+ *     version when added to testImplementation will be overridden by `+`, the latest version\n+ *     possible. For simple libraries without different behavior between versions, it is possible\n+ *     to have a single dependency on library only.\n+ *\n+ * - testLibrary: A dependency on a library for testing. This will usually be used to either\n+ *     a) use a different version of the library for compilation and testing and b) to add a helper\n+ *     that is only required for tests (e.g., library-testing artifact). The dependency will be\n+ *     added to testImplementation and will have a version of `+` when testing latest deps as\n+ *     described above.\n+ *\n+ * - latestDepTestLibrary: A dependency on a library for testing when testing of latest dependency\n+ *   version is enabled. This dependency will be added as-is to testImplementation, but only if\n+ *   -PtestLatestDeps=true. The version will not be modified but it will be given highest\n+ *   precedence. Use this to restrict the latest version dependency from the default `+`, for\n+ *   example to restrict to just a major version by specifying `2.x`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c172fcf5bf21d6c54bd8456ac1b94b088a70fd2f"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUxNDM5Mg==", "bodyText": "Also see more general version of this issue #749", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/977#discussion_r472514392", "createdAt": "2020-08-18T21:52:34Z", "author": {"login": "trask"}, "path": "instrumentation/hibernate/hibernate-4.3/hibernate-4.3.gradle", "diffHunk": "@@ -26,13 +19,12 @@ dependencies {\n   testImplementation project(':instrumentation:hibernate:hibernate-3.3')\n   testImplementation project(':instrumentation:hibernate:hibernate-4.0')\n \n-  testImplementation group: 'org.hibernate', name: 'hibernate-core', version: '4.3.0.Final'\n-  testImplementation group: 'org.hibernate', name: 'hibernate-entitymanager', version: '4.3.0.Final'\n+  testLibrary group: 'org.hibernate', name: 'hibernate-entitymanager', version: '4.3.0.Final'\n   testImplementation group: 'org.hsqldb', name: 'hsqldb', version: '2.0.0'\n-  testImplementation group: 'org.springframework.data', name: 'spring-data-jpa', version: '1.5.1.RELEASE'\n+  testLibrary group: 'org.springframework.data', name: 'spring-data-jpa', version: '1.5.1.RELEASE'\n \n-  latestDepTestImplementation group: 'org.hibernate', name: 'hibernate-core', version: '(,6.0.0.Final)'\n-  latestDepTestImplementation group: 'org.hibernate', name: 'hibernate-entitymanager', version: '(,6.0.0.Final)'\n-  latestDepTestImplementation group: 'org.hsqldb', name: 'hsqldb', version: '2.0.0'\n-  latestDepTestImplementation group: 'org.springframework.data', name: 'spring-data-jpa', version: '+'\n+  // TODO(anuraaga): Investigate why these tests don't pass on 5 or 6\n+  // https://github.com/open-telemetry/opentelemetry-java-instrumentation/issues/1042", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c172fcf5bf21d6c54bd8456ac1b94b088a70fd2f"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUxNjk5Ng==", "bodyText": "unrelated, but since we're here \ud83d\ude04\nit's not related to requiring different instrumentation (anymore since #152)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              //This seems to be the earliest version that has org.apache.catalina.loader.WebappClassLoaderBase\n          \n          \n            \n              //Older versions would require slightly different instrumentation.\n          \n          \n            \n              // This is the earliest version that has org.apache.catalina.loader.ParallelWebappClassLoader\n          \n          \n            \n              // which is used in the test", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/977#discussion_r472516996", "createdAt": "2020-08-18T21:58:36Z", "author": {"login": "trask"}, "path": "instrumentation/java-classloader/tomcat-testing/tomcat-testing.gradle", "diffHunk": "@@ -12,18 +11,10 @@ muzzle {\n   }\n }\n \n-testSets {\n-  latestDepTest {\n-    dirName = 'test'\n-  }\n-}\n-\n dependencies {\n   testImplementation project(':instrumentation:java-classloader')\n \n   //This seems to be the earliest version that has org.apache.catalina.loader.WebappClassLoaderBase\n   //Older versions would require slightly different instrumentation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c172fcf5bf21d6c54bd8456ac1b94b088a70fd2f"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUyMjU4Mg==", "bodyText": "i think?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              testImplementation group: 'org.eclipse.jetty', name: 'jetty-server', version: '7.0.0.v20091005'\n          \n          \n            \n              testImplementation group: 'org.eclipse.jetty', name: 'jetty-servlet', version: '7.0.0.v20091005'\n          \n          \n            \n              testLibrary group: 'org.eclipse.jetty', name: 'jetty-server', version: '7.0.0.v20091005'\n          \n          \n            \n              testLibrary group: 'org.eclipse.jetty', name: 'jetty-servlet', version: '7.0.0.v20091005'", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/977#discussion_r472522582", "createdAt": "2020-08-18T22:12:19Z", "author": {"login": "trask"}, "path": "instrumentation/servlet/servlet-common/servlet-common.gradle", "diffHunk": "@@ -22,7 +17,4 @@ dependencies {\n   }\n   testImplementation group: 'org.eclipse.jetty', name: 'jetty-server', version: '7.0.0.v20091005'\n   testImplementation group: 'org.eclipse.jetty', name: 'jetty-servlet', version: '7.0.0.v20091005'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c172fcf5bf21d6c54bd8456ac1b94b088a70fd2f"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "371fdf8e45fa78acab40cab75a6cd1d8b9ef5fbb", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/371fdf8e45fa78acab40cab75a6cd1d8b9ef5fbb", "committedDate": "2020-08-18T23:12:48Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Trask Stalnaker <trask.stalnaker@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2718, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}