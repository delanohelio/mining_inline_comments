{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMTk2NzA2", "number": 1384, "title": "Update to latest SDK snapshot", "bodyText": "WIP for after the next release. gRPC library instrumentation went swell, still debugging an issue with auto instrumentation of all libraries, some tests fail, others give a VerifyError", "createdAt": "2020-10-14T08:16:11Z", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384", "merged": true, "mergeCommit": {"oid": "f6ad05b8e32d264ff8c5442897e9bcb16d112870"}, "closed": true, "closedAt": "2020-10-25T06:14:33Z", "author": {"login": "anuraaga"}, "timelineItems": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSYssugH2gAyNTAzMTk2NzA2OmVkOTRjMzQ5MDk4NmZmZTZiYmRhN2Y5NTY1NGU5NDJkNDE5YjE0ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdV3KRzgH2gAyNTAzMTk2NzA2OmYzYTYyMjdmZDFkMDc2OTA3YmFiY2FkNDc1Y2RjNmMxMWM4NDc4OTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ed94c3490986ffe6bbda7f95654e942d419b1486", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ed94c3490986ffe6bbda7f95654e942d419b1486", "committedDate": "2020-10-14T08:14:25Z", "message": "Update to latest SDK snapshot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2caf9ab95e82e6c98fe02c4ba10bf343a6453af0", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2caf9ab95e82e6c98fe02c4ba10bf343a6453af0", "committedDate": "2020-10-15T04:00:09Z", "message": "Use published snapshot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0893848642a65072a220557d90fb435ca6ab59e0", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/0893848642a65072a220557d90fb435ca6ab59e0", "committedDate": "2020-10-16T06:23:40Z", "message": "Fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4aee92914efc08d0d5d50307dd47dd79f64b8cd", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/d4aee92914efc08d0d5d50307dd47dd79f64b8cd", "committedDate": "2020-10-16T06:34:59Z", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into sdk-snapshot-20201014"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44fa57a71c0455ffe2b6a165a805812d922d9ee2", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/44fa57a71c0455ffe2b6a165a805812d922d9ee2", "committedDate": "2020-10-16T07:07:34Z", "message": "Cleans"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b67952a027db38b67b50776bce7b220f90fe357d", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b67952a027db38b67b50776bce7b220f90fe357d", "committedDate": "2020-10-16T07:08:27Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc711f4bb585acf0cc634d4ad1a81096009667cb", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/bc711f4bb585acf0cc634d4ad1a81096009667cb", "committedDate": "2020-10-19T06:26:17Z", "message": "Most"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f65de9f3c5ca808e4e13103825fb943cacee677", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2f65de9f3c5ca808e4e13103825fb943cacee677", "committedDate": "2020-10-20T04:21:36Z", "message": "Clean"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96fa65b68770435300c966cdc26120f06a02a4e9", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/96fa65b68770435300c966cdc26120f06a02a4e9", "committedDate": "2020-10-21T04:46:01Z", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into sdk-snapshot-20201014"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39b0a854053c7817dc78f0df332fdee3c5634571", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/39b0a854053c7817dc78f0df332fdee3c5634571", "committedDate": "2020-10-21T04:49:08Z", "message": "Merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a048388aba735cc91f223f83f0d367181cf48fb", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/6a048388aba735cc91f223f83f0d367181cf48fb", "committedDate": "2020-10-21T04:59:23Z", "message": "Temporarily remove context interop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52bb59a8043d4cc6a393eb3c3996fa8feeb3d94b", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/52bb59a8043d4cc6a393eb3c3996fa8feeb3d94b", "committedDate": "2020-10-21T07:49:52Z", "message": "WIP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMzk2ODA3", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#pullrequestreview-513396807", "createdAt": "2020-10-21T07:50:36Z", "commit": {"oid": "52bb59a8043d4cc6a393eb3c3996fa8feeb3d94b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzo1MDozNlrOHletUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzo1MDozNlrOHletUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2MjQ4Mg==", "bodyText": "@trask Not being able to get this instrumentation of a static interface method to kick in", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r509062482", "createdAt": "2020-10-21T07:50:36Z", "author": {"login": "anuraaga"}, "path": "instrumentation/opentelemetry-api-beta/src/main/java/io/opentelemetry/javaagent/instrumentation/opentelemetryapi/SpanInstrumentation.java", "diffHunk": "@@ -23,25 +22,25 @@\n import net.bytebuddy.matcher.ElementMatcher;\n \n @AutoService(Instrumenter.class)\n-public class DefaultSpanInstrumentation extends AbstractInstrumentation {\n+public class SpanInstrumentation extends AbstractInstrumentation {\n   @Override\n   public ElementMatcher<? super TypeDescription> typeMatcher() {\n-    return named(\"application.io.opentelemetry.trace.DefaultSpan\");\n+    return named(\"application.io.opentelemetry.trace.Span\");\n   }\n \n   @Override\n   public Map<? extends ElementMatcher<? super MethodDescription>, String> transformers() {\n     return Collections.singletonMap(\n-        isMethod().and(isPublic()).and(isStatic()).and(named(\"create\")),\n-        DefaultSpanInstrumentation.class.getName() + \"$CreateAdvice\");\n+        isMethod().and(isPublic()).and(isStatic()).and(named(\"wrap\")),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52bb59a8043d4cc6a393eb3c3996fa8feeb3d94b"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "776cf4e5ef697a3c83827583d1c703b22a145b08", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/776cf4e5ef697a3c83827583d1c703b22a145b08", "committedDate": "2020-10-22T06:16:32Z", "message": "Prepare for intercepting propagated span"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8281009b9d19f871354c411f80564806678d7ce", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b8281009b9d19f871354c411f80564806678d7ce", "committedDate": "2020-10-22T06:16:42Z", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into sdk-snapshot-20201014"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c518db020afc5d7739e27ac58899ae4a5cf5c64", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/5c518db020afc5d7739e27ac58899ae4a5cf5c64", "committedDate": "2020-10-22T06:30:55Z", "message": "Bump SDK"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbc238cfcb3fb0d53a760dbd5197ad64ff264396", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/bbc238cfcb3fb0d53a760dbd5197ad64ff264396", "committedDate": "2020-10-22T06:43:25Z", "message": "IDE updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30126418693044ad9e4f3b2625fa9b3aae99780a", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/30126418693044ad9e4f3b2625fa9b3aae99780a", "committedDate": "2020-10-22T07:26:50Z", "message": "Lots"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "147235082c44772122c7445734803bbeec921e87", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/147235082c44772122c7445734803bbeec921e87", "committedDate": "2020-10-22T07:34:40Z", "message": "compileJava"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36886bca9a70e546b05f53ad18596f322228b3d3", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/36886bca9a70e546b05f53ad18596f322228b3d3", "committedDate": "2020-10-23T14:05:16Z", "message": "Done?"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "728fc6cddea397f4f9295d2f37db9b1a7643a7c2", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/728fc6cddea397f4f9295d2f37db9b1a7643a7c2", "committedDate": "2020-10-23T14:19:00Z", "message": "bar"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe7769434d93920512ceab6aa81934b9c8647f45", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/fe7769434d93920512ceab6aa81934b9c8647f45", "committedDate": "2020-10-23T14:03:48Z", "message": "Done?"}, "afterCommit": {"oid": "728fc6cddea397f4f9295d2f37db9b1a7643a7c2", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/728fc6cddea397f4f9295d2f37db9b1a7643a7c2", "committedDate": "2020-10-23T14:19:00Z", "message": "bar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "345d5eb290182d924e8bff2debf43b009c5fe56b", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/345d5eb290182d924e8bff2debf43b009c5fe56b", "committedDate": "2020-10-23T14:27:18Z", "message": "Spot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f01672d274bc7a9fd715a3ddebad143f5e66804", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/9f01672d274bc7a9fd715a3ddebad143f5e66804", "committedDate": "2020-10-23T14:44:09Z", "message": "drugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac885914ba62789fcd33b32f1cd1413d84e7d420", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ac885914ba62789fcd33b32f1cd1413d84e7d420", "committedDate": "2020-10-23T15:03:20Z", "message": "Groovy--"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e76d11eb3bc53bef3c1e163220f0de1474ec7fb", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2e76d11eb3bc53bef3c1e163220f0de1474ec7fb", "committedDate": "2020-10-24T03:24:12Z", "message": "green for me"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3111863a7287ffcbf7986e26c9362949bf9c25b9", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/3111863a7287ffcbf7986e26c9362949bf9c25b9", "committedDate": "2020-10-24T03:30:38Z", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into sdk-snapshot-20201014\n\n\u0001 Conflicts:\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/DbCassandraSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/DbHbaseSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/DbMongodbSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/DbMssqlSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/DbRedisSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/DbSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/FaasHttpSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/FaasPubsubSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/GrpcClientSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/GrpcServerSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/HttpClientSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/HttpServerSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/HttpSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/IdentitySpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/MessagingConsumerSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/MessagingConsumerSynchronousSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/MessagingProducerSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/MessagingProducerSynchronousSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/MessagingSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/NetworkSpan.java\n\u0001\tinstrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/typedspan/RpcSpan.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98c4128cbc8a133bcf4120db4cec3cc16d9f68f1", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/98c4128cbc8a133bcf4120db4cec3cc16d9f68f1", "committedDate": "2020-10-24T03:32:18Z", "message": "Spot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/61842c85d8484576eefd2eb2ab512d08e1f66b18", "committedDate": "2020-10-24T03:34:32Z", "message": "Remove grpc import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MTU3MTY0", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#pullrequestreview-516157164", "createdAt": "2020-10-24T04:07:09Z", "commit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "state": "APPROVED", "comments": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQwNDowNzoxMFrOHnnmyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQwNToxNzoyMVrOHnooJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMwNTQxOQ==", "bodyText": "I like named \ud83d\udc4d", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511305419", "createdAt": "2020-10-24T04:07:10Z", "author": {"login": "trask"}, "path": "instrumentation-api/src/main/java/io/opentelemetry/instrumentation/api/decorator/ClientDecorator.java", "diffHunk": "@@ -5,31 +5,30 @@\n \n package io.opentelemetry.instrumentation.api.decorator;\n \n-import io.grpc.Context;\n-import io.opentelemetry.trace.DefaultSpan;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.ContextKey;\n import io.opentelemetry.trace.Span;\n import io.opentelemetry.trace.Span.Kind;\n import io.opentelemetry.trace.Tracer;\n-import io.opentelemetry.trace.TracingContextUtils;\n \n @Deprecated\n public abstract class ClientDecorator extends BaseDecorator {\n \n   // Keeps track of the client span in a subtree corresponding to a client request.\n   // Visible for testing\n-  static final Context.Key<Span> CONTEXT_CLIENT_SPAN_KEY =\n-      Context.key(\"opentelemetry-trace-auto-client-span-key\");\n+  static final ContextKey<Span> CONTEXT_CLIENT_SPAN_KEY =\n+      ContextKey.named(\"opentelemetry-trace-auto-client-span-key\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMwNzQ2MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                assert io.opentelemetry.trace.Span.fromContext(Context.current()) == internal\n          \n          \n            \n                assert Span.fromContext(Context.current()) == internal", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511307461", "createdAt": "2020-10-24T04:11:51Z", "author": {"login": "trask"}, "path": "instrumentation-api/src/test/groovy/io/opentelemetry/instrumentation/api/decorator/ClientDecoratorTest.groovy", "diffHunk": "@@ -65,16 +64,16 @@ class ClientDecoratorTest extends BaseDecoratorTest {\n   def \"test getOrCreateSpan internal after client span\"() {\n     setup:\n     def client = ClientDecorator.getOrCreateSpan(\"existing\", TRACER)\n-    def scope = ContextUtils.withScopedContext(ClientDecorator.currentContextWith(client))\n+    def scope = ClientDecorator.currentContextWith(client).makeCurrent()\n \n     when:\n     def internal = TRACER.spanBuilder(\"internal\").setSpanKind(Span.Kind.INTERNAL).startSpan()\n     def scope2 = TracingContextUtils.currentContextWith(internal)\n \n     then:\n-    assert internal.getContext().isValid()\n-    assert ClientDecorator.CONTEXT_CLIENT_SPAN_KEY.get(Context.current()) == client\n-    assert TracingContextUtils.getSpan(Context.current()) == internal\n+    assert internal.getSpanContext().isValid()\n+    assert Context.current().get(ClientDecorator.CONTEXT_CLIENT_SPAN_KEY) == client\n+    assert io.opentelemetry.trace.Span.fromContext(Context.current()) == internal", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMwODE0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                assert io.opentelemetry.trace.Span.fromContext(context) == span\n          \n          \n            \n                assert Span.fromContext(context) == span", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511308144", "createdAt": "2020-10-24T04:13:29Z", "author": {"login": "trask"}, "path": "instrumentation-api/src/test/groovy/io/opentelemetry/instrumentation/api/decorator/ClientDecoratorTest.groovy", "diffHunk": "@@ -89,8 +88,8 @@ class ClientDecoratorTest extends BaseDecoratorTest {\n     def context = ClientDecorator.currentContextWith(span)\n \n     then:\n-    assert ClientDecorator.CONTEXT_CLIENT_SPAN_KEY.get(context) == span\n-    assert TracingContextUtils.getSpan(context) == span\n+    assert context.get(ClientDecorator.CONTEXT_CLIENT_SPAN_KEY) == span\n+    assert io.opentelemetry.trace.Span.fromContext(context) == span", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMxMDY3Nw==", "bodyText": "I'm also ok with dropping Scala 2.11 support (now or in future), it looks like the last 2.11 maintenance release was 3 years ago\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              val TRACER: Tracer = Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")\n          \n          \n            \n              // Java8Bridge is needed in order to support Scala 2.11 which targets Java 6 bytecode\n          \n          \n            \n              val TRACER: Tracer = Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511310677", "createdAt": "2020-10-24T04:18:58Z", "author": {"login": "trask"}, "path": "instrumentation/akka-context-propagation-2.5/src/test/scala/AkkaActors.scala", "diffHunk": "@@ -7,13 +7,15 @@ import akka.actor.{Actor, ActorLogging, ActorRef, ActorSystem, Props}\n import akka.pattern.ask\n import akka.util.Timeout\n import io.opentelemetry.OpenTelemetry\n+import io.opentelemetry.context.Context\n+import io.opentelemetry.javaagent.instrumentation.api.Java8Bridge\n import io.opentelemetry.trace.Tracer\n \n import scala.concurrent.duration._\n \n // ! == send-message\n object AkkaActors {\n-  val TRACER: Tracer = OpenTelemetry.getTracer(\"io.opentelemetry.auto\")\n+  val TRACER: Tracer = Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMxMzE3OQ==", "bodyText": "i like the new api, that this can be chained, e.g. (no need to change here, just appreciating the new API)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Context context = Context.current().with(span);\n          \n          \n            \n                context = context.with(CONTEXT_CLIENT_SPAN_KEY, span);\n          \n          \n            \n                return context.makeCurrent();\n          \n          \n            \n                return Context.current().with(span).with(CONTEXT_CLIENT_SPAN_KEY, span).makeCurrent();", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511313179", "createdAt": "2020-10-24T04:24:35Z", "author": {"login": "trask"}, "path": "instrumentation/aws-sdk/aws-sdk-1.11/src/main/java/io/opentelemetry/javaagent/instrumentation/awssdk/v1_11/AwsSdkClientTracer.java", "diffHunk": "@@ -68,9 +65,9 @@ public Span startSpan(Request<?> request, RequestMeta requestMeta) {\n    */\n   @Override\n   public Scope startScope(Span span, Request<?> request) {\n-    Context context = withSpan(span, Context.current());\n-    context = context.withValue(CONTEXT_CLIENT_SPAN_KEY, span);\n-    return withScopedContext(context);\n+    Context context = Context.current().with(span);\n+    context = context.with(CONTEXT_CLIENT_SPAN_KEY, span);\n+    return context.makeCurrent();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMxMzU1NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                !io.opentelemetry.trace.Span.current().getSpanContext().isValid()\n          \n          \n            \n                !Span.current().getSpanContext().isValid()", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511313554", "createdAt": "2020-10-24T04:25:19Z", "author": {"login": "trask"}, "path": "instrumentation/aws-sdk/aws-sdk-1.11/src/test_before_1_11_106/groovy/AWS0ClientTest.groovy", "diffHunk": "@@ -199,7 +200,7 @@ class AWS0ClientTest extends AgentTestRunner {\n     client.getObject(\"someBucket\", \"someKey\")\n \n     then:\n-    !TEST_TRACER.getCurrentSpan().getContext().isValid()\n+    !io.opentelemetry.trace.Span.current().getSpanContext().isValid()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMxNTkxNA==", "bodyText": "a few unneeded fully qualified names in this class (intellij groovy refactoring? \ud83d\ude22)", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511315914", "createdAt": "2020-10-24T04:30:07Z", "author": {"login": "trask"}, "path": "instrumentation/grpc-1.5/testing/src/main/groovy/io/opentelemetry/instrumentation/grpc/v1_5/AbstractGrpcTest.groovy", "diffHunk": "@@ -312,7 +311,7 @@ abstract class AbstractGrpcTest extends InstrumentationSpecification {\n           responseObserver.onError(new AssertionError((Object) \"context not preserved\"))\n           return\n         }\n-        if (!TracingContextUtils.getSpan(Context.current()).getContext().isValid()) {\n+        if (!io.opentelemetry.trace.Span.fromContext(io.opentelemetry.context.Context.current()).getSpanContext().isValid()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMxODE1OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  def parentSpan = io.opentelemetry.trace.Span.current()\n          \n          \n            \n                  def parentSpan = Span.current()", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511318159", "createdAt": "2020-10-24T04:34:23Z", "author": {"login": "trask"}, "path": "instrumentation/http-url-connection/src/test/groovy/HttpUrlConnectionTest.groovy", "diffHunk": "@@ -28,9 +28,9 @@ class HttpUrlConnectionTest extends HttpClientTest {\n       connection.setRequestProperty(\"Connection\", \"close\")\n       connection.useCaches = true\n       connection.connectTimeout = CONNECT_TIMEOUT_MS\n-      def parentSpan = TEST_TRACER.getCurrentSpan()\n+      def parentSpan = io.opentelemetry.trace.Span.current()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMxODc1NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  assert io.opentelemetry.trace.Span.current() == parentSpan\n          \n          \n            \n                  assert Span.current() == parentSpan", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511318754", "createdAt": "2020-10-24T04:35:36Z", "author": {"login": "trask"}, "path": "instrumentation/http-url-connection/src/test/groovy/HttpUrlConnectionTest.groovy", "diffHunk": "@@ -28,9 +28,9 @@ class HttpUrlConnectionTest extends HttpClientTest {\n       connection.setRequestProperty(\"Connection\", \"close\")\n       connection.useCaches = true\n       connection.connectTimeout = CONNECT_TIMEOUT_MS\n-      def parentSpan = TEST_TRACER.getCurrentSpan()\n+      def parentSpan = io.opentelemetry.trace.Span.current()\n       def stream = connection.inputStream\n-      assert TEST_TRACER.getCurrentSpan() == parentSpan\n+      assert io.opentelemetry.trace.Span.current() == parentSpan", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMxODgyNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  assert io.opentelemetry.trace.Span.current() != null\n          \n          \n            \n                  assert Span.current() != null", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511318824", "createdAt": "2020-10-24T04:35:51Z", "author": {"login": "trask"}, "path": "instrumentation/http-url-connection/src/test/groovy/UrlConnectionTest.groovy", "diffHunk": "@@ -19,7 +19,7 @@ class UrlConnectionTest extends AgentTestRunner {\n       URLConnection connection = url.openConnection()\n       connection.setConnectTimeout(10000)\n       connection.setReadTimeout(10000)\n-      assert TEST_TRACER.getCurrentSpan() != null\n+      assert io.opentelemetry.trace.Span.current() != null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMxODkwNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  def parentSpan = io.opentelemetry.trace.Span.current()\n          \n          \n            \n                  def parentSpan = Span.current()", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511318904", "createdAt": "2020-10-24T04:36:02Z", "author": {"login": "trask"}, "path": "instrumentation/http-url-connection/src/test/groovy/HttpUrlConnectionUseCachesFalseTest.groovy", "diffHunk": "@@ -18,9 +18,9 @@ class HttpUrlConnectionUseCachesFalseTest extends HttpClientTest {\n       connection.setRequestProperty(\"Connection\", \"close\")\n       connection.useCaches = false\n       connection.connectTimeout = CONNECT_TIMEOUT_MS\n-      def parentSpan = TEST_TRACER.getCurrentSpan()\n+      def parentSpan = io.opentelemetry.trace.Span.current()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMxODk2Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  assert io.opentelemetry.trace.Span.current() == parentSpan\n          \n          \n            \n                  assert Span.current() == parentSpan", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511318963", "createdAt": "2020-10-24T04:36:12Z", "author": {"login": "trask"}, "path": "instrumentation/http-url-connection/src/test/groovy/HttpUrlConnectionUseCachesFalseTest.groovy", "diffHunk": "@@ -18,9 +18,9 @@ class HttpUrlConnectionUseCachesFalseTest extends HttpClientTest {\n       connection.setRequestProperty(\"Connection\", \"close\")\n       connection.useCaches = false\n       connection.connectTimeout = CONNECT_TIMEOUT_MS\n-      def parentSpan = TEST_TRACER.getCurrentSpan()\n+      def parentSpan = io.opentelemetry.trace.Span.current()\n       def stream = connection.inputStream\n-      assert TEST_TRACER.getCurrentSpan() == parentSpan\n+      assert io.opentelemetry.trace.Span.current() == parentSpan", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMxOTgxNA==", "bodyText": "does Kotlin also compile to Java 6/7 bytecode?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              val tracer: Tracer = Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")\n          \n          \n            \n              // Java8Bridge is needed in order to support Kotlin <version> which targets Java <version> bytecode\n          \n          \n            \n              val tracer: Tracer = Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511319814", "createdAt": "2020-10-24T04:46:44Z", "author": {"login": "trask"}, "path": "instrumentation/kotlin-coroutines/src/test/kotlin/KotlinCoroutineTests.kt", "diffHunk": "@@ -26,7 +26,7 @@ import kotlinx.coroutines.withTimeout\n import kotlinx.coroutines.yield\n \n class KotlinCoroutineTests(private val dispatcher: CoroutineDispatcher) {\n-  val tracer: Tracer = OpenTelemetry.getTracer(\"io.opentelemetry.auto\")\n+  val tracer: Tracer = Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMxOTk1Mg==", "bodyText": "just checking that this rename was intentional?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511319952", "createdAt": "2020-10-24T04:49:10Z", "author": {"login": "trask"}, "path": "instrumentation/netty/netty-3.8/src/main/java/io/opentelemetry/javaagent/instrumentation/netty/v3_8/ChannelTraceContext.java", "diffHunk": "@@ -49,7 +49,7 @@ public void setClientParentContext(Context clientParentContext) {\n     this.clientParentContext = clientParentContext;\n   }\n \n-  public Context getContext() {\n+  public Context getSpanContext() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMyMDM5OQ==", "bodyText": "oh this is clever \ud83d\udc4d", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511320399", "createdAt": "2020-10-24T04:54:41Z", "author": {"login": "trask"}, "path": "instrumentation/opentelemetry-api-beta/src/main/java/io/opentelemetry/javaagent/instrumentation/opentelemetryapi/ContextInstrumentation.java", "diffHunk": "@@ -25,35 +25,46 @@\n import net.bytebuddy.matcher.ElementMatcher;\n \n @AutoService(Instrumenter.class)\n-public class GrpcContextInstrumentation extends AbstractInstrumentation {\n+public class ContextInstrumentation extends AbstractInstrumentation {\n \n   @Override\n   public ElementMatcher<? super TypeDescription> typeMatcher() {\n-    return named(\"application.io.grpc.Context\");\n+    return named(\"application.io.opentelemetry.context.Context\");\n   }\n \n   @Override\n   public Map<? extends ElementMatcher<? super MethodDescription>, String> transformers() {\n     Map<ElementMatcher<? super MethodDescription>, String> transformers = new HashMap<>();\n     transformers.put(\n         isMethod().and(isPublic()).and(isStatic()).and(named(\"current\")).and(takesArguments(0)),\n-        GrpcContextInstrumentation.class.getName() + \"$CurrentAdvice\");\n+        ContextInstrumentation.class.getName() + \"$CurrentAdvice\");\n+    transformers.put(\n+        isMethod().and(isPublic()).and(named(\"makeCurrent\")).and(takesArguments(0)),\n+        ContextInstrumentation.class.getName() + \"$MakeCurrentAdvice\");\n     return transformers;\n   }\n \n   public static class CurrentAdvice {\n \n     @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n     public static void methodExit(@Advice.Return Context applicationContext) {\n-      ContextStore<Context, io.grpc.Context> contextStore =\n-          InstrumentationContext.get(Context.class, io.grpc.Context.class);\n-      contextStore.put(applicationContext, io.grpc.Context.current());\n+      ContextStore<Context, io.opentelemetry.context.Context> contextStore =\n+          InstrumentationContext.get(Context.class, io.opentelemetry.context.Context.class);\n+      contextStore.put(applicationContext, io.opentelemetry.context.Context.current());\n     }\n+  }\n \n-    // this is to make muzzle think we need ContextUtils to make sure we do not apply this\n-    // instrumentation when ContextUtils would not work\n-    public static Object muzzleCheck() {\n-      return ContextUtils.class;\n+  public static class MakeCurrentAdvice {\n+\n+    @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n+    public static void methodExit(\n+        @Advice.This Context applicationContext,\n+        @Advice.Return(readOnly = false) Scope applicationScope) {\n+      ContextStore<Context, io.opentelemetry.context.Context> contextStore =\n+          InstrumentationContext.get(Context.class, io.opentelemetry.context.Context.class);\n+      io.opentelemetry.context.Scope agentScope =\n+          contextStore.get(applicationContext).makeCurrent();\n+      applicationScope = agentScope::close;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMyMDQ5OA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511320498", "createdAt": "2020-10-24T04:55:57Z", "author": {"login": "trask"}, "path": "instrumentation/opentelemetry-api-beta/src/main/java/io/opentelemetry/javaagent/instrumentation/opentelemetryapi/SpanInstrumentation.java", "diffHunk": "@@ -23,25 +22,33 @@\n import net.bytebuddy.matcher.ElementMatcher;\n \n @AutoService(Instrumenter.class)\n-public class DefaultSpanInstrumentation extends AbstractInstrumentation {\n+public class SpanInstrumentation extends AbstractInstrumentation {\n   @Override\n   public ElementMatcher<? super TypeDescription> typeMatcher() {\n-    return named(\"application.io.opentelemetry.trace.DefaultSpan\");\n+    return named(\"application.io.opentelemetry.trace.PropagatedSpan\");\n   }\n \n   @Override\n   public Map<? extends ElementMatcher<? super MethodDescription>, String> transformers() {\n     return Collections.singletonMap(\n-        isMethod().and(isPublic()).and(isStatic()).and(named(\"create\")),\n-        DefaultSpanInstrumentation.class.getName() + \"$CreateAdvice\");\n+        isMethod().and(isStatic()).and(named(\"create\")),\n+        SpanInstrumentation.class.getName() + \"$CreateAdvice\");\n   }\n \n   public static class CreateAdvice {\n-    @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n-    public static void methodExit(@Advice.Return(readOnly = false) Span applicationSpan) {\n+    // We replace the return value completely so don't need to call the method.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMyMDU0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          io.opentelemetry.trace.Span.wrap(Bridging.toAgent(applicationSpanContext)));\n          \n          \n            \n                          Span.wrap(Bridging.toAgent(applicationSpanContext)));", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511320541", "createdAt": "2020-10-24T04:56:29Z", "author": {"login": "trask"}, "path": "instrumentation/opentelemetry-api-beta/src/main/java/io/opentelemetry/javaagent/instrumentation/opentelemetryapi/SpanInstrumentation.java", "diffHunk": "@@ -23,25 +22,33 @@\n import net.bytebuddy.matcher.ElementMatcher;\n \n @AutoService(Instrumenter.class)\n-public class DefaultSpanInstrumentation extends AbstractInstrumentation {\n+public class SpanInstrumentation extends AbstractInstrumentation {\n   @Override\n   public ElementMatcher<? super TypeDescription> typeMatcher() {\n-    return named(\"application.io.opentelemetry.trace.DefaultSpan\");\n+    return named(\"application.io.opentelemetry.trace.PropagatedSpan\");\n   }\n \n   @Override\n   public Map<? extends ElementMatcher<? super MethodDescription>, String> transformers() {\n     return Collections.singletonMap(\n-        isMethod().and(isPublic()).and(isStatic()).and(named(\"create\")),\n-        DefaultSpanInstrumentation.class.getName() + \"$CreateAdvice\");\n+        isMethod().and(isStatic()).and(named(\"create\")),\n+        SpanInstrumentation.class.getName() + \"$CreateAdvice\");\n   }\n \n   public static class CreateAdvice {\n-    @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n-    public static void methodExit(@Advice.Return(readOnly = false) Span applicationSpan) {\n+    // We replace the return value completely so don't need to call the method.\n+    @Advice.OnMethodEnter(skipOn = Advice.OnDefaultValue.class)\n+    public static boolean methodEnter() {\n+      return false;\n+    }\n+\n+    @Advice.OnMethodExit\n+    public static void methodExit(\n+        @Advice.Argument(0) SpanContext applicationSpanContext,\n+        @Advice.Return(readOnly = false) Span applicationSpan) {\n       applicationSpan =\n           Bridging.toApplication(\n-              DefaultSpan.create(Bridging.toAgent(applicationSpan.getContext())));\n+              io.opentelemetry.trace.Span.wrap(Bridging.toAgent(applicationSpanContext)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMyMDYzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public Span.Builder setParent(application.io.opentelemetry.context.Context applicationContext) {\n          \n          \n            \n                public Span.Builder setParent(Context applicationContext) {", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511320637", "createdAt": "2020-10-24T04:58:03Z", "author": {"login": "trask"}, "path": "instrumentation/opentelemetry-api-beta/src/main/java/io/opentelemetry/javaagent/instrumentation/opentelemetryapi/trace/ApplicationSpan.java", "diffHunk": "@@ -137,17 +137,17 @@ public boolean equals(Object other) {\n     private static final Logger log = LoggerFactory.getLogger(Builder.class);\n \n     private final io.opentelemetry.trace.Span.Builder agentBuilder;\n-    private final ContextStore<Context, io.grpc.Context> contextStore;\n+    private final ContextStore<Context, io.opentelemetry.context.Context> contextStore;\n \n     Builder(\n         io.opentelemetry.trace.Span.Builder agentBuilder,\n-        ContextStore<Context, io.grpc.Context> contextStore) {\n+        ContextStore<Context, io.opentelemetry.context.Context> contextStore) {\n       this.agentBuilder = agentBuilder;\n       this.contextStore = contextStore;\n     }\n \n     @Override\n-    public Span.Builder setParent(Context applicationContext) {\n+    public Span.Builder setParent(application.io.opentelemetry.context.Context applicationContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMyMDkwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    SpanContext spanContext = io.opentelemetry.trace.Span.fromContext(context).getSpanContext();\n          \n          \n            \n                    SpanContext spanContext = Span.fromContext(context).getSpanContext();", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511320905", "createdAt": "2020-10-24T05:01:50Z", "author": {"login": "trask"}, "path": "instrumentation/rmi/src/main/java/io/opentelemetry/javaagent/instrumentation/rmi/context/server/ContextDispatcher.java", "diffHunk": "@@ -51,7 +50,7 @@ public void dispatch(Remote obj, RemoteCall call) throws IOException {\n       ContextPayload payload = ContextPayload.read(in);\n       if (payload != null) {\n         Context context = extract(payload, GETTER);\n-        SpanContext spanContext = getSpan(context).getContext();\n+        SpanContext spanContext = io.opentelemetry.trace.Span.fromContext(context).getSpanContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMyMTExNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")\n          \n          \n            \n                // Java8Bridge is needed in order to support Scala 2.11 which targets Java 6 bytecode\n          \n          \n            \n                Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511321114", "createdAt": "2020-10-24T05:04:43Z", "author": {"login": "trask"}, "path": "instrumentation/scala-concurrent/src/slickTest/scala/SlickUtils.scala", "diffHunk": "@@ -12,7 +13,7 @@ import scala.concurrent.{Await, Future}\n \n class SlickUtils {\n   val TRACER: Tracer =\n-    OpenTelemetry.getTracerProvider.get(\"io.opentelemetry.auto\")\n+    Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMyMTE4Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")\n          \n          \n            \n                // Java8Bridge is needed in order to support Scala 2.11 which targets Java 6 bytecode\n          \n          \n            \n                Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511321187", "createdAt": "2020-10-24T05:05:19Z", "author": {"login": "trask"}, "path": "instrumentation/scala-concurrent/src/test/scala/ScalaConcurrentTests.scala", "diffHunk": "@@ -14,14 +15,15 @@ import scala.concurrent.{Await, Future, Promise}\n \n class ScalaConcurrentTests {\n   val TRACER: Tracer =\n-    OpenTelemetry.getTracerProvider.get(\"io.opentelemetry.auto\")\n+    Java8Bridge.getGlobalTracer(\"io.opentelemetry.auto\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMyMTcxMg==", "bodyText": "too verbose?\nthough I think verbosity is ok for something confusing like this\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public final class Java8Bridge {\n          \n          \n            \n            public final class Java8BytecodeBridge {", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511321712", "createdAt": "2020-10-24T05:12:02Z", "author": {"login": "trask"}, "path": "javaagent-api/src/main/java/io/opentelemetry/javaagent/instrumentation/api/Java8Bridge.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.javaagent.instrumentation.api;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.ContextPropagators;\n+import io.opentelemetry.trace.Span;\n+import io.opentelemetry.trace.Tracer;\n+\n+/**\n+ * A helper for accessing methods that rely on Java 8 bytecode such as static interface methods. In\n+ * instrumentation, we may need to call these methods in code that is inlined into an instrumented\n+ * class, however many times the instrumented class has been compiled to a previous version of\n+ * bytecode and we cannot inline Java 8 method calls.\n+ */\n+public final class Java8Bridge {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMyMjExMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * bytecode and we cannot inline Java 8 method calls.\n          \n          \n            \n             * bytecode and so we cannot inline calls to static interface methods, as those were not supported prior to Java 8\n          \n          \n            \n             * and will lead to a class verification error.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511322111", "createdAt": "2020-10-24T05:16:44Z", "author": {"login": "trask"}, "path": "javaagent-api/src/main/java/io/opentelemetry/javaagent/instrumentation/api/Java8Bridge.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.javaagent.instrumentation.api;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.ContextPropagators;\n+import io.opentelemetry.trace.Span;\n+import io.opentelemetry.trace.Tracer;\n+\n+/**\n+ * A helper for accessing methods that rely on Java 8 bytecode such as static interface methods. In\n+ * instrumentation, we may need to call these methods in code that is inlined into an instrumented\n+ * class, however many times the instrumented class has been compiled to a previous version of\n+ * bytecode and we cannot inline Java 8 method calls.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMyMjE0OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * A helper for accessing methods that rely on Java 8 bytecode such as static interface methods. In\n          \n          \n            \n             * A helper for accessing methods that rely on new Java 8 bytecode features such as calling a static interface method. In", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1384#discussion_r511322149", "createdAt": "2020-10-24T05:17:21Z", "author": {"login": "trask"}, "path": "javaagent-api/src/main/java/io/opentelemetry/javaagent/instrumentation/api/Java8Bridge.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.javaagent.instrumentation.api;\n+\n+import io.opentelemetry.OpenTelemetry;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.ContextPropagators;\n+import io.opentelemetry.trace.Span;\n+import io.opentelemetry.trace.Tracer;\n+\n+/**\n+ * A helper for accessing methods that rely on Java 8 bytecode such as static interface methods. In", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61842c85d8484576eefd2eb2ab512d08e1f66b18"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3a6227fd1d076907babcad475cdc6c11c847897", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/f3a6227fd1d076907babcad475cdc6c11c847897", "committedDate": "2020-10-25T03:25:39Z", "message": "Scrub"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2330, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}