{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5NzcyNTkx", "number": 1479, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNTozOTozMVrOExwZxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNzoyNDoyMlrOEyAkBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNjA4NzA5OnYy", "diffSide": "LEFT", "path": "instrumentation/opentelemetry-api-beta/src/main/java/io/opentelemetry/javaagent/instrumentation/opentelemetryapi/trace/TracingContextUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNTozOTozMVrOHoBbvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNTozOTozMVrOHoBbvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyODU3Mw==", "bodyText": "I just deleted this since I think even previously, this wasn't required because of instrumentation of withSpan and makeCurrent", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r511728573", "createdAt": "2020-10-26T05:39:31Z", "author": {"login": "anuraaga"}, "path": "instrumentation/opentelemetry-api-beta/src/main/java/io/opentelemetry/javaagent/instrumentation/opentelemetryapi/trace/TracingContextUtils.java", "diffHunk": "@@ -77,22 +74,4 @@ public static Span getSpanWithoutDefault(\n         io.opentelemetry.trace.Span.fromContextOrNull(agentContext);\n     return agentSpan == null ? null : toApplication(agentSpan);\n   }\n-\n-  public static Scope currentContextWith(Span applicationSpan) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be86c8fef109c1285e4c33be00fd6362c5461aaf"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNjIzNTE1OnYy", "diffSide": "RIGHT", "path": "instrumentation/external-annotations/external-annotations.gradle", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNjo1OTo1NFrOHoCvDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNzozODoyOVrOHoDkQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc0OTkwMQ==", "bodyText": "I guess this is better than having muzzle pull in random versions from snapshot repo? Let me know if there's a better way.\nI'm surprised the smoke tests pass though - actually I had flaky behavior this time where sometimes they fail with no WithSpan and sometimes they pass fine locally, and have similar seemingly bad-cache behavior before so a bit anxious they may have some problem @iNikem", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r511749901", "createdAt": "2020-10-26T06:59:54Z", "author": {"login": "anuraaga"}, "path": "instrumentation/external-annotations/external-annotations.gradle", "diffHunk": "@@ -1,5 +1,7 @@\n apply from: \"$rootDir/gradle/instrumentation.gradle\"\n \n+// TODO(anuraaga): Reenable after SDK 0.10.0 is published", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29b5752e80a40a62d2f89c6d8b9fd73c92024746"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc1NTQ0Mg==", "bodyText": "Did something change in the annotations that broke muzzle's compatibility check?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r511755442", "createdAt": "2020-10-26T07:17:07Z", "author": {"login": "trask"}, "path": "instrumentation/external-annotations/external-annotations.gradle", "diffHunk": "@@ -1,5 +1,7 @@\n apply from: \"$rootDir/gradle/instrumentation.gradle\"\n \n+// TODO(anuraaga): Reenable after SDK 0.10.0 is published", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc0OTkwMQ=="}, "originalCommit": {"oid": "29b5752e80a40a62d2f89c6d8b9fd73c92024746"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc2MzUyMQ==", "bodyText": "Now the implementation uses Span.makeCurrent() instead of TracingContextUtils which isn't available in previous opentelemetry API", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r511763521", "createdAt": "2020-10-26T07:38:29Z", "author": {"login": "anuraaga"}, "path": "instrumentation/external-annotations/external-annotations.gradle", "diffHunk": "@@ -1,5 +1,7 @@\n apply from: \"$rootDir/gradle/instrumentation.gradle\"\n \n+// TODO(anuraaga): Reenable after SDK 0.10.0 is published", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc0OTkwMQ=="}, "originalCommit": {"oid": "29b5752e80a40a62d2f89c6d8b9fd73c92024746"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwODU4NTI1OnYy", "diffSide": "RIGHT", "path": "smoke-tests/springboot/build.gradle", "isResolved": true, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNjo1MTo0NFrOHoZAuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwMjoyODowOVrOHopIJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExNDg3NQ==", "bodyText": "is this change needed, since the annotation API itself hasn't changed (only our underlying instrumentation)?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r512114875", "createdAt": "2020-10-26T16:51:44Z", "author": {"login": "trask"}, "path": "smoke-tests/springboot/build.gradle", "diffHunk": "@@ -11,11 +11,18 @@ version = '0.0.1-SNAPSHOT'\n repositories {\n   mavenCentral()\n   jcenter()\n+  // this is only needed for the working against unreleased otel-java snapshots\n+  maven {\n+    url \"https://oss.jfrog.org/artifactory/oss-snapshot-local\"\n+    content {\n+      includeGroup \"io.opentelemetry\"\n+    }\n+  }\n }\n \n dependencies {\n   implementation 'org.springframework.boot:spring-boot-starter-web'\n-  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.7.0'\n+  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.10.0-SNAPSHOT'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8825e08d0bf725057490f42275de6e42e441eac6"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMzMjkwMw==", "bodyText": "Ah thanks I got confused since muzzle was failing", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r512332903", "createdAt": "2020-10-26T23:41:16Z", "author": {"login": "anuraaga"}, "path": "smoke-tests/springboot/build.gradle", "diffHunk": "@@ -11,11 +11,18 @@ version = '0.0.1-SNAPSHOT'\n repositories {\n   mavenCentral()\n   jcenter()\n+  // this is only needed for the working against unreleased otel-java snapshots\n+  maven {\n+    url \"https://oss.jfrog.org/artifactory/oss-snapshot-local\"\n+    content {\n+      includeGroup \"io.opentelemetry\"\n+    }\n+  }\n }\n \n dependencies {\n   implementation 'org.springframework.boot:spring-boot-starter-web'\n-  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.7.0'\n+  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.10.0-SNAPSHOT'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExNDg3NQ=="}, "originalCommit": {"oid": "8825e08d0bf725057490f42275de6e42e441eac6"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMzOTUzNw==", "bodyText": "Ah wait - yeah the main point of the change wasn't the annotations but to pull in the newer API package (figured it's more idiomatic to just use the transitive dependency to manage that). I'm a bit confused why the smoke tests are passing - wouldn't you expect the instrumentation to get muzzled since missing Span.makeCurrent?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r512339537", "createdAt": "2020-10-27T00:03:06Z", "author": {"login": "anuraaga"}, "path": "smoke-tests/springboot/build.gradle", "diffHunk": "@@ -11,11 +11,18 @@ version = '0.0.1-SNAPSHOT'\n repositories {\n   mavenCentral()\n   jcenter()\n+  // this is only needed for the working against unreleased otel-java snapshots\n+  maven {\n+    url \"https://oss.jfrog.org/artifactory/oss-snapshot-local\"\n+    content {\n+      includeGroup \"io.opentelemetry\"\n+    }\n+  }\n }\n \n dependencies {\n   implementation 'org.springframework.boot:spring-boot-starter-web'\n-  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.7.0'\n+  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.10.0-SNAPSHOT'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExNDg3NQ=="}, "originalCommit": {"oid": "8825e08d0bf725057490f42275de6e42e441eac6"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM0Mjg0MA==", "bodyText": "WithSpanAnnotationInstrumentation uses shaded Span.makeCurrent, but doesn't rely on OpenTelemetry API in user class loader, so no muzzle problem (though we want to apply muzzle consistently across all instrumentation in a single module in the future #1274 (comment))\nOh, and this made me realized @WithSpan instrumentation is no longer in external-annotations, which makes me think maybe your change to external-annotations.gradle is not needed?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r512342840", "createdAt": "2020-10-27T00:14:50Z", "author": {"login": "trask"}, "path": "smoke-tests/springboot/build.gradle", "diffHunk": "@@ -11,11 +11,18 @@ version = '0.0.1-SNAPSHOT'\n repositories {\n   mavenCentral()\n   jcenter()\n+  // this is only needed for the working against unreleased otel-java snapshots\n+  maven {\n+    url \"https://oss.jfrog.org/artifactory/oss-snapshot-local\"\n+    content {\n+      includeGroup \"io.opentelemetry\"\n+    }\n+  }\n }\n \n dependencies {\n   implementation 'org.springframework.boot:spring-boot-starter-web'\n-  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.7.0'\n+  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.10.0-SNAPSHOT'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExNDg3NQ=="}, "originalCommit": {"oid": "8825e08d0bf725057490f42275de6e42e441eac6"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM0NDYzNg==", "bodyText": "Hmm - the :muzzle task was definitely failing in external-annotations though. Muzzle explicitly depends on the otel api, which doesn't have Span.makeCurrent, but should it be checking our shaded version instead?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r512344636", "createdAt": "2020-10-27T00:21:08Z", "author": {"login": "anuraaga"}, "path": "smoke-tests/springboot/build.gradle", "diffHunk": "@@ -11,11 +11,18 @@ version = '0.0.1-SNAPSHOT'\n repositories {\n   mavenCentral()\n   jcenter()\n+  // this is only needed for the working against unreleased otel-java snapshots\n+  maven {\n+    url \"https://oss.jfrog.org/artifactory/oss-snapshot-local\"\n+    content {\n+      includeGroup \"io.opentelemetry\"\n+    }\n+  }\n }\n \n dependencies {\n   implementation 'org.springframework.boot:spring-boot-starter-web'\n-  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.7.0'\n+  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.10.0-SNAPSHOT'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExNDg3NQ=="}, "originalCommit": {"oid": "8825e08d0bf725057490f42275de6e42e441eac6"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM0OTYxNQ==", "bodyText": "oh sorry, we should remove the annotations dep from that muzzle block in external-annotations.gradle since that module doesn't use it anymore (we should have removed it when we moved WithSpan annotation instrumentation from external-annotations to opentelemetry-api-beta), e.g.\nmuzzle {\n  pass {\n    group = \"io.opentracing.contrib.dropwizard\"\n    module = \"dropwizard-opentracing\"\n    versions = \"[0.2.2,)\"\n  }\n}", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r512349615", "createdAt": "2020-10-27T00:40:14Z", "author": {"login": "trask"}, "path": "smoke-tests/springboot/build.gradle", "diffHunk": "@@ -11,11 +11,18 @@ version = '0.0.1-SNAPSHOT'\n repositories {\n   mavenCentral()\n   jcenter()\n+  // this is only needed for the working against unreleased otel-java snapshots\n+  maven {\n+    url \"https://oss.jfrog.org/artifactory/oss-snapshot-local\"\n+    content {\n+      includeGroup \"io.opentelemetry\"\n+    }\n+  }\n }\n \n dependencies {\n   implementation 'org.springframework.boot:spring-boot-starter-web'\n-  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.7.0'\n+  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.10.0-SNAPSHOT'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExNDg3NQ=="}, "originalCommit": {"oid": "8825e08d0bf725057490f42275de6e42e441eac6"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3MTQxOA==", "bodyText": "Thanks!\nNot sure if you meant this literally or figuratively - I tried adding muzzle for other libraries as well but dropwizard-opentracing seems to be the only one that passes for some reason.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r512371418", "createdAt": "2020-10-27T02:00:12Z", "author": {"login": "anuraaga"}, "path": "smoke-tests/springboot/build.gradle", "diffHunk": "@@ -11,11 +11,18 @@ version = '0.0.1-SNAPSHOT'\n repositories {\n   mavenCentral()\n   jcenter()\n+  // this is only needed for the working against unreleased otel-java snapshots\n+  maven {\n+    url \"https://oss.jfrog.org/artifactory/oss-snapshot-local\"\n+    content {\n+      includeGroup \"io.opentelemetry\"\n+    }\n+  }\n }\n \n dependencies {\n   implementation 'org.springframework.boot:spring-boot-starter-web'\n-  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.7.0'\n+  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.10.0-SNAPSHOT'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExNDg3NQ=="}, "originalCommit": {"oid": "8825e08d0bf725057490f42275de6e42e441eac6"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM3ODkxNw==", "bodyText": "Not sure if you meant this literally or figuratively\n\nI use e.g. to mean a lot of things at once \ud83d\ude02", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r512378917", "createdAt": "2020-10-27T02:28:09Z", "author": {"login": "trask"}, "path": "smoke-tests/springboot/build.gradle", "diffHunk": "@@ -11,11 +11,18 @@ version = '0.0.1-SNAPSHOT'\n repositories {\n   mavenCentral()\n   jcenter()\n+  // this is only needed for the working against unreleased otel-java snapshots\n+  maven {\n+    url \"https://oss.jfrog.org/artifactory/oss-snapshot-local\"\n+    content {\n+      includeGroup \"io.opentelemetry\"\n+    }\n+  }\n }\n \n dependencies {\n   implementation 'org.springframework.boot:spring-boot-starter-web'\n-  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.7.0'\n+  implementation 'io.opentelemetry:opentelemetry-extension-auto-annotations:0.10.0-SNAPSHOT'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjExNDg3NQ=="}, "originalCommit": {"oid": "8825e08d0bf725057490f42275de6e42e441eac6"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwODczNDc3OnYy", "diffSide": "RIGHT", "path": "smoke-tests/grpc/build.gradle", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNzoyNDoyMlrOHoaeuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNzoyNDoyMlrOHoaeuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEzODkzNg==", "bodyText": "is this change needed? smoke tests are passing on this PR, and I think(?) they use docker images from last build on master", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1479#discussion_r512138936", "createdAt": "2020-10-26T17:24:22Z", "author": {"login": "trask"}, "path": "smoke-tests/grpc/build.gradle", "diffHunk": "@@ -17,8 +24,8 @@ dependencies {\n   implementation \"io.grpc:grpc-netty-shaded:1.32.1\"\n   implementation \"io.grpc:grpc-protobuf:1.32.1\"\n   implementation \"io.grpc:grpc-stub:1.32.1\"\n-  implementation \"io.opentelemetry:opentelemetry-proto:0.9.1\"\n-  implementation \"io.opentelemetry:opentelemetry-extension-auto-annotations:0.9.1\"\n+  implementation \"io.opentelemetry:opentelemetry-proto:0.10.0-SNAPSHOT\"\n+  implementation \"io.opentelemetry:opentelemetry-extension-auto-annotations:0.10.0-SNAPSHOT\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8825e08d0bf725057490f42275de6e42e441eac6"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4741, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}