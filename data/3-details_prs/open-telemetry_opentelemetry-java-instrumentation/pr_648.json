{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1ODYwMjEx", "number": 648, "title": "[3.2] Create spring-webmvc-3.1-core project", "bodyText": "This pull requests builds on this change #647.\nThis pull request introduces a new spring-webmvc-3.1-core project\n\nMove spring-webmvc:3.1 and javax dependencies from spring-webmvc-3.1.gradle to spring-webmvc-3.1-core.gradle\nAdd compileOnly project(instrumentation-core:spring:spring-webmvc-3.1-core')tospring-webmvc-3.1.gradle\nImplement the HttpServerTracingBase decorator\nUse the new decorator to instrument spring-webmvc using a spring-web filter (This filter will be used to add tracing to spring-web controllers)", "createdAt": "2020-07-08T02:23:02Z", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648", "merged": true, "mergeCommit": {"oid": "556baecd556906e31ad832e67bcf82dc4745de1e"}, "closed": true, "closedAt": "2020-07-10T16:45:40Z", "author": {"login": "mabdinur"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyxBn4gBqjM1MjMwODk1OTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczmeI-AFqTQ0NjU0NzY4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a0026cefa1a86e33a2173f06e0a0399255647756", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a0026cefa1a86e33a2173f06e0a0399255647756", "committedDate": "2020-07-08T01:47:38Z", "message": "[3.2] create spring-webmvc-3.1-core project"}, "afterCommit": {"oid": "25ffc2b64f88d9fd4706b211a0f51c25cf6af69d", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/25ffc2b64f88d9fd4706b211a0f51c25cf6af69d", "committedDate": "2020-07-08T02:28:41Z", "message": "[3.2] create spring-webmvc-3.1-core project"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "25ffc2b64f88d9fd4706b211a0f51c25cf6af69d", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/25ffc2b64f88d9fd4706b211a0f51c25cf6af69d", "committedDate": "2020-07-08T02:28:41Z", "message": "[3.2] create spring-webmvc-3.1-core project"}, "afterCommit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/406a1f606ae035901fa95b05c9376f09a0f61905", "committedDate": "2020-07-08T03:07:24Z", "message": "[3.2] create spring-webmvc-3.1-core project"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NDMxNzY3", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#pullrequestreview-444431767", "createdAt": "2020-07-08T05:53:50Z", "commit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNTo1Mzo1MFrOGuZIBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNjoxOTowOVrOGuZpKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI5OTMzMg==", "bodyText": "This is default, so no need to specify this manually", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r451299332", "createdAt": "2020-07-08T05:53:50Z", "author": {"login": "iNikem"}, "path": "instrumentation-core/spring/spring-webmvc-3.1-core/spring-webmvc-3.1-core.gradle", "diffHunk": "@@ -0,0 +1,52 @@\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_7", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI5OTQyMw==", "bodyText": "Version is taken care of automatically, please remove this.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r451299423", "createdAt": "2020-07-08T05:54:03Z", "author": {"login": "iNikem"}, "path": "instrumentation-core/spring/spring-webmvc-3.1-core/spring-webmvc-3.1-core.gradle", "diffHunk": "@@ -0,0 +1,52 @@\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_7\n+}\n+\n+group = 'io.opentelemetry.instrumentation'\n+version = '0.0.1-SNAPSHOT'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI5OTY5MA==", "bodyText": "Muzzle is purely byte-code manipulation related functionality. No need to have it here.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r451299690", "createdAt": "2020-07-08T05:54:52Z", "author": {"login": "iNikem"}, "path": "instrumentation-core/spring/spring-webmvc-3.1-core/spring-webmvc-3.1-core.gradle", "diffHunk": "@@ -0,0 +1,52 @@\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_7\n+}\n+\n+group = 'io.opentelemetry.instrumentation'\n+version = '0.0.1-SNAPSHOT'\n+\n+apply from: \"$rootDir/gradle/java.gradle\"\n+apply plugin: 'muzzle'\n+\n+muzzle {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI5OTc3NQ==", "bodyText": "remove this please", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r451299775", "createdAt": "2020-07-08T05:55:10Z", "author": {"login": "iNikem"}, "path": "instrumentation-core/spring/spring-webmvc-3.1-core/spring-webmvc-3.1-core.gradle", "diffHunk": "@@ -0,0 +1,52 @@\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_7\n+}\n+\n+group = 'io.opentelemetry.instrumentation'\n+version = '0.0.1-SNAPSHOT'\n+\n+apply from: \"$rootDir/gradle/java.gradle\"\n+apply plugin: 'muzzle'\n+\n+muzzle {\n+  pass {\n+    group = 'org.springframework'\n+    module = 'spring-webmvc'\n+    versions = \"[3.1.0.RELEASE,]\"\n+    skipVersions += ['1.2.1', '1.2.2', '1.2.3', '1.2.4'] // broken releases... missing dependencies\n+    skipVersions += '3.2.1.RELEASE' // missing a required class.  (bad release?)\n+    extraDependency \"javax.servlet:javax.servlet-api:3.0.1\"\n+    assertInverse = true\n+  }\n+\n+  // FIXME: webmvc depends on web, so we need a separate integration for spring-web specifically.\n+  fail {\n+    group = 'org.springframework'\n+    module = 'spring-web'\n+    versions = \"[,]\"\n+    skipVersions += ['1.2.1', '1.2.2', '1.2.3', '1.2.4'] // broken releases... missing dependencies\n+    extraDependency \"javax.servlet:javax.servlet-api:3.0.1\"\n+  }\n+}\n+\n+sourceCompatibility = '7'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwMDEzNQ==", "bodyText": "Manual instrumentations must not depend on auto-instrumentations. What functionality do you need from there?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r451300135", "createdAt": "2020-07-08T05:56:13Z", "author": {"login": "iNikem"}, "path": "instrumentation-core/spring/spring-webmvc-3.1-core/spring-webmvc-3.1-core.gradle", "diffHunk": "@@ -0,0 +1,52 @@\n+ext {\n+  minJavaVersionForTests = JavaVersion.VERSION_1_7\n+}\n+\n+group = 'io.opentelemetry.instrumentation'\n+version = '0.0.1-SNAPSHOT'\n+\n+apply from: \"$rootDir/gradle/java.gradle\"\n+apply plugin: 'muzzle'\n+\n+muzzle {\n+  pass {\n+    group = 'org.springframework'\n+    module = 'spring-webmvc'\n+    versions = \"[3.1.0.RELEASE,]\"\n+    skipVersions += ['1.2.1', '1.2.2', '1.2.3', '1.2.4'] // broken releases... missing dependencies\n+    skipVersions += '3.2.1.RELEASE' // missing a required class.  (bad release?)\n+    extraDependency \"javax.servlet:javax.servlet-api:3.0.1\"\n+    assertInverse = true\n+  }\n+\n+  // FIXME: webmvc depends on web, so we need a separate integration for spring-web specifically.\n+  fail {\n+    group = 'org.springframework'\n+    module = 'spring-web'\n+    versions = \"[,]\"\n+    skipVersions += ['1.2.1', '1.2.2', '1.2.3', '1.2.4'] // broken releases... missing dependencies\n+    extraDependency \"javax.servlet:javax.servlet-api:3.0.1\"\n+  }\n+}\n+\n+sourceCompatibility = '7'\n+\n+dependencies {\n+  // copy-paste from instrumentation-core-aws-sdk:aws-sdk-2.2-core:\n+  // TODO(anuraaga): We currently include common instrumentation logic like decorators in the\n+  // bootstrap, but we need to move it out so manual instrumentation does not depend on code from\n+  // the agent, like Agent.\n+  api project(':auto-bootstrap')\n+\n+  // TODO(mabdinur):\n+  // Move servlet-common to instrumentation-core\n+  compileOnly project(':instrumentation:servlet:servlet-common')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwMDg3NQ==", "bodyText": "Our codes currently has 2 approaches for creating spans and setting attributes. One is using old-style \"Decorators\", another is newer one using \"Tracers\". It will take time, but the goal is to replaces Decorators with Tracers. As you extend from Tracer, please don't use \"Decorator\" in you class/field names to avoid confusion.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r451300875", "createdAt": "2020-07-08T05:58:34Z", "author": {"login": "iNikem"}, "path": "instrumentation-core/spring/spring-webmvc-3.1-core/src/main/java/io/opentelemetry/instrumentation/springwebmvc/SpringWebMvcDecorator.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.instrumentation.springwebmvc;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.auto.bootstrap.instrumentation.decorator.HttpServerTracerBase;\n+import io.opentelemetry.auto.instrumentation.servlet.HttpServletRequestGetter;\n+import io.opentelemetry.context.propagation.HttpTextFormat.Getter;\n+import io.opentelemetry.trace.Span;\n+import io.opentelemetry.trace.Status;\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import javax.servlet.http.HttpServletRequest;\n+\n+public class SpringWebMvcDecorator\n+    extends HttpServerTracerBase<HttpServletRequest, HttpServletRequest, HttpServletRequest> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwMTYwMA==", "bodyText": "There is no need to override and expose this method. Clients should use end or endExceptionally from the base class instead.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r451301600", "createdAt": "2020-07-08T06:00:49Z", "author": {"login": "iNikem"}, "path": "instrumentation-core/spring/spring-webmvc-3.1-core/src/main/java/io/opentelemetry/instrumentation/springwebmvc/SpringWebMvcDecorator.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.instrumentation.springwebmvc;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.auto.bootstrap.instrumentation.decorator.HttpServerTracerBase;\n+import io.opentelemetry.auto.instrumentation.servlet.HttpServletRequestGetter;\n+import io.opentelemetry.context.propagation.HttpTextFormat.Getter;\n+import io.opentelemetry.trace.Span;\n+import io.opentelemetry.trace.Status;\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import javax.servlet.http.HttpServletRequest;\n+\n+public class SpringWebMvcDecorator\n+    extends HttpServerTracerBase<HttpServletRequest, HttpServletRequest, HttpServletRequest> {\n+\n+  public static final SpringWebMvcDecorator DECORATE = new SpringWebMvcDecorator();\n+\n+  public Span afterStart(final Span span) {\n+    assert span != null;\n+    return span;\n+  }\n+\n+  public Span beforeFinish(final Span span) {\n+    assert span != null;\n+    return span;\n+  }\n+\n+  @Override\n+  public void onError(final Span span, final Throwable throwable) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwMTk0Ng==", "bodyText": "Use endExceptionally here", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r451301946", "createdAt": "2020-07-08T06:01:54Z", "author": {"login": "iNikem"}, "path": "instrumentation-core/spring/spring-webmvc-3.1-core/src/main/java/io/opentelemetry/instrumentation/springwebmvc/WebMVCTracingFilter.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.instrumentation.springwebmvc;\n+\n+import static io.opentelemetry.instrumentation.springwebmvc.SpringWebMvcDecorator.DECORATE;\n+\n+import io.opentelemetry.context.Scope;\n+import io.opentelemetry.trace.Span;\n+import io.opentelemetry.trace.Tracer;\n+import java.io.IOException;\n+import javax.servlet.FilterChain;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.springframework.core.Ordered;\n+import org.springframework.web.filter.OncePerRequestFilter;\n+\n+public class WebMVCTracingFilter extends OncePerRequestFilter implements Ordered {\n+\n+  private static final String FILTER_CLASS = \"WebMVCTracingFilter\";\n+  private static final String FILTER_METHOD = \"doFilterInteral\";\n+  private final Tracer tracer;\n+\n+  public WebMVCTracingFilter(Tracer tracer) {\n+    this.tracer = tracer;\n+  }\n+\n+  @Override\n+  public void doFilterInternal(\n+      HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)\n+      throws ServletException, IOException {\n+    HttpServletRequest req = (HttpServletRequest) request;\n+\n+    Span serverSpan = DECORATE.startSpan(tracer, req, req, FILTER_METHOD, FILTER_CLASS);\n+\n+    try (Scope scope = tracer.withSpan(serverSpan)) {\n+      filterChain.doFilter(req, response);\n+    } catch (Throwable t) {\n+      DECORATE.onError(serverSpan, t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNzMwNg==", "bodyText": "I am not sure if my thoughts below are correct... @trask @anuraaga what do you think about it?\nAmong other things there are two objectives in introducing manual instrumentations in this repo.\n\nTo produce roughly the same result as auto-instrumentation does\nTo allow auto-instrumentation to reuse code from manual one, if possible.\n\nThis filter violates at least the first one. Auto-instrumentation for Spring MVC creates spans with Span.Kind=INTERNAL, this filter produces Span.King=SERVER.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r451307306", "createdAt": "2020-07-08T06:17:41Z", "author": {"login": "iNikem"}, "path": "instrumentation-core/spring/spring-webmvc-3.1-core/src/main/java/io/opentelemetry/instrumentation/springwebmvc/WebMVCTracingFilter.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.instrumentation.springwebmvc;\n+\n+import static io.opentelemetry.instrumentation.springwebmvc.SpringWebMvcDecorator.DECORATE;\n+\n+import io.opentelemetry.context.Scope;\n+import io.opentelemetry.trace.Span;\n+import io.opentelemetry.trace.Tracer;\n+import java.io.IOException;\n+import javax.servlet.FilterChain;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.springframework.core.Ordered;\n+import org.springframework.web.filter.OncePerRequestFilter;\n+\n+public class WebMVCTracingFilter extends OncePerRequestFilter implements Ordered {\n+\n+  private static final String FILTER_CLASS = \"WebMVCTracingFilter\";\n+  private static final String FILTER_METHOD = \"doFilterInteral\";\n+  private final Tracer tracer;\n+\n+  public WebMVCTracingFilter(Tracer tracer) {\n+    this.tracer = tracer;\n+  }\n+\n+  @Override\n+  public void doFilterInternal(\n+      HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)\n+      throws ServletException, IOException {\n+    HttpServletRequest req = (HttpServletRequest) request;\n+\n+    Span serverSpan = DECORATE.startSpan(tracer, req, req, FILTER_METHOD, FILTER_CLASS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMwNzgxNw==", "bodyText": "What exactly does this auto-instrumentation modules (re)-uses from that \"core\" module?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r451307817", "createdAt": "2020-07-08T06:19:09Z", "author": {"login": "iNikem"}, "path": "instrumentation/spring-webmvc-3.1/spring-webmvc-3.1.gradle", "diffHunk": "@@ -1,31 +1,7 @@\n apply from: \"$rootDir/gradle/instrumentation.gradle\"\n \n-muzzle {\n-  pass {\n-    group = 'org.springframework'\n-    module = 'spring-webmvc'\n-    versions = \"[3.1.0.RELEASE,]\"\n-    skipVersions += ['1.2.1', '1.2.2', '1.2.3', '1.2.4'] // broken releases... missing dependencies\n-    skipVersions += '3.2.1.RELEASE' // missing a required class.  (bad release?)\n-    extraDependency \"javax.servlet:javax.servlet-api:3.0.1\"\n-    assertInverse = true\n-  }\n-\n-  // FIXME: webmvc depends on web, so we need a separate integration for spring-web specifically.\n-  fail {\n-    group = 'org.springframework'\n-    module = 'spring-web'\n-    versions = \"[,]\"\n-    skipVersions += ['1.2.1', '1.2.2', '1.2.3', '1.2.4'] // broken releases... missing dependencies\n-    extraDependency \"javax.servlet:javax.servlet-api:3.0.1\"\n-  }\n-}\n-\n dependencies {\n-  compileOnly group: 'org.springframework', name: 'spring-webmvc', version: '3.1.0.RELEASE'\n-  compileOnly group: 'javax.servlet', name: 'javax.servlet-api', version: '3.1.0'\n-//  compileOnly group: 'org.springframework', name: 'spring-webmvc', version: '2.5.6'\n-//  compileOnly group: 'javax.servlet', name: 'servlet-api', version: '2.4'\n+  compileOnly project(':instrumentation-core:spring:spring-webmvc-3.1-core')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "406a1f606ae035901fa95b05c9376f09a0f61905"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c83435bf29b5fb7f505b7a7b95e44a58a5ae0b9", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/0c83435bf29b5fb7f505b7a7b95e44a58a5ae0b9", "committedDate": "2020-07-08T14:01:11Z", "message": "address comments"}, "afterCommit": {"oid": "2150498f6a7f26077bb352a871be454bb0c24b6d", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2150498f6a7f26077bb352a871be454bb0c24b6d", "committedDate": "2020-07-08T14:09:47Z", "message": "address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2150498f6a7f26077bb352a871be454bb0c24b6d", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2150498f6a7f26077bb352a871be454bb0c24b6d", "committedDate": "2020-07-08T14:09:47Z", "message": "address comments"}, "afterCommit": {"oid": "7b13346c9f8ee09fd3f6088aa8d7e55d4128c2f2", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/7b13346c9f8ee09fd3f6088aa8d7e55d4128c2f2", "committedDate": "2020-07-08T14:29:25Z", "message": "rebase and fix conflicts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b13346c9f8ee09fd3f6088aa8d7e55d4128c2f2", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/7b13346c9f8ee09fd3f6088aa8d7e55d4128c2f2", "committedDate": "2020-07-08T14:29:25Z", "message": "rebase and fix conflicts"}, "afterCommit": {"oid": "a707946a6015fd0b8523fa093463b33df5806978", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a707946a6015fd0b8523fa093463b33df5806978", "committedDate": "2020-07-09T00:51:07Z", "message": "rebase and fix conflicts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a707946a6015fd0b8523fa093463b33df5806978", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a707946a6015fd0b8523fa093463b33df5806978", "committedDate": "2020-07-09T00:51:07Z", "message": "rebase and fix conflicts"}, "afterCommit": {"oid": "769ab4fa7c9edb2bb11fc15f93b29582466da6d9", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/769ab4fa7c9edb2bb11fc15f93b29582466da6d9", "committedDate": "2020-07-09T15:01:36Z", "message": "renamed project and removed instrumentation:spring-webmv-3.1 -> instrumentation-core:spring-webmvc-3.1 dependency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1OTk1NDU0", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#pullrequestreview-445995454", "createdAt": "2020-07-09T21:54:45Z", "commit": {"oid": "769ab4fa7c9edb2bb11fc15f93b29582466da6d9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo1NDo0NVrOGvjJJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMTo1NTowMlrOGvjJsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMjAzNw==", "bodyText": "need to re-throw t (otherwise exception will be suppressed and alter the application behavior)", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r452512037", "createdAt": "2020-07-09T21:54:45Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-webmvc-3.1/src/main/java/io/opentelemetry/instrumentation/springwebmvc/WebMVCTracingFilter.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.instrumentation.springwebmvc;\n+\n+import static io.opentelemetry.instrumentation.springwebmvc.SpringWebMvcServerTracer.DECORATE;\n+\n+import io.opentelemetry.context.Scope;\n+import io.opentelemetry.trace.Span;\n+import io.opentelemetry.trace.Tracer;\n+import java.io.IOException;\n+import javax.servlet.FilterChain;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.springframework.core.Ordered;\n+import org.springframework.web.filter.OncePerRequestFilter;\n+\n+public class WebMVCTracingFilter extends OncePerRequestFilter implements Ordered {\n+\n+  private static final String FILTER_CLASS = \"WebMVCTracingFilter\";\n+  private static final String FILTER_METHOD = \"doFilterInteral\";\n+  private final Tracer tracer;\n+\n+  public WebMVCTracingFilter(Tracer tracer) {\n+    this.tracer = tracer;\n+  }\n+\n+  @Override\n+  public void doFilterInternal(\n+      HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)\n+      throws ServletException, IOException {\n+    HttpServletRequest req = (HttpServletRequest) request;\n+\n+    Span serverSpan = DECORATE.startSpan(tracer, req, req, FILTER_METHOD, FILTER_CLASS);\n+\n+    try (Scope scope = tracer.withSpan(serverSpan)) {\n+      filterChain.doFilter(req, response);\n+      DECORATE.end(serverSpan, response.getStatus());\n+    } catch (Throwable t) {\n+      DECORATE.endExceptionally(serverSpan, t, response.getStatus());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "769ab4fa7c9edb2bb11fc15f93b29582466da6d9"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUxMjE3Ng==", "bodyText": "this cast is not needed", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r452512176", "createdAt": "2020-07-09T21:55:02Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-webmvc-3.1/src/main/java/io/opentelemetry/instrumentation/springwebmvc/WebMVCTracingFilter.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.instrumentation.springwebmvc;\n+\n+import static io.opentelemetry.instrumentation.springwebmvc.SpringWebMvcServerTracer.DECORATE;\n+\n+import io.opentelemetry.context.Scope;\n+import io.opentelemetry.trace.Span;\n+import io.opentelemetry.trace.Tracer;\n+import java.io.IOException;\n+import javax.servlet.FilterChain;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.springframework.core.Ordered;\n+import org.springframework.web.filter.OncePerRequestFilter;\n+\n+public class WebMVCTracingFilter extends OncePerRequestFilter implements Ordered {\n+\n+  private static final String FILTER_CLASS = \"WebMVCTracingFilter\";\n+  private static final String FILTER_METHOD = \"doFilterInteral\";\n+  private final Tracer tracer;\n+\n+  public WebMVCTracingFilter(Tracer tracer) {\n+    this.tracer = tracer;\n+  }\n+\n+  @Override\n+  public void doFilterInternal(\n+      HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)\n+      throws ServletException, IOException {\n+    HttpServletRequest req = (HttpServletRequest) request;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "769ab4fa7c9edb2bb11fc15f93b29582466da6d9"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MTI0NTMy", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#pullrequestreview-446124532", "createdAt": "2020-07-10T05:08:59Z", "commit": {"oid": "278801b0f3a5aae7f2a94cb1328ebe5a633b5de8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNTowODo1OVrOGvqBGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNTowODo1OVrOGvqBGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYyNDY2NQ==", "bodyText": "i like the idea from an earlier review of keeping public api surface of manual instrumentation minimal \ud83d\udc4d\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class SpringWebMvcServerTracer\n          \n          \n            \n            class SpringWebMvcServerTracer", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#discussion_r452624665", "createdAt": "2020-07-10T05:08:59Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-webmvc-3.1/src/main/java/io/opentelemetry/instrumentation/springwebmvc/SpringWebMvcServerTracer.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.instrumentation.springwebmvc;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.auto.bootstrap.instrumentation.decorator.HttpServerTracer;\n+import io.opentelemetry.context.propagation.HttpTextFormat.Getter;\n+import io.opentelemetry.instrumentation.servlet.HttpServletRequestGetter;\n+import io.opentelemetry.trace.Tracer;\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import javax.servlet.http.HttpServletRequest;\n+\n+public class SpringWebMvcServerTracer", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "278801b0f3a5aae7f2a94cb1328ebe5a633b5de8"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MTMxMDgw", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#pullrequestreview-446131080", "createdAt": "2020-07-10T05:32:23Z", "commit": {"oid": "278801b0f3a5aae7f2a94cb1328ebe5a633b5de8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b592da3fb73e4e8113f8bb3754903136ca5a34aa", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b592da3fb73e4e8113f8bb3754903136ca5a34aa", "committedDate": "2020-07-10T16:07:51Z", "message": "[3.2] create spring-webmvc-3.1-core project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76b19bb7a328b62e5afd529bfdb26388973ba2b1", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/76b19bb7a328b62e5afd529bfdb26388973ba2b1", "committedDate": "2020-07-10T16:07:51Z", "message": "rebase and fix conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4da50ca0d84cac26b944d9f4a26ec0a9839d8c3", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/d4da50ca0d84cac26b944d9f4a26ec0a9839d8c3", "committedDate": "2020-07-10T16:07:51Z", "message": "renamed project and removed instrumentation:spring-webmv-3.1 -> instrumentation-core:spring-webmvc-3.1 dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de30e9779fa83b8b77f84c666ba7d9d91c86d564", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/de30e9779fa83b8b77f84c666ba7d9d91c86d564", "committedDate": "2020-07-10T16:07:51Z", "message": "update tracer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c353ba66fd54ebf1fcdb350acc1d41cb15786a7", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/8c353ba66fd54ebf1fcdb350acc1d41cb15786a7", "committedDate": "2020-07-10T16:07:51Z", "message": "ws"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db96c537039556660eecaccfc955d46706e7b12c", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/db96c537039556660eecaccfc955d46706e7b12c", "committedDate": "2020-07-10T16:07:52Z", "message": "Update instrumentation-core/spring/spring-webmvc-3.1/src/main/java/io/opentelemetry/instrumentation/springwebmvc/SpringWebMvcServerTracer.java\n\nCo-authored-by: Trask Stalnaker <trask.stalnaker@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d2c7b81d6c0c8b261706c92a1d4671361698975", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/3d2c7b81d6c0c8b261706c92a1d4671361698975", "committedDate": "2020-07-10T16:07:52Z", "message": "Update spring-webmvc-3.1.gradle"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3a12cf97d670d13a36ae782953f9041dbde06a7", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e3a12cf97d670d13a36ae782953f9041dbde06a7", "committedDate": "2020-07-10T15:11:30Z", "message": "Update spring-webmvc-3.1.gradle"}, "afterCommit": {"oid": "3d2c7b81d6c0c8b261706c92a1d4671361698975", "author": {"user": {"login": "mabdinur", "name": "Munir Abdinur"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/3d2c7b81d6c0c8b261706c92a1d4671361698975", "committedDate": "2020-07-10T16:07:52Z", "message": "Update spring-webmvc-3.1.gradle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTQ3Njg5", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/648#pullrequestreview-446547689", "createdAt": "2020-07-10T16:45:32Z", "commit": {"oid": "3d2c7b81d6c0c8b261706c92a1d4671361698975"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3067, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}