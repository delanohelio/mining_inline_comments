{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0NzYyNDgw", "number": 922, "reviewThreads": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDowOTowNVrOEWaZxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1NDoyM1rOEYK0bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM2NzExOnYy", "diffSide": "RIGHT", "path": "instrumentation/play-ws/play-ws-2.1/src/main/java/io/opentelemetry/auto/instrumentation/playws/v2_1/PlayWSClientInstrumentation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDowOTowNVrOG9tT0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDowOTowNVrOG9tT0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1ODY3Mw==", "bodyText": "I don't think scope can be null here", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467358673", "createdAt": "2020-08-08T04:09:05Z", "author": {"login": "trask"}, "path": "instrumentation/play-ws/play-ws-2.1/src/main/java/io/opentelemetry/auto/instrumentation/playws/v2_1/PlayWSClientInstrumentation.java", "diffHunk": "@@ -63,12 +53,15 @@ public static Span methodEnter(\n \n     @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n     public static void methodExit(\n-        @Advice.Enter final Span clientSpan, @Advice.Thrown final Throwable throwable) {\n+        @Advice.Enter final Span span,\n+        @Advice.Thrown final Throwable throwable,\n+        @Advice.Local(\"otelScope\") Scope scope) {\n+      if (scope != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM2ODU1OnYy", "diffSide": "RIGHT", "path": "instrumentation/play-ws/play-ws-1.0/src/main/java/io/opentelemetry/auto/instrumentation/playws/v1_0/PlayWSClientInstrumentation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMTowM1rOG9tUdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMTowM1rOG9tUdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1ODgzNg==", "bodyText": "can you switch this to new convention @Advice.Local(\"otelSpan\")?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467358836", "createdAt": "2020-08-08T04:11:03Z", "author": {"login": "trask"}, "path": "instrumentation/play-ws/play-ws-1.0/src/main/java/io/opentelemetry/auto/instrumentation/playws/v1_0/PlayWSClientInstrumentation.java", "diffHunk": "@@ -72,12 +57,14 @@ public static Span methodEnter(\n \n     @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n     public static void methodExit(\n-        @Advice.Enter final Span clientSpan, @Advice.Thrown final Throwable throwable) {\n-\n+        @Advice.Enter final Span span,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM2ODY5OnYy", "diffSide": "RIGHT", "path": "instrumentation/play-ws/play-ws-1.0/src/main/java/io/opentelemetry/auto/instrumentation/playws/v1_0/PlayWSClientInstrumentation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMTozMVrOG9tUhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMTozMVrOG9tUhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1ODg1Mg==", "bodyText": "i don't think scope can be null here", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467358852", "createdAt": "2020-08-08T04:11:31Z", "author": {"login": "trask"}, "path": "instrumentation/play-ws/play-ws-1.0/src/main/java/io/opentelemetry/auto/instrumentation/playws/v1_0/PlayWSClientInstrumentation.java", "diffHunk": "@@ -72,12 +57,14 @@ public static Span methodEnter(\n \n     @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n     public static void methodExit(\n-        @Advice.Enter final Span clientSpan, @Advice.Thrown final Throwable throwable) {\n-\n+        @Advice.Enter final Span span,\n+        @Advice.Thrown final Throwable throwable,\n+        @Advice.Local(\"otelScope\") Scope scope) {\n+      if (scope != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM2OTA0OnYy", "diffSide": "RIGHT", "path": "instrumentation/play-ws/play-ws-2.0/src/main/java/io/opentelemetry/auto/instrumentation/playws/v2_0/PlayWSClientInstrumentation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMTo0OVrOG9tUqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMTo0OVrOG9tUqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1ODg4OQ==", "bodyText": "can you switch this to new convention @Advice.Local(\"otelSpan\")?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467358889", "createdAt": "2020-08-08T04:11:49Z", "author": {"login": "trask"}, "path": "instrumentation/play-ws/play-ws-2.0/src/main/java/io/opentelemetry/auto/instrumentation/playws/v2_0/PlayWSClientInstrumentation.java", "diffHunk": "@@ -63,12 +53,15 @@ public static Span methodEnter(\n \n     @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n     public static void methodExit(\n-        @Advice.Enter final Span clientSpan, @Advice.Thrown final Throwable throwable) {\n+        @Advice.Enter final Span span,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM2OTE2OnYy", "diffSide": "RIGHT", "path": "instrumentation/play-ws/play-ws-2.0/src/main/java/io/opentelemetry/auto/instrumentation/playws/v2_0/PlayWSClientInstrumentation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMjowNlrOG9tUug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMjowNlrOG9tUug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1ODkwNg==", "bodyText": "i don't think scope can be null here", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467358906", "createdAt": "2020-08-08T04:12:06Z", "author": {"login": "trask"}, "path": "instrumentation/play-ws/play-ws-2.0/src/main/java/io/opentelemetry/auto/instrumentation/playws/v2_0/PlayWSClientInstrumentation.java", "diffHunk": "@@ -63,12 +53,15 @@ public static Span methodEnter(\n \n     @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n     public static void methodExit(\n-        @Advice.Enter final Span clientSpan, @Advice.Thrown final Throwable throwable) {\n+        @Advice.Enter final Span span,\n+        @Advice.Thrown final Throwable throwable,\n+        @Advice.Local(\"otelScope\") Scope scope) {\n+      if (scope != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM2OTI5OnYy", "diffSide": "RIGHT", "path": "instrumentation/play-ws/play-ws-2.1/src/main/java/io/opentelemetry/auto/instrumentation/playws/v2_1/PlayWSClientInstrumentation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMjoxOVrOG9tUxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMjoxOVrOG9tUxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1ODkxOQ==", "bodyText": "can you switch this to new convention @Advice.Local(\"otelSpan\")?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467358919", "createdAt": "2020-08-08T04:12:19Z", "author": {"login": "trask"}, "path": "instrumentation/play-ws/play-ws-2.1/src/main/java/io/opentelemetry/auto/instrumentation/playws/v2_1/PlayWSClientInstrumentation.java", "diffHunk": "@@ -63,12 +53,15 @@ public static Span methodEnter(\n \n     @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n     public static void methodExit(\n-        @Advice.Enter final Span clientSpan, @Advice.Thrown final Throwable throwable) {\n+        @Advice.Enter final Span span,\n+        @Advice.Thrown final Throwable throwable,\n+        @Advice.Local(\"otelScope\") Scope scope) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM2OTY5OnYy", "diffSide": "LEFT", "path": "instrumentation-core/apache-httpclient-4.0/src/main/java/io/opentelemetry/instrumentation/apachehttpclient/v4_0/ApacheHttpClientHelper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMzoxOVrOG9tU-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMzoxOVrOG9tU-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1ODk2OQ==", "bodyText": "lost this comment", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467358969", "createdAt": "2020-08-08T04:13:19Z", "author": {"login": "trask"}, "path": "instrumentation-core/apache-httpclient-4.0/src/main/java/io/opentelemetry/instrumentation/apachehttpclient/v4_0/ApacheHttpClientHelper.java", "diffHunk": "@@ -69,14 +48,15 @@ public static void doMethodExit(\n       final SpanWithScope spanWithScope, final Object result, final Throwable throwable) {\n     try {\n       Span span = spanWithScope.getSpan();\n-\n       if (result instanceof HttpResponse) {\n-        DECORATE.onResponse(span, (HttpResponse) result);\n-      } // else they probably provided a ResponseHandler.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM2OTkwOnYy", "diffSide": "RIGHT", "path": "instrumentation-core/apache-httpclient-4.0/src/main/java/io/opentelemetry/instrumentation/apachehttpclient/v4_0/ApacheHttpClientTracer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxMzo1MVrOG9tVGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxOToxNTo1OFrOG-b5rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1OTAwMQ==", "bodyText": "is this needed since only calls super?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467359001", "createdAt": "2020-08-08T04:13:51Z", "author": {"login": "trask"}, "path": "instrumentation-core/apache-httpclient-4.0/src/main/java/io/opentelemetry/instrumentation/apachehttpclient/v4_0/ApacheHttpClientTracer.java", "diffHunk": "@@ -59,8 +56,23 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpUriRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.spring-webflux-5.0\";\n+  }\n+\n+  @Override\n+  protected Span onResponse(Span span, HttpResponse httpResponse) {\n+    return super.onResponse(span, httpResponse);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEyMjAzMA==", "bodyText": "yes.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468122030", "createdAt": "2020-08-10T19:15:58Z", "author": {"login": "heyams"}, "path": "instrumentation-core/apache-httpclient-4.0/src/main/java/io/opentelemetry/instrumentation/apachehttpclient/v4_0/ApacheHttpClientTracer.java", "diffHunk": "@@ -59,8 +56,23 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpUriRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.spring-webflux-5.0\";\n+  }\n+\n+  @Override\n+  protected Span onResponse(Span span, HttpResponse httpResponse) {\n+    return super.onResponse(span, httpResponse);\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1OTAwMQ=="}, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM3MDUxOnYy", "diffSide": "RIGHT", "path": "instrumentation-core/spring/spring-boot-autoconfigure/src/main/java/io/opentelemetry/instrumentation/spring/autoconfigure/httpclients/resttemplate/RestTemplateAutoConfiguration.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxNDozOFrOG9tVZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxNDozOFrOG9tVZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1OTA3Ng==", "bodyText": "in this case we want to pass tracer on, so that spring boot starter users can supply their own Tracer\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return new RestTemplateBeanPostProcessor();\n          \n          \n            \n                return new RestTemplateBeanPostProcessor(tracer);", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467359076", "createdAt": "2020-08-08T04:14:38Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-boot-autoconfigure/src/main/java/io/opentelemetry/instrumentation/spring/autoconfigure/httpclients/resttemplate/RestTemplateAutoConfiguration.java", "diffHunk": "@@ -43,6 +43,6 @@\n   @Bean\n   @Autowired\n   public RestTemplateBeanPostProcessor otelRestTemplateBeanPostProcessor(final Tracer tracer) {\n-    return new RestTemplateBeanPostProcessor(tracer);\n+    return new RestTemplateBeanPostProcessor();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM3MTEyOnYy", "diffSide": "RIGHT", "path": "instrumentation-core/spring/spring-boot-autoconfigure/src/main/java/io/opentelemetry/instrumentation/spring/autoconfigure/httpclients/resttemplate/RestTemplateBeanPostProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxNTowN1rOG9tVqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxNTowN1rOG9tVqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1OTE0NQ==", "bodyText": "same here\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  restTemplateInterceptors.add(0, new RestTemplateInterceptor());\n          \n          \n            \n                  restTemplateInterceptors.add(0, new RestTemplateInterceptor(tracer));", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467359145", "createdAt": "2020-08-08T04:15:07Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-boot-autoconfigure/src/main/java/io/opentelemetry/instrumentation/spring/autoconfigure/httpclients/resttemplate/RestTemplateBeanPostProcessor.java", "diffHunk": "@@ -47,7 +42,7 @@ private void addRestTemplateInterceptorIfNotPresent(RestTemplate restTemplate) {\n     List<ClientHttpRequestInterceptor> restTemplateInterceptors = restTemplate.getInterceptors();\n     if (restTemplateInterceptors.stream()\n         .noneMatch(inteceptor -> inteceptor instanceof RestTemplateInterceptor)) {\n-      restTemplateInterceptors.add(0, new RestTemplateInterceptor(tracer));\n+      restTemplateInterceptors.add(0, new RestTemplateInterceptor());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM3MTI3OnYy", "diffSide": "RIGHT", "path": "instrumentation-core/spring/spring-boot-autoconfigure/src/test/java/io/opentelemetry/instrumentation/spring/autoconfigure/httpclients/resttemplate/RestTemplateBeanPostProcessorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxNToyMFrOG9tVug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxNToyMFrOG9tVug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1OTE2Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              RestTemplateBeanPostProcessor restTemplateBeanPostProcessor = new RestTemplateBeanPostProcessor();\n          \n          \n            \n              RestTemplateBeanPostProcessor restTemplateBeanPostProcessor = new RestTemplateBeanPostProcessor(tracer);", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467359162", "createdAt": "2020-08-08T04:15:20Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-boot-autoconfigure/src/test/java/io/opentelemetry/instrumentation/spring/autoconfigure/httpclients/resttemplate/RestTemplateBeanPostProcessorTest.java", "diffHunk": "@@ -31,8 +31,7 @@\n class RestTemplateBeanPostProcessorTest {\n   @Mock Tracer tracer;\n \n-  RestTemplateBeanPostProcessor restTemplateBeanPostProcessor =\n-      new RestTemplateBeanPostProcessor(tracer);\n+  RestTemplateBeanPostProcessor restTemplateBeanPostProcessor = new RestTemplateBeanPostProcessor();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTM3MzI3OnYy", "diffSide": "RIGHT", "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/springwebflux/client/WebClientTracingFilter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxODo1NlrOG9tWqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNDoxODo1NlrOG9tWqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1OTQwMA==", "bodyText": "this can go up, before the scope, which helps us see it's all part of \"startSpan\"", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r467359400", "createdAt": "2020-08-08T04:18:56Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/springwebflux/client/WebClientTracingFilter.java", "diffHunk": "@@ -49,32 +48,27 @@ public static void addFilter(\n \n   @Override\n   public Mono<ClientResponse> filter(final ClientRequest request, final ExchangeFunction next) {\n-    Span span = DECORATE.getOrCreateSpan(request, tracer);\n-    DECORATE.afterStart(span);\n+    Span span = TRACER.getOrCreateSpan(TRACER.spanNameForRequest(request), tracer);\n \n     try (Scope scope = tracer.withSpan(span)) {\n       ClientRequest mutatedRequest =\n           ClientRequest.from(request)\n-              .headers(httpHeaders -> DECORATE.inject(Context.current(), httpHeaders))\n+              .headers(httpHeaders -> TRACER.inject(Context.current(), httpHeaders))\n               .build();\n-      DECORATE.onRequest(span, mutatedRequest);\n+      TRACER.onRequest(span, mutatedRequest);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36f4c33563dc92c251b00ee6a5383534685569f3"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTY0MzA2OnYy", "diffSide": "RIGHT", "path": "instrumentation-core/spring/spring-boot-autoconfigure/src/main/java/io/opentelemetry/instrumentation/spring/autoconfigure/httpclients/resttemplate/RestTemplateBeanPostProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDozNjo1M1rOG-kWrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDozNjo1M1rOG-kWrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2MDUyNg==", "bodyText": "fyi #921", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468260526", "createdAt": "2020-08-11T00:36:53Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-boot-autoconfigure/src/main/java/io/opentelemetry/instrumentation/spring/autoconfigure/httpclients/resttemplate/RestTemplateBeanPostProcessor.java", "diffHunk": "@@ -27,7 +27,7 @@\n \n   private final Tracer tracer;\n \n-  public RestTemplateBeanPostProcessor(Tracer tracer) {\n+  public RestTemplateBeanPostProcessor(final Tracer tracer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTY1MjUwOnYy", "diffSide": "RIGHT", "path": "instrumentation/apache-httpasyncclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpasyncclient/ApacheHttpAsyncClientInstrumentation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDo0MTowNVrOG-kbvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDo0MTowNVrOG-kbvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2MTgyMw==", "bodyText": "comment was lost here\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  TRACER.endExceptionally(clientSpan, getResponse(context), ex);\n          \n          \n            \n                  // end span before calling delegate\n          \n          \n            \n                  TRACER.endExceptionally(clientSpan, getResponse(context), ex);", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468261823", "createdAt": "2020-08-11T00:41:05Z", "author": {"login": "trask"}, "path": "instrumentation/apache-httpasyncclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpasyncclient/ApacheHttpAsyncClientInstrumentation.java", "diffHunk": "@@ -220,10 +213,7 @@ public void completed(final T result) {\n \n     @Override\n     public void failed(final Exception ex) {\n-      DECORATE.onResponse(clientSpan, getResponse(context));\n-      DECORATE.onError(clientSpan, ex);\n-      DECORATE.beforeFinish(clientSpan);\n-      clientSpan.end(); // end span before calling delegate\n+      TRACER.endExceptionally(clientSpan, getResponse(context), ex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTY1Mjk3OnYy", "diffSide": "RIGHT", "path": "instrumentation/apache-httpasyncclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpasyncclient/ApacheHttpAsyncClientInstrumentation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDo0MToyM1rOG-kcDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDo0MToyM1rOG-kcDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2MTkwMg==", "bodyText": "same\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  TRACER.end(clientSpan, getResponse(context));\n          \n          \n            \n                  // end span before calling delegate\n          \n          \n            \n                  TRACER.end(clientSpan, getResponse(context));", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468261902", "createdAt": "2020-08-11T00:41:23Z", "author": {"login": "trask"}, "path": "instrumentation/apache-httpasyncclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpasyncclient/ApacheHttpAsyncClientInstrumentation.java", "diffHunk": "@@ -236,9 +226,7 @@ public void failed(final Exception ex) {\n \n     @Override\n     public void cancelled() {\n-      DECORATE.onResponse(clientSpan, getResponse(context));\n-      DECORATE.beforeFinish(clientSpan);\n-      clientSpan.end(); // end span before calling delegate\n+      TRACER.end(clientSpan, getResponse(context));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTY2MDQwOnYy", "diffSide": "RIGHT", "path": "instrumentation/apache-httpasyncclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpasyncclient/ApacheHttpAsyncClientTracer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDo0NTozN1rOG-kgaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQyMDoyMzowMFrOG_H3SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2MzAxNg==", "bodyText": "i think move this to HttpClientTracer, looks like netty instrumentation calls it also (but we don't validate netty CONNECT span is CLIENT)", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468263016", "createdAt": "2020-08-11T00:45:37Z", "author": {"login": "trask"}, "path": "instrumentation/apache-httpasyncclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpasyncclient/ApacheHttpAsyncClientTracer.java", "diffHunk": "@@ -78,8 +77,37 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.apache-httpasyncclient-4.0\";\n+  }\n+\n+  /**\n+   * This method is used to generate an acceptable CLIENT span (operation) name based on a given\n+   * name.\n+   */\n+  @Override\n+  public Span startSpan(String spanName) {\n+    return tracer.spanBuilder(spanName).setSpanKind(Kind.CLIENT).startSpan();\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODcyMDk0MA==", "bodyText": "Netty doesn't use it.. but Http-url-connection does.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468720940", "createdAt": "2020-08-11T16:46:19Z", "author": {"login": "heyams"}, "path": "instrumentation/apache-httpasyncclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpasyncclient/ApacheHttpAsyncClientTracer.java", "diffHunk": "@@ -78,8 +77,37 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.apache-httpasyncclient-4.0\";\n+  }\n+\n+  /**\n+   * This method is used to generate an acceptable CLIENT span (operation) name based on a given\n+   * name.\n+   */\n+  @Override\n+  public Span startSpan(String spanName) {\n+    return tracer.spanBuilder(spanName).setSpanKind(Kind.CLIENT).startSpan();\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2MzAxNg=="}, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0MjMxMw==", "bodyText": "add a todo in #912", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468842313", "createdAt": "2020-08-11T20:23:00Z", "author": {"login": "heyams"}, "path": "instrumentation/apache-httpasyncclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpasyncclient/ApacheHttpAsyncClientTracer.java", "diffHunk": "@@ -78,8 +77,37 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.apache-httpasyncclient-4.0\";\n+  }\n+\n+  /**\n+   * This method is used to generate an acceptable CLIENT span (operation) name based on a given\n+   * name.\n+   */\n+  @Override\n+  public Span startSpan(String spanName) {\n+    return tracer.spanBuilder(spanName).setSpanKind(Kind.CLIENT).startSpan();\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2MzAxNg=="}, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTY2MjcwOnYy", "diffSide": "RIGHT", "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientHelper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDo0Njo0N1rOG-khuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDo0Njo0N1rOG-khuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2MzM1Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    HttpResponse response = (HttpResponse) result;\n          \n          \n            \n                    TRACER.onResponse(span, response);\n          \n          \n            \n                    TRACER.onResponse(span, (HttpResponse) result);", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468263353", "createdAt": "2020-08-11T00:46:47Z", "author": {"login": "trask"}, "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientHelper.java", "diffHunk": "@@ -69,14 +48,15 @@ public static void doMethodExit(\n       final SpanWithScope spanWithScope, final Object result, final Throwable throwable) {\n     try {\n       Span span = spanWithScope.getSpan();\n-\n       if (result instanceof HttpResponse) {\n-        DECORATE.onResponse(span, (HttpResponse) result);\n-      } // else they probably provided a ResponseHandler.\n-\n-      DECORATE.onError(span, throwable);\n-      DECORATE.beforeFinish(span);\n-      span.end();\n+        HttpResponse response = (HttpResponse) result;\n+        TRACER.onResponse(span, response);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTY2NTk0OnYy", "diffSide": "RIGHT", "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientTracer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDo0ODo0OVrOG-kjnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNjo1MDowN1rOG_AmPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2MzgzNg==", "bodyText": "looks like this override is not needed\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n              @Override\n          \n          \n            \n              protected Span onResponse(Span span, HttpResponse httpResponse) {\n          \n          \n            \n                return super.onResponse(span, httpResponse);\n          \n          \n            \n              }", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468263836", "createdAt": "2020-08-11T00:48:49Z", "author": {"login": "trask"}, "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientTracer.java", "diffHunk": "@@ -59,8 +56,23 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpUriRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.spring-webflux-5.0\";\n+  }\n+\n+  @Override\n+  protected Span onResponse(Span span, HttpResponse httpResponse) {\n+    return super.onResponse(span, httpResponse);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODcyMzI2Mw==", "bodyText": "onResponse is called in the helper line 52.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468723263", "createdAt": "2020-08-11T16:50:07Z", "author": {"login": "heyams"}, "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientTracer.java", "diffHunk": "@@ -59,8 +56,23 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpUriRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.spring-webflux-5.0\";\n+  }\n+\n+  @Override\n+  protected Span onResponse(Span span, HttpResponse httpResponse) {\n+    return super.onResponse(span, httpResponse);\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2MzgzNg=="}, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTY4MzYxOnYy", "diffSide": "RIGHT", "path": "instrumentation/jaxrs-client/jaxrs-client-1.1/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v1_1/JaxRsClientV1Instrumentation.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMDo1ODo0M1rOG-ktfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMToyMTo1OVrOHAHNzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2NjM2Ng==", "bodyText": "i think this can use startScope\nalso, this:\nWARNING: this might be a chain...so we only have to trace the first in the chain.\n\nshouldn't be needed once this item from #912 is done:\n\nadd ClientDecorator.CONTEXT_CLIENT_SPAN_KEY to the context inside startScope", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468266366", "createdAt": "2020-08-11T00:58:43Z", "author": {"login": "trask"}, "path": "instrumentation/jaxrs-client/jaxrs-client-1.1/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v1_1/JaxRsClientV1Instrumentation.java", "diffHunk": "@@ -83,45 +81,42 @@ public JaxRsClientV1Instrumentation() {\n   public static class HandleAdvice {\n \n     @Advice.OnMethodEnter\n-    public static SpanWithScope onEnter(\n-        @Advice.Argument(0) final ClientRequest request, @Advice.This final ClientHandler thisObj) {\n+    public static void onEnter(\n+        @Advice.Argument(0) final ClientRequest request,\n+        @Advice.This final ClientHandler thisObj,\n+        @Advice.Local(\"otelSpan\") Span span,\n+        @Advice.Local(\"otelScope\") Scope scope) {\n \n       // WARNING: this might be a chain...so we only have to trace the first in the chain.\n       boolean isRootClientHandler = null == request.getProperties().get(CONTEXT_ATTRIBUTE);\n       if (isRootClientHandler) {\n-        Span span =\n-            TRACER\n-                .spanBuilder(DECORATE.spanNameForRequest(request))\n-                .setSpanKind(CLIENT)\n-                .startSpan();\n-        DECORATE.afterStart(span);\n-        DECORATE.onRequest(span, request);\n+        span = TRACER.startSpan(request);\n \n         Context context = withSpan(span, Context.current());\n         request.getProperties().put(CONTEXT_ATTRIBUTE, context);\n \n         OpenTelemetry.getPropagators()\n             .getHttpTextFormat()\n             .inject(context, request.getHeaders(), SETTER);\n-        return new SpanWithScope(span, withScopedContext(context));\n+        scope = withScopedContext(context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODcyNTcyOQ==", "bodyText": "it can't.  SETTER is HttpTextFormat.Setter MultivaluedMap type.. getSetter() supports HttpTextFormat.Setter REQUEST.\nThis is the issue i brought up in the very first PR.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468725729", "createdAt": "2020-08-11T16:54:03Z", "author": {"login": "heyams"}, "path": "instrumentation/jaxrs-client/jaxrs-client-1.1/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v1_1/JaxRsClientV1Instrumentation.java", "diffHunk": "@@ -83,45 +81,42 @@ public JaxRsClientV1Instrumentation() {\n   public static class HandleAdvice {\n \n     @Advice.OnMethodEnter\n-    public static SpanWithScope onEnter(\n-        @Advice.Argument(0) final ClientRequest request, @Advice.This final ClientHandler thisObj) {\n+    public static void onEnter(\n+        @Advice.Argument(0) final ClientRequest request,\n+        @Advice.This final ClientHandler thisObj,\n+        @Advice.Local(\"otelSpan\") Span span,\n+        @Advice.Local(\"otelScope\") Scope scope) {\n \n       // WARNING: this might be a chain...so we only have to trace the first in the chain.\n       boolean isRootClientHandler = null == request.getProperties().get(CONTEXT_ATTRIBUTE);\n       if (isRootClientHandler) {\n-        Span span =\n-            TRACER\n-                .spanBuilder(DECORATE.spanNameForRequest(request))\n-                .setSpanKind(CLIENT)\n-                .startSpan();\n-        DECORATE.afterStart(span);\n-        DECORATE.onRequest(span, request);\n+        span = TRACER.startSpan(request);\n \n         Context context = withSpan(span, Context.current());\n         request.getProperties().put(CONTEXT_ATTRIBUTE, context);\n \n         OpenTelemetry.getPropagators()\n             .getHttpTextFormat()\n             .inject(context, request.getHeaders(), SETTER);\n-        return new SpanWithScope(span, withScopedContext(context));\n+        scope = withScopedContext(context);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2NjM2Ng=="}, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg4MDI2OA==", "bodyText": "But you can make io.opentelemetry.auto.instrumentation.jaxrsclient.v1_1.InjectAdapter implements HttpTextFormat.Setter<ClientRequest>.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469880268", "createdAt": "2020-08-13T11:21:59Z", "author": {"login": "iNikem"}, "path": "instrumentation/jaxrs-client/jaxrs-client-1.1/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v1_1/JaxRsClientV1Instrumentation.java", "diffHunk": "@@ -83,45 +81,42 @@ public JaxRsClientV1Instrumentation() {\n   public static class HandleAdvice {\n \n     @Advice.OnMethodEnter\n-    public static SpanWithScope onEnter(\n-        @Advice.Argument(0) final ClientRequest request, @Advice.This final ClientHandler thisObj) {\n+    public static void onEnter(\n+        @Advice.Argument(0) final ClientRequest request,\n+        @Advice.This final ClientHandler thisObj,\n+        @Advice.Local(\"otelSpan\") Span span,\n+        @Advice.Local(\"otelScope\") Scope scope) {\n \n       // WARNING: this might be a chain...so we only have to trace the first in the chain.\n       boolean isRootClientHandler = null == request.getProperties().get(CONTEXT_ATTRIBUTE);\n       if (isRootClientHandler) {\n-        Span span =\n-            TRACER\n-                .spanBuilder(DECORATE.spanNameForRequest(request))\n-                .setSpanKind(CLIENT)\n-                .startSpan();\n-        DECORATE.afterStart(span);\n-        DECORATE.onRequest(span, request);\n+        span = TRACER.startSpan(request);\n \n         Context context = withSpan(span, Context.current());\n         request.getProperties().put(CONTEXT_ATTRIBUTE, context);\n \n         OpenTelemetry.getPropagators()\n             .getHttpTextFormat()\n             .inject(context, request.getHeaders(), SETTER);\n-        return new SpanWithScope(span, withScopedContext(context));\n+        scope = withScopedContext(context);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2NjM2Ng=="}, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTY4NjQwOnYy", "diffSide": "RIGHT", "path": "instrumentation/kubernetes-client-7.0/src/main/java/io/opentelemetry/auto/instrumentation/kubernetesclient/KubernetesClientTracer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMTowMDoxMFrOG-kvDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNzoxNjo0NFrOG_Bkew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2Njc2Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n              @Override\n          \n          \n            \n              protected Span onRequest(Span span, Request request) {\n          \n          \n            \n                return super.onRequest(span, request);\n          \n          \n            \n              }", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468266767", "createdAt": "2020-08-11T01:00:10Z", "author": {"login": "trask"}, "path": "instrumentation/kubernetes-client-7.0/src/main/java/io/opentelemetry/auto/instrumentation/kubernetesclient/KubernetesClientTracer.java", "diffHunk": "@@ -53,4 +52,32 @@ protected String requestHeader(Request request, String name) {\n   protected String responseHeader(Response response, String name) {\n     return response.header(name);\n   }\n+\n+  @Override\n+  protected Setter<Request> getSetter() {\n+    return null;\n+  }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.kubernetes-client-7.0\";\n+  }\n+\n+  @Override\n+  protected Span onRequest(Span span, Request request) {\n+    return super.onRequest(span, request);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODczOTE5NQ==", "bodyText": "This is called by TracingInterceptor.java line 38.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r468739195", "createdAt": "2020-08-11T17:16:44Z", "author": {"login": "heyams"}, "path": "instrumentation/kubernetes-client-7.0/src/main/java/io/opentelemetry/auto/instrumentation/kubernetesclient/KubernetesClientTracer.java", "diffHunk": "@@ -53,4 +52,32 @@ protected String requestHeader(Request request, String name) {\n   protected String responseHeader(Response response, String name) {\n     return response.header(name);\n   }\n+\n+  @Override\n+  protected Setter<Request> getSetter() {\n+    return null;\n+  }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.kubernetes-client-7.0\";\n+  }\n+\n+  @Override\n+  protected Span onRequest(Span span, Request request) {\n+    return super.onRequest(span, request);\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2Njc2Nw=="}, "originalCommit": {"oid": "df2c8a647cd0441bd5b18004c5346143f4e8fc5d"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMzIzMjcxOnYy", "diffSide": "RIGHT", "path": "instrumentation/spring-webflux-5.0/src/main/java/io/opentelemetry/auto/instrumentation/spring/webflux/client/WebClientFilterInstrumentation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzo1NDoyMlrOG_sQdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNzo1NDoyMlrOG_sQdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQzODU4Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  \"io.opentelemetry.instrumentation.springwebflux.client.SpringWebfluxHttpClientTracer\",\n          \n          \n            \n                  \"io.opentelemetry.instrumentation.springwebflux.client.HttpHeadersInjectAdapter\",\n          \n          \n            \n                  \"io.opentelemetry.instrumentation.springwebflux.client.WebClientTracingFilter\"\n          \n          \n            \n                  \"io.opentelemetry.instrumentation.spring.webflux.client.SpringWebfluxHttpClientTracer\",\n          \n          \n            \n                  \"io.opentelemetry.instrumentation.spring.webflux.client.HttpHeadersInjectAdapter\",\n          \n          \n            \n                  \"io.opentelemetry.instrumentation.spring.webflux.client.WebClientTracingFilter\"", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469438582", "createdAt": "2020-08-12T17:54:22Z", "author": {"login": "trask"}, "path": "instrumentation/spring-webflux-5.0/src/main/java/io/opentelemetry/auto/instrumentation/spring/webflux/client/WebClientFilterInstrumentation.java", "diffHunk": "@@ -46,9 +46,9 @@ public WebClientFilterInstrumentation() {\n   @Override\n   public String[] helperClassNames() {\n     return new String[] {\n-      \"io.opentelemetry.instrumentation.spring.webflux.client.SpringWebfluxHttpClientDecorator\",\n-      \"io.opentelemetry.instrumentation.spring.webflux.client.HttpHeadersInjectAdapter\",\n-      \"io.opentelemetry.instrumentation.spring.webflux.client.WebClientTracingFilter\"\n+      \"io.opentelemetry.instrumentation.springwebflux.client.SpringWebfluxHttpClientTracer\",\n+      \"io.opentelemetry.instrumentation.springwebflux.client.HttpHeadersInjectAdapter\",\n+      \"io.opentelemetry.instrumentation.springwebflux.client.WebClientTracingFilter\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccef511e3143d2a82d6ee6fa1a7d8b5944766966"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMzI4NTkwOnYy", "diffSide": "RIGHT", "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowOTo1OFrOG_sypg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODowOTo1OFrOG_sypg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ0NzMzNA==", "bodyText": "these look unused", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469447334", "createdAt": "2020-08-12T18:09:58Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "diffHunk": "@@ -71,4 +68,28 @@ protected String responseHeader(ClientResponse clientResponse, String name) {\n     List<String> headers = clientResponse.headers().header(name);\n     return !headers.isEmpty() ? headers.get(0) : null;\n   }\n+\n+  @Override\n+  protected Setter<ClientRequest> getSetter() {\n+    return null;\n+  }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.spring-webflux-5.0\";\n+  }\n+\n+  @Override\n+  protected Span onRequest(Span span, ClientRequest clientRequest) {\n+    return super.onRequest(span, clientRequest);\n+  }\n+\n+  @Override\n+  protected String spanNameForRequest(ClientRequest clientRequest) {\n+    return super.spanNameForRequest(clientRequest);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ccef511e3143d2a82d6ee6fa1a7d8b5944766966"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMzM2NzE2OnYy", "diffSide": "RIGHT", "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODozMjo1NlrOG_tldQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxODozMjo1NlrOG_tldQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ2MDM0MQ==", "bodyText": "we will get rid of this soon, you can accept heyams#1, or i can send that in as separate PR after your PR", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469460341", "createdAt": "2020-08-12T18:32:56Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "diffHunk": "@@ -71,4 +68,18 @@ protected String responseHeader(ClientResponse clientResponse, String name) {\n     List<String> headers = clientResponse.headers().header(name);\n     return !headers.isEmpty() ? headers.get(0) : null;\n   }\n+\n+  @Override\n+  protected Setter<ClientRequest> getSetter() {\n+    return null;\n+  }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.spring-webflux-5.0\";\n+  }\n+\n+  public Tracer getTracer() {\n+    return tracer;\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77d2bcc7d071453e5336af03de6fe727142917cc"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNDg4Nzg5OnYy", "diffSide": "RIGHT", "path": "instrumentation-core/spring/spring-web-3.1/src/main/java/io/opentelemetry/instrumentation/spring/httpclients/RestTemplateInterceptor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNDo0MjozN1rOG_7yEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNDo0MjozN1rOG_7yEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY5Mjk0Nw==", "bodyText": "Think we're not supposed to have this per #921 (though we can delete at the same time so no worries)", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469692947", "createdAt": "2020-08-13T04:42:37Z", "author": {"login": "anuraaga"}, "path": "instrumentation-core/spring/spring-web-3.1/src/main/java/io/opentelemetry/instrumentation/spring/httpclients/RestTemplateInterceptor.java", "diffHunk": "@@ -33,26 +32,19 @@\n \n   private final Tracer tracer;\n \n-  public RestTemplateInterceptor(Tracer tracer) {\n+  public RestTemplateInterceptor(final Tracer tracer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNDg4OTI1OnYy", "diffSide": "RIGHT", "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNDo0MzozN1rOG_7y8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODo0MDo0NFrOHAYxJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY5MzE3MQ==", "bodyText": "Hmm - I'm sensing something wrong with our API if we have to skip it so many times (thought for broader discussion, not an issue with this PR)", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469693171", "createdAt": "2020-08-13T04:43:37Z", "author": {"login": "anuraaga"}, "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "diffHunk": "@@ -71,4 +68,18 @@ protected String responseHeader(ClientResponse clientResponse, String name) {\n     List<String> headers = clientResponse.headers().header(name);\n     return !headers.isEmpty() ? headers.get(0) : null;\n   }\n+\n+  @Override\n+  protected Setter<ClientRequest> getSetter() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg2ODM1OA==", "bodyText": "But why to you return null if io.opentelemetry.instrumentation.spring.webflux.client.HttpHeadersInjectAdapter.SETTER was used before?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469868358", "createdAt": "2020-08-13T10:56:30Z", "author": {"login": "iNikem"}, "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "diffHunk": "@@ -71,4 +68,18 @@ protected String responseHeader(ClientResponse clientResponse, String name) {\n     List<String> headers = clientResponse.headers().header(name);\n     return !headers.isEmpty() ? headers.get(0) : null;\n   }\n+\n+  @Override\n+  protected Setter<ClientRequest> getSetter() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY5MzE3MQ=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NTczNg==", "bodyText": "Updated the adpater to be httpformat.setter.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470085736", "createdAt": "2020-08-13T16:44:35Z", "author": {"login": "heyams"}, "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "diffHunk": "@@ -71,4 +68,18 @@ protected String responseHeader(ClientResponse clientResponse, String name) {\n     List<String> headers = clientResponse.headers().header(name);\n     return !headers.isEmpty() ? headers.get(0) : null;\n   }\n+\n+  @Override\n+  protected Setter<ClientRequest> getSetter() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY5MzE3MQ=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE2NjI0Mg==", "bodyText": "@iNikem we could make the HttpHeadersInjectAdapter implement HttpTextFormat.Setter<ClientRequest.Builder>, and add a third generic type to HttpClientTracer, maybe named HEADERS? this 3rd generic type might solve similar issue in a couple other places too. i'll log an issue for the getSetter() not working as broadly as we would like currently", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470166242", "createdAt": "2020-08-13T18:37:58Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "diffHunk": "@@ -71,4 +68,18 @@ protected String responseHeader(ClientResponse clientResponse, String name) {\n     List<String> headers = clientResponse.headers().header(name);\n     return !headers.isEmpty() ? headers.get(0) : null;\n   }\n+\n+  @Override\n+  protected Setter<ClientRequest> getSetter() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY5MzE3MQ=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE2Nzg0Ng==", "bodyText": "#964", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470167846", "createdAt": "2020-08-13T18:40:44Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-webflux-5.0/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "diffHunk": "@@ -71,4 +68,18 @@ protected String responseHeader(ClientResponse clientResponse, String name) {\n     List<String> headers = clientResponse.headers().header(name);\n     return !headers.isEmpty() ? headers.get(0) : null;\n   }\n+\n+  @Override\n+  protected Setter<ClientRequest> getSetter() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY5MzE3MQ=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNDg5NDUyOnYy", "diffSide": "RIGHT", "path": "instrumentation/apache-httpasyncclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpasyncclient/ApacheHttpAsyncClientTracer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNDo0NjozOFrOG_72Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0Mzo0MlrOHATuhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY5Mzk1NA==", "bodyText": "The funny thing about protected methods is unless we make them final they may as well be public :P", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469693954", "createdAt": "2020-08-13T04:46:38Z", "author": {"login": "anuraaga"}, "path": "instrumentation/apache-httpasyncclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpasyncclient/ApacheHttpAsyncClientTracer.java", "diffHunk": "@@ -78,8 +77,38 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.apache-httpasyncclient-4.0\";\n+  }\n+\n+  /**\n+   * This method is used to generate an acceptable CLIENT span (operation) name based on a given\n+   * name.\n+   */\n+  @Override\n+  public Span startSpan(String spanName) {\n+    return tracer.spanBuilder(spanName).setSpanKind(Kind.CLIENT).startSpan();\n+  }\n+\n+  @Override\n+  public String spanNameForRequest(HttpRequest httpRequest) {\n+    return super.spanNameForRequest(httpRequest);\n+  }\n+\n+  /** This method is overridden to allow other classes in this package to call it. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NTI1Mg==", "bodyText": "It's error prone to make it public in the super class.. user might call startSpan and then onRequest again.  in that case, onRequest will get invoked twice.  besides there are only a couple of places need to do this.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470085252", "createdAt": "2020-08-13T16:43:42Z", "author": {"login": "heyams"}, "path": "instrumentation/apache-httpasyncclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpasyncclient/ApacheHttpAsyncClientTracer.java", "diffHunk": "@@ -78,8 +77,38 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.apache-httpasyncclient-4.0\";\n+  }\n+\n+  /**\n+   * This method is used to generate an acceptable CLIENT span (operation) name based on a given\n+   * name.\n+   */\n+  @Override\n+  public Span startSpan(String spanName) {\n+    return tracer.spanBuilder(spanName).setSpanKind(Kind.CLIENT).startSpan();\n+  }\n+\n+  @Override\n+  public String spanNameForRequest(HttpRequest httpRequest) {\n+    return super.spanNameForRequest(httpRequest);\n+  }\n+\n+  /** This method is overridden to allow other classes in this package to call it. */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY5Mzk1NA=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjA3NjMzOnYy", "diffSide": "LEFT", "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientHelper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMToxMDo0MlrOHAG5cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjozMjoyOVrOHATUfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3NTA1OA==", "bodyText": "Where is this inject now?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469875058", "createdAt": "2020-08-13T11:10:42Z", "author": {"login": "iNikem"}, "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientHelper.java", "diffHunk": "@@ -16,42 +16,21 @@\n \n package io.opentelemetry.auto.instrumentation.apachehttpclient.v4_0;\n \n-import static io.opentelemetry.auto.instrumentation.apachehttpclient.v4_0.ApacheHttpClientDecorator.DECORATE;\n-import static io.opentelemetry.context.ContextUtils.withScopedContext;\n+import static io.opentelemetry.auto.instrumentation.apachehttpclient.v4_0.ApacheHttpClientTracer.TRACER;\n \n-import io.grpc.Context;\n-import io.opentelemetry.OpenTelemetry;\n import io.opentelemetry.context.Scope;\n-import io.opentelemetry.instrumentation.api.decorator.ClientDecorator;\n import io.opentelemetry.instrumentation.auto.api.CallDepthThreadLocalMap;\n import io.opentelemetry.instrumentation.auto.api.SpanWithScope;\n import io.opentelemetry.trace.Span;\n-import io.opentelemetry.trace.Tracer;\n import org.apache.http.HttpResponse;\n import org.apache.http.client.HttpClient;\n import org.apache.http.client.methods.HttpUriRequest;\n \n public class ApacheHttpClientHelper {\n \n-  public static final Tracer TRACER =\n-      OpenTelemetry.getTracerProvider().get(\"io.opentelemetry.auto.spring-webflux-5.0\");\n-\n   public static SpanWithScope doMethodEnter(final HttpUriRequest request) {\n-    return doMethodEnter(request, TRACER);\n-  }\n-\n-  public static SpanWithScope doMethodEnter(final HttpUriRequest request, final Tracer tracer) {\n-    Span span = DECORATE.getOrCreateSpan(request, tracer);\n-\n-    DECORATE.afterStart(span);\n-    DECORATE.onRequest(span, request);\n-\n-    Context context = ClientDecorator.currentContextWith(span);\n-    if (span.getContext().isValid()) {\n-      DECORATE.inject(context, request);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA3ODU4OQ==", "bodyText": "inside startScope.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470078589", "createdAt": "2020-08-13T16:32:29Z", "author": {"login": "heyams"}, "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientHelper.java", "diffHunk": "@@ -16,42 +16,21 @@\n \n package io.opentelemetry.auto.instrumentation.apachehttpclient.v4_0;\n \n-import static io.opentelemetry.auto.instrumentation.apachehttpclient.v4_0.ApacheHttpClientDecorator.DECORATE;\n-import static io.opentelemetry.context.ContextUtils.withScopedContext;\n+import static io.opentelemetry.auto.instrumentation.apachehttpclient.v4_0.ApacheHttpClientTracer.TRACER;\n \n-import io.grpc.Context;\n-import io.opentelemetry.OpenTelemetry;\n import io.opentelemetry.context.Scope;\n-import io.opentelemetry.instrumentation.api.decorator.ClientDecorator;\n import io.opentelemetry.instrumentation.auto.api.CallDepthThreadLocalMap;\n import io.opentelemetry.instrumentation.auto.api.SpanWithScope;\n import io.opentelemetry.trace.Span;\n-import io.opentelemetry.trace.Tracer;\n import org.apache.http.HttpResponse;\n import org.apache.http.client.HttpClient;\n import org.apache.http.client.methods.HttpUriRequest;\n \n public class ApacheHttpClientHelper {\n \n-  public static final Tracer TRACER =\n-      OpenTelemetry.getTracerProvider().get(\"io.opentelemetry.auto.spring-webflux-5.0\");\n-\n   public static SpanWithScope doMethodEnter(final HttpUriRequest request) {\n-    return doMethodEnter(request, TRACER);\n-  }\n-\n-  public static SpanWithScope doMethodEnter(final HttpUriRequest request, final Tracer tracer) {\n-    Span span = DECORATE.getOrCreateSpan(request, tracer);\n-\n-    DECORATE.afterStart(span);\n-    DECORATE.onRequest(span, request);\n-\n-    Context context = ClientDecorator.currentContextWith(span);\n-    if (span.getContext().isValid()) {\n-      DECORATE.inject(context, request);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3NTA1OA=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjA3OTE1OnYy", "diffSide": "RIGHT", "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientTracer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMToxMTo0NFrOHAG7Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0ODozMlrOHAT5vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3NTQ4Nw==", "bodyText": "This name is wrong", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469875487", "createdAt": "2020-08-13T11:11:44Z", "author": {"login": "iNikem"}, "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientTracer.java", "diffHunk": "@@ -59,8 +56,24 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpUriRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.spring-webflux-5.0\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MDM1OA==", "bodyText": "FYI this is not a new name.  It exists like this before.  what should the new name be if you think it's not right?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470080358", "createdAt": "2020-08-13T16:35:25Z", "author": {"login": "heyams"}, "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientTracer.java", "diffHunk": "@@ -59,8 +56,24 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpUriRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.spring-webflux-5.0\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3NTQ4Nw=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4ODEyNw==", "bodyText": "This is ApacheHttpClientTracer. So name could be io.opentelemetry.auto.apache-http-client", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470088127", "createdAt": "2020-08-13T16:48:32Z", "author": {"login": "iNikem"}, "path": "instrumentation/apache-httpclient/apache-httpclient-4.0/src/main/java/io/opentelemetry/auto/instrumentation/apachehttpclient/v4_0/ApacheHttpClientTracer.java", "diffHunk": "@@ -59,8 +56,24 @@ protected String responseHeader(HttpResponse response, String name) {\n     return header(response, name);\n   }\n \n+  @Override\n+  protected Setter<HttpUriRequest> getSetter() {\n+    return SETTER;\n+  }\n+\n   private static String header(HttpMessage message, String name) {\n     Header header = message.getFirstHeader(name);\n     return header != null ? header.getValue() : null;\n   }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.spring-webflux-5.0\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3NTQ4Nw=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjA4NjcxOnYy", "diffSide": "RIGHT", "path": "instrumentation/aws-sdk/aws-sdk-1.11/src/main/java/io/opentelemetry/auto/instrumentation/awssdk/v1_11/AwsSdkClientTracer.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMToxNDoyMVrOHAG_tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1MzoyNlrOHAXGEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3NjY2MA==", "bodyText": "Still don't understand why do we do something extra to avoid it.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469876660", "createdAt": "2020-08-13T11:14:21Z", "author": {"login": "iNikem"}, "path": "instrumentation/aws-sdk/aws-sdk-1.11/src/main/java/io/opentelemetry/auto/instrumentation/awssdk/v1_11/AwsSdkClientTracer.java", "diffHunk": "@@ -64,20 +65,27 @@ public Span onRequest(final Span span, final Request<?> request) {\n     span.setAttribute(\"aws.operation\", awsOperation.getSimpleName());\n     span.setAttribute(\"aws.endpoint\", request.getEndpoint().toString());\n \n-    if (contextStore != null) {\n-      RequestMeta requestMeta = contextStore.get(originalRequest);\n-      if (requestMeta != null) {\n-        span.setAttribute(\"aws.bucket.name\", requestMeta.getBucketName());\n-        span.setAttribute(\"aws.queue.url\", requestMeta.getQueueUrl());\n-        span.setAttribute(\"aws.queue.name\", requestMeta.getQueueName());\n-        span.setAttribute(\"aws.stream.name\", requestMeta.getStreamName());\n-        span.setAttribute(\"aws.table.name\", requestMeta.getTableName());\n-      }\n+    if (requestMeta != null) {\n+      span.setAttribute(\"aws.bucket.name\", requestMeta.getBucketName());\n+      span.setAttribute(\"aws.queue.url\", requestMeta.getQueueUrl());\n+      span.setAttribute(\"aws.queue.name\", requestMeta.getQueueName());\n+      span.setAttribute(\"aws.stream.name\", requestMeta.getStreamName());\n+      span.setAttribute(\"aws.table.name\", requestMeta.getTableName());\n     }\n-\n     return span;\n   }\n \n+  /**\n+   * Override startScope not to inject context into the request since no need to propagate context", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MTM1OQ==", "bodyText": "super class's startScope will do 2 things.. get the span and then inject the context into the request.  this is not needed for aws sdk tracer.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470081359", "createdAt": "2020-08-13T16:37:08Z", "author": {"login": "heyams"}, "path": "instrumentation/aws-sdk/aws-sdk-1.11/src/main/java/io/opentelemetry/auto/instrumentation/awssdk/v1_11/AwsSdkClientTracer.java", "diffHunk": "@@ -64,20 +65,27 @@ public Span onRequest(final Span span, final Request<?> request) {\n     span.setAttribute(\"aws.operation\", awsOperation.getSimpleName());\n     span.setAttribute(\"aws.endpoint\", request.getEndpoint().toString());\n \n-    if (contextStore != null) {\n-      RequestMeta requestMeta = contextStore.get(originalRequest);\n-      if (requestMeta != null) {\n-        span.setAttribute(\"aws.bucket.name\", requestMeta.getBucketName());\n-        span.setAttribute(\"aws.queue.url\", requestMeta.getQueueUrl());\n-        span.setAttribute(\"aws.queue.name\", requestMeta.getQueueName());\n-        span.setAttribute(\"aws.stream.name\", requestMeta.getStreamName());\n-        span.setAttribute(\"aws.table.name\", requestMeta.getTableName());\n-      }\n+    if (requestMeta != null) {\n+      span.setAttribute(\"aws.bucket.name\", requestMeta.getBucketName());\n+      span.setAttribute(\"aws.queue.url\", requestMeta.getQueueUrl());\n+      span.setAttribute(\"aws.queue.name\", requestMeta.getQueueName());\n+      span.setAttribute(\"aws.stream.name\", requestMeta.getStreamName());\n+      span.setAttribute(\"aws.table.name\", requestMeta.getTableName());\n     }\n-\n     return span;\n   }\n \n+  /**\n+   * Override startScope not to inject context into the request since no need to propagate context", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3NjY2MA=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEzMDc0OA==", "bodyText": "That's precisely what I don't understand: why do we want to avoid injecting trace context headers into AWS SDK requests? Even if in most cases nobody will consume them, what bad will happen if we do inject them? Is it worth making our code more complicated?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470130748", "createdAt": "2020-08-13T17:40:24Z", "author": {"login": "iNikem"}, "path": "instrumentation/aws-sdk/aws-sdk-1.11/src/main/java/io/opentelemetry/auto/instrumentation/awssdk/v1_11/AwsSdkClientTracer.java", "diffHunk": "@@ -64,20 +65,27 @@ public Span onRequest(final Span span, final Request<?> request) {\n     span.setAttribute(\"aws.operation\", awsOperation.getSimpleName());\n     span.setAttribute(\"aws.endpoint\", request.getEndpoint().toString());\n \n-    if (contextStore != null) {\n-      RequestMeta requestMeta = contextStore.get(originalRequest);\n-      if (requestMeta != null) {\n-        span.setAttribute(\"aws.bucket.name\", requestMeta.getBucketName());\n-        span.setAttribute(\"aws.queue.url\", requestMeta.getQueueUrl());\n-        span.setAttribute(\"aws.queue.name\", requestMeta.getQueueName());\n-        span.setAttribute(\"aws.stream.name\", requestMeta.getStreamName());\n-        span.setAttribute(\"aws.table.name\", requestMeta.getTableName());\n-      }\n+    if (requestMeta != null) {\n+      span.setAttribute(\"aws.bucket.name\", requestMeta.getBucketName());\n+      span.setAttribute(\"aws.queue.url\", requestMeta.getQueueUrl());\n+      span.setAttribute(\"aws.queue.name\", requestMeta.getQueueName());\n+      span.setAttribute(\"aws.stream.name\", requestMeta.getStreamName());\n+      span.setAttribute(\"aws.table.name\", requestMeta.getTableName());\n     }\n-\n     return span;\n   }\n \n+  /**\n+   * Override startScope not to inject context into the request since no need to propagate context", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3NjY2MA=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MDQzMg==", "bodyText": "that's not my decision.. it was like that before.  please talk to the creator of aws sdk decorator.  it's out of scope for this pr anyway.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470140432", "createdAt": "2020-08-13T17:53:26Z", "author": {"login": "heyams"}, "path": "instrumentation/aws-sdk/aws-sdk-1.11/src/main/java/io/opentelemetry/auto/instrumentation/awssdk/v1_11/AwsSdkClientTracer.java", "diffHunk": "@@ -64,20 +65,27 @@ public Span onRequest(final Span span, final Request<?> request) {\n     span.setAttribute(\"aws.operation\", awsOperation.getSimpleName());\n     span.setAttribute(\"aws.endpoint\", request.getEndpoint().toString());\n \n-    if (contextStore != null) {\n-      RequestMeta requestMeta = contextStore.get(originalRequest);\n-      if (requestMeta != null) {\n-        span.setAttribute(\"aws.bucket.name\", requestMeta.getBucketName());\n-        span.setAttribute(\"aws.queue.url\", requestMeta.getQueueUrl());\n-        span.setAttribute(\"aws.queue.name\", requestMeta.getQueueName());\n-        span.setAttribute(\"aws.stream.name\", requestMeta.getStreamName());\n-        span.setAttribute(\"aws.table.name\", requestMeta.getTableName());\n-      }\n+    if (requestMeta != null) {\n+      span.setAttribute(\"aws.bucket.name\", requestMeta.getBucketName());\n+      span.setAttribute(\"aws.queue.url\", requestMeta.getQueueUrl());\n+      span.setAttribute(\"aws.queue.name\", requestMeta.getQueueName());\n+      span.setAttribute(\"aws.stream.name\", requestMeta.getStreamName());\n+      span.setAttribute(\"aws.table.name\", requestMeta.getTableName());\n     }\n-\n     return span;\n   }\n \n+  /**\n+   * Override startScope not to inject context into the request since no need to propagate context", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3NjY2MA=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjEwMDk3OnYy", "diffSide": "RIGHT", "path": "instrumentation/jaxrs-client/jaxrs-client-2.0/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v2_0/JaxRsClientTracer.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMToxODo1MVrOHAHIGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODoyMDoyNFrOHAYEfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3ODgxMQ==", "bodyText": "There io.opentelemetry.auto.instrumentation.jaxrsclient.v2_0.InjectAdapter.SETTER, why do you return null?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469878811", "createdAt": "2020-08-13T11:18:51Z", "author": {"login": "iNikem"}, "path": "instrumentation/jaxrs-client/jaxrs-client-2.0/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v2_0/JaxRsClientTracer.java", "diffHunk": "@@ -54,4 +50,14 @@ protected String requestHeader(ClientRequestContext clientRequestContext, String\n   protected String responseHeader(ClientResponseContext clientResponseContext, String name) {\n     return clientResponseContext.getHeaderString(name);\n   }\n+\n+  @Override\n+  protected Setter<ClientRequestContext> getSetter() {\n+    return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MjQyNQ==", "bodyText": "HttpTextFormat.Setter.  JaxRsClientTracer has 'ClientRequestContext' request type.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470082425", "createdAt": "2020-08-13T16:39:00Z", "author": {"login": "heyams"}, "path": "instrumentation/jaxrs-client/jaxrs-client-2.0/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v2_0/JaxRsClientTracer.java", "diffHunk": "@@ -54,4 +50,14 @@ protected String requestHeader(ClientRequestContext clientRequestContext, String\n   protected String responseHeader(ClientResponseContext clientResponseContext, String name) {\n     return clientResponseContext.getHeaderString(name);\n   }\n+\n+  @Override\n+  protected Setter<ClientRequestContext> getSetter() {\n+    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3ODgxMQ=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEzMTUxOQ==", "bodyText": "As in case of version 1 below, you can change SETTER", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470131519", "createdAt": "2020-08-13T17:41:15Z", "author": {"login": "iNikem"}, "path": "instrumentation/jaxrs-client/jaxrs-client-2.0/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v2_0/JaxRsClientTracer.java", "diffHunk": "@@ -54,4 +50,14 @@ protected String requestHeader(ClientRequestContext clientRequestContext, String\n   protected String responseHeader(ClientResponseContext clientResponseContext, String name) {\n     return clientResponseContext.getHeaderString(name);\n   }\n+\n+  @Override\n+  protected Setter<ClientRequestContext> getSetter() {\n+    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3ODgxMQ=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MTkwMg==", "bodyText": "I did try. it doesn't support clientrequestcontext.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470141902", "createdAt": "2020-08-13T17:55:31Z", "author": {"login": "heyams"}, "path": "instrumentation/jaxrs-client/jaxrs-client-2.0/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v2_0/JaxRsClientTracer.java", "diffHunk": "@@ -54,4 +50,14 @@ protected String requestHeader(ClientRequestContext clientRequestContext, String\n   protected String responseHeader(ClientResponseContext clientResponseContext, String name) {\n     return clientResponseContext.getHeaderString(name);\n   }\n+\n+  @Override\n+  protected Setter<ClientRequestContext> getSetter() {\n+    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3ODgxMQ=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MjU3Ng==", "bodyText": "by the way return null in many other places too.  @anuraaga insisted to make this method abstract that's why it returns null for tracers that don't apply to the setter type.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470142576", "createdAt": "2020-08-13T17:56:35Z", "author": {"login": "heyams"}, "path": "instrumentation/jaxrs-client/jaxrs-client-2.0/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v2_0/JaxRsClientTracer.java", "diffHunk": "@@ -54,4 +50,14 @@ protected String requestHeader(ClientRequestContext clientRequestContext, String\n   protected String responseHeader(ClientResponseContext clientResponseContext, String name) {\n     return clientResponseContext.getHeaderString(name);\n   }\n+\n+  @Override\n+  protected Setter<ClientRequestContext> getSetter() {\n+    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3ODgxMQ=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1NjQxMg==", "bodyText": "i think you can do the same thing here that you did for v1.1: 6702d6a", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470156412", "createdAt": "2020-08-13T18:20:24Z", "author": {"login": "trask"}, "path": "instrumentation/jaxrs-client/jaxrs-client-2.0/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v2_0/JaxRsClientTracer.java", "diffHunk": "@@ -54,4 +50,14 @@ protected String requestHeader(ClientRequestContext clientRequestContext, String\n   protected String responseHeader(ClientResponseContext clientResponseContext, String name) {\n     return clientResponseContext.getHeaderString(name);\n   }\n+\n+  @Override\n+  protected Setter<ClientRequestContext> getSetter() {\n+    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg3ODgxMQ=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNjEzMTAyOnYy", "diffSide": "RIGHT", "path": "instrumentation/kubernetes-client-7.0/src/main/java/io/opentelemetry/auto/instrumentation/kubernetesclient/KubernetesClientTracer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMToyODo0N1rOHAHaRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo1MDoyM1rOHAT97A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg4MzQ2MQ==", "bodyText": "You don't need so much customisations here. You can use startSpan(Request) from the superclass. Override spanNameForRequest to get digest. You may need to override startSpan(Request) to add these two attributes from digest.\nThis also will remove the need to make onRequest public and to call it manually.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r469883461", "createdAt": "2020-08-13T11:28:47Z", "author": {"login": "iNikem"}, "path": "instrumentation/kubernetes-client-7.0/src/main/java/io/opentelemetry/auto/instrumentation/kubernetesclient/KubernetesClientTracer.java", "diffHunk": "@@ -53,4 +52,33 @@ protected String requestHeader(Request request, String name) {\n   protected String responseHeader(Response response, String name) {\n     return response.header(name);\n   }\n+\n+  @Override\n+  protected Setter<Request> getSetter() {\n+    return null;\n+  }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.kubernetes-client-7.0\";\n+  }\n+\n+  /** This method is overridden to allow other classes in this package to call it. */\n+  @Override\n+  protected Span onRequest(Span span, Request request) {\n+    return super.onRequest(span, request);\n+  }\n+\n+  /**\n+   * This method is used to generate an acceptable CLIENT span (operation) name based on a given\n+   * KubernetesRequestDigest.\n+   */\n+  public Span startSpan(KubernetesRequestDigest digest) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4OTE5Ng==", "bodyText": "this is old code.  If we want to refactor it, i can add it to the todo list.  It can be on a separate PR.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470089196", "createdAt": "2020-08-13T16:50:23Z", "author": {"login": "heyams"}, "path": "instrumentation/kubernetes-client-7.0/src/main/java/io/opentelemetry/auto/instrumentation/kubernetesclient/KubernetesClientTracer.java", "diffHunk": "@@ -53,4 +52,33 @@ protected String requestHeader(Request request, String name) {\n   protected String responseHeader(Response response, String name) {\n     return response.header(name);\n   }\n+\n+  @Override\n+  protected Setter<Request> getSetter() {\n+    return null;\n+  }\n+\n+  @Override\n+  protected String getInstrumentationName() {\n+    return \"io.opentelemetry.auto.kubernetes-client-7.0\";\n+  }\n+\n+  /** This method is overridden to allow other classes in this package to call it. */\n+  @Override\n+  protected Span onRequest(Span span, Request request) {\n+    return super.onRequest(span, request);\n+  }\n+\n+  /**\n+   * This method is used to generate an acceptable CLIENT span (operation) name based on a given\n+   * KubernetesRequestDigest.\n+   */\n+  public Span startSpan(KubernetesRequestDigest digest) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg4MzQ2MQ=="}, "originalCommit": {"oid": "68622854118c408ae5ec24cc1a10764ef955ef7b"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNzc4NTQyOnYy", "diffSide": "RIGHT", "path": "instrumentation/jaxrs-client/jaxrs-client-1.1/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v1_1/JaxRsClientV1Instrumentation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1NDoyM1rOHAXIhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1NDoyM1rOHAXIhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MTA2MA==", "bodyText": "i think still need the scope != null here, until we do #912 (comment)", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/922#discussion_r470141060", "createdAt": "2020-08-13T17:54:23Z", "author": {"login": "trask"}, "path": "instrumentation/jaxrs-client/jaxrs-client-1.1/src/main/java/io/opentelemetry/auto/instrumentation/jaxrsclient/v1_1/JaxRsClientV1Instrumentation.java", "diffHunk": "@@ -108,9 +96,7 @@ public static void onExit(\n         @Advice.Thrown final Throwable throwable,\n         @Advice.Local(\"otelSpan\") Span span,\n         @Advice.Local(\"otelScope\") Scope scope) {\n-      if (scope != null) {\n-        scope.close();\n-      }\n+      scope.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6702d6a729d94bde3d6e7daa78d5ce844c0bb5a5"}, "originalPosition": 47}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4997, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}