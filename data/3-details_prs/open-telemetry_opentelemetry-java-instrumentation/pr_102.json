{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4MzkzMDI2", "number": 102, "title": "Change netty-*, play-*, rabbitmq, ratpack, rmi, jms instrumentation to use OpenTelemetry API directly", "bodyText": "Closes #97, #98, #99, #100, #101, #102", "createdAt": "2020-01-29T06:24:44Z", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/102", "merged": true, "mergeCommit": {"oid": "e4b8c579b226757a1f43dc9cd7a5414e959f531b"}, "closed": true, "closedAt": "2020-01-29T19:19:24Z", "author": {"login": "trask"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-5170AH2gAyMzY4MzkzMDI2OmUyZDgzZmUxYjg2OTk2ZmU5MjM3MjQ4ZGYwNzNhZmRhMmQxZDBlNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_KehmgFqTM1MDMyNDgzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e2d83fe1b86996fe9237248df073afda2d1d0e58", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e2d83fe1b86996fe9237248df073afda2d1d0e58", "committedDate": "2020-01-28T23:21:44Z", "message": "Fix gRPC conversion to OpenTelemetry API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc38d599094a9b4e57ad81b08d120f1409dba9ab", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/dc38d599094a9b4e57ad81b08d120f1409dba9ab", "committedDate": "2020-01-28T23:21:44Z", "message": "Fix Akka conversion to OpenTelemetry API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "801b5a289205b2fb00009fa0e46230eece03cac9", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/801b5a289205b2fb00009fa0e46230eece03cac9", "committedDate": "2020-01-28T23:21:44Z", "message": "Convert JMS to use OpenTelemetry API directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1d0437b7171b56d1144713ffb6f66e15ffdd790", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c1d0437b7171b56d1144713ffb6f66e15ffdd790", "committedDate": "2020-01-29T04:04:50Z", "message": "Convert Netty 4.0 to use OpenTelemetry API directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42ab5ec96a692c9e51dba816a41309723439ff2d", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/42ab5ec96a692c9e51dba816a41309723439ff2d", "committedDate": "2020-01-29T04:17:00Z", "message": "Convert Netty 4.1 to use OpenTelemetry API directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcb6728901e467eec8509bc4edace8b340003b0e", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/fcb6728901e467eec8509bc4edace8b340003b0e", "committedDate": "2020-01-29T04:41:24Z", "message": "Convert Play 2.4 to use OpenTelemetry API directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f948ef0a6d45265074b0658ee0f19ce794e64b07", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/f948ef0a6d45265074b0658ee0f19ce794e64b07", "committedDate": "2020-01-29T04:41:37Z", "message": "Convert Play 2.6 to use OpenTelemetry API directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08413626fb37175e2706ce483dda180fc0b48874", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/08413626fb37175e2706ce483dda180fc0b48874", "committedDate": "2020-01-29T04:47:37Z", "message": "Convert Play WS 1 to use OpenTelemetry API directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bc68d50d949cc664674b91ab65614d015e4fe0f", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2bc68d50d949cc664674b91ab65614d015e4fe0f", "committedDate": "2020-01-29T04:47:53Z", "message": "Convert Play WS 2 to use OpenTelemetry API directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50eb0e5fa5774a12b177c4370ff3758f71140447", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/50eb0e5fa5774a12b177c4370ff3758f71140447", "committedDate": "2020-01-29T04:50:01Z", "message": "Convert Play WS 2.1 to use OpenTelemetry API directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b00165861b5f33d6d393686ec1a06c23f328882", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/6b00165861b5f33d6d393686ec1a06c23f328882", "committedDate": "2020-01-29T05:23:59Z", "message": "Convert RabbitMQ to use OpenTelemetry API directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a231c882993b6b1de1c56627d271542ff68f230a", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a231c882993b6b1de1c56627d271542ff68f230a", "committedDate": "2020-01-29T06:06:46Z", "message": "Convert Ratpack to use OpenTelemetry API directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1afad22a9a072ea5ed75abd2ab98fcfb1fad7429", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/1afad22a9a072ea5ed75abd2ab98fcfb1fad7429", "committedDate": "2020-01-29T06:06:46Z", "message": "Convert RMI to use OpenTelemetry API directly"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMzI0ODM3", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/102#pullrequestreview-350324837", "createdAt": "2020-01-29T18:22:13Z", "commit": {"oid": "1afad22a9a072ea5ed75abd2ab98fcfb1fad7429"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxODoyMjoxM1rOFjSwGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxODoyMjozMlrOFjSwzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU1MTcwNg==", "bodyText": "static import?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/102#discussion_r372551706", "createdAt": "2020-01-29T18:22:13Z", "author": {"login": "tylerbenson"}, "path": "instrumentation/netty-4.0/src/main/java/io/opentelemetry/auto/instrumentation/netty40/ChannelFutureListenerInstrumentation.java", "diffHunk": "@@ -84,25 +82,27 @@ public static AgentScope activateScope(@Advice.Argument(0) final ChannelFuture f\n       if (cause == null) {\n         return null;\n       }\n-      final AgentSpan parentSpan =\n+      final Span parentSpan =\n           future.channel().attr(AttributeKeys.PARENT_CONNECT_SPAN_ATTRIBUTE_KEY).getAndRemove();\n       if (parentSpan == null) {\n         return null;\n       }\n-      final AgentScope parentScope = activateSpan(parentSpan, false);\n+      final Scope parentScope = NettyHttpServerDecorator.TRACER.withSpan(parentSpan);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1afad22a9a072ea5ed75abd2ab98fcfb1fad7429"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU1MTg4NA==", "bodyText": "Static import?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/102#discussion_r372551884", "createdAt": "2020-01-29T18:22:32Z", "author": {"login": "tylerbenson"}, "path": "instrumentation/netty-4.0/src/main/java/io/opentelemetry/auto/instrumentation/netty40/NettyChannelPipelineInstrumentation.java", "diffHunk": "@@ -148,9 +148,9 @@ public static void addHandler(\n   public static class ChannelPipelineConnectAdvice {\n     @Advice.OnMethodEnter\n     public static void addParentSpan(@Advice.This final ChannelPipeline pipeline) {\n-      final AgentSpan span = activeSpan();\n-      if (span != null) {\n-        final Attribute<AgentSpan> attribute =\n+      final Span span = NettyHttpServerDecorator.TRACER.getCurrentSpan();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1afad22a9a072ea5ed75abd2ab98fcfb1fad7429"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3372, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}