{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNjA5OTkx", "number": 1263, "title": "Add debugging docs", "bodyText": "Resolves #1241\nRelated to #482 cc) @anuraaga", "createdAt": "2020-09-26T18:14:21Z", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1263", "merged": true, "mergeCommit": {"oid": "42c9ee53a443de92b4c4df2fc75a9d80bdb0a415"}, "closed": true, "closedAt": "2020-09-27T19:52:55Z", "author": {"login": "pavolloffay"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMuc0LAH2gAyNDkzNjA5OTkxOjFkMjdiMTMyMzE2ZDAxODYyODhiMzM1YTE1MmNjMTIzZWZlMTg4ZTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdND7cvAH2gAyNDkzNjA5OTkxOmI4NWVlMTZjYTE4MTY1NjcwMGQxODlmZGIxZjgzNWU1YTE3Zjg1Mjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1d27b132316d0186288b335a152cc123efe188e5", "author": {"user": {"login": "pavolloffay", "name": "Pavol Loffay"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/1d27b132316d0186288b335a152cc123efe188e5", "committedDate": "2020-09-26T18:11:26Z", "message": "Add debugging instructions\n\nSigned-off-by: Pavol Loffay <ploffay@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecb53e4b3241c85612273a188a2de04f66d56e24", "author": {"user": {"login": "pavolloffay", "name": "Pavol Loffay"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ecb53e4b3241c85612273a188a2de04f66d56e24", "committedDate": "2020-09-26T18:12:47Z", "message": "notes\n\nSigned-off-by: Pavol Loffay <ploffay@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDI1MDYz", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1263#pullrequestreview-497025063", "createdAt": "2020-09-26T19:08:15Z", "commit": {"oid": "ecb53e4b3241c85612273a188a2de04f66d56e24"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQxOTowODoxNlrOHYiEUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQxOToxMjozNlrOHYiFwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NjAzNA==", "bodyText": "agentmain is for \"hot attach\" and I think breakpoints may work there (though we don't use/test/doc hot attach at this time).\nnaming specific classes as examples I think is good, since lots of agent-tooling classes will work under debugger, just not the initialization code\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            in agent initialization code (`premain`/`agentmain`, `agent-tooling` artifact etc.).\n          \n          \n            \n            in agent initialization code (`OpenTelemetryAgent`, `AgentInitializer`, `AgentInstaller`, `TracerInstaller`, etc.).", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1263#discussion_r495486034", "createdAt": "2020-09-26T19:08:16Z", "author": {"login": "trask"}, "path": "docs/contributing/debugging.md", "diffHunk": "@@ -0,0 +1,33 @@\n+### Debugging\n+\n+Debugging java agent can be a challenging task since some instrumentation\n+code is directly inlined into target classes and debugger is\n+usually not attached early enough to activate breakpoints\n+in agent initialization code (`premain`/`agentmain`, `agent-tooling` artifact etc.).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecb53e4b3241c85612273a188a2de04f66d56e24"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NjQwMA==", "bodyText": "I don't think we use the term \"template methods\" elsewhere. I think \"advice methods\" may be better.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1263#discussion_r495486400", "createdAt": "2020-09-26T19:12:36Z", "author": {"login": "trask"}, "path": "docs/contributing/debugging.md", "diffHunk": "@@ -0,0 +1,33 @@\n+### Debugging\n+\n+Debugging java agent can be a challenging task since some instrumentation\n+code is directly inlined into target classes and debugger is\n+usually not attached early enough to activate breakpoints\n+in agent initialization code (`premain`/`agentmain`, `agent-tooling` artifact etc.).\n+\n+#### Template methods and agent initialization", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecb53e4b3241c85612273a188a2de04f66d56e24"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDY1Mjgw", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1263#pullrequestreview-497065280", "createdAt": "2020-09-27T09:05:30Z", "commit": {"oid": "ecb53e4b3241c85612273a188a2de04f66d56e24"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwOTowNTozMFrOHYl8Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QwOTowNTozMFrOHYl8Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU0OTQ3MA==", "bodyText": "IIUC, this requires remote debugging from this repo since it has the code, but not a users if they are using the agent. Since this is CONTRIBUTING.md that's totally fine :) With the linked issue I'm hoping we can provide that jar so it's easier to debug for a user though - add compileOnly dependency on obfuscated jar and use normal IntelliJ local debug, it's worked ok for me in the past.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1263#discussion_r495549470", "createdAt": "2020-09-27T09:05:30Z", "author": {"login": "anuraaga"}, "path": "docs/contributing/debugging.md", "diffHunk": "@@ -0,0 +1,33 @@\n+### Debugging\n+\n+Debugging java agent can be a challenging task since some instrumentation\n+code is directly inlined into target classes and debugger is\n+usually not attached early enough to activate breakpoints\n+in agent initialization code (`premain`/`agentmain`, `agent-tooling` artifact etc.).\n+\n+#### Template methods and agent initialization\n+\n+Breakpoints do not work in template methods, because their code is directly inlined\n+by ByteBuddy into the target class. It is good to keep these methods as small as possible.\n+The template methods are annotated with:\n+\n+```java\n+@net.bytebuddy.asm.Advice.OnMethodEnter\n+@net.bytebuddy.asm.Advice.OnMethodExit\n+```\n+\n+The best approach to debug template methods and agent initialization is to use the following statements:\n+\n+```java\n+System.out.println()\n+Thread.dumpStack()\n+```\n+\n+#### Enable debugger\n+\n+The following example shows remote debugger configuration. The breakpoints", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecb53e4b3241c85612273a188a2de04f66d56e24"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26c7c5d75b47d6262624c76c0d9191c66f556ca2", "author": {"user": {"login": "pavolloffay", "name": "Pavol Loffay"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/26c7c5d75b47d6262624c76c0d9191c66f556ca2", "committedDate": "2020-09-27T15:49:31Z", "message": "Review comments\n\nSigned-off-by: Pavol Loffay <ploffay@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b85ee16ca181656700d189fdb1f835e5a17f8527", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b85ee16ca181656700d189fdb1f835e5a17f8527", "committedDate": "2020-09-27T19:12:54Z", "message": "Merge remote-tracking branch 'upstream/master' into pavolloffay/debugging-docs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2651, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}