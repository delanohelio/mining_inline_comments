{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MTUxNzk1", "number": 1881, "title": "Document advice class name hard coding", "bodyText": "This came up in the SIG call this morning.  This question has been asked before, so we're trying to help document it so that it is more easily and consistently answered.", "createdAt": "2020-12-10T18:26:24Z", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1881", "merged": true, "mergeCommit": {"oid": "c800c0dc876ad831abac6fa55c7fc393a6d7397d"}, "closed": true, "closedAt": "2020-12-14T21:14:58Z", "author": {"login": "breedx-splk"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk3l9cgH2gAyNTM2MTUxNzk1OjNiZjAwYzBlMjc4YmM3N2ZkOTUwY2FmODEyNDg3NWQ2ZjZjMWFiNDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlWjUFgFqTU1MDY5NTgyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3bf00c0e278bc77fd950caf8124875d6f6c1ab43", "author": {"user": {"login": "breedx-splk", "name": "jason plumb"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/3bf00c0e278bc77fd950caf8124875d6f6c1ab43", "committedDate": "2020-12-10T18:24:45Z", "message": "document why class names are hard coded and concatenated."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NDg2MTQ2", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1881#pullrequestreview-549486146", "createdAt": "2020-12-10T18:28:42Z", "commit": {"oid": "3bf00c0e278bc77fd950caf8124875d6f6c1ab43"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODoyODo0M1rOIDXbOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxODozMDo0MlrOIDXgsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQwMDQ0Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Subclasses of `InstrumentationModule` will often implement advice classes static inner classes.\n          \n          \n            \n            Subclasses of `InstrumentationModule` will often implement advice classes as static inner classes.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1881#discussion_r540400442", "createdAt": "2020-12-10T18:28:43Z", "author": {"login": "iNikem"}, "path": "docs/contributing/writing-instrumentation.md", "diffHunk": "@@ -124,3 +124,27 @@ are not legal in Java 7 (and prior) bytecode.\n Because OpenTelemetry API has many common default methods (e.g. `Span.current()`),\n the `javaagent-api` artifact has a class `Java8BytecodeBridge` which provides static methods\n for accessing these default methods from advice.\n+\n+### Why hard code advice class names?\n+\n+Subclasses of `InstrumentationModule` will often implement advice classes static inner classes.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bf00c0e278bc77fd950caf8124875d6f6c1ab43"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQwMTIxNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Simply referring to the inner class and\n          \n          \n            \n            calling `getName()` would be easier to read and understand than\n          \n          \n            \n            Simply writing `WonderfulAdvice.class.getName()` would be easier to read and understand than", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1881#discussion_r540401215", "createdAt": "2020-12-10T18:29:47Z", "author": {"login": "iNikem"}, "path": "docs/contributing/writing-instrumentation.md", "diffHunk": "@@ -124,3 +124,27 @@ are not legal in Java 7 (and prior) bytecode.\n Because OpenTelemetry API has many common default methods (e.g. `Span.current()`),\n the `javaagent-api` artifact has a class `Java8BytecodeBridge` which provides static methods\n for accessing these default methods from advice.\n+\n+### Why hard code advice class names?\n+\n+Subclasses of `InstrumentationModule` will often implement advice classes static inner classes.\n+These classes are referred to by name in the mappings from method descriptor to advice class,\n+typically in the `transform()` method.\n+\n+For instance, this `MyInstrumentationModule` defines a single advice that mathches\n+on a single `execute` method:\n+\n+```\n+transformers.put(\n+  isMethod().and(named(\"execute\")), \n+  MyInstrumentationModule.class.getName() + \"$WonderfulAdvice\");\n+```\n+\n+Simply referring to the inner class and\n+calling `getName()` would be easier to read and understand than", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bf00c0e278bc77fd950caf8124875d6f6c1ab43"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQwMTg0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Instrumentation modules are typically loaded by the user's classloader, and this \n          \n          \n            \n            Instrumentation modules are loaded by the agent's classloader, and this", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1881#discussion_r540401841", "createdAt": "2020-12-10T18:30:42Z", "author": {"login": "iNikem"}, "path": "docs/contributing/writing-instrumentation.md", "diffHunk": "@@ -124,3 +124,27 @@ are not legal in Java 7 (and prior) bytecode.\n Because OpenTelemetry API has many common default methods (e.g. `Span.current()`),\n the `javaagent-api` artifact has a class `Java8BytecodeBridge` which provides static methods\n for accessing these default methods from advice.\n+\n+### Why hard code advice class names?\n+\n+Subclasses of `InstrumentationModule` will often implement advice classes static inner classes.\n+These classes are referred to by name in the mappings from method descriptor to advice class,\n+typically in the `transform()` method.\n+\n+For instance, this `MyInstrumentationModule` defines a single advice that mathches\n+on a single `execute` method:\n+\n+```\n+transformers.put(\n+  isMethod().and(named(\"execute\")), \n+  MyInstrumentationModule.class.getName() + \"$WonderfulAdvice\");\n+```\n+\n+Simply referring to the inner class and\n+calling `getName()` would be easier to read and understand than\n+this odd mix of string concatenation...but please NOTE:  **this is intentional** \n+and should be maintained.\n+\n+Instrumentation modules are typically loaded by the user's classloader, and this ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bf00c0e278bc77fd950caf8124875d6f6c1ab43"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b6c2e0ef4ffa5a7469746e0e92588927f0c0113", "author": {"user": {"login": "breedx-splk", "name": "jason plumb"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/8b6c2e0ef4ffa5a7469746e0e92588927f0c0113", "committedDate": "2020-12-10T18:38:00Z", "message": "Update docs/contributing/writing-instrumentation.md\n\nCo-authored-by: Nikita Salnikov-Tarnovski <gnikem@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3f542e2193aabd2369da414d3f919906da004fd", "author": {"user": {"login": "breedx-splk", "name": "jason plumb"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c3f542e2193aabd2369da414d3f919906da004fd", "committedDate": "2020-12-10T18:41:50Z", "message": "Update docs/contributing/writing-instrumentation.md\n\nCo-authored-by: Nikita Salnikov-Tarnovski <gnikem@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5NTk2Njg4", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1881#pullrequestreview-549596688", "createdAt": "2020-12-10T20:59:14Z", "commit": {"oid": "c3f542e2193aabd2369da414d3f919906da004fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e44518fd941473f08db965c587930861a1b0fd21", "author": {"user": {"login": "breedx-splk", "name": "jason plumb"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e44518fd941473f08db965c587930861a1b0fd21", "committedDate": "2020-12-10T22:46:26Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84b52db98873253a2094e5b39c10bc4e3c1cfa9b", "author": {"user": {"login": "breedx-splk", "name": "jason plumb"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/84b52db98873253a2094e5b39c10bc4e3c1cfa9b", "committedDate": "2020-12-10T22:47:51Z", "message": "Merge remote-tracking branch 'origin/doc_advice_class_string_concat' into doc_advice_class_string_concat\n\n# Conflicts:\n#\tdocs/contributing/writing-instrumentation.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5OTQwMzg3", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1881#pullrequestreview-549940387", "createdAt": "2020-12-11T09:39:22Z", "commit": {"oid": "84b52db98873253a2094e5b39c10bc4e3c1cfa9b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwOTozOToyMlrOIDwv2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwOTo0MDo0NVrOIDwzbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgxNTMyMA==", "bodyText": "transformers() method belongs to the TypeInstrumentation interface and I think it's a bit better to focus on them in this particular gotcha. A module just brings everything together.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Subclasses of `InstrumentationModule` will often implement advice classes as static inner classes.\n          \n          \n            \n            Implementations of `TypeInstrumentation` will often implement advice classes as static inner classes.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1881#discussion_r540815320", "createdAt": "2020-12-11T09:39:22Z", "author": {"login": "mateuszrzeszutek"}, "path": "docs/contributing/writing-instrumentation.md", "diffHunk": "@@ -124,3 +124,27 @@ are not legal in Java 7 (and prior) bytecode.\n Because OpenTelemetry API has many common default methods (e.g. `Span.current()`),\n the `javaagent-api` artifact has a class `Java8BytecodeBridge` which provides static methods\n for accessing these default methods from advice.\n+\n+### Why hard code advice class names?\n+\n+Subclasses of `InstrumentationModule` will often implement advice classes as static inner classes.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84b52db98873253a2094e5b39c10bc4e3c1cfa9b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgxNjIzOQ==", "bodyText": "It might be useful to mention that it's okay to keep the advice class in the module class or in the package.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1881#discussion_r540816239", "createdAt": "2020-12-11T09:40:45Z", "author": {"login": "mateuszrzeszutek"}, "path": "docs/contributing/writing-instrumentation.md", "diffHunk": "@@ -124,3 +124,27 @@ are not legal in Java 7 (and prior) bytecode.\n Because OpenTelemetry API has many common default methods (e.g. `Span.current()`),\n the `javaagent-api` artifact has a class `Java8BytecodeBridge` which provides static methods\n for accessing these default methods from advice.\n+\n+### Why hard code advice class names?\n+\n+Subclasses of `InstrumentationModule` will often implement advice classes as static inner classes.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgxNTMyMA=="}, "originalCommit": {"oid": "84b52db98873253a2094e5b39c10bc4e3c1cfa9b"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57f716678c8a2fd77e7750161a7d5d29c185586b", "author": {"user": {"login": "breedx-splk", "name": "jason plumb"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/57f716678c8a2fd77e7750161a7d5d29c185586b", "committedDate": "2020-12-11T16:46:12Z", "message": "Update docs/contributing/writing-instrumentation.md\n\nCo-authored-by: Mateusz Rzeszutek <mrzeszutek@splunk.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjk1ODIx", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1881#pullrequestreview-550695821", "createdAt": "2020-12-12T06:28:55Z", "commit": {"oid": "57f716678c8a2fd77e7750161a7d5d29c185586b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1970, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}