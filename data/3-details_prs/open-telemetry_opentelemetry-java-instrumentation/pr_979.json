{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3ODY1Mjc4", "number": 979, "title": "Implement Armeria instrumentation context propagation.", "bodyText": "This is both to provide a good mechanism for tying our context to Armeria's for users, and also food for thought in case the implementation can inspire something in other libraries. I don't see any reason a similar concept wouldn't work with Akka, etc.", "createdAt": "2020-08-14T09:01:55Z", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/979", "merged": true, "mergeCommit": {"oid": "56360a8137d84ce0a3ab8e6dae2ecb6285d016a7"}, "closed": true, "closedAt": "2020-08-21T02:22:14Z", "author": {"login": "anuraaga"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-wzo5AH2gAyNDY3ODY1Mjc4OmVjOTE1YmY0ZTUzNTZiNzM1MDQwMzI1ZWFiNWQ5Y2ZiZDVhZDQxY2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdA7SZsAFqTQ3MjEwMTEyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec915bf4e5356b735040325eab5d9cfbd5ad41cc", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ec915bf4e5356b735040325eab5d9cfbd5ad41cc", "committedDate": "2020-08-14T09:01:14Z", "message": "Implement Armeria instrumentation context propagation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NDY1NzAx", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/979#pullrequestreview-467465701", "createdAt": "2020-08-14T10:16:07Z", "commit": {"oid": "ec915bf4e5356b735040325eab5d9cfbd5ad41cc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMDoxNjowN1rOHAvaDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMDoyMDoxNVrOHAvhTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDUzODc2NA==", "bodyText": "How this will work in production where java_concurrent instrumentation IS enabled by default? Don't you want to test in realistic env?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/979#discussion_r470538764", "createdAt": "2020-08-14T10:16:07Z", "author": {"login": "iNikem"}, "path": "instrumentation/armeria-1.0/auto/armeria-1.0-auto.gradle", "diffHunk": "@@ -22,3 +22,9 @@ dependencies {\n \n   testImplementation project(':instrumentation:armeria-1.0:testing')\n }\n+\n+tasks.withType(Test) {\n+  // Armeria has its own mechanism for context propagation which we don't want our automatic context\n+  // propagation mechanism to interfere with.\n+  jvmArgs '-Dotel.integration.java_concurrent.enabled=false'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec915bf4e5356b735040325eab5d9cfbd5ad41cc"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDU0MDYyMQ==", "bodyText": "First, javadoc please :)\nSecond, having this class will override context storage for the whole JVM with our agent. Including all our instrumentations. And may change the before of the application, if it already has its own override.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/979#discussion_r470540621", "createdAt": "2020-08-14T10:20:15Z", "author": {"login": "iNikem"}, "path": "instrumentation/armeria-1.0/library/src/main/java/io/grpc/override/ContextStorageOverride.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.grpc.override;\n+\n+import com.linecorp.armeria.common.RequestContext;\n+import io.grpc.Context;\n+import io.grpc.Context.Storage;\n+import io.netty.util.AttributeKey;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class ContextStorageOverride extends Storage {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec915bf4e5356b735040325eab5d9cfbd5ad41cc"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "548287828b466bf49199ef56d23cabbfe685c3eb", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/548287828b466bf49199ef56d23cabbfe685c3eb", "committedDate": "2020-08-19T07:54:44Z", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-auto-instr-java into armeria-context-storage-override"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddc98f1a9b17c2a403dd614e3b18b755229a4756", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ddc98f1a9b17c2a403dd614e3b18b755229a4756", "committedDate": "2020-08-19T08:03:43Z", "message": "Doc and cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5062b9d9b52aaa07ab2c04d31b084d811ddc8c5", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/f5062b9d9b52aaa07ab2c04d31b084d811ddc8c5", "committedDate": "2020-08-19T08:10:18Z", "message": "Update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18cf6507e8de94cf3c71da75bd1f4893e360b783", "author": {"user": {"login": "anuraaga", "name": "Anuraag Agrawal"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/18cf6507e8de94cf3c71da75bd1f4893e360b783", "committedDate": "2020-08-19T08:13:11Z", "message": "Clean"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMzQ3MTE4", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/979#pullrequestreview-470347118", "createdAt": "2020-08-19T10:59:21Z", "commit": {"oid": "18cf6507e8de94cf3c71da75bd1f4893e360b783"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMTAxMTI4", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/979#pullrequestreview-472101128", "createdAt": "2020-08-21T02:21:44Z", "commit": {"oid": "18cf6507e8de94cf3c71da75bd1f4893e360b783"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2720, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}