{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2OTkxODE1", "number": 1970, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDozNjo1M1rOFKwm7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDozNjo1M1rOFKwm7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODI2NDc4OnYy", "diffSide": "RIGHT", "path": "javaagent-tooling/src/main/java/io/opentelemetry/javaagent/tooling/ExporterClassLoader.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwNDozNjo1M1rOINlW-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMTo0NDo1M1rOIOCKRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ==", "bodyText": "Do we need to change the url.getFile()?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551114491", "createdAt": "2021-01-04T04:36:53Z", "author": {"login": "anuraaga"}, "path": "javaagent-tooling/src/main/java/io/opentelemetry/javaagent/tooling/ExporterClassLoader.java", "diffHunk": "@@ -127,10 +128,9 @@ private static String getPackageName(String className) {\n   }\n \n   private static Manifest getManifest(URL url) {\n-    try {\n-      JarFile jarFile = new JarFile(url.getFile());\n+    try (JarFile jarFile = new JarFile(url.toURI().getPath())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb5762923459b11ddcbc2b2b7d890af36aa9c5d9"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIwNjYyOQ==", "bodyText": "If path contains a space then url.getFile() will leave it as %20, url.toURI().getPath() decodes it as an actual space character", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551206629", "createdAt": "2021-01-04T09:39:12Z", "author": {"login": "laurit"}, "path": "javaagent-tooling/src/main/java/io/opentelemetry/javaagent/tooling/ExporterClassLoader.java", "diffHunk": "@@ -127,10 +128,9 @@ private static String getPackageName(String className) {\n   }\n \n   private static Manifest getManifest(URL url) {\n-    try {\n-      JarFile jarFile = new JarFile(url.getFile());\n+    try (JarFile jarFile = new JarFile(url.toURI().getPath())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ=="}, "originalCommit": {"oid": "fb5762923459b11ddcbc2b2b7d890af36aa9c5d9"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIwNzc0Mw==", "bodyText": "Does it cause a problem? I'm surprised the more direct way of getting a File would cause JarFile constructor to fail, if you're seeing an exception let's add a comment above this line on what exception we are trying to prevent with the indirect code.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551207743", "createdAt": "2021-01-04T09:41:23Z", "author": {"login": "anuraaga"}, "path": "javaagent-tooling/src/main/java/io/opentelemetry/javaagent/tooling/ExporterClassLoader.java", "diffHunk": "@@ -127,10 +128,9 @@ private static String getPackageName(String className) {\n   }\n \n   private static Manifest getManifest(URL url) {\n-    try {\n-      JarFile jarFile = new JarFile(url.getFile());\n+    try (JarFile jarFile = new JarFile(url.toURI().getPath())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ=="}, "originalCommit": {"oid": "fb5762923459b11ddcbc2b2b7d890af36aa9c5d9"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTIxODMwMg==", "bodyText": "URL.getFile returns a String. As the url is constructed with new File(exporterJar).toURI().toURL(); which encodes space -> %20 when getting file from url we should use a way that translates %20 back to space.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551218302", "createdAt": "2021-01-04T10:01:42Z", "author": {"login": "laurit"}, "path": "javaagent-tooling/src/main/java/io/opentelemetry/javaagent/tooling/ExporterClassLoader.java", "diffHunk": "@@ -127,10 +128,9 @@ private static String getPackageName(String className) {\n   }\n \n   private static Manifest getManifest(URL url) {\n-    try {\n-      JarFile jarFile = new JarFile(url.getFile());\n+    try (JarFile jarFile = new JarFile(url.toURI().getPath())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ=="}, "originalCommit": {"oid": "fb5762923459b11ddcbc2b2b7d890af36aa9c5d9"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMyMDg3MA==", "bodyText": "So it sounds like there is a problem when the path has a space. If so yeah we need to fix it :) But it's confusing, so we need at least a comment documenting the failure case. Even better is a test that fails before the change and passes after, then no one will accidentally revert and regress.\nAlternatively, we can keep the code similarly as before and file an issue - the PR title is about closing the jar file but is doing more than just that. It's ok but we need to do it completely, otherwise let's not make too many changes.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551320870", "createdAt": "2021-01-04T13:37:33Z", "author": {"login": "anuraaga"}, "path": "javaagent-tooling/src/main/java/io/opentelemetry/javaagent/tooling/ExporterClassLoader.java", "diffHunk": "@@ -127,10 +128,9 @@ private static String getPackageName(String className) {\n   }\n \n   private static Manifest getManifest(URL url) {\n-    try {\n-      JarFile jarFile = new JarFile(url.getFile());\n+    try (JarFile jarFile = new JarFile(url.toURI().getPath())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ=="}, "originalCommit": {"oid": "fb5762923459b11ddcbc2b2b7d890af36aa9c5d9"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTU4NjM3Mg==", "bodyText": "Added test", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1970#discussion_r551586372", "createdAt": "2021-01-04T21:44:53Z", "author": {"login": "laurit"}, "path": "javaagent-tooling/src/main/java/io/opentelemetry/javaagent/tooling/ExporterClassLoader.java", "diffHunk": "@@ -127,10 +128,9 @@ private static String getPackageName(String className) {\n   }\n \n   private static Manifest getManifest(URL url) {\n-    try {\n-      JarFile jarFile = new JarFile(url.getFile());\n+    try (JarFile jarFile = new JarFile(url.toURI().getPath())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTExNDQ5MQ=="}, "originalCommit": {"oid": "fb5762923459b11ddcbc2b2b7d890af36aa9c5d9"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4417, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}