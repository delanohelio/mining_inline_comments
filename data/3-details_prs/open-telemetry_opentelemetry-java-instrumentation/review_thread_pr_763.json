{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1NDE1NzUw", "number": 763, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwMzozMDo1OFrOESoySQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwMzozMDo1OFrOESoySQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg3OTc4MDU3OnYy", "diffSide": "RIGHT", "path": "instrumentation-core/spring/spring-boot-autoconfigure/src/test/java/io/opentelemetry/instrumentation/spring/autoconfigure/httpclients/webclient/WebClientBeanPostProcessorTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwMzozMDo1OFrOG37SYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODozMzo0N1rOG4ZYSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI5NjIyNA==", "bodyText": "did you mean to call this multiple times?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/763#discussion_r461296224", "createdAt": "2020-07-28T03:30:58Z", "author": {"login": "trask"}, "path": "instrumentation-core/spring/spring-boot-autoconfigure/src/test/java/io/opentelemetry/instrumentation/spring/autoconfigure/httpclients/webclient/WebClientBeanPostProcessorTest.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.instrumentation.spring.autoconfigure.httpclients.webclient;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+import io.opentelemetry.instrumentation.springwebflux.client.WebClientTracingFilter;\n+import io.opentelemetry.trace.Tracer;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.MockitoJUnitRunner;\n+import org.springframework.web.reactive.function.client.WebClient;\n+\n+/** Spring bean post processor test {@link WebClientBeanPostProcessor} */\n+@RunWith(MockitoJUnitRunner.class)\n+public class WebClientBeanPostProcessorTest {\n+\n+  @Mock Tracer tracer;\n+\n+  WebClientBeanPostProcessor webClientBeanPostProcessor = new WebClientBeanPostProcessor(tracer);\n+\n+  @Test\n+  public void\n+      should_return_object_if_processed_bean_is_NOT_of_type_WebClient_or_WebClientBuilder() {\n+    assertEquals(\n+        webClientBeanPostProcessor\n+            .postProcessAfterInitialization(new Object(), \"testObject\")\n+            .getClass(),\n+        Object.class);\n+  }\n+\n+  @Test\n+  public void should_return_web_client_if_processed_bean_is_of_type_WebClient() {\n+    WebClient webClient = WebClient.create();\n+\n+    assertTrue(\n+        webClientBeanPostProcessor.postProcessAfterInitialization(webClient, \"testWebClient\")\n+            instanceof WebClient);\n+  }\n+\n+  @Test\n+  public void should_return_WebClientBuilder_if_processed_bean_is_of_type_WebClientBuilder() {\n+    WebClient.Builder webClientBuilder = WebClient.builder();\n+\n+    assertTrue(\n+        webClientBeanPostProcessor.postProcessAfterInitialization(\n+                webClientBuilder, \"testWebClientBuilder\")\n+            instanceof WebClient.Builder);\n+  }\n+\n+  @Test\n+  public void should_add_ONE_exchange_filter_to_WebClient() {\n+    WebClient webClient = WebClient.create();\n+    Object processedWebClient =\n+        webClientBeanPostProcessor.postProcessAfterInitialization(webClient, \"testWebClient\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "632792ccafbef90d3f98413cfd8dc4626644d685"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc4OTI1OQ==", "bodyText": "It wouldn't make sense to call webClientBeanPostProcessor.postProcessAfterInitialization multiple times since it returns a new WebClient object. I changed the name of the test from should_add_ONE_exchange_filter_to_WebClient to should_add_exchange_filter_to_WebClient", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/763#discussion_r461789259", "createdAt": "2020-07-28T18:33:47Z", "author": {"login": "mabdinur"}, "path": "instrumentation-core/spring/spring-boot-autoconfigure/src/test/java/io/opentelemetry/instrumentation/spring/autoconfigure/httpclients/webclient/WebClientBeanPostProcessorTest.java", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.instrumentation.spring.autoconfigure.httpclients.webclient;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+import io.opentelemetry.instrumentation.springwebflux.client.WebClientTracingFilter;\n+import io.opentelemetry.trace.Tracer;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.MockitoJUnitRunner;\n+import org.springframework.web.reactive.function.client.WebClient;\n+\n+/** Spring bean post processor test {@link WebClientBeanPostProcessor} */\n+@RunWith(MockitoJUnitRunner.class)\n+public class WebClientBeanPostProcessorTest {\n+\n+  @Mock Tracer tracer;\n+\n+  WebClientBeanPostProcessor webClientBeanPostProcessor = new WebClientBeanPostProcessor(tracer);\n+\n+  @Test\n+  public void\n+      should_return_object_if_processed_bean_is_NOT_of_type_WebClient_or_WebClientBuilder() {\n+    assertEquals(\n+        webClientBeanPostProcessor\n+            .postProcessAfterInitialization(new Object(), \"testObject\")\n+            .getClass(),\n+        Object.class);\n+  }\n+\n+  @Test\n+  public void should_return_web_client_if_processed_bean_is_of_type_WebClient() {\n+    WebClient webClient = WebClient.create();\n+\n+    assertTrue(\n+        webClientBeanPostProcessor.postProcessAfterInitialization(webClient, \"testWebClient\")\n+            instanceof WebClient);\n+  }\n+\n+  @Test\n+  public void should_return_WebClientBuilder_if_processed_bean_is_of_type_WebClientBuilder() {\n+    WebClient.Builder webClientBuilder = WebClient.builder();\n+\n+    assertTrue(\n+        webClientBeanPostProcessor.postProcessAfterInitialization(\n+                webClientBuilder, \"testWebClientBuilder\")\n+            instanceof WebClient.Builder);\n+  }\n+\n+  @Test\n+  public void should_add_ONE_exchange_filter_to_WebClient() {\n+    WebClient webClient = WebClient.create();\n+    Object processedWebClient =\n+        webClientBeanPostProcessor.postProcessAfterInitialization(webClient, \"testWebClient\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI5NjIyNA=="}, "originalCommit": {"oid": "632792ccafbef90d3f98413cfd8dc4626644d685"}, "originalPosition": 71}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 129, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}