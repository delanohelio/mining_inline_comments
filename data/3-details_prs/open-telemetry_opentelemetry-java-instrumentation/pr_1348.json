{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMTMwMDIx", "number": 1348, "title": "Instrument Netty addTask to ensure complete coverage of async Runnables ", "bodyText": "We found that certain code paths in RxNetty through vanilla Netty exposed an issue where Netty WriteTasks weren't capturing the correct/any context during submission.  Turns out that newer 4.1 variants of Netty have a backchannel \"lazy\" execution that uses execute(Runnable, boolean), bypassing the standard execute(Runnable).  Fortunately, all the variants flow through to addTask(Runnable).\nWithout the addTask instrumentation addition, the added unit test fails with 3 traces (the second client request shows up under a brand new 3rd trace without any inherited context).", "createdAt": "2020-10-08T19:11:31Z", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1348", "merged": true, "mergeCommit": {"oid": "b34fd496829f8e0449d37dc1b228f5c6b78777dd"}, "closed": true, "closedAt": "2020-10-09T18:43:34Z", "author": {"login": "johnbley"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQmZHdgH2gAyNTAwMTMwMDIxOmRiMjU5ZTJiMTg5N2E5ZmJmOTY0OTZkNTU4Y2FlNTMxYWJhN2MzNWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQ6sqXAFqTUwNTkxMTI1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "db259e2b1897a9fbf96496d558cae531aba7c35a", "author": {"user": {"login": "johnbley", "name": "John Bley"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/db259e2b1897a9fbf96496d558cae531aba7c35a", "committedDate": "2020-10-08T19:03:51Z", "message": "Instrument Netty addTask to ensure complete coverage of async Runnables\n\nNewer versions of Netty introduce variants like execute(Runnable, boolean) which\naren't covered by the core execute(Runnable) instrumentation.  Fortunately they all\nflow through to addTask(Runnable), which allows us to carry the context through properly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfe214c03b2a3a5fec551cc038cc666f10e92beb", "author": {"user": {"login": "johnbley", "name": "John Bley"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/cfe214c03b2a3a5fec551cc038cc666f10e92beb", "committedDate": "2020-10-08T19:09:09Z", "message": "codeNarc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a5131c3ea172dbd9f1d77f9b18c422c4f61c4ff", "author": {"user": {"login": "johnbley", "name": "John Bley"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2a5131c3ea172dbd9f1d77f9b18c422c4f61c4ff", "committedDate": "2020-10-08T19:20:13Z", "message": "spotless/code format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MTI0NjI1", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1348#pullrequestreview-505124625", "createdAt": "2020-10-08T20:03:57Z", "commit": {"oid": "2a5131c3ea172dbd9f1d77f9b18c422c4f61c4ff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMDowMzo1OFrOHeueuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQyMDowMzo1OFrOHeueuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk4MDg1OQ==", "bodyText": "Wouldn't it be enough to have later versions in latestDepTest? I think we still want to test with the oldest supported version.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1348#discussion_r501980859", "createdAt": "2020-10-08T20:03:58Z", "author": {"login": "iNikem"}, "path": "instrumentation/netty/netty-4.1/netty-4.1.gradle", "diffHunk": "@@ -27,7 +27,7 @@ muzzle {\n }\n \n dependencies {\n-  library group: 'io.netty', name: 'netty-codec-http', version: '4.1.0.Final'\n+  library group: 'io.netty', name: 'netty-codec-http', version: '4.1.52.Final'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a5131c3ea172dbd9f1d77f9b18c422c4f61c4ff"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MzUyNjY3", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1348#pullrequestreview-505352667", "createdAt": "2020-10-09T04:15:08Z", "commit": {"oid": "2a5131c3ea172dbd9f1d77f9b18c422c4f61c4ff"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31c5e41b8360aeb2884e19e704b4c58e96ae5f22", "author": {"user": {"login": "johnbley", "name": "John Bley"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/31c5e41b8360aeb2884e19e704b4c58e96ae5f22", "committedDate": "2020-10-09T15:36:30Z", "message": "Revert Netty version to 4.1.0.Final"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1ODUzNjMx", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1348#pullrequestreview-505853631", "createdAt": "2020-10-09T17:11:04Z", "commit": {"oid": "31c5e41b8360aeb2884e19e704b4c58e96ae5f22"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1OTExMjUy", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1348#pullrequestreview-505911252", "createdAt": "2020-10-09T18:43:18Z", "commit": {"oid": "31c5e41b8360aeb2884e19e704b4c58e96ae5f22"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2301, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}