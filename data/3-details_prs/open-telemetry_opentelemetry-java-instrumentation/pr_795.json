{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NzA1ODU0", "number": 795, "title": "Deprecate SpanWithScope", "bodyText": "Closes #794", "createdAt": "2020-07-26T05:56:11Z", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/795", "merged": true, "mergeCommit": {"oid": "010252ce471954fe3ee03b9ea6cd923a54f33ee6"}, "closed": true, "closedAt": "2020-07-27T05:53:59Z", "author": {"login": "trask"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4mwzCAH2gAyNDU2NzA1ODU0OjA5NTJjY2UwNTI1NTYyZWQ3NDVmZTU5ZDc1NDI1NTJlMzcxZmI2MWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc47VjfgFqTQ1NTQ4NzkwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0952cce0525562ed745fe59d7542552e371fb61b", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/0952cce0525562ed745fe59d7542552e371fb61b", "committedDate": "2020-07-26T05:55:32Z", "message": "Deprecate SpanWithScope"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzM0NTcw", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/795#pullrequestreview-455334570", "createdAt": "2020-07-26T06:02:51Z", "commit": {"oid": "0952cce0525562ed745fe59d7542552e371fb61b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQwNjowMjo1MVrOG3Jr2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQwNjowMjo1MVrOG3Jr2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ4MzU0Ng==", "bodyText": "Don't think this is the old pattern, though it's not a big deal to document in detail either I think.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/795#discussion_r460483546", "createdAt": "2020-07-26T06:02:51Z", "author": {"login": "anuraaga"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/instrumentation/api/SpanWithScope.java", "diffHunk": "@@ -19,7 +19,62 @@\n import io.opentelemetry.context.Scope;\n import io.opentelemetry.trace.Span;\n \n-// intentionally (for now) not implementing Closeable since not clear what it would close\n+/**\n+ * This is deprecated.\n+ *\n+ * <p>Originally, we used {@code SpanWithScope} to pass the {@link Span} and {@link Scope} between\n+ * {@code @Advice.OnMethodEnter} and {@code @Advice.OnMethodExit}, e.g.\n+ *\n+ * <pre>\n+ *   &#64;Advice.OnMethodEnter(...)\n+ *   public static CallDepth onEnter(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0952cce0525562ed745fe59d7542552e371fb61b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c32d1fa881439da74b5a68bf2c5163e526323af9", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c32d1fa881439da74b5a68bf2c5163e526323af9", "committedDate": "2020-07-26T06:10:07Z", "message": "feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzM2MDE1", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/795#pullrequestreview-455336015", "createdAt": "2020-07-26T06:30:20Z", "commit": {"oid": "c32d1fa881439da74b5a68bf2c5163e526323af9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQwNjozMDoyMVrOG3J1GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQwNjozMDoyMVrOG3J1GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ4NTkxMw==", "bodyText": "I think it deserves the explanation: why are we migrating? What was bad with old approach? Document your decisions, not actions :)", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/795#discussion_r460485913", "createdAt": "2020-07-26T06:30:21Z", "author": {"login": "iNikem"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/instrumentation/api/SpanWithScope.java", "diffHunk": "@@ -19,7 +19,59 @@\n import io.opentelemetry.context.Scope;\n import io.opentelemetry.trace.Span;\n \n-// intentionally (for now) not implementing Closeable since not clear what it would close\n+/**\n+ * This is deprecated.\n+ *\n+ * <p>Originally, we used {@code SpanWithScope} to pass the {@link Span} and {@link Scope} between\n+ * {@code @Advice.OnMethodEnter} and {@code @Advice.OnMethodExit}, e.g.\n+ *\n+ * <pre>\n+ *   &#64;Advice.OnMethodEnter(...)\n+ *     public static SpanWithScope onEnter(...) {\n+ *     ...\n+ *     Span span = ...\n+ *     return new SpanWithScope(span, currentContextWith(span));\n+ *   }\n+ *\n+ *   &#64;Advice.OnMethodExit(...)\n+ *   public static void stopSpan(\n+ *       ...\n+ *       &#64;Advice.Enter final SpanWithScope spanWithScope) {\n+ *     Span span = spanWithScope.getSpan();\n+ *     ...\n+ *     span.end();\n+ *     spanWithScope.closeScope();\n+ *   }\n+ * </pre>\n+ *\n+ * But we are (slowly) migrating to a new style using {@code @Advice.Local} that doesn't require", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c32d1fa881439da74b5a68bf2c5163e526323af9"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f091dfbab3341e8c6d31347e087516449cf8b038", "author": {"user": {"login": "trask", "name": "Trask Stalnaker"}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/f091dfbab3341e8c6d31347e087516449cf8b038", "committedDate": "2020-07-26T06:42:10Z", "message": "feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NDg3OTAy", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/795#pullrequestreview-455487902", "createdAt": "2020-07-27T05:53:47Z", "commit": {"oid": "f091dfbab3341e8c6d31347e087516449cf8b038"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2862, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}