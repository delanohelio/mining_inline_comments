{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MTE0NzY2", "number": 1107, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNDoxNDowN1rOEdBaTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTozODoxOVrOEdDmrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4ODY3Mjc5OnYy", "diffSide": "RIGHT", "path": "instrumentation/scala-concurrent/scala-concurrent.gradle", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNDoxNDowN1rOHH798g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxOToyMzozMlrOHIeF8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA4NDU5NA==", "bodyText": "cc: @tylerbenson, it looks like muzzle in dd-trace-java is only ever checking 2.11.12 b/c of\nresolutionStrategy {\n  force deps.scala\n}\n\nin test-with-scala.gradle", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478084594", "createdAt": "2020-08-27T04:14:07Z", "author": {"login": "trask"}, "path": "instrumentation/scala-concurrent/scala-concurrent.gradle", "diffHunk": "@@ -0,0 +1,40 @@\n+apply from: \"$rootDir/gradle/instrumentation.gradle\"\n+apply from: \"$rootDir/gradle/test-with-scala.gradle\"\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+muzzle {\n+  pass {\n+    group = 'org.scala-lang'\n+    module = \"scala-library\"\n+    versions = \"[2.8.0,2.12.0)\"\n+    assertInverse = true\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c6341ff21026d64572b38201fffd6c2e29020ce"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU1ODQyMQ==", "bodyText": "did you find a way to solve it?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478558421", "createdAt": "2020-08-27T16:48:55Z", "author": {"login": "tylerbenson"}, "path": "instrumentation/scala-concurrent/scala-concurrent.gradle", "diffHunk": "@@ -0,0 +1,40 @@\n+apply from: \"$rootDir/gradle/instrumentation.gradle\"\n+apply from: \"$rootDir/gradle/test-with-scala.gradle\"\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+muzzle {\n+  pass {\n+    group = 'org.scala-lang'\n+    module = \"scala-library\"\n+    versions = \"[2.8.0,2.12.0)\"\n+    assertInverse = true\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA4NDU5NA=="}, "originalCommit": {"oid": "9c6341ff21026d64572b38201fffd6c2e29020ce"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MDI0MA==", "bodyText": "I guess that's not a problem here since you aren't forcing that version.  Thanks for calling it out.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478560240", "createdAt": "2020-08-27T16:52:03Z", "author": {"login": "tylerbenson"}, "path": "instrumentation/scala-concurrent/scala-concurrent.gradle", "diffHunk": "@@ -0,0 +1,40 @@\n+apply from: \"$rootDir/gradle/instrumentation.gradle\"\n+apply from: \"$rootDir/gradle/test-with-scala.gradle\"\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+muzzle {\n+  pass {\n+    group = 'org.scala-lang'\n+    module = \"scala-library\"\n+    versions = \"[2.8.0,2.12.0)\"\n+    assertInverse = true\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA4NDU5NA=="}, "originalCommit": {"oid": "9c6341ff21026d64572b38201fffd6c2e29020ce"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU3NTgwNQ==", "bodyText": "I took the liberty: DataDog/dd-trace-java#1810", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478575805", "createdAt": "2020-08-27T17:19:14Z", "author": {"login": "tylerbenson"}, "path": "instrumentation/scala-concurrent/scala-concurrent.gradle", "diffHunk": "@@ -0,0 +1,40 @@\n+apply from: \"$rootDir/gradle/instrumentation.gradle\"\n+apply from: \"$rootDir/gradle/test-with-scala.gradle\"\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+muzzle {\n+  pass {\n+    group = 'org.scala-lang'\n+    module = \"scala-library\"\n+    versions = \"[2.8.0,2.12.0)\"\n+    assertInverse = true\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA4NDU5NA=="}, "originalCommit": {"oid": "9c6341ff21026d64572b38201fffd6c2e29020ce"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU5NzU3Mg==", "bodyText": "It's actually failing for me on latestDepTestCompile which you seem to have removed here.", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478597572", "createdAt": "2020-08-27T17:57:17Z", "author": {"login": "tylerbenson"}, "path": "instrumentation/scala-concurrent/scala-concurrent.gradle", "diffHunk": "@@ -0,0 +1,40 @@\n+apply from: \"$rootDir/gradle/instrumentation.gradle\"\n+apply from: \"$rootDir/gradle/test-with-scala.gradle\"\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+muzzle {\n+  pass {\n+    group = 'org.scala-lang'\n+    module = \"scala-library\"\n+    versions = \"[2.8.0,2.12.0)\"\n+    assertInverse = true\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA4NDU5NA=="}, "originalCommit": {"oid": "9c6341ff21026d64572b38201fffd6c2e29020ce"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY0MzY5Ng==", "bodyText": "oh, good point, i added it back", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478643696", "createdAt": "2020-08-27T19:23:32Z", "author": {"login": "trask"}, "path": "instrumentation/scala-concurrent/scala-concurrent.gradle", "diffHunk": "@@ -0,0 +1,40 @@\n+apply from: \"$rootDir/gradle/instrumentation.gradle\"\n+apply from: \"$rootDir/gradle/test-with-scala.gradle\"\n+apply plugin: 'org.unbroken-dome.test-sets'\n+\n+muzzle {\n+  pass {\n+    group = 'org.scala-lang'\n+    module = \"scala-library\"\n+    versions = \"[2.8.0,2.12.0)\"\n+    assertInverse = true\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODA4NDU5NA=="}, "originalCommit": {"oid": "9c6341ff21026d64572b38201fffd6c2e29020ce"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4ODkyMjIwOnYy", "diffSide": "RIGHT", "path": "instrumentation/akka-context-propagation-2.5/src/main/java/io/opentelemetry/instrumentation/auto/akkaconcurrent/AkkaForkJoinPoolInstrumentation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTowOTozN1rOHH-hEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNToxNTowNFrOHH-uzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODEyNjM1Mw==", "bodyText": "Can we confirm this caveat? Should we file an issue?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478126353", "createdAt": "2020-08-27T05:09:37Z", "author": {"login": "anuraaga"}, "path": "instrumentation/akka-context-propagation-2.5/src/main/java/io/opentelemetry/instrumentation/auto/akkaconcurrent/AkkaForkJoinPoolInstrumentation.java", "diffHunk": "@@ -28,27 +28,33 @@\n import io.opentelemetry.instrumentation.auto.api.InstrumentationContext;\n import io.opentelemetry.instrumentation.auto.api.concurrent.ExecutorInstrumentationUtils;\n import io.opentelemetry.instrumentation.auto.api.concurrent.State;\n-import io.opentelemetry.instrumentation.auto.javaconcurrent.AbstractExecutorInstrumentation;\n import io.opentelemetry.javaagent.tooling.Instrumenter;\n import java.util.HashMap;\n import java.util.Map;\n import java.util.concurrent.Executor;\n import net.bytebuddy.asm.Advice;\n import net.bytebuddy.description.method.MethodDescription;\n+import net.bytebuddy.description.type.TypeDescription;\n import net.bytebuddy.matcher.ElementMatcher;\n \n @AutoService(Instrumenter.class)\n-public final class AkkaExecutorInstrumentation extends AbstractExecutorInstrumentation {\n+public final class AkkaForkJoinPoolInstrumentation extends Instrumenter.Default {\n \n-  public AkkaExecutorInstrumentation() {\n-    super(AbstractExecutorInstrumentation.EXEC_NAME + \".akka_fork_join\");\n+  public AkkaForkJoinPoolInstrumentation() {\n+    super(\"akka_context_propagation\");\n   }\n \n   @Override\n   protected boolean defaultEnabled() {\n     return false;\n   }\n \n+  @Override\n+  public ElementMatcher<TypeDescription> typeMatcher() {\n+    // This might need to be an extendsClass matcher...", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODEyOTg3MA==", "bodyText": "Just checking you saw my response #1089 (comment)", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478129870", "createdAt": "2020-08-27T05:15:04Z", "author": {"login": "trask"}, "path": "instrumentation/akka-context-propagation-2.5/src/main/java/io/opentelemetry/instrumentation/auto/akkaconcurrent/AkkaForkJoinPoolInstrumentation.java", "diffHunk": "@@ -28,27 +28,33 @@\n import io.opentelemetry.instrumentation.auto.api.InstrumentationContext;\n import io.opentelemetry.instrumentation.auto.api.concurrent.ExecutorInstrumentationUtils;\n import io.opentelemetry.instrumentation.auto.api.concurrent.State;\n-import io.opentelemetry.instrumentation.auto.javaconcurrent.AbstractExecutorInstrumentation;\n import io.opentelemetry.javaagent.tooling.Instrumenter;\n import java.util.HashMap;\n import java.util.Map;\n import java.util.concurrent.Executor;\n import net.bytebuddy.asm.Advice;\n import net.bytebuddy.description.method.MethodDescription;\n+import net.bytebuddy.description.type.TypeDescription;\n import net.bytebuddy.matcher.ElementMatcher;\n \n @AutoService(Instrumenter.class)\n-public final class AkkaExecutorInstrumentation extends AbstractExecutorInstrumentation {\n+public final class AkkaForkJoinPoolInstrumentation extends Instrumenter.Default {\n \n-  public AkkaExecutorInstrumentation() {\n-    super(AbstractExecutorInstrumentation.EXEC_NAME + \".akka_fork_join\");\n+  public AkkaForkJoinPoolInstrumentation() {\n+    super(\"akka_context_propagation\");\n   }\n \n   @Override\n   protected boolean defaultEnabled() {\n     return false;\n   }\n \n+  @Override\n+  public ElementMatcher<TypeDescription> typeMatcher() {\n+    // This might need to be an extendsClass matcher...", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODEyNjM1Mw=="}, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4ODk5NTQyOnYy", "diffSide": "RIGHT", "path": "instrumentation/finatra-2.9/src/latestDepTest/groovy/FinatraServerLatestTest.groovy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNToyODo0MVrOHH_PsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQwNDowOTo0NlrOHJftqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODEzODI4OQ==", "bodyText": "So how exceptions are recorded in Finatra? Or are they not?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478138289", "createdAt": "2020-08-27T05:28:41Z", "author": {"login": "iNikem"}, "path": "instrumentation/finatra-2.9/src/latestDepTest/groovy/FinatraServerLatestTest.groovy", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import static io.opentelemetry.auto.test.base.HttpServerTest.ServerEndpoint.SUCCESS\n+import static io.opentelemetry.trace.Span.Kind.INTERNAL\n+\n+import com.twitter.app.lifecycle.Event\n+import com.twitter.app.lifecycle.Observer\n+import com.twitter.finatra.http.HttpServer\n+import com.twitter.util.Await\n+import com.twitter.util.Closable\n+import com.twitter.util.Duration\n+import com.twitter.util.Promise\n+import io.opentelemetry.auto.test.asserts.TraceAssert\n+import io.opentelemetry.auto.test.base.HttpServerTest\n+import io.opentelemetry.sdk.trace.data.SpanData\n+\n+class FinatraServerLatestTest extends HttpServerTest<HttpServer> {\n+  private static final Duration TIMEOUT = Duration.fromSeconds(5)\n+  private static final Duration STARTUP_TIMEOUT = Duration.fromSeconds(20)\n+\n+  static closeAndWait(Closable closable) {\n+    if (closable != null) {\n+      Await.ready(closable.close(), TIMEOUT)\n+    }\n+  }\n+\n+  @Override\n+  HttpServer startServer(int port) {\n+    HttpServer testServer = new FinatraServer()\n+\n+    // Starting the server is blocking so start it in a separate thread\n+    Thread startupThread = new Thread({\n+      testServer.main(\"-admin.port=:0\", \"-http.port=:\" + port)\n+    })\n+    startupThread.setDaemon(true)\n+    startupThread.start()\n+\n+    Promise<Boolean> startupPromise = new Promise<>()\n+\n+    testServer.withObserver(new Observer() {\n+      @Override\n+      void onSuccess(Event event) {\n+        if (event == testServer.startupCompletionEvent()) {\n+          startupPromise.setValue(true)\n+        }\n+      }\n+\n+      void onEntry(Event event) {\n+\n+      }\n+\n+      @Override\n+      void onFailure(Event stage, Throwable throwable) {\n+        if (stage != Event.Close$.MODULE$) {\n+          startupPromise.setException(throwable)\n+        }\n+      }\n+    })\n+\n+    Await.result(startupPromise, STARTUP_TIMEOUT)\n+\n+    return testServer\n+  }\n+\n+  @Override\n+  boolean hasHandlerSpan() {\n+    return true\n+  }\n+\n+  @Override\n+  boolean testNotFound() {\n+    // Resource name is set to \"GET /notFound\"\n+    false\n+  }\n+\n+  @Override\n+  void stopServer(HttpServer httpServer) {\n+    Await.ready(httpServer.close(), TIMEOUT)\n+  }\n+\n+  @Override\n+  void handlerSpan(TraceAssert trace, int index, Object parent, String method = \"GET\", ServerEndpoint endpoint = SUCCESS) {\n+    trace.span(index) {\n+      operationName \"FinatraController\"\n+      spanKind INTERNAL\n+      childOf(parent as SpanData)\n+      // Finatra doesn't propagate the stack trace or exception to the instrumentation\n+      // so the normal errorAttributes() method can't be used", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTcxODgyNw==", "bodyText": "idk, this is not new code in this PR (copied from FinatraServerTest.groovy), opened #1131 to track", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r479718827", "createdAt": "2020-08-30T04:09:46Z", "author": {"login": "trask"}, "path": "instrumentation/finatra-2.9/src/latestDepTest/groovy/FinatraServerLatestTest.groovy", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import static io.opentelemetry.auto.test.base.HttpServerTest.ServerEndpoint.SUCCESS\n+import static io.opentelemetry.trace.Span.Kind.INTERNAL\n+\n+import com.twitter.app.lifecycle.Event\n+import com.twitter.app.lifecycle.Observer\n+import com.twitter.finatra.http.HttpServer\n+import com.twitter.util.Await\n+import com.twitter.util.Closable\n+import com.twitter.util.Duration\n+import com.twitter.util.Promise\n+import io.opentelemetry.auto.test.asserts.TraceAssert\n+import io.opentelemetry.auto.test.base.HttpServerTest\n+import io.opentelemetry.sdk.trace.data.SpanData\n+\n+class FinatraServerLatestTest extends HttpServerTest<HttpServer> {\n+  private static final Duration TIMEOUT = Duration.fromSeconds(5)\n+  private static final Duration STARTUP_TIMEOUT = Duration.fromSeconds(20)\n+\n+  static closeAndWait(Closable closable) {\n+    if (closable != null) {\n+      Await.ready(closable.close(), TIMEOUT)\n+    }\n+  }\n+\n+  @Override\n+  HttpServer startServer(int port) {\n+    HttpServer testServer = new FinatraServer()\n+\n+    // Starting the server is blocking so start it in a separate thread\n+    Thread startupThread = new Thread({\n+      testServer.main(\"-admin.port=:0\", \"-http.port=:\" + port)\n+    })\n+    startupThread.setDaemon(true)\n+    startupThread.start()\n+\n+    Promise<Boolean> startupPromise = new Promise<>()\n+\n+    testServer.withObserver(new Observer() {\n+      @Override\n+      void onSuccess(Event event) {\n+        if (event == testServer.startupCompletionEvent()) {\n+          startupPromise.setValue(true)\n+        }\n+      }\n+\n+      void onEntry(Event event) {\n+\n+      }\n+\n+      @Override\n+      void onFailure(Event stage, Throwable throwable) {\n+        if (stage != Event.Close$.MODULE$) {\n+          startupPromise.setException(throwable)\n+        }\n+      }\n+    })\n+\n+    Await.result(startupPromise, STARTUP_TIMEOUT)\n+\n+    return testServer\n+  }\n+\n+  @Override\n+  boolean hasHandlerSpan() {\n+    return true\n+  }\n+\n+  @Override\n+  boolean testNotFound() {\n+    // Resource name is set to \"GET /notFound\"\n+    false\n+  }\n+\n+  @Override\n+  void stopServer(HttpServer httpServer) {\n+    Await.ready(httpServer.close(), TIMEOUT)\n+  }\n+\n+  @Override\n+  void handlerSpan(TraceAssert trace, int index, Object parent, String method = \"GET\", ServerEndpoint endpoint = SUCCESS) {\n+    trace.span(index) {\n+      operationName \"FinatraController\"\n+      spanKind INTERNAL\n+      childOf(parent as SpanData)\n+      // Finatra doesn't propagate the stack trace or exception to the instrumentation\n+      // so the normal errorAttributes() method can't be used", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODEzODI4OQ=="}, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 102}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTAwMzM3OnYy", "diffSide": "RIGHT", "path": "instrumentation/guava-10.0/src/main/java/io/opentelemetry/instrumentation/auto/guava/ListenableFutureInstrumentation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTozMDoyN1rOHH_UdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQwNDoyOToyNlrOHJfyvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODEzOTUwOA==", "bodyText": "@trask You have removed this check in another PR, haven't you?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478139508", "createdAt": "2020-08-27T05:30:27Z", "author": {"login": "iNikem"}, "path": "instrumentation/guava-10.0/src/main/java/io/opentelemetry/instrumentation/auto/guava/ListenableFutureInstrumentation.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package datadog.trace.instrumentation.guava10;\n+\n+import static java.util.Collections.singletonMap;\n+import static net.bytebuddy.matcher.ElementMatchers.named;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.util.concurrent.AbstractFuture;\n+import io.grpc.Context;\n+import io.opentelemetry.instrumentation.auto.api.ContextStore;\n+import io.opentelemetry.instrumentation.auto.api.InstrumentationContext;\n+import io.opentelemetry.instrumentation.auto.api.concurrent.ExecutorInstrumentationUtils;\n+import io.opentelemetry.instrumentation.auto.api.concurrent.RunnableWrapper;\n+import io.opentelemetry.instrumentation.auto.api.concurrent.State;\n+import io.opentelemetry.javaagent.tooling.Instrumenter;\n+import java.util.Map;\n+import java.util.concurrent.Executor;\n+import net.bytebuddy.asm.Advice;\n+import net.bytebuddy.description.method.MethodDescription;\n+import net.bytebuddy.description.type.TypeDescription;\n+import net.bytebuddy.matcher.ElementMatcher;\n+import net.bytebuddy.matcher.ElementMatchers;\n+\n+@AutoService(Instrumenter.class)\n+public class ListenableFutureInstrumentation extends Instrumenter.Default {\n+\n+  public ListenableFutureInstrumentation() {\n+    super(\"guava\");\n+  }\n+\n+  @Override\n+  public ElementMatcher<TypeDescription> typeMatcher() {\n+    return named(\"com.google.common.util.concurrent.AbstractFuture\");\n+  }\n+\n+  @Override\n+  public Map<String, String> contextStore() {\n+    return singletonMap(Runnable.class.getName(), State.class.getName());\n+  }\n+\n+  @Override\n+  public Map<? extends ElementMatcher<? super MethodDescription>, String> transformers() {\n+    return singletonMap(\n+        named(\"addListener\").and(ElementMatchers.takesArguments(Runnable.class, Executor.class)),\n+        ListenableFutureInstrumentation.class.getName() + \"$AddListenerAdvice\");\n+  }\n+\n+  public static class AddListenerAdvice {\n+    @Advice.OnMethodEnter(suppress = Throwable.class)\n+    public static State addListenerEnter(\n+        @Advice.Argument(value = 0, readOnly = false) Runnable task,\n+        @Advice.Argument(1) final Executor executor) {\n+      final Context context = Context.current();\n+      final Runnable newTask = RunnableWrapper.wrapIfNeeded(task);\n+      // It is important to check potentially wrapped task if we can instrument task in this\n+      // executor. Some executors do not support wrapped tasks.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTcyMDEyNw==", "bodyText": "yes, thanks, and this comment prompted #1128", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r479720127", "createdAt": "2020-08-30T04:29:26Z", "author": {"login": "trask"}, "path": "instrumentation/guava-10.0/src/main/java/io/opentelemetry/instrumentation/auto/guava/ListenableFutureInstrumentation.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package datadog.trace.instrumentation.guava10;\n+\n+import static java.util.Collections.singletonMap;\n+import static net.bytebuddy.matcher.ElementMatchers.named;\n+\n+import com.google.auto.service.AutoService;\n+import com.google.common.util.concurrent.AbstractFuture;\n+import io.grpc.Context;\n+import io.opentelemetry.instrumentation.auto.api.ContextStore;\n+import io.opentelemetry.instrumentation.auto.api.InstrumentationContext;\n+import io.opentelemetry.instrumentation.auto.api.concurrent.ExecutorInstrumentationUtils;\n+import io.opentelemetry.instrumentation.auto.api.concurrent.RunnableWrapper;\n+import io.opentelemetry.instrumentation.auto.api.concurrent.State;\n+import io.opentelemetry.javaagent.tooling.Instrumenter;\n+import java.util.Map;\n+import java.util.concurrent.Executor;\n+import net.bytebuddy.asm.Advice;\n+import net.bytebuddy.description.method.MethodDescription;\n+import net.bytebuddy.description.type.TypeDescription;\n+import net.bytebuddy.matcher.ElementMatcher;\n+import net.bytebuddy.matcher.ElementMatchers;\n+\n+@AutoService(Instrumenter.class)\n+public class ListenableFutureInstrumentation extends Instrumenter.Default {\n+\n+  public ListenableFutureInstrumentation() {\n+    super(\"guava\");\n+  }\n+\n+  @Override\n+  public ElementMatcher<TypeDescription> typeMatcher() {\n+    return named(\"com.google.common.util.concurrent.AbstractFuture\");\n+  }\n+\n+  @Override\n+  public Map<String, String> contextStore() {\n+    return singletonMap(Runnable.class.getName(), State.class.getName());\n+  }\n+\n+  @Override\n+  public Map<? extends ElementMatcher<? super MethodDescription>, String> transformers() {\n+    return singletonMap(\n+        named(\"addListener\").and(ElementMatchers.takesArguments(Runnable.class, Executor.class)),\n+        ListenableFutureInstrumentation.class.getName() + \"$AddListenerAdvice\");\n+  }\n+\n+  public static class AddListenerAdvice {\n+    @Advice.OnMethodEnter(suppress = Throwable.class)\n+    public static State addListenerEnter(\n+        @Advice.Argument(value = 0, readOnly = false) Runnable task,\n+        @Advice.Argument(1) final Executor executor) {\n+      final Context context = Context.current();\n+      final Runnable newTask = RunnableWrapper.wrapIfNeeded(task);\n+      // It is important to check potentially wrapped task if we can instrument task in this\n+      // executor. Some executors do not support wrapped tasks.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODEzOTUwOA=="}, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTAwNjgyOnYy", "diffSide": "RIGHT", "path": "instrumentation/hystrix-1.4/src/test/groovy/HystrixObservableChainTest.groovy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTozMToyN1rOHH_WvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQwNDoxMzoxOVrOHJfulw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE0MDA5Mg==", "bodyText": "I think both properties should be inside ConfigUtils.updateConfig", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478140092", "createdAt": "2020-08-27T05:31:27Z", "author": {"login": "iNikem"}, "path": "instrumentation/hystrix-1.4/src/test/groovy/HystrixObservableChainTest.groovy", "diffHunk": "@@ -19,13 +19,17 @@ import static io.opentelemetry.auto.test.utils.TraceUtils.runUnderTrace\n \n import com.netflix.hystrix.HystrixObservableCommand\n import io.opentelemetry.auto.test.AgentTestRunner\n+import io.opentelemetry.auto.test.utils.ConfigUtils\n import rx.Observable\n import rx.schedulers.Schedulers\n \n class HystrixObservableChainTest extends AgentTestRunner {\n   static {\n     // Disable so failure testing below doesn't inadvertently change the behavior.\n     System.setProperty(\"hystrix.command.default.circuitBreaker.enabled\", \"false\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTcxOTA2Mw==", "bodyText": "hystrix.command.default.circuitBreaker.enabled is configuration for the library under test, not for the instrumentation under test, so not sure it should be under updateConfig", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r479719063", "createdAt": "2020-08-30T04:13:19Z", "author": {"login": "trask"}, "path": "instrumentation/hystrix-1.4/src/test/groovy/HystrixObservableChainTest.groovy", "diffHunk": "@@ -19,13 +19,17 @@ import static io.opentelemetry.auto.test.utils.TraceUtils.runUnderTrace\n \n import com.netflix.hystrix.HystrixObservableCommand\n import io.opentelemetry.auto.test.AgentTestRunner\n+import io.opentelemetry.auto.test.utils.ConfigUtils\n import rx.Observable\n import rx.schedulers.Schedulers\n \n class HystrixObservableChainTest extends AgentTestRunner {\n   static {\n     // Disable so failure testing below doesn't inadvertently change the behavior.\n     System.setProperty(\"hystrix.command.default.circuitBreaker.enabled\", \"false\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE0MDA5Mg=="}, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTAwNzM0OnYy", "diffSide": "RIGHT", "path": "instrumentation/hystrix-1.4/src/test/groovy/HystrixObservableTest.groovy", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTozMTozN1rOHH_XBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTozMTozN1rOHH_XBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE0MDE2Ng==", "bodyText": "Same here", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478140166", "createdAt": "2020-08-27T05:31:37Z", "author": {"login": "iNikem"}, "path": "instrumentation/hystrix-1.4/src/test/groovy/HystrixObservableTest.groovy", "diffHunk": "@@ -30,6 +31,9 @@ class HystrixObservableTest extends AgentTestRunner {\n   static {\n     // Disable so failure testing below doesn't inadvertently change the behavior.\n     System.setProperty(\"hystrix.command.default.circuitBreaker.enabled\", \"false\")\n+    ConfigUtils.updateConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTAwNzg3OnYy", "diffSide": "RIGHT", "path": "instrumentation/hystrix-1.4/src/test/groovy/HystrixTest.groovy", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTozMTo0N1rOHH_XYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTozMTo0N1rOHH_XYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE0MDI1Ng==", "bodyText": "And here", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478140256", "createdAt": "2020-08-27T05:31:47Z", "author": {"login": "iNikem"}, "path": "instrumentation/hystrix-1.4/src/test/groovy/HystrixTest.groovy", "diffHunk": "@@ -28,6 +29,9 @@ class HystrixTest extends AgentTestRunner {\n   static {\n     // Disable so failure testing below doesn't inadvertently change the behavior.\n     System.setProperty(\"hystrix.command.default.circuitBreaker.enabled\", \"false\")\n+    ConfigUtils.updateConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTAyNjgwOnYy", "diffSide": "RIGHT", "path": "instrumentation/spring/spring-webflux-5.0/spring-webflux-5.0-library/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTozNjo0OVrOHH_jTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTozNjo0OVrOHH_jTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE0MzMxMA==", "bodyText": "This certainly needs javadoc", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478143310", "createdAt": "2020-08-27T05:36:49Z", "author": {"login": "iNikem"}, "path": "instrumentation/spring/spring-webflux-5.0/spring-webflux-5.0-library/src/main/java/io/opentelemetry/instrumentation/spring/webflux/client/SpringWebfluxHttpClientTracer.java", "diffHunk": "@@ -76,4 +87,13 @@ protected String getInstrumentationName() {\n   public Tracer getTracer() {\n     return tracer;\n   }\n+\n+  private static MethodHandle findRawStatusCode() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTAzMjEyOnYy", "diffSide": "RIGHT", "path": "javaagent-tooling/src/test/groovy/io/opentelemetry/javaagent/test/DefaultInstrumenterTest.groovy", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTozODoxOVrOHH_m2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwNTozODoxOVrOHH_m2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE0NDIxNw==", "bodyText": "Why this change? Old code seems better to me :)", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1107#discussion_r478144217", "createdAt": "2020-08-27T05:38:19Z", "author": {"login": "iNikem"}, "path": "javaagent-tooling/src/test/groovy/io/opentelemetry/javaagent/test/DefaultInstrumenterTest.groovy", "diffHunk": "@@ -93,9 +93,8 @@ class DefaultInstrumenterTest extends AgentSpecification {\n \n   def \"configure default sys prop as #value\"() {\n     setup:\n-    ConfigUtils.updateConfig {\n-      System.setProperty(\"otel.integrations.enabled\", value)\n-    }\n+    System.setProperty(\"otel.integrations.enabled\", value)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ec4e36a1248c7c7eefe67687e5ab8f1436af9ab"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4824, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}