{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczODA4MDM2", "number": 156, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODozMToxNFrODgzmpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODozMToxNFrODgzmpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NzI2NTAxOnYy", "diffSide": "RIGHT", "path": "instrumentation/servlet/src/main/java/io/opentelemetry/auto/instrumentation/servlet/dispatcher/RequestDispatcherInstrumentation.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxODozMToxNFrOFrNoYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxOTo1OToxNVrOFrQc-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1NjQxOA==", "bodyText": "Why remove the null check?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/156#discussion_r380856418", "createdAt": "2020-02-18T18:31:14Z", "author": {"login": "tylerbenson"}, "path": "instrumentation/servlet/src/main/java/io/opentelemetry/auto/instrumentation/servlet/dispatcher/RequestDispatcherInstrumentation.java", "diffHunk": "@@ -95,17 +92,15 @@ public static SpanWithScope start(\n     @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n     public static void stop(\n         @Advice.Enter final SpanWithScope spanWithScope,\n-        @Advice.Local(\"_requestSpan\") final Object requestSpan,\n+        @Advice.Local(\"_originalServletSpan\") final Object originalServletSpan,\n         @Advice.Argument(0) final ServletRequest request,\n         @Advice.Thrown final Throwable throwable) {\n       if (spanWithScope == null) {\n         return;\n       }\n \n-      if (requestSpan != null) {\n-        // now add it back...\n-        request.setAttribute(SPAN_ATTRIBUTE, requestSpan);\n-      }\n+      // restore the original servlet span\n+      request.setAttribute(SPAN_ATTRIBUTE, originalServletSpan);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a6c028ee2b309c739d6664f945883ae2a41c1f2"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkwMjY0OA==", "bodyText": "I pushed a clarifying comment just now, does this makes sense?\n// since spanWithScope is non-null here, originalServletSpan must have been set with the prior\n// servlet span (as opposed to remaining unset)", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/156#discussion_r380902648", "createdAt": "2020-02-18T19:59:15Z", "author": {"login": "trask"}, "path": "instrumentation/servlet/src/main/java/io/opentelemetry/auto/instrumentation/servlet/dispatcher/RequestDispatcherInstrumentation.java", "diffHunk": "@@ -95,17 +92,15 @@ public static SpanWithScope start(\n     @Advice.OnMethodExit(onThrowable = Throwable.class, suppress = Throwable.class)\n     public static void stop(\n         @Advice.Enter final SpanWithScope spanWithScope,\n-        @Advice.Local(\"_requestSpan\") final Object requestSpan,\n+        @Advice.Local(\"_originalServletSpan\") final Object originalServletSpan,\n         @Advice.Argument(0) final ServletRequest request,\n         @Advice.Thrown final Throwable throwable) {\n       if (spanWithScope == null) {\n         return;\n       }\n \n-      if (requestSpan != null) {\n-        // now add it back...\n-        request.setAttribute(SPAN_ATTRIBUTE, requestSpan);\n-      }\n+      // restore the original servlet span\n+      request.setAttribute(SPAN_ATTRIBUTE, originalServletSpan);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1NjQxOA=="}, "originalCommit": {"oid": "9a6c028ee2b309c739d6664f945883ae2a41c1f2"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 566, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}