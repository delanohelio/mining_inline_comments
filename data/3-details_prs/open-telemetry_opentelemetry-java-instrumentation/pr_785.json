{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NTMwOTcx", "number": 785, "title": "Update database semantic conventions", "bodyText": "Fix #697\nI'll have a follow-up PR to use the latest SemanticAttributes from opentelemetry-java.\ndb.operation hasn't been updated yet since we need to parse query string in order to determine the database operation.", "createdAt": "2020-07-24T23:38:42Z", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785", "merged": true, "mergeCommit": {"oid": "44fcf8115b140f242272ee5b6b639cd7b728c5b6"}, "closed": true, "closedAt": "2020-07-28T18:55:56Z", "author": {"login": "heyams"}, "timelineItems": {"totalCount": 45, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4MmZ5gH2gAyNDU2NTMwOTcxOmUxMWViNTYwNGU3MjQ5NmM1NzMwOTVjMmNhZDRkMTE2ZjFiZDI1Mzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5ayHNAFqTQ1NjkwMTMwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e11eb5604e72496c573095c2cad4d116f1bd2538", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e11eb5604e72496c573095c2cad4d116f1bd2538", "committedDate": "2020-07-24T23:26:39Z", "message": "Rename db.type to db.system, db.instance to db.name, db.url to db.connection_string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffcb3cb59631f223d589bc3710a6a5ccf9435a90", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ffcb3cb59631f223d589bc3710a6a5ccf9435a90", "committedDate": "2020-07-24T23:30:53Z", "message": "Update parser and tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73321903833367369e56bef0f62d383cf06f5298", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/73321903833367369e56bef0f62d383cf06f5298", "committedDate": "2020-07-24T23:33:56Z", "message": "Merge remote-tracking branch 'upstream/master' into heya/implement-database-semantic-conventions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7354416b5a5b58aef697cfef7bd7a1b8972b9bc", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e7354416b5a5b58aef697cfef7bd7a1b8972b9bc", "committedDate": "2020-07-24T23:59:50Z", "message": "Add jdbc README and fix a typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6a03c02c09b077e7b93bbd70c3610818c7d8bb1", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e6a03c02c09b077e7b93bbd70c3610818c7d8bb1", "committedDate": "2020-07-25T00:06:56Z", "message": "Fix build failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad807d35ab9e7e3bf6824276865250a08027ab8b", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/ad807d35ab9e7e3bf6824276865250a08027ab8b", "committedDate": "2020-07-25T00:11:41Z", "message": "Move README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edfccd38b9222c9441d61e5bebdbaf745ef32323", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/edfccd38b9222c9441d61e5bebdbaf745ef32323", "committedDate": "2020-07-25T00:34:00Z", "message": "Update jdbc README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2215b0f4677a3acc53d33eca55a561fb182d43a1", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/2215b0f4677a3acc53d33eca55a561fb182d43a1", "committedDate": "2020-07-25T00:58:38Z", "message": "Use string constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb9e3ef7c276e93ffcb31f5d25cf88eaf08e4aee", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/cb9e3ef7c276e93ffcb31f5d25cf88eaf08e4aee", "committedDate": "2020-07-25T01:26:24Z", "message": "Fix PutGetTest failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23287bb054d7b0ac60632ba0f13f5e609b4c7114", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/23287bb054d7b0ac60632ba0f13f5e609b4c7114", "committedDate": "2020-07-25T02:04:23Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9541850bfc1d818bf9ff28f519dedcdc77326c4d", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/9541850bfc1d818bf9ff28f519dedcdc77326c4d", "committedDate": "2020-07-25T02:25:39Z", "message": "Force CircleCI to rebuild"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7e1a04f86e7f46d896384276a2aca79b2f85605", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e7e1a04f86e7f46d896384276a2aca79b2f85605", "committedDate": "2020-07-25T17:21:09Z", "message": "Fix instrumentation:spymemcached-2.12:codenarcLatestDepTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7b06a69ab7f56140a228b7427a9f5f7f8a3786d", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/f7b06a69ab7f56140a228b7427a9f5f7f8a3786d", "committedDate": "2020-07-25T18:02:34Z", "message": "Fix missing import statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f2fe9f19d2922852ba21117888cb402f2171857", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/9f2fe9f19d2922852ba21117888cb402f2171857", "committedDate": "2020-07-25T18:20:40Z", "message": "Fix missing import statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c80902dc0a2b6620d3975243ad09dcab4a515b8", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/4c80902dc0a2b6620d3975243ad09dcab4a515b8", "committedDate": "2020-07-25T18:55:27Z", "message": "Fix lettuce-5.1 tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1eb9f791c3fa40083fdefac9b26c33fb5361a9a", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b1eb9f791c3fa40083fdefac9b26c33fb5361a9a", "committedDate": "2020-07-25T19:05:58Z", "message": "Use SemanticAttribute instead of hardcoded strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c51182e0436b4a2edb3501275b25eaef0e4fbebf", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c51182e0436b4a2edb3501275b25eaef0e4fbebf", "committedDate": "2020-07-25T19:32:09Z", "message": "Fix groovy MissingPropertyException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/1e9be03d974acdd8feff39b3b12fab526ad0d308", "committedDate": "2020-07-25T19:48:44Z", "message": "Fix a typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzE0NTI4", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#pullrequestreview-455314528", "createdAt": "2020-07-25T20:37:26Z", "commit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "state": "COMMENTED", "comments": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQyMDozNzoyNlrOG3HSvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQyMTo1MjozMFrOG3Hpdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0NDM1MA==", "bodyText": "i think rename to DbSystem, that way usages will be more descriptive, e.g. DbSystem.MYSQL", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460444350", "createdAt": "2020-07-25T20:37:26Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/Constants.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.auto.bootstrap.instrumentation.jdbc;\n+\n+public final class Constants {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0NTMxOQ==", "bodyText": "updateDbSystem --> toDbSystem (update... sounds like it has side effects)", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460445319", "createdAt": "2020-07-25T20:49:15Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/JDBCConnectionUrlParser.java", "diffHunk": "@@ -885,4 +892,45 @@ private static void populateStandardProperties(\n       }\n     }\n   }\n+\n+  /**\n+   * see {@link <a\n+   * href=\"https://github.com/open-telemetry/opentelemetry-specification/blob/709293fe132709705f0e0dd4252992e87a6ec899/specification/trace/semantic_conventions/database.md\">specification</a>}\n+   */\n+  private static String updateDbSystem(final String type) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 309}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0NTQyOQ==", "bodyText": "\ud83d\udc4d link to latest copy\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * see {@link <a\n          \n          \n            \n               * href=\"https://github.com/open-telemetry/opentelemetry-specification/blob/709293fe132709705f0e0dd4252992e87a6ec899/specification/trace/semantic_conventions/database.md\">specification</a>}\n          \n          \n            \n               * see {@link <a\n          \n          \n            \n               * href=\"https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/database.md\">specification</a>}", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460445429", "createdAt": "2020-07-25T20:50:22Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/JDBCConnectionUrlParser.java", "diffHunk": "@@ -885,4 +892,45 @@ private static void populateStandardProperties(\n       }\n     }\n   }\n+\n+  /**\n+   * see {@link <a\n+   * href=\"https://github.com/open-telemetry/opentelemetry-specification/blob/709293fe132709705f0e0dd4252992e87a6ec899/specification/trace/semantic_conventions/database.md\">specification</a>}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 307}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0NTY3Mw==", "bodyText": "i think we really do want type here (and not system) in order to construct the \"short url\" (which we then use as db.connection_string).\nit looks like this method is only called from one place, so you could pass in the real type here, so you don't have to add another field to DbInfo/Builder", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460445673", "createdAt": "2020-07-25T20:53:51Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/JDBCConnectionUrlParser.java", "diffHunk": "@@ -795,12 +802,12 @@ public static DBInfo parse(String connectionUrl, final Properties props) {\n \n   private static DBInfo withUrl(final DBInfo.Builder builder) {\n     DBInfo info = builder.build();\n-    String type = info.getType();\n-    if (type == null) {\n+    String system = info.getSystem();\n+    if (system == null) {\n       return builder.build();\n     }\n     StringBuilder url = new StringBuilder();\n-    url.append(type);\n+    url.append(system);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 287}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0NTk0Mw==", "bodyText": "link to spec at top here, and only document differences, e.g. the rows in table below with \"not on [database.md]\"", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460445943", "createdAt": "2020-07-25T20:56:45Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/README.md", "diffHunk": "@@ -0,0 +1,42 @@\n+### Notes and well-known identifiers for `db.system`\n+\n+This is a non-exhaustive list of well-known identifiers to be specified for `db.system`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0NjI5Nw==", "bodyText": "can you try reformatting this file in Intellij? i'm not sure why it's not using our .editorconfig", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460446297", "createdAt": "2020-07-25T21:00:57Z", "author": {"login": "trask"}, "path": "instrumentation/elasticsearch/elasticsearch-transport-5.3/src/test/groovy/Elasticsearch53TransportClientTest.groovy", "diffHunk": "@@ -36,257 +37,257 @@ import static io.opentelemetry.trace.Span.Kind.CLIENT\n import static org.elasticsearch.cluster.ClusterName.CLUSTER_NAME_SETTING\n \n class Elasticsearch53TransportClientTest extends AgentTestRunner {\n-  public static final long TIMEOUT = 10000; // 10 seconds\n+    public static final long TIMEOUT = 10000; // 10 seconds", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0NjMzMQ==", "bodyText": "can you try reformatting this file in Intellij? i'm not sure why it's not using our .editorconfig", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460446331", "createdAt": "2020-07-25T21:01:19Z", "author": {"login": "trask"}, "path": "instrumentation/elasticsearch/elasticsearch-transport-5.3/src/test/groovy/springdata/Elasticsearch53SpringRepositoryTest.groovy", "diffHunk": "@@ -30,317 +30,317 @@ import static io.opentelemetry.trace.Span.Kind.CLIENT\n import static io.opentelemetry.trace.Span.Kind.INTERNAL\n \n class Elasticsearch53SpringRepositoryTest extends AgentTestRunner {\n-  // Setting up appContext & repo with @Shared doesn't allow\n-  // spring-data instrumentation to applied.\n-  // To change the timing without adding ugly checks everywhere -\n-  // use a dynamic proxy.  There's probably a more \"groovy\" way to do this.\n+    // Setting up appContext & repo with @Shared doesn't allow", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0NjM2Mw==", "bodyText": "can you try reformatting this file in Intellij? i'm not sure why it's not using our .editorconfig", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460446363", "createdAt": "2020-07-25T21:01:40Z", "author": {"login": "trask"}, "path": "instrumentation/elasticsearch/elasticsearch-transport-5.3/src/test/groovy/springdata/Elasticsearch53SpringTemplateTest.groovy", "diffHunk": "@@ -43,290 +43,290 @@ import static io.opentelemetry.trace.Span.Kind.CLIENT\n import static org.elasticsearch.cluster.ClusterName.CLUSTER_NAME_SETTING\n \n class Elasticsearch53SpringTemplateTest extends AgentTestRunner {\n-  public static final long TIMEOUT = 10000; // 10 seconds\n-\n-  // Some ES actions are not caused by clients and seem to just happen from time to time.\n-  // We will just ignore these actions in traces.\n-  // TODO: check if other ES tests need this protection and potentially pull this into global class\n-  public static final Set<String> IGNORED_ACTIONS = ImmutableSet.of(\"NodesStatsAction\", \"IndicesStatsAction\")\n-\n-  @Shared\n-  Node testNode\n-  @Shared\n-  File esWorkingDir\n-  @Shared\n-  String clusterName = UUID.randomUUID().toString()\n-\n-  @Shared\n-  ElasticsearchTemplate template\n-\n-  def setupSpec() {\n-\n-    esWorkingDir = File.createTempDir(\"test-es-working-dir-\", \"\")\n-    esWorkingDir.deleteOnExit()\n-    println \"ES work dir: $esWorkingDir\"\n-\n-    def settings = Settings.builder()\n-      .put(\"path.home\", esWorkingDir.path)\n-    // Since we use listeners to close spans this should make our span closing deterministic which is good for tests\n-      .put(\"thread_pool.listener.size\", 1)\n-      .put(\"transport.type\", \"netty3\")\n-      .put(\"http.type\", \"netty3\")\n-      .put(CLUSTER_NAME_SETTING.getKey(), clusterName)\n-      .build()\n-    testNode = new Node(new Environment(InternalSettingsPreparer.prepareSettings(settings)), [Netty3Plugin])\n-    testNode.start()\n-    runUnderTrace(\"setup\") {\n-      // this may potentially create multiple requests and therefore multiple spans, so we wrap this call\n-      // into a top level trace to get exactly one trace in the result.\n-      testNode.client().admin().cluster().prepareHealth().setWaitForYellowStatus().execute().actionGet(TIMEOUT)\n-    }\n-    TEST_WRITER.waitForTraces(1)\n-\n-    template = new ElasticsearchTemplate(testNode.client())\n-  }\n+    public static final long TIMEOUT = 10000; // 10 seconds", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0NjQxMw==", "bodyText": "can you try reformatting this file in Intellij? i'm not sure why it's not using our .editorconfig", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460446413", "createdAt": "2020-07-25T21:02:28Z", "author": {"login": "trask"}, "path": "instrumentation/lettuce/lettuce-5.0/src/test/groovy/LettuceAsyncClientTest.groovy", "diffHunk": "@@ -43,459 +44,459 @@ import java.util.function.Function\n import static io.opentelemetry.trace.Span.Kind.CLIENT\n \n class LettuceAsyncClientTest extends AgentTestRunner {\n-  public static final String PEER_NAME = \"localhost\"\n-  public static final String PEER_IP = \"127.0.0.1\"\n-  public static final int DB_INDEX = 0\n-  // Disable autoreconnect so we do not get stray traces popping up on server shutdown\n-  public static final ClientOptions CLIENT_OPTIONS = ClientOptions.builder().autoReconnect(false).build()\n-\n-  @Shared\n-  int port\n-  @Shared\n-  int incorrectPort\n-  @Shared\n-  String dbAddr\n-  @Shared\n-  String dbAddrNonExistent\n-  @Shared\n-  String dbUriNonExistent\n-  @Shared\n-  String embeddedDbUri\n-\n-  @Shared\n-  RedisServer redisServer\n-\n-  @Shared\n-  Map<String, String> testHashMap = [\n-    firstname: \"John\",\n-    lastname : \"Doe\",\n-    age      : \"53\"\n-  ]\n-\n-  RedisClient redisClient\n-  StatefulConnection connection\n-  RedisAsyncCommands<String, ?> asyncCommands\n-  RedisCommands<String, ?> syncCommands\n-\n-  def setupSpec() {\n-    port = PortUtils.randomOpenPort()\n-    incorrectPort = PortUtils.randomOpenPort()\n-    dbAddr = PEER_NAME + \":\" + port + \"/\" + DB_INDEX\n-    dbAddrNonExistent = PEER_NAME + \":\" + incorrectPort + \"/\" + DB_INDEX\n-    dbUriNonExistent = \"redis://\" + dbAddrNonExistent\n-    embeddedDbUri = \"redis://\" + dbAddr\n-\n-    redisServer = RedisServer.builder()\n-    // bind to localhost to avoid firewall popup\n-      .setting(\"bind \" + PEER_NAME)\n-    // set max memory to avoid problems in CI\n-      .setting(\"maxmemory 128M\")\n-      .port(port).build()\n-  }\n-\n-  def setup() {\n-    redisClient = RedisClient.create(embeddedDbUri)\n-\n-    println \"Using redis: $redisServer.args\"\n-    redisServer.start()\n-    redisClient.setOptions(CLIENT_OPTIONS)\n-\n-    connection = redisClient.connect()\n-    asyncCommands = connection.async()\n-    syncCommands = connection.sync()\n-\n-    syncCommands.set(\"TESTKEY\", \"TESTVAL\")\n-\n-    // 1 set + 1 connect trace\n-    TEST_WRITER.waitForTraces(2)\n-    TEST_WRITER.clear()\n-  }\n-\n-  def cleanup() {\n-    connection.close()\n-    redisServer.stop()\n-  }\n-\n-  def \"connect using get on ConnectionFuture\"() {\n-    setup:\n-    RedisClient testConnectionClient = RedisClient.create(embeddedDbUri)\n-    testConnectionClient.setOptions(CLIENT_OPTIONS)\n-\n-    when:\n-    ConnectionFuture connectionFuture = testConnectionClient.connectAsync(StringCodec.UTF8,\n-      new RedisURI(PEER_NAME, port, 3, TimeUnit.SECONDS))\n-    StatefulConnection connection = connectionFuture.get()\n-\n-    then:\n-    connection != null\n-    assertTraces(1) {\n-      trace(0, 1) {\n-        span(0) {\n-          operationName \"CONNECT\"\n-          spanKind CLIENT\n-          errored false\n-          attributes {\n-            \"${SemanticAttributes.NET_PEER_NAME.key()}\" PEER_NAME\n-            \"${SemanticAttributes.NET_PEER_IP.key()}\" PEER_IP\n-            \"${SemanticAttributes.NET_PEER_PORT.key()}\" port\n-            \"${SemanticAttributes.DB_TYPE.key()}\" \"redis\"\n-            \"${SemanticAttributes.DB_STATEMENT.key()}\" \"CONNECT\"\n-            \"db.redis.dbIndex\" 0\n-          }\n-        }\n-      }\n+    public static final String PEER_NAME = \"localhost\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0NjQ0NQ==", "bodyText": "can you try reformatting this file in Intellij? i'm not sure why it's not using our .editorconfig", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460446445", "createdAt": "2020-07-25T21:02:47Z", "author": {"login": "trask"}, "path": "instrumentation/lettuce/lettuce-5.0/src/test/groovy/LettuceReactiveClientTest.groovy", "diffHunk": "@@ -33,394 +34,394 @@ import static io.opentelemetry.auto.test.utils.TraceUtils.runUnderTrace\n import static io.opentelemetry.trace.Span.Kind.CLIENT\n \n class LettuceReactiveClientTest extends AgentTestRunner {\n-  public static final String PEER_HOST = \"localhost\"\n-  public static final String PEER_IP = \"127.0.0.1\"\n-  public static final int DB_INDEX = 0\n-  // Disable autoreconnect so we do not get stray traces popping up on server shutdown\n-  public static final ClientOptions CLIENT_OPTIONS = ClientOptions.builder().autoReconnect(false).build()\n-\n-  @Shared\n-  String embeddedDbUri\n-\n-  @Shared\n-  RedisServer redisServer\n-\n-  RedisClient redisClient\n-  StatefulConnection connection\n-  RedisReactiveCommands<String, ?> reactiveCommands\n-  RedisCommands<String, ?> syncCommands\n-\n-  def setupSpec() {\n-    int port = PortUtils.randomOpenPort()\n-    String dbAddr = PEER_HOST + \":\" + port + \"/\" + DB_INDEX\n-    embeddedDbUri = \"redis://\" + dbAddr\n-\n-    redisServer = RedisServer.builder()\n-    // bind to localhost to avoid firewall popup\n-      .setting(\"bind \" + PEER_HOST)\n-    // set max memory to avoid problems in CI\n-      .setting(\"maxmemory 128M\")\n-      .port(port).build()\n-  }\n-\n-  def setup() {\n-    redisClient = RedisClient.create(embeddedDbUri)\n-\n-    println \"Using redis: $redisServer.args\"\n-    redisServer.start()\n-    redisClient.setOptions(CLIENT_OPTIONS)\n-\n-    connection = redisClient.connect()\n-    reactiveCommands = connection.reactive()\n-    syncCommands = connection.sync()\n-\n-    syncCommands.set(\"TESTKEY\", \"TESTVAL\")\n-\n-    // 1 set + 1 connect trace\n-    TEST_WRITER.waitForTraces(2)\n-    TEST_WRITER.clear()\n-  }\n-\n-  def cleanup() {\n-    connection.close()\n-    redisClient.shutdown()\n-    redisServer.stop()\n-  }\n-\n-  def \"set command with subscribe on a defined consumer\"() {\n-    setup:\n-    def conds = new AsyncConditions()\n-    Consumer<String> consumer = new Consumer<String>() {\n-      @Override\n-      void accept(String res) {\n-        conds.evaluate {\n-          assert res == \"OK\"\n-        }\n-      }\n+    public static final String PEER_HOST = \"localhost\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0NjQ1MA==", "bodyText": "can you try reformatting this file in Intellij? i'm not sure why it's not using our .editorconfig", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460446450", "createdAt": "2020-07-25T21:03:00Z", "author": {"login": "trask"}, "path": "instrumentation/lettuce/lettuce-5.0/src/test/groovy/LettuceSyncClientTest.groovy", "diffHunk": "@@ -30,320 +31,320 @@ import java.util.concurrent.CompletionException\n import static io.opentelemetry.trace.Span.Kind.CLIENT\n \n class LettuceSyncClientTest extends AgentTestRunner {\n-  public static final String PEER_NAME = \"localhost\"\n-  public static final String PEER_IP = \"127.0.0.1\"\n-  public static final int DB_INDEX = 0\n-  // Disable autoreconnect so we do not get stray traces popping up on server shutdown\n-  public static final ClientOptions CLIENT_OPTIONS = ClientOptions.builder().autoReconnect(false).build()\n-\n-  @Shared\n-  int port\n-  @Shared\n-  int incorrectPort\n-  @Shared\n-  String dbAddr\n-  @Shared\n-  String dbAddrNonExistent\n-  @Shared\n-  String dbUriNonExistent\n-  @Shared\n-  String embeddedDbUri\n-\n-  @Shared\n-  RedisServer redisServer\n-\n-  @Shared\n-  Map<String, String> testHashMap = [\n-    firstname: \"John\",\n-    lastname : \"Doe\",\n-    age      : \"53\"\n-  ]\n-\n-  RedisClient redisClient\n-  StatefulConnection connection\n-  RedisCommands<String, ?> syncCommands\n-\n-  def setupSpec() {\n-    port = PortUtils.randomOpenPort()\n-    incorrectPort = PortUtils.randomOpenPort()\n-    dbAddr = PEER_NAME + \":\" + port + \"/\" + DB_INDEX\n-    dbAddrNonExistent = PEER_NAME + \":\" + incorrectPort + \"/\" + DB_INDEX\n-    dbUriNonExistent = \"redis://\" + dbAddrNonExistent\n-    embeddedDbUri = \"redis://\" + dbAddr\n-\n-    redisServer = RedisServer.builder()\n-    // bind to localhost to avoid firewall popup\n-      .setting(\"bind \" + PEER_NAME)\n-    // set max memory to avoid problems in CI\n-      .setting(\"maxmemory 128M\")\n-      .port(port).build()\n-  }\n-\n-  def setup() {\n-    redisClient = RedisClient.create(embeddedDbUri)\n-\n-    redisServer.start()\n-    connection = redisClient.connect()\n-    syncCommands = connection.sync()\n-\n-    syncCommands.set(\"TESTKEY\", \"TESTVAL\")\n-    syncCommands.hmset(\"TESTHM\", testHashMap)\n-\n-    // 2 sets + 1 connect trace\n-    TEST_WRITER.waitForTraces(3)\n-    TEST_WRITER.clear()\n-  }\n-\n-  def cleanup() {\n-    connection.close()\n-    redisServer.stop()\n-  }\n-\n-  def \"connect\"() {\n-    setup:\n-    RedisClient testConnectionClient = RedisClient.create(embeddedDbUri)\n-    testConnectionClient.setOptions(CLIENT_OPTIONS)\n-\n-    when:\n-    StatefulConnection connection = testConnectionClient.connect()\n-\n-    then:\n-    assertTraces(1) {\n-      trace(0, 1) {\n-        span(0) {\n-          operationName \"CONNECT\"\n-          spanKind CLIENT\n-          errored false\n-          attributes {\n-            \"${SemanticAttributes.NET_PEER_NAME.key()}\" PEER_NAME\n-            \"${SemanticAttributes.NET_PEER_IP.key()}\" PEER_IP\n-            \"${SemanticAttributes.NET_PEER_PORT.key()}\" port\n-            \"${SemanticAttributes.DB_TYPE.key()}\" \"redis\"\n-            \"${SemanticAttributes.DB_STATEMENT.key()}\" \"CONNECT\"\n-            \"db.redis.dbIndex\" 0\n-          }\n+    public static final String PEER_NAME = \"localhost\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0ODcxOA==", "bodyText": "this happens to match the constant, but is not really related to db_system (this is why I recommended to rename Constants to DbSystem above to make this more clear where to use it)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                super(\"jedis\", Constants.REDIS);\n          \n          \n            \n                super(\"jedis\", \"redis\");", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460448718", "createdAt": "2020-07-25T21:31:52Z", "author": {"login": "trask"}, "path": "instrumentation/jedis/jedis-1.4/src/main/java/io/opentelemetry/auto/instrumentation/jedis/v1_4/JedisInstrumentation.java", "diffHunk": "@@ -44,7 +45,7 @@\n public final class JedisInstrumentation extends Instrumenter.Default {\n \n   public JedisInstrumentation() {\n-    super(\"jedis\", \"redis\");\n+    super(\"jedis\", Constants.REDIS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0ODk5Nw==", "bodyText": "this happens when Intellij wraps our end-of-line comments. usually i move the eol comment above the line, but in this case i don't think the comment is very helpful, so suggest we just delete it\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        // Optional", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460448997", "createdAt": "2020-07-25T21:35:35Z", "author": {"login": "trask"}, "path": "instrumentation/vertx-reactive-3.5/src/test/groovy/VertxReactivePropagationTest.groovy", "diffHunk": "@@ -68,7 +69,8 @@ class VertxReactivePropagationTest extends AgentTestRunner {\n           parent()\n           attributes {\n             \"${SemanticAttributes.NET_PEER_PORT.key()}\" Long\n-            \"${SemanticAttributes.NET_PEER_IP.key()}\" { it == null || it == \"127.0.0.1\" } // Optional\n+            \"${SemanticAttributes.NET_PEER_IP.key()}\" { it == null || it == \"127.0.0.1\" }\n+            // Optional", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0OTE4OA==", "bodyText": "this happens to match the constant, but is not really related to db_system\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                super(\"jedis\", Constants.REDIS);\n          \n          \n            \n                super(\"jedis\", \"redis\");", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460449188", "createdAt": "2020-07-25T21:38:28Z", "author": {"login": "trask"}, "path": "instrumentation/jedis/jedis-3.0/src/main/java/io/opentelemetry/auto/instrumentation/jedis/v3_0/JedisInstrumentation.java", "diffHunk": "@@ -44,7 +45,7 @@\n public final class JedisInstrumentation extends Instrumenter.Default {\n \n   public JedisInstrumentation() {\n-    super(\"jedis\", \"redis\");\n+    super(\"jedis\", Constants.REDIS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ0OTIxMg==", "bodyText": "this happens to match the constant, but is not really related to db_system\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                super(\"rediscala\", Constants.REDIS);\n          \n          \n            \n                super(\"rediscala\", \"redis\");", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460449212", "createdAt": "2020-07-25T21:38:50Z", "author": {"login": "trask"}, "path": "instrumentation/rediscala-1.8/src/main/java/io/opentelemetry/auto/instrumentation/rediscala/RediscalaInstrumentation.java", "diffHunk": "@@ -49,7 +50,7 @@\n public final class RediscalaInstrumentation extends Instrumenter.Default {\n \n   public RediscalaInstrumentation() {\n-    super(\"rediscala\", \"redis\");\n+    super(\"rediscala\", Constants.REDIS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ1MDE2Nw==", "bodyText": "something like (see comment below), also probably still want typeParsers key to be type and not system\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String baseSystem = jdbcUrl.substring(0, typeLoc);\n          \n          \n            \n                baseSystem = updateDbSystem(baseSystem);\n          \n          \n            \n                String type = jdbcUrl.substring(0, typeLoc); \n          \n          \n            \n                String system = updateDbSystem(type);", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r460450167", "createdAt": "2020-07-25T21:52:30Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/JDBCConnectionUrlParser.java", "diffHunk": "@@ -777,14 +783,15 @@ public static DBInfo parse(String connectionUrl, final Properties props) {\n       return DEFAULT;\n     }\n \n-    String baseType = jdbcUrl.substring(0, typeLoc);\n-    DBInfo.Builder parsedProps = DEFAULT.toBuilder().type(baseType);\n+    String baseSystem = jdbcUrl.substring(0, typeLoc);\n+    baseSystem = updateDbSystem(baseSystem);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e9be03d974acdd8feff39b3b12fab526ad0d308"}, "originalPosition": 262}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a95e038cb7e23bee2ec130bf4e11e0cfa0e77d03", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a95e038cb7e23bee2ec130bf4e11e0cfa0e77d03", "committedDate": "2020-07-27T16:53:00Z", "message": "Rename Constants.java to DbSystem.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6668509213869bf23141f8255febf189cd34f3b0", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/6668509213869bf23141f8255febf189cd34f3b0", "committedDate": "2020-07-27T16:54:51Z", "message": "Rename updateDbSystem to toDbSystem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15701f282f20999de06ffae82f803ea75333c7a2", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/15701f282f20999de06ffae82f803ea75333c7a2", "committedDate": "2020-07-27T17:14:35Z", "message": "Link the latest copy of database.md\n\nCo-authored-by: Trask Stalnaker <trask.stalnaker@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c94175f03e1d9c0c21311aa4f2c730a2044ca996", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c94175f03e1d9c0c21311aa4f2c730a2044ca996", "committedDate": "2020-07-27T17:32:01Z", "message": "Only show differences in JDBC README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0484cec3e0c06c42b49baf8e98ba66fdd37851e", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c0484cec3e0c06c42b49baf8e98ba66fdd37851e", "committedDate": "2020-07-27T17:45:00Z", "message": "Address code review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28203368adc82fabed0fae8adb664f24cb7eb224", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/28203368adc82fabed0fae8adb664f24cb7eb224", "committedDate": "2020-07-27T17:45:18Z", "message": "Merge branch 'heya/implement-database-semantic-conventions' of https://github.com/heyams/opentelemetry-java-instrumentation into heya/implement-database-semantic-conventions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a90fc8168dc0e06639e7d10359985aa12db08ea0", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/a90fc8168dc0e06639e7d10359985aa12db08ea0", "committedDate": "2020-07-27T18:46:38Z", "message": "Reformat groovy files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/72b73a12b2baa62754eaf25dbde053df84617043", "committedDate": "2020-07-27T22:27:12Z", "message": "Keep type to parsers\n\nKeep subtype for mssqlparser and update its tests\n\nAddress other code review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MTgwMDEw", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#pullrequestreview-456180010", "createdAt": "2020-07-27T22:31:04Z", "commit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043"}, "state": "COMMENTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMjozMTowNFrOG313qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QyMzowODo1N1rOG32tjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIwNzQ2Nw==", "bodyText": "i think better not to compare driver type to db.system constant, e.g. if the spec could change the db.system constant, but that wouldn't change the driver type\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  if (type.equals(DbSystem.DB2) || type.equals(DbSystem.AS400)) {\n          \n          \n            \n                  if (type.equals(\"db2\") || type.equals(\"as400\")) {", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461207467", "createdAt": "2020-07-27T22:31:04Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/JDBCConnectionUrlParser.java", "diffHunk": "@@ -138,7 +138,7 @@\n       type = jdbcUrl.substring(0, hostIndex);\n \n       String[] split;\n-      if (type.equals(\"db2\") || type.equals(\"as400\")) {\n+      if (type.equals(DbSystem.DB2) || type.equals(DbSystem.AS400)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxNzI2Nw==", "bodyText": "i think this matches other parsing a bit better:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  int typeLoc = jdbcUrl.indexOf(\":\"); // type\n          \n          \n            \n                  int subtypeLoc = jdbcUrl.indexOf(\":\", typeLoc + 1); // subtype\n          \n          \n            \n                  int hostLoc = jdbcUrl.indexOf(\"//\");\n          \n          \n            \n                  if (subtypeLoc != -1 && typeLoc != -1 && typeLoc < subtypeLoc && subtypeLoc < hostLoc) {\n          \n          \n            \n                    String subtype = jdbcUrl.substring(typeLoc + 1, subtypeLoc);\n          \n          \n            \n                  int protoLoc = jdbcUrl.indexOf(\"://\");\n          \n          \n            \n                  int typeEndLoc = jdbcUrl.indexOf(':');\n          \n          \n            \n                  if (protoLoc > typeEndLoc) {\n          \n          \n            \n                    String subtype = jdbcUrl.substring(typeEndLoc + 1, protoLoc);", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461217267", "createdAt": "2020-07-27T22:57:44Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/JDBCConnectionUrlParser.java", "diffHunk": "@@ -367,13 +367,16 @@\n         builder.port(DEFAULT_PORT);\n       }\n \n-      if (jdbcUrl.startsWith(\"microsoft:\")) {\n-        jdbcUrl = jdbcUrl.substring(\"microsoft:\".length());\n-      } else if (jdbcUrl.startsWith(\"jtds:\")) {\n-        return JTDS_URL_LIKE.doParse(jdbcUrl, builder);\n+      int typeLoc = jdbcUrl.indexOf(\":\"); // type\n+      int subtypeLoc = jdbcUrl.indexOf(\":\", typeLoc + 1); // subtype\n+      int hostLoc = jdbcUrl.indexOf(\"//\");\n+      if (subtypeLoc != -1 && typeLoc != -1 && typeLoc < subtypeLoc && subtypeLoc < hostLoc) {\n+        String subtype = jdbcUrl.substring(typeLoc + 1, subtypeLoc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxODk2NQ==", "bodyText": "Intellij flags this as unused, can be used in GeodeDecorator", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461218965", "createdAt": "2020-07-27T23:02:26Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/DbSystem.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.auto.bootstrap.instrumentation.jdbc;\n+\n+public final class DbSystem {\n+\n+  public static final String AS400 = \"as400\";\n+  public static final String CASSANDRA = \"cassandra\";\n+  public static final String COSMOSDB = \"cosmosdb\";\n+  public static final String COUCHBASE = \"couchbase\";\n+  public static final String COUCHDB = \"couchdb\";\n+  public static final String DB2 = \"db2\";\n+  public static final String DERBY = \"derby\";\n+  public static final String DYNAMODB = \"dynamodb\";\n+  public static final String GEODE = \"geode\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxOTI0MA==", "bodyText": "let's only include jdbc drivers here that we have parsing/tests for now\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  case DbSystem.CASSANDRA: // Cassandra\n          \n          \n            \n                  case DbSystem.COSMOSDB: // Microsoft Azure Cosmos DB\n          \n          \n            \n                  case DbSystem.COUCHBASE: // Couchbase\n          \n          \n            \n                  case DbSystem.COUCHDB: // CouchDB", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461219240", "createdAt": "2020-07-27T23:03:13Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/JDBCConnectionUrlParser.java", "diffHunk": "@@ -885,4 +885,45 @@ private static void populateStandardProperties(\n       }\n     }\n   }\n+\n+  /**\n+   * see {@link <a\n+   * href=\"https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/database.md\">specification</a>}\n+   */\n+  private static String toDbSystem(final String type) {\n+    switch (type) {\n+      case DbSystem.AS400: // IBM AS400 Database\n+      case DbSystem.CASSANDRA: // Cassandra\n+      case DbSystem.COSMOSDB: // Microsoft Azure Cosmos DB\n+      case DbSystem.COUCHBASE: // Couchbase\n+      case DbSystem.COUCHDB: // CouchDB", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043"}, "originalPosition": 257}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxOTMzOA==", "bodyText": "same\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  case DbSystem.MONGODB: // MongoDB", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461219338", "createdAt": "2020-07-27T23:03:29Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/JDBCConnectionUrlParser.java", "diffHunk": "@@ -885,4 +885,45 @@ private static void populateStandardProperties(\n       }\n     }\n   }\n+\n+  /**\n+   * see {@link <a\n+   * href=\"https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/database.md\">specification</a>}\n+   */\n+  private static String toDbSystem(final String type) {\n+    switch (type) {\n+      case DbSystem.AS400: // IBM AS400 Database\n+      case DbSystem.CASSANDRA: // Cassandra\n+      case DbSystem.COSMOSDB: // Microsoft Azure Cosmos DB\n+      case DbSystem.COUCHBASE: // Couchbase\n+      case DbSystem.COUCHDB: // CouchDB\n+      case DbSystem.DB2: // IBM Db2\n+      case DbSystem.DERBY: // Apache Derby\n+      case DbSystem.H2: // H2 Database\n+      case DbSystem.HSQLDB: // Hyper SQL Database\n+      case DbSystem.MARIADB: // MariaDB\n+      case DbSystem.MONGODB: // MongoDB", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043"}, "originalPosition": 263}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIxOTY0Mw==", "bodyText": "same\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  case DbSystem.NEO4J: // Neo4j", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461219643", "createdAt": "2020-07-27T23:04:17Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/JDBCConnectionUrlParser.java", "diffHunk": "@@ -885,4 +885,45 @@ private static void populateStandardProperties(\n       }\n     }\n   }\n+\n+  /**\n+   * see {@link <a\n+   * href=\"https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/database.md\">specification</a>}\n+   */\n+  private static String toDbSystem(final String type) {\n+    switch (type) {\n+      case DbSystem.AS400: // IBM AS400 Database\n+      case DbSystem.CASSANDRA: // Cassandra\n+      case DbSystem.COSMOSDB: // Microsoft Azure Cosmos DB\n+      case DbSystem.COUCHBASE: // Couchbase\n+      case DbSystem.COUCHDB: // CouchDB\n+      case DbSystem.DB2: // IBM Db2\n+      case DbSystem.DERBY: // Apache Derby\n+      case DbSystem.H2: // H2 Database\n+      case DbSystem.HSQLDB: // Hyper SQL Database\n+      case DbSystem.MARIADB: // MariaDB\n+      case DbSystem.MONGODB: // MongoDB\n+      case DbSystem.MYSQL: // MySQL\n+      case DbSystem.NEO4J: // Neo4j", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043"}, "originalPosition": 265}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIyMDI4Ng==", "bodyText": "same\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  case DbSystem.REDIS: // Redis\n          \n          \n            \n                  case DbSystem.SAP: // SAP HANA\n          \n          \n            \n                  case DbSystem.SQLITE: // SQLite\n          \n          \n            \n                  case DbSystem.TERADATA: // Teradata", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461220286", "createdAt": "2020-07-27T23:06:07Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/JDBCConnectionUrlParser.java", "diffHunk": "@@ -885,4 +885,45 @@ private static void populateStandardProperties(\n       }\n     }\n   }\n+\n+  /**\n+   * see {@link <a\n+   * href=\"https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/database.md\">specification</a>}\n+   */\n+  private static String toDbSystem(final String type) {\n+    switch (type) {\n+      case DbSystem.AS400: // IBM AS400 Database\n+      case DbSystem.CASSANDRA: // Cassandra\n+      case DbSystem.COSMOSDB: // Microsoft Azure Cosmos DB\n+      case DbSystem.COUCHBASE: // Couchbase\n+      case DbSystem.COUCHDB: // CouchDB\n+      case DbSystem.DB2: // IBM Db2\n+      case DbSystem.DERBY: // Apache Derby\n+      case DbSystem.H2: // H2 Database\n+      case DbSystem.HSQLDB: // Hyper SQL Database\n+      case DbSystem.MARIADB: // MariaDB\n+      case DbSystem.MONGODB: // MongoDB\n+      case DbSystem.MYSQL: // MySQL\n+      case DbSystem.NEO4J: // Neo4j\n+      case DbSystem.ORACLE: // Oracle Database\n+      case DbSystem.POSTGRESQL: // PostgreSQL\n+      case DbSystem.REDIS: // Redis\n+      case DbSystem.SAP: // SAP HANA\n+      case DbSystem.SQLITE: // SQLite\n+      case DbSystem.TERADATA: // Teradata", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043"}, "originalPosition": 271}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIyMDQ2MQ==", "bodyText": "same\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  case \"apachehbase\": // Apache HBase\n          \n          \n            \n                    return DbSystem.HBASE;\n          \n          \n            \n                  case \"amazondynamodb\": // Amazon DynamoDB\n          \n          \n            \n                    return DbSystem.DYNAMODB;\n          \n          \n            \n                  case \"hive2\": // Apache Hive\n          \n          \n            \n                    return DbSystem.HIVE;", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461220461", "createdAt": "2020-07-27T23:06:36Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/JDBCConnectionUrlParser.java", "diffHunk": "@@ -885,4 +885,45 @@ private static void populateStandardProperties(\n       }\n     }\n   }\n+\n+  /**\n+   * see {@link <a\n+   * href=\"https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/database.md\">specification</a>}\n+   */\n+  private static String toDbSystem(final String type) {\n+    switch (type) {\n+      case DbSystem.AS400: // IBM AS400 Database\n+      case DbSystem.CASSANDRA: // Cassandra\n+      case DbSystem.COSMOSDB: // Microsoft Azure Cosmos DB\n+      case DbSystem.COUCHBASE: // Couchbase\n+      case DbSystem.COUCHDB: // CouchDB\n+      case DbSystem.DB2: // IBM Db2\n+      case DbSystem.DERBY: // Apache Derby\n+      case DbSystem.H2: // H2 Database\n+      case DbSystem.HSQLDB: // Hyper SQL Database\n+      case DbSystem.MARIADB: // MariaDB\n+      case DbSystem.MONGODB: // MongoDB\n+      case DbSystem.MYSQL: // MySQL\n+      case DbSystem.NEO4J: // Neo4j\n+      case DbSystem.ORACLE: // Oracle Database\n+      case DbSystem.POSTGRESQL: // PostgreSQL\n+      case DbSystem.REDIS: // Redis\n+      case DbSystem.SAP: // SAP HANA\n+      case DbSystem.SQLITE: // SQLite\n+      case DbSystem.TERADATA: // Teradata\n+        return type;\n+      case \"apachehbase\": // Apache HBase\n+        return DbSystem.HBASE;\n+      case \"amazondynamodb\": // Amazon DynamoDB\n+        return DbSystem.DYNAMODB;\n+      case \"hive2\": // Apache Hive\n+        return DbSystem.HIVE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043"}, "originalPosition": 278}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIyMDc2Mw==", "bodyText": "unused for now\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | `\"sap\"`               | SAP                       | not on [database.md]           |", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461220763", "createdAt": "2020-07-27T23:07:28Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/README.md", "diffHunk": "@@ -0,0 +1,12 @@\n+`db.system`\n+\n+The latest specification for `db.system` is [database.md].\n+\n+[database.md]: https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/database.md\n+\n+| Value for `db.system` | Product name              | Note                           |\n+| :-------------------- | :------------------------ | :----------------------------- |\n+| `\"as400\"`             | IBM AS400 Database        | not on [database.md]           |\n+| `\"h2\"`                | H2 Database               | not on [database.md]           |\n+| `\"hsqldb\"`            | Hyper SQL Database        | not on [database.md]           |\n+| `\"sap\"`               | SAP                       | not on [database.md]           |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIyMTI2MA==", "bodyText": "let's remove this and map it to db2\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | `\"as400\"`             | IBM AS400 Database        | not on [database.md]           |", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461221260", "createdAt": "2020-07-27T23:08:57Z", "author": {"login": "trask"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/jdbc/README.md", "diffHunk": "@@ -0,0 +1,12 @@\n+`db.system`\n+\n+The latest specification for `db.system` is [database.md].\n+\n+[database.md]: https://github.com/open-telemetry/opentelemetry-specification/blob/master/specification/trace/semantic_conventions/database.md\n+\n+| Value for `db.system` | Product name              | Note                           |\n+| :-------------------- | :------------------------ | :----------------------------- |\n+| `\"as400\"`             | IBM AS400 Database        | not on [database.md]           |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72b73a12b2baa62754eaf25dbde053df84617043"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f6c1a6a16c0bdc4d30c79d9699b1991894fdb9a", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/5f6c1a6a16c0bdc4d30c79d9699b1991894fdb9a", "committedDate": "2020-07-27T23:22:57Z", "message": "Separate driver type from db.system.\n\nCo-authored-by: Trask Stalnaker <trask.stalnaker@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "778a6ab6d1231ee5d217749fd93b113809bc8fa0", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/778a6ab6d1231ee5d217749fd93b113809bc8fa0", "committedDate": "2020-07-27T23:24:35Z", "message": "Use a consistent parsing for subtype.\n\nCo-authored-by: Trask Stalnaker <trask.stalnaker@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c49ba6adfc24a70712abb0e72bdd650650cc6da", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/6c49ba6adfc24a70712abb0e72bdd650650cc6da", "committedDate": "2020-07-27T23:47:35Z", "message": "Keep db.system for jdcb drivers only\n\nMap as400 to db2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9c05014c1265af2ffa064b050b94b5e6f63e7ff", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/c9c05014c1265af2ffa064b050b94b5e6f63e7ff", "committedDate": "2020-07-27T23:58:42Z", "message": "Fix SlickTest failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13bbedecc10872787392775d6e94564f1d708ea8", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/13bbedecc10872787392775d6e94564f1d708ea8", "committedDate": "2020-07-28T00:02:26Z", "message": "Update JDBC README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e1a495d9af44c8731663d3de10f6b96e58bbfe1", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/5e1a495d9af44c8731663d3de10f6b96e58bbfe1", "committedDate": "2020-07-28T00:07:23Z", "message": "Delete unused DbSystem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7a0a8f3f05a3f7b277bc8f4993a840d9e2fb9e8", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b7a0a8f3f05a3f7b277bc8f4993a840d9e2fb9e8", "committedDate": "2020-07-28T00:25:59Z", "message": "Don't use DbSystem constants for jdbc driver types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8578b8b45f3070006e717565e0ac6cbc28425953", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/8578b8b45f3070006e717565e0ac6cbc28425953", "committedDate": "2020-07-28T00:29:06Z", "message": "Remove unused AS400 string constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cb049d1af75c67ec00907e3668e3c0a4b37c85c", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/9cb049d1af75c67ec00907e3668e3c0a4b37c85c", "committedDate": "2020-07-28T01:00:38Z", "message": "Fix hibernate test failures"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MjUyNjU5", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#pullrequestreview-456252659", "createdAt": "2020-07-28T02:06:00Z", "commit": {"oid": "9cb049d1af75c67ec00907e3668e3c0a4b37c85c"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwMjowNjowMVrOG356yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwMjoxMDo1M1rOG35_7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI3MzgwMg==", "bodyText": "since not really tied to DbSystem constant\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                super(DbSystem.CASSANDRA);\n          \n          \n            \n                super(\"cassandra\");", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461273802", "createdAt": "2020-07-28T02:06:01Z", "author": {"login": "trask"}, "path": "instrumentation/cassandra/cassandra-3.0/src/main/java/io/opentelemetry/auto/instrumentation/cassandra/v3_0/CassandraClientInstrumentation.java", "diffHunk": "@@ -35,7 +36,7 @@\n public class CassandraClientInstrumentation extends Instrumenter.Default {\n \n   public CassandraClientInstrumentation() {\n-    super(\"cassandra\");\n+    super(DbSystem.CASSANDRA);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cb049d1af75c67ec00907e3668e3c0a4b37c85c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI3MzkyOA==", "bodyText": "same\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                super(DbSystem.CASSANDRA);\n          \n          \n            \n                super(\"cassandra\");", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461273928", "createdAt": "2020-07-28T02:06:28Z", "author": {"login": "trask"}, "path": "instrumentation/cassandra/cassandra-4.0/src/main/java/io/opentelemetry/auto/instrumentation/cassandra/v4_0/CassandraClientInstrumentation.java", "diffHunk": "@@ -33,7 +34,7 @@\n public class CassandraClientInstrumentation extends Instrumenter.Default {\n \n   public CassandraClientInstrumentation() {\n-    super(\"cassandra\");\n+    super(DbSystem.CASSANDRA);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cb049d1af75c67ec00907e3668e3c0a4b37c85c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI3NDA1MQ==", "bodyText": "same\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                super(DbSystem.COUCHBASE);\n          \n          \n            \n                super(\"couchbase\");", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461274051", "createdAt": "2020-07-28T02:06:50Z", "author": {"login": "trask"}, "path": "instrumentation/couchbase/couchbase-2.0/src/main/java/io/opentelemetry/auto/instrumentation/couchbase/v2_0/CouchbaseBucketInstrumentation.java", "diffHunk": "@@ -40,7 +41,7 @@\n public class CouchbaseBucketInstrumentation extends Instrumenter.Default {\n \n   public CouchbaseBucketInstrumentation() {\n-    super(\"couchbase\");\n+    super(DbSystem.COUCHBASE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cb049d1af75c67ec00907e3668e3c0a4b37c85c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI3NDExMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                super(DbSystem.COUCHBASE);\n          \n          \n            \n                super(\"couchbase\");", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461274112", "createdAt": "2020-07-28T02:07:04Z", "author": {"login": "trask"}, "path": "instrumentation/couchbase/couchbase-2.0/src/main/java/io/opentelemetry/auto/instrumentation/couchbase/v2_0/CouchbaseClusterInstrumentation.java", "diffHunk": "@@ -40,7 +41,7 @@\n public class CouchbaseClusterInstrumentation extends Instrumenter.Default {\n \n   public CouchbaseClusterInstrumentation() {\n-    super(\"couchbase\");\n+    super(DbSystem.COUCHBASE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cb049d1af75c67ec00907e3668e3c0a4b37c85c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI3NDIwMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                super(DbSystem.COUCHBASE);\n          \n          \n            \n                super(\"couchbase\");", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461274202", "createdAt": "2020-07-28T02:07:25Z", "author": {"login": "trask"}, "path": "instrumentation/couchbase/couchbase-2.6/src/main/java/io/opentelemetry/auto/instrumentation/couchbase/v2_6/CouchbaseCoreInstrumentation.java", "diffHunk": "@@ -40,7 +41,7 @@\n public class CouchbaseCoreInstrumentation extends Instrumenter.Default {\n \n   public CouchbaseCoreInstrumentation() {\n-    super(\"couchbase\");\n+    super(DbSystem.COUCHBASE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cb049d1af75c67ec00907e3668e3c0a4b37c85c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI3NDI1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                super(DbSystem.COUCHBASE);\n          \n          \n            \n                super(\"couchbase\");", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461274253", "createdAt": "2020-07-28T02:07:37Z", "author": {"login": "trask"}, "path": "instrumentation/couchbase/couchbase-2.6/src/main/java/io/opentelemetry/auto/instrumentation/couchbase/v2_6/CouchbaseNetworkInstrumentation.java", "diffHunk": "@@ -43,7 +44,7 @@\n @AutoService(Instrumenter.class)\n public class CouchbaseNetworkInstrumentation extends Instrumenter.Default {\n   public CouchbaseNetworkInstrumentation() {\n-    super(\"couchbase\");\n+    super(DbSystem.COUCHBASE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cb049d1af75c67ec00907e3668e3c0a4b37c85c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI3NDg3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                super(\"jedis\", DbSystem.REDIS);\n          \n          \n            \n                super(\"jedis\", \"redis\");", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461274878", "createdAt": "2020-07-28T02:10:04Z", "author": {"login": "trask"}, "path": "instrumentation/jedis/jedis-3.0/src/main/java/io/opentelemetry/auto/instrumentation/jedis/v3_0/JedisInstrumentation.java", "diffHunk": "@@ -44,7 +45,7 @@\n public final class JedisInstrumentation extends Instrumenter.Default {\n \n   public JedisInstrumentation() {\n-    super(\"jedis\", \"redis\");\n+    super(\"jedis\", DbSystem.REDIS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cb049d1af75c67ec00907e3668e3c0a4b37c85c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI3NTExOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          .spanBuilder(DbSystem.REDIS)\n          \n          \n            \n                          .spanBuilder(\"REDIS\")", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461275118", "createdAt": "2020-07-28T02:10:53Z", "author": {"login": "trask"}, "path": "instrumentation/lettuce/lettuce-5.1/src/main/java/io/opentelemetry/auto/instrumentation/lettuce/v5_1/OpenTelemetryTracing.java", "diffHunk": "@@ -167,10 +169,10 @@ public OpenTelemetrySpan nextSpan(TraceContext traceContext) {\n       // the span starts.\n       spanBuilder =\n           TRACER\n-              .spanBuilder(\"REDIS\")\n+              .spanBuilder(DbSystem.REDIS)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cb049d1af75c67ec00907e3668e3c0a4b37c85c"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "389e1e9cf824558a2fc85022695ffed93864b68a", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/389e1e9cf824558a2fc85022695ffed93864b68a", "committedDate": "2020-07-28T16:52:28Z", "message": "Fix misusing DbSystem constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6f33cde46dd21ad3c29950e55fb8e17ad340859", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/e6f33cde46dd21ad3c29950e55fb8e17ad340859", "committedDate": "2020-07-28T16:55:51Z", "message": "Fix misusing DbSystem.REDIS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0ad7324c49722b02f8b090a386aea5af8a81ae1", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/d0ad7324c49722b02f8b090a386aea5af8a81ae1", "committedDate": "2020-07-28T16:59:42Z", "message": "Merge remote-tracking branch 'upstream/master' into heya/implement-database-semantic-conventions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODQ1Njg3", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#pullrequestreview-456845687", "createdAt": "2020-07-28T17:17:42Z", "commit": {"oid": "d0ad7324c49722b02f8b090a386aea5af8a81ae1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80c55914a2fab04dd411b4d416d5b167e20b612a", "author": {"user": {"login": "heyams", "name": "Helen Y."}}, "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/80c55914a2fab04dd411b4d416d5b167e20b612a", "committedDate": "2020-07-28T17:51:41Z", "message": "Fix mongodb tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2ODk4NTM3", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#pullrequestreview-456898537", "createdAt": "2020-07-28T18:28:09Z", "commit": {"oid": "80c55914a2fab04dd411b4d416d5b167e20b612a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODoyODowOVrOG4ZLSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxODoyODowOVrOG4ZLSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc4NTkzMQ==", "bodyText": "This seems to be used in a lot of places.  Perhaps it should be created once somewhere and reused?", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#discussion_r461785931", "createdAt": "2020-07-28T18:28:09Z", "author": {"login": "tylerbenson"}, "path": "agent-bootstrap/src/main/java/io/opentelemetry/auto/bootstrap/instrumentation/decorator/DatabaseClientDecorator.java", "diffHunk": "@@ -18,26 +18,27 @@\n \n import io.opentelemetry.trace.Span;\n import io.opentelemetry.trace.attributes.SemanticAttributes;\n+import io.opentelemetry.trace.attributes.StringAttributeSetter;\n \n /** @deprecated use {@link DatabaseClientTracer} instead. */\n @Deprecated\n public abstract class DatabaseClientDecorator<CONNECTION> extends ClientDecorator {\n \n-  protected abstract String dbType();\n+  protected abstract String dbSystem();\n \n   protected abstract String dbUser(CONNECTION connection);\n \n-  protected abstract String dbInstance(CONNECTION connection);\n+  protected abstract String dbName(CONNECTION connection);\n \n   // TODO make abstract after implementing in all subclasses\n-  protected String dbUrl(final CONNECTION connection) {\n+  protected String dbConnectionString(final CONNECTION connection) {\n     return null;\n   }\n \n   @Override\n   public Span afterStart(final Span span) {\n     assert span != null;\n-    span.setAttribute(SemanticAttributes.DB_TYPE.key(), dbType());\n+    span.setAttribute(StringAttributeSetter.create(\"db.system\").key(), dbSystem());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80c55914a2fab04dd411b4d416d5b167e20b612a"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTAxMzAy", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/785#pullrequestreview-456901302", "createdAt": "2020-07-28T18:32:02Z", "commit": {"oid": "80c55914a2fab04dd411b4d416d5b167e20b612a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2852, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}