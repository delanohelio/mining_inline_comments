{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MTU5NjQ3", "number": 1226, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMzo1MDoxMVrODWZy7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMDoyMjozNFrODWaGZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0ODE3OTAxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMzo1MDoxMVrOFbJOkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMTowNzo0MlrOFbKVAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAwNzA1Nw==", "bodyText": "I don't really think this is a relevant check, but a better way would be to catch the array index out of bounds exception and rethrow.", "url": "https://github.com/microsoft/mssql-jdbc/pull/1226#discussion_r364007057", "createdAt": "2020-01-07T23:50:11Z", "author": {"login": "rene-ye"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java", "diffHunk": "@@ -3776,7 +3776,14 @@ void writeString(String value) throws SQLServerException {\n             while (bytesCopied < bytesToCopy) {\n                 char ch = value.charAt(charsCopied++);\n                 valueBytes[bytesCopied++] = (byte) ((ch >> 0) & 0xFF);\n-                valueBytes[bytesCopied++] = (byte) ((ch >> 8) & 0xFF);\n+\n+                if (bytesCopied > bytesToCopy) {\n+                    MessageFormat form = new MessageFormat(SQLServerException.getErrString(\"R_indexOutOfRange\"));\n+                    Object[] msgArgs = {bytesCopied};\n+                    error(form.format(msgArgs), SQLState.DATA_EXCEPTION_NOT_SPECIFIC, DriverError.NOT_SET);\n+                }\n+                valueBytes[bytesCopied] = (byte) ((ch >> 8) & 0xFF);\n+                bytesCopied++;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5baa6365bb9b92a5406be9c495ab8a06c604c1e"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAyNTA5MA==", "bodyText": "I did this cos adding a try doesn't fix the error for Semmle. It's stupid. Ok I changed it", "url": "https://github.com/microsoft/mssql-jdbc/pull/1226#discussion_r364025090", "createdAt": "2020-01-08T01:07:42Z", "author": {"login": "lilgreenbird"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java", "diffHunk": "@@ -3776,7 +3776,14 @@ void writeString(String value) throws SQLServerException {\n             while (bytesCopied < bytesToCopy) {\n                 char ch = value.charAt(charsCopied++);\n                 valueBytes[bytesCopied++] = (byte) ((ch >> 0) & 0xFF);\n-                valueBytes[bytesCopied++] = (byte) ((ch >> 8) & 0xFF);\n+\n+                if (bytesCopied > bytesToCopy) {\n+                    MessageFormat form = new MessageFormat(SQLServerException.getErrString(\"R_indexOutOfRange\"));\n+                    Object[] msgArgs = {bytesCopied};\n+                    error(form.format(msgArgs), SQLState.DATA_EXCEPTION_NOT_SPECIFIC, DriverError.NOT_SET);\n+                }\n+                valueBytes[bytesCopied] = (byte) ((ch >> 8) & 0xFF);\n+                bytesCopied++;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAwNzA1Nw=="}, "originalCommit": {"oid": "e5baa6365bb9b92a5406be9c495ab8a06c604c1e"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0ODIyODg0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/microsoft/sqlserver/jdbc/SQLServerXAResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMDoyMjozNFrOFbJtBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQwMTowNzo0NlrOFbKVDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAxNDg1NA==", "bodyText": "Same here, if we're really worried this may cause an out of index access then we can catch and rethrow it.", "url": "https://github.com/microsoft/mssql-jdbc/pull/1226#discussion_r364014854", "createdAt": "2020-01-08T00:22:34Z", "author": {"login": "rene-ye"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/SQLServerXAResource.java", "diffHunk": "@@ -845,8 +845,19 @@ public void forget(Xid xid) throws XAException {\n                 power = power * 256;\n             }\n             offset += 4;\n-            int gid_len = (r.bData[offset++] & 0x00FF);\n-            int bid_len = (r.bData[offset++] & 0x00FF);\n+            int gid_len = (r.bData[offset] & 0x00FF);\n+            if (offset++ > r.bData.length) {\n+                MessageFormat form = new MessageFormat(SQLServerException.getErrString(\"R_indexOutOfRange\"));\n+                Object[] msgArgs = {offset};\n+                XAException xex = new XAException(form.format(msgArgs));\n+                xex.errorCode = XAException.XAER_RMERR;\n+                if (xaLogger.isLoggable(Level.FINER))\n+                    xaLogger.finer(toString() + \" exception:\" + xex);\n+                throw xex;\n+            }\n+            int bid_len = (r.bData[offset] & 0x00FF);\n+            offset++;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5baa6365bb9b92a5406be9c495ab8a06c604c1e"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAyNTEwMw==", "bodyText": "I did this cos adding a try doesn't fix the error for Semmle. It's stupid. Ok I changed it", "url": "https://github.com/microsoft/mssql-jdbc/pull/1226#discussion_r364025103", "createdAt": "2020-01-08T01:07:46Z", "author": {"login": "lilgreenbird"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/SQLServerXAResource.java", "diffHunk": "@@ -845,8 +845,19 @@ public void forget(Xid xid) throws XAException {\n                 power = power * 256;\n             }\n             offset += 4;\n-            int gid_len = (r.bData[offset++] & 0x00FF);\n-            int bid_len = (r.bData[offset++] & 0x00FF);\n+            int gid_len = (r.bData[offset] & 0x00FF);\n+            if (offset++ > r.bData.length) {\n+                MessageFormat form = new MessageFormat(SQLServerException.getErrString(\"R_indexOutOfRange\"));\n+                Object[] msgArgs = {offset};\n+                XAException xex = new XAException(form.format(msgArgs));\n+                xex.errorCode = XAException.XAER_RMERR;\n+                if (xaLogger.isLoggable(Level.FINER))\n+                    xaLogger.finer(toString() + \" exception:\" + xex);\n+                throw xex;\n+            }\n+            int bid_len = (r.bData[offset] & 0x00FF);\n+            offset++;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAxNDg1NA=="}, "originalCommit": {"oid": "e5baa6365bb9b92a5406be9c495ab8a06c604c1e"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1179, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}