{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMjcxNjQx", "number": 1322, "title": "Check tls protocol version and throw warning", "bodyText": "", "createdAt": "2020-04-28T17:57:11Z", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322", "merged": true, "mergeCommit": {"oid": "639d22c817499e3cf57143a16b82a07faeff317e"}, "closed": true, "closedAt": "2020-04-30T17:46:32Z", "author": {"login": "rene-ye"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccHummAH2gAyNDEwMjcxNjQxOjY3MjM3MGU2ZjY0NjIwMTMxYjExNTI0ZjRkNjAxNjk2MjBhZjNiNWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccwxLLgFqTQwMzc0MjMwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "672370e6f64620131b11524f4d60169620af3b5e", "author": {"user": {"login": "rene-ye", "name": "v-reye"}}, "url": "https://github.com/microsoft/mssql-jdbc/commit/672370e6f64620131b11524f4d60169620af3b5e", "committedDate": "2020-04-28T17:56:12Z", "message": "Check protocol version and throw warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7e0647f2b919a77de6dfca08d17c38261054d68", "author": {"user": {"login": "rene-ye", "name": "v-reye"}}, "url": "https://github.com/microsoft/mssql-jdbc/commit/a7e0647f2b919a77de6dfca08d17c38261054d68", "committedDate": "2020-04-28T17:57:35Z", "message": "Remove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMDg4MTg0", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#pullrequestreview-402088184", "createdAt": "2020-04-28T18:09:00Z", "commit": {"oid": "672370e6f64620131b11524f4d60169620af3b5e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxODowOTowMFrOGNgrCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxODowOTowMFrOGNgrCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgxOTk3Nw==", "bodyText": "There is already SSLProtocol enum in the driver", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#discussion_r416819977", "createdAt": "2020-04-28T18:09:00Z", "author": {"login": "ulvii"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java", "diffHunk": "@@ -1593,6 +1594,9 @@ private void validateServerNameInCertificate(X509Certificate cert) throws Certif\n         SSL_HANDHSAKE_COMPLETE\n     }\n \n+    static final String TLS_1 = \"TLSv1\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "672370e6f64620131b11524f4d60169620af3b5e"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7f1e6e8dc4e2240fd833fea988ef6a57903eee3", "author": {"user": {"login": "rene-ye", "name": "v-reye"}}, "url": "https://github.com/microsoft/mssql-jdbc/commit/a7f1e6e8dc4e2240fd833fea988ef6a57903eee3", "committedDate": "2020-04-28T22:30:28Z", "message": "Remove existing static strings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzgzMTc0", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#pullrequestreview-402383174", "createdAt": "2020-04-29T06:06:13Z", "commit": {"oid": "a7f1e6e8dc4e2240fd833fea988ef6a57903eee3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNjowNjoxM1rOGNw1mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNjowNjoxM1rOGNw1mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA4NDgyNg==", "bodyText": "add to SQLServerResource?", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#discussion_r417084826", "createdAt": "2020-04-29T06:06:13Z", "author": {"login": "lilgreenbird"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java", "diffHunk": "@@ -1826,6 +1826,16 @@ else if (con.getTrustManagerClass() != null) {\n             // SSL is now enabled; switch over the channel socket\n             channelSocket = sslSocket;\n \n+            // Check the TLS version\n+            String tlsProtocol = sslSocket.getSession().getProtocol();\n+            if (SSLProtocol.TLS_V10.toString().equalsIgnoreCase(tlsProtocol)\n+                    || SSLProtocol.TLS_V11.toString().equalsIgnoreCase(tlsProtocol)) {\n+                String warningMsg = tlsProtocol\n+                        + \" was negotiated. Please update server and client to use TLSv1.2 at minimum.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7f1e6e8dc4e2240fd833fea988ef6a57903eee3"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMzg0MjQx", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#pullrequestreview-402384241", "createdAt": "2020-04-29T06:09:19Z", "commit": {"oid": "a7f1e6e8dc4e2240fd833fea988ef6a57903eee3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNjowOToxOVrOGNw5lQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwNjowOToxOVrOGNw5lQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA4NTg0NQ==", "bodyText": "I think it might be better to put add a isMinTLS() (or something) method in SQLServerDriver? That way when a new version comes out it can be changed in 1 place only.", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#discussion_r417085845", "createdAt": "2020-04-29T06:09:19Z", "author": {"login": "lilgreenbird"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/IOBuffer.java", "diffHunk": "@@ -1826,6 +1826,16 @@ else if (con.getTrustManagerClass() != null) {\n             // SSL is now enabled; switch over the channel socket\n             channelSocket = sslSocket;\n \n+            // Check the TLS version\n+            String tlsProtocol = sslSocket.getSession().getProtocol();\n+            if (SSLProtocol.TLS_V10.toString().equalsIgnoreCase(tlsProtocol)\n+                    || SSLProtocol.TLS_V11.toString().equalsIgnoreCase(tlsProtocol)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7f1e6e8dc4e2240fd833fea988ef6a57903eee3"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDk4MDI0", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#pullrequestreview-403098024", "createdAt": "2020-04-29T22:59:26Z", "commit": {"oid": "a7f1e6e8dc4e2240fd833fea988ef6a57903eee3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNzQyMzAw", "url": "https://github.com/microsoft/mssql-jdbc/pull/1322#pullrequestreview-403742300", "createdAt": "2020-04-30T17:45:07Z", "commit": {"oid": "a7f1e6e8dc4e2240fd833fea988ef6a57903eee3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2532, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}