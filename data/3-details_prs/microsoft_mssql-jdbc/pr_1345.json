{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NzQ5MDM2", "number": 1345, "title": "Added DatabaseMetaData.getDatabaseCompatabilityLevel", "bodyText": "Implemented a new function to SQLServerDatabaseMetaData to check database compatibility level.", "createdAt": "2020-05-28T21:35:39Z", "url": "https://github.com/microsoft/mssql-jdbc/pull/1345", "merged": true, "mergeCommit": {"oid": "559577f47efb1b4135f004af36d416c340230152"}, "closed": true, "closedAt": "2020-06-15T21:27:23Z", "author": {"login": "dhait"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcl00TEAH2gAyNDI0NzQ5MDM2OjFlZThkZWYzYjBkOGJkY2NlYjhmNDM0NmQ2YjUxNTdjYjhiMzVmMGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrngGTgFqTQzMTAwNTMxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1ee8def3b0d8bdcceb8f4346d6b5157cb8b35f0f", "author": {"user": {"login": "dhait", "name": "David Hait"}}, "url": "https://github.com/microsoft/mssql-jdbc/commit/1ee8def3b0d8bdcceb8f4346d6b5157cb8b35f0f", "committedDate": "2020-05-28T21:33:28Z", "message": "Added DatabaseMetaData.getDatabaseCompatabilityLevel"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMjIyNzAx", "url": "https://github.com/microsoft/mssql-jdbc/pull/1345#pullrequestreview-421222701", "createdAt": "2020-05-29T19:21:15Z", "commit": {"oid": "1ee8def3b0d8bdcceb8f4346d6b5157cb8b35f0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOToyMToxNVrOGcpJNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOToyMToxNVrOGcpJNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY4NzQxMw==", "bodyText": "I don't think we can guarantee this is always going to be true. Also I couldn't find any documentation on correlation between database version and compatibility level I think it's best not to assume this here", "url": "https://github.com/microsoft/mssql-jdbc/pull/1345#discussion_r432687413", "createdAt": "2020-05-29T19:21:15Z", "author": {"login": "lilgreenbird"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/databasemetadata/DatabaseMetaDataTest.java", "diffHunk": "@@ -120,6 +120,16 @@ public void testDriverVersion() throws SQLException, IOException {\n         }\n     }\n \n+    @Test\n+    public void testDatabaseCompatibilityLevel() throws SQLException {\n+        try (Connection conn = getConnection()) {\n+            SQLServerDatabaseMetaData dbmData = (SQLServerDatabaseMetaData) conn.getMetaData();\n+            int compatibilityLevel = dbmData.getDatabaseCompatibilityLevel();\n+            assertTrue(compatibilityLevel > 0);\n+            assertTrue(compatibilityLevel < dbmData.getDatabaseMajorVersion()*100);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ee8def3b0d8bdcceb8f4346d6b5157cb8b35f0f"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMjI0MjA1", "url": "https://github.com/microsoft/mssql-jdbc/pull/1345#pullrequestreview-421224205", "createdAt": "2020-05-29T19:24:00Z", "commit": {"oid": "1ee8def3b0d8bdcceb8f4346d6b5157cb8b35f0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOToyNDowMVrOGcpNuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOToyNDowMVrOGcpNuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY4ODU3MQ==", "bodyText": "please add javadoc header (see other public api's for format)", "url": "https://github.com/microsoft/mssql-jdbc/pull/1345#discussion_r432688571", "createdAt": "2020-05-29T19:24:01Z", "author": {"login": "lilgreenbird"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/SQLServerDatabaseMetaData.java", "diffHunk": "@@ -2537,6 +2537,22 @@ public boolean locatorsUpdateCopy() throws SQLException {\n         checkClosed();\n         return true;\n     }\n+\n+    /* -------------- MSSQL-JDBC Extension methods  ---------------- */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ee8def3b0d8bdcceb8f4346d6b5157cb8b35f0f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMjI5MDUx", "url": "https://github.com/microsoft/mssql-jdbc/pull/1345#pullrequestreview-421229051", "createdAt": "2020-05-29T19:30:38Z", "commit": {"oid": "1ee8def3b0d8bdcceb8f4346d6b5157cb8b35f0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOTozMDozOVrOGcpZBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOTozMDozOVrOGcpZBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MTQ2MA==", "bodyText": "remove and just let the error throw", "url": "https://github.com/microsoft/mssql-jdbc/pull/1345#discussion_r432691460", "createdAt": "2020-05-29T19:30:39Z", "author": {"login": "lilgreenbird"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/SQLServerDatabaseMetaData.java", "diffHunk": "@@ -2537,6 +2537,22 @@ public boolean locatorsUpdateCopy() throws SQLException {\n         checkClosed();\n         return true;\n     }\n+\n+    /* -------------- MSSQL-JDBC Extension methods  ---------------- */\n+\n+    public int getDatabaseCompatibilityLevel() throws SQLException {\n+        checkClosed();\n+        String database = connection.getCatalog();\n+        try (SQLServerResultSet rs = getResultSetFromInternalQueries(null,\n+                \"select name, compatibility_level from sys.databases where name = '\" + database + \"'\")) {\n+            if (!rs.next()) {\n+                return 0;\n+            }\n+            return rs.getInt(\"compatibility_level\");\n+        } catch (SQLServerException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ee8def3b0d8bdcceb8f4346d6b5157cb8b35f0f"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97bf26036cf6cd0aaed4a1cd0bdbc8ba9680d6ac", "author": {"user": {"login": "dhait", "name": "David Hait"}}, "url": "https://github.com/microsoft/mssql-jdbc/commit/97bf26036cf6cd0aaed4a1cd0bdbc8ba9680d6ac", "committedDate": "2020-05-30T16:16:29Z", "message": "Incorporated reviewer comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDQ0MjUw", "url": "https://github.com/microsoft/mssql-jdbc/pull/1345#pullrequestreview-428444250", "createdAt": "2020-06-10T21:33:19Z", "commit": {"oid": "97bf26036cf6cd0aaed4a1cd0bdbc8ba9680d6ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MjgxNzgw", "url": "https://github.com/microsoft/mssql-jdbc/pull/1345#pullrequestreview-429281780", "createdAt": "2020-06-11T20:54:34Z", "commit": {"oid": "97bf26036cf6cd0aaed4a1cd0bdbc8ba9680d6ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDAzMjY3", "url": "https://github.com/microsoft/mssql-jdbc/pull/1345#pullrequestreview-431003267", "createdAt": "2020-06-15T21:22:22Z", "commit": {"oid": "97bf26036cf6cd0aaed4a1cd0bdbc8ba9680d6ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDA1MzE0", "url": "https://github.com/microsoft/mssql-jdbc/pull/1345#pullrequestreview-431005314", "createdAt": "2020-06-15T21:26:11Z", "commit": {"oid": "97bf26036cf6cd0aaed4a1cd0bdbc8ba9680d6ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2559, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}