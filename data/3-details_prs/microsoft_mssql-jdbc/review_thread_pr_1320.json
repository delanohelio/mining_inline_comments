{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMjQyODcw", "number": 1320, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMDoxNzo0NVrOD6Z6Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzowODo0NFrOD7VAmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTY4NDc0OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/datatypes/SQLVariantResultSetTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMDoxNzo0NVrOGSOsVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMDoxNzo0NVrOGSOsVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc2ODI3Nw==", "bodyText": "ResultSet in try block.", "url": "https://github.com/microsoft/mssql-jdbc/pull/1320#discussion_r421768277", "createdAt": "2020-05-07T20:17:45Z", "author": {"login": "ulvii"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/datatypes/SQLVariantResultSetTest.java", "diffHunk": "@@ -1061,6 +1061,16 @@ public void testTimeClassAsSqlVariant() throws SQLException {\n             assertEquals(object.getClass(), java.sql.Time.class);;\n         }\n     }\n+    \n+    @Test\n+    public void testCastThenGetNumeric() throws SQLException {\n+        try (Connection con = getConnection(); Statement stmt = con.createStatement();) {\n+            SQLServerResultSet rs = (SQLServerResultSet) stmt.executeQuery(\"select cast(123 as sql_variant) as c1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5e88ce353fd00842333d0b21237383e1d128751"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTY4NTQwOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/datatypes/SQLVariantResultSetTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMDoxNzo1OVrOGSOsyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMDoxNzo1OVrOGSOsyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc2ODM5Mw==", "bodyText": "Expected value first.", "url": "https://github.com/microsoft/mssql-jdbc/pull/1320#discussion_r421768393", "createdAt": "2020-05-07T20:17:59Z", "author": {"login": "ulvii"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/datatypes/SQLVariantResultSetTest.java", "diffHunk": "@@ -1061,6 +1061,16 @@ public void testTimeClassAsSqlVariant() throws SQLException {\n             assertEquals(object.getClass(), java.sql.Time.class);;\n         }\n     }\n+    \n+    @Test\n+    public void testCastThenGetNumeric() throws SQLException {\n+        try (Connection con = getConnection(); Statement stmt = con.createStatement();) {\n+            SQLServerResultSet rs = (SQLServerResultSet) stmt.executeQuery(\"select cast(123 as sql_variant) as c1\");\n+            rs.next();\n+            long longValue = rs.getLong(\"c1\");\n+            assertEquals(longValue, 123L);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5e88ce353fd00842333d0b21237383e1d128751"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTczNDU0OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/datatypes/SQLVariantResultSetTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMDozMjo1OVrOGSPLPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQyMDoyMToxOVrOGSycrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc3NjE5MA==", "bodyText": "Please add test cases for rest of the datatypes this PR applies to.", "url": "https://github.com/microsoft/mssql-jdbc/pull/1320#discussion_r421776190", "createdAt": "2020-05-07T20:32:59Z", "author": {"login": "ulvii"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/datatypes/SQLVariantResultSetTest.java", "diffHunk": "@@ -1061,6 +1061,16 @@ public void testTimeClassAsSqlVariant() throws SQLException {\n             assertEquals(object.getClass(), java.sql.Time.class);;\n         }\n     }\n+    \n+    @Test\n+    public void testCastThenGetNumeric() throws SQLException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5e88ce353fd00842333d0b21237383e1d128751"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM1NDA5NA==", "bodyText": "Done (applies to other comments too)", "url": "https://github.com/microsoft/mssql-jdbc/pull/1320#discussion_r422354094", "createdAt": "2020-05-08T20:21:19Z", "author": {"login": "peterbae"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/datatypes/SQLVariantResultSetTest.java", "diffHunk": "@@ -1061,6 +1061,16 @@ public void testTimeClassAsSqlVariant() throws SQLException {\n             assertEquals(object.getClass(), java.sql.Time.class);;\n         }\n     }\n+    \n+    @Test\n+    public void testCastThenGetNumeric() throws SQLException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc3NjE5MA=="}, "originalCommit": {"oid": "b5e88ce353fd00842333d0b21237383e1d128751"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTk2MjMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/microsoft/sqlserver/jdbc/DDC.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMTo0Mjo0MVrOGSRWNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMjo0MTozMlrOGSSyig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTgxMTc2Ng==", "bodyText": "can you add a comment here on why these 2 values?", "url": "https://github.com/microsoft/mssql-jdbc/pull/1320#discussion_r421811766", "createdAt": "2020-05-07T21:42:41Z", "author": {"login": "lilgreenbird"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/DDC.java", "diffHunk": "@@ -72,6 +72,17 @@ static final Object convertIntegerToObject(int intValue, int valueLength, JDBCTy\n                 return (float) intValue;\n             case BINARY:\n                 return convertIntToBytes(intValue, valueLength);\n+            case SQL_VARIANT:\n+                // return short or bit if the underlying datatype of sql_variant is tinyint, smallint or bit\n+                // otherwise, return integer\n+                // Longer datatypes such as double and float are handled by convertLongToObject instead.\n+                if (valueLength == 1) {\n+                    return 0 != intValue;\n+                } else if (valueLength == 3 || valueLength == 4) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5e88ce353fd00842333d0b21237383e1d128751"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTgzNTQwMg==", "bodyText": "I do have a comment, on line 76", "url": "https://github.com/microsoft/mssql-jdbc/pull/1320#discussion_r421835402", "createdAt": "2020-05-07T22:41:32Z", "author": {"login": "peterbae"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/DDC.java", "diffHunk": "@@ -72,6 +72,17 @@ static final Object convertIntegerToObject(int intValue, int valueLength, JDBCTy\n                 return (float) intValue;\n             case BINARY:\n                 return convertIntToBytes(intValue, valueLength);\n+            case SQL_VARIANT:\n+                // return short or bit if the underlying datatype of sql_variant is tinyint, smallint or bit\n+                // otherwise, return integer\n+                // Longer datatypes such as double and float are handled by convertLongToObject instead.\n+                if (valueLength == 1) {\n+                    return 0 != intValue;\n+                } else if (valueLength == 3 || valueLength == 4) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTgxMTc2Ng=="}, "originalCommit": {"oid": "b5e88ce353fd00842333d0b21237383e1d128751"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTM2NzkyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/microsoft/sqlserver/jdbc/DDC.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzowODo0NFrOGTlcdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoyNzozNVrOGTmIug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE4OTYyMw==", "bodyText": "1 == valueLength, same in line 81", "url": "https://github.com/microsoft/mssql-jdbc/pull/1320#discussion_r423189623", "createdAt": "2020-05-11T17:08:44Z", "author": {"login": "lilgreenbird"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/DDC.java", "diffHunk": "@@ -72,6 +72,17 @@ static final Object convertIntegerToObject(int intValue, int valueLength, JDBCTy\n                 return (float) intValue;\n             case BINARY:\n                 return convertIntToBytes(intValue, valueLength);\n+            case SQL_VARIANT:\n+                // return short or bit if the underlying datatype of sql_variant is tinyint, smallint or bit\n+                // otherwise, return integer\n+                // Longer datatypes such as double and float are handled by convertLongToObject instead.\n+                if (valueLength == 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da113804eea22739c907ec7199b19f41f697ecee"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIwMDk1NA==", "bodyText": "I don't think this is necessary", "url": "https://github.com/microsoft/mssql-jdbc/pull/1320#discussion_r423200954", "createdAt": "2020-05-11T17:27:35Z", "author": {"login": "peterbae"}, "path": "src/main/java/com/microsoft/sqlserver/jdbc/DDC.java", "diffHunk": "@@ -72,6 +72,17 @@ static final Object convertIntegerToObject(int intValue, int valueLength, JDBCTy\n                 return (float) intValue;\n             case BINARY:\n                 return convertIntToBytes(intValue, valueLength);\n+            case SQL_VARIANT:\n+                // return short or bit if the underlying datatype of sql_variant is tinyint, smallint or bit\n+                // otherwise, return integer\n+                // Longer datatypes such as double and float are handled by convertLongToObject instead.\n+                if (valueLength == 1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE4OTYyMw=="}, "originalCommit": {"oid": "da113804eea22739c907ec7199b19f41f697ecee"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1074, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}