{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1MTI5MTA3", "number": 1262, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQwMDowMTo0MFrODgDJrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjoxODozMVrODx19vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0OTMyNjU1OnYy", "diffSide": "LEFT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/JDBCEncryptionDecryptionTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQwMDowMTo0MFrOFqGx_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNVQwMDowMTo0MFrOFqGx_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY5NTYxNA==", "bodyText": "Where are you testing testRichQuery, testRichQueryDate, testRichQuery if they are removed?", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r379695614", "createdAt": "2020-02-15T00:01:40Z", "author": {"login": "ulvii"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/JDBCEncryptionDecryptionTest.java", "diffHunk": "@@ -2138,254 +2091,6 @@ void testWithSpecifiedtype(SQLServerResultSet rs, int numberOfColumns, String[]\n         index++;\n     }\n \n-    /**\n-     * Alter Column encryption on deterministic columns to randomized - this will trigger enclave to re-encrypt\n-     * \n-     * @param stmt\n-     * @param tableName\n-     * @param table\n-     * @param values\n-     * @throws SQLException\n-     */\n-    private void testAlterColumnEncryption(SQLServerStatement stmt, String tableName, String table[][],\n-            String cekName) throws SQLException {\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo)) {\n-            for (int i = 0; i < table.length; i++) {\n-                // alter deterministic to randomized\n-                String sql = \"ALTER TABLE \" + tableName + \" ALTER COLUMN \" + ColumnType.DETERMINISTIC.name()\n-                        + table[i][0] + \" \" + table[i][1]\n-                        + String.format(encryptSql, ColumnType.RANDOMIZED.name(), cekName) + \")\";\n-                try (SQLServerPreparedStatement pstmt = (SQLServerPreparedStatement) TestUtils.getPreparedStmt(con, sql,\n-                        stmtColEncSetting)) {\n-                    stmt.execute(sql);\n-                    if (!TestUtils.isAEv2(con)) {\n-                        fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n-                    }\n-                } catch (SQLException e) {\n-                    if (!TestUtils.isAEv2(con)) {\n-                        fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n-                    } else {\n-                        fail(TestResource.getResource(\"R_AlterAEv2Error\") + e.getMessage() + \"Query: \" + sql);\n-                    }\n-                }\n-            }\n-        }\n-    }\n-\n-    private void testRichQuery(SQLServerStatement stmt, String tableName, String table[][],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "752595832af81e32544d68f112675e5e982797d3"}, "originalPosition": 1124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NjE1MzY4OnYy", "diffSide": "RIGHT", "path": "pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwNToxMjowOVrOF53INA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwNToxMjoyNVrOF53Iag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIxNjM3Mg==", "bodyText": "Can you explain this line?", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r396216372", "createdAt": "2020-03-23T05:12:09Z", "author": {"login": "peterbae"}, "path": "pom.xml", "diffHunk": "@@ -52,8 +52,8 @@\n \t\t\tNTLM  - - - - - - - For tests using NTLM Authentication mode (excluded by default) \n \t\t\treqExternalSetup  - For tests requiring external setup (excluded by default)\n \t\t\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \n-\t\t\tDefault testing enabled with SQL Server 2019 (SQLv15) -->\n-\t\t<excludedGroups>xSQLv15, NTLM, reqExternalSetup</excludedGroups>\n+\t\t\tDefault testing enabled with no extra dependencies -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "752595832af81e32544d68f112675e5e982797d3"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIxNjQyNg==", "bodyText": "I meant the line below", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r396216426", "createdAt": "2020-03-23T05:12:25Z", "author": {"login": "peterbae"}, "path": "pom.xml", "diffHunk": "@@ -52,8 +52,8 @@\n \t\t\tNTLM  - - - - - - - For tests using NTLM Authentication mode (excluded by default) \n \t\t\treqExternalSetup  - For tests requiring external setup (excluded by default)\n \t\t\t- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - \n-\t\t\tDefault testing enabled with SQL Server 2019 (SQLv15) -->\n-\t\t<excludedGroups>xSQLv15, NTLM, reqExternalSetup</excludedGroups>\n+\t\t\tDefault testing enabled with no extra dependencies -->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIxNjM3Mg=="}, "originalCommit": {"oid": "752595832af81e32544d68f112675e5e982797d3"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMzA3NTY0OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwMToyODo1M1rOGDueMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwMToyODo1M1rOGDueMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2MDMwNw==", "bodyText": "Do we need this pstmt? It gets created but doesnt get used.", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406560307", "createdAt": "2020-04-10T01:28:53Z", "author": {"login": "peterbae"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java", "diffHunk": "@@ -1959,4 +1941,38 @@ private static void dropCMK(String cmkName, Statement stmt) throws SQLException\n                 + \" drop column master key \" + cmkName + \" end\";\n         stmt.execute(cekSql);\n     }\n+\n+    /**\n+     * Alter Column encryption on deterministic columns to randomized - this will trigger enclave to re-encrypt\n+     * \n+     * @param stmt\n+     * @param tableName\n+     * @param table\n+     * @param values\n+     * @throws SQLException\n+     */\n+    protected void testAlterColumnEncryption(SQLServerStatement stmt, String tableName, String table[][],\n+            String cekName) throws SQLException {\n+        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo)) {\n+            for (int i = 0; i < table.length; i++) {\n+                // alter deterministic to randomized\n+                String sql = \"ALTER TABLE \" + tableName + \" ALTER COLUMN \" + ColumnType.DETERMINISTIC.name()\n+                        + table[i][0] + \" \" + table[i][1]\n+                        + String.format(encryptSql, ColumnType.RANDOMIZED.name(), cekName) + \")\";\n+                try (SQLServerPreparedStatement pstmt = (SQLServerPreparedStatement) TestUtils.getPreparedStmt(con, sql,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMzA3ODU4OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/JDBCEncryptionDecryptionTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwMTozMDo1M1rOGDuf3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwMTozMDo1M1rOGDuf3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2MDczNQ==", "bodyText": "Should probably leave the newline at end of file?", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406560735", "createdAt": "2020-04-10T01:30:53Z", "author": {"login": "peterbae"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/JDBCEncryptionDecryptionTest.java", "diffHunk": "@@ -2296,4 +2262,4 @@ public String getAccessToken(String authority, String resource, String scope) {\n             return result.getAccessToken();\n         }\n     };\n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888"}, "originalPosition": 649}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMzY1NjI2OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzo0MjozM1rOGDzmPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzo0MjozM1rOGDzmPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NDI4Ng==", "bodyText": "params don't match", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406644286", "createdAt": "2020-04-10T07:42:33Z", "author": {"login": "lilgreenbird"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java", "diffHunk": "@@ -1959,4 +1941,38 @@ private static void dropCMK(String cmkName, Statement stmt) throws SQLException\n                 + \" drop column master key \" + cmkName + \" end\";\n         stmt.execute(cekSql);\n     }\n+\n+    /**\n+     * Alter Column encryption on deterministic columns to randomized - this will trigger enclave to re-encrypt\n+     * \n+     * @param stmt\n+     * @param tableName\n+     * @param table\n+     * @param values", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMzY2NTAzOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/CallableStatementTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzo0NjoyN1rOGDzrhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzo0NjoyN1rOGDzrhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NTYzNw==", "bodyText": "this is not necessary as a sep method since it's only called once now", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406645637", "createdAt": "2020-04-10T07:46:27Z", "author": {"login": "lilgreenbird"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/CallableStatementTest.java", "diffHunk": "@@ -127,15 +127,15 @@\n      */\n     @BeforeAll\n     public static void initValues() throws Exception {\n-        dropAll();\n-\n         numericValues = createNumericValues(nullable);\n         byteValues = createBinaryValues(nullable);\n         dateValues = createTemporalTypesCallableStatement(nullable);\n         charValues = createCharValues(nullable);\n+\n+        initCallableStatementTest();\n     }\n \n-    void initCallableStatementTest() throws Exception {\n+    static void initCallableStatementTest() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMzY3NzY4OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzo1MjoyMlrOGDzzGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzo1MjoyMlrOGDzzGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NzU3OA==", "bodyText": "test description", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406647578", "createdAt": "2020-04-10T07:52:22Z", "author": {"login": "lilgreenbird"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +180,172 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(values);\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n             fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n         } catch (Throwable e) {\n             // testChars called fail()\n             assertTrue(e.getMessage().contains(TestResource.getResource(\"R_AlterAEv2Error\")));\n         }\n     }\n \n-    /**\n-     * Test case for char set string for string values\n-     * \n-     * @throws Exception\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for string values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekWin, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for jdbc string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set null for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NULL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekWin, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetobject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set null for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarysetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for jdbc type binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekWin, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for java date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJavaType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for jdbc date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJDBCType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for min/max date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterMinMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnMinMax = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnNull = true;\n-            nullable = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for date set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        RandomData.returnNull = true;\n-        nullable = true;\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekWin, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for numeric values F\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for jdbc type numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Test char", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888"}, "originalPosition": 681}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyMzY3ODQ3OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzo1Mjo0MlrOGDzzig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQwNzo1Mjo0MlrOGDzzig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NzY5MA==", "bodyText": "test description", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r406647690", "createdAt": "2020-04-10T07:52:42Z", "author": {"login": "lilgreenbird"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +180,172 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(values);\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n             fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n         } catch (Throwable e) {\n             // testChars called fail()\n             assertTrue(e.getMessage().contains(TestResource.getResource(\"R_AlterAEv2Error\")));\n         }\n     }\n \n-    /**\n-     * Test case for char set string for string values\n-     * \n-     * @throws Exception\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for string values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekWin, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for jdbc string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set null for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NULL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekWin, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetobject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set null for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarysetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for jdbc type binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekWin, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for java date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJavaType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for jdbc date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJDBCType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for min/max date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterMinMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnMinMax = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnNull = true;\n-            nullable = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for date set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        RandomData.returnNull = true;\n-        nullable = true;\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekWin, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for numeric values F\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for jdbc type numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Test char\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n+    public void testChar(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n         try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(createCharValues(false));\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n         }\n     }\n \n-    /**\n-     * Test case for numeric set numeric for max numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Test char", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888"}, "originalPosition": 709}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMDgwMzM3OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxOToyMzozNVrOGEyCeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMDozMjo1MVrOGE58ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY2NzMyMA==", "bodyText": "This code throws an exception with error message \"Expected exception is not thrown.\", which might be misleading because SQLServerException will get thrown when the server does not support AEv2, which is expected. Perhaps it is better to fail with fail(e.getMessage());.", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r407667320", "createdAt": "2020-04-13T19:23:35Z", "author": {"login": "ulvii"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java", "diffHunk": "@@ -1959,4 +1941,38 @@ private static void dropCMK(String cmkName, Statement stmt) throws SQLException\n                 + \" drop column master key \" + cmkName + \" end\";\n         stmt.execute(cekSql);\n     }\n+\n+    /**\n+     * Alter Column encryption on deterministic columns to randomized - this will trigger enclave to re-encrypt\n+     * \n+     * @param stmt\n+     * @param tableName\n+     * @param table\n+     * @param values\n+     * @throws SQLException\n+     */\n+    protected void testAlterColumnEncryption(SQLServerStatement stmt, String tableName, String table[][],\n+            String cekName) throws SQLException {\n+        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo)) {\n+            for (int i = 0; i < table.length; i++) {\n+                // alter deterministic to randomized\n+                String sql = \"ALTER TABLE \" + tableName + \" ALTER COLUMN \" + ColumnType.DETERMINISTIC.name()\n+                        + table[i][0] + \" \" + table[i][1]\n+                        + String.format(encryptSql, ColumnType.RANDOMIZED.name(), cekName) + \")\";\n+                try (SQLServerPreparedStatement pstmt = (SQLServerPreparedStatement) TestUtils.getPreparedStmt(con, sql,\n+                        stmtColEncSetting)) {\n+                    stmt.execute(sql);\n+                    if (!TestUtils.isAEv2(con)) {\n+                        fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n+                    }\n+                } catch (SQLException e) {\n+                    if (!TestUtils.isAEv2(con)) {\n+                        fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzc5NjgzNg==", "bodyText": "good point, please make the same change in JDBCEncryptionDecryptionTest", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r407796836", "createdAt": "2020-04-14T00:32:51Z", "author": {"login": "lilgreenbird"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/AESetup.java", "diffHunk": "@@ -1959,4 +1941,38 @@ private static void dropCMK(String cmkName, Statement stmt) throws SQLException\n                 + \" drop column master key \" + cmkName + \" end\";\n         stmt.execute(cekSql);\n     }\n+\n+    /**\n+     * Alter Column encryption on deterministic columns to randomized - this will trigger enclave to re-encrypt\n+     * \n+     * @param stmt\n+     * @param tableName\n+     * @param table\n+     * @param values\n+     * @throws SQLException\n+     */\n+    protected void testAlterColumnEncryption(SQLServerStatement stmt, String tableName, String table[][],\n+            String cekName) throws SQLException {\n+        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo)) {\n+            for (int i = 0; i < table.length; i++) {\n+                // alter deterministic to randomized\n+                String sql = \"ALTER TABLE \" + tableName + \" ALTER COLUMN \" + ColumnType.DETERMINISTIC.name()\n+                        + table[i][0] + \" \" + table[i][1]\n+                        + String.format(encryptSql, ColumnType.RANDOMIZED.name(), cekName) + \")\";\n+                try (SQLServerPreparedStatement pstmt = (SQLServerPreparedStatement) TestUtils.getPreparedStmt(con, sql,\n+                        stmtColEncSetting)) {\n+                    stmt.execute(sql);\n+                    if (!TestUtils.isAEv2(con)) {\n+                        fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n+                    }\n+                } catch (SQLException e) {\n+                    if (!TestUtils.isAEv2(con)) {\n+                        fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY2NzMyMA=="}, "originalCommit": {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMDg2NTgzOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxOTo0MzowNlrOGEypiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxOTo0MzowNlrOGEypiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY3NzMyMA==", "bodyText": "Do the tables get cleaned up when the tests are done?", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r407677320", "createdAt": "2020-04-13T19:43:06Z", "author": {"login": "ulvii"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +180,172 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888"}, "originalPosition": 189}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMDg3Mjc1OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxOTo0NToxMlrOGEytww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo1NTo1OVrOGFYElw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY3ODQwMw==", "bodyText": "Are these tests tan in parallel or sequentially. If they are ran in parallel, wouldn't there be a conflict because tests are using the same table?", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r407678403", "createdAt": "2020-04-13T19:45:12Z", "author": {"login": "ulvii"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +180,172 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888"}, "originalPosition": 188}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI5MDQ1NQ==", "bodyText": "The classes themselves aren't run in parallel, e.g. EnclaveTest can run alongside JDBCEncryptionDecryption, but multiple EnclaveTest test cases can't be run at the same time. I don't think the chances of conflicts are very high but we can circumvent it either way by forcing the tests to use/create different databases if it becomes a problem.", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r408290455", "createdAt": "2020-04-14T16:55:59Z", "author": {"login": "rene-ye"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +180,172 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY3ODQwMw=="}, "originalCommit": {"oid": "5ca3c581f2524b9c9551ef20519c76acd312d888"}, "originalPosition": 188}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTkwNDczOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjoxNjozNVrOGFi8Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjoxNjozNVrOGFi8Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2ODQ4Mg==", "bodyText": "Expected value should come first.", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r408468482", "createdAt": "2020-04-14T22:16:35Z", "author": {"login": "ulvii"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +181,183 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(values);\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n             fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n         } catch (Throwable e) {\n             // testChars called fail()\n             assertTrue(e.getMessage().contains(TestResource.getResource(\"R_AlterAEv2Error\")));\n         }\n     }\n \n-    /**\n-     * Test case for char set string for string values\n-     * \n-     * @throws Exception\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for string values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekWin, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for jdbc string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set null for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NULL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekWin, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetobject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set null for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarysetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for jdbc type binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekWin, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for java date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJavaType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for jdbc date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJDBCType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for min/max date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterMinMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnMinMax = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnNull = true;\n-            nullable = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for date set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        RandomData.returnNull = true;\n-        nullable = true;\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekWin, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for numeric values F\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for jdbc type numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Tests alter column encryption on char tables\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n+    public void testChar(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n         try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(createCharValues(false));\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n         }\n     }\n \n-    /**\n-     * Test case for numeric set numeric for max numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Tests alter column encryption on char tables with AKV\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n+    public void testCharAkv(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n         try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = {Boolean.TRUE.toString(), \"255\", \"32767\", \"2147483647\", \"9223372036854775807\",\n-                    \"1.79E308\", \"1.123\", \"3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"214748.3647\", \"922337203685477.5807\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-            String[] values2 = {Boolean.TRUE.toString(), \"255\", \"32767\", \"2147483647\", \"9223372036854775807\",\n-                    \"1.79E308\", \"1.123\", \"3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"214748.3647\", \"922337203685477.5807\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekAkv, charTable);\n+            populateCharNormalCase(createCharValues(false));\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekAkv);\n         }\n     }\n \n     /**\n-     * Test case for numeric set numeric for min numeric values\n+     * Test FMTOnly with Always Encrypted\n      * \n      * @throws SQLException\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterMinValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = {Boolean.FALSE.toString(), \"0\", \"-32768\", \"-2147483648\", \"-9223372036854775808\",\n-                    \"-1.79E308\", \"1.123\", \"-3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"-214748.3648\", \"-922337203685477.5808\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-            String[] values2 = {Boolean.FALSE.toString(), \"0\", \"-32768\", \"-2147483648\", \"-9223372036854775808\",\n-                    \"-1.79E308\", \"1.123\", \"-3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"-214748.3648\", \"-922337203685477.5808\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n+    public void testAEFMTOnly(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n+        try (SQLServerConnection c = PrepUtil.getConnection(AETestConnectionString + \";useFmtOnly=true\", AEInfo);\n+                Statement s = c.createStatement()) {\n+            createTable(NUMERIC_TABLE_AE, cekJks, numericTable);\n+            String sql = \"insert into \" + NUMERIC_TABLE_AE + \" values( \" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\"\n+                    + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\"\n+                    + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?\" + \")\";\n+            try (PreparedStatement p = c.prepareStatement(sql)) {\n+                ParameterMetaData pmd = p.getParameterMetaData();\n+                assertTrue(pmd.getParameterCount() == 48);\n+            }\n         }\n     }\n \n     /**\n-     * Test case for numeric set numeric for null values\n-     * \n-     * @throws SQLException\n+     * Test alter column\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            nullable = true;\n-            RandomData.returnNull = true;\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NULL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NULL, true);\n+    public void testAlter(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n+        try (SQLServerConnection c = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n+                Statement s = c.createStatement()) {\n+            createTable(CHAR_TABLE_AE, cekJks, varcharTableSimple);\n+            PreparedStatement pstmt = c.prepareStatement(\"INSERT INTO \" + CHAR_TABLE_AE + \" VALUES (?,?,?)\");\n+            pstmt.setString(1, \"a\");\n+            pstmt.setString(2, \"b\");\n+            pstmt.setString(3, \"test\");\n+            pstmt.execute();\n+            pstmt = c.prepareStatement(\"ALTER TABLE \" + CHAR_TABLE_AE\n+                    + \" ALTER COLUMN RandomizedVarchar VARCHAR(20) NULL WITH (ONLINE = ON)\");\n+            pstmt.execute();\n         }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n     }\n \n     /**\n-     * Test case for numeric set object for null values\n-     * \n-     * @throws SQLException\n+     * Rich Query with number compare\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterSetObjectNull(String serverName, String url,\n-            String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            nullable = true;\n-            RandomData.returnNull = true;\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NULL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NULL, true);\n+    public void testNumericRichQuery(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n+        try (SQLServerConnection c = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n+                Statement s = c.createStatement()) {\n+            createTable(NUMERIC_TABLE_AE, cekJks, numericTableSimple);\n+            PreparedStatement pstmt = c.prepareStatement(\"INSERT INTO \" + NUMERIC_TABLE_AE + \" VALUES (?,?,?)\");\n+            pstmt.setInt(1, 1);\n+            pstmt.setInt(2, 2);\n+            pstmt.setInt(3, 3);\n+            pstmt.execute();\n+            pstmt = c.prepareStatement(\"SELECT * FROM \" + NUMERIC_TABLE_AE + \" WHERE RANDOMIZEDInt = ?\");\n+            pstmt.setInt(1, 3);\n+            try (ResultSet rs = pstmt.executeQuery()) {\n+                while (rs.next()) {\n+                    assertTrue(rs.getInt(1) == 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d27d52ba435c3aa85a5765639dea4bd0c9707ce"}, "originalPosition": 852}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTkwOTc0OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjoxODozMVrOGFi-8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjoxODozMVrOGFi-8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2OTIzMw==", "bodyText": "Expected value should come first.", "url": "https://github.com/microsoft/mssql-jdbc/pull/1262#discussion_r408469233", "createdAt": "2020-04-14T22:18:31Z", "author": {"login": "ulvii"}, "path": "src/test/java/com/microsoft/sqlserver/jdbc/AlwaysEncrypted/EnclaveTest.java", "diffHunk": "@@ -206,656 +181,183 @@ public void testAEv2Disabled(String serverName, String url, String protocol) thr\n \n         try (SQLServerConnection con = PrepUtil.getConnection(testConnectionString);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n+            String[] values = createCharValues(false);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(values);\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n             fail(TestResource.getResource(\"R_expectedExceptionNotThrown\"));\n         } catch (Throwable e) {\n             // testChars called fail()\n             assertTrue(e.getMessage().contains(TestResource.getResource(\"R_AlterAEv2Error\")));\n         }\n     }\n \n-    /**\n-     * Test case for char set string for string values\n-     * \n-     * @throws Exception\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for string values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekWin, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for jdbc string values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = createCharValues(nullable);\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set string for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NORMAL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.SETOBJECT, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for char set null for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testCharSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values = {null, null, null, null, null, null, null, null, null};\n-\n-            testChars(stmt, cekJks, charTable, values, TestCase.NULL, true);\n-            testChars(stmt, cekAkv, charTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for binary values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekWin, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetobject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set null for binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set binary for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySpecificSetterNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.NORMAL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarysetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(true);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for binary set object for jdbc type binary values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testBinarySetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<byte[]> values = createBinaryValues(false);\n-\n-            testBinaries(stmt, cekJks, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testBinaries(stmt, cekAkv, binaryTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for date values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekWin, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for java date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJavaType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JAVATYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set object for jdbc date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectWithJDBCType(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for min/max date values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSpecificSetterMinMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnMinMax = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NORMAL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for date set date for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            RandomData.returnNull = true;\n-            nullable = true;\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for date set object for null values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testDateSetObjectNull(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        RandomData.returnNull = true;\n-        nullable = true;\n-\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            LinkedList<Object> values = createTemporalTypes(nullable);\n-\n-            testDates(stmt, cekJks, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-            testDates(stmt, cekAkv, dateTable, values, TestCase.SETOBJECT_NULL, true);\n-        }\n-\n-        nullable = false;\n-        RandomData.returnNull = false;\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetter(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set numeric for numeric values using windows certificate store\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterWindows(String serverName, String url, String protocol) throws Exception {\n-        org.junit.Assume.assumeTrue(System.getProperty(\"os.name\").startsWith(\"Windows\"));\n-\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekWin, numericTable, values1, values2, TestCase.NORMAL, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for numeric values F\n-     * \n-     * @throws SQLException\n-     */\n-    @ParameterizedTest\n-    @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObject(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT, true);\n-        }\n-    }\n-\n-    /**\n-     * Test case for numeric set object for jdbc type numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Tests alter column encryption on char tables\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSetObjectWithJDBCTypes(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n+    public void testChar(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n         try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = createNumericValues(nullable);\n-            String[] values2 = new String[values1.length];\n-            System.arraycopy(values1, 0, values2, 0, values1.length);\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.SETOBJECT_WITH_JDBCTYPES, true);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekJks, charTable);\n+            populateCharNormalCase(createCharValues(false));\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekJks);\n         }\n     }\n \n-    /**\n-     * Test case for numeric set numeric for max numeric values\n-     * \n-     * @throws SQLException\n+    /*\n+     * Tests alter column encryption on char tables with AKV\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterMaxValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n+    public void testCharAkv(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n         try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n                 SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-\n-            String[] values1 = {Boolean.TRUE.toString(), \"255\", \"32767\", \"2147483647\", \"9223372036854775807\",\n-                    \"1.79E308\", \"1.123\", \"3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"214748.3647\", \"922337203685477.5807\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-            String[] values2 = {Boolean.TRUE.toString(), \"255\", \"32767\", \"2147483647\", \"9223372036854775807\",\n-                    \"1.79E308\", \"1.123\", \"3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"214748.3647\", \"922337203685477.5807\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n+            TestUtils.dropTableIfExists(CHAR_TABLE_AE, stmt);\n+            createTable(CHAR_TABLE_AE, cekAkv, charTable);\n+            populateCharNormalCase(createCharValues(false));\n+            testAlterColumnEncryption(stmt, CHAR_TABLE_AE, charTable, cekAkv);\n         }\n     }\n \n     /**\n-     * Test case for numeric set numeric for min numeric values\n+     * Test FMTOnly with Always Encrypted\n      * \n      * @throws SQLException\n      */\n     @ParameterizedTest\n     @MethodSource(\"enclaveParams\")\n-    public void testNumericSpecificSetterMinValue(String serverName, String url, String protocol) throws Exception {\n-        checkAESetup(serverName, url, protocol);\n-        try (SQLServerConnection con = PrepUtil.getConnection(AETestConnectionString, AEInfo);\n-                SQLServerStatement stmt = (SQLServerStatement) con.createStatement()) {\n-            String[] values1 = {Boolean.FALSE.toString(), \"0\", \"-32768\", \"-2147483648\", \"-9223372036854775808\",\n-                    \"-1.79E308\", \"1.123\", \"-3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"-214748.3648\", \"-922337203685477.5808\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-            String[] values2 = {Boolean.FALSE.toString(), \"0\", \"-32768\", \"-2147483648\", \"-9223372036854775808\",\n-                    \"-1.79E308\", \"1.123\", \"-3.4E38\", \"999999999999999999\", \"12345.12345\", \"999999999999999999\",\n-                    \"567812.78\", \"-214748.3648\", \"-922337203685477.5808\", \"999999999999999999999999.9999\",\n-                    \"999999999999999999999999.9999\"};\n-\n-            testNumerics(stmt, cekJks, numericTable, values1, values2, TestCase.NORMAL, true);\n-            testNumerics(stmt, cekAkv, numericTable, values1, values2, TestCase.NORMAL, true);\n+    public void testAEFMTOnly(String serverName, String url, String protocol) throws Exception {\n+        setAEConnectionString(serverName, url, protocol);\n+        try (SQLServerConnection c = PrepUtil.getConnection(AETestConnectionString + \";useFmtOnly=true\", AEInfo);\n+                Statement s = c.createStatement()) {\n+            createTable(NUMERIC_TABLE_AE, cekJks, numericTable);\n+            String sql = \"insert into \" + NUMERIC_TABLE_AE + \" values( \" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\"\n+                    + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?,\"\n+                    + \"?,?,?,\" + \"?,?,?,\" + \"?,?,?\" + \")\";\n+            try (PreparedStatement p = c.prepareStatement(sql)) {\n+                ParameterMetaData pmd = p.getParameterMetaData();\n+                assertTrue(pmd.getParameterCount() == 48);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d27d52ba435c3aa85a5765639dea4bd0c9707ce"}, "originalPosition": 773}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1199, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}