{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4OTUzOTYw", "number": 1043, "title": "add chained credential provider", "bodyText": "", "createdAt": "2020-08-17T16:57:22Z", "url": "https://github.com/minio/minio-java/pull/1043", "merged": true, "mergeCommit": {"oid": "093b0df6fe12273ace64a78a546a23784f28e7c1"}, "closed": true, "closedAt": "2020-08-25T19:35:05Z", "author": {"login": "balamurugana"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_1ZTXgH2gAyNDY4OTUzOTYwOjY0ZDUyY2UzMzUwZmI1MjNkNzgxYzI4MmNmZWM4Y2NmZWU3M2Q1YjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCP1qAAFqTQ3NDEzMzExMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "64d52ce3350fb523d781c282cfec8ccfee73d5b3", "author": {"user": {"login": "balamurugana", "name": "Bala FA"}}, "url": "https://github.com/minio/minio-java/commit/64d52ce3350fb523d781c282cfec8ccfee73d5b3", "committedDate": "2020-08-17T16:55:55Z", "message": "add chain credential provider"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMTI5Mzc5", "url": "https://github.com/minio/minio-java/pull/1043#pullrequestreview-470129379", "createdAt": "2020-08-19T05:13:08Z", "commit": {"oid": "64d52ce3350fb523d781c282cfec8ccfee73d5b3"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwNToxMzowOVrOHCzmiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwNToyNTo0OFrOHC0GFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjcwNDY1MQ==", "bodyText": "ChainedProvider might sound better", "url": "https://github.com/minio/minio-java/pull/1043#discussion_r472704651", "createdAt": "2020-08-19T05:13:09Z", "author": {"login": "anjalshireesh"}, "path": "api/src/main/java/io/minio/credentials/ChainProvider.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.credentials;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import javax.annotation.Nonnull;\n+\n+/** Chained credential provider work with list of credential providers. */\n+public class ChainProvider implements Provider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64d52ce3350fb523d781c282cfec8ccfee73d5b3"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjcxMTgwMw==", "bodyText": "Not sure if synchronizing this block helps. Making the fetch method itself synchronized might be better.", "url": "https://github.com/minio/minio-java/pull/1043#discussion_r472711803", "createdAt": "2020-08-19T05:24:31Z", "author": {"login": "anjalshireesh"}, "path": "api/src/main/java/io/minio/credentials/ChainProvider.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.credentials;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import javax.annotation.Nonnull;\n+\n+/** Chained credential provider work with list of credential providers. */\n+public class ChainProvider implements Provider {\n+  private final List<Provider> providers;\n+  private Provider currentProvider;\n+  private Credentials credentials;\n+\n+  public ChainProvider(@Nonnull Provider... providers) {\n+    this.providers = Arrays.asList(providers);\n+  }\n+\n+  @Override\n+  public Credentials fetch() {\n+    if (this.credentials != null && !this.credentials.isExpired()) {\n+      return this.credentials;\n+    }\n+\n+    Credentials credentials = null;\n+\n+    if (currentProvider != null) {\n+      try {\n+        credentials = currentProvider.fetch();\n+      } catch (IllegalStateException e) {\n+        // Ignore and fallback to iteration.\n+      }\n+    }\n+\n+    if (credentials != null) {\n+      synchronized (this) {\n+        this.credentials = credentials;\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64d52ce3350fb523d781c282cfec8ccfee73d5b3"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjcxMjcyNg==", "bodyText": "Might want to skip doing this for currentProvider as that has already happened in previous lines.", "url": "https://github.com/minio/minio-java/pull/1043#discussion_r472712726", "createdAt": "2020-08-19T05:25:48Z", "author": {"login": "anjalshireesh"}, "path": "api/src/main/java/io/minio/credentials/ChainProvider.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio.credentials;\n+\n+import java.util.Arrays;\n+import java.util.List;\n+import javax.annotation.Nonnull;\n+\n+/** Chained credential provider work with list of credential providers. */\n+public class ChainProvider implements Provider {\n+  private final List<Provider> providers;\n+  private Provider currentProvider;\n+  private Credentials credentials;\n+\n+  public ChainProvider(@Nonnull Provider... providers) {\n+    this.providers = Arrays.asList(providers);\n+  }\n+\n+  @Override\n+  public Credentials fetch() {\n+    if (this.credentials != null && !this.credentials.isExpired()) {\n+      return this.credentials;\n+    }\n+\n+    Credentials credentials = null;\n+\n+    if (currentProvider != null) {\n+      try {\n+        credentials = currentProvider.fetch();\n+      } catch (IllegalStateException e) {\n+        // Ignore and fallback to iteration.\n+      }\n+    }\n+\n+    if (credentials != null) {\n+      synchronized (this) {\n+        this.credentials = credentials;\n+      }\n+\n+      return this.credentials;\n+    }\n+\n+    for (Provider provider : providers) {\n+      try {\n+        credentials = provider.fetch();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64d52ce3350fb523d781c282cfec8ccfee73d5b3"}, "originalPosition": 59}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c959e4dd814399791f522e595fbe8d57b92feef", "author": {"user": {"login": "balamurugana", "name": "Bala FA"}}, "url": "https://github.com/minio/minio-java/commit/0c959e4dd814399791f522e595fbe8d57b92feef", "committedDate": "2020-08-20T04:46:42Z", "message": "address review comments"}, "afterCommit": {"oid": "af75e302139157124a3ce698e849298b7a5a7098", "author": {"user": {"login": "balamurugana", "name": "Bala FA"}}, "url": "https://github.com/minio/minio-java/commit/af75e302139157124a3ce698e849298b7a5a7098", "committedDate": "2020-08-21T10:10:10Z", "message": "address review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2288affaae5de83d0199a53e2b8cafda4808f6a", "author": {"user": {"login": "balamurugana", "name": "Bala FA"}}, "url": "https://github.com/minio/minio-java/commit/b2288affaae5de83d0199a53e2b8cafda4808f6a", "committedDate": "2020-08-21T10:28:06Z", "message": "address review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af75e302139157124a3ce698e849298b7a5a7098", "author": {"user": {"login": "balamurugana", "name": "Bala FA"}}, "url": "https://github.com/minio/minio-java/commit/af75e302139157124a3ce698e849298b7a5a7098", "committedDate": "2020-08-21T10:10:10Z", "message": "address review comments"}, "afterCommit": {"oid": "b2288affaae5de83d0199a53e2b8cafda4808f6a", "author": {"user": {"login": "balamurugana", "name": "Bala FA"}}, "url": "https://github.com/minio/minio-java/commit/b2288affaae5de83d0199a53e2b8cafda4808f6a", "committedDate": "2020-08-21T10:28:06Z", "message": "address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyOTc5NTA5", "url": "https://github.com/minio/minio-java/pull/1043#pullrequestreview-472979509", "createdAt": "2020-08-23T05:09:06Z", "commit": {"oid": "b2288affaae5de83d0199a53e2b8cafda4808f6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0MTMzMTEy", "url": "https://github.com/minio/minio-java/pull/1043#pullrequestreview-474133112", "createdAt": "2020-08-25T04:52:16Z", "commit": {"oid": "b2288affaae5de83d0199a53e2b8cafda4808f6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1791, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}