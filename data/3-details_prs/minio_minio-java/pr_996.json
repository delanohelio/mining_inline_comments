{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMzEwNjI1", "number": 996, "title": "Sts client grants", "bodyText": "Hey, guys.\nI've played a little with an STS api, and figured out that there is no implementation in java sdk.\nSo i've made one for \"client grants\".", "createdAt": "2020-06-29T10:09:30Z", "url": "https://github.com/minio/minio-java/pull/996", "merged": true, "mergeCommit": {"oid": "f1b4011d1ea20f218607b2e095a54276a5bf85f3"}, "closed": true, "closedAt": "2020-07-24T06:41:26Z", "author": {"login": "egetman"}, "timelineItems": {"totalCount": 45, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvqnYYgH2gAyNDQxMzEwNjI1OmMwNmFiMjhkNTk1MDZkOTJlY2I1ODAyN2IxYWZhMjUzZjMwZGU1YWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3-JVzAFqTQ1NDY2MDUxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c06ab28d59506d92ecb58027b1afa253f30de5af", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/c06ab28d59506d92ecb58027b1afa253f30de5af", "committedDate": "2020-06-28T11:19:33Z", "message": "Add sts response messages for client grants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "286d9168c881df596f6864d4c356b259b925e2bb", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/286d9168c881df596f6864d4c356b259b925e2bb", "committedDate": "2020-06-28T16:23:41Z", "message": "Add struct for access token & token expiration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "284369a88ed2a821ff5e9bb1359f151b4884ecbb", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/284369a88ed2a821ff5e9bb1359f151b4884ecbb", "committedDate": "2020-06-28T16:24:32Z", "message": "Switch ZonedDateTime with wrapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d2cfec60be5ad8c5d396fc38a3c34a200e30a20", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/3d2cfec60be5ad8c5d396fc38a3c34a200e30a20", "committedDate": "2020-06-28T16:33:36Z", "message": "Implement base sts client grants functionality"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea688da641747ba9f54c3af5aad771ec6b206425", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/ea688da641747ba9f54c3af5aad771ec6b206425", "committedDate": "2020-06-28T16:36:12Z", "message": "Add ClientGrants example"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b1242e827eab208d2bfb728092aae6664af025a", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/0b1242e827eab208d2bfb728092aae6664af025a", "committedDate": "2020-06-29T09:18:55Z", "message": "Fix code style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d097c82c0d9bcd1e21aeeef42e76ce9c7ac7c86d", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/d097c82c0d9bcd1e21aeeef42e76ce9c7ac7c86d", "committedDate": "2020-06-29T09:36:30Z", "message": "Add javadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42232c66d14403deb1cd90588e911b517c6a20e0", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/42232c66d14403deb1cd90588e911b517c6a20e0", "committedDate": "2020-06-29T09:39:45Z", "message": "Update README.md with link to ClientGrants example"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MDgwMTY3", "url": "https://github.com/minio/minio-java/pull/996#pullrequestreview-439080167", "createdAt": "2020-06-29T12:14:38Z", "commit": {"oid": "42232c66d14403deb1cd90588e911b517c6a20e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMjoxNDozOFrOGqODXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMjoxNDozOFrOGqODXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkyMzYxNA==", "bodyText": "You could have below instead of this method.\npublic Credentials credentials() {\n  return clientGrantsResult == null ? null : clientGrantsResult.credentials();\n}\n}", "url": "https://github.com/minio/minio-java/pull/996#discussion_r446923614", "createdAt": "2020-06-29T12:14:38Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/AssumeRoleWithClientGrantsResponse.java", "diffHunk": "@@ -0,0 +1,17 @@\n+package io.minio.messages;\n+\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Namespace;\n+import org.simpleframework.xml.Root;\n+\n+@Root(name = \"AssumeRoleWithClientGrantsResponse\", strict = false)\n+@Namespace(reference = \"https://sts.amazonaws.com/doc/2011-06-15/\")\n+public class AssumeRoleWithClientGrantsResponse {\n+\n+  @Element(name = \"AssumeRoleWithClientGrantsResult\")\n+  private AssumeRoleWithClientGrantsResult clientGrantsResult;\n+\n+  public AssumeRoleWithClientGrantsResult getClientGrantsResult() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42232c66d14403deb1cd90588e911b517c6a20e0"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a29e3da4c6ca1a12b36651ecc785040bf8a85c05", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/a29e3da4c6ca1a12b36651ecc785040bf8a85c05", "committedDate": "2020-06-29T13:50:23Z", "message": "Fix getters naming issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ca3cf7ddb51d0698e3b54f02184f701a1631ad2", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/8ca3cf7ddb51d0698e3b54f02184f701a1631ad2", "committedDate": "2020-06-30T13:05:04Z", "message": "Change S3Escaper sync StrBuffer -> StrBuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb86cf0ad0014867a86ee18f678e51bd8eaa3534", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/fb86cf0ad0014867a86ee18f678e51bd8eaa3534", "committedDate": "2020-06-30T16:54:21Z", "message": "Update STS request/response structures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eba0ae9baa0ddf0817d1f4e71d85663749e6846e", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/eba0ae9baa0ddf0817d1f4e71d85663749e6846e", "committedDate": "2020-06-30T16:54:54Z", "message": "Make S3Escaper visible outside the package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea299dd62b437d229f95e8b3ed2e9940119b0807", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/ea299dd62b437d229f95e8b3ed2e9940119b0807", "committedDate": "2020-06-30T16:56:34Z", "message": "Add basic CredentialsProvider interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48950c3f3826660e15287cc38307c68321d71d8c", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/48950c3f3826660e15287cc38307c68321d71d8c", "committedDate": "2020-06-30T16:58:46Z", "message": "Added a bunch of CredentialsProvider implementations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e187846f5db708dad42b434891732123e8f36021", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/e187846f5db708dad42b434891732123e8f36021", "committedDate": "2020-07-01T10:53:36Z", "message": "Fix some issues with DCL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5d8f0839bbd2548104b14c29e467d47f9f5651a", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/c5d8f0839bbd2548104b14c29e467d47f9f5651a", "committedDate": "2020-07-01T11:09:26Z", "message": "Add WebIdentityCredentialsProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "115599ce7d8fdfd8a07f688b369d102a2da948e2", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/115599ce7d8fdfd8a07f688b369d102a2da948e2", "committedDate": "2020-07-01T13:09:57Z", "message": "Make Credentials immutable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "348838cdce762535be197227dad9b643fcf4bbc8", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/348838cdce762535be197227dad9b643fcf4bbc8", "committedDate": "2020-07-01T13:10:39Z", "message": "Add Token request for WebIdentity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "341fa6017811caf26e0883185462e6ec29367c3c", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/341fa6017811caf26e0883185462e6ec29367c3c", "committedDate": "2020-07-01T13:15:25Z", "message": "Update ClientGrants with new api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b6c19b86f4f68af0ea8fe7cbe7fc381f7707f4a", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/2b6c19b86f4f68af0ea8fe7cbe7fc381f7707f4a", "committedDate": "2020-07-01T13:15:47Z", "message": "Add WebIdentity example"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4afbcdec0a6a35cabbbd170b0653475b92a9d7e5", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/4afbcdec0a6a35cabbbd170b0653475b92a9d7e5", "committedDate": "2020-07-01T13:16:46Z", "message": "Update README.md reference for sts api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c924f4921bf9093bbe6e7b203b987a49b78f637b", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/c924f4921bf9093bbe6e7b203b987a49b78f637b", "committedDate": "2020-07-01T13:17:53Z", "message": "Update MinioClient with new CredentialsProvider api. Minor code cleanups"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a350ca75b6542ec015954b22e869e371e4d375ec", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/a350ca75b6542ec015954b22e869e371e4d375ec", "committedDate": "2020-07-01T13:18:26Z", "message": "Fix code formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54f4cb88702d41805e48a68edb2ee3a21a596a86", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/54f4cb88702d41805e48a68edb2ee3a21a596a86", "committedDate": "2020-07-01T13:21:54Z", "message": "Update resources host/port in examples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4d878e1cdd141b49fac2640c62a4a290e0f02c4", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/e4d878e1cdd141b49fac2640c62a4a290e0f02c4", "committedDate": "2020-07-01T14:04:19Z", "message": "Add copyright for examples"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjYwODIy", "url": "https://github.com/minio/minio-java/pull/996#pullrequestreview-441260822", "createdAt": "2020-07-01T23:41:26Z", "commit": {"oid": "e4d878e1cdd141b49fac2640c62a4a290e0f02c4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMzo0MToyNlrOGr4sFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMzo0NDoxOFrOGr4vNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3MDc0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // no instances plz\n          \n          \n            \n                // no instances please", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448670741", "createdAt": "2020-07-01T23:41:26Z", "author": {"login": "harshavardhana"}, "path": "api/src/main/java/io/minio/S3Escaper.java", "diffHunk": "@@ -19,9 +19,14 @@\n import com.google.common.escape.Escaper;\n import com.google.common.net.UrlEscapers;\n \n-class S3Escaper {\n+public class S3Escaper {\n+\n   private static final Escaper ESCAPER = UrlEscapers.urlPathSegmentEscaper();\n \n+  private S3Escaper() {\n+    // no instances plz", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4d878e1cdd141b49fac2640c62a4a290e0f02c4"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3MDc5OQ==", "bodyText": "license missing should point to 2020", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448670799", "createdAt": "2020-07-01T23:41:38Z", "author": {"login": "harshavardhana"}, "path": "api/src/main/java/io/minio/credentials/AnonymousCredentialsProvider.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package io.minio.credentials;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4d878e1cdd141b49fac2640c62a4a290e0f02c4"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3MTUwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                final String stsEndpoint = \"http://sts-host:sts-port/sts\";\n          \n          \n            \n                // STS endpoint usually points to MinIO endpoint in case of MinIO\n          \n          \n            \n                final String stsEndpoint = \"http://sts-host:sts-port/\";", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448671503", "createdAt": "2020-07-01T23:44:06Z", "author": {"login": "harshavardhana"}, "path": "examples/ClientGrants.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2017 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import com.fasterxml.jackson.annotation.JsonAutoDetect;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.DeserializationFeature;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.introspect.VisibilityChecker;\n+import io.minio.MinioClient;\n+import io.minio.credentials.ClientGrantsCredentialsProvider;\n+import io.minio.credentials.CredentialsProvider;\n+import io.minio.messages.Bucket;\n+import io.minio.messages.ClientGrantsToken;\n+import java.beans.ConstructorProperties;\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import okhttp3.FormBody;\n+import okhttp3.OkHttpClient;\n+import okhttp3.Request;\n+import okhttp3.RequestBody;\n+import okhttp3.Response;\n+\n+public class ClientGrants {\n+\n+  private static final String POLICY =\n+      new StringBuilder()\n+          .append(\"{\\n\")\n+          .append(\"    \\\"Statement\\\": [\\n\")\n+          .append(\"       \" + \" {\\n\")\n+          .append(\"            \\\"Action\\\": [\\n\")\n+          .append(\"                \\\"s3:GetBucketLocation\\\",\\n\")\n+          .append(\"                \\\"s3:ListBucket\\\"\\n\")\n+          .append(\"            ],\\n\")\n+          .append(\"            \\\"Effect\\\": \\\"Allow\\\",\\n\")\n+          .append(\"            \\\"Principal\\\": \\\"*\\\",\\n\")\n+          .append(\"            \\\"Resource\\\": \\\"arn:aws:s3:::test\\\"\\n\")\n+          .append(\"        }\\n\")\n+          .append(\"    ],\\n\")\n+          .append(\"    \\\"Version\\\": \\\"2012-10-17\\\"\\n\")\n+          .append(\"}\\n\")\n+          .toString();\n+\n+  static class JwtToken {\n+\n+    @JsonProperty(\"access_token\")\n+    private final String accessToken;\n+\n+    @JsonProperty(\"expires_in\")\n+    private final long expiredAfter;\n+\n+    @ConstructorProperties({\"access_token\", \"expires_in\"})\n+    public JwtToken(String accessToken, long expiredAfter) {\n+      this.accessToken = accessToken;\n+      this.expiredAfter = expiredAfter;\n+    }\n+  }\n+\n+  @SuppressWarnings({\"SameParameterValue\", \"squid:S1192\"})\n+  static ClientGrantsToken getTokenAndExpiry(\n+      @Nonnull String clientId,\n+      @Nonnull String clientSecret,\n+      @Nonnull String idpClientId,\n+      @Nonnull String idpEndpoint) {\n+    Objects.requireNonNull(clientId, \"Client id must not be null\");\n+    Objects.requireNonNull(clientSecret, \"ClientSecret must not be null\");\n+\n+    final RequestBody requestBody =\n+        new FormBody.Builder()\n+            .add(\"username\", clientId)\n+            .add(\"password\", clientSecret)\n+            .add(\"grant_type\", \"password\")\n+            .add(\"client_id\", idpClientId)\n+            .build();\n+\n+    final Request request = new Request.Builder().url(idpEndpoint).post(requestBody).build();\n+\n+    final OkHttpClient client = new OkHttpClient();\n+    try (Response response = client.newCall(request).execute()) {\n+      final ObjectMapper mapper = new ObjectMapper();\n+      mapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);\n+      mapper.setVisibility(\n+          VisibilityChecker.Std.defaultInstance()\n+              .withFieldVisibility(JsonAutoDetect.Visibility.ANY));\n+\n+      final JwtToken jwtToken =\n+          mapper.readValue(Objects.requireNonNull(response.body()).charStream(), JwtToken.class);\n+      return new ClientGrantsToken(jwtToken.accessToken, jwtToken.expiredAfter, POLICY);\n+    } catch (IOException e) {\n+      throw new IllegalStateException(e);\n+    }\n+  }\n+\n+  @SuppressWarnings(\"squid:S106\")\n+  public static void main(String[] args) throws Exception {\n+    final String clientId = \"user\";\n+    final String clientSecret = \"password\";\n+    final String idpEndpoint =\n+        \"http://idp-host:idp-port/auth/realms/master/protocol/openid-connect/token\";\n+    final String stsEndpoint = \"http://sts-host:sts-port/sts\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4d878e1cdd141b49fac2640c62a4a290e0f02c4"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3MTU0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                final String stsEndpoint = \"http://sts-host:sts-port/sts\";\n          \n          \n            \n                final String stsEndpoint = \"http://sts-host:sts-port/\";", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448671541", "createdAt": "2020-07-01T23:44:18Z", "author": {"login": "harshavardhana"}, "path": "examples/WebIdentity.java", "diffHunk": "@@ -0,0 +1,117 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2017 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import com.fasterxml.jackson.annotation.JsonAutoDetect;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.DeserializationFeature;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.introspect.VisibilityChecker;\n+import io.minio.MinioClient;\n+import io.minio.credentials.CredentialsProvider;\n+import io.minio.credentials.WebIdentityCredentialsProvider;\n+import io.minio.messages.Bucket;\n+import io.minio.messages.WebIdentityToken;\n+import java.beans.ConstructorProperties;\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import okhttp3.FormBody;\n+import okhttp3.OkHttpClient;\n+import okhttp3.Request;\n+import okhttp3.RequestBody;\n+import okhttp3.Response;\n+\n+public class WebIdentity {\n+\n+  static class JwtToken {\n+\n+    @JsonProperty(\"access_token\")\n+    private final String accessToken;\n+\n+    @JsonProperty(\"expires_in\")\n+    private final long expiredAfter;\n+\n+    @ConstructorProperties({\"access_token\", \"expires_in\"})\n+    public JwtToken(String accessToken, long expiredAfter) {\n+      this.accessToken = accessToken;\n+      this.expiredAfter = expiredAfter;\n+    }\n+  }\n+\n+  @SuppressWarnings({\"SameParameterValue\", \"squid:S1192\"})\n+  static WebIdentityToken getTokenAndExpiry(\n+      @Nonnull String clientId,\n+      @Nonnull String clientSecret,\n+      @Nonnull String idpClientId,\n+      @Nonnull String idpEndpoint) {\n+    Objects.requireNonNull(clientId, \"Client id must not be null\");\n+    Objects.requireNonNull(clientSecret, \"ClientSecret must not be null\");\n+\n+    final RequestBody requestBody =\n+        new FormBody.Builder()\n+            .add(\"username\", clientId)\n+            .add(\"password\", clientSecret)\n+            .add(\"grant_type\", \"password\")\n+            .add(\"client_id\", idpClientId)\n+            .build();\n+\n+    final Request request = new Request.Builder().url(idpEndpoint).post(requestBody).build();\n+\n+    final OkHttpClient client = new OkHttpClient();\n+    try (Response response = client.newCall(request).execute()) {\n+      final ObjectMapper mapper = new ObjectMapper();\n+      mapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);\n+      mapper.setVisibility(\n+          VisibilityChecker.Std.defaultInstance()\n+              .withFieldVisibility(JsonAutoDetect.Visibility.ANY));\n+\n+      final JwtToken jwtToken =\n+          mapper.readValue(Objects.requireNonNull(response.body()).charStream(), JwtToken.class);\n+      return new WebIdentityToken(jwtToken.accessToken, jwtToken.expiredAfter);\n+    } catch (IOException e) {\n+      throw new IllegalStateException(e);\n+    }\n+  }\n+\n+  @SuppressWarnings(\"squid:S106\")\n+  public static void main(String[] args) throws Exception {\n+    final String clientId = \"user\";\n+    final String clientSecret = \"password\";\n+    final String idpEndpoint =\n+        \"http://idp-host:idp-port/auth/realms/master/protocol/openid-connect/token\";\n+    final String stsEndpoint = \"http://sts-host:sts-port/sts\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4d878e1cdd141b49fac2640c62a4a290e0f02c4"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMzU5NDM2", "url": "https://github.com/minio/minio-java/pull/996#pullrequestreview-441359436", "createdAt": "2020-07-02T05:27:34Z", "commit": {"oid": "e4d878e1cdd141b49fac2640c62a4a290e0f02c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNToyNzozNFrOGr960Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNToyNzozNFrOGr960Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc1NjQzMw==", "bodyText": "All newly added source files should have copyright to 2020", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448756433", "createdAt": "2020-07-02T05:27:34Z", "author": {"login": "balamurugana"}, "path": "examples/ClientGrants.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2017 MinIO, Inc.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4d878e1cdd141b49fac2640c62a4a290e0f02c4"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d63fb288da407604062a2ec7f3ec2dae1373fc2", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/6d63fb288da407604062a2ec7f3ec2dae1373fc2", "committedDate": "2020-07-02T08:55:19Z", "message": "Remove comments from S3Escaper init"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b70264bdaf7424e14efe6fba6482167d66718a6", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/2b70264bdaf7424e14efe6fba6482167d66718a6", "committedDate": "2020-07-02T08:56:54Z", "message": "Update licence year for examples, update sts url's"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fac6501096d5e3470d4b40dd8d90a2d76245e796", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/fac6501096d5e3470d4b40dd8d90a2d76245e796", "committedDate": "2020-07-02T09:01:48Z", "message": "Added license for new files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/f6b277612b778275a3d491cad44b44ea65530172", "committedDate": "2020-07-02T09:05:02Z", "message": "Simplify AwsEnvironmentCredentialsProvider"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNTI5NTAy", "url": "https://github.com/minio/minio-java/pull/996#pullrequestreview-441529502", "createdAt": "2020-07-02T09:57:22Z", "commit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "state": "COMMENTED", "comments": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwOTo1NzoyM1rOGsGAIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMTo1MzoyNlrOGsJgvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg4ODg2Nw==", "bodyText": "Please add license.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448888867", "createdAt": "2020-07-02T09:57:23Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/Credentials.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package io.minio.messages;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg5MTU3OA==", "bodyText": "As we are moving away from many overloaded methods, you could keep two public constructors\n\nno arg constructor for XML unmarshalling\n\npublic Credentials() {}\n\nconstructor with accessKey, secretKey, sessionToken and expiration for creating Credentials object; here accessKey cannot be null/empty, secretKey cannot be null and  sessionToken and expiration can be null.\n\npublic Credentials(String accessKey, String secretKey, String sessionToken, ZonedDateTime expiration) {\n    // validate accessKey\n}", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448891578", "createdAt": "2020-07-02T10:02:19Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/Credentials.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package io.minio.messages;\n+\n+import java.time.ZonedDateTime;\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Root;\n+\n+@Root(name = \"Credentials\", strict = false)\n+public class Credentials {\n+\n+  public static final Credentials EMPTY = new Credentials();\n+\n+  @Element(name = \"AccessKeyId\")\n+  private final String accessKey;\n+\n+  @Element(name = \"SecretAccessKey\")\n+  private final String secretKey;\n+\n+  @Element(name = \"Expiration\")\n+  private final ResponseDate expiredAt;\n+\n+  @Element(name = \"SessionToken\")\n+  private final String sessionToken;\n+\n+  private Credentials() {\n+    accessKey = null;\n+    secretKey = null;\n+    expiredAt = null;\n+    sessionToken = null;\n+  }\n+\n+  public Credentials(@Nonnull String accessKey, @Nonnull String secretKey) {\n+    this(accessKey, secretKey, null);\n+  }\n+\n+  public Credentials(\n+      @Nonnull String accessKey, @Nonnull String secretKey, @Nullable ZonedDateTime expiredAt) {\n+    this(accessKey, secretKey, expiredAt, null);\n+  }\n+\n+  public Credentials(\n+      @Nonnull String accessKey,\n+      @Nonnull String secretKey,\n+      @Nullable ZonedDateTime expiredAt,\n+      @Nullable String sessionToken) {\n+    this(accessKey, secretKey, new ResponseDate(expiredAt), sessionToken);\n+  }\n+\n+  // deserialization constructor\n+  @SuppressWarnings(\"unused\")\n+  public Credentials(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg5MjY5Mw==", "bodyText": "I don't think EMPTY and this private constructor are useful. Either a credentials object is available or not available.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448892693", "createdAt": "2020-07-02T10:04:18Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/Credentials.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package io.minio.messages;\n+\n+import java.time.ZonedDateTime;\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Root;\n+\n+@Root(name = \"Credentials\", strict = false)\n+public class Credentials {\n+\n+  public static final Credentials EMPTY = new Credentials();\n+\n+  @Element(name = \"AccessKeyId\")\n+  private final String accessKey;\n+\n+  @Element(name = \"SecretAccessKey\")\n+  private final String secretKey;\n+\n+  @Element(name = \"Expiration\")\n+  private final ResponseDate expiredAt;\n+\n+  @Element(name = \"SessionToken\")\n+  private final String sessionToken;\n+\n+  private Credentials() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg5NTA1Mg==", "bodyText": "You could have this method as isEmpty().\nFor anonymous access, we shouldn't pass Credentials object to MinioClient.builder().credentials().\nIf a credential provider returning an empty credential is an error i.e. provider should retry N no. of times (or with configured N) and throw an exception on failure.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448895052", "createdAt": "2020-07-02T10:08:40Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/Credentials.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package io.minio.messages;\n+\n+import java.time.ZonedDateTime;\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Root;\n+\n+@Root(name = \"Credentials\", strict = false)\n+public class Credentials {\n+\n+  public static final Credentials EMPTY = new Credentials();\n+\n+  @Element(name = \"AccessKeyId\")\n+  private final String accessKey;\n+\n+  @Element(name = \"SecretAccessKey\")\n+  private final String secretKey;\n+\n+  @Element(name = \"Expiration\")\n+  private final ResponseDate expiredAt;\n+\n+  @Element(name = \"SessionToken\")\n+  private final String sessionToken;\n+\n+  private Credentials() {\n+    accessKey = null;\n+    secretKey = null;\n+    expiredAt = null;\n+    sessionToken = null;\n+  }\n+\n+  public Credentials(@Nonnull String accessKey, @Nonnull String secretKey) {\n+    this(accessKey, secretKey, null);\n+  }\n+\n+  public Credentials(\n+      @Nonnull String accessKey, @Nonnull String secretKey, @Nullable ZonedDateTime expiredAt) {\n+    this(accessKey, secretKey, expiredAt, null);\n+  }\n+\n+  public Credentials(\n+      @Nonnull String accessKey,\n+      @Nonnull String secretKey,\n+      @Nullable ZonedDateTime expiredAt,\n+      @Nullable String sessionToken) {\n+    this(accessKey, secretKey, new ResponseDate(expiredAt), sessionToken);\n+  }\n+\n+  // deserialization constructor\n+  @SuppressWarnings(\"unused\")\n+  public Credentials(\n+      @Nonnull @Element(name = \"AccessKeyId\") String accessKey,\n+      @Nonnull @Element(name = \"SecretAccessKey\") String secretKey,\n+      @Nullable @Element(name = \"Expiration\") ResponseDate expiredAt,\n+      @Nullable @Element(name = \"SessionToken\") String sessionToken) {\n+    this.accessKey = Objects.requireNonNull(accessKey, \"AccessKey must not be null\");\n+    this.secretKey = Objects.requireNonNull(secretKey, \"SecretKey must not be null\");\n+    if (accessKey.isEmpty() || secretKey.isEmpty()) {\n+      throw new IllegalArgumentException(\"AccessKey and SecretKey must not be empty\");\n+    }\n+    this.sessionToken = sessionToken;\n+    this.expiredAt = expiredAt;\n+  }\n+\n+  public String accessKey() {\n+    return accessKey;\n+  }\n+\n+  public String secretKey() {\n+    return secretKey;\n+  }\n+\n+  public ZonedDateTime expiredAt() {\n+    return expiredAt.zonedDateTime();\n+  }\n+\n+  public String sessionToken() {\n+    return sessionToken;\n+  }\n+\n+  public boolean isAnonymous() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwMzgzNA==", "bodyText": "You could remove this constructor.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448903834", "createdAt": "2020-07-02T10:25:23Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/WebIdentityToken.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.minio.messages;\n+\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+\n+public class WebIdentityToken {\n+\n+  private final String jwtAccessToken;\n+  private final long expiredAfter;\n+  private final String policy;\n+\n+  @SuppressWarnings(\"unused\")\n+  public WebIdentityToken(@Nonnull String jwtAccessToken, long expiredAfter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNTUzMQ==", "bodyText": "This class as same as WebIdentityToken. You could just inherit WebIdentityToken class.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448905531", "createdAt": "2020-07-02T10:28:48Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/ClientGrantsToken.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.minio.messages;\n+\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+\n+public class ClientGrantsToken {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNjkxOQ==", "bodyText": "Just have below and remove api/src/main/java/io/minio/messages/AssumeRoleWithWebIdentityResult.java\n  @Path(value = \"AssumeRoleWithWebIdentityResult\")\n  @Element(name = \"Credentials\")\n  private Credentials credentials;", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448906919", "createdAt": "2020-07-02T10:31:31Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/AssumeRoleWithWebIdentityResponse.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.minio.messages;\n+\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Namespace;\n+import org.simpleframework.xml.Root;\n+\n+@Root(name = \"AssumeRoleWithWebIdentityResponse\", strict = false)\n+@Namespace(reference = \"https://sts.amazonaws.com/doc/2011-06-15/\")\n+public class AssumeRoleWithWebIdentityResponse {\n+\n+  @Element(name = \"AssumeRoleWithWebIdentityResult\")\n+  private AssumeRoleWithWebIdentityResult webIdentityResult;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkzMDcwNw==", "bodyText": "You could use below and remove api/src/main/java/io/minio/messages/AssumeRoleWithClientGrantsResult.java\n  @path(value = \"AssumeRoleWithClientGrantsResult\")\n  @Element(name = \"Credentials\")\n  private Credentials credentials;", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448930707", "createdAt": "2020-07-02T11:20:40Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/AssumeRoleWithClientGrantsResponse.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.minio.messages;\n+\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Namespace;\n+import org.simpleframework.xml.Root;\n+\n+@Root(name = \"AssumeRoleWithClientGrantsResponse\", strict = false)\n+@Namespace(reference = \"https://sts.amazonaws.com/doc/2011-06-15/\")\n+public class AssumeRoleWithClientGrantsResponse {\n+\n+  @Element(name = \"AssumeRoleWithClientGrantsResult\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0MDk3Mg==", "bodyText": "We would need to have force fetch as well.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448940972", "createdAt": "2020-07-02T11:42:28Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/credentials/CredentialsProvider.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.minio.credentials;\n+\n+import io.minio.messages.Credentials;\n+import java.time.Duration;\n+import java.time.ZonedDateTime;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * This component allows {@link io.minio.MinioClient} to fetch valid (not expired) credentials.\n+ * Note: any provider implementation should cache valid credentials and control it's lifetime to\n+ * prevent unnesessary computation logic of repeatedly called {@link #fetch()}, while holding a\n+ * valid {@link Credentials} instance.\n+ */\n+@SuppressWarnings(\"unused\")\n+public interface CredentialsProvider {\n+\n+  /**\n+   * @return a valid (not expired) {@link Credentials} instance for {@link io.minio.MinioClient}.\n+   */\n+  Credentials fetch();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0MTgyOQ==", "bodyText": "Anonymous does not have any credentials. You could remove all anonymous credential handling.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448941829", "createdAt": "2020-07-02T11:44:24Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/credentials/AnonymousCredentialsProvider.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0MzkzMQ==", "bodyText": "You could name it as just Provider; Credentials in io.minio.credentials is not needed.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448943931", "createdAt": "2020-07-02T11:48:41Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/credentials/CredentialsProvider.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.minio.credentials;\n+\n+import io.minio.messages.Credentials;\n+import java.time.Duration;\n+import java.time.ZonedDateTime;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * This component allows {@link io.minio.MinioClient} to fetch valid (not expired) credentials.\n+ * Note: any provider implementation should cache valid credentials and control it's lifetime to\n+ * prevent unnesessary computation logic of repeatedly called {@link #fetch()}, while holding a\n+ * valid {@link Credentials} instance.\n+ */\n+@SuppressWarnings(\"unused\")\n+public interface CredentialsProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0NDc0Nw==", "bodyText": "Why is it needed?", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448944747", "createdAt": "2020-07-02T11:50:14Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -200,76 +208,80 @@\n   private static final String US_EAST_1 = \"us-east-1\";\n   private static final String UPLOAD_ID = \"uploadId\";\n \n-  private static final Set<String> amzHeaders = new HashSet<>();\n+  @SuppressWarnings(\"MismatchedQueryAndUpdateOfCollection\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0NTg3NQ==", "bodyText": "Can you remove these specific to your env?", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448945875", "createdAt": "2020-07-02T11:52:29Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -200,76 +208,80 @@\n   private static final String US_EAST_1 = \"us-east-1\";\n   private static final String UPLOAD_ID = \"uploadId\";\n \n-  private static final Set<String> amzHeaders = new HashSet<>();\n+  @SuppressWarnings(\"MismatchedQueryAndUpdateOfCollection\")\n+  private static final Set<String> AMZ_HEADERS = new HashSet<>();\n \n   static {\n-    amzHeaders.add(\"server-side-encryption\");\n-    amzHeaders.add(\"server-side-encryption-aws-kms-key-id\");\n-    amzHeaders.add(\"server-side-encryption-context\");\n-    amzHeaders.add(\"server-side-encryption-customer-algorithm\");\n-    amzHeaders.add(\"server-side-encryption-customer-key\");\n-    amzHeaders.add(\"server-side-encryption-customer-key-md5\");\n-    amzHeaders.add(\"website-redirect-location\");\n-    amzHeaders.add(\"storage-class\");\n+    AMZ_HEADERS.add(\"server-side-encryption\");\n+    AMZ_HEADERS.add(\"server-side-encryption-aws-kms-key-id\");\n+    AMZ_HEADERS.add(\"server-side-encryption-context\");\n+    AMZ_HEADERS.add(\"server-side-encryption-customer-algorithm\");\n+    AMZ_HEADERS.add(\"server-side-encryption-customer-key\");\n+    AMZ_HEADERS.add(\"server-side-encryption-customer-key-md5\");\n+    AMZ_HEADERS.add(\"website-redirect-location\");\n+    AMZ_HEADERS.add(\"storage-class\");\n   }\n \n-  private static final Set<String> standardHeaders = new HashSet<>();\n+  @SuppressWarnings(\"MismatchedQueryAndUpdateOfCollection\")\n+  private static final Set<String> STANDARD_HEADERS = new HashSet<>();\n \n   static {\n-    standardHeaders.add(\"content-type\");\n-    standardHeaders.add(\"cache-control\");\n-    standardHeaders.add(\"content-encoding\");\n-    standardHeaders.add(\"content-disposition\");\n-    standardHeaders.add(\"content-language\");\n-    standardHeaders.add(\"expires\");\n-    standardHeaders.add(\"range\");\n+    STANDARD_HEADERS.add(\"content-type\");\n+    STANDARD_HEADERS.add(\"cache-control\");\n+    STANDARD_HEADERS.add(\"content-encoding\");\n+    STANDARD_HEADERS.add(\"content-disposition\");\n+    STANDARD_HEADERS.add(\"content-language\");\n+    STANDARD_HEADERS.add(\"expires\");\n+    STANDARD_HEADERS.add(\"range\");\n   }\n \n   private String userAgent = DEFAULT_USER_AGENT;\n   private PrintWriter traceStream;\n \n-  private HttpUrl baseUrl;\n-  private String region;\n-  private boolean isAwsHost;\n+  private final HttpUrl baseUrl;\n+  private final String region;\n+  private final boolean isAwsHost;\n   private boolean isAcceleratedHost;\n   private boolean isDualStackHost;\n   private boolean useVirtualStyle;\n-  private String accessKey;\n-  private String secretKey;\n   private OkHttpClient httpClient;\n \n+  private final CredentialsProvider credentialsProvider;\n+\n+  @SuppressWarnings(\"java:S107\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0NjM2NA==", "bodyText": "Builder should take care this check i.e. values from builder are already validated", "url": "https://github.com/minio/minio-java/pull/996#discussion_r448946364", "createdAt": "2020-07-02T11:53:26Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -200,76 +208,80 @@\n   private static final String US_EAST_1 = \"us-east-1\";\n   private static final String UPLOAD_ID = \"uploadId\";\n \n-  private static final Set<String> amzHeaders = new HashSet<>();\n+  @SuppressWarnings(\"MismatchedQueryAndUpdateOfCollection\")\n+  private static final Set<String> AMZ_HEADERS = new HashSet<>();\n \n   static {\n-    amzHeaders.add(\"server-side-encryption\");\n-    amzHeaders.add(\"server-side-encryption-aws-kms-key-id\");\n-    amzHeaders.add(\"server-side-encryption-context\");\n-    amzHeaders.add(\"server-side-encryption-customer-algorithm\");\n-    amzHeaders.add(\"server-side-encryption-customer-key\");\n-    amzHeaders.add(\"server-side-encryption-customer-key-md5\");\n-    amzHeaders.add(\"website-redirect-location\");\n-    amzHeaders.add(\"storage-class\");\n+    AMZ_HEADERS.add(\"server-side-encryption\");\n+    AMZ_HEADERS.add(\"server-side-encryption-aws-kms-key-id\");\n+    AMZ_HEADERS.add(\"server-side-encryption-context\");\n+    AMZ_HEADERS.add(\"server-side-encryption-customer-algorithm\");\n+    AMZ_HEADERS.add(\"server-side-encryption-customer-key\");\n+    AMZ_HEADERS.add(\"server-side-encryption-customer-key-md5\");\n+    AMZ_HEADERS.add(\"website-redirect-location\");\n+    AMZ_HEADERS.add(\"storage-class\");\n   }\n \n-  private static final Set<String> standardHeaders = new HashSet<>();\n+  @SuppressWarnings(\"MismatchedQueryAndUpdateOfCollection\")\n+  private static final Set<String> STANDARD_HEADERS = new HashSet<>();\n \n   static {\n-    standardHeaders.add(\"content-type\");\n-    standardHeaders.add(\"cache-control\");\n-    standardHeaders.add(\"content-encoding\");\n-    standardHeaders.add(\"content-disposition\");\n-    standardHeaders.add(\"content-language\");\n-    standardHeaders.add(\"expires\");\n-    standardHeaders.add(\"range\");\n+    STANDARD_HEADERS.add(\"content-type\");\n+    STANDARD_HEADERS.add(\"cache-control\");\n+    STANDARD_HEADERS.add(\"content-encoding\");\n+    STANDARD_HEADERS.add(\"content-disposition\");\n+    STANDARD_HEADERS.add(\"content-language\");\n+    STANDARD_HEADERS.add(\"expires\");\n+    STANDARD_HEADERS.add(\"range\");\n   }\n \n   private String userAgent = DEFAULT_USER_AGENT;\n   private PrintWriter traceStream;\n \n-  private HttpUrl baseUrl;\n-  private String region;\n-  private boolean isAwsHost;\n+  private final HttpUrl baseUrl;\n+  private final String region;\n+  private final boolean isAwsHost;\n   private boolean isAcceleratedHost;\n   private boolean isDualStackHost;\n   private boolean useVirtualStyle;\n-  private String accessKey;\n-  private String secretKey;\n   private OkHttpClient httpClient;\n \n+  private final CredentialsProvider credentialsProvider;\n+\n+  @SuppressWarnings(\"java:S107\")\n   private MinioClient(\n       HttpUrl baseUrl,\n       String region,\n       boolean isAwsHost,\n       boolean isAcceleratedHost,\n       boolean isDualStackHost,\n       boolean useVirtualStyle,\n-      String accessKey,\n-      String secretKey,\n+      CredentialsProvider credentialsProvider,\n       OkHttpClient httpClient) {\n-    this.baseUrl = baseUrl;\n+\n     this.region = region;\n+    this.baseUrl = baseUrl;\n     this.isAwsHost = isAwsHost;\n-    this.isAcceleratedHost = isAcceleratedHost;\n+    this.httpClient = httpClient;\n     this.isDualStackHost = isDualStackHost;\n     this.useVirtualStyle = useVirtualStyle;\n-    this.accessKey = accessKey;\n-    this.secretKey = secretKey;\n-    this.httpClient = httpClient;\n+    this.isAcceleratedHost = isAcceleratedHost;\n+    this.credentialsProvider =\n+        Objects.requireNonNull(credentialsProvider, \"Credentials provider can't be null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 153}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a353de2955f4222e638c1007d8ae1b1bf1985fc", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/3a353de2955f4222e638c1007d8ae1b1bf1985fc", "committedDate": "2020-07-02T13:12:27Z", "message": "Some review fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNzE1MDE4", "url": "https://github.com/minio/minio-java/pull/996#pullrequestreview-441715018", "createdAt": "2020-07-02T14:09:07Z", "commit": {"oid": "3a353de2955f4222e638c1007d8ae1b1bf1985fc"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNDowOTowN1rOGsOk2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxNDo1OTozMVrOGsQuWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAyOTMzNw==", "bodyText": "It is perfectly fine to use below constructor and this can be removed.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r449029337", "createdAt": "2020-07-02T14:09:07Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/WebIdentityToken.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.minio.messages;\n+\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+\n+public class WebIdentityToken {\n+\n+  private final String jwtAccessToken;\n+  private final long expiredAfter;\n+  private final String policy;\n+\n+  @SuppressWarnings(\"unused\")\n+  public WebIdentityToken(@Nonnull String jwtAccessToken, long expiredAfter) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwMzgzNA=="}, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAzMDcyOQ==", "bodyText": "I don't know; and not sure where you got web identity. As both the classes are same except names, you could just do by inheritance or bring an abstract class for both and add additional properties in respective classes.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r449030729", "createdAt": "2020-07-02T14:11:08Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/ClientGrantsToken.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.minio.messages;\n+\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+\n+public class ClientGrantsToken {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkwNTUzMQ=="}, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAzNTQ1NA==", "bodyText": "No. If provider is null, it is anonymous and this check should only be in MinioClient. No credential providers return null credentials and null values to access/secret keys.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r449035454", "createdAt": "2020-07-02T14:18:04Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/Credentials.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package io.minio.messages;\n+\n+import java.time.ZonedDateTime;\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Root;\n+\n+@Root(name = \"Credentials\", strict = false)\n+public class Credentials {\n+\n+  public static final Credentials EMPTY = new Credentials();\n+\n+  @Element(name = \"AccessKeyId\")\n+  private final String accessKey;\n+\n+  @Element(name = \"SecretAccessKey\")\n+  private final String secretKey;\n+\n+  @Element(name = \"Expiration\")\n+  private final ResponseDate expiredAt;\n+\n+  @Element(name = \"SessionToken\")\n+  private final String sessionToken;\n+\n+  private Credentials() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg5MjY5Mw=="}, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA0ODc0OQ==", "bodyText": "If so, we could live with this constructor only. It is perfectly fine to pass null values to arguments accepting null values. I don't know why it is bad to pass null for such arguments.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r449048749", "createdAt": "2020-07-02T14:36:35Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/Credentials.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package io.minio.messages;\n+\n+import java.time.ZonedDateTime;\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Root;\n+\n+@Root(name = \"Credentials\", strict = false)\n+public class Credentials {\n+\n+  public static final Credentials EMPTY = new Credentials();\n+\n+  @Element(name = \"AccessKeyId\")\n+  private final String accessKey;\n+\n+  @Element(name = \"SecretAccessKey\")\n+  private final String secretKey;\n+\n+  @Element(name = \"Expiration\")\n+  private final ResponseDate expiredAt;\n+\n+  @Element(name = \"SessionToken\")\n+  private final String sessionToken;\n+\n+  private Credentials() {\n+    accessKey = null;\n+    secretKey = null;\n+    expiredAt = null;\n+    sessionToken = null;\n+  }\n+\n+  public Credentials(@Nonnull String accessKey, @Nonnull String secretKey) {\n+    this(accessKey, secretKey, null);\n+  }\n+\n+  public Credentials(\n+      @Nonnull String accessKey, @Nonnull String secretKey, @Nullable ZonedDateTime expiredAt) {\n+    this(accessKey, secretKey, expiredAt, null);\n+  }\n+\n+  public Credentials(\n+      @Nonnull String accessKey,\n+      @Nonnull String secretKey,\n+      @Nullable ZonedDateTime expiredAt,\n+      @Nullable String sessionToken) {\n+    this(accessKey, secretKey, new ResponseDate(expiredAt), sessionToken);\n+  }\n+\n+  // deserialization constructor\n+  @SuppressWarnings(\"unused\")\n+  public Credentials(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg5MTU3OA=="}, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA1NjM5OQ==", "bodyText": "Yes. We do support anonymous access i.e. MinioClient.builder().endpoint(\"https://s3.amazonaws.com\").build(); is used to create client instance for anonymous access.\nWhen provider is used, the provider should return credentials on fetch() i.e. returning non-null and access/secret keys in the object are non-null. However MinioClient needs to check for valid credentials by\nCredentials creds = provider.fetch();\nif (creds == null || creds.isEmpty()) {\n  throw new InvalidCredentialsException();\n}\nIt can't blindly use creds with null values.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r449056399", "createdAt": "2020-07-02T14:47:43Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/messages/Credentials.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package io.minio.messages;\n+\n+import java.time.ZonedDateTime;\n+import java.util.Objects;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import org.simpleframework.xml.Element;\n+import org.simpleframework.xml.Root;\n+\n+@Root(name = \"Credentials\", strict = false)\n+public class Credentials {\n+\n+  public static final Credentials EMPTY = new Credentials();\n+\n+  @Element(name = \"AccessKeyId\")\n+  private final String accessKey;\n+\n+  @Element(name = \"SecretAccessKey\")\n+  private final String secretKey;\n+\n+  @Element(name = \"Expiration\")\n+  private final ResponseDate expiredAt;\n+\n+  @Element(name = \"SessionToken\")\n+  private final String sessionToken;\n+\n+  private Credentials() {\n+    accessKey = null;\n+    secretKey = null;\n+    expiredAt = null;\n+    sessionToken = null;\n+  }\n+\n+  public Credentials(@Nonnull String accessKey, @Nonnull String secretKey) {\n+    this(accessKey, secretKey, null);\n+  }\n+\n+  public Credentials(\n+      @Nonnull String accessKey, @Nonnull String secretKey, @Nullable ZonedDateTime expiredAt) {\n+    this(accessKey, secretKey, expiredAt, null);\n+  }\n+\n+  public Credentials(\n+      @Nonnull String accessKey,\n+      @Nonnull String secretKey,\n+      @Nullable ZonedDateTime expiredAt,\n+      @Nullable String sessionToken) {\n+    this(accessKey, secretKey, new ResponseDate(expiredAt), sessionToken);\n+  }\n+\n+  // deserialization constructor\n+  @SuppressWarnings(\"unused\")\n+  public Credentials(\n+      @Nonnull @Element(name = \"AccessKeyId\") String accessKey,\n+      @Nonnull @Element(name = \"SecretAccessKey\") String secretKey,\n+      @Nullable @Element(name = \"Expiration\") ResponseDate expiredAt,\n+      @Nullable @Element(name = \"SessionToken\") String sessionToken) {\n+    this.accessKey = Objects.requireNonNull(accessKey, \"AccessKey must not be null\");\n+    this.secretKey = Objects.requireNonNull(secretKey, \"SecretKey must not be null\");\n+    if (accessKey.isEmpty() || secretKey.isEmpty()) {\n+      throw new IllegalArgumentException(\"AccessKey and SecretKey must not be empty\");\n+    }\n+    this.sessionToken = sessionToken;\n+    this.expiredAt = expiredAt;\n+  }\n+\n+  public String accessKey() {\n+    return accessKey;\n+  }\n+\n+  public String secretKey() {\n+    return secretKey;\n+  }\n+\n+  public ZonedDateTime expiredAt() {\n+    return expiredAt.zonedDateTime();\n+  }\n+\n+  public String sessionToken() {\n+    return sessionToken;\n+  }\n+\n+  public boolean isAnonymous() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg5NTA1Mg=="}, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA2MjA2Mw==", "bodyText": "You could refer minio-py; but it can be brought later if needed.", "url": "https://github.com/minio/minio-java/pull/996#discussion_r449062063", "createdAt": "2020-07-02T14:56:02Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/credentials/Provider.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package io.minio.credentials;\n+\n+import io.minio.messages.Credentials;\n+import java.time.Duration;\n+import java.time.ZonedDateTime;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * This component allows {@link io.minio.MinioClient} to fetch valid (not expired) credentials.\n+ * Note: any provider implementation should cache valid credentials and control it's lifetime to\n+ * prevent unnesessary computation logic of repeatedly called {@link #fetch()}, while holding a\n+ * valid {@link Credentials} instance.\n+ */\n+@SuppressWarnings(\"unused\")\n+public interface Provider {\n+\n+  /**\n+   * @return a valid (not expired) {@link Credentials} instance for {@link io.minio.MinioClient}.\n+   */\n+  Credentials fetch();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a353de2955f4222e638c1007d8ae1b1bf1985fc"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA2NDUzNw==", "bodyText": "Can you send all clean ups and unrelated changes as separate PR?", "url": "https://github.com/minio/minio-java/pull/996#discussion_r449064537", "createdAt": "2020-07-02T14:59:31Z", "author": {"login": "balamurugana"}, "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -200,76 +208,80 @@\n   private static final String US_EAST_1 = \"us-east-1\";\n   private static final String UPLOAD_ID = \"uploadId\";\n \n-  private static final Set<String> amzHeaders = new HashSet<>();\n+  @SuppressWarnings(\"MismatchedQueryAndUpdateOfCollection\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0NDc0Nw=="}, "originalCommit": {"oid": "f6b277612b778275a3d491cad44b44ea65530172"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db1f61fa97cab39481128ce96c3fb67d9712a071", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/db1f61fa97cab39481128ce96c3fb67d9712a071", "committedDate": "2020-07-08T15:21:26Z", "message": "Revert \"Update MinioClient with new CredentialsProvider api. Minor code cleanups\"\n\nThis reverts commit c924f492"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74587025427ccd8095d142a191c157a613b89429", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/74587025427ccd8095d142a191c157a613b89429", "committedDate": "2020-07-08T16:38:07Z", "message": "Removed AnonymousProvider, cleanups and some constructors. Added several null-checks in different places."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faf607485cfc985292a438cfe6b1a1d6de6c0236", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/faf607485cfc985292a438cfe6b1a1d6de6c0236", "committedDate": "2020-07-09T10:03:51Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89e97214b0c52256a757336bf8c0995019f24c86", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/89e97214b0c52256a757336bf8c0995019f24c86", "committedDate": "2020-07-09T10:36:43Z", "message": "Update pr with upstream"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MjQ1NTQ2", "url": "https://github.com/minio/minio-java/pull/996#pullrequestreview-454245546", "createdAt": "2020-07-23T15:22:05Z", "commit": {"oid": "89e97214b0c52256a757336bf8c0995019f24c86"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f3cfb3f2ffd83214e936a61e34ee3fdaa5b20b0", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/5f3cfb3f2ffd83214e936a61e34ee3fdaa5b20b0", "committedDate": "2020-07-23T15:44:22Z", "message": "Merge remote-tracking branch 'upstream/master' into sts-client-grants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2217140ff4af8781946b8693b4441c9d70e69af5", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/2217140ff4af8781946b8693b4441c9d70e69af5", "committedDate": "2020-07-23T15:58:48Z", "message": "Merge remote-tracking branch 'upstream/master' into sts-client-grants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8384194934e1e1b501fdda41e2d0f48505b0aa55", "author": {"user": {"login": "egetman", "name": "Eugene Getman"}}, "url": "https://github.com/minio/minio-java/commit/8384194934e1e1b501fdda41e2d0f48505b0aa55", "committedDate": "2020-07-23T15:59:42Z", "message": "Merge remote-tracking branch 'origin/sts-client-grants' into sts-client-grants\n\n# Conflicts:\n#\tapi/src/main/java/io/minio/MinioClient.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NjU5MTY4", "url": "https://github.com/minio/minio-java/pull/996#pullrequestreview-454659168", "createdAt": "2020-07-24T06:32:23Z", "commit": {"oid": "8384194934e1e1b501fdda41e2d0f48505b0aa55"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NjYwNTE5", "url": "https://github.com/minio/minio-java/pull/996#pullrequestreview-454660519", "createdAt": "2020-07-24T06:36:14Z", "commit": {"oid": "8384194934e1e1b501fdda41e2d0f48505b0aa55"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1942, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}