{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMzUyMDQ5", "number": 1063, "title": "fix x-amz-object-lock-retain-until-date header time format in ObjectWriteArgs", "bodyText": "Setting retention on upload/copy were failing stating Invalid date format.\nIssue can be replicated using the below code\nimport io.minio.CopyObjectArgs;\nimport io.minio.CopySource;\nimport io.minio.GetObjectRetentionArgs;\nimport io.minio.MinioClient;\nimport io.minio.Time;\nimport io.minio.errors.MinioException;\nimport io.minio.messages.Retention;\nimport io.minio.messages.RetentionMode;\nimport java.io.IOException;\nimport java.security.InvalidKeyException;\nimport java.security.NoSuchAlgorithmException;\nimport java.time.ZonedDateTime;\npublic class CopyObjectWithRetention {\n  /** MinioClient.copyObject() example. */\n  public static void main(String[] args)\n    throws IOException, NoSuchAlgorithmException, InvalidKeyException {\n    try {\n      /* play.min.io for test and development. */\n      MinioClient minioClient =\n        MinioClient.builder()\n          .endpoint(\"http://localhost:9000\")\n          .credentials(\"minio\", \"minio123\")\n          .build();\n      ZonedDateTime retentionUntil = ZonedDateTime.now(Time.UTC).plusDays(1).withNano(0);\n      Retention config = new Retention(RetentionMode.GOVERNANCE, retentionUntil);\n\n      minioClient.copyObject(\n        CopyObjectArgs.builder()\n          .bucket(\"lock2\")\n          .object(\"issue\")\n          .retention(config)\n          .source(\n            CopySource.builder()\n              .bucket(\"lock1\")\n              .object(\"goair\")\n              .build())\n          .build());\n      System.out.println(\n        \"lock/issue copied to lock/issue1 successfully\");\n    } catch (MinioException e) {\n      System.out.println(\"Error occurred: \" + e);\n    }\n  }\n}", "createdAt": "2020-09-24T10:38:52Z", "url": "https://github.com/minio/minio-java/pull/1063", "merged": true, "mergeCommit": {"oid": "983582694ea2bc866a912b600660bb35de3c9d8a"}, "closed": true, "closedAt": "2020-09-24T16:03:38Z", "author": {"login": "sinhaashish"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdL_RyZgFqTQ5NTQ2MDY4NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMDZaeAFqTQ5NTcyNTg3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NDYwNjg0", "url": "https://github.com/minio/minio-java/pull/1063#pullrequestreview-495460684", "createdAt": "2020-09-24T11:13:32Z", "commit": {"oid": "889c2bbc8ad4268b6526b4f718ece07d09dd7538"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMToxMzozMlrOHXVZjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMToxMzozMlrOHXVZjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIyOTkwMA==", "bodyText": "You would need to add this to putObject() test", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494229900", "createdAt": "2020-09-24T11:13:32Z", "author": {"login": "balamurugana"}, "path": "functional/FunctionalTest.java", "diffHunk": "@@ -2514,6 +2514,24 @@ public static void setObjectRetention() throws Exception {\n                 .config(new Retention())\n                 .bypassGovernanceMode(true)\n                 .build());\n+\n+        objectInfo =\n+            client.putObject(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "889c2bbc8ad4268b6526b4f718ece07d09dd7538"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "889c2bbc8ad4268b6526b4f718ece07d09dd7538", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/889c2bbc8ad4268b6526b4f718ece07d09dd7538", "committedDate": "2020-09-24T10:35:48Z", "message": "Date Format in Reetention"}, "afterCommit": {"oid": "db7e5a23516d8722f4f730d96e199e2f1f7baed6", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/db7e5a23516d8722f4f730d96e199e2f1f7baed6", "committedDate": "2020-09-24T11:35:33Z", "message": "Date Format in Reetention"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db7e5a23516d8722f4f730d96e199e2f1f7baed6", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/db7e5a23516d8722f4f730d96e199e2f1f7baed6", "committedDate": "2020-09-24T11:35:33Z", "message": "Date Format in Reetention"}, "afterCommit": {"oid": "3b314d018dbbedffc5b74b1981b385ee200f291c", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/3b314d018dbbedffc5b74b1981b385ee200f291c", "committedDate": "2020-09-24T12:18:18Z", "message": "Date Format in Retention"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b314d018dbbedffc5b74b1981b385ee200f291c", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/3b314d018dbbedffc5b74b1981b385ee200f291c", "committedDate": "2020-09-24T12:18:18Z", "message": "Date Format in Retention"}, "afterCommit": {"oid": "d08428d925540790964ccd617a745a73fd4a9e16", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/d08428d925540790964ccd617a745a73fd4a9e16", "committedDate": "2020-09-24T12:57:34Z", "message": "Date Format in Retention"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d08428d925540790964ccd617a745a73fd4a9e16", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/d08428d925540790964ccd617a745a73fd4a9e16", "committedDate": "2020-09-24T12:57:34Z", "message": "Date Format in Retention"}, "afterCommit": {"oid": "e27d98c95368d2f1ec9e53954390ae217e19ffbe", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/e27d98c95368d2f1ec9e53954390ae217e19ffbe", "committedDate": "2020-09-24T13:13:30Z", "message": "Date Format in Retention"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e27d98c95368d2f1ec9e53954390ae217e19ffbe", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/e27d98c95368d2f1ec9e53954390ae217e19ffbe", "committedDate": "2020-09-24T13:13:30Z", "message": "Date Format in Retention"}, "afterCommit": {"oid": "70072fed417181865db93765595e3f5c1e6b8602", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/70072fed417181865db93765595e3f5c1e6b8602", "committedDate": "2020-09-24T13:19:12Z", "message": "Date Format in Retention"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70072fed417181865db93765595e3f5c1e6b8602", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/70072fed417181865db93765595e3f5c1e6b8602", "committedDate": "2020-09-24T13:19:12Z", "message": "Date Format in Retention"}, "afterCommit": {"oid": "5c0284132cb19aa2c91e1a97cc4496d9cbae18e9", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/5c0284132cb19aa2c91e1a97cc4496d9cbae18e9", "committedDate": "2020-09-24T13:25:15Z", "message": "Date Format in Retention"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c0284132cb19aa2c91e1a97cc4496d9cbae18e9", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/5c0284132cb19aa2c91e1a97cc4496d9cbae18e9", "committedDate": "2020-09-24T13:25:15Z", "message": "Date Format in Retention"}, "afterCommit": {"oid": "0efe4191248073310a3c2d72bfdb07d1ef4cbead", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/0efe4191248073310a3c2d72bfdb07d1ef4cbead", "committedDate": "2020-09-24T13:34:39Z", "message": "Date Format in Retention"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "committedDate": "2020-09-24T13:38:30Z", "message": "Date Format in Retention"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0efe4191248073310a3c2d72bfdb07d1ef4cbead", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/0efe4191248073310a3c2d72bfdb07d1ef4cbead", "committedDate": "2020-09-24T13:34:39Z", "message": "Date Format in Retention"}, "afterCommit": {"oid": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a", "committedDate": "2020-09-24T13:38:30Z", "message": "Date Format in Retention"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NjczNzYz", "url": "https://github.com/minio/minio-java/pull/1063#pullrequestreview-495673763", "createdAt": "2020-09-24T15:07:06Z", "commit": {"oid": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNTowNzowNlrOHXfgxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNTowOTo1NVrOHXfoyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5NTU5MQ==", "bodyText": "Move ObjectWriteResponse objectInfo = null; here.", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494395591", "createdAt": "2020-09-24T15:07:06Z", "author": {"login": "balamurugana"}, "path": "functional/FunctionalTest.java", "diffHunk": "@@ -749,16 +749,31 @@ public static void testPutObject(String testTags, PutObjectArgs args, String err\n       throws Exception {\n     String methodName = \"putObject()\";\n     long startTime = System.currentTimeMillis();\n+    ObjectWriteResponse objectInfo = null;\n     try {\n       try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5NjAxMw==", "bodyText": "Use if (args.retention() != null)", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494396013", "createdAt": "2020-09-24T15:07:41Z", "author": {"login": "balamurugana"}, "path": "functional/FunctionalTest.java", "diffHunk": "@@ -749,16 +749,31 @@ public static void testPutObject(String testTags, PutObjectArgs args, String err\n       throws Exception {\n     String methodName = \"putObject()\";\n     long startTime = System.currentTimeMillis();\n+    ObjectWriteResponse objectInfo = null;\n     try {\n       try {\n-        client.putObject(args);\n+        objectInfo = client.putObject(args);\n       } catch (ErrorResponseException e) {\n         if (errorCode == null || !e.errorResponse().code().equals(errorCode)) {\n           throw e;\n         }\n       }\n+      if (testTags.equals(\"[With Retention]\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5NjU1Nw==", "bodyText": "Just use .versionId(objectInfo.versionId())", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494396557", "createdAt": "2020-09-24T15:08:24Z", "author": {"login": "balamurugana"}, "path": "functional/FunctionalTest.java", "diffHunk": "@@ -749,16 +749,31 @@ public static void testPutObject(String testTags, PutObjectArgs args, String err\n       throws Exception {\n     String methodName = \"putObject()\";\n     long startTime = System.currentTimeMillis();\n+    ObjectWriteResponse objectInfo = null;\n     try {\n       try {\n-        client.putObject(args);\n+        objectInfo = client.putObject(args);\n       } catch (ErrorResponseException e) {\n         if (errorCode == null || !e.errorResponse().code().equals(errorCode)) {\n           throw e;\n         }\n       }\n+      if (testTags.equals(\"[With Retention]\")) {\n+        client.setObjectRetention(\n+            SetObjectRetentionArgs.builder()\n+                .bucket(args.bucket())\n+                .object(args.object())\n+                .config(new Retention())\n+                .bypassGovernanceMode(true)\n+                .build());\n+      }\n       client.removeObject(\n-          RemoveObjectArgs.builder().bucket(args.bucket()).object(args.object()).build());\n+          RemoveObjectArgs.builder()\n+              .bucket(args.bucket())\n+              .object(args.object())\n+              .versionId(objectInfo != null ? objectInfo.versionId() : null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5NzEwNA==", "bodyText": "No need to declare a variable; instead use getRandomName() directly.", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494397104", "createdAt": "2020-09-24T15:09:13Z", "author": {"login": "balamurugana"}, "path": "functional/FunctionalTest.java", "diffHunk": "@@ -909,6 +924,16 @@ public static void putObject() throws Exception {\n             .build(),\n         null);\n \n+    String retainedObjectName = getRandomName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM5NzY0Mw==", "bodyText": "Keep tag lower cased.", "url": "https://github.com/minio/minio-java/pull/1063#discussion_r494397643", "createdAt": "2020-09-24T15:09:55Z", "author": {"login": "balamurugana"}, "path": "functional/FunctionalTest.java", "diffHunk": "@@ -909,6 +924,16 @@ public static void putObject() throws Exception {\n             .build(),\n         null);\n \n+    String retainedObjectName = getRandomName();\n+    testPutObject(\n+        \"[With Retention]\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4c2fd0a7f474a5c9b9bc13b8c729c88accc778a"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9c902cc53b212cd6ff7d3794d47fcf8c27dbbb3", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/b9c902cc53b212cd6ff7d3794d47fcf8c27dbbb3", "committedDate": "2020-09-24T15:35:50Z", "message": "Address review comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0819c512e73c78a8e1bd95b6849633c7a5424c58", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/0819c512e73c78a8e1bd95b6849633c7a5424c58", "committedDate": "2020-09-24T15:25:25Z", "message": "Address review comment"}, "afterCommit": {"oid": "b9c902cc53b212cd6ff7d3794d47fcf8c27dbbb3", "author": {"user": {"login": "sinhaashish", "name": "Ashish Kumar Sinha"}}, "url": "https://github.com/minio/minio-java/commit/b9c902cc53b212cd6ff7d3794d47fcf8c27dbbb3", "committedDate": "2020-09-24T15:35:50Z", "message": "Address review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NzExOTg0", "url": "https://github.com/minio/minio-java/pull/1063#pullrequestreview-495711984", "createdAt": "2020-09-24T15:46:47Z", "commit": {"oid": "b9c902cc53b212cd6ff7d3794d47fcf8c27dbbb3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NzI1ODc5", "url": "https://github.com/minio/minio-java/pull/1063#pullrequestreview-495725879", "createdAt": "2020-09-24T16:01:48Z", "commit": {"oid": "b9c902cc53b212cd6ff7d3794d47fcf8c27dbbb3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1798, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}