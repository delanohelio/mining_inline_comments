{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MjA1Mzg4", "number": 2057, "title": "GH-2056 more use of getStatement instead of filter", "bodyText": "GitHub issue resolved: #2056 \nBriefly describe the changes proposed in this PR:\n\nChange from Iterator to Iterable\nUse Iterable where possible in helper methods in Models class\nUse .getStatements where possible in the RDF4J code base", "createdAt": "2020-04-01T20:05:15Z", "url": "https://github.com/eclipse/rdf4j/pull/2057", "merged": true, "mergeCommit": {"oid": "46cb8bcda16461f3bf4a22fbfd368c9fc9d0abd7"}, "closed": true, "closedAt": "2020-04-04T07:57:45Z", "author": {"login": "hmottestad"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTd4riABqjMxODk1OTgwNTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUMC-ugFqTM4NzY1ODEyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1e576b21e0ad3e16eb12e8ae6de52c4238116a9", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/e1e576b21e0ad3e16eb12e8ae6de52c4238116a9", "committedDate": "2020-04-01T20:33:34Z", "message": "GH-2056 migrate to hashmap to be able to return the actual statement instead of a new statement in the SingletonIterator\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}, "afterCommit": {"oid": "210498fd2b54903e8a8fa274e0346ccac748ddf0", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/210498fd2b54903e8a8fa274e0346ccac748ddf0", "committedDate": "2020-04-01T20:39:29Z", "message": "GH-2056 migrate to hashmap to be able to return the actual statement instead of a new statement in the SingletonIterator\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1OTg5ODg2", "url": "https://github.com/eclipse/rdf4j/pull/2057#pullrequestreview-385989886", "createdAt": "2020-04-01T22:20:49Z", "commit": {"oid": "210498fd2b54903e8a8fa274e0346ccac748ddf0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMjoyMDo0OVrOF_Ut8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMjoyMjo1N1rOF_UxYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk0NDA0OQ==", "bodyText": "Ah. Using a HashMap to be able to match and retrieve the original statement, instead of the newly created copy. Clever.", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r401944049", "createdAt": "2020-04-01T22:20:49Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "diffHunk": "@@ -281,12 +296,32 @@ public void clear() {\n \t\t}\n \t}\n \n+\t@Override\n+\tpublic Iterator<Statement> getStatements(Resource subject, IRI predicate, Value object, Resource... contexts) {\n+\t\tif (model == null && subject != null && predicate != null && object != null && contexts != null\n+\t\t\t\t&& contexts.length == 1) {\n+\t\t\tStatement statement = SimpleValueFactory.getInstance()\n+\t\t\t\t\t.createStatement(subject, predicate, object, contexts[0]);\n+\t\t\tStatement foundStatement = statements.get(statement);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "210498fd2b54903e8a8fa274e0346ccac748ddf0"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk0NDkzMQ==", "bodyText": "Can we keep the old constructor signature as a (deprecated) overload? Just to keep things backward compatible.", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r401944931", "createdAt": "2020-04-01T22:22:57Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/DistinctModelReducingUnionIteration.java", "diffHunk": "@@ -34,15 +34,15 @@\n public class DistinctModelReducingUnionIteration extends LookAheadIteration<Statement, SailException> {\n \n \tDistinctModelReducingUnionIteration(CloseableIteration<? extends Statement, SailException> iterator, Model model,\n-\t\t\tFunction<Model, Model> filterable) {\n+\t\t\tFunction<Model, Iterator<Statement>> filterable) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "210498fd2b54903e8a8fa274e0346ccac748ddf0"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64b970b72934870125a02b48958d95a961df47d2", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/64b970b72934870125a02b48958d95a961df47d2", "committedDate": "2020-04-02T16:38:43Z", "message": "GH-2056 added benchmarks\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85c83a82d8e576c41aa195b042216e2aad97aef5", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/85c83a82d8e576c41aa195b042216e2aad97aef5", "committedDate": "2020-04-02T16:38:43Z", "message": "GH-2056 more use of getStatement instead of filter\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4391f9e88e610efb22e396d970c4abe258e4fea5", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/4391f9e88e610efb22e396d970c4abe258e4fea5", "committedDate": "2020-04-02T16:38:43Z", "message": "GH-2056 removed unnecessary filter\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "858889e02bcfce05862cab13cc3d6e5e69c7bea4", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/858889e02bcfce05862cab13cc3d6e5e69c7bea4", "committedDate": "2020-04-02T16:38:43Z", "message": "GH-2056 implemented getStatements in DynamicModel to handle single statements if possible\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20212298d8ab6b0c469d234885f92285872dbaf2", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/20212298d8ab6b0c469d234885f92285872dbaf2", "committedDate": "2020-04-02T16:38:43Z", "message": "GH-2056 migrate to hashmap to be able to return the actual statement instead of a new statement in the SingletonIterator\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d00be2ffebc56657e5f0c7a74ad0e59930a953ca", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/d00be2ffebc56657e5f0c7a74ad0e59930a953ca", "committedDate": "2020-04-02T16:38:24Z", "message": "GH-2056 added benchmarks\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}, "afterCommit": {"oid": "20212298d8ab6b0c469d234885f92285872dbaf2", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/20212298d8ab6b0c469d234885f92285872dbaf2", "committedDate": "2020-04-02T16:38:43Z", "message": "GH-2056 migrate to hashmap to be able to return the actual statement instead of a new statement in the SingletonIterator\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2Njg4MTQ2", "url": "https://github.com/eclipse/rdf4j/pull/2057#pullrequestreview-386688146", "createdAt": "2020-04-02T18:27:12Z", "commit": {"oid": "20212298d8ab6b0c469d234885f92285872dbaf2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODoyNzoxMlrOF_4GCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODoyNzoxMlrOF_4GCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyMzY1Nw==", "bodyText": "I don't think this change makes a difference for the results. The set of statements that are in iter but not in deprecated is the same unless the pattern used to filter deprecated is different from the pattern used by iter.\nThe difference is for performance. Now later on in the FilterIteration we can work directly with the hashmap without having to upgrade to a full LinkedHashModel because of a complicated filter operation.", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r402523657", "createdAt": "2020-04-02T18:27:12Z", "author": {"login": "hmottestad"}, "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/SailDatasetImpl.java", "diffHunk": "@@ -267,15 +267,16 @@ public void handleClose() throws SailException {\n \t\t}\n \t\tModel deprecated = changes.getDeprecated();\n \t\tif (deprecated != null && iter != null) {\n-\t\t\titer = difference(iter, deprecated.filter(subj, pred, obj, contexts));\n+\t\t\titer = difference(iter, deprecated);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20212298d8ab6b0c469d234885f92285872dbaf2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "860f72b2c529e8ffd3f85bbf9e577535270f17c9", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/860f72b2c529e8ffd3f85bbf9e577535270f17c9", "committedDate": "2020-04-03T07:16:01Z", "message": "GH-2056 migrate from iterator to iterable in order to support for-each loops\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "221d8b9448b6d721cdd4c51421860e3b4e59b805", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/221d8b9448b6d721cdd4c51421860e3b4e59b805", "committedDate": "2020-04-03T07:16:34Z", "message": "GH-2056 migrate more code to use getStatements instead of filter\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2OTg4Mjk1", "url": "https://github.com/eclipse/rdf4j/pull/2057#pullrequestreview-386988295", "createdAt": "2020-04-03T07:18:13Z", "commit": {"oid": "221d8b9448b6d721cdd4c51421860e3b4e59b805"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNzoxODoxM1rOGAH02g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNzoxODoxM1rOGAH02g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc4MTQwMg==", "bodyText": "@jeenbroekstra I'm proposing we move from iterator to iterable because iterable supports for-each loops and is also simpler to convert into a stream.", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r402781402", "createdAt": "2020-04-03T07:18:13Z", "author": {"login": "hmottestad"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/Model.java", "diffHunk": "@@ -191,14 +191,14 @@ public default boolean remove(Resource subj, URI pred, Value obj, Resource... co\n \t *                  matching any one of these will match. To match statements without an associated context, specify\n \t *                  the value {@code null} and explicitly cast it to type {@code Resource}.\n \t * @return an {@link Iterator} over the statements in this Model that match the specified pattern.\n-\t * \n+\t *\n \t * @since 3.2.0\n-\t * \n+\t *\n \t * @see #filter(Resource, IRI, Value, Resource...)\n \t */\n-\tpublic default Iterator<Statement> getStatements(Resource subject, IRI predicate, Value object,\n+\tpublic default Iterable<Statement> getStatements(Resource subject, IRI predicate, Value object,\n \t\t\tResource... contexts) {\n-\t\treturn filter(subject, predicate, object, contexts).iterator();\n+\t\treturn () -> filter(subject, predicate, object, contexts).iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "221d8b9448b6d721cdd4c51421860e3b4e59b805"}, "originalPosition": 103}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "878c8377a5445b6358d8c6d73c25a22e168475cb", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/878c8377a5445b6358d8c6d73c25a22e168475cb", "committedDate": "2020-04-03T09:13:54Z", "message": "GH-2056 updated java docs\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NjU4MTI0", "url": "https://github.com/eclipse/rdf4j/pull/2057#pullrequestreview-387658124", "createdAt": "2020-04-04T02:26:41Z", "commit": {"oid": "878c8377a5445b6358d8c6d73c25a22e168475cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 20, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}