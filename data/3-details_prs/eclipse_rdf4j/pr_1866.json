{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1MzEwMjU3", "number": 1866, "title": "GH-1535 NTriples and Turtle IRI escaping", "bodyText": "GitHub issue resolved: #1535 \nBriefly describe the changes proposed in this PR:\n\nNew IRI escaping method, using \\u for valid and % for invalid IRI characters\nUse it in both TurtleWriter and NTriplesWriter\nJavadoc corrections\nAdded Deprecated annotation to methods that should not be used (anymore)\nAdded test", "createdAt": "2020-01-21T13:39:44Z", "url": "https://github.com/eclipse/rdf4j/pull/1866", "merged": true, "mergeCommit": {"oid": "d219b94a930937106a8b13beb06bd00deb3ed0ec"}, "closed": true, "closedAt": "2020-01-28T20:26:26Z", "author": {"login": "barthanssens"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9SjK8gFqTM0NzY2NDA4Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-1q0HABqjI5ODY3NTU4MTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NjY0MDg2", "url": "https://github.com/eclipse/rdf4j/pull/1866#pullrequestreview-347664086", "createdAt": "2020-01-23T22:57:31Z", "commit": {"oid": "4718a867f98c705683bfc12da6add9d7d7195c27"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMjo1NzozMlrOFhPYMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMjo1NzozMlrOFhPYMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM5OTI4MA==", "bodyText": "I'm worried that using %-encoding is not the right way to go here. They effectively change the IRI. For example, http://a.example/%66oo-bar is not considered the same IRI as http://a.example/foo-bar (unless you specifically use IRI percent encoding normalization).", "url": "https://github.com/eclipse/rdf4j/pull/1866#discussion_r370399280", "createdAt": "2020-01-23T22:57:32Z", "author": {"login": "jeenbroekstra"}, "path": "core/util/src/main/java/org/eclipse/rdf4j/common/text/StringUtil.java", "diffHunk": "@@ -72,8 +82,61 @@ public static String gsub(String olds, String news, String text) {\n \t\treturn buf.toString();\n \t}\n \n+\tprivate static String hex(int c) {\n+\t\treturn Integer.toHexString(c).toUpperCase(Locale.US);\n+\t}\n+\n+\t/**\n+\t * Escapes string to a (mostly) conforming IRI value and append it to the appendable. Most invalid characters are\n+\t * percent-encoded, non-ASCII values can optionally be numerically encoded.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4718a867f98c705683bfc12da6add9d7d7195c27"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MDE3NTg4", "url": "https://github.com/eclipse/rdf4j/pull/1866#pullrequestreview-349017588", "createdAt": "2020-01-27T22:22:51Z", "commit": {"oid": "59516c94612362e87c1468f96e42b40b1106ff79"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMjoyMjo1MVrOFiTjig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMjoyMjo1MVrOFiTjig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUxNjI5OA==", "bodyText": "This stringbuilder is no longer used.", "url": "https://github.com/eclipse/rdf4j/pull/1866#discussion_r371516298", "createdAt": "2020-01-27T22:22:51Z", "author": {"login": "jeenbroekstra"}, "path": "core/rio/ntriples/src/main/java/org/eclipse/rdf4j/rio/ntriples/NTriplesUtil.java", "diffHunk": "@@ -252,22 +276,45 @@ public static void append(Resource resource, Appendable appendable) throws IOExc\n \n \t/**\n \t * Creates an N-Triples string for the supplied URI.\n+\t * \n+\t * @param uri\n+\t * @return string\n \t */\n \tpublic static String toNTriplesString(IRI uri) {\n \t\treturn \"<\" + escapeString(uri.toString()) + \">\";\n \t}\n \n+\t/**\n+\t * Appends the N-Triples representation of the given {@link IRI} to the given {@link Appendable}.\n+\t * \n+\t * @param uri        The IRI to write.\n+\t * @param appendable The object to append to.\n+\t * @throws IOException\n+\t */\n \tpublic static void append(IRI uri, Appendable appendable) throws IOException {\n+\t\tappend(uri, appendable, true);\n+\t}\n+\n+\t/**\n+\t * Appends the N-Triples representation of the given {@link IRI} to the given {@link Appendable}.\n+\t * \n+\t * @param uri\n+\t * @param appendable\n+\t * @param escapeUnicode\n+\t * @throws java.io.IOException\n+\t */\n+\tpublic static void append(IRI uri, Appendable appendable, boolean escapeUnicode) throws IOException {\n \t\tStringBuilder sb = new StringBuilder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59516c94612362e87c1468f96e42b40b1106ff79"}, "originalPosition": 121}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1a5f0deb2abf1908dcd3a89a2014f40b7870342", "author": {"user": {"login": "barthanssens", "name": "Bart Hanssens"}}, "url": "https://github.com/eclipse/rdf4j/commit/e1a5f0deb2abf1908dcd3a89a2014f40b7870342", "committedDate": "2020-01-28T18:28:43Z", "message": "GH-1535 New escapeIRI method, javadoc corrections + added deprecated annotations\n\nSigned-off-by: Bart Hanssens <bart.hanssens@bosa.fgov.be>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "29ee65e50618297695ad6d3a5721434756b8b56f", "author": {"user": {"login": "barthanssens", "name": "Bart Hanssens"}}, "url": "https://github.com/eclipse/rdf4j/commit/29ee65e50618297695ad6d3a5721434756b8b56f", "committedDate": "2020-01-28T18:03:39Z", "message": "GH-1535 remove unused StringBuilder\nSigned-off-by:Bart Hanssens <bart.hanssens@bosa.fgov.be>"}, "afterCommit": {"oid": "e1a5f0deb2abf1908dcd3a89a2014f40b7870342", "author": {"user": {"login": "barthanssens", "name": "Bart Hanssens"}}, "url": "https://github.com/eclipse/rdf4j/commit/e1a5f0deb2abf1908dcd3a89a2014f40b7870342", "committedDate": "2020-01-28T18:28:43Z", "message": "GH-1535 New escapeIRI method, javadoc corrections + added deprecated annotations\n\nSigned-off-by: Bart Hanssens <bart.hanssens@bosa.fgov.be>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 56, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}