{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMjExMjcx", "number": 1957, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMDozNjo0MFrODkebPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDozNTozM1rODlrXDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTczODIzOnYy", "diffSide": "RIGHT", "path": "core/query/src/main/java/org/eclipse/rdf4j/query/QueryResults.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMDozNjo0MFrOFw0c3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMDozNjo0MFrOFw0c3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjczNTMyNQ==", "bodyText": "While we're at it, perhaps we could make the ModelFactory injectable here as well, by introducing a method overload. E.g. something like this:\npublic static Model asModel(CloseableIteration<? extends Statement, ? extends RDF4JException> iteration) {\n      return asModel(iteration, new SimpleUpgradeableModelFactory());\n }\n public static Model asModel(CloseableIteration<? extends Statement, ? extends RDF4JException> iteration, ModelFactory modelFactory) {\n                 Model model = modelFactory.createEmptyModel();\n                 ....", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r386735325", "createdAt": "2020-03-03T00:36:40Z", "author": {"login": "jeenbroekstra"}, "path": "core/query/src/main/java/org/eclipse/rdf4j/query/QueryResults.java", "diffHunk": "@@ -66,7 +68,7 @@\n \t */\n \tpublic static Model asModel(CloseableIteration<? extends Statement, ? extends RDF4JException> iteration)\n \t\t\tthrows QueryEvaluationException {\n-\t\tModel model = new LinkedHashModel();\n+\t\tModel model = new SimpleUpgradeableModel(new LinkedHashModelFactory());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c79c33a1299fa6aabdd0bc967d72bdd8d732700"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTc0MTI2OnYy", "diffSide": "RIGHT", "path": "core/rio/api/src/main/java/org/eclipse/rdf4j/rio/Rio.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMDozNzo1OVrOFw0egA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMDozNzo1OVrOFw0egA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjczNTc0NA==", "bodyText": "Same here - could we make it injectable?", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r386735744", "createdAt": "2020-03-03T00:37:59Z", "author": {"login": "jeenbroekstra"}, "path": "core/rio/api/src/main/java/org/eclipse/rdf4j/rio/Rio.java", "diffHunk": "@@ -258,12 +259,12 @@ public static Model parse(Reader reader, String baseURI, RDFFormat dataFormat, R\n \tpublic static Model parse(InputStream in, String baseURI, RDFFormat dataFormat, ParserConfig settings,\n \t\t\tValueFactory valueFactory, ParseErrorListener errors, Resource... contexts)\n \t\t\tthrows IOException, RDFParseException, UnsupportedRDFormatException {\n-\t\tModel result = new LinkedHashModel();\n+\t\tModel result = new SimpleUpgradeableModel(new LinkedHashModelFactory());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c79c33a1299fa6aabdd0bc967d72bdd8d732700"}, "originalPosition": 141}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTc0NjU0OnYy", "diffSide": "RIGHT", "path": "core/rio/api/src/main/java/org/eclipse/rdf4j/rio/Rio.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMDo0MDo0NFrOFw0hgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMDo0MDo0NFrOFw0hgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjczNjUxNQ==", "bodyText": "..and here as well", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r386736515", "createdAt": "2020-03-03T00:40:44Z", "author": {"login": "jeenbroekstra"}, "path": "core/rio/api/src/main/java/org/eclipse/rdf4j/rio/Rio.java", "diffHunk": "@@ -292,12 +293,12 @@ public static Model parse(InputStream in, String baseURI, RDFFormat dataFormat,\n \tpublic static Model parse(Reader reader, String baseURI, RDFFormat dataFormat, ParserConfig settings,\n \t\t\tValueFactory valueFactory, ParseErrorListener errors, Resource... contexts)\n \t\t\tthrows IOException, RDFParseException, UnsupportedRDFormatException {\n-\t\tModel result = new LinkedHashModel();\n+\t\tModel result = new SimpleUpgradeableModel(new LinkedHashModelFactory());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c79c33a1299fa6aabdd0bc967d72bdd8d732700"}, "originalPosition": 165}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NjgyMTI0OnYy", "diffSide": "RIGHT", "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwOTo0NTozMFrOFw-rRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNDo1NDoyNVrOFxf-gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkwMjg1NQ==", "bodyText": "In order to get the most out of sails that use the notifying behaviour we need to implement simple support for filter. I read that the docs specify that filter(...) should return a view of the current model, rather than a new model or an unmodifiable model. Not sure how to implement this with the performance I want. Have you worked with the FilteredModel before @jeenbroekstra ?", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r386902855", "createdAt": "2020-03-03T09:45:30Z", "author": {"login": "hmottestad"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "diffHunk": "@@ -141,6 +142,35 @@ public boolean remove(Resource subj, IRI pred, Value obj, Resource... contexts)\n \n \t@Override\n \tpublic Model filter(Resource subj, IRI pred, Value obj, Resource... contexts) {\n+\t\tif (model == null && statements.size() == 0) {\n+\t\t\treturn new EmptyModel(this);\n+\t\t}\n+\n+\t\tif (model == null && subj != null && pred != null && obj != null && contexts.length == 1) {\n+\t\t\tStatement needle = SimpleValueFactory.getInstance().createStatement(subj, pred, obj, contexts[0]);\n+\t\t\tif (statements.size() == 1) {\n+\t\t\t\tStatement s = (Statement) statements.toArray()[0];\n+\n+\t\t\t\tDynamicModel ret = new DynamicModel(modelFactory);\n+\n+\t\t\t\tif (s.equals(needle)) {\n+\t\t\t\t\tret.add(s);\n+\t\t\t\t}\n+\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tDynamicModel ret = new DynamicModel(modelFactory);\n+\t\t\tif (statements.contains(needle)) {\n+\t\t\t\tret.add(needle);\n+\t\t\t}\n+\t\t\treturn ret;\n+\t\t}\n+\n+\t\tif (subj == null && pred == null && obj == null && contexts.length == 0) {\n+\t\t\treturn this;\n+\t\t}\n+\n \t\tupgrade();\n \t\treturn model.filter(subj, pred, obj, contexts);\n \t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63826e1e4a2a17a518cd3809c2a932264ca545d"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ0Mjc4MQ==", "bodyText": "I'm not sure what problem you're trying to solve here, to be honest. Just filter on the underlying model when filter is used. It will use a FilteredModel internally. FilteredModel is just a wrapper around the original model that internally keeps track of fixed subject, predicate, object and/or context to, well, filter statements dynamically.", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r387442781", "createdAt": "2020-03-04T04:25:54Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "diffHunk": "@@ -141,6 +142,35 @@ public boolean remove(Resource subj, IRI pred, Value obj, Resource... contexts)\n \n \t@Override\n \tpublic Model filter(Resource subj, IRI pred, Value obj, Resource... contexts) {\n+\t\tif (model == null && statements.size() == 0) {\n+\t\t\treturn new EmptyModel(this);\n+\t\t}\n+\n+\t\tif (model == null && subj != null && pred != null && obj != null && contexts.length == 1) {\n+\t\t\tStatement needle = SimpleValueFactory.getInstance().createStatement(subj, pred, obj, contexts[0]);\n+\t\t\tif (statements.size() == 1) {\n+\t\t\t\tStatement s = (Statement) statements.toArray()[0];\n+\n+\t\t\t\tDynamicModel ret = new DynamicModel(modelFactory);\n+\n+\t\t\t\tif (s.equals(needle)) {\n+\t\t\t\t\tret.add(s);\n+\t\t\t\t}\n+\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tDynamicModel ret = new DynamicModel(modelFactory);\n+\t\t\tif (statements.contains(needle)) {\n+\t\t\t\tret.add(needle);\n+\t\t\t}\n+\t\t\treturn ret;\n+\t\t}\n+\n+\t\tif (subj == null && pred == null && obj == null && contexts.length == 0) {\n+\t\t\treturn this;\n+\t\t}\n+\n \t\tupgrade();\n \t\treturn model.filter(subj, pred, obj, contexts);\n \t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkwMjg1NQ=="}, "originalCommit": {"oid": "e63826e1e4a2a17a518cd3809c2a932264ca545d"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ0ODQ1MA==", "bodyText": "I haven't thought this through fully, but if your idea is to somehow postpone upgrading when filtering by just using the original DynamicModel in corner cases, you could just do this by returning a new FilteredModel that internally creates an iterator, and put your filtering / upgrade logic in that iterator. As long as you make sure that what you return is a filtered view on the original Model, so that any future modifications of that result object get reflected in the original model, you're good.\nBut perhaps you shouldn't sweat over this too much right now. I get the feeling you're trying to push too many optimizations in one PR, and this change is really out of scope: it's supposed to be about using the DynamicModel in more places, not about optimizing the DynamicModel itself even further.", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r387448450", "createdAt": "2020-03-04T04:54:25Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "diffHunk": "@@ -141,6 +142,35 @@ public boolean remove(Resource subj, IRI pred, Value obj, Resource... contexts)\n \n \t@Override\n \tpublic Model filter(Resource subj, IRI pred, Value obj, Resource... contexts) {\n+\t\tif (model == null && statements.size() == 0) {\n+\t\t\treturn new EmptyModel(this);\n+\t\t}\n+\n+\t\tif (model == null && subj != null && pred != null && obj != null && contexts.length == 1) {\n+\t\t\tStatement needle = SimpleValueFactory.getInstance().createStatement(subj, pred, obj, contexts[0]);\n+\t\t\tif (statements.size() == 1) {\n+\t\t\t\tStatement s = (Statement) statements.toArray()[0];\n+\n+\t\t\t\tDynamicModel ret = new DynamicModel(modelFactory);\n+\n+\t\t\t\tif (s.equals(needle)) {\n+\t\t\t\t\tret.add(s);\n+\t\t\t\t}\n+\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tDynamicModel ret = new DynamicModel(modelFactory);\n+\t\t\tif (statements.contains(needle)) {\n+\t\t\t\tret.add(needle);\n+\t\t\t}\n+\t\t\treturn ret;\n+\t\t}\n+\n+\t\tif (subj == null && pred == null && obj == null && contexts.length == 0) {\n+\t\t\treturn this;\n+\t\t}\n+\n \t\tupgrade();\n \t\treturn model.filter(subj, pred, obj, contexts);\n \t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkwMjg1NQ=="}, "originalCommit": {"oid": "e63826e1e4a2a17a518cd3809c2a932264ca545d"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDI5NTcxOnYy", "diffSide": "RIGHT", "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNDo0MToyOFrOFxf0WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNToxNDowMFrOFxgN5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ0NTg0OA==", "bodyText": "This isn't valid - you can't return a new Model object as the result of the filter. If someone were to add something to this empty model, that should be reflected in the original.\nI'm a little surprised there are no failing tests for this to be honest. I thought James had created a comprehensive set of tests for Model behavior. This expectation should be reflected in the tests on the filter method.", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r387445848", "createdAt": "2020-03-04T04:41:28Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "diffHunk": "@@ -141,6 +142,35 @@ public boolean remove(Resource subj, IRI pred, Value obj, Resource... contexts)\n \n \t@Override\n \tpublic Model filter(Resource subj, IRI pred, Value obj, Resource... contexts) {\n+\t\tif (model == null && statements.size() == 0) {\n+\t\t\treturn new EmptyModel(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a0787b53627d4c9bab6604825b59c571bc5f395"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ1MjM4OQ==", "bodyText": "I'll push a couple of tests for this to this PR to make it easier.", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r387452389", "createdAt": "2020-03-04T05:14:00Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "diffHunk": "@@ -141,6 +142,35 @@ public boolean remove(Resource subj, IRI pred, Value obj, Resource... contexts)\n \n \t@Override\n \tpublic Model filter(Resource subj, IRI pred, Value obj, Resource... contexts) {\n+\t\tif (model == null && statements.size() == 0) {\n+\t\t\treturn new EmptyModel(this);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ0NTg0OA=="}, "originalCommit": {"oid": "4a0787b53627d4c9bab6604825b59c571bc5f395"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDI5NjI3OnYy", "diffSide": "RIGHT", "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNDo0MTo1MFrOFxf0qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNDo0MTo1MFrOFxf0qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ0NTkyOA==", "bodyText": "Same here.", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r387445928", "createdAt": "2020-03-04T04:41:50Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "diffHunk": "@@ -141,6 +142,35 @@ public boolean remove(Resource subj, IRI pred, Value obj, Resource... contexts)\n \n \t@Override\n \tpublic Model filter(Resource subj, IRI pred, Value obj, Resource... contexts) {\n+\t\tif (model == null && statements.size() == 0) {\n+\t\t\treturn new EmptyModel(this);\n+\t\t}\n+\n+\t\tif (model == null && subj != null && pred != null && obj != null && contexts.length == 1) {\n+\t\t\tStatement needle = SimpleValueFactory.getInstance().createStatement(subj, pred, obj, contexts[0]);\n+\t\t\tif (statements.size() == 1) {\n+\t\t\t\tStatement s = (Statement) statements.toArray()[0];\n+\n+\t\t\t\tDynamicModel ret = new DynamicModel(modelFactory);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a0787b53627d4c9bab6604825b59c571bc5f395"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwMDMwNTg0OnYy", "diffSide": "RIGHT", "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNDo0OTozOFrOFxf6mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNDo0OTozOFrOFxf6mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ0NzQ0OA==", "bodyText": "...and here as well.", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r387447448", "createdAt": "2020-03-04T04:49:38Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "diffHunk": "@@ -141,6 +142,35 @@ public boolean remove(Resource subj, IRI pred, Value obj, Resource... contexts)\n \n \t@Override\n \tpublic Model filter(Resource subj, IRI pred, Value obj, Resource... contexts) {\n+\t\tif (model == null && statements.size() == 0) {\n+\t\t\treturn new EmptyModel(this);\n+\t\t}\n+\n+\t\tif (model == null && subj != null && pred != null && obj != null && contexts.length == 1) {\n+\t\t\tStatement needle = SimpleValueFactory.getInstance().createStatement(subj, pred, obj, contexts[0]);\n+\t\t\tif (statements.size() == 1) {\n+\t\t\t\tStatement s = (Statement) statements.toArray()[0];\n+\n+\t\t\t\tDynamicModel ret = new DynamicModel(modelFactory);\n+\n+\t\t\t\tif (s.equals(needle)) {\n+\t\t\t\t\tret.add(s);\n+\t\t\t\t}\n+\n+\t\t\t\treturn ret;\n+\t\t\t}\n+\n+\t\t\tDynamicModel ret = new DynamicModel(modelFactory);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a0787b53627d4c9bab6604825b59c571bc5f395"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwODM0MzE5OnYy", "diffSide": "RIGHT", "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/SailSourceConnection.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNDozNTozM1rOFys7lQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwODozODowM1rOFywzvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcwOTI2OQ==", "bodyText": "Just had a look at this after your remark. I'm not sure I follow the logic here to be honest. You've modified the check to only look in the null context. But what if the statement already existed (either inferred or explicit) in some other context? This adaptation will now report a new inferred statement even if in reality it might already have existed.", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r388709269", "createdAt": "2020-03-06T04:35:33Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/SailSourceConnection.java", "diffHunk": "@@ -544,9 +547,9 @@ public boolean addInferredStatement(Resource subj, IRI pred, Value obj, Resource\n \t\t\t}\n \t\t\tboolean modified = false;\n \t\t\tif (contexts.length == 0) {\n-\t\t\t\tif (!hasStatement(explicitOnlyDataset, subj, pred, obj)) {\n+\t\t\t\tif (!hasStatement(explicitOnlyDataset, subj, pred, obj, NULL_CTX)) {\n \t\t\t\t\t// only add inferred statements that aren't already explicit\n-\t\t\t\t\tif (!hasStatement(inferredOnlyDataset, subj, pred, obj)) {\n+\t\t\t\t\tif (!hasStatement(inferredOnlyDataset, subj, pred, obj, NULL_CTX)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "229722eb245889d155ba48fa21cad98a75eb955d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcwOTU5MQ==", "bodyText": "It would seem more logical to me if this check explicitly looked at the context you're trying to insert the new statement to.", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r388709591", "createdAt": "2020-03-06T04:37:21Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/SailSourceConnection.java", "diffHunk": "@@ -544,9 +547,9 @@ public boolean addInferredStatement(Resource subj, IRI pred, Value obj, Resource\n \t\t\t}\n \t\t\tboolean modified = false;\n \t\t\tif (contexts.length == 0) {\n-\t\t\t\tif (!hasStatement(explicitOnlyDataset, subj, pred, obj)) {\n+\t\t\t\tif (!hasStatement(explicitOnlyDataset, subj, pred, obj, NULL_CTX)) {\n \t\t\t\t\t// only add inferred statements that aren't already explicit\n-\t\t\t\t\tif (!hasStatement(inferredOnlyDataset, subj, pred, obj)) {\n+\t\t\t\t\tif (!hasStatement(inferredOnlyDataset, subj, pred, obj, NULL_CTX)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcwOTI2OQ=="}, "originalCommit": {"oid": "229722eb245889d155ba48fa21cad98a75eb955d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODczMzE5Mg==", "bodyText": "It would seem more logical to me if this check explicitly looked at the context you're trying to insert the new statement to.\n\nIt does. There are two branches. One for context.length == 0 and one for length >= 1. This is for length == 0.", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r388733192", "createdAt": "2020-03-06T06:32:11Z", "author": {"login": "hmottestad"}, "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/SailSourceConnection.java", "diffHunk": "@@ -544,9 +547,9 @@ public boolean addInferredStatement(Resource subj, IRI pred, Value obj, Resource\n \t\t\t}\n \t\t\tboolean modified = false;\n \t\t\tif (contexts.length == 0) {\n-\t\t\t\tif (!hasStatement(explicitOnlyDataset, subj, pred, obj)) {\n+\t\t\t\tif (!hasStatement(explicitOnlyDataset, subj, pred, obj, NULL_CTX)) {\n \t\t\t\t\t// only add inferred statements that aren't already explicit\n-\t\t\t\t\tif (!hasStatement(inferredOnlyDataset, subj, pred, obj)) {\n+\t\t\t\t\tif (!hasStatement(inferredOnlyDataset, subj, pred, obj, NULL_CTX)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcwOTI2OQ=="}, "originalCommit": {"oid": "229722eb245889d155ba48fa21cad98a75eb955d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc3Mjc5Nw==", "bodyText": "Ah, right, I missed that in the diff!", "url": "https://github.com/eclipse/rdf4j/pull/1957#discussion_r388772797", "createdAt": "2020-03-06T08:38:03Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/SailSourceConnection.java", "diffHunk": "@@ -544,9 +547,9 @@ public boolean addInferredStatement(Resource subj, IRI pred, Value obj, Resource\n \t\t\t}\n \t\t\tboolean modified = false;\n \t\t\tif (contexts.length == 0) {\n-\t\t\t\tif (!hasStatement(explicitOnlyDataset, subj, pred, obj)) {\n+\t\t\t\tif (!hasStatement(explicitOnlyDataset, subj, pred, obj, NULL_CTX)) {\n \t\t\t\t\t// only add inferred statements that aren't already explicit\n-\t\t\t\t\tif (!hasStatement(inferredOnlyDataset, subj, pred, obj)) {\n+\t\t\t\t\tif (!hasStatement(inferredOnlyDataset, subj, pred, obj, NULL_CTX)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcwOTI2OQ=="}, "originalCommit": {"oid": "229722eb245889d155ba48fa21cad98a75eb955d"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1668, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}