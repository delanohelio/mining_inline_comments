{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MzA5NTU5", "number": 2403, "title": "GH-2187 keep parent reference in querymodelnode consistent", "bodyText": "GitHub issue resolved: #2187 \nBriefly describe the changes proposed in this PR:\n\nensure optimizers and other components that manipulate the algebra tree keep the parent node references consistent\nadded \"cleanup\" at end of optimizer pipeline to catch any wrongdoers\nadded regression tests for all optimizer implementations\n\n\nPR Author Checklist (see the contributor guidelines for more details):\n\n my pull request is self-contained\n I've added tests for the changes I made\n I've applied code formatting (you can use mvn process-resources to format from the command line)\n every commit message starts with the issue number (GH-xxxx) followed by a meaningful description of the change\n every commit has been signed off\n\nNote: we merge all feature pull requests using squash and merge. See RDF4J git merge strategy for more details.", "createdAt": "2020-07-29T09:24:01Z", "url": "https://github.com/eclipse/rdf4j/pull/2403", "merged": true, "mergeCommit": {"oid": "3395bbffc47f1cf034694ac1646f14e263beccaa"}, "closed": true, "closedAt": "2021-04-16T06:11:41Z", "author": {"login": "jeenbroekstra"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5nlzKgBqjM1OTgxNDkwMTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeNkofogBqjQ2MDI4NTg0NDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be3a3ca0e9a38b635ead8c43bac8f23c4150288d", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/be3a3ca0e9a38b635ead8c43bac8f23c4150288d", "committedDate": "2020-05-06T07:40:15Z", "message": "good point to debug\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}, "afterCommit": {"oid": "7f0604cdcdf66a25ab1540c7378c1cd145048374", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/7f0604cdcdf66a25ab1540c7378c1cd145048374", "committedDate": "2020-07-29T09:27:08Z", "message": "good point to debug\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f0604cdcdf66a25ab1540c7378c1cd145048374", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/7f0604cdcdf66a25ab1540c7378c1cd145048374", "committedDate": "2020-07-29T09:27:08Z", "message": "good point to debug\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}, "afterCommit": {"oid": "cf0aaa360518fb23fa492d49c6a50eef1f985800", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/cf0aaa360518fb23fa492d49c6a50eef1f985800", "committedDate": "2021-04-13T05:21:02Z", "message": "good point to debug\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1065a2cc11fa58769bf4ae0ebe07a02f82808393", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/1065a2cc11fa58769bf4ae0ebe07a02f82808393", "committedDate": "2021-04-15T00:15:35Z", "message": "GH-2187 code cleanup and turn temp test into proper test"}, "afterCommit": {"oid": "1dec6eaaa25376481dd79632924a2e27644ef0c8", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/1dec6eaaa25376481dd79632924a2e27644ef0c8", "committedDate": "2021-04-15T00:43:47Z", "message": "GH-2187 code cleanup and turn temp test into proper test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM3MzMyMTc1", "url": "https://github.com/eclipse/rdf4j/pull/2403#pullrequestreview-637332175", "createdAt": "2021-04-16T05:05:07Z", "commit": {"oid": "1dec6eaaa25376481dd79632924a2e27644ef0c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xNlQwNTowNTowN1rOJKF4RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xNlQwNTowNTowN1rOJKF4RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDU2MTg2MQ==", "bodyText": "I would have been ok with you deleting this test, but it's nice of you to turn it into a functional test.", "url": "https://github.com/eclipse/rdf4j/pull/2403#discussion_r614561861", "createdAt": "2021-04-16T05:05:07Z", "author": {"login": "hmottestad"}, "path": "core/sail/memory/src/test/java/org/eclipse/rdf4j/sail/memory/QueryPlanRetrievalTest.java", "diffHunk": "@@ -873,4 +873,38 @@ public void testDotTimed() {\n \n \t}\n \n+\t@Test\n+\tpublic void testArbitraryLengthPath() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dec6eaaa25376481dd79632924a2e27644ef0c8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM3MzMyOTY2", "url": "https://github.com/eclipse/rdf4j/pull/2403#pullrequestreview-637332966", "createdAt": "2021-04-16T05:07:36Z", "commit": {"oid": "1dec6eaaa25376481dd79632924a2e27644ef0c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xNlQwNTowNzozNlrOJKF7Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xNlQwNTowNzozNlrOJKF7Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNDU2MjYxOQ==", "bodyText": "What was the reason you added this? Did you see any cycles in query plan?", "url": "https://github.com/eclipse/rdf4j/pull/2403#discussion_r614562619", "createdAt": "2021-04-16T05:07:36Z", "author": {"login": "hmottestad"}, "path": "core/queryalgebra/model/src/main/java/org/eclipse/rdf4j/query/algebra/helpers/QueryModelTreeToGenericPlanNode.java", "diffHunk": "@@ -35,10 +37,11 @@ public GenericPlanNode getGenericPlanNode() {\n \t\treturn top;\n \t}\n \n-\t// node.getParentNode() is not reliable because nodes are reused and parent is not maintained! This is why we use a\n-\t// queue to maintain the effective parent stack.\n \t@Override\n \tprotected void meetNode(QueryModelNode node) {\n+\t\tassert !visited.containsKey(node);\n+\t\tvisited.put(node, node);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dec6eaaa25376481dd79632924a2e27644ef0c8"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76861e03c149c1f1416e6dba382e3ffd49555a48", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/76861e03c149c1f1416e6dba382e3ffd49555a48", "committedDate": "2021-04-16T05:30:01Z", "message": "GH-2187 added temporary test code for parent issue\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bf2cb1676cebca008a2eb3ff8efaf3ce40af3b8", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/5bf2cb1676cebca008a2eb3ff8efaf3ce40af3b8", "committedDate": "2021-04-16T05:30:01Z", "message": "GH-2187 fix uncloned reuse of variables in algebra evaluation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d43ed4bfe1bfb192c8ecfb49d5989af2e3b718f0", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/d43ed4bfe1bfb192c8ecfb49d5989af2e3b718f0", "committedDate": "2021-04-16T05:30:02Z", "message": "GH-2187 clone vars when creating new statement pattern\n\n- this makes sure parent node references do not become inconsistent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10d95d0953e72b4dfd8dfdebdec626196670dc28", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/10d95d0953e72b4dfd8dfdebdec626196670dc28", "committedDate": "2021-04-16T05:30:02Z", "message": "GH-2187 make sure parent references are consistent at end of optimization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5013e84fd4485c131a4f821fdb97ff7c14916a4", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/c5013e84fd4485c131a4f821fdb97ff7c14916a4", "committedDate": "2021-04-16T05:30:02Z", "message": "GH-2187 basic tree consistency tests for all standard optimizers"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1dec6eaaa25376481dd79632924a2e27644ef0c8", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/1dec6eaaa25376481dd79632924a2e27644ef0c8", "committedDate": "2021-04-15T00:43:47Z", "message": "GH-2187 code cleanup and turn temp test into proper test"}, "afterCommit": {"oid": "c5013e84fd4485c131a4f821fdb97ff7c14916a4", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/c5013e84fd4485c131a4f821fdb97ff7c14916a4", "committedDate": "2021-04-16T05:30:02Z", "message": "GH-2187 basic tree consistency tests for all standard optimizers"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 137, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}