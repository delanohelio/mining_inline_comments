{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwODk1Mzcz", "number": 1905, "title": "GH-1904: fix ThredPool initialization in FedX", "bodyText": "GitHub issue resolved: #1904\nIn FedX we use configurable threadpools for executing join and union sub\nqueries, as well as other remote requests. Also the pool size is meant\nto be configurable via FedXConfig setters.\nHowever, due to a bug in the construction of the ThreadPoolExecutor the\nsize is always set to a most 10 threads. This is because we have an\nunbound queue and set the minimumCoreSize to 10. In such setting new\nthreads are only created if the core size of the pool is not reached.\nWe now explicitly set the core pool size to the configured number of\nworkers, and in addition configure the pool in such a way that idle\nthreads can get destroyed. The idle timeout is set to 60s.", "createdAt": "2020-02-04T15:20:34Z", "url": "https://github.com/eclipse/rdf4j/pull/1905", "merged": true, "mergeCommit": {"oid": "5f5de6cfbc3da96b3fd8b939154dbd1546fa0ec5"}, "closed": true, "closedAt": "2020-02-05T07:56:47Z", "author": {"login": "aschwarte10"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBDI-6AH2gAyMzcwODk1MzczOjE1ZDJjOTMyZjYwZGI5N2ZhNTQzYWM3YmM3YTYzNmE0ZDkyMTQ4NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBRJ8LgFqTM1MzUxMzQ1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15d2c932f60db97fa543ac7bc7a636a4d9214859", "author": {"user": {"login": "aschwarte10", "name": "Andreas Schwarte"}}, "url": "https://github.com/eclipse/rdf4j/commit/15d2c932f60db97fa543ac7bc7a636a4d9214859", "committedDate": "2020-02-04T15:19:32Z", "message": "GH-1904: fix ThredPool initialization in FedX\n\nIn FedX we use configurable threadpools for executing join and union sub\nqueries, as well as other remote requests. Also the pool size is meant\nto be configurable via FedXConfig setters.\n\nHowever, due to a bug in the construction of the ThreadPoolExecutor the\nsize is always set to a most 10 threads. This is because we have an\nunbound queue and set the minimumCoreSize to 10. In such setting new\nthreads are only created if the core size of the pool is not reached.\n\nWe now explicitly set the core pool size to the configured number of\nworkers, and in addition configure the pool in such a way that idle\nthreads can get destroyed. The idle timeout is set to 60s."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMTgzMjk1", "url": "https://github.com/eclipse/rdf4j/pull/1905#pullrequestreview-353183295", "createdAt": "2020-02-04T17:58:46Z", "commit": {"oid": "15d2c932f60db97fa543ac7bc7a636a4d9214859"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNzo1ODo0NlrOFldzCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNzo1ODo0NlrOFldzCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgyOTgzMg==", "bodyText": "Btw. Unrelated to this particular PR. I noticed a lot of Protected variables in this class, do you need them to be available so broadly.\nAlso, I was wondering what happens if you call initWorkerThreads multiple times? Does it create a bunch of thread pools?", "url": "https://github.com/eclipse/rdf4j/pull/1905#discussion_r374829832", "createdAt": "2020-02-04T17:58:46Z", "author": {"login": "hmottestad"}, "path": "tools/federation/src/main/java/org/eclipse/rdf4j/federated/evaluation/concurrent/ControlledWorkerScheduler.java", "diffHunk": "@@ -112,8 +112,10 @@ public int getNumberOfTasks() {\n \n \tprotected void initWorkerThreads() {\n \n-\t\texecutor = new ThreadPoolExecutor(Math.min(10, nWorkers / 2), nWorkers, 30L, TimeUnit.SECONDS, _taskQueue,\n+\t\tThreadPoolExecutor _executor = new ThreadPoolExecutor(nWorkers, nWorkers, 60L, TimeUnit.SECONDS, _taskQueue,\n \t\t\t\tnew NamingThreadFactory(name));\n+\t\t_executor.allowCoreThreadTimeOut(true);\n+\t\tthis.executor = _executor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15d2c932f60db97fa543ac7bc7a636a4d9214859"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDY5NjY3", "url": "https://github.com/eclipse/rdf4j/pull/1905#pullrequestreview-353469667", "createdAt": "2020-02-05T05:12:16Z", "commit": {"oid": "15d2c932f60db97fa543ac7bc7a636a4d9214859"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNToxMjoxN1rOFlr-hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNToxMjoxN1rOFlr-hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA2MjE0OA==", "bodyText": "@hmottestad I agree that some of these variables should be made private, but this close to release I'd rather have confirmation from @aschwarte10 that that won't break dependent code.\nAs for your second remark: it looks as if the intent is that initWorkerThreads is only invoked from the constructor. So that would happen only once.", "url": "https://github.com/eclipse/rdf4j/pull/1905#discussion_r375062148", "createdAt": "2020-02-05T05:12:17Z", "author": {"login": "jeenbroekstra"}, "path": "tools/federation/src/main/java/org/eclipse/rdf4j/federated/evaluation/concurrent/ControlledWorkerScheduler.java", "diffHunk": "@@ -112,8 +112,10 @@ public int getNumberOfTasks() {\n \n \tprotected void initWorkerThreads() {\n \n-\t\texecutor = new ThreadPoolExecutor(Math.min(10, nWorkers / 2), nWorkers, 30L, TimeUnit.SECONDS, _taskQueue,\n+\t\tThreadPoolExecutor _executor = new ThreadPoolExecutor(nWorkers, nWorkers, 60L, TimeUnit.SECONDS, _taskQueue,\n \t\t\t\tnew NamingThreadFactory(name));\n+\t\t_executor.allowCoreThreadTimeOut(true);\n+\t\tthis.executor = _executor;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgyOTgzMg=="}, "originalCommit": {"oid": "15d2c932f60db97fa543ac7bc7a636a4d9214859"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDg5NzA5", "url": "https://github.com/eclipse/rdf4j/pull/1905#pullrequestreview-353489709", "createdAt": "2020-02-05T06:28:36Z", "commit": {"oid": "db10678087cabc1d7289725d0bb331ec30dc57d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNjoyODozN1rOFls97Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNjoyODozN1rOFls97Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA3ODM4MQ==", "bodyText": "could executor be final?", "url": "https://github.com/eclipse/rdf4j/pull/1905#discussion_r375078381", "createdAt": "2020-02-05T06:28:37Z", "author": {"login": "hmottestad"}, "path": "tools/federation/src/main/java/org/eclipse/rdf4j/federated/evaluation/concurrent/ControlledWorkerScheduler.java", "diffHunk": "@@ -38,14 +38,14 @@\n  */\n public class ControlledWorkerScheduler<T> implements Scheduler<T> {\n \n-\tprotected static final Logger log = LoggerFactory.getLogger(ControlledWorkerScheduler.class);\n+\tprivate static final Logger log = LoggerFactory.getLogger(ControlledWorkerScheduler.class);\n \n-\tprotected ExecutorService executor;\n+\tprivate ExecutorService executor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db10678087cabc1d7289725d0bb331ec30dc57d3"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d60f082b73eaea5a19048e3a6f635a2801d36679", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/d60f082b73eaea5a19048e3a6f635a2801d36679", "committedDate": "2020-02-05T07:13:42Z", "message": "GH-1904 make fields and methods private"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db10678087cabc1d7289725d0bb331ec30dc57d3", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/db10678087cabc1d7289725d0bb331ec30dc57d3", "committedDate": "2020-02-05T06:22:47Z", "message": "GH-1904 make fields and methods private"}, "afterCommit": {"oid": "d60f082b73eaea5a19048e3a6f635a2801d36679", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/d60f082b73eaea5a19048e3a6f635a2801d36679", "committedDate": "2020-02-05T07:13:42Z", "message": "GH-1904 make fields and methods private"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNTEzNDU1", "url": "https://github.com/eclipse/rdf4j/pull/1905#pullrequestreview-353513455", "createdAt": "2020-02-05T07:39:15Z", "commit": {"oid": "d60f082b73eaea5a19048e3a6f635a2801d36679"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 63, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}