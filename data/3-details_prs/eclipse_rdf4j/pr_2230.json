{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4OTU0Mzk3", "number": 2230, "title": "GH-1481 accept graph patterns in DELETE WHERE updates", "bodyText": "GitHub issue resolved: #1481 \nBriefly describe the changes proposed in this PR:\nWe added a test that shows how the query described in #1481 can be run using SPARQLBuilder\n\nPR Author Checklist:\n\n my pull request is self-contained\n I've added tests for the changes I made\n every commit message starts with the issue number (GH-xxxx) followed by a meaningful description of the change\n every commit has been signed off\n\nNote: we merge all feature pull requests using squash and merge. See RDF4J git merge strategy for more details.", "createdAt": "2020-05-16T11:23:14Z", "url": "https://github.com/eclipse/rdf4j/pull/2230", "merged": true, "mergeCommit": {"oid": "15c0ec5a99c92d2328bd3cc01f6d32e426a8cb4d"}, "closed": true, "closedAt": "2020-05-28T01:19:34Z", "author": {"login": "deepali17043"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABciAow9AFqTQxMzExODQyNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcljcc3AFqTQxOTcxNDgwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTE4NDI1", "url": "https://github.com/eclipse/rdf4j/pull/2230#pullrequestreview-413118425", "createdAt": "2020-05-17T00:49:29Z", "commit": {"oid": "abf2cbd352aab4667f57f8f067b7c30986889de3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QwMDo0OToyOVrOGWddNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QwMDo1NToyN1rOGWdebg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIwNDQ2OA==", "bodyText": "We don't use a contrib.txt file in RDF4J, I'm afraid. Could you remove this?\nIf you're worried about going unrecognized: the commit history will of course show your name, and you will also show up on https://github.com/eclipse/rdf4j/graphs/contributors . In addition, you will get a mention in the release notes of course.", "url": "https://github.com/eclipse/rdf4j/pull/2230#discussion_r426204468", "createdAt": "2020-05-17T00:49:29Z", "author": {"login": "jeenbroekstra"}, "path": "contrib.txt", "diffHunk": "@@ -0,0 +1,3 @@\n+Kritika\n+Deepali\n+Anmol", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abf2cbd352aab4667f57f8f067b7c30986889de3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIwNDc4Mg==", "bodyText": "Good start with putting in a test. However, please note that the code in ...rdf4j/sparqlbuilder/examples is not really tests, but just usage examples. There is no checking in any of these tests (including yours) that the SparqlBuilder does what it's supposed to do, and produces the correct output.\nSince what you are testing here is the behavior of a ModifyQuery, I suggest you create a new unit test class in src/test/java: org.eclipse.rdf4j.sparqlbuilder.core.query.ModifyQueryTest, and put your test case in there. You should probably also put a test assertion (assertTrue or assertEquals) in to check that the resulting query string is what you expect it to be.", "url": "https://github.com/eclipse/rdf4j/pull/2230#discussion_r426204782", "createdAt": "2020-05-17T00:55:27Z", "author": {"login": "jeenbroekstra"}, "path": "core/sparqlbuilder/src/test/java/org/eclipse/rdf4j/sparqlbuilder/examples/updatespec/Section3Test.java", "diffHunk": "@@ -342,4 +342,29 @@ public void example_14() {\n \tpublic void example_15() {\n \t\tp(Queries.ADD().fromDefault().to(iri(\"http://example.org/named\")));\n \t}\n+\n+\t/**\n+\t * DELETE { GRAPH ?g1 { ?subject <http://my-example.com/anyIRI/> ?object . ?subject ?predicate\n+\t * <http://my-example.com/anyIRI/> . } } WHERE { GRAPH ?g1 { OPTIONAL { ?subject ?predicate\n+\t * <http://my-example.com/anyIRI/> . } OPTIONAL { ?subject <http://my-example.com/anyIRI/> ?object . } } }\n+\t */\n+\t@Test\n+\tpublic void example_issue_1481() {\n+\t\tModifyQuery modify = Queries.MODIFY();\n+\t\tIri g1 = () -> \"<g1>\";\n+\n+\t\tVariable subject = SparqlBuilder.var(\"subject\");\n+\t\tVariable obj = SparqlBuilder.var(\"object\");\n+\t\tPrefix pre = SparqlBuilder.prefix(iri(\"http://my-example.com/anyIRI/\"));\n+\t\tVariable predicate = SparqlBuilder.var(\"predicate\");\n+\n+\t\tTriplePattern delTriple1 = subject.has(pre.iri(\"\"), obj);\n+\t\tTriplePattern delTriple2 = subject.has(predicate, pre.iri(\"\"));\n+\t\tTriplePattern whereTriple1 = subject.has(predicate, pre.iri(\"\"));\n+\t\tTriplePattern whereTriple2 = subject.has(pre.iri(\"\"), obj);\n+\n+\t\tmodify.with(g1)\n+\t\t\t\t.delete(delTriple1, delTriple2)\n+\t\t\t\t.where(and(GraphPatterns.optional(whereTriple1), GraphPatterns.optional(whereTriple2)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abf2cbd352aab4667f57f8f067b7c30986889de3"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a7342aa3e5351223bd9bc71a14af5070e91fb69", "author": {"user": {"login": "deepali17043", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/3a7342aa3e5351223bd9bc71a14af5070e91fb69", "committedDate": "2020-05-17T05:38:13Z", "message": "Revert \"Formatting\"\n\nThis reverts commit abf2cbd352aab4667f57f8f067b7c30986889de3."}, "afterCommit": {"oid": "7591cce0b8548ab9ababc063c2c18dfd59d738e4", "author": {"user": {"login": "deepali17043", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/7591cce0b8548ab9ababc063c2c18dfd59d738e4", "committedDate": "2020-05-17T06:21:22Z", "message": "Revert \"Formatting\"\n\nThis reverts commit abf2cbd352aab4667f57f8f067b7c30986889de3.\n\nSigned-off-by: Deepali <deepali17043@iiitd.ac.in>\n\nSigned-off-by: Deepali Chawla <<deepali17043@iiitd.ac.in>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7591cce0b8548ab9ababc063c2c18dfd59d738e4", "author": {"user": {"login": "deepali17043", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/7591cce0b8548ab9ababc063c2c18dfd59d738e4", "committedDate": "2020-05-17T06:21:22Z", "message": "Revert \"Formatting\"\n\nThis reverts commit abf2cbd352aab4667f57f8f067b7c30986889de3.\n\nSigned-off-by: Deepali <deepali17043@iiitd.ac.in>\n\nSigned-off-by: Deepali Chawla <<deepali17043@iiitd.ac.in>"}, "afterCommit": {"oid": "556c8f3bab916aa5d9951fc6a722d6d1f1a815f5", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/556c8f3bab916aa5d9951fc6a722d6d1f1a815f5", "committedDate": "2020-05-07T03:31:40Z", "message": "Merge pull request #2195 from eclipse/releases/3.2.0\n\nnext development iteration: 3.2.1-SNAPSHOT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b6bee3287ed5d33856ac4c6feb16817d3346af7", "author": {"user": {"login": "deepali17043", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/8b6bee3287ed5d33856ac4c6feb16817d3346af7", "committedDate": "2020-05-17T06:40:04Z", "message": "1481 Exampletest\n\nSigned-off-by: Deepali <deepali17043@iiitd.ac.in>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76ebe977ead36ad2d2e703203307e30e852cff46", "author": {"user": {"login": "29kritika", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/76ebe977ead36ad2d2e703203307e30e852cff46", "committedDate": "2020-05-19T04:50:32Z", "message": "GH-1481: Added test\n\nSigned-off-by: Kritika <kritika17061@iiitd.ac.in>"}, "afterCommit": {"oid": "8b6bee3287ed5d33856ac4c6feb16817d3346af7", "author": {"user": {"login": "deepali17043", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/8b6bee3287ed5d33856ac4c6feb16817d3346af7", "committedDate": "2020-05-17T06:40:04Z", "message": "1481 Exampletest\n\nSigned-off-by: Deepali <deepali17043@iiitd.ac.in>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2296a044676f0036e1526f106fe450b31b1cf79e", "author": {"user": {"login": "29kritika", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/2296a044676f0036e1526f106fe450b31b1cf79e", "committedDate": "2020-05-19T13:30:39Z", "message": "GH-1481: Added test\n\nSigned-off-by: Kritika <kritika17061@iiitd.ac.in>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NDQ4OTY1", "url": "https://github.com/eclipse/rdf4j/pull/2230#pullrequestreview-417448965", "createdAt": "2020-05-25T04:23:12Z", "commit": {"oid": "2296a044676f0036e1526f106fe450b31b1cf79e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNDoyMzoxMlrOGZ0Ygw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNDoyMzoxMlrOGZ0Ygw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTcyNTgyNw==", "bodyText": "This has been copied to a new class ModifyQueryTest, which is good, but you still need to remove it from Section3Test again.", "url": "https://github.com/eclipse/rdf4j/pull/2230#discussion_r429725827", "createdAt": "2020-05-25T04:23:12Z", "author": {"login": "jeenbroekstra"}, "path": "core/sparqlbuilder/src/test/java/org/eclipse/rdf4j/sparqlbuilder/examples/updatespec/Section3Test.java", "diffHunk": "@@ -342,4 +342,30 @@ public void example_14() {\n \tpublic void example_15() {\n \t\tp(Queries.ADD().fromDefault().to(iri(\"http://example.org/named\")));\n \t}\n+\n+\t/**\n+\t * DELETE { GRAPH ?g1 { ?subject <http://my-example.com/anyIRI/> ?object . ?subject ?predicate\n+\t * <http://my-example.com/anyIRI/> . } } WHERE { GRAPH ?g1 { OPTIONAL { ?subject ?predicate\n+\t * <http://my-example.com/anyIRI/> . } OPTIONAL { ?subject <http://my-example.com/anyIRI/> ?object . } } }\n+\t */\n+\t@Test\n+\tpublic void example_issue_1481() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2296a044676f0036e1526f106fe450b31b1cf79e"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a98e19c50a8c30be87aea6c889c2389f8c2c407f", "author": {"user": {"login": "deepali17043", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/a98e19c50a8c30be87aea6c889c2389f8c2c407f", "committedDate": "2020-05-26T10:10:05Z", "message": "GH 1481 Removed fn from Section3Test\n\nSigned-off-by: Deepali <deepali17043@iiitd.ac.in>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NzE0ODA1", "url": "https://github.com/eclipse/rdf4j/pull/2230#pullrequestreview-419714805", "createdAt": "2020-05-28T01:19:02Z", "commit": {"oid": "a98e19c50a8c30be87aea6c889c2389f8c2c407f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 156, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}