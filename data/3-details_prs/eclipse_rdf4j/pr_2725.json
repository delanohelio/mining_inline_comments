{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMjE4NDM0", "number": 2725, "title": "GH-2724 Add more tests to validate behaviour of QueryBindingSet.", "bodyText": "Signed-off-by: Jerven bolleman jerven.bolleman@sib.swiss\nGitHub issue resolved: #2715\nBriefly describe the changes proposed in this PR:\nAdd new tests for the QueryBindingSet to make sure new implementations do not break existing usage.\n\nPR Author Checklist (see the contributor guidelines for more details):\n\n my pull request is self-contained\n I've added tests for the changes I made\n I've applied code formatting (you can use mvn process-resources to format from the command line)\n I've squashed my commits down to one or a few meaningful commits\n every commit message starts with the issue number (GH-xxxx) followed by a meaningful description of the change\n every commit has been signed off", "createdAt": "2020-12-16T14:48:21Z", "url": "https://github.com/eclipse/rdf4j/pull/2725", "merged": true, "mergeCommit": {"oid": "f318df8a9ebf6fc7e472c433afab8779cda9dea3"}, "closed": true, "closedAt": "2020-12-30T08:35:04Z", "author": {"login": "JervenBolleman"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmv8I5gH2gAyNTQxMjE4NDM0OjNlZjc4NjJhYzczNGE2Y2VhZGQxYTMxZmI3NmU0NmFlNGUzY2RiOWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdo5F7OAFqTU1NzY2NDk3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3ef7862ac734a6ceadd1a31fb76e46ae4e3cdb9a", "author": {"user": {"login": "JervenBolleman", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/3ef7862ac734a6ceadd1a31fb76e46ae4e3cdb9a", "committedDate": "2020-12-16T14:37:35Z", "message": "GH-2724 Add more tests to validate behaviour of QueryBindingSet.\n\nSigned-off-by: Jerven bolleman <jerven.bolleman@sib.swiss>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0Mjk4NzQ2", "url": "https://github.com/eclipse/rdf4j/pull/2725#pullrequestreview-554298746", "createdAt": "2020-12-17T05:56:15Z", "commit": {"oid": "3ef7862ac734a6ceadd1a31fb76e46ae4e3cdb9a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNTo1NjoxNVrOIHl4LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwNjowMzoyOFrOIHmB8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgzMTUzMg==", "bodyText": "I think catching AssertionErrors is not a good pattern, even in test code. All this is really testing here is that the assertions work. Assertions are themselves a debugging tool, I don't think we need to codify them in our test suite.", "url": "https://github.com/eclipse/rdf4j/pull/2725#discussion_r544831532", "createdAt": "2020-12-17T05:56:15Z", "author": {"login": "jeenbroekstra"}, "path": "core/queryalgebra/evaluation/src/test/java/org/eclipse/rdf4j/query/algebra/evaluation/QueryBindingSetTest.java", "diffHunk": "@@ -46,6 +54,136 @@ public void testEqualsMapBindingSet() {\n \t\tassertEquals(qbs, mbs);\n \t}\n \n+\t@Test\n+\tpublic void testAddAll() {\n+\t\t{\n+\t\t\tQueryBindingSet bs = new QueryBindingSet();\n+\t\t\tbs.addAll(new QueryBindingSet());\n+\t\t\tassertEquals(0, bs.size());\n+\t\t}\n+\t\t{\n+\t\t\tQueryBindingSet bs = new QueryBindingSet();\n+\t\t\tbs.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tbs.addAll(new QueryBindingSet());\n+\t\t\tassertEquals(1, bs.size());\n+\t\t}\n+\t\t{\n+\t\t\tQueryBindingSet bs = new QueryBindingSet();\n+\t\t\tbs.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tfinal QueryBindingSet bs2 = new QueryBindingSet();\n+\t\t\tbs2.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tbs.addAll(bs2);\n+\t\t\tassertEquals(1, bs.size());\n+\t\t}\n+\t\t{\n+\t\t\tQueryBindingSet bs = new QueryBindingSet();\n+\t\t\tbs.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tfinal QueryBindingSet bs2 = new QueryBindingSet();\n+\t\t\tbs2.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tbs2.addBinding(\"bar\", vf.createIRI(\"urn:bar\"));\n+\t\t\tbs.addAll(bs2);\n+\t\t\tassertEquals(2, bs.size());\n+\t\t}\n+\t}\n+\n+\t@Test\n+\tpublic void testAdd() {\n+\t\ttry {\n+\t\t\tQueryBindingSet bs = new QueryBindingSet();\n+\t\t\tbs.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tbs.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tfail();\n+\t\t} catch (AssertionError e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef7862ac734a6ceadd1a31fb76e46ae4e3cdb9a"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgzNDAzNA==", "bodyText": "Rather than testing this through reflection, we could test this through public methods by adding a new binding to bs, after using it to initialize bs2, and then checking that bs2 does not also contain that new binding.", "url": "https://github.com/eclipse/rdf4j/pull/2725#discussion_r544834034", "createdAt": "2020-12-17T06:03:28Z", "author": {"login": "jeenbroekstra"}, "path": "core/queryalgebra/evaluation/src/test/java/org/eclipse/rdf4j/query/algebra/evaluation/QueryBindingSetTest.java", "diffHunk": "@@ -46,6 +54,136 @@ public void testEqualsMapBindingSet() {\n \t\tassertEquals(qbs, mbs);\n \t}\n \n+\t@Test\n+\tpublic void testAddAll() {\n+\t\t{\n+\t\t\tQueryBindingSet bs = new QueryBindingSet();\n+\t\t\tbs.addAll(new QueryBindingSet());\n+\t\t\tassertEquals(0, bs.size());\n+\t\t}\n+\t\t{\n+\t\t\tQueryBindingSet bs = new QueryBindingSet();\n+\t\t\tbs.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tbs.addAll(new QueryBindingSet());\n+\t\t\tassertEquals(1, bs.size());\n+\t\t}\n+\t\t{\n+\t\t\tQueryBindingSet bs = new QueryBindingSet();\n+\t\t\tbs.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tfinal QueryBindingSet bs2 = new QueryBindingSet();\n+\t\t\tbs2.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tbs.addAll(bs2);\n+\t\t\tassertEquals(1, bs.size());\n+\t\t}\n+\t\t{\n+\t\t\tQueryBindingSet bs = new QueryBindingSet();\n+\t\t\tbs.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tfinal QueryBindingSet bs2 = new QueryBindingSet();\n+\t\t\tbs2.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tbs2.addBinding(\"bar\", vf.createIRI(\"urn:bar\"));\n+\t\t\tbs.addAll(bs2);\n+\t\t\tassertEquals(2, bs.size());\n+\t\t}\n+\t}\n+\n+\t@Test\n+\tpublic void testAdd() {\n+\t\ttry {\n+\t\t\tQueryBindingSet bs = new QueryBindingSet();\n+\t\t\tbs.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tbs.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\t\tfail();\n+\t\t} catch (AssertionError e) {\n+\t\t\treturn;\n+\t\t}\n+\t}\n+\n+\t@Test\n+\tpublic void testNonSharedBackingMap()\n+\t\t\tthrows NoSuchFieldException, SecurityException, IllegalArgumentException, IllegalAccessException {\n+\t\tQueryBindingSet bs = new QueryBindingSet();\n+\t\tbs.addBinding(\"foo\", vf.createIRI(\"urn:foo\"));\n+\t\tbs.addBinding(\"bar\", vf.createIRI(\"urn:bar\"));\n+\t\tQueryBindingSet bs2 = new QueryBindingSet(bs);\n+\t\tfinal Field declaredField = QueryBindingSet.class.getDeclaredField(\"bindings\");\n+\t\tdeclaredField.setAccessible(true);\n+\t\tassertTrue(declaredField.get(bs) != declaredField.get(bs2));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ef7862ac734a6ceadd1a31fb76e46ae4e3cdb9a"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fc1b00d3e9ceea5e17d27bfdb9f2a1eaac7c9fa", "author": {"user": {"login": "JervenBolleman", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/3fc1b00d3e9ceea5e17d27bfdb9f2a1eaac7c9fa", "committedDate": "2020-12-18T22:36:37Z", "message": "GH-2724 QueryBindingSets constructed from others may not share their backing store. Also comment the reason for the addBinding test.\n\nSigned-off-by: Jerven bolleman <jerven.bolleman@sib.swiss>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36c23c6b63ef71c4dd2b0075a16232703840b791", "author": {"user": {"login": "JervenBolleman", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/36c23c6b63ef71c4dd2b0075a16232703840b791", "committedDate": "2020-12-18T19:46:01Z", "message": "GH-2724 QueryBindingSets constructed from others may not share their backing store. Also comment the reason for the addBinding test.\n\nSigned-off-by: Jerven bolleman <jerven.bolleman@sib.swiss>"}, "afterCommit": {"oid": "3fc1b00d3e9ceea5e17d27bfdb9f2a1eaac7c9fa", "author": {"user": {"login": "JervenBolleman", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/3fc1b00d3e9ceea5e17d27bfdb9f2a1eaac7c9fa", "committedDate": "2020-12-18T22:36:37Z", "message": "GH-2724 QueryBindingSets constructed from others may not share their backing store. Also comment the reason for the addBinding test.\n\nSigned-off-by: Jerven bolleman <jerven.bolleman@sib.swiss>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NjY0OTcw", "url": "https://github.com/eclipse/rdf4j/pull/2725#pullrequestreview-557664970", "createdAt": "2020-12-23T06:25:16Z", "commit": {"oid": "3fc1b00d3e9ceea5e17d27bfdb9f2a1eaac7c9fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 87, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}