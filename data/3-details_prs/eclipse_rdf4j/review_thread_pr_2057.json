{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MjA1Mzg4", "number": 2057, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMjoyMDo0OVrODtuh8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNzoxODoxM1rODuPGDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5Mjc0ODY0OnYy", "diffSide": "RIGHT", "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMjoyMDo0OVrOF_Ut8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMjoyMDo0OVrOF_Ut8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk0NDA0OQ==", "bodyText": "Ah. Using a HashMap to be able to match and retrieve the original statement, instead of the newly created copy. Clever.", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r401944049", "createdAt": "2020-04-01T22:20:49Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/DynamicModel.java", "diffHunk": "@@ -281,12 +296,32 @@ public void clear() {\n \t\t}\n \t}\n \n+\t@Override\n+\tpublic Iterator<Statement> getStatements(Resource subject, IRI predicate, Value object, Resource... contexts) {\n+\t\tif (model == null && subject != null && predicate != null && object != null && contexts != null\n+\t\t\t\t&& contexts.length == 1) {\n+\t\t\tStatement statement = SimpleValueFactory.getInstance()\n+\t\t\t\t\t.createStatement(subject, predicate, object, contexts[0]);\n+\t\t\tStatement foundStatement = statements.get(statement);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "210498fd2b54903e8a8fa274e0346ccac748ddf0"}, "originalPosition": 155}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5Mjc1NDE1OnYy", "diffSide": "RIGHT", "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/DistinctModelReducingUnionIteration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMjoyMjo1N1rOF_UxYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwMzozNDozNlrOF_aKSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk0NDkzMQ==", "bodyText": "Can we keep the old constructor signature as a (deprecated) overload? Just to keep things backward compatible.", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r401944931", "createdAt": "2020-04-01T22:22:57Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/DistinctModelReducingUnionIteration.java", "diffHunk": "@@ -34,15 +34,15 @@\n public class DistinctModelReducingUnionIteration extends LookAheadIteration<Statement, SailException> {\n \n \tDistinctModelReducingUnionIteration(CloseableIteration<? extends Statement, SailException> iterator, Model model,\n-\t\t\tFunction<Model, Model> filterable) {\n+\t\t\tFunction<Model, Iterator<Statement>> filterable) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "210498fd2b54903e8a8fa274e0346ccac748ddf0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjAzMzIyNA==", "bodyText": "Actually never mind, I overlooked that this constructor is package-private anyway.", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r402033224", "createdAt": "2020-04-02T03:34:36Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/DistinctModelReducingUnionIteration.java", "diffHunk": "@@ -34,15 +34,15 @@\n public class DistinctModelReducingUnionIteration extends LookAheadIteration<Statement, SailException> {\n \n \tDistinctModelReducingUnionIteration(CloseableIteration<? extends Statement, SailException> iterator, Model model,\n-\t\t\tFunction<Model, Model> filterable) {\n+\t\t\tFunction<Model, Iterator<Statement>> filterable) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk0NDkzMQ=="}, "originalCommit": {"oid": "210498fd2b54903e8a8fa274e0346ccac748ddf0"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NjQyMjEwOnYy", "diffSide": "RIGHT", "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/SailDatasetImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODoyNzoxMlrOF_4GCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNTozMzo1M1rOGAFpFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyMzY1Nw==", "bodyText": "I don't think this change makes a difference for the results. The set of statements that are in iter but not in deprecated is the same unless the pattern used to filter deprecated is different from the pattern used by iter.\nThe difference is for performance. Now later on in the FilterIteration we can work directly with the hashmap without having to upgrade to a full LinkedHashModel because of a complicated filter operation.", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r402523657", "createdAt": "2020-04-02T18:27:12Z", "author": {"login": "hmottestad"}, "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/SailDatasetImpl.java", "diffHunk": "@@ -267,15 +267,16 @@ public void handleClose() throws SailException {\n \t\t}\n \t\tModel deprecated = changes.getDeprecated();\n \t\tif (deprecated != null && iter != null) {\n-\t\t\titer = difference(iter, deprecated.filter(subj, pred, obj, contexts));\n+\t\t\titer = difference(iter, deprecated);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20212298d8ab6b0c469d234885f92285872dbaf2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc0NTYyMQ==", "bodyText": "The test suite appears to agree with you!", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r402745621", "createdAt": "2020-04-03T05:33:53Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/base/src/main/java/org/eclipse/rdf4j/sail/base/SailDatasetImpl.java", "diffHunk": "@@ -267,15 +267,16 @@ public void handleClose() throws SailException {\n \t\t}\n \t\tModel deprecated = changes.getDeprecated();\n \t\tif (deprecated != null && iter != null) {\n-\t\t\titer = difference(iter, deprecated.filter(subj, pred, obj, contexts));\n+\t\t\titer = difference(iter, deprecated);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyMzY1Nw=="}, "originalCommit": {"oid": "20212298d8ab6b0c469d234885f92285872dbaf2"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5ODA4Mzk2OnYy", "diffSide": "RIGHT", "path": "core/model/src/main/java/org/eclipse/rdf4j/model/Model.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNzoxODoxM1rOGAH02g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwODowMjoyOFrOGAJb1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc4MTQwMg==", "bodyText": "@jeenbroekstra I'm proposing we move from iterator to iterable because iterable supports for-each loops and is also simpler to convert into a stream.", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r402781402", "createdAt": "2020-04-03T07:18:13Z", "author": {"login": "hmottestad"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/Model.java", "diffHunk": "@@ -191,14 +191,14 @@ public default boolean remove(Resource subj, URI pred, Value obj, Resource... co\n \t *                  matching any one of these will match. To match statements without an associated context, specify\n \t *                  the value {@code null} and explicitly cast it to type {@code Resource}.\n \t * @return an {@link Iterator} over the statements in this Model that match the specified pattern.\n-\t * \n+\t *\n \t * @since 3.2.0\n-\t * \n+\t *\n \t * @see #filter(Resource, IRI, Value, Resource...)\n \t */\n-\tpublic default Iterator<Statement> getStatements(Resource subject, IRI predicate, Value object,\n+\tpublic default Iterable<Statement> getStatements(Resource subject, IRI predicate, Value object,\n \t\t\tResource... contexts) {\n-\t\treturn filter(subject, predicate, object, contexts).iterator();\n+\t\treturn () -> filter(subject, predicate, object, contexts).iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "221d8b9448b6d721cdd4c51421860e3b4e59b805"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5NTI4Ng==", "bodyText": "It's a pity that Java didn't introduce a combo interface with both iterable and stream. We can always create our own interface in the future though which extends both and still remain backwards compatible.", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r402795286", "createdAt": "2020-04-03T07:46:02Z", "author": {"login": "hmottestad"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/Model.java", "diffHunk": "@@ -191,14 +191,14 @@ public default boolean remove(Resource subj, URI pred, Value obj, Resource... co\n \t *                  matching any one of these will match. To match statements without an associated context, specify\n \t *                  the value {@code null} and explicitly cast it to type {@code Resource}.\n \t * @return an {@link Iterator} over the statements in this Model that match the specified pattern.\n-\t * \n+\t *\n \t * @since 3.2.0\n-\t * \n+\t *\n \t * @see #filter(Resource, IRI, Value, Resource...)\n \t */\n-\tpublic default Iterator<Statement> getStatements(Resource subject, IRI predicate, Value object,\n+\tpublic default Iterable<Statement> getStatements(Resource subject, IRI predicate, Value object,\n \t\t\tResource... contexts) {\n-\t\treturn filter(subject, predicate, object, contexts).iterator();\n+\t\treturn () -> filter(subject, predicate, object, contexts).iterator();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc4MTQwMg=="}, "originalCommit": {"oid": "221d8b9448b6d721cdd4c51421860e3b4e59b805"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgwNzc2Nw==", "bodyText": "@jeenbroekstra I'm proposing we move from iterator to iterable because iterable supports for-each loops and is also simpler to convert into a stream.\n\nI'm fine with that, but can you make sure you update the original issue's (#2030) description, and also the javadoc in Model?", "url": "https://github.com/eclipse/rdf4j/pull/2057#discussion_r402807767", "createdAt": "2020-04-03T08:02:28Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/Model.java", "diffHunk": "@@ -191,14 +191,14 @@ public default boolean remove(Resource subj, URI pred, Value obj, Resource... co\n \t *                  matching any one of these will match. To match statements without an associated context, specify\n \t *                  the value {@code null} and explicitly cast it to type {@code Resource}.\n \t * @return an {@link Iterator} over the statements in this Model that match the specified pattern.\n-\t * \n+\t *\n \t * @since 3.2.0\n-\t * \n+\t *\n \t * @see #filter(Resource, IRI, Value, Resource...)\n \t */\n-\tpublic default Iterator<Statement> getStatements(Resource subject, IRI predicate, Value object,\n+\tpublic default Iterable<Statement> getStatements(Resource subject, IRI predicate, Value object,\n \t\t\tResource... contexts) {\n-\t\treturn filter(subject, predicate, object, contexts).iterator();\n+\t\treturn () -> filter(subject, predicate, object, contexts).iterator();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc4MTQwMg=="}, "originalCommit": {"oid": "221d8b9448b6d721cdd4c51421860e3b4e59b805"}, "originalPosition": 103}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1558, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}