{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNjQ0MDYw", "number": 2020, "title": "GH-1574 better target node support", "bodyText": "GitHub issue resolved: #1574 \nBriefly describe the changes proposed in this PR:\n\nvalidates all sh:targetNodes, regardless of if the targets exist or not\nfixes som logging issues", "createdAt": "2020-03-18T20:18:30Z", "url": "https://github.com/eclipse/rdf4j/pull/2020", "merged": true, "mergeCommit": {"oid": "b4ee8b3781cb108e301ef0a473b5dbd54447a421"}, "closed": true, "closedAt": "2020-03-20T10:29:16Z", "author": {"login": "hmottestad"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcO93FiAFqTM3NzIzNDYwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPd6YvAH2gAyMzkwNjQ0MDYwOjU2YjMwMmM1ZGQ5MTg0M2JiMmY0YmQ3MmQ4MzJjMjk5OGY0ZjZiZDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MjM0NjA3", "url": "https://github.com/eclipse/rdf4j/pull/2020#pullrequestreview-377234607", "createdAt": "2020-03-18T21:05:24Z", "commit": {"oid": "066988b122873d8455de00aa4e47f2403f6d2333"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMTowNToyNFrOF4W3bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMTowNToyNFrOF4W3bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYzOTIxMg==", "bodyText": "Create a test that exemplifies this.", "url": "https://github.com/eclipse/rdf4j/pull/2020#discussion_r394639212", "createdAt": "2020-03-18T21:05:24Z", "author": {"login": "hmottestad"}, "path": "core/sail/shacl/src/main/java/org/eclipse/rdf4j/sail/shacl/AST/ShaclProperties.java", "diffHunk": "@@ -48,7 +50,7 @@\n \tString flags = \"\";\n \n \tSet<Resource> targetClass = new HashSet<>(0);\n-\tSet<Value> targetNode = new HashSet<>(0);\n+\tTreeSet<Value> targetNode = new TreeSet<>(new ValueComparator());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "066988b122873d8455de00aa4e47f2403f6d2333"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ecfb4342f26cb65953134d72a29e25a5ecd9e6d", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/4ecfb4342f26cb65953134d72a29e25a5ecd9e6d", "committedDate": "2020-03-19T09:34:06Z", "message": "#1574 fixed failing W3C tests and created test to force use of TreeSet\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}, "afterCommit": {"oid": "2750f53ca64ba97c3b53a7eb848f129926cebdd5", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/2750f53ca64ba97c3b53a7eb848f129926cebdd5", "committedDate": "2020-03-19T10:01:15Z", "message": "#1574 fixed failing W3C tests and created test to force use of TreeSet\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebe9d6e7afb1b086172521030028d30cbddac08f", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/ebe9d6e7afb1b086172521030028d30cbddac08f", "committedDate": "2020-03-19T10:06:06Z", "message": "GH-1574 validate all target nodes for every transaction\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2663ff3ed5c15b61f5ccbdf49d8ec8d528d6ec2c", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/2663ff3ed5c15b61f5ccbdf49d8ec8d528d6ec2c", "committedDate": "2020-03-19T10:06:07Z", "message": "GH-1574 fixed some failing tests and added some edge case tests\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d1b7d98cfd413abb8cd84d48c0fc36319ecc7b4", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/1d1b7d98cfd413abb8cd84d48c0fc36319ecc7b4", "committedDate": "2020-03-19T10:06:07Z", "message": "log the property shape and the identifier of the shape when GlobalValidationExecutionLogging is enabled as well as a fix where the wrong identity hash is used when printing plans\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0168b23d1ce54a515336628deb92e9582a561094", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/0168b23d1ce54a515336628deb92e9582a561094", "committedDate": "2020-03-19T10:06:07Z", "message": "GH-1574 fixed failing W3C tests and created test to force use of TreeSet\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2750f53ca64ba97c3b53a7eb848f129926cebdd5", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/2750f53ca64ba97c3b53a7eb848f129926cebdd5", "committedDate": "2020-03-19T10:01:15Z", "message": "#1574 fixed failing W3C tests and created test to force use of TreeSet\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}, "afterCommit": {"oid": "0168b23d1ce54a515336628deb92e9582a561094", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/0168b23d1ce54a515336628deb92e9582a561094", "committedDate": "2020-03-19T10:06:07Z", "message": "GH-1574 fixed failing W3C tests and created test to force use of TreeSet\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MjA2MzQw", "url": "https://github.com/eclipse/rdf4j/pull/2020#pullrequestreview-378206340", "createdAt": "2020-03-20T02:34:52Z", "commit": {"oid": "0168b23d1ce54a515336628deb92e9582a561094"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwMjozNDo1M1rOF5GPjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwMjo1MDowOFrOF5Gakg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxNTQzNw==", "bodyText": "That looks like the wrong year for a new file", "url": "https://github.com/eclipse/rdf4j/pull/2020#discussion_r395415437", "createdAt": "2020-03-20T02:34:53Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/shacl/src/main/java/org/eclipse/rdf4j/sail/shacl/planNodes/ValuesBackedNode.java", "diffHunk": "@@ -0,0 +1,118 @@\n+/*******************************************************************************\n+ * Copyright (c) 2018 Eclipse RDF4J contributors.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0168b23d1ce54a515336628deb92e9582a561094"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxNTUyNA==", "bodyText": "wrong year.", "url": "https://github.com/eclipse/rdf4j/pull/2020#discussion_r395415524", "createdAt": "2020-03-20T02:35:22Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/shacl/src/test/java/org/eclipse/rdf4j/sail/shacl/OrderingTest.java", "diffHunk": "@@ -0,0 +1,185 @@\n+/*******************************************************************************\n+ * Copyright (c) 2018 Eclipse RDF4J contributors.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0168b23d1ce54a515336628deb92e9582a561094"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxNjQxMQ==", "bodyText": "Why are you wrapping this in an Arraylist?", "url": "https://github.com/eclipse/rdf4j/pull/2020#discussion_r395416411", "createdAt": "2020-03-20T02:39:55Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/shacl/src/main/java/org/eclipse/rdf4j/sail/shacl/planNodes/GroupByCount.java", "diffHunk": "@@ -74,7 +75,8 @@ private void calculateNext() {\n \n \t\t\t\t}\n \n-\t\t\t\tList<Value> line = Arrays.asList(subject, SimpleValueFactory.getInstance().createLiteral(count));\n+\t\t\t\tList<Value> line = new ArrayList<>(\n+\t\t\t\t\t\tArrays.asList(subject, SimpleValueFactory.getInstance().createLiteral(count)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0168b23d1ce54a515336628deb92e9582a561094"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxNjU0OQ==", "bodyText": "Same here - why is this needed? It looks redundant.", "url": "https://github.com/eclipse/rdf4j/pull/2020#discussion_r395416549", "createdAt": "2020-03-20T02:40:46Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/shacl/src/main/java/org/eclipse/rdf4j/sail/shacl/planNodes/Tuple.java", "diffHunk": "@@ -39,7 +39,7 @@ public Tuple(List<Value> list) {\n \t}\n \n \tpublic Tuple(Value... list) {\n-\t\tline = Arrays.asList(list);\n+\t\tline = new ArrayList<>(Arrays.asList(list));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0168b23d1ce54a515336628deb92e9582a561094"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQxODI1OA==", "bodyText": "While these tests (after reading back and forth a bit) seem sensible, I'm a bit lost on what this has to do with issue GH-1574. Did the fix you added change ordering behavior somehow?", "url": "https://github.com/eclipse/rdf4j/pull/2020#discussion_r395418258", "createdAt": "2020-03-20T02:50:08Z", "author": {"login": "jeenbroekstra"}, "path": "core/sail/shacl/src/test/java/org/eclipse/rdf4j/sail/shacl/OrderingTest.java", "diffHunk": "@@ -0,0 +1,185 @@\n+/*******************************************************************************\n+ * Copyright (c) 2018 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.sail.shacl;\n+\n+import org.eclipse.rdf4j.IsolationLevels;\n+import org.eclipse.rdf4j.model.IRI;\n+import org.eclipse.rdf4j.model.Value;\n+import org.eclipse.rdf4j.model.ValueFactory;\n+import org.eclipse.rdf4j.model.impl.SimpleValueFactory;\n+import org.eclipse.rdf4j.model.vocabulary.FOAF;\n+import org.eclipse.rdf4j.model.vocabulary.RDF;\n+import org.eclipse.rdf4j.model.vocabulary.RDFS;\n+import org.eclipse.rdf4j.model.vocabulary.SHACL;\n+import org.eclipse.rdf4j.repository.sail.SailRepository;\n+import org.eclipse.rdf4j.repository.sail.SailRepositoryConnection;\n+import org.eclipse.rdf4j.sail.SailConnection;\n+import org.eclipse.rdf4j.sail.memory.MemoryStore;\n+import org.eclipse.rdf4j.sail.shacl.AST.ShaclProperties;\n+import org.eclipse.rdf4j.sail.shacl.mock.MockConsumePlanNode;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.InnerJoin;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.PlanNode;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.Select;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.Sort;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.TrimTuple;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.Tuple;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.UnBufferedPlanNode;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.ValuesBackedNode;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.TreeSet;\n+import java.util.stream.Collectors;\n+\n+import static junit.framework.TestCase.assertEquals;\n+import static junit.framework.TestCase.assertTrue;\n+\n+/**\n+ * @author H\u00e5vard Ottestad\n+ */\n+public class OrderingTest {\n+\n+\tprivate final static ValueFactory vf = SimpleValueFactory.getInstance();\n+\n+\t@Test\n+\tpublic void testSelect() {\n+\t\tMemoryStore repository = new MemoryStore();\n+\t\trepository.init();\n+\n+\t\ttry (SailConnection connection = repository.getConnection()) {\n+\t\t\tconnection.begin(IsolationLevels.NONE);\n+\t\t\tconnection.addStatement(RDFS.RESOURCE, RDF.TYPE, RDFS.RESOURCE);\n+\t\t\tconnection.addStatement(RDFS.CLASS, RDF.TYPE, RDFS.RESOURCE);\n+\t\t\tconnection.addStatement(RDFS.SUBCLASSOF, RDF.TYPE, RDFS.RESOURCE);\n+\t\t\tconnection.commit();\n+\n+\t\t\tSelect select = new Select(connection, \"?a <\" + RDF.TYPE + \"> []\", \"*\");\n+\t\t\tList<Tuple> tuples = new MockConsumePlanNode(select).asList();\n+\n+\t\t\tString actual = Arrays.toString(tuples.toArray());\n+\n+\t\t\tCollections.sort(tuples);\n+\n+\t\t\tString expected = Arrays.toString(tuples.toArray());\n+\n+\t\t\tassertEquals(expected, actual);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0168b23d1ce54a515336628deb92e9582a561094"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56b302c5dd91843bb2f4bd72d832c2998f4f6bd8", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/56b302c5dd91843bb2f4bd72d832c2998f4f6bd8", "committedDate": "2020-03-20T10:25:58Z", "message": "GH-1574 added comments to help next developer\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}