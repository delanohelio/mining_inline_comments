{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwMzMxNDc5", "number": 2486, "title": "GH-2485 fix failing test in RDFCollections", "bodyText": "GitHub issue resolved: #2485 \nBriefly describe the changes proposed in this PR:\n\nmake sure test for cycle detection uses a collection that is well-formed (apart from the cycle obviously)\n\n\nPR Author Checklist (see the contributor guidelines for more details):\n\n my pull request is self-contained\n I've added tests for the changes I made\n I've applied code formatting (you can use mvn process-resources to format from the command line)\n every commit message starts with the issue number (GH-xxxx) followed by a meaningful description of the change\n every commit has been signed off\n\nNote: we merge all feature pull requests using squash and merge. See RDF4J git merge strategy for more details.", "createdAt": "2020-09-05T00:54:31Z", "url": "https://github.com/eclipse/rdf4j/pull/2486", "merged": true, "mergeCommit": {"oid": "acc65533afda7d01297ac2af91b278ff000196ef"}, "closed": true, "closedAt": "2020-09-08T00:50:15Z", "author": {"login": "jeenbroekstra"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFvApVAH2gAyNDgwMzMxNDc5OmEzN2YzYjEzMjRhM2I0ZTJlNDA1NjYwMDZiMWEyNGJjNGUwZmQ3ZTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGrn7vgH2gAyNDgwMzMxNDc5OjA5NDEzMDI1MDM5MjVlMDM1NGU4ODkwOWYxYWYxZjQxMGZhNzk4OTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a37f3b1324a3b4e2e40566006b1a24bc4e0fd7e6", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/a37f3b1324a3b4e2e40566006b1a24bc4e0fd7e6", "committedDate": "2020-09-05T00:53:06Z", "message": "GH-2485 downgrade guava testlib"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d90bde21d9d8d4e4c004294e73af29a12c4b940a", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/d90bde21d9d8d4e4c004294e73af29a12c4b940a", "committedDate": "2020-09-05T01:02:34Z", "message": "GH-2485 fully downgrade guava"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab11590b6e8150c06349e0887e4928bec90dacb5", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/ab11590b6e8150c06349e0887e4928bec90dacb5", "committedDate": "2020-09-05T01:15:41Z", "message": "Revert \"GH-2485 fully downgrade guava\"\n\nThis reverts commit d90bde21d9d8d4e4c004294e73af29a12c4b940a."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29fb2a14b6c80259ab26bfcfcddf40f610e81529", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/29fb2a14b6c80259ab26bfcfcddf40f610e81529", "committedDate": "2020-09-05T01:15:56Z", "message": "Revert \"GH-2485 downgrade guava testlib\"\n\nThis reverts commit a37f3b1324a3b4e2e40566006b1a24bc4e0fd7e6."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcc28851f6821e21c51376e3329ef468e6b1cc40", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/dcc28851f6821e21c51376e3329ef468e6b1cc40", "committedDate": "2020-09-05T01:37:53Z", "message": "GH-2485 split out test cases for non-wellformed collections"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e60210e212e3c83f5a434cbe0286e85c177f84d", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/2e60210e212e3c83f5a434cbe0286e85c177f84d", "committedDate": "2020-09-05T04:09:11Z", "message": "GH-2485 run 1,000 times to be sure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2e031b968b08a5acb0b3065c94f7684b448fbc7", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/d2e031b968b08a5acb0b3065c94f7684b448fbc7", "committedDate": "2020-09-05T04:10:29Z", "message": "Revert \"GH-2485 run 1,000 times to be sure\"\n\nThis reverts commit 2e60210e212e3c83f5a434cbe0286e85c177f84d."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31b60d3707cbe75cb413b16d2476e2aafdbc97a5", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/31b60d3707cbe75cb413b16d2476e2aafdbc97a5", "committedDate": "2020-09-06T10:02:03Z", "message": "GH-2485 this should reproduce the issue\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8c624faf00bed7f10abeed6321ab08026e15634", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/c8c624faf00bed7f10abeed6321ab08026e15634", "committedDate": "2020-09-07T00:14:40Z", "message": "GH-2485 replace existing rdf:rest relation instead of just adding\n\n- test for cycle detection should make sure collection is otherwise wellformed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMzk2ODk0", "url": "https://github.com/eclipse/rdf4j/pull/2486#pullrequestreview-483396894", "createdAt": "2020-09-07T09:21:49Z", "commit": {"oid": "c8c624faf00bed7f10abeed6321ab08026e15634"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwOToyMTo0OVrOHN3spQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwOToyMTo0OVrOHN3spQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMwNjA4NQ==", "bodyText": "Could you add the comment: // supply incorrect head node\nMakes the test easier to read.", "url": "https://github.com/eclipse/rdf4j/pull/2486#discussion_r484306085", "createdAt": "2020-09-07T09:21:49Z", "author": {"login": "hmottestad"}, "path": "core/model/src/test/java/org/eclipse/rdf4j/model/util/RDFCollectionsTest.java", "diffHunk": "@@ -71,35 +70,33 @@ public void testConversionRoundtrip() {\n \n \t}\n \n-\t@Test\n-\tpublic void testNonWellformedCollection() {\n+\t@Test(expected = ModelException.class)\n+\tpublic void testNonWellformedCollection_MissingTerminator() {\n \t\tResource head = vf.createBNode();\n \t\tModel m = RDFCollections.asRDF(values, head, new TreeModel());\n \t\tm.remove(null, RDF.REST, RDF.NIL);\n-\t\ttry {\n-\t\t\tRDFCollections.asValues(m, head, new ArrayList<>());\n-\t\t\tfail(\"collection missing terminator should result in error\");\n-\t\t} catch (ModelException e) {\n-\t\t\t// fall through, expected\n-\t\t}\n-\n-\t\tm = RDFCollections.asRDF(values, head, new TreeModel());\n+\t\tRDFCollections.asValues(m, head, new ArrayList<>());\n+\t}\n+\n+\t@Test(expected = ModelException.class)\n+\tpublic void testNonWellformedCollection_Cycle() {\n+\t\tResource head = vf.createBNode(\"z\");\n+\t\tModel m = RDFCollections.asRDF(values, head, new TreeModel());\n+\n+\t\t// Replace rdf:rest relation for head node with one pointing to itself.\n+\t\t// This introduces a cycle in an otherwise well-formed collection.\n+\t\tm.remove(head, RDF.REST, null);\n \t\tm.add(head, RDF.REST, head);\n \n-\t\ttry {\n-\t\t\tRDFCollections.asValues(m, head, new ArrayList<>());\n-\t\t\tfail(\"collection with cycle should result in error\");\n-\t\t} catch (ModelException e) {\n-\t\t\t// fall through, expected\n-\t\t}\n-\n-\t\t// supply incorrect head node\n-\t\ttry {\n-\t\t\tRDFCollections.asValues(m, vf.createBNode(), new ArrayList<>());\n-\t\t\tfail(\"resource that is not a collection should result in error\");\n-\t\t} catch (ModelException e) {\n-\t\t\t// fall through, expected\n-\t\t}\n+\t\tRDFCollections.asValues(m, head, new ArrayList<>());\n+\t}\n+\n+\t@Test(expected = ModelException.class)\n+\tpublic void testNonWellformedCollection_IncorrectHeadNode() {\n+\t\tResource head = vf.createBNode();\n+\t\tModel m = RDFCollections.asRDF(values, head, new TreeModel());\n+\n+\t\tRDFCollections.asValues(m, vf.createBNode(), new ArrayList<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8c624faf00bed7f10abeed6321ab08026e15634"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMzk3MzMy", "url": "https://github.com/eclipse/rdf4j/pull/2486#pullrequestreview-483397332", "createdAt": "2020-09-07T09:22:24Z", "commit": {"oid": "c8c624faf00bed7f10abeed6321ab08026e15634"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0941302503925e0354e88909f1af1f410fa79895", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/0941302503925e0354e88909f1af1f410fa79895", "committedDate": "2020-09-07T23:30:19Z", "message": "GH-2485 added comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 97, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}