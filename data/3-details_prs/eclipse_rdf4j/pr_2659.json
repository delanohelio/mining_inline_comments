{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwOTk3NjAz", "number": 2659, "title": "GH-2658 Literal/ValueFactory java.time support", "bodyText": "GitHub issue resolved: #2658\nBriefly describe the changes proposed in this PR:\n\nadd Literal.temporalAccessor/AmountValue() methods\nadd ValueFactory.createLiteral(TemporalAccessor/Amount) methods\nimplement new methods in AbstractLiteral and AbstractValueFactory\n\n\nPR Author Checklist (see the contributor guidelines for more details):\n\n my pull request is self-contained\n I've added tests for the changes I made\n I've applied code formatting (you can use mvn process-resources to format from the command line)\n I've squashed my commits down to one or a few meaningful commits\n every commit message starts with the issue number (GH-xxxx) followed by a meaningful description of the change\n every commit has been signed off", "createdAt": "2020-11-14T11:56:49Z", "url": "https://github.com/eclipse/rdf4j/pull/2659", "merged": true, "mergeCommit": {"oid": "a6b73531bd14ac9cc609dca5600901c1120f957d"}, "closed": true, "closedAt": "2020-11-27T23:30:50Z", "author": {"login": "knoan"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdceOMNABqjM5OTY1NTYxMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgeMzggFqTUzOTY3NTk0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "632d8f8347acfb7f587877aea1cfe67c7162e2d6", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/632d8f8347acfb7f587877aea1cfe67c7162e2d6", "committedDate": "2020-11-14T11:51:23Z", "message": "GH-2658 Add ValueFactory.createLiteral(TemporalAccessor) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}, "afterCommit": {"oid": "dbb88f26fe13fe5f2bf49dd591c7698d6b35c932", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/dbb88f26fe13fe5f2bf49dd591c7698d6b35c932", "committedDate": "2020-11-14T16:19:03Z", "message": "GH-2658 Implement AbstractValueFactory.createLiteral(TemporalAccessor) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "194f0994689a0f3ba6a4cf53c476e2c96b4f2c9e", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/194f0994689a0f3ba6a4cf53c476e2c96b4f2c9e", "committedDate": "2020-11-14T16:28:44Z", "message": "GH-2658 Inherit SimpleValueFactory.createLiteral(TemporalAccessor) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}, "afterCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/8297c5ad4935777671510e88f26b0249c603fcab", "committedDate": "2020-11-14T16:42:48Z", "message": "GH-2658 Inherit SimpleValueFactory.createLiteral(TemporalAccessor) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODQwNDIw", "url": "https://github.com/eclipse/rdf4j/pull/2659#pullrequestreview-530840420", "createdAt": "2020-11-15T22:08:41Z", "commit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMjowODo0MlrOHzjfiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzowMDo1OVrOHzj41g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyMDkzNw==", "bodyText": "It looks solid, but AbstractLiteral is getting a bit large with all of this temporal processing code on top of everything else. Should we separate this out into a new file with a package-private class for TemporalLiteral? Or do we consider this still managable?", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r523820937", "createdAt": "2020-11-15T22:08:42Z", "author": {"login": "jeenbroekstra"}, "path": "core/model-api/src/main/java/org/eclipse/rdf4j/model/base/AbstractLiteral.java", "diffHunk": "@@ -72,6 +87,149 @@\n \tprivate static final String NEGATIVE_INFINITY = \"-INF\";\n \tprivate static final String NAN = \"NaN\";\n \n+\tprivate static final DateTimeFormatter LOCAL_TIME_FORMATTER = new DateTimeFormatterBuilder()\n+\n+\t\t\t.appendValue(HOUR_OF_DAY, 2)\n+\t\t\t.appendLiteral(':')\n+\t\t\t.appendValue(MINUTE_OF_HOUR, 2)\n+\t\t\t.appendLiteral(':')\n+\t\t\t.appendValue(SECOND_OF_MINUTE, 2)\n+\n+\t\t\t.optionalStart()\n+\t\t\t.appendFraction(NANO_OF_SECOND, 0, 9, true)\n+\n+\t\t\t.toFormatter();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyNzQxNA==", "bodyText": "Can we not use nested/chained ternaries? YMMV, but I find them hard to read. Might be improved with linebreaks in different places, but I think an if-else is easier on the eye (if a little more verbose):\nTemporalAccessor value;\nif (label.startsWith(\"--\")) {\n    value = DASH_FORMATTER.parse(label);\n} else if (label.length() >= 8 && label.charAt(2) == ':' ) {\n   value = OFFSET_TIME_FORMATTER.parse(label);\n} else {\n  value = DATETIME_FORMATTER.parse(label);\n}\nor perhaps more clean:\nfinal TemporalAccessor value = getFormatter(label).parse();\n\n... \n\nprivate static DateFormatter getFormatter(String label) {\n    if(label.startsWith(\"--\")) {\n       return DASH_FORMATTER;\n   } \n   if (label.length() >= 8 && label.charAt(2) == \":\") {\n       return OFFSET_TIME_FORMATTER;     \n   }\n   return DATETIME_FORMATTER;\n}", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r523827414", "createdAt": "2020-11-15T23:00:59Z", "author": {"login": "jeenbroekstra"}, "path": "core/model-api/src/main/java/org/eclipse/rdf4j/model/base/AbstractLiteral.java", "diffHunk": "@@ -175,6 +333,25 @@ public BigDecimal decimalValue() {\n \t\treturn value(BigDecimal::new);\n \t}\n \n+\t@Override\n+\tpublic TemporalAccessor temporalValue() throws DateTimeException {\n+\t\treturn value(label -> {\n+\n+\t\t\tfinal TemporalAccessor value = label.startsWith(\"--\") ? DASH_FORMATTER.parse(label)\n+\t\t\t\t\t: label.length() >= 8 && label.charAt(2) == ':' ? OFFSET_TIME_FORMATTER.parse(label)\n+\t\t\t\t\t\t\t: DATETIME_FORMATTER.parse(label);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 202}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODQ1OTE3", "url": "https://github.com/eclipse/rdf4j/pull/2659#pullrequestreview-530845917", "createdAt": "2020-11-15T23:04:36Z", "commit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzowNDozN1rOHzj6iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzowNDozN1rOHzj6iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyNzg0OA==", "bodyText": "I actually need to look at this, see #2655. I will likely refactor SimpleValueFactory to directly inherit from the new AbstractValueFactory, copying all the old AbstractValueFactory code over and leaving it orphaned.", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r523827848", "createdAt": "2020-11-15T23:04:37Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/AbstractValueFactory.java", "diffHunk": "@@ -39,7 +39,7 @@\n  *             {@link org.eclipse.rdf4j.model.base.AbstractValueFactory}.\n  */\n @Deprecated\n-public abstract class AbstractValueFactory implements ValueFactory {\n+public abstract class AbstractValueFactory extends org.eclipse.rdf4j.model.base.AbstractValueFactory {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/8297c5ad4935777671510e88f26b0249c603fcab", "committedDate": "2020-11-14T16:42:48Z", "message": "GH-2658 Inherit SimpleValueFactory.createLiteral(TemporalAccessor) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}, "afterCommit": {"oid": "04bb1381e9218013db15bb4d6ac70cf7b7c4d783", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/04bb1381e9218013db15bb4d6ac70cf7b7c4d783", "committedDate": "2020-11-16T09:02:50Z", "message": "GH-2658 Inherit SimpleValueFactory.createLiteral(TemporalAccessor) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04bb1381e9218013db15bb4d6ac70cf7b7c4d783", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/04bb1381e9218013db15bb4d6ac70cf7b7c4d783", "committedDate": "2020-11-16T09:02:50Z", "message": "GH-2658 Inherit SimpleValueFactory.createLiteral(TemporalAccessor) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}, "afterCommit": {"oid": "a441e35b6533d707d79048d894be3d90eb848c12", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/a441e35b6533d707d79048d894be3d90eb848c12", "committedDate": "2020-11-16T15:57:58Z", "message": "GH-2658 Inherit SimpleValueFactory.createLiteral(TemporalAccessor) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a441e35b6533d707d79048d894be3d90eb848c12", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/a441e35b6533d707d79048d894be3d90eb848c12", "committedDate": "2020-11-16T15:57:58Z", "message": "GH-2658 Inherit SimpleValueFactory.createLiteral(TemporalAccessor) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}, "afterCommit": {"oid": "82be6557ab746e64e7480ec8e22f7ea88b65617a", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/82be6557ab746e64e7480ec8e22f7ea88b65617a", "committedDate": "2020-11-16T17:44:01Z", "message": "GH-2658 Inherit SimpleValueFactory.createLiteral(TemporalAccessor) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "20f55eb5363c5ff85baca8923ac4140cee122ffe", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/20f55eb5363c5ff85baca8923ac4140cee122ffe", "committedDate": "2020-11-16T17:58:55Z", "message": "GH-2658 Hide AbstractLiteral.value(Function<String, V> mapper) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}, "afterCommit": {"oid": "fea5344c564b21034ec99ca482ece2fd03e96ac1", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/fea5344c564b21034ec99ca482ece2fd03e96ac1", "committedDate": "2020-11-17T08:34:02Z", "message": "GH-2658 Hide AbstractLiteral.value(Function<String, V> mapper) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b332a40d8aa2f21f4e948be6ecc1d216ceb8d1a5", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/b332a40d8aa2f21f4e948be6ecc1d216ceb8d1a5", "committedDate": "2020-11-26T10:27:19Z", "message": "GH-2658 Define Literal/ValueFactory temporal methods\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb3351877162563319e88ee93fc27d9bd48ce417", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/eb3351877162563319e88ee93fc27d9bd48ce417", "committedDate": "2020-11-26T10:27:19Z", "message": "GH-2658 Implement AbstractLiteral/AbstractValueFactory temporal methods\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "accbaf6994ba2ea3f00cf4119c1246a0274b94b2", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/accbaf6994ba2ea3f00cf4119c1246a0274b94b2", "committedDate": "2020-11-26T10:27:19Z", "message": "GH-2658 Implement temporal methods in delegating ValueFactories\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1090dca65bb6e9f123f6d76dab54aff3bf986633", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/1090dca65bb6e9f123f6d76dab54aff3bf986633", "committedDate": "2020-11-26T10:27:19Z", "message": "GH-2658 Inherit SimpleValueFactory.createLiteral(TemporalAccessor) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6799fabb2c7b8da7614d092dc61166606ee292d", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/e6799fabb2c7b8da7614d092dc61166606ee292d", "committedDate": "2020-11-26T10:27:19Z", "message": "GH-2658 Hide AbstractLiteral.value(Function<String, V> mapper) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fea5344c564b21034ec99ca482ece2fd03e96ac1", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/fea5344c564b21034ec99ca482ece2fd03e96ac1", "committedDate": "2020-11-17T08:34:02Z", "message": "GH-2658 Hide AbstractLiteral.value(Function<String, V> mapper) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}, "afterCommit": {"oid": "e6799fabb2c7b8da7614d092dc61166606ee292d", "author": {"user": {"login": "knoan", "name": "AB"}}, "url": "https://github.com/eclipse/rdf4j/commit/e6799fabb2c7b8da7614d092dc61166606ee292d", "committedDate": "2020-11-26T10:27:19Z", "message": "GH-2658 Hide AbstractLiteral.value(Function<String, V> mapper) method\n\nSigned-off-by: Alessandro Bollini <22@metreeca.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5Njc1OTQ3", "url": "https://github.com/eclipse/rdf4j/pull/2659#pullrequestreview-539675947", "createdAt": "2020-11-27T02:33:57Z", "commit": {"oid": "e6799fabb2c7b8da7614d092dc61166606ee292d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 82, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}