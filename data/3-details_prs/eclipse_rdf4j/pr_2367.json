{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwOTYzNDE1", "number": 2367, "title": "GH-2362 pass TripleSource through to function evaluation", "bodyText": "GitHub issue resolved: #2362  \nBriefly describe the changes proposed in this PR:\nAllow access to database during function evaluation.\n\nPR Author Checklist (see the contributor guidelines for more details):\n\n my pull request is self-contained\n I've added tests for the changes I made\n I've applied code formatting (you can use mvn process-resources to format from the command line)\n every commit message starts with the issue number (GH-xxxx) followed by a meaningful description of the change\n every commit has been signed off\n\nNote: we merge all feature pull requests using squash and merge. See RDF4J git merge strategy for more details.", "createdAt": "2020-07-17T09:33:49Z", "url": "https://github.com/eclipse/rdf4j/pull/2367", "merged": true, "mergeCommit": {"oid": "e5980d44be0a675b0053f6121ee653fe21b27d37"}, "closed": true, "closedAt": "2020-07-21T06:22:00Z", "author": {"login": "jeenbroekstra"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1wUwbgH2gAyNDUwOTYzNDE1OjQxODQ4MWE1Y2QyNmVmOGM3N2QyZDU3NzQxYzEzNTI2NDIwN2FmNjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2_ODtAH2gAyNDUwOTYzNDE1OmE3MGRiOTc5MWI5NGI5Yjg0YzhhODVlZGM2MzkyMDJhYzA3YzE0Mjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "418481a5cd26ef8c77d2d57741c135264207af69", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/418481a5cd26ef8c77d2d57741c135264207af69", "committedDate": "2020-07-17T09:22:11Z", "message": "GH-2362 pass TripleSource through to function evaluation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cdb3992fe1d60db19ab99aa715c756b793a4784", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/9cdb3992fe1d60db19ab99aa715c756b793a4784", "committedDate": "2020-07-18T01:25:50Z", "message": "GH-2362 javadoc editorial"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMDI0Mjcz", "url": "https://github.com/eclipse/rdf4j/pull/2367#pullrequestreview-451024273", "createdAt": "2020-07-18T02:31:28Z", "commit": {"oid": "f388f377afb0f71d2d234e00cacd986fb34194ef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwMjozMToyOFrOGzlFHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwMjozMToyOFrOGzlFHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjczODA3OQ==", "bodyText": "We should probably note in #2115 that this default might be removed in 4.0.", "url": "https://github.com/eclipse/rdf4j/pull/2367#discussion_r456738079", "createdAt": "2020-07-18T02:31:28Z", "author": {"login": "jeenbroekstra"}, "path": "core/queryalgebra/evaluation/src/main/java/org/eclipse/rdf4j/query/algebra/evaluation/function/Function.java", "diffHunk": "@@ -9,14 +9,45 @@\n \n import org.eclipse.rdf4j.model.Value;\n import org.eclipse.rdf4j.model.ValueFactory;\n+import org.eclipse.rdf4j.query.algebra.evaluation.TripleSource;\n import org.eclipse.rdf4j.query.algebra.evaluation.ValueExprEvaluationException;\n \n /**\n+ * A query function, which can be a built-in function in the query language, or a custom function as documented in the\n+ * <a href=\"https://www.w3.org/TR/sparql11-query/\">SPARQL 1.1 Query Language Recommendation</a>.\n+ *\n  * @author Arjohn Kampman\n+ * @author Jeen Broekstra\n+ * @see FunctionRegistry\n  */\n public interface Function {\n \n-\tpublic String getURI();\n+\tString getURI();\n \n-\tpublic Value evaluate(ValueFactory valueFactory, Value... args) throws ValueExprEvaluationException;\n+\t/**\n+\t * Evaluate the function over the supplied input arguments, using the supplied {@link ValueFactory} to produce the\n+\t * result.\n+\t *\n+\t * @param valueFactory a {@link ValueFactory} to use for producing the function result.\n+\t * @param args         the function input arguments.\n+\t * @return the function result value.\n+\t * @throws ValueExprEvaluationException\n+\t * @deprecated since 3.3.0. Use {@link #evaluate(TripleSource, Value...)} instead.\n+\t */\n+\t@Deprecated\n+\tValue evaluate(ValueFactory valueFactory, Value... args) throws ValueExprEvaluationException;\n+\n+\t/**\n+\t * Evaluate the function over the supplied input arguments.\n+\t *\n+\t * @param tripleSource the {@link TripleSource} used in the query evaluation. This can be used to access the current\n+\t *                     state of the store.\n+\t * @param args         the function input arguments.\n+\t * @return the function result value.\n+\t * @throws ValueExprEvaluationException\n+\t * @since 3.3.0\n+\t */\n+\tdefault Value evaluate(TripleSource tripleSource, Value... args) throws ValueExprEvaluationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f388f377afb0f71d2d234e00cacd986fb34194ef"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f388f377afb0f71d2d234e00cacd986fb34194ef", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/f388f377afb0f71d2d234e00cacd986fb34194ef", "committedDate": "2020-07-18T02:23:28Z", "message": "GH-2362 integration test for function evaluation using TripleSource"}, "afterCommit": {"oid": "53471e58956c6aa2cb07fa54f412602ac2d95bc7", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/53471e58956c6aa2cb07fa54f412602ac2d95bc7", "committedDate": "2020-07-18T02:33:41Z", "message": "GH-2362 integration test for function evaluation using TripleSource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a597ca5af6b7f438c90534f111da65544d4ef00", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/8a597ca5af6b7f438c90534f111da65544d4ef00", "committedDate": "2020-07-18T02:36:38Z", "message": "GH-2362 integration test for function evaluation using TripleSource"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53471e58956c6aa2cb07fa54f412602ac2d95bc7", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/53471e58956c6aa2cb07fa54f412602ac2d95bc7", "committedDate": "2020-07-18T02:33:41Z", "message": "GH-2362 integration test for function evaluation using TripleSource"}, "afterCommit": {"oid": "8a597ca5af6b7f438c90534f111da65544d4ef00", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/8a597ca5af6b7f438c90534f111da65544d4ef00", "committedDate": "2020-07-18T02:36:38Z", "message": "GH-2362 integration test for function evaluation using TripleSource"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzUxNTI0", "url": "https://github.com/eclipse/rdf4j/pull/2367#pullrequestreview-451351524", "createdAt": "2020-07-20T07:17:40Z", "commit": {"oid": "8a597ca5af6b7f438c90534f111da65544d4ef00"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzUyNDg5", "url": "https://github.com/eclipse/rdf4j/pull/2367#pullrequestreview-451352489", "createdAt": "2020-07-20T07:19:12Z", "commit": {"oid": "8a597ca5af6b7f438c90534f111da65544d4ef00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxOToxM1rOGz8nmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxOToxM1rOGz8nmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyMzczOA==", "bodyText": "Could you add to the deprecation warning that the value factory can be retrieved from the triple source?", "url": "https://github.com/eclipse/rdf4j/pull/2367#discussion_r457123738", "createdAt": "2020-07-20T07:19:13Z", "author": {"login": "hmottestad"}, "path": "core/queryalgebra/evaluation/src/main/java/org/eclipse/rdf4j/query/algebra/evaluation/function/Function.java", "diffHunk": "@@ -9,14 +9,45 @@\n \n import org.eclipse.rdf4j.model.Value;\n import org.eclipse.rdf4j.model.ValueFactory;\n+import org.eclipse.rdf4j.query.algebra.evaluation.TripleSource;\n import org.eclipse.rdf4j.query.algebra.evaluation.ValueExprEvaluationException;\n \n /**\n+ * A query function, which can be a built-in function in the query language, or a custom function as documented in the\n+ * <a href=\"https://www.w3.org/TR/sparql11-query/\">SPARQL 1.1 Query Language Recommendation</a>.\n+ *\n  * @author Arjohn Kampman\n+ * @author Jeen Broekstra\n+ * @see FunctionRegistry\n  */\n public interface Function {\n \n-\tpublic String getURI();\n+\tString getURI();\n \n-\tpublic Value evaluate(ValueFactory valueFactory, Value... args) throws ValueExprEvaluationException;\n+\t/**\n+\t * Evaluate the function over the supplied input arguments, using the supplied {@link ValueFactory} to produce the\n+\t * result.\n+\t *\n+\t * @param valueFactory a {@link ValueFactory} to use for producing the function result.\n+\t * @param args         the function input arguments.\n+\t * @return the function result value.\n+\t * @throws ValueExprEvaluationException\n+\t * @deprecated since 3.3.0. Use {@link #evaluate(TripleSource, Value...)} instead.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a597ca5af6b7f438c90534f111da65544d4ef00"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a70db9791b94b9b84c8a85edc639202ac07c1428", "author": {"user": {"login": "jeenbroekstra", "name": "Jeen Broekstra"}}, "url": "https://github.com/eclipse/rdf4j/commit/a70db9791b94b9b84c8a85edc639202ac07c1428", "committedDate": "2020-07-21T05:17:22Z", "message": "GH-2362 minor addition to javadoc deprecation notice"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 131, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}