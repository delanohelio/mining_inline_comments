{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMDQ5ODAx", "number": 2159, "title": "Gh 2151 nativestore datastore benchmarks", "bodyText": "GitHub issue resolved: #2151 \nBriefly describe the changes proposed in this PR:\nSome benchmarks for the lower level file operations in NativeStore and a couple of tweaks to control caching and syncing better as well as support for specifying the initial size of the HashFile.\n\nPR Author Checklist:\n\n my pull request is self-contained\n I've added tests for the changes I made\n every commit message starts with the issue number (GH-xxxx) followed by a meaningful description of the change\n every commit has been signed off\n\nNote: we merge all feature pull requests using squash and merge. See RDF4J git merge strategy for more details.", "createdAt": "2020-05-01T08:52:48Z", "url": "https://github.com/eclipse/rdf4j/pull/2159", "merged": true, "mergeCommit": {"oid": "6d3e1f0baa35d3930b734aa5dfea495f4749cbf4"}, "closed": true, "closedAt": "2020-05-04T07:10:22Z", "author": {"login": "hmottestad"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcc_SW9AH2gAyNDEyMDQ5ODAxOjlhYzdkMTRlOTg4YjhmNjhiOTlkNTY1ZmIyMDUwMjk0ODUyNzYzMTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcd6CrHAFqTQwNDc0NzM0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9ac7d14e988b8f68b99d565fb205029485276311", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/9ac7d14e988b8f68b99d565fb205029485276311", "committedDate": "2020-05-01T10:40:02Z", "message": "GH-2151 benchmarks and some required adjustments for robust benchmakrs\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e524e791906f69be007e0492df05b4d5b1a56cd", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/2e524e791906f69be007e0492df05b4d5b1a56cd", "committedDate": "2020-05-01T10:40:02Z", "message": "more benchmarks and cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be5897535574d273b9b35972b1bb2334f59f0375", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/be5897535574d273b9b35972b1bb2334f59f0375", "committedDate": "2020-05-01T08:30:13Z", "message": "more benchmarks and cleanup"}, "afterCommit": {"oid": "2e524e791906f69be007e0492df05b4d5b1a56cd", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/2e524e791906f69be007e0492df05b4d5b1a56cd", "committedDate": "2020-05-01T10:40:02Z", "message": "more benchmarks and cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4", "author": {"user": {"login": "hmottestad", "name": null}}, "url": "https://github.com/eclipse/rdf4j/commit/549467b570b79d429aafcfa7241f954763ae7cf4", "committedDate": "2020-05-02T08:15:32Z", "message": "GH-2151 TPS benchmarks are more useful when they don't create a new native store for every measurement\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzMxMzEy", "url": "https://github.com/eclipse/rdf4j/pull/2159#pullrequestreview-404731312", "createdAt": "2020-05-04T06:27:43Z", "commit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyNzo0M1rOGPz7Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyNzo0M1rOGPz7Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIzMjU0Nw==", "bodyText": "new public method", "url": "https://github.com/eclipse/rdf4j/pull/2159#discussion_r419232547", "createdAt": "2020-05-04T06:27:43Z", "author": {"login": "hmottestad"}, "path": "core/sail/nativerdf/src/main/java/org/eclipse/rdf4j/sail/nativerdf/datastore/DataFile.java", "diffHunk": "@@ -191,6 +191,10 @@ public void sync() throws IOException {\n \t\t}\n \t}\n \n+\tpublic void sync(boolean force) throws IOException {\n+\t\tnioFile.force(force);\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzMxNDMx", "url": "https://github.com/eclipse/rdf4j/pull/2159#pullrequestreview-404731431", "createdAt": "2020-05-04T06:28:04Z", "commit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyODowNFrOGPz7hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyODowNFrOGPz7hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIzMjY0Ng==", "bodyText": "new public constructor", "url": "https://github.com/eclipse/rdf4j/pull/2159#discussion_r419232646", "createdAt": "2020-05-04T06:28:04Z", "author": {"login": "hmottestad"}, "path": "core/sail/nativerdf/src/main/java/org/eclipse/rdf4j/sail/nativerdf/datastore/HashFile.java", "diffHunk": "@@ -91,6 +89,10 @@ public HashFile(File file) throws IOException {\n \t}\n \n \tpublic HashFile(File file, boolean forceSync) throws IOException {\n+\t\tthis(file, forceSync, 512); // 512 is default initial size\n+\t}\n+\n+\tpublic HashFile(File file, boolean forceSync, int initialSize) throws IOException {\n \t\tthis.nioFile = new NioFile(file);\n \t\tthis.forceSync = forceSync;\n \t\tloadFactor = 0.75f;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzMxNTA2", "url": "https://github.com/eclipse/rdf4j/pull/2159#pullrequestreview-404731506", "createdAt": "2020-05-04T06:28:15Z", "commit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyODoxNVrOGPz7xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyODoxNVrOGPz7xQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIzMjcwOQ==", "bodyText": "new public method", "url": "https://github.com/eclipse/rdf4j/pull/2159#discussion_r419232709", "createdAt": "2020-05-04T06:28:15Z", "author": {"login": "hmottestad"}, "path": "core/sail/nativerdf/src/main/java/org/eclipse/rdf4j/sail/nativerdf/datastore/HashFile.java", "diffHunk": "@@ -255,6 +258,11 @@ public void sync() throws IOException {\n \t\t}\n \t}\n \n+\tpublic void sync(boolean force) throws IOException {\n+\t\tsync();\n+\t\tnioFile.force(force);\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzMxNTY4", "url": "https://github.com/eclipse/rdf4j/pull/2159#pullrequestreview-404731568", "createdAt": "2020-05-04T06:28:24Z", "commit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyODoyNVrOGPz8CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyODoyNVrOGPz8CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIzMjc3Ng==", "bodyText": "new public method", "url": "https://github.com/eclipse/rdf4j/pull/2159#discussion_r419232776", "createdAt": "2020-05-04T06:28:25Z", "author": {"login": "hmottestad"}, "path": "core/sail/nativerdf/src/main/java/org/eclipse/rdf4j/sail/nativerdf/datastore/IDFile.java", "diffHunk": "@@ -249,6 +249,10 @@ public void sync() throws IOException {\n \t\t}\n \t}\n \n+\tpublic void sync(boolean force) throws IOException {\n+\t\tnioFile.force(false);\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzMxNjAz", "url": "https://github.com/eclipse/rdf4j/pull/2159#pullrequestreview-404731603", "createdAt": "2020-05-04T06:28:32Z", "commit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyODozMlrOGPz8KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyODozMlrOGPz8KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIzMjgwOQ==", "bodyText": "new public method", "url": "https://github.com/eclipse/rdf4j/pull/2159#discussion_r419232809", "createdAt": "2020-05-04T06:28:32Z", "author": {"login": "hmottestad"}, "path": "core/sail/nativerdf/src/main/java/org/eclipse/rdf4j/sail/nativerdf/datastore/IDFile.java", "diffHunk": "@@ -284,4 +288,11 @@ public void close() throws IOException {\n \t\t}\n \t\treturn cacheLine;\n \t}\n+\n+\tsynchronized public void clearCache() {\n+\t\tcache.clear();\n+\t\tgcReducingCacheIndex = -1;\n+\t\tgcReducingCache = null;\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzMxOTc3", "url": "https://github.com/eclipse/rdf4j/pull/2159#pullrequestreview-404731977", "createdAt": "2020-05-04T06:29:28Z", "commit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyOToyOFrOGPz9Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjoyOToyOFrOGPz9Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIzMzA5MA==", "bodyText": "to run benchmarks from eclipse", "url": "https://github.com/eclipse/rdf4j/pull/2159#discussion_r419233090", "createdAt": "2020-05-04T06:29:28Z", "author": {"login": "hmottestad"}, "path": "core/sail/nativerdf/src/test/java/org/eclipse/rdf4j/sail/nativerdf/benchmark/Main.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.sail.nativerdf.benchmark;\n+\n+import org.openjdk.jmh.runner.Runner;\n+import org.openjdk.jmh.runner.RunnerException;\n+import org.openjdk.jmh.runner.options.Options;\n+import org.openjdk.jmh.runner.options.OptionsBuilder;\n+\n+/**\n+ * @author H\u00e5vard Ottestad\n+ */\n+\n+public class Main {\n+\n+\tpublic static void main(String[] args) throws RunnerException {\n+\t\tOptions opt = new OptionsBuilder()\n+\t\t\t\t.include(\"\")\n+//\t\t\t\t.include(\"DataFileBenchmark.write$\")\n+//\t\t\t\t.forks(0)\n+\t\t\t\t.build();\n+\n+\t\tnew Runner(opt).run();\n+\t}\n+\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzQ3MzQ5", "url": "https://github.com/eclipse/rdf4j/pull/2159#pullrequestreview-404747349", "createdAt": "2020-05-04T07:07:18Z", "commit": {"oid": "549467b570b79d429aafcfa7241f954763ae7cf4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 146, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}