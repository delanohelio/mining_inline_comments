{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwOTk3NjAz", "number": 2659, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMjowODo0MlrOE5N1Zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzowNDozN1rOE5OLIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NDMwOTUxOnYy", "diffSide": "RIGHT", "path": "core/model-api/src/main/java/org/eclipse/rdf4j/model/base/AbstractLiteral.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMjowODo0MlrOHzjfiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwOToxMjoyMFrOHzundg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyMDkzNw==", "bodyText": "It looks solid, but AbstractLiteral is getting a bit large with all of this temporal processing code on top of everything else. Should we separate this out into a new file with a package-private class for TemporalLiteral? Or do we consider this still managable?", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r523820937", "createdAt": "2020-11-15T22:08:42Z", "author": {"login": "jeenbroekstra"}, "path": "core/model-api/src/main/java/org/eclipse/rdf4j/model/base/AbstractLiteral.java", "diffHunk": "@@ -72,6 +87,149 @@\n \tprivate static final String NEGATIVE_INFINITY = \"-INF\";\n \tprivate static final String NAN = \"NaN\";\n \n+\tprivate static final DateTimeFormatter LOCAL_TIME_FORMATTER = new DateTimeFormatterBuilder()\n+\n+\t\t\t.appendValue(HOUR_OF_DAY, 2)\n+\t\t\t.appendLiteral(':')\n+\t\t\t.appendValue(MINUTE_OF_HOUR, 2)\n+\t\t\t.appendLiteral(':')\n+\t\t\t.appendValue(SECOND_OF_MINUTE, 2)\n+\n+\t\t\t.optionalStart()\n+\t\t\t.appendFraction(NANO_OF_SECOND, 0, 9, true)\n+\n+\t\t\t.toFormatter();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDAwMzE5MA==", "bodyText": "I refactor to migrated all support fields and parsing code to the relevant specialised nested classes: now we are in the position to easily promote them to top level, if we opt to do so.\nFor the time being, however, I'd leave them inside AbstractLiteral, in order not to relax encapsulation and symmetry with other generic implementations in other Abstract* value classes.", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r524003190", "createdAt": "2020-11-16T09:12:20Z", "author": {"login": "knoan"}, "path": "core/model-api/src/main/java/org/eclipse/rdf4j/model/base/AbstractLiteral.java", "diffHunk": "@@ -72,6 +87,149 @@\n \tprivate static final String NEGATIVE_INFINITY = \"-INF\";\n \tprivate static final String NAN = \"NaN\";\n \n+\tprivate static final DateTimeFormatter LOCAL_TIME_FORMATTER = new DateTimeFormatterBuilder()\n+\n+\t\t\t.appendValue(HOUR_OF_DAY, 2)\n+\t\t\t.appendLiteral(':')\n+\t\t\t.appendValue(MINUTE_OF_HOUR, 2)\n+\t\t\t.appendLiteral(':')\n+\t\t\t.appendValue(SECOND_OF_MINUTE, 2)\n+\n+\t\t\t.optionalStart()\n+\t\t\t.appendFraction(NANO_OF_SECOND, 0, 9, true)\n+\n+\t\t\t.toFormatter();\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyMDkzNw=="}, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NDM2MTg3OnYy", "diffSide": "RIGHT", "path": "core/model-api/src/main/java/org/eclipse/rdf4j/model/base/AbstractLiteral.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzowMDo1OVrOHzj41g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMjo0NjoyMlrOH1OmRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyNzQxNA==", "bodyText": "Can we not use nested/chained ternaries? YMMV, but I find them hard to read. Might be improved with linebreaks in different places, but I think an if-else is easier on the eye (if a little more verbose):\nTemporalAccessor value;\nif (label.startsWith(\"--\")) {\n    value = DASH_FORMATTER.parse(label);\n} else if (label.length() >= 8 && label.charAt(2) == ':' ) {\n   value = OFFSET_TIME_FORMATTER.parse(label);\n} else {\n  value = DATETIME_FORMATTER.parse(label);\n}\nor perhaps more clean:\nfinal TemporalAccessor value = getFormatter(label).parse();\n\n... \n\nprivate static DateFormatter getFormatter(String label) {\n    if(label.startsWith(\"--\")) {\n       return DASH_FORMATTER;\n   } \n   if (label.length() >= 8 && label.charAt(2) == \":\") {\n       return OFFSET_TIME_FORMATTER;     \n   }\n   return DATETIME_FORMATTER;\n}", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r523827414", "createdAt": "2020-11-15T23:00:59Z", "author": {"login": "jeenbroekstra"}, "path": "core/model-api/src/main/java/org/eclipse/rdf4j/model/base/AbstractLiteral.java", "diffHunk": "@@ -175,6 +333,25 @@ public BigDecimal decimalValue() {\n \t\treturn value(BigDecimal::new);\n \t}\n \n+\t@Override\n+\tpublic TemporalAccessor temporalValue() throws DateTimeException {\n+\t\treturn value(label -> {\n+\n+\t\t\tfinal TemporalAccessor value = label.startsWith(\"--\") ? DASH_FORMATTER.parse(label)\n+\t\t\t\t\t: label.length() >= 8 && label.charAt(2) == ':' ? OFFSET_TIME_FORMATTER.parse(label)\n+\t\t\t\t\t\t\t: DATETIME_FORMATTER.parse(label);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 202}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDAwMzY0Ng==", "bodyText": "Done.", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r524003646", "createdAt": "2020-11-16T09:12:49Z", "author": {"login": "knoan"}, "path": "core/model-api/src/main/java/org/eclipse/rdf4j/model/base/AbstractLiteral.java", "diffHunk": "@@ -175,6 +333,25 @@ public BigDecimal decimalValue() {\n \t\treturn value(BigDecimal::new);\n \t}\n \n+\t@Override\n+\tpublic TemporalAccessor temporalValue() throws DateTimeException {\n+\t\treturn value(label -> {\n+\n+\t\t\tfinal TemporalAccessor value = label.startsWith(\"--\") ? DASH_FORMATTER.parse(label)\n+\t\t\t\t\t: label.length() >= 8 && label.charAt(2) == ':' ? OFFSET_TIME_FORMATTER.parse(label)\n+\t\t\t\t\t\t\t: DATETIME_FORMATTER.parse(label);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyNzQxNA=="}, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 202}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU3NTc1MQ==", "bodyText": "Great, thanks!", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r525575751", "createdAt": "2020-11-17T22:46:22Z", "author": {"login": "jeenbroekstra"}, "path": "core/model-api/src/main/java/org/eclipse/rdf4j/model/base/AbstractLiteral.java", "diffHunk": "@@ -175,6 +333,25 @@ public BigDecimal decimalValue() {\n \t\treturn value(BigDecimal::new);\n \t}\n \n+\t@Override\n+\tpublic TemporalAccessor temporalValue() throws DateTimeException {\n+\t\treturn value(label -> {\n+\n+\t\t\tfinal TemporalAccessor value = label.startsWith(\"--\") ? DASH_FORMATTER.parse(label)\n+\t\t\t\t\t: label.length() >= 8 && label.charAt(2) == ':' ? OFFSET_TIME_FORMATTER.parse(label)\n+\t\t\t\t\t\t\t: DATETIME_FORMATTER.parse(label);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyNzQxNA=="}, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 202}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NDM2NTEyOnYy", "diffSide": "RIGHT", "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/AbstractValueFactory.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzowNDozN1rOHzj6iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDo1NToxMFrOH04vGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyNzg0OA==", "bodyText": "I actually need to look at this, see #2655. I will likely refactor SimpleValueFactory to directly inherit from the new AbstractValueFactory, copying all the old AbstractValueFactory code over and leaving it orphaned.", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r523827848", "createdAt": "2020-11-15T23:04:37Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/AbstractValueFactory.java", "diffHunk": "@@ -39,7 +39,7 @@\n  *             {@link org.eclipse.rdf4j.model.base.AbstractValueFactory}.\n  */\n @Deprecated\n-public abstract class AbstractValueFactory implements ValueFactory {\n+public abstract class AbstractValueFactory extends org.eclipse.rdf4j.model.base.AbstractValueFactory {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk1MTgyMg==", "bodyText": "I actually need to look at this, see #2655. I will likely refactor SimpleValueFactory to directly inherit from the new AbstractValueFactory, copying all the old AbstractValueFactory code over and leaving it orphaned.\n\nAs long as SimpleValueFactory inherits from the new AbstractValueFactor tests won't break.", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r523951822", "createdAt": "2020-11-16T07:57:44Z", "author": {"login": "knoan"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/AbstractValueFactory.java", "diffHunk": "@@ -39,7 +39,7 @@\n  *             {@link org.eclipse.rdf4j.model.base.AbstractValueFactory}.\n  */\n @Deprecated\n-public abstract class AbstractValueFactory implements ValueFactory {\n+public abstract class AbstractValueFactory extends org.eclipse.rdf4j.model.base.AbstractValueFactory {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyNzg0OA=="}, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk0Njk0Mg==", "bodyText": "I've merged my update for #2655. It shouldn't break anything for you but might be worth rebasing, just to make sure.", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r524946942", "createdAt": "2020-11-17T07:58:29Z", "author": {"login": "jeenbroekstra"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/AbstractValueFactory.java", "diffHunk": "@@ -39,7 +39,7 @@\n  *             {@link org.eclipse.rdf4j.model.base.AbstractValueFactory}.\n  */\n @Deprecated\n-public abstract class AbstractValueFactory implements ValueFactory {\n+public abstract class AbstractValueFactory extends org.eclipse.rdf4j.model.base.AbstractValueFactory {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyNzg0OA=="}, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIxNzU2Mw==", "bodyText": "Rebased", "url": "https://github.com/eclipse/rdf4j/pull/2659#discussion_r525217563", "createdAt": "2020-11-17T14:55:10Z", "author": {"login": "knoan"}, "path": "core/model/src/main/java/org/eclipse/rdf4j/model/impl/AbstractValueFactory.java", "diffHunk": "@@ -39,7 +39,7 @@\n  *             {@link org.eclipse.rdf4j.model.base.AbstractValueFactory}.\n  */\n @Deprecated\n-public abstract class AbstractValueFactory implements ValueFactory {\n+public abstract class AbstractValueFactory extends org.eclipse.rdf4j.model.base.AbstractValueFactory {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgyNzg0OA=="}, "originalCommit": {"oid": "8297c5ad4935777671510e88f26b0249c603fcab"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1332, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}