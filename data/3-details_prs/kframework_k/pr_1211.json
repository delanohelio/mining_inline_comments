{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMDI3ODc3", "number": 1211, "title": "LLVM backend unparser changes in K frontend", "bodyText": "Mostly this consists of generating some flat text files that are used to avoid having to parse the entire K definition in order to do unparsing. we also add the integration test for the functionality to the K tutorial, and include some helper code that was used to generate ANSI terminal color codes to be fed into the llvm backend.\nSecond PR is here: kframework/llvm-backend#315", "createdAt": "2020-04-10T18:58:41Z", "url": "https://github.com/kframework/k/pull/1211", "merged": true, "mergeCommit": {"oid": "f52264634fcaaf0d5310d74f5032ad544913caa9"}, "closed": true, "closedAt": "2020-04-15T20:51:51Z", "author": {"login": "dwightguth"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWVy3hgH2gAyNDAyMDI3ODc3OmU2ZmNlMjUwODQ2NmQ4ODEwYTRlMjQ4YThlMzVkYzMxMTdmYTQxNTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX8T-qAH2gAyNDAyMDI3ODc3OjI2MmVjYTE3MDFmNGYzODBjYTIwYjc4M2VhMmI2Y2EyNDg0MTI3MzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e6fce2508466d8810a4e248a8e35dc3117fa4150", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/e6fce2508466d8810a4e248a8e35dc3117fa4150", "committedDate": "2020-04-10T18:55:59Z", "message": "change imp script to call llvm backend unparser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b28fb91f5f6da4569a0f936af090df4555c5d5f4", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/b28fb91f5f6da4569a0f936af090df4555c5d5f4", "committedDate": "2020-04-10T18:56:12Z", "message": "main method to assist with generating code for llvm backend unparser for\ncolors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8f5dee1d3a0c3649ff549ecf9a093d20e206e4a", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/f8f5dee1d3a0c3649ff549ecf9a093d20e206e4a", "committedDate": "2020-04-10T18:56:30Z", "message": "make Formatter.defaultFormat public"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24508d5d249daf69d01b6453c254696530868d56", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/24508d5d249daf69d01b6453c254696530868d56", "committedDate": "2020-04-10T18:56:50Z", "message": "emit formatting data in the format the backend expects"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ea5ff29459acd3ab7e65e5b30a167ffb65824a9", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/8ea5ff29459acd3ab7e65e5b30a167ffb65824a9", "committedDate": "2020-04-13T18:57:46Z", "message": "Merge branch 'master' into unparse3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aa426412cd276fadd5b06147f8b3f8320d7a015", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/0aa426412cd276fadd5b06147f8b3f8320d7a015", "committedDate": "2020-04-14T17:23:42Z", "message": "Merge branch 'master' into unparse3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95c880d19e537e93dabbd8ca67ec58a071e7971a", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/95c880d19e537e93dabbd8ca67ec58a071e7971a", "committedDate": "2020-04-14T17:24:45Z", "message": "add llvm tools to k debian package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f19475b5ffb55b0aba0ed788521b06526c529405", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/f19475b5ffb55b0aba0ed788521b06526c529405", "committedDate": "2020-04-14T18:10:02Z", "message": "fix path"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjAzMzAz", "url": "https://github.com/kframework/k/pull/1211#pullrequestreview-393603303", "createdAt": "2020-04-15T09:24:23Z", "commit": {"oid": "f19475b5ffb55b0aba0ed788521b06526c529405"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOToyNDoyNFrOGFxRBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOToyNDoyNFrOGFxRBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcwMzIzOA==", "bodyText": "This isn't really about symbol translation directly, and may confuse future developers about where the logic for symbol translation ends and writing the extra files begins. You could consider separating out the new functionality into a function writeSymbolUnparsingInformation (or something similar) and just call that method here, to make the distinction clearer.\nYour call.", "url": "https://github.com/kframework/k/pull/1211#discussion_r408703238", "createdAt": "2020-04-15T09:24:24Z", "author": {"login": "ehildenb"}, "path": "kernel/src/main/java/org/kframework/backend/kore/ModuleToKORE.java", "diffHunk": "@@ -350,7 +381,47 @@ private void translateSymbols(Map<String, Boolean> attributes, SetMultimap<KLabe\n             sb.append(\") : \");\n             convert(prod.sort(), prod, sb);\n             sb.append(\" \");\n-            convert(attributes, addKoreAttributes(prod, functionRules, impurities, overloads), sb, null, null);\n+            Att koreAtt = addKoreAttributes(prod, functionRules, impurities, overloads);\n+            convert(attributes, koreAtt, sb, null, null);\n+            if (koreAtt.contains(\"format\")) {\n+              formats.append(\"Lbl\");\n+              convert(prod.klabel().get().name(), formats);\n+              formats.append('\\n');\n+              formats.append(koreAtt.get(\"format\"));\n+              formats.append('\\n');\n+            }\n+            if (koreAtt.contains(\"color\")) {\n+              colors.append(\"Lbl\");\n+              convert(prod.klabel().get().name(), colors);\n+              colors.append('\\n');\n+              for (int i = 0; i < prod.items().size(); i++) {\n+                if (prod.items().apply(i) instanceof Terminal) {\n+                  colors.append(koreAtt.get(\"color\"));\n+                  colors.append('\\n');\n+                }\n+              }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f19475b5ffb55b0aba0ed788521b06526c529405"}, "originalPosition": 85}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjAzNDM2", "url": "https://github.com/kframework/k/pull/1211#pullrequestreview-393603436", "createdAt": "2020-04-15T09:24:34Z", "commit": {"oid": "f19475b5ffb55b0aba0ed788521b06526c529405"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOToyNDozNFrOGFxRbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOToyNDozNFrOGFxRbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcwMzM0Mg==", "bodyText": "Similarly here.", "url": "https://github.com/kframework/k/pull/1211#discussion_r408703342", "createdAt": "2020-04-15T09:24:34Z", "author": {"login": "ehildenb"}, "path": "kernel/src/main/java/org/kframework/backend/kore/ModuleToKORE.java", "diffHunk": "@@ -1357,6 +1428,23 @@ private Att addKoreAttributes(Production prod, SetMultimap<KLabel, Rule> functio\n         if (isMacro) {\n             att = att.add(\"macro\");\n         }\n+        String format = att.getOptional(\"format\").orElse(Formatter.defaultFormat(prod.items().size()));\n+        int nt = 1;\n+        boolean hasFormat = true;\n+        for (int i = 0; i < prod.items().size(); i++) {\n+          if (prod.items().apply(i) instanceof NonTerminal) {\n+            format = format.replace(\"%\" + (i+1), \"%\" + (nt++));\n+          } else if (prod.items().apply(i) instanceof Terminal) {\n+            format = format.replace(\"%\" + (i+1), \"%c\" + ((Terminal)prod.items().apply(i)).value() + \"%r\");\n+          } else {\n+            hasFormat = false;\n+          }\n+        }\n+        if (hasFormat) {\n+          att = att.add(\"format\", format);\n+        } else {\n+          att = att.remove(\"format\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f19475b5ffb55b0aba0ed788521b06526c529405"}, "originalPosition": 130}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjA0NjAz", "url": "https://github.com/kframework/k/pull/1211#pullrequestreview-393604603", "createdAt": "2020-04-15T09:26:06Z", "commit": {"oid": "f19475b5ffb55b0aba0ed788521b06526c529405"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15aa0be22c9c0c9b3ad95d2ede1d1e7ddbc952a3", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/15aa0be22c9c0c9b3ad95d2ede1d1e7ddbc952a3", "committedDate": "2020-04-15T13:55:13Z", "message": "factor out methods for updating unparsing data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a35044fae5ab00f808a9fde1d747861a3ac4e970", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/a35044fae5ab00f808a9fde1d747861a3ac4e970", "committedDate": "2020-04-15T14:45:34Z", "message": "fix bug in generation of colors text file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c7d5c7362498390f30db31f84508522a41add8b", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/7c7d5c7362498390f30db31f84508522a41add8b", "committedDate": "2020-04-15T14:45:48Z", "message": "make `colors` attribute consistent with kprint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de4ac568bec2dd842bf3485b3a9733c6d430fa64", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/de4ac568bec2dd842bf3485b3a9733c6d430fa64", "committedDate": "2020-04-15T14:46:07Z", "message": "add documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzODcxODQ1", "url": "https://github.com/kframework/k/pull/1211#pullrequestreview-393871845", "createdAt": "2020-04-15T15:11:34Z", "commit": {"oid": "de4ac568bec2dd842bf3485b3a9733c6d430fa64"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "262eca1701f4f380ca20b783ea2b6ca248412733", "author": {"user": {"login": "rv-jenkins", "name": null}}, "url": "https://github.com/kframework/k/commit/262eca1701f4f380ca20b783ea2b6ca248412733", "committedDate": "2020-04-15T18:22:28Z", "message": "Merge branch 'master' into unparse3"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2452, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}