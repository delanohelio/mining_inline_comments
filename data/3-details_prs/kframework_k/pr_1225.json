{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2OTc5NDA4", "number": 1225, "title": "Simplify handling #Ceil(_Map_)", "bodyText": "This pull request implements two related changes which simplify how #Ceil(_Map_) is handled:\n\nThe generated axioms for the MAP.in_keys hook are removed. These interact poorly with the #Ceil(_Map_) axioms; it's hard to apply them without looping. Because this requires some meta-logic, we will implement these hooks fully symbolically in the backend.\nSome redundant conditions are removed from the generated #Ceil(_Map_) axioms.", "createdAt": "2020-04-22T00:42:22Z", "url": "https://github.com/kframework/k/pull/1225", "merged": true, "mergeCommit": {"oid": "88aa24db091e870a7e06a15da92bbeb2f5068696"}, "closed": true, "closedAt": "2020-05-15T15:49:23Z", "author": {"login": "ttuegel"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ01wTAH2gAyNDA2OTc5NDA4OmE4NzYxMDJiMmU5MzcyZWY5NWU5M2I3OTNlZDcxZjJhZGZlZWYyYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchjIsCgH2gAyNDA2OTc5NDA4OmJiOTU4YTM4YTNhMTU4MDI3OTY2ZDMyMzYzYTNhN2NkMGUxNGRhNjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a876102b2e9372ef95e93b793ed71f2adfeef2a7", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/a876102b2e9372ef95e93b793ed71f2adfeef2a7", "committedDate": "2020-04-21T14:47:58Z", "message": "ModuleToKORE: Remove generated MAP.in_keys axioms\n\nEvaluating this function must be handled internally by the backend due to a bad\ninteraction with the generated \\ceil rules."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "557e1dd6ee6743bae9ce44a0ca4fc246628f1836", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/557e1dd6ee6743bae9ce44a0ca4fc246628f1836", "committedDate": "2020-04-21T15:21:24Z", "message": "ModuleToKORE: Simplify generated #Ceil axiom for MAP.concat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8ca65f5c6ff32c1a55c72c4555108e32fc4d0c5", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/f8ca65f5c6ff32c1a55c72c4555108e32fc4d0c5", "committedDate": "2020-04-21T15:21:24Z", "message": "ModuleToKORE: Use KLabels.ML_EQUALS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3ODYyNzY1", "url": "https://github.com/kframework/k/pull/1225#pullrequestreview-397862765", "createdAt": "2020-04-22T05:54:23Z", "commit": {"oid": "f8ca65f5c6ff32c1a55c72c4555108e32fc4d0c5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNTo1NDoyNFrOGJkmFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNTo1NDoyNFrOGJkmFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY4OTk0MQ==", "bodyText": "I agree with you that the in_keys condition would require the variables to be defined anyway.\nWhy then keep the definedness conditions?", "url": "https://github.com/kframework/k/pull/1225#discussion_r412689941", "createdAt": "2020-04-22T05:54:24Z", "author": {"login": "traiansf"}, "path": "kernel/src/main/java/org/kframework/backend/kore/ModuleToKORE.java", "diffHunk": "@@ -598,69 +598,33 @@ private void genMapCeilAxioms(Production prod, Collection<Rule> rules) {\n         Seq<NonTerminal> nonterminals = elementProd.nonterminals();\n         Sort sortParam = Sort(AddSortInjections.SORTPARAM_NAME, Sort(\"Q\"));\n \n-        List<K> args = new ArrayList<>();\n-        for (int i = 0; i< nonterminals.length(); i++) {\n-            Sort sort = nonterminals.apply(i).sort();\n-            args.add(KVariable(\"K\" + i, Att.empty().add(Sort.class, sort)));\n-        } // variable arguments for MapItem (K1 is the key)\n-        Seq<K> argsSeq = JavaConverters.iterableAsScalaIterable(args).toSeq();\n-        K restMap = KVariable(\"Rest\", Att.empty().add(Sort.class, mapSort));\n-\n-        // rule K1:KItem in_keys(MapItem(K1, K2, .., Kn) Rest:Map) => true\n-        Rule inKeysRule1 = Rule(\n-                KRewrite(\n-                        KApply(prod.klabel().get(),\n-                                args.get(0),\n-                                KApply(concatProd.klabel().get(),\n-                                        KApply(elementProd.klabel().get(),\n-                                                argsSeq,\n-                                                Att.empty()\n-                                        ),\n-                                        restMap\n-                                )\n-                        ),\n-                        BooleanUtils.TRUE\n-                ),\n-                BooleanUtils.TRUE,\n-                BooleanUtils.TRUE\n-        );\n-        rules.add(inKeysRule1);\n-\n-        // rule K1:KItem in_keys(Rest:Map) => false [owise]\n-        Rule inKeysRule2 = Rule(\n-                KRewrite(\n-                        KApply(prod.klabel().get(),\n-                                args.get(0),\n-                                restMap\n-                        ),\n-                        BooleanUtils.FALSE\n-                ),\n-                BooleanUtils.TRUE,\n-                BooleanUtils.TRUE,\n-                Att.empty().add(\"owise\")\n-        );\n-        rules.add(inKeysRule2);\n+        // rule\n+        //   #Ceil(MapItem(K1, K2, ..., Kn) Rest:Map)\n+        // =>\n+        //  {(@K1 in_keys(@Rest)) #Equals false} #And ... #And #Ceil(@Kn)\n+        // Note: The {_ in_Keys(_) #Equals false} condition implies\n+        // #Ceil(@K1) and #Ceil(@Rest).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8ca65f5c6ff32c1a55c72c4555108e32fc4d0c5"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32469ca1d26325f731023dca81ef0173b4a24f59", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/32469ca1d26325f731023dca81ef0173b4a24f59", "committedDate": "2020-04-22T14:28:01Z", "message": "ModuleToKORE: Clarify comment on definedness of MapItem arguments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb958a38a3a158027966d32363a3a7cd0e14da68", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/bb958a38a3a158027966d32363a3a7cd0e14da68", "committedDate": "2020-05-15T14:41:45Z", "message": "Merge branch 'master' into bug--Map-in_keys"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2462, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}