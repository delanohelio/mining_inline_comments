{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTI1OTEx", "number": 1252, "title": "Function encoding", "bodyText": "This is not ready to be merged yet, but it is ready to get initial feedback. I don't expect the tests will pass on the haskell or llvm backends, but I want to get reviews to make sure it looks like what we agreed on to people before I start working on getting it working in the llvm backend.\nSample input:\nsyntax Int ::= foo(Bar, Baz) [function]\n\nsyntax Bar ::= \"bar\" | \"bar2\"\nsyntax Baz ::= \"baz\"\n\nrule foo(bar, baz) => 0\n  requires 0 >Int 0\nrule foo(B:Bar, baz) => 1\nrule foo(...) => 2\n  requires 1 >Int 1 [owise]\n\nSample output:\n  axiom{R} \\implies{R} (\n    \\and{R}(\n      \\top{R}(),\n      \\and{R} (\n          \\in{SortBar{}, R} (\n            X0:SortBar{},\n            VarB:SortBar{}\n          ),\\and{R} (\n          \\in{SortBaz{}, R} (\n            X1:SortBaz{},\n            Lblbaz'Unds'TEST'Unds'Baz{}()\n          ),\n          \\top{R} ()\n        ))),\n    \\and{R} (\n      \\equals{SortInt{},R} (\n        Lblfoo'LParUndsCommUndsRParUnds'TEST'Unds'Int'Unds'Bar'Unds'Baz{}(X0:SortBar{},X1:SortBaz{}),\n        \\dv{SortInt{}}(\"1\")),\n      \\top{R}())) [...]\n\n  axiom{R} \\implies{R} (\n    \\and{R} (\n      \\not{R} (\n        \\or{R} (\n          \\exists{R} (Var'Unds'4:SortBar{},\n            \\and{R} (\n              \\top{R}(),\n              \\and{R} (\n                \\in{SortBar{}, R} (\n                  X0:SortBar{},\n                  Var'Unds'4:SortBar{}\n                ),\\and{R} (\n                \\in{SortBaz{}, R} (\n                  X1:SortBaz{},\n                  Lblbaz'Unds'TEST'Unds'Baz{}()\n                ),\n                \\top{R} ()\n              ))\n          )),\n          \\or{R} (\n            \\and{R} (\n              \\equals{SortBool{},R}(\n        Lbl'Unds-GT-'Int'Unds'{}(\\dv{SortInt{}}(\"0\"),\\dv{SortInt{}}(\"0\")),\n        \\dv{SortBool{}}(\"true\")),\n              \\and{R} (\n                \\in{SortBar{}, R} (\n                  X0:SortBar{},\n                  Lblbar'Unds'TEST'Unds'Bar{}()\n                ),\\and{R} (\n                \\in{SortBaz{}, R} (\n                  X1:SortBaz{},\n                  Lblbaz'Unds'TEST'Unds'Baz{}()\n                ),\n                \\top{R} ()\n              ))\n          ),\n          \\bottom{R}()\n        ))\n      ),\n      \\and{R}(\n        \\equals{SortBool{},R}(\n        Lbl'Unds-GT-'Int'Unds'{}(\\dv{SortInt{}}(\"1\"),\\dv{SortInt{}}(\"1\")),\n        \\dv{SortBool{}}(\"true\")),\n        \\and{R} (\n          \\in{SortBar{}, R} (\n            X0:SortBar{},\n            Var'Unds'0:SortBar{}\n          ),\\and{R} (\n          \\in{SortBaz{}, R} (\n            X1:SortBaz{},\n            Var'Unds'1:SortBaz{}\n          ),\n          \\top{R} ()\n        ))\n    )),\n    \\and{R} (\n      \\equals{SortInt{},R} (\n        Lblfoo'LParUndsCommUndsRParUnds'TEST'Unds'Int'Unds'Bar'Unds'Baz{}(X0:SortBar{},X1:SortBaz{}),\n        \\dv{SortInt{}}(\"2\")),\n      \\top{R}())) [...]\n\n  axiom{R} \\implies{R} (\n    \\and{R}(\n      \\equals{SortBool{},R}(\n        Lbl'Unds-GT-'Int'Unds'{}(\\dv{SortInt{}}(\"0\"),\\dv{SortInt{}}(\"0\")),\n        \\dv{SortBool{}}(\"true\")),\n      \\and{R} (\n          \\in{SortBar{}, R} (\n            X0:SortBar{},\n            Lblbar'Unds'TEST'Unds'Bar{}()\n          ),\\and{R} (\n          \\in{SortBaz{}, R} (\n            X1:SortBaz{},\n            Lblbaz'Unds'TEST'Unds'Baz{}()\n          ),\n          \\top{R} ()\n        ))),\n    \\and{R} (\n      \\equals{SortInt{},R} (\n        Lblfoo'LParUndsCommUndsRParUnds'TEST'Unds'Int'Unds'Bar'Unds'Baz{}(X0:SortBar{},X1:SortBaz{}),\n        \\dv{SortInt{}}(\"0\")),\n      \\top{R}())) [...]", "createdAt": "2020-05-04T18:57:38Z", "url": "https://github.com/kframework/k/pull/1252", "merged": true, "mergeCommit": {"oid": "6608e83f6406178d35ec0e7bb86deff1c270d6e2"}, "closed": true, "closedAt": "2020-09-04T22:21:59Z", "author": {"login": "dwightguth"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceEL1_AH2gAyNDEzMTI1OTExOjY1NmI1Nzk3ZDBmMTJkNDNjNDAxOGI3NGU1MTMzMDVmZDczZTkzMzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFrxjbAH2gAyNDEzMTI1OTExOjBhZTUyMzY4M2I0MDFhNDI0MzI0YTVlNzA3NDdjZGNlOTg1NzYzYWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "656b5797d0f12d43c4018b74e513305fd73e9333", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/656b5797d0f12d43c4018b74e513305fd73e9333", "committedDate": "2020-05-04T18:56:22Z", "message": "rename some references to old syntax"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf172bf76a03923452e35a5a79a3c543fe2d33e8", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/cf172bf76a03923452e35a5a79a3c543fe2d33e8", "committedDate": "2020-05-04T18:56:36Z", "message": "new encoding of functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12236f1100e85ae8c72685d93f51b07705708206", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/12236f1100e85ae8c72685d93f51b07705708206", "committedDate": "2020-05-04T18:57:05Z", "message": "don't add simplification automatically"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6779e493f69617cfab5dd2694bb53c0892445f39", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/6779e493f69617cfab5dd2694bb53c0892445f39", "committedDate": "2020-05-04T19:36:54Z", "message": "fix non owise rules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfe932e4e973ca7a84f8a202a21c5502836babb7", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/dfe932e4e973ca7a84f8a202a21c5502836babb7", "committedDate": "2020-05-05T18:50:24Z", "message": "disallow priority or owise + simplification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ba774be946035c89516a671c59ebdb12f03f8b4", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/5ba774be946035c89516a671c59ebdb12f03f8b4", "committedDate": "2020-05-05T18:55:02Z", "message": "restore old behavior for simplification rules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e46f70b2fe4812ebad726f06d7798b80eff8dab0", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/e46f70b2fe4812ebad726f06d7798b80eff8dab0", "committedDate": "2020-05-07T17:31:42Z", "message": "tmp: update submodule"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NzgwMDU2", "url": "https://github.com/kframework/k/pull/1252#pullrequestreview-429780056", "createdAt": "2020-06-12T14:18:51Z", "commit": {"oid": "e46f70b2fe4812ebad726f06d7798b80eff8dab0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNDoxODo1MlrOGjFv1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNDoxODo1MlrOGjFv1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ0NzUwOQ==", "bodyText": "We should allow priority on simplification rules. For example, this is needed for the arithmetic simplification lemmas.", "url": "https://github.com/kframework/k/pull/1252#discussion_r439447509", "createdAt": "2020-06-12T14:18:52Z", "author": {"login": "ana-pantilie"}, "path": "kernel/src/main/java/org/kframework/compile/checks/CheckAtt.java", "diffHunk": "@@ -0,0 +1,39 @@\n+// Copyright (c) 2016-2019 K Team. All Rights Reserved.\n+package org.kframework.compile.checks;\n+\n+import org.kframework.attributes.Att;\n+import org.kframework.attributes.HasLocation;\n+import org.kframework.definition.Module;\n+import org.kframework.definition.Rule;\n+import org.kframework.definition.Sentence;\n+import org.kframework.utils.errorsystem.KEMException;\n+\n+import java.util.Set;\n+\n+/**\n+ * Created by dwightguth on 1/25/16.\n+ */\n+public class CheckAtt {\n+    private final Set<KEMException> errors;\n+    private final Module m;\n+\n+    public CheckAtt(Set<KEMException> errors, Module m) {\n+        this.errors = errors;\n+        this.m = m;\n+    }\n+\n+    public void check(Sentence sentence) {\n+        if (sentence instanceof Rule) {\n+            check(((Rule) sentence).att(), sentence);\n+        }\n+    }\n+\n+    private void check(Att att, HasLocation loc) {\n+        if (att.contains(Att.OWISE()) && att.contains(Att.SIMPLIFICATION())) {\n+          errors.add(KEMException.compilerError(\"owise attribute is not supported on simplification rules.\", loc));\n+        }\n+        if (att.contains(Att.PRIORITY()) && att.contains(Att.SIMPLIFICATION())) {\n+          errors.add(KEMException.compilerError(\"priority attribute is not supported on simplification rules.\", loc));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e46f70b2fe4812ebad726f06d7798b80eff8dab0"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37bb9f94500e9b0a92fc303be02005eda3f35f99", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/37bb9f94500e9b0a92fc303be02005eda3f35f99", "committedDate": "2020-06-17T17:24:07Z", "message": "Merge branch 'master' into function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "607a89c105cea5e6843ca538f7094c0fde5ec2ad", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/607a89c105cea5e6843ca538f7094c0fde5ec2ad", "committedDate": "2020-06-17T17:28:27Z", "message": "update llvm backend submodule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aca3987a60f707314b7deb4b13327affe8ccc249", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/aca3987a60f707314b7deb4b13327affe8ccc249", "committedDate": "2020-07-29T19:08:25Z", "message": "domains.k: Do not combine priority and simplification attributes\n\nThe Haskell backend now supports a simplification attribute with optional\npriority argument."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d19c58d9958dd099fec889c782367375ec8351ec", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/d19c58d9958dd099fec889c782367375ec8351ec", "committedDate": "2020-07-29T19:33:46Z", "message": "Update haskell-backend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd35a8c7ba0608ce3355304a3f84f912d1630410", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/bd35a8c7ba0608ce3355304a3f84f912d1630410", "committedDate": "2020-08-11T20:32:49Z", "message": "Merge branch 'master' into function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfd1317167e3818dd3e13e4748232d55afed05a6", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/cfd1317167e3818dd3e13e4748232d55afed05a6", "committedDate": "2020-08-11T20:32:55Z", "message": "Update llvm-backend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08e436bb5de338695b424ea126b630ebb2d100fe", "author": {"user": {"login": "ana-pantilie", "name": null}}, "url": "https://github.com/kframework/k/commit/08e436bb5de338695b424ea126b630ebb2d100fe", "committedDate": "2020-08-27T07:11:55Z", "message": "Merge remote-tracking branch 'upstream/master' into function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faa2a64a8ef1d7b3d22867272ab1d05557ee78e1", "author": {"user": {"login": "ana-pantilie", "name": null}}, "url": "https://github.com/kframework/k/commit/faa2a64a8ef1d7b3d22867272ab1d05557ee78e1", "committedDate": "2020-08-27T08:28:19Z", "message": "rat.md: add simplification attribute for ceil rule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a833f75cebcb0c3df50ef91a8dfac4631f0d487", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/6a833f75cebcb0c3df50ef91a8dfac4631f0d487", "committedDate": "2020-08-27T16:40:10Z", "message": "llvm-backend: update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTgwNTY0", "url": "https://github.com/kframework/k/pull/1252#pullrequestreview-477180564", "createdAt": "2020-08-28T01:14:21Z", "commit": {"oid": "6a833f75cebcb0c3df50ef91a8dfac4631f0d487"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6df314be9ee03fdae0851cd38e101881c00f4f5f", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/6df314be9ee03fdae0851cd38e101881c00f4f5f", "committedDate": "2020-09-04T16:27:31Z", "message": "Merge branch 'master' into function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ae523683b401a424324a5e70747cdce985763aa", "author": {"user": {"login": "ttuegel", "name": "Thomas Tuegel"}}, "url": "https://github.com/kframework/k/commit/0ae523683b401a424324a5e70747cdce985763aa", "committedDate": "2020-09-04T21:06:54Z", "message": "Update LLVM backend"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2422, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}