{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NjA4Njgz", "number": 1310, "title": "Warn if non-anonymous variable appears only once.", "bodyText": "Fixes part of #1296.", "createdAt": "2020-05-28T16:46:25Z", "url": "https://github.com/kframework/k/pull/1310", "merged": true, "mergeCommit": {"oid": "135469ea0ebea96dacf0f9a49261ff1171440c20"}, "closed": true, "closedAt": "2020-06-10T21:21:53Z", "author": {"login": "dwightguth"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclypjLgBqjMzODQyMTU0NDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp_JFRgH2gAyNDI0NjA4NjgzOjQ5YjczZjg4MWY5MzY0ZjY3ZTYzNzIwNDA3MjgzNGZjMWRmZDYxZTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8885da82ecf2d91ee608ec9b2bf0129039b2c87b", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/8885da82ecf2d91ee608ec9b2bf0129039b2c87b", "committedDate": "2020-05-28T16:46:34Z", "message": "Merge branch 'master' into warn"}, "afterCommit": {"oid": "a6e4b83e2218fa6c7ac15e95f5a61ab8ba9e36a6", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/a6e4b83e2218fa6c7ac15e95f5a61ab8ba9e36a6", "committedDate": "2020-05-28T19:01:22Z", "message": "add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7833aecd8e9cc5649152ff8a617e85643422cffa", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/7833aecd8e9cc5649152ff8a617e85643422cffa", "committedDate": "2020-05-28T19:02:23Z", "message": "cleanup checks a bit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abc5a5cfef74a62644499d29e3759b5a9d78c7ce", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/abc5a5cfef74a62644499d29e3759b5a9d78c7ce", "committedDate": "2020-05-28T19:02:23Z", "message": "add check for unused variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ae36234519c78b44405f27a90185f932c0e9254", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/7ae36234519c78b44405f27a90185f932c0e9254", "committedDate": "2020-05-28T19:02:23Z", "message": "beef up test some more"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f0e210a7f2d08c047c40c1b81fa2958404b0f44", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/9f0e210a7f2d08c047c40c1b81fa2958404b0f44", "committedDate": "2020-05-28T19:02:23Z", "message": "fix crash in test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "780901dd84c19f56a1cdf02707c239f214423c76", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/780901dd84c19f56a1cdf02707c239f214423c76", "committedDate": "2020-05-28T19:02:23Z", "message": "fix warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebf3fae34bb8a7ebfda572a6f731a34bc30c038e", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/ebf3fae34bb8a7ebfda572a6f731a34bc30c038e", "committedDate": "2020-05-28T19:02:23Z", "message": "fix bug with contexts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d77e977dd2128827e9d238744320a467de7e1d63", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/d77e977dd2128827e9d238744320a467de7e1d63", "committedDate": "2020-05-28T19:02:23Z", "message": "handle fresh anonymous constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4572df4c20c8e6d5c1bc300f06063fba0714904c", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/4572df4c20c8e6d5c1bc300f06063fba0714904c", "committedDate": "2020-05-28T19:02:23Z", "message": "add test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a6e4b83e2218fa6c7ac15e95f5a61ab8ba9e36a6", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/a6e4b83e2218fa6c7ac15e95f5a61ab8ba9e36a6", "committedDate": "2020-05-28T19:01:22Z", "message": "add test"}, "afterCommit": {"oid": "4572df4c20c8e6d5c1bc300f06063fba0714904c", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/4572df4c20c8e6d5c1bc300f06063fba0714904c", "committedDate": "2020-05-28T19:02:23Z", "message": "add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba95c45a8d0ce3e646d35272ecae4170e05a455e", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/ba95c45a8d0ce3e646d35272ecae4170e05a455e", "committedDate": "2020-05-28T19:19:57Z", "message": "update test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10e5800f04ca93572a5c1af9a921e3bdc527c966", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/10e5800f04ca93572a5c1af9a921e3bdc527c966", "committedDate": "2020-05-28T19:19:57Z", "message": "update output file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2526e2af521480bde0f05d9eb50659164f94074", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/f2526e2af521480bde0f05d9eb50659164f94074", "committedDate": "2020-05-28T19:19:57Z", "message": "fix another false positive"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36d4daea0b6db09d99326a56992f7e625dd92062", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/36d4daea0b6db09d99326a56992f7e625dd92062", "committedDate": "2020-06-01T20:18:14Z", "message": "more warnings in prelude"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "640b82d6e3342f9a0d58dc7d3135bb4ea5479778", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/640b82d6e3342f9a0d58dc7d3135bb4ea5479778", "committedDate": "2020-06-01T20:30:21Z", "message": "update tests more"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85f9b67ad87ad5ebcb23315fc4e56bd674408e7a", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/85f9b67ad87ad5ebcb23315fc4e56bd674408e7a", "committedDate": "2020-06-01T22:16:51Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9591728d26277e5ece270bc471fca9480ad85677", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/9591728d26277e5ece270bc471fca9480ad85677", "committedDate": "2020-06-02T18:28:11Z", "message": "update test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "236b454b585855e26f21c1e6c42d8cebaac8d060", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/236b454b585855e26f21c1e6c42d8cebaac8d060", "committedDate": "2020-06-02T19:37:53Z", "message": "Merge branch 'master' into warn"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzgxNzQz", "url": "https://github.com/kframework/k/pull/1310#pullrequestreview-423781743", "createdAt": "2020-06-03T17:35:31Z", "commit": {"oid": "236b454b585855e26f21c1e6c42d8cebaac8d060"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzozNTozMlrOGemanA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzozNTozMlrOGemanA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDczOTg2OA==", "bodyText": "Please add some tests that also include requires clauses, and ensures clauses.\nSpecifically, add a test which defines the variable in the LHS, but only uses in the requires clause or ensures clause (and make sure no warning is output).\nAlso add one which has a trivial requires clause which does not use the variable.", "url": "https://github.com/kframework/k/pull/1310#discussion_r434739868", "createdAt": "2020-06-03T17:35:32Z", "author": {"login": "ehildenb"}, "path": "k-distribution/tests/regression-new/checkWarns/checkUnusedVar.k", "diffHunk": "@@ -0,0 +1,21 @@\n+module CHECKUNUSEDVAR-SYNTAX\n+\n+endmodule\n+\n+module MOD\n+  imports INT\n+  configuration <bar> 0 </bar>\n+endmodule\n+\n+module CHECKUNUSEDVAR\n+  imports INT\n+  imports MOD\n+\n+  syntax KItem ::= foo(Int)\n+\n+  rule foo(X) => 0\n+  rule foo(0) => !_:Int", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "236b454b585855e26f21c1e6c42d8cebaac8d060"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzgzMzQ5", "url": "https://github.com/kframework/k/pull/1310#pullrequestreview-423783349", "createdAt": "2020-06-03T17:37:36Z", "commit": {"oid": "236b454b585855e26f21c1e6c42d8cebaac8d060"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzozNzozNlrOGemfeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzozNzozNlrOGemfeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc0MTExMg==", "bodyText": "What is this change going on here? Is it related to the variable declaration issues?\nOr is it related to the new issue @hjorthjort posted #1318.", "url": "https://github.com/kframework/k/pull/1310#discussion_r434741112", "createdAt": "2020-06-03T17:37:36Z", "author": {"login": "ehildenb"}, "path": "kernel/src/main/java/org/kframework/compile/GenerateSentencesFromConfigDecl.java", "diffHunk": "@@ -202,11 +209,31 @@ public void apply(KToken k) {\n         }\n \n         @Override\n-        public void apply(KApply k) {\n-            if (k.klabel().name().equals(\"#externalCell\")) {\n-                hasConfigVar = true;\n+        public void apply(KApply kapp) {\n+            if (kapp.klabel().name().equals(\"#externalCell\")) {\n+                if (kapp.klist().size() == 1) {\n+                    K startLabel = kapp.klist().items().get(0);\n+                    if (startLabel instanceof KToken) {\n+                        KToken label = (KToken) startLabel;\n+                        if (label.sort().equals(Sort(\"#CellName\"))) {\n+                            String cellName = label.s();\n+                            Sort sort = Sort(getSortOfCell(cellName));\n+                            Option<Set<Production>> initializerProduction = m.productionsFor().get(KLabel(getInitLabel(sort)));\n+                            if (initializerProduction.isDefined()) {\n+                                Set<Production> realProds = stream(initializerProduction.get())\n+                                        .filter(p -> !p.att().contains(Att.RECORD_PRD(), Production.class))\n+                                        .collect(Collections.toSet());\n+                                if (realProds.size() == 1) { // should be only a single initializer\n+                                    if (realProds.head().items().size() == 4) {\n+                                      hasConfigVar = true;\n+                                    }\n+                                }\n+                            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "236b454b585855e26f21c1e6c42d8cebaac8d060"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23c25441872285f5b0dff39e341a7584e2661aa3", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/23c25441872285f5b0dff39e341a7584e2661aa3", "committedDate": "2020-06-09T17:34:58Z", "message": "add more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31dd67a027d744d8cad4dffe4c9a43a9377c007c", "author": {"user": {"login": "dwightguth", "name": "Dwight Guth"}}, "url": "https://github.com/kframework/k/commit/31dd67a027d744d8cad4dffe4c9a43a9377c007c", "committedDate": "2020-06-09T17:34:58Z", "message": "don't make warnings fatal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MjgxMTY3", "url": "https://github.com/kframework/k/pull/1310#pullrequestreview-428281167", "createdAt": "2020-06-10T17:32:57Z", "commit": {"oid": "31dd67a027d744d8cad4dffe4c9a43a9377c007c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d087209a4b338c3412f9e341626ed73e143adac", "author": {"user": {"login": "rv-jenkins", "name": null}}, "url": "https://github.com/kframework/k/commit/2d087209a4b338c3412f9e341626ed73e143adac", "committedDate": "2020-06-10T17:50:48Z", "message": "Merge branch 'master' into warn"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49b73f881f9364f67e637204072834fc1dfd61e9", "author": {"user": {"login": "rv-jenkins", "name": null}}, "url": "https://github.com/kframework/k/commit/49b73f881f9364f67e637204072834fc1dfd61e9", "committedDate": "2020-06-10T19:50:55Z", "message": "Merge branch 'master' into warn"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2383, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}