{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyMTYyMjkz", "number": 6779, "title": "Refactor file preferences", "bodyText": "This PR is going to refactor some parts of the code in relationship with the FilePreferences. It's going to be rather big again, since FilePreferences and other Preferences objects are not clearly distinguishable and this will take probably some time for me to contemplate how to resort them.\nWork in progress, but here for you to preview and to comment, if you have some good ideas.\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-08-23T18:44:45Z", "url": "https://github.com/JabRef/jabref/pull/6779", "merged": true, "mergeCommit": {"oid": "5ab494e8b1732f688d4ed8d696740bc7e8ef4101"}, "closed": true, "closedAt": "2020-09-01T12:20:11Z", "author": {"login": "calixtus"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdB1UKWgH2gAyNDcyMTYyMjkzOmU1ZWEzNTk4ODY4YTI1ODM3YWI0ODU2MjQ2ZmEyMzljMGE2M2M4YTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEmXcgAH2gAyNDcyMTYyMjkzOmNlMjBjMDY3NGI2ZjU5MjJhZjRmM2UwNmQ0YTdmNTI3ODFjZjgwNjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e5ea3598868a25837ab4856246fa239c0a63c8a3", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/e5ea3598868a25837ab4856246fa239c0a63c8a3", "committedDate": "2020-08-23T21:58:09Z", "message": "Refactored for same basic clean-up and naming consistency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fac9f9907cb6d1e0443cc211001e840e50e2c562", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/fac9f9907cb6d1e0443cc211001e840e50e2c562", "committedDate": "2020-08-23T21:58:09Z", "message": "Refactored for more clean-ups and naming consistency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fb6e7a3ae9d3cac58f8488ac6bdaaa72e3263a3", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/1fb6e7a3ae9d3cac58f8488ac6bdaaa72e3263a3", "committedDate": "2020-08-23T21:58:09Z", "message": "Refactored and extended AutoLinkPreferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4147133a8049a66141f2194623def131a70e03a0", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/4147133a8049a66141f2194623def131a70e03a0", "committedDate": "2020-08-23T21:58:09Z", "message": "Refactored FilePreferences to immutable class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d04a14a2130d886b35d4528fd5036799fceacd43", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/d04a14a2130d886b35d4528fd5036799fceacd43", "committedDate": "2020-08-23T06:47:06Z", "message": "Refactored FilePreferences to immutable class"}, "afterCommit": {"oid": "4147133a8049a66141f2194623def131a70e03a0", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/4147133a8049a66141f2194623def131a70e03a0", "committedDate": "2020-08-23T21:58:09Z", "message": "Refactored FilePreferences to immutable class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd159fdbba7720351bcf8519a5ca6c55dd52414c", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/fd159fdbba7720351bcf8519a5ca6c55dd52414c", "committedDate": "2020-08-24T11:09:22Z", "message": "Refactored two preferences from AutoLinkPreferences to FilePreferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c90d6216f2e064f71d3ffa9a8c48f679624396db", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/c90d6216f2e064f71d3ffa9a8c48f679624396db", "committedDate": "2020-08-24T11:42:46Z", "message": "Moved import linked file patterns preferences to FilePreferencesTab"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dd6ffc46a76635dce67e1265a5862389b739bce", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/1dd6ffc46a76635dce67e1265a5862389b739bce", "committedDate": "2020-08-24T17:10:43Z", "message": "Extended FilePreferences and refactored FileTab to use it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "416d8b7c016c99e2894b089cc43426a46b5dd861", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/416d8b7c016c99e2894b089cc43426a46b5dd861", "committedDate": "2020-08-24T18:11:50Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acd5eb95107fee1002633711c36de8b729a1d453", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/acd5eb95107fee1002633711c36de8b729a1d453", "committedDate": "2020-08-31T15:05:20Z", "message": "Merge remote-tracking branch 'upstream/master' into RefactorFilePreferences\n\n# Conflicts:\n#\tsrc/main/java/org/jabref/preferences/JabRefPreferences.java\n#\tsrc/main/java/org/jabref/preferences/PreferencesService.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edaed5ef008ab11aa029c3f76e26496f926d5512", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/edaed5ef008ab11aa029c3f76e26496f926d5512", "committedDate": "2020-08-31T15:09:16Z", "message": "Fixed merge error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08bf7606d454a6803ec0b5fcd1f2c8f0b005ecf6", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/08bf7606d454a6803ec0b5fcd1f2c8f0b005ecf6", "committedDate": "2020-08-31T18:39:10Z", "message": "Moved import-export preferences to exportSortingTab and renamed the tab"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e5ab695d3ba452393ea311f4196cade787cc64f", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/7e5ab695d3ba452393ea311f4196cade787cc64f", "committedDate": "2020-08-31T19:04:09Z", "message": "Renamed FileTab to LinkedFilesTab"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "352417d8fa73b0ff9d1c4ebdee87c7ed563e1e1d", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/352417d8fa73b0ff9d1c4ebdee87c7ed563e1e1d", "committedDate": "2020-08-31T20:36:41Z", "message": "Refactored ImportExportTab to PreferencesService"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4OTQzMDE4", "url": "https://github.com/JabRef/jabref/pull/6779#pullrequestreview-478943018", "createdAt": "2020-08-31T20:47:19Z", "commit": {"oid": "352417d8fa73b0ff9d1c4ebdee87c7ed563e1e1d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDo0NzoxOVrOHKIrUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDo0NzoxOVrOHKIrUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM4OTk3MQ==", "bodyText": "default missing?", "url": "https://github.com/JabRef/jabref/pull/6779#discussion_r480389971", "createdAt": "2020-08-31T20:47:19Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/gui/preferences/LinkedFilesTabViewModel.java", "diffHunk": "@@ -0,0 +1,192 @@\n+package org.jabref.gui.preferences;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.ListProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleListProperty;\n+import javafx.beans.property.SimpleStringProperty;\n+import javafx.beans.property.StringProperty;\n+import javafx.collections.FXCollections;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.util.DirectoryDialogConfiguration;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.logic.util.io.AutoLinkPreferences;\n+import org.jabref.model.metadata.FilePreferences;\n+import org.jabref.preferences.PreferencesService;\n+\n+import de.saxsys.mvvmfx.utils.validation.FunctionBasedValidator;\n+import de.saxsys.mvvmfx.utils.validation.ValidationMessage;\n+import de.saxsys.mvvmfx.utils.validation.ValidationStatus;\n+import de.saxsys.mvvmfx.utils.validation.Validator;\n+\n+public class LinkedFilesTabViewModel implements PreferenceTabViewModel {\n+\n+    private final StringProperty mainFileDirectoryProperty = new SimpleStringProperty(\"\");\n+    private final BooleanProperty useBibLocationAsPrimaryProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty autolinkFileStartsBibtexProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty autolinkFileExactBibtexProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty autolinkUseRegexProperty = new SimpleBooleanProperty();\n+    private final StringProperty autolinkRegexKeyProperty = new SimpleStringProperty(\"\");\n+    private final BooleanProperty searchFilesOnOpenProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty openBrowseOnCreateProperty = new SimpleBooleanProperty();\n+    private final ListProperty<String> defaultFileNamePatternsProperty =\n+            new SimpleListProperty<>(FXCollections.observableArrayList(FilePreferences.DEFAULT_FILENAME_PATTERNS));\n+    private final StringProperty fileNamePatternProperty = new SimpleStringProperty();\n+    private final StringProperty fileDirectoryPatternProperty = new SimpleStringProperty();\n+\n+    private final Validator mainFileDirValidator;\n+\n+    private final DialogService dialogService;\n+    private final PreferencesService preferences;\n+    private final FilePreferences initialFilePreferences;\n+    private final AutoLinkPreferences initialAutoLinkPreferences;\n+\n+    public LinkedFilesTabViewModel(DialogService dialogService, PreferencesService preferences) {\n+        this.dialogService = dialogService;\n+        this.preferences = preferences;\n+        this.initialFilePreferences = preferences.getFilePreferences();\n+        this.initialAutoLinkPreferences = preferences.getAutoLinkPreferences();\n+\n+        mainFileDirValidator = new FunctionBasedValidator<>(\n+                mainFileDirectoryProperty,\n+                input -> {\n+                    Path path = Path.of(mainFileDirectoryProperty.getValue());\n+                    return (Files.exists(path) && Files.isDirectory(path));\n+                },\n+                ValidationMessage.error(String.format(\"%s > %s > %s %n %n %s\",\n+                        Localization.lang(\"File\"),\n+                        Localization.lang(\"External file links\"),\n+                        Localization.lang(\"Main file directory\"),\n+                        Localization.lang(\"Directory not found\")\n+                        )\n+                )\n+        );\n+    }\n+\n+    @Override\n+    public void setValues() {\n+        // External files preferences / Attached files preferences / File preferences\n+        mainFileDirectoryProperty.setValue(initialFilePreferences.getFileDirectory().orElse(Path.of(\"\")).toString());\n+        useBibLocationAsPrimaryProperty.setValue(initialFilePreferences.isBibLocationAsPrimary());\n+        searchFilesOnOpenProperty.setValue(initialFilePreferences.shouldSearchFilesOnOpen());\n+        openBrowseOnCreateProperty.setValue(initialFilePreferences.shouldOpenBrowseOnCreate());\n+        fileNamePatternProperty.setValue(initialFilePreferences.getFileNamePattern());\n+        fileDirectoryPatternProperty.setValue(initialFilePreferences.getFileDirectoryPattern());\n+\n+        // Autolink preferences\n+        switch (initialAutoLinkPreferences.getCitationKeyDependency()) {\n+            case START -> autolinkFileStartsBibtexProperty.setValue(true);\n+            case EXACT -> autolinkFileExactBibtexProperty.setValue(true);\n+            case REGEX -> autolinkUseRegexProperty.setValue(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "352417d8fa73b0ff9d1c4ebdee87c7ed563e1e1d"}, "originalPosition": 86}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83a05c124bf23d37d0e7d945593b1f0fdf224d43", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/83a05c124bf23d37d0e7d945593b1f0fdf224d43", "committedDate": "2020-08-31T20:50:57Z", "message": "CHANGELOG.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c00e7b43e55aebc56522dee82ad3dc27940fd6d", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/1c00e7b43e55aebc56522dee82ad3dc27940fd6d", "committedDate": "2020-08-31T22:23:52Z", "message": "Rewording ImportExport to File"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acc5646c6cdff8313106771720aceaa2c16275db", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/acc5646c6cdff8313106771720aceaa2c16275db", "committedDate": "2020-09-01T10:19:54Z", "message": "Make FilePreferences and SavePreferences mutable, added ADR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce20c0674b6f5922af4f3e06d4a7f52781cf8065", "author": {"user": {"login": "tobiasdiez", "name": "Tobias Diez"}}, "url": "https://github.com/JabRef/jabref/commit/ce20c0674b6f5922af4f3e06d4a7f52781cf8065", "committedDate": "2020-09-01T12:14:56Z", "message": "Merge branch 'master' into RefactorFilePreferences"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 112, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}