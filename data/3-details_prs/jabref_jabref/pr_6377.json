{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwOTk1NDY0", "number": 6377, "title": "Fixes #6357: File directory", "bodyText": "Bug was introduced in 1b03f03. Sorry @calixtus for suspecting you \ud83d\udc7c.\nAlso a bit of code cleanup is included. For example, I tried to minimize using strings and favored Paths instead.\n\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-04-29T22:47:09Z", "url": "https://github.com/JabRef/jabref/pull/6377", "merged": true, "mergeCommit": {"oid": "862078a4db316cfd15bd77be68d3d2b010feab3b"}, "closed": true, "closedAt": "2020-04-30T09:10:14Z", "author": {"login": "tobiasdiez"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccgblNgH2gAyNDEwOTk1NDY0Ojc5ZTUxMDZkNWI0MDI2ZDg4ZGY2NDYyNDEzOWIwOTI0ODIzYTRjNmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccpUjRgH2gAyNDEwOTk1NDY0OjIxYTM3NGY4MzU5MjNmZTdmMGUyNWFlMDQxNjkyM2E1MjEyN2RjYjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "79e5106d5b4026d88df64624139b0924823a4c6c", "author": {"user": {"login": "tobiasdiez", "name": "Tobias Diez"}}, "url": "https://github.com/JabRef/jabref/commit/79e5106d5b4026d88df64624139b0924823a4c6c", "committedDate": "2020-04-29T22:43:03Z", "message": "Fixes #6357: File directory\n\nBug was introduced in https://github.com/JabRef/jabref/commit/1b03f039aa4abf0812a3a8ae0ba248c08fdb39a3."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "885ddbb99e9a62b3e16fc75586871420aaf78fa3", "author": {"user": {"login": "tobiasdiez", "name": "Tobias Diez"}}, "url": "https://github.com/JabRef/jabref/commit/885ddbb99e9a62b3e16fc75586871420aaf78fa3", "committedDate": "2020-04-29T22:54:59Z", "message": "Fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMjQzMjM3", "url": "https://github.com/JabRef/jabref/pull/6377#pullrequestreview-403243237", "createdAt": "2020-04-30T06:46:55Z", "commit": {"oid": "885ddbb99e9a62b3e16fc75586871420aaf78fa3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMjY4MTY2", "url": "https://github.com/JabRef/jabref/pull/6377#pullrequestreview-403268166", "createdAt": "2020-04-30T07:30:00Z", "commit": {"oid": "885ddbb99e9a62b3e16fc75586871420aaf78fa3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNzozMDowMFrOGOdHhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNzozNDoxNlrOGOdQTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgxMDMxMA==", "bodyText": "JavaDoc indicates, that Paths::get will be deprecated soon. Use Path::of instead.\nhttps://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/nio/file/Paths.html", "url": "https://github.com/JabRef/jabref/pull/6377#discussion_r417810310", "createdAt": "2020-04-30T07:30:00Z", "author": {"login": "calixtus"}, "path": "src/main/java/org/jabref/model/metadata/FilePreferences.java", "diffHunk": "@@ -34,24 +30,14 @@ public String getUser() {\n         return user;\n     }\n \n-    public Optional<Path> getFileDirectory(Field field) {\n-        try {\n-            String value = fieldFileDirectories.get(field);\n-            // filter empty paths\n-            if ((value != null) && !value.isEmpty()) {\n-                Path path = Paths.get(value);\n-                return Optional.of(path);\n-            }\n-            return Optional.empty();\n-        } catch (InvalidPathException ex) {\n+    public Optional<Path> getFileDirectory() {\n+        if (StringUtil.isBlank(mainFileDirectory)) {\n             return Optional.empty();\n+        } else {\n+            return Optional.of(Paths.get(mainFileDirectory));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "885ddbb99e9a62b3e16fc75586871420aaf78fa3"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgxMjU1OQ==", "bodyText": "Path::of and also below", "url": "https://github.com/JabRef/jabref/pull/6377#discussion_r417812559", "createdAt": "2020-04-30T07:34:16Z", "author": {"login": "calixtus"}, "path": "src/test/java/org/jabref/model/database/BibDatabaseContextTest.java", "diffHunk": "@@ -15,61 +17,104 @@\n import static org.mockito.Mockito.mock;\n import static org.mockito.Mockito.when;\n \n-public class BibDatabaseContextTest {\n+class BibDatabaseContextTest {\n \n     private Path currentWorkingDir;\n \n-    // Store the minimal preferences for the\n-    // BibDatabaseContext.getFileDirectories(File,\n-    // FilePreferences) incocation:\n     private FilePreferences fileDirPrefs;\n \n     @BeforeEach\n-    public void setUp() {\n+    void setUp() {\n         fileDirPrefs = mock(FilePreferences.class);\n         currentWorkingDir = Paths.get(System.getProperty(\"user.dir\"));\n         when(fileDirPrefs.isBibLocationAsPrimary()).thenReturn(true);\n     }\n \n     @Test\n-    public void getFileDirectoriesWithEmptyDbParent() {\n-        BibDatabaseContext dbContext = new BibDatabaseContext();\n-        dbContext.setDatabasePath(Paths.get(\"biblio.bib\"));\n-        List<String> fileDirectories = dbContext.getFileDirectories(StandardField.FILE, fileDirPrefs);\n-        assertEquals(Collections.singletonList(currentWorkingDir.toString()),\n-                fileDirectories);\n+    void getFileDirectoriesWithEmptyDbParent() {\n+        BibDatabaseContext database = new BibDatabaseContext();\n+        database.setDatabasePath(Paths.get(\"biblio.bib\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "885ddbb99e9a62b3e16fc75586871420aaf78fa3"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d6dffac64d40260f562896c224e4b77e3fb43d5", "author": {"user": {"login": "tobiasdiez", "name": "Tobias Diez"}}, "url": "https://github.com/JabRef/jabref/commit/4d6dffac64d40260f562896c224e4b77e3fb43d5", "committedDate": "2020-04-30T08:56:30Z", "message": "Replace Paths.get"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21a374f835923fe7f0e25ae0416923a52127dcb6", "author": {"user": {"login": "tobiasdiez", "name": "Tobias Diez"}}, "url": "https://github.com/JabRef/jabref/commit/21a374f835923fe7f0e25ae0416923a52127dcb6", "committedDate": "2020-04-30T09:04:31Z", "message": "Fix code style"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 362, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}