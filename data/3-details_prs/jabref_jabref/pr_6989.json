{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MzYwMjE0", "number": 6989, "title": "Merge parsing of bracketed patterns", "bodyText": "Fixes #6892.\nCharacter classes (regex expressions in brackets, e.g., [a-zA-Z]) should be usable with the regex modifier, but it currently isn't for citation keys.\nBracketed patterns are parsed using several different methods in CitationKeyGenerator.java, BracketedPattern.java and AbstractCitationKeyPattern. This PR aims to merge all parsing code into BracketedPattern.java to make it easier to modify bracketed patterns without breaking the citation key generator.\nCurrently BracketedPattern's parser can parse expressions containing the regex modifier using character classes.\nTodo\n\n What are AbstractCitationKeyPattern and GlobalCitationKeyPattern used for, and should they be removed?\n Why are both GlobalCitationKeyPattern and CitationKeyPatternPreferences  needed to create a CitationKeyGenerator?\n\n\nChecklist\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-10-07T16:05:35Z", "url": "https://github.com/JabRef/jabref/pull/6989", "merged": true, "mergeCommit": {"oid": "e955c46850e4738830198a889c3f09870b88ab30"}, "closed": true, "closedAt": "2020-10-13T13:01:42Z", "author": {"login": "k3KAW8Pnf7mkmdSMPHz27"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQO2ESgH2gAyNDk5MzYwMjE0OjI5Y2YwYmQxM2IwNzNhOGQ0NGY4MmMwNDM2OTlkZGI5NWQyNGMzZDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR71zjgH2gAyNDk5MzYwMjE0OmM4YjU5ZDUyODE2NWRlNzE1MmMxZWFjOGI5NmI0NzUxMzdlNWZjZmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "29cf0bd13b073a8d44f82c043699ddb95d24c3d0", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/29cf0bd13b073a8d44f82c043699ddb95d24c3d0", "committedDate": "2020-10-07T15:37:45Z", "message": "Add test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32f4a6417dc53bb8358fc601f62713f28a208f16", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/32f4a6417dc53bb8358fc601f62713f28a208f16", "committedDate": "2020-10-08T13:29:36Z", "message": "Fix test case use of unwanted character"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "035723643b80928b5a68b68ce34f3135cdeb834e", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/035723643b80928b5a68b68ce34f3135cdeb834e", "committedDate": "2020-10-08T14:42:14Z", "message": "Add method injection to `expandBrackets`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77045bd91ecdbaa5423c1f6705cbf9cd21254a3f", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/77045bd91ecdbaa5423c1f6705cbf9cd21254a3f", "committedDate": "2020-10-08T14:42:35Z", "message": "Fix logger message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5647df5070db30d49646a4326fdcf51cc44e0069", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/5647df5070db30d49646a4326fdcf51cc44e0069", "committedDate": "2020-10-08T15:15:41Z", "message": "Extract methods and change parsing\n\nExtracts code from `generateKey` as methods for readability purposes and\n switches out the parsing code for the one in `BracketedPattern`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc8aabe742e168a882b7ada32a6bf1932997f1de", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/cc8aabe742e168a882b7ada32a6bf1932997f1de", "committedDate": "2020-10-08T15:16:56Z", "message": "Codestyle improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "876ab47da4d3398769a9f27f4027eb396869921d", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/876ab47da4d3398769a9f27f4027eb396869921d", "committedDate": "2020-10-08T15:19:35Z", "message": "Fix use of illegal character in test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d96877d2b2a880bf0fafc0d74219f0c0925da22", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/9d96877d2b2a880bf0fafc0d74219f0c0925da22", "committedDate": "2020-10-08T17:53:24Z", "message": "Add log output for PatternSyntaxException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af776c53478360071fb5103eb53eb205a82b590c", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/af776c53478360071fb5103eb53eb205a82b590c", "committedDate": "2020-10-08T19:36:02Z", "message": "Fix handling unwanted characters between brackets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bca72ab52fa7343b452d3fa542cc6fe34354995b", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/bca72ab52fa7343b452d3fa542cc6fe34354995b", "committedDate": "2020-10-12T19:32:41Z", "message": "Fix Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47bc8d13826cb704ceed333a484f473764186262", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/47bc8d13826cb704ceed333a484f473764186262", "committedDate": "2020-10-12T19:48:27Z", "message": "Add test case for incorrect regex replacement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c67128ccbd69550e5d4a3f4c6ceef04649e99440", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/c67128ccbd69550e5d4a3f4c6ceef04649e99440", "committedDate": "2020-10-12T20:10:43Z", "message": "Add JavaDoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTE5MjIw", "url": "https://github.com/JabRef/jabref/pull/6989#pullrequestreview-506919220", "createdAt": "2020-10-12T21:11:00Z", "commit": {"oid": "c67128ccbd69550e5d4a3f4c6ceef04649e99440"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTI1MTMy", "url": "https://github.com/JabRef/jabref/pull/6989#pullrequestreview-506925132", "createdAt": "2020-10-12T21:24:27Z", "commit": {"oid": "c67128ccbd69550e5d4a3f4c6ceef04649e99440"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMToyNDoyOFrOHgNmFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMToyNDoyOFrOHgNmFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUzOTIyMQ==", "bodyText": "Possible exception if fieldParts is empty? Can this happen", "url": "https://github.com/JabRef/jabref/pull/6989#discussion_r503539221", "createdAt": "2020-10-12T21:24:28Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/logic/citationkeypattern/BracketedPattern.java", "diffHunk": "@@ -172,6 +172,43 @@ public String expand(BibEntry bibentry, Character keywordDelimiter, BibDatabase\n     public static String expandBrackets(String pattern, Character keywordDelimiter, BibEntry entry, BibDatabase database) {\n         Objects.requireNonNull(pattern);\n         Objects.requireNonNull(entry);\n+        return expandBrackets(pattern, expandBracketContent(keywordDelimiter, entry, database));\n+    }\n+\n+    /**\n+     * Utility method creating a function taking the string representation of the content of a bracketed expression and\n+     * expanding it.\n+     *\n+     * @param keywordDelimiter The keyword delimiter to use\n+     * @param entry            The {@link BibEntry} to use for expansion\n+     * @param database         The {@link BibDatabase} for field resolving. May be null.\n+     * @return a function accepting a bracketed expression and returning the result of expanding it\n+     */\n+    private static Function<String, String> expandBracketContent(Character keywordDelimiter, BibEntry entry, BibDatabase database) {\n+        return (String bracket) -> {\n+            String expandedPattern;\n+            List<String> fieldParts = parseFieldAndModifiers(bracket);\n+            // check whether there is a modifier on the end such as\n+            // \":lower\":\n+            expandedPattern = getFieldValue(entry, fieldParts.get(0), keywordDelimiter, database);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c67128ccbd69550e5d4a3f4c6ceef04649e99440"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTI1OTQ2", "url": "https://github.com/JabRef/jabref/pull/6989#pullrequestreview-506925946", "createdAt": "2020-10-12T21:26:16Z", "commit": {"oid": "c67128ccbd69550e5d4a3f4c6ceef04649e99440"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8b59d528165de7152c1eac8b96b475137e5fcfd", "author": {"user": {"login": "k3KAW8Pnf7mkmdSMPHz27", "name": "Jonatan Asketorp"}}, "url": "https://github.com/JabRef/jabref/commit/c8b59d528165de7152c1eac8b96b475137e5fcfd", "committedDate": "2020-10-12T22:37:07Z", "message": "Add test case"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 31, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}