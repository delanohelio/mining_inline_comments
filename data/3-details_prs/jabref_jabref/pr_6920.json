{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4ODY4ODc1", "number": 6920, "title": "Improve parsing of short DOIs", "bodyText": "Fixes #6880\nno more erroneous interpretation as short DOI of url's/notes like:\n\n\"http://www.cs.utexas.edu/users/kaufmann/itp-trusted-extensions-aug-2010/summary/summary.pdf\"\n\"abc.com/20/10/something/whatever\"\n\nstill correct detection of short DOIs hidden in url's as long as doi is part of subdomain, eg:\n\n\"www.doi.xyz.com/10/abc123\"\n\ncorrect detection of short DOIs like:\n\n\"doi.org/ab123\"\n\"https://doi.org/ab123\"\n\nadded respective tests.\nadded entry to CHANGELOG\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-09-17T19:02:19Z", "url": "https://github.com/JabRef/jabref/pull/6920", "merged": true, "mergeCommit": {"oid": "d944eaed90d080c0590960aa440f29d0e9585254"}, "closed": true, "closedAt": "2020-09-20T20:09:27Z", "author": {"login": "PremKolar"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJ1b9uAH2gAyNDg4ODY4ODc1OjY4YzRiZWJjZjc3MTI2NzUzNzliY2RkNjg3ZWQ1Y2U1NmJlOTU2NWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdK0hvsAFqTQ5MjIxOTQ4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "68c4bebcf7712675379bcdd687ed5ce56be9565c", "author": {"user": {"login": "PremKolar", "name": "Nikolaus Koopmann"}}, "url": "https://github.com/JabRef/jabref/commit/68c4bebcf7712675379bcdd687ed5ce56be9565c", "committedDate": "2020-09-17T18:38:04Z", "message": "fixed issue #6880: Improved detection of short DOIs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "404a41ad4d1e3c42940e480d676d41176f523372", "author": {"user": {"login": "PremKolar", "name": "Nikolaus Koopmann"}}, "url": "https://github.com/JabRef/jabref/commit/404a41ad4d1e3c42940e480d676d41176f523372", "committedDate": "2020-09-17T18:43:47Z", "message": "updated changelog for issue #6880"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d57fbc62f5d508822328d309854f767e758ffaed", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/d57fbc62f5d508822328d309854f767e758ffaed", "committedDate": "2020-09-18T06:54:32Z", "message": "Merge branch 'master' into bugfix/issue6880"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0208f44dcaeae3c7d9cf4a1b778dfae1f4ad6f2", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/d0208f44dcaeae3c7d9cf4a1b778dfae1f4ad6f2", "committedDate": "2020-09-18T06:55:37Z", "message": "Update CHANGELOG.md\n\nfix merge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMjIxMDAy", "url": "https://github.com/JabRef/jabref/pull/6920#pullrequestreview-491221002", "createdAt": "2020-09-18T07:37:48Z", "commit": {"oid": "d0208f44dcaeae3c7d9cf4a1b778dfae1f4ad6f2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNzozNzo0OFrOHUBlfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwNzo0Mzo1OFrOHUBxEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc1OTU0OQ==", "bodyText": "please remove the added indent.", "url": "https://github.com/JabRef/jabref/pull/6920#discussion_r490759549", "createdAt": "2020-09-18T07:37:48Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/cleanup/DoiCleanup.java", "diffHunk": "@@ -46,7 +46,7 @@\n                 // Doi field seems to contain Doi -> cleanup note, url, ee field\n                 for (Field field : FIELDS) {\n                     entry.getField(field).flatMap(DOI::parse)\n-                         .ifPresent(unused -> removeFieldValue(entry, field, changes));\n+                            .ifPresent(unused -> removeFieldValue(entry, field, changes));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0208f44dcaeae3c7d9cf4a1b778dfae1f4ad6f2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MDkzOQ==", "bodyText": "please remove empty line", "url": "https://github.com/JabRef/jabref/pull/6920#discussion_r490760939", "createdAt": "2020-09-18T07:40:41Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/model/entry/identifier/DOI.java", "diffHunk": "@@ -115,12 +133,37 @@ public DOI(String doi) {\n             if (shortDoiMatcher.find()) {\n                 this.doi = shortDoiMatcher.group(1);\n                 isShortDoi = true;\n+                checkForAmbiguousShortDOI(); // can only happen in this case\n             } else {\n-                throw new IllegalArgumentException(trimmedDoi + \" is not a valid DOI/Short DOI.\");\n+                // Shortcut DOI without the \"10/\" as in \"doi.org/d8dn\"\n+                Matcher shortcutDoiMatcher = EXACT_SHORT_DOI_SHORTCUT.matcher(trimmedDoi);\n+                if (shortcutDoiMatcher.find()) {\n+                    this.doi = \"10/\"+shortcutDoiMatcher.group(1);\n+                    isShortDoi = true;\n+                } else {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0208f44dcaeae3c7d9cf4a1b778dfae1f4ad6f2"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MjE1Mw==", "bodyText": "We have the convention that in general dead/unused code should be removed. Do you have any concrete plans/ideas where the isAmbiguous variable is needed?\nIf not, I would ask you to remove it.", "url": "https://github.com/JabRef/jabref/pull/6920#discussion_r490762153", "createdAt": "2020-09-18T07:43:12Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/model/entry/identifier/DOI.java", "diffHunk": "@@ -115,12 +133,37 @@ public DOI(String doi) {\n             if (shortDoiMatcher.find()) {\n                 this.doi = shortDoiMatcher.group(1);\n                 isShortDoi = true;\n+                checkForAmbiguousShortDOI(); // can only happen in this case\n             } else {\n-                throw new IllegalArgumentException(trimmedDoi + \" is not a valid DOI/Short DOI.\");\n+                // Shortcut DOI without the \"10/\" as in \"doi.org/d8dn\"\n+                Matcher shortcutDoiMatcher = EXACT_SHORT_DOI_SHORTCUT.matcher(trimmedDoi);\n+                if (shortcutDoiMatcher.find()) {\n+                    this.doi = \"10/\"+shortcutDoiMatcher.group(1);\n+                    isShortDoi = true;\n+                } else {\n+\n+                    throw new IllegalArgumentException(trimmedDoi + \" is not a valid DOI/Short DOI.\");\n+                }\n             }\n         }\n     }\n \n+    /**\n+     * checks whether the DOI might as well be something else, like:\n+     * \"10/2012\" or \" 10:as23 \".\n+     *\n+     * sets the property \"isAmbiguous\" accordingly. ( NOT USED YET! )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0208f44dcaeae3c7d9cf4a1b778dfae1f4ad6f2"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MjUxNQ==", "bodyText": "remove new empty lines", "url": "https://github.com/JabRef/jabref/pull/6920#discussion_r490762515", "createdAt": "2020-09-18T07:43:58Z", "author": {"login": "tobiasdiez"}, "path": "src/test/java/org/jabref/model/entry/identifier/DOITest.java", "diffHunk": "@@ -83,18 +88,32 @@ public void acceptDoiPrefixInShortDoi() {\n         assertEquals(\"10/gf4gqc\", new DOI(\"doi:10/gf4gqc\").getDOI());\n     }\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0208f44dcaeae3c7d9cf4a1b778dfae1f4ad6f2"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be8fd198bfd60dc6d8ce1f247f0135ea2dfcc8a9", "author": {"user": {"login": "PremKolar", "name": "Nikolaus Koopmann"}}, "url": "https://github.com/JabRef/jabref/commit/be8fd198bfd60dc6d8ce1f247f0135ea2dfcc8a9", "committedDate": "2020-09-18T08:42:39Z", "message": "fixed formatting/style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98ea42fe8be96fd5db2cb5c1379b66e3cfcf868c", "author": {"user": {"login": "PremKolar", "name": "Nikolaus Koopmann"}}, "url": "https://github.com/JabRef/jabref/commit/98ea42fe8be96fd5db2cb5c1379b66e3cfcf868c", "committedDate": "2020-09-18T08:43:01Z", "message": "Merge branch 'bugfix/issue6880' of https://github.com/PremKolar/jabref into bugfix/issue6880"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a21ee2d5d68eb97de56df09c413fa6f0e7b37ee", "author": {"user": {"login": "PremKolar", "name": "Nikolaus Koopmann"}}, "url": "https://github.com/JabRef/jabref/commit/0a21ee2d5d68eb97de56df09c413fa6f0e7b37ee", "committedDate": "2020-09-18T11:12:07Z", "message": "removed stuff relating to 'ambiguous DOIs'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aac71bd83b4867f741f26230b2e49c2ff237f3d5", "author": {"user": {"login": "PremKolar", "name": "Nikolaus Koopmann"}}, "url": "https://github.com/JabRef/jabref/commit/aac71bd83b4867f741f26230b2e49c2ff237f3d5", "committedDate": "2020-09-18T14:31:37Z", "message": "Merge branch 'master' into bugfix/issue6880"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e5de7999d2528ba7ae74b3d06cf3ef9007c5db7", "author": {"user": {"login": "PremKolar", "name": "Nikolaus Koopmann"}}, "url": "https://github.com/JabRef/jabref/commit/1e5de7999d2528ba7ae74b3d06cf3ef9007c5db7", "committedDate": "2020-09-19T18:31:03Z", "message": "fixed checkstyle failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e15cd8950ec6c854f548bc7d7f27721ca4cccbce", "author": {"user": {"login": "PremKolar", "name": "Nikolaus Koopmann"}}, "url": "https://github.com/JabRef/jabref/commit/e15cd8950ec6c854f548bc7d7f27721ca4cccbce", "committedDate": "2020-09-19T18:46:47Z", "message": "re-added the 'urn:doi:' case for FIND_SHORT_DOI_EXP"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMjA1ODQ4", "url": "https://github.com/JabRef/jabref/pull/6920#pullrequestreview-492205848", "createdAt": "2020-09-20T16:28:17Z", "commit": {"oid": "e15cd8950ec6c854f548bc7d7f27721ca4cccbce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMjE5Mzk3", "url": "https://github.com/JabRef/jabref/pull/6920#pullrequestreview-492219397", "createdAt": "2020-09-20T20:06:56Z", "commit": {"oid": "e15cd8950ec6c854f548bc7d7f27721ca4cccbce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMFQyMDowNjo1N1rOHU8wBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMFQyMDowNjo1N1rOHU8wBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTcyODkwMQ==", "bodyText": "Note to self: urn:doi is not a valid DOI: See https://en.wikipedia.org/wiki/Digital_object_identifier#Standardization", "url": "https://github.com/JabRef/jabref/pull/6920#discussion_r491728901", "createdAt": "2020-09-20T20:06:57Z", "author": {"login": "koppor"}, "path": "src/test/java/org/jabref/model/entry/identifier/DOITest.java", "diffHunk": "@@ -86,15 +91,24 @@ public void acceptDoiPrefixInShortDoi() {\n     @Test\n     public void acceptURNPrefix() {\n         assertEquals(\"10.123/456\", new DOI(\"urn:10.123/456\").getDOI());\n-        assertEquals(\"10.123/456\", new DOI(\"urn:doi:10.123/456\").getDOI());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e15cd8950ec6c854f548bc7d7f27721ca4cccbce"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMjE5NDgz", "url": "https://github.com/JabRef/jabref/pull/6920#pullrequestreview-492219483", "createdAt": "2020-09-20T20:08:24Z", "commit": {"oid": "e15cd8950ec6c854f548bc7d7f27721ca4cccbce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4981, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}