{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyODkwODkz", "number": 6897, "title": "DOI matching in duplicate check", "bodyText": "Fixes #6707\nFollow up from #6756\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-09-09T14:35:49Z", "url": "https://github.com/JabRef/jabref/pull/6897", "merged": true, "mergeCommit": {"oid": "8a242c9737322f654077817d9af8810f5b237dc2"}, "closed": true, "closedAt": "2020-09-29T06:06:57Z", "author": {"login": "Siedlerchr"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc84SXegH2gAyNDgyODkwODkzOjZjOGI3ZDdjMDU0ODNjZWY5ZmY3MzEwNTkzMGE4MmMwMzE1OWIyYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNh4SeAFqTQ5ODEyMDEyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6c8b7d7c05483cef9ff73105930a82c03159b2c6", "author": {"user": {"login": "KunAndrew", "name": null}}, "url": "https://github.com/JabRef/jabref/commit/6c8b7d7c05483cef9ff73105930a82c03159b2c6", "committedDate": "2020-08-08T12:36:17Z", "message": "Add DOI matching with not full coincidence."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25e34f085b8fa6f7ba97e92cf935e34116991648", "author": {"user": {"login": "KunAndrew", "name": null}}, "url": "https://github.com/JabRef/jabref/commit/25e34f085b8fa6f7ba97e92cf935e34116991648", "committedDate": "2020-08-11T15:57:56Z", "message": "issue 6707\nAdd zero weights for otes and comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e4714b8fe0c974a90e65e4806dd761547e5ea0f", "author": {"user": {"login": "KunAndrew", "name": null}}, "url": "https://github.com/JabRef/jabref/commit/8e4714b8fe0c974a90e65e4806dd761547e5ea0f", "committedDate": "2020-08-17T12:57:48Z", "message": "issue 6707\nsmall improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9f412cd09fe69f6aaf31840ad735fe97a192eed", "author": {"user": {"login": "KunAndrew", "name": null}}, "url": "https://github.com/JabRef/jabref/commit/b9f412cd09fe69f6aaf31840ad735fe97a192eed", "committedDate": "2020-09-08T18:39:56Z", "message": "issue 6707\nMoving cleanup's logic to DOI constructor.Add results of generate-authors.sh."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a024749c3030cdf22516e9e96f5ae2278d569ff", "author": {"user": {"login": "KunAndrew", "name": null}}, "url": "https://github.com/JabRef/jabref/commit/8a024749c3030cdf22516e9e96f5ae2278d569ff", "committedDate": "2020-09-09T04:45:50Z", "message": "issue 6707\nMoving cleanup's logic to DOI constructor.Add results of generate-authors.sh.\n(revert AUTHORS)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "304b99fb0a9e81021dd0dcfdab1536d0c3b6147a", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/304b99fb0a9e81021dd0dcfdab1536d0c3b6147a", "committedDate": "2020-09-09T14:33:15Z", "message": "Merge branch 'fix-for-issue-6707' of https://github.com/KunAndrew/jabref into KunAndrew-fix-for-issue-6707\n\n* 'fix-for-issue-6707' of https://github.com/KunAndrew/jabref:\n  issue 6707 Moving cleanup's logic to DOI constructor.Add results of generate-authors.sh. (revert AUTHORS)\n  issue 6707 Moving cleanup's logic to DOI constructor.Add results of generate-authors.sh.\n  issue 6707 small improvements\n  issue 6707 Add zero weights for otes and comments.\n  Add DOI matching with not full coincidence."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/3fc1ffa2516e9f417bc929d98df77273a257597a", "committedDate": "2020-09-09T14:45:38Z", "message": "remove unnecessary cast"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NTk5NjE3", "url": "https://github.com/JabRef/jabref/pull/6897#pullrequestreview-485599617", "createdAt": "2020-09-10T05:48:50Z", "commit": {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwNTo0ODo1MFrOHPj_Qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwNTo0ODo1MFrOHPj_Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjA4MDMyMw==", "bodyText": "@KunAndrew  I think you need to adjust the DOI regex pattern:\nOne CrossRef test fails, because of the missing underscore:\nThe DOI cannot be resolved wihtout underscore\norg.opentest4j.AssertionFailedError: expected: <10.1007/11538394_20> but was: <10.1007/1153839420>", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r486080323", "createdAt": "2020-09-10T05:48:50Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/model/entry/identifier/DOI.java", "diffHunk": "@@ -108,12 +108,12 @@ public DOI(String doi) {\n         Matcher matcher = EXACT_DOI_PATT.matcher(trimmedDoi);\n         if (matcher.find()) {\n             // match only group \\1\n-            this.doi = matcher.group(1);\n+            this.doi = matcher.group(1).replaceAll(\"[^\\\\w,/,:,-,.,-]|[_]\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MjMyODEx", "url": "https://github.com/JabRef/jabref/pull/6897#pullrequestreview-486232811", "createdAt": "2020-09-10T19:08:22Z", "commit": {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTowODoyMlrOHQCGFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTowODoyMlrOHQCGFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3MzU4OQ==", "bodyText": "I think, using org.jabref.model.entry.identifier.DOI#equals makes more sense.\nFurthermore, Objects.equals should be used\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return oneDOI.get().getDOI().equalsIgnoreCase(twoDOI.get().getDOI());\n          \n          \n            \n                        return Objects.equals(oneDOI, twoDOI);", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r486573589", "createdAt": "2020-09-10T19:08:22Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/logic/database/DuplicateCheck.java", "diffHunk": "@@ -303,6 +308,19 @@ public boolean isDuplicate(final BibEntry one, final BibEntry two, final BibData\n             return true;\n         }\n \n+        // check DOI\n+        Optional<DOI> oneDOI = one.getDOI();\n+        Optional<DOI> twoDOI = two.getDOI();\n+        if (oneDOI.isPresent() && twoDOI.isPresent()) {\n+            return oneDOI.get().getDOI().equalsIgnoreCase(twoDOI.get().getDOI());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MjMzMDQ3", "url": "https://github.com/JabRef/jabref/pull/6897#pullrequestreview-486233047", "createdAt": "2020-09-10T19:08:42Z", "commit": {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOTowODo0MlrOHQCG2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxOToxMDoyNlrOHQCKig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3Mzc4Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return oneISBN.get().equals(twoISBN.get());\n          \n          \n            \n                        return Objects.equals(oneISBN, twoISBN);", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r486573786", "createdAt": "2020-09-10T19:08:42Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/logic/database/DuplicateCheck.java", "diffHunk": "@@ -303,6 +308,19 @@ public boolean isDuplicate(final BibEntry one, final BibEntry two, final BibData\n             return true;\n         }\n \n+        // check DOI\n+        Optional<DOI> oneDOI = one.getDOI();\n+        Optional<DOI> twoDOI = two.getDOI();\n+        if (oneDOI.isPresent() && twoDOI.isPresent()) {\n+            return oneDOI.get().getDOI().equalsIgnoreCase(twoDOI.get().getDOI());\n+        }\n+        // check ISBN\n+        Optional<ISBN> oneISBN = one.getISBN();\n+        Optional<ISBN> twoISBN = two.getISBN();\n+        if (oneISBN.isPresent() && twoISBN.isPresent()) {\n+            return oneISBN.get().equals(twoISBN.get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3NDYxNg==", "bodyText": "There should be a comment added which characters are removed and why. Without any comment, this is a \"magic number\" which should be extraced to a constant.", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r486574616", "createdAt": "2020-09-10T19:10:13Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/model/entry/identifier/DOI.java", "diffHunk": "@@ -108,12 +108,12 @@ public DOI(String doi) {\n         Matcher matcher = EXACT_DOI_PATT.matcher(trimmedDoi);\n         if (matcher.find()) {\n             // match only group \\1\n-            this.doi = matcher.group(1);\n+            this.doi = matcher.group(1).replaceAll(\"[^\\\\w,/,:,-,.,-]|[_]\", \"\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjA4MDMyMw=="}, "originalCommit": {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU3NDczMA==", "bodyText": "This is the same pattern than above --> please use a constant.", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r486574730", "createdAt": "2020-09-10T19:10:26Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/model/entry/identifier/DOI.java", "diffHunk": "@@ -108,12 +108,12 @@ public DOI(String doi) {\n         Matcher matcher = EXACT_DOI_PATT.matcher(trimmedDoi);\n         if (matcher.find()) {\n             // match only group \\1\n-            this.doi = matcher.group(1);\n+            this.doi = matcher.group(1).replaceAll(\"[^\\\\w,/,:,-,.,-]|[_]\", \"\");\n         } else {\n             // Short DOI\n             Matcher shortDoiMatcher = EXACT_SHORT_DOI_PATT.matcher(trimmedDoi);\n             if (shortDoiMatcher.find()) {\n-                this.doi = shortDoiMatcher.group(1);\n+                this.doi = shortDoiMatcher.group(1).replaceAll(\"[^\\\\w,/,:,-,.,-]|[_]\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MzU2OTkx", "url": "https://github.com/JabRef/jabref/pull/6897#pullrequestreview-488356991", "createdAt": "2020-09-15T06:20:40Z", "commit": {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNjoyMDo0MFrOHRyZHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwNjoyMDo0MFrOHRyZHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQxMzQ2OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        this.doi = matcher.group(1).replaceAll(\"[^\\\\w,/,:,-,.,-]|[_]\", \"\");\n          \n          \n            \n                        this.doi = matcher.group(1).replaceAll(\"[^\\\\w/:-.-_]\", \"\");\n          \n      \n    \n    \n  \n\nVariable name: ILLEGAL_DOI_CHARACTERS --> Pattern.compile?\n(devcall)", "url": "https://github.com/JabRef/jabref/pull/6897#discussion_r488413469", "createdAt": "2020-09-15T06:20:40Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/model/entry/identifier/DOI.java", "diffHunk": "@@ -108,12 +108,12 @@ public DOI(String doi) {\n         Matcher matcher = EXACT_DOI_PATT.matcher(trimmedDoi);\n         if (matcher.find()) {\n             // match only group \\1\n-            this.doi = matcher.group(1);\n+            this.doi = matcher.group(1).replaceAll(\"[^\\\\w,/,:,-,.,-]|[_]\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fc1ffa2516e9f417bc929d98df77273a257597a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8c08a2af10e089c5c26bd21a2cb5488425e61fe", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/d8c08a2af10e089c5c26bd21a2cb5488425e61fe", "committedDate": "2020-09-26T11:45:15Z", "message": "Update src/main/java/org/jabref/logic/database/DuplicateCheck.java\n\nCo-authored-by: Oliver Kopp <kopp.dev@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aee547752717e6a37fbbe23ab3ff9a515e54b14", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/0aee547752717e6a37fbbe23ab3ff9a515e54b14", "committedDate": "2020-09-26T11:45:22Z", "message": "Update src/main/java/org/jabref/logic/database/DuplicateCheck.java\n\nCo-authored-by: Oliver Kopp <kopp.dev@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "074856d7e18d22142be4138b630c3615d7ac49db", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/074856d7e18d22142be4138b630c3615d7ac49db", "committedDate": "2020-09-26T11:45:30Z", "message": "Update src/main/java/org/jabref/model/entry/identifier/DOI.java\n\nCo-authored-by: Oliver Kopp <kopp.dev@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1102851c158a1fd07c8fa83b0b7e4b2e33aab20f", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/1102851c158a1fd07c8fa83b0b7e4b2e33aab20f", "committedDate": "2020-09-26T11:46:25Z", "message": "Merge remote-tracking branch 'upstream/master' into KunAndrew-fix-for-issue-6707\n\n* upstream/master: (35 commits)\n  Fix a fetcher test for the ShortDOIService (#6945)\n  Fixes Shared Database: Changes filtering in CoarseChangeFilter to attribute property (#6868)\n  Changed default value of \"search and store files relative to bibtex file\" to true (#6928)\n  Replace comment by just a failure (#6943)\n  Fix: in entry types editor selected field is not removed after first click  (#6941)\n  Fix remove actions for entry types in the editor (#6933)\n  Always use Java 15 (#6929)\n  Update DevDocs: workaround for issues with local openjfx maven libraries (#6931)\n  Fixes bugs in the `regex` cite key pattern modifier (#6893)\n  Add missing author\n  Readability for citation key patterns (#6706)\n  Add new author\n  Reset to master and add default case to switch (#6847)\n  Bump mockito-core from 3.5.10 to 3.5.11 (#6924)\n  Bump byte-buddy-parent from 1.10.14 to 1.10.15 (#6923)\n  Bump org.beryx.jlink from 2.21.4 to 2.22.0 (#6925)\n  Bump xmpbox from 2.0.20 to 2.0.21 (#6926)\n  Bump pascalgn/automerge-action from v0.9.0 to v0.10.0 (#6927)\n  Improve parsing of short DOIs (#6920)\n  Bump junit-vintage-engine from 5.6.2 to 5.7.0 (#6910)\n  ..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fa5691901d6f614a9454b662dec987354708670", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/0fa5691901d6f614a9454b662dec987354708670", "committedDate": "2020-09-26T12:25:31Z", "message": "simplify code\nremove additional regex we already are trimming and normalizing DOIs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "298ec852baa0288f18fef38b70ecc8bb506921c1", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/298ec852baa0288f18fef38b70ecc8bb506921c1", "committedDate": "2020-09-26T12:39:28Z", "message": "add changelog entry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3920cd3f566b252eb2964e3d1b4826d3c8f7ef98", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/3920cd3f566b252eb2964e3d1b4826d3c8f7ef98", "committedDate": "2020-09-26T16:43:11Z", "message": "Merge branch 'master' into KunAndrew-fix-for-issue-6707"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDgyNDI4", "url": "https://github.com/JabRef/jabref/pull/6897#pullrequestreview-497082428", "createdAt": "2020-09-27T13:42:18Z", "commit": {"oid": "3920cd3f566b252eb2964e3d1b4826d3c8f7ef98"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MTIwMTIy", "url": "https://github.com/JabRef/jabref/pull/6897#pullrequestreview-498120122", "createdAt": "2020-09-29T06:06:36Z", "commit": {"oid": "3920cd3f566b252eb2964e3d1b4826d3c8f7ef98"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4978, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}