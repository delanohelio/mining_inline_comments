{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NzI1NTQz", "number": 5812, "title": "Batch DBMSProcessor fields insertion", "bodyText": "In preparing for aggregating insertion of entries, I realized that aggregation of insertion into the FIELD table itself can be aggregated, since it is currently being done in a for loop. This can be done without aggregating entry insertion. The fix is in this PR, although I have not manually tested it.\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for bigger UI changes)\n Checked documentation: Is the information available and up to date? If not: Issue created at https://github.com/JabRef/user-documentation/issues.", "createdAt": "2020-01-02T17:00:22Z", "url": "https://github.com/JabRef/jabref/pull/5812", "merged": true, "mergeCommit": {"oid": "2f5565b3e3b97eecf93bb4a51752b18426efedce"}, "closed": true, "closedAt": "2020-01-07T22:26:51Z", "author": {"login": "abepolk"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2Z2v8AH2gAyMzU4NzI1NTQzOjEzNDhjMmY0OGQ5NWI3MmZmNmNhZWZjYWM0ODExNmZiOGJhYjU4Mjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4Id7UgFqTMzOTU0NzIwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1348c2f48d95b72ff6caefcac48116fb8bab5829", "author": {"user": {"login": "abepolk", "name": "Abe Polk"}}, "url": "https://github.com/JabRef/jabref/commit/1348c2f48d95b72ff6caefcac48116fb8bab5829", "committedDate": "2020-01-02T13:34:16Z", "message": "Initial changes to DBMSProcessor for insert entry functionality"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e4e76f99bc7327e4a8955f0eab7a76a69e1ed86", "author": {"user": {"login": "abepolk", "name": "Abe Polk"}}, "url": "https://github.com/JabRef/jabref/commit/7e4e76f99bc7327e4a8955f0eab7a76a69e1ed86", "committedDate": "2020-01-02T16:50:24Z", "message": "Added unit test for inserting multiple entries, with multiple of BibEntry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cf40b474eb30ced745cf588e4c68ec43e2856b6", "author": {"user": {"login": "abepolk", "name": "Abe Polk"}}, "url": "https://github.com/JabRef/jabref/commit/8cf40b474eb30ced745cf588e4c68ec43e2856b6", "committedDate": "2020-01-02T16:58:47Z", "message": "Remove StandardOut"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "931ccad7ab27f0340b7ee06073dca9b76ecbf63b", "author": {"user": {"login": "abepolk", "name": "Abe Polk"}}, "url": "https://github.com/JabRef/jabref/commit/931ccad7ab27f0340b7ee06073dca9b76ecbf63b", "committedDate": "2020-01-02T17:12:53Z", "message": "Merge branch 'master' into batch_DBMSProcessor_fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MDcxOTgx", "url": "https://github.com/JabRef/jabref/pull/5812#pullrequestreview-338071981", "createdAt": "2020-01-03T13:10:26Z", "commit": {"oid": "931ccad7ab27f0340b7ee06073dca9b76ecbf63b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTQ3MjAx", "url": "https://github.com/JabRef/jabref/pull/5812#pullrequestreview-339547201", "createdAt": "2020-01-07T22:25:16Z", "commit": {"oid": "931ccad7ab27f0340b7ee06073dca9b76ecbf63b"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMjoyNToxNlrOFbHrnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMjoyNjozMVrOFbHthQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk4MTcyNQ==", "bodyText": "I think, this should be \"Convert\" instead of \"Coerce\"?", "url": "https://github.com/JabRef/jabref/pull/5812#discussion_r363981725", "createdAt": "2020-01-07T22:25:16Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/logic/shared/DBMSProcessor.java", "diffHunk": "@@ -213,25 +213,30 @@ private boolean checkForBibEntryExistence(BibEntry bibEntry) {\n     private void insertIntoFieldTable(BibEntry bibEntry) {\n         try {\n             // Inserting into FIELD table\n-            for (Field field : bibEntry.getFields()) {\n-                StringBuilder insertFieldQuery = new StringBuilder()\n-                        .append(\"INSERT INTO \")\n-                        .append(escape(\"FIELD\"))\n-                        .append(\"(\")\n-                        .append(escape(\"ENTRY_SHARED_ID\"))\n-                        .append(\", \")\n-                        .append(escape(\"NAME\"))\n-                        .append(\", \")\n-                        .append(escape(\"VALUE\"))\n-                        .append(\") VALUES(?, ?, ?)\");\n-\n-                try (PreparedStatement preparedFieldStatement = connection.prepareStatement(insertFieldQuery.toString())) {\n+            // Coerce to ArrayList in order to use List.get()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "931ccad7ab27f0340b7ee06073dca9b76ecbf63b"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk4MTgyNQ==", "bodyText": "Can't we use the repeat() thing there, too?", "url": "https://github.com/JabRef/jabref/pull/5812#discussion_r363981825", "createdAt": "2020-01-07T22:25:32Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/logic/shared/DBMSProcessor.java", "diffHunk": "@@ -213,25 +213,30 @@ private boolean checkForBibEntryExistence(BibEntry bibEntry) {\n     private void insertIntoFieldTable(BibEntry bibEntry) {\n         try {\n             // Inserting into FIELD table\n-            for (Field field : bibEntry.getFields()) {\n-                StringBuilder insertFieldQuery = new StringBuilder()\n-                        .append(\"INSERT INTO \")\n-                        .append(escape(\"FIELD\"))\n-                        .append(\"(\")\n-                        .append(escape(\"ENTRY_SHARED_ID\"))\n-                        .append(\", \")\n-                        .append(escape(\"NAME\"))\n-                        .append(\", \")\n-                        .append(escape(\"VALUE\"))\n-                        .append(\") VALUES(?, ?, ?)\");\n-\n-                try (PreparedStatement preparedFieldStatement = connection.prepareStatement(insertFieldQuery.toString())) {\n+            // Coerce to ArrayList in order to use List.get()\n+            List<Field> fields = new ArrayList<>(bibEntry.getFields());\n+            StringBuilder insertFieldQuery = new StringBuilder()\n+                    .append(\"INSERT INTO \")\n+                    .append(escape(\"FIELD\"))\n+                    .append(\"(\")\n+                    .append(escape(\"ENTRY_SHARED_ID\"))\n+                    .append(\", \")\n+                    .append(escape(\"NAME\"))\n+                    .append(\", \")\n+                    .append(escape(\"VALUE\"))\n+                    .append(\") VALUES(?, ?, ?)\");\n+            // Number of commas is fields.size() - 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "931ccad7ab27f0340b7ee06073dca9b76ecbf63b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk4MjA0Mw==", "bodyText": "\"eventually\" is a false friend. Please translate it to \"possibly\" or \"maybe\"", "url": "https://github.com/JabRef/jabref/pull/5812#discussion_r363982043", "createdAt": "2020-01-07T22:26:02Z", "author": {"login": "koppor"}, "path": "src/test/java/org/jabref/logic/shared/DBMSProcessorTest.java", "diffHunk": "@@ -95,6 +95,59 @@ void testInsertEntry() throws SQLException {\n         assertEquals(expectedFieldMap, actualFieldMap);\n     }\n \n+    @Test\n+    void testInsertMultipleEntries() throws SQLException {\n+        BibEntry firstEntry = getBibEntryExample();\n+        String firstId = firstEntry.getId();\n+        BibEntry secondEntry = getBibEntryExample2();\n+        String secondId = secondEntry.getId();\n+        BibEntry thirdEntry = getBibEntryExample3();\n+        String thirdId = thirdEntry.getId();\n+\n+        // This must eventually be changed to insertEntries() once that method is implemented", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "931ccad7ab27f0340b7ee06073dca9b76ecbf63b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk4MjIxMw==", "bodyText": "Please give the method a more meaningful name. For instance getShelahBibEntry.", "url": "https://github.com/JabRef/jabref/pull/5812#discussion_r363982213", "createdAt": "2020-01-07T22:26:31Z", "author": {"login": "koppor"}, "path": "src/test/java/org/jabref/logic/shared/DBMSProcessorTest.java", "diffHunk": "@@ -311,6 +364,24 @@ private static BibEntry getBibEntryExample() {\n                 .withCiteKey(\"nanoproc1994\");\n     }\n \n+    private static BibEntry getBibEntryExample2() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "931ccad7ab27f0340b7ee06073dca9b76ecbf63b"}, "originalPosition": 84}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 516, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}