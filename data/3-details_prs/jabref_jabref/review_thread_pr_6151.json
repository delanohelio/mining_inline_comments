{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxOTAxMTEz", "number": 6151, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNDo1NzoxMVrODsUqag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNTowNToyNVrODsUtUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3ODAyNDc0OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/actions/ActionHelper.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNDo1NzoxMVrOF9KABA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNjozODo1NVrOGEsgoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MTMwMA==", "bodyText": "I think the current code runs into similar problems that we had recently in a PR by @stefan-kolb: if the currently selected entry changes, then the binding is not updated.\nHere, this should be relatively easy to fix:\nEasyBind.flatMap(stateManager.getSelectedEntries().getValueAt(0), entry -> entry.getFiles())\n         .map(files -> to boolean)\n\nHere the getFiles methods needs to be changed to return an observable list. This can be done using the current code and a EasyBind.map(getFieldBinding(FILE), ... parse).", "url": "https://github.com/JabRef/jabref/pull/6151#discussion_r399671300", "createdAt": "2020-03-28T14:57:11Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/actions/ActionHelper.java", "diffHunk": "@@ -36,4 +40,18 @@ public static BooleanExpression isAnyFieldSetForSelectedEntry(List<Field> fields\n                 entry.getFieldsObservable(),\n                 stateManager.getSelectedEntries());\n     }\n+\n+    public static BooleanExpression isFilePresentForSelectedEntry(StateManager stateManager, PreferencesService preferencesService) {\n+        List<LinkedFile> files = stateManager.getSelectedEntries().get(0).getFiles();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d16ded3b7142f8c33d5fdc105c338602b9349928"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcwOTg0OQ==", "bodyText": "I played a bit around with it. I was able to make getFiles return an ObservableList (by BindingsHelper::map, I had no luck with EasyBind), but EasyBind.flatMap does not exist, so i worked with map. But now the ActionHelper never works. I really don't know how to proceed, what am I doing wrong?", "url": "https://github.com/JabRef/jabref/pull/6151#discussion_r399709849", "createdAt": "2020-03-28T21:09:11Z", "author": {"login": "calixtus"}, "path": "src/main/java/org/jabref/gui/actions/ActionHelper.java", "diffHunk": "@@ -36,4 +40,18 @@ public static BooleanExpression isAnyFieldSetForSelectedEntry(List<Field> fields\n                 entry.getFieldsObservable(),\n                 stateManager.getSelectedEntries());\n     }\n+\n+    public static BooleanExpression isFilePresentForSelectedEntry(StateManager stateManager, PreferencesService preferencesService) {\n+        List<LinkedFile> files = stateManager.getSelectedEntries().get(0).getFiles();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MTMwMA=="}, "originalCommit": {"oid": "d16ded3b7142f8c33d5fdc105c338602b9349928"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcyMzkyNQ==", "bodyText": "Sorry, it wasn't in EasyBind but here: \n  \n    \n      jabref/src/main/java/org/jabref/gui/util/BindingsHelper.java\n    \n    \n         Line 68\n      in\n      093a6fb\n    \n    \n    \n    \n\n        \n          \n           public static <T, U> ObservableList<U> map(ObservableValue<T> source, Function<T, List<U>> mapper) { \n        \n    \n  \n\n\nthus BindingsHelper.map(getFieldBinding(FILES), string -> parseFiles()) should work. If not I'll have a closer look at it tomorrow.", "url": "https://github.com/JabRef/jabref/pull/6151#discussion_r399723925", "createdAt": "2020-03-28T23:53:11Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/actions/ActionHelper.java", "diffHunk": "@@ -36,4 +40,18 @@ public static BooleanExpression isAnyFieldSetForSelectedEntry(List<Field> fields\n                 entry.getFieldsObservable(),\n                 stateManager.getSelectedEntries());\n     }\n+\n+    public static BooleanExpression isFilePresentForSelectedEntry(StateManager stateManager, PreferencesService preferencesService) {\n+        List<LinkedFile> files = stateManager.getSelectedEntries().get(0).getFiles();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MTMwMA=="}, "originalCommit": {"oid": "d16ded3b7142f8c33d5fdc105c338602b9349928"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU3NjczNw==", "bodyText": "We always think way too complicated.\nI just moved the call to getFiles() into the calculation part and added stateManager.getSelectedEntries as an additional dependency, so the list is always recalculated if the currently selected entry changes.\nI have tested it and it works.", "url": "https://github.com/JabRef/jabref/pull/6151#discussion_r407576737", "createdAt": "2020-04-13T16:38:55Z", "author": {"login": "calixtus"}, "path": "src/main/java/org/jabref/gui/actions/ActionHelper.java", "diffHunk": "@@ -36,4 +40,18 @@ public static BooleanExpression isAnyFieldSetForSelectedEntry(List<Field> fields\n                 entry.getFieldsObservable(),\n                 stateManager.getSelectedEntries());\n     }\n+\n+    public static BooleanExpression isFilePresentForSelectedEntry(StateManager stateManager, PreferencesService preferencesService) {\n+        List<LinkedFile> files = stateManager.getSelectedEntries().get(0).getFiles();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MTMwMA=="}, "originalCommit": {"oid": "d16ded3b7142f8c33d5fdc105c338602b9349928"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3ODAyODAwOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/fieldeditors/LinkedFileViewModel.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNTowMDo0M1rOF9KBmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQyMToxMzoyOFrOF9MYCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MTcwNA==", "bodyText": "The old code also opens websites, which leads to problems with this new code. I think a isLink check at the appropiate place suffices.", "url": "https://github.com/JabRef/jabref/pull/6151#discussion_r399671704", "createdAt": "2020-03-28T15:00:43Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/fieldeditors/LinkedFileViewModel.java", "diffHunk": "@@ -161,8 +176,18 @@ public void acceptAsLinked() {\n \n     public void open() {\n         try {\n+            Optional<Path> resolvedPath = FileHelper.expandFilename(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d16ded3b7142f8c33d5fdc105c338602b9349928"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcxMDIxOQ==", "bodyText": "see below", "url": "https://github.com/JabRef/jabref/pull/6151#discussion_r399710219", "createdAt": "2020-03-28T21:13:28Z", "author": {"login": "calixtus"}, "path": "src/main/java/org/jabref/gui/fieldeditors/LinkedFileViewModel.java", "diffHunk": "@@ -161,8 +176,18 @@ public void acceptAsLinked() {\n \n     public void open() {\n         try {\n+            Optional<Path> resolvedPath = FileHelper.expandFilename(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MTcwNA=="}, "originalCommit": {"oid": "d16ded3b7142f8c33d5fdc105c338602b9349928"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3ODAyOTEyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/fieldeditors/LinkedFileViewModel.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNTowMjoxNFrOF9KCIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQyMzo1NDo1NVrOF9NOLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MTg0MA==", "bodyText": "What happens if a website url is linked?", "url": "https://github.com/JabRef/jabref/pull/6151#discussion_r399671840", "createdAt": "2020-03-28T15:02:14Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/fieldeditors/LinkedFileViewModel.java", "diffHunk": "@@ -87,6 +94,14 @@ public LinkedFileViewModel(LinkedFile linkedFile,\n         this.externalFileTypes = externalFileTypes;\n         this.xmpPreferences = xmpPreferences;\n \n+        fileExistsValidator = new FunctionBasedValidator<>(\n+                linkedFile.linkProperty(),\n+                link -> {\n+                    Optional<Path> path = FileHelper.expandFilename(databaseContext, link, filePreferences);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d16ded3b7142f8c33d5fdc105c338602b9349928"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY4MzI2OQ==", "bodyText": "If a website url is linked in StandardField.FILE, it simply displays an error dialog.\nBut I'm not entierly sure about the intended behaviour of this.\nCan there be an external file be linked in the file field or only in the StandardField.URL?\nIf you click on addFromUrl a dialog is opened asking for an url, if fetchFulltext is clicked, JabRef will try to find a PDF by DOI and other linked identifiers.", "url": "https://github.com/JabRef/jabref/pull/6151#discussion_r399683269", "createdAt": "2020-03-28T16:47:48Z", "author": {"login": "calixtus"}, "path": "src/main/java/org/jabref/gui/fieldeditors/LinkedFileViewModel.java", "diffHunk": "@@ -87,6 +94,14 @@ public LinkedFileViewModel(LinkedFile linkedFile,\n         this.externalFileTypes = externalFileTypes;\n         this.xmpPreferences = xmpPreferences;\n \n+        fileExistsValidator = new FunctionBasedValidator<>(\n+                linkedFile.linkProperty(),\n+                link -> {\n+                    Optional<Path> path = FileHelper.expandFilename(databaseContext, link, filePreferences);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MTg0MA=="}, "originalCommit": {"oid": "d16ded3b7142f8c33d5fdc105c338602b9349928"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcyNDA3Ng==", "bodyText": "Yes, it is also possible to link url's. Some fetcher return the link to the PDF which then can be downloaded by the user (right click > download). Also some users add links to their notes in this way (for example onenote url's).", "url": "https://github.com/JabRef/jabref/pull/6151#discussion_r399724076", "createdAt": "2020-03-28T23:54:55Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/fieldeditors/LinkedFileViewModel.java", "diffHunk": "@@ -87,6 +94,14 @@ public LinkedFileViewModel(LinkedFile linkedFile,\n         this.externalFileTypes = externalFileTypes;\n         this.xmpPreferences = xmpPreferences;\n \n+        fileExistsValidator = new FunctionBasedValidator<>(\n+                linkedFile.linkProperty(),\n+                link -> {\n+                    Optional<Path> path = FileHelper.expandFilename(databaseContext, link, filePreferences);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MTg0MA=="}, "originalCommit": {"oid": "d16ded3b7142f8c33d5fdc105c338602b9349928"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3ODAzMTUzOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/util/ViewModelListCellFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNTowNDozMVrOF9KDQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNTowNDozMVrOF9KDQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MjEzMA==", "bodyText": "I think adding a pseudo-class invalid instead of the style is more flexible in the long term (as it is a clearer separation between ui and ui-logic)", "url": "https://github.com/JabRef/jabref/pull/6151#discussion_r399672130", "createdAt": "2020-03-28T15:04:31Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/util/ViewModelListCellFactory.java", "diffHunk": "@@ -203,6 +215,9 @@ protected void updateItem(T item, boolean empty) {\n                         Subscription subscription = BindingsHelper.includePseudoClassWhen(this, pseudoClassWithCondition.getKey(), condition);\n                         subscriptions.add(subscription);\n                     }\n+                    if ((validationStatusProperty != null) && validationStatusProperty.call(viewModel).getHighestMessage().isPresent()) {\n+                        setStyle(\"-fx-background-color: -jr-warn\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d16ded3b7142f8c33d5fdc105c338602b9349928"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3ODAzMjE4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/util/ViewModelListCellFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNTowNToyNVrOF9KDmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNTowNToyNVrOF9KDmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MjIxNg==", "bodyText": "The validation message should also be displayed if toTooltip is null, right?", "url": "https://github.com/JabRef/jabref/pull/6151#discussion_r399672216", "createdAt": "2020-03-28T15:05:25Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/util/ViewModelListCellFactory.java", "diffHunk": "@@ -178,7 +185,12 @@ protected void updateItem(T item, boolean empty) {\n                         getStyleClass().setAll(toStyleClass.call(viewModel));\n                     }\n                     if (toTooltip != null) {\n-                        setTooltip(toTooltip.call(viewModel));\n+                        Tooltip tooltip = toTooltip.call(viewModel);\n+                        if (validationStatusProperty != null) {\n+                            validationStatusProperty.call(viewModel).getHighestMessage().ifPresent(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d16ded3b7142f8c33d5fdc105c338602b9349928"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2017, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}