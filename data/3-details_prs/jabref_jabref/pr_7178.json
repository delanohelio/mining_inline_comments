{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM3MjU4NTE3", "number": 7178, "title": "Fix newly added entry not synced to db", "bodyText": "Fixes #7176\nShould also fix #6944\nNewly added entries have empty fields; don't update the field table to prevent SQL Exception\nFix shared entry not found by id\nuse left outer join for this\n\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-12-11T18:39:15Z", "url": "https://github.com/JabRef/jabref/pull/7178", "merged": true, "mergeCommit": {"oid": "f356f9e54a2d621163f5ee5ef56ed657b0fb99b4"}, "closed": true, "closedAt": "2020-12-14T19:17:25Z", "author": {"login": "Siedlerchr"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdlMZTgAH2gAyNTM3MjU4NTE3OmM4ODNlOGRhODBjYWY0NjU2MGEzNDI1NGViNzUzYmJiOWJjMDMzMTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmKuwsgH2gAyNTM3MjU4NTE3OjNjMzM1ODQwNmIxNGZlZmNhY2IxZDY3YmNkZDQ4YWUyNjRjZWI1NDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c883e8da80caf46560a34254eb753bbb9bc03310", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/c883e8da80caf46560a34254eb753bbb9bc03310", "committedDate": "2020-12-11T18:38:56Z", "message": "Fix newly added entry not synced to db\n\n\nNewly added entries have empty fields; don't update the field table to prevent SQL Exception\nFix shared entry not found by id\nuse left outer join for this"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7317104c3f7a94890b33bdc720fff8ef722b66e3", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/7317104c3f7a94890b33bdc720fff8ef722b66e3", "committedDate": "2020-12-11T18:45:50Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae37d4bf391295f07319b5dd84ca8071717b9062", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/ae37d4bf391295f07319b5dd84ca8071717b9062", "committedDate": "2020-12-11T18:46:41Z", "message": "fix wording"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6d01b355cf919ac1c75339ae743a4d71be80747", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/c6d01b355cf919ac1c75339ae743a4d71be80747", "committedDate": "2020-12-13T13:36:06Z", "message": "Merge remote-tracking branch 'upstream/master' into sharedDbInsert\n\n* upstream/master:\n  Disable SLR in UI until #7126 is merged (#7179)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "503670a7193e0835ed9318fff53cbc252aa7661f", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/503670a7193e0835ed9318fff53cbc252aa7661f", "committedDate": "2020-12-13T13:37:12Z", "message": "add tests for fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwOTY1NjY5", "url": "https://github.com/JabRef/jabref/pull/7178#pullrequestreview-550965669", "createdAt": "2020-12-13T22:07:38Z", "commit": {"oid": "503670a7193e0835ed9318fff53cbc252aa7661f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xM1QyMjowNzozOFrOIE6DVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xM1QyMjowODo0MFrOIE6D_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAxNjM0MA==", "bodyText": "Isn't this always an empty list (as expected entry is empty)?", "url": "https://github.com/JabRef/jabref/pull/7178#discussion_r542016340", "createdAt": "2020-12-13T22:07:38Z", "author": {"login": "tobiasdiez"}, "path": "src/test/java/org/jabref/logic/shared/DBMSProcessorTest.java", "diffHunk": "@@ -95,6 +95,37 @@ void testInsertEntry() throws SQLException {\n         assertEquals(expectedFieldMap, actualFieldMap);\n     }\n \n+    @Test\n+    void testInsertEntryWithEmptyFields() throws SQLException {\n+        BibEntry expectedEntry = new BibEntry(StandardEntryType.Article);\n+\n+        dbmsProcessor.insertEntry(expectedEntry);\n+\n+        BibEntry emptyEntry = getBibEntryExample();\n+        emptyEntry.getSharedBibEntryData().setSharedID(1);\n+        dbmsProcessor.insertEntry(emptyEntry); // does not insert, due to same sharedID.\n+\n+        Map<String, String> actualFieldMap = new HashMap<>();\n+\n+        try (ResultSet entryResultSet = selectFrom(\"ENTRY\", dbmsConnection, dbmsProcessor)) {\n+            assertTrue(entryResultSet.next());\n+            assertEquals(1, entryResultSet.getInt(\"SHARED_ID\"));\n+            assertEquals(\"article\", entryResultSet.getString(\"TYPE\"));\n+            assertEquals(1, entryResultSet.getInt(\"VERSION\"));\n+            assertFalse(entryResultSet.next());\n+\n+            try (ResultSet fieldResultSet = selectFrom(\"FIELD\", dbmsConnection, dbmsProcessor)) {\n+                while (fieldResultSet.next()) {\n+                    actualFieldMap.put(fieldResultSet.getString(\"NAME\"), fieldResultSet.getString(\"VALUE\"));\n+                }\n+            }\n+        }\n+\n+        Map<String, String> expectedFieldMap = expectedEntry.getFieldMap().entrySet().stream().collect(Collectors.toMap((entry) -> entry.getKey().getName(), Map.Entry::getValue));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "503670a7193e0835ed9318fff53cbc252aa7661f"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAxNjUwOA==", "bodyText": "why is this then necessary?", "url": "https://github.com/JabRef/jabref/pull/7178#discussion_r542016508", "createdAt": "2020-12-13T22:08:40Z", "author": {"login": "tobiasdiez"}, "path": "src/test/java/org/jabref/logic/shared/DBMSProcessorTest.java", "diffHunk": "@@ -95,6 +95,37 @@ void testInsertEntry() throws SQLException {\n         assertEquals(expectedFieldMap, actualFieldMap);\n     }\n \n+    @Test\n+    void testInsertEntryWithEmptyFields() throws SQLException {\n+        BibEntry expectedEntry = new BibEntry(StandardEntryType.Article);\n+\n+        dbmsProcessor.insertEntry(expectedEntry);\n+\n+        BibEntry emptyEntry = getBibEntryExample();\n+        emptyEntry.getSharedBibEntryData().setSharedID(1);\n+        dbmsProcessor.insertEntry(emptyEntry); // does not insert, due to same sharedID.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "503670a7193e0835ed9318fff53cbc252aa7661f"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33f11a64c8aaf5248a334c9a61d4df49a92cf4e0", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/33f11a64c8aaf5248a334c9a61d4df49a92cf4e0", "committedDate": "2020-12-14T18:23:21Z", "message": "adjust test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODEzMDAx", "url": "https://github.com/JabRef/jabref/pull/7178#pullrequestreview-551813001", "createdAt": "2020-12-14T19:14:53Z", "commit": {"oid": "33f11a64c8aaf5248a334c9a61d4df49a92cf4e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxOToxNDo1M1rOIFhwkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxOToxNDo1M1rOIFhwkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY2Njg5OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                         .append(\" left outer join \")\n          \n          \n            \n                         // Handle special case if entry does not have any fields (yet)\n          \n          \n            \n                         .append(\" left outer join \")", "url": "https://github.com/JabRef/jabref/pull/7178#discussion_r542666898", "createdAt": "2020-12-14T19:14:53Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/logic/shared/DBMSProcessor.java", "diffHunk": "@@ -493,7 +499,7 @@ public void removeEntries(List<BibEntry> bibEntries) {\n              .append(\"F.\").append(escape(\"VALUE\"))\n              .append(\" FROM \")\n              .append(escape(\"ENTRY\"))\n-             .append(\" inner join \")\n+             .append(\" left outer join \")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33f11a64c8aaf5248a334c9a61d4df49a92cf4e0"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c3358406b14fefcacb1d67bcdd48ae264ceb541", "author": {"user": {"login": "koppor", "name": "Oliver Kopp"}}, "url": "https://github.com/JabRef/jabref/commit/3c3358406b14fefcacb1d67bcdd48ae264ceb541", "committedDate": "2020-12-14T19:16:29Z", "message": "Update src/main/java/org/jabref/logic/shared/DBMSProcessor.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4899, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}