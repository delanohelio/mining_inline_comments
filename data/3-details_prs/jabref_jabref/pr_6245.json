{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5MTU4MDMy", "number": 6245, "title": "Refactor EntryEditorPreferences", "bodyText": "This PR is a follow up to #6171\nIt aims to extract all the calls to JabRefPreferences::get or ::put in relation to EntryEditorPreferences and to use EntryEditorPreferences instead.\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for bigger UI changes)\n Checked documentation: Is the information available and up to date? If not: Issue created at https://github.com/JabRef/user-documentation/issues.", "createdAt": "2020-04-05T16:32:09Z", "url": "https://github.com/JabRef/jabref/pull/6245", "merged": true, "mergeCommit": {"oid": "a10e06b7e74302db8f6a31b7603eb9621f92baca"}, "closed": true, "closedAt": "2020-04-24T16:57:27Z", "author": {"login": "calixtus"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUslm0AH2gAyMzk5MTU4MDMyOjY5Y2E1NGY1MjI4MDRmNjExOGE5YjExYjFlZjU2Zjg2MzE4ZGMzMmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZcU-7gH2gAyMzk5MTU4MDMyOmQ3YjE4YzMwMmNkNWU0MzAwZGM5YzE0NWM5ZmMwYjUzYzcxZjgzZTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "69ca54f522804f6118a9b11b1ef56f86318dc32a", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/69ca54f522804f6118a9b11b1ef56f86318dc32a", "committedDate": "2020-04-05T16:21:28Z", "message": "Refactored JabRefPreferences, concentrated EntryEditorPreferences and extracted store logic out of dialog CustomizeGeneralFieldsDialogViewModel."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f93fc243eb5c7721c7d16667aea72daac8295aa5", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/f93fc243eb5c7721c7d16667aea72daac8295aa5", "committedDate": "2020-04-05T16:25:25Z", "message": "Merge remote-tracking branch 'upstream/master' into refactor_entryeditorprefs\n\n# Conflicts:\n#\tsrc/main/java/org/jabref/preferences/JabRefPreferences.java\n#\tsrc/main/java/org/jabref/preferences/PreferencesService.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4ODMzMjI5", "url": "https://github.com/JabRef/jabref/pull/6245#pullrequestreview-388833229", "createdAt": "2020-04-07T06:59:44Z", "commit": {"oid": "f93fc243eb5c7721c7d16667aea72daac8295aa5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwNjo1OTo0NFrOGB1f1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwNjo1OTo0NFrOGB1f1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3ODI2Mg==", "bodyText": "This is probably a huge thing, but what about replacing this many boolean parameters with an enum?", "url": "https://github.com/JabRef/jabref/pull/6245#discussion_r404578262", "createdAt": "2020-04-07T06:59:44Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/gui/entryeditor/EntryEditorPreferences.java", "diffHunk": "@@ -24,7 +24,17 @@\n     private boolean avoidOverwritingCiteKey;\n     private final boolean shouldShowLatexCitationsTab;\n \n-    public EntryEditorPreferences(Map<String, Set<Field>> entryEditorTabList, FieldWriterPreferences fieldWriterPreferences, ImportFormatPreferences importFormatPreferences, List<Field> customTabFieldNames, boolean shouldShowRecommendationsTab, boolean isMrdlibAccepted, boolean shouldShowLatexCitationsTab, boolean showSourceTabByDefault, BibtexKeyPatternPreferences bibtexKeyPatternPreferences, KeyBindingRepository keyBindings, boolean avoidOverwritingCiteKey) {\n+    public EntryEditorPreferences(Map<String, Set<Field>> entryEditorTabList,\n+                                  FieldWriterPreferences fieldWriterPreferences,\n+                                  ImportFormatPreferences importFormatPreferences,\n+                                  List<Field> customTabFieldNames,\n+                                  boolean shouldShowRecommendationsTab,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f93fc243eb5c7721c7d16667aea72daac8295aa5"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d74b272660933fa1d7f67e15501047137f859ae9", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/d74b272660933fa1d7f67e15501047137f859ae9", "committedDate": "2020-04-08T21:55:55Z", "message": "Extracted calls to JabRefPreferences::get and put out of EntryEditorTabViewModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6af3ddd12ae0b66b121473ae47ededfd4c3921ca", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/6af3ddd12ae0b66b121473ae47ededfd4c3921ca", "committedDate": "2020-04-08T22:07:24Z", "message": "Fixed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d0a90af6e623bd02f0ffee5306a79e90838aebf", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/6d0a90af6e623bd02f0ffee5306a79e90838aebf", "committedDate": "2020-04-10T19:16:58Z", "message": "Refactored AutoCompletePreferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "059d208d1b965dc5c92367b6f6f2cf3191ff0bcd", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/059d208d1b965dc5c92367b6f6f2cf3191ff0bcd", "committedDate": "2020-04-11T10:16:10Z", "message": "Merge remote-tracking branch 'upstream/master' into refactor_entryeditorprefs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b85e8add74a3be68e2704a221eb4be4be3508e8c", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/b85e8add74a3be68e2704a221eb4be4be3508e8c", "committedDate": "2020-04-14T11:57:42Z", "message": "Merge remote-tracking branch 'upstream/master' into refactor_entryeditorprefs\n\n# Conflicts:\n#\tsrc/main/java/org/jabref/gui/customizefields/CustomizeGeneralFieldsDialogViewModel.java\n#\tsrc/main/java/org/jabref/gui/preferences/EntryEditorTabViewModel.java\n#\tsrc/main/java/org/jabref/preferences/JabRefPreferences.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "647a781d25048dbc26308c075cb04c20f58f02c7", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/647a781d25048dbc26308c075cb04c20f58f02c7", "committedDate": "2020-04-17T16:19:14Z", "message": "Checkstyle and missing comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NTkyMTU3", "url": "https://github.com/JabRef/jabref/pull/6245#pullrequestreview-395592157", "createdAt": "2020-04-17T16:16:46Z", "commit": {"oid": "b85e8add74a3be68e2704a221eb4be4be3508e8c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNjoxNjo0NlrOGHUb6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNjoyNzowOVrOGHUzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMyODA0Mw==", "bodyText": "the prefix only doesn't really makes sense, right? Moreover, the enum name should be capitalized.", "url": "https://github.com/JabRef/jabref/pull/6245#discussion_r410328043", "createdAt": "2020-04-17T16:16:46Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/autocompleter/AutoCompletePreferences.java", "diffHunk": "@@ -8,26 +8,24 @@\n \n public class AutoCompletePreferences {\n \n+    public enum onlyCompleteNameFormat {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b85e8add74a3be68e2704a221eb4be4be3508e8c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMyODk2MQ==", "bodyText": "This field doesn't seem to be used", "url": "https://github.com/JabRef/jabref/pull/6245#discussion_r410328961", "createdAt": "2020-04-17T16:18:21Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/bibtexkeypattern/GenerateBibtexKeySingleAction.java", "diffHunk": "@@ -4,37 +4,39 @@\n \n import org.jabref.gui.DialogService;\n import org.jabref.gui.actions.SimpleCommand;\n-import org.jabref.gui.entryeditor.EntryEditorPreferences;\n import org.jabref.gui.undo.UndoableKeyChange;\n import org.jabref.logic.bibtexkeypattern.BibtexKeyGenerator;\n+import org.jabref.logic.bibtexkeypattern.BibtexKeyPatternPreferences;\n import org.jabref.model.database.BibDatabaseContext;\n import org.jabref.model.entry.BibEntry;\n+import org.jabref.preferences.PreferencesService;\n \n public class GenerateBibtexKeySingleAction extends SimpleCommand {\n \n     private DialogService dialogService;\n     private BibDatabaseContext databaseContext;\n-    private EntryEditorPreferences preferences;\n+    private PreferencesService preferencesService;\n+    private BibtexKeyPatternPreferences bibtexKeyPatternPreferences;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b85e8add74a3be68e2704a221eb4be4be3508e8c"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMzMDI4OA==", "bodyText": "Shouldn't updateEntryEditorTabList be automatically called if storeEntryEditorTabList is called?", "url": "https://github.com/JabRef/jabref/pull/6245#discussion_r410330288", "createdAt": "2020-04-17T16:20:44Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/customizefields/CustomizeGeneralFieldsDialogViewModel.java", "diffHunk": "@@ -43,48 +46,36 @@ public StringProperty fieldsTextProperty() {\n     }\n \n     public void saveFields() {\n+        Map<String, Set<Field>> customTabsMap = new LinkedHashMap<>();\n         String[] lines = fieldsText.get().split(\"\\n\");\n-        int i = 0;\n-        for (; i < lines.length; i++) {\n-            String[] parts = lines[i].split(\":\");\n+\n+        for (String line : lines) {\n+            String[] parts = line.split(\":\");\n             if (parts.length != 2) {\n-                // Report error and exit.\n-                String field = Localization.lang(\"field\");\n-                String title = Localization.lang(\"Error\");\n-                String content = Localization.lang(\"Each line must be of the following form\") + \" '\" +\n-                                 Localization.lang(\"Tabname\") + ':' + field + \"1;\" + field + \"2;...;\" + field + \"N'\";\n-                dialogService.showInformationDialogAndWait(title, content);\n+                dialogService.showInformationDialogAndWait(\n+                        Localization.lang(\"Error\"),\n+                        Localization.lang(\"Each line must be of the following form: 'tab:field1;field2;...;fieldN'.\"));\n                 return;\n             }\n \n             String testString = BibtexKeyGenerator.cleanKey(parts[1], preferences.getEnforceLegalKeys());\n             if (!testString.equals(parts[1]) || (parts[1].indexOf('&') >= 0)) {\n-                String title = Localization.lang(\"Error\");\n-                String content = Localization.lang(\"Field names are not allowed to contain white space or the following \"\n-                                                   + \"characters\")\n-                                 + \": # { } ( ) ~ , ^ & - \\\" ' ` \u02b9 \\\\\";\n-                dialogService.showInformationDialogAndWait(title, content);\n+                dialogService.showInformationDialogAndWait(\n+                        Localization.lang(\"Error\"),\n+                        Localization.lang(\"Field names are not allowed to contain white spaces or certain characters (%0).\",\n+                                \"# { } ( ) ~ , ^ & - \\\" ' ` \u02b9 \\\\\"));\n                 return;\n             }\n-            preferences.setCustomTabsNameAndFields(parts[0], parts[1], i);\n \n+            customTabsMap.put(parts[0], FieldFactory.parseFieldList(parts[1]));\n         }\n-        preferences.purgeSeries(JabRefPreferences.CUSTOM_TAB_NAME, i);\n-        preferences.purgeSeries(JabRefPreferences.CUSTOM_TAB_FIELDS, i);\n+\n+        preferences.storeEntryEditorTabList(customTabsMap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "647a781d25048dbc26308c075cb04c20f58f02c7"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMzMTUwMg==", "bodyText": "In my opinion, the name preferences is also fine. That's probably a matter of taste...", "url": "https://github.com/JabRef/jabref/pull/6245#discussion_r410331502", "createdAt": "2020-04-17T16:22:55Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/fieldeditors/BibtexKeyEditorViewModel.java", "diffHunk": "@@ -5,28 +5,28 @@\n import org.jabref.gui.DialogService;\n import org.jabref.gui.autocompleter.AutoCompleteSuggestionProvider;\n import org.jabref.gui.bibtexkeypattern.GenerateBibtexKeySingleAction;\n-import org.jabref.gui.entryeditor.EntryEditorPreferences;\n import org.jabref.logic.integrity.FieldCheckers;\n import org.jabref.model.database.BibDatabaseContext;\n import org.jabref.model.entry.field.Field;\n+import org.jabref.preferences.PreferencesService;\n \n import de.saxsys.mvvmfx.utils.commands.Command;\n \n public class BibtexKeyEditorViewModel extends AbstractEditorViewModel {\n-    private final EntryEditorPreferences preferences;\n+    private final PreferencesService preferencesService;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "647a781d25048dbc26308c075cb04c20f58f02c7"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMzMjE3Nw==", "bodyText": "Is this todo still relevant?", "url": "https://github.com/JabRef/jabref/pull/6245#discussion_r410332177", "createdAt": "2020-04-17T16:24:06Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/preferences/EntryEditorTabViewModel.java", "diffHunk": "@@ -33,37 +32,42 @@\n     private final BooleanProperty firstNameModeFullProperty = new SimpleBooleanProperty();\n     private final BooleanProperty firstNameModeBothProperty = new SimpleBooleanProperty();\n \n-    private AutoCompletePreferences autoCompletePreferences;\n-\n     private final DialogService dialogService;\n-    private final JabRefPreferences preferences;\n+    private final PreferencesService preferencesService;\n+    private final EntryEditorPreferences initialEntryEditorPreferences;\n+    private final AutoCompletePreferences initialAutoCompletePreferences;\n \n-    public EntryEditorTabViewModel(DialogService dialogService, JabRefPreferences preferences) {\n+    public EntryEditorTabViewModel(DialogService dialogService, PreferencesService preferencesService) {\n         this.dialogService = dialogService;\n-        this.preferences = preferences;\n-        this.autoCompletePreferences = preferences.getAutoCompletePreferences();\n+        this.preferencesService = preferencesService;\n+        this.initialEntryEditorPreferences = preferencesService.getEntryEditorPreferences();\n+        this.initialAutoCompletePreferences = preferencesService.getAutoCompletePreferences();\n     }\n \n     @Override\n     public void setValues() {\n-        openOnNewEntryProperty.setValue(preferences.getBoolean(JabRefPreferences.AUTO_OPEN_FORM));\n-        defaultSourceProperty.setValue(preferences.getBoolean(JabRefPreferences.DEFAULT_SHOW_SOURCE));\n-        enableRelatedArticlesTabProperty.setValue(preferences.getBoolean(JabRefPreferences.SHOW_RECOMMENDATIONS));\n-        acceptRecommendationsProperty.setValue(preferences.getBoolean(JabRefPreferences.ACCEPT_RECOMMENDATIONS));\n-        enableLatexCitationsTabProperty.setValue(preferences.getBoolean(JabRefPreferences.SHOW_LATEX_CITATIONS));\n-        enableValidationProperty.setValue(preferences.getBoolean(JabRefPreferences.VALIDATE_IN_ENTRY_EDITOR));\n-        enableAutoCompleteProperty.setValue(autoCompletePreferences.shouldAutoComplete());\n-        autoCompleteFieldsProperty.setValue(autoCompletePreferences.getCompleteNamesAsString());\n-\n-        if (autoCompletePreferences.getOnlyCompleteFirstLast()) {\n+        // ToDo: Include EntryEditorFieldsEditor in PreferencesDialog", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "647a781d25048dbc26308c075cb04c20f58f02c7"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMzNDAwNA==", "bodyText": "Can these constants JabRefPreferences.AUTO_OPEN_FORM etc now be made private?", "url": "https://github.com/JabRef/jabref/pull/6245#discussion_r410334004", "createdAt": "2020-04-17T16:27:09Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/preferences/EntryEditorTabViewModel.java", "diffHunk": "@@ -78,35 +82,37 @@ public void setValues() {\n \n     @Override\n     public void storeSettings() {\n-        preferences.putBoolean(JabRefPreferences.AUTO_OPEN_FORM, openOnNewEntryProperty.getValue());\n-        preferences.putBoolean(JabRefPreferences.DEFAULT_SHOW_SOURCE, defaultSourceProperty.getValue());\n-        preferences.putBoolean(JabRefPreferences.SHOW_RECOMMENDATIONS, enableRelatedArticlesTabProperty.getValue());\n-        preferences.putBoolean(JabRefPreferences.ACCEPT_RECOMMENDATIONS, acceptRecommendationsProperty.getValue());\n-        preferences.putBoolean(JabRefPreferences.SHOW_LATEX_CITATIONS, enableLatexCitationsTabProperty.getValue());\n-        preferences.putBoolean(JabRefPreferences.VALIDATE_IN_ENTRY_EDITOR, enableValidationProperty.getValue());\n-\n-        autoCompletePreferences.setShouldAutoComplete(enableAutoCompleteProperty.getValue());\n-        autoCompletePreferences.setCompleteNames(autoCompleteFieldsProperty.getValue());\n-        if (autoCompleteBothProperty.getValue()) {\n-            autoCompletePreferences.setOnlyCompleteFirstLast(false);\n-            autoCompletePreferences.setOnlyCompleteLastFirst(false);\n-        } else if (autoCompleteFirstLastProperty.getValue()) {\n-            autoCompletePreferences.setOnlyCompleteFirstLast(true);\n-            autoCompletePreferences.setOnlyCompleteLastFirst(false);\n-        } else {\n-            autoCompletePreferences.setOnlyCompleteFirstLast(false);\n-            autoCompletePreferences.setOnlyCompleteLastFirst(true);\n+        preferencesService.storeEntryEditorPreferences(new EntryEditorPreferences(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "647a781d25048dbc26308c075cb04c20f58f02c7"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36d675cba95c692a35508636ecc491cbedc1437a", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/36d675cba95c692a35508636ecc491cbedc1437a", "committedDate": "2020-04-17T17:24:11Z", "message": "Rewording and small refactorings regarding discussion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1Njc2NTc1", "url": "https://github.com/JabRef/jabref/pull/6245#pullrequestreview-395676575", "createdAt": "2020-04-17T18:21:07Z", "commit": {"oid": "36d675cba95c692a35508636ecc491cbedc1437a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7b18c302cd5e4300dc9c145c9fc0b53c71f83e7", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/d7b18c302cd5e4300dc9c145c9fc0b53c71f83e7", "committedDate": "2020-04-20T10:14:27Z", "message": "Merge remote-tracking branch 'upstream/master' into refactor_entryeditorprefs\n\n# Conflicts:\n#\tsrc/main/java/org/jabref/gui/fieldeditors/BibtexKeyEditorViewModel.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 313, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}