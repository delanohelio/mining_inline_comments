{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NDQ1MDkz", "number": 6805, "title": "Feature/add ui for query parsing", "bodyText": "This PR is a follow-up of #6799  and adds the related changes to the UI code.\nThe search bar will be highlighted green if the supported syntax is used, and red otherwise.\nUsing supported syntax:\n\nMissing quotation mark:\n\nUsing unsupported field:\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-08-28T14:39:44Z", "url": "https://github.com/JabRef/jabref/pull/6805", "merged": true, "mergeCommit": {"oid": "5d6c2ee1d47968745b75de9a44ec01880d0708bf"}, "closed": true, "closedAt": "2020-09-01T17:55:05Z", "author": {"login": "DominikVoigt"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdERdT4ABqjM3MDk1MTk3ODg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEpiYyAH2gAyNDc1NDQ1MDkzOjZmZDM5YzdjY2ZmZmE4ZDU1Nzk0YzMyNTZiYzMwOWJlNGE0MWJiNzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ebceab85c07c16ccc18a990169c15cf92c1b6cd4", "author": {"user": {"login": "DominikVoigt", "name": "Dominik Voigt"}}, "url": "https://github.com/JabRef/jabref/commit/ebceab85c07c16ccc18a990169c15cf92c1b6cd4", "committedDate": "2020-08-31T11:51:09Z", "message": "Merge remote-tracking branch 'upstream/master' into feature/add-ui-for-query-parsing"}, "afterCommit": {"oid": "e3075dc48bdc760ac27cdc1eb1862fdd73b868c4", "author": {"user": {"login": "DominikVoigt", "name": "Dominik Voigt"}}, "url": "https://github.com/JabRef/jabref/commit/e3075dc48bdc760ac27cdc1eb1862fdd73b868c4", "committedDate": "2020-08-31T11:53:05Z", "message": "Squash into one commit\n\nSigned-off-by: Dominik Voigt <dominik.ingo.voigt@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5MDE2MjI5", "url": "https://github.com/JabRef/jabref/pull/6805#pullrequestreview-479016229", "createdAt": "2020-08-31T22:37:24Z", "commit": {"oid": "0f8b79a0b039ea01722258c8c6be42ee253f256f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMjozNzoyNFrOHKLymQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMjozNzoyNFrOHKLymQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ0MDk4NQ==", "bodyText": "Pseudo-classes could be used instead of hardcoding the colors here. See gui/util/ViewModelListCellFactory", "url": "https://github.com/JabRef/jabref/pull/6805#discussion_r480440985", "createdAt": "2020-08-31T22:37:24Z", "author": {"login": "calixtus"}, "path": "src/main/java/org/jabref/gui/importer/fetcher/WebSearchPaneViewModel.java", "diffHunk": "@@ -91,13 +104,40 @@ public void search() {\n \n         SearchBasedFetcher activeFetcher = getSelectedFetcher();\n \n-        BackgroundTask<ParserResult> task = BackgroundTask.wrap(() -> new ParserResult(activeFetcher.performSearch(getQuery().trim())))\n-                                                          .withInitialMessage(Localization.lang(\"Processing %0\", getQuery()));\n-\n+        BackgroundTask<ParserResult> task;\n+        QueryParser queryParser = new QueryParser();\n+        Optional<ComplexSearchQuery> generatedQuery = queryParser.parseQueryStringIntoComplexQuery(getQuery());\n+        if (generatedQuery.isPresent()) {\n+            task = BackgroundTask.wrap(() -> new ParserResult(activeFetcher.performComplexSearch(generatedQuery.get())))\n+                                 .withInitialMessage(Localization.lang(\"Processing %0\", getQuery()));\n+        } else {\n+            task = BackgroundTask.wrap(() -> new ParserResult(activeFetcher.performSearch(getQuery().trim())))\n+                                 .withInitialMessage(Localization.lang(\"Processing %0\", getQuery()));\n+        }\n         task.onFailure(dialogService::showErrorDialogAndWait);\n \n         ImportEntriesDialog dialog = new ImportEntriesDialog(frame.getCurrentBasePanel().getBibDatabaseContext(), task);\n         dialog.setTitle(activeFetcher.getName());\n         dialog.showAndWait();\n     }\n+\n+    public void validateQueryStringAndGiveColorFeedback(TextField querySource, String queryString) {\n+        Matcher queryValidation = queryPattern.matcher(queryString.strip());\n+        if (queryValidation.matches()) {\n+            if (containsYearAndYearRange(queryString)) {\n+                querySource.setStyle(\"-fx-background-color: rgba(240, 128, 128, 0.5);\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f8b79a0b039ea01722258c8c6be42ee253f256f"}, "originalPosition": 78}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebcb7dc7adb59cd7357c73be05974745d7b0eca9", "author": {"user": {"login": "DominikVoigt", "name": "Dominik Voigt"}}, "url": "https://github.com/JabRef/jabref/commit/ebcb7dc7adb59cd7357c73be05974745d7b0eca9", "committedDate": "2020-09-01T10:39:40Z", "message": "Add query syntax validity feedback to UI\nMake QueryParser handle query parsing issues more robust\nMake default implementation of performComplexSearch include all fields\n\nSigned-off-by: Dominik Voigt <dominik.ingo.voigt@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be038397a0893690d41861569e5bf9deecb1694e", "author": {"user": {"login": "DominikVoigt", "name": "Dominik Voigt"}}, "url": "https://github.com/JabRef/jabref/commit/be038397a0893690d41861569e5bf9deecb1694e", "committedDate": "2020-09-01T10:32:25Z", "message": "Remove unwanted whitespace\n\nSigned-off-by: Dominik Voigt <dominik.ingo.voigt@gmail.com>"}, "afterCommit": {"oid": "ebcb7dc7adb59cd7357c73be05974745d7b0eca9", "author": {"user": {"login": "DominikVoigt", "name": "Dominik Voigt"}}, "url": "https://github.com/JabRef/jabref/commit/ebcb7dc7adb59cd7357c73be05974745d7b0eca9", "committedDate": "2020-09-01T10:39:40Z", "message": "Add query syntax validity feedback to UI\nMake QueryParser handle query parsing issues more robust\nMake default implementation of performComplexSearch include all fields\n\nSigned-off-by: Dominik Voigt <dominik.ingo.voigt@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fd39c7ccfffa8d55794c3256bc309be4a41bb70", "author": {"user": {"login": "DominikVoigt", "name": "Dominik Voigt"}}, "url": "https://github.com/JabRef/jabref/commit/6fd39c7ccfffa8d55794c3256bc309be4a41bb70", "committedDate": "2020-09-01T15:56:36Z", "message": "Make UI use advanced formation\n\nSigned-off-by: Dominik Voigt <dominik.ingo.voigt@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 125, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}