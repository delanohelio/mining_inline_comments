{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1NDczNTk1", "number": 7025, "title": "add Cleanup for copying over physcial review article id as the page n\u2026", "bodyText": "Fixes #7019\nAdded a cleanup to copy over the article id as the page number for APS journals. This only happens if the page number doesn't exist already.\n\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-10-18T13:36:00Z", "url": "https://github.com/JabRef/jabref/pull/7025", "merged": true, "mergeCommit": {"oid": "a7b05d0755334caa9d8480a5e4aefdf6759b1895"}, "closed": true, "closedAt": "2020-10-20T10:55:03Z", "author": {"login": "tmrd993"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTvmNQAH2gAyNTA1NDczNTk1OmM5YjUyODQzNmQyMTJkMzIyM2Y4ZGJlYTI0OGEzNjA1OThiMTExYjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUWMbAAH2gAyNTA1NDczNTk1OmExZmRmM2U5ZDk5ZTgxZWY0YzQwNWQ0NDExODc1NDc1ZDIzMzJkN2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c9b528436d212d3223f8dbea248a360598b111b6", "author": {"user": {"login": "tmrd993", "name": "Timucin Merdin"}}, "url": "https://github.com/JabRef/jabref/commit/c9b528436d212d3223f8dbea248a360598b111b6", "committedDate": "2020-10-18T13:29:04Z", "message": "add Cleanup for copying over physcial review article id as the page number"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTQ5Nzk4", "url": "https://github.com/JabRef/jabref/pull/7025#pullrequestreview-511149798", "createdAt": "2020-10-18T14:25:34Z", "commit": {"oid": "c9b528436d212d3223f8dbea248a360598b111b6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNDoyNTozNFrOHjrJsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNDoyNzoyM1rOHjrK0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE2OTIwMA==", "bodyText": "Since this is only used for the DOI fetcher, I would suggest to add this functionality as a private class method in DoiFetcher instead of a new class.", "url": "https://github.com/JabRef/jabref/pull/7025#discussion_r507169200", "createdAt": "2020-10-18T14:25:34Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/cleanup/PageFieldCleanup.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.jabref.logic.cleanup;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.jabref.model.FieldChange;\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+/**\n+ * adds the article ID of a journal as the page count, but only if the page field is empty\n+ */\n+public class PageFieldCleanup implements CleanupJob {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9b528436d212d3223f8dbea248a360598b111b6"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE2OTQ5MA==", "bodyText": "Since this issue only concerns articles from Physical Review, I would suggest to use a regex based on the format outlined in #7019 (comment). In particular, make sure it only applies to doi's to Physical Review, and not all dois ending on some number.", "url": "https://github.com/JabRef/jabref/pull/7025#discussion_r507169490", "createdAt": "2020-10-18T14:27:23Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/cleanup/PageFieldCleanup.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.jabref.logic.cleanup;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.jabref.model.FieldChange;\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+/**\n+ * adds the article ID of a journal as the page count, but only if the page field is empty\n+ */\n+public class PageFieldCleanup implements CleanupJob {\n+\n+    @Override\n+    public List<FieldChange> cleanup(BibEntry entry) {\n+        List<FieldChange> changes = new ArrayList<>();\n+        Optional<String> doiAsString = entry.getField(StandardField.DOI);\n+\n+        if (doiAsString.isPresent() && !entry.hasField(StandardField.PAGES)) {\n+            String articleId = new String();\n+            int index = doiAsString.get().length() - 1;\n+            while (Character.isDigit(doiAsString.get().charAt(index))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9b528436d212d3223f8dbea248a360598b111b6"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTQ5NTU1", "url": "https://github.com/JabRef/jabref/pull/7025#pullrequestreview-511149555", "createdAt": "2020-10-18T14:22:53Z", "commit": {"oid": "c9b528436d212d3223f8dbea248a360598b111b6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNDoyMjo1M1rOHjrFag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNDozMTo0NVrOHjrNDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE2ODEwNg==", "bodyText": "I would simply use a substring with lastIndexOf(.) to the the part after the last dot.\nhttps://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/lang/String.html#lastIndexOf(java.lang.String)", "url": "https://github.com/JabRef/jabref/pull/7025#discussion_r507168106", "createdAt": "2020-10-18T14:22:53Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/logic/cleanup/PageFieldCleanup.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.jabref.logic.cleanup;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.jabref.model.FieldChange;\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+/**\n+ * adds the article ID of a journal as the page count, but only if the page field is empty\n+ */\n+public class PageFieldCleanup implements CleanupJob {\n+\n+    @Override\n+    public List<FieldChange> cleanup(BibEntry entry) {\n+        List<FieldChange> changes = new ArrayList<>();\n+        Optional<String> doiAsString = entry.getField(StandardField.DOI);\n+\n+        if (doiAsString.isPresent() && !entry.hasField(StandardField.PAGES)) {\n+            String articleId = new String();\n+            int index = doiAsString.get().length() - 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9b528436d212d3223f8dbea248a360598b111b6"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE3MDA2Mw==", "bodyText": "This is not a good idea to put it here, because it would be called for every type of DOI, and the APS are only a very specific subset.\nI would suggest adding it as a CleanupPreset Step:\nhttps://github.com/JabRef/jabref/blob/1b35f8cb0040fdfb515974e78532598f07e11af2/src/main/java/org/jabref/logic/cleanup/CleanupPreset.java\nand also adding it to the Cleanup Dialog maybe as Move article id to pages? (APS).", "url": "https://github.com/JabRef/jabref/pull/7025#discussion_r507170063", "createdAt": "2020-10-18T14:31:45Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/logic/importer/fetcher/DoiFetcher.java", "diffHunk": "@@ -89,6 +90,7 @@ public String getName() {\n     }\n \n     private void doPostCleanup(BibEntry entry) {\n+        new PageFieldCleanup().cleanup(entry);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9b528436d212d3223f8dbea248a360598b111b6"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3856f25edd2d53f3b10fdaeeee4e926b6279f135", "author": {"user": {"login": "tmrd993", "name": "Timucin Merdin"}}, "url": "https://github.com/JabRef/jabref/commit/3856f25edd2d53f3b10fdaeeee4e926b6279f135", "committedDate": "2020-10-19T08:27:45Z", "message": "remove PageFieldCleanup, add private methods to DoiFetcher"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "342cacbcad2c6f9a425e1b9accce0fa6485ce0e3", "author": {"user": {"login": "tmrd993", "name": "Timucin Merdin"}}, "url": "https://github.com/JabRef/jabref/commit/342cacbcad2c6f9a425e1b9accce0fa6485ce0e3", "committedDate": "2020-10-19T08:30:19Z", "message": "remove comment from DoiFetcherTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNTc3MzA3", "url": "https://github.com/JabRef/jabref/pull/7025#pullrequestreview-511577307", "createdAt": "2020-10-19T09:31:43Z", "commit": {"oid": "342cacbcad2c6f9a425e1b9accce0fa6485ce0e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOTozMTo0M1rOHkFwZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwOTozMTo0M1rOHkFwZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYwNTA5NA==", "bodyText": "I am thinking if it would make sense to check for the strig \"phys\" as well?\nIt's better to etract the Pattern to a static string, otherwise you won't get the advantages", "url": "https://github.com/JabRef/jabref/pull/7025#discussion_r507605094", "createdAt": "2020-10-19T09:31:43Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/logic/importer/fetcher/DoiFetcher.java", "diffHunk": "@@ -123,4 +133,18 @@ private void doPostCleanup(BibEntry entry) {\n \n         return agency;\n     }\n+\n+    private void setPageCountToArticleId(BibEntry entry, String doiAsString) {\n+        String articleId = doiAsString.substring(doiAsString.lastIndexOf('.') + 1);\n+        entry.setField(StandardField.PAGES, articleId);\n+    }\n+\n+    private boolean isAPSJournal(BibEntry entry, String doiAsString) {\n+        if (!entry.getType().equals(StandardEntryType.Article)) {\n+            return false;\n+        }\n+        Pattern apsJournalSuffixPattern = Pattern.compile(\"([\\\\w]+\\\\.)([\\\\w]+\\\\.)([\\\\w]+)\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "342cacbcad2c6f9a425e1b9accce0fa6485ce0e3"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e69989a44c5c15b1ac75a95d1cd585f786eb6a72", "author": {"user": {"login": "tmrd993", "name": "Timucin Merdin"}}, "url": "https://github.com/JabRef/jabref/commit/e69989a44c5c15b1ac75a95d1cd585f786eb6a72", "committedDate": "2020-10-19T14:02:49Z", "message": "replace regex with substring and string comparison"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1779e423bdff56193830f9d777ddf88c1cc5c760", "author": {"user": {"login": "tmrd993", "name": "Timucin Merdin"}}, "url": "https://github.com/JabRef/jabref/commit/1779e423bdff56193830f9d777ddf88c1cc5c760", "committedDate": "2020-10-19T14:10:14Z", "message": "fix checkstyle issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37042695c9688a96b7ec128942eaeef42a5f8171", "author": {"user": {"login": "tmrd993", "name": "Timucin Merdin"}}, "url": "https://github.com/JabRef/jabref/commit/37042695c9688a96b7ec128942eaeef42a5f8171", "committedDate": "2020-10-19T14:13:26Z", "message": "fix checkstyle issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1853df7c6f4a5ee7ebf4c01d4e436e045009a55e", "author": {"user": {"login": "tmrd993", "name": "Timucin Merdin"}}, "url": "https://github.com/JabRef/jabref/commit/1853df7c6f4a5ee7ebf4c01d4e436e045009a55e", "committedDate": "2020-10-20T09:04:30Z", "message": "add regex to check aps doi format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNDk2NjIw", "url": "https://github.com/JabRef/jabref/pull/7025#pullrequestreview-512496620", "createdAt": "2020-10-20T09:13:03Z", "commit": {"oid": "1853df7c6f4a5ee7ebf4c01d4e436e045009a55e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwOToxMzowM1rOHkyi-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQwOToxMzowM1rOHkyi-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODMzODkzNg==", "bodyText": "move that line one as well to  private static final then it's good !", "url": "https://github.com/JabRef/jabref/pull/7025#discussion_r508338936", "createdAt": "2020-10-20T09:13:03Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/logic/importer/fetcher/DoiFetcher.java", "diffHunk": "@@ -141,11 +143,14 @@ private void setPageCountToArticleId(BibEntry entry, String doiAsString) {\n         entry.setField(StandardField.PAGES, articleId);\n     }\n \n+    // checks if the entry is an APS journal by comparing the organization id and the suffix format\n     private boolean isAPSJournal(BibEntry entry, String doiAsString) {\n         if (!entry.getType().equals(StandardEntryType.Article)) {\n             return false;\n         }\n+        Pattern apsSuffixPattern = Pattern.compile(APS_SUFFIX);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1853df7c6f4a5ee7ebf4c01d4e436e045009a55e"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "983962f3c2fa72dcaa0543b7caddfdf45db5dfcf", "author": {"user": {"login": "tmrd993", "name": "Timucin Merdin"}}, "url": "https://github.com/JabRef/jabref/commit/983962f3c2fa72dcaa0543b7caddfdf45db5dfcf", "committedDate": "2020-10-20T09:42:02Z", "message": "move suffix pattern to private static field"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNTMxMjEz", "url": "https://github.com/JabRef/jabref/pull/7025#pullrequestreview-512531213", "createdAt": "2020-10-20T09:52:45Z", "commit": {"oid": "983962f3c2fa72dcaa0543b7caddfdf45db5dfcf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1fe707781c1e05282d06ca043a0bb61d9fa3367", "author": {"user": {"login": "tmrd993", "name": "Timucin Merdin"}}, "url": "https://github.com/JabRef/jabref/commit/a1fe707781c1e05282d06ca043a0bb61d9fa3367", "committedDate": "2020-10-20T10:13:38Z", "message": "add changelog entry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "593c86d4537bcd8f0a70197a02d3bbee47f5ab9c", "author": {"user": {"login": "tmrd993", "name": "Timucin Merdin"}}, "url": "https://github.com/JabRef/jabref/commit/593c86d4537bcd8f0a70197a02d3bbee47f5ab9c", "committedDate": "2020-10-20T10:15:19Z", "message": "add issue link to changelog entry"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1fdf3e9d99e81ef4c405d4411875475d2332d7e", "author": {"user": {"login": "tmrd993", "name": "Timucin Merdin"}}, "url": "https://github.com/JabRef/jabref/commit/a1fdf3e9d99e81ef4c405d4411875475d2332d7e", "committedDate": "2020-10-20T10:27:12Z", "message": "Merge branch 'master' into add-cleanup-for-replacing-page-number-with-article-id"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 59, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}