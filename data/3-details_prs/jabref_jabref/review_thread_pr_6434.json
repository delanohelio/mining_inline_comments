{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0Mzg5NDAw", "number": 6434, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMjoxMzozN1rOD6OF6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTowNzo0MlrOD8PMCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMzc0ODg4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMjoxMzozN1rOGR7pgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMzoxMjoyN1rOGSTa1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ1NjI1OQ==", "bodyText": "I think there should also be a check that the information in the date field coincides with the one in year & month. For example, if date = {2004-05} but year = {2005} the year field shouldn't be deleted.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r421456259", "createdAt": "2020-05-07T12:13:37Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,6 +39,12 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If field date is filled it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(newDate -> {\n+                entry.clearField(StandardField.YEAR).ifPresent(changes::add);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93de4bcdcd4f430fc2113f123be99c47879c0325"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTgxOTc1Mw==", "bodyText": "Is this really the job of this class? The code assures, that there is something in the date field. I don't think that the cleanup class has to check, if the conversion was done right...", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r421819753", "createdAt": "2020-05-07T22:00:03Z", "author": {"login": "calixtus"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,6 +39,12 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If field date is filled it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(newDate -> {\n+                entry.clearField(StandardField.YEAR).ifPresent(changes::add);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ1NjI1OQ=="}, "originalCommit": {"oid": "93de4bcdcd4f430fc2113f123be99c47879c0325"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg0NTcxOA==", "bodyText": "I agree with @tobiasdiez we should check if the date is equal to the year.\nIf it is a user error, there is no point in removing it and it is always an alert that made a mistake.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r421845718", "createdAt": "2020-05-07T23:12:27Z", "author": {"login": "catarinagomespt"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,6 +39,12 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If field date is filled it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(newDate -> {\n+                entry.clearField(StandardField.YEAR).ifPresent(changes::add);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ1NjI1OQ=="}, "originalCommit": {"oid": "93de4bcdcd4f430fc2113f123be99c47879c0325"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMzc1NDE5OnYy", "diffSide": "RIGHT", "path": "CHANGELOG.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMjoxNTowNVrOGR7sxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QyMjo0MDo1NFrOGSSxaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ1NzA5NA==", "bodyText": "maybe \"where year and month fields were not cleared\" ?", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r421457094", "createdAt": "2020-05-07T12:15:05Z", "author": {"login": "tobiasdiez"}, "path": "CHANGELOG.md", "diffHunk": "@@ -54,6 +54,7 @@ Note that this project **does not** adhere to [Semantic Versioning](http://semve\n - We fixed an issue where JabRef switched to discrete graphics under macOS [#5935](https://github.com/JabRef/jabref/issues/5935)\n - We fixed an issue where the Preferences entry preview will be unexpected modified leads to Value too long exception [#6198](https://github.com/JabRef/jabref/issues/6198)\n - We fixed an issue where custom jstyles for Open/LibreOffice would only be valid if a layout line for the entry type `default` was at the end of the layout section [#6303](https://github.com/JabRef/jabref/issues/6303)\n+- We fixed an issue where clear year and month field when converting to biblatex [#6224](https://github.com/JabRef/jabref/issues/6224)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93de4bcdcd4f430fc2113f123be99c47879c0325"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTgzNTExMw==", "bodyText": "Done.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r421835113", "createdAt": "2020-05-07T22:40:54Z", "author": {"login": "catarinagomespt"}, "path": "CHANGELOG.md", "diffHunk": "@@ -54,6 +54,7 @@ Note that this project **does not** adhere to [Semantic Versioning](http://semve\n - We fixed an issue where JabRef switched to discrete graphics under macOS [#5935](https://github.com/JabRef/jabref/issues/5935)\n - We fixed an issue where the Preferences entry preview will be unexpected modified leads to Value too long exception [#6198](https://github.com/JabRef/jabref/issues/6198)\n - We fixed an issue where custom jstyles for Open/LibreOffice would only be valid if a layout line for the entry type `default` was at the end of the layout section [#6303](https://github.com/JabRef/jabref/issues/6303)\n+- We fixed an issue where clear year and month field when converting to biblatex [#6224](https://github.com/JabRef/jabref/issues/6224)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ1NzA5NA=="}, "originalCommit": {"oid": "93de4bcdcd4f430fc2113f123be99c47879c0325"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyODQ0NTgxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNDo1MDo0M1rOGSoUJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNToyODoxMFrOGSpl1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE4ODA2OA==", "bodyText": "Can you give the variable year1 a more meaningful name? Sure, everybody understands that, but nevertheless, we try to write exemplary code in JabRef (I know, it's still a loooooong way to go).", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422188068", "createdAt": "2020-05-08T14:50:43Z", "author": {"login": "calixtus"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(yearl -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf164595b211df427825ed84ce7d6909daf33536"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwNzU5Mg==", "bodyText": "you're right, I forgot to change", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422207592", "createdAt": "2020-05-08T15:25:29Z", "author": {"login": "catarinagomespt"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(yearl -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE4ODA2OA=="}, "originalCommit": {"oid": "bf164595b211df427825ed84ce7d6909daf33536"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwODM2OQ==", "bodyText": "Done.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422208369", "createdAt": "2020-05-08T15:26:53Z", "author": {"login": "catarinagomespt"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(yearl -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE4ODA2OA=="}, "originalCommit": {"oid": "bf164595b211df427825ed84ce7d6909daf33536"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwODk4MQ==", "bodyText": "Done.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422208981", "createdAt": "2020-05-08T15:28:10Z", "author": {"login": "catarinagomespt"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(yearl -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE4ODA2OA=="}, "originalCommit": {"oid": "bf164595b211df427825ed84ce7d6909daf33536"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDY4OTI5OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanupTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNjo1NjoxNlrOGS8jfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOTo1ODowOFrOGUWtOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTY3OQ==", "bodyText": "This should be 2011-01 to include the month, right?", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422519679", "createdAt": "2020-05-09T16:56:16Z", "author": {"login": "tobiasdiez"}, "path": "src/test/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanupTest.java", "diffHunk": "@@ -46,6 +46,20 @@ public void cleanupWithDateAlreadyPresentDoesNothing() {\n         assertEquals(Optional.of(\"2012\"), entry.getField(StandardField.DATE));\n     }\n \n+    @Test\n+    public void cleanupWithDateAlreadyPresentAndEqualsToYearRemovesYearAndMonth() {\n+        BibEntry entry = new BibEntry();\n+        entry.setField(StandardField.YEAR, \"2011\");\n+        entry.setField(StandardField.MONTH, \"#jan#\");\n+        entry.setField(StandardField.DATE, \"2011\");\n+\n+        worker.cleanup(entry);\n+\n+        assertEquals(Optional.empty(), entry.getField(StandardField.YEAR));\n+        assertEquals(Optional.empty(), entry.getField(StandardField.MONTH));\n+        assertEquals(Optional.of(\"2011\"), entry.getField(StandardField.DATE));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk5NjczMQ==", "bodyText": "Done.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r423996731", "createdAt": "2020-05-12T19:58:08Z", "author": {"login": "catarinagomespt"}, "path": "src/test/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanupTest.java", "diffHunk": "@@ -46,6 +46,20 @@ public void cleanupWithDateAlreadyPresentDoesNothing() {\n         assertEquals(Optional.of(\"2012\"), entry.getField(StandardField.DATE));\n     }\n \n+    @Test\n+    public void cleanupWithDateAlreadyPresentAndEqualsToYearRemovesYearAndMonth() {\n+        BibEntry entry = new BibEntry();\n+        entry.setField(StandardField.YEAR, \"2011\");\n+        entry.setField(StandardField.MONTH, \"#jan#\");\n+        entry.setField(StandardField.DATE, \"2011\");\n+\n+        worker.cleanup(entry);\n+\n+        assertEquals(Optional.empty(), entry.getField(StandardField.YEAR));\n+        assertEquals(Optional.empty(), entry.getField(StandardField.MONTH));\n+        assertEquals(Optional.of(\"2011\"), entry.getField(StandardField.DATE));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTY3OQ=="}, "originalCommit": {"oid": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDY5MDc1OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "isResolved": true, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNjo1ODowMVrOGS8kMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMDo0Mjo0NFrOGS-Bhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ==", "bodyText": "Adding to @koppor's comment, we have a date class which you can use to parse the date in order to get the year AND the month.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422519859", "createdAt": "2020-05-09T16:58:01Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(checkYear -> {\n+                    // Get the year of the date field (4 digits).\n+                    if (date.substring(0, 4).equals(checkYear)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzMDM2Nw==", "bodyText": "@koppor @tobiasdiez\nPlease confirm that I understood correctly:\nAcceptance Criteria  1:\n\nIf the month + year fields are equal to the month + year in the date field, must clear the month and the year.\nStart:\ndate = \"2020-05\"\nmonth = \"05\"\nyear = \"2020\"\nResult:\ndate = \"2020-05\"\nmonth = \"\"\nyear = \"\"\n\nAcceptance Criteria 2:\n\nIf the month field is different from the month in the date field, does nothing\nStart:\ndate = \"2020-05\"\nmonth = \"04\"\nyear = \"2020\"\nResult:\ndate = \"2020-05\"\nmonth = \"04\"\nyear = \"2020\"\n\nAcceptance Criteria 3:\n\nIf the year field is different from the year in the date field, does nothing\nStart:\ndate = \"2020-05\"\nmonth = \"05\"\nyear = \"2019\"\nResult:\ndate = \"2020-05\"\nmonth = \"05\"\nyear = \"2019\"\n\nAcceptance Criteria 4:\n\nIf the date field has a blank/empty value, must set the date field with year and month values and clear the month + year fields.\nStart:\ndate = \"\"\nmonth = \"05\"\nyear = \"2020\"\nResult:\ndate = \"2020-05\"\nmonth = \"\"\nyear = \"\"\n\nThanks", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422530367", "createdAt": "2020-05-09T18:34:26Z", "author": {"login": "catarinagomespt"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(checkYear -> {\n+                    // Get the year of the date field (4 digits).\n+                    if (date.substring(0, 4).equals(checkYear)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, "originalCommit": {"oid": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzMDcxNg==", "bodyText": "@koppor @tobiasdiez\nAnother question:\nWhat should happen if we have the following situation?\ndate = \"2020\"\nmonth = \"04\"\nyear = \"2020\"\nResult: ???", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422530716", "createdAt": "2020-05-09T18:38:03Z", "author": {"login": "catarinagomespt"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(checkYear -> {\n+                    // Get the year of the date field (4 digits).\n+                    if (date.substring(0, 4).equals(checkYear)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, "originalCommit": {"oid": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzMTA2Mg==", "bodyText": "I think in scenario 2 + 3 the correct information (the month in 2, the year in 3) can be deleted leaving only differing information behind. Thanks for the detailed specification.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422531062", "createdAt": "2020-05-09T18:40:51Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(checkYear -> {\n+                    // Get the year of the date field (4 digits).\n+                    if (date.substring(0, 4).equals(checkYear)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, "originalCommit": {"oid": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzMjE5OQ==", "bodyText": "@tobiasdiez\nJust to make sure I got it right.\nStart:\ndate = \"2020-05\"\nmonth = \"04\"\nyear = \"2020\"\nResult:\ndate = \"2020-05\"\nmonth = \"04\"\nyear = \"\"\nPlease, confirms that the result is correct.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422532199", "createdAt": "2020-05-09T18:50:51Z", "author": {"login": "catarinagomespt"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(checkYear -> {\n+                    // Get the year of the date field (4 digits).\n+                    if (date.substring(0, 4).equals(checkYear)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, "originalCommit": {"oid": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzMjc4Nw==", "bodyText": "For inconsistent data: Don't overwrite/move. Keep as is", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422532787", "createdAt": "2020-05-09T18:56:02Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(checkYear -> {\n+                    // Get the year of the date field (4 digits).\n+                    if (date.substring(0, 4).equals(checkYear)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, "originalCommit": {"oid": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUzNzM3Mg==", "bodyText": "@tobiasdiez\n\nAdding to @koppor's comment, we have a date class which you can use to parse the date in order to get the year AND the month.\n\nWhat is the class name?", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422537372", "createdAt": "2020-05-09T19:39:35Z", "author": {"login": "catarinagomespt"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(checkYear -> {\n+                    // Get the year of the date field (4 digits).\n+                    if (date.substring(0, 4).equals(checkYear)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, "originalCommit": {"oid": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0Mzc1MQ==", "bodyText": "https://github.com/JabRef/jabref/blob/master/src/main/java/org/jabref/model/entry/Date.java", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r422543751", "createdAt": "2020-05-09T20:42:44Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +39,18 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If date field is filled and is equal to year it should be removed the year and month fields\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(checkYear -> {\n+                    // Get the year of the date field (4 digits).\n+                    if (date.substring(0, 4).equals(checkYear)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUxOTg1OQ=="}, "originalCommit": {"oid": "5b1c8529c7cbd5a35c0ac61be23884d3a5117883"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MzIyMDE2OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/model/entry/Date.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMzo1NDozNFrOGUyxxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMzowOTo0N1rOGVGniQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ1NjY0Ng==", "bodyText": "Could you please adjust the javadoc as well?", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424456646", "createdAt": "2020-05-13T13:54:34Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/model/entry/Date.java", "diffHunk": "@@ -54,7 +54,8 @@ public Date(TemporalAccessor date) {\n                 \"MMMM d, uuuu\",\n                 \"MMMM, uuuu\",\n                 \"d.M.uuuu\",\n-                \"uuuu.M.d\", \"uuuu\");\n+                \"uuuu.M.d\", \"uuuu\",\n+                \"MMM, uuuu\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2b1950ef575e4f5b784d93e33c71b0ba3ad5645"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc4MTcwNQ==", "bodyText": "Done. Please confirm.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424781705", "createdAt": "2020-05-13T23:09:47Z", "author": {"login": "catarinagomespt"}, "path": "src/main/java/org/jabref/model/entry/Date.java", "diffHunk": "@@ -54,7 +54,8 @@ public Date(TemporalAccessor date) {\n                 \"MMMM d, uuuu\",\n                 \"MMMM, uuuu\",\n                 \"d.M.uuuu\",\n-                \"uuuu.M.d\", \"uuuu\");\n+                \"uuuu.M.d\", \"uuuu\",\n+                \"MMM, uuuu\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ1NjY0Ng=="}, "originalCommit": {"oid": "c2b1950ef575e4f5b784d93e33c71b0ba3ad5645"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MzI4NTY2OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNDowOTowMFrOGUzcMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOTo1ODozNFrOGVBYIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ2NzUwNg==", "bodyText": "One of the Date.parse method overloads accepts already Optional as parameter, so you can make your code a bit easier and remove the ifPressent checks for Year and month\nso you would have checkDate = Date.parse(entry.getFieldOrAlias(StandardField.YEAR),  entry.getFieldOrAlias(StandardField.Month), Optional.empty())", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424467506", "createdAt": "2020-05-13T14:09:00Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +41,26 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If the year from date field is filled and equal to year it should be removed the year field\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(year -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2b1950ef575e4f5b784d93e33c71b0ba3ad5645"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY5NTg0MA==", "bodyText": "@Siedlerchr Thanks for the tip. Already did that.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424695840", "createdAt": "2020-05-13T19:58:34Z", "author": {"login": "catarinagomespt"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +41,26 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If the year from date field is filled and equal to year it should be removed the year field\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                entry.getFieldOrAlias(StandardField.YEAR).ifPresent(year -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ2NzUwNg=="}, "originalCommit": {"oid": "c2b1950ef575e4f5b784d93e33c71b0ba3ad5645"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NDg5OTkyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTowNzo0MlrOGVDj2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMzoxNDo1NFrOGVGt9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczMTYxMA==", "bodyText": "Just a quick note,\nThe Optional equals also returns true if both are empty.\nThat could be the case when there is a value in all fields, but it's invalid., eg maybe some random letters.\nCould you please add a test case for that as well. Then you should have all cases covered. I think in practice this doesn't matter but code wise it would be nice to have this edge case covered as well.\nOtherwise it's looking good to me! Thanks again for your ongoing contribution\nhttps://docs.oracle.com/javase/8/docs/api/java/util/Optional.html#equals-java.lang.Object-", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424731610", "createdAt": "2020-05-13T21:07:42Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +41,19 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If the year from date field is filled and equal to year it should be removed the year field\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                Optional<Date> newDate = Date.parse(date);\n+                Optional<Date> checkDate = Date.parse(entry.getFieldOrAlias(StandardField.YEAR),\n+                        entry.getFieldOrAlias(StandardField.MONTH), Optional.empty());\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c0d2a4caaab6b912252080bfaddf7787bf44276"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc4MzM0OQ==", "bodyText": "@Siedlerchr You are right, if both fields are empty returns true. I added a new test case to cover it.", "url": "https://github.com/JabRef/jabref/pull/6434#discussion_r424783349", "createdAt": "2020-05-13T23:14:54Z", "author": {"login": "catarinagomespt"}, "path": "src/main/java/org/jabref/logic/cleanup/ConvertToBiblatexCleanup.java", "diffHunk": "@@ -39,8 +41,19 @@\n                 entry.clearField(StandardField.YEAR).ifPresent(changes::add);\n                 entry.clearField(StandardField.MONTH).ifPresent(changes::add);\n             });\n+        } else {\n+            // If the year from date field is filled and equal to year it should be removed the year field\n+            entry.getFieldOrAlias(StandardField.DATE).ifPresent(date -> {\n+                Optional<Date> newDate = Date.parse(date);\n+                Optional<Date> checkDate = Date.parse(entry.getFieldOrAlias(StandardField.YEAR),\n+                        entry.getFieldOrAlias(StandardField.MONTH), Optional.empty());\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczMTYxMA=="}, "originalCommit": {"oid": "3c0d2a4caaab6b912252080bfaddf7787bf44276"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1811, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}