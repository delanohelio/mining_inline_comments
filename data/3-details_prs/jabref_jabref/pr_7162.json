{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMDU1NTIw", "number": 7162, "title": "Fix file not linked after DL from fulltext fetcher", "bodyText": "Remove redundant code\nWhile debugging for #7152  I found that the file is downloaded, but not linked to the library afterwards.\nFortunately I could just replace it with the specific download method already defined.\n\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-12-05T17:14:13Z", "url": "https://github.com/JabRef/jabref/pull/7162", "merged": true, "mergeCommit": {"oid": "8674477a345ceae5de3ec8fe9959dff95068b782"}, "closed": true, "closedAt": "2020-12-07T20:51:37Z", "author": {"login": "Siedlerchr"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjPkYfAH2gAyNTMzMDU1NTIwOjQyMGMwODcyNTZiZDNkYTg0NmQ1MzEyYzMwNjFhYjk2ZjMzMTk1ZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj75MJgFqTU0NjUyNTUzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "420c087256bd3da846d5312c3061ab96f33195dd", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/420c087256bd3da846d5312c3061ab96f33195dd", "committedDate": "2020-12-05T17:12:54Z", "message": "Fix file not linked after DL\n\nRemove redundant code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a84662e11ec9ab40b88eca86b3ee2e0476c3cd4", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/7a84662e11ec9ab40b88eca86b3ee2e0476c3cd4", "committedDate": "2020-12-05T17:20:05Z", "message": "fix l10n"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NjQ0NzE1", "url": "https://github.com/JabRef/jabref/pull/7162#pullrequestreview-545644715", "createdAt": "2020-12-05T19:43:53Z", "commit": {"oid": "420c087256bd3da846d5312c3061ab96f33195dd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxOTo0Mzo1M1rOIAAk_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxOTo0Mzo1M1rOIAAk_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg4MDM4MA==", "bodyText": "I think with this change, downloading a pdf doesn't show any progress any more since the onlineFile is not added to the entry until the download succeeds.", "url": "https://github.com/JabRef/jabref/pull/7162#discussion_r536880380", "createdAt": "2020-12-05T19:43:53Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/DownloadFullTextAction.java", "diffHunk": "@@ -154,26 +150,7 @@ private void addLinkedFileFromURL(BibDatabaseContext databaseContext, URL url, B\n                     preferences.getFilePreferences(),\n                     ExternalFileTypes.getInstance());\n \n-            try {\n-                URLDownload urlDownload = new URLDownload(newLinkedFile.getLink());\n-                BackgroundTask<Path> downloadTask = onlineFile.prepareDownloadTask(targetDirectory, urlDownload);\n-                downloadTask.onSuccess(destination -> {\n-                    LinkedFile downloadedFile = LinkedFilesEditorViewModel.fromFile(\n-                            destination,\n-                            databaseContext.getFileDirectories(preferences.getFilePreferences()),\n-                            ExternalFileTypes.getInstance());\n-                    entry.addFile(downloadedFile);\n-                    dialogService.notify(Localization.lang(\"Finished downloading full text document for entry %0.\",\n-                            entry.getCitationKey().orElse(Localization.lang(\"undefined\"))));\n-                });\n-                downloadTask.titleProperty().set(Localization.lang(\"Downloading\"));\n-                downloadTask.messageProperty().set(\n-                        Localization.lang(\"Fulltext for\") + \": \" + entry.getCitationKey().orElse(Localization.lang(\"New entry\")));\n-                downloadTask.showToUser(true);\n-                Globals.TASK_EXECUTOR.execute(downloadTask);\n-            } catch (MalformedURLException exception) {\n-                dialogService.showErrorDialogAndWait(Localization.lang(\"Invalid URL\"), exception);\n-            }\n+            onlineFile.download();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "420c087256bd3da846d5312c3061ab96f33195dd"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTI1NTM3", "url": "https://github.com/JabRef/jabref/pull/7162#pullrequestreview-546525537", "createdAt": "2020-12-07T20:51:27Z", "commit": {"oid": "7a84662e11ec9ab40b88eca86b3ee2e0476c3cd4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4890, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}