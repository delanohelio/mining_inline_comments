{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NzgxOTYz", "number": 6018, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMToxNDo0OFrODi2qzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxODoyNDowNFrODjkAaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODczODY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/BasePanel.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMToxNDo0OFrOFuVblA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwNzoyMTozMFrOFugctQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEyOTk0MA==", "bodyText": "Please implement a Fetcher (as the DOIFetcher or other fetchers do). --> Then, you can easily write test cases for the different shortscience urls etc.", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384129940", "createdAt": "2020-02-25T21:14:48Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/gui/BasePanel.java", "diffHunk": "@@ -1200,6 +1204,37 @@ public void action() {\n         }\n     }\n \n+    private class OpenShortScienceAction implements BaseAction {\n+        private static final String BASIC_SEARCH_URL = \"https://www.shortscience.org/internalsearch\";\n+\n+        @Override\n+        public void action() {\n+            final List<BibEntry> bes = mainTable.getSelectedEntries();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7303b233d681c7941e0738ee5ba3943e93a06fe7"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4MDIwNQ==", "bodyText": "But this is not a fetcher, or I'm mistaken?", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384180205", "createdAt": "2020-02-25T23:03:23Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/BasePanel.java", "diffHunk": "@@ -1200,6 +1204,37 @@ public void action() {\n         }\n     }\n \n+    private class OpenShortScienceAction implements BaseAction {\n+        private static final String BASIC_SEARCH_URL = \"https://www.shortscience.org/internalsearch\";\n+\n+        @Override\n+        public void action() {\n+            final List<BibEntry> bes = mainTable.getSelectedEntries();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEyOTk0MA=="}, "originalCommit": {"oid": "7303b233d681c7941e0738ee5ba3943e93a06fe7"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMxMDQ1Mw==", "bodyText": "This isn't really a fetcher as I've understood things, as it is essentially the same as a OpenURLAction with the exception that the link has to be generated. It doesn't fetch any information from the web, but instead opens the user's web browser.", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384310453", "createdAt": "2020-02-26T07:21:30Z", "author": {"login": "stevensdavid"}, "path": "src/main/java/org/jabref/gui/BasePanel.java", "diffHunk": "@@ -1200,6 +1204,37 @@ public void action() {\n         }\n     }\n \n+    private class OpenShortScienceAction implements BaseAction {\n+        private static final String BASIC_SEARCH_URL = \"https://www.shortscience.org/internalsearch\";\n+\n+        @Override\n+        public void action() {\n+            final List<BibEntry> bes = mainTable.getSelectedEntries();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEyOTk0MA=="}, "originalCommit": {"oid": "7303b233d681c7941e0738ee5ba3943e93a06fe7"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4Mzg3MTIxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/maintable/OpenShortScienceAction.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoxNzoxM1rOFvGW1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoxNzoxM1rOFvGW1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzMTU0Mg==", "bodyText": "Use\nreturn entry.getField(StandardField.TITLE).map(title -> {\n  ...\n  return uriBuilder.toString();\n});", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384931542", "createdAt": "2020-02-27T06:17:13Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/gui/maintable/OpenShortScienceAction.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package org.jabref.gui.maintable;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import javafx.beans.binding.BooleanExpression;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.actions.SimpleCommand;\n+import org.jabref.gui.desktop.JabRefDesktop;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+import org.apache.http.client.utils.URIBuilder;\n+\n+import static org.jabref.gui.actions.ActionHelper.isFieldSetForSelectedEntry;\n+import static org.jabref.gui.actions.ActionHelper.needsEntriesSelected;\n+\n+public class OpenShortScienceAction extends SimpleCommand {\n+    private static final String BASIC_SEARCH_URL = \"https://www.shortscience.org/internalsearch\";\n+    private final DialogService dialogService;\n+    private final StateManager stateManager;\n+\n+    public OpenShortScienceAction(DialogService dialogService, StateManager stateManager) {\n+        this.dialogService = dialogService;\n+        this.stateManager = stateManager;\n+\n+        BooleanExpression fieldIsSet = isFieldSetForSelectedEntry(StandardField.TITLE, stateManager);\n+        this.executable.bind(needsEntriesSelected(1, stateManager).and(fieldIsSet));\n+    }\n+\n+    @Override\n+    public void execute() {\n+        stateManager.getActiveDatabase().ifPresent(databaseContext -> {\n+            final List<BibEntry> bibEntries = stateManager.getSelectedEntries();\n+\n+            if (bibEntries.size() != 1) {\n+                dialogService.notify(Localization.lang(\"This operation requires exactly one item to be selected.\"));\n+                return;\n+            }\n+            getShortScienceSearchURL(bibEntries.get(0)).ifPresent(url -> {\n+                try {\n+                    JabRefDesktop.openExternalViewer(databaseContext, url, StandardField.URL);\n+                } catch (IOException ex) {\n+                    dialogService.showErrorDialogAndWait(Localization.lang(\"Unable to open ShortScience.\"), ex);\n+                }\n+            });\n+        });\n+    }\n+\n+    /**\n+     * Get a URL to the search results of ShortScience for the BibEntry's title\n+     * @param entry The entry to search for. Expects TITLE to be set for successful return.\n+     * @return The URL if it was successfully created\n+     */\n+    public static Optional<String> getShortScienceSearchURL(BibEntry entry) {\n+        Optional<String> title = entry.getField(StandardField.TITLE);\n+        if (!title.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4363b22f33e6fd3609ce4223b85e83bb688d43f"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4Mzg3NDE4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/maintable/OpenShortScienceAction.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoxOTowN1rOFvGYqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxMDo1OToyMVrOFvN6sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzMjAxMQ==", "bodyText": "This code should reside in the logic package somewhere - this is not user interaction, but some functionality. - it should also be tested in JUnit.", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384932011", "createdAt": "2020-02-27T06:19:07Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/gui/maintable/OpenShortScienceAction.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package org.jabref.gui.maintable;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import javafx.beans.binding.BooleanExpression;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.actions.SimpleCommand;\n+import org.jabref.gui.desktop.JabRefDesktop;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+import org.apache.http.client.utils.URIBuilder;\n+\n+import static org.jabref.gui.actions.ActionHelper.isFieldSetForSelectedEntry;\n+import static org.jabref.gui.actions.ActionHelper.needsEntriesSelected;\n+\n+public class OpenShortScienceAction extends SimpleCommand {\n+    private static final String BASIC_SEARCH_URL = \"https://www.shortscience.org/internalsearch\";\n+    private final DialogService dialogService;\n+    private final StateManager stateManager;\n+\n+    public OpenShortScienceAction(DialogService dialogService, StateManager stateManager) {\n+        this.dialogService = dialogService;\n+        this.stateManager = stateManager;\n+\n+        BooleanExpression fieldIsSet = isFieldSetForSelectedEntry(StandardField.TITLE, stateManager);\n+        this.executable.bind(needsEntriesSelected(1, stateManager).and(fieldIsSet));\n+    }\n+\n+    @Override\n+    public void execute() {\n+        stateManager.getActiveDatabase().ifPresent(databaseContext -> {\n+            final List<BibEntry> bibEntries = stateManager.getSelectedEntries();\n+\n+            if (bibEntries.size() != 1) {\n+                dialogService.notify(Localization.lang(\"This operation requires exactly one item to be selected.\"));\n+                return;\n+            }\n+            getShortScienceSearchURL(bibEntries.get(0)).ifPresent(url -> {\n+                try {\n+                    JabRefDesktop.openExternalViewer(databaseContext, url, StandardField.URL);\n+                } catch (IOException ex) {\n+                    dialogService.showErrorDialogAndWait(Localization.lang(\"Unable to open ShortScience.\"), ex);\n+                }\n+            });\n+        });\n+    }\n+\n+    /**\n+     * Get a URL to the search results of ShortScience for the BibEntry's title\n+     * @param entry The entry to search for. Expects TITLE to be set for successful return.\n+     * @return The URL if it was successfully created\n+     */\n+    public static Optional<String> getShortScienceSearchURL(BibEntry entry) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4363b22f33e6fd3609ce4223b85e83bb688d43f"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzNTgxNA==", "bodyText": "Place it into org.jabref.logic.util (as new class). I did not find a petter place.\norg.jabref.logic.importer could also fit, but not that well.", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384935814", "createdAt": "2020-02-27T06:33:59Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/gui/maintable/OpenShortScienceAction.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package org.jabref.gui.maintable;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import javafx.beans.binding.BooleanExpression;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.actions.SimpleCommand;\n+import org.jabref.gui.desktop.JabRefDesktop;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+import org.apache.http.client.utils.URIBuilder;\n+\n+import static org.jabref.gui.actions.ActionHelper.isFieldSetForSelectedEntry;\n+import static org.jabref.gui.actions.ActionHelper.needsEntriesSelected;\n+\n+public class OpenShortScienceAction extends SimpleCommand {\n+    private static final String BASIC_SEARCH_URL = \"https://www.shortscience.org/internalsearch\";\n+    private final DialogService dialogService;\n+    private final StateManager stateManager;\n+\n+    public OpenShortScienceAction(DialogService dialogService, StateManager stateManager) {\n+        this.dialogService = dialogService;\n+        this.stateManager = stateManager;\n+\n+        BooleanExpression fieldIsSet = isFieldSetForSelectedEntry(StandardField.TITLE, stateManager);\n+        this.executable.bind(needsEntriesSelected(1, stateManager).and(fieldIsSet));\n+    }\n+\n+    @Override\n+    public void execute() {\n+        stateManager.getActiveDatabase().ifPresent(databaseContext -> {\n+            final List<BibEntry> bibEntries = stateManager.getSelectedEntries();\n+\n+            if (bibEntries.size() != 1) {\n+                dialogService.notify(Localization.lang(\"This operation requires exactly one item to be selected.\"));\n+                return;\n+            }\n+            getShortScienceSearchURL(bibEntries.get(0)).ifPresent(url -> {\n+                try {\n+                    JabRefDesktop.openExternalViewer(databaseContext, url, StandardField.URL);\n+                } catch (IOException ex) {\n+                    dialogService.showErrorDialogAndWait(Localization.lang(\"Unable to open ShortScience.\"), ex);\n+                }\n+            });\n+        });\n+    }\n+\n+    /**\n+     * Get a URL to the search results of ShortScience for the BibEntry's title\n+     * @param entry The entry to search for. Expects TITLE to be set for successful return.\n+     * @return The URL if it was successfully created\n+     */\n+    public static Optional<String> getShortScienceSearchURL(BibEntry entry) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzMjAxMQ=="}, "originalCommit": {"oid": "a4363b22f33e6fd3609ce4223b85e83bb688d43f"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA1NTQxMA==", "bodyText": "I moved it to org.jabref.logic.util.ExternalLinkCreator.", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r385055410", "createdAt": "2020-02-27T10:59:21Z", "author": {"login": "stevensdavid"}, "path": "src/main/java/org/jabref/gui/maintable/OpenShortScienceAction.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package org.jabref.gui.maintable;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import javafx.beans.binding.BooleanExpression;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.actions.SimpleCommand;\n+import org.jabref.gui.desktop.JabRefDesktop;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+import org.apache.http.client.utils.URIBuilder;\n+\n+import static org.jabref.gui.actions.ActionHelper.isFieldSetForSelectedEntry;\n+import static org.jabref.gui.actions.ActionHelper.needsEntriesSelected;\n+\n+public class OpenShortScienceAction extends SimpleCommand {\n+    private static final String BASIC_SEARCH_URL = \"https://www.shortscience.org/internalsearch\";\n+    private final DialogService dialogService;\n+    private final StateManager stateManager;\n+\n+    public OpenShortScienceAction(DialogService dialogService, StateManager stateManager) {\n+        this.dialogService = dialogService;\n+        this.stateManager = stateManager;\n+\n+        BooleanExpression fieldIsSet = isFieldSetForSelectedEntry(StandardField.TITLE, stateManager);\n+        this.executable.bind(needsEntriesSelected(1, stateManager).and(fieldIsSet));\n+    }\n+\n+    @Override\n+    public void execute() {\n+        stateManager.getActiveDatabase().ifPresent(databaseContext -> {\n+            final List<BibEntry> bibEntries = stateManager.getSelectedEntries();\n+\n+            if (bibEntries.size() != 1) {\n+                dialogService.notify(Localization.lang(\"This operation requires exactly one item to be selected.\"));\n+                return;\n+            }\n+            getShortScienceSearchURL(bibEntries.get(0)).ifPresent(url -> {\n+                try {\n+                    JabRefDesktop.openExternalViewer(databaseContext, url, StandardField.URL);\n+                } catch (IOException ex) {\n+                    dialogService.showErrorDialogAndWait(Localization.lang(\"Unable to open ShortScience.\"), ex);\n+                }\n+            });\n+        });\n+    }\n+\n+    /**\n+     * Get a URL to the search results of ShortScience for the BibEntry's title\n+     * @param entry The entry to search for. Expects TITLE to be set for successful return.\n+     * @return The URL if it was successfully created\n+     */\n+    public static Optional<String> getShortScienceSearchURL(BibEntry entry) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzMjAxMQ=="}, "originalCommit": {"oid": "a4363b22f33e6fd3609ce4223b85e83bb688d43f"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4Mzg3NTAzOnYy", "diffSide": "RIGHT", "path": "src/test/java/org/jabref/gui/maintable/OpenShortScienceActionTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoxOTo0MVrOFvGZSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoxOTo0MVrOFvGZSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzMjE2OQ==", "bodyText": "Good to have test caes. They should also reside in th elogic package.", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384932169", "createdAt": "2020-02-27T06:19:41Z", "author": {"login": "koppor"}, "path": "src/test/java/org/jabref/gui/maintable/OpenShortScienceActionTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package org.jabref.gui.maintable;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import java.net.MalformedURLException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.util.Optional;\n+\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+import static org.jabref.gui.maintable.OpenShortScienceAction.getShortScienceSearchURL;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+class OpenShortScienceActionTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4363b22f33e6fd3609ce4223b85e83bb688d43f"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4Mzg3Njk4OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/jabref/gui/maintable/OpenShortScienceActionTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoyMDo0OVrOFvGacg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoyMDo0OVrOFvGacg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzMjQ2Ng==", "bodyText": "Can't we use assertEquals(Optional.empty(), getShortScienceSearchURL(entry));? In a case of a failure, IntelliJ can show the diff between the returned URL and the empty one. -- Not that important in that place, but this is a general testing style", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384932466", "createdAt": "2020-02-27T06:20:49Z", "author": {"login": "koppor"}, "path": "src/test/java/org/jabref/gui/maintable/OpenShortScienceActionTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package org.jabref.gui.maintable;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import java.net.MalformedURLException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.util.Optional;\n+\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+import static org.jabref.gui.maintable.OpenShortScienceAction.getShortScienceSearchURL;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+class OpenShortScienceActionTest {\n+\n+    /**\n+     * Validates URL conformance to RFC2396. Does not perform complex checks such as opening connections.\n+     */\n+    private boolean urlIsValid(String url) {\n+        try {\n+            // This will throw on non-compliance to RFC2396.\n+            new URL(url).toURI();\n+            return true;\n+        } catch (MalformedURLException | URISyntaxException e) {\n+            return false;\n+        }\n+    }\n+\n+    @Test\n+    void getShortScienceSearchURLEncodesSpecialCharacters() {\n+        BibEntry entry = new BibEntry();\n+        String rfc3986ReservedCharacters = \"!*'();:@&=+$,/?#[]\";\n+        entry.setField(StandardField.TITLE, rfc3986ReservedCharacters);\n+        Optional<String> url = getShortScienceSearchURL(entry);\n+        assertTrue(url.isPresent() && urlIsValid(url.get()));\n+    }\n+\n+    @Test\n+    void getShortScienceSearchURLReturnsEmptyOnMissingTitle() {\n+        BibEntry entry = new BibEntry();\n+        assertTrue(getShortScienceSearchURL(entry).isEmpty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4363b22f33e6fd3609ce4223b85e83bb688d43f"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4Mzg3ODI0OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/jabref/gui/maintable/OpenShortScienceActionTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoyMTozNlrOFvGbOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoyMTozNlrOFvGbOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzMjY2NA==", "bodyText": "&& is an indicator of strange test clauses. Maybe split up into two asserts.", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384932664", "createdAt": "2020-02-27T06:21:36Z", "author": {"login": "koppor"}, "path": "src/test/java/org/jabref/gui/maintable/OpenShortScienceActionTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package org.jabref.gui.maintable;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import java.net.MalformedURLException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.util.Optional;\n+\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+import static org.jabref.gui.maintable.OpenShortScienceAction.getShortScienceSearchURL;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+class OpenShortScienceActionTest {\n+\n+    /**\n+     * Validates URL conformance to RFC2396. Does not perform complex checks such as opening connections.\n+     */\n+    private boolean urlIsValid(String url) {\n+        try {\n+            // This will throw on non-compliance to RFC2396.\n+            new URL(url).toURI();\n+            return true;\n+        } catch (MalformedURLException | URISyntaxException e) {\n+            return false;\n+        }\n+    }\n+\n+    @Test\n+    void getShortScienceSearchURLEncodesSpecialCharacters() {\n+        BibEntry entry = new BibEntry();\n+        String rfc3986ReservedCharacters = \"!*'();:@&=+$,/?#[]\";\n+        entry.setField(StandardField.TITLE, rfc3986ReservedCharacters);\n+        Optional<String> url = getShortScienceSearchURL(entry);\n+        assertTrue(url.isPresent() && urlIsValid(url.get()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4363b22f33e6fd3609ce4223b85e83bb688d43f"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4Mzg5MDIyOnYy", "diffSide": "RIGHT", "path": "src/test/java/org/jabref/gui/maintable/OpenShortScienceActionTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoyODozOVrOFvGiMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoyODozOVrOFvGiMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzNDQ1MA==", "bodyText": "You can use\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    BibEntry entry = new BibEntry();\n          \n          \n            \n                    BibEntry entry = new BibEntry()\n          \n          \n            \n                      .withField(tandardField.TITLE, \"JabRef bibliography management\");", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384934450", "createdAt": "2020-02-27T06:28:39Z", "author": {"login": "koppor"}, "path": "src/test/java/org/jabref/gui/maintable/OpenShortScienceActionTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package org.jabref.gui.maintable;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import java.net.MalformedURLException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.util.Optional;\n+\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+import static org.jabref.gui.maintable.OpenShortScienceAction.getShortScienceSearchURL;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+class OpenShortScienceActionTest {\n+\n+    /**\n+     * Validates URL conformance to RFC2396. Does not perform complex checks such as opening connections.\n+     */\n+    private boolean urlIsValid(String url) {\n+        try {\n+            // This will throw on non-compliance to RFC2396.\n+            new URL(url).toURI();\n+            return true;\n+        } catch (MalformedURLException | URISyntaxException e) {\n+            return false;\n+        }\n+    }\n+\n+    @Test\n+    void getShortScienceSearchURLEncodesSpecialCharacters() {\n+        BibEntry entry = new BibEntry();\n+        String rfc3986ReservedCharacters = \"!*'();:@&=+$,/?#[]\";\n+        entry.setField(StandardField.TITLE, rfc3986ReservedCharacters);\n+        Optional<String> url = getShortScienceSearchURL(entry);\n+        assertTrue(url.isPresent() && urlIsValid(url.get()));\n+    }\n+\n+    @Test\n+    void getShortScienceSearchURLReturnsEmptyOnMissingTitle() {\n+        BibEntry entry = new BibEntry();\n+        assertTrue(getShortScienceSearchURL(entry).isEmpty());\n+    }\n+\n+    @Test\n+    void getShortScienceSearchURLLinksToSearchResults() {\n+        BibEntry entry = new BibEntry();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4363b22f33e6fd3609ce4223b85e83bb688d43f"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4Mzg5MTQwOnYy", "diffSide": "RIGHT", "path": "src/test/java/org/jabref/gui/maintable/OpenShortScienceActionTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoyOToyN1rOFvGi8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjoyOToyN1rOFvGi8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzNDY0Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertTrue(url.isPresent() && url.get().equals(\"https://www.shortscience.org/internalsearch?q=JabRef+bibliography+management\"));\n          \n          \n            \n                    assertEquals(Optional.of(\"https://www.shortscience.org/internalsearch?q=JabRef+bibliography+management\"), url);", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384934642", "createdAt": "2020-02-27T06:29:27Z", "author": {"login": "koppor"}, "path": "src/test/java/org/jabref/gui/maintable/OpenShortScienceActionTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package org.jabref.gui.maintable;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import java.net.MalformedURLException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.util.Optional;\n+\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+import static org.jabref.gui.maintable.OpenShortScienceAction.getShortScienceSearchURL;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+class OpenShortScienceActionTest {\n+\n+    /**\n+     * Validates URL conformance to RFC2396. Does not perform complex checks such as opening connections.\n+     */\n+    private boolean urlIsValid(String url) {\n+        try {\n+            // This will throw on non-compliance to RFC2396.\n+            new URL(url).toURI();\n+            return true;\n+        } catch (MalformedURLException | URISyntaxException e) {\n+            return false;\n+        }\n+    }\n+\n+    @Test\n+    void getShortScienceSearchURLEncodesSpecialCharacters() {\n+        BibEntry entry = new BibEntry();\n+        String rfc3986ReservedCharacters = \"!*'();:@&=+$,/?#[]\";\n+        entry.setField(StandardField.TITLE, rfc3986ReservedCharacters);\n+        Optional<String> url = getShortScienceSearchURL(entry);\n+        assertTrue(url.isPresent() && urlIsValid(url.get()));\n+    }\n+\n+    @Test\n+    void getShortScienceSearchURLReturnsEmptyOnMissingTitle() {\n+        BibEntry entry = new BibEntry();\n+        assertTrue(getShortScienceSearchURL(entry).isEmpty());\n+    }\n+\n+    @Test\n+    void getShortScienceSearchURLLinksToSearchResults() {\n+        BibEntry entry = new BibEntry();\n+        // Take an arbitrary article name\n+        String title = \"JabRef bibliography management\";\n+        entry.setField(StandardField.TITLE, title);\n+        Optional<String> url = getShortScienceSearchURL(entry);\n+        // Expected behaviour is to link to the search results page, /internalsearch\n+        assertTrue(url.isPresent() && url.get().equals(\"https://www.shortscience.org/internalsearch?q=JabRef+bibliography+management\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4363b22f33e6fd3609ce4223b85e83bb688d43f"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MzkwMTYyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/maintable/OpenShortScienceAction.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjozNTowM1rOFvGo7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwNjozNTowM1rOFvGo7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDkzNjE3NA==", "bodyText": "Please add an empty line above.\nPlease use BibEntry's title in both lines (title vs. TITLE) - or use StandardFields.TITLE here.", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r384936174", "createdAt": "2020-02-27T06:35:03Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/gui/maintable/OpenShortScienceAction.java", "diffHunk": "@@ -0,0 +1,76 @@\n+package org.jabref.gui.maintable;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import javafx.beans.binding.BooleanExpression;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.actions.SimpleCommand;\n+import org.jabref.gui.desktop.JabRefDesktop;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+import org.apache.http.client.utils.URIBuilder;\n+\n+import static org.jabref.gui.actions.ActionHelper.isFieldSetForSelectedEntry;\n+import static org.jabref.gui.actions.ActionHelper.needsEntriesSelected;\n+\n+public class OpenShortScienceAction extends SimpleCommand {\n+    private static final String BASIC_SEARCH_URL = \"https://www.shortscience.org/internalsearch\";\n+    private final DialogService dialogService;\n+    private final StateManager stateManager;\n+\n+    public OpenShortScienceAction(DialogService dialogService, StateManager stateManager) {\n+        this.dialogService = dialogService;\n+        this.stateManager = stateManager;\n+\n+        BooleanExpression fieldIsSet = isFieldSetForSelectedEntry(StandardField.TITLE, stateManager);\n+        this.executable.bind(needsEntriesSelected(1, stateManager).and(fieldIsSet));\n+    }\n+\n+    @Override\n+    public void execute() {\n+        stateManager.getActiveDatabase().ifPresent(databaseContext -> {\n+            final List<BibEntry> bibEntries = stateManager.getSelectedEntries();\n+\n+            if (bibEntries.size() != 1) {\n+                dialogService.notify(Localization.lang(\"This operation requires exactly one item to be selected.\"));\n+                return;\n+            }\n+            getShortScienceSearchURL(bibEntries.get(0)).ifPresent(url -> {\n+                try {\n+                    JabRefDesktop.openExternalViewer(databaseContext, url, StandardField.URL);\n+                } catch (IOException ex) {\n+                    dialogService.showErrorDialogAndWait(Localization.lang(\"Unable to open ShortScience.\"), ex);\n+                }\n+            });\n+        });\n+    }\n+\n+    /**\n+     * Get a URL to the search results of ShortScience for the BibEntry's title\n+     * @param entry The entry to search for. Expects TITLE to be set for successful return.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4363b22f33e6fd3609ce4223b85e83bb688d43f"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NjE2MzIyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/actions/StandardActions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxODoyMzowOFrOFvcKIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMDoxMjoxOVrOFvfrQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI4ODczNg==", "bodyText": "Rename the key? Is it open or Search?", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r385288736", "createdAt": "2020-02-27T18:23:08Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/gui/actions/StandardActions.java", "diffHunk": "@@ -33,6 +33,7 @@\n     SEND_AS_EMAIL(Localization.lang(\"Send as email\"), IconTheme.JabRefIcons.EMAIL),\n     OPEN_EXTERNAL_FILE(Localization.lang(\"Open file\"), IconTheme.JabRefIcons.FILE, KeyBinding.OPEN_FILE),\n     OPEN_URL(Localization.lang(\"Open URL or DOI\"), IconTheme.JabRefIcons.WWW, KeyBinding.OPEN_URL_OR_DOI),\n+    OPEN_SHORTSCIENCE(Localization.lang(\"Search ShortScience\")),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb90e80dcf2f84a756d198b25640d34c898c8c74"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM0NjM2OA==", "bodyText": "I renamed it now, good catch!", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r385346368", "createdAt": "2020-02-27T20:12:19Z", "author": {"login": "stevensdavid"}, "path": "src/main/java/org/jabref/gui/actions/StandardActions.java", "diffHunk": "@@ -33,6 +33,7 @@\n     SEND_AS_EMAIL(Localization.lang(\"Send as email\"), IconTheme.JabRefIcons.EMAIL),\n     OPEN_EXTERNAL_FILE(Localization.lang(\"Open file\"), IconTheme.JabRefIcons.FILE, KeyBinding.OPEN_FILE),\n     OPEN_URL(Localization.lang(\"Open URL or DOI\"), IconTheme.JabRefIcons.WWW, KeyBinding.OPEN_URL_OR_DOI),\n+    OPEN_SHORTSCIENCE(Localization.lang(\"Search ShortScience\")),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI4ODczNg=="}, "originalCommit": {"oid": "eb90e80dcf2f84a756d198b25640d34c898c8c74"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4NjE2NjgxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/logic/util/ExternalLinkCreator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxODoyNDowNVrOFvcMVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxODoyNDowNVrOFvcMVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI4OTMwMg==", "bodyText": "Please also pass the original exception as parameter. Just in case", "url": "https://github.com/JabRef/jabref/pull/6018#discussion_r385289302", "createdAt": "2020-02-27T18:24:05Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/logic/util/ExternalLinkCreator.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.jabref.logic.util;\n+\n+import java.net.URISyntaxException;\n+import java.util.Optional;\n+\n+import org.jabref.model.entry.BibEntry;\n+import org.jabref.model.entry.field.StandardField;\n+\n+import org.apache.http.client.utils.URIBuilder;\n+\n+public class ExternalLinkCreator {\n+    private static final String SHORTSCIENCE_SEARCH_URL = \"https://www.shortscience.org/internalsearch\";\n+\n+    /**\n+     * Get a URL to the search results of ShortScience for the BibEntry's title\n+     *\n+     * @param entry The entry to search for. Expects the BibEntry's title to be set for successful return.\n+     * @return The URL if it was successfully created\n+     */\n+    public static Optional<String> getShortScienceSearchURL(BibEntry entry) {\n+        return entry.getField(StandardField.TITLE).map(title -> {\n+            URIBuilder uriBuilder;\n+            try {\n+                uriBuilder = new URIBuilder(SHORTSCIENCE_SEARCH_URL);\n+            } catch (URISyntaxException e) {\n+                // This should never be able to happen as it would require the field to be misconfigured.\n+                throw new AssertionError(\"ShortScience URL is invalid.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb90e80dcf2f84a756d198b25640d34c898c8c74"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1957, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}