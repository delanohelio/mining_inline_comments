{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExNzA2Mjg3", "number": 6381, "title": "Added a download checkbox to the import dialog", "bodyText": "When importing entries, users now have a checkbox available to download\nfiles linked via url.\nI am not a GUI expert and am wondering whether my fix is appropriate and is considered clean in the MVC-concept. Since the functionality was already implemented in the LinkedFileViewModel, I just created an instance and let it handle the download. Is that ok? If not, copying the code over (and resolving some dependencies) would be the easiest, but also the dirtiest solution to this problem. Is there an appropriate place the code in LinkedFileViewModel could be moved, so it is callable in ImportEntriesViewModel?\nFixes #5662\n\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-04-30T16:37:49Z", "url": "https://github.com/JabRef/jabref/pull/6381", "merged": true, "mergeCommit": {"oid": "7cb7ea60324932723db22fcd1964e26f73f7d9b4"}, "closed": true, "closedAt": "2020-05-04T14:12:29Z", "author": {"login": "btut"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccvrPmAH2gAyNDExNzA2Mjg3OjUyNjA5OWUyMTE3ZjZiZWYyNDk0YzNmMDg3OTA4YTI0MDNkM2ZlMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceBp8qAFqTQwNTEyNDk3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "526099e2117f6bef2494c3f087908a2403d3fe08", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/526099e2117f6bef2494c3f087908a2403d3fe08", "committedDate": "2020-04-30T16:28:44Z", "message": "Added a download checkbox to the import dialog\n\nWhen importing entries, users now have a checkbox available to download\nfiles linked via url."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNzE2NzE5", "url": "https://github.com/JabRef/jabref/pull/6381#pullrequestreview-403716719", "createdAt": "2020-04-30T17:10:39Z", "commit": {"oid": "526099e2117f6bef2494c3f087908a2403d3fe08"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzoxMDozOVrOGOyk7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxNzoxMDozOVrOGOyk7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODE2MTkwMA==", "bodyText": "As JabRef uses the MVVM approach, the ideal solution would be to add a property for the checkbox in the viewmodel and bind that to the checkbox's selected item property. That should have ideally also be already the case for the checkedItems.. Don't know why it's not done.\nhttps://devdocs.jabref.org/readings-on-coding/javafx", "url": "https://github.com/JabRef/jabref/pull/6381#discussion_r418161900", "createdAt": "2020-04-30T17:10:39Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/gui/importer/ImportEntriesDialog.java", "diffHunk": "@@ -79,7 +81,7 @@ public ImportEntriesDialog(BibDatabaseContext database, BackgroundTask<ParserRes\n \n         setResultConverter(button -> {\n             if (button == importButton) {\n-                viewModel.importEntries(entriesListView.getCheckModel().getCheckedItems());\n+                viewModel.importEntries(entriesListView.getCheckModel().getCheckedItems(), downloadLinkedOnlineFiles.isSelected());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "526099e2117f6bef2494c3f087908a2403d3fe08"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f09a0ff98edf6197f820c70650f4874425856088", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/f09a0ff98edf6197f820c70650f4874425856088", "committedDate": "2020-04-30T17:22:36Z", "message": "Added languages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1854e8ddb95de230887ea3a846918bf0903391e6", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/1854e8ddb95de230887ea3a846918bf0903391e6", "committedDate": "2020-04-30T17:31:59Z", "message": "removed translations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18ac7940298e411dee33d66d0b43dcf211c3f4ca", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/18ac7940298e411dee33d66d0b43dcf211c3f4ca", "committedDate": "2020-04-30T17:35:14Z", "message": "Fixed style problems"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8a4b1b718580eacf6e6117ecbe3f258cbc8002b", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/b8a4b1b718580eacf6e6117ecbe3f258cbc8002b", "committedDate": "2020-05-01T08:22:02Z", "message": "Added preference in import tab"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb743f0f6f5b6302772d60c0c0ac9fe2df4d4aa2", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/eb743f0f6f5b6302772d60c0c0ac9fe2df4d4aa2", "committedDate": "2020-05-01T08:42:54Z", "message": "Fixed style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzIzODQ5", "url": "https://github.com/JabRef/jabref/pull/6381#pullrequestreview-404323849", "createdAt": "2020-05-01T18:31:13Z", "commit": {"oid": "eb743f0f6f5b6302772d60c0c0ac9fe2df4d4aa2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODozMToxM1rOGPR5lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODozMToxM1rOGPR5lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3NTA5Mg==", "bodyText": "If you like, you could also inject PreferencesService by the constructor. We are currently trying to get rid of the singleton pattern whereever possible.", "url": "https://github.com/JabRef/jabref/pull/6381#discussion_r418675092", "createdAt": "2020-05-01T18:31:13Z", "author": {"login": "calixtus"}, "path": "src/main/java/org/jabref/gui/importer/ImportEntriesDialog.java", "diffHunk": "@@ -77,9 +80,11 @@ public ImportEntriesDialog(BibDatabaseContext database, BackgroundTask<ParserRes\n         Button btn = (Button) this.getDialogPane().lookupButton(importButton);\n         btn.disableProperty().bind(booleanBind);\n \n+        downloadLinkedOnlineFiles.setSelected(JabRefPreferences.getInstance().getFilePreferences().getDownloadLinkedFiles());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb743f0f6f5b6302772d60c0c0ac9fe2df4d4aa2"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50d27319f2e92ba8eeb25566c0c5f792cbe9beb0", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/50d27319f2e92ba8eeb25566c0c5f792cbe9beb0", "committedDate": "2020-05-04T08:31:27Z", "message": "Removed singleton-access to preferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e00bf03c83e3f2a8302b574e41b993a84a4f454", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/6e00bf03c83e3f2a8302b574e41b993a84a4f454", "committedDate": "2020-05-04T09:22:03Z", "message": "Downloaded file is inserted before link"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "091d4a2853c213e18f1c7cc5260ce51d53f4d684", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/091d4a2853c213e18f1c7cc5260ce51d53f4d684", "committedDate": "2020-05-04T09:51:26Z", "message": "Fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2bfb8972e4276f50e390417a2066f8ef2cee7f1", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/d2bfb8972e4276f50e390417a2066f8ef2cee7f1", "committedDate": "2020-05-04T10:16:10Z", "message": "Consider FileDirPattern when downloading fulltext"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01ca6e440e8abce3c836e4269817fa4cf18d3f70", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/01ca6e440e8abce3c836e4269817fa4cf18d3f70", "committedDate": "2020-05-04T10:41:14Z", "message": "Added changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2f3c6999bb037e4e5665bc4fe5515776b6432e8", "author": {"user": null}, "url": "https://github.com/JabRef/jabref/commit/d2f3c6999bb037e4e5665bc4fe5515776b6432e8", "committedDate": "2020-05-04T10:41:40Z", "message": "Merge branch 'master' of https://github.com/JabRef/jabref into feature/downloadFilesOnImport"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0ODgwNzYy", "url": "https://github.com/JabRef/jabref/pull/6381#pullrequestreview-404880762", "createdAt": "2020-05-04T10:49:20Z", "commit": {"oid": "d2f3c6999bb037e4e5665bc4fe5515776b6432e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0OTMwNDQ2", "url": "https://github.com/JabRef/jabref/pull/6381#pullrequestreview-404930446", "createdAt": "2020-05-04T12:13:50Z", "commit": {"oid": "d2f3c6999bb037e4e5665bc4fe5515776b6432e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MTI0OTc4", "url": "https://github.com/JabRef/jabref/pull/6381#pullrequestreview-405124978", "createdAt": "2020-05-04T15:59:32Z", "commit": {"oid": "d2f3c6999bb037e4e5665bc4fe5515776b6432e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNTo1OTozMlrOGQG9vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNTo1OTozMlrOGQG9vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0NDUwOA==", "bodyText": "@btut Thanks for your implementation. I fear this addition here now duplicates the file if you right-click an online link and select \"Download\". Can you please double check this.\n(In case this is really an issue, one option would be to use prepareDownloadTask below in the importer. Then you can also display a nice progress window for the downloads.)", "url": "https://github.com/JabRef/jabref/pull/6381#discussion_r419544508", "createdAt": "2020-05-04T15:59:32Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/fieldeditors/LinkedFileViewModel.java", "diffHunk": "@@ -415,6 +416,7 @@ public void download() {\n                 LinkedFile newLinkedFile = LinkedFilesEditorViewModel.fromFile(destination, databaseContext.getFileDirectoriesAsPaths(filePreferences), externalFileTypes);\n                 linkedFile.setLink(newLinkedFile.getLink());\n                 linkedFile.setFileType(newLinkedFile.getFileType());\n+                entry.addFile(0, newLinkedFile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2f3c6999bb037e4e5665bc4fe5515776b6432e8"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 227, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}