{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyNjA4NzYw", "number": 6402, "title": "Fix action helper when no library is open", "bodyText": "This fixes #6430 an exception when opening the View menu with an empty library\n\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-05-03T14:13:03Z", "url": "https://github.com/JabRef/jabref/pull/6402", "merged": true, "mergeCommit": {"oid": "92519311c1c2ba5b0b7c1d32b6a0c451fb0d3aa0"}, "closed": true, "closedAt": "2020-05-09T18:33:24Z", "author": {"login": "Siedlerchr"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcdrf_ogH2gAyNDEyNjA4NzYwOjRlNDgwNzkzYjhlNmNjMTQzN2Q3MGI2ZjM0YjRmNDA5MTY0YTZhNzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfprimAFqTQwODY2Nzk4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e480793b8e6cc1437d70b6f34b4f409164a6a73", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/4e480793b8e6cc1437d70b6f34b4f409164a6a73", "committedDate": "2020-05-03T14:10:45Z", "message": "Fix action helper when no library is open"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70e8077ed62f07998018e654b1ced460fb44e595", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/70e8077ed62f07998018e654b1ced460fb44e595", "committedDate": "2020-05-08T18:49:12Z", "message": "Merge remote-tracking branch 'upstream/master' into fixactionHelperEmptyLib\n\n* upstream/master: (23 commits)\n  Make wrap fields also visible in entry editor (#6315)\n  Add launcher to fix extension import in snap (#6439)\n  add concise message when SaveException happen (#6444)\n  Squashed 'src/main/resources/csl-locales/' changes from 79845b087b..cbb45961b8\n  Squashed 'src/main/resources/csl-styles/' changes from 906cd6d43d..270cd3209b\n  Addition to the early pull #6438 (#6441)\n  Fix the bug #6421 (#6438)\n  Cleanup dead code (#6436)\n  Fixed entry duplication on file download (#6437)\n  Add workaround for buildSrc issue (#6433)\n  Remove dash from illegal characters. (#6300)\n  Docs: For developers: New architectural decision added to list (#6397)\n  Added a download checkbox to the import dialog (#6381)\n  Bump jaxb-xjc from 2.3.2 to 2.3.3 (#6410)\n  Bump flexmark-ext-gfm-strikethrough from 0.61.20 to 0.61.24 (#6413)\n  Bump byte-buddy-parent from 1.10.9 to 1.10.10 (#6408)\n  Bump flexmark-ext-gfm-tasklist from 0.61.20 to 0.61.24 (#6412)\n  Bump org.beryx.jlink from 2.17.8 to 2.18.0 (#6411)\n  Bump tika-core from 1.24 to 1.24.1 (#6409)\n  Bump flexmark from 0.61.20 to 0.61.24 (#6416)\n  ..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3eff0c49c0c63c626f2a6a324b4459000fc7fca", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/a3eff0c49c0c63c626f2a6a324b4459000fc7fca", "committedDate": "2020-05-08T19:06:54Z", "message": "Refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjY3OTg1", "url": "https://github.com/JabRef/jabref/pull/6402#pullrequestreview-408667985", "createdAt": "2020-05-09T17:11:23Z", "commit": {"oid": "a3eff0c49c0c63c626f2a6a324b4459000fc7fca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNzoxMToyM1rOGS8p5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNzoxMToyM1rOGS8p5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyMTMxNg==", "bodyText": "I think this does not update the status if a file is added to the currently selected entry. For this, the isAnyFieldSetForSelectedEntry method uses flatMap instead of map.", "url": "https://github.com/JabRef/jabref/pull/6402#discussion_r422521316", "createdAt": "2020-05-09T17:11:23Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/actions/ActionHelper.java", "diffHunk": "@@ -50,18 +50,23 @@ public static BooleanExpression isAnyFieldSetForSelectedEntry(List<Field> fields\n     }\n \n     public static BooleanExpression isFilePresentForSelectedEntry(StateManager stateManager, PreferencesService preferencesService) {\n-        return Bindings.createBooleanBinding(() -> {\n-                    List<LinkedFile> files = stateManager.getSelectedEntries().get(0).getFiles();\n-                    if ((files.size() > 0) && stateManager.getActiveDatabase().isPresent()) {\n-                        Optional<Path> filename = FileHelper.find(\n-                                stateManager.getActiveDatabase().get(),\n-                                files.get(0).getLink(),\n-                                preferencesService.getFilePreferences());\n-                        return filename.isPresent();\n-                    } else {\n-                        return false;\n-                    }\n-                }, stateManager.getSelectedEntries(),\n-                stateManager.getSelectedEntries().get(0).getFieldBinding(StandardField.FILE));\n+\n+        ObservableList<BibEntry> selectedEntries = stateManager.getSelectedEntries();\n+        MonadicObservableValue<Boolean> fileIsPresent = EasyBind.monadic(Bindings.valueAt(selectedEntries, 0)).map(entry -> {\n+            List<LinkedFile> files = entry.getFiles();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3eff0c49c0c63c626f2a6a324b4459000fc7fca"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 233, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}