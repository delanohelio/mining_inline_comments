{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MDE5NzUx", "number": 7037, "title": "Add awt native open commands", "bodyText": "Fixes flathub/org.jabref.jabref#3\nAs discussed in gitter the confined releases do not play nicely with xdg-open.\nThe flatpak fails directly, and the snap asks for confirmation every time.\nIf we introduce awt.open it works as intended with native commands/windows.\nIt works in confined and unconfined releases.\nAt the moment this is a draft pending further tests\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-10-23T14:53:14Z", "url": "https://github.com/JabRef/jabref/pull/7037", "merged": true, "mergeCommit": {"oid": "bfd9840f90c23adee9c78e03f95dd022cec71eff"}, "closed": true, "closedAt": "2020-10-28T09:34:41Z", "author": {"login": "LyzardKing"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVXtBLAH2gAyNTA5MDE5NzUxOjRmOTIzY2NkZTUwZTcwMTUxZDRlZTc1Njc1YWUzNDY1MGMzYmQwYjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWbAGfgH2gAyNTA5MDE5NzUxOmZhNWJkNWEzZmE5YjVhMDU2OWU0OTVjODI5YjkxYjQ4NDM0YmQ0M2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4f923ccde50e70151d4ee75675ae34650c3bd0b2", "author": {"user": {"login": "LyzardKing", "name": "Galileo Sartor"}}, "url": "https://github.com/JabRef/jabref/commit/4f923ccde50e70151d4ee75675ae34650c3bd0b2", "committedDate": "2020-10-23T14:46:38Z", "message": "Add awt native open commands"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1ODg1MjU4", "url": "https://github.com/JabRef/jabref/pull/7037#pullrequestreview-515885258", "createdAt": "2020-10-23T17:54:42Z", "commit": {"oid": "4f923ccde50e70151d4ee75675ae34650c3bd0b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNzo1NDo0M1rOHnX3UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNzo1NDo0M1rOHnX3UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA0NzUwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                LOGGER.error(\"Open operation not successful: \" + e.getMessage());\n          \n          \n            \n                                LOGGER.error(\"Open operation not successful\", e);\n          \n      \n    \n    \n  \n\nLogger error has an overload which directly accepts an throwable/eception", "url": "https://github.com/JabRef/jabref/pull/7037#discussion_r511047505", "createdAt": "2020-10-23T17:54:43Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/gui/desktop/os/Linux.java", "diffHunk": "@@ -20,23 +21,39 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(Linux.class);\n \n+    private void nativeOpenFile(String filePath) {\n+        if (Desktop.isDesktopSupported()) {\n+            new Thread(() -> {\n+                try {\n+                    File file = new File(filePath);\n+                    Desktop.getDesktop().open(file);\n+                    LOGGER.info(\"Opened file with Desktop integration\");\n+                } catch (Exception e) {\n+                    LOGGER.error(\"Open operation not successful: \" + e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f923ccde50e70151d4ee75675ae34650c3bd0b2"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fbc3a897e878042e97ee6bb7933c2eb13a5a49d", "author": {"user": {"login": "LyzardKing", "name": "Galileo Sartor"}}, "url": "https://github.com/JabRef/jabref/commit/8fbc3a897e878042e97ee6bb7933c2eb13a5a49d", "committedDate": "2020-10-25T13:11:47Z", "message": "Revert to xdg-open if the native awt operation fails.\n\nThis is used in the confined linux packages to open URLs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8afcfd8b859eee29aafd7784769016a22a5ad8c", "author": {"user": {"login": "LyzardKing", "name": "Galileo Sartor"}}, "url": "https://github.com/JabRef/jabref/commit/b8afcfd8b859eee29aafd7784769016a22a5ad8c", "committedDate": "2020-10-25T14:51:24Z", "message": "Fix AllowedToUseAwt annotation use"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41a4936ac60a2f406f14c6eba3bc16d298fa0be0", "author": {"user": {"login": "LyzardKing", "name": "Galileo Sartor"}}, "url": "https://github.com/JabRef/jabref/commit/41a4936ac60a2f406f14c6eba3bc16d298fa0be0", "committedDate": "2020-10-25T14:58:25Z", "message": "Use Thread to avoid swing dependency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mzc4MzU5", "url": "https://github.com/JabRef/jabref/pull/7037#pullrequestreview-516378359", "createdAt": "2020-10-25T17:01:30Z", "commit": {"oid": "41a4936ac60a2f406f14c6eba3bc16d298fa0be0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQxNzowMTozMFrOHn69SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQxNzowMTozMFrOHn69SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYyMjQ3Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    new Thread(() -> {\n          \n          \n            \n                    JabRefExecutorService.INSTANCE.execute(() -> {", "url": "https://github.com/JabRef/jabref/pull/7037#discussion_r511622472", "createdAt": "2020-10-25T17:01:30Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/gui/desktop/os/Linux.java", "diffHunk": "@@ -16,27 +18,48 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+@AllowedToUseAwt(\"Requires AWT to open a file with the native method\")\n public class Linux implements NativeDesktop {\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(Linux.class);\n \n+    private void nativeOpenFile(String filePath) {\n+        new Thread(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a4936ac60a2f406f14c6eba3bc16d298fa0be0"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mzc4Mzc0", "url": "https://github.com/JabRef/jabref/pull/7037#pullrequestreview-516378374", "createdAt": "2020-10-25T17:01:41Z", "commit": {"oid": "41a4936ac60a2f406f14c6eba3bc16d298fa0be0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQxNzowMTo0MVrOHn69YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQxNzowMTo0MVrOHn69YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYyMjQ5Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    }).start();\n          \n          \n            \n                    });", "url": "https://github.com/JabRef/jabref/pull/7037#discussion_r511622496", "createdAt": "2020-10-25T17:01:41Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/gui/desktop/os/Linux.java", "diffHunk": "@@ -16,27 +18,48 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+@AllowedToUseAwt(\"Requires AWT to open a file with the native method\")\n public class Linux implements NativeDesktop {\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(Linux.class);\n \n+    private void nativeOpenFile(String filePath) {\n+        new Thread(() -> {\n+            try {\n+                File file = new File(filePath);\n+                Desktop.getDesktop().open(file);\n+                System.out.println(\"Open file in default application with Desktop integration\");\n+            } catch (IllegalArgumentException e) {\n+                System.out.println(\"Fail back to xdg-open\");\n+                try {\n+                    String cmd = \"xdg-open \" + filePath;\n+                    Runtime.getRuntime().exec(cmd);\n+                } catch (Exception e2) {\n+                    System.out.println(\"Open operation not successful: \" + e2);\n+                }\n+            } catch (IOException e) {\n+                System.out.println(\"Native open operation not successful: \" + e);\n+            }\n+        }).start();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a4936ac60a2f406f14c6eba3bc16d298fa0be0"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7682bb2b0815c512081a509f36cab37c2447615a", "author": {"user": {"login": "LyzardKing", "name": "Galileo Sartor"}}, "url": "https://github.com/JabRef/jabref/commit/7682bb2b0815c512081a509f36cab37c2447615a", "committedDate": "2020-10-25T17:35:13Z", "message": "Use JabRefExecutorService to open files in Linux"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MzgwODE4", "url": "https://github.com/JabRef/jabref/pull/7037#pullrequestreview-516380818", "createdAt": "2020-10-25T17:31:15Z", "commit": {"oid": "41a4936ac60a2f406f14c6eba3bc16d298fa0be0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQxNzozMToxNVrOHn7Jtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNVQxNzozMToxNVrOHn7Jtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYyNTY1NA==", "bodyText": "@Siedlerchr\nCan we not remove this part and replace it with\nRuntime.getRuntime().exec?\nThe code would be a lot cleaner..both here and in the openFileWithApplication methods..", "url": "https://github.com/JabRef/jabref/pull/7037#discussion_r511625654", "createdAt": "2020-10-25T17:31:15Z", "author": {"login": "LyzardKing"}, "path": "src/main/java/org/jabref/gui/desktop/os/Linux.java", "diffHunk": "@@ -16,27 +18,48 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+@AllowedToUseAwt(\"Requires AWT to open a file with the native method\")\n public class Linux implements NativeDesktop {\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(Linux.class);\n \n+    private void nativeOpenFile(String filePath) {\n+        new Thread(() -> {\n+            try {\n+                File file = new File(filePath);\n+                Desktop.getDesktop().open(file);\n+                System.out.println(\"Open file in default application with Desktop integration\");\n+            } catch (IllegalArgumentException e) {\n+                System.out.println(\"Fail back to xdg-open\");\n+                try {\n+                    String cmd = \"xdg-open \" + filePath;\n+                    Runtime.getRuntime().exec(cmd);\n+                } catch (Exception e2) {\n+                    System.out.println(\"Open operation not successful: \" + e2);\n+                }\n+            } catch (IOException e) {\n+                System.out.println(\"Native open operation not successful: \" + e);\n+            }\n+        }).start();\n+    }\n+\n     @Override\n     public void openFile(String filePath, String fileType) throws IOException {\n         Optional<ExternalFileType> type = ExternalFileTypes.getInstance().getExternalFileTypeByExt(fileType);\n         String viewer;\n \n         if (type.isPresent() && !type.get().getOpenWithApplication().isEmpty()) {\n             viewer = type.get().getOpenWithApplication();\n+            ProcessBuilder processBuilder = new ProcessBuilder(viewer, filePath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a4936ac60a2f406f14c6eba3bc16d298fa0be0"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mzg0NDc2", "url": "https://github.com/JabRef/jabref/pull/7037#pullrequestreview-516384476", "createdAt": "2020-10-25T18:17:25Z", "commit": {"oid": "7682bb2b0815c512081a509f36cab37c2447615a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa5bd5a3fa9b5a0569e495c829b91b48434bd43c", "author": {"user": {"login": "LyzardKing", "name": "Galileo Sartor"}}, "url": "https://github.com/JabRef/jabref/commit/fa5bd5a3fa9b5a0569e495c829b91b48434bd43c", "committedDate": "2020-10-26T21:11:07Z", "message": "Add line in changelog"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4942, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}