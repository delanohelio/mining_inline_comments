{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MDkwMTI5", "number": 6118, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo0ODo1N1rOEe05aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo1NDoyNFrOEe1CIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzU5NDAzOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/JabRefExecutorService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo0ODo1N1rOHKuopg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo0ODo1N1rOHKuopg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAxMTg3OA==", "bodyText": "Upon termination, this method returns.\n??", "url": "https://github.com/JabRef/jabref/pull/6118#discussion_r481011878", "createdAt": "2020-09-01T09:48:57Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/JabRefExecutorService.java", "diffHunk": "@@ -132,13 +132,47 @@ public void submit(TimerTask timerTask, long millisecondsDelay) {\n         timer.schedule(timerTask, millisecondsDelay);\n     }\n \n+    /**\n+     * Shuts everything down. Upon termination, this method returns.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9df012a7f1a9b764f87fbd3412eda2be6318e263"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzYwMjI0OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/JabRefExecutorService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo1MDo0NFrOHKutKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo1MDo0NFrOHKutKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAxMzAzMg==", "bodyText": "indent", "url": "https://github.com/JabRef/jabref/pull/6118#discussion_r481013032", "createdAt": "2020-09-01T09:50:44Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/JabRefExecutorService.java", "diffHunk": "@@ -132,13 +132,47 @@ public void submit(TimerTask timerTask, long millisecondsDelay) {\n         timer.schedule(timerTask, millisecondsDelay);\n     }\n \n+    /**\n+     * Shuts everything down. Upon termination, this method returns.\n+     */\n     public void shutdownEverything() {\n-        // those threads will be allowed to finish\n-        this.executorService.shutdown();\n-        // those threads will be interrupted in their current task\n-        this.lowPriorityExecutorService.shutdownNow();\n         // kill the remote thread\n         stopRemoteThread();\n+\n+        try {\n+            // those threads will be allowed to finish\n+            this.executorService.shutdown();\n+            if (!executorService.awaitTermination(60, TimeUnit.SECONDS)) {\n+                LOGGER.debug(\"One minute passed, saving still not completed. Trying forced shutdown.\");\n+                executorService.shutdownNow();\n+                if (executorService.awaitTermination(60, TimeUnit.SECONDS)) {\n+                    LOGGER.debug(\"One minute passed again - forced shutdown worked.\");\n+                } else {\n+                    LOGGER.error(\"DelayedTaskThrottler did not terminate\");\n+                }\n+            }\n+        } catch (InterruptedException ie) {\n+                executorService.shutdownNow();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9df012a7f1a9b764f87fbd3412eda2be6318e263"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzYwOTc5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/util/DefaultTaskExecutor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo1Mjo0MFrOHKuxwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMDoxODowN1rOHKv4Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAxNDIxMA==", "bodyText": "add to interface", "url": "https://github.com/JabRef/jabref/pull/6118#discussion_r481014210", "createdAt": "2020-09-01T09:52:40Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/util/DefaultTaskExecutor.java", "diffHunk": "@@ -122,6 +122,9 @@ public static void runInJavaFXThread(Runnable runnable) {\n         return scheduledExecutor.schedule(getJavaFXTask(task), delay, unit);\n     }\n \n+    /**\n+     * Shuts everything down. Upon termination, this method returns.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9df012a7f1a9b764f87fbd3412eda2be6318e263"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAzMjI2Mg==", "bodyText": "Can't do - Added a comment to TaskExecutor", "url": "https://github.com/JabRef/jabref/pull/6118#discussion_r481032262", "createdAt": "2020-09-01T10:18:07Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/gui/util/DefaultTaskExecutor.java", "diffHunk": "@@ -122,6 +122,9 @@ public static void runInJavaFXThread(Runnable runnable) {\n         return scheduledExecutor.schedule(getJavaFXTask(task), delay, unit);\n     }\n \n+    /**\n+     * Shuts everything down. Upon termination, this method returns.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAxNDIxMA=="}, "originalCommit": {"oid": "9df012a7f1a9b764f87fbd3412eda2be6318e263"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzYxMjExOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/JabRefExecutorService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo1MzoxN1rOHKuzHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo1MzoxN1rOHKuzHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAxNDU1OA==", "bodyText": "extract try block to method and call it for executorService and lowPriorityExecutorService", "url": "https://github.com/JabRef/jabref/pull/6118#discussion_r481014558", "createdAt": "2020-09-01T09:53:17Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/JabRefExecutorService.java", "diffHunk": "@@ -132,13 +132,47 @@ public void submit(TimerTask timerTask, long millisecondsDelay) {\n         timer.schedule(timerTask, millisecondsDelay);\n     }\n \n+    /**\n+     * Shuts everything down. Upon termination, this method returns.\n+     */\n     public void shutdownEverything() {\n-        // those threads will be allowed to finish\n-        this.executorService.shutdown();\n-        // those threads will be interrupted in their current task\n-        this.lowPriorityExecutorService.shutdownNow();\n         // kill the remote thread\n         stopRemoteThread();\n+\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9df012a7f1a9b764f87fbd3412eda2be6318e263"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzYxNDc5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/JabRefExecutorService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo1NDowMFrOHKu0xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo1NDowMFrOHKu0xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAxNDk4Mg==", "bodyText": "thats not the delayed task throttler", "url": "https://github.com/JabRef/jabref/pull/6118#discussion_r481014982", "createdAt": "2020-09-01T09:54:00Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/JabRefExecutorService.java", "diffHunk": "@@ -132,13 +132,47 @@ public void submit(TimerTask timerTask, long millisecondsDelay) {\n         timer.schedule(timerTask, millisecondsDelay);\n     }\n \n+    /**\n+     * Shuts everything down. Upon termination, this method returns.\n+     */\n     public void shutdownEverything() {\n-        // those threads will be allowed to finish\n-        this.executorService.shutdown();\n-        // those threads will be interrupted in their current task\n-        this.lowPriorityExecutorService.shutdownNow();\n         // kill the remote thread\n         stopRemoteThread();\n+\n+        try {\n+            // those threads will be allowed to finish\n+            this.executorService.shutdown();\n+            if (!executorService.awaitTermination(60, TimeUnit.SECONDS)) {\n+                LOGGER.debug(\"One minute passed, saving still not completed. Trying forced shutdown.\");\n+                executorService.shutdownNow();\n+                if (executorService.awaitTermination(60, TimeUnit.SECONDS)) {\n+                    LOGGER.debug(\"One minute passed again - forced shutdown worked.\");\n+                } else {\n+                    LOGGER.error(\"DelayedTaskThrottler did not terminate\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9df012a7f1a9b764f87fbd3412eda2be6318e263"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwNzYxNjMyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/logic/util/DelayTaskThrottler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo1NDoyNFrOHKu1pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwOTo1NDoyNFrOHKu1pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTAxNTIwNg==", "bodyText": "call above helper method", "url": "https://github.com/JabRef/jabref/pull/6118#discussion_r481015206", "createdAt": "2020-09-01T09:54:24Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/util/DelayTaskThrottler.java", "diffHunk": "@@ -45,7 +46,25 @@ public void schedule(Runnable command) {\n         }\n     }\n \n+    /**\n+     * Shuts everything down. Upon termination, this method returns.\n+     */\n     public void shutdown() {\n+        // this is non-blocking. See https://stackoverflow.com/a/57383461/873282.\n         executor.shutdown();\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9df012a7f1a9b764f87fbd3412eda2be6318e263"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1996, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}