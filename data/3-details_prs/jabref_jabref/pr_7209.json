{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzMTAzNDE0", "number": 7209, "title": "Refactor unlinked files", "bodyText": "create dialog in fxml and use a background task for import\nWill fix #7205 and fix #7206\nScanning:\n\nImporting:\n\nExpanded results:\n\n\n  Finish GUI Dialog\n  Show results after Import in own dialog (see copy files)\n Background Task for Import\n Basic dialog structure in MVVM\n\n\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-12-20T17:53:09Z", "url": "https://github.com/JabRef/jabref/pull/7209", "merged": true, "mergeCommit": {"oid": "86d52cd6468335d9e460aaacc870aa5088c62431"}, "closed": true, "closedAt": "2021-01-24T17:56:09Z", "author": {"login": "Siedlerchr"}, "timelineItems": {"totalCount": 96, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoFITYAH2gAyNTQzMTAzNDE0OjU3ZjIxMGVlYTFiMmQ3NjVmZTk2ODI5YTZlY2M5ZjU5OTg4Zjc3Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdzQCArgH2gAyNTQzMTAzNDE0OjYzNjI1ODQ3NTljNzIwZDIyM2IxYWI1NWZlNGZiMWViYTE5NDNjY2Q=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "57f210eea1b2d765fe96829a6ecc9f59988f7767", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/57f210eea1b2d765fe96829a6ecc9f59988f7767", "committedDate": "2020-12-20T17:52:48Z", "message": "[WIP] Refactor unlinked files\n\ncreate dialog in fxml and use a background task for import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "803c56eef25563688a0c0c6285803631105a0754", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/803c56eef25563688a0c0c6285803631105a0754", "committedDate": "2020-12-20T18:47:02Z", "message": "add controller"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3685516eefda43194a1c654c366bf31cb05d6792", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/3685516eefda43194a1c654c366bf31cb05d6792", "committedDate": "2020-12-20T19:24:09Z", "message": "inject stuff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cb8a2d92724e605c90a601319a831125d10652c", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/2cb8a2d92724e605c90a601319a831125d10652c", "committedDate": "2020-12-20T20:10:14Z", "message": "empty line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d429cd9f832cfb7f7ba3b2301495ca6de2a7e36", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/8d429cd9f832cfb7f7ba3b2301495ca6de2a7e36", "committedDate": "2020-12-21T10:42:11Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Bump pdfbox from 2.0.21 to 2.0.22 (#7213)\n  Bump fontbox from 2.0.21 to 2.0.22 (#7219)\n  Bump archunit-junit5-api from 0.14.1 to 0.15.0 (#7220)\n  Bump unoloader from 7.0.3 to 7.0.4 (#7214)\n  Bump guava from 30.0-jre to 30.1-jre (#7218)\n  Bump xmpbox from 2.0.21 to 2.0.22 (#7217)\n  Bump classgraph from 4.8.94 to 4.8.97 (#7211)\n  Bump byte-buddy-parent from 1.10.18 to 1.10.19 (#7216)\n  Bump archunit-junit5-engine from 0.14.1 to 0.15.0 (#7215)\n  Bump org.beryx.jlink from 2.22.3 to 2.23.0 (#7212)\n  Add missing author\n  Remove field check for journal abbrev in entry editor (#7208)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bdb2c691e0796fad105e9f33dba7d8613c7a57b", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/6bdb2c691e0796fad105e9f33dba7d8613c7a57b", "committedDate": "2020-12-21T12:05:03Z", "message": "add progreess indicator\ncopy over some methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98770bbe45a666aca639d915c9b2494fba37ab5a", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/98770bbe45a666aca639d915c9b2494fba37ab5a", "committedDate": "2020-12-21T17:07:15Z", "message": "finish export implementation\nTODO: Import Button does not yet work, always null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3d2cca7957c59bdaa771df1f3413c00581b8da4", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/f3d2cca7957c59bdaa771df1f3413c00581b8da4", "committedDate": "2020-12-21T17:55:05Z", "message": "prepare background task for import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10db39a1ab29f440a001cdb00ea56e9747c08f3f", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/10db39a1ab29f440a001cdb00ea56e9747c08f3f", "committedDate": "2020-12-22T07:22:37Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Output java error on console, too (#7222)\n  Speedup processResources (#7221)\n  Fix ClipboardManager <-> Prefs ordering (#7224)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e89c91e7c23f253d720dee33c37ec7d794d8564", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/9e89c91e7c23f253d720dee33c37ec7d794d8564", "committedDate": "2020-12-22T08:02:01Z", "message": "prepare eception handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb4446958bc56e6446e1ce31c402084b0eb33ef6", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/eb4446958bc56e6446e1ce31c402084b0eb33ef6", "committedDate": "2020-12-22T09:26:22Z", "message": "add further logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a732cbcd0fad7150c15953df34ff5d0162217fd", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/1a732cbcd0fad7150c15953df34ff5d0162217fd", "committedDate": "2020-12-22T11:33:17Z", "message": "add progrees indicator linkage\n\nTODO: Progress not yet shown"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0b3f79cbda2be146215e3950d321d77b681fee8", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/f0b3f79cbda2be146215e3950d321d77b681fee8", "committedDate": "2020-12-22T16:29:30Z", "message": "Fix threading issues, report progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a05ba1fb76981cc1960c7ce12f43ac7f23adeea1", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/a05ba1fb76981cc1960c7ce12f43ac7f23adeea1", "committedDate": "2020-12-22T16:33:03Z", "message": "remove useless undo stuff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d25e30d1095a19b9c7b77666333c8dec43f70fe", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/1d25e30d1095a19b9c7b77666333c8dec43f70fe", "committedDate": "2020-12-23T14:59:40Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  fxdocs changed their URL (#7230)\n  New Crowdin updates (#7227)\n  Fix some fetcher test (#7225)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f93cef657f1e77812f3e8f7705d9810f90fa8fc", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/3f93cef657f1e77812f3e8f7705d9810f90fa8fc", "committedDate": "2020-12-23T16:22:32Z", "message": "wire buttons to the viewModel\nadjust dialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7dddd4c1e217244d16bb2f2afb360e524e52019", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/e7dddd4c1e217244d16bb2f2afb360e524e52019", "committedDate": "2020-12-23T17:14:19Z", "message": "show import results dialog view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7fcd2f16eb433a54f55375d20bbfea63e6d42aa", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/b7fcd2f16eb433a54f55375d20bbfea63e6d42aa", "committedDate": "2020-12-23T17:25:54Z", "message": "better error messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad50cc9faa6f4debb73c72668c828644e1fda454", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/ad50cc9faa6f4debb73c72668c828644e1fda454", "committedDate": "2020-12-24T13:55:37Z", "message": "Rename files, fix cancel, fix gui"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "082580cb188011774cfe2ccc9b9e29b6d7a48907", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/082580cb188011774cfe2ccc9b9e29b6d7a48907", "committedDate": "2020-12-25T17:22:20Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  add language mapping for chinese\n  remove chinese content\n  fix hamcrest link\n  Add Traditional Chinese (#7240)\n  Show development information\n  Allow manual trigger of the deployment workflow\n  Release v5.2\n  Adapt changelog for 5.2 release\n  Update external-libraries.md\n  checkstyle\n  L10n master (#7235)\n  fix fetcher architecture test\n  Add missing author\n  Add error dialog \"Problem finding files\" (#6842)\n  Disable ACM, Google Scholar, JSTOR (#7229)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e37d447197a85d9aedcd050295dbafa099bba09", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/4e37d447197a85d9aedcd050295dbafa099bba09", "committedDate": "2020-12-26T14:11:12Z", "message": "Cleanup\ncheckstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f61e8e308a2c888b3c75111a05b9c2484701b0e", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/6f61e8e308a2c888b3c75111a05b9c2484701b0e", "committedDate": "2020-12-26T14:19:54Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ae183dc6b94362d9aa06c6d3d6af38971da4f0a", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/2ae183dc6b94362d9aa06c6d3d6af38971da4f0a", "committedDate": "2020-12-26T15:54:43Z", "message": "fix checkstyle in md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27cf98db11aa5f3f584cc5429096cb02d47305aa", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/27cf98db11aa5f3f584cc5429096cb02d47305aa", "committedDate": "2020-12-26T16:53:17Z", "message": "Make table columns more wider\ndisable import button"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98c6a7f71e2fab3dfa2d4b138e3d11244eacf740", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/98c6a7f71e2fab3dfa2d4b138e3d11244eacf740", "committedDate": "2020-12-26T17:10:54Z", "message": "preapre localization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6219364665caf03f81a39b02572c26679b5d0d54", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/6219364665caf03f81a39b02572c26679b5d0d54", "committedDate": "2020-12-26T17:19:14Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebd045724ac2a68cd629bcc759e7bf63d3d89fe5", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/ebd045724ac2a68cd629bcc759e7bf63d3d89fe5", "committedDate": "2020-12-26T17:19:16Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  GitBook: [master] 5 pages and 25 assets modified\n  New Crowdin updates (#7246)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7222863c7b6dc6eaccf705c32a84453ab6c380e", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/f7222863c7b6dc6eaccf705c32a84453ab6c380e", "committedDate": "2020-12-26T17:20:32Z", "message": "fix md errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1da3921a8ba7fbbc093abc9c99cda0ecb545024", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/a1da3921a8ba7fbbc093abc9c99cda0ecb545024", "committedDate": "2020-12-26T17:22:16Z", "message": "fix l10n key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2fd3ba93a6a5ec2dc503adbb56373d3b4385181", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/e2fd3ba93a6a5ec2dc503adbb56373d3b4385181", "committedDate": "2020-12-26T17:36:06Z", "message": "add l10n"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bee42c6be6b188e560b306606470a5c585e49c8a", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/bee42c6be6b188e560b306606470a5c585e49c8a", "committedDate": "2020-12-26T17:48:37Z", "message": "further l10n fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cdfa696ebc6b13c0e3b184f40aac02cd96e92f3", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/5cdfa696ebc6b13c0e3b184f40aac02cd96e92f3", "committedDate": "2020-12-26T17:55:01Z", "message": "further l10n fixs to reuse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15bbee1fcb48e97daf279f4b3367598923a48c67", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/15bbee1fcb48e97daf279f4b3367598923a48c67", "committedDate": "2020-12-26T18:00:14Z", "message": "remove one dot"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6d17f9a91a1c2b5f4b210b3d22a6b0962cc6074", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/a6d17f9a91a1c2b5f4b210b3d22a6b0962cc6074", "committedDate": "2020-12-28T10:44:42Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Bump xmlunit-core from 2.8.1 to 2.8.2 (#7251)\n  Bump classgraph from 4.8.97 to 4.8.98 (#7250)\n  Bump bcprov-jdk15on from 1.67 to 1.68 (#7249)\n  Bump xmlunit-matchers from 2.8.1 to 2.8.2 (#7252)\n  Bump unirest-java from 3.11.06 to 3.11.09 (#7254)\n  Bump org.beryx.jlink from 2.23.0 to 2.23.1 (#7253)\n  Bump pascalgn/automerge-action from v0.12.0 to v0.13.0 (#7255)\n  Added a check to integrate with the flatpak package (#7248)\n  New translations JabRef_en.properties (Chinese Traditional) (#7247)\n  Update code-howtos.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "191889354fc42a0539b60177e367fb1ddfb099d9", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/191889354fc42a0539b60177e367fb1ddfb099d9", "committedDate": "2020-12-28T15:02:12Z", "message": "idea extend filenode wrapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37f6b5b2dd83399fbc94c20655e05aa460aaa30d", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/37f6b5b2dd83399fbc94c20655e05aa460aaa30d", "committedDate": "2020-12-28T17:35:03Z", "message": "Remove extra dialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b6946511e7377886cd5eb08143610953be31dcd", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/6b6946511e7377886cd5eb08143610953be31dcd", "committedDate": "2020-12-28T17:41:46Z", "message": "fix progressIndicator still visible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "babad73222e1f00fd452f58ac84c150830ea41da", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/babad73222e1f00fd452f58ac84c150830ea41da", "committedDate": "2020-12-28T17:46:10Z", "message": "replace with spaces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d9bf7c91d249cbe890c257c3d68fa7b41b27a36", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/1d9bf7c91d249cbe890c257c3d68fa7b41b27a36", "committedDate": "2020-12-28T17:53:45Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1dc05771c4a3fc019657a8c3478da5e6fdceaf5", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/a1dc05771c4a3fc019657a8c3478da5e6fdceaf5", "committedDate": "2020-12-29T11:52:42Z", "message": "add titled pane"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3683a2ceced9e296635bcc4bf9448c3fb011e80c", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/3683a2ceced9e296635bcc4bf9448c3fb011e80c", "committedDate": "2020-12-29T11:58:43Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce21003a9991279ef293ac62bb96145a92dfa36b", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/ce21003a9991279ef293ac62bb96145a92dfa36b", "committedDate": "2020-12-29T12:44:21Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Improved detection of long DOI's within text (#7260)\n  Add missing author and fix name\n  Fix style of highlighted checkboxes while searching in preferences (#7258)\n  Updates to institution citation keys (#7210)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78cf06ba89433586a93bc5fe0eb13973a6888bd8", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/78cf06ba89433586a93bc5fe0eb13973a6888bd8", "committedDate": "2020-12-29T12:46:08Z", "message": "fix duplicate method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f776b2a4e3b357f2f9db7312effdeba0a5c11b4", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/7f776b2a4e3b357f2f9db7312effdeba0a5c11b4", "committedDate": "2021-01-02T16:49:42Z", "message": "Merge and remove unceessary dependencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b036f11b91709410bcb47fb553a64822c462edbe", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/b036f11b91709410bcb47fb553a64822c462edbe", "committedDate": "2021-01-02T17:14:47Z", "message": "align browse button"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82ae9eab133543d660f89e1527bc281c5eca2af4", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/82ae9eab133543d660f89e1527bc281c5eca2af4", "committedDate": "2021-01-02T17:31:00Z", "message": "adjust combobox display"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "380f4d1765adf270da5f1d3d29e388dda9dcf28b", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/380f4d1765adf270da5f1d3d29e388dda9dcf28b", "committedDate": "2021-01-03T19:22:45Z", "message": "Fixed whitespaces, fxml and refactored for some readability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe59fb97dd979c4944cffb082007de08b0b403bd", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/fe59fb97dd979c4944cffb082007de08b0b403bd", "committedDate": "2021-01-03T21:13:38Z", "message": "Fixed accordion and l10n"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b3a9224f6198b4cda537d5dd0f6220dd8c1c98b", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/4b3a9224f6198b4cda537d5dd0f6220dd8c1c98b", "committedDate": "2021-01-04T10:34:36Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Added eye candy in entry editor context menus (#7268)\n  Bump WyriHaximus/github-action-wait-for-status from v1.2 to v1.3 (#7285)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9b38ab450589a1a3d3a00d0f1aa2dea83736265", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/e9b38ab450589a1a3d3a00d0f1aa2dea83736265", "committedDate": "2021-01-04T10:46:17Z", "message": "Add changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/e0466377c7ea3dce53d753f7fd60d7c0ada99279", "committedDate": "2021-01-04T10:56:37Z", "message": "fix link in changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwOTY4NjU1", "url": "https://github.com/JabRef/jabref/pull/7209#pullrequestreview-560968655", "createdAt": "2021-01-04T11:44:43Z", "commit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMTo0NDo0M1rOINuypQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMjoxOTo1MlrOINvuvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI2OTAyOQ==", "bodyText": "Add fullstop.", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551269029", "createdAt": "2021-01-04T11:44:43Z", "author": {"login": "tobiasdiez"}, "path": "CHANGELOG.md", "diffHunk": "@@ -12,15 +12,19 @@ Note that this project **does not** adhere to [Semantic Versioning](http://semve\n ### Added\n \n - We added the extension support and the external application support (For Texshow, Texmaker and LyX) to the flatpak [#7248](https://github.com/JabRef/jabref/pull/7248)\n-- We added some symbols and keybindings to the context menu in the entry editor. [#7268]((https://github.com/JabRef/jabref/pull/7268))\n+- We added some symbols and keybindings to the context menu in the entry editor. [#7268](https://github.com/JabRef/jabref/pull/7268)\n \n ### Changed\n \n+- We improved the \"Find unlinked files\" dialog to show import results for each file [#7209](https://github.com/JabRef/jabref/pull/7209)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI2OTE4Nw==", "bodyText": "Here as well, 2x", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551269187", "createdAt": "2021-01-04T11:45:03Z", "author": {"login": "tobiasdiez"}, "path": "CHANGELOG.md", "diffHunk": "@@ -12,15 +12,19 @@ Note that this project **does not** adhere to [Semantic Versioning](http://semve\n ### Added\n \n - We added the extension support and the external application support (For Texshow, Texmaker and LyX) to the flatpak [#7248](https://github.com/JabRef/jabref/pull/7248)\n-- We added some symbols and keybindings to the context menu in the entry editor. [#7268]((https://github.com/JabRef/jabref/pull/7268))\n+- We added some symbols and keybindings to the context menu in the entry editor. [#7268](https://github.com/JabRef/jabref/pull/7268)\n \n ### Changed\n \n+- We improved the \"Find unlinked files\" dialog to show import results for each file [#7209](https://github.com/JabRef/jabref/pull/7209)\n+\n ### Fixed\n \n - We fixed an issue with the style of highlighted check boxes while searching in preferences. [#7226](https://github.com/JabRef/jabref/issues/7226)\n - We fixed an issue where the option \"Move file to file directory\" was disabled in the entry editor for all files [#7194](https://github.com/JabRef/jabref/issues/7194)\n - We fixed an issue where application dialogs were opening in the wrong display when using multiple screens [#7273](https://github.com/JabRef/jabref/pull/7273)\n+- We fixed an issue where the \"Find unlinked files\" dialog would freeze JabRef on importing [#7205](https://github.com/JabRef/jabref/issues/7205)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3MTQ3MA==", "bodyText": "This wrapping is not necessarily:\n\nCalls to updateMessage are coalesced and run later on the FX application thread, so calls to updateMessage, even from the FX Application thread, may not necessarily result in immediate updates to this property, and intermediate message values may be coalesced to save on event notifications.", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551271470", "createdAt": "2021-01-04T11:50:15Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +71,96 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3MjExNQ==", "bodyText": "I think these variables should be local to the BackgroundTask constructed below.", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551272115", "createdAt": "2021-01-04T11:51:45Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -27,16 +32,22 @@\n import org.jabref.model.util.FileUpdateMonitor;\n import org.jabref.preferences.PreferencesService;\n \n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n public class ImportHandler {\n \n-    private final BibDatabaseContext database;\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ImportHandler.class);\n+    private final BibDatabaseContext bibdatabasecontext;\n     private final PreferencesService preferencesService;\n-    private final DialogService dialogService;\n     private final FileUpdateMonitor fileUpdateMonitor;\n     private final ExternalFilesEntryLinker linker;\n     private final ExternalFilesContentImporter contentImporter;\n     private final UndoManager undoManager;\n     private final StateManager stateManager;\n+    private List<ImportFilesResultItemViewModel> results;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3MjQyMA==", "bodyText": "bibDatabaseContext? But actually database is totally fine in my opinion", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551272420", "createdAt": "2021-01-04T11:52:26Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -46,9 +57,7 @@ public ImportHandler(DialogService dialogService,\n                          UndoManager undoManager,\n                          StateManager stateManager) {\n \n-        this.dialogService = dialogService;\n-        this.database = database;\n-\n+        this.bibdatabasecontext = database;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3Mjc2Mw==", "bodyText": "Why use counter here instead of i?", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551272763", "createdAt": "2021-01-04T11:53:20Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +71,96 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {\n+                        updateMessage(Localization.lang(\"Processing file %0 of %1\", counter, files.size()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3MzM2Mg==", "bodyText": "What about showing the name of the file instead? The other information is already included in the pogressbar", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551273362", "createdAt": "2021-01-04T11:54:35Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +71,96 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {\n+                        updateMessage(Localization.lang(\"Processing file %0 of %1\", counter, files.size()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3MzYyOQ==", "bodyText": "get(i)?", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551273629", "createdAt": "2021-01-04T11:55:16Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +71,96 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {\n+                        updateMessage(Localization.lang(\"Processing file %0 of %1\", counter, files.size()));\n+                        updateProgress(counter, files.size() - 1);\n+                    });\n+\n+                    var file = files.get(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3NDkwMg==", "bodyText": "Doesn't this may show an error message, even though later only the xmp information is used anyway? I would resort the code here to call only the import pdf if there is no xmp info", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551274902", "createdAt": "2021-01-04T11:58:08Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +71,96 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {\n+                        updateMessage(Localization.lang(\"Processing file %0 of %1\", counter, files.size()));\n+                        updateProgress(counter, files.size() - 1);\n+                    });\n+\n+                    var file = files.get(0);\n+                    entriesToAdd = Collections.emptyList();\n+\n+                    try {\n+                        if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n+\n+                            var pdfImporterResult = contentImporter.importPDFContent(file);\n+                            List<BibEntry> pdfEntriesInFile = pdfImporterResult.getDatabase().getEntries();\n+\n+                            if (pdfImporterResult.hasWarnings()) {\n+                                addResultToList(file, false, Localization.lang(\"Error reading PDF content: %0\", pdfImporterResult.getErrorMessage()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3Njc3OQ==", "bodyText": "Really? I thought that should actually work. Where do you get deadlocks otherwise?", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551276779", "createdAt": "2021-01-04T12:02:30Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +71,96 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {\n+                        updateMessage(Localization.lang(\"Processing file %0 of %1\", counter, files.size()));\n+                        updateProgress(counter, files.size() - 1);\n+                    });\n+\n+                    var file = files.get(0);\n+                    entriesToAdd = Collections.emptyList();\n+\n+                    try {\n+                        if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n+\n+                            var pdfImporterResult = contentImporter.importPDFContent(file);\n+                            List<BibEntry> pdfEntriesInFile = pdfImporterResult.getDatabase().getEntries();\n+\n+                            if (pdfImporterResult.hasWarnings()) {\n+                                addResultToList(file, false, Localization.lang(\"Error reading PDF content: %0\", pdfImporterResult.getErrorMessage()));\n+                            }\n+\n+                            var xmpParserResult = contentImporter.importXMPContent(file);\n+                            List<BibEntry> xmpEntriesInFile = xmpParserResult.getDatabase().getEntries();\n+\n+                            if (xmpParserResult.hasWarnings()) {\n+                                addResultToList(file, false, Localization.lang(\"Error reading XMP content: %0\", xmpParserResult.getErrorMessage()));\n+                            }\n+\n+                            // First try xmp import, if empty try pdf import, otherwise create empty entry\n+                            if (!xmpEntriesInFile.isEmpty()) {\n+                                entriesToAdd = xmpEntriesInFile;\n+                                addResultToList(file, true, Localization.lang(\"Importing using XMP data...\"));\n+                            } else if (!pdfEntriesInFile.isEmpty()) {\n+                                    entriesToAdd = pdfEntriesInFile;\n+                                    addResultToList(file, true, Localization.lang(\"Importing using extracted PDF data\"));\n+                            } else {\n+                                    entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                                    addResultToList(file, false, Localization.lang(\"No metadata found. Creating empty entry with file link\"));\n+                            }\n+                        } else if (FileUtil.isBibFile(file)) {\n+                            var bibtexParserResult = contentImporter.importFromBibFile(file, fileUpdateMonitor);\n+                            if (bibtexParserResult.hasWarnings()) {\n+                                addResultToList(file, false, bibtexParserResult.getErrorMessage());\n+                            }\n+\n+                            entriesToAdd = bibtexParserResult.getDatabaseContext().getEntries();\n+                            addResultToList(file, false, Localization.lang(\"Importing bib entry\"));\n+                        } else {\n+                            entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                            addResultToList(file, false, Localization.lang(\"No bibtex data found. Creating empty entry with file link\"));\n+                        }\n+\n+                    } catch (IOException ex) {\n+                        LOGGER.error(\"Error importing\", ex);\n+                        addResultToList(file, false, Localization.lang(\"Error from import: %0\", ex.getLocalizedMessage()));\n+\n+                        DefaultTaskExecutor.runInJavaFXThread(() -> updateMessage(Localization.lang(\"Error\")));\n                     }\n+\n+                    // We need to run the actual import on the FX Thread, otherwise we will get some deadlocks with the UIThreadList", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 151}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3Njg1NQ==", "bodyText": "runinJavafxthread not necessary", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551276855", "createdAt": "2021-01-04T12:02:44Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +71,96 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {\n+                        updateMessage(Localization.lang(\"Processing file %0 of %1\", counter, files.size()));\n+                        updateProgress(counter, files.size() - 1);\n+                    });\n+\n+                    var file = files.get(0);\n+                    entriesToAdd = Collections.emptyList();\n+\n+                    try {\n+                        if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n+\n+                            var pdfImporterResult = contentImporter.importPDFContent(file);\n+                            List<BibEntry> pdfEntriesInFile = pdfImporterResult.getDatabase().getEntries();\n+\n+                            if (pdfImporterResult.hasWarnings()) {\n+                                addResultToList(file, false, Localization.lang(\"Error reading PDF content: %0\", pdfImporterResult.getErrorMessage()));\n+                            }\n+\n+                            var xmpParserResult = contentImporter.importXMPContent(file);\n+                            List<BibEntry> xmpEntriesInFile = xmpParserResult.getDatabase().getEntries();\n+\n+                            if (xmpParserResult.hasWarnings()) {\n+                                addResultToList(file, false, Localization.lang(\"Error reading XMP content: %0\", xmpParserResult.getErrorMessage()));\n+                            }\n+\n+                            // First try xmp import, if empty try pdf import, otherwise create empty entry\n+                            if (!xmpEntriesInFile.isEmpty()) {\n+                                entriesToAdd = xmpEntriesInFile;\n+                                addResultToList(file, true, Localization.lang(\"Importing using XMP data...\"));\n+                            } else if (!pdfEntriesInFile.isEmpty()) {\n+                                    entriesToAdd = pdfEntriesInFile;\n+                                    addResultToList(file, true, Localization.lang(\"Importing using extracted PDF data\"));\n+                            } else {\n+                                    entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                                    addResultToList(file, false, Localization.lang(\"No metadata found. Creating empty entry with file link\"));\n+                            }\n+                        } else if (FileUtil.isBibFile(file)) {\n+                            var bibtexParserResult = contentImporter.importFromBibFile(file, fileUpdateMonitor);\n+                            if (bibtexParserResult.hasWarnings()) {\n+                                addResultToList(file, false, bibtexParserResult.getErrorMessage());\n+                            }\n+\n+                            entriesToAdd = bibtexParserResult.getDatabaseContext().getEntries();\n+                            addResultToList(file, false, Localization.lang(\"Importing bib entry\"));\n+                        } else {\n+                            entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                            addResultToList(file, false, Localization.lang(\"No bibtex data found. Creating empty entry with file link\"));\n+                        }\n+\n+                    } catch (IOException ex) {\n+                        LOGGER.error(\"Error importing\", ex);\n+                        addResultToList(file, false, Localization.lang(\"Error from import: %0\", ex.getLocalizedMessage()));\n+\n+                        DefaultTaskExecutor.runInJavaFXThread(() -> updateMessage(Localization.lang(\"Error\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 148}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3NzE5Ng==", "bodyText": "with what?", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551277196", "createdAt": "2021-01-04T12:03:33Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +71,96 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {\n+                        updateMessage(Localization.lang(\"Processing file %0 of %1\", counter, files.size()));\n+                        updateProgress(counter, files.size() - 1);\n+                    });\n+\n+                    var file = files.get(0);\n+                    entriesToAdd = Collections.emptyList();\n+\n+                    try {\n+                        if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n+\n+                            var pdfImporterResult = contentImporter.importPDFContent(file);\n+                            List<BibEntry> pdfEntriesInFile = pdfImporterResult.getDatabase().getEntries();\n+\n+                            if (pdfImporterResult.hasWarnings()) {\n+                                addResultToList(file, false, Localization.lang(\"Error reading PDF content: %0\", pdfImporterResult.getErrorMessage()));\n+                            }\n+\n+                            var xmpParserResult = contentImporter.importXMPContent(file);\n+                            List<BibEntry> xmpEntriesInFile = xmpParserResult.getDatabase().getEntries();\n+\n+                            if (xmpParserResult.hasWarnings()) {\n+                                addResultToList(file, false, Localization.lang(\"Error reading XMP content: %0\", xmpParserResult.getErrorMessage()));\n+                            }\n+\n+                            // First try xmp import, if empty try pdf import, otherwise create empty entry\n+                            if (!xmpEntriesInFile.isEmpty()) {\n+                                entriesToAdd = xmpEntriesInFile;\n+                                addResultToList(file, true, Localization.lang(\"Importing using XMP data...\"));\n+                            } else if (!pdfEntriesInFile.isEmpty()) {\n+                                    entriesToAdd = pdfEntriesInFile;\n+                                    addResultToList(file, true, Localization.lang(\"Importing using extracted PDF data\"));\n+                            } else {\n+                                    entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                                    addResultToList(file, false, Localization.lang(\"No metadata found. Creating empty entry with file link\"));\n+                            }\n+                        } else if (FileUtil.isBibFile(file)) {\n+                            var bibtexParserResult = contentImporter.importFromBibFile(file, fileUpdateMonitor);\n+                            if (bibtexParserResult.hasWarnings()) {\n+                                addResultToList(file, false, bibtexParserResult.getErrorMessage());\n+                            }\n+\n+                            entriesToAdd = bibtexParserResult.getDatabaseContext().getEntries();\n+                            addResultToList(file, false, Localization.lang(\"Importing bib entry\"));\n+                        } else {\n+                            entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                            addResultToList(file, false, Localization.lang(\"No bibtex data found. Creating empty entry with file link\"));\n+                        }\n+\n+                    } catch (IOException ex) {\n+                        LOGGER.error(\"Error importing\", ex);\n+                        addResultToList(file, false, Localization.lang(\"Error from import: %0\", ex.getLocalizedMessage()));\n+\n+                        DefaultTaskExecutor.runInJavaFXThread(() -> updateMessage(Localization.lang(\"Error\")));\n                     }\n+\n+                    // We need to run the actual import on the FX Thread, otherwise we will get some deadlocks with the UIThreadList\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> importEntries(entriesToAdd));\n+\n+                    ce.addEdit(new UndoableInsertEntries(bibdatabasecontext.getDatabase(), entriesToAdd));\n+                    ce.end();\n+                    undoManager.addEdit(ce);\n+\n+                    counter++;\n                 }\n-            } else if (FileUtil.isBibFile(file)) {\n-                entriesToAdd = contentImporter.importFromBibFile(file, fileUpdateMonitor);\n-            } else {\n-                entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                return results;\n             }\n+        };\n+    }\n \n-            importEntries(entriesToAdd);\n-            ce.addEdit(new UndoableInsertEntries(database.getDatabase(), entriesToAdd));\n-        }\n-        ce.end();\n-        undoManager.addEdit(ce);\n+    private void addResultToList(Path newFile, boolean success, String logMessage) {\n+        var result = new ImportFilesResultItemViewModel(newFile, success, logMessage);\n+        results.add(result);\n+    }\n+\n+    public void importAsNewEntries(List<Path> files) {\n+        // Will be replaced", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 180}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3NzcwMg==", "bodyText": "wouldn't it be good to have a result variable, and then add it at the end of the import? Otherwise you might end up with multiple messages for one file nad that can be confusing", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551277702", "createdAt": "2021-01-04T12:04:43Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +71,96 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {\n+                        updateMessage(Localization.lang(\"Processing file %0 of %1\", counter, files.size()));\n+                        updateProgress(counter, files.size() - 1);\n+                    });\n+\n+                    var file = files.get(0);\n+                    entriesToAdd = Collections.emptyList();\n+\n+                    try {\n+                        if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n+\n+                            var pdfImporterResult = contentImporter.importPDFContent(file);\n+                            List<BibEntry> pdfEntriesInFile = pdfImporterResult.getDatabase().getEntries();\n+\n+                            if (pdfImporterResult.hasWarnings()) {\n+                                addResultToList(file, false, Localization.lang(\"Error reading PDF content: %0\", pdfImporterResult.getErrorMessage()));\n+                            }\n+\n+                            var xmpParserResult = contentImporter.importXMPContent(file);\n+                            List<BibEntry> xmpEntriesInFile = xmpParserResult.getDatabase().getEntries();\n+\n+                            if (xmpParserResult.hasWarnings()) {\n+                                addResultToList(file, false, Localization.lang(\"Error reading XMP content: %0\", xmpParserResult.getErrorMessage()));\n+                            }\n+\n+                            // First try xmp import, if empty try pdf import, otherwise create empty entry\n+                            if (!xmpEntriesInFile.isEmpty()) {\n+                                entriesToAdd = xmpEntriesInFile;\n+                                addResultToList(file, true, Localization.lang(\"Importing using XMP data...\"));\n+                            } else if (!pdfEntriesInFile.isEmpty()) {\n+                                    entriesToAdd = pdfEntriesInFile;\n+                                    addResultToList(file, true, Localization.lang(\"Importing using extracted PDF data\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3ODM2OQ==", "bodyText": "If you add a new constructor to the ImportFilesResultItemViewModel class, this could be simply result = new ImportFilesResultItemViewModel(file, xmpParserResult).", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551278369", "createdAt": "2021-01-04T12:06:14Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +71,96 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {\n+                        updateMessage(Localization.lang(\"Processing file %0 of %1\", counter, files.size()));\n+                        updateProgress(counter, files.size() - 1);\n+                    });\n+\n+                    var file = files.get(0);\n+                    entriesToAdd = Collections.emptyList();\n+\n+                    try {\n+                        if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n+\n+                            var pdfImporterResult = contentImporter.importPDFContent(file);\n+                            List<BibEntry> pdfEntriesInFile = pdfImporterResult.getDatabase().getEntries();\n+\n+                            if (pdfImporterResult.hasWarnings()) {\n+                                addResultToList(file, false, Localization.lang(\"Error reading PDF content: %0\", pdfImporterResult.getErrorMessage()));\n+                            }\n+\n+                            var xmpParserResult = contentImporter.importXMPContent(file);\n+                            List<BibEntry> xmpEntriesInFile = xmpParserResult.getDatabase().getEntries();\n+\n+                            if (xmpParserResult.hasWarnings()) {\n+                                addResultToList(file, false, Localization.lang(\"Error reading XMP content: %0\", xmpParserResult.getErrorMessage()));\n+                            }\n+\n+                            // First try xmp import, if empty try pdf import, otherwise create empty entry\n+                            if (!xmpEntriesInFile.isEmpty()) {\n+                                entriesToAdd = xmpEntriesInFile;\n+                                addResultToList(file, true, Localization.lang(\"Importing using XMP data...\"));\n+                            } else if (!pdfEntriesInFile.isEmpty()) {\n+                                    entriesToAdd = pdfEntriesInFile;\n+                                    addResultToList(file, true, Localization.lang(\"Importing using extracted PDF data\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3NzcwMg=="}, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3ODk3Ng==", "bodyText": "wrap also not necessary", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551278976", "createdAt": "2021-01-04T12:07:34Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesCrawler.java", "diffHunk": "@@ -95,11 +98,14 @@ public UnlinkedFilesCrawler(Path directory, FileFilter fileFilter, BibDatabaseCo\n             root.getChildren().add(new CheckBoxTreeItem<>(new FileNodeWrapper(file.toPath())));\n \n             counter++;\n-            if (counter == 1) {\n-                updateMessage(Localization.lang(\"One file found\"));\n-            } else {\n-                updateMessage(Localization.lang(\"%0 files found\", Integer.toString(counter)));\n-            }\n+            DefaultTaskExecutor.runInJavaFXThread(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3OTIxOA==", "bodyText": "remove empty line", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551279218", "createdAt": "2021-01-04T12:08:07Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,213 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.nio.file.Files;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.collections.FXCollections;\n+import javafx.event.ActionEvent;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.Tooltip;\n+import javafx.scene.control.TreeView;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileType;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.ControlHelper;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileChooser.ExtensionFilter> fileTypeSelection;\n+    @FXML private TreeView<FileNodeWrapper> tree;\n+    @FXML private Button buttonScan;\n+    @FXML private ButtonType importButton;\n+    @FXML private Button buttonExport;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> tvResult;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        Button btnImport = (Button) this.getDialogPane().lookupButton(importButton);\n+        ControlHelper.setAction(importButton, getDialogPane(), evt-> viewModel.startImport());\n+        btnImport.disableProperty().bindBidirectional(viewModel.applyButtonDisabled());\n+        btnImport.setTooltip(new Tooltip(Localization.lang(\"Starts the import of BibTeX entries.\")));\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3OTU0MQ==", "bodyText": "Make getFileFilters already return an observable list", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551279541", "createdAt": "2021-01-04T12:08:49Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,213 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.nio.file.Files;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.collections.FXCollections;\n+import javafx.event.ActionEvent;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.Tooltip;\n+import javafx.scene.control.TreeView;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileType;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.ControlHelper;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileChooser.ExtensionFilter> fileTypeSelection;\n+    @FXML private TreeView<FileNodeWrapper> tree;\n+    @FXML private Button buttonScan;\n+    @FXML private ButtonType importButton;\n+    @FXML private Button buttonExport;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> tvResult;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        Button btnImport = (Button) this.getDialogPane().lookupButton(importButton);\n+        ControlHelper.setAction(importButton, getDialogPane(), evt-> viewModel.startImport());\n+        btnImport.disableProperty().bindBidirectional(viewModel.applyButtonDisabled());\n+        btnImport.setTooltip(new Tooltip(Localization.lang(\"Starts the import of BibTeX entries.\")));\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+\n+        viewModel = new UnlinkedFilesDialogViewModel(dialogService, ExternalFileTypes.getInstance(), undoManager, fileUpdateMonitor, preferencesService, stateManager, taskExecutor);\n+        viewModel.directoryPath().bindBidirectional(directoryPathField.textProperty());\n+\n+        fileTypeSelection.setItems(FXCollections.observableArrayList(viewModel.getFileFilters()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3OTYwNw==", "bodyText": "indent", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551279607", "createdAt": "2021-01-04T12:09:00Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,213 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.nio.file.Files;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.collections.FXCollections;\n+import javafx.event.ActionEvent;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.Tooltip;\n+import javafx.scene.control.TreeView;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileType;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.ControlHelper;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileChooser.ExtensionFilter> fileTypeSelection;\n+    @FXML private TreeView<FileNodeWrapper> tree;\n+    @FXML private Button buttonScan;\n+    @FXML private ButtonType importButton;\n+    @FXML private Button buttonExport;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> tvResult;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        Button btnImport = (Button) this.getDialogPane().lookupButton(importButton);\n+        ControlHelper.setAction(importButton, getDialogPane(), evt-> viewModel.startImport());\n+        btnImport.disableProperty().bindBidirectional(viewModel.applyButtonDisabled());\n+        btnImport.setTooltip(new Tooltip(Localization.lang(\"Starts the import of BibTeX entries.\")));\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+\n+        viewModel = new UnlinkedFilesDialogViewModel(dialogService, ExternalFileTypes.getInstance(), undoManager, fileUpdateMonitor, preferencesService, stateManager, taskExecutor);\n+        viewModel.directoryPath().bindBidirectional(directoryPathField.textProperty());\n+\n+        fileTypeSelection.setItems(FXCollections.observableArrayList(viewModel.getFileFilters()));\n+        new ViewModelListCellFactory<FileChooser.ExtensionFilter>()\n+        .withText(fileFilter -> fileFilter.getDescription() + fileFilter.getExtensions().stream().collect(Collectors.joining(\", \", \" (\", \")\")))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3OTk0Mw==", "bodyText": "move this lambda to fileFilter.getIcon", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551279943", "createdAt": "2021-01-04T12:09:45Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,213 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.nio.file.Files;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.collections.FXCollections;\n+import javafx.event.ActionEvent;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.Tooltip;\n+import javafx.scene.control.TreeView;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileType;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.ControlHelper;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileChooser.ExtensionFilter> fileTypeSelection;\n+    @FXML private TreeView<FileNodeWrapper> tree;\n+    @FXML private Button buttonScan;\n+    @FXML private ButtonType importButton;\n+    @FXML private Button buttonExport;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> tvResult;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        Button btnImport = (Button) this.getDialogPane().lookupButton(importButton);\n+        ControlHelper.setAction(importButton, getDialogPane(), evt-> viewModel.startImport());\n+        btnImport.disableProperty().bindBidirectional(viewModel.applyButtonDisabled());\n+        btnImport.setTooltip(new Tooltip(Localization.lang(\"Starts the import of BibTeX entries.\")));\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+\n+        viewModel = new UnlinkedFilesDialogViewModel(dialogService, ExternalFileTypes.getInstance(), undoManager, fileUpdateMonitor, preferencesService, stateManager, taskExecutor);\n+        viewModel.directoryPath().bindBidirectional(directoryPathField.textProperty());\n+\n+        fileTypeSelection.setItems(FXCollections.observableArrayList(viewModel.getFileFilters()));\n+        new ViewModelListCellFactory<FileChooser.ExtensionFilter>()\n+        .withText(fileFilter -> fileFilter.getDescription() + fileFilter.getExtensions().stream().collect(Collectors.joining(\", \", \" (\", \")\")))\n+        .withIcon(fileFilter -> ExternalFileTypes.getInstance().getExternalFileTypeByExt(fileFilter.getExtensions().get(0))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4MDIxOA==", "bodyText": "Rename FileNodeWrapper to `FileNodeViewModel", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551280218", "createdAt": "2021-01-04T12:10:20Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,213 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.nio.file.Files;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.collections.FXCollections;\n+import javafx.event.ActionEvent;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.Tooltip;\n+import javafx.scene.control.TreeView;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileType;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.ControlHelper;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileChooser.ExtensionFilter> fileTypeSelection;\n+    @FXML private TreeView<FileNodeWrapper> tree;\n+    @FXML private Button buttonScan;\n+    @FXML private ButtonType importButton;\n+    @FXML private Button buttonExport;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> tvResult;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        Button btnImport = (Button) this.getDialogPane().lookupButton(importButton);\n+        ControlHelper.setAction(importButton, getDialogPane(), evt-> viewModel.startImport());\n+        btnImport.disableProperty().bindBidirectional(viewModel.applyButtonDisabled());\n+        btnImport.setTooltip(new Tooltip(Localization.lang(\"Starts the import of BibTeX entries.\")));\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+\n+        viewModel = new UnlinkedFilesDialogViewModel(dialogService, ExternalFileTypes.getInstance(), undoManager, fileUpdateMonitor, preferencesService, stateManager, taskExecutor);\n+        viewModel.directoryPath().bindBidirectional(directoryPathField.textProperty());\n+\n+        fileTypeSelection.setItems(FXCollections.observableArrayList(viewModel.getFileFilters()));\n+        new ViewModelListCellFactory<FileChooser.ExtensionFilter>()\n+        .withText(fileFilter -> fileFilter.getDescription() + fileFilter.getExtensions().stream().collect(Collectors.joining(\", \", \" (\", \")\")))\n+        .withIcon(fileFilter -> ExternalFileTypes.getInstance().getExternalFileTypeByExt(fileFilter.getExtensions().get(0))\n+                                                 .map(ExternalFileType::getIcon)\n+                                                 .orElse(null))\n+        .install(fileTypeSelection);\n+\n+        new ViewModelTreeCellFactory<FileNodeWrapper>()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4MDM5MQ==", "bodyText": "move lambda to node.getDisplayText", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551280391", "createdAt": "2021-01-04T12:10:47Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,213 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.nio.file.Files;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.collections.FXCollections;\n+import javafx.event.ActionEvent;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.Tooltip;\n+import javafx.scene.control.TreeView;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileType;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.ControlHelper;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileChooser.ExtensionFilter> fileTypeSelection;\n+    @FXML private TreeView<FileNodeWrapper> tree;\n+    @FXML private Button buttonScan;\n+    @FXML private ButtonType importButton;\n+    @FXML private Button buttonExport;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> tvResult;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        Button btnImport = (Button) this.getDialogPane().lookupButton(importButton);\n+        ControlHelper.setAction(importButton, getDialogPane(), evt-> viewModel.startImport());\n+        btnImport.disableProperty().bindBidirectional(viewModel.applyButtonDisabled());\n+        btnImport.setTooltip(new Tooltip(Localization.lang(\"Starts the import of BibTeX entries.\")));\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+\n+        viewModel = new UnlinkedFilesDialogViewModel(dialogService, ExternalFileTypes.getInstance(), undoManager, fileUpdateMonitor, preferencesService, stateManager, taskExecutor);\n+        viewModel.directoryPath().bindBidirectional(directoryPathField.textProperty());\n+\n+        fileTypeSelection.setItems(FXCollections.observableArrayList(viewModel.getFileFilters()));\n+        new ViewModelListCellFactory<FileChooser.ExtensionFilter>()\n+        .withText(fileFilter -> fileFilter.getDescription() + fileFilter.getExtensions().stream().collect(Collectors.joining(\", \", \" (\", \")\")))\n+        .withIcon(fileFilter -> ExternalFileTypes.getInstance().getExternalFileTypeByExt(fileFilter.getExtensions().get(0))\n+                                                 .map(ExternalFileType::getIcon)\n+                                                 .orElse(null))\n+        .install(fileTypeSelection);\n+\n+        new ViewModelTreeCellFactory<FileNodeWrapper>()\n+                .withText(node -> {\n+                    if (Files.isRegularFile(node.path)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4MDYyNA==", "bodyText": "file/files should be localized", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551280624", "createdAt": "2021-01-04T12:11:22Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,213 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.nio.file.Files;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.collections.FXCollections;\n+import javafx.event.ActionEvent;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.Tooltip;\n+import javafx.scene.control.TreeView;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileType;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.ControlHelper;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileChooser.ExtensionFilter> fileTypeSelection;\n+    @FXML private TreeView<FileNodeWrapper> tree;\n+    @FXML private Button buttonScan;\n+    @FXML private ButtonType importButton;\n+    @FXML private Button buttonExport;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> tvResult;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        Button btnImport = (Button) this.getDialogPane().lookupButton(importButton);\n+        ControlHelper.setAction(importButton, getDialogPane(), evt-> viewModel.startImport());\n+        btnImport.disableProperty().bindBidirectional(viewModel.applyButtonDisabled());\n+        btnImport.setTooltip(new Tooltip(Localization.lang(\"Starts the import of BibTeX entries.\")));\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+\n+        viewModel = new UnlinkedFilesDialogViewModel(dialogService, ExternalFileTypes.getInstance(), undoManager, fileUpdateMonitor, preferencesService, stateManager, taskExecutor);\n+        viewModel.directoryPath().bindBidirectional(directoryPathField.textProperty());\n+\n+        fileTypeSelection.setItems(FXCollections.observableArrayList(viewModel.getFileFilters()));\n+        new ViewModelListCellFactory<FileChooser.ExtensionFilter>()\n+        .withText(fileFilter -> fileFilter.getDescription() + fileFilter.getExtensions().stream().collect(Collectors.joining(\", \", \" (\", \")\")))\n+        .withIcon(fileFilter -> ExternalFileTypes.getInstance().getExternalFileTypeByExt(fileFilter.getExtensions().get(0))\n+                                                 .map(ExternalFileType::getIcon)\n+                                                 .orElse(null))\n+        .install(fileTypeSelection);\n+\n+        new ViewModelTreeCellFactory<FileNodeWrapper>()\n+                .withText(node -> {\n+                    if (Files.isRegularFile(node.path)) {\n+                        // File\n+                        return node.path.getFileName().toString();\n+                    } else {\n+                        // Directory\n+                        return node.path.getFileName() + \" (\" + node.fileCount + \" file\" + (node.fileCount > 1 ? \"s\" : \"\") + \")\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4MDgxMg==", "bodyText": "indent", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551280812", "createdAt": "2021-01-04T12:11:47Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,213 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.nio.file.Files;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.collections.FXCollections;\n+import javafx.event.ActionEvent;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.Tooltip;\n+import javafx.scene.control.TreeView;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileType;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.ControlHelper;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileChooser.ExtensionFilter> fileTypeSelection;\n+    @FXML private TreeView<FileNodeWrapper> tree;\n+    @FXML private Button buttonScan;\n+    @FXML private ButtonType importButton;\n+    @FXML private Button buttonExport;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> tvResult;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        Button btnImport = (Button) this.getDialogPane().lookupButton(importButton);\n+        ControlHelper.setAction(importButton, getDialogPane(), evt-> viewModel.startImport());\n+        btnImport.disableProperty().bindBidirectional(viewModel.applyButtonDisabled());\n+        btnImport.setTooltip(new Tooltip(Localization.lang(\"Starts the import of BibTeX entries.\")));\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+\n+        viewModel = new UnlinkedFilesDialogViewModel(dialogService, ExternalFileTypes.getInstance(), undoManager, fileUpdateMonitor, preferencesService, stateManager, taskExecutor);\n+        viewModel.directoryPath().bindBidirectional(directoryPathField.textProperty());\n+\n+        fileTypeSelection.setItems(FXCollections.observableArrayList(viewModel.getFileFilters()));\n+        new ViewModelListCellFactory<FileChooser.ExtensionFilter>()\n+        .withText(fileFilter -> fileFilter.getDescription() + fileFilter.getExtensions().stream().collect(Collectors.joining(\", \", \" (\", \")\")))\n+        .withIcon(fileFilter -> ExternalFileTypes.getInstance().getExternalFileTypeByExt(fileFilter.getExtensions().get(0))\n+                                                 .map(ExternalFileType::getIcon)\n+                                                 .orElse(null))\n+        .install(fileTypeSelection);\n+\n+        new ViewModelTreeCellFactory<FileNodeWrapper>()\n+                .withText(node -> {\n+                    if (Files.isRegularFile(node.path)) {\n+                        // File\n+                        return node.path.getFileName().toString();\n+                    } else {\n+                        // Directory\n+                        return node.path.getFileName() + \" (\" + node.fileCount + \" file\" + (node.fileCount > 1 ? \"s\" : \"\") + \")\";\n+                    }\n+                })\n+                .install(tree);\n+\n+       tree.setPrefWidth(Double.POSITIVE_INFINITY);\n+       viewModel.treeRoot().bindBidirectional(tree.rootProperty());\n+       viewModel.scanButtonDisabled().bindBidirectional(buttonScan.disableProperty());\n+       viewModel.scanButtonDefaultButton().bindBidirectional(buttonScan.defaultButtonProperty());\n+       viewModel.exportButtonDisabled().bindBidirectional(buttonExport.disableProperty());\n+       viewModel.selectedExtension().bind(fileTypeSelection.valueProperty());\n+\n+       tvResult.setItems(viewModel.resultTableItems());\n+\n+       progressDisplay.progressProperty().bind(viewModel.progress());\n+       progressText.textProperty().bind(viewModel.progressText());\n+\n+       progressPane.managedProperty().bind(viewModel.searchProgressVisible());\n+       progressPane.visibleProperty().bind(viewModel.searchProgressVisible());\n+       accordion.disableProperty().bind(viewModel.searchProgressVisible());\n+       tree.maxHeightProperty().bind(((Control) filePane.contentProperty().get()).heightProperty());\n+\n+       viewModel.filePaneExpanded().bindBidirectional(filePane.expandedProperty());\n+       viewModel.resultPaneExpanded().bindBidirectional(resultPane.expandedProperty());\n+\n+       viewModel.scanButtonDefaultButton().setValue(true);\n+       viewModel.scanButtonDisabled().setValue(true);\n+       viewModel.applyButtonDisabled().setValue(true);\n+       fileTypeSelection.getSelectionModel().selectFirst();\n+\n+       setupResultTable();\n+    }\n+\n+    private void setupResultTable() {\n+\n+        colFile.setCellValueFactory(cellData -> cellData.getValue().file());\n+        new ValueTableCellFactory<ImportFilesResultItemViewModel, String>()\n+        .withText(item -> item).withTooltip(item -> item)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4MDg3OQ==", "bodyText": "remove empty line", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551280879", "createdAt": "2021-01-04T12:11:52Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,213 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.nio.file.Files;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.collections.FXCollections;\n+import javafx.event.ActionEvent;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.Tooltip;\n+import javafx.scene.control.TreeView;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileType;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.ControlHelper;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileChooser.ExtensionFilter> fileTypeSelection;\n+    @FXML private TreeView<FileNodeWrapper> tree;\n+    @FXML private Button buttonScan;\n+    @FXML private ButtonType importButton;\n+    @FXML private Button buttonExport;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> tvResult;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        Button btnImport = (Button) this.getDialogPane().lookupButton(importButton);\n+        ControlHelper.setAction(importButton, getDialogPane(), evt-> viewModel.startImport());\n+        btnImport.disableProperty().bindBidirectional(viewModel.applyButtonDisabled());\n+        btnImport.setTooltip(new Tooltip(Localization.lang(\"Starts the import of BibTeX entries.\")));\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+\n+        viewModel = new UnlinkedFilesDialogViewModel(dialogService, ExternalFileTypes.getInstance(), undoManager, fileUpdateMonitor, preferencesService, stateManager, taskExecutor);\n+        viewModel.directoryPath().bindBidirectional(directoryPathField.textProperty());\n+\n+        fileTypeSelection.setItems(FXCollections.observableArrayList(viewModel.getFileFilters()));\n+        new ViewModelListCellFactory<FileChooser.ExtensionFilter>()\n+        .withText(fileFilter -> fileFilter.getDescription() + fileFilter.getExtensions().stream().collect(Collectors.joining(\", \", \" (\", \")\")))\n+        .withIcon(fileFilter -> ExternalFileTypes.getInstance().getExternalFileTypeByExt(fileFilter.getExtensions().get(0))\n+                                                 .map(ExternalFileType::getIcon)\n+                                                 .orElse(null))\n+        .install(fileTypeSelection);\n+\n+        new ViewModelTreeCellFactory<FileNodeWrapper>()\n+                .withText(node -> {\n+                    if (Files.isRegularFile(node.path)) {\n+                        // File\n+                        return node.path.getFileName().toString();\n+                    } else {\n+                        // Directory\n+                        return node.path.getFileName() + \" (\" + node.fileCount + \" file\" + (node.fileCount > 1 ? \"s\" : \"\") + \")\";\n+                    }\n+                })\n+                .install(tree);\n+\n+       tree.setPrefWidth(Double.POSITIVE_INFINITY);\n+       viewModel.treeRoot().bindBidirectional(tree.rootProperty());\n+       viewModel.scanButtonDisabled().bindBidirectional(buttonScan.disableProperty());\n+       viewModel.scanButtonDefaultButton().bindBidirectional(buttonScan.defaultButtonProperty());\n+       viewModel.exportButtonDisabled().bindBidirectional(buttonExport.disableProperty());\n+       viewModel.selectedExtension().bind(fileTypeSelection.valueProperty());\n+\n+       tvResult.setItems(viewModel.resultTableItems());\n+\n+       progressDisplay.progressProperty().bind(viewModel.progress());\n+       progressText.textProperty().bind(viewModel.progressText());\n+\n+       progressPane.managedProperty().bind(viewModel.searchProgressVisible());\n+       progressPane.visibleProperty().bind(viewModel.searchProgressVisible());\n+       accordion.disableProperty().bind(viewModel.searchProgressVisible());\n+       tree.maxHeightProperty().bind(((Control) filePane.contentProperty().get()).heightProperty());\n+\n+       viewModel.filePaneExpanded().bindBidirectional(filePane.expandedProperty());\n+       viewModel.resultPaneExpanded().bindBidirectional(resultPane.expandedProperty());\n+\n+       viewModel.scanButtonDefaultButton().setValue(true);\n+       viewModel.scanButtonDisabled().setValue(true);\n+       viewModel.applyButtonDisabled().setValue(true);\n+       fileTypeSelection.getSelectionModel().selectFirst();\n+\n+       setupResultTable();\n+    }\n+\n+    private void setupResultTable() {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 152}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4MTE3MQ==", "bodyText": "move this logic to getIcon", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551281171", "createdAt": "2021-01-04T12:12:35Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,213 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.nio.file.Files;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.collections.FXCollections;\n+import javafx.event.ActionEvent;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.Tooltip;\n+import javafx.scene.control.TreeView;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileType;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.ControlHelper;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileChooser.ExtensionFilter> fileTypeSelection;\n+    @FXML private TreeView<FileNodeWrapper> tree;\n+    @FXML private Button buttonScan;\n+    @FXML private ButtonType importButton;\n+    @FXML private Button buttonExport;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> tvResult;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        Button btnImport = (Button) this.getDialogPane().lookupButton(importButton);\n+        ControlHelper.setAction(importButton, getDialogPane(), evt-> viewModel.startImport());\n+        btnImport.disableProperty().bindBidirectional(viewModel.applyButtonDisabled());\n+        btnImport.setTooltip(new Tooltip(Localization.lang(\"Starts the import of BibTeX entries.\")));\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+\n+        viewModel = new UnlinkedFilesDialogViewModel(dialogService, ExternalFileTypes.getInstance(), undoManager, fileUpdateMonitor, preferencesService, stateManager, taskExecutor);\n+        viewModel.directoryPath().bindBidirectional(directoryPathField.textProperty());\n+\n+        fileTypeSelection.setItems(FXCollections.observableArrayList(viewModel.getFileFilters()));\n+        new ViewModelListCellFactory<FileChooser.ExtensionFilter>()\n+        .withText(fileFilter -> fileFilter.getDescription() + fileFilter.getExtensions().stream().collect(Collectors.joining(\", \", \" (\", \")\")))\n+        .withIcon(fileFilter -> ExternalFileTypes.getInstance().getExternalFileTypeByExt(fileFilter.getExtensions().get(0))\n+                                                 .map(ExternalFileType::getIcon)\n+                                                 .orElse(null))\n+        .install(fileTypeSelection);\n+\n+        new ViewModelTreeCellFactory<FileNodeWrapper>()\n+                .withText(node -> {\n+                    if (Files.isRegularFile(node.path)) {\n+                        // File\n+                        return node.path.getFileName().toString();\n+                    } else {\n+                        // Directory\n+                        return node.path.getFileName() + \" (\" + node.fileCount + \" file\" + (node.fileCount > 1 ? \"s\" : \"\") + \")\";\n+                    }\n+                })\n+                .install(tree);\n+\n+       tree.setPrefWidth(Double.POSITIVE_INFINITY);\n+       viewModel.treeRoot().bindBidirectional(tree.rootProperty());\n+       viewModel.scanButtonDisabled().bindBidirectional(buttonScan.disableProperty());\n+       viewModel.scanButtonDefaultButton().bindBidirectional(buttonScan.defaultButtonProperty());\n+       viewModel.exportButtonDisabled().bindBidirectional(buttonExport.disableProperty());\n+       viewModel.selectedExtension().bind(fileTypeSelection.valueProperty());\n+\n+       tvResult.setItems(viewModel.resultTableItems());\n+\n+       progressDisplay.progressProperty().bind(viewModel.progress());\n+       progressText.textProperty().bind(viewModel.progressText());\n+\n+       progressPane.managedProperty().bind(viewModel.searchProgressVisible());\n+       progressPane.visibleProperty().bind(viewModel.searchProgressVisible());\n+       accordion.disableProperty().bind(viewModel.searchProgressVisible());\n+       tree.maxHeightProperty().bind(((Control) filePane.contentProperty().get()).heightProperty());\n+\n+       viewModel.filePaneExpanded().bindBidirectional(filePane.expandedProperty());\n+       viewModel.resultPaneExpanded().bindBidirectional(resultPane.expandedProperty());\n+\n+       viewModel.scanButtonDefaultButton().setValue(true);\n+       viewModel.scanButtonDisabled().setValue(true);\n+       viewModel.applyButtonDisabled().setValue(true);\n+       fileTypeSelection.getSelectionModel().selectFirst();\n+\n+       setupResultTable();\n+    }\n+\n+    private void setupResultTable() {\n+\n+        colFile.setCellValueFactory(cellData -> cellData.getValue().file());\n+        new ValueTableCellFactory<ImportFilesResultItemViewModel, String>()\n+        .withText(item -> item).withTooltip(item -> item)\n+        .install(colFile);\n+\n+        colMessage.setCellValueFactory(cellData -> cellData.getValue().message());\n+        new ValueTableCellFactory<ImportFilesResultItemViewModel, String>()\n+        .withText(item->item).withTooltip(item->item)\n+        .install(colMessage);\n+\n+        colStatus.setCellValueFactory(cellData -> cellData.getValue().getIcon());\n+\n+        colStatus.setCellFactory(new ValueTableCellFactory<ImportFilesResultItemViewModel, JabRefIcon>().withGraphic(item -> {\n+            if (item == IconTheme.JabRefIcons.CHECK) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 166}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4MjA4NA==", "bodyText": "rename variable", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551282084", "createdAt": "2021-01-04T12:14:54Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogViewModel.java", "diffHunk": "@@ -0,0 +1,370 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.io.BufferedWriter;\n+import java.io.FileFilter;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.StandardOpenOption;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.DoubleProperty;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleDoubleProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.beans.property.SimpleStringProperty;\n+import javafx.beans.property.StringProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import javafx.scene.control.CheckBoxTreeItem;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TreeItem;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.util.BackgroundTask;\n+import org.jabref.gui.util.DirectoryDialogConfiguration;\n+import org.jabref.gui.util.FileDialogConfiguration;\n+import org.jabref.gui.util.FileFilterConverter;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.logic.util.StandardFileType;\n+import org.jabref.model.database.BibDatabaseContext;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class UnlinkedFilesDialogViewModel {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(UnlinkedFilesDialogViewModel.class);\n+\n+    private final ImportHandler importHandler;\n+    private final StringProperty directoryPath = new SimpleStringProperty(\"\");\n+    private final ObjectProperty<FileChooser.ExtensionFilter> selectedExtension = new SimpleObjectProperty<>();\n+\n+    private final BooleanProperty searchProgressVisible = new SimpleBooleanProperty(false);\n+    private final BooleanProperty applyButtonDisabled = new SimpleBooleanProperty();\n+    private final BooleanProperty scanButtonDisabled = new SimpleBooleanProperty(true);\n+    private final BooleanProperty exportButtonDisabled = new SimpleBooleanProperty();\n+    private final ObjectProperty<TreeItem<FileNodeWrapper>> treeRoot = new SimpleObjectProperty<>();\n+    private final BooleanProperty scanButtonDefaultButton = new SimpleBooleanProperty();\n+    private final DoubleProperty progress = new SimpleDoubleProperty(0);\n+    private final StringProperty progressText = new SimpleStringProperty();\n+    private final BooleanProperty filePaneExpanded = new SimpleBooleanProperty();\n+    private final BooleanProperty resultPaneExpanded = new SimpleBooleanProperty();\n+\n+    private final ObservableList<ImportFilesResultItemViewModel> resultList = FXCollections.observableArrayList();\n+\n+    private final List<FileChooser.ExtensionFilter> fileFilterList = List.of(\n+                                                                             FileFilterConverter.ANY_FILE,\n+                                                                             FileFilterConverter.toExtensionFilter(StandardFileType.PDF),\n+                                                                             FileFilterConverter.toExtensionFilter(StandardFileType.BIBTEX_DB));\n+    private final DialogService dialogService;\n+    private final PreferencesService preferences;\n+    private BackgroundTask<CheckBoxTreeItem<FileNodeWrapper>> findUnlinkedFilesTask;\n+    private BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesBackgroundTask;\n+\n+    private final BibDatabaseContext bibDatabasecontext;\n+    private final TaskExecutor taskExecutor;\n+\n+    public UnlinkedFilesDialogViewModel(DialogService dialogService, ExternalFileTypes externalFileTypes, UndoManager undoManager,\n+                                        FileUpdateMonitor fileUpdateMonitor, PreferencesService preferences, StateManager stateManager, TaskExecutor taskExecutor) {\n+        this.preferences = preferences;\n+        this.dialogService = dialogService;\n+        this.taskExecutor = taskExecutor;\n+        this.bibDatabasecontext = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4MjQ4NQ==", "bodyText": "The viewmodel should be free of any javafx controls, i.e. no javafx.scene  imports", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551282485", "createdAt": "2021-01-04T12:15:45Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogViewModel.java", "diffHunk": "@@ -0,0 +1,370 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.io.BufferedWriter;\n+import java.io.FileFilter;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.StandardOpenOption;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.DoubleProperty;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleDoubleProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.beans.property.SimpleStringProperty;\n+import javafx.beans.property.StringProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import javafx.scene.control.CheckBoxTreeItem;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4MjYyOA==", "bodyText": "indent", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551282628", "createdAt": "2021-01-04T12:16:02Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogViewModel.java", "diffHunk": "@@ -0,0 +1,370 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.io.BufferedWriter;\n+import java.io.FileFilter;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.StandardOpenOption;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.DoubleProperty;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleDoubleProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.beans.property.SimpleStringProperty;\n+import javafx.beans.property.StringProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import javafx.scene.control.CheckBoxTreeItem;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TreeItem;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.util.BackgroundTask;\n+import org.jabref.gui.util.DirectoryDialogConfiguration;\n+import org.jabref.gui.util.FileDialogConfiguration;\n+import org.jabref.gui.util.FileFilterConverter;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.logic.util.StandardFileType;\n+import org.jabref.model.database.BibDatabaseContext;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class UnlinkedFilesDialogViewModel {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(UnlinkedFilesDialogViewModel.class);\n+\n+    private final ImportHandler importHandler;\n+    private final StringProperty directoryPath = new SimpleStringProperty(\"\");\n+    private final ObjectProperty<FileChooser.ExtensionFilter> selectedExtension = new SimpleObjectProperty<>();\n+\n+    private final BooleanProperty searchProgressVisible = new SimpleBooleanProperty(false);\n+    private final BooleanProperty applyButtonDisabled = new SimpleBooleanProperty();\n+    private final BooleanProperty scanButtonDisabled = new SimpleBooleanProperty(true);\n+    private final BooleanProperty exportButtonDisabled = new SimpleBooleanProperty();\n+    private final ObjectProperty<TreeItem<FileNodeWrapper>> treeRoot = new SimpleObjectProperty<>();\n+    private final BooleanProperty scanButtonDefaultButton = new SimpleBooleanProperty();\n+    private final DoubleProperty progress = new SimpleDoubleProperty(0);\n+    private final StringProperty progressText = new SimpleStringProperty();\n+    private final BooleanProperty filePaneExpanded = new SimpleBooleanProperty();\n+    private final BooleanProperty resultPaneExpanded = new SimpleBooleanProperty();\n+\n+    private final ObservableList<ImportFilesResultItemViewModel> resultList = FXCollections.observableArrayList();\n+\n+    private final List<FileChooser.ExtensionFilter> fileFilterList = List.of(\n+                                                                             FileFilterConverter.ANY_FILE,\n+                                                                             FileFilterConverter.toExtensionFilter(StandardFileType.PDF),\n+                                                                             FileFilterConverter.toExtensionFilter(StandardFileType.BIBTEX_DB));\n+    private final DialogService dialogService;\n+    private final PreferencesService preferences;\n+    private BackgroundTask<CheckBoxTreeItem<FileNodeWrapper>> findUnlinkedFilesTask;\n+    private BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesBackgroundTask;\n+\n+    private final BibDatabaseContext bibDatabasecontext;\n+    private final TaskExecutor taskExecutor;\n+\n+    public UnlinkedFilesDialogViewModel(DialogService dialogService, ExternalFileTypes externalFileTypes, UndoManager undoManager,\n+                                        FileUpdateMonitor fileUpdateMonitor, PreferencesService preferences, StateManager stateManager, TaskExecutor taskExecutor) {\n+        this.preferences = preferences;\n+        this.dialogService = dialogService;\n+        this.taskExecutor = taskExecutor;\n+        this.bibDatabasecontext = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n+        importHandler = new ImportHandler(\n+                                          dialogService,\n+                                          bibDatabasecontext,\n+                                          externalFileTypes,\n+                                          preferences,\n+                                          fileUpdateMonitor,\n+                                          undoManager,\n+                                          stateManager);\n+    }\n+\n+    public void startImport() {\n+\n+        CheckBoxTreeItem<FileNodeWrapper> root = (CheckBoxTreeItem<FileNodeWrapper>) treeRoot.getValue();\n+        final List<Path> fileList = getFileListFromNode(root);\n+\n+        resultList.clear();\n+\n+        if (fileList.isEmpty()) {\n+            return;\n+        }\n+\n+        importFilesBackgroundTask = importHandler.importFilesInBackground(fileList)\n+        .onRunning(() -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4MjkzMQ==", "bodyText": "remove empty lines...a lot", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551282931", "createdAt": "2021-01-04T12:16:42Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogViewModel.java", "diffHunk": "@@ -0,0 +1,370 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.io.BufferedWriter;\n+import java.io.FileFilter;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.StandardOpenOption;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.DoubleProperty;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleDoubleProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.beans.property.SimpleStringProperty;\n+import javafx.beans.property.StringProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import javafx.scene.control.CheckBoxTreeItem;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TreeItem;\n+import javafx.stage.FileChooser;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.util.BackgroundTask;\n+import org.jabref.gui.util.DirectoryDialogConfiguration;\n+import org.jabref.gui.util.FileDialogConfiguration;\n+import org.jabref.gui.util.FileFilterConverter;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.logic.util.StandardFileType;\n+import org.jabref.model.database.BibDatabaseContext;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class UnlinkedFilesDialogViewModel {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(UnlinkedFilesDialogViewModel.class);\n+\n+    private final ImportHandler importHandler;\n+    private final StringProperty directoryPath = new SimpleStringProperty(\"\");\n+    private final ObjectProperty<FileChooser.ExtensionFilter> selectedExtension = new SimpleObjectProperty<>();\n+\n+    private final BooleanProperty searchProgressVisible = new SimpleBooleanProperty(false);\n+    private final BooleanProperty applyButtonDisabled = new SimpleBooleanProperty();\n+    private final BooleanProperty scanButtonDisabled = new SimpleBooleanProperty(true);\n+    private final BooleanProperty exportButtonDisabled = new SimpleBooleanProperty();\n+    private final ObjectProperty<TreeItem<FileNodeWrapper>> treeRoot = new SimpleObjectProperty<>();\n+    private final BooleanProperty scanButtonDefaultButton = new SimpleBooleanProperty();\n+    private final DoubleProperty progress = new SimpleDoubleProperty(0);\n+    private final StringProperty progressText = new SimpleStringProperty();\n+    private final BooleanProperty filePaneExpanded = new SimpleBooleanProperty();\n+    private final BooleanProperty resultPaneExpanded = new SimpleBooleanProperty();\n+\n+    private final ObservableList<ImportFilesResultItemViewModel> resultList = FXCollections.observableArrayList();\n+\n+    private final List<FileChooser.ExtensionFilter> fileFilterList = List.of(\n+                                                                             FileFilterConverter.ANY_FILE,\n+                                                                             FileFilterConverter.toExtensionFilter(StandardFileType.PDF),\n+                                                                             FileFilterConverter.toExtensionFilter(StandardFileType.BIBTEX_DB));\n+    private final DialogService dialogService;\n+    private final PreferencesService preferences;\n+    private BackgroundTask<CheckBoxTreeItem<FileNodeWrapper>> findUnlinkedFilesTask;\n+    private BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesBackgroundTask;\n+\n+    private final BibDatabaseContext bibDatabasecontext;\n+    private final TaskExecutor taskExecutor;\n+\n+    public UnlinkedFilesDialogViewModel(DialogService dialogService, ExternalFileTypes externalFileTypes, UndoManager undoManager,\n+                                        FileUpdateMonitor fileUpdateMonitor, PreferencesService preferences, StateManager stateManager, TaskExecutor taskExecutor) {\n+        this.preferences = preferences;\n+        this.dialogService = dialogService;\n+        this.taskExecutor = taskExecutor;\n+        this.bibDatabasecontext = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n+        importHandler = new ImportHandler(\n+                                          dialogService,\n+                                          bibDatabasecontext,\n+                                          externalFileTypes,\n+                                          preferences,\n+                                          fileUpdateMonitor,\n+                                          undoManager,\n+                                          stateManager);\n+    }\n+\n+    public void startImport() {\n+\n+        CheckBoxTreeItem<FileNodeWrapper> root = (CheckBoxTreeItem<FileNodeWrapper>) treeRoot.getValue();\n+        final List<Path> fileList = getFileListFromNode(root);\n+\n+        resultList.clear();\n+\n+        if (fileList.isEmpty()) {\n+            return;\n+        }\n+\n+        importFilesBackgroundTask = importHandler.importFilesInBackground(fileList)\n+        .onRunning(() -> {\n+            progress.bind(importFilesBackgroundTask.workDonePercentageProperty());\n+            progressText.bind(importFilesBackgroundTask.messageProperty());\n+\n+            searchProgressVisible.setValue(true);\n+            scanButtonDisabled.setValue(true);\n+            applyButtonDisabled.setValue(true);\n+         })\n+        .onFinished(() -> {\n+            progress.unbind();\n+            progressText.unbind();\n+            searchProgressVisible.setValue(false);\n+            scanButtonDisabled.setValue(false);\n+\n+        })\n+        .onSuccess(results -> {\n+           applyButtonDisabled.setValue(false);\n+           exportButtonDisabled.setValue(false);\n+           scanButtonDefaultButton.setValue(false);\n+\n+           progress.unbind();\n+           progressText.unbind();\n+           searchProgressVisible.setValue(false);\n+\n+           filePaneExpanded.setValue(false);\n+           resultPaneExpanded.setValue(true);\n+           resultList.addAll(results);\n+\n+        });\n+        importFilesBackgroundTask.executeWith(taskExecutor);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4NDQxMw==", "bodyText": "Isn't Object better here instead of T? Otherwise all params need to have the same type, don't they?", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r551284413", "createdAt": "2021-01-04T12:19:52Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/l10n/Localization.java", "diffHunk": "@@ -48,13 +49,15 @@ private Localization() {\n      * @param params Replacement strings for parameters %0, %1, etc.\n      * @return The message with replaced parameters\n      */\n-    public static String lang(String key, String... params) {\n+    public static <T> String lang(String key, T... params) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d439a863f0eed2c2ffca5ff64e723e54bc41bcd", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/0d439a863f0eed2c2ffca5ff64e723e54bc41bcd", "committedDate": "2021-01-04T13:54:53Z", "message": "fix changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "408f6e6ff715da6719b8b1143a7eefe98f0540c9", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/408f6e6ff715da6719b8b1143a7eefe98f0540c9", "committedDate": "2021-01-04T14:16:05Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  fix compiler error\n  workaround for eclipse compile error\n  Fix link\n  Bump checkstyle from 8.38 to 8.39 (#7284)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bc4acb77c258dff9aa6138dd6499fcf93ecc7e7", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/6bc4acb77c258dff9aa6138dd6499fcf93ecc7e7", "committedDate": "2021-01-04T14:28:53Z", "message": "fix wrong loop var\nfix dnd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e7544a3ce7f8e1f947c668a60517ae7959e5130", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/9e7544a3ce7f8e1f947c668a60517ae7959e5130", "committedDate": "2021-01-05T16:02:43Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Fix typo for small pi (#7296)\n  Fix Normalize pages formatter not replacing dashes (#7243)\n  Simplify LO connection and fix threading errors (#7271)\n  Fix for issue 7287 (#7290)\n\n# Conflicts:\n#\tsrc/main/resources/l10n/JabRef_en.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e059988d76900bf08cae11854ed70dcaf7ddfa44", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/e059988d76900bf08cae11854ed70dcaf7ddfa44", "committedDate": "2021-01-05T16:42:52Z", "message": "refactor\nonly call pdf import when xmp did not find a result"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyNjMwNDc3", "url": "https://github.com/JabRef/jabref/pull/7209#pullrequestreview-562630477", "createdAt": "2021-01-06T11:38:43Z", "commit": {"oid": "e059988d76900bf08cae11854ed70dcaf7ddfa44"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxMTozODo0M1rOIO7aDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQxMTozODo0M1rOIO7aDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjUyNDMwMg==", "bodyText": "The view class shouldn't contain any logic, so all these 3 methods here should go to appropriate view model classes (probably a ExtensionFilterViewModel needs to be introduced for this).", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r552524302", "createdAt": "2021-01-06T11:38:43Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -210,4 +188,33 @@ void exportSelected(ActionEvent event) {\n        viewModel.startExport();\n     }\n \n+    private JabRefIcon getFileFilterIcon(FileChooser.ExtensionFilter fileFilter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e059988d76900bf08cae11854ed70dcaf7ddfa44"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "179c3498e21fae5249d83aebcc63310a8a7dd365", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/179c3498e21fae5249d83aebcc63310a8a7dd365", "committedDate": "2021-01-07T14:39:34Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Adjust zbmath fetcher (#7298)\n  Add \"acm-siggraph.csl\" required by CitationStyle.java\n  Added Keyboard shortcuts (clear/set read status) (#7302)\n  Add special fields ADR (#7300)\n  Overwrite local copies\n  Squashed 'buildres/csl/csl-locales/' content from commit ecb8e70233\n  Squashed 'buildres/csl/csl-styles/' content from commit 737ffa1505\n  Adapt workflow and build.gradle\n  Move CSL to buildres/csl to speedup \"processResources\" during development"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c52f0d76235a7fd2d7eb41e3b7e5b8e41de8703b", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/c52f0d76235a7fd2d7eb41e3b7e5b8e41de8703b", "committedDate": "2021-01-07T15:40:45Z", "message": "create viewModel for filter model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "266a8c378243ef3756573bf01aa1d6c7d205b824", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/266a8c378243ef3756573bf01aa1d6c7d205b824", "committedDate": "2021-01-07T19:03:03Z", "message": "wip refactor like in parse latex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81e7b449eb79eecc6d79dfab5ce08c8eb3f5561f", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/81e7b449eb79eecc6d79dfab5ce08c8eb3f5561f", "committedDate": "2021-01-08T14:57:44Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Remove obsolete registry patch file (#7316)\n  Fix AUTHORS\n  GitBook: [master] one page modified\n  Remove broken Sonarqube integration (#7315)\n  GitBook: [master] 5 pages and 32 assets modified\n  docs: update license year (#7314)\n  Add javafx version number + update javafx (#7312)\n  Add missing authors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5b21f2f6a2881547575325c46f3dd785c666a10", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/b5b21f2f6a2881547575325c46f3dd785c666a10", "committedDate": "2021-01-10T16:16:52Z", "message": "fix view model stuff\nadapt to check View model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d50a9d6fd669e67c256386ffa99463b89d477306", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/d50a9d6fd669e67c256386ffa99463b89d477306", "committedDate": "2021-01-10T16:24:54Z", "message": "add validator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cd75e57a188b1fdb8d1aa078431f83e1572c51c", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/0cd75e57a188b1fdb8d1aa078431f83e1572c51c", "committedDate": "2021-01-10T16:29:02Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Fixed exception about missing custom css file (#7292)\n  Update the templates for opening a new issue (#7321)\n  Entitlements file Mac (#7317)\n  Make CONTRIBUTING.md much shorter. Move long text to docs/contributing.md (#7293)\n  Include Github-optimized screenshot into repository (#7318)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aebd602c22270175713642b499bb976da3d1d470", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/aebd602c22270175713642b499bb976da3d1d470", "committedDate": "2021-01-10T17:00:41Z", "message": "fix selection and export\nmove file node view model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e8cfbb556b4645e098ad1ca91c93c1cd431763a", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/0e8cfbb556b4645e098ad1ca91c93c1cd431763a", "committedDate": "2021-01-10T17:12:26Z", "message": "fix bug using wrong parameter\nremove l10n keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "950655ca0f9ae2327e145b85e21677f535edf135", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/950655ca0f9ae2327e145b85e21677f535edf135", "committedDate": "2021-01-10T18:05:44Z", "message": "Refactored some style issues and a minor suggestions of IntelliJ"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4503d1e39ea8f6e51f8e1b446074708f75d89631", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/4503d1e39ea8f6e51f8e1b446074708f75d89631", "committedDate": "2021-01-10T18:18:21Z", "message": "l10n"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0426fd260f8b082751539b33909c26ed70e89856", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/0426fd260f8b082751539b33909c26ed70e89856", "committedDate": "2021-01-13T17:15:10Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Update guidelines-for-setting-up-a-local-workspace.md (#7339)\n  Updates to colored group indicator for cited entries (#7173)\n  Add some special fields as default columns (#7286)\n  Add a more descriptive path when Directory cannot be found (#7232)\n  Bump antlr4 from 4.9 to 4.9.1 (#7327)\n  Bump unirest-java from 3.11.09 to 3.11.10 (#7329)\n  Bump mockito-core from 3.6.28 to 3.7.0 (#7328)\n  Bump antlr4-runtime from 4.9 to 4.9.1 (#7330)\n  Bump gittools/actions from v0.9.7 to v0.9.8 (#7331)\n  Update to gradle 6.8 (#7324)\n  Link to GitHub contributors in about dialog (#7319)\n  Fix snapcraft upload (#7263)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d1dd9041064f9ec353ec42c0d858376ab3dacc3", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/3d1dd9041064f9ec353ec42c0d858376ab3dacc3", "committedDate": "2021-01-13T17:34:50Z", "message": "only show results after import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bc1ddcdd552e611f67a39f671bb5ec389445f2d", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/2bc1ddcdd552e611f67a39f671bb5ec389445f2d", "committedDate": "2021-01-13T17:40:32Z", "message": "Merge branch 'importerbackgroundtask' of github.com:JabRef/jabref into importerbackgroundtask\n\n* 'importerbackgroundtask' of github.com:JabRef/jabref:\n  l10n\n  Refactored some style issues and a minor suggestions of IntelliJ\n\n# Conflicts:\n#\tsrc/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogViewModel.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8e4e35786fd1b396893377d79acef2df3d8b789", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/b8e4e35786fd1b396893377d79acef2df3d8b789", "committedDate": "2021-01-14T17:39:34Z", "message": "Add custom skin for putting arrow to the right"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9778d0197fd27dbc49554c883eba9e4376b34e80", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/9778d0197fd27dbc49554c883eba9e4376b34e80", "committedDate": "2021-01-14T17:57:23Z", "message": "add checkstyle exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3acb2b3bb32ca535627102ed8613f175c37a6dc", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/c3acb2b3bb32ca535627102ed8613f175c37a6dc", "committedDate": "2021-01-14T17:58:45Z", "message": "only change import order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "473aac77aa5fff4b07b928c7ad89ab7d41e51da8", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/473aac77aa5fff4b07b928c7ad89ab7d41e51da8", "committedDate": "2021-01-14T18:16:53Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbe221019da8e083a93e55a63e5b6de320627d58", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/bbe221019da8e083a93e55a63e5b6de320627d58", "committedDate": "2021-01-14T18:22:59Z", "message": "load custom skin only on accordion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35fcac955d727f276c3d8cf2e279913cf1b2d2ba", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/35fcac955d727f276c3d8cf2e279913cf1b2d2ba", "committedDate": "2021-01-15T20:30:41Z", "message": "Add arrow rotation hack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e21a060167682e5148ffbb0755ed94968c2e9e08", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/e21a060167682e5148ffbb0755ed94968c2e9e08", "committedDate": "2021-01-15T20:32:07Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Fix regex (#7352)\n  Disable certain fetcher tests on CI (#7348)\n  Add date fields (#7334)\n\n# Conflicts:\n#\tsrc/main/java/org/jabref/logic/externalfiles/ExternalFilesContentImporter.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ec265162cab3d3da7092d71104acf2764b0ba5d", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/7ec265162cab3d3da7092d71104acf2764b0ba5d", "committedDate": "2021-01-15T20:34:10Z", "message": "Fix merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c11d0c310d4c89faf4df3b7cb0921cd77d71e082", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/c11d0c310d4c89faf4df3b7cb0921cd77d71e082", "committedDate": "2021-01-17T12:58:28Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Export urldate to MSOffice (#7357)\n  Fix DOI fetcher and add documentation on fetcher trust levels (#6990)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "686af8f0c7ce8e5e0bff83460fe2cebd022d8be8", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/686af8f0c7ce8e5e0bff83460fe2cebd022d8be8", "committedDate": "2021-01-17T13:05:18Z", "message": "Set disable instead of visible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef0cc31ebd9278314206e34163e47fd3fc87260a", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/ef0cc31ebd9278314206e34163e47fd3fc87260a", "committedDate": "2021-01-17T16:54:15Z", "message": "Fixed jumping arrow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1ef47460e3065730e5f87ff040afed0ec60d927", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/b1ef47460e3065730e5f87ff040afed0ec60d927", "committedDate": "2021-01-18T19:00:35Z", "message": "Refactored for mvvm pattern and optics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c", "author": {"user": {"login": "koppor", "name": "Oliver Kopp"}}, "url": "https://github.com/JabRef/jabref/commit/9b28692563bdec847ea814f9d1063373df4b806c", "committedDate": "2021-01-20T22:59:49Z", "message": "Remove obsolete language key"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTczODE4MDI4", "url": "https://github.com/JabRef/jabref/pull/7209#pullrequestreview-573818028", "createdAt": "2021-01-21T23:24:12Z", "commit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQyMzoyNDoxMlrOIYNz5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQyMzoyNjowNFrOIYN2eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjI2MzAxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        <Tooltip text=\"Starts the import of BibTeX entries.\"/>\n          \n          \n            \n                                        <Tooltip text=\"%Starts the import of BibTeX entries.\"/>\n          \n      \n    \n    \n  \n\nPlease undo the removal in JabRef_en.properties", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562263013", "createdAt": "2021-01-21T23:24:12Z", "author": {"login": "koppor"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialog.fxml", "diffHunk": "@@ -0,0 +1,111 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<?import javafx.scene.control.Accordion?>\n+<?import javafx.scene.control.Button?>\n+<?import javafx.scene.control.ButtonBar?>\n+<?import javafx.scene.control.ButtonType?>\n+<?import javafx.scene.control.ComboBox?>\n+<?import javafx.scene.control.DialogPane?>\n+<?import javafx.scene.control.Label?>\n+<?import javafx.scene.control.ProgressIndicator?>\n+<?import javafx.scene.control.ScrollPane?>\n+<?import javafx.scene.control.TableColumn?>\n+<?import javafx.scene.control.TableView?>\n+<?import javafx.scene.control.TextField?>\n+<?import javafx.scene.control.TitledPane?>\n+<?import javafx.scene.control.Tooltip?>\n+<?import javafx.scene.layout.BorderPane?>\n+<?import javafx.scene.layout.ColumnConstraints?>\n+<?import javafx.scene.layout.GridPane?>\n+<?import javafx.scene.layout.RowConstraints?>\n+<?import javafx.scene.layout.StackPane?>\n+<?import javafx.scene.layout.VBox?>\n+<?import org.jabref.gui.icon.JabRefIconView?>\n+<?import org.controlsfx.control.CheckTreeView?>\n+<DialogPane xmlns=\"http://javafx.com/javafx/15.0.1\" xmlns:fx=\"http://javafx.com/fxml/1\"\n+            fx:controller=\"org.jabref.gui.externalfiles.UnlinkedFilesDialogView\"\n+            prefWidth=\"600.0\">\n+    <content>\n+        <VBox spacing=\"10.0\">\n+            <GridPane hgap=\"10.0\" vgap=\"4.0\">\n+            <columnConstraints>\n+                <ColumnConstraints hgrow=\"SOMETIMES\"/>\n+                <ColumnConstraints hgrow=\"ALWAYS\"/>\n+                <ColumnConstraints hgrow=\"SOMETIMES\"/>\n+            </columnConstraints>\n+            <rowConstraints>\n+                <RowConstraints minHeight=\"10.0\" vgrow=\"SOMETIMES\"/>\n+                <RowConstraints minHeight=\"10.0\" vgrow=\"SOMETIMES\"/>\n+            </rowConstraints>\n+                <Label text=\"%Start directory:\" GridPane.columnIndex=\"0\" GridPane.rowIndex=\"0\"/>\n+                <TextField fx:id=\"directoryPathField\" GridPane.columnIndex=\"1\" GridPane.rowIndex=\"0\"/>\n+                <Button onAction=\"#browseFileDirectory\" styleClass=\"icon-button,narrow\"\n+                        GridPane.columnIndex=\"2\" GridPane.rowIndex=\"0\"\n+                        prefHeight=\"20.0\" prefWidth=\"20.0\">\n+                    <graphic>\n+                        <JabRefIconView glyph=\"OPEN\"/>\n+                    </graphic>\n+                    <tooltip>\n+                        <Tooltip text=\"%Browse\"/>\n+                    </tooltip>\n+                </Button>\n+\n+                <Label text=\"%File extension:\" GridPane.columnIndex=\"0\" GridPane.rowIndex=\"1\"/>\n+                <ComboBox fx:id=\"fileTypeCombo\" maxWidth=\"Infinity\" GridPane.columnIndex=\"1\" GridPane.rowIndex=\"1\"/>\n+                <Button fx:id=\"scanButton\" onAction=\"#scanFiles\" text=\"%Scan directory\"\n+                        GridPane.columnIndex=\"2\" GridPane.rowIndex=\"1\">\n+                    <tooltip>\n+                        <Tooltip text=\"%Searches the selected directory for unlinked files.\"/>\n+                    </tooltip>\n+                </Button>\n+            </GridPane>\n+            <StackPane VBox.vgrow=\"ALWAYS\">\n+                <Accordion fx:id=\"accordion\" minHeight=\"300.0\" prefHeight=\"300.0\" maxHeight=\"300.0\">\n+                    <panes>\n+                        <TitledPane fx:id=\"filePane\" text=\"%Currently unlinked files\">\n+                            <ScrollPane fitToWidth=\"true\">\n+                                <CheckTreeView fx:id=\"unlinkedFilesList\"/>\n+                            </ScrollPane>\n+                        </TitledPane>\n+                        <TitledPane fx:id=\"resultPane\" text=\"%Import result\" disable=\"true\">\n+                            <TableView fx:id=\"importResultTable\">\n+                                <columns>\n+                                    <TableColumn fx:id=\"colStatus\" prefWidth=\"100.0\" text=\"%Status\"/>\n+                                    <TableColumn fx:id=\"colMessage\" prefWidth=\"300.0\" text=\"%Message\"/>\n+                                    <TableColumn fx:id=\"colFile\" prefWidth=\"500.0\" text=\"%File\"/>\n+                                </columns>\n+                                <columnResizePolicy>\n+                                    <TableView fx:constant=\"CONSTRAINED_RESIZE_POLICY\"/>\n+                                </columnResizePolicy>\n+                            </TableView>\n+                        </TitledPane>\n+                    </panes>\n+                </Accordion>\n+                <VBox fx:id=\"progressPane\" alignment=\"CENTER\" StackPane.alignment=\"CENTER\">\n+                    <ProgressIndicator fx:id=\"progressDisplay\" maxHeight=\"50.0\" maxWidth=\"50.0\"\n+                                       prefHeight=\"50.0\" prefWidth=\"50.0\" progress=\"0.0\"/>\n+                    <Label fx:id=\"progressText\" text=\"%Searching file system...\"/>\n+                </VBox>\n+            </StackPane>\n+            <ButtonBar buttonMinWidth=\"80.0\" BorderPane.alignment=\"CENTER\">\n+                <buttons>\n+                    <Button onAction=\"#selectAll\" text=\"%Select all\" ButtonBar.buttonData=\"OTHER\"/>\n+                    <Button onAction=\"#unselectAll\" text=\"%Unselect all\" ButtonBar.buttonData=\"OTHER\"/>\n+                    <Button onAction=\"#collapseAll\" text=\"%Collapse all\" ButtonBar.buttonData=\"OTHER\"/>\n+                    <Button onAction=\"#expandAll\" text=\"%Expand all\" ButtonBar.buttonData=\"OTHER\"/>\n+                    <Button onAction=\"#exportSelected\" text=\"%Export selected\" fx:id=\"exportButton\" ButtonBar.buttonData=\"OTHER\">\n+                        <tooltip>\n+                            <Tooltip text=\"%Export to text file.\"/>\n+                        </tooltip>\n+                    </Button>\n+                    <Button onAction=\"#startImport\" text=\"%Import\" fx:id=\"importButton\" ButtonBar.buttonData=\"APPLY\">\n+                        <tooltip>\n+                            <Tooltip text=\"Starts the import of BibTeX entries.\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjI2MzE2MQ==", "bodyText": "5 years ago, We had a huge debate how to write BibTeX. We decided for BibTeX (see koppor#434). Could you please change it here, too?", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562263161", "createdAt": "2021-01-21T23:24:40Z", "author": {"login": "koppor"}, "path": "src/main/resources/l10n/JabRef_en.properties", "diffHunk": "@@ -2280,6 +2276,17 @@ Regular\\ expression=Regular expression\n \n Error\\ importing.\\ See\\ the\\ error\\ log\\ for\\ details.=Error importing. See the error log for details.\n \n+Error\\ from\\ import\\:\\ %0=Error from import\\: %0\n+Error\\ reading\\ PDF\\ content\\:\\ %0=Error reading PDF content\\: %0\n+Error\\ reading\\ XMP\\ content\\:\\ %0=Error reading XMP content\\: %0\n+Importing\\ bib\\ entry=Importing bib entry\n+Importing\\ using\\ XMP\\ data...=Importing using XMP data...\n+Importing\\ using\\ extracted\\ PDF\\ data=Importing using extracted PDF data\n+No\\ bibtex\\ data\\ found.\\ Creating\\ empty\\ entry\\ with\\ file\\ link=No bibtex data found. Creating empty entry with file link", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjI2MzY3Mw==", "bodyText": "Could you add a comment why the file is completely excluded? Can't the checkstyle issues be fixed? (https://medium.com/@matryer/broken-windows-theory-why-code-quality-and-simplistic-design-are-non-negotiable-e37f8ce23dab ^^)", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562263673", "createdAt": "2021-01-21T23:26:04Z", "author": {"login": "koppor"}, "path": "config/checkstyle/suppressions.xml", "diffHunk": "@@ -6,4 +6,5 @@\n \n <suppressions>\n     <suppress checks=\"[a-zA-Z0-9]*\" files=\"[\\\\/]generated[\\\\/]\" />\n+    <suppress checks=\"[a-zA-Z0-9]*\" files=\"CustomTitledPaneSkin.java\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc0MTMwNzQ3", "url": "https://github.com/JabRef/jabref/pull/7209#pullrequestreview-574130747", "createdAt": "2021-01-22T10:24:15Z", "commit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxMDoyNDoxNVrOIYeVMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxMDo1MDoxMVrOIYfQtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzMzY4MQ==", "bodyText": "this should be called icon()", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562533681", "createdAt": "2021-01-22T10:24:15Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportFilesResultItemViewModel.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.nio.file.Path;\n+\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.beans.property.SimpleStringProperty;\n+import javafx.beans.property.StringProperty;\n+\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+\n+public class ImportFilesResultItemViewModel {\n+\n+    private final StringProperty file = new SimpleStringProperty(\"\");\n+    private final ObjectProperty<JabRefIcon> icon = new SimpleObjectProperty<>(IconTheme.JabRefIcons.WARNING);\n+    private final StringProperty message = new SimpleStringProperty(\"\");\n+\n+    public ImportFilesResultItemViewModel(Path file, boolean success, String message) {\n+        this.file.setValue(file.toString());\n+        this.message.setValue(message);\n+        if (success) {\n+            this.icon.setValue(IconTheme.JabRefIcons.CHECK);\n+        }\n+    }\n+\n+    public ObjectProperty<JabRefIcon> getIcon() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzNDA5Mw==", "bodyText": "Still think this, why did you marked it as \"resolved\"?", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562534093", "createdAt": "2021-01-22T10:24:54Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -27,16 +32,22 @@\n import org.jabref.model.util.FileUpdateMonitor;\n import org.jabref.preferences.PreferencesService;\n \n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n public class ImportHandler {\n \n-    private final BibDatabaseContext database;\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ImportHandler.class);\n+    private final BibDatabaseContext bibdatabasecontext;\n     private final PreferencesService preferencesService;\n-    private final DialogService dialogService;\n     private final FileUpdateMonitor fileUpdateMonitor;\n     private final ExternalFilesEntryLinker linker;\n     private final ExternalFilesContentImporter contentImporter;\n     private final UndoManager undoManager;\n     private final StateManager stateManager;\n+    private List<ImportFilesResultItemViewModel> results;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3MjExNQ=="}, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzNDgyNg==", "bodyText": "Still applies.", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562534826", "createdAt": "2021-01-22T10:26:03Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +71,96 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {\n+                        updateMessage(Localization.lang(\"Processing file %0 of %1\", counter, files.size()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3MzM2Mg=="}, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzNTQ1OQ==", "bodyText": "Why don't you use a nice foreach loop (I don't think i is used and you have the counter variable anyway)", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562535459", "createdAt": "2021-01-22T10:27:05Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +70,93 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    var file = files.get(i);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzNjUzMQ==", "bodyText": "I think it would make sense to introduce a FileUtil.isPdfFile similar to the isbibfile method.", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562536531", "createdAt": "2021-01-22T10:28:37Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/ImportHandler.java", "diffHunk": "@@ -62,40 +70,93 @@ public ExternalFilesEntryLinker getLinker() {\n         return linker;\n     }\n \n-    public void importAsNewEntries(List<Path> files) {\n-        CompoundEdit ce = new CompoundEdit();\n-        for (Path file : files) {\n-            List<BibEntry> entriesToAdd;\n-            if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {\n-                List<BibEntry> pdfResult = contentImporter.importPDFContent(file);\n-                List<BibEntry> xmpEntriesInFile = contentImporter.importXMPContent(file);\n-\n-                // First try xmp import, if empty try pdf import, otherwise create empty entry\n-                if (!xmpEntriesInFile.isEmpty()) {\n-                    if (!pdfResult.isEmpty()) {\n-                        // FIXME: Show merge dialog?\n-                        entriesToAdd = xmpEntriesInFile;\n-                    } else {\n-                        entriesToAdd = xmpEntriesInFile;\n+    public BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesInBackground(List<Path> files) {\n+        return new BackgroundTask<>() {\n+\n+            @Override\n+            protected List<ImportFilesResultItemViewModel> call() {\n+                results = new ArrayList<>();\n+                counter = 1;\n+                CompoundEdit ce = new CompoundEdit();\n+                for (int i = 0; i < files.size(); i++) {\n+\n+                    var file = files.get(i);\n+                    entriesToAdd = Collections.emptyList();\n+\n+                    if (isCanceled()) {\n+                        break;\n                     }\n-                } else {\n-                    if (!pdfResult.isEmpty()) {\n-                        entriesToAdd = pdfResult;\n-                    } else {\n-                        entriesToAdd = Collections.singletonList(createEmptyEntryWithLink(file));\n+                    DefaultTaskExecutor.runInJavaFXThread(() -> {\n+                        updateMessage(Localization.lang(\"Processing file %0 of %1\", counter, files.size()));\n+                        updateProgress(counter, files.size() - 1);\n+                    });\n+\n+                    try {\n+                        if (FileUtil.getFileExtension(file).filter(\"pdf\"::equals).isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjUzOTkwNw==", "bodyText": "There are no bibtex entries here, it's an import of files, right?", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562539907", "createdAt": "2021-01-22T10:34:10Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialog.fxml", "diffHunk": "@@ -0,0 +1,111 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+\n+<?import javafx.scene.control.Accordion?>\n+<?import javafx.scene.control.Button?>\n+<?import javafx.scene.control.ButtonBar?>\n+<?import javafx.scene.control.ButtonType?>\n+<?import javafx.scene.control.ComboBox?>\n+<?import javafx.scene.control.DialogPane?>\n+<?import javafx.scene.control.Label?>\n+<?import javafx.scene.control.ProgressIndicator?>\n+<?import javafx.scene.control.ScrollPane?>\n+<?import javafx.scene.control.TableColumn?>\n+<?import javafx.scene.control.TableView?>\n+<?import javafx.scene.control.TextField?>\n+<?import javafx.scene.control.TitledPane?>\n+<?import javafx.scene.control.Tooltip?>\n+<?import javafx.scene.layout.BorderPane?>\n+<?import javafx.scene.layout.ColumnConstraints?>\n+<?import javafx.scene.layout.GridPane?>\n+<?import javafx.scene.layout.RowConstraints?>\n+<?import javafx.scene.layout.StackPane?>\n+<?import javafx.scene.layout.VBox?>\n+<?import org.jabref.gui.icon.JabRefIconView?>\n+<?import org.controlsfx.control.CheckTreeView?>\n+<DialogPane xmlns=\"http://javafx.com/javafx/15.0.1\" xmlns:fx=\"http://javafx.com/fxml/1\"\n+            fx:controller=\"org.jabref.gui.externalfiles.UnlinkedFilesDialogView\"\n+            prefWidth=\"600.0\">\n+    <content>\n+        <VBox spacing=\"10.0\">\n+            <GridPane hgap=\"10.0\" vgap=\"4.0\">\n+            <columnConstraints>\n+                <ColumnConstraints hgrow=\"SOMETIMES\"/>\n+                <ColumnConstraints hgrow=\"ALWAYS\"/>\n+                <ColumnConstraints hgrow=\"SOMETIMES\"/>\n+            </columnConstraints>\n+            <rowConstraints>\n+                <RowConstraints minHeight=\"10.0\" vgrow=\"SOMETIMES\"/>\n+                <RowConstraints minHeight=\"10.0\" vgrow=\"SOMETIMES\"/>\n+            </rowConstraints>\n+                <Label text=\"%Start directory:\" GridPane.columnIndex=\"0\" GridPane.rowIndex=\"0\"/>\n+                <TextField fx:id=\"directoryPathField\" GridPane.columnIndex=\"1\" GridPane.rowIndex=\"0\"/>\n+                <Button onAction=\"#browseFileDirectory\" styleClass=\"icon-button,narrow\"\n+                        GridPane.columnIndex=\"2\" GridPane.rowIndex=\"0\"\n+                        prefHeight=\"20.0\" prefWidth=\"20.0\">\n+                    <graphic>\n+                        <JabRefIconView glyph=\"OPEN\"/>\n+                    </graphic>\n+                    <tooltip>\n+                        <Tooltip text=\"%Browse\"/>\n+                    </tooltip>\n+                </Button>\n+\n+                <Label text=\"%File extension:\" GridPane.columnIndex=\"0\" GridPane.rowIndex=\"1\"/>\n+                <ComboBox fx:id=\"fileTypeCombo\" maxWidth=\"Infinity\" GridPane.columnIndex=\"1\" GridPane.rowIndex=\"1\"/>\n+                <Button fx:id=\"scanButton\" onAction=\"#scanFiles\" text=\"%Scan directory\"\n+                        GridPane.columnIndex=\"2\" GridPane.rowIndex=\"1\">\n+                    <tooltip>\n+                        <Tooltip text=\"%Searches the selected directory for unlinked files.\"/>\n+                    </tooltip>\n+                </Button>\n+            </GridPane>\n+            <StackPane VBox.vgrow=\"ALWAYS\">\n+                <Accordion fx:id=\"accordion\" minHeight=\"300.0\" prefHeight=\"300.0\" maxHeight=\"300.0\">\n+                    <panes>\n+                        <TitledPane fx:id=\"filePane\" text=\"%Currently unlinked files\">\n+                            <ScrollPane fitToWidth=\"true\">\n+                                <CheckTreeView fx:id=\"unlinkedFilesList\"/>\n+                            </ScrollPane>\n+                        </TitledPane>\n+                        <TitledPane fx:id=\"resultPane\" text=\"%Import result\" disable=\"true\">\n+                            <TableView fx:id=\"importResultTable\">\n+                                <columns>\n+                                    <TableColumn fx:id=\"colStatus\" prefWidth=\"100.0\" text=\"%Status\"/>\n+                                    <TableColumn fx:id=\"colMessage\" prefWidth=\"300.0\" text=\"%Message\"/>\n+                                    <TableColumn fx:id=\"colFile\" prefWidth=\"500.0\" text=\"%File\"/>\n+                                </columns>\n+                                <columnResizePolicy>\n+                                    <TableView fx:constant=\"CONSTRAINED_RESIZE_POLICY\"/>\n+                                </columnResizePolicy>\n+                            </TableView>\n+                        </TitledPane>\n+                    </panes>\n+                </Accordion>\n+                <VBox fx:id=\"progressPane\" alignment=\"CENTER\" StackPane.alignment=\"CENTER\">\n+                    <ProgressIndicator fx:id=\"progressDisplay\" maxHeight=\"50.0\" maxWidth=\"50.0\"\n+                                       prefHeight=\"50.0\" prefWidth=\"50.0\" progress=\"0.0\"/>\n+                    <Label fx:id=\"progressText\" text=\"%Searching file system...\"/>\n+                </VBox>\n+            </StackPane>\n+            <ButtonBar buttonMinWidth=\"80.0\" BorderPane.alignment=\"CENTER\">\n+                <buttons>\n+                    <Button onAction=\"#selectAll\" text=\"%Select all\" ButtonBar.buttonData=\"OTHER\"/>\n+                    <Button onAction=\"#unselectAll\" text=\"%Unselect all\" ButtonBar.buttonData=\"OTHER\"/>\n+                    <Button onAction=\"#collapseAll\" text=\"%Collapse all\" ButtonBar.buttonData=\"OTHER\"/>\n+                    <Button onAction=\"#expandAll\" text=\"%Expand all\" ButtonBar.buttonData=\"OTHER\"/>\n+                    <Button onAction=\"#exportSelected\" text=\"%Export selected\" fx:id=\"exportButton\" ButtonBar.buttonData=\"OTHER\">\n+                        <tooltip>\n+                            <Tooltip text=\"%Export to text file.\"/>\n+                        </tooltip>\n+                    </Button>\n+                    <Button onAction=\"#startImport\" text=\"%Import\" fx:id=\"importButton\" ButtonBar.buttonData=\"APPLY\">\n+                        <tooltip>\n+                            <Tooltip text=\"Starts the import of BibTeX entries.\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjI2MzAxMw=="}, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjU0MTIwMw==", "bodyText": "A bit cleaner: bind to hasNoResults = EasyBind.isEmpty(viewModel.resultTableItems()) (similar for the treeRoot listener above)", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562541203", "createdAt": "2021-01-22T10:36:23Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,264 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.util.Objects;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.application.Platform;\n+import javafx.beans.InvalidationListener;\n+import javafx.beans.binding.Bindings;\n+import javafx.beans.binding.BooleanBinding;\n+import javafx.collections.FXCollections;\n+import javafx.fxml.FXML;\n+import javafx.scene.Node;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.CheckBoxTreeItem;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.SelectionMode;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.TreeItem;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.FileNodeViewModel;\n+import org.jabref.gui.util.IconValidationDecorator;\n+import org.jabref.gui.util.RecursiveTreeItem;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+import com.tobiasdiez.easybind.EasyBind;\n+import de.saxsys.mvvmfx.utils.validation.visualization.ControlsFxVisualizer;\n+import org.controlsfx.control.CheckTreeView;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileExtensionViewModel> fileTypeCombo;\n+    @FXML private CheckTreeView<FileNodeViewModel> unlinkedFilesList;\n+    @FXML private Button scanButton;\n+    @FXML private Button exportButton;\n+    @FXML private Button importButton;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> importResultTable;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private final ControlsFxVisualizer validationVisualizer;\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.validationVisualizer = new ControlsFxVisualizer();\n+\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+        viewModel = new UnlinkedFilesDialogViewModel(dialogService, ExternalFileTypes.getInstance(), undoManager, fileUpdateMonitor, preferencesService, stateManager, taskExecutor);\n+\n+        progressDisplay.progressProperty().bind(viewModel.progressValueProperty());\n+        progressText.textProperty().bind(viewModel.progressTextProperty());\n+        progressPane.managedProperty().bind(viewModel.taskActiveProperty());\n+        progressPane.visibleProperty().bind(viewModel.taskActiveProperty());\n+        accordion.disableProperty().bind(viewModel.taskActiveProperty());\n+\n+        viewModel.treeRootProperty().addListener(observable -> {\n+            scanButton.setDefaultButton(false);\n+            importButton.setDefaultButton(true);\n+            scanButton.setDefaultButton(false);\n+            filePane.setExpanded(true);\n+            resultPane.setExpanded(false);\n+        });\n+\n+        viewModel.resultTableItems().addListener((InvalidationListener) observable -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjU0MzA2Nw==", "bodyText": "This should be moved to ImportFilesResultItemViewModel", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562543067", "createdAt": "2021-01-22T10:39:34Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java", "diffHunk": "@@ -0,0 +1,264 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.util.Objects;\n+\n+import javax.inject.Inject;\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.application.Platform;\n+import javafx.beans.InvalidationListener;\n+import javafx.beans.binding.Bindings;\n+import javafx.beans.binding.BooleanBinding;\n+import javafx.collections.FXCollections;\n+import javafx.fxml.FXML;\n+import javafx.scene.Node;\n+import javafx.scene.control.Accordion;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.ButtonType;\n+import javafx.scene.control.CheckBoxTreeItem;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.Control;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.SelectionMode;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.control.TitledPane;\n+import javafx.scene.control.TreeItem;\n+import javafx.scene.layout.VBox;\n+import javafx.scene.paint.Color;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.icon.JabRefIcon;\n+import org.jabref.gui.util.BaseDialog;\n+import org.jabref.gui.util.FileNodeViewModel;\n+import org.jabref.gui.util.IconValidationDecorator;\n+import org.jabref.gui.util.RecursiveTreeItem;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.gui.util.ViewModelTreeCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+import com.tobiasdiez.easybind.EasyBind;\n+import de.saxsys.mvvmfx.utils.validation.visualization.ControlsFxVisualizer;\n+import org.controlsfx.control.CheckTreeView;\n+\n+public class UnlinkedFilesDialogView extends BaseDialog<Void> {\n+\n+    @FXML private TextField directoryPathField;\n+    @FXML private ComboBox<FileExtensionViewModel> fileTypeCombo;\n+    @FXML private CheckTreeView<FileNodeViewModel> unlinkedFilesList;\n+    @FXML private Button scanButton;\n+    @FXML private Button exportButton;\n+    @FXML private Button importButton;\n+    @FXML private Label progressText;\n+    @FXML private Accordion accordion;\n+    @FXML private ProgressIndicator progressDisplay;\n+    @FXML private VBox progressPane;\n+\n+    @FXML private TableView<ImportFilesResultItemViewModel> importResultTable;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, JabRefIcon> colStatus;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colMessage;\n+    @FXML private TableColumn<ImportFilesResultItemViewModel, String> colFile;\n+\n+    @FXML private TitledPane filePane;\n+    @FXML private TitledPane resultPane;\n+\n+    @Inject private PreferencesService preferencesService;\n+    @Inject private DialogService dialogService;\n+    @Inject private StateManager stateManager;\n+    @Inject private UndoManager undoManager;\n+    @Inject private TaskExecutor taskExecutor;\n+    @Inject private FileUpdateMonitor fileUpdateMonitor;\n+\n+    private final ControlsFxVisualizer validationVisualizer;\n+    private UnlinkedFilesDialogViewModel viewModel;\n+\n+    public UnlinkedFilesDialogView() {\n+        this.validationVisualizer = new ControlsFxVisualizer();\n+\n+        this.setTitle(Localization.lang(\"Search for unlinked local files\"));\n+\n+        ViewLoader.view(this)\n+                  .load()\n+                  .setAsDialogPane(this);\n+\n+        setResultConverter(button -> {\n+            if (button == ButtonType.CANCEL) {\n+                viewModel.cancelTasks();\n+            }\n+            return null;\n+        });\n+    }\n+\n+    @FXML\n+    private void initialize() {\n+        viewModel = new UnlinkedFilesDialogViewModel(dialogService, ExternalFileTypes.getInstance(), undoManager, fileUpdateMonitor, preferencesService, stateManager, taskExecutor);\n+\n+        progressDisplay.progressProperty().bind(viewModel.progressValueProperty());\n+        progressText.textProperty().bind(viewModel.progressTextProperty());\n+        progressPane.managedProperty().bind(viewModel.taskActiveProperty());\n+        progressPane.visibleProperty().bind(viewModel.taskActiveProperty());\n+        accordion.disableProperty().bind(viewModel.taskActiveProperty());\n+\n+        viewModel.treeRootProperty().addListener(observable -> {\n+            scanButton.setDefaultButton(false);\n+            importButton.setDefaultButton(true);\n+            scanButton.setDefaultButton(false);\n+            filePane.setExpanded(true);\n+            resultPane.setExpanded(false);\n+        });\n+\n+        viewModel.resultTableItems().addListener((InvalidationListener) observable -> {\n+            filePane.setExpanded(false);\n+            resultPane.setExpanded(true);\n+            resultPane.setDisable(false);\n+        });\n+\n+        initDirectorySelection();\n+        initUnlinkedFilesList();\n+        initResultTable();\n+        initButtons();\n+    }\n+\n+    private void initDirectorySelection() {\n+        validationVisualizer.setDecoration(new IconValidationDecorator());\n+\n+        directoryPathField.textProperty().bindBidirectional(viewModel.directoryPathProperty());\n+        Platform.runLater(() -> validationVisualizer.initVisualization(viewModel.directoryPathValidationStatus(), directoryPathField));\n+\n+        new ViewModelListCellFactory<FileExtensionViewModel>()\n+                .withText(FileExtensionViewModel::getDescription)\n+                .withIcon(FileExtensionViewModel::getIcon)\n+                .install(fileTypeCombo);\n+        fileTypeCombo.setItems(viewModel.getFileFilters());\n+        fileTypeCombo.valueProperty().bindBidirectional(viewModel.selectedExtensionProperty());\n+        fileTypeCombo.getSelectionModel().selectFirst();\n+    }\n+\n+    private void initUnlinkedFilesList() {\n+        new ViewModelTreeCellFactory<FileNodeViewModel>()\n+                .withText(FileNodeViewModel::getDisplayText)\n+                .install(unlinkedFilesList);\n+\n+        unlinkedFilesList.maxHeightProperty().bind(((Control) filePane.contentProperty().get()).heightProperty());\n+        unlinkedFilesList.getSelectionModel().setSelectionMode(SelectionMode.MULTIPLE);\n+\n+        unlinkedFilesList.rootProperty().bind(EasyBind.map(viewModel.treeRootProperty(),\n+                fileNode -> {\n+                    if (!Objects.isNull(fileNode)) {\n+                        return new RecursiveTreeItem<>(fileNode, FileNodeViewModel::getChildren);\n+                    } else {\n+                        return null;\n+                    }\n+                }));\n+\n+        EasyBind.subscribe(unlinkedFilesList.rootProperty(), root -> {\n+            if (root != null) {\n+                ((CheckBoxTreeItem<FileNodeViewModel>) root).setSelected(true);\n+                root.setExpanded(true);\n+                EasyBind.bindContent(viewModel.checkedFileListProperty(), unlinkedFilesList.getCheckModel().getCheckedItems());\n+            } else {\n+                EasyBind.bindContent(viewModel.checkedFileListProperty(), FXCollections.observableArrayList());\n+            }\n+        });\n+    }\n+\n+    private void initResultTable() {\n+        colFile.setCellValueFactory(cellData -> cellData.getValue().file());\n+        new ValueTableCellFactory<ImportFilesResultItemViewModel, String>()\n+                .withText(item -> item).withTooltip(item -> item)\n+                .install(colFile);\n+\n+        colMessage.setCellValueFactory(cellData -> cellData.getValue().message());\n+        new ValueTableCellFactory<ImportFilesResultItemViewModel, String>()\n+                .withText(item -> item).withTooltip(item -> item)\n+                .install(colMessage);\n+\n+        colStatus.setCellValueFactory(cellData -> cellData.getValue().getIcon());\n+        colStatus.setCellFactory(new ValueTableCellFactory<ImportFilesResultItemViewModel, JabRefIcon>().withGraphic(this::getIcon));\n+        importResultTable.setColumnResizePolicy((param) -> true);\n+\n+        importResultTable.setItems(viewModel.resultTableItems());\n+    }\n+\n+    private void initButtons() {\n+        BooleanBinding noItemsChecked = Bindings.isNull(unlinkedFilesList.rootProperty())\n+                                                .or(Bindings.isEmpty(viewModel.checkedFileListProperty()));\n+        exportButton.disableProperty().bind(noItemsChecked);\n+        importButton.disableProperty().bind(noItemsChecked);\n+\n+        scanButton.setDefaultButton(true);\n+        scanButton.disableProperty().bind(viewModel.taskActiveProperty().or(viewModel.directoryPathValidationStatus().validProperty().not()));\n+    }\n+\n+    @FXML\n+    void browseFileDirectory() {\n+        viewModel.browseFileDirectory();\n+    }\n+\n+    @FXML\n+    void collapseAll() {\n+        expandTree(unlinkedFilesList.getRoot(), false);\n+    }\n+\n+    @FXML\n+    void expandAll() {\n+        expandTree(unlinkedFilesList.getRoot(), true);\n+    }\n+\n+    @FXML\n+    void scanFiles() {\n+        viewModel.startSearch();\n+    }\n+\n+    @FXML\n+    void startImport() {\n+        viewModel.startImport();\n+    }\n+\n+    @FXML\n+    void selectAll() {\n+        unlinkedFilesList.getCheckModel().checkAll();\n+    }\n+\n+    @FXML\n+    void unselectAll() {\n+        unlinkedFilesList.getCheckModel().clearChecks();\n+    }\n+\n+    @FXML\n+    void exportSelected() {\n+        viewModel.startExport();\n+    }\n+\n+    private Node getIcon(JabRefIcon icon) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 243}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjU0MzU1MQ==", "bodyText": "You can use the EasyBind.OptionalProperty instead of handling with null values.", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562543551", "createdAt": "2021-01-22T10:40:26Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogViewModel.java", "diffHunk": "@@ -0,0 +1,269 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.io.BufferedWriter;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.DirectoryStream.Filter;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.StandardOpenOption;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.DoubleProperty;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleDoubleProperty;\n+import javafx.beans.property.SimpleListProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.beans.property.SimpleStringProperty;\n+import javafx.beans.property.StringProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TreeItem;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.util.BackgroundTask;\n+import org.jabref.gui.util.DirectoryDialogConfiguration;\n+import org.jabref.gui.util.FileDialogConfiguration;\n+import org.jabref.gui.util.FileNodeViewModel;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.logic.util.StandardFileType;\n+import org.jabref.model.database.BibDatabaseContext;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import de.saxsys.mvvmfx.utils.validation.FunctionBasedValidator;\n+import de.saxsys.mvvmfx.utils.validation.ValidationMessage;\n+import de.saxsys.mvvmfx.utils.validation.ValidationStatus;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class UnlinkedFilesDialogViewModel {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(UnlinkedFilesDialogViewModel.class);\n+\n+    private final ImportHandler importHandler;\n+    private final StringProperty directoryPath = new SimpleStringProperty(\"\");\n+    private final ObjectProperty<FileExtensionViewModel> selectedExtension = new SimpleObjectProperty<>();\n+\n+    private final ObjectProperty<FileNodeViewModel> treeRootProperty = new SimpleObjectProperty<>();\n+    private final SimpleListProperty<TreeItem<FileNodeViewModel>> checkedFileListProperty = new SimpleListProperty<>(FXCollections.observableArrayList());\n+\n+    private final BooleanProperty taskActiveProperty = new SimpleBooleanProperty(false);\n+    private final DoubleProperty progressValueProperty = new SimpleDoubleProperty(0);\n+    private final StringProperty progressTextProperty = new SimpleStringProperty();\n+\n+    private final ObservableList<ImportFilesResultItemViewModel> resultList = FXCollections.observableArrayList();\n+    private final ObservableList<FileExtensionViewModel> fileFilterList;\n+    private final DialogService dialogService;\n+    private final PreferencesService preferences;\n+    private BackgroundTask<FileNodeViewModel> findUnlinkedFilesTask;\n+    private BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesBackgroundTask;\n+\n+    private final BibDatabaseContext bibDatabase;\n+    private final TaskExecutor taskExecutor;\n+\n+    private final FunctionBasedValidator<String> scanDirectoryValidator;\n+\n+    public UnlinkedFilesDialogViewModel(DialogService dialogService, ExternalFileTypes externalFileTypes, UndoManager undoManager,\n+                                        FileUpdateMonitor fileUpdateMonitor, PreferencesService preferences, StateManager stateManager, TaskExecutor taskExecutor) {\n+        this.preferences = preferences;\n+        this.dialogService = dialogService;\n+        this.taskExecutor = taskExecutor;\n+        this.bibDatabase = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n+        importHandler = new ImportHandler(\n+                dialogService,\n+                bibDatabase,\n+                externalFileTypes,\n+                preferences,\n+                fileUpdateMonitor,\n+                undoManager,\n+                stateManager);\n+\n+        this.fileFilterList = FXCollections.observableArrayList(\n+                new FileExtensionViewModel(StandardFileType.ANY_FILE, externalFileTypes),\n+                new FileExtensionViewModel(StandardFileType.BIBTEX_DB, externalFileTypes),\n+                new FileExtensionViewModel(StandardFileType.PDF, externalFileTypes));\n+\n+        Predicate<String> isDirectory = path -> Files.isDirectory(Path.of(path));\n+        scanDirectoryValidator = new FunctionBasedValidator<>(directoryPath, isDirectory,\n+                ValidationMessage.error(Localization.lang(\"Please enter a valid file path.\")));\n+\n+        treeRootProperty.setValue(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjU0NDI0MQ==", "bodyText": "There is some code dup with the onFinished handler, is still really needed?", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562544241", "createdAt": "2021-01-22T10:41:44Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogViewModel.java", "diffHunk": "@@ -0,0 +1,269 @@\n+package org.jabref.gui.externalfiles;\n+\n+import java.io.BufferedWriter;\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.DirectoryStream.Filter;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.StandardOpenOption;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+\n+import javax.swing.undo.UndoManager;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.DoubleProperty;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleDoubleProperty;\n+import javafx.beans.property.SimpleListProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.beans.property.SimpleStringProperty;\n+import javafx.beans.property.StringProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import javafx.scene.control.ProgressIndicator;\n+import javafx.scene.control.TreeItem;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.externalfiletype.ExternalFileTypes;\n+import org.jabref.gui.util.BackgroundTask;\n+import org.jabref.gui.util.DirectoryDialogConfiguration;\n+import org.jabref.gui.util.FileDialogConfiguration;\n+import org.jabref.gui.util.FileNodeViewModel;\n+import org.jabref.gui.util.TaskExecutor;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.logic.util.StandardFileType;\n+import org.jabref.model.database.BibDatabaseContext;\n+import org.jabref.model.util.FileUpdateMonitor;\n+import org.jabref.preferences.PreferencesService;\n+\n+import de.saxsys.mvvmfx.utils.validation.FunctionBasedValidator;\n+import de.saxsys.mvvmfx.utils.validation.ValidationMessage;\n+import de.saxsys.mvvmfx.utils.validation.ValidationStatus;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class UnlinkedFilesDialogViewModel {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(UnlinkedFilesDialogViewModel.class);\n+\n+    private final ImportHandler importHandler;\n+    private final StringProperty directoryPath = new SimpleStringProperty(\"\");\n+    private final ObjectProperty<FileExtensionViewModel> selectedExtension = new SimpleObjectProperty<>();\n+\n+    private final ObjectProperty<FileNodeViewModel> treeRootProperty = new SimpleObjectProperty<>();\n+    private final SimpleListProperty<TreeItem<FileNodeViewModel>> checkedFileListProperty = new SimpleListProperty<>(FXCollections.observableArrayList());\n+\n+    private final BooleanProperty taskActiveProperty = new SimpleBooleanProperty(false);\n+    private final DoubleProperty progressValueProperty = new SimpleDoubleProperty(0);\n+    private final StringProperty progressTextProperty = new SimpleStringProperty();\n+\n+    private final ObservableList<ImportFilesResultItemViewModel> resultList = FXCollections.observableArrayList();\n+    private final ObservableList<FileExtensionViewModel> fileFilterList;\n+    private final DialogService dialogService;\n+    private final PreferencesService preferences;\n+    private BackgroundTask<FileNodeViewModel> findUnlinkedFilesTask;\n+    private BackgroundTask<List<ImportFilesResultItemViewModel>> importFilesBackgroundTask;\n+\n+    private final BibDatabaseContext bibDatabase;\n+    private final TaskExecutor taskExecutor;\n+\n+    private final FunctionBasedValidator<String> scanDirectoryValidator;\n+\n+    public UnlinkedFilesDialogViewModel(DialogService dialogService, ExternalFileTypes externalFileTypes, UndoManager undoManager,\n+                                        FileUpdateMonitor fileUpdateMonitor, PreferencesService preferences, StateManager stateManager, TaskExecutor taskExecutor) {\n+        this.preferences = preferences;\n+        this.dialogService = dialogService;\n+        this.taskExecutor = taskExecutor;\n+        this.bibDatabase = stateManager.getActiveDatabase().orElseThrow(() -> new NullPointerException(\"Database null\"));\n+        importHandler = new ImportHandler(\n+                dialogService,\n+                bibDatabase,\n+                externalFileTypes,\n+                preferences,\n+                fileUpdateMonitor,\n+                undoManager,\n+                stateManager);\n+\n+        this.fileFilterList = FXCollections.observableArrayList(\n+                new FileExtensionViewModel(StandardFileType.ANY_FILE, externalFileTypes),\n+                new FileExtensionViewModel(StandardFileType.BIBTEX_DB, externalFileTypes),\n+                new FileExtensionViewModel(StandardFileType.PDF, externalFileTypes));\n+\n+        Predicate<String> isDirectory = path -> Files.isDirectory(Path.of(path));\n+        scanDirectoryValidator = new FunctionBasedValidator<>(directoryPath, isDirectory,\n+                ValidationMessage.error(Localization.lang(\"Please enter a valid file path.\")));\n+\n+        treeRootProperty.setValue(null);\n+    }\n+\n+    public void startSearch() {\n+        Path directory = this.getSearchDirectory();\n+        Filter<Path> selectedFileFilter = selectedExtension.getValue().dirFilter();\n+\n+        progressValueProperty.unbind();\n+        progressTextProperty.unbind();\n+\n+        findUnlinkedFilesTask = new UnlinkedFilesCrawler(directory, selectedFileFilter, bibDatabase, preferences.getFilePreferences())\n+                .onRunning(() -> {\n+                    progressValueProperty.set(ProgressIndicator.INDETERMINATE_PROGRESS);\n+                    progressTextProperty.setValue(Localization.lang(\"Searching file system...\"));\n+                    progressTextProperty.bind(findUnlinkedFilesTask.messageProperty());\n+                    taskActiveProperty.setValue(true);\n+                    treeRootProperty.setValue(null);\n+                })\n+                .onFinished(() -> {\n+                    progressValueProperty.set(0);\n+                    taskActiveProperty.setValue(false);\n+                })\n+                .onSuccess(root -> {\n+                    progressValueProperty.set(0);\n+                    taskActiveProperty.setValue(false);\n+                    treeRootProperty.setValue(root);\n+                });\n+        findUnlinkedFilesTask.executeWith(taskExecutor);\n+    }\n+\n+    public void startImport() {\n+        List<Path> fileList = checkedFileListProperty.stream()\n+                                                     .map(item -> item.getValue().getPath())\n+                                                     .filter(path -> path.toFile().isFile())\n+                                                     .collect(Collectors.toList());\n+        if (fileList.isEmpty()) {\n+            LOGGER.warn(\"There are no valid files checked\");\n+            return;\n+        }\n+        resultList.clear();\n+\n+        importFilesBackgroundTask = importHandler.importFilesInBackground(fileList)\n+                                                 .onRunning(() -> {\n+                                                     progressValueProperty.bind(importFilesBackgroundTask.workDonePercentageProperty());\n+                                                     progressTextProperty.bind(importFilesBackgroundTask.messageProperty());\n+                                                     taskActiveProperty.setValue(true);\n+                                                 })\n+                                                 .onFinished(() -> {\n+                                                     progressValueProperty.unbind();\n+                                                     progressTextProperty.unbind();\n+                                                     taskActiveProperty.setValue(false);\n+                                                 })\n+                                                 .onSuccess(results -> {\n+                                                     progressValueProperty.unbind();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjU0NjcyMA==", "bodyText": "pathname rename to path", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562546720", "createdAt": "2021-01-22T10:46:16Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/util/FileFilterConverter.java", "diffHunk": "@@ -76,4 +83,19 @@ public static FileFilter toFileFilter(FileChooser.ExtensionFilter extensionFilte\n                                        .orElse(false);\n         }\n     }\n+\n+    public static Filter<Path> toDirFilter(List<String> extensions) {\n+        List<String> extensionsCleaned = extensions.stream()\n+                                                   .map(extension -> extension.replace(\".\", \"\").replace(\"*\", \"\"))\n+                                                   .filter(StringUtil::isNotBlank)\n+                                                   .collect(Collectors.toList());\n+        if (extensionsCleaned.isEmpty()) {\n+            // Except every file\n+            return pathname -> true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjU0NzA0OQ==", "bodyText": "Is it not possible to reuse the toDirFilter here? They are almost the same code. Something like\nfilter = toDirFilter(extensions);\nreturn file -> filter.apply(file.toPath())", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562547049", "createdAt": "2021-01-22T10:46:58Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/util/FileFilterConverter.java", "diffHunk": "@@ -62,11 +64,16 @@ private FileFilterConverter() {\n     }\n \n     public static FileFilter toFileFilter(FileChooser.ExtensionFilter extensionFilter) {\n-        List<String> extensionsCleaned = extensionFilter.getExtensions()\n-                                                        .stream()\n-                                                        .map(extension -> extension.replace(\".\", \"\").replace(\"*\", \"\"))\n-                                                        .filter(StringUtil::isNotBlank)\n-                                                        .collect(Collectors.toList());\n+        return toFileFilter(extensionFilter.getExtensions());\n+    }\n+\n+    // Implement as DirectoryStream https://docs.oracle.com/javase/9/docs/api/java/nio/file/DirectoryStream.Filter.html\n+\n+    public static FileFilter toFileFilter(List<String> extensions) {\n+        List<String> extensionsCleaned = extensions.stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b28692563bdec847ea814f9d1063373df4b806c"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjU0ODkxNw==", "bodyText": "But lang(\"...\", file, path) is not possible since file and path are not of the same type T", "url": "https://github.com/JabRef/jabref/pull/7209#discussion_r562548917", "createdAt": "2021-01-22T10:50:11Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/l10n/Localization.java", "diffHunk": "@@ -48,13 +49,15 @@ private Localization() {\n      * @param params Replacement strings for parameters %0, %1, etc.\n      * @return The message with replaced parameters\n      */\n-    public static String lang(String key, String... params) {\n+    public static <T> String lang(String key, T... params) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI4NDQxMw=="}, "originalCommit": {"oid": "e0466377c7ea3dce53d753f7fd60d7c0ada99279"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fec815c7d8e3b5740a4e354d8bea0ba7a5c8fa8", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/2fec815c7d8e3b5740a4e354d8bea0ba7a5c8fa8", "committedDate": "2021-01-22T18:17:37Z", "message": "Merge remote-tracking branch 'upstream/master' into importerbackgroundtask\n\n* upstream/master:\n  Upgrade citeproc to 3.x snapshot without graal (#7370)\n  Fix Exception if no AzureInstrumentationKey is available (#7373)\n  Update snapcraft source url (#7372)\n  Fix checkstyle and adjust language\n  GitBook: [master] 3 pages and 32 assets modified\n  Add migration to special field (#7368)\n  GitBook: [master] 5 pages and 29 assets modified\n  Modify message at the duplicates found dialog (#7231)\n  Fixes miss-parsed names in `AutomaticPersonsGroup` (#7228)\n  Fix an issue where the password for a shared SQL database was only remembered if it was the same as the username (#7364)\n  Fix harvard exporter by changing AuthorsFormatter (#7355)\n  Bump styfle/cancel-workflow-action from 0.6.0 to 0.7.0 (#7363)\n  Bump mockito-core from 3.7.0 to 3.7.7 (#7360)\n  Bump org.beryx.jlink from 2.23.1 to 2.23.2 (#7361)\n  Bump libreoffice from 7.0.3 to 7.0.4 (#7362)\n  Export full month name instead of number in ms office (#7358)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4efa5b94d7556d4a32fc4f5c9ef9812faf851b04", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/4efa5b94d7556d4a32fc4f5c9ef9812faf851b04", "committedDate": "2021-01-22T19:01:11Z", "message": "refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ec8e38c76f5a6748b72476e5ffc4cf8c9561450", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/7ec8e38c76f5a6748b72476e5ffc4cf8c9561450", "committedDate": "2021-01-22T19:04:33Z", "message": "Merge remote-tracking branch 'upstream/importerbackgroundtask' into importerbackgroundtask\n\n* upstream/importerbackgroundtask:\n  Remove obsolete language key\n  Refactored for mvvm pattern and optics\n\n# Conflicts:\n#\tsrc/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogView.java\n#\tsrc/main/java/org/jabref/gui/externalfiles/UnlinkedFilesDialogViewModel.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c41e9a5768675edd0c7bc667e5ab71724bf9bb0", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/7c41e9a5768675edd0c7bc667e5ab71724bf9bb0", "committedDate": "2021-01-22T19:18:33Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc6c9e1cc366b1518b5417aac62c1d0af20ca60b", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/bc6c9e1cc366b1518b5417aac62c1d0af20ca60b", "committedDate": "2021-01-22T19:40:25Z", "message": "fix checkstyle\nand l10n"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "443c14ccbb89dd778107b1ff3089ca3aef70cbfa", "author": {"user": {"login": "Siedlerchr", "name": "Christoph"}}, "url": "https://github.com/JabRef/jabref/commit/443c14ccbb89dd778107b1ff3089ca3aef70cbfa", "committedDate": "2021-01-23T16:18:31Z", "message": "move vars down to background task\nadd explaination to checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc0ODYyMDkw", "url": "https://github.com/JabRef/jabref/pull/7209#pullrequestreview-574862090", "createdAt": "2021-01-23T17:20:18Z", "commit": {"oid": "443c14ccbb89dd778107b1ff3089ca3aef70cbfa"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecaa23ad05a87ccf2b1066e469517a93901546c2", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/ecaa23ad05a87ccf2b1066e469517a93901546c2", "committedDate": "2021-01-24T10:36:01Z", "message": "Made treeRootProperty a property of Optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6362584759c720d223b1ab55fe4fb1eba1943ccd", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/6362584759c720d223b1ab55fe4fb1eba1943ccd", "committedDate": "2021-01-24T10:48:03Z", "message": "l10n"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4918, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}