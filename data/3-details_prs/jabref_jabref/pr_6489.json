{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MTgzOTE1", "number": 6489, "title": "Refactor BibtexKeyPatternPreferences", "bodyText": "Follow-up to #6245\nHad some time to continue work on refactoring JabRefPreferences. Progress may be slow but steady. Most of the changes is some rewording. The interesting part should be BibtexKeyPatternPreferences and JabRefPreferences. I also introduced an enum KeyLetters instead of some booleans (\ud83d\ude09 @Siedlerchr).\nI also took the liberty to rename the 'Advanced' tab in the preferences to 'Network', since the only two preferences not related to network stuff in it were not used anywhere, therefor obsolete and removed by me.\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for UI changes)\n Checked documentation: Is the information available and up to date? If not created an issue at https://github.com/JabRef/user-documentation/issues or, even better, submitted a pull request to the documentation repository.", "createdAt": "2020-05-17T22:28:29Z", "url": "https://github.com/JabRef/jabref/pull/6489", "merged": true, "mergeCommit": {"oid": "62c8bf1a526802f16f524b31e57ab2859ce449d2"}, "closed": true, "closedAt": "2020-05-22T10:55:39Z", "author": {"login": "calixtus"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABciP_WsgH2gAyNDE5MTgzOTE1OmMwODIwNzhjNWVjNGMzOWE4YzhmZmMxYTAyMGY4MGJhMWNmYTQxYTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjoJ20AH2gAyNDE5MTgzOTE1OjU2NmZiZjA0NDkyZjQ1MWFlOTI3ZjViYjVhYmEyNTJkNTBmODA5YTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c082078c5ec4c39a8c8ffc1a020f80ba1cfa41a1", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/c082078c5ec4c39a8c8ffc1a020f80ba1cfa41a1", "committedDate": "2020-05-17T18:57:17Z", "message": "Removed unused preferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f882fbf19dfcd8fec81d128eca8180a94958f17", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/9f882fbf19dfcd8fec81d128eca8180a94958f17", "committedDate": "2020-05-17T19:16:46Z", "message": "Reworded advanced prefs to network prefs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0dfe3448a4f7e37fd806299cb570a98001723a0", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/d0dfe3448a4f7e37fd806299cb570a98001723a0", "committedDate": "2020-05-17T22:04:49Z", "message": "Refactored BibtexKeyPatternPreferences and some minor housekeeping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb29c41362a714b116f2d31f844367aecba30262", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/bb29c41362a714b116f2d31f844367aecba30262", "committedDate": "2020-05-17T22:08:15Z", "message": "Reworded name of advanced tab in preferences in network"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMjk1MDQy", "url": "https://github.com/JabRef/jabref/pull/6489#pullrequestreview-413295042", "createdAt": "2020-05-18T06:12:51Z", "commit": {"oid": "bb29c41362a714b116f2d31f844367aecba30262"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNjoxMjo1MVrOGWouRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNjoxMjo1MVrOGWouRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM4OTA2Mg==", "bodyText": "Probably wrong name?", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r426389062", "createdAt": "2020-05-18T06:12:51Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/logic/net/ProxyRegisterer.java", "diffHunk": "@@ -7,14 +7,14 @@ private ProxyRegisterer() {\n \n     public static void register(ProxyPreferences proxyPrefs) {\n         if (proxyPrefs.isUseProxy()) {\n-            // NetworkTabView.java ensures that proxyHostname and proxyPort are not null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb29c41362a714b116f2d31f844367aecba30262"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMjk1NTMz", "url": "https://github.com/JabRef/jabref/pull/6489#pullrequestreview-413295533", "createdAt": "2020-05-18T06:14:10Z", "commit": {"oid": "bb29c41362a714b116f2d31f844367aecba30262"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b0a7767a8d97ed107dbc7ca5f665453e4d25dc6", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/4b0a7767a8d97ed107dbc7ca5f665453e4d25dc6", "committedDate": "2020-05-18T07:13:58Z", "message": "Fixed comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0f825d750d476a5d5d8f402dfa46d7fb6c957f7", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/e0f825d750d476a5d5d8f402dfa46d7fb6c957f7", "committedDate": "2020-05-18T07:44:23Z", "message": "Reworded putKeyWord and reordered BibtexKeyPatternPreferences for inner coherency, split up lines for better readability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a5531598f8d069a011110582cb98bbd52269928", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/7a5531598f8d069a011110582cb98bbd52269928", "committedDate": "2020-05-18T07:59:40Z", "message": "Fixed test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjIyOTY1", "url": "https://github.com/JabRef/jabref/pull/6489#pullrequestreview-414622965", "createdAt": "2020-05-19T16:31:06Z", "commit": {"oid": "7a5531598f8d069a011110582cb98bbd52269928"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNjozMTowNlrOGXownQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNjozMTowNlrOGXownQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQzODIzNw==", "bodyText": "Probably it makes sense to add a migration to it", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r427438237", "createdAt": "2020-05-19T16:31:06Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/preferences/JabRefPreferences.java", "diffHunk": "@@ -245,8 +245,6 @@\n     public static final String ALLOW_FILE_AUTO_OPEN_BROWSE = \"allowFileAutoOpenBrowse\";\n     public static final String CUSTOM_TAB_NAME = \"customTabName_\";\n     public static final String CUSTOM_TAB_FIELDS = \"customTabFields_\";\n-    public static final String USE_UNIT_FORMATTER_ON_SEARCH = \"useUnitFormatterOnSearch\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a5531598f8d069a011110582cb98bbd52269928"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MDM3OTI4", "url": "https://github.com/JabRef/jabref/pull/6489#pullrequestreview-416037928", "createdAt": "2020-05-21T10:25:13Z", "commit": {"oid": "7a5531598f8d069a011110582cb98bbd52269928"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDoyNToxNFrOGYt2qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDo0MDozN1rOGYuPwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3MDI4Mg==", "bodyText": "Please add a changelog entry for this change.", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r428570282", "createdAt": "2020-05-21T10:25:14Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/preferences/NetworkTab.fxml", "diffHunk": "@@ -12,8 +12,8 @@\n <?import org.controlsfx.control.textfield.CustomPasswordField?>\n <fx:root prefWidth=\"650.0\" spacing=\"10.0\" type=\"VBox\"\n          xmlns=\"http://javafx.com/javafx/8.0.212\" xmlns:fx=\"http://javafx.com/fxml/1\"\n-         fx:controller=\"org.jabref.gui.preferences.AdvancedTabView\">\n-    <Label styleClass=\"titleHeader\" text=\"%Advanced\"/>\n+         fx:controller=\"org.jabref.gui.preferences.NetworkTabView\">\n+    <Label styleClass=\"titleHeader\" text=\"%Network\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a5531598f8d069a011110582cb98bbd52269928"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3MTczNg==", "bodyText": "What do you think about renaming BibtexKeyPattern to CiteKeyPattern to be consistent with the naming in the metadata class?", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r428571736", "createdAt": "2020-05-21T10:28:22Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/bibtexkeypattern/BibtexKeyPatternDialog.java", "diffHunk": "@@ -19,7 +19,7 @@ public BibtexKeyPatternDialog(BasePanel panel) {\n         this.bibtexKeyPatternPanel = new BibtexKeyPatternPanel(panel);\n         this.panel = panel;\n         this.metaData = panel.getBibDatabaseContext().getMetaData();\n-        AbstractBibtexKeyPattern keyPattern = metaData.getCiteKeyPattern(Globals.prefs.getKeyPattern());\n+        AbstractBibtexKeyPattern keyPattern = metaData.getCiteKeyPattern(Globals.prefs.getGlobalBibtexKeyPattern());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a5531598f8d069a011110582cb98bbd52269928"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3Mzk1Mw==", "bodyText": "I think the should prefix is better here: shouldAvoidOverwriting, shouldWarnBeforeOverwrite and shouldGenerateKeysBeforeSaving.\nhttps://stackoverflow.com/a/5326487/873661", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r428573953", "createdAt": "2020-05-21T10:33:34Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/preferences/BibtexKeyPatternTabViewModel.java", "diffHunk": "@@ -16,46 +16,51 @@\n import org.jabref.gui.DialogService;\n import org.jabref.gui.commonfxcontrols.BibtexKeyPatternPanelItemModel;\n import org.jabref.gui.commonfxcontrols.BibtexKeyPatternPanelViewModel;\n+import org.jabref.logic.bibtexkeypattern.BibtexKeyPatternPreferences;\n import org.jabref.model.bibtexkeypattern.GlobalBibtexKeyPattern;\n import org.jabref.preferences.JabRefPreferences;\n \n public class BibtexKeyPatternTabViewModel implements PreferenceTabViewModel {\n \n-    private BooleanProperty overwriteAllowProperty = new SimpleBooleanProperty();\n-    private BooleanProperty overwriteWarningProperty = new SimpleBooleanProperty();\n-    private BooleanProperty generateOnSaveProperty = new SimpleBooleanProperty();\n-    private BooleanProperty letterStartAProperty = new SimpleBooleanProperty();\n-    private BooleanProperty letterStartBProperty = new SimpleBooleanProperty();\n-    private BooleanProperty letterAlwaysAddProperty = new SimpleBooleanProperty();\n-    private StringProperty keyPatternRegexProperty = new SimpleStringProperty();\n-    private StringProperty keyPatternReplacementProperty = new SimpleStringProperty();\n-    private StringProperty unwantedCharactersProperty = new SimpleStringProperty();\n+    private final BooleanProperty overwriteAllowProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty overwriteWarningProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty generateOnSaveProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty letterStartAProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty letterStartBProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty letterAlwaysAddProperty = new SimpleBooleanProperty();\n+    private final StringProperty keyPatternRegexProperty = new SimpleStringProperty();\n+    private final StringProperty keyPatternReplacementProperty = new SimpleStringProperty();\n+    private final StringProperty unwantedCharactersProperty = new SimpleStringProperty();\n \n     // The list and the default properties are being overwritten by the bound properties of the tableView, but to\n     // prevent an NPE on storing the preferences before lazy-loading of the setValues, they need to be initialized.\n-    private ListProperty<BibtexKeyPatternPanelItemModel> patternListProperty = new SimpleListProperty<>(FXCollections.observableArrayList());\n-    private ObjectProperty<BibtexKeyPatternPanelItemModel> defaultKeyPatternProperty = new SimpleObjectProperty<>(\n+    private final ListProperty<BibtexKeyPatternPanelItemModel> patternListProperty = new SimpleListProperty<>(FXCollections.observableArrayList());\n+    private final ObjectProperty<BibtexKeyPatternPanelItemModel> defaultKeyPatternProperty = new SimpleObjectProperty<>(\n             new BibtexKeyPatternPanelItemModel(new BibtexKeyPatternPanelViewModel.DefaultEntryType(), \"\"));\n \n     private final DialogService dialogService;\n     private final JabRefPreferences preferences;\n+    private final BibtexKeyPatternPreferences initialBibtexKeyPatternPreferences;\n \n     public BibtexKeyPatternTabViewModel(DialogService dialogService, JabRefPreferences preferences) {\n         this.dialogService = dialogService;\n         this.preferences = preferences;\n+        this.initialBibtexKeyPatternPreferences = preferences.getBibtexKeyPatternPreferences();\n     }\n \n     @Override\n     public void setValues() {\n-        overwriteAllowProperty.setValue(!preferences.getBoolean(JabRefPreferences.AVOID_OVERWRITING_KEY));\n-        overwriteWarningProperty.setValue(preferences.getBoolean(JabRefPreferences.WARN_BEFORE_OVERWRITING_KEY));\n-        generateOnSaveProperty.setValue(preferences.getBoolean(JabRefPreferences.GENERATE_KEYS_BEFORE_SAVING));\n+        overwriteAllowProperty.setValue(!initialBibtexKeyPatternPreferences.avoidOverwritingCiteKey());\n+        overwriteWarningProperty.setValue(initialBibtexKeyPatternPreferences.isWarningBeforeOverwrite());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a5531598f8d069a011110582cb98bbd52269928"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjIwNA==", "bodyText": "Maybe rename to KeySuffix?", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r428576204", "createdAt": "2020-05-21T10:39:22Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/bibtexkeypattern/BibtexKeyPatternPreferences.java", "diffHunk": "@@ -4,48 +4,65 @@\n \n public class BibtexKeyPatternPreferences {\n \n+    public enum KeyLetters {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a5531598f8d069a011110582cb98bbd52269928"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjcwNQ==", "bodyText": "The globalCiteKeyPattern is now also included in the bibtexKeyPatternPreferences right?", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r428576705", "createdAt": "2020-05-21T10:40:37Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/exporter/SavePreferences.java", "diffHunk": "@@ -37,15 +36,14 @@ private SavePreferences(Boolean saveInOriginalOrder, SaveOrderConfig saveOrder,\n         this.reformatFile = reformatFile;\n         this.fieldWriterPreferences = fieldWriterPreferences;\n         this.globalCiteKeyPattern = globalCiteKeyPattern;\n-        this.generateBibtexKeysBeforeSaving = generateBibtexKeysBeforeSaving;\n         this.bibtexKeyPatternPreferences = bibtexKeyPatternPreferences;\n     }\n \n     public SavePreferences(Boolean saveInOriginalOrder, SaveOrderConfig saveOrder, Charset encoding,\n                            DatabaseSaveType saveType, Boolean takeMetadataSaveOrderInAccount, Boolean reformatFile,\n                            FieldWriterPreferences fieldWriterPreferences, GlobalBibtexKeyPattern globalCiteKeyPattern,\n-                           Boolean generateBibtexKeysBeforeSaving, BibtexKeyPatternPreferences bibtexKeyPatternPreferences) {\n-        this(saveInOriginalOrder, saveOrder, encoding, true, saveType, takeMetadataSaveOrderInAccount, reformatFile, fieldWriterPreferences, globalCiteKeyPattern, generateBibtexKeysBeforeSaving, bibtexKeyPatternPreferences);\n+                           BibtexKeyPatternPreferences bibtexKeyPatternPreferences) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a5531598f8d069a011110582cb98bbd52269928"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef7154a62dfd9a5e9fc853244609b981270887f4", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/ef7154a62dfd9a5e9fc853244609b981270887f4", "committedDate": "2020-05-21T13:51:31Z", "message": "Added CHANGELOG.md entry and some minor rewording"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f72ca07dcd427cdd809633177ca98f93c7f32e6e", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/f72ca07dcd427cdd809633177ca98f93c7f32e6e", "committedDate": "2020-05-21T14:51:24Z", "message": "Removed duplicate globalCiteKeyPattern out of SavePreferences, cached getGlobalBibtexKeyPattern()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2f5101a858ffb3c7af6f87987d995f078e80166", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/d2f5101a858ffb3c7af6f87987d995f078e80166", "committedDate": "2020-05-21T15:00:13Z", "message": "Reworded forgotten variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfb7f50eb5d91abe512b45c4c27e73cc6a2d76ea", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/bfb7f50eb5d91abe512b45c4c27e73cc6a2d76ea", "committedDate": "2020-05-21T16:12:55Z", "message": "Merge remote-tracking branch 'upstream/master' into refactor_bibtexkeyprefs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2ecab5a7f2e9c961a1ddc485093eb0b742d414c", "author": {"user": {"login": "tobiasdiez", "name": "Tobias Diez"}}, "url": "https://github.com/JabRef/jabref/commit/a2ecab5a7f2e9c961a1ddc485093eb0b742d414c", "committedDate": "2020-05-21T19:53:34Z", "message": "Merge branch 'master' into refactor_bibtexkeyprefs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "566fbf04492f451ae927f5bb5aba252d50f809a9", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/566fbf04492f451ae927f5bb5aba252d50f809a9", "committedDate": "2020-05-22T01:40:24Z", "message": "Removed superfluous expressions and some rewording in l10n"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 273, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}