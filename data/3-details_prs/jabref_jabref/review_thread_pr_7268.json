{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2MjYxMjU2", "number": 7268, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQyMDo1MzowOVrOFKZ_7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQyMDo1NDoyMVrOFKaA0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2NDU2MDQ3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/fieldeditors/contextmenu/EditorContextAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQyMDo1MzowOVrOINLZ2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTowMTo1MlrOINQt2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4OTI0MQ==", "bodyText": "The SELECT_ALL case was originally disabled, if SHOW_HANDLES was false. Why?", "url": "https://github.com/JabRef/jabref/pull/7268#discussion_r550689241", "createdAt": "2020-12-31T20:53:09Z", "author": {"login": "calixtus"}, "path": "src/main/java/org/jabref/gui/fieldeditors/contextmenu/EditorContextAction.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package org.jabref.gui.fieldeditors.contextmenu;\n+\n+import java.util.List;\n+\n+import javafx.beans.binding.Bindings;\n+import javafx.beans.binding.BooleanBinding;\n+import javafx.beans.property.BooleanProperty;\n+import javafx.scene.control.MenuItem;\n+import javafx.scene.control.PasswordField;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.input.Clipboard;\n+\n+import org.jabref.gui.actions.ActionFactory;\n+import org.jabref.gui.actions.SimpleCommand;\n+import org.jabref.gui.actions.StandardActions;\n+import org.jabref.gui.keyboard.KeyBindingRepository;\n+import org.jabref.gui.util.BindingsHelper;\n+import org.jabref.logic.util.OS;\n+\n+import com.sun.javafx.scene.control.Properties;\n+\n+public class EditorContextAction extends SimpleCommand {\n+\n+    private static final boolean SHOW_HANDLES = Properties.IS_TOUCH_SUPPORTED && !OS.OS_X;\n+\n+    private final StandardActions command;\n+    private final TextInputControl textInputControl;\n+\n+    public EditorContextAction(StandardActions command, TextInputControl textInputControl) {\n+        this.command = command;\n+        this.textInputControl = textInputControl;\n+\n+        BooleanProperty editableBinding = textInputControl.editableProperty();\n+        BooleanBinding hasTextBinding = Bindings.createBooleanBinding(() -> textInputControl.getLength() > 0, textInputControl.textProperty());\n+        BooleanBinding hasStringInClipboardBinding = (BooleanBinding) BindingsHelper.constantOf(Clipboard.getSystemClipboard().hasString());\n+        BooleanBinding hasSelectionBinding = Bindings.createBooleanBinding(() -> textInputControl.getSelection().getLength() > 0, textInputControl.selectionProperty());\n+        BooleanBinding allSelectedBinding = Bindings.createBooleanBinding(() -> textInputControl.getSelection().getLength() == textInputControl.getLength());\n+        BooleanBinding maskTextBinding = (BooleanBinding) BindingsHelper.constantOf(textInputControl instanceof PasswordField); // (maskText(\"A\") != \"A\");\n+\n+        if (SHOW_HANDLES) {\n+            this.executable.bind(\n+                    switch (command) {\n+                        case COPY -> editableBinding.and(maskTextBinding.not()).and(hasSelectionBinding);\n+                        case CUT -> maskTextBinding.not().and(hasSelectionBinding);\n+                        case PASTE -> editableBinding.and(hasStringInClipboardBinding);\n+                        case DELETE -> editableBinding.and(hasSelectionBinding);\n+                        case SELECT_ALL -> hasTextBinding.and(allSelectedBinding.not());\n+                        default -> BindingsHelper.constantOf(true);\n+                    });\n+        } else {\n+            this.executable.bind(\n+                    switch (command) {\n+                        case COPY -> editableBinding.and(maskTextBinding.not()).and(hasSelectionBinding);\n+                        case CUT -> maskTextBinding.not().and(hasSelectionBinding);\n+                        case PASTE -> editableBinding.and(hasStringInClipboardBinding);\n+                        case DELETE -> editableBinding.and(hasSelectionBinding);\n+                        case SELECT_ALL -> hasTextBinding.and(allSelectedBinding.not()); // why was this disabled before?\n+                        default -> BindingsHelper.constantOf(true);\n+                    });\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcd356c37a2d574ccafb653d883ae04964818277"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc3NjI4MQ==", "bodyText": "No idea why...", "url": "https://github.com/JabRef/jabref/pull/7268#discussion_r550776281", "createdAt": "2021-01-01T15:01:52Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/fieldeditors/contextmenu/EditorContextAction.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package org.jabref.gui.fieldeditors.contextmenu;\n+\n+import java.util.List;\n+\n+import javafx.beans.binding.Bindings;\n+import javafx.beans.binding.BooleanBinding;\n+import javafx.beans.property.BooleanProperty;\n+import javafx.scene.control.MenuItem;\n+import javafx.scene.control.PasswordField;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.input.Clipboard;\n+\n+import org.jabref.gui.actions.ActionFactory;\n+import org.jabref.gui.actions.SimpleCommand;\n+import org.jabref.gui.actions.StandardActions;\n+import org.jabref.gui.keyboard.KeyBindingRepository;\n+import org.jabref.gui.util.BindingsHelper;\n+import org.jabref.logic.util.OS;\n+\n+import com.sun.javafx.scene.control.Properties;\n+\n+public class EditorContextAction extends SimpleCommand {\n+\n+    private static final boolean SHOW_HANDLES = Properties.IS_TOUCH_SUPPORTED && !OS.OS_X;\n+\n+    private final StandardActions command;\n+    private final TextInputControl textInputControl;\n+\n+    public EditorContextAction(StandardActions command, TextInputControl textInputControl) {\n+        this.command = command;\n+        this.textInputControl = textInputControl;\n+\n+        BooleanProperty editableBinding = textInputControl.editableProperty();\n+        BooleanBinding hasTextBinding = Bindings.createBooleanBinding(() -> textInputControl.getLength() > 0, textInputControl.textProperty());\n+        BooleanBinding hasStringInClipboardBinding = (BooleanBinding) BindingsHelper.constantOf(Clipboard.getSystemClipboard().hasString());\n+        BooleanBinding hasSelectionBinding = Bindings.createBooleanBinding(() -> textInputControl.getSelection().getLength() > 0, textInputControl.selectionProperty());\n+        BooleanBinding allSelectedBinding = Bindings.createBooleanBinding(() -> textInputControl.getSelection().getLength() == textInputControl.getLength());\n+        BooleanBinding maskTextBinding = (BooleanBinding) BindingsHelper.constantOf(textInputControl instanceof PasswordField); // (maskText(\"A\") != \"A\");\n+\n+        if (SHOW_HANDLES) {\n+            this.executable.bind(\n+                    switch (command) {\n+                        case COPY -> editableBinding.and(maskTextBinding.not()).and(hasSelectionBinding);\n+                        case CUT -> maskTextBinding.not().and(hasSelectionBinding);\n+                        case PASTE -> editableBinding.and(hasStringInClipboardBinding);\n+                        case DELETE -> editableBinding.and(hasSelectionBinding);\n+                        case SELECT_ALL -> hasTextBinding.and(allSelectedBinding.not());\n+                        default -> BindingsHelper.constantOf(true);\n+                    });\n+        } else {\n+            this.executable.bind(\n+                    switch (command) {\n+                        case COPY -> editableBinding.and(maskTextBinding.not()).and(hasSelectionBinding);\n+                        case CUT -> maskTextBinding.not().and(hasSelectionBinding);\n+                        case PASTE -> editableBinding.and(hasStringInClipboardBinding);\n+                        case DELETE -> editableBinding.and(hasSelectionBinding);\n+                        case SELECT_ALL -> hasTextBinding.and(allSelectedBinding.not()); // why was this disabled before?\n+                        default -> BindingsHelper.constantOf(true);\n+                    });\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4OTI0MQ=="}, "originalCommit": {"oid": "fcd356c37a2d574ccafb653d883ae04964818277"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2NDU2Mjc0OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/jabref/gui/fieldeditors/contextmenu/EditorContextAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQyMDo1NDoyMVrOINLa1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTowMzoyMVrOINQuRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4OTQ5Mw==", "bodyText": "What does that property mean? Is this somehow related to the select all option above?", "url": "https://github.com/JabRef/jabref/pull/7268#discussion_r550689493", "createdAt": "2020-12-31T20:54:21Z", "author": {"login": "calixtus"}, "path": "src/main/java/org/jabref/gui/fieldeditors/contextmenu/EditorContextAction.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package org.jabref.gui.fieldeditors.contextmenu;\n+\n+import java.util.List;\n+\n+import javafx.beans.binding.Bindings;\n+import javafx.beans.binding.BooleanBinding;\n+import javafx.beans.property.BooleanProperty;\n+import javafx.scene.control.MenuItem;\n+import javafx.scene.control.PasswordField;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.input.Clipboard;\n+\n+import org.jabref.gui.actions.ActionFactory;\n+import org.jabref.gui.actions.SimpleCommand;\n+import org.jabref.gui.actions.StandardActions;\n+import org.jabref.gui.keyboard.KeyBindingRepository;\n+import org.jabref.gui.util.BindingsHelper;\n+import org.jabref.logic.util.OS;\n+\n+import com.sun.javafx.scene.control.Properties;\n+\n+public class EditorContextAction extends SimpleCommand {\n+\n+    private static final boolean SHOW_HANDLES = Properties.IS_TOUCH_SUPPORTED && !OS.OS_X;\n+\n+    private final StandardActions command;\n+    private final TextInputControl textInputControl;\n+\n+    public EditorContextAction(StandardActions command, TextInputControl textInputControl) {\n+        this.command = command;\n+        this.textInputControl = textInputControl;\n+\n+        BooleanProperty editableBinding = textInputControl.editableProperty();\n+        BooleanBinding hasTextBinding = Bindings.createBooleanBinding(() -> textInputControl.getLength() > 0, textInputControl.textProperty());\n+        BooleanBinding hasStringInClipboardBinding = (BooleanBinding) BindingsHelper.constantOf(Clipboard.getSystemClipboard().hasString());\n+        BooleanBinding hasSelectionBinding = Bindings.createBooleanBinding(() -> textInputControl.getSelection().getLength() > 0, textInputControl.selectionProperty());\n+        BooleanBinding allSelectedBinding = Bindings.createBooleanBinding(() -> textInputControl.getSelection().getLength() == textInputControl.getLength());\n+        BooleanBinding maskTextBinding = (BooleanBinding) BindingsHelper.constantOf(textInputControl instanceof PasswordField); // (maskText(\"A\") != \"A\");\n+\n+        if (SHOW_HANDLES) {\n+            this.executable.bind(\n+                    switch (command) {\n+                        case COPY -> editableBinding.and(maskTextBinding.not()).and(hasSelectionBinding);\n+                        case CUT -> maskTextBinding.not().and(hasSelectionBinding);\n+                        case PASTE -> editableBinding.and(hasStringInClipboardBinding);\n+                        case DELETE -> editableBinding.and(hasSelectionBinding);\n+                        case SELECT_ALL -> hasTextBinding.and(allSelectedBinding.not());\n+                        default -> BindingsHelper.constantOf(true);\n+                    });\n+        } else {\n+            this.executable.bind(\n+                    switch (command) {\n+                        case COPY -> editableBinding.and(maskTextBinding.not()).and(hasSelectionBinding);\n+                        case CUT -> maskTextBinding.not().and(hasSelectionBinding);\n+                        case PASTE -> editableBinding.and(hasStringInClipboardBinding);\n+                        case DELETE -> editableBinding.and(hasSelectionBinding);\n+                        case SELECT_ALL -> hasTextBinding.and(allSelectedBinding.not()); // why was this disabled before?\n+                        default -> BindingsHelper.constantOf(true);\n+                    });\n+        }\n+    }\n+\n+    @Override\n+    public void execute() {\n+        switch (command) {\n+            case COPY -> textInputControl.copy();\n+            case CUT -> textInputControl.cut();\n+            case PASTE -> textInputControl.paste();\n+            case DELETE -> textInputControl.deleteText(textInputControl.getSelection());\n+            case SELECT_ALL -> textInputControl.selectAll();\n+        }\n+        textInputControl.requestFocus();\n+    }\n+\n+    /**\n+     * Returns the default context menu items (except undo/redo)\n+     */\n+    public static List<MenuItem> getDefaultContextMenuItems(TextInputControl textInputControl,\n+                                                            KeyBindingRepository keyBindingRepository) {\n+        ActionFactory factory = new ActionFactory(keyBindingRepository);\n+\n+        MenuItem selectAllMenuItem = factory.createMenuItem(StandardActions.SELECT_ALL,\n+                new EditorContextAction(StandardActions.SELECT_ALL, textInputControl));\n+        if (SHOW_HANDLES) {\n+            selectAllMenuItem.getProperties().put(\"refreshMenu\", Boolean.TRUE); // what does that mean?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcd356c37a2d574ccafb653d883ae04964818277"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc3NjM5MQ==", "bodyText": "Also no idea here. I think, I copied these things from the original JavaFX sources.", "url": "https://github.com/JabRef/jabref/pull/7268#discussion_r550776391", "createdAt": "2021-01-01T15:03:21Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/fieldeditors/contextmenu/EditorContextAction.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package org.jabref.gui.fieldeditors.contextmenu;\n+\n+import java.util.List;\n+\n+import javafx.beans.binding.Bindings;\n+import javafx.beans.binding.BooleanBinding;\n+import javafx.beans.property.BooleanProperty;\n+import javafx.scene.control.MenuItem;\n+import javafx.scene.control.PasswordField;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.input.Clipboard;\n+\n+import org.jabref.gui.actions.ActionFactory;\n+import org.jabref.gui.actions.SimpleCommand;\n+import org.jabref.gui.actions.StandardActions;\n+import org.jabref.gui.keyboard.KeyBindingRepository;\n+import org.jabref.gui.util.BindingsHelper;\n+import org.jabref.logic.util.OS;\n+\n+import com.sun.javafx.scene.control.Properties;\n+\n+public class EditorContextAction extends SimpleCommand {\n+\n+    private static final boolean SHOW_HANDLES = Properties.IS_TOUCH_SUPPORTED && !OS.OS_X;\n+\n+    private final StandardActions command;\n+    private final TextInputControl textInputControl;\n+\n+    public EditorContextAction(StandardActions command, TextInputControl textInputControl) {\n+        this.command = command;\n+        this.textInputControl = textInputControl;\n+\n+        BooleanProperty editableBinding = textInputControl.editableProperty();\n+        BooleanBinding hasTextBinding = Bindings.createBooleanBinding(() -> textInputControl.getLength() > 0, textInputControl.textProperty());\n+        BooleanBinding hasStringInClipboardBinding = (BooleanBinding) BindingsHelper.constantOf(Clipboard.getSystemClipboard().hasString());\n+        BooleanBinding hasSelectionBinding = Bindings.createBooleanBinding(() -> textInputControl.getSelection().getLength() > 0, textInputControl.selectionProperty());\n+        BooleanBinding allSelectedBinding = Bindings.createBooleanBinding(() -> textInputControl.getSelection().getLength() == textInputControl.getLength());\n+        BooleanBinding maskTextBinding = (BooleanBinding) BindingsHelper.constantOf(textInputControl instanceof PasswordField); // (maskText(\"A\") != \"A\");\n+\n+        if (SHOW_HANDLES) {\n+            this.executable.bind(\n+                    switch (command) {\n+                        case COPY -> editableBinding.and(maskTextBinding.not()).and(hasSelectionBinding);\n+                        case CUT -> maskTextBinding.not().and(hasSelectionBinding);\n+                        case PASTE -> editableBinding.and(hasStringInClipboardBinding);\n+                        case DELETE -> editableBinding.and(hasSelectionBinding);\n+                        case SELECT_ALL -> hasTextBinding.and(allSelectedBinding.not());\n+                        default -> BindingsHelper.constantOf(true);\n+                    });\n+        } else {\n+            this.executable.bind(\n+                    switch (command) {\n+                        case COPY -> editableBinding.and(maskTextBinding.not()).and(hasSelectionBinding);\n+                        case CUT -> maskTextBinding.not().and(hasSelectionBinding);\n+                        case PASTE -> editableBinding.and(hasStringInClipboardBinding);\n+                        case DELETE -> editableBinding.and(hasSelectionBinding);\n+                        case SELECT_ALL -> hasTextBinding.and(allSelectedBinding.not()); // why was this disabled before?\n+                        default -> BindingsHelper.constantOf(true);\n+                    });\n+        }\n+    }\n+\n+    @Override\n+    public void execute() {\n+        switch (command) {\n+            case COPY -> textInputControl.copy();\n+            case CUT -> textInputControl.cut();\n+            case PASTE -> textInputControl.paste();\n+            case DELETE -> textInputControl.deleteText(textInputControl.getSelection());\n+            case SELECT_ALL -> textInputControl.selectAll();\n+        }\n+        textInputControl.requestFocus();\n+    }\n+\n+    /**\n+     * Returns the default context menu items (except undo/redo)\n+     */\n+    public static List<MenuItem> getDefaultContextMenuItems(TextInputControl textInputControl,\n+                                                            KeyBindingRepository keyBindingRepository) {\n+        ActionFactory factory = new ActionFactory(keyBindingRepository);\n+\n+        MenuItem selectAllMenuItem = factory.createMenuItem(StandardActions.SELECT_ALL,\n+                new EditorContextAction(StandardActions.SELECT_ALL, textInputControl));\n+        if (SHOW_HANDLES) {\n+            selectAllMenuItem.getProperties().put(\"refreshMenu\", Boolean.TRUE); // what does that mean?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4OTQ5Mw=="}, "originalCommit": {"oid": "fcd356c37a2d574ccafb653d883ae04964818277"}, "originalPosition": 85}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2099, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}