{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NDIxNTY5", "number": 6107, "title": "Complete refactor of LibraryProperties to mvvm", "bodyText": "This PR aims to refactor the LibraryPreferencesDialog to comply with the mvvm pattern.\nAgain, this PR is not so lightweight, as the pattern panels had to be reworked too, FieldFormattersCleanupsPanel had to be converted to mvvm-pattern, so the storeSettings-method could be placed into the ViewModel.\nThe package commonfxcontrols is introduced and should collect all panels used by several dialogs.\nwhen it's done, it should also fix #6091\nrefs #6106\nReworked FieldFormatterCleanupsPanel (works in LibraryProperties as well as in CleanupDialog:\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for bigger UI changes)\n Checked documentation: Is the information available and up to date? If not: Issue created at https://github.com/JabRef/user-documentation/issues.", "createdAt": "2020-03-12T19:01:42Z", "url": "https://github.com/JabRef/jabref/pull/6107", "merged": true, "mergeCommit": {"oid": "120a0afc515dc2bae4118b40c0c7b38833c041bb"}, "closed": true, "closedAt": "2020-03-22T15:32:31Z", "author": {"login": "calixtus"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMVN70AH2gAyMzg3NDIxNTY5OjQ1NmMwNTY3NmY1NDVjNGMyOWMzYWI1OGRjYzkyOTEwM2EzYzk1NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcP56UVAH2gAyMzg3NDIxNTY5Ojk0ZjkzMWMwYjZiM2VjNmVmZGQ3ZjgyNzA0ODlmMzViOGFkMGRiOGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "456c05676f545c4c29c3ab58dcc929103a3c9549", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/456c05676f545c4c29c3ab58dcc929103a3c9549", "committedDate": "2020-03-10T16:36:24Z", "message": "Reordered packages, removed CustomJFXPanel.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7eced7f90e25a8de43684d946b2bb78bf82b5e00", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/7eced7f90e25a8de43684d946b2bb78bf82b5e00", "committedDate": "2020-03-11T00:17:41Z", "message": "Refactored FieldFormatterCleanupsPanel to mvvm-pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fececfcdfbf0365f72f070f9d242b5ee8f9ec2c", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/2fececfcdfbf0365f72f070f9d242b5ee8f9ec2c", "committedDate": "2020-03-11T00:40:03Z", "message": "Added new FieldFormatterCleanupsPanel to CleanupPresetPanel, removed old FieldFormatterCleanupsPanel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4a367026c676bee2652a8a457c5b97b8f5b7b5a", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/f4a367026c676bee2652a8a457c5b97b8f5b7b5a", "committedDate": "2020-03-11T23:36:35Z", "message": "Refactored LibraryPropertiesAction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "068ba2b0de6f81bc4bed77714ba7d30e89a8f9a4", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/068ba2b0de6f81bc4bed77714ba7d30e89a8f9a4", "committedDate": "2020-03-12T18:53:03Z", "message": "Fixes instance creation of LibraryPropertiesAction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96d18745b20c4c2d4c0971fd11d890a32bd4c932", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/96d18745b20c4c2d4c0971fd11d890a32bd4c932", "committedDate": "2020-03-12T19:04:09Z", "message": "Merge remote-tracking branch 'upstream/master' into common_fx_controls"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODI5NzEz", "url": "https://github.com/JabRef/jabref/pull/6107#pullrequestreview-373829713", "createdAt": "2020-03-12T19:09:38Z", "commit": {"oid": "96d18745b20c4c2d4c0971fd11d890a32bd4c932"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxOTowOTozOFrOF1rrqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxOTowOTozOFrOF1rrqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTgzNDUzNg==", "bodyText": "Pass state manager as Parameter, it can be injected into the view", "url": "https://github.com/JabRef/jabref/pull/6107#discussion_r391834536", "createdAt": "2020-03-12T19:09:38Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanelViewModel.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package org.jabref.gui.commonfxcontrols;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.ListProperty;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleListProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.collections.FXCollections;\n+import javafx.scene.control.SelectionModel;\n+\n+import org.jabref.Globals;\n+import org.jabref.gui.util.NoSelectionModel;\n+import org.jabref.logic.cleanup.Cleanups;\n+import org.jabref.model.cleanup.FieldFormatterCleanup;\n+import org.jabref.model.cleanup.Formatter;\n+import org.jabref.model.entry.field.Field;\n+import org.jabref.model.entry.field.FieldFactory;\n+\n+public class FieldFormatterCleanupsPanelViewModel {\n+\n+    private final BooleanProperty cleanupsDisableProperty = new SimpleBooleanProperty();\n+    private final ListProperty<FieldFormatterCleanup> cleanupsListProperty = new SimpleListProperty<>(FXCollections.observableArrayList());\n+    private final ObjectProperty<SelectionModel<FieldFormatterCleanup>> selectedCleanupProperty = new SimpleObjectProperty<>(new NoSelectionModel<>());\n+    private final ListProperty<Field> availableFieldsProperty = new SimpleListProperty<>(FXCollections.observableArrayList(FieldFactory.getCommonFields()));\n+    private final ObjectProperty<Field> selectedFieldProperty = new SimpleObjectProperty<>();\n+    private final ListProperty<Formatter> availableFormattersProperty = new SimpleListProperty<>(FXCollections.observableArrayList(Cleanups.getBuiltInFormatters()));\n+    private final ObjectProperty<Formatter> selectedFormatterProperty = new SimpleObjectProperty<>();\n+\n+    public FieldFormatterCleanupsPanelViewModel() {\n+    }\n+\n+    public void resetToRecommended() {\n+        Globals.stateManager.getActiveDatabase().ifPresent(databaseContext -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96d18745b20c4c2d4c0971fd11d890a32bd4c932"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "078e1c90937725f88b2a120ac8dba7803ddf8bdb", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/078e1c90937725f88b2a120ac8dba7803ddf8bdb", "committedDate": "2020-03-12T20:50:15Z", "message": "Added injection of StateManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a61ecae8331ad8aa84d2d3f9ce37101ae45acccb", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/a61ecae8331ad8aa84d2d3f9ce37101ae45acccb", "committedDate": "2020-03-12T23:11:05Z", "message": "Refactored LibraryPropertiesDialogViewModel to save metadata from properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ad1c739a2edc206576b506d52b797671a88d10e", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/8ad1c739a2edc206576b506d52b797671a88d10e", "committedDate": "2020-03-12T23:48:21Z", "message": "Refactored ExportSortingTab to mvvm-pattern"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NjQ2NDcx", "url": "https://github.com/JabRef/jabref/pull/6107#pullrequestreview-374646471", "createdAt": "2020-03-13T22:12:02Z", "commit": {"oid": "8ad1c739a2edc206576b506d52b797671a88d10e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjoxMjowMlrOF2U2GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QyMjoxMjowMlrOF2U2GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwODk1Mw==", "bodyText": "I think it should work if you pass the stateManager as ctor parameter instead of using the injection", "url": "https://github.com/JabRef/jabref/pull/6107#discussion_r392508953", "createdAt": "2020-03-13T22:12:02Z", "author": {"login": "Siedlerchr"}, "path": "src/main/java/org/jabref/gui/commonfxcontrols/FieldFormatterCleanupsPanel.java", "diffHunk": "@@ -0,0 +1,139 @@\n+package org.jabref.gui.commonfxcontrols;\n+\n+import javax.inject.Inject;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.ListProperty;\n+import javafx.beans.property.ReadOnlyObjectWrapper;\n+import javafx.fxml.FXML;\n+import javafx.scene.control.CheckBox;\n+import javafx.scene.control.ComboBox;\n+import javafx.scene.control.SelectionMode;\n+import javafx.scene.control.TableColumn;\n+import javafx.scene.control.TableView;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.layout.VBox;\n+\n+import org.jabref.gui.StateManager;\n+import org.jabref.gui.icon.IconTheme;\n+import org.jabref.gui.util.FieldsUtil;\n+import org.jabref.gui.util.ValueTableCellFactory;\n+import org.jabref.gui.util.ViewModelListCellFactory;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.model.cleanup.FieldFormatterCleanup;\n+import org.jabref.model.cleanup.Formatter;\n+import org.jabref.model.entry.field.Field;\n+\n+import com.airhacks.afterburner.views.ViewLoader;\n+\n+public class FieldFormatterCleanupsPanel extends VBox {\n+\n+    @FXML private CheckBox cleanupsEnabled;\n+    @FXML private TableView<FieldFormatterCleanup> cleanupsList;\n+    @FXML private TableColumn<FieldFormatterCleanup, Field> fieldColumn;\n+    @FXML private TableColumn<FieldFormatterCleanup, Formatter> formatterColumn;\n+    @FXML private TableColumn<FieldFormatterCleanup, Field> actionsColumn;\n+    @FXML private ComboBox<Field> addableFields;\n+    @FXML private ComboBox<Formatter> addableFormatters;\n+\n+    @Inject private StateManager stateManager;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ad1c739a2edc206576b506d52b797671a88d10e"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a65dda05f93c19a34bc3b14cbd61fa2e2fc2f666", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/a65dda05f93c19a34bc3b14cbd61fa2e2fc2f666", "committedDate": "2020-03-16T00:11:36Z", "message": "l10n and changed failing injection with Globals"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e36200b11992fc4228512791d791c99dcda2887c", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/e36200b11992fc4228512791d791c99dcda2887c", "committedDate": "2020-03-16T00:20:58Z", "message": "Merge remote-tracking branch 'upstream/master' into common_fx_controls"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTQ5OTE3", "url": "https://github.com/JabRef/jabref/pull/6107#pullrequestreview-376149917", "createdAt": "2020-03-17T15:34:15Z", "commit": {"oid": "e36200b11992fc4228512791d791c99dcda2887c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2b0e303b9a31bf932daa68aa68bc596a82490d8", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/f2b0e303b9a31bf932daa68aa68bc596a82490d8", "committedDate": "2020-03-19T06:46:30Z", "message": "Merge remote-tracking branch 'upstream/master' into common_fx_controls\n\n# Conflicts:\n#\tsrc/main/resources/l10n/JabRef_en.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e8f3a42fa81af39674eec46e566f12fcca0e72e", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/8e8f3a42fa81af39674eec46e566f12fcca0e72e", "committedDate": "2020-03-19T06:52:51Z", "message": "l10n"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ffc56a3059b8457e62cdc6246126c91f93deb92", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/8ffc56a3059b8457e62cdc6246126c91f93deb92", "committedDate": "2020-03-20T14:26:29Z", "message": "Merge remote-tracking branch 'upstream/master' into common_fx_controls\n\n# Conflicts:\n#\tsrc/main/resources/l10n/JabRef_en.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94f931c0b6b3ec6efdd7f8270489f35b8ad0db8f", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/94f931c0b6b3ec6efdd7f8270489f35b8ad0db8f", "committedDate": "2020-03-21T19:03:14Z", "message": "Merge remote-tracking branch 'upstream/master' into common_fx_controls"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 403, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}