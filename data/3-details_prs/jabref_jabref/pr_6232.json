{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MjEzNzk0", "number": 6232, "title": "Allow basic markup syntax custom previews", "bodyText": "Add MarkdownFormatter using https://github.com/vsch/flexmark-java/ to format markdown.\nTo configure Markdown in custom previews add the \"Markdown\" formatter.\nMarkdown is enabled by default for the comment field as requested in #6194\nFixes #6194\n\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for bigger UI changes)\n Checked documentation: Is the information available and up to date? If not: Issue created at https://github.com/JabRef/user-documentation/issues.", "createdAt": "2020-04-01T20:24:04Z", "url": "https://github.com/JabRef/jabref/pull/6232", "merged": true, "mergeCommit": {"oid": "d4e46b099faaab5787c6df89898014a1ec34a61c"}, "closed": true, "closedAt": "2020-04-03T22:17:29Z", "author": {"login": "AlexanderGirgis"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTdjIoAH2gAyMzk3MjEzNzk0OjNjYjEwNDg3ZmRjMTM3ZjA1ZDA5Mjg2MWEwZGY5M2EzYWNjN2FhYWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUHUhTgFqTM4NzU3NTA4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3cb10487fdc137f05d092861a0df93a3acc7aaae", "author": {"user": {"login": "AlexanderGirgis", "name": "Alexander Girgis"}}, "url": "https://github.com/JabRef/jabref/commit/3cb10487fdc137f05d092861a0df93a3acc7aaae", "committedDate": "2020-04-01T20:16:16Z", "message": "Allow basic markup syntax custom previews\n\nAdd MarkdownFormatter using https://github.com/vsch/flexmark-java/ to format markdown.\nTo configure Markdown in custom previews add the \"Markdown\" formatter.\nMarkdown is enabled by default for the comment field as requested in https://github.com/JabRef/jabref/issues/6194"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b13832575ebfd45df3b5381f5e6e424113bf5714", "author": {"user": {"login": "AlexanderGirgis", "name": "Alexander Girgis"}}, "url": "https://github.com/JabRef/jabref/commit/b13832575ebfd45df3b5381f5e6e424113bf5714", "committedDate": "2020-04-01T21:34:52Z", "message": "Remove AssertJ in favor of plain JUnit5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1285b2a694228b3261fc36d9c3de95ad1c1137ed", "author": {"user": {"login": "AlexanderGirgis", "name": "Alexander Girgis"}}, "url": "https://github.com/JabRef/jabref/commit/1285b2a694228b3261fc36d9c3de95ad1c1137ed", "committedDate": "2020-04-01T21:53:35Z", "message": "Switch back to <p> instead of <br> for formatted text blocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6d16d54bdacbfbee869513cbbf1282daa6bc8d1", "author": {"user": {"login": "AlexanderGirgis", "name": "Alexander Girgis"}}, "url": "https://github.com/JabRef/jabref/commit/c6d16d54bdacbfbee869513cbbf1282daa6bc8d1", "committedDate": "2020-04-01T22:04:44Z", "message": "Reduce MarkdownFormatterTest.formatWhenFormattingComplexMarkupThenReturnsOnlyOneLine to actually test newlines only because the rest is covered elsewhere"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MjYwMjEw", "url": "https://github.com/JabRef/jabref/pull/6232#pullrequestreview-386260210", "createdAt": "2020-04-02T09:36:17Z", "commit": {"oid": "c6d16d54bdacbfbee869513cbbf1282daa6bc8d1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwOTozNjoxOFrOF_jKig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwOTozOTozN1rOF_jSdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE4MDc0Ng==", "bodyText": "is requires annotations really necessary. I remember that I had a few problems with annotations vs jakarta.annotation in the past.", "url": "https://github.com/JabRef/jabref/pull/6232#discussion_r402180746", "createdAt": "2020-04-02T09:36:18Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/module-info.java", "diffHunk": "@@ -82,4 +82,11 @@\n     requires org.antlr.antlr4.runtime;\n     requires flowless;\n     requires org.apache.tika.core;\n+\n+    requires flexmark;\n+    requires flexmark.ext.gfm.strikethrough;\n+    requires flexmark.ext.gfm.tasklist;\n+    requires flexmark.util.ast;\n+    requires flexmark.util.data;\n+    requires annotations;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6d16d54bdacbfbee869513cbbf1282daa6bc8d1"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE4MTc0OQ==", "bodyText": "is the HTMLChars formatter still necessary or is the HtmlRenderer already taking care of it?", "url": "https://github.com/JabRef/jabref/pull/6232#discussion_r402181749", "createdAt": "2020-04-02T09:37:58Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/logic/layout/format/MarkdownFormatter.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.jabref.logic.layout.format;\n+\n+import java.util.List;\n+import java.util.Objects;\n+\n+import org.jabref.logic.layout.LayoutFormatter;\n+\n+import com.vladsch.flexmark.ext.gfm.strikethrough.StrikethroughExtension;\n+import com.vladsch.flexmark.ext.gfm.tasklist.TaskListExtension;\n+import com.vladsch.flexmark.html.HtmlRenderer;\n+import com.vladsch.flexmark.parser.Parser;\n+import com.vladsch.flexmark.util.ast.Node;\n+import com.vladsch.flexmark.util.data.MutableDataSet;\n+\n+public class MarkdownFormatter implements LayoutFormatter {\n+\n+    private final Parser parser;\n+    private final HtmlRenderer renderer;\n+\n+    public MarkdownFormatter() {\n+        MutableDataSet options = new MutableDataSet();\n+        options.set(Parser.EXTENSIONS, List.of(\n+                StrikethroughExtension.create(),\n+                TaskListExtension.create()\n+        ));\n+\n+        parser = Parser.builder(options).build();\n+        renderer = HtmlRenderer.builder(options).build();\n+    }\n+\n+    @Override\n+    public String format(final String fieldText) {\n+        Objects.requireNonNull(fieldText, \"Field Text should not be null, when handed to formatter\");\n+\n+        Node document = parser.parse(fieldText);\n+        String html = renderer.render(document);\n+\n+        // workaround HTMLChars transforming \"\\n\" into <br> by returning a one liner", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6d16d54bdacbfbee869513cbbf1282daa6bc8d1"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE4Mjc3Mw==", "bodyText": "Is there a reason not to simply replace \\\\format[HTMLChars]{\\\\comment} with \\\\format[Markdown,HTMLChars]{\\\\comment} (or \\\\format[Markdown]{\\\\comment} see above)? If the user changed the preview style a bit, then this replacement would still have the desired effect, right?", "url": "https://github.com/JabRef/jabref/pull/6232#discussion_r402182773", "createdAt": "2020-04-02T09:39:37Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/migrations/PreferencesMigrations.java", "diffHunk": "@@ -301,6 +302,12 @@ static void upgradePreviewStyleFromReviewToComment(JabRefPreferences prefs) {\n         prefs.setPreviewStyle(migratedStyle);\n     }\n \n+    static void upgradePreviewStyleAllowMarkdown(JabRefPreferences prefs) {\n+        String currentPreviewStyle = prefs.getPreviewStyle();\n+        String migratedStyle = currentPreviewStyle.replace(\"\\\\begin{comment}<BR><BR><b>Comment: </b> \\\\format[HTMLChars]{\\\\comment} \\\\end{comment}\", \"\\\\begin{comment}<BR><BR><b>Comment: </b> \\\\format[Markdown,HTMLChars]{\\\\comment} \\\\end{comment}\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6d16d54bdacbfbee869513cbbf1282daa6bc8d1"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62552128117c1a7a6fbbb8d885e476134f515487", "author": {"user": {"login": "AlexanderGirgis", "name": "Alexander Girgis"}}, "url": "https://github.com/JabRef/jabref/commit/62552128117c1a7a6fbbb8d885e476134f515487", "committedDate": "2020-04-02T18:56:25Z", "message": "Remove annotations left behind by reverted change."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7ca5364412ff2ca3f8f721ba8ec0ff424ed0106", "author": {"user": {"login": "AlexanderGirgis", "name": "Alexander Girgis"}}, "url": "https://github.com/JabRef/jabref/commit/d7ca5364412ff2ca3f8f721ba8ec0ff424ed0106", "committedDate": "2020-04-02T20:36:16Z", "message": "Narrow configuration migration to migrate customized preview configurations as well as suggested in review by @tobiasdiez and @koppor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "232915482c41c13421c2b613c2947aae1bf20e1f", "author": {"user": {"login": "koppor", "name": "Oliver Kopp"}}, "url": "https://github.com/JabRef/jabref/commit/232915482c41c13421c2b613c2947aae1bf20e1f", "committedDate": "2020-04-03T06:23:01Z", "message": "Merge branch 'master' into AlexanderGirgis-allow-basic-markup-in-comment-fixes-6194"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aae5ede8e31537a0cdbfa9a003dd6370f1cf78c0", "author": {"user": {"login": "AlexanderGirgis", "name": "Alexander Girgis"}}, "url": "https://github.com/JabRef/jabref/commit/aae5ede8e31537a0cdbfa9a003dd6370f1cf78c0", "committedDate": "2020-04-03T20:04:48Z", "message": "Fix checkstyle error in PreferencesMigrationsTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cc45c6068ee544fe49a19309b1682dcf4492896", "author": {"user": {"login": "AlexanderGirgis", "name": "Alexander Girgis"}}, "url": "https://github.com/JabRef/jabref/commit/0cc45c6068ee544fe49a19309b1682dcf4492896", "committedDate": "2020-04-03T20:24:20Z", "message": "Merge branch 'allow-basic-markup-in-comment-fixes-6194' of https://github.com/AlexanderGirgis/jabref into allow-basic-markup-in-comment-fixes-6194"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTc1MDgx", "url": "https://github.com/JabRef/jabref/pull/6232#pullrequestreview-387575081", "createdAt": "2020-04-03T20:56:19Z", "commit": {"oid": "0cc45c6068ee544fe49a19309b1682dcf4492896"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 302, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}