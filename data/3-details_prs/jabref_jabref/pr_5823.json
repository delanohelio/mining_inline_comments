{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMzc5Mzg4", "number": 5823, "title": "Fix for multiple error messages in messed up source editor", "bodyText": "Fixes #5820\nJabRef created a new instance of CodeArea everytime an entry was selected and bound multiple listeners to the CodeArea and to the ValidationStatus in bindToEntry. Refactored it a little bit, so the CodeArea stays persistent and the error messages are only displayed once.\nDid some minor refactorings to the other Validators and to modules.info too, to avoid warning messages from the IDE, and fixed a minor mistake from a previous PR in dark.css.\nNo screenshot, as there is no visual change.\n\n Change in CHANGELOG.md described (if applicable)\n Tests created for changes (if applicable)\n Manually tested changed features in running JabRef (always required)\n Screenshots added in PR description (for bigger UI changes)\n Checked documentation: Is the information available and up to date? If not: Issue created at https://github.com/JabRef/user-documentation/issues.", "createdAt": "2020-01-10T10:21:12Z", "url": "https://github.com/JabRef/jabref/pull/5823", "merged": true, "mergeCommit": {"oid": "5f2ffb234d262422138b32efcab0f2adebf58d8b"}, "closed": true, "closedAt": "2020-01-10T15:04:58Z", "author": {"login": "calixtus"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb46lVvAH2gAyMzYxMzc5Mzg4OjMzZjg4YmE1NDg5NjA1ZGQ4NzU5YjQxYzAzZWNhZTA4ZjFlNWJlZTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4_jUUgH2gAyMzYxMzc5Mzg4OjQ3MzlkY2RjNDYxNjc3ZGU4MWQyZDNiYzU1MzFiY2I2MDA3YTIwN2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "33f88ba5489605dd8759b41c03ecae08f1e5bee0", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/33f88ba5489605dd8759b41c03ecae08f1e5bee0", "committedDate": "2020-01-10T08:49:58Z", "message": "Fix for unknown gray shade in dark theme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaf1cdc1b7f0a3fa0df92b08c2e7750e6eedb616", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/aaf1cdc1b7f0a3fa0df92b08c2e7750e6eedb616", "committedDate": "2020-01-10T08:51:22Z", "message": "Fix for missing import in module system"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d79dc29e3237d4a8b95ff74bc76da6f9d511db6c", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/d79dc29e3237d4a8b95ff74bc76da6f9d511db6c", "committedDate": "2020-01-10T09:31:09Z", "message": "Fixed multiple error dialogs with the same message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "753aede5c92a7c898f8ebdf4a323fa7d46248cb5", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/753aede5c92a7c898f8ebdf4a323fa7d46248cb5", "committedDate": "2020-01-10T09:36:35Z", "message": "Refactored FunctionBasedValidators to common interface and harmonised their logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e14a3036ea6def21eead7b2e285c65e0211c6b19", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/e14a3036ea6def21eead7b2e285c65e0211c6b19", "committedDate": "2020-01-10T10:06:00Z", "message": "Fixed storing entry before changing it and validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMDk3NjE1", "url": "https://github.com/JabRef/jabref/pull/5823#pullrequestreview-341097615", "createdAt": "2020-01-10T11:11:17Z", "commit": {"oid": "e14a3036ea6def21eead7b2e285c65e0211c6b19"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxMToxMToxN1rOFcRI7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxMToxODozOFrOFcRS9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE4NTI2MQ==", "bodyText": "The parent EntryEditorTab already defines currentEntry, which seems to be what you want.", "url": "https://github.com/JabRef/jabref/pull/5823#discussion_r365185261", "createdAt": "2020-01-10T11:11:17Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/entryeditor/SourceTab.java", "diffHunk": "@@ -64,15 +63,17 @@\n     private final BibDatabaseMode mode;\n     private final UndoManager undoManager;\n     private final ObjectProperty<ValidationMessage> sourceIsValid = new SimpleObjectProperty<>();\n-    @SuppressWarnings(\"unchecked\") private final ObservableRuleBasedValidator sourceValidator = new ObservableRuleBasedValidator(sourceIsValid);\n+    private final ObservableRuleBasedValidator sourceValidator = new ObservableRuleBasedValidator();\n     private final ImportFormatPreferences importFormatPreferences;\n     private final FileUpdateMonitor fileMonitor;\n     private final DialogService dialogService;\n     private final StateManager stateManager;\n     private Optional<Pattern> searchHighlightPattern = Optional.empty();\n-    private CodeArea codeArea;\n+    private final CodeArea codeArea;\n     private KeyBindingRepository keyBindingRepository;\n \n+    private BibEntry boundEntry;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e14a3036ea6def21eead7b2e285c65e0211c6b19"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE4NzgyOA==", "bodyText": "Why did you removed the binding fields -> code area? If the entry changes (e.g. cleanup actions or \"generate bibtex key\" or set special fields like ranked/printed/...), then these changes should be reflected in the source tab, too.", "url": "https://github.com/JabRef/jabref/pull/5823#discussion_r365187828", "createdAt": "2020-01-10T11:18:38Z", "author": {"login": "tobiasdiez"}, "path": "src/main/java/org/jabref/gui/entryeditor/SourceTab.java", "diffHunk": "@@ -201,30 +218,13 @@ public boolean shouldShow(BibEntry entry) {\n \n     @Override\n     protected void bindToEntry(BibEntry entry) {\n-        CodeArea codeArea = createSourceEditor();\n-        VirtualizedScrollPane<CodeArea> node = new VirtualizedScrollPane<>(codeArea);\n-        NotificationPane notificationPane = new NotificationPane(node);\n-        notificationPane.setShowFromTop(false);\n-        sourceValidator.getValidationStatus().getMessages().addListener((ListChangeListener<ValidationMessage>) c -> {\n-            if (sourceValidator.getValidationStatus().isValid()) {\n-                notificationPane.hide();\n-            } else {\n-                sourceValidator.getValidationStatus().getHighestMessage().ifPresent(validationMessage -> {\n-                    notificationPane.show(validationMessage.getMessage());//this seems not working\n-                    dialogService.showErrorDialogAndWait(validationMessage.getMessage());\n-                });\n-            }\n-        });\n-        this.setContent(codeArea);\n-        this.codeArea = codeArea;\n-\n-        // Store source for on focus out event in the source code (within its text area)\n-        // and update source code for every change of entry field values\n-        BindingsHelper.bindContentBidirectional(entry.getFieldsObservable(), codeArea.focusedProperty(), onFocus -> {\n-            if (!onFocus) {\n-                storeSource(entry, codeArea.textProperty().getValue());\n-            }\n-        }, fields -> {\n+        if (boundEntry != null) {\n+            storeSource(boundEntry, codeArea.textProperty().getValue());\n+        }\n+\n+        this.boundEntry = entry;\n+\n+        if (entry != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e14a3036ea6def21eead7b2e285c65e0211c6b19"}, "originalPosition": 152}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "929b31c86cc3997781cf94c442c07b33a838530c", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/929b31c86cc3997781cf94c442c07b33a838530c", "committedDate": "2020-01-10T12:38:01Z", "message": "Fixes sync between fields and sourceTab"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4739dcdc461677de81d2d3bc5531bcb6007a207c", "author": {"user": {"login": "calixtus", "name": "Carl Christian Snethlage"}}, "url": "https://github.com/JabRef/jabref/commit/4739dcdc461677de81d2d3bc5531bcb6007a207c", "committedDate": "2020-01-10T14:37:17Z", "message": "Fixes test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 521, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}