{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NjQxMzA5", "number": 1948, "title": "[#1632] Keep link open on cmd disposition update timeout", "bodyText": "Based on the discussion in #1632, the command link to the device is now kept open when the device hasn't sent a disposition update in time.", "createdAt": "2020-05-07T12:01:54Z", "url": "https://github.com/eclipse/hono/pull/1948", "merged": true, "mergeCommit": {"oid": "69c0282819250d3185d964af6ff2803fe85c3757"}, "closed": true, "closedAt": "2020-05-11T09:10:42Z", "author": {"login": "calohmn"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABce-EbvAH2gAyNDE0NjQxMzA5OjQyNjRjZDBjYzM3ZWU1NWIwMDRjNzI4ZDYxZjZlZTcyNGUzYjVmMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgLzSXAFqTQwODk4NDcwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4264cd0cc37ee55b004c728d61f6ee724e3b5f36", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/4264cd0cc37ee55b004c728d61f6ee724e3b5f36", "committedDate": "2020-05-07T14:22:46Z", "message": "[#1632] Keep link open on cmd disposition update timeout.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bca78fbfec84327440636b93ce18c07fb91c0367", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/bca78fbfec84327440636b93ce18c07fb91c0367", "committedDate": "2020-05-07T11:59:28Z", "message": "[#1632] Keep link open on cmd disposition update timeout.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}, "afterCommit": {"oid": "4264cd0cc37ee55b004c728d61f6ee724e3b5f36", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/4264cd0cc37ee55b004c728d61f6ee724e3b5f36", "committedDate": "2020-05-07T14:22:46Z", "message": "[#1632] Keep link open on cmd disposition update timeout.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4OTEwMDMx", "url": "https://github.com/eclipse/hono/pull/1948#pullrequestreview-408910031", "createdAt": "2020-05-11T07:06:17Z", "commit": {"oid": "4264cd0cc37ee55b004c728d61f6ee724e3b5f36"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwNzowNjoxOFrOGTPObg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwNzowNjoxOFrOGTPObg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgyNTU4Mg==", "bodyText": "why not log the error to the span?", "url": "https://github.com/eclipse/hono/pull/1948#discussion_r422825582", "createdAt": "2020-05-11T07:06:18Z", "author": {"login": "sophokles73"}, "path": "adapters/amqp-vertx/src/main/java/org/eclipse/hono/adapter/amqp/impl/VertxBasedAmqpProtocolAdapter.java", "diffHunk": "@@ -762,18 +749,29 @@ protected void handleRemoteSenderOpenForCommands(\n         });\n     }\n \n+    private void onCommandConnectionClose(final String tenantId, final String deviceId, final Device authenticatedDevice,\n+            final ProtocolAdapterCommandConsumer consumer, final OptionalInt traceSamplingPriority) {\n+\n+        final Span span = newSpan(\"handle closing of command connection\", authenticatedDevice, traceSamplingPriority);\n+        final Future<ProtonDelivery> sendEventFuture = sendDisconnectedTtdEvent(tenantId, deviceId, authenticatedDevice,\n+                span.context());\n+        final Future<Void> closeConsumerFuture = consumer.close(span.context());\n+\n+        CompositeFuture.join(sendEventFuture, closeConsumerFuture).recover(thr -> {\n+            Tags.ERROR.set(span, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4264cd0cc37ee55b004c728d61f6ee724e3b5f36"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4OTg0NzAy", "url": "https://github.com/eclipse/hono/pull/1948#pullrequestreview-408984702", "createdAt": "2020-05-11T08:56:38Z", "commit": {"oid": "4264cd0cc37ee55b004c728d61f6ee724e3b5f36"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 745, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}