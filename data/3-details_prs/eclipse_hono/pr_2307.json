{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0Mjc3MDY3", "number": 2307, "title": "Fix search devices operation and integration tests", "bodyText": "The integration tests for the search devices operation have not been running as it expects\nthe system property hono.deviceregistry.supportsSearchDevices set to true. This property\nhas been renamed to  deviceregistry.supportsSearchDevices in the pom.xml of tests\nmodule but not in the corresponding test class. This has been fixed now to use the renamed\nproperty in the test class.\n\n\nIntegration tests corresponding to the search devices operation have been disabled for the\nJDBC based device registry as it doesn't implement this operation.\n\n\nWhen the data type of a filter value is string and the value doesn't contain any search wild\ncard characters then that filter has been ignored by the MongoDB device registry. This has\nbeen fixed.\n\n\nWhen there are no filters specified in the request, then at least the results should be\nfiltered based on the tenant identifier in the request URL. This has been fixed in the\nMongoDB device registry.\n\n\nFix integration tests corresponding to the search devices operation.", "createdAt": "2020-11-19T22:34:26Z", "url": "https://github.com/eclipse/hono/pull/2307", "merged": true, "mergeCommit": {"oid": "90976090e52ab5b222a4f0ff7f88148085f79462"}, "closed": true, "closedAt": "2020-11-20T13:12:05Z", "author": {"login": "kaniyan"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeSKsUAFqTUzNTE2NzA2MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeV_5rAFqTUzNTM2MjU1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MTY3MDYw", "url": "https://github.com/eclipse/hono/pull/2307#pullrequestreview-535167060", "createdAt": "2020-11-20T07:21:06Z", "commit": {"oid": "15df141531d790177957c6dca99d11c6aac8c751"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNzoyMTowN1rOH3DLvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNzoyMzozMVrOH3DPLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ4NTg4NA==", "bodyText": "would you mind creating an issue for this that we can refer to in this PR as this seems to be clearly a bug, right?", "url": "https://github.com/eclipse/hono/pull/2307#discussion_r527485884", "createdAt": "2020-11-20T07:21:07Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-mongodb/src/main/java/org/eclipse/hono/deviceregistry/mongodb/utils/MongoDbDocumentBuilder.java", "diffHunk": "@@ -207,12 +207,9 @@ public MongoDbDocumentBuilder withDeviceFilters(final List<Filter> filters) {\n         filters.forEach(filter -> {\n             if (filter.getValue() instanceof String) {\n                 final String value = (String) filter.getValue();\n-                if (value.contains(\"*\") || value.contains(\"?\")) {\n-                    // if the value contains * and ? then use regex matching\n-                    document.put(mapDeviceField(filter.getField()),\n-                            new JsonObject().put(\"$regex\",\n-                                    DeviceRegistryUtils.getRegexExpressionForSearchOperation(value)));\n-                }\n+                document.put(mapDeviceField(filter.getField()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15df141531d790177957c6dca99d11c6aac8c751"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ4Njc2NQ==", "bodyText": "nice catch \ud83d\udc4d", "url": "https://github.com/eclipse/hono/pull/2307#discussion_r527486765", "createdAt": "2020-11-20T07:23:31Z", "author": {"login": "sophokles73"}, "path": "tests/src/test/java/org/eclipse/hono/tests/registry/DeviceManagementIT.java", "diffHunk": "@@ -403,7 +401,7 @@ public void testDeregisterDeviceFailsForNonExistingDevice(final VertxTestContext\n      *      Device Registry Management API - Search Devices</a>\n      */\n     @Nested\n-    @EnabledIfSystemProperty(named = \"hono.deviceregistry.supportsSearchDevices\", matches = \"true\")\n+    @EnabledIfSystemProperty(named = \"deviceregistry.supportsSearchDevices\", matches = \"true\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15df141531d790177957c6dca99d11c6aac8c751"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e63c7d68cce6914267c053887c0bdd57394faac3", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/e63c7d68cce6914267c053887c0bdd57394faac3", "committedDate": "2020-11-20T11:34:30Z", "message": "Disable search devices integration tests for JDBC based device registry\n\n* Integration tests corresponding to the search devices operation have been disabled for the\n JDBC based device registry as it doesn't implement this operation.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37f2a94b4caa8effce210b4e39844665334e75cc", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/37f2a94b4caa8effce210b4e39844665334e75cc", "committedDate": "2020-11-20T11:34:30Z", "message": "[#2308] Fix search devices operation and corresponding integration tests\n\n* The integration tests for the search devices operation have not been running as it expects\n  the system property `hono.deviceregistry.supportsSearchDevices` set to true. This property\n  has been renamed to  `deviceregistry.supportsSearchDevices` in the `pom.xml` of tests\n  module but not in the corresponding test class. This has been fixed now to use the renamed\n  property in the test class.\n\n* When the data type of a filter value is string and the value doesn't contain any search wild\n  card characters then that filter has been ignored by the MongoDB device registry. This has\n  been fixed.\n\n* When there are no filters specified in the request, then at least the results should be\n  filtered based on the tenant identifier in the request URL. This has been fixed.\n\n* Fix integration tests corresponding to the search devices operation.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15df141531d790177957c6dca99d11c6aac8c751", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/15df141531d790177957c6dca99d11c6aac8c751", "committedDate": "2020-11-19T22:30:37Z", "message": "Fix search devices operation and corresponding integration tests\n\n* The integration tests for the search devices operation have not been running as it expects\n  the system property `hono.deviceregistry.supportsSearchDevices` set to true. This property\n  has been renamed to  `deviceregistry.supportsSearchDevices` in the `pom.xml` of tests\n  module but not in the corresponding test class. This has been fixed now to use the renamed\n  property in the test class.\n\n* When the data type of a filter value is string and the value doesn't contain any search wild\n  card characters then that filter has been ignored by the MongoDB device registry. This has\n  been fixed.\n\n* Fix integration tests corresponding to the search devices operation.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}, "afterCommit": {"oid": "37f2a94b4caa8effce210b4e39844665334e75cc", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/37f2a94b4caa8effce210b4e39844665334e75cc", "committedDate": "2020-11-20T11:34:30Z", "message": "[#2308] Fix search devices operation and corresponding integration tests\n\n* The integration tests for the search devices operation have not been running as it expects\n  the system property `hono.deviceregistry.supportsSearchDevices` set to true. This property\n  has been renamed to  `deviceregistry.supportsSearchDevices` in the `pom.xml` of tests\n  module but not in the corresponding test class. This has been fixed now to use the renamed\n  property in the test class.\n\n* When the data type of a filter value is string and the value doesn't contain any search wild\n  card characters then that filter has been ignored by the MongoDB device registry. This has\n  been fixed.\n\n* When there are no filters specified in the request, then at least the results should be\n  filtered based on the tenant identifier in the request URL. This has been fixed.\n\n* Fix integration tests corresponding to the search devices operation.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MzYyNTU0", "url": "https://github.com/eclipse/hono/pull/2307#pullrequestreview-535362554", "createdAt": "2020-11-20T11:52:46Z", "commit": {"oid": "37f2a94b4caa8effce210b4e39844665334e75cc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 449, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}