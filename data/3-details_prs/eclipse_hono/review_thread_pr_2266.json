{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMTQxMDIz", "number": 2266, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNzo0NjowM1rOEyN95g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNzo0NzowNVrOEyN_UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMDkzMDk0OnYy", "diffSide": "RIGHT", "path": "tests/src/test/java/org/eclipse/hono/tests/amqp/AmqpConnectionIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNzo0NjowM1rOHou4sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNzo0NjowM1rOHou4sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ3MzI2Nw==", "bodyText": "WHEN a device of a non-existing tenant tries to connect", "url": "https://github.com/eclipse/hono/pull/2266#discussion_r512473267", "createdAt": "2020-10-27T07:46:03Z", "author": {"login": "sophokles73"}, "path": "tests/src/test/java/org/eclipse/hono/tests/amqp/AmqpConnectionIT.java", "diffHunk": "@@ -175,11 +176,37 @@ public void testConnectFailsForWrongCredentials(final VertxTestContext ctx) {\n         .compose(ok -> connectToAdapter(IntegrationTestSupport.getUsername(deviceId, tenantId), \"wrong password\"))\n         .onComplete(ctx.failing(t -> {\n             // THEN the connection is refused\n-            ctx.verify(() -> assertThat(t).isInstanceOf(SaslException.class));\n+            ctx.verify(() -> assertThat(t).isInstanceOf(AuthenticationException.class));\n             ctx.completeNow();\n         }));\n     }\n \n+    /**\n+     * Verifies that the adapter rejects connection attempts from devices\n+     * using credentials that contain a non-existing tenant.\n+     *\n+     * @param ctx The test context\n+     */\n+    @Test\n+    public void testConnectFailsForNonExistingTenant(final VertxTestContext ctx) {\n+\n+        // GIVEN a registered device\n+        final String tenantId = helper.getRandomTenantId();\n+        final String deviceId = helper.getRandomDeviceId(tenantId);\n+        final String password = \"secret\";\n+        final Tenant tenant = new Tenant();\n+\n+        helper.registry\n+                .addDeviceForTenant(tenantId, tenant, deviceId, password)\n+                // WHEN the device tries to connect using a wrong password", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "108252aca7915b083550ae0589a66fcd469fbe96"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMDkzNDU3OnYy", "diffSide": "RIGHT", "path": "tests/src/test/java/org/eclipse/hono/tests/mqtt/MqttConnectionIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNzo0NzowNVrOHou6xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwNzo0NzowNVrOHou6xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ3Mzc5Ng==", "bodyText": "see above", "url": "https://github.com/eclipse/hono/pull/2266#discussion_r512473796", "createdAt": "2020-10-27T07:47:05Z", "author": {"login": "sophokles73"}, "path": "tests/src/test/java/org/eclipse/hono/tests/mqtt/MqttConnectionIT.java", "diffHunk": "@@ -223,6 +223,32 @@ public void testConnectFailsForWrongCredentials(final VertxTestContext ctx) {\n         }));\n     }\n \n+    /**\n+     * Verifies that the adapter rejects connection attempts from devices\n+     * using credentials that contain a non-existing tenant.\n+     *\n+     * @param ctx The test context\n+     */\n+    @Test\n+    public void testConnectFailsForNonExistingTenant(final VertxTestContext ctx) {\n+\n+        // GIVEN a registered device\n+        final Tenant tenant = new Tenant();\n+\n+        helper.registry\n+                .addDeviceForTenant(tenantId, tenant, deviceId, password)\n+                // WHEN the device tries to connect using a wrong password", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "108252aca7915b083550ae0589a66fcd469fbe96"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2833, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}