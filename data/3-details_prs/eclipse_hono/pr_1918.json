{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3MTgwMDQy", "number": 1918, "title": "[#1864] Add basic authentication support for the MongoDB based device registry", "bodyText": "This PR provides basic authentication support for the MongoDB based device registry. Vert.x MongodB Auth Provider is used in this implementation. It makes use of the user credentials stored in a MongoDB collection to authenticate client credentials.", "createdAt": "2020-04-22T09:55:56Z", "url": "https://github.com/eclipse/hono/pull/1918", "merged": true, "mergeCommit": {"oid": "fe3e9bec0d4fc79ebc84f7e070a20f7103eb547d"}, "closed": true, "closedAt": "2020-05-05T07:40:39Z", "author": {"login": "kaniyan"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcctEniAFqTQwMzUxNzA5Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcePGc7AFqTQwNTU1NTQ0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNTE3MDk3", "url": "https://github.com/eclipse/hono/pull/1918#pullrequestreview-403517097", "createdAt": "2020-04-30T13:26:44Z", "commit": {"oid": "80ea34afb69d99358cac3e884e1ed50374a7bca4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzI0NDE3", "url": "https://github.com/eclipse/hono/pull/1918#pullrequestreview-404724417", "createdAt": "2020-05-04T06:06:06Z", "commit": {"oid": "80ea34afb69d99358cac3e884e1ed50374a7bca4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjowNjowNlrOGPzk9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNjowNzozNlrOGPzmbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIyNjg3MA==", "bodyText": "I'd rather have a bean of type MongoClient being ceated by the config class which can then be used by multiple other beans. FMPOV there is no reason why we need to depend on MongoDbCallExecutor here ...", "url": "https://github.com/eclipse/hono/pull/1918#discussion_r419226870", "createdAt": "2020-05-04T06:06:06Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-mongodb/src/main/java/org/eclipse/hono/deviceregistry/mongodb/ApplicationConfig.java", "diffHunk": "@@ -323,6 +329,26 @@ public ObjectFactoryCreatingFactoryBean httpServerFactory() {\n         return factory;\n     }\n \n+    /**\n+     * Creates a new instance of an auth handler to provide basic authentication for the \n+     * Hono's Device Registry Management APIs.\n+     * <p>\n+     * This creates an instance of the {@link HonoBasicAuthHandler} with an auth provider of type\n+     * {@link MongoAuth} to verify the credentials.\n+     *\n+     * @return The auth handler.\n+     * @see <a href=\"https://vertx.io/docs/vertx-auth-mongo/java/\">Mongo auth provider docs</a>\n+     */\n+    @Bean\n+    @Scope(\"prototype\")\n+    @ConditionalOnProperty(name = \"hono.registry.http.authenticationRequired\", havingValue = \"true\", matchIfMissing = true)\n+    public AuthHandler createAuthHandler() {\n+        return new HonoBasicAuthHandler(\n+                MongoAuth.create(mongoDBCallExecutor().getMongoClient(), new JsonObject()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80ea34afb69d99358cac3e884e1ed50374a7bca4"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIyNzI0NQ==", "bodyText": "this should come from configuration properties, don't you think?", "url": "https://github.com/eclipse/hono/pull/1918#discussion_r419227245", "createdAt": "2020-05-04T06:07:36Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-mongodb/src/main/java/org/eclipse/hono/deviceregistry/mongodb/ApplicationConfig.java", "diffHunk": "@@ -323,6 +329,26 @@ public ObjectFactoryCreatingFactoryBean httpServerFactory() {\n         return factory;\n     }\n \n+    /**\n+     * Creates a new instance of an auth handler to provide basic authentication for the \n+     * Hono's Device Registry Management APIs.\n+     * <p>\n+     * This creates an instance of the {@link HonoBasicAuthHandler} with an auth provider of type\n+     * {@link MongoAuth} to verify the credentials.\n+     *\n+     * @return The auth handler.\n+     * @see <a href=\"https://vertx.io/docs/vertx-auth-mongo/java/\">Mongo auth provider docs</a>\n+     */\n+    @Bean\n+    @Scope(\"prototype\")\n+    @ConditionalOnProperty(name = \"hono.registry.http.authenticationRequired\", havingValue = \"true\", matchIfMissing = true)\n+    public AuthHandler createAuthHandler() {\n+        return new HonoBasicAuthHandler(\n+                MongoAuth.create(mongoDBCallExecutor().getMongoClient(), new JsonObject()),\n+                MongoDbDeviceRegistryUtils.DEFAULT_REALM,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80ea34afb69d99358cac3e884e1ed50374a7bca4"}, "originalPosition": 54}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80ea34afb69d99358cac3e884e1ed50374a7bca4", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/80ea34afb69d99358cac3e884e1ed50374a7bca4", "committedDate": "2020-04-22T09:27:23Z", "message": "[#1864] Add basic authentication support for the MongoDB based device registry.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}, "afterCommit": {"oid": "d647bd4d1dae8c003efc3d06da7406f47cab9689", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/d647bd4d1dae8c003efc3d06da7406f47cab9689", "committedDate": "2020-05-04T07:48:16Z", "message": "Refactor to create MongoClient bean instead of depending upon MongoDbCallExecutor.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0OTQ5NzY1", "url": "https://github.com/eclipse/hono/pull/1918#pullrequestreview-404949765", "createdAt": "2020-05-04T12:42:44Z", "commit": {"oid": "98d96e6e376181a165bcc0d0bc1469dcc4600899"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMjo0Mjo0NFrOGP-hnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMjo0Mjo0NFrOGP-hnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQwNjIzOQ==", "bodyText": "wouldn't it make more sense to simply create an HTTP specific subclass of ServiceConfigProperties and add the required properties there?", "url": "https://github.com/eclipse/hono/pull/1918#discussion_r419406239", "createdAt": "2020-05-04T12:42:44Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-mongodb/src/main/java/org/eclipse/hono/deviceregistry/mongodb/ApplicationConfig.java", "diffHunk": "@@ -317,6 +317,18 @@ public ServiceConfigProperties httpServerProperties() {\n         return new ServiceConfigProperties();\n     }\n \n+    /**\n+     * Gets properties for configuring an authentication mechanism for the HTTP based \n+     * Device Registry Management endpoint.\n+     *\n+     * @return The properties.\n+     */\n+    @Bean\n+    @ConfigurationProperties(prefix = \"hono.registry.http.auth\")\n+    public MongoDbBasedRegistryAuthenticationConfigProperties httpServerAuthConfigProperties() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98d96e6e376181a165bcc0d0bc1469dcc4600899"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98d96e6e376181a165bcc0d0bc1469dcc4600899", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/98d96e6e376181a165bcc0d0bc1469dcc4600899", "committedDate": "2020-05-04T08:53:25Z", "message": "[#1864] Make the name of the realm to be used in the WWW-Authenticate header configurable.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}, "afterCommit": {"oid": "e319f6102bdace6fdde39d4d758913b8c27943af", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/e319f6102bdace6fdde39d4d758913b8c27943af", "committedDate": "2020-05-04T13:07:52Z", "message": "[#1864] Make the name of the realm to be used in the WWW-Authenticate header configurable.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDYwMjY1", "url": "https://github.com/eclipse/hono/pull/1918#pullrequestreview-405060265", "createdAt": "2020-05-04T14:48:43Z", "commit": {"oid": "e319f6102bdace6fdde39d4d758913b8c27943af"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDo0ODo0M1rOGQD3OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDo1NToyNFrOGQEKOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5MzY4OA==", "bodyText": "I guess this is obsolete now, isn't it?", "url": "https://github.com/eclipse/hono/pull/1918#discussion_r419493688", "createdAt": "2020-05-04T14:48:43Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-mongodb/src/main/java/org/eclipse/hono/deviceregistry/mongodb/utils/MongoDbDeviceRegistryUtils.java", "diffHunk": "@@ -35,6 +35,10 @@\n  */\n public final class MongoDbDeviceRegistryUtils {\n \n+    /**\n+     * The default name of the realm needed to authenticate to.\n+     */\n+    public static final String DEFAULT_REALM = \"Hono\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e319f6102bdace6fdde39d4d758913b8c27943af"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5NzMxOQ==", "bodyText": "this class doesn't seem to be specific to the MongoDB based registry, is it? Why not move it to the org.eclipse.hono.service.http package in the service-base module?", "url": "https://github.com/eclipse/hono/pull/1918#discussion_r419497319", "createdAt": "2020-05-04T14:53:42Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-mongodb/src/main/java/org/eclipse/hono/deviceregistry/mongodb/config/HttpServiceConfigProperties.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+\n+package org.eclipse.hono.deviceregistry.mongodb.config;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e319f6102bdace6fdde39d4d758913b8c27943af"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5ODU1Mg==", "bodyText": "instead of this conditional, you could simply pass in the config object as a param and check its authenticationRequired property to determine, if an AuthHandler needs to be created or not ...", "url": "https://github.com/eclipse/hono/pull/1918#discussion_r419498552", "createdAt": "2020-05-04T14:55:24Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-mongodb/src/main/java/org/eclipse/hono/deviceregistry/mongodb/ApplicationConfig.java", "diffHunk": "@@ -323,6 +341,26 @@ public ObjectFactoryCreatingFactoryBean httpServerFactory() {\n         return factory;\n     }\n \n+    /**\n+     * Creates a new instance of an auth handler to provide basic authentication for the \n+     * Hono's Device Registry Management APIs.\n+     * <p>\n+     * This creates an instance of the {@link HonoBasicAuthHandler} with an auth provider of type\n+     * {@link MongoAuth} to verify the credentials.\n+     *\n+     * @return The auth handler.\n+     * @see <a href=\"https://vertx.io/docs/vertx-auth-mongo/java/\">Mongo auth provider docs</a>\n+     */\n+    @Bean\n+    @Scope(\"prototype\")\n+    @ConditionalOnProperty(name = \"hono.registry.http.authenticationRequired\", havingValue = \"true\", matchIfMissing = true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e319f6102bdace6fdde39d4d758913b8c27943af"}, "originalPosition": 89}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e0e3a86133ee28428a8a954734c8b9721b5a3e2", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/1e0e3a86133ee28428a8a954734c8b9721b5a3e2", "committedDate": "2020-05-04T19:59:07Z", "message": "[#1864] Add basic authentication support for the MongoDB based device registry.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "349912f252e779623d6bf07408a4c049dd73c078", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/349912f252e779623d6bf07408a4c049dd73c078", "committedDate": "2020-05-04T19:59:07Z", "message": "Refactor to create MongoClient bean instead of depending upon MongoDbCallExecutor.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2753a3c0229c603fa5dbb7297a283437fa974b39", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/2753a3c0229c603fa5dbb7297a283437fa974b39", "committedDate": "2020-05-04T20:45:47Z", "message": "[#1864] Make the name of the realm to be used in the WWW-Authenticate header configurable.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e319f6102bdace6fdde39d4d758913b8c27943af", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/e319f6102bdace6fdde39d4d758913b8c27943af", "committedDate": "2020-05-04T13:07:52Z", "message": "[#1864] Make the name of the realm to be used in the WWW-Authenticate header configurable.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}, "afterCommit": {"oid": "2753a3c0229c603fa5dbb7297a283437fa974b39", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/2753a3c0229c603fa5dbb7297a283437fa974b39", "committedDate": "2020-05-04T20:45:47Z", "message": "[#1864] Make the name of the realm to be used in the WWW-Authenticate header configurable.\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTU1NDQ3", "url": "https://github.com/eclipse/hono/pull/1918#pullrequestreview-405555447", "createdAt": "2020-05-05T07:39:26Z", "commit": {"oid": "2753a3c0229c603fa5dbb7297a283437fa974b39"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 884, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}