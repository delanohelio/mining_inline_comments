{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxOTE2MzU2", "number": 2164, "title": "[#2134] Make use of the given client context to match credentials in MongoDB registry", "bodyText": "", "createdAt": "2020-09-08T09:39:32Z", "url": "https://github.com/eclipse/hono/pull/2164", "merged": true, "mergeCommit": {"oid": "cf32fde2df09ee25ac4ccf4a4c4340c200786201"}, "closed": true, "closedAt": "2020-09-10T06:32:50Z", "author": {"login": "kaniyan"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdG2UD7AFqTQ4NDA1OTgwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHa1wOgFqTQ4NTYxODI1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MDU5ODA3", "url": "https://github.com/eclipse/hono/pull/2164#pullrequestreview-484059807", "createdAt": "2020-09-08T11:57:24Z", "commit": {"oid": "b1120e627848109f7ec3ba8b80cd7c80d323dff8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMTo1NzoyNFrOHOZfcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxMTo1NzoyNFrOHOZfcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1OTc2MA==", "bodyText": "if the result is a JsonArray (as the previous line seems to indicate), then we should probably try to find the matching credentials among the elements of that array instead of just matching the first element, right?", "url": "https://github.com/eclipse/hono/pull/2164#discussion_r484859760", "createdAt": "2020-09-08T11:57:24Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-mongodb/src/main/java/org/eclipse/hono/deviceregistry/mongodb/service/MongoDbBasedCredentialsService.java", "diffHunk": "@@ -382,6 +383,8 @@ private CompositeFuture createIndices() {\n                         .flatMap(ok -> Optional\n                                 .ofNullable(result.getJsonArray(MongoDbDeviceRegistryUtils.FIELD_CREDENTIALS))\n                                 .map(credential -> credential.getJsonObject(0))\n+                                .filter(credential -> DeviceRegistryUtils.matchesWithClientContext(credential,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1120e627848109f7ec3ba8b80cd7c80d323dff8"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MjQ1MjM5", "url": "https://github.com/eclipse/hono/pull/2164#pullrequestreview-484245239", "createdAt": "2020-09-08T15:15:15Z", "commit": {"oid": "b1120e627848109f7ec3ba8b80cd7c80d323dff8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNToxNToxNVrOHOiFsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNToxNTozNFrOHOiGnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAwMDYyNw==", "bodyText": "It would be good to describe how the client context is matched against the extension properties as I do not think that this is straight forward.", "url": "https://github.com/eclipse/hono/pull/2164#discussion_r485000627", "createdAt": "2020-09-08T15:15:15Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/util/DeviceRegistryUtils.java", "diffHunk": "@@ -242,4 +242,39 @@ public static void checkCredential(\n             }\n         }\n     }\n+\n+    /**\n+     * Checks if the properties in the given client context matches with the extension properties of ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1120e627848109f7ec3ba8b80cd7c80d323dff8"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTAwMDg2MQ==", "bodyText": "Yes, that is true for our implementation at hand.", "url": "https://github.com/eclipse/hono/pull/2164#discussion_r485000861", "createdAt": "2020-09-08T15:15:34Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-mongodb/src/main/java/org/eclipse/hono/deviceregistry/mongodb/service/MongoDbBasedCredentialsService.java", "diffHunk": "@@ -382,6 +383,8 @@ private CompositeFuture createIndices() {\n                         .flatMap(ok -> Optional\n                                 .ofNullable(result.getJsonArray(MongoDbDeviceRegistryUtils.FIELD_CREDENTIALS))\n                                 .map(credential -> credential.getJsonObject(0))\n+                                .filter(credential -> DeviceRegistryUtils.matchesWithClientContext(credential,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1OTc2MA=="}, "originalCommit": {"oid": "b1120e627848109f7ec3ba8b80cd7c80d323dff8"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d2a4b78884d4847ce504b2be8571ae5e1ea8027", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/6d2a4b78884d4847ce504b2be8571ae5e1ea8027", "committedDate": "2020-09-09T14:16:09Z", "message": "[#2134] Support client context matching\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d998e4fa3f267f9b91d8d7b631b9dd3939b2c056", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/d998e4fa3f267f9b91d8d7b631b9dd3939b2c056", "committedDate": "2020-09-09T14:16:09Z", "message": "Update JavaDoc on how the client context matching is being done\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b1120e627848109f7ec3ba8b80cd7c80d323dff8", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/b1120e627848109f7ec3ba8b80cd7c80d323dff8", "committedDate": "2020-09-08T09:31:52Z", "message": "[#2134] Support client context matching\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}, "afterCommit": {"oid": "d998e4fa3f267f9b91d8d7b631b9dd3939b2c056", "author": {"user": {"login": "kaniyan", "name": "Karthees Kalidass"}}, "url": "https://github.com/eclipse/hono/commit/d998e4fa3f267f9b91d8d7b631b9dd3939b2c056", "committedDate": "2020-09-09T14:16:09Z", "message": "Update JavaDoc on how the client context matching is being done\n\nSigned-off-by: Kartheeswaran Kalidass <kartheeswaran.kalidass@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NjE4MjU1", "url": "https://github.com/eclipse/hono/pull/2164#pullrequestreview-485618255", "createdAt": "2020-09-10T06:30:57Z", "commit": {"oid": "d998e4fa3f267f9b91d8d7b631b9dd3939b2c056"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 558, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}