{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyOTQxODI1", "number": 1854, "title": "Add credential checking and encoding to the abstract service", "bodyText": "", "createdAt": "2020-03-24T11:45:15Z", "url": "https://github.com/eclipse/hono/pull/1854", "merged": true, "mergeCommit": {"oid": "0ff2e61d7662a4294b898a8b800a00523c9d0cdb"}, "closed": true, "closedAt": "2020-03-24T13:20:02Z", "author": {"login": "dejanb"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQyeJRgFqTM4MDI3NzM1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQyyAwgFqTM4MDI5ODAyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMjc3MzU4", "url": "https://github.com/eclipse/hono/pull/1854#pullrequestreview-380277358", "createdAt": "2020-03-24T12:52:49Z", "commit": {"oid": "08e8182354ee29c2c20e3706bd3085693215d18c"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjo1Mjo0OVrOF6uyMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjo1NjozNVrOF6u7VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEyODI0Mw==", "bodyText": "does it make sense to allow setting this to null?", "url": "https://github.com/eclipse/hono/pull/1854#discussion_r397128243", "createdAt": "2020-03-24T12:52:49Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/credentials/AbstractCredentialsManagementService.java", "diffHunk": "@@ -44,6 +65,11 @@ public void setTenantInformationService(final TenantInformationService tenantInf\n         this.tenantInformationService = tenantInformationService;\n     }\n \n+    @Autowired\n+    public void setPasswordEncoder(final HonoPasswordEncoder passwordEncoder) {\n+        this.passwordEncoder = passwordEncoder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08e8182354ee29c2c20e3706bd3085693215d18c"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEyOTQ2Nw==", "bodyText": "personally, I find it easier to read (and understand) the positive condition, i.e.\nif (needToEncode(credentials)) {\n} else {\n}", "url": "https://github.com/eclipse/hono/pull/1854#discussion_r397129467", "createdAt": "2020-03-24T12:54:47Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/credentials/AbstractCredentialsManagementService.java", "diffHunk": "@@ -91,4 +122,51 @@ public void setTenantInformationService(final TenantInformationService tenantInf\n                         : processReadCredentials(DeviceKey.from(result.getPayload(), deviceId), span));\n     }\n \n+    private Future<List<CommonCredential>> verifyAndEncodePasswords(final List<CommonCredential> credentials) {\n+        // Check if we need to encode passwords\n+        if (!needToEncode(credentials)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08e8182354ee29c2c20e3706bd3085693215d18c"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEzMDU4MA==", "bodyText": "!Strings.isNullOrEmpty(s.getPasswordPlain())?", "url": "https://github.com/eclipse/hono/pull/1854#discussion_r397130580", "createdAt": "2020-03-24T12:56:35Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/credentials/AbstractCredentialsManagementService.java", "diffHunk": "@@ -91,4 +122,51 @@ public void setTenantInformationService(final TenantInformationService tenantInf\n                         : processReadCredentials(DeviceKey.from(result.getPayload(), deviceId), span));\n     }\n \n+    private Future<List<CommonCredential>> verifyAndEncodePasswords(final List<CommonCredential> credentials) {\n+        // Check if we need to encode passwords\n+        if (!needToEncode(credentials)) {\n+            // ... no, so don't fork off a worker task, but inline work\n+            return Future.succeededFuture(checkCredentials(credentials));\n+        } else {\n+            // ... yes, encode passwords asynchronously\n+            return Futures.executeBlocking(this.vertx, () -> checkCredentials(checkCredentials(credentials)));\n+        }\n+    }\n+\n+    /**\n+     * Check if we need to encode any secrets.\n+     *\n+     * @param credentials The credentials to check.\n+     * @return {@code true} is the list contains at least one password which needs to be encoded on the\n+     *         server side.\n+     */\n+    private static boolean needToEncode(final List<CommonCredential> credentials) {\n+        return credentials\n+                .stream()\n+                .filter(PasswordCredential.class::isInstance)\n+                .map(PasswordCredential.class::cast)\n+                .flatMap(c -> c.getSecrets().stream())\n+                .anyMatch(s -> s.getPasswordPlain() != null && !s.getPasswordPlain().isEmpty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08e8182354ee29c2c20e3706bd3085693215d18c"}, "originalPosition": 112}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08e8182354ee29c2c20e3706bd3085693215d18c", "author": {"user": {"login": "dejanb", "name": "Dejan Bosanac"}}, "url": "https://github.com/eclipse/hono/commit/08e8182354ee29c2c20e3706bd3085693215d18c", "committedDate": "2020-03-24T11:44:33Z", "message": "Add credential checking and encoding to the abstract service"}, "afterCommit": {"oid": "0c9897143bd44a9866fe469c549027f366d89c68", "author": {"user": {"login": "dejanb", "name": "Dejan Bosanac"}}, "url": "https://github.com/eclipse/hono/commit/0c9897143bd44a9866fe469c549027f366d89c68", "committedDate": "2020-03-24T13:10:45Z", "message": "Add credential checking and encoding to the abstract service"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMjkzMTQz", "url": "https://github.com/eclipse/hono/pull/1854#pullrequestreview-380293143", "createdAt": "2020-03-24T13:12:41Z", "commit": {"oid": "0c9897143bd44a9866fe469c549027f366d89c68"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMzoxMjo0MVrOF6vhZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMzoxMjo0MVrOF6vhZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE0MDMyNQ==", "bodyText": "now you also need to remove the ! ;-)", "url": "https://github.com/eclipse/hono/pull/1854#discussion_r397140325", "createdAt": "2020-03-24T13:12:41Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/credentials/AbstractCredentialsManagementService.java", "diffHunk": "@@ -91,4 +131,51 @@ public void setTenantInformationService(final TenantInformationService tenantInf\n                         : processReadCredentials(DeviceKey.from(result.getPayload(), deviceId), span));\n     }\n \n+    private Future<List<CommonCredential>> verifyAndEncodePasswords(final List<CommonCredential> credentials) {\n+        // Check if we need to encode passwords\n+        if (!needToEncode(credentials)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c9897143bd44a9866fe469c549027f366d89c68"}, "originalPosition": 100}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0708b5ebc6a1583f1f849c288eb3fc66c9c8ea3", "author": {"user": {"login": "dejanb", "name": "Dejan Bosanac"}}, "url": "https://github.com/eclipse/hono/commit/e0708b5ebc6a1583f1f849c288eb3fc66c9c8ea3", "committedDate": "2020-03-24T13:14:24Z", "message": "Add credential checking and encoding to the abstract service"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c9897143bd44a9866fe469c549027f366d89c68", "author": {"user": {"login": "dejanb", "name": "Dejan Bosanac"}}, "url": "https://github.com/eclipse/hono/commit/0c9897143bd44a9866fe469c549027f366d89c68", "committedDate": "2020-03-24T13:10:45Z", "message": "Add credential checking and encoding to the abstract service"}, "afterCommit": {"oid": "e0708b5ebc6a1583f1f849c288eb3fc66c9c8ea3", "author": {"user": {"login": "dejanb", "name": "Dejan Bosanac"}}, "url": "https://github.com/eclipse/hono/commit/e0708b5ebc6a1583f1f849c288eb3fc66c9c8ea3", "committedDate": "2020-03-24T13:14:24Z", "message": "Add credential checking and encoding to the abstract service"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMjk4MDIw", "url": "https://github.com/eclipse/hono/pull/1854#pullrequestreview-380298020", "createdAt": "2020-03-24T13:18:45Z", "commit": {"oid": "e0708b5ebc6a1583f1f849c288eb3fc66c9c8ea3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 831, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}