{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwNjQxMzQ3", "number": 2297, "title": "[#2267] Do not use Spring autowiring for adapters anymore", "bodyText": "The collaborators required by protocol adapters are not injected using\nautowiring anymore. This allows for shifting responsibility of object\ninstantiation/initialization from AbstractProtocolAdapterBase to the\nSpring Boot/Quarkus configuration classes which helps with hiding\nimplementation details from the adapter implementation classes.", "createdAt": "2020-11-13T15:16:22Z", "url": "https://github.com/eclipse/hono/pull/2297", "merged": true, "mergeCommit": {"oid": "be421cc0007eeb7680237513156ca3e2e91dda79"}, "closed": true, "closedAt": "2020-11-16T10:54:08Z", "author": {"login": "sophokles73"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcIr4SgH2gAyNTIwNjQxMzQ3OjhlYzFjNzJlYzA1MjZhMjNkMGU0NmE2YjExODUwZDI0NzNmZTBmOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddCu1IAFqTUzMTIxMDYwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8ec1c72ec0526a23d0e46a6b11850d2473fe0f95", "author": {"user": {"login": "sophokles73", "name": "Kai Hudalla"}}, "url": "https://github.com/eclipse/hono/commit/8ec1c72ec0526a23d0e46a6b11850d2473fe0f95", "committedDate": "2020-11-13T15:14:17Z", "message": "[#2267] Do not use Spring autowiring for adapters anymore\n\nThe collaborators required by protocol adapters are not injected using\nautowiring anymore. This allows for shifting responsibility of object\ninstantiation/initialization from AbstractProtocolAdapterBase to the\nSpring Boot/Quarkus configuration classes which helps with hiding\nimplementation details from the adapter implementation classes.\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMjc2MjI4", "url": "https://github.com/eclipse/hono/pull/2297#pullrequestreview-530276228", "createdAt": "2020-11-13T17:44:23Z", "commit": {"oid": "8ec1c72ec0526a23d0e46a6b11850d2473fe0f95"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNzo0NDoyM1rOHy4vqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNzo0NDoyM1rOHy4vqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEyMDU1NQ==", "bodyText": "It seems to me, the content of the adapter() method can be reduced to just:\n        final VertxBasedMqttProtocolAdapter adapter = new VertxBasedMqttProtocolAdapter();\n        setCollaborators(adapter);\n        adapter.setConfig(adapterProperties);\n        adapter.setMetrics(metrics);\n        adapter.setMessageMapping(messageMapping());\n        return adapter;\n\nusing the parent setCollaborators(AbstractProtocolAdapterBase) method.\nSame goes for the corresponding class/method in the hono-adapter-http-vertx-quarkus module.", "url": "https://github.com/eclipse/hono/pull/2297#discussion_r523120555", "createdAt": "2020-11-13T17:44:23Z", "author": {"login": "calohmn"}, "path": "adapters/mqtt-vertx-quarkus/src/main/java/org/eclipse/hono/adapter/mqtt/quarkus/Application.java", "diffHunk": "@@ -83,16 +96,73 @@ void onStop(final @Observes ShutdownEvent ev) {\n \n     private VertxBasedMqttProtocolAdapter adapter() {\n \n+        final DeviceRegistrationClient registrationClient = registrationClient();\n+        final DeviceConnectionClient deviceConnectionClient = deviceConnectionClient();\n+        final CommandTargetMapper commandTargetMapper = commandTargetMapper();\n+\n+        commandTargetMapper.initialize(new CommandTargetMapperContext() {\n+\n+            @Override\n+            public Future<List<String>> getViaGateways(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ec1c72ec0526a23d0e46a6b11850d2473fe0f95"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65354b3611da2a353cb7fb44ec06f3fdf40c00ef", "author": {"user": {"login": "sophokles73", "name": "Kai Hudalla"}}, "url": "https://github.com/eclipse/hono/commit/65354b3611da2a353cb7fb44ec06f3fdf40c00ef", "committedDate": "2020-11-16T07:34:15Z", "message": "Incorporate feedback\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMDQ4OTA3", "url": "https://github.com/eclipse/hono/pull/2297#pullrequestreview-531048907", "createdAt": "2020-11-16T08:14:33Z", "commit": {"oid": "65354b3611da2a353cb7fb44ec06f3fdf40c00ef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwODoxNDozM1rOHzr97Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwODoxNDozM1rOHzr97Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk1OTc4OQ==", "bodyText": "There are still subclasses of AbstractProtocolAdapterBase that use the @Autowired annotation (e.g. VertxBasedMqttProtocolAdapter), I guess it should be removed there as well.", "url": "https://github.com/eclipse/hono/pull/2297#discussion_r523959789", "createdAt": "2020-11-16T08:14:33Z", "author": {"login": "calohmn"}, "path": "service-base/src/main/java/org/eclipse/hono/service/AbstractProtocolAdapterBase.java", "diffHunk": "@@ -55,22 +51,15 @@\n import org.eclipse.hono.service.resourcelimits.ResourceLimitChecks;\n import org.eclipse.hono.service.util.ServiceBaseUtils;\n import org.eclipse.hono.util.Constants;\n-import org.eclipse.hono.util.CredentialsConstants;\n-import org.eclipse.hono.util.DeviceConnectionConstants;\n import org.eclipse.hono.util.EventConstants;\n import org.eclipse.hono.util.Lifecycle;\n import org.eclipse.hono.util.MessageHelper;\n import org.eclipse.hono.util.QoS;\n import org.eclipse.hono.util.RegistrationAssertion;\n-import org.eclipse.hono.util.RegistrationConstants;\n import org.eclipse.hono.util.ResourceIdentifier;\n import org.eclipse.hono.util.Strings;\n-import org.eclipse.hono.util.TelemetryConstants;\n import org.eclipse.hono.util.TelemetryExecutionContext;\n-import org.eclipse.hono.util.TenantConstants;\n import org.eclipse.hono.util.TenantObject;\n-import org.springframework.beans.factory.annotation.Autowired;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65354b3611da2a353cb7fb44ec06f3fdf40c00ef"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f91d270376a327765ad8af8d778d7386173fc96", "author": {"user": {"login": "sophokles73", "name": "Kai Hudalla"}}, "url": "https://github.com/eclipse/hono/commit/6f91d270376a327765ad8af8d778d7386173fc96", "committedDate": "2020-11-16T09:59:02Z", "message": "Do not use autowiring for injecting metrics implementation\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMjEwNjA0", "url": "https://github.com/eclipse/hono/pull/2297#pullrequestreview-531210604", "createdAt": "2020-11-16T10:52:00Z", "commit": {"oid": "6f91d270376a327765ad8af8d778d7386173fc96"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 437, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}