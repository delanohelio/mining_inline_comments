{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NTgzNTQ2", "number": 2092, "title": "CoAP adapter: fix tracing info and add tests", "bodyText": "This fixes the CoAP adapter always setting an authenticated: true tag on the \"upload telemetry/event\" trace span - even for an unauthenticated request. This is done by using a null value for authenticatedDevice variables in case of an unauthenticated request, like it is also used in the methods of the protocol adapter base classes.\nAlso integration tests regarding Command & Control with an unauthenticated device have been added.\nThe refactorings done here serve as a preparation for the fix for #1395.", "createdAt": "2020-07-28T06:21:17Z", "url": "https://github.com/eclipse/hono/pull/2092", "merged": true, "mergeCommit": {"oid": "7a7a7dbec03b22254706669481f12a5eca3f34fa"}, "closed": true, "closedAt": "2020-07-28T10:17:08Z", "author": {"login": "calohmn"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4DVwNgH2gAyNDU3NTgzNTQ2OmYzZTBkN2IyMjAzZWZkYjZlNGViZGYwNDBjZTJlNWIyNzNlZTY1MjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5TqwoAFqTQ1NjQ5NDc5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f3e0d7b2203efdb6e4ebdf040ce2e5b273ee6521", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/f3e0d7b2203efdb6e4ebdf040ce2e5b273ee6521", "committedDate": "2020-07-24T12:39:19Z", "message": "Add CoAP C&C tests concerning an unauthenticated device.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f193237f76bfe5f8e3df3991807e8e70e7e7157", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/9f193237f76bfe5f8e3df3991807e8e70e7e7157", "committedDate": "2020-07-28T06:12:21Z", "message": "Fix tracing info about whether a CoAP request is authenticated.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2Mzc1NDIz", "url": "https://github.com/eclipse/hono/pull/2092#pullrequestreview-456375423", "createdAt": "2020-07-28T07:36:32Z", "commit": {"oid": "9f193237f76bfe5f8e3df3991807e8e70e7e7157"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNzozNjozMlrOG4AUzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwNzozNjozMlrOG4AUzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM3ODc2Ng==", "bodyText": "I'm not sure, if a device, which doesn't use coaps, could be considered to be authenticated?", "url": "https://github.com/eclipse/hono/pull/2092#discussion_r461378766", "createdAt": "2020-07-28T07:36:32Z", "author": {"login": "boaks"}, "path": "tests/src/test/java/org/eclipse/hono/tests/coap/CoapTestBase.java", "diffHunk": "@@ -1053,6 +1059,53 @@ private URI getRequestUri(final String scheme, final String resource) {\n         }\n     }\n \n+    /**\n+     * Creates a CoAP request using either the <em>coaps</em> or <em>coap</em> scheme,\n+     * depending on the given endpoint configuration.\n+     *\n+     * @param endpointConfig The endpoint configuration.\n+     * @param requestDeviceId The identifier of the device to publish data for.\n+     * @param msgNo The message number.\n+     * @return The request to send.\n+     */\n+    protected Request createCoapsOrCoapRequest(\n+            final CoapCommandEndpointConfiguration endpointConfig,\n+            final String requestDeviceId,\n+            final int msgNo) {\n+\n+        if (endpointConfig.isSubscribeAsGatewayForSingleDevice()) {\n+            return createCoapsRequest(Code.PUT, getMessageType(), getPutResource(tenantId, requestDeviceId), msgNo);\n+        } else if (endpointConfig.isSubscribeAsUnauthenticatedDevice()) {\n+            return createCoapRequest(Code.PUT, getMessageType(), getPutResource(tenantId, requestDeviceId), msgNo);\n+        } else {\n+            return createCoapsRequest(Code.POST, getMessageType(), getPostResource(), msgNo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f193237f76bfe5f8e3df3991807e8e70e7e7157"}, "originalPosition": 111}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NDk0Nzk4", "url": "https://github.com/eclipse/hono/pull/2092#pullrequestreview-456494798", "createdAt": "2020-07-28T10:14:40Z", "commit": {"oid": "9f193237f76bfe5f8e3df3991807e8e70e7e7157"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 723, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}