{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyOTUwOTc2", "number": 1803, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNTo0ODoxNVrODktP-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMToyNDowNlrODlYs1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5ODE2Njk5OnYy", "diffSide": "RIGHT", "path": "service-base/src/test/java/org/eclipse/hono/service/credentials/AbstractCredentialsServiceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNTo0ODoxNVrOFxLY-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNzo0NTo0OVrOFxQC1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzExMTE2MA==", "bodyText": "It looks to me as if the\n.setHandler(ctx.succeeding(s -> Future.succeededFuture(s)))\npart can be removed.\nThe future returned by createDevice gets a handler here and is assigned to phase1Future.\nSome lines below the phase1Future gets a handler again, overwriting the previous one. Therefore the above line looks superfluous.\nSame applies to 7 other occurrences of a similar block in this class.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r387111160", "createdAt": "2020-03-03T15:48:15Z", "author": {"login": "calohmn"}, "path": "service-base/src/test/java/org/eclipse/hono/service/credentials/AbstractCredentialsServiceTest.java", "diffHunk": "@@ -702,16 +700,15 @@ public void testDisableCredentials(final VertxTestContext ctx) {\n \n         // create device\n \n-        final Promise<?> phase1 = Promise.promise();\n-        getDeviceManagementService().createDevice(\n-                tenantId, Optional.of(deviceId), new Device(), NoopSpan.INSTANCE,\n-                ctx.succeeding(s -> phase1.complete()));\n+        final Future<OperationResult<Id>> phase1Future = getDeviceManagementService().createDevice(\n+                tenantId, Optional.of(deviceId), new Device(), NoopSpan.INSTANCE)\n+                .setHandler(ctx.succeeding(s -> Future.succeededFuture(s)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75aaa49f8f58b85e5df8617aed7531e104507d70"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4NzQxNQ==", "bodyText": "@calohmn Done. Also I have replaced phase1Future with inline reference.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r387187415", "createdAt": "2020-03-03T17:45:49Z", "author": {"login": "kaniyan"}, "path": "service-base/src/test/java/org/eclipse/hono/service/credentials/AbstractCredentialsServiceTest.java", "diffHunk": "@@ -702,16 +700,15 @@ public void testDisableCredentials(final VertxTestContext ctx) {\n \n         // create device\n \n-        final Promise<?> phase1 = Promise.promise();\n-        getDeviceManagementService().createDevice(\n-                tenantId, Optional.of(deviceId), new Device(), NoopSpan.INSTANCE,\n-                ctx.succeeding(s -> phase1.complete()));\n+        final Future<OperationResult<Id>> phase1Future = getDeviceManagementService().createDevice(\n+                tenantId, Optional.of(deviceId), new Device(), NoopSpan.INSTANCE)\n+                .setHandler(ctx.succeeding(s -> Future.succeededFuture(s)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzExMTE2MA=="}, "originalCommit": {"oid": "75aaa49f8f58b85e5df8617aed7531e104507d70"}, "originalPosition": 120}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5ODE3OTc2OnYy", "diffSide": "RIGHT", "path": "service-base/src/test/java/org/eclipse/hono/service/management/device/AutoProvisioningEnabledDeviceBackendTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNTo1MDo1NFrOFxLgqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNzo0ODozMlrOFxQJCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzExMzEzMA==", "bodyText": "Using when(underTest.createDevice(...)).thenReturn(Future.succeededFuture(...)); looks simpler here.\nSame in 2 other places below.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r387113130", "createdAt": "2020-03-03T15:50:54Z", "author": {"login": "calohmn"}, "path": "service-base/src/test/java/org/eclipse/hono/service/management/device/AutoProvisioningEnabledDeviceBackendTest.java", "diffHunk": "@@ -80,11 +80,9 @@ public void testProvisionDeviceSucceeds(final VertxTestContext ctx) {\n         final AutoProvisioningEnabledDeviceBackend underTest = mock(AutoProvisioningEnabledDeviceBackend.class);\n         when(underTest.provisionDevice(anyString(), any(), any())).thenCallRealMethod();\n \n-        doAnswer(invocation -> {\n-            final Promise<OperationResult<Id>> promise = invocation.getArgument(4);\n-            promise.complete(OperationResult.ok(201, Id.of(DEVICE_ID), Optional.empty(), Optional.empty()));\n-            return null;\n-        }).when(underTest).createDevice(any(), any(), any(), any(), any(Handler.class));\n+        doAnswer(invocation -> Future\n+                .succeededFuture(OperationResult.ok(201, Id.of(DEVICE_ID), Optional.empty(), Optional.empty()))\n+        ).when(underTest).createDevice(any(), any(), any(), any());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75aaa49f8f58b85e5df8617aed7531e104507d70"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4OTAwMQ==", "bodyText": "I though of the same and I tried to keep it as close to the original code, so its easier to review. I changed it now.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r387189001", "createdAt": "2020-03-03T17:48:32Z", "author": {"login": "kaniyan"}, "path": "service-base/src/test/java/org/eclipse/hono/service/management/device/AutoProvisioningEnabledDeviceBackendTest.java", "diffHunk": "@@ -80,11 +80,9 @@ public void testProvisionDeviceSucceeds(final VertxTestContext ctx) {\n         final AutoProvisioningEnabledDeviceBackend underTest = mock(AutoProvisioningEnabledDeviceBackend.class);\n         when(underTest.provisionDevice(anyString(), any(), any())).thenCallRealMethod();\n \n-        doAnswer(invocation -> {\n-            final Promise<OperationResult<Id>> promise = invocation.getArgument(4);\n-            promise.complete(OperationResult.ok(201, Id.of(DEVICE_ID), Optional.empty(), Optional.empty()));\n-            return null;\n-        }).when(underTest).createDevice(any(), any(), any(), any(), any(Handler.class));\n+        doAnswer(invocation -> Future\n+                .succeededFuture(OperationResult.ok(201, Id.of(DEVICE_ID), Optional.empty(), Optional.empty()))\n+        ).when(underTest).createDevice(any(), any(), any(), any());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzExMzEzMA=="}, "originalCommit": {"oid": "75aaa49f8f58b85e5df8617aed7531e104507d70"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTIyMTY0OnYy", "diffSide": "RIGHT", "path": "service-base/src/main/java/org/eclipse/hono/service/management/device/DeviceManagementService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTowMzoxOVrOFyPQ-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTozMTo1M1rOFyQGmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIyMzIyNg==", "bodyText": "I guess this was added by mistake.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r388223226", "createdAt": "2020-03-05T11:03:19Z", "author": {"login": "calohmn"}, "path": "service-base/src/main/java/org/eclipse/hono/service/management/device/DeviceManagementService.java", "diffHunk": "@@ -113,7 +110,7 @@ void updateDevice(String tenantId, String deviceId, Device device, Optional<Stri\n      * @throws NullPointerException if any of the parameters is {@code null}.\n      * @see <a href=\"https://www.eclipse.org/hono/docs/api/management/#/devices/deleteRegistration\">\n      *      Device Registry Management API - Delete Device Registration</a>\n+     * @return", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a182aef81bba9ab9e047eb1db3b973cd70bca13"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIzNjk1Mw==", "bodyText": "I have removed it now.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r388236953", "createdAt": "2020-03-05T11:31:53Z", "author": {"login": "kaniyan"}, "path": "service-base/src/main/java/org/eclipse/hono/service/management/device/DeviceManagementService.java", "diffHunk": "@@ -113,7 +110,7 @@ void updateDevice(String tenantId, String deviceId, Device device, Optional<Stri\n      * @throws NullPointerException if any of the parameters is {@code null}.\n      * @see <a href=\"https://www.eclipse.org/hono/docs/api/management/#/devices/deleteRegistration\">\n      *      Device Registry Management API - Delete Device Registration</a>\n+     * @return", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIyMzIyNg=="}, "originalCommit": {"oid": "7a182aef81bba9ab9e047eb1db3b973cd70bca13"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTIzNTQ2OnYy", "diffSide": "RIGHT", "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTowNzoyN1rOFyPZKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMjozOTo0NlrOFyR-WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIyNTMyMQ==", "bodyText": "Indentation in this method seems non-standard.\nSomething which was there in the code before already: Since resourceVersion can be null, Optional.ofNullable(resourceVersion) should be used, I guess.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r388225321", "createdAt": "2020-03-05T11:07:27Z", "author": {"login": "calohmn"}, "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "diffHunk": "@@ -655,27 +592,23 @@ public void testUpdateSucceedWithMissingResourceVersion(final VertxTestContext c\n     @Test\n     public void testUpdateSucceedWithCorrectResourceVersion(final VertxTestContext ctx) {\n \n-        final Promise<OperationResult<Id>> result = Promise.promise();\n         final Checkpoint register = ctx.checkpoint(2);\n         final JsonObject version = new JsonObject();\n \n-        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE, result);\n-        result.future()\n-        .map(response -> {\n-            assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n-            register.flag();\n-            return response;\n-        }).compose(rr -> {\n-            final Promise<OperationResult<Id>> update = Promise.promise();\n+        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE)\n+                .map(response -> {\n+                    assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n+                    register.flag();\n+                    return response;\n+                }).compose(rr -> {\n             final String resourceVersion = rr.getResourceVersion().orElse(null);\n             version.put(\"1\", resourceVersion);\n \n-            getDeviceManagementService().updateDevice(\n-                    TENANT, DEVICE,\n-                    new JsonObject().put(\"ext\", new JsonObject().put(\"customKey\", \"customValue\")).mapTo(Device.class),\n-                    Optional.of(resourceVersion), NoopSpan.INSTANCE,\n-                    update);\n-            return update.future();\n+            return getDeviceManagementService()\n+                    .updateDevice(TENANT, DEVICE,\n+                            new JsonObject().put(\"ext\", new JsonObject().put(\"customKey\", \"customValue\"))\n+                                    .mapTo(Device.class),\n+                            Optional.of(resourceVersion), NoopSpan.INSTANCE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a182aef81bba9ab9e047eb1db3b973cd70bca13"}, "originalPosition": 408}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI2MjIyNQ==", "bodyText": "Something which was there in the code before already: Since resourceVersion can be null, Optional.ofNullable(resourceVersion) should be used, I guess.\n\nThis has been already there and not added in this refactoring. Also in some places, I have seen scope for some optimisations and I don't want address this as part of this PR as this focuses mainly on refactoring the code to return future. IMHO a separate PR would be good. Also in the above test, Optional.of(resourceVersion) is used to create an instance of Optional and for me it seems ok and I didn't get it why it should be Optional.ofNullable(...)", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r388262225", "createdAt": "2020-03-05T12:28:15Z", "author": {"login": "kaniyan"}, "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "diffHunk": "@@ -655,27 +592,23 @@ public void testUpdateSucceedWithMissingResourceVersion(final VertxTestContext c\n     @Test\n     public void testUpdateSucceedWithCorrectResourceVersion(final VertxTestContext ctx) {\n \n-        final Promise<OperationResult<Id>> result = Promise.promise();\n         final Checkpoint register = ctx.checkpoint(2);\n         final JsonObject version = new JsonObject();\n \n-        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE, result);\n-        result.future()\n-        .map(response -> {\n-            assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n-            register.flag();\n-            return response;\n-        }).compose(rr -> {\n-            final Promise<OperationResult<Id>> update = Promise.promise();\n+        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE)\n+                .map(response -> {\n+                    assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n+                    register.flag();\n+                    return response;\n+                }).compose(rr -> {\n             final String resourceVersion = rr.getResourceVersion().orElse(null);\n             version.put(\"1\", resourceVersion);\n \n-            getDeviceManagementService().updateDevice(\n-                    TENANT, DEVICE,\n-                    new JsonObject().put(\"ext\", new JsonObject().put(\"customKey\", \"customValue\")).mapTo(Device.class),\n-                    Optional.of(resourceVersion), NoopSpan.INSTANCE,\n-                    update);\n-            return update.future();\n+            return getDeviceManagementService()\n+                    .updateDevice(TENANT, DEVICE,\n+                            new JsonObject().put(\"ext\", new JsonObject().put(\"customKey\", \"customValue\"))\n+                                    .mapTo(Device.class),\n+                            Optional.of(resourceVersion), NoopSpan.INSTANCE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIyNTMyMQ=="}, "originalCommit": {"oid": "7a182aef81bba9ab9e047eb1db3b973cd70bca13"}, "originalPosition": 408}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI2NzYwOA==", "bodyText": "Also in the above test, Optional.of(resourceVersion) is used to create an instance of Optional and for me it seems ok and I didn't get it why it should be Optional.ofNullable(...)\n\nFor resourceVersion==null, Optional.of(resourceVersion) will produce a NPE. But that change could also be put in another PR.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r388267608", "createdAt": "2020-03-05T12:39:46Z", "author": {"login": "calohmn"}, "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "diffHunk": "@@ -655,27 +592,23 @@ public void testUpdateSucceedWithMissingResourceVersion(final VertxTestContext c\n     @Test\n     public void testUpdateSucceedWithCorrectResourceVersion(final VertxTestContext ctx) {\n \n-        final Promise<OperationResult<Id>> result = Promise.promise();\n         final Checkpoint register = ctx.checkpoint(2);\n         final JsonObject version = new JsonObject();\n \n-        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE, result);\n-        result.future()\n-        .map(response -> {\n-            assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n-            register.flag();\n-            return response;\n-        }).compose(rr -> {\n-            final Promise<OperationResult<Id>> update = Promise.promise();\n+        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE)\n+                .map(response -> {\n+                    assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n+                    register.flag();\n+                    return response;\n+                }).compose(rr -> {\n             final String resourceVersion = rr.getResourceVersion().orElse(null);\n             version.put(\"1\", resourceVersion);\n \n-            getDeviceManagementService().updateDevice(\n-                    TENANT, DEVICE,\n-                    new JsonObject().put(\"ext\", new JsonObject().put(\"customKey\", \"customValue\")).mapTo(Device.class),\n-                    Optional.of(resourceVersion), NoopSpan.INSTANCE,\n-                    update);\n-            return update.future();\n+            return getDeviceManagementService()\n+                    .updateDevice(TENANT, DEVICE,\n+                            new JsonObject().put(\"ext\", new JsonObject().put(\"customKey\", \"customValue\"))\n+                                    .mapTo(Device.class),\n+                            Optional.of(resourceVersion), NoopSpan.INSTANCE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIyNTMyMQ=="}, "originalCommit": {"oid": "7a182aef81bba9ab9e047eb1db3b973cd70bca13"}, "originalPosition": 408}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTIzNzA4OnYy", "diffSide": "RIGHT", "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTowODowMFrOFyPaNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTowODowMFrOFyPaNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIyNTU5MA==", "bodyText": "Indentation in this method seems non-standard.\nSomething which was there in the code before already: Since resourceVersion can be null, Optional.ofNullable(resourceVersion) should be used, I guess.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r388225590", "createdAt": "2020-03-05T11:08:00Z", "author": {"login": "calohmn"}, "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "diffHunk": "@@ -724,22 +650,17 @@ public void testDeleteSucceedWithMissingResourceVersion(final VertxTestContext c\n     @Test\n     public void testDeleteSucceedWithCorrectResourceVersion(final VertxTestContext ctx) {\n \n-        final Promise<OperationResult<Id>> result = Promise.promise();\n         final Checkpoint register = ctx.checkpoint(2);\n \n-        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE, result);\n-        result.future()\n-        .map(response -> {\n-            assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n-            register.flag();\n-            return response;\n-        }).compose(rr -> {\n-            final Promise<Result<Void>> update = Promise.promise();\n+        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE)\n+                .map(response -> {\n+                    assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n+                    register.flag();\n+                    return response;\n+                }).compose(rr -> {\n             final String resourceVersion = rr.getResourceVersion().orElse(null);\n-\n-            getDeviceManagementService().deleteDevice(\n-                    TENANT, DEVICE, Optional.of(resourceVersion), NoopSpan.INSTANCE, update);\n-            return update.future();\n+            return getDeviceManagementService()\n+                    .deleteDevice(TENANT, DEVICE, Optional.of(resourceVersion), NoopSpan.INSTANCE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a182aef81bba9ab9e047eb1db3b973cd70bca13"}, "originalPosition": 471}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTI3MDE1OnYy", "diffSide": "RIGHT", "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMToxODo1M1rOFyPujQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMToxODo1M1rOFyPujQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIzMDc5Nw==", "bodyText": "Indentation in this method seems non-standard.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r388230797", "createdAt": "2020-03-05T11:18:53Z", "author": {"login": "calohmn"}, "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "diffHunk": "@@ -513,23 +474,18 @@ public void testGetReturnsCopyOfOriginalData(final VertxTestContext ctx) {\n     @Test\n     public void testGetFailsForDeregisteredDevice(final VertxTestContext ctx) {\n \n-        final Promise<OperationResult<Id>> result = Promise.promise();\n         final Checkpoint get = ctx.checkpoint(3);\n \n-        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE, result);\n-        result.future()\n-        .compose(response -> {\n-            assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n-            get.flag();\n-            final Promise<Result<Void>> deregisterResult = Promise.promise();\n-            getDeviceManagementService().deleteDevice(TENANT, DEVICE, Optional.empty(), NoopSpan.INSTANCE, deregisterResult);\n-            return deregisterResult.future();\n-        }).compose(response -> {\n+        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE)\n+                .compose(response -> {\n+                    assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n+                    get.flag();\n+                    return getDeviceManagementService()\n+                            .deleteDevice(TENANT, DEVICE, Optional.empty(), NoopSpan.INSTANCE);\n+                }).compose(response -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a182aef81bba9ab9e047eb1db3b973cd70bca13"}, "originalPosition": 242}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTI3MTYyOnYy", "diffSide": "RIGHT", "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMToxOToyNFrOFyPvcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMToxOToyNFrOFyPvcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIzMTAyNg==", "bodyText": "Indentation in this method seems non-standard.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r388231026", "createdAt": "2020-03-05T11:19:24Z", "author": {"login": "calohmn"}, "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "diffHunk": "@@ -588,25 +538,20 @@ public void testAddSucceedAndContainsResourceVersion(final VertxTestContext ctx)\n     @Test\n     public void testUpdateFailsWithInvalidResourceVersion(final VertxTestContext ctx) {\n \n-        final Promise<OperationResult<Id>> result = Promise.promise();\n         final Checkpoint register = ctx.checkpoint(2);\n \n-        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE, result);\n-        result.future()\n-        .map(response -> {\n-            assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n-            register.flag();\n-            return response;\n-        }).compose(rr -> {\n-            final Promise<OperationResult<Id>> update = Promise.promise();\n+        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE)\n+                .map(response -> {\n+                    assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n+                    register.flag();\n+                    return response;\n+                }).compose(rr -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a182aef81bba9ab9e047eb1db3b973cd70bca13"}, "originalPosition": 324}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTI3NjQzOnYy", "diffSide": "RIGHT", "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMToyMTowM1rOFyPyZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMToyMTowM1rOFyPyZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIzMTc4Mw==", "bodyText": "Indentation in this method seems non-standard.", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r388231783", "createdAt": "2020-03-05T11:21:03Z", "author": {"login": "calohmn"}, "path": "service-base/src/test/java/org/eclipse/hono/service/registration/AbstractRegistrationServiceTest.java", "diffHunk": "@@ -755,22 +676,17 @@ public void testDeleteSucceedWithCorrectResourceVersion(final VertxTestContext c\n     @Test\n     public void testDeleteFailsWithInvalidResourceVersion(final VertxTestContext ctx) {\n \n-        final Promise<OperationResult<Id>> result = Promise.promise();\n         final Checkpoint register = ctx.checkpoint(2);\n \n-        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE, result);\n-        result.future()\n-        .map(response -> {\n-            assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n-            register.flag();\n-            return response;\n-        }).compose(rr -> {\n-            final Promise<Result<Void>> update = Promise.promise();\n+        getDeviceManagementService().createDevice(TENANT, Optional.of(DEVICE), new Device(), NoopSpan.INSTANCE)\n+                .map(response -> {\n+                    assertEquals(HttpURLConnection.HTTP_CREATED, response.getStatus());\n+                    register.flag();\n+                    return response;\n+                }).compose(rr -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a182aef81bba9ab9e047eb1db3b973cd70bca13"}, "originalPosition": 495}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNTI4NTk4OnYy", "diffSide": "RIGHT", "path": "service-base/src/test/java/org/eclipse/hono/service/management/device/AutoProvisioningEnabledDeviceBackendTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMToyNDowNlrOFyP4HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzoxODo0OFrOFyTIfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIzMzI0NQ==", "bodyText": "Can be simplified (when(underTest.deleteDevice)...).", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r388233245", "createdAt": "2020-03-05T11:24:06Z", "author": {"login": "calohmn"}, "path": "service-base/src/test/java/org/eclipse/hono/service/management/device/AutoProvisioningEnabledDeviceBackendTest.java", "diffHunk": "@@ -119,17 +117,12 @@ public void testProvisionDeviceRemovesDeviceIfCredentialsCreationFails(final Ver\n         final AutoProvisioningEnabledDeviceBackend underTest = mock(AutoProvisioningEnabledDeviceBackend.class);\n         when(underTest.provisionDevice(anyString(), any(), any())).thenCallRealMethod();\n \n-        doAnswer(invocation -> {\n-            final Promise<OperationResult<Id>> promise = invocation.getArgument(4);\n-            promise.complete(OperationResult.ok(201, Id.of(DEVICE_ID), Optional.empty(), Optional.empty()));\n-            return null;\n-        }).when(underTest).createDevice(any(), any(), any(), any(), any(Handler.class));\n+        when(underTest.createDevice(any(), any(), any(), any()))\n+                .thenReturn(Future.succeededFuture(\n+                        OperationResult.ok(201, Id.of(DEVICE_ID), Optional.empty(), Optional.empty())));\n \n-        doAnswer(invocation -> {\n-            final Promise<Result<Void>> promise = invocation.getArgument(4);\n-            promise.complete(Result.from(204));\n-            return null;\n-        }).when(underTest).deleteDevice(any(), any(), any(), any(), any(Handler.class));\n+        doAnswer(invocation -> Future.succeededFuture(Result.from(204)))\n+                .when(underTest).deleteDevice(any(), any(), any(), any());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a182aef81bba9ab9e047eb1db3b973cd70bca13"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI4NjU4OQ==", "bodyText": "@calohmn I have updated it. Also made changes regarding indentation as in the above comments. Would you mind taking a look again?", "url": "https://github.com/eclipse/hono/pull/1803#discussion_r388286589", "createdAt": "2020-03-05T13:18:48Z", "author": {"login": "kaniyan"}, "path": "service-base/src/test/java/org/eclipse/hono/service/management/device/AutoProvisioningEnabledDeviceBackendTest.java", "diffHunk": "@@ -119,17 +117,12 @@ public void testProvisionDeviceRemovesDeviceIfCredentialsCreationFails(final Ver\n         final AutoProvisioningEnabledDeviceBackend underTest = mock(AutoProvisioningEnabledDeviceBackend.class);\n         when(underTest.provisionDevice(anyString(), any(), any())).thenCallRealMethod();\n \n-        doAnswer(invocation -> {\n-            final Promise<OperationResult<Id>> promise = invocation.getArgument(4);\n-            promise.complete(OperationResult.ok(201, Id.of(DEVICE_ID), Optional.empty(), Optional.empty()));\n-            return null;\n-        }).when(underTest).createDevice(any(), any(), any(), any(), any(Handler.class));\n+        when(underTest.createDevice(any(), any(), any(), any()))\n+                .thenReturn(Future.succeededFuture(\n+                        OperationResult.ok(201, Id.of(DEVICE_ID), Optional.empty(), Optional.empty())));\n \n-        doAnswer(invocation -> {\n-            final Promise<Result<Void>> promise = invocation.getArgument(4);\n-            promise.complete(Result.from(204));\n-            return null;\n-        }).when(underTest).deleteDevice(any(), any(), any(), any(), any(Handler.class));\n+        doAnswer(invocation -> Future.succeededFuture(Result.from(204)))\n+                .when(underTest).deleteDevice(any(), any(), any(), any());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIzMzI0NQ=="}, "originalCommit": {"oid": "7a182aef81bba9ab9e047eb1db3b973cd70bca13"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3233, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}