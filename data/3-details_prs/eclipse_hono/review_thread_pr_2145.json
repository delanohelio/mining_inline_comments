{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MDY5MjI1", "number": 2145, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNDozMDo0OFrOEfOBnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNToyNjozMlrOEfP-Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMTcxMTAwOnYy", "diffSide": "RIGHT", "path": "adapters/coap-vertx-base/src/main/java/org/eclipse/hono/adapter/coap/CoapContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNDozMDo0OFrOHLWlIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNDozMDo0OFrOHLWlIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTY2NjMzOA==", "bodyText": "1st parameter missing or wrong quotes.", "url": "https://github.com/eclipse/hono/pull/2145#discussion_r481666338", "createdAt": "2020-09-02T04:30:48Z", "author": {"login": "calohmn"}, "path": "adapters/coap-vertx-base/src/main/java/org/eclipse/hono/adapter/coap/CoapContext.java", "diffHunk": "@@ -158,24 +159,37 @@ public String getAuthId() {\n     /**\n      * Sets a timer to trigger the sending of a separate ACK to a device.\n      * <p>\n+     * This method first tries to find a {@value CoapConstants#TIMEOUT_TO_ACK} property value\n+     * in the tenant's CoAP adapter configuration.\n+     * If no such property is found, the value given in the timeoutMillis parameter is used instead.\n      *\n-     * @param vertx Vertx to schedule the timer\n+     * @param vertx The vert.x instance to set the timer on.\n+     * @param tenant The tenant that the device belongs to which the request being processed originates from.\n      * @param timeoutMillis The number of milliseconds to wait for a separate ACK. {@code -1}, never use separate\n      *            response, {@code 0}, always use separate response.\n+     * @throws NullPointerException if vertx or tenant are {@code null}.\n      */\n     public void startAcceptTimer(\n             final Vertx vertx,\n+            final TenantObject tenant,\n             final long timeoutMillis) {\n \n+        Objects.requireNonNull(vertx, \"vert.x\");\n+        Objects.requireNonNull(\"tenant\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac880a0506565b6c053329dd46bd1ca0f51329fd"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMTk2ODc4OnYy", "diffSide": "RIGHT", "path": "adapters/coap-vertx-base/src/main/java/org/eclipse/hono/adapter/coap/CoapContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNToxNTozN1rOHLZQ5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNToxNTozN1rOHLZQ5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTcxMDMxMQ==", "bodyText": "Given a JSON string with the \"timeoutToAck\" value set to something <= Integer.MAX_VALUE, this will lead to a ClassCastException because the Map value will be an Integer, not a Long. Using the primitive long type for the cast would work.\nBesides that, I think it would be better to deal with a possible configuration error here, the \"timeoutToAck\" value being defined as a String for example. For the standard TenantObject fields, we deal with that gracefully, catching ClassCastExceptions via JsonHelper.getValue. I think for extension values, we should do the same, so that there can't be any ClassCastException thrown here.", "url": "https://github.com/eclipse/hono/pull/2145#discussion_r481710311", "createdAt": "2020-09-02T05:15:37Z", "author": {"login": "calohmn"}, "path": "adapters/coap-vertx-base/src/main/java/org/eclipse/hono/adapter/coap/CoapContext.java", "diffHunk": "@@ -158,24 +159,37 @@ public String getAuthId() {\n     /**\n      * Sets a timer to trigger the sending of a separate ACK to a device.\n      * <p>\n+     * This method first tries to find a {@value CoapConstants#TIMEOUT_TO_ACK} property value\n+     * in the tenant's CoAP adapter configuration.\n+     * If no such property is found, the value given in the timeoutMillis parameter is used instead.\n      *\n-     * @param vertx Vertx to schedule the timer\n+     * @param vertx The vert.x instance to set the timer on.\n+     * @param tenant The tenant that the device belongs to which the request being processed originates from.\n      * @param timeoutMillis The number of milliseconds to wait for a separate ACK. {@code -1}, never use separate\n      *            response, {@code 0}, always use separate response.\n+     * @throws NullPointerException if vertx or tenant are {@code null}.\n      */\n     public void startAcceptTimer(\n             final Vertx vertx,\n+            final TenantObject tenant,\n             final long timeoutMillis) {\n \n+        Objects.requireNonNull(vertx, \"vert.x\");\n+        Objects.requireNonNull(\"tenant\");\n+\n+        final long ackTimeout = Optional.ofNullable(tenant.getAdapter(Constants.PROTOCOL_ADAPTER_TYPE_COAP))\n+                .map(config -> (Long) config.getExtensions().get(CoapConstants.TIMEOUT_TO_ACK))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac880a0506565b6c053329dd46bd1ca0f51329fd"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjAxMDI3OnYy", "diffSide": "RIGHT", "path": "site/homepage/content/release-notes.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNToyMjo1OFrOHLZsyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNToyMjo1OFrOHLZsyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTcxNzQ1MA==", "bodyText": "\"If\" with uppercase \"i\".", "url": "https://github.com/eclipse/hono/pull/2145#discussion_r481717450", "createdAt": "2020-09-02T05:22:58Z", "author": {"login": "calohmn"}, "path": "site/homepage/content/release-notes.md", "diffHunk": "@@ -15,7 +15,10 @@ title = \"Release Notes\"\n * The LoraWAN protocol adapter has been extended with support for the *Actility Enterprise* provider.\n * The LoraWAN protocol adapter has been extended with support for the *Orbiwise* provider.\n * Added metrics for tracking the RTT between sending an AMQP message to receiving the disposition.\n-\n+* The CoAP adapter now supports configuration of the *timeoutToAck* parameter at the tenant level\n+  in addition to the adapter level. If set, the tenant specific value is used for all devices of the\n+  particular tenant. if not set, the value defined at the adapter level is used.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac880a0506565b6c053329dd46bd1ca0f51329fd"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMjAzMDE0OnYy", "diffSide": "RIGHT", "path": "adapters/coap-vertx-base/src/main/java/org/eclipse/hono/adapter/coap/CoapContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNToyNjozMlrOHLZ6Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNToyNjozMlrOHLZ6Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTcyMDg2Nw==", "bodyText": "\"[...] to wait for a separate ACK, if not configured for the tenant.\"", "url": "https://github.com/eclipse/hono/pull/2145#discussion_r481720867", "createdAt": "2020-09-02T05:26:32Z", "author": {"login": "calohmn"}, "path": "adapters/coap-vertx-base/src/main/java/org/eclipse/hono/adapter/coap/CoapContext.java", "diffHunk": "@@ -158,24 +159,37 @@ public String getAuthId() {\n     /**\n      * Sets a timer to trigger the sending of a separate ACK to a device.\n      * <p>\n+     * This method first tries to find a {@value CoapConstants#TIMEOUT_TO_ACK} property value\n+     * in the tenant's CoAP adapter configuration.\n+     * If no such property is found, the value given in the timeoutMillis parameter is used instead.\n      *\n-     * @param vertx Vertx to schedule the timer\n+     * @param vertx The vert.x instance to set the timer on.\n+     * @param tenant The tenant that the device belongs to which the request being processed originates from.\n      * @param timeoutMillis The number of milliseconds to wait for a separate ACK. {@code -1}, never use separate\n      *            response, {@code 0}, always use separate response.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac880a0506565b6c053329dd46bd1ca0f51329fd"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3012, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}