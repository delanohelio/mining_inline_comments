{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MDY5MjI1", "number": 2145, "title": "[#2125] Support tenant specific configuration of timeoutToAck", "bodyText": "The CoAP adapter now supports the configiuration of the timeoutToAck\nproperty at the tenant level. If not specified, the value set at the\nadapter level is used.", "createdAt": "2020-09-01T13:08:05Z", "url": "https://github.com/eclipse/hono/pull/2145", "merged": true, "mergeCommit": {"oid": "77b3c3aae94f9159fd883a054e948c32f2bccaf8"}, "closed": true, "closedAt": "2020-09-02T11:34:01Z", "author": {"login": "sophokles73"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEnHV7gH2gAyNDc3MDY5MjI1OmFjODgwYTA1MDY1NjViNmMwNTMzMjlkZDQ2YmQxY2EwZjUxMzI5ZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdE2_XUgFqTQ4MDU1ODQ1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ac880a0506565b6c053329dd46bd1ca0f51329fd", "author": {"user": {"login": "sophokles73", "name": "Kai Hudalla"}}, "url": "https://github.com/eclipse/hono/commit/ac880a0506565b6c053329dd46bd1ca0f51329fd", "committedDate": "2020-09-01T13:07:15Z", "message": "[#2125] Support tenant specific configuration of timeoutToAck\n\nThe CoAP adapter now supports the configiuration of the timeoutToAck\nproperty at the tenant level. If not specified, the value set at the\nadapter level is used.\n\nFixes #2125\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNDc1ODgz", "url": "https://github.com/eclipse/hono/pull/2145#pullrequestreview-480475883", "createdAt": "2020-09-02T04:30:48Z", "commit": {"oid": "ac880a0506565b6c053329dd46bd1ca0f51329fd"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNDozMDo0OFrOHLWlIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQwNToyNjozMlrOHLZ6Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTY2NjMzOA==", "bodyText": "1st parameter missing or wrong quotes.", "url": "https://github.com/eclipse/hono/pull/2145#discussion_r481666338", "createdAt": "2020-09-02T04:30:48Z", "author": {"login": "calohmn"}, "path": "adapters/coap-vertx-base/src/main/java/org/eclipse/hono/adapter/coap/CoapContext.java", "diffHunk": "@@ -158,24 +159,37 @@ public String getAuthId() {\n     /**\n      * Sets a timer to trigger the sending of a separate ACK to a device.\n      * <p>\n+     * This method first tries to find a {@value CoapConstants#TIMEOUT_TO_ACK} property value\n+     * in the tenant's CoAP adapter configuration.\n+     * If no such property is found, the value given in the timeoutMillis parameter is used instead.\n      *\n-     * @param vertx Vertx to schedule the timer\n+     * @param vertx The vert.x instance to set the timer on.\n+     * @param tenant The tenant that the device belongs to which the request being processed originates from.\n      * @param timeoutMillis The number of milliseconds to wait for a separate ACK. {@code -1}, never use separate\n      *            response, {@code 0}, always use separate response.\n+     * @throws NullPointerException if vertx or tenant are {@code null}.\n      */\n     public void startAcceptTimer(\n             final Vertx vertx,\n+            final TenantObject tenant,\n             final long timeoutMillis) {\n \n+        Objects.requireNonNull(vertx, \"vert.x\");\n+        Objects.requireNonNull(\"tenant\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac880a0506565b6c053329dd46bd1ca0f51329fd"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTcxMDMxMQ==", "bodyText": "Given a JSON string with the \"timeoutToAck\" value set to something <= Integer.MAX_VALUE, this will lead to a ClassCastException because the Map value will be an Integer, not a Long. Using the primitive long type for the cast would work.\nBesides that, I think it would be better to deal with a possible configuration error here, the \"timeoutToAck\" value being defined as a String for example. For the standard TenantObject fields, we deal with that gracefully, catching ClassCastExceptions via JsonHelper.getValue. I think for extension values, we should do the same, so that there can't be any ClassCastException thrown here.", "url": "https://github.com/eclipse/hono/pull/2145#discussion_r481710311", "createdAt": "2020-09-02T05:15:37Z", "author": {"login": "calohmn"}, "path": "adapters/coap-vertx-base/src/main/java/org/eclipse/hono/adapter/coap/CoapContext.java", "diffHunk": "@@ -158,24 +159,37 @@ public String getAuthId() {\n     /**\n      * Sets a timer to trigger the sending of a separate ACK to a device.\n      * <p>\n+     * This method first tries to find a {@value CoapConstants#TIMEOUT_TO_ACK} property value\n+     * in the tenant's CoAP adapter configuration.\n+     * If no such property is found, the value given in the timeoutMillis parameter is used instead.\n      *\n-     * @param vertx Vertx to schedule the timer\n+     * @param vertx The vert.x instance to set the timer on.\n+     * @param tenant The tenant that the device belongs to which the request being processed originates from.\n      * @param timeoutMillis The number of milliseconds to wait for a separate ACK. {@code -1}, never use separate\n      *            response, {@code 0}, always use separate response.\n+     * @throws NullPointerException if vertx or tenant are {@code null}.\n      */\n     public void startAcceptTimer(\n             final Vertx vertx,\n+            final TenantObject tenant,\n             final long timeoutMillis) {\n \n+        Objects.requireNonNull(vertx, \"vert.x\");\n+        Objects.requireNonNull(\"tenant\");\n+\n+        final long ackTimeout = Optional.ofNullable(tenant.getAdapter(Constants.PROTOCOL_ADAPTER_TYPE_COAP))\n+                .map(config -> (Long) config.getExtensions().get(CoapConstants.TIMEOUT_TO_ACK))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac880a0506565b6c053329dd46bd1ca0f51329fd"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTcxNzQ1MA==", "bodyText": "\"If\" with uppercase \"i\".", "url": "https://github.com/eclipse/hono/pull/2145#discussion_r481717450", "createdAt": "2020-09-02T05:22:58Z", "author": {"login": "calohmn"}, "path": "site/homepage/content/release-notes.md", "diffHunk": "@@ -15,7 +15,10 @@ title = \"Release Notes\"\n * The LoraWAN protocol adapter has been extended with support for the *Actility Enterprise* provider.\n * The LoraWAN protocol adapter has been extended with support for the *Orbiwise* provider.\n * Added metrics for tracking the RTT between sending an AMQP message to receiving the disposition.\n-\n+* The CoAP adapter now supports configuration of the *timeoutToAck* parameter at the tenant level\n+  in addition to the adapter level. If set, the tenant specific value is used for all devices of the\n+  particular tenant. if not set, the value defined at the adapter level is used.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac880a0506565b6c053329dd46bd1ca0f51329fd"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTcyMDg2Nw==", "bodyText": "\"[...] to wait for a separate ACK, if not configured for the tenant.\"", "url": "https://github.com/eclipse/hono/pull/2145#discussion_r481720867", "createdAt": "2020-09-02T05:26:32Z", "author": {"login": "calohmn"}, "path": "adapters/coap-vertx-base/src/main/java/org/eclipse/hono/adapter/coap/CoapContext.java", "diffHunk": "@@ -158,24 +159,37 @@ public String getAuthId() {\n     /**\n      * Sets a timer to trigger the sending of a separate ACK to a device.\n      * <p>\n+     * This method first tries to find a {@value CoapConstants#TIMEOUT_TO_ACK} property value\n+     * in the tenant's CoAP adapter configuration.\n+     * If no such property is found, the value given in the timeoutMillis parameter is used instead.\n      *\n-     * @param vertx Vertx to schedule the timer\n+     * @param vertx The vert.x instance to set the timer on.\n+     * @param tenant The tenant that the device belongs to which the request being processed originates from.\n      * @param timeoutMillis The number of milliseconds to wait for a separate ACK. {@code -1}, never use separate\n      *            response, {@code 0}, always use separate response.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac880a0506565b6c053329dd46bd1ca0f51329fd"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b51e9a5097071cbd9cce6b11f3bc5b22facc35f", "author": {"user": {"login": "sophokles73", "name": "Kai Hudalla"}}, "url": "https://github.com/eclipse/hono/commit/6b51e9a5097071cbd9cce6b11f3bc5b22facc35f", "committedDate": "2020-09-02T06:46:57Z", "message": "Fix parameter value handling, typos\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNTU4NDUx", "url": "https://github.com/eclipse/hono/pull/2145#pullrequestreview-480558451", "createdAt": "2020-09-02T07:37:01Z", "commit": {"oid": "6b51e9a5097071cbd9cce6b11f3bc5b22facc35f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 540, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}