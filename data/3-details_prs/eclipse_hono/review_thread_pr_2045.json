{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3OTE1Nzc3", "number": 2045, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMjo0OTo1NFrOEHjpLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwOTozMzoxMFrOEISqdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzU5NDcxOnYy", "diffSide": "RIGHT", "path": "site/documentation/content/api/Metrics.md", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMjo0OTo1NFrOGm_Ktg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNTo1MDoxN1rOGnGwvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzUzNDAwNg==", "bodyText": "I would rather replace this with a metric for connection attempts in general. We could then use tags to indicate the outcome like succeeded, unauthenticated, rejected (due to resource limitations). In any case, this metric would only make sense as a connection attempt rate, i.e. how many attempts per time-period instead of absolute numbers.", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r443534006", "createdAt": "2020-06-22T12:49:54Z", "author": {"login": "sophokles73"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.rejected.total*  | Counter             | *host*, *component-type*, *component-name*, *tenant*                                         | The number of attempted connections to protocol adapters which were rejected because a configured connection limit was hit. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5fe2c6cb96afdba6490f9dd445606f5fef87974"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU3NDY4NA==", "bodyText": "Since the number of rejected connections is a number which can only increase but never decrease I deemed a Counter to be the appropriate type as the alternatives listed by https://prometheus.io/docs/concepts/metric_types/ didn't really fit.\nIsn't the range function of Prometheus (https://prometheus.io/docs/prometheus/latest/querying/functions/#rate) which converts this to a rate, providing the metric as you want it to be?", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r443574684", "createdAt": "2020-06-22T13:54:16Z", "author": {"login": "fkaltner"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.rejected.total*  | Counter             | *host*, *component-type*, *component-name*, *tenant*                                         | The number of attempted connections to protocol adapters which were rejected because a configured connection limit was hit. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzUzNDAwNg=="}, "originalCommit": {"oid": "e5fe2c6cb96afdba6490f9dd445606f5fef87974"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU3OTM3MA==", "bodyText": "I forgot: i think having this as a more generic metric with a label is a good idea! Is this something you see as part of this issue or should I create a follow-up issue?", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r443579370", "createdAt": "2020-06-22T14:00:50Z", "author": {"login": "fkaltner"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.rejected.total*  | Counter             | *host*, *component-type*, *component-name*, *tenant*                                         | The number of attempted connections to protocol adapters which were rejected because a configured connection limit was hit. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzUzNDAwNg=="}, "originalCommit": {"oid": "e5fe2c6cb96afdba6490f9dd445606f5fef87974"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY1ODQzMQ==", "bodyText": "I reworked the metric using labels, see commit 3d3ce96.\nThis doesn't cover all outcomes like you mentioned above, but it's a start and we can continue to add more labels as needed.\n@sophokles73 WDYT?\n@ctron Would this also cover your comment?", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r443658431", "createdAt": "2020-06-22T15:50:17Z", "author": {"login": "fkaltner"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.rejected.total*  | Counter             | *host*, *component-type*, *component-name*, *tenant*                                         | The number of attempted connections to protocol adapters which were rejected because a configured connection limit was hit. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzUzNDAwNg=="}, "originalCommit": {"oid": "e5fe2c6cb96afdba6490f9dd445606f5fef87974"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NDUwMTgxOnYy", "diffSide": "RIGHT", "path": "site/documentation/content/api/Metrics.md", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNjoyMjowNFrOGnIA6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwODoyMTozOVrOGnehKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY3ODk1NQ==", "bodyText": "FMPOV it should also have a tag status or outcome which indicated whether the attempt succeeded or, if not, why. Possible values of the tag could therefore be succeeded, rejected and unauthorized FMPOV ...", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r443678955", "createdAt": "2020-06-22T16:22:04Z", "author": {"login": "sophokles73"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.attempts.total*  | Counter             | *host*, *component-type*, *component-name*, *tenant*                                         | The number of connection attempts to protocol adapters. Can be distinguished by outcome by evaluating the tag \"outcome\" (and its corresponding \"reason\"). <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d3ce96ebc8a3b227d3b6092aab5e0fde455faef"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk5NTkyMw==", "bodyText": "EDIT: Now I see: I missed there's a separate column in the documentation with tags.\nI'm confused :) Possibly my phrasing is misleading, but it states: \"Can be distinguished by outcome by evaluating the tag \"outcome\" (and its corresponding \"reason\")\".\nSo there's one tag (\"outcome\") indicating the result (succeeded, rejected, etc.) and another one (\"reason\") which can be used for detailing the reason for the outcome (e.g. by the value \"adapter-resource-limit-exceeded\").", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r443995923", "createdAt": "2020-06-23T06:44:37Z", "author": {"login": "fkaltner"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.attempts.total*  | Counter             | *host*, *component-type*, *component-name*, *tenant*                                         | The number of connection attempts to protocol adapters. Can be distinguished by outcome by evaluating the tag \"outcome\" (and its corresponding \"reason\"). <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY3ODk1NQ=="}, "originalCommit": {"oid": "3d3ce96ebc8a3b227d3b6092aab5e0fde455faef"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDAwNzc1NQ==", "bodyText": "Each tag adds another dimension when evaluating meters in the backend (and requires more memory). If there is no compelling reason to use two separate tags for outcome and reason I would suggest to stick with a single tag instead. For a successful outcome (connection established) there will never be a reason anyway, so filtering for successful/unsuccessful outcomes should be easy enough, right?", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444007755", "createdAt": "2020-06-23T07:10:09Z", "author": {"login": "sophokles73"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.attempts.total*  | Counter             | *host*, *component-type*, *component-name*, *tenant*                                         | The number of connection attempts to protocol adapters. Can be distinguished by outcome by evaluating the tag \"outcome\" (and its corresponding \"reason\"). <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY3ODk1NQ=="}, "originalCommit": {"oid": "3d3ce96ebc8a3b227d3b6092aab5e0fde455faef"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA0NzY1OQ==", "bodyText": "Good point. Since the Prometheus doc themselves warns about it\n\nCAUTION: Remember that every unique combination of key-value label pairs represents a new time series, which can dramatically increase the amount of data stored. Do not use labels to store dimensions with high cardinality (many different label values), such as user IDs, email addresses, or other unbounded sets of values.\n\n(https://prometheus.io/docs/practices/naming/)\nI guess it's not worth having two labels for clarity. Changed with 25ce759.", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444047659", "createdAt": "2020-06-23T08:21:39Z", "author": {"login": "fkaltner"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.attempts.total*  | Counter             | *host*, *component-type*, *component-name*, *tenant*                                         | The number of connection attempts to protocol adapters. Can be distinguished by outcome by evaluating the tag \"outcome\" (and its corresponding \"reason\"). <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY3ODk1NQ=="}, "originalCommit": {"oid": "3d3ce96ebc8a3b227d3b6092aab5e0fde455faef"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODE4MzM4OnYy", "diffSide": "RIGHT", "path": "site/documentation/content/api/Metrics.md", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNDoyNzoxNlrOGnr5kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNToxOTo0OFrOGnuVhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI2Njg5Nw==", "bodyText": "can you please replace the quotes around \"outcome\" with asterisks (*outcome*)?\nIt would also be helpful to define the possible values of the outcome tag in the corresponding table above.\nFMPOV we just need accepted, unauthorized, data-volume-exceeded, connection-count-exceeded and connection-duration-exceeded for now ...", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444266897", "createdAt": "2020-06-23T14:27:16Z", "author": {"login": "sophokles73"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.attempts.total*  | Counter             | *host*, *component-type*, *component-name*, *outcome*                              | The number of connection attempts to protocol adapters. The outcome can be observed by looking the tag \"outcome\" which contains the result and the reason. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25ce759732183a9d8e0d414149cf205f0f8c0930"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4NzgyMA==", "bodyText": "Sure, no problem.\nRegarding the possible values: at the moment I only implemented one (see our discussion following your first comment) called \"rejected-adapter-connection-limit-exceeded\". I can rename this if you like but as far as I know there's also the possibility that a connection may be rejected because of a tenant specific connection limit, so I guess it makes sense to make this clear in the name.", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444287820", "createdAt": "2020-06-23T14:53:36Z", "author": {"login": "fkaltner"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.attempts.total*  | Counter             | *host*, *component-type*, *component-name*, *outcome*                              | The number of connection attempts to protocol adapters. The outcome can be observed by looking the tag \"outcome\" which contains the result and the reason. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI2Njg5Nw=="}, "originalCommit": {"oid": "25ce759732183a9d8e0d414149cf205f0f8c0930"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI5OTk2OQ==", "bodyText": "We could start with a single possible failure outcome for the time being. I see your point regarding the different types of limits. So maybe we can start with adapter-connection-limit-exceeded. WDYT?\nIn any case, we should document the possible value(s) in the table ...", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444299969", "createdAt": "2020-06-23T15:10:17Z", "author": {"login": "sophokles73"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.attempts.total*  | Counter             | *host*, *component-type*, *component-name*, *outcome*                              | The number of connection attempts to protocol adapters. The outcome can be observed by looking the tag \"outcome\" which contains the result and the reason. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI2Njg5Nw=="}, "originalCommit": {"oid": "25ce759732183a9d8e0d414149cf205f0f8c0930"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMwNjgyMA==", "bodyText": "Agreed and adapted.", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444306820", "createdAt": "2020-06-23T15:19:48Z", "author": {"login": "fkaltner"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.attempts.total*  | Counter             | *host*, *component-type*, *component-name*, *outcome*                              | The number of connection attempts to protocol adapters. The outcome can be observed by looking the tag \"outcome\" which contains the result and the reason. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI2Njg5Nw=="}, "originalCommit": {"oid": "25ce759732183a9d8e0d414149cf205f0f8c0930"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODYyMTk0OnYy", "diffSide": "RIGHT", "path": "service-base/src/main/java/org/eclipse/hono/service/metric/MicrometerBasedMetrics.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjowNTozOVrOGnwTEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwODo0NzoyNVrOGoI25g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMzODk2Mw==", "bodyText": "this is only capable of recording a rejected connection attempt. What about the successful attempts?", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444338963", "createdAt": "2020-06-23T16:05:39Z", "author": {"login": "sophokles73"}, "path": "service-base/src/main/java/org/eclipse/hono/service/metric/MicrometerBasedMetrics.java", "diffHunk": "@@ -116,6 +126,10 @@ protected MicrometerBasedMetrics(final MeterRegistry registry, final Vertx vertx\n             }\n         });\n         this.unauthenticatedConnections = registry.gauge(METER_CONNECTIONS_UNAUTHENTICATED, new AtomicLong());\n+\n+        this.rejectedConnections = Counter.builder(METER_CONNECTIONS_ATTEMPTS)\n+            .tag(METER_CONNECTION_ATTEMPTS_TAG_KEY_OUTCOME, \"adapter-connection-limit-exceeded\")\n+            .register(registry);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf7366264bbef4eef732b3f2836cb8578b73f69d"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc0MTM1MA==", "bodyText": "Right. Since we do not record successful attempts as of now, I went for the most simple solution.\nBut I took the chance to look at how this was done for the other metrics and adapted the implementation to match the approach of those. It's a bit more lines to read and understand but should be consistent now, see:\ndf1620b", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444741350", "createdAt": "2020-06-24T08:47:25Z", "author": {"login": "fkaltner"}, "path": "service-base/src/main/java/org/eclipse/hono/service/metric/MicrometerBasedMetrics.java", "diffHunk": "@@ -116,6 +126,10 @@ protected MicrometerBasedMetrics(final MeterRegistry registry, final Vertx vertx\n             }\n         });\n         this.unauthenticatedConnections = registry.gauge(METER_CONNECTIONS_UNAUTHENTICATED, new AtomicLong());\n+\n+        this.rejectedConnections = Counter.builder(METER_CONNECTIONS_ATTEMPTS)\n+            .tag(METER_CONNECTION_ATTEMPTS_TAG_KEY_OUTCOME, \"adapter-connection-limit-exceeded\")\n+            .register(registry);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMzODk2Mw=="}, "originalCommit": {"oid": "bf7366264bbef4eef732b3f2836cb8578b73f69d"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MTE4MzEyOnYy", "diffSide": "RIGHT", "path": "site/documentation/content/api/Metrics.md", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwOTowMToyNlrOGoJXxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwOTowODo1NVrOGoJo1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc0OTc2Ng==", "bodyText": "according to the constant definition in MicrometerBasedMetrics, the name is hono.connections.attempts only (which I find preferable).", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444749766", "createdAt": "2020-06-24T09:01:26Z", "author": {"login": "sophokles73"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.attempts.total*  | Counter             | *host*, *component-type*, *component-name*, *outcome*                                        | The number of connection attempts to protocol adapters. The outcome can be observed by looking the tag *outcome* which contains the result and the reason. At the moment there's only one possible value: `adapter-connection-limit-exceeded`<br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df1620b7236d3eab01fae6f4004d791910638ed5"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc1MTM4Mw==", "bodyText": "Well, actually Micrometer adds the \"_total\" suffix to comply with the Prometheus naming conventions (see https://prometheus.io/docs/practices/naming/#metric-names).", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444751383", "createdAt": "2020-06-24T09:04:19Z", "author": {"login": "fkaltner"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.attempts.total*  | Counter             | *host*, *component-type*, *component-name*, *outcome*                                        | The number of connection attempts to protocol adapters. The outcome can be observed by looking the tag *outcome* which contains the result and the reason. At the moment there's only one possible value: `adapter-connection-limit-exceeded`<br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc0OTc2Ng=="}, "originalCommit": {"oid": "df1620b7236d3eab01fae6f4004d791910638ed5"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc1NDEzNA==", "bodyText": "That might be true, but this spec is about the metrics that we report using the Micrometer framework in the Hono components. Prometheus is one of multiple options for a metrics backend where the meter readings are being collected. We have little (that is: no) influence on what these systems do with the data. However, this specification should define the names that we use in our components only. Does that make sense?", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444754134", "createdAt": "2020-06-24T09:08:55Z", "author": {"login": "sophokles73"}, "path": "site/documentation/content/api/Metrics.md", "diffHunk": "@@ -75,6 +75,7 @@ Metrics provided by the protocol adapters are:\n | *hono.connections.authenticated*   | Gauge               | *host*, *component-type*, *component-name*, *tenant*                                         | Current number of connected, authenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.unauthenticated* | Gauge               | *host*, *component-type*, *component-name*                                                   | Current number of connected, unauthenticated devices. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n | *hono.connections.authenticated.duration* | Timer        | *host*, *component-type*, *component-name*, *tenant*                                         | The overall amount of time that authenticated devices have been connected to protocol adapters. <br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |\n+| *hono.connections.attempts.total*  | Counter             | *host*, *component-type*, *component-name*, *outcome*                                        | The number of connection attempts to protocol adapters. The outcome can be observed by looking the tag *outcome* which contains the result and the reason. At the moment there's only one possible value: `adapter-connection-limit-exceeded`<br/> **NB** This metric is only supported by protocol adapters that maintain *connection state* with authenticated devices. In particular, the HTTP adapter does not support this metric. |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc0OTc2Ng=="}, "originalCommit": {"oid": "df1620b7236d3eab01fae6f4004d791910638ed5"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MTI5ODQ0OnYy", "diffSide": "RIGHT", "path": "service-base/src/main/java/org/eclipse/hono/service/metric/MicrometerBasedMetrics.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwOTozMzoxMFrOGoKgCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwOTozMzoxMFrOGoKgCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc2ODI2Ng==", "bodyText": "I believe that this is no longer necessary, is it?", "url": "https://github.com/eclipse/hono/pull/2045#discussion_r444768266", "createdAt": "2020-06-24T09:33:10Z", "author": {"login": "sophokles73"}, "path": "service-base/src/main/java/org/eclipse/hono/service/metric/MicrometerBasedMetrics.java", "diffHunk": "@@ -60,6 +61,14 @@\n      * The name of the meter for unauthenticated connections.\n      */\n     public static final String METER_CONNECTIONS_UNAUTHENTICATED = \"hono.connections.unauthenticated\";\n+    /**\n+     * The name of the meter for connection attempts. The outcome is signaled by the accordingly named tag.\n+     */\n+    public static final String METER_CONNECTIONS_ATTEMPTS = \"hono.connections.attempts\";\n+    /**\n+     * The key for the meter connection attempt tag holding the outcome of the connection attempt.\n+     */\n+    public static final String METER_CONNECTION_ATTEMPTS_TAG_KEY_OUTCOME = \"outcome\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79cd69d1f279c9565db22a0fcaacfaa9b0244abe"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3171, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}