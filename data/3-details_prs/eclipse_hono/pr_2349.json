{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNzMwNzU3", "number": 2349, "title": "Apply default content type in setPayload()", "bodyText": "Based on the discussion in #2340:\nThe \"application/octet-stream\" content type now gets applied as default in the setPayload() methods, provided the payload isn't null. The \"payload not null\" condition is now also used in the other places where the content type gets set.\nThis effectively means:\n\nnon telemetry/event messages (e.g. command response messages), that aren't empty, get the \"application/octet-stream\" content type as default as well\na telemetry/event AMQP message without payload and content type, sent to the AMQP adapter, will now be forwarded without a content type.\na default content type defined in the tenant configuration will now only get applied if the payload isn't null (this probably only applies to telemetry/event AMQP messages without payload sent to the AMQP adapter).\n\nNote the extra handling of \"application/vnd.eclipse-hono-empty-notification\" in setPayload, getting set also for a null payload: This allows for the places where such empty events get sent to keep using a null payload.", "createdAt": "2020-12-07T14:51:38Z", "url": "https://github.com/eclipse/hono/pull/2349", "merged": true, "mergeCommit": {"oid": "e0fda5a939834625296fcbab65557ecd660dad07"}, "closed": true, "closedAt": "2020-12-08T14:16:42Z", "author": {"login": "calohmn"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkGI1FgFqTU0Njg2NzYyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkKb-dgFqTU0NzI0ODU1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2ODY3NjI5", "url": "https://github.com/eclipse/hono/pull/2349#pullrequestreview-546867629", "createdAt": "2020-12-08T08:47:18Z", "commit": {"oid": "63cd8c7339082de9eb8bfd4f0a9ffd6fdd98fa99"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwODo0NzoxOFrOIBN07Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwODo0NzoxOFrOIBN07Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE0NjAyOQ==", "bodyText": "this sounds like the content-type is set despite the fact that the body is null. However, my understanding is that this should happen only if the body is null, right? So, FMPOV this should read\n\n... is set to the \"application/vnd.eclipse-hono-empty-notification\" content-type if the payload is null", "url": "https://github.com/eclipse/hono/pull/2349#discussion_r538146029", "createdAt": "2020-12-08T08:47:18Z", "author": {"login": "sophokles73"}, "path": "core/src/test/java/org/eclipse/hono/util/MessageHelperTest.java", "diffHunk": "@@ -325,6 +341,64 @@ public void testNewMessageUsesGivenTtlValue() {\n         assertThat(message.getTtl()).isEqualTo(timeToLive.toMillis());\n     }\n \n+    /**\n+     * Verifies that the content-type of a newly created event message\n+     * is set to the \"application/vnd.eclipse-hono-empty-notification\" content-type\n+     * even if the payload is {@code null}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63cd8c7339082de9eb8bfd4f0a9ffd6fdd98fa99"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b22e9e632f3a81a52712f2e66b1a1d73bb3d623d", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/b22e9e632f3a81a52712f2e66b1a1d73bb3d623d", "committedDate": "2020-12-08T13:21:12Z", "message": "Apply default content type in setPayload().\n\nThe \"application/octet-stream\" content type now gets\napplied as default in the setPayload() methods, provided\nthe payload isn't null. The \"payload not null\" condition\nis now also used in the other places where the content\ntype gets set.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63cd8c7339082de9eb8bfd4f0a9ffd6fdd98fa99", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/63cd8c7339082de9eb8bfd4f0a9ffd6fdd98fa99", "committedDate": "2020-12-07T14:19:09Z", "message": "Apply default content type in setPayload().\n\nThe \"application/octet-stream\" content type now gets\napplied as default in the setPayload() methods, provided\nthe payload isn't null. The \"payload not null\" condition\nis now also used in the other places where the content\ntype gets set.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}, "afterCommit": {"oid": "b22e9e632f3a81a52712f2e66b1a1d73bb3d623d", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/b22e9e632f3a81a52712f2e66b1a1d73bb3d623d", "committedDate": "2020-12-08T13:21:12Z", "message": "Apply default content type in setPayload().\n\nThe \"application/octet-stream\" content type now gets\napplied as default in the setPayload() methods, provided\nthe payload isn't null. The \"payload not null\" condition\nis now also used in the other places where the content\ntype gets set.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3MjQ4NTUw", "url": "https://github.com/eclipse/hono/pull/2349#pullrequestreview-547248550", "createdAt": "2020-12-08T13:48:07Z", "commit": {"oid": "b22e9e632f3a81a52712f2e66b1a1d73bb3d623d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 476, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}