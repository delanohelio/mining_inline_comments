{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyNzUyNjcy", "number": 1936, "title": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance", "bodyText": "This is for #1858.", "createdAt": "2020-05-04T05:54:23Z", "url": "https://github.com/eclipse/hono/pull/1936", "merged": true, "mergeCommit": {"oid": "478e626f1d4d7f481184a16f85775b88cbdfeff6"}, "closed": true, "closedAt": "2020-05-06T07:52:32Z", "author": {"login": "calohmn"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcd6lZxABqjMyOTg2NjA4NDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceji_BAFqTQwNjM2MTY1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30b2fe21f5eab007a5f510c51dee3309cc2b696c", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/30b2fe21f5eab007a5f510c51dee3309cc2b696c", "committedDate": "2020-05-04T05:52:53Z", "message": "[#1858] Add 'onlyUpdate' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}, "afterCommit": {"oid": "0818b7d7f144c3d606b2275da26bcfee298bd0e1", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/0818b7d7f144c3d606b2275da26bcfee298bd0e1", "committedDate": "2020-05-04T07:45:03Z", "message": "[#1858] Add 'onlyUpdate' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzgxMDg1", "url": "https://github.com/eclipse/hono/pull/1936#pullrequestreview-404781085", "createdAt": "2020-05-04T08:10:05Z", "commit": {"oid": "0818b7d7f144c3d606b2275da26bcfee298bd0e1"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODoxMDowNVrOGP2ZHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODoxNzo1NVrOGP2nwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3Mjk5MQ==", "bodyText": "what if any of the params are null?", "url": "https://github.com/eclipse/hono/pull/1936#discussion_r419272991", "createdAt": "2020-05-04T08:10:05Z", "author": {"login": "sophokles73"}, "path": "client-device-connection-infinispan/src/main/java/org/eclipse/hono/deviceconnection/infinispan/client/Cache.java", "diffHunk": "@@ -61,6 +61,19 @@\n      */\n     Future<V> put(K key, V value, long lifespan, TimeUnit lifespanUnit);\n \n+    /**\n+     * Replaces the entry for a key only if currently mapped to a given value.\n+     *\n+     * @param key The key.\n+     * @param oldValue The value to overwrite.\n+     * @param newValue The value to store.\n+     * @param lifespan The lifespan of the entry. A negative value is interpreted as an unlimited lifespan.\n+     * @param lifespanUnit The time unit for the lifespan.\n+     * @return A succeeded future containing a boolean, indicating whether the value was replaced or not.\n+     *         A failed future if the value could not be stored in the cache.\n+     */\n+    Future<Boolean> replace(K key, V oldValue, V newValue, long lifespan, TimeUnit lifespanUnit);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0818b7d7f144c3d606b2275da26bcfee298bd0e1"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3NTcxNg==", "bodyText": "can we please rename this parameter to update_only?", "url": "https://github.com/eclipse/hono/pull/1936#discussion_r419275716", "createdAt": "2020-05-04T08:15:53Z", "author": {"login": "sophokles73"}, "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -129,6 +129,7 @@ The following table provides an overview of the properties a client needs to set\n | *subject*             | yes       | *properties*             | *string*  | MUST be set to `set-cmd-handling-adapter-instance`. |\n | *adapter_instance_id* | yes       | *application-properties* | *string*  | The identifier of the protocol adapter instance that currently handles commands for the device or gateway identified by the *device_id* property. |\n | *lifespan*            | no        | *application-properties* | *int*     | The lifespan of the mapping entry in seconds. After that period, the mapping entry shall be treated as non-existent by the *Device Registration API* methods. A negative value, as well as an omitted property, is interpreted as an unlimited lifespan. |\n+| *only_update*         | no        | *application-properties* | *boolean* | If set to `true`, the command will only update an existing mapping entry with the given lifespan, provided such an entry with the given device id and adapter instance id exists. If the property is omitted or set to `false`, the mapping entry will be set regardless whether an entry with the given adapter instance id exists or not. |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0818b7d7f144c3d606b2275da26bcfee298bd0e1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3NjczNw==", "bodyText": "FMPOV this should be returned if no entry has been found for the given device ID, regardless of the value of update_only.\nWe should then expicitly list 412 as the value to be returned for update_only = true and a non-matching orig-value. I do not see why the registry implementation should return 404 or 412 in that case, given that we expect the registry to explicitly support this property anyway ...", "url": "https://github.com/eclipse/hono/pull/1936#discussion_r419276737", "createdAt": "2020-05-04T08:17:55Z", "author": {"login": "sophokles73"}, "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -141,9 +142,11 @@ The response message's *status* property may contain the following codes:\n | Code  | Description |\n | :---- | :---------- |\n | *204* | OK, the adapter instance for the device has been updated. |\n-| *400* | Bad Request, the command-handling adapter instance has not been updated due to invalid or missing data in the request. |\n+| *400* | Bad Request, the command-handling adapter instance has not been set or updated due to invalid or missing data in the request. |\n+| *404* | Not Found, entry to be updated was not found. This applies to requests with *only_update* set to `true`. |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0818b7d7f144c3d606b2275da26bcfee298bd0e1"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0818b7d7f144c3d606b2275da26bcfee298bd0e1", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/0818b7d7f144c3d606b2275da26bcfee298bd0e1", "committedDate": "2020-05-04T07:45:03Z", "message": "[#1858] Add 'onlyUpdate' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}, "afterCommit": {"oid": "54a44ceb2dafb88567641894bef3e8467d2ed609", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/54a44ceb2dafb88567641894bef3e8467d2ed609", "committedDate": "2020-05-04T09:56:56Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "54a44ceb2dafb88567641894bef3e8467d2ed609", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/54a44ceb2dafb88567641894bef3e8467d2ed609", "committedDate": "2020-05-04T09:56:56Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}, "afterCommit": {"oid": "7cc4db1ac61e44b610ad96bac3b2e5a87dd3535d", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/7cc4db1ac61e44b610ad96bac3b2e5a87dd3535d", "committedDate": "2020-05-04T11:26:13Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7cc4db1ac61e44b610ad96bac3b2e5a87dd3535d", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/7cc4db1ac61e44b610ad96bac3b2e5a87dd3535d", "committedDate": "2020-05-04T11:26:13Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}, "afterCommit": {"oid": "29c2b7acd8a5fbabb274eedb8e869e1f78061eae", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/29c2b7acd8a5fbabb274eedb8e869e1f78061eae", "committedDate": "2020-05-04T14:45:51Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTY5OTMw", "url": "https://github.com/eclipse/hono/pull/1936#pullrequestreview-405569930", "createdAt": "2020-05-05T08:03:38Z", "commit": {"oid": "29c2b7acd8a5fbabb274eedb8e869e1f78061eae"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODowMzozOVrOGQeiFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODoxODo0MlrOGQfBXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzMDY0Ng==", "bodyText": "how about\n\nPrecondition failed, the adapter instance for the device has not been set or updated. This status is returned if the update_only property is set to true but no matching entry for the given device ID and adapter instance value exists.", "url": "https://github.com/eclipse/hono/pull/1936#discussion_r419930646", "createdAt": "2020-05-05T08:03:39Z", "author": {"login": "sophokles73"}, "path": "site/documentation/content/api/device-connection/index.md", "diffHunk": "@@ -140,8 +141,9 @@ The response message's *status* property may contain the following codes:\n \n | Code  | Description |\n | :---- | :---------- |\n-| *204* | OK, the adapter instance for the device has been updated. |\n-| *400* | Bad Request, the command-handling adapter instance has not been updated due to invalid or missing data in the request. |\n+| *204* | OK, the command-handling adapter instance for the device has been updated. |\n+| *400* | Bad Request, the adapter instance for the device has not been set or updated due to invalid or missing data in the request. |\n+| *412* | Precondition failed, the to be updated adapter instance entry for the device doesn't exist, or its adapter instance value doesn't match. This applies to requests with *update_only* set to `true`. |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29c2b7acd8a5fbabb274eedb8e869e1f78061eae"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzNDc5Mg==", "bodyText": "don't we expect the updateOnly param to be false here?", "url": "https://github.com/eclipse/hono/pull/1936#discussion_r419934792", "createdAt": "2020-05-05T08:11:13Z", "author": {"login": "sophokles73"}, "path": "client/src/test/java/org/eclipse/hono/client/impl/ProtocolAdapterCommandConsumerFactoryImplTest.java", "diffHunk": "@@ -187,7 +187,7 @@ public void testCreateCommandConsumerSucceeds(final VertxTestContext ctx) {\n                 ctx.verify(() -> {\n                     verify(connection).createReceiver(eq(tenantCommandAddress), eq(ProtonQoS.AT_LEAST_ONCE), any(), anyInt(),\n                             eq(false), any());\n-                    verify(devConClient).setCommandHandlingAdapterInstance(eq(deviceId), anyString(), any(), any());\n+                    verify(devConClient).setCommandHandlingAdapterInstance(eq(deviceId), anyString(), any(), anyBoolean(), any());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29c2b7acd8a5fbabb274eedb8e869e1f78061eae"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzNDkyNg==", "bodyText": "don't we expect the updateOnly param to be false here?", "url": "https://github.com/eclipse/hono/pull/1936#discussion_r419934926", "createdAt": "2020-05-05T08:11:28Z", "author": {"login": "sophokles73"}, "path": "client/src/test/java/org/eclipse/hono/client/impl/ProtocolAdapterCommandConsumerFactoryImplTest.java", "diffHunk": "@@ -211,7 +211,7 @@ public void testCreateTimeLimitedCommandConsumerSucceeds(final VertxTestContext\n             ctx.verify(() -> {\n                 verify(connection).createReceiver(eq(tenantCommandAddress), eq(ProtonQoS.AT_LEAST_ONCE), any(), anyInt(),\n                         eq(false), any());\n-                verify(devConClient).setCommandHandlingAdapterInstance(eq(deviceId), anyString(), any(), any());\n+                verify(devConClient).setCommandHandlingAdapterInstance(eq(deviceId), anyString(), any(), anyBoolean(), any());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29c2b7acd8a5fbabb274eedb8e869e1f78061eae"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzNjIzMw==", "bodyText": "how about\nfinal boolean updateOnly = Optional.ofNullable(MessageHelper.getApplicationProperty(request.getApplicationProperties(), MessageHelper.APP_PROPERTY_UPDATE_ONLY, Boolean.class))\n  .orElse(false);", "url": "https://github.com/eclipse/hono/pull/1936#discussion_r419936233", "createdAt": "2020-05-05T08:14:01Z", "author": {"login": "sophokles73"}, "path": "service-base/src/main/java/org/eclipse/hono/service/deviceconnection/DelegatingDeviceConnectionAmqpEndpoint.java", "diffHunk": "@@ -241,6 +241,7 @@ public DelegatingDeviceConnectionAmqpEndpoint(final Vertx vertx, final S service\n         final String deviceId = MessageHelper.getDeviceId(request);\n         final String adapterInstanceId = MessageHelper.getApplicationProperty(request.getApplicationProperties(), MessageHelper.APP_PROPERTY_ADAPTER_INSTANCE_ID, String.class);\n         final Integer lifespanSecondsOrNull = MessageHelper.getApplicationProperty(request.getApplicationProperties(), MessageHelper.APP_PROPERTY_LIFESPAN, Integer.class);\n+        final Boolean updateOnlyOrNull = MessageHelper.getApplicationProperty(request.getApplicationProperties(), MessageHelper.APP_PROPERTY_UPDATE_ONLY, Boolean.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29c2b7acd8a5fbabb274eedb8e869e1f78061eae"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkzODY1Mw==", "bodyText": "I think we need to also remove an expired existing value if the adapter instance doesn't match ...", "url": "https://github.com/eclipse/hono/pull/1936#discussion_r419938653", "createdAt": "2020-05-05T08:18:42Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/deviceconnection/MapBasedDeviceConnectionService.java", "diffHunk": "@@ -128,9 +129,26 @@ public MapBasedDeviceConnectionsConfigProperties getConfig() {\n         final int currentMapSize = adapterInstancesForTenantMap.size();\n         if (currentMapSize < getConfig().getMaxDevicesPerTenant()\n                 || (currentMapSize == getConfig().getMaxDevicesPerTenant() && adapterInstancesForTenantMap.containsKey(deviceId))) {\n-            adapterInstancesForTenantMap.put(deviceId,\n-                    new ExpiringValue<>(createAdapterInstanceIdJson(protocolAdapterInstanceId), getLifespanNanos(lifespan)));\n-            result = DeviceConnectionResult.from(HttpURLConnection.HTTP_NO_CONTENT);\n+            final ExpiringValue<JsonObject> newValue = new ExpiringValue<>(\n+                    createAdapterInstanceIdJson(protocolAdapterInstanceId), getLifespanNanos(lifespan));\n+            if (updateOnly) {\n+                final ExpiringValue<JsonObject> resultingValue = adapterInstancesForTenantMap\n+                        .computeIfPresent(deviceId, (key, oldValue) -> {\n+                            if (protocolAdapterInstanceId.equals(getAdapterInstanceIdFromJson(oldValue.getValue()))) {\n+                                return newValue;\n+                            } else {\n+                                return oldValue;\n+                            }\n+                        });\n+                if (resultingValue != null && protocolAdapterInstanceId.equals(getAdapterInstanceIdFromJson(resultingValue.getValue()))) {\n+                    result = DeviceConnectionResult.from(HttpURLConnection.HTTP_NO_CONTENT);\n+                } else {\n+                    result = DeviceConnectionResult.from(HttpURLConnection.HTTP_PRECON_FAILED);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29c2b7acd8a5fbabb274eedb8e869e1f78061eae"}, "originalPosition": 32}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "29c2b7acd8a5fbabb274eedb8e869e1f78061eae", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/29c2b7acd8a5fbabb274eedb8e869e1f78061eae", "committedDate": "2020-05-04T14:45:51Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}, "afterCommit": {"oid": "31052fb230de6bf05b0f2d457b2070338954ba26", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/31052fb230de6bf05b0f2d457b2070338954ba26", "committedDate": "2020-05-05T12:07:49Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31052fb230de6bf05b0f2d457b2070338954ba26", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/31052fb230de6bf05b0f2d457b2070338954ba26", "committedDate": "2020-05-05T12:07:49Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}, "afterCommit": {"oid": "b5641b3c7c8fd008beda6e9c2ffdb120026437d4", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/b5641b3c7c8fd008beda6e9c2ffdb120026437d4", "committedDate": "2020-05-05T14:21:55Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MzM3MDE3", "url": "https://github.com/eclipse/hono/pull/1936#pullrequestreview-406337017", "createdAt": "2020-05-06T06:41:17Z", "commit": {"oid": "b5641b3c7c8fd008beda6e9c2ffdb120026437d4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNjo0MToxOFrOGRFz1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwNjo0MTozNlrOGRF0TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU3NDE2NA==", "bodyText": "My understanding is that we do not want to change an existing value's lifespan on reading, right? Does currentDuration contain the object's remaining lifetime based on the lifetime determined at creation/update time?", "url": "https://github.com/eclipse/hono/pull/1936#discussion_r420574164", "createdAt": "2020-05-06T06:41:18Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/deviceconnection/MapBasedDeviceConnectionService.java", "diffHunk": "@@ -159,13 +171,13 @@ public long expireAfterCreate(final String key, final ExpiringValue<JsonObject>\n                     @Override\n                     public long expireAfterUpdate(final String key, final ExpiringValue<JsonObject> value,\n                             final long currentTime, final long currentDuration) {\n-                        return Long.MAX_VALUE;\n+                        return value.getLifespanNanos();\n                     }\n \n                     @Override\n                     public long expireAfterRead(final String key, final ExpiringValue<JsonObject> value,\n                             final long currentTime, final long currentDuration) {\n-                        return Long.MAX_VALUE;\n+                        return currentDuration;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5641b3c7c8fd008beda6e9c2ffdb120026437d4"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU3NDI4NQ==", "bodyText": "java.util.function.Predicate ?", "url": "https://github.com/eclipse/hono/pull/1936#discussion_r420574285", "createdAt": "2020-05-06T06:41:36Z", "author": {"login": "sophokles73"}, "path": "services/device-registry-base/src/main/java/org/eclipse/hono/deviceregistry/service/deviceconnection/MapBasedDeviceConnectionService.java", "diffHunk": "@@ -300,6 +312,22 @@ private String getAdapterInstanceIdFromJson(final JsonObject adapterInstanceIdJs\n         return expiringValue != null ? expiringValue.getValue() : null;\n     }\n \n+    /**\n+     * Replaces the entry for a key only if the matching function applied to the current value returns {@code true}.\n+     */\n+    private static <V, K> boolean replaceIfMatching(final ConcurrentMap<K, V> map, final K key, final V newValue,\n+            final Function<? super V, Boolean> matchingFunction) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5641b3c7c8fd008beda6e9c2ffdb120026437d4"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79542f6e090d35f8492e15ec03cfc2c275a8bbe7", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/79542f6e090d35f8492e15ec03cfc2c275a8bbe7", "committedDate": "2020-05-06T06:54:50Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5641b3c7c8fd008beda6e9c2ffdb120026437d4", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/b5641b3c7c8fd008beda6e9c2ffdb120026437d4", "committedDate": "2020-05-05T14:21:55Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}, "afterCommit": {"oid": "79542f6e090d35f8492e15ec03cfc2c275a8bbe7", "author": {"user": {"login": "calohmn", "name": "Carsten Lohmann"}}, "url": "https://github.com/eclipse/hono/commit/79542f6e090d35f8492e15ec03cfc2c275a8bbe7", "committedDate": "2020-05-06T06:54:50Z", "message": "[#1858] Add 'updateOnly' param to setCommandHandlingAdapterInstance.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MzYxNjUy", "url": "https://github.com/eclipse/hono/pull/1936#pullrequestreview-406361652", "createdAt": "2020-05-06T07:28:42Z", "commit": {"oid": "79542f6e090d35f8492e15ec03cfc2c275a8bbe7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 902, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}