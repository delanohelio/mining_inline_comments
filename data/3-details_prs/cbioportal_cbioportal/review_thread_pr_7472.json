{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzODA3NTE2", "number": 7472, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDoyNjoxOFrOD99cMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDozOToyMVrOD99sqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2Mjk2MzY4OnYy", "diffSide": "RIGHT", "path": "core/src/main/scripts/importer/validateData.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDoyNjoxOFrOGXxVGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMzozNTowOFrOGX2N4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3ODY0OA==", "bodyText": "Do we still need to check NA at here? Not sure will gene_panel_list contains NA.", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427578648", "createdAt": "2020-05-19T20:26:18Z", "author": {"login": "dippindots"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -1484,16 +1485,22 @@ def checkLine(self, data):\n         if 'Hugo_Symbol' in self.cols:\n             hugo_symbol = data[self.cols.index('Hugo_Symbol')].strip()\n             # treat the empty string or 'Unknown' as a missing value\n-            if hugo_symbol in ('', 'Unknown'):\n+            if hugo_symbol in ('NA', '', 'Unknown'):\n                 hugo_symbol = None\n         if 'Entrez_Gene_Id' in self.cols:\n             entrez_id = data[self.cols.index('Entrez_Gene_Id')].strip()\n             # treat the empty string or 0 as a missing value\n-            if entrez_id in ('', '0'):\n+            if entrez_id in ('NA', '', '0'):\n                 entrez_id = None\n         # validate hugo and entrez together:\n-        self.checkGeneIdentification(hugo_symbol, entrez_id)\n-\n+        normalized_gene = self.checkGeneIdentification(hugo_symbol, entrez_id)\n+        \n+        # validate the gene to make sure its from the targeted panel\n+        if normalized_gene and self.portal.gene_panel_list and data[sample_id_column_index] in sample_ids_panel_dict:\n+            panel_id = sample_ids_panel_dict[data[sample_id_column_index]]\n+            if panel_id in self.portal.gene_panel_list and panel_id != 'NA':", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY1ODcyMQ==", "bodyText": "Thanks for the review @dippindots. The panel id sometimes is NA. For example see: https://github.com/cBioPortal/cbioportal/blob/master/core/src/test/scripts/test_data/study_es_0/data_gene_panel_matrix.txt", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427658721", "createdAt": "2020-05-19T23:35:08Z", "author": {"login": "rmadupuri"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -1484,16 +1485,22 @@ def checkLine(self, data):\n         if 'Hugo_Symbol' in self.cols:\n             hugo_symbol = data[self.cols.index('Hugo_Symbol')].strip()\n             # treat the empty string or 'Unknown' as a missing value\n-            if hugo_symbol in ('', 'Unknown'):\n+            if hugo_symbol in ('NA', '', 'Unknown'):\n                 hugo_symbol = None\n         if 'Entrez_Gene_Id' in self.cols:\n             entrez_id = data[self.cols.index('Entrez_Gene_Id')].strip()\n             # treat the empty string or 0 as a missing value\n-            if entrez_id in ('', '0'):\n+            if entrez_id in ('NA', '', '0'):\n                 entrez_id = None\n         # validate hugo and entrez together:\n-        self.checkGeneIdentification(hugo_symbol, entrez_id)\n-\n+        normalized_gene = self.checkGeneIdentification(hugo_symbol, entrez_id)\n+        \n+        # validate the gene to make sure its from the targeted panel\n+        if normalized_gene and self.portal.gene_panel_list and data[sample_id_column_index] in sample_ids_panel_dict:\n+            panel_id = sample_ids_panel_dict[data[sample_id_column_index]]\n+            if panel_id in self.portal.gene_panel_list and panel_id != 'NA':", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3ODY0OA=="}, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2Mjk3MTAyOnYy", "diffSide": "RIGHT", "path": "core/src/main/scripts/importer/validateData.py", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDoyODozOFrOGXxZ6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMTozODoxOVrOGX4VpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3OTg4Mg==", "bodyText": "Should we throw a warning or an error when we cannot parse a normalized_gene?", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427579882", "createdAt": "2020-05-19T20:28:38Z", "author": {"login": "dippindots"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -1828,6 +1835,23 @@ def checkValidationColumns(self, data):\n \n         return True\n \n+    def checkOffPanelVariant(self, data, normalized_gene, panel_id, hugo_symbol, entrez_id):\n+        try:\n+            normalized_gene = int(normalized_gene)\n+        except:\n+            pass", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY2NzM2MQ==", "bodyText": "The normalized_gene is either a entrez id or None(when mapping in gene table is not present). If its None a warning is thrown here \n  \n    \n      cbioportal/core/src/main/scripts/importer/validateData.py\n    \n    \n         Line 725\n      in\n      3744576\n    \n    \n    \n    \n\n        \n          \n           def checkGeneIdentification(self, gene_symbol=None, entrez_id=None):", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427667361", "createdAt": "2020-05-20T00:01:45Z", "author": {"login": "rmadupuri"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -1828,6 +1835,23 @@ def checkValidationColumns(self, data):\n \n         return True\n \n+    def checkOffPanelVariant(self, data, normalized_gene, panel_id, hugo_symbol, entrez_id):\n+        try:\n+            normalized_gene = int(normalized_gene)\n+        except:\n+            pass", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3OTg4Mg=="}, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY5MzQ3Nw==", "bodyText": "Thanks!", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427693477", "createdAt": "2020-05-20T01:38:19Z", "author": {"login": "dippindots"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -1828,6 +1835,23 @@ def checkValidationColumns(self, data):\n \n         return True\n \n+    def checkOffPanelVariant(self, data, normalized_gene, panel_id, hugo_symbol, entrez_id):\n+        try:\n+            normalized_gene = int(normalized_gene)\n+        except:\n+            pass", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3OTg4Mg=="}, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MzAwNTE4OnYy", "diffSide": "RIGHT", "path": "core/src/test/scripts/test_data/study_es_0/result_report.html", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDozOTowN1rOGXxvYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMDowNjowN1rOGX20vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4NTM3Ng==", "bodyText": "Same as the next comment, I don't think we expect to see warnings when validate study_es_0. I don't really understand why this warning shows up since I saw those genes in the gene-panels.json.", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427585376", "createdAt": "2020-05-19T20:39:07Z", "author": {"login": "dippindots"}, "path": "core/src/test/scripts/test_data/study_es_0/result_report.html", "diffHunk": "@@ -1259,6 +1259,13 @@ <h4 class=\"panel-title\">data_mutations_extended.maf</h4>\n                 <td>Line will not be loaded due to the variant classification filter. Filtered types: [Silent, Intron, 3&#39;UTR, 3&#39;Flank, 5&#39;UTR, 5&#39;Flank, IGR, RNA]</td>\n                 <td>Silent</td>\n               </tr>\n+              <tr class=\"warning\">\n+                <td><span class=\"glyphicon glyphicon-warning-sign\" aria-hidden=\"true\"></span><span class=\"sr-only\">Warning</span></td>\n+                <td>10, 11, 16, (9 more)</td>\n+                <td>&ndash;</td>\n+                <td>Off panel variant. Gene symbol not known to the targeted panel.</td>\n+                <td>MSH3, MYB, TP53, (4 more)</td>\n+              </tr>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY2ODY3MA==", "bodyText": "Thanks for pointing this. I wasn't sure if the test study should succeed 100% or can succeed with warnings. Added missing genes to the test gene panel and the study passed with no warnings. Reverted the reports.", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427668670", "createdAt": "2020-05-20T00:06:07Z", "author": {"login": "rmadupuri"}, "path": "core/src/test/scripts/test_data/study_es_0/result_report.html", "diffHunk": "@@ -1259,6 +1259,13 @@ <h4 class=\"panel-title\">data_mutations_extended.maf</h4>\n                 <td>Line will not be loaded due to the variant classification filter. Filtered types: [Silent, Intron, 3&#39;UTR, 3&#39;Flank, 5&#39;UTR, 5&#39;Flank, IGR, RNA]</td>\n                 <td>Silent</td>\n               </tr>\n+              <tr class=\"warning\">\n+                <td><span class=\"glyphicon glyphicon-warning-sign\" aria-hidden=\"true\"></span><span class=\"sr-only\">Warning</span></td>\n+                <td>10, 11, 16, (9 more)</td>\n+                <td>&ndash;</td>\n+                <td>Off panel variant. Gene symbol not known to the targeted panel.</td>\n+                <td>MSH3, MYB, TP53, (4 more)</td>\n+              </tr>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4NTM3Ng=="}, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MzAwNTg0OnYy", "diffSide": "RIGHT", "path": "core/src/test/scripts/system_tests_validate_data.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDozOToyMVrOGXxv1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwMDowNjoyOVrOGX21JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4NTQ5NA==", "bodyText": "Are we expecting to see warning when we validate study_es_0? I think study_es_0 should pass the validation without any warnings and errors.", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427585494", "createdAt": "2020-05-19T20:39:21Z", "author": {"login": "dippindots"}, "path": "core/src/test/scripts/system_tests_validate_data.py", "diffHunk": "@@ -93,7 +93,7 @@ def test_exit_status_success(self):\n         # execute main function with arguments provided as if from sys.argv\n         args = validateData.interface(args)\n         exit_status = validateData.main_validate(args)\n-        self.assertEqual(0, exit_status)\n+        self.assertEqual(3, exit_status)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY2ODc3Mw==", "bodyText": "Reverted to 0.", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427668773", "createdAt": "2020-05-20T00:06:29Z", "author": {"login": "rmadupuri"}, "path": "core/src/test/scripts/system_tests_validate_data.py", "diffHunk": "@@ -93,7 +93,7 @@ def test_exit_status_success(self):\n         # execute main function with arguments provided as if from sys.argv\n         args = validateData.interface(args)\n         exit_status = validateData.main_validate(args)\n-        self.assertEqual(0, exit_status)\n+        self.assertEqual(3, exit_status)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4NTQ5NA=="}, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3645, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}