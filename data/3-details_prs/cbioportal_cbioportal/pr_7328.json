{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMTI4OTgz", "number": 7328, "title": "migration survival data", "bodyText": "Fix #7322\nrelated to #7292\nDescribe changes proposed in this pull request:\n\nAdd \"0:\" and \"1:\" before each survival data values\ndo not add the prefix for a value that cannot find a mapping from the vocabulary.", "createdAt": "2020-03-24T17:06:25Z", "url": "https://github.com/cBioPortal/cbioportal/pull/7328", "merged": true, "mergeCommit": {"oid": "47501bbce2f859ed526253f75b6be86a93c011c9"}, "closed": true, "closedAt": "2020-05-14T22:36:59Z", "author": {"login": "dippindots"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRj7F6gBqjMxNzAzMjYyMjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchSnMWgBqjMzMzgwOTMwOTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ef36e7fcec88ece5cf3d918362cf9fff4abff2f", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/4ef36e7fcec88ece5cf3d918362cf9fff4abff2f", "committedDate": "2020-03-24T17:04:04Z", "message": "migration survival data"}, "afterCommit": {"oid": "89b487814197ea91f63e941a0a92b1076f0fae73", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/89b487814197ea91f63e941a0a92b1076f0fae73", "committedDate": "2020-03-26T22:33:39Z", "message": "migration survival data"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89b487814197ea91f63e941a0a92b1076f0fae73", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/89b487814197ea91f63e941a0a92b1076f0fae73", "committedDate": "2020-03-26T22:33:39Z", "message": "migration survival data"}, "afterCommit": {"oid": "24e97e24314b73f924bcc3064abd876fe4c2b770", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/24e97e24314b73f924bcc3064abd876fe4c2b770", "committedDate": "2020-03-27T06:01:32Z", "message": "migration survival data"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "24e97e24314b73f924bcc3064abd876fe4c2b770", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/24e97e24314b73f924bcc3064abd876fe4c2b770", "committedDate": "2020-03-27T06:01:32Z", "message": "migration survival data"}, "afterCommit": {"oid": "b793733ccb8b3c7ab851c51a11001cafde9adb79", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/b793733ccb8b3c7ab851c51a11001cafde9adb79", "committedDate": "2020-04-07T04:29:54Z", "message": "search and replace survival data by pattern (has both _months and _status)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b793733ccb8b3c7ab851c51a11001cafde9adb79", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/b793733ccb8b3c7ab851c51a11001cafde9adb79", "committedDate": "2020-04-07T04:29:54Z", "message": "search and replace survival data by pattern (has both _months and _status)"}, "afterCommit": {"oid": "578a80aa6ff6f48301ad84399cf44d07fb98e8d2", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/578a80aa6ff6f48301ad84399cf44d07fb98e8d2", "committedDate": "2020-04-07T04:33:33Z", "message": "search and replace survival data by pattern (has both _months and _status)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "578a80aa6ff6f48301ad84399cf44d07fb98e8d2", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/578a80aa6ff6f48301ad84399cf44d07fb98e8d2", "committedDate": "2020-04-07T04:33:33Z", "message": "search and replace survival data by pattern (has both _months and _status)"}, "afterCommit": {"oid": "d6863b8dcaf24cfda5a9e4017c0c04e1d721082f", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/d6863b8dcaf24cfda5a9e4017c0c04e1d721082f", "committedDate": "2020-04-07T04:34:38Z", "message": "search and replace survival data by pattern (has both _months and _status)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "20427cad2df2a4e231cf35003bc12661e4ae5217", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/20427cad2df2a4e231cf35003bc12661e4ae5217", "committedDate": "2020-04-07T05:09:23Z", "message": "do not change data type"}, "afterCommit": {"oid": "aeb132d929c8d9289f3e1fc53bfdc62386c831c3", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/aeb132d929c8d9289f3e1fc53bfdc62386c831c3", "committedDate": "2020-04-08T18:46:11Z", "message": "do not change data type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "809329b2ea43a3adafb093961691bb5f35ca2a36", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/809329b2ea43a3adafb093961691bb5f35ca2a36", "committedDate": "2020-04-13T22:31:05Z", "message": "add EXTENDED_METADATA column"}, "afterCommit": {"oid": "765a1ee68d84ae3abb0ad6f5837494b7d08bceef", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/765a1ee68d84ae3abb0ad6f5837494b7d08bceef", "committedDate": "2020-04-24T18:30:59Z", "message": "do not change data type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMDkxMjkz", "url": "https://github.com/cBioPortal/cbioportal/pull/7328#pullrequestreview-402091293", "createdAt": "2020-04-28T18:13:12Z", "commit": {"oid": "765a1ee68d84ae3abb0ad6f5837494b7d08bceef"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxODoxMzoxM1rOGNg07g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMDoyNjoyOVrOGNlkIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgyMjUxMA==", "bodyText": "These mappings correspond with inventory of survival types captured in 7292.  Note when the select statement is run against clinical_attribute_meta on the private database, additional attributes are identified beyond which are captured in the issue (which is restricted to the public database).  We should clarify if/when this gets run on the private database.", "url": "https://github.com/cBioPortal/cbioportal/pull/7328#discussion_r416822510", "createdAt": "2020-04-28T18:13:13Z", "author": {"login": "n1zea144"}, "path": "db-scripts/src/main/resources/migration.sql", "diffHunk": "@@ -849,4 +849,23 @@ CREATE TABLE `resource_study` (\n   PRIMARY KEY (`INTERNAL_ID`, `RESOURCE_ID`, `URL`),\n   FOREIGN KEY (`INTERNAL_ID`) REFERENCES `cancer_study` (`CANCER_STUDY_ID`) ON DELETE CASCADE\n );\n-UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n\\ No newline at end of file\n+UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n+\n+##version: 2.12.5\n+-- survival data migration\n+-- create temporary table to store survival attributes\n+CREATE TEMPORARY TABLE IF NOT EXISTS survival_attributes AS \n+  (SELECT DISTINCT Concat(Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7), \n+                   \"_STATUS\") AS ATTR_ID \n+   FROM   clinical_attribute_meta \n+   WHERE  ATTR_ID LIKE \"%_STATUS\" \n+          AND Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7)IN (SELECT DISTINCT \n+              Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7) AS \n+              SurvivalDataStatusPrefix \n+              FROM   clinical_attribute_meta \n+              WHERE  ATTR_ID LIKE \"%_MONTHS\")); \n+\n+-- mapping to 0/1\n+UPDATE clinical_patient SET ATTR_VALUE = CONCAT(\"1:\",ATTR_ID) WHERE ATTR_ID in (SELECT ATTR_ID FROM survival_attributes) AND ATTR_VALUE in ('DECEASED','Recurred/Progressed','Recurred','Progressed','Yes','yes','1','PROGRESSION','Event','DEAD OF MELANOMA','DEAD WITH TUMOR','Metastatic','Relapse','Localized');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "765a1ee68d84ae3abb0ad6f5837494b7d08bceef"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgyNDY0MQ==", "bodyText": "Only select %_STATUS attributes which have a corresponding %_MONTHS attribute.", "url": "https://github.com/cBioPortal/cbioportal/pull/7328#discussion_r416824641", "createdAt": "2020-04-28T18:16:42Z", "author": {"login": "n1zea144"}, "path": "db-scripts/src/main/resources/migration.sql", "diffHunk": "@@ -849,4 +849,23 @@ CREATE TABLE `resource_study` (\n   PRIMARY KEY (`INTERNAL_ID`, `RESOURCE_ID`, `URL`),\n   FOREIGN KEY (`INTERNAL_ID`) REFERENCES `cancer_study` (`CANCER_STUDY_ID`) ON DELETE CASCADE\n );\n-UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n\\ No newline at end of file\n+UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n+\n+##version: 2.12.5\n+-- survival data migration\n+-- create temporary table to store survival attributes\n+CREATE TEMPORARY TABLE IF NOT EXISTS survival_attributes AS \n+  (SELECT DISTINCT Concat(Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7), \n+                   \"_STATUS\") AS ATTR_ID \n+   FROM   clinical_attribute_meta \n+   WHERE  ATTR_ID LIKE \"%_STATUS\" \n+          AND Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7)IN (SELECT DISTINCT \n+              Substr(ATTR_ID, 1, Char_length(ATTR_ID) - 7) AS \n+              SurvivalDataStatusPrefix \n+              FROM   clinical_attribute_meta \n+              WHERE  ATTR_ID LIKE \"%_MONTHS\")); ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "765a1ee68d84ae3abb0ad6f5837494b7d08bceef"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkwMDEyOQ==", "bodyText": "Given that a temporary table is created, I don't think the \"If not exists\" clause is required, but it doesn't hurt.", "url": "https://github.com/cBioPortal/cbioportal/pull/7328#discussion_r416900129", "createdAt": "2020-04-28T20:26:29Z", "author": {"login": "n1zea144"}, "path": "db-scripts/src/main/resources/migration.sql", "diffHunk": "@@ -849,4 +849,23 @@ CREATE TABLE `resource_study` (\n   PRIMARY KEY (`INTERNAL_ID`, `RESOURCE_ID`, `URL`),\n   FOREIGN KEY (`INTERNAL_ID`) REFERENCES `cancer_study` (`CANCER_STUDY_ID`) ON DELETE CASCADE\n );\n-UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n\\ No newline at end of file\n+UPDATE `info` SET `DB_SCHEMA_VERSION`=\"2.12.4\";\n+\n+##version: 2.12.5\n+-- survival data migration\n+-- create temporary table to store survival attributes\n+CREATE TEMPORARY TABLE IF NOT EXISTS survival_attributes AS ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "765a1ee68d84ae3abb0ad6f5837494b7d08bceef"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "765a1ee68d84ae3abb0ad6f5837494b7d08bceef", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/765a1ee68d84ae3abb0ad6f5837494b7d08bceef", "committedDate": "2020-04-24T18:30:59Z", "message": "do not change data type"}, "afterCommit": {"oid": "f50b6f53d1baba2d9e78c92fef638dba06c649bf", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/f50b6f53d1baba2d9e78c92fef638dba06c649bf", "committedDate": "2020-04-28T20:35:50Z", "message": "migration survival data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMTkyOTg1", "url": "https://github.com/cBioPortal/cbioportal/pull/7328#pullrequestreview-402192985", "createdAt": "2020-04-28T20:38:19Z", "commit": {"oid": "765a1ee68d84ae3abb0ad6f5837494b7d08bceef"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f50b6f53d1baba2d9e78c92fef638dba06c649bf", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/f50b6f53d1baba2d9e78c92fef638dba06c649bf", "committedDate": "2020-04-28T20:35:50Z", "message": "migration survival data"}, "afterCommit": {"oid": "63c7fcb50f8dcd2235caa53068da05c9f8233f14", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/63c7fcb50f8dcd2235caa53068da05c9f8233f14", "committedDate": "2020-05-06T16:28:16Z", "message": "migration survival data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3OTE1MTI1", "url": "https://github.com/cBioPortal/cbioportal/pull/7328#pullrequestreview-407915125", "createdAt": "2020-05-08T00:03:19Z", "commit": {"oid": "63c7fcb50f8dcd2235caa53068da05c9f8233f14"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7dd6726db8701284ac2e069aa35876db4005c5b", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/d7dd6726db8701284ac2e069aa35876db4005c5b", "committedDate": "2020-05-14T19:24:52Z", "message": "migration survival data"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63c7fcb50f8dcd2235caa53068da05c9f8233f14", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/63c7fcb50f8dcd2235caa53068da05c9f8233f14", "committedDate": "2020-05-06T16:28:16Z", "message": "migration survival data"}, "afterCommit": {"oid": "d7dd6726db8701284ac2e069aa35876db4005c5b", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/d7dd6726db8701284ac2e069aa35876db4005c5b", "committedDate": "2020-05-14T19:24:52Z", "message": "migration survival data"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1736, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}