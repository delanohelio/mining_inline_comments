{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4MTQ3NjMx", "number": 7859, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwODozMTowNlrOEf4goQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzo0MDowNFrOEgF7RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxODY3MTY5OnYy", "diffSide": "RIGHT", "path": "service/src/test/java/org/cbioportal/service/impl/UuidDataAccessTokenServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwODozMTowNlrOHMb8bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwODozMTowNlrOHMb8bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgwMjc5Ng==", "bodyText": "Now that the oldest token will automatically be deleted to make room for a new token to be issued, this test case no longer will generate the expected MaxNumberTokensExceededException. The next test has the test for the expected behavior (that the oldest token (OLDEST_TOKEN_UUID) gets deleted from the database. From now on, that will always happen when the user is at their quota limit, so this test can be dropped.", "url": "https://github.com/cBioPortal/cbioportal/pull/7859#discussion_r482802796", "createdAt": "2020-09-03T08:31:06Z", "author": {"login": "sheridancbio"}, "path": "service/src/test/java/org/cbioportal/service/impl/UuidDataAccessTokenServiceImplTest.java", "diffHunk": "@@ -101,7 +100,7 @@\n      */\n     @Test(expected = MaxNumberTokensExceededException.class)\n     public void testNonAutoExpireCreateTokenWhenLimitReached() {\n-        DataAccessToken newDataAccessToken = uuidDataAccessTokenServiceImpl.createDataAccessToken(UuidDataAccessTokenServiceImplTestConfiguration.MOCK_USERNAME_WITH_ONE_TOKEN, false);\n+        DataAccessToken newDataAccessToken = uuidDataAccessTokenServiceImpl.createDataAccessToken(UuidDataAccessTokenServiceImplTestConfiguration.MOCK_USERNAME_WITH_ONE_TOKEN);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5d625259d0093cc9414f3ad404625ca49cf223f"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxODY4MDU5OnYy", "diffSide": "RIGHT", "path": "service/src/test/java/org/cbioportal/service/impl/UuidDataAccessTokenServiceImplTestFiveTokenLimit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwODozMzozMFrOHMcB1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwODozMzozMFrOHMcB1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgwNDE4Mg==", "bodyText": "same as prior comment. This test is no longer needed because MaxNumberTokensExceededException can no longer be generated. The user will always successfully receive a token .. even if it means that a previously issued and still valid token needs to be deleted to accomplish it.", "url": "https://github.com/cBioPortal/cbioportal/pull/7859#discussion_r482804182", "createdAt": "2020-09-03T08:33:30Z", "author": {"login": "sheridancbio"}, "path": "service/src/test/java/org/cbioportal/service/impl/UuidDataAccessTokenServiceImplTestFiveTokenLimit.java", "diffHunk": "@@ -101,7 +100,7 @@\n      */\n     @Test(expected = MaxNumberTokensExceededException.class)\n     public void testNonAutoExpireCreateTokenWhenLimitReached() {\n-        DataAccessToken newDataAccessToken = uuidDataAccessTokenServiceImpl.createDataAccessToken(UuidDataAccessTokenServiceImplTestConfiguration.MOCK_USERNAME_WITH_FIVE_TOKENS, false);\n+        DataAccessToken newDataAccessToken = uuidDataAccessTokenServiceImpl.createDataAccessToken(UuidDataAccessTokenServiceImplTestConfiguration.MOCK_USERNAME_WITH_FIVE_TOKENS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5d625259d0093cc9414f3ad404625ca49cf223f"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxODgxNjk3OnYy", "diffSide": "RIGHT", "path": "web/src/main/java/org/cbioportal/web/DataAccessTokenController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwOTowODowMFrOHMdWJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwOTowODowMFrOHMdWJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyNTc2NQ==", "bodyText": "This function no longer serves any purpose. I suggest we drop this function and replace calls to it with a call to tokenService.createDataAccessToken(userName) instead.", "url": "https://github.com/cBioPortal/cbioportal/pull/7859#discussion_r482825765", "createdAt": "2020-09-03T09:08:00Z", "author": {"login": "sheridancbio"}, "path": "web/src/main/java/org/cbioportal/web/DataAccessTokenController.java", "diffHunk": "@@ -129,13 +125,8 @@ private String getAuthenticatedUser(Authentication authentication) {\n         return username;\n     }\n \n-    private DataAccessToken createDataAccessToken(String userName, Boolean myAllowRevocationOfOtherTokens) {\n-        DataAccessToken token;\n-        if (myAllowRevocationOfOtherTokens != null) {\n-            token = tokenService.createDataAccessToken(userName, myAllowRevocationOfOtherTokens);\n-        }  else {\n-            token = tokenService.createDataAccessToken(userName);\n-        }\n+    private DataAccessToken createDataAccessToken(String userName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5d625259d0093cc9414f3ad404625ca49cf223f"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMDg2NjMwOnYy", "diffSide": "LEFT", "path": "src/main/resources/portal.properties.EXAMPLE", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzozOTowMlrOHMw_ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzozOTowMlrOHMw_ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE0NzY1OA==", "bodyText": "great .. thanks for adding this change", "url": "https://github.com/cBioPortal/cbioportal/pull/7859#discussion_r483147658", "createdAt": "2020-09-03T17:39:02Z", "author": {"login": "sheridancbio"}, "path": "src/main/resources/portal.properties.EXAMPLE", "diffHunk": "@@ -141,7 +141,6 @@ dat.unauth_users=\n dat.method=none\n dat.ttl_seconds=2592000\n dat.uuid.max_number_per_user=1\n-dat.uuid.revoke_other_tokens=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d44d4cc76bec9475f12cf02a1942cdd5399951ff"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMDg2OTgwOnYy", "diffSide": "LEFT", "path": "web/src/main/java/org/cbioportal/web/error/GlobalExceptionHandler.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzo0MDowNFrOHMxBxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzo0MDowNFrOHMxBxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE0ODIzMA==", "bodyText": "nice cleaning this up too", "url": "https://github.com/cBioPortal/cbioportal/pull/7859#discussion_r483148230", "createdAt": "2020-09-03T17:40:04Z", "author": {"login": "sheridancbio"}, "path": "web/src/main/java/org/cbioportal/web/error/GlobalExceptionHandler.java", "diffHunk": "@@ -151,12 +151,6 @@\n         return new ResponseEntity<>(response, HttpStatus.UNAUTHORIZED);\n     }\n \n-    @ExceptionHandler(MaxNumberTokensExceededException.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d44d4cc76bec9475f12cf02a1942cdd5399951ff"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3566, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}