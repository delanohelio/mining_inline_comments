{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwODM4NDY0", "number": 7894, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxOToyNjoyMVrOEp7L8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjo0NDo1NVrOFH2_fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMzk2Nzg2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mskcc/cbio/portal/dao/DaoCnaEvent.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxOToyNjoyMVrOHb5KrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMjowMDoyMVrOHxKMsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAxMDIyMQ==", "bodyText": "has this query been tested on a db with large number of records/large study? Just wondering if there was any changes in performance that needs to be considered for periodic imports.", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r499010221", "createdAt": "2020-10-02T19:26:21Z", "author": {"login": "averyniceday"}, "path": "core/src/main/java/org/mskcc/cbio/portal/dao/DaoCnaEvent.java", "diffHunk": "@@ -147,38 +159,53 @@ private static long addCnaEventDirectly(CnaEvent cnaEvent) throws DaoException {\n         try {\n             con = JdbcUtil.getDbConnection(DaoCnaEvent.class);\n             pstmt = con.prepareStatement\n-\t\t(\"SELECT sample_cna_event.CNA_EVENT_ID, SAMPLE_ID, GENETIC_PROFILE_ID,\"\n-                    + \" ENTREZ_GENE_ID, ALTERATION FROM sample_cna_event, cna_event\"\n-                    + \" WHERE `GENETIC_PROFILE_ID`=?\"\n+\t\t(\"SELECT sample_cna_event.CNA_EVENT_ID,\"\n+                    + \" sample_cna_event.SAMPLE_ID,\"\n+                    + \" sample_cna_event.GENETIC_PROFILE_ID,\"\n+                    + \" ENTREZ_GENE_ID,\"\n+                    + \" ALTERATION,\"\n+                    + \" alteration_driver_annotation.DRIVER_FILTER,\"\n+                    + \" alteration_driver_annotation.DRIVER_FILTER_ANNOTATION,\"\n+                    + \" alteration_driver_annotation.DRIVER_TIERS_FILTER,\"\n+                    + \" alteration_driver_annotation.DRIVER_TIERS_FILTER_ANNOTATION\"\n+                    + \" FROM sample_cna_event\"\n+                    + \" LEFT JOIN alteration_driver_annotation ON\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0e7e1b3c2ebcd7dc230341b252cb2e1e95f6d1"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQ4NTI2Nw==", "bodyText": "No, it has not. Is there a particular way to test this beforehand that you can recommend?", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r501485267", "createdAt": "2020-10-08T06:50:08Z", "author": {"login": "pvannierop"}, "path": "core/src/main/java/org/mskcc/cbio/portal/dao/DaoCnaEvent.java", "diffHunk": "@@ -147,38 +159,53 @@ private static long addCnaEventDirectly(CnaEvent cnaEvent) throws DaoException {\n         try {\n             con = JdbcUtil.getDbConnection(DaoCnaEvent.class);\n             pstmt = con.prepareStatement\n-\t\t(\"SELECT sample_cna_event.CNA_EVENT_ID, SAMPLE_ID, GENETIC_PROFILE_ID,\"\n-                    + \" ENTREZ_GENE_ID, ALTERATION FROM sample_cna_event, cna_event\"\n-                    + \" WHERE `GENETIC_PROFILE_ID`=?\"\n+\t\t(\"SELECT sample_cna_event.CNA_EVENT_ID,\"\n+                    + \" sample_cna_event.SAMPLE_ID,\"\n+                    + \" sample_cna_event.GENETIC_PROFILE_ID,\"\n+                    + \" ENTREZ_GENE_ID,\"\n+                    + \" ALTERATION,\"\n+                    + \" alteration_driver_annotation.DRIVER_FILTER,\"\n+                    + \" alteration_driver_annotation.DRIVER_FILTER_ANNOTATION,\"\n+                    + \" alteration_driver_annotation.DRIVER_TIERS_FILTER,\"\n+                    + \" alteration_driver_annotation.DRIVER_TIERS_FILTER_ANNOTATION\"\n+                    + \" FROM sample_cna_event\"\n+                    + \" LEFT JOIN alteration_driver_annotation ON\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAxMDIyMQ=="}, "originalCommit": {"oid": "bb0e7e1b3c2ebcd7dc230341b252cb2e1e95f6d1"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTMwOTM2MQ==", "bodyText": "btw i did notice this stackoverflow issue re doing a left join with empty rows: https://stackoverflow.com/questions/31207935/mysql-with-left-join-is-slow-with-empty-row. Didn't read carefully to check if this applies here but just sharing for reference. I guess in the public cBioPortal alteration_driver_annotation will be empty at first\nCould also try with e.g. the latest dump of the public portal: http://download.cbioportal.org/mysql-snapshots/mysql-snapshots-toc.html", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r521309361", "createdAt": "2020-11-11T12:00:21Z", "author": {"login": "inodb"}, "path": "core/src/main/java/org/mskcc/cbio/portal/dao/DaoCnaEvent.java", "diffHunk": "@@ -147,38 +159,53 @@ private static long addCnaEventDirectly(CnaEvent cnaEvent) throws DaoException {\n         try {\n             con = JdbcUtil.getDbConnection(DaoCnaEvent.class);\n             pstmt = con.prepareStatement\n-\t\t(\"SELECT sample_cna_event.CNA_EVENT_ID, SAMPLE_ID, GENETIC_PROFILE_ID,\"\n-                    + \" ENTREZ_GENE_ID, ALTERATION FROM sample_cna_event, cna_event\"\n-                    + \" WHERE `GENETIC_PROFILE_ID`=?\"\n+\t\t(\"SELECT sample_cna_event.CNA_EVENT_ID,\"\n+                    + \" sample_cna_event.SAMPLE_ID,\"\n+                    + \" sample_cna_event.GENETIC_PROFILE_ID,\"\n+                    + \" ENTREZ_GENE_ID,\"\n+                    + \" ALTERATION,\"\n+                    + \" alteration_driver_annotation.DRIVER_FILTER,\"\n+                    + \" alteration_driver_annotation.DRIVER_FILTER_ANNOTATION,\"\n+                    + \" alteration_driver_annotation.DRIVER_TIERS_FILTER,\"\n+                    + \" alteration_driver_annotation.DRIVER_TIERS_FILTER_ANNOTATION\"\n+                    + \" FROM sample_cna_event\"\n+                    + \" LEFT JOIN alteration_driver_annotation ON\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAxMDIyMQ=="}, "originalCommit": {"oid": "bb0e7e1b3c2ebcd7dc230341b252cb2e1e95f6d1"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzNzg0NTQ2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/mskcc/cbio/portal/dao/DaoMutation.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjo0MjozOFrOIJer5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjo0MjozOFrOIJer5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjgxMDg1NQ==", "bodyText": "@pvannierop @dippindots this DAO only has to do with import right?  This is not related to reading db, right?", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r546810855", "createdAt": "2020-12-21T16:42:38Z", "author": {"login": "alisman"}, "path": "core/src/main/java/org/mskcc/cbio/portal/dao/DaoMutation.java", "diffHunk": "@@ -1548,7 +1556,7 @@ public static void deleteAllRecords() throws DaoException {\n                 try {\n                     con = JdbcUtil.getDbConnection(DaoMutation.class);\n                     pstmt = con.prepareStatement(\n-                            \"SELECT DISTINCT DRIVER_TIERS_FILTER FROM mutation \"\n+                            \"SELECT DISTINCT DRIVER_TIERS_FILTER FROM alteration_driver_annotation \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzNzg1MzQyOnYy", "diffSide": "RIGHT", "path": "persistence/persistence-mybatis/src/main/resources/org/cbioportal/persistence/mybatis/MutationMapper.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjo0NDo1NVrOIJewlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjo0NDo1NVrOIJewlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjgxMjA1Mw==", "bodyText": "@pvannierop is it possible that we haven't introduced appropriate indexing on this table (alteration_driver_annotation) ?", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r546812053", "createdAt": "2020-12-21T16:44:55Z", "author": {"login": "alisman"}, "path": "persistence/persistence-mybatis/src/main/resources/org/cbioportal/persistence/mybatis/MutationMapper.xml", "diffHunk": "@@ -61,6 +61,10 @@\n         INNER JOIN sample ON mutation.SAMPLE_ID = sample.INTERNAL_ID\n         INNER JOIN patient ON sample.PATIENT_ID = patient.INTERNAL_ID\n         INNER JOIN cancer_study ON patient.CANCER_STUDY_ID = cancer_study.CANCER_STUDY_ID\n+        LEFT JOIN alteration_driver_annotation ON", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3571, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}