{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3OTM5NTE0", "number": 8090, "title": "RFC56: OncoKB import and update scripts", "bodyText": "OncoKB import and update scripts\nNote:\n\nThis PR is part of RFC56\nThis PR covers the Import of OncoKB annotations by ETL facility sub-task in RFC56:\n\nThis PR will add two scripts. The first import and add OncoKB annotations to study files during study loading process. The second will update OncoKB annotations for a study that has already been loaded. Integration tests for both scripts are included.", "createdAt": "2020-11-26T09:19:03Z", "url": "https://github.com/cBioPortal/cbioportal/pull/8090", "merged": true, "mergeCommit": {"oid": "aff9b08c3fa42c128af51a331deedf1cb131e4e6"}, "closed": true, "closedAt": "2021-02-02T17:24:17Z", "author": {"login": "oplantalech"}, "timelineItems": {"totalCount": 118, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABd0hd8KABqjQyNjAxMDczMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd21XNgAFqTU4MzQxODE0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3cd30e4923bab7669f2b0933c9fbdcdd6e81d69", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/d3cd30e4923bab7669f2b0933c9fbdcdd6e81d69", "committedDate": "2021-01-28T09:38:34Z", "message": "change name 2"}, "afterCommit": {"oid": "6a2c818bab0ff5f90489761939c498ed7b912f53", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6a2c818bab0ff5f90489761939c498ed7b912f53", "committedDate": "2021-01-28T09:40:44Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a2c818bab0ff5f90489761939c498ed7b912f53", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6a2c818bab0ff5f90489761939c498ed7b912f53", "committedDate": "2021-01-28T09:40:44Z", "message": "change name 2"}, "afterCommit": {"oid": "59208625cc8ca4ddb54d5f4f6ff83b5344629fee", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/59208625cc8ca4ddb54d5f4f6ff83b5344629fee", "committedDate": "2021-01-28T09:46:03Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59208625cc8ca4ddb54d5f4f6ff83b5344629fee", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/59208625cc8ca4ddb54d5f4f6ff83b5344629fee", "committedDate": "2021-01-28T09:46:03Z", "message": "change name 2"}, "afterCommit": {"oid": "01acb27e2fcec3d11d2a13129019e38a1a909b8f", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/01acb27e2fcec3d11d2a13129019e38a1a909b8f", "committedDate": "2021-01-28T09:52:44Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01acb27e2fcec3d11d2a13129019e38a1a909b8f", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/01acb27e2fcec3d11d2a13129019e38a1a909b8f", "committedDate": "2021-01-28T09:52:44Z", "message": "change name 2"}, "afterCommit": {"oid": "e69d6991453662f4ad4af08b7fb87945287fb8e2", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/e69d6991453662f4ad4af08b7fb87945287fb8e2", "committedDate": "2021-01-28T09:56:07Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e69d6991453662f4ad4af08b7fb87945287fb8e2", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/e69d6991453662f4ad4af08b7fb87945287fb8e2", "committedDate": "2021-01-28T09:56:07Z", "message": "change name 2"}, "afterCommit": {"oid": "ea49d4a3e0d4825eb124fd62a107c44031d2b860", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ea49d4a3e0d4825eb124fd62a107c44031d2b860", "committedDate": "2021-01-28T10:20:27Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea49d4a3e0d4825eb124fd62a107c44031d2b860", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ea49d4a3e0d4825eb124fd62a107c44031d2b860", "committedDate": "2021-01-28T10:20:27Z", "message": "change name 2"}, "afterCommit": {"oid": "f3d1aee529ebd8c9bf9a93359f6c0533a6a159dc", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/f3d1aee529ebd8c9bf9a93359f6c0533a6a159dc", "committedDate": "2021-01-28T10:22:57Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3d1aee529ebd8c9bf9a93359f6c0533a6a159dc", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/f3d1aee529ebd8c9bf9a93359f6c0533a6a159dc", "committedDate": "2021-01-28T10:22:57Z", "message": "change name 2"}, "afterCommit": {"oid": "cf01c24eeab4f43cc83a9fd31eee1a96d576703d", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/cf01c24eeab4f43cc83a9fd31eee1a96d576703d", "committedDate": "2021-01-28T10:29:44Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf01c24eeab4f43cc83a9fd31eee1a96d576703d", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/cf01c24eeab4f43cc83a9fd31eee1a96d576703d", "committedDate": "2021-01-28T10:29:44Z", "message": "change name 2"}, "afterCommit": {"oid": "da129bad4f189752bb1df67dc46e764134f80621", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/da129bad4f189752bb1df67dc46e764134f80621", "committedDate": "2021-01-28T10:38:42Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3aa8f9cb7d9f40398ed5bfd97703af521d31d726", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/3aa8f9cb7d9f40398ed5bfd97703af521d31d726", "committedDate": "2021-01-28T10:51:28Z", "message": "Build cbio conditionally"}, "afterCommit": {"oid": "60ff7be7cf09751ebf49719b54cf87c70206dfe2", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/60ff7be7cf09751ebf49719b54cf87c70206dfe2", "committedDate": "2021-01-28T10:53:20Z", "message": "Build cbio conditionally"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60ff7be7cf09751ebf49719b54cf87c70206dfe2", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/60ff7be7cf09751ebf49719b54cf87c70206dfe2", "committedDate": "2021-01-28T10:53:20Z", "message": "Build cbio conditionally"}, "afterCommit": {"oid": "82238c607b3d1fc72f3c6ae49091433e1305429c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/82238c607b3d1fc72f3c6ae49091433e1305429c", "committedDate": "2021-01-28T10:57:54Z", "message": "Build cbio conditionally"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "82238c607b3d1fc72f3c6ae49091433e1305429c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/82238c607b3d1fc72f3c6ae49091433e1305429c", "committedDate": "2021-01-28T10:57:54Z", "message": "Build cbio conditionally"}, "afterCommit": {"oid": "3d0304d3b603abaec39dc9fac308c2ff9c1a5fd2", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/3d0304d3b603abaec39dc9fac308c2ff9c1a5fd2", "committedDate": "2021-01-28T10:58:41Z", "message": "Build cbio conditionally"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d0304d3b603abaec39dc9fac308c2ff9c1a5fd2", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/3d0304d3b603abaec39dc9fac308c2ff9c1a5fd2", "committedDate": "2021-01-28T10:58:41Z", "message": "Build cbio conditionally"}, "afterCommit": {"oid": "4f171f421c2da30f143b0492161cd86255c5c37b", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/4f171f421c2da30f143b0492161cd86255c5c37b", "committedDate": "2021-01-28T11:04:56Z", "message": "Update condition for building cbioportal"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "050c6a3fea3daebb073df76abc2694b430f6ce8b", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/050c6a3fea3daebb073df76abc2694b430f6ce8b", "committedDate": "2021-01-29T10:16:52Z", "message": "Update mysql check"}, "afterCommit": {"oid": "864e18b84d00735ef47a05280c992989f961cc98", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/864e18b84d00735ef47a05280c992989f961cc98", "committedDate": "2021-01-29T10:31:30Z", "message": "Update mysql check"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "864e18b84d00735ef47a05280c992989f961cc98", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/864e18b84d00735ef47a05280c992989f961cc98", "committedDate": "2021-01-29T10:31:30Z", "message": "Update mysql check"}, "afterCommit": {"oid": "886e06e7a2167bae129f7ea475be1df833e48dab", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/886e06e7a2167bae129f7ea475be1df833e48dab", "committedDate": "2021-01-29T10:46:59Z", "message": "Update mysql check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "293d3d0a5c57d0227865e645797e9455d91279ca", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/293d3d0a5c57d0227865e645797e9455d91279ca", "committedDate": "2021-01-29T11:31:28Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db3abd441eb40a4ccf9715540798afb494c2aae9", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/db3abd441eb40a4ccf9715540798afb494c2aae9", "committedDate": "2021-01-30T07:44:00Z", "message": "Fix invoker plugin goals"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "886e06e7a2167bae129f7ea475be1df833e48dab", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/886e06e7a2167bae129f7ea475be1df833e48dab", "committedDate": "2021-01-29T10:46:59Z", "message": "Update mysql check"}, "afterCommit": {"oid": "db3abd441eb40a4ccf9715540798afb494c2aae9", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/db3abd441eb40a4ccf9715540798afb494c2aae9", "committedDate": "2021-01-30T07:44:00Z", "message": "Fix invoker plugin goals"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzNDE4MTQ1", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#pullrequestreview-583418145", "createdAt": "2021-02-04T13:59:27Z", "commit": {"oid": "db3abd441eb40a4ccf9715540798afb494c2aae9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxMzo1OToyOFrOIf07Fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxMzo1OToyOFrOIf07Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDI0Mzg2Mg==", "bodyText": "not sure exactly where the resulting war gets copied to the docker image?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r570243862", "createdAt": "2021-02-04T13:59:28Z", "author": {"login": "inodb"}, "path": ".github/workflows/integration-test.yml", "diffHunk": "@@ -0,0 +1,76 @@\n+name: Integration tests\n+on: [push, pull_request]\n+jobs:\n+  build:\n+    name: Integration tests\n+    runs-on: ubuntu-latest\n+    env: \n+      PORTAL_SOURCE_DIR: /home/runner/work/cbioportal/cbioportal/cbioportal\n+      PORTAL_COMPOSE_DIR: /home/runner/work/cbioportal/cbioportal/cbioportal-docker-compose\n+      PORTAL_INFO_DIR: /home/runner/work/cbioportal/cbioportal/portalInfo\n+    steps:\n+      - name: 'Checkout cbioportal repo'\n+        uses: actions/checkout@v2\n+        with:\n+          path: ./cbioportal\n+      - name: 'Install python requirements'\n+        working-directory: ./cbioportal\n+        run: |\n+          sudo apt-get install python3-setuptools && \\\n+          pip3 install -U wheel && \\\n+          pip3 install -r ./requirements.txt\n+      - name: 'Set up JDK 11'\n+        uses: actions/setup-java@v1\n+        with:\n+          java-version: 11\n+      - name: 'Cache Maven packages'\n+        uses: actions/cache@v1\n+        with:\n+          path: ~/.m2\n+          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}\n+          restore-keys: ${{ runner.os }}-m2\n+      - name: 'Build cbioportal'\n+        working-directory: ./cbioportal\n+        run: |\n+          mvn -DskipTests clean install", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db3abd441eb40a4ccf9715540798afb494c2aae9"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4770c4f21509364cf0f4ddd0522b7f44eb8f2539", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/4770c4f21509364cf0f4ddd0522b7f44eb8f2539", "committedDate": "2020-11-26T09:02:18Z", "message": "Add automatic import of OncoKB annotations as custom driver annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbb894f6ea85ce198855b969568196a2134fce55", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/cbb894f6ea85ce198855b969568196a2134fce55", "committedDate": "2020-11-26T09:02:18Z", "message": "Implement batch wise retrieval of OncoKB annotations\n\nImplement batch wise retrieval of OncoKB annotations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32527dabdd6bd43a0696d551baed47d3cc92a3dd", "author": {"user": {"login": "oplantalech", "name": "Oleguer Plantalech-Casals"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/32527dabdd6bd43a0696d551baed47d3cc92a3dd", "committedDate": "2020-11-26T09:02:18Z", "message": "Add script to update imported oncokb annotations\n\n* Fix bugs in OncoKB API address\n* Add test for update OncoKB annotations\n* Fix test for import OncoKB annotations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MjA5MzE5", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#pullrequestreview-539209319", "createdAt": "2020-11-26T10:58:18Z", "commit": {"oid": "32527dabdd6bd43a0696d551baed47d3cc92a3dd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMDo1ODoxOFrOH6WV9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMjo1NjozN1rOH6aWCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDk0NTUyNg==", "bodyText": "rename to 'import' to be in-line with 'update'", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r530945526", "createdAt": "2020-11-26T10:58:18Z", "author": {"login": "pvannierop"}, "path": ".travis.yml", "diffHunk": "@@ -14,12 +14,14 @@ env:\n   matrix:\n   - MAVEN_VERSION=3.5.4 TEST=core\n   - MAVEN_VERSION=3.5.4 TEST=python-validator\n+  - MAVEN_VERSION=3.5.4 TEST=python-oncokb-importer", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32527dabdd6bd43a0696d551baed47d3cc92a3dd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAwMzMzNw==", "bodyText": "cd - can be removed here. There is no code following.", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r531003337", "createdAt": "2020-11-26T12:42:11Z", "author": {"login": "pvannierop"}, "path": ".travis.yml", "diffHunk": "@@ -115,10 +127,22 @@ script:\n           sleep 30s\n       done\n       [ -z \"$healthy\" ] && { echo \"Error starting cBioPortal services.\"; exit 1; } || echo \"Successful deploy.\"\n+  fi\n+- |\n+  if [[ \"${TEST}\" == integration-test-load-study ]]\n+  then\n+    # load gene panels and study_es_0\n+    bash ../test/integration/test_load_study.sh\n \n-      # load gene panels and study_es_0\n-      bash ../test/integration/test_load_study.sh\n+    # back to main dir\n+    cd -", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32527dabdd6bd43a0696d551baed47d3cc92a3dd"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAwMzM4Mw==", "bodyText": "cd - can be removed here. There is no code following.", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r531003383", "createdAt": "2020-11-26T12:42:16Z", "author": {"login": "pvannierop"}, "path": ".travis.yml", "diffHunk": "@@ -115,10 +127,22 @@ script:\n           sleep 30s\n       done\n       [ -z \"$healthy\" ] && { echo \"Error starting cBioPortal services.\"; exit 1; } || echo \"Successful deploy.\"\n+  fi\n+- |\n+  if [[ \"${TEST}\" == integration-test-load-study ]]\n+  then\n+    # load gene panels and study_es_0\n+    bash ../test/integration/test_load_study.sh\n \n-      # load gene panels and study_es_0\n-      bash ../test/integration/test_load_study.sh\n+    # back to main dir\n+    cd -\n+  fi\n+- |\n+  if [[ \"${TEST}\" == python-oncokb-update ]]\n+  then\n+    # update oncokb test\n+    bash ../test/integration/test_update_oncokb.sh\n \n-      # back to main dir\n-      cd -\n+    # back to main dir\n+    cd -", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32527dabdd6bd43a0696d551baed47d3cc92a3dd"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAxMTA4MQ==", "bodyText": "Add remark that this depends on the version of oncokb.", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r531011081", "createdAt": "2020-11-26T12:56:37Z", "author": {"login": "pvannierop"}, "path": "test/integration/test_update_oncokb.sh", "diffHunk": "@@ -0,0 +1,23 @@\n+#!/bin/bash\n+\n+# exit when any of these fails\n+set -e\n+\n+run_in_service() {\n+    service=$1\n+    shift\n+    docker-compose -f docker-compose.yml -f ../test/integration/docker-compose-localbuild.yml \\\n+        run --rm \\\n+        \"$service\" bash -c \"$@\"\n+}\n+\n+# load study_es_0 using API validation\n+echo \"Testing update of OncoKB annotations...\"\n+run_in_service cbioportal 'metaImport.py -v -u http://cbioportal:8080 -o -s /cbioportal/core/src/test/scripts/test_data/study_oncokb_update/'\n+\n+# execute updateOncokb script\n+run_in_service cbioportal 'python3 /cbioportal/core/src/main/scripts/importer/updateOncokbAnnotations.py -s study_es_0 -p /cbioportal/portal.properties'\n+\n+# Check that mutation annotations have been updated\n+# 4 annotations should be changed to \"Putative_Driver\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32527dabdd6bd43a0696d551baed47d3cc92a3dd"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40", "author": {"user": {"login": "oplantalech", "name": "Oleguer Plantalech-Casals"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ae885e2226d87b0b340c29e26ce245fd063e5c40", "committedDate": "2020-11-26T13:53:00Z", "message": "Implement changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5Mzc2OTYx", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#pullrequestreview-539376961", "createdAt": "2020-11-26T14:48:30Z", "commit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MjIwNTg4", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#pullrequestreview-545220588", "createdAt": "2020-12-04T19:00:47Z", "commit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxOTowMDo0N1rOH_d9kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxOTowMDo0N1rOH_d9kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMxMzIzMw==", "bodyText": "we've had some issues using Travis recently (it's very slow), would be better to use CircleCI or github actions in the future. Thanks for adding this test tho!", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536313233", "createdAt": "2020-12-04T19:00:47Z", "author": {"login": "inodb"}, "path": ".travis.yml", "diffHunk": "@@ -14,12 +14,14 @@ env:\n   matrix:\n   - MAVEN_VERSION=3.5.4 TEST=core\n   - MAVEN_VERSION=3.5.4 TEST=python-validator\n+  - MAVEN_VERSION=3.5.4 TEST=python-oncokb-import\n+  - MAVEN_VERSION=3.5.4 TEST=python-oncokb-update\n   - MAVEN_VERSION=3.5.4 TEST=sanity-checks\n   - MAVEN_VERSION=3.5.4 TEST=end-to-end\n   - MAVEN_VERSION=3.5.4 TEST=integration-test-load-study\n install:\n - |\n-  if [[ \"${TEST}\" == core || \"${TEST}\" == end-to-end  || \"${TEST}\" == integration-test-load-study ]]\n+  if [[ \"${TEST}\" == core || \"${TEST}\" == end-to-end  || \"${TEST}\" == integration-test-load-study || \"${TEST}\" == python-oncokb-update  ]]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MjQzNjU5", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#pullrequestreview-545243659", "createdAt": "2020-12-04T19:36:19Z", "commit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxOTozNjoxOVrOH_fP_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQyMDo0Nzo0MlrOH_hdoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMzNDMzMw==", "bodyText": "This method has been duplicated twice.", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536334333", "createdAt": "2020-12-04T19:36:19Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    sample_ids = [i for j, i in enumerate(header_elements) if j not in header_indexes.values()]\n+    sample_indexes = {}\n+    for sample_id in sample_ids:\n+        sample_indexes[sample_id] = header_elements.index(sample_id)\n+\n+    features = []\n+    cna_file = open_cna_file(cna_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in cna_file:\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip('\\n').split('\\t')\n+        for sample_id in sample_ids:\n+            feature = {}\n+            feature['sample_id'] = sample_id\n+            feature['alteration'] = int(line_elements[sample_indexes[sample_id]])\n+            # cna value 0 (no CNA) is skipped\n+            if feature['alteration'] == 0:\n+                continue\n+            feature['copyNameAlterationType'] = list(cna_alteration_types.keys())[\n+                list(cna_alteration_types.values()).index(feature['alteration'])]\n+            for column_name, index in header_indexes.items():\n+                value = line_elements[index]\n+                if value != '':\n+                    feature[column_name] = value\n+                elif column_name != 'Entrez_Gene_Id':\n+                    print(Color.RED + \"Empty value encounterd in column '\" + column_name + \"' in row \" + str(\n+                        row_counter) + \". OncoKb annotations cannot be imported. Please fix and rerun.\" + Color.END,\n+                          file=sys.stderr)\n+                    print(\"!\" * 71, file=sys.stderr)\n+                    sys.exit(1)\n+\n+            # resolve gene symbols to Entrez Ids if needed\n+            if 'Entrez_Gene_Id' in feature and feature['Entrez_Gene_Id'] is not None and feature[\n+                'Entrez_Gene_Id'] != '':\n+                entrez_gene_ids = [feature['Entrez_Gene_Id']]\n+            else:\n+                entrez_gene_ids = portal_instance.hugo_entrez_map[feature['Hugo_Symbol']]\n+\n+            if len(entrez_gene_ids) > 1:\n+                logger.error(\"Multiple Entrez gene ids were found for a gene.\" \\\n+                             \"OncoKb annotations will not be imported for this gene.\" \\\n+                             \"Please fix and rerun.\",\n+                             extra={'symbol': feature['Hugo_Symbol']})\n+                feature['Entrez_Gene_Id'] = None\n+            elif len(entrez_gene_ids) == 0:\n+                logger.error(\"Could not find the Entrez gene id for a gene.\" \\\n+                             \"OncoKb annotations will not be imported for this gene.\" \\\n+                             \"Please fix and rerun.\",\n+                             extra={'symbol': feature['Hugo_Symbol']})\n+                feature['Entrez_Gene_Id'] = None\n+            else:\n+                feature['Entrez_Gene_Id'] = str(entrez_gene_ids[0])\n+                feature['id'] = \"_\".join([feature['Entrez_Gene_Id'], feature['copyNameAlterationType']])\n+\n+            features.append(feature)\n+    cna_file.close()\n+    print(\" DONE\")\n+    return features\n+\n+\n+def fetch_oncokb_annotations(features):\n+    \"\"\"Submit CNA events to OncoKB.org and return OncoKB annotations.\"\"\"\n+    id_to_annotation = {}\n+    payload_list = create_request_payload(features)\n+    annotations = libImportOncokb.fetch_oncokb_annotations(payload_list, \"https://public.api.oncokb.org/api/v1/annotate/copyNumberAlterations\")\n+    for annotation in annotations:\n+        id = annotation['query']['id']\n+        id_to_annotation[id] = annotation\n+    return id_to_annotation\n+\n+\n+def create_request_payload(features):\n+    \"\"\"Translate CNA events into JSON for message body.\"\"\"\n+    elements = {}\n+    for feature in features:\n+        elements[feature[\n+            'id']] = '{ \"copyNameAlterationType\":\"%s\", \"gene\":{\"entrezGeneId\":%s}, \"id\":\"%s\", \"tumorType\":null} ' \\\n+                     % (feature['copyNameAlterationType'], feature['Entrez_Gene_Id'], feature['id'])\n+    # normalize for alteration id since same alteration is represented in multiple samples\n+    return list(elements.values())\n+\n+\n+def update_cna_metafile(meta_cna_file_path, pd_file_name):\n+    \"\"\"Add reference to pd annotation file to CNA meta file.\"\"\"\n+    meta_file = open(meta_cna_file_path, \"r\")\n+    lines = meta_file.readlines()\n+    meta_file.close()\n+    meta_file_name = os.path.basename(meta_cna_file_path)\n+    dir = os.path.dirname(meta_cna_file_path)\n+    os.rename(meta_cna_file_path, os.path.join(dir, 'ONCOKB_IMPORT_BACKUP_' + meta_file_name))\n+    if lines[-1] == '\\n':\n+        lines = lines[:-1]\n+    meta_file = open(meta_cna_file_path, \"w\")\n+    for line in lines:\n+        meta_file.write(line)\n+    meta_file.write('pd_annotations_filename: ' + pd_file_name + '\\n')\n+    meta_file.close()\n+\n+\n+def write_annotations_to_file(features, pd_file_name):\n+    \"\"\"Write CNA pd annotations to data file.\"\"\"\n+    new_file = open(pd_file_name, \"w\")\n+    new_file.write(\"SAMPLE_ID\\tEntrez_Gene_Id\\tcbp_driver\\tcbp_driver_annotation\\tcbp_driver_tiers\\tcbp_driver_tiers_annotation\\n\")\n+    for feature in features:\n+        if 'oncogenic' in feature:\n+            line = \"\\t\".join(\n+                [feature['sample_id'], feature['Entrez_Gene_Id'], libImportOncokb.evaluate_driver_passenger(feature['oncogenic']),\n+                feature['oncogenic'], '', '']) + \"\\n\"\n+            new_file.write(line)\n+    new_file.close()\n+\n+\n+def check_required_columns(header_elements):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 252}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMzNDk4Mw==", "bodyText": "Do you want to put this into util method? It's duplicated.", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536334983", "createdAt": "2020-12-04T19:37:28Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    sample_ids = [i for j, i in enumerate(header_elements) if j not in header_indexes.values()]\n+    sample_indexes = {}\n+    for sample_id in sample_ids:\n+        sample_indexes[sample_id] = header_elements.index(sample_id)\n+\n+    features = []\n+    cna_file = open_cna_file(cna_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in cna_file:\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip('\\n').split('\\t')\n+        for sample_id in sample_ids:\n+            feature = {}\n+            feature['sample_id'] = sample_id\n+            feature['alteration'] = int(line_elements[sample_indexes[sample_id]])\n+            # cna value 0 (no CNA) is skipped\n+            if feature['alteration'] == 0:\n+                continue\n+            feature['copyNameAlterationType'] = list(cna_alteration_types.keys())[\n+                list(cna_alteration_types.values()).index(feature['alteration'])]\n+            for column_name, index in header_indexes.items():\n+                value = line_elements[index]\n+                if value != '':\n+                    feature[column_name] = value\n+                elif column_name != 'Entrez_Gene_Id':\n+                    print(Color.RED + \"Empty value encounterd in column '\" + column_name + \"' in row \" + str(\n+                        row_counter) + \". OncoKb annotations cannot be imported. Please fix and rerun.\" + Color.END,\n+                          file=sys.stderr)\n+                    print(\"!\" * 71, file=sys.stderr)\n+                    sys.exit(1)\n+\n+            # resolve gene symbols to Entrez Ids if needed\n+            if 'Entrez_Gene_Id' in feature and feature['Entrez_Gene_Id'] is not None and feature[\n+                'Entrez_Gene_Id'] != '':\n+                entrez_gene_ids = [feature['Entrez_Gene_Id']]\n+            else:\n+                entrez_gene_ids = portal_instance.hugo_entrez_map[feature['Hugo_Symbol']]\n+\n+            if len(entrez_gene_ids) > 1:\n+                logger.error(\"Multiple Entrez gene ids were found for a gene.\" \\\n+                             \"OncoKb annotations will not be imported for this gene.\" \\\n+                             \"Please fix and rerun.\",\n+                             extra={'symbol': feature['Hugo_Symbol']})\n+                feature['Entrez_Gene_Id'] = None\n+            elif len(entrez_gene_ids) == 0:\n+                logger.error(\"Could not find the Entrez gene id for a gene.\" \\\n+                             \"OncoKb annotations will not be imported for this gene.\" \\\n+                             \"Please fix and rerun.\",\n+                             extra={'symbol': feature['Hugo_Symbol']})\n+                feature['Entrez_Gene_Id'] = None\n+            else:\n+                feature['Entrez_Gene_Id'] = str(entrez_gene_ids[0])\n+                feature['id'] = \"_\".join([feature['Entrez_Gene_Id'], feature['copyNameAlterationType']])\n+\n+            features.append(feature)\n+    cna_file.close()\n+    print(\" DONE\")\n+    return features\n+\n+\n+def fetch_oncokb_annotations(features):\n+    \"\"\"Submit CNA events to OncoKB.org and return OncoKB annotations.\"\"\"\n+    id_to_annotation = {}\n+    payload_list = create_request_payload(features)\n+    annotations = libImportOncokb.fetch_oncokb_annotations(payload_list, \"https://public.api.oncokb.org/api/v1/annotate/copyNumberAlterations\")\n+    for annotation in annotations:\n+        id = annotation['query']['id']\n+        id_to_annotation[id] = annotation\n+    return id_to_annotation\n+\n+\n+def create_request_payload(features):\n+    \"\"\"Translate CNA events into JSON for message body.\"\"\"\n+    elements = {}\n+    for feature in features:\n+        elements[feature[\n+            'id']] = '{ \"copyNameAlterationType\":\"%s\", \"gene\":{\"entrezGeneId\":%s}, \"id\":\"%s\", \"tumorType\":null} ' \\\n+                     % (feature['copyNameAlterationType'], feature['Entrez_Gene_Id'], feature['id'])\n+    # normalize for alteration id since same alteration is represented in multiple samples\n+    return list(elements.values())\n+\n+\n+def update_cna_metafile(meta_cna_file_path, pd_file_name):\n+    \"\"\"Add reference to pd annotation file to CNA meta file.\"\"\"\n+    meta_file = open(meta_cna_file_path, \"r\")\n+    lines = meta_file.readlines()\n+    meta_file.close()\n+    meta_file_name = os.path.basename(meta_cna_file_path)\n+    dir = os.path.dirname(meta_cna_file_path)\n+    os.rename(meta_cna_file_path, os.path.join(dir, 'ONCOKB_IMPORT_BACKUP_' + meta_file_name))\n+    if lines[-1] == '\\n':\n+        lines = lines[:-1]\n+    meta_file = open(meta_cna_file_path, \"w\")\n+    for line in lines:\n+        meta_file.write(line)\n+    meta_file.write('pd_annotations_filename: ' + pd_file_name + '\\n')\n+    meta_file.close()\n+\n+\n+def write_annotations_to_file(features, pd_file_name):\n+    \"\"\"Write CNA pd annotations to data file.\"\"\"\n+    new_file = open(pd_file_name, \"w\")\n+    new_file.write(\"SAMPLE_ID\\tEntrez_Gene_Id\\tcbp_driver\\tcbp_driver_annotation\\tcbp_driver_tiers\\tcbp_driver_tiers_annotation\\n\")\n+    for feature in features:\n+        if 'oncogenic' in feature:\n+            line = \"\\t\".join(\n+                [feature['sample_id'], feature['Entrez_Gene_Id'], libImportOncokb.evaluate_driver_passenger(feature['oncogenic']),\n+                feature['oncogenic'], '', '']) + \"\\n\"\n+            new_file.write(line)\n+    new_file.close()\n+\n+\n+def check_required_columns(header_elements):\n+    missing_columns = []\n+    for required_column in required_cna_columns:\n+        if not required_column in header_elements:\n+            missing_columns.append(required_column)\n+    if len(missing_columns) > 0:\n+        raise RuntimeError(\"One or more required columns for OncoKb import are missing from the discrete CNA file. \" \\\n+                           \"Missing column(s): [\" + \", \".join(missing_columns) + \"]\")\n+\n+\n+def interface():\n+    parser = argparse.ArgumentParser(description='cBioPortal OncoKB annotation importer')\n+    parser.add_argument('-u', '--url_server',\n+                        type=str,\n+                        default='http://localhost:8080',\n+                        help='URL to cBioPortal server. You can '\n+                             'set this if your URL is not '\n+                             'http://localhost:8080')\n+    parser.add_argument('-m', '--study_directory', type=str, required=True,\n+                        help='path to study directory.')\n+    parser = parser.parse_args()\n+    return parser\n+\n+\n+if __name__ == '__main__':\n+    try:\n+        parsed_args = interface()\n+        exit_status = main_import(parsed_args)\n+    finally:\n+        logging.shutdown()\n+        del logging._handlerList[:]  # workaround for harmless exceptions on exit\n+    print(('Import of OncoKB annotations for discrete CNA {status}.'.format(\n+        status={0: 'succeeded',\n+                1: 'failed',\n+                2: 'not performed as problems occurred',\n+                3: 'succeeded with warnings'}.get(exit_status, 'unknown'))), file=sys.stderr)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 287}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMzNjU2NQ==", "bodyText": "Are we still doing the license declaration? I thought we had an effort to remove all of them. @n1zea144 @jjgao", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536336565", "createdAt": "2020-12-04T19:40:21Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM0MTQzMA==", "bodyText": "Should it call fetch_and_map_oncokb_annotations?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536341430", "createdAt": "2020-12-04T19:49:20Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    sample_ids = [i for j, i in enumerate(header_elements) if j not in header_indexes.values()]\n+    sample_indexes = {}\n+    for sample_id in sample_ids:\n+        sample_indexes[sample_id] = header_elements.index(sample_id)\n+\n+    features = []\n+    cna_file = open_cna_file(cna_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in cna_file:\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip('\\n').split('\\t')\n+        for sample_id in sample_ids:\n+            feature = {}\n+            feature['sample_id'] = sample_id\n+            feature['alteration'] = int(line_elements[sample_indexes[sample_id]])\n+            # cna value 0 (no CNA) is skipped\n+            if feature['alteration'] == 0:\n+                continue\n+            feature['copyNameAlterationType'] = list(cna_alteration_types.keys())[\n+                list(cna_alteration_types.values()).index(feature['alteration'])]\n+            for column_name, index in header_indexes.items():\n+                value = line_elements[index]\n+                if value != '':\n+                    feature[column_name] = value\n+                elif column_name != 'Entrez_Gene_Id':\n+                    print(Color.RED + \"Empty value encounterd in column '\" + column_name + \"' in row \" + str(\n+                        row_counter) + \". OncoKb annotations cannot be imported. Please fix and rerun.\" + Color.END,\n+                          file=sys.stderr)\n+                    print(\"!\" * 71, file=sys.stderr)\n+                    sys.exit(1)\n+\n+            # resolve gene symbols to Entrez Ids if needed\n+            if 'Entrez_Gene_Id' in feature and feature['Entrez_Gene_Id'] is not None and feature[\n+                'Entrez_Gene_Id'] != '':\n+                entrez_gene_ids = [feature['Entrez_Gene_Id']]\n+            else:\n+                entrez_gene_ids = portal_instance.hugo_entrez_map[feature['Hugo_Symbol']]\n+\n+            if len(entrez_gene_ids) > 1:\n+                logger.error(\"Multiple Entrez gene ids were found for a gene.\" \\\n+                             \"OncoKb annotations will not be imported for this gene.\" \\\n+                             \"Please fix and rerun.\",\n+                             extra={'symbol': feature['Hugo_Symbol']})\n+                feature['Entrez_Gene_Id'] = None\n+            elif len(entrez_gene_ids) == 0:\n+                logger.error(\"Could not find the Entrez gene id for a gene.\" \\\n+                             \"OncoKb annotations will not be imported for this gene.\" \\\n+                             \"Please fix and rerun.\",\n+                             extra={'symbol': feature['Hugo_Symbol']})\n+                feature['Entrez_Gene_Id'] = None\n+            else:\n+                feature['Entrez_Gene_Id'] = str(entrez_gene_ids[0])\n+                feature['id'] = \"_\".join([feature['Entrez_Gene_Id'], feature['copyNameAlterationType']])\n+\n+            features.append(feature)\n+    cna_file.close()\n+    print(\" DONE\")\n+    return features\n+\n+\n+def fetch_oncokb_annotations(features):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 200}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM0MjUxNQ==", "bodyText": "Seems exactly the same to the one in importOncokbDiscreteCNA.py", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536342515", "createdAt": "2020-12-04T19:51:25Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbMutation.py", "diffHunk": "@@ -0,0 +1,293 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for MAF files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_mutation_columns = ['Hugo_Symbol', 'HGVSp_Short', 'Variant_Classification', 'Protein_position']\n+disallowed_mutation_columns = ['cbp_driver', 'cbp_driver_annotation', 'cbp_driver_tiers', 'cbp_driver_tiers_annotation']\n+portal_instance = None\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_file_mutation = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'MUTATION_EXTENDED'})\n+    mutation_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_file_mutation))\n+    check_required_columns(libImportOncokb.get_first_line(open_mutations_file(mutation_file_path)).rstrip('\\n').split('\\t'))\n+    check_disallowed_columns(libImportOncokb.get_first_line(open_mutations_file(mutation_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    row_number_to_feature = get_features(mutation_file_path)\n+    row_number_to_annotation = fetch_oncokb_annotations(row_number_to_feature)\n+    write_annotations_to_file(row_number_to_annotation, mutation_file_path)\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_mutations_file(file_name):\n+    \"\"\"Open MAF file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open MAF file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def check_disallowed_columns(header_elements):\n+    disallowed_columns = []\n+    for disallowed_column in disallowed_mutation_columns:\n+        if disallowed_column in header_elements:\n+            disallowed_columns.append(disallowed_column)\n+    if len(disallowed_columns) > 0:\n+        raise RuntimeError(\"One or more disallowed columns for OncoKb import are present in the MAF file. \" \\\n+                           \"Disallowed column(s): [\" + \", \".join(disallowed_columns) + \"]\")\n+\n+\n+def get_features(mutation_file_path):\n+    \"\"\"Extract Mutation events from MAF data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_mutations_file(mutation_file_path)).rstrip().split('\\t')\n+    header_indexes = {}\n+    for required_column in required_mutation_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    row_number_to_feature = {}\n+    row_counter = 0\n+    mutation_file = open_mutations_file(mutation_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in mutation_file:\n+        row_counter += 1\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip().split('\\t')\n+        feature = {}\n+        for column_name, index in header_indexes.items():\n+            value = line_elements[index]\n+            if value != '':\n+                if column_name == 'HGVSp_Short':\n+                    value = value.replace('p.', '')\n+                feature[column_name] = value\n+            elif column_name != 'Entrez_Gene_Id' and column_name != 'Protein_position':\n+                raise RuntimeError(\"Empty value encounterd in column '\" +\n+                                   column_name + \"' in row \" + str(row_counter) + \".\" \\\n+                                                                                  \"OncoKb annotations cannot be imported. Please fix and rerun.\")\n+\n+        # resolve gene symbols to Entrez Ids if needed\n+        if 'Entrez_Gene_Id' in feature and feature['Entrez_Gene_Id'] is not None and feature['Entrez_Gene_Id'] != '':\n+            entrez_gene_ids = [feature['Entrez_Gene_Id']]\n+        else:\n+            entrez_gene_ids = portal_instance.hugo_entrez_map[feature['Hugo_Symbol']]\n+\n+        if len(entrez_gene_ids) > 1:\n+            logger.error(\"Multiple Entrez gene ids were found for a gene.\" \\\n+                         \"OncoKb annotations will not be imported for this gene.\" \\\n+                         \"Please fix and rerun.\",\n+                         extra={'symbol': feature['Hugo_Symbol'], 'row': str(row_counter)})\n+            feature['Entrez_Gene_Id'] = None\n+        elif len(entrez_gene_ids) == 0:\n+            logger.error(\"Could not find the Entrez gene id for a gene.\" \\\n+                         \"OncoKb annotations will not be imported for this gene.\" \\\n+                         \"Please fix and rerun.\",\n+                         extra={'symbol': feature['Hugo_Symbol'], 'row': str(row_counter)})\n+            feature['Entrez_Gene_Id'] = None\n+        else:\n+            feature['Entrez_Gene_Id'] = str(entrez_gene_ids[0])\n+            feature['id'] = \"_\".join(\n+                [feature['Entrez_Gene_Id'], feature['HGVSp_Short'], feature['Variant_Classification']])\n+\n+        row_number_to_feature[row_counter] = feature\n+    mutation_file.close()\n+    print(\" DONE\")\n+    return row_number_to_feature\n+\n+\n+def fetch_oncokb_annotations(row_number_to_feature):\n+    \"\"\"Submit mutation events to OncoKB.org and return OncoKB annotations.\"\"\"\n+    id_to_rownumber = {}\n+    for row_number, feature in row_number_to_feature.items():\n+        id_to_rownumber[feature['id']] = row_number\n+    payload_list = create_request_payload(row_number_to_feature)\n+    annotations = libImportOncokb.fetch_oncokb_annotations(payload_list, \"https://public.api.oncokb.org/api/v1/annotate/mutations/byProteinChange\")\n+    row_number_to_annotation = {}\n+    id_to_annotation = {annotation['query']['id']: annotation for annotation in annotations}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 184}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM0MzEwNw==", "bodyText": "This could be a generic open_file util method", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536343107", "createdAt": "2020-12-04T19:52:32Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM0NTIzOA==", "bodyText": "All the places using get_first_line seems following with a rstrip and split. Would it make sense just wrap the logic all together for a get_first_line_cells?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536345238", "createdAt": "2020-12-04T19:56:33Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM0ODI5OQ==", "bodyText": "Can we move the public.api.oncokb.org/api/v1 to a global constant so it can be shared?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536348299", "createdAt": "2020-12-04T20:02:25Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    sample_ids = [i for j, i in enumerate(header_elements) if j not in header_indexes.values()]\n+    sample_indexes = {}\n+    for sample_id in sample_ids:\n+        sample_indexes[sample_id] = header_elements.index(sample_id)\n+\n+    features = []\n+    cna_file = open_cna_file(cna_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in cna_file:\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip('\\n').split('\\t')\n+        for sample_id in sample_ids:\n+            feature = {}\n+            feature['sample_id'] = sample_id\n+            feature['alteration'] = int(line_elements[sample_indexes[sample_id]])\n+            # cna value 0 (no CNA) is skipped\n+            if feature['alteration'] == 0:\n+                continue\n+            feature['copyNameAlterationType'] = list(cna_alteration_types.keys())[\n+                list(cna_alteration_types.values()).index(feature['alteration'])]\n+            for column_name, index in header_indexes.items():\n+                value = line_elements[index]\n+                if value != '':\n+                    feature[column_name] = value\n+                elif column_name != 'Entrez_Gene_Id':\n+                    print(Color.RED + \"Empty value encounterd in column '\" + column_name + \"' in row \" + str(\n+                        row_counter) + \". OncoKb annotations cannot be imported. Please fix and rerun.\" + Color.END,\n+                          file=sys.stderr)\n+                    print(\"!\" * 71, file=sys.stderr)\n+                    sys.exit(1)\n+\n+            # resolve gene symbols to Entrez Ids if needed\n+            if 'Entrez_Gene_Id' in feature and feature['Entrez_Gene_Id'] is not None and feature[\n+                'Entrez_Gene_Id'] != '':\n+                entrez_gene_ids = [feature['Entrez_Gene_Id']]\n+            else:\n+                entrez_gene_ids = portal_instance.hugo_entrez_map[feature['Hugo_Symbol']]\n+\n+            if len(entrez_gene_ids) > 1:\n+                logger.error(\"Multiple Entrez gene ids were found for a gene.\" \\\n+                             \"OncoKb annotations will not be imported for this gene.\" \\\n+                             \"Please fix and rerun.\",\n+                             extra={'symbol': feature['Hugo_Symbol']})\n+                feature['Entrez_Gene_Id'] = None\n+            elif len(entrez_gene_ids) == 0:\n+                logger.error(\"Could not find the Entrez gene id for a gene.\" \\\n+                             \"OncoKb annotations will not be imported for this gene.\" \\\n+                             \"Please fix and rerun.\",\n+                             extra={'symbol': feature['Hugo_Symbol']})\n+                feature['Entrez_Gene_Id'] = None\n+            else:\n+                feature['Entrez_Gene_Id'] = str(entrez_gene_ids[0])\n+                feature['id'] = \"_\".join([feature['Entrez_Gene_Id'], feature['copyNameAlterationType']])\n+\n+            features.append(feature)\n+    cna_file.close()\n+    print(\" DONE\")\n+    return features\n+\n+\n+def fetch_oncokb_annotations(features):\n+    \"\"\"Submit CNA events to OncoKB.org and return OncoKB annotations.\"\"\"\n+    id_to_annotation = {}\n+    payload_list = create_request_payload(features)\n+    annotations = libImportOncokb.fetch_oncokb_annotations(payload_list, \"https://public.api.oncokb.org/api/v1/annotate/copyNumberAlterations\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 204}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM0OTc0Mw==", "bodyText": "It seems strange to me you have all upper case, camel case, and lower case headers. Is this your intention?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536349743", "createdAt": "2020-12-04T20:05:19Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    sample_ids = [i for j, i in enumerate(header_elements) if j not in header_indexes.values()]\n+    sample_indexes = {}\n+    for sample_id in sample_ids:\n+        sample_indexes[sample_id] = header_elements.index(sample_id)\n+\n+    features = []\n+    cna_file = open_cna_file(cna_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in cna_file:\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip('\\n').split('\\t')\n+        for sample_id in sample_ids:\n+            feature = {}\n+            feature['sample_id'] = sample_id\n+            feature['alteration'] = int(line_elements[sample_indexes[sample_id]])\n+            # cna value 0 (no CNA) is skipped\n+            if feature['alteration'] == 0:\n+                continue\n+            feature['copyNameAlterationType'] = list(cna_alteration_types.keys())[\n+                list(cna_alteration_types.values()).index(feature['alteration'])]\n+            for column_name, index in header_indexes.items():\n+                value = line_elements[index]\n+                if value != '':\n+                    feature[column_name] = value\n+                elif column_name != 'Entrez_Gene_Id':\n+                    print(Color.RED + \"Empty value encounterd in column '\" + column_name + \"' in row \" + str(\n+                        row_counter) + \". OncoKb annotations cannot be imported. Please fix and rerun.\" + Color.END,\n+                          file=sys.stderr)\n+                    print(\"!\" * 71, file=sys.stderr)\n+                    sys.exit(1)\n+\n+            # resolve gene symbols to Entrez Ids if needed\n+            if 'Entrez_Gene_Id' in feature and feature['Entrez_Gene_Id'] is not None and feature[\n+                'Entrez_Gene_Id'] != '':\n+                entrez_gene_ids = [feature['Entrez_Gene_Id']]\n+            else:\n+                entrez_gene_ids = portal_instance.hugo_entrez_map[feature['Hugo_Symbol']]\n+\n+            if len(entrez_gene_ids) > 1:\n+                logger.error(\"Multiple Entrez gene ids were found for a gene.\" \\\n+                             \"OncoKb annotations will not be imported for this gene.\" \\\n+                             \"Please fix and rerun.\",\n+                             extra={'symbol': feature['Hugo_Symbol']})\n+                feature['Entrez_Gene_Id'] = None\n+            elif len(entrez_gene_ids) == 0:\n+                logger.error(\"Could not find the Entrez gene id for a gene.\" \\\n+                             \"OncoKb annotations will not be imported for this gene.\" \\\n+                             \"Please fix and rerun.\",\n+                             extra={'symbol': feature['Hugo_Symbol']})\n+                feature['Entrez_Gene_Id'] = None\n+            else:\n+                feature['Entrez_Gene_Id'] = str(entrez_gene_ids[0])\n+                feature['id'] = \"_\".join([feature['Entrez_Gene_Id'], feature['copyNameAlterationType']])\n+\n+            features.append(feature)\n+    cna_file.close()\n+    print(\" DONE\")\n+    return features\n+\n+\n+def fetch_oncokb_annotations(features):\n+    \"\"\"Submit CNA events to OncoKB.org and return OncoKB annotations.\"\"\"\n+    id_to_annotation = {}\n+    payload_list = create_request_payload(features)\n+    annotations = libImportOncokb.fetch_oncokb_annotations(payload_list, \"https://public.api.oncokb.org/api/v1/annotate/copyNumberAlterations\")\n+    for annotation in annotations:\n+        id = annotation['query']['id']\n+        id_to_annotation[id] = annotation\n+    return id_to_annotation\n+\n+\n+def create_request_payload(features):\n+    \"\"\"Translate CNA events into JSON for message body.\"\"\"\n+    elements = {}\n+    for feature in features:\n+        elements[feature[\n+            'id']] = '{ \"copyNameAlterationType\":\"%s\", \"gene\":{\"entrezGeneId\":%s}, \"id\":\"%s\", \"tumorType\":null} ' \\\n+                     % (feature['copyNameAlterationType'], feature['Entrez_Gene_Id'], feature['id'])\n+    # normalize for alteration id since same alteration is represented in multiple samples\n+    return list(elements.values())\n+\n+\n+def update_cna_metafile(meta_cna_file_path, pd_file_name):\n+    \"\"\"Add reference to pd annotation file to CNA meta file.\"\"\"\n+    meta_file = open(meta_cna_file_path, \"r\")\n+    lines = meta_file.readlines()\n+    meta_file.close()\n+    meta_file_name = os.path.basename(meta_cna_file_path)\n+    dir = os.path.dirname(meta_cna_file_path)\n+    os.rename(meta_cna_file_path, os.path.join(dir, 'ONCOKB_IMPORT_BACKUP_' + meta_file_name))\n+    if lines[-1] == '\\n':\n+        lines = lines[:-1]\n+    meta_file = open(meta_cna_file_path, \"w\")\n+    for line in lines:\n+        meta_file.write(line)\n+    meta_file.write('pd_annotations_filename: ' + pd_file_name + '\\n')\n+    meta_file.close()\n+\n+\n+def write_annotations_to_file(features, pd_file_name):\n+    \"\"\"Write CNA pd annotations to data file.\"\"\"\n+    new_file = open(pd_file_name, \"w\")\n+    new_file.write(\"SAMPLE_ID\\tEntrez_Gene_Id\\tcbp_driver\\tcbp_driver_annotation\\tcbp_driver_tiers\\tcbp_driver_tiers_annotation\\n\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 242}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1MDQ2NA==", "bodyText": "Sorry about this silly question, is it by design having these three imports written after the logics above? Instead of putting all imports together?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536350464", "createdAt": "2020-12-04T20:06:38Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1MTQ0Mg==", "bodyText": "This logger initiation script is duplicated, is it possible to merge together?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536351442", "createdAt": "2020-12-04T20:08:43Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1MjM5Mw==", "bodyText": "Is Entrez_Gene_Id required column?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536352393", "createdAt": "2020-12-04T20:10:28Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1MjcyOA==", "bodyText": "What does features mean here?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536352728", "createdAt": "2020-12-04T20:11:11Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1MzE5Ng==", "bodyText": "Shouldn't you skip all values that not in cna_alteration_types.values()?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536353196", "createdAt": "2020-12-04T20:11:59Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    sample_ids = [i for j, i in enumerate(header_elements) if j not in header_indexes.values()]\n+    sample_indexes = {}\n+    for sample_id in sample_ids:\n+        sample_indexes[sample_id] = header_elements.index(sample_id)\n+\n+    features = []\n+    cna_file = open_cna_file(cna_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in cna_file:\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip('\\n').split('\\t')\n+        for sample_id in sample_ids:\n+            feature = {}\n+            feature['sample_id'] = sample_id\n+            feature['alteration'] = int(line_elements[sample_indexes[sample_id]])\n+            # cna value 0 (no CNA) is skipped\n+            if feature['alteration'] == 0:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 156}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1NDE2Ng==", "bodyText": "I think that sometimes the cell can be empty by design. Not sure whether you want to stop executing the script.", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536354166", "createdAt": "2020-12-04T20:13:59Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    sample_ids = [i for j, i in enumerate(header_elements) if j not in header_indexes.values()]\n+    sample_indexes = {}\n+    for sample_id in sample_ids:\n+        sample_indexes[sample_id] = header_elements.index(sample_id)\n+\n+    features = []\n+    cna_file = open_cna_file(cna_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in cna_file:\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip('\\n').split('\\t')\n+        for sample_id in sample_ids:\n+            feature = {}\n+            feature['sample_id'] = sample_id\n+            feature['alteration'] = int(line_elements[sample_indexes[sample_id]])\n+            # cna value 0 (no CNA) is skipped\n+            if feature['alteration'] == 0:\n+                continue\n+            feature['copyNameAlterationType'] = list(cna_alteration_types.keys())[\n+                list(cna_alteration_types.values()).index(feature['alteration'])]\n+            for column_name, index in header_indexes.items():\n+                value = line_elements[index]\n+                if value != '':\n+                    feature[column_name] = value\n+                elif column_name != 'Entrez_Gene_Id':", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 164}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1NDc4Ng==", "bodyText": "Do you want to move Hugo_Symbol to a constant to avoid the typo?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536354786", "createdAt": "2020-12-04T20:15:16Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    sample_ids = [i for j, i in enumerate(header_elements) if j not in header_indexes.values()]\n+    sample_indexes = {}\n+    for sample_id in sample_ids:\n+        sample_indexes[sample_id] = header_elements.index(sample_id)\n+\n+    features = []\n+    cna_file = open_cna_file(cna_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in cna_file:\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip('\\n').split('\\t')\n+        for sample_id in sample_ids:\n+            feature = {}\n+            feature['sample_id'] = sample_id\n+            feature['alteration'] = int(line_elements[sample_indexes[sample_id]])\n+            # cna value 0 (no CNA) is skipped\n+            if feature['alteration'] == 0:\n+                continue\n+            feature['copyNameAlterationType'] = list(cna_alteration_types.keys())[\n+                list(cna_alteration_types.values()).index(feature['alteration'])]\n+            for column_name, index in header_indexes.items():\n+                value = line_elements[index]\n+                if value != '':\n+                    feature[column_name] = value\n+                elif column_name != 'Entrez_Gene_Id':\n+                    print(Color.RED + \"Empty value encounterd in column '\" + column_name + \"' in row \" + str(\n+                        row_counter) + \". OncoKb annotations cannot be imported. Please fix and rerun.\" + Color.END,\n+                          file=sys.stderr)\n+                    print(\"!\" * 71, file=sys.stderr)\n+                    sys.exit(1)\n+\n+            # resolve gene symbols to Entrez Ids if needed\n+            if 'Entrez_Gene_Id' in feature and feature['Entrez_Gene_Id'] is not None and feature[\n+                'Entrez_Gene_Id'] != '':\n+                entrez_gene_ids = [feature['Entrez_Gene_Id']]\n+            else:\n+                entrez_gene_ids = portal_instance.hugo_entrez_map[feature['Hugo_Symbol']]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 176}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1NTA4MA==", "bodyText": "Also Entrez_Gene_Id", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536355080", "createdAt": "2020-12-04T20:15:54Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    sample_ids = [i for j, i in enumerate(header_elements) if j not in header_indexes.values()]\n+    sample_indexes = {}\n+    for sample_id in sample_ids:\n+        sample_indexes[sample_id] = header_elements.index(sample_id)\n+\n+    features = []\n+    cna_file = open_cna_file(cna_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in cna_file:\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip('\\n').split('\\t')\n+        for sample_id in sample_ids:\n+            feature = {}\n+            feature['sample_id'] = sample_id\n+            feature['alteration'] = int(line_elements[sample_indexes[sample_id]])\n+            # cna value 0 (no CNA) is skipped\n+            if feature['alteration'] == 0:\n+                continue\n+            feature['copyNameAlterationType'] = list(cna_alteration_types.keys())[\n+                list(cna_alteration_types.values()).index(feature['alteration'])]\n+            for column_name, index in header_indexes.items():\n+                value = line_elements[index]\n+                if value != '':\n+                    feature[column_name] = value\n+                elif column_name != 'Entrez_Gene_Id':\n+                    print(Color.RED + \"Empty value encounterd in column '\" + column_name + \"' in row \" + str(\n+                        row_counter) + \". OncoKb annotations cannot be imported. Please fix and rerun.\" + Color.END,\n+                          file=sys.stderr)\n+                    print(\"!\" * 71, file=sys.stderr)\n+                    sys.exit(1)\n+\n+            # resolve gene symbols to Entrez Ids if needed\n+            if 'Entrez_Gene_Id' in feature and feature['Entrez_Gene_Id'] is not None and feature[\n+                'Entrez_Gene_Id'] != '':\n+                entrez_gene_ids = [feature['Entrez_Gene_Id']]\n+            else:\n+                entrez_gene_ids = portal_instance.hugo_entrez_map[feature['Hugo_Symbol']]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1NDc4Ng=="}, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 176}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1OTM2Mw==", "bodyText": "I noticed that in some of the one line string, you use three quotes even there is not need to escape the quote. Maybe that's the convention you like to use? Here would be a perfect place to use three quotes with multiple lines?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536359363", "createdAt": "2020-12-04T20:24:27Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    sample_ids = [i for j, i in enumerate(header_elements) if j not in header_indexes.values()]\n+    sample_indexes = {}\n+    for sample_id in sample_ids:\n+        sample_indexes[sample_id] = header_elements.index(sample_id)\n+\n+    features = []\n+    cna_file = open_cna_file(cna_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in cna_file:\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip('\\n').split('\\t')\n+        for sample_id in sample_ids:\n+            feature = {}\n+            feature['sample_id'] = sample_id\n+            feature['alteration'] = int(line_elements[sample_indexes[sample_id]])\n+            # cna value 0 (no CNA) is skipped\n+            if feature['alteration'] == 0:\n+                continue\n+            feature['copyNameAlterationType'] = list(cna_alteration_types.keys())[\n+                list(cna_alteration_types.values()).index(feature['alteration'])]\n+            for column_name, index in header_indexes.items():\n+                value = line_elements[index]\n+                if value != '':\n+                    feature[column_name] = value\n+                elif column_name != 'Entrez_Gene_Id':\n+                    print(Color.RED + \"Empty value encounterd in column '\" + column_name + \"' in row \" + str(\n+                        row_counter) + \". OncoKb annotations cannot be imported. Please fix and rerun.\" + Color.END,\n+                          file=sys.stderr)\n+                    print(\"!\" * 71, file=sys.stderr)\n+                    sys.exit(1)\n+\n+            # resolve gene symbols to Entrez Ids if needed\n+            if 'Entrez_Gene_Id' in feature and feature['Entrez_Gene_Id'] is not None and feature[\n+                'Entrez_Gene_Id'] != '':\n+                entrez_gene_ids = [feature['Entrez_Gene_Id']]\n+            else:\n+                entrez_gene_ids = portal_instance.hugo_entrez_map[feature['Hugo_Symbol']]\n+\n+            if len(entrez_gene_ids) > 1:\n+                logger.error(\"Multiple Entrez gene ids were found for a gene.\" \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2MDUyNg==", "bodyText": "It would be great to put this as a string constant.", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536360526", "createdAt": "2020-12-04T20:26:41Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbMutation.py", "diffHunk": "@@ -0,0 +1,293 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for MAF files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_mutation_columns = ['Hugo_Symbol', 'HGVSp_Short', 'Variant_Classification', 'Protein_position']\n+disallowed_mutation_columns = ['cbp_driver', 'cbp_driver_annotation', 'cbp_driver_tiers', 'cbp_driver_tiers_annotation']\n+portal_instance = None\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_file_mutation = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'MUTATION_EXTENDED'})\n+    mutation_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_file_mutation))\n+    check_required_columns(libImportOncokb.get_first_line(open_mutations_file(mutation_file_path)).rstrip('\\n').split('\\t'))\n+    check_disallowed_columns(libImportOncokb.get_first_line(open_mutations_file(mutation_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    row_number_to_feature = get_features(mutation_file_path)\n+    row_number_to_annotation = fetch_oncokb_annotations(row_number_to_feature)\n+    write_annotations_to_file(row_number_to_annotation, mutation_file_path)\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_mutations_file(file_name):\n+    \"\"\"Open MAF file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open MAF file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def check_disallowed_columns(header_elements):\n+    disallowed_columns = []\n+    for disallowed_column in disallowed_mutation_columns:\n+        if disallowed_column in header_elements:\n+            disallowed_columns.append(disallowed_column)\n+    if len(disallowed_columns) > 0:\n+        raise RuntimeError(\"One or more disallowed columns for OncoKb import are present in the MAF file. \" \\\n+                           \"Disallowed column(s): [\" + \", \".join(disallowed_columns) + \"]\")\n+\n+\n+def get_features(mutation_file_path):\n+    \"\"\"Extract Mutation events from MAF data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_mutations_file(mutation_file_path)).rstrip().split('\\t')\n+    header_indexes = {}\n+    for required_column in required_mutation_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    row_number_to_feature = {}\n+    row_counter = 0\n+    mutation_file = open_mutations_file(mutation_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in mutation_file:\n+        row_counter += 1\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip().split('\\t')\n+        feature = {}\n+        for column_name, index in header_indexes.items():\n+            value = line_elements[index]\n+            if value != '':\n+                if column_name == 'HGVSp_Short':", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDAwMg==", "bodyText": "I didn't review this method considering it's coming from the portal.", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536364002", "createdAt": "2020-12-04T20:34:02Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/libImportOncokb.py", "diffHunk": "@@ -0,0 +1,236 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script.\n+\n+Run with the command line option --help for usage information.\n+\"\"\"\n+\n+import re\n+import os\n+import requests\n+import json\n+\n+from . import validateData\n+\n+\n+BATCH_SIZE = 200\n+\n+\n+def load_portal_genes(server_url):\n+    parsed_json = request_from_portal_api(server_url, \"genes\", logging.getLogger(__name__))\n+    return transform_symbol_entrez_map(parsed_json, 'hugoGeneSymbol')\n+\n+\n+# after: getProteinStart() in ExtendedMutationUtil.java\n+def get_protein_pos_start(protein_position, protein_change):\n+    start = -1\n+    if protein_position is not None:\n+        start_end = protein_position.split('/')[0].split('-')\n+        if len(start_end) > 0:\n+            start = start_end[0]\n+    if start == -1 and protein_change is not None:\n+        start_stop = annotate_protein_change(protein_change)\n+        start = str(start_stop['start'])\n+    return start\n+\n+\n+# after: getProteinPosEnd() in ExtendedMutationUtil.java\n+def get_protein_pos_end(protein_position, protein_change):\n+    stop = -1\n+    if protein_position is not None:\n+        start_end = protein_position.split('/')[0].split('-')\n+        if len(start_end) > 1:\n+            stop = start_end[1]\n+    if stop == -1 and protein_change is not None:\n+        start_stop = annotate_protein_change(protein_change)\n+        stop = str(start_stop['stop'])\n+    return stop\n+\n+\n+# after: annotateProteinChange() in ExtendedMutationUtil.java\n+def annotate_protein_change(protein_change):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDM1Ng==", "bodyText": "end?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536364356", "createdAt": "2020-12-04T20:34:44Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/libImportOncokb.py", "diffHunk": "@@ -0,0 +1,236 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script.\n+\n+Run with the command line option --help for usage information.\n+\"\"\"\n+\n+import re\n+import os\n+import requests\n+import json\n+\n+from . import validateData\n+\n+\n+BATCH_SIZE = 200\n+\n+\n+def load_portal_genes(server_url):\n+    parsed_json = request_from_portal_api(server_url, \"genes\", logging.getLogger(__name__))\n+    return transform_symbol_entrez_map(parsed_json, 'hugoGeneSymbol')\n+\n+\n+# after: getProteinStart() in ExtendedMutationUtil.java\n+def get_protein_pos_start(protein_position, protein_change):\n+    start = -1\n+    if protein_position is not None:\n+        start_end = protein_position.split('/')[0].split('-')\n+        if len(start_end) > 0:\n+            start = start_end[0]\n+    if start == -1 and protein_change is not None:\n+        start_stop = annotate_protein_change(protein_change)\n+        start = str(start_stop['start'])\n+    return start\n+\n+\n+# after: getProteinPosEnd() in ExtendedMutationUtil.java\n+def get_protein_pos_end(protein_position, protein_change):\n+    stop = -1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDQ1Nw==", "bodyText": "What's your normal protein position? In the Maf file we are using, it's annotate_protein_change  a single digit for the missense mutation. The protein end is start_end[0]", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536364457", "createdAt": "2020-12-04T20:34:58Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/libImportOncokb.py", "diffHunk": "@@ -0,0 +1,236 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script.\n+\n+Run with the command line option --help for usage information.\n+\"\"\"\n+\n+import re\n+import os\n+import requests\n+import json\n+\n+from . import validateData\n+\n+\n+BATCH_SIZE = 200\n+\n+\n+def load_portal_genes(server_url):\n+    parsed_json = request_from_portal_api(server_url, \"genes\", logging.getLogger(__name__))\n+    return transform_symbol_entrez_map(parsed_json, 'hugoGeneSymbol')\n+\n+\n+# after: getProteinStart() in ExtendedMutationUtil.java\n+def get_protein_pos_start(protein_position, protein_change):\n+    start = -1\n+    if protein_position is not None:\n+        start_end = protein_position.split('/')[0].split('-')\n+        if len(start_end) > 0:\n+            start = start_end[0]\n+    if start == -1 and protein_change is not None:\n+        start_stop = annotate_protein_change(protein_change)\n+        start = str(start_stop['start'])\n+    return start\n+\n+\n+# after: getProteinPosEnd() in ExtendedMutationUtil.java\n+def get_protein_pos_end(protein_position, protein_change):\n+    stop = -1\n+    if protein_position is not None:\n+        start_end = protein_position.split('/')[0].split('-')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDkwMw==", "bodyText": "This is the api to curated gene list not cancer genes. Which one you like to use?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536364903", "createdAt": "2020-12-04T20:35:57Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/libImportOncokb.py", "diffHunk": "@@ -0,0 +1,236 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script.\n+\n+Run with the command line option --help for usage information.\n+\"\"\"\n+\n+import re\n+import os\n+import requests\n+import json\n+\n+from . import validateData\n+\n+\n+BATCH_SIZE = 200\n+\n+\n+def load_portal_genes(server_url):\n+    parsed_json = request_from_portal_api(server_url, \"genes\", logging.getLogger(__name__))\n+    return transform_symbol_entrez_map(parsed_json, 'hugoGeneSymbol')\n+\n+\n+# after: getProteinStart() in ExtendedMutationUtil.java\n+def get_protein_pos_start(protein_position, protein_change):\n+    start = -1\n+    if protein_position is not None:\n+        start_end = protein_position.split('/')[0].split('-')\n+        if len(start_end) > 0:\n+            start = start_end[0]\n+    if start == -1 and protein_change is not None:\n+        start_stop = annotate_protein_change(protein_change)\n+        start = str(start_stop['start'])\n+    return start\n+\n+\n+# after: getProteinPosEnd() in ExtendedMutationUtil.java\n+def get_protein_pos_end(protein_position, protein_change):\n+    stop = -1\n+    if protein_position is not None:\n+        start_end = protein_position.split('/')[0].split('-')\n+        if len(start_end) > 1:\n+            stop = start_end[1]\n+    if stop == -1 and protein_change is not None:\n+        start_stop = annotate_protein_change(protein_change)\n+        stop = str(start_stop['stop'])\n+    return stop\n+\n+\n+# after: annotateProteinChange() in ExtendedMutationUtil.java\n+def annotate_protein_change(protein_change):\n+    start = -1\n+    end = -1\n+    match = re.findall(r'^([A-Z\\*]+)([0-9]+)([A-Z\\*\\?]*)$', protein_change)\n+    if len(match) > 0:\n+        ref = match[0][0]\n+        var = match[0][2]\n+        refL = len(ref)\n+        start = int(match[0][1])\n+        if ref == var or ref == '*' or var == '*' or start == 1 or var == '?':\n+            end = start\n+        else:\n+            end = start + refL - 1\n+    else:\n+        match = re.findall(r'[A-Z]?([0-9]+)(_[A-Z]?([0-9]+))?(delins|ins)([A-Z]+)', protein_change)\n+        if len(match) > 0:\n+            start = int(match[0][0])\n+            if match[0][2] is not None:\n+                end = int(match[0][2])\n+            else:\n+                end = start\n+        else:\n+            match = re.findall(r'[A-Z]?([0-9]+)(_[A-Z]?([0-9]+))?(_)?splice', protein_change)\n+            if len(match) > 0:\n+                start = int(match[0][0])\n+                if match[0][2] is not None and match[0][2] != '':\n+                    end = int(match[0][2])\n+                else:\n+                    end = start\n+            else:\n+                match = re.findall(r'[A-Z]?([0-9]+)_[A-Z]?([0-9]+)(.+)', protein_change)\n+                if len(match) > 0:\n+                    start = int(match[0][0])\n+                    end = int(match[0][1])\n+                else:\n+                    match = re.findall(r'([A-Z\\*])([0-9]+)[A-Z]?fs.*', protein_change)\n+                    if len(match) > 0:\n+                        start = int(match[0][1])\n+                        end = start\n+                    else:\n+                        match = re.findall(r'([A-Z]+)?([0-9]+)((ins)|(del)|(dup))', protein_change)\n+                        if len(match) > 0:\n+                            start = int(match[0][1])\n+                            end = start\n+    return {\"start\": start, \"stop\": end}\n+\n+\n+def evaluate_driver_passenger(oncogenic):\n+    \"\"\"Translate the OncoKB 'oncogenic' value to Putative_Driver' or Putative_Passenger'\"\"\"\n+    custom_annotation = 'Putative_Passenger'\n+    if oncogenic.lower() in ['oncogenic', 'likely oncogenic', 'predicted oncogenic']:\n+        custom_annotation = 'Putative_Driver'\n+    return custom_annotation\n+\n+\n+def get_first_line(file_handle):\n+    \"\"\"Read the first line of a file ignoring comment lines.\"\"\"\n+    while True:\n+        first_line = file_handle.readline()\n+        if not first_line.startswith('#'):\n+            file_handle.close()\n+            return first_line\n+\n+\n+def find_meta_file_by_fields(study_dir, field_dict):\n+    \"\"\"In the study directory find the meta file that holds specified field values.\"\"\"\n+    filenames = os.listdir(study_dir)\n+    meta_files = [ file for file in filenames if file.startswith('meta_')]\n+    meta_files = [ study_dir + \"/\" + file for file in meta_files ]\n+    for meta_file in meta_files:\n+        fields = read_meta_file(meta_file)\n+        match_found = True\n+        for field_name, field_value in field_dict.items():\n+            if field_name not in fields or fields[field_name] != field_value:\n+                match_found = False\n+        if match_found:\n+            return os.path.join(study_dir, meta_file)\n+    return None\n+\n+\n+def find_data_file_from_meta_file(metafile_path):\n+    \"\"\"From specified meta file return the value of the 'data_filename' field.\"\"\"\n+    fields = read_meta_file(metafile_path)\n+    return fields['data_filename']\n+\n+\n+def read_meta_file(metafile_path):\n+    \"\"\"Read fields of specified meta into a dict.\"\"\"\n+    fields = {}\n+    with open(metafile_path) as metafile:\n+        for line in metafile:\n+            if line == '\\n':\n+                continue\n+            match = re.findall(r'\\s*(\\S+)\\s*:\\s*(\\S+)', line)[0]\n+            fields[match[0]] = match[1]\n+    return fields\n+\n+def get_oncokb_cancer_genes():\n+    \"\"\"Do a call to OncoKB to retrieve the Cancer Gene List. \"\"\"\n+    request_url = \"https://public.api.oncokb.org/api/v1/utils/allCuratedGenes\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 173}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NTQzMA==", "bodyText": "I don't see usage of sv. Are you adding later?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536365430", "createdAt": "2020-12-04T20:37:02Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/libImportOncokb.py", "diffHunk": "@@ -0,0 +1,236 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script.\n+\n+Run with the command line option --help for usage information.\n+\"\"\"\n+\n+import re\n+import os\n+import requests\n+import json\n+\n+from . import validateData\n+\n+\n+BATCH_SIZE = 200\n+\n+\n+def load_portal_genes(server_url):\n+    parsed_json = request_from_portal_api(server_url, \"genes\", logging.getLogger(__name__))\n+    return transform_symbol_entrez_map(parsed_json, 'hugoGeneSymbol')\n+\n+\n+# after: getProteinStart() in ExtendedMutationUtil.java\n+def get_protein_pos_start(protein_position, protein_change):\n+    start = -1\n+    if protein_position is not None:\n+        start_end = protein_position.split('/')[0].split('-')\n+        if len(start_end) > 0:\n+            start = start_end[0]\n+    if start == -1 and protein_change is not None:\n+        start_stop = annotate_protein_change(protein_change)\n+        start = str(start_stop['start'])\n+    return start\n+\n+\n+# after: getProteinPosEnd() in ExtendedMutationUtil.java\n+def get_protein_pos_end(protein_position, protein_change):\n+    stop = -1\n+    if protein_position is not None:\n+        start_end = protein_position.split('/')[0].split('-')\n+        if len(start_end) > 1:\n+            stop = start_end[1]\n+    if stop == -1 and protein_change is not None:\n+        start_stop = annotate_protein_change(protein_change)\n+        stop = str(start_stop['stop'])\n+    return stop\n+\n+\n+# after: annotateProteinChange() in ExtendedMutationUtil.java\n+def annotate_protein_change(protein_change):\n+    start = -1\n+    end = -1\n+    match = re.findall(r'^([A-Z\\*]+)([0-9]+)([A-Z\\*\\?]*)$', protein_change)\n+    if len(match) > 0:\n+        ref = match[0][0]\n+        var = match[0][2]\n+        refL = len(ref)\n+        start = int(match[0][1])\n+        if ref == var or ref == '*' or var == '*' or start == 1 or var == '?':\n+            end = start\n+        else:\n+            end = start + refL - 1\n+    else:\n+        match = re.findall(r'[A-Z]?([0-9]+)(_[A-Z]?([0-9]+))?(delins|ins)([A-Z]+)', protein_change)\n+        if len(match) > 0:\n+            start = int(match[0][0])\n+            if match[0][2] is not None:\n+                end = int(match[0][2])\n+            else:\n+                end = start\n+        else:\n+            match = re.findall(r'[A-Z]?([0-9]+)(_[A-Z]?([0-9]+))?(_)?splice', protein_change)\n+            if len(match) > 0:\n+                start = int(match[0][0])\n+                if match[0][2] is not None and match[0][2] != '':\n+                    end = int(match[0][2])\n+                else:\n+                    end = start\n+            else:\n+                match = re.findall(r'[A-Z]?([0-9]+)_[A-Z]?([0-9]+)(.+)', protein_change)\n+                if len(match) > 0:\n+                    start = int(match[0][0])\n+                    end = int(match[0][1])\n+                else:\n+                    match = re.findall(r'([A-Z\\*])([0-9]+)[A-Z]?fs.*', protein_change)\n+                    if len(match) > 0:\n+                        start = int(match[0][1])\n+                        end = start\n+                    else:\n+                        match = re.findall(r'([A-Z]+)?([0-9]+)((ins)|(del)|(dup))', protein_change)\n+                        if len(match) > 0:\n+                            start = int(match[0][1])\n+                            end = start\n+    return {\"start\": start, \"stop\": end}\n+\n+\n+def evaluate_driver_passenger(oncogenic):\n+    \"\"\"Translate the OncoKB 'oncogenic' value to Putative_Driver' or Putative_Passenger'\"\"\"\n+    custom_annotation = 'Putative_Passenger'\n+    if oncogenic.lower() in ['oncogenic', 'likely oncogenic', 'predicted oncogenic']:\n+        custom_annotation = 'Putative_Driver'\n+    return custom_annotation\n+\n+\n+def get_first_line(file_handle):\n+    \"\"\"Read the first line of a file ignoring comment lines.\"\"\"\n+    while True:\n+        first_line = file_handle.readline()\n+        if not first_line.startswith('#'):\n+            file_handle.close()\n+            return first_line\n+\n+\n+def find_meta_file_by_fields(study_dir, field_dict):\n+    \"\"\"In the study directory find the meta file that holds specified field values.\"\"\"\n+    filenames = os.listdir(study_dir)\n+    meta_files = [ file for file in filenames if file.startswith('meta_')]\n+    meta_files = [ study_dir + \"/\" + file for file in meta_files ]\n+    for meta_file in meta_files:\n+        fields = read_meta_file(meta_file)\n+        match_found = True\n+        for field_name, field_value in field_dict.items():\n+            if field_name not in fields or fields[field_name] != field_value:\n+                match_found = False\n+        if match_found:\n+            return os.path.join(study_dir, meta_file)\n+    return None\n+\n+\n+def find_data_file_from_meta_file(metafile_path):\n+    \"\"\"From specified meta file return the value of the 'data_filename' field.\"\"\"\n+    fields = read_meta_file(metafile_path)\n+    return fields['data_filename']\n+\n+\n+def read_meta_file(metafile_path):\n+    \"\"\"Read fields of specified meta into a dict.\"\"\"\n+    fields = {}\n+    with open(metafile_path) as metafile:\n+        for line in metafile:\n+            if line == '\\n':\n+                continue\n+            match = re.findall(r'\\s*(\\S+)\\s*:\\s*(\\S+)', line)[0]\n+            fields[match[0]] = match[1]\n+    return fields\n+\n+def get_oncokb_cancer_genes():\n+    \"\"\"Do a call to OncoKB to retrieve the Cancer Gene List. \"\"\"\n+    request_url = \"https://public.api.oncokb.org/api/v1/utils/allCuratedGenes\"\n+    request = requests.get(url=request_url)\n+\n+    if request.ok:\n+        return request.json()\n+    else:\n+        if request.status_code == 404:\n+            raise ConnectionError(\n+                \"An error occurred when trying to connect to OncoKB for retrieving of mutation annotations.\")\n+        else:\n+            request.raise_for_status()\n+\n+def get_annotated_oncokb_cancer_genes_by_entrezId():\n+    \"\"\" Get a list with the Entrez Gene IDs of the OncoKB Cancer Gene List, only the genes that have\n+        annotations. \"\"\"\n+    cancer_genes = get_oncokb_cancer_genes()\n+    entrez_ids = []\n+    for gene in cancer_genes:\n+        entrez_ids += [gene[\"entrezGeneId\"]]\n+    return entrez_ids\n+\n+def filter_payload(payload_list, sv):\n+    \"\"\" Remove the genes that are not an OncoKB Cancer Gene List from the payload. \"\"\"\n+    cancer_genes = get_annotated_oncokb_cancer_genes_by_entrezId()\n+    filtered_payload = []\n+    for element in payload_list:\n+        parsed_element = json.loads(element)\n+        if sv:\n+            if parsed_element[\"geneA\"][\"entrezGeneId\"] in cancer_genes and parsed_element[\"geneB\"][\"entrezGeneId\"] in cancer_genes:\n+                filtered_payload += [element]\n+        else:\n+            if parsed_element[\"gene\"][\"entrezGeneId\"] in cancer_genes:\n+                filtered_payload += [element]\n+    return filtered_payload\n+\n+def fetch_oncokb_annotations(payload_list, request_url, sv=False):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 208}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NjEyOA==", "bodyText": "Can we do a quick standardize the language in the output? We mix use OncoKB and OncoKb through out different files. Let's stick to OncoKB. Thanks!", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536366128", "createdAt": "2020-12-04T20:38:45Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/importOncokbDiscreteCNA.py", "diffHunk": "@@ -0,0 +1,288 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"OncoKB annotation import script for discrete CNA files.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+from os import path\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+required_cna_columns = ['Hugo_Symbol']\n+\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+\n+def main_import(args):\n+\n+    study_dir = args.study_directory\n+    server_url = args.url_server\n+\n+    # get a logger to emit messages\n+    logger = logging.getLogger(__name__)\n+    logger.setLevel(logging.INFO)\n+    exit_status_handler = validateData.MaxLevelTrackingHandler()\n+    logger.addHandler(exit_status_handler)\n+\n+    # set default message handler\n+    text_handler = logging.StreamHandler(sys.stdout)\n+    text_handler.setFormatter(\n+        cbioportal_common.LogfileStyleFormatter(study_dir))\n+    collapsing_text_handler = cbioportal_common.CollapsingLogMessageHandler(\n+        capacity=5e5,\n+        flushLevel=logging.CRITICAL,\n+        target=text_handler)\n+    collapsing_text_handler.setLevel(logging.INFO)\n+    logger.addHandler(collapsing_text_handler)\n+\n+    meta_cna_file_path = libImportOncokb.find_meta_file_by_fields(study_dir, {'genetic_alteration_type': 'COPY_NUMBER_ALTERATION', 'datatype': 'DISCRETE'})\n+    cna_file_path = os.path.join(study_dir, libImportOncokb.find_data_file_from_meta_file(meta_cna_file_path))\n+    pd_file_name = 'data_cna_pd_annotations.txt'\n+    pd_file_path = os.path.join(study_dir, pd_file_name)\n+    meta_dict = libImportOncokb.read_meta_file(meta_cna_file_path)\n+    if 'pd_annotations_filename' in meta_dict:\n+        raise RuntimeError(\n+            \"Custom driver annotations filename already specified in discrete CNA meta file. Please remove and rerun.\")\n+    if path.exists(pd_file_path):\n+        raise RuntimeError(\n+            \"Custom driver annotations file '\" + pd_file_path + \"' for discrete CNA already exists . Please remove and rerun.\")\n+    check_required_columns(libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t'))\n+\n+    global portal_instance\n+    if hasattr(args, 'portal_info_dir') and args.portal_info_dir is not None:\n+        portal_instance = validateData.load_portal_info(args.portal_info_dir, logger,\n+                                           offline=True)\n+    else:\n+        portal_instance = validateData.load_portal_info(server_url, logger)\n+\n+    features = get_features(cna_file_path)\n+    id_to_annotation = fetch_oncokb_annotations(features)\n+    for feature in features:\n+        if feature['id'] in id_to_annotation:\n+            feature['oncogenic'] = id_to_annotation[feature['id']]['oncogenic']\n+\n+    print(\"Updating study files ...\", end = '')\n+    write_annotations_to_file(features, pd_file_path)\n+    update_cna_metafile(meta_cna_file_path, pd_file_name)\n+    print(\" DONE\")\n+\n+    logger.info('Import complete')\n+\n+    return exit_status_handler.get_exit_status()\n+\n+\n+def open_cna_file(file_name):\n+    \"\"\"Open CNA file and handle exception when not found.\"\"\"\n+    try:\n+        file = open(file_name)\n+    except FileNotFoundError:\n+        raise FilenotFoundError(\"Could not open discrete CNA file at path '\" + file_name + \"'\")\n+    return file\n+\n+\n+def get_features(cna_file_path):\n+    \"\"\"Extract CNA events from CNA data file.\"\"\"\n+    header_elements = libImportOncokb.get_first_line(open_cna_file(cna_file_path)).rstrip('\\n').split('\\t')\n+    header_indexes = {}\n+    for required_column in required_cna_columns + ['Entrez_Gene_Id']:\n+        header_indexes[required_column] = header_elements.index(required_column)\n+    sample_ids = [i for j, i in enumerate(header_elements) if j not in header_indexes.values()]\n+    sample_indexes = {}\n+    for sample_id in sample_ids:\n+        sample_indexes[sample_id] = header_elements.index(sample_id)\n+\n+    features = []\n+    cna_file = open_cna_file(cna_file_path)\n+    print(\"Reading features from file ...\", end = '')\n+    for line in cna_file:\n+        if line == '\\n' or line.startswith('#') or line.startswith(header_elements[0]):\n+            continue  # skip comment and header line\n+        line_elements = line.rstrip('\\n').split('\\t')\n+        for sample_id in sample_ids:\n+            feature = {}\n+            feature['sample_id'] = sample_id\n+            feature['alteration'] = int(line_elements[sample_indexes[sample_id]])\n+            # cna value 0 (no CNA) is skipped\n+            if feature['alteration'] == 0:\n+                continue\n+            feature['copyNameAlterationType'] = list(cna_alteration_types.keys())[\n+                list(cna_alteration_types.values()).index(feature['alteration'])]\n+            for column_name, index in header_indexes.items():\n+                value = line_elements[index]\n+                if value != '':\n+                    feature[column_name] = value\n+                elif column_name != 'Entrez_Gene_Id':\n+                    print(Color.RED + \"Empty value encounterd in column '\" + column_name + \"' in row \" + str(\n+                        row_counter) + \". OncoKb annotations cannot be imported. Please fix and rerun.\" + Color.END,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 166}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3MDU5Mw==", "bodyText": "In the importOncokbMutation.py, you have similar logics. Are they different?", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#discussion_r536370593", "createdAt": "2020-12-04T20:47:42Z", "author": {"login": "zhx828"}, "path": "core/src/main/scripts/importer/updateOncokbAnnotations.py", "diffHunk": "@@ -0,0 +1,379 @@\n+#!/usr/bin/env python3\n+\n+#\n+# Copyright (c) 2020 The Hyve B.V.\n+# This code is licensed under the GNU Affero General Public License (AGPL),\n+# version 3, or (at your option) any later version.\n+#\n+\n+#\n+# This file is part of cBioPortal.\n+#\n+# cBioPortal is free software: you can redistribute it and/or modify\n+# it under the terms of the GNU Affero General Public License as\n+# published by the Free Software Foundation, either version 3 of the\n+# License.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU Affero General Public License for more details.\n+#\n+# You should have received a copy of the GNU Affero General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+#\n+\n+\"\"\"Script to update OncoKB annotation for the provided study.\n+\"\"\"\n+\n+import argparse\n+import importlib\n+import logging.handlers\n+import os\n+import requests\n+import sys\n+import MySQLdb\n+from pathlib import Path\n+\n+# configure relative imports if running as a script; see PEP 366\n+# it might passed as empty string by certain tooling to mark a top level module\n+if __name__ == \"__main__\" and (__package__ is None or __package__ == ''):\n+    # replace the script's location in the Python search path by the main\n+    # scripts/ folder, above it, so that the importer package folder is in\n+    # scope and *not* directly in sys.path; see PEP 395\n+    sys.path[0] = str(Path(sys.path[0]).resolve().parent)\n+    __package__ = 'importer'\n+    # explicitly import the package, which is needed on CPython 3.4 because it\n+    # doesn't include https://github.com/python/cpython/pull/2639\n+    importlib.import_module(__package__)\n+\n+from . import cbioportal_common\n+from . import libImportOncokb\n+from . import validateData\n+\n+ERROR_FILE = sys.stderr\n+DATABASE_HOST = 'db.host'\n+DATABASE_NAME = 'db.portal_db_name'\n+DATABASE_USER = 'db.user'\n+DATABASE_PW = 'db.password'\n+REQUIRED_PROPERTIES = [DATABASE_HOST, DATABASE_NAME, DATABASE_USER, DATABASE_PW]\n+REFERENCE_GENOME = {'hg19': 'GRCh37', 'hg38': 'GRCh38'}\n+\n+# from: cbioportal-frontend file CopyNumberUtils.ts\n+cna_alteration_types = {\n+    \"DELETION\": -2,\n+    \"LOSS\": -1,\n+    \"GAIN\": 1,\n+    \"AMPLIFICATION\": 2,\n+}\n+\n+class PortalProperties(object):\n+    \"\"\" Properties object class, just has fields for db conn \"\"\"\n+\n+    def __init__(self, database_host, database_name, database_user, database_pw):\n+        # default port:\n+        self.database_port = 3306\n+        # if there is a port added to the host name, split and use this one:\n+        if ':' in database_host:\n+            host_and_port = database_host.split(':')\n+            self.database_host = host_and_port[0]\n+            if self.database_host.strip() == 'localhost':\n+                print(\n+                    \"Invalid host config '\" + database_host + \"' in properties file. If you want to specify a port on local host use '127.0.0.1' instead of 'localhost'\",\n+                    file=ERROR_FILE)\n+                sys.exit(1)\n+            self.database_port = int(host_and_port[1])\n+        else:\n+            self.database_host = database_host\n+        self.database_name = database_name\n+        self.database_user = database_user\n+        self.database_pw = database_pw\n+\n+def get_portal_properties(properties_filename):\n+    \"\"\" Returns a properties object \"\"\"\n+    properties = {}\n+    with open(properties_filename, 'r') as properties_file:\n+        for line in properties_file:\n+            line = line.strip()\n+            # skip line if its blank or a comment\n+            if len(line) == 0 or line.startswith('#'):\n+                continue\n+            try:\n+                name, value = line.split('=', maxsplit=1)\n+            except ValueError:\n+                print(\n+                    'Skipping invalid entry in property file: %s' % (line),\n+                    file=ERROR_FILE)\n+                continue\n+            properties[name] = value.strip()\n+    missing_properties = []\n+    for required_property in REQUIRED_PROPERTIES:\n+        if required_property not in properties or len(properties[required_property]) == 0:\n+            missing_properties.append(required_property)\n+    if missing_properties:\n+        print(\n+            'Missing required properties : (%s)' % (', '.join(missing_properties)),\n+            file=ERROR_FILE)\n+        return None\n+    # return an instance of PortalProperties\n+    return PortalProperties(properties[DATABASE_HOST],\n+                            properties[DATABASE_NAME],\n+                            properties[DATABASE_USER],\n+                            properties[DATABASE_PW])\n+\n+def get_db_cursor(portal_properties):\n+    \"\"\" Establishes a MySQL connection \"\"\"\n+    try:\n+        connection = MySQLdb.connect(host=portal_properties.database_host,\n+            port = portal_properties.database_port,\n+            user = portal_properties.database_user,\n+            passwd = portal_properties.database_pw,\n+            db = portal_properties.database_name)\n+        connection.autocommit = False\n+    except MySQLdb.Error as exception:\n+        print(exception, file=ERROR_FILE)\n+        port_info = ''\n+        if portal_properties.database_host.strip() != 'localhost':\n+            # only add port info if host is != localhost (since with localhost apparently sockets are used and not the given port) TODO - perhaps this applies for all names vs ips?\n+            port_info = \" on port \" + str(portal_properties.database_port)\n+        message = (\n+            \"--> Error connecting to server \"\n+            + portal_properties.database_host\n+            + port_info)\n+        print(message, file=ERROR_FILE)\n+        raise ConnectionError(message) from exception\n+    if connection is not None:\n+        return connection, connection.cursor()\n+\n+def get_current_mutation_data(study_id, cursor):\n+    \"\"\" Get mutation data from the current study.\n+        Returns an array of dictionaries, with the following keys:\n+        id, geneticProfileId, entrezGeneId, alteration, and consequence\n+    \"\"\"\n+    mutations = []\n+    try:\n+        cursor.execute('SELECT genetic_profile.GENETIC_PROFILE_ID, mutation_event.ENTREZ_GENE_ID, PROTEIN_CHANGE as ALTERATION, ' +\n+        'MUTATION_TYPE as CONSEQUENCE, mutation.MUTATION_EVENT_ID, mutation.SAMPLE_ID FROM cbioportal.mutation_event ' +\n+        'inner join mutation on mutation.MUTATION_EVENT_ID = mutation_event.MUTATION_EVENT_ID ' +\n+        'inner join genetic_profile on genetic_profile.GENETIC_PROFILE_ID = mutation.GENETIC_PROFILE_ID ' +\n+        'inner join cancer_study on cancer_study.CANCER_STUDY_ID = genetic_profile.CANCER_STUDY_ID ' +\n+        'WHERE cancer_study.CANCER_STUDY_IDENTIFIER = \"'+study_id +'\"')\n+        for row in cursor.fetchall():\n+            mutations += [{ \"id\": \"_\".join([str(row[4]), str(row[0]), str(row[5])]), \"geneticProfileId\": row[0], \"entrezGeneId\": row[1],\n+                            \"alteration\": row[2], \"consequence\": row[3]}]\n+    except MySQLdb.Error as msg:\n+        print(msg, file=ERROR_FILE)\n+        return None\n+    return mutations\n+\n+def get_current_cna_data(study_id, cursor):\n+    \"\"\" Get cna data from the current study.\n+        Returns an array of dictionaries, with the following keys:\n+        id, geneticProfileId, entrezGeneId, and alteration\n+    \"\"\"\n+    cna = []\n+    try:\n+        cursor.execute('SELECT genetic_profile.GENETIC_PROFILE_ID, '+ 'cna_event.ENTREZ_GENE_ID, cna_event.ALTERATION, '+\n+        'sample_cna_event.CNA_EVENT_ID, sample_cna_event.SAMPLE_ID from cbioportal.cna_event ' +\n+        'inner join sample_cna_event on sample_cna_event.CNA_EVENT_ID = cna_event.CNA_EVENT_ID '+\n+        'inner join genetic_profile on genetic_profile.GENETIC_PROFILE_ID = sample_cna_event.GENETIC_PROFILE_ID '+\n+        'inner join cancer_study on cancer_study.CANCER_STUDY_ID = genetic_profile.CANCER_STUDY_ID '+\n+        'WHERE cancer_study.CANCER_STUDY_IDENTIFIER = \"'+study_id +'\"')\n+        for row in cursor.fetchall():\n+            alteration = list(cna_alteration_types.keys())[\n+                list(cna_alteration_types.values()).index(row[2])]\n+            cna += [{\"id\": \"_\".join([str(row[3]), str(row[0]), str(row[4])]), \"geneticProfileId\": row[0], \"entrezGeneId\": row[1],\n+                    \"alteration\": alteration}]\n+    except MySQLdb.Error as msg:\n+        print(msg, file=ERROR_FILE)\n+        return None\n+    return cna\n+\n+def get_current_sv_data(study_id, cursor):\n+    \"\"\" Get structural variant data from the current study.\n+        Returns an array of dictionaries, with the following keys:\n+        id, geneticProfileId, entrezGeneIdA, entrezGeneIdB, and structuralVariantType\n+    \"\"\"\n+    sv = []\n+    try:\n+        cursor.execute('SELECT genetic_profile.GENETIC_PROFILE_ID, '+ 'structural_variant.SITE1_ENTREZ_GENE_ID, '+\n+        'structural_variant.SITE2_ENTREZ_GENE_ID, structural_variant.EVENT_INFO, ' +\n+        'structural_variant.INTERNAL_ID, structural_variant.SAMPLE_ID from cbioportal.structural_variant ' +\n+        'inner join genetic_profile on genetic_profile.GENETIC_PROFILE_ID = structural_variant.GENETIC_PROFILE_ID '+\n+        'inner join cancer_study on cancer_study.CANCER_STUDY_ID = genetic_profile.CANCER_STUDY_ID '+\n+        'WHERE cancer_study.CANCER_STUDY_IDENTIFIER = \"'+study_id +'\"')\n+        for row in cursor.fetchall():\n+            sv += [{\"id\": \"_\".join([str(row[4]), str(row[0]), str(row[5])]), \"geneticProfileId\": row[0], \"entrezGeneIdA\": row[1],\n+                    \"entrezGeneIdB\": row[2], \"structuralVariantType\": row[3]}]\n+    except MySQLdb.Error as msg:\n+        print(msg, file=ERROR_FILE)\n+        return None\n+    return sv\n+\n+def get_reference_genome(study_id, cursor):\n+    \"\"\" Get reference genome from the study \"\"\"\n+    ref_genome = []\n+    try:\n+        cursor.execute('SELECT reference_genome.NAME FROM reference_genome ' +\n+        'inner join cancer_study ON cancer_study.reference_genome_id = reference_genome.reference_genome_id ' +\n+        'WHERE cancer_study.CANCER_STUDY_IDENTIFIER = \"'+study_id +'\"')\n+        for row in cursor.fetchall():\n+            ref_genome += [row[0]]\n+        if len(ref_genome) == 1:\n+            return REFERENCE_GENOME[ref_genome[0]]\n+        else:\n+            raise ValueError(\"There is an error when retrieving the reference genome, as multiple values have been retrieved: \"+ref_genome)\n+    except MySQLdb.Error as msg:\n+        print(msg, file=ERROR_FILE)\n+\n+def fetch_oncokb_mutation_annotations(mutation_data, ref_genome):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae885e2226d87b0b340c29e26ce245fd063e5c40"}, "originalPosition": 229}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fab7815b2c2700fa576d0af429c005884b9b762", "author": {"user": {"login": "oplantalech", "name": "Oleguer Plantalech-Casals"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/0fab7815b2c2700fa576d0af429c005884b9b762", "committedDate": "2020-12-07T10:11:20Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cabfe6244a7d2f79c81e92a89954960c38a0e5a", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/4cabfe6244a7d2f79c81e92a89954960c38a0e5a", "committedDate": "2020-12-30T10:44:43Z", "message": "Fix regex match for mutation stop position"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "430c24b4bc26836c9f6becc765a9286a90f63b95", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/430c24b4bc26836c9f6becc765a9286a90f63b95", "committedDate": "2020-12-30T10:50:11Z", "message": "Allow empty cells in 'HGVSp_Short' column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6af6168a661f18122d5788c73166e5bf5dbfb0a8", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6af6168a661f18122d5788c73166e5bf5dbfb0a8", "committedDate": "2020-12-30T10:58:09Z", "message": "Fix HUGO symbol not found in portal dump"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dcc43a74a99d943f70da25f9e135e85fa466e50", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/3dcc43a74a99d943f70da25f9e135e85fa466e50", "committedDate": "2021-01-07T07:42:08Z", "message": "Fix duplicate sample/entrez_gene_id entries in CNA annotations file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee2879ae1200f2f1641e341d8e63bcc9d369dbbe", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ee2879ae1200f2f1641e341d8e63bcc9d369dbbe", "committedDate": "2021-01-07T08:03:47Z", "message": "Rename method name\n\nPR feedback Hongxin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "922cfe6635bce58cb0d7ba59e43c2dc7a60807d0", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/922cfe6635bce58cb0d7ba59e43c2dc7a60807d0", "committedDate": "2021-01-07T09:59:55Z", "message": "Create convenience method for retrieving header cells\n\nPR feedback Hongxin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e78378df70ccaef50924a535406666269250f70", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/3e78378df70ccaef50924a535406666269250f70", "committedDate": "2021-01-07T10:37:58Z", "message": "Rename feature to cna_event and mutation_event\n\nPR feedback Hongxin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e9d63c9e0948b76467e9da90760c08d9f9d5f12", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/5e9d63c9e0948b76467e9da90760c08d9f9d5f12", "committedDate": "2021-01-07T11:48:23Z", "message": "Correct evaluation of no CNA event\n\nPR feedback Hongxin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fe2418de386b939f87516a3cec3449ae848f1b0", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/0fe2418de386b939f87516a3cec3449ae848f1b0", "committedDate": "2021-01-07T12:18:16Z", "message": "Make better use of multi-line comments\n\nPR feedback Hongxin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bcf37fbdada5c1d04603370381950b1c9e8b0f3", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/8bcf37fbdada5c1d04603370381950b1c9e8b0f3", "committedDate": "2021-01-07T12:18:46Z", "message": "Move hard-coded strings to constants\n\nPR feedback Hongxin"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "621649525051d89c9d95b57f536e687892cbb59e", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/621649525051d89c9d95b57f536e687892cbb59e", "committedDate": "2020-12-30T14:15:43Z", "message": "Fix duplicate sample/entrez_gene_id entries in CNA annotations file"}, "afterCommit": {"oid": "8bcf37fbdada5c1d04603370381950b1c9e8b0f3", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/8bcf37fbdada5c1d04603370381950b1c9e8b0f3", "committedDate": "2021-01-07T12:18:46Z", "message": "Move hard-coded strings to constants\n\nPR feedback Hongxin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a826758edc44831b6ce1118bc45fa8df156de606", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/a826758edc44831b6ce1118bc45fa8df156de606", "committedDate": "2021-01-09T08:57:23Z", "message": "Move interface() to libImportOncokb.py\n\nPR feedback Hongxin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1bfbbbb4b8bd2a0333ca342334bda6173a5af8a", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c1bfbbbb4b8bd2a0333ca342334bda6173a5af8a", "committedDate": "2021-01-11T11:41:44Z", "message": "Import tiers from OncoKB annotation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcxNDUyNDMw", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#pullrequestreview-571452430", "createdAt": "2021-01-19T16:58:38Z", "commit": {"oid": "a826758edc44831b6ce1118bc45fa8df156de606"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTczMzY1NDY1", "url": "https://github.com/cBioPortal/cbioportal/pull/8090#pullrequestreview-573365465", "createdAt": "2021-01-21T14:11:53Z", "commit": {"oid": "a826758edc44831b6ce1118bc45fa8df156de606"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33d21e522adadf8ee67e897dd7e93b2b095f7c3b", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/33d21e522adadf8ee67e897dd7e93b2b095f7c3b", "committedDate": "2021-01-27T09:02:30Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "51b09266dc889f21d137f0e34ddc9bfe888c1e50", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/51b09266dc889f21d137f0e34ddc9bfe888c1e50", "committedDate": "2021-01-27T09:31:20Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "51b09266dc889f21d137f0e34ddc9bfe888c1e50", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/51b09266dc889f21d137f0e34ddc9bfe888c1e50", "committedDate": "2021-01-27T09:31:20Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "cfae3aef78924d566d8b1a7328c67bf7dc19e395", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/cfae3aef78924d566d8b1a7328c67bf7dc19e395", "committedDate": "2021-01-27T09:33:08Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cfae3aef78924d566d8b1a7328c67bf7dc19e395", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/cfae3aef78924d566d8b1a7328c67bf7dc19e395", "committedDate": "2021-01-27T09:33:08Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "3c4342755d8f006df730b081e97bc3d0414f54c0", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/3c4342755d8f006df730b081e97bc3d0414f54c0", "committedDate": "2021-01-27T09:34:18Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c4342755d8f006df730b081e97bc3d0414f54c0", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/3c4342755d8f006df730b081e97bc3d0414f54c0", "committedDate": "2021-01-27T09:34:18Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "7da32873d7ef95e719abc0894374c9f66f382988", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/7da32873d7ef95e719abc0894374c9f66f382988", "committedDate": "2021-01-27T09:36:13Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f5907b07f2c0a7d2d9a63542c55b0f09a341ca24", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/f5907b07f2c0a7d2d9a63542c55b0f09a341ca24", "committedDate": "2021-01-27T09:37:53Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "b684f70fb211058fbe960cb9317e51977c431304", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/b684f70fb211058fbe960cb9317e51977c431304", "committedDate": "2021-01-27T09:40:00Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b684f70fb211058fbe960cb9317e51977c431304", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/b684f70fb211058fbe960cb9317e51977c431304", "committedDate": "2021-01-27T09:40:00Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "292ece396a45faaf34f71d59031e853eda498eed", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/292ece396a45faaf34f71d59031e853eda498eed", "committedDate": "2021-01-27T09:40:53Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "292ece396a45faaf34f71d59031e853eda498eed", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/292ece396a45faaf34f71d59031e853eda498eed", "committedDate": "2021-01-27T09:40:53Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "6311974ed72c8bacb8bfe5b046ad61edb3c5dfa9", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6311974ed72c8bacb8bfe5b046ad61edb3c5dfa9", "committedDate": "2021-01-27T12:18:22Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6311974ed72c8bacb8bfe5b046ad61edb3c5dfa9", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6311974ed72c8bacb8bfe5b046ad61edb3c5dfa9", "committedDate": "2021-01-27T12:18:22Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "ec17729e7d06af354c74ccaee9195f60c7b8506c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ec17729e7d06af354c74ccaee9195f60c7b8506c", "committedDate": "2021-01-27T12:21:35Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec17729e7d06af354c74ccaee9195f60c7b8506c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ec17729e7d06af354c74ccaee9195f60c7b8506c", "committedDate": "2021-01-27T12:21:35Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "45656f2a35f839429d573c9ba10a6c8f241b5495", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/45656f2a35f839429d573c9ba10a6c8f241b5495", "committedDate": "2021-01-27T12:33:57Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "45656f2a35f839429d573c9ba10a6c8f241b5495", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/45656f2a35f839429d573c9ba10a6c8f241b5495", "committedDate": "2021-01-27T12:33:57Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "679d6cf43c6ccf4d86bb57f4440246c7791af49e", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/679d6cf43c6ccf4d86bb57f4440246c7791af49e", "committedDate": "2021-01-27T12:36:30Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "679d6cf43c6ccf4d86bb57f4440246c7791af49e", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/679d6cf43c6ccf4d86bb57f4440246c7791af49e", "committedDate": "2021-01-27T12:36:30Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "4548b1897dc0195aeb3febf41d38044a3d94a14f", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/4548b1897dc0195aeb3febf41d38044a3d94a14f", "committedDate": "2021-01-27T12:37:27Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4548b1897dc0195aeb3febf41d38044a3d94a14f", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/4548b1897dc0195aeb3febf41d38044a3d94a14f", "committedDate": "2021-01-27T12:37:27Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "986fc65485c8dc02889814f2ee320bc7f913688d", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/986fc65485c8dc02889814f2ee320bc7f913688d", "committedDate": "2021-01-27T12:38:38Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "986fc65485c8dc02889814f2ee320bc7f913688d", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/986fc65485c8dc02889814f2ee320bc7f913688d", "committedDate": "2021-01-27T12:38:38Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "49992294aed64cb69c7943448e296823880a5419", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/49992294aed64cb69c7943448e296823880a5419", "committedDate": "2021-01-27T12:48:18Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "49992294aed64cb69c7943448e296823880a5419", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/49992294aed64cb69c7943448e296823880a5419", "committedDate": "2021-01-27T12:48:18Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "98e1ba34737fe13f6a1f6e75b5391302f44ec305", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/98e1ba34737fe13f6a1f6e75b5391302f44ec305", "committedDate": "2021-01-27T12:58:24Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98e1ba34737fe13f6a1f6e75b5391302f44ec305", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/98e1ba34737fe13f6a1f6e75b5391302f44ec305", "committedDate": "2021-01-27T12:58:24Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "c11f55884c5bc73948919c0a16f59d4301704c71", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c11f55884c5bc73948919c0a16f59d4301704c71", "committedDate": "2021-01-27T13:11:53Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c11f55884c5bc73948919c0a16f59d4301704c71", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c11f55884c5bc73948919c0a16f59d4301704c71", "committedDate": "2021-01-27T13:11:53Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "e4116b76dc48d2d8b6d12752f4e18c62cc352374", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/e4116b76dc48d2d8b6d12752f4e18c62cc352374", "committedDate": "2021-01-27T13:15:11Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4116b76dc48d2d8b6d12752f4e18c62cc352374", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/e4116b76dc48d2d8b6d12752f4e18c62cc352374", "committedDate": "2021-01-27T13:15:11Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "8932fd0de032b2ee9f631c429d95a25685b1c8e3", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/8932fd0de032b2ee9f631c429d95a25685b1c8e3", "committedDate": "2021-01-27T13:18:19Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8932fd0de032b2ee9f631c429d95a25685b1c8e3", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/8932fd0de032b2ee9f631c429d95a25685b1c8e3", "committedDate": "2021-01-27T13:18:19Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "31e5f56183abc66804d16c9595ba44092e53baeb", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/31e5f56183abc66804d16c9595ba44092e53baeb", "committedDate": "2021-01-27T13:18:52Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31e5f56183abc66804d16c9595ba44092e53baeb", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/31e5f56183abc66804d16c9595ba44092e53baeb", "committedDate": "2021-01-27T13:18:52Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "53acea94d3de3e00b38304eb6d48845fdf338f15", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/53acea94d3de3e00b38304eb6d48845fdf338f15", "committedDate": "2021-01-27T13:37:50Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53acea94d3de3e00b38304eb6d48845fdf338f15", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/53acea94d3de3e00b38304eb6d48845fdf338f15", "committedDate": "2021-01-27T13:37:50Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "0969a00b9ae456a61062bee1ed24adb683ec479a", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/0969a00b9ae456a61062bee1ed24adb683ec479a", "committedDate": "2021-01-27T13:41:33Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0969a00b9ae456a61062bee1ed24adb683ec479a", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/0969a00b9ae456a61062bee1ed24adb683ec479a", "committedDate": "2021-01-27T13:41:33Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "c01e107e68c07ff65f1ff4d9428d75191aea02fe", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c01e107e68c07ff65f1ff4d9428d75191aea02fe", "committedDate": "2021-01-27T15:01:10Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c01e107e68c07ff65f1ff4d9428d75191aea02fe", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c01e107e68c07ff65f1ff4d9428d75191aea02fe", "committedDate": "2021-01-27T15:01:10Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "f3fa803f0d651505a0d0cef25fd9c7c44a754e5b", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/f3fa803f0d651505a0d0cef25fd9c7c44a754e5b", "committedDate": "2021-01-27T15:05:58Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3fa803f0d651505a0d0cef25fd9c7c44a754e5b", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/f3fa803f0d651505a0d0cef25fd9c7c44a754e5b", "committedDate": "2021-01-27T15:05:58Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "bd213c047be13854b902c0ca2603c2467ad34f29", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/bd213c047be13854b902c0ca2603c2467ad34f29", "committedDate": "2021-01-27T15:06:50Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bd213c047be13854b902c0ca2603c2467ad34f29", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/bd213c047be13854b902c0ca2603c2467ad34f29", "committedDate": "2021-01-27T15:06:50Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "dc8bbb7e4dba9b314a8bb19b5ef9222363296476", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/dc8bbb7e4dba9b314a8bb19b5ef9222363296476", "committedDate": "2021-01-27T15:14:42Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc8bbb7e4dba9b314a8bb19b5ef9222363296476", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/dc8bbb7e4dba9b314a8bb19b5ef9222363296476", "committedDate": "2021-01-27T15:14:42Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "709c15d377fb9afe43ee577cd17474341d2b81e8", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/709c15d377fb9afe43ee577cd17474341d2b81e8", "committedDate": "2021-01-27T15:15:36Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "709c15d377fb9afe43ee577cd17474341d2b81e8", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/709c15d377fb9afe43ee577cd17474341d2b81e8", "committedDate": "2021-01-27T15:15:36Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "84ca45b7ab74231f5932e00acf0443cccacfda9c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/84ca45b7ab74231f5932e00acf0443cccacfda9c", "committedDate": "2021-01-27T15:17:55Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84ca45b7ab74231f5932e00acf0443cccacfda9c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/84ca45b7ab74231f5932e00acf0443cccacfda9c", "committedDate": "2021-01-27T15:17:55Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "c9d88149677a84815c3b1a895763171f531138a9", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c9d88149677a84815c3b1a895763171f531138a9", "committedDate": "2021-01-27T15:19:34Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9d88149677a84815c3b1a895763171f531138a9", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c9d88149677a84815c3b1a895763171f531138a9", "committedDate": "2021-01-27T15:19:34Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "fb37e2d8c68115a285edd8fe1a4df5f9474d43d2", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/fb37e2d8c68115a285edd8fe1a4df5f9474d43d2", "committedDate": "2021-01-27T15:20:30Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb37e2d8c68115a285edd8fe1a4df5f9474d43d2", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/fb37e2d8c68115a285edd8fe1a4df5f9474d43d2", "committedDate": "2021-01-27T15:20:30Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "098998eed4a00ad676017c304e76876469f1747c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/098998eed4a00ad676017c304e76876469f1747c", "committedDate": "2021-01-27T15:21:56Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "098998eed4a00ad676017c304e76876469f1747c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/098998eed4a00ad676017c304e76876469f1747c", "committedDate": "2021-01-27T15:21:56Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "7c585a9bec37df3cfad2d233f3c1d25d7a34d6a8", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/7c585a9bec37df3cfad2d233f3c1d25d7a34d6a8", "committedDate": "2021-01-27T15:25:43Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c585a9bec37df3cfad2d233f3c1d25d7a34d6a8", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/7c585a9bec37df3cfad2d233f3c1d25d7a34d6a8", "committedDate": "2021-01-27T15:25:43Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "389669fa6dc8c1fd86b7f1d8fc38442b101464a2", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/389669fa6dc8c1fd86b7f1d8fc38442b101464a2", "committedDate": "2021-01-27T15:27:23Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "389669fa6dc8c1fd86b7f1d8fc38442b101464a2", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/389669fa6dc8c1fd86b7f1d8fc38442b101464a2", "committedDate": "2021-01-27T15:27:23Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "8fe5f5c78453b618bf8ef284d8003d49114d1f37", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/8fe5f5c78453b618bf8ef284d8003d49114d1f37", "committedDate": "2021-01-27T15:28:52Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8fe5f5c78453b618bf8ef284d8003d49114d1f37", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/8fe5f5c78453b618bf8ef284d8003d49114d1f37", "committedDate": "2021-01-27T15:28:52Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "521eb34ee6ab6aeadb634abea9da8790a648df87", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/521eb34ee6ab6aeadb634abea9da8790a648df87", "committedDate": "2021-01-27T15:31:38Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "521eb34ee6ab6aeadb634abea9da8790a648df87", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/521eb34ee6ab6aeadb634abea9da8790a648df87", "committedDate": "2021-01-27T15:31:38Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "ea9db362ed8083cf929d8018fba6ccb9f34fe092", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ea9db362ed8083cf929d8018fba6ccb9f34fe092", "committedDate": "2021-01-27T15:33:00Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea9db362ed8083cf929d8018fba6ccb9f34fe092", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ea9db362ed8083cf929d8018fba6ccb9f34fe092", "committedDate": "2021-01-27T15:33:00Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "e497161c723d0654796fdba3cef9ba154542c8a3", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/e497161c723d0654796fdba3cef9ba154542c8a3", "committedDate": "2021-01-27T15:43:41Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e497161c723d0654796fdba3cef9ba154542c8a3", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/e497161c723d0654796fdba3cef9ba154542c8a3", "committedDate": "2021-01-27T15:43:41Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "89301271799b6ce13012f3c60c161ba37ab3058c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/89301271799b6ce13012f3c60c161ba37ab3058c", "committedDate": "2021-01-27T15:46:44Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89301271799b6ce13012f3c60c161ba37ab3058c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/89301271799b6ce13012f3c60c161ba37ab3058c", "committedDate": "2021-01-27T15:46:44Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "26d057e46c946002fd4d93242e8648012e46695e", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/26d057e46c946002fd4d93242e8648012e46695e", "committedDate": "2021-01-27T16:00:21Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26d057e46c946002fd4d93242e8648012e46695e", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/26d057e46c946002fd4d93242e8648012e46695e", "committedDate": "2021-01-27T16:00:21Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "58c2ef49aaeb37619b685b872343cb068b2b263c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/58c2ef49aaeb37619b685b872343cb068b2b263c", "committedDate": "2021-01-27T16:06:32Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "58c2ef49aaeb37619b685b872343cb068b2b263c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/58c2ef49aaeb37619b685b872343cb068b2b263c", "committedDate": "2021-01-27T16:06:32Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "48f8cd4081a50527b30e6378714859fd78c18995", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/48f8cd4081a50527b30e6378714859fd78c18995", "committedDate": "2021-01-27T16:10:13Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48f8cd4081a50527b30e6378714859fd78c18995", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/48f8cd4081a50527b30e6378714859fd78c18995", "committedDate": "2021-01-27T16:10:13Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "df2a208b4ea8b66ba38677e87bcd35ad36ad539f", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/df2a208b4ea8b66ba38677e87bcd35ad36ad539f", "committedDate": "2021-01-27T16:42:01Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df2a208b4ea8b66ba38677e87bcd35ad36ad539f", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/df2a208b4ea8b66ba38677e87bcd35ad36ad539f", "committedDate": "2021-01-27T16:42:01Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "6c17e0d501e84aa5706d7465194d88ac536b0fae", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6c17e0d501e84aa5706d7465194d88ac536b0fae", "committedDate": "2021-01-27T16:53:43Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c17e0d501e84aa5706d7465194d88ac536b0fae", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6c17e0d501e84aa5706d7465194d88ac536b0fae", "committedDate": "2021-01-27T16:53:43Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "70bbcae9e09406dff11f3c056122bc16a98c4715", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/70bbcae9e09406dff11f3c056122bc16a98c4715", "committedDate": "2021-01-28T05:22:30Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70bbcae9e09406dff11f3c056122bc16a98c4715", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/70bbcae9e09406dff11f3c056122bc16a98c4715", "committedDate": "2021-01-28T05:22:30Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "8d2248b3825489438e03249ba09498ca530eae48", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/8d2248b3825489438e03249ba09498ca530eae48", "committedDate": "2021-01-28T05:24:32Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d2248b3825489438e03249ba09498ca530eae48", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/8d2248b3825489438e03249ba09498ca530eae48", "committedDate": "2021-01-28T05:24:32Z", "message": "Add GitHub action for integration tests"}, "afterCommit": {"oid": "02363de9af8e0624fb40d01669c29dfad3d60073", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/02363de9af8e0624fb40d01669c29dfad3d60073", "committedDate": "2021-01-28T05:25:08Z", "message": "Add GitHub action for integration tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "64bbc4b88b0f8f911870252a6d22900daae52625", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/64bbc4b88b0f8f911870252a6d22900daae52625", "committedDate": "2021-01-28T05:27:35Z", "message": "change name"}, "afterCommit": {"oid": "faa982fec306d018837eb5563f57493331a5f037", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/faa982fec306d018837eb5563f57493331a5f037", "committedDate": "2021-01-28T06:21:40Z", "message": "change name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "faa982fec306d018837eb5563f57493331a5f037", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/faa982fec306d018837eb5563f57493331a5f037", "committedDate": "2021-01-28T06:21:40Z", "message": "change name"}, "afterCommit": {"oid": "c32647fd4f53c562bc4c687f26173f1db7bbacc9", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c32647fd4f53c562bc4c687f26173f1db7bbacc9", "committedDate": "2021-01-28T06:31:36Z", "message": "change name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ed4b74a5d16996a0387a66647a7db03a001842c", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6ed4b74a5d16996a0387a66647a7db03a001842c", "committedDate": "2021-01-28T06:33:32Z", "message": "change name 2"}, "afterCommit": {"oid": "96bc1744002ab68c312722119be85e1c3ea24e64", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/96bc1744002ab68c312722119be85e1c3ea24e64", "committedDate": "2021-01-28T06:45:24Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96bc1744002ab68c312722119be85e1c3ea24e64", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/96bc1744002ab68c312722119be85e1c3ea24e64", "committedDate": "2021-01-28T06:45:24Z", "message": "change name 2"}, "afterCommit": {"oid": "21a5f6ff593089128f9a4778c859586acd664adc", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/21a5f6ff593089128f9a4778c859586acd664adc", "committedDate": "2021-01-28T06:49:42Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21a5f6ff593089128f9a4778c859586acd664adc", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/21a5f6ff593089128f9a4778c859586acd664adc", "committedDate": "2021-01-28T06:49:42Z", "message": "change name 2"}, "afterCommit": {"oid": "a35532d114ad64f1445e8e22f1bb17129465b598", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/a35532d114ad64f1445e8e22f1bb17129465b598", "committedDate": "2021-01-28T06:57:44Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a35532d114ad64f1445e8e22f1bb17129465b598", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/a35532d114ad64f1445e8e22f1bb17129465b598", "committedDate": "2021-01-28T06:57:44Z", "message": "change name 2"}, "afterCommit": {"oid": "aeae5931306768adbd2c2ab1b45d9f7388ae8389", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/aeae5931306768adbd2c2ab1b45d9f7388ae8389", "committedDate": "2021-01-28T06:59:16Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aeae5931306768adbd2c2ab1b45d9f7388ae8389", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/aeae5931306768adbd2c2ab1b45d9f7388ae8389", "committedDate": "2021-01-28T06:59:16Z", "message": "change name 2"}, "afterCommit": {"oid": "da1a9624d8d8ba03a704801f6effe51642f5a531", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/da1a9624d8d8ba03a704801f6effe51642f5a531", "committedDate": "2021-01-28T07:05:26Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da1a9624d8d8ba03a704801f6effe51642f5a531", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/da1a9624d8d8ba03a704801f6effe51642f5a531", "committedDate": "2021-01-28T07:05:26Z", "message": "change name 2"}, "afterCommit": {"oid": "00402b4895d97a41f77d636b4a9dc0412e281ce8", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/00402b4895d97a41f77d636b4a9dc0412e281ce8", "committedDate": "2021-01-28T07:06:26Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "00402b4895d97a41f77d636b4a9dc0412e281ce8", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/00402b4895d97a41f77d636b4a9dc0412e281ce8", "committedDate": "2021-01-28T07:06:26Z", "message": "change name 2"}, "afterCommit": {"oid": "618a6ea77a21ae4c021e0b6760d2b1e2c13e2d65", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/618a6ea77a21ae4c021e0b6760d2b1e2c13e2d65", "committedDate": "2021-01-28T07:35:31Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "618a6ea77a21ae4c021e0b6760d2b1e2c13e2d65", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/618a6ea77a21ae4c021e0b6760d2b1e2c13e2d65", "committedDate": "2021-01-28T07:35:31Z", "message": "change name 2"}, "afterCommit": {"oid": "6e4328a33eb59c23d49a8ec08b94d51fbe5fd5d5", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6e4328a33eb59c23d49a8ec08b94d51fbe5fd5d5", "committedDate": "2021-01-28T07:36:39Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e4328a33eb59c23d49a8ec08b94d51fbe5fd5d5", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6e4328a33eb59c23d49a8ec08b94d51fbe5fd5d5", "committedDate": "2021-01-28T07:36:39Z", "message": "change name 2"}, "afterCommit": {"oid": "7729e8d6d7d5100f0b0bcfac30972b57e0ef45de", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/7729e8d6d7d5100f0b0bcfac30972b57e0ef45de", "committedDate": "2021-01-28T07:38:46Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7729e8d6d7d5100f0b0bcfac30972b57e0ef45de", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/7729e8d6d7d5100f0b0bcfac30972b57e0ef45de", "committedDate": "2021-01-28T07:38:46Z", "message": "change name 2"}, "afterCommit": {"oid": "84df341ca8fd1f8545f804baf6f3e1815e4e6f80", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/84df341ca8fd1f8545f804baf6f3e1815e4e6f80", "committedDate": "2021-01-28T07:41:23Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84df341ca8fd1f8545f804baf6f3e1815e4e6f80", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/84df341ca8fd1f8545f804baf6f3e1815e4e6f80", "committedDate": "2021-01-28T07:41:23Z", "message": "change name 2"}, "afterCommit": {"oid": "119c9c8edc857009c7a43d632fc8107650db8329", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/119c9c8edc857009c7a43d632fc8107650db8329", "committedDate": "2021-01-28T07:43:42Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "027d597e7467ad9e75c5788f99c26afd57f5e4d0", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/027d597e7467ad9e75c5788f99c26afd57f5e4d0", "committedDate": "2021-01-28T07:45:49Z", "message": "change name 2"}, "afterCommit": {"oid": "ec0f4803ed2a254e3042b3826873737664746ff0", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ec0f4803ed2a254e3042b3826873737664746ff0", "committedDate": "2021-01-28T07:48:04Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec0f4803ed2a254e3042b3826873737664746ff0", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ec0f4803ed2a254e3042b3826873737664746ff0", "committedDate": "2021-01-28T07:48:04Z", "message": "change name 2"}, "afterCommit": {"oid": "0acfe818b2c59d637559ba5a4bb05ea6081b36c4", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/0acfe818b2c59d637559ba5a4bb05ea6081b36c4", "committedDate": "2021-01-28T07:59:58Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0acfe818b2c59d637559ba5a4bb05ea6081b36c4", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/0acfe818b2c59d637559ba5a4bb05ea6081b36c4", "committedDate": "2021-01-28T07:59:58Z", "message": "change name 2"}, "afterCommit": {"oid": "295883e18abd978167f774992fd412746b2de8e7", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/295883e18abd978167f774992fd412746b2de8e7", "committedDate": "2021-01-28T08:03:52Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "295883e18abd978167f774992fd412746b2de8e7", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/295883e18abd978167f774992fd412746b2de8e7", "committedDate": "2021-01-28T08:03:52Z", "message": "change name 2"}, "afterCommit": {"oid": "1b0f51bd498cf39a4847bdfbb51296d90b744306", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/1b0f51bd498cf39a4847bdfbb51296d90b744306", "committedDate": "2021-01-28T08:06:20Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b0f51bd498cf39a4847bdfbb51296d90b744306", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/1b0f51bd498cf39a4847bdfbb51296d90b744306", "committedDate": "2021-01-28T08:06:20Z", "message": "change name 2"}, "afterCommit": {"oid": "660ea9436909d654a939f0f9ba3b6f04effc227e", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/660ea9436909d654a939f0f9ba3b6f04effc227e", "committedDate": "2021-01-28T08:07:50Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "660ea9436909d654a939f0f9ba3b6f04effc227e", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/660ea9436909d654a939f0f9ba3b6f04effc227e", "committedDate": "2021-01-28T08:07:50Z", "message": "change name 2"}, "afterCommit": {"oid": "491370f87ced1d0b68d931c31190badfd45e228d", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/491370f87ced1d0b68d931c31190badfd45e228d", "committedDate": "2021-01-28T08:09:46Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "491370f87ced1d0b68d931c31190badfd45e228d", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/491370f87ced1d0b68d931c31190badfd45e228d", "committedDate": "2021-01-28T08:09:46Z", "message": "change name 2"}, "afterCommit": {"oid": "140a33770505dcf548885c6661fa4402f72b7747", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/140a33770505dcf548885c6661fa4402f72b7747", "committedDate": "2021-01-28T08:12:26Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "140a33770505dcf548885c6661fa4402f72b7747", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/140a33770505dcf548885c6661fa4402f72b7747", "committedDate": "2021-01-28T08:12:26Z", "message": "change name 2"}, "afterCommit": {"oid": "21769776f87d66b3d79c80971b2e40f2a207d95d", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/21769776f87d66b3d79c80971b2e40f2a207d95d", "committedDate": "2021-01-28T08:13:24Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21769776f87d66b3d79c80971b2e40f2a207d95d", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/21769776f87d66b3d79c80971b2e40f2a207d95d", "committedDate": "2021-01-28T08:13:24Z", "message": "change name 2"}, "afterCommit": {"oid": "5e08102cc0d3bad3b4273614265924d9a15e3888", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/5e08102cc0d3bad3b4273614265924d9a15e3888", "committedDate": "2021-01-28T08:15:23Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e08102cc0d3bad3b4273614265924d9a15e3888", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/5e08102cc0d3bad3b4273614265924d9a15e3888", "committedDate": "2021-01-28T08:15:23Z", "message": "change name 2"}, "afterCommit": {"oid": "132359e9ee611313c8e98879bf2342cbcea5b1ef", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/132359e9ee611313c8e98879bf2342cbcea5b1ef", "committedDate": "2021-01-28T08:27:13Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "132359e9ee611313c8e98879bf2342cbcea5b1ef", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/132359e9ee611313c8e98879bf2342cbcea5b1ef", "committedDate": "2021-01-28T08:27:13Z", "message": "change name 2"}, "afterCommit": {"oid": "c285fa1e04e4fac6dbfc40803018336dcd4000e7", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c285fa1e04e4fac6dbfc40803018336dcd4000e7", "committedDate": "2021-01-28T08:28:00Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c285fa1e04e4fac6dbfc40803018336dcd4000e7", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c285fa1e04e4fac6dbfc40803018336dcd4000e7", "committedDate": "2021-01-28T08:28:00Z", "message": "change name 2"}, "afterCommit": {"oid": "e6edf64164136da6f274722093fe39026fc1cb72", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/e6edf64164136da6f274722093fe39026fc1cb72", "committedDate": "2021-01-28T08:44:00Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e6edf64164136da6f274722093fe39026fc1cb72", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/e6edf64164136da6f274722093fe39026fc1cb72", "committedDate": "2021-01-28T08:44:00Z", "message": "change name 2"}, "afterCommit": {"oid": "625b71ae6c073165a44e5e7cae3d92227c3fd9dc", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/625b71ae6c073165a44e5e7cae3d92227c3fd9dc", "committedDate": "2021-01-28T08:45:33Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "625b71ae6c073165a44e5e7cae3d92227c3fd9dc", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/625b71ae6c073165a44e5e7cae3d92227c3fd9dc", "committedDate": "2021-01-28T08:45:33Z", "message": "change name 2"}, "afterCommit": {"oid": "02df0ed9dc22d8676c26db67d5bdf66a5ed82be6", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/02df0ed9dc22d8676c26db67d5bdf66a5ed82be6", "committedDate": "2021-01-28T08:47:10Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "02df0ed9dc22d8676c26db67d5bdf66a5ed82be6", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/02df0ed9dc22d8676c26db67d5bdf66a5ed82be6", "committedDate": "2021-01-28T08:47:10Z", "message": "change name 2"}, "afterCommit": {"oid": "c49b7afc0011864242fe4f5d59ea4e9f40d0427d", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c49b7afc0011864242fe4f5d59ea4e9f40d0427d", "committedDate": "2021-01-28T08:48:35Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c49b7afc0011864242fe4f5d59ea4e9f40d0427d", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c49b7afc0011864242fe4f5d59ea4e9f40d0427d", "committedDate": "2021-01-28T08:48:35Z", "message": "change name 2"}, "afterCommit": {"oid": "307299ee08d2e399fac9132cdc9c48ba9799eccf", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/307299ee08d2e399fac9132cdc9c48ba9799eccf", "committedDate": "2021-01-28T08:55:38Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "307299ee08d2e399fac9132cdc9c48ba9799eccf", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/307299ee08d2e399fac9132cdc9c48ba9799eccf", "committedDate": "2021-01-28T08:55:38Z", "message": "change name 2"}, "afterCommit": {"oid": "ad1239107c2ff90600b1b432e3452a7837f485b0", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ad1239107c2ff90600b1b432e3452a7837f485b0", "committedDate": "2021-01-28T09:01:21Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad1239107c2ff90600b1b432e3452a7837f485b0", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ad1239107c2ff90600b1b432e3452a7837f485b0", "committedDate": "2021-01-28T09:01:21Z", "message": "change name 2"}, "afterCommit": {"oid": "647b52580afddc3f255c159f579ae2e19b971783", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/647b52580afddc3f255c159f579ae2e19b971783", "committedDate": "2021-01-28T09:21:11Z", "message": "change name 2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "647b52580afddc3f255c159f579ae2e19b971783", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/647b52580afddc3f255c159f579ae2e19b971783", "committedDate": "2021-01-28T09:21:11Z", "message": "change name 2"}, "afterCommit": {"oid": "d3cd30e4923bab7669f2b0933c9fbdcdd6e81d69", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/d3cd30e4923bab7669f2b0933c9fbdcdd6e81d69", "committedDate": "2021-01-28T09:38:34Z", "message": "change name 2"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1589, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}