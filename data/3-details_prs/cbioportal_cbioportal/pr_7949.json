{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NDU3MjQy", "number": 7949, "title": "Update keycloak auth docs to specify how to get jwtRolesPath", "bodyText": "Had some issues when deploying GENIE with oauth2 DAT method.\nEnded up realizing it was an issue with jwtRolesPath. Thought it would help to have clearer docs explaining how to get the path out of the JWT.\nChecks\n\n Runs on heroku\n Has tests or has a separate issue that describes the types of test that should be created. If no test is included it should explicitly be mentioned in the PR why there is no test.\n The commit log is comprehensible. It follows 7 rules of great commit messages. For most PRs a single commit should suffice, in some cases multiple topical commits can be useful. During review it is ok to see tiny commits (e.g. Fix reviewer comments), but right before the code gets merged to master or rc branch, any such commits should be squashed since they are useless to the other developers. Definitely avoid merge commits, use rebase instead.\n Is this PR adding logic based on one or more clinical attributes? If yes, please make sure validation for this attribute is also present in the data validation / data loading layers (in backend repo) and documented in File-Formats Clinical data section!\n\nAny screenshots or GIFs?\nIf this is a new visual feature please add a before/after screenshot or gif\nhere with e.g. Giphy CAPTURE or Peek\nNotify reviewers\nRead our Pull request merging\npolicy. It can help to figure out who worked on the\nfile before you. Please use git blame <filename> to determine that\nand notify them either through slack or by assigning them as a reviewer on the PR", "createdAt": "2020-10-07T19:05:20Z", "url": "https://github.com/cBioPortal/cbioportal/pull/7949", "merged": true, "mergeCommit": {"oid": "38ed10eec0fdd9fbf9d2303e6b81121c7bbc0e72"}, "closed": true, "closedAt": "2020-12-15T14:35:00Z", "author": {"login": "averyniceday"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQb2cwAFqTUwNDQ3MTUzOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSsqNeAFqTUwOTA5MTY2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NDcxNTM5", "url": "https://github.com/cBioPortal/cbioportal/pull/7949#pullrequestreview-504471539", "createdAt": "2020-10-08T06:46:56Z", "commit": {"oid": "9832d7e83ac1b2b3a8b6369c52b592110134a3ab"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da60b2b218007d124e0782507fe86601e29e41fb", "author": {"user": {"login": "averyniceday", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/da60b2b218007d124e0782507fe86601e29e41fb", "committedDate": "2020-10-13T17:58:42Z", "message": "Update Authenticating-and-Authorizing-Users-via-keycloak.md"}, "afterCommit": {"oid": "a4036405897c6af5edddcd7b7373ef9fd800191d", "author": {"user": {"login": "averyniceday", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/a4036405897c6af5edddcd7b7373ef9fd800191d", "committedDate": "2020-10-13T17:59:48Z", "message": "Update keycloak auth docs to specify how to get jwtRolesPath"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MDMxNjI0", "url": "https://github.com/cBioPortal/cbioportal/pull/7949#pullrequestreview-508031624", "createdAt": "2020-10-14T06:32:13Z", "commit": {"oid": "a4036405897c6af5edddcd7b7373ef9fd800191d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwNjozMjoxM1rOHhEHMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwNjozMjoxM1rOHhEHMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQzMjQzMw==", "bodyText": "The trigger for looking at this section should not be a 4xx error. I propose to remove this line and replace it for something like this:\n\nBy default user-roles are extracted from path resource_access::cbioportal::roles in the JWT json. When the configuration of roles at the realm and client level in a Keycloak instance differ from that described in this manual, configure the path can be specified using the dat.oauth2.jwtRolesPath property in the portal.properties file.", "url": "https://github.com/cBioPortal/cbioportal/pull/7949#discussion_r504432433", "createdAt": "2020-10-14T06:32:13Z", "author": {"login": "pvannierop"}, "path": "docs/Authenticating-and-Authorizing-Users-via-keycloak.md", "diffHunk": "@@ -357,3 +357,32 @@ log4j.logger.org.springframework.security=DEBUG\n ```\n \n Then, rebuild the WAR, redeploy, and try to authenticate again.  Your log file will then include hundreds of SAML-specific messages, even the full XML of each SAML message, and this should help you debug the error.\n+\n+#### Determining jwtRolesPath for OAuth2 Token\n+If the generated token returns a 4XX error when used, confirm that the `jwtRolesPath` property matches the roles path. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4036405897c6af5edddcd7b7373ef9fd800191d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55ee8febc1c1198c6016cca0d72bef31c37954b9", "author": {"user": {"login": "averyniceday", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/55ee8febc1c1198c6016cca0d72bef31c37954b9", "committedDate": "2020-10-14T18:14:12Z", "message": "Update keycloak auth docs to specify how to get jwtRolesPath"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e99f2a5ec1922de89ba9895cf93208a3b9e4b38", "author": {"user": {"login": "averyniceday", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/8e99f2a5ec1922de89ba9895cf93208a3b9e4b38", "committedDate": "2020-10-14T18:12:22Z", "message": "Update Authenticating-and-Authorizing-Users-via-keycloak.md"}, "afterCommit": {"oid": "55ee8febc1c1198c6016cca0d72bef31c37954b9", "author": {"user": {"login": "averyniceday", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/55ee8febc1c1198c6016cca0d72bef31c37954b9", "committedDate": "2020-10-14T18:14:12Z", "message": "Update keycloak auth docs to specify how to get jwtRolesPath"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDkxNjY1", "url": "https://github.com/cBioPortal/cbioportal/pull/7949#pullrequestreview-509091665", "createdAt": "2020-10-15T07:29:48Z", "commit": {"oid": "55ee8febc1c1198c6016cca0d72bef31c37954b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1559, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}