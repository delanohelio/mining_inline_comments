{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNjgzMDYz", "number": 7950, "title": "add integration test to load study_es_0", "bodyText": "This PR adds an integration test for the loading of study_es_0 and associated gene panels, based on a local portal dump, and using the cbioportal-docker-compose solution.\nTo ensure the local repository is used instead of the docker image, we override the war file.", "createdAt": "2020-10-09T15:57:06Z", "url": "https://github.com/cBioPortal/cbioportal/pull/7950", "merged": true, "mergeCommit": {"oid": "908d318b7b44e9f43d75544dc36018634f0bee8f"}, "closed": true, "closedAt": "2020-11-08T21:19:53Z", "author": {"login": "SRodenburg"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQ4WGngBqjM4NjA4MjI5MzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZg-JTgH2gAyNTAwNjgzMDYzOmQ1MzY5MmI2ZjRlMjlmOGI3ZDRiMzBmNGU3ZTQ0MTk3MDQ5ZDgyMDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7de13a16ff9e317c1088e9a3d94950b0e8a01ef2", "author": {"user": {"login": "SRodenburg", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/7de13a16ff9e317c1088e9a3d94950b0e8a01ef2", "committedDate": "2020-10-09T15:53:40Z", "message": "add integration test to load study_es_0"}, "afterCommit": {"oid": "6c2d5e7f97c17de328c1c4fabb14f172c44f2e79", "author": {"user": {"login": "SRodenburg", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6c2d5e7f97c17de328c1c4fabb14f172c44f2e79", "committedDate": "2020-10-09T15:58:36Z", "message": "add integration test to load study_es_0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MDkxODYy", "url": "https://github.com/cBioPortal/cbioportal/pull/7950#pullrequestreview-507091862", "createdAt": "2020-10-13T06:03:00Z", "commit": {"oid": "66a44da1e7c8b19b53e2eca264edbe8d60aec2c0"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNjowMzowMFrOHgWkZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNjoxMDowMlrOHgWt6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY4NjI0Ng==", "bodyText": "Should we not replace this with a proper wait cycle that checks ready-state?", "url": "https://github.com/cBioPortal/cbioportal/pull/7950#discussion_r503686246", "createdAt": "2020-10-13T06:03:00Z", "author": {"login": "pvannierop"}, "path": ".travis.yml", "diffHunk": "@@ -96,4 +97,21 @@ script:\n       # spot visual regression by comparing screenshots in the repo with\n       # screenshots of this portal loaded with the data from the amazon db\n       bash test/end-to-end/test_make_screenshots.sh test/end-to-end/screenshots.yml\n+      docker-compose down\n+  fi\n+- |\n+  if [[ \"${TEST}\" == integration-test-load-study ]]\n+  then\n+      # test for loading study_es_0 on a complete working instance\n+      # download compose and init\n+      git clone https://github.com/cBioPortal/cbioportal-docker-compose.git && \\\n+      cd cbioportal-docker-compose && bash init.sh\n+\n+      # creates cbioportal container with local maven build\n+      docker-compose -f docker-compose.yml -f ../test/integration/docker-compose-localbuild.yml up -d\n+\n+      sleep 60s ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66a44da1e7c8b19b53e2eca264edbe8d60aec2c0"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY4NjQ5MA==", "bodyText": "Do relative paths work. At least in v2.4 this gives problems. Or am I mistaken?", "url": "https://github.com/cBioPortal/cbioportal/pull/7950#discussion_r503686490", "createdAt": "2020-10-13T06:03:45Z", "author": {"login": "pvannierop"}, "path": "test/integration/docker-compose-localbuild.yml", "diffHunk": "@@ -0,0 +1,9 @@\n+version: '3'\n+\n+services:\n+  cbioportal:\n+    command: /bin/sh -c \"java -Xms2g -Xmx4g -Dauthenticate=noauthsessionservice -Dsession.service.url=http://cbioportal_session:5000/api/sessions/my_portal/ -jar webapp-runner.jar -AmaxHttpHeaderSize=16384 -AconnectionTimeout=20000 --enable-compression /app.war\"\n+    volumes:\n+     - ./portalinfo/:/portalinfo/\n+     - ../:/cbioportal\n+     - ../portal/target/cbioportal.war:/app.war", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66a44da1e7c8b19b53e2eca264edbe8d60aec2c0"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY4NzcwMw==", "bodyText": "I think it would be a good idea to put a remark here on what this extension does. Pointing out that this mounts the current backend in order to test it would for sure help others that come across this code.", "url": "https://github.com/cBioPortal/cbioportal/pull/7950#discussion_r503687703", "createdAt": "2020-10-13T06:07:13Z", "author": {"login": "pvannierop"}, "path": "test/integration/docker-compose-localbuild.yml", "diffHunk": "@@ -0,0 +1,9 @@\n+version: '3'\n+\n+services:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66a44da1e7c8b19b53e2eca264edbe8d60aec2c0"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY4ODY4Mw==", "bodyText": "Now, you only test the route via portaldump, isn't it? I think it is a good idea to also add the study load option that uses the server url (-u option) so that validation is against a live portal, not the dump of the portal. Or is such a test redundant?", "url": "https://github.com/cBioPortal/cbioportal/pull/7950#discussion_r503688683", "createdAt": "2020-10-13T06:10:02Z", "author": {"login": "pvannierop"}, "path": "test/integration/test_load_study.sh", "diffHunk": "@@ -0,0 +1,26 @@\n+#!/bin/bash\n+\n+# exit when any of these fails\n+set -e\n+\n+run_in_service() {\n+    service=$1\n+    shift\n+    docker-compose -f docker-compose.yml -f ../test/integration/docker-compose-localbuild.yml \\\n+        run --rm \\\n+        \"$service\" bash -c \"$@\"\n+}\n+\n+# load panels\n+run_in_service cbioportal \"cd /cbioportal/core/src/main/scripts/ && perl importGenePanel.pl --data \\\n+                          /cbioportal/core/src/test/scripts/test_data/study_es_0/data_gene_panel_testpanel1.txt\"\n+run_in_service cbioportal \"cd /cbioportal/core/src/main/scripts/ && perl importGenePanel.pl --data \\\n+                          /cbioportal/core/src/test/scripts/test_data/study_es_0/data_gene_panel_testpanel2.txt\"\n+\n+# dump portal info", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66a44da1e7c8b19b53e2eca264edbe8d60aec2c0"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "068017936ee3c9f1e7d614cd6f65bbc65dd6ba40", "author": {"user": {"login": "SRodenburg", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/068017936ee3c9f1e7d614cd6f65bbc65dd6ba40", "committedDate": "2020-10-14T10:50:54Z", "message": "fix healthy test"}, "afterCommit": {"oid": "bfaa94e2e33f5f3d81924f9a8bc9037b498aea6e", "author": {"user": {"login": "SRodenburg", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/bfaa94e2e33f5f3d81924f9a8bc9037b498aea6e", "committedDate": "2020-10-14T11:23:06Z", "message": "add integration test to load study_es_0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40b3d5f94a4fd38def1a2d0283e95bac82fe3679", "author": {"user": {"login": "SRodenburg", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/40b3d5f94a4fd38def1a2d0283e95bac82fe3679", "committedDate": "2020-10-15T15:55:48Z", "message": "add integration test to load study_es_0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "715765d96b3addfbf2481cc2cdb4f5f064c87692", "author": {"user": {"login": "SRodenburg", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/715765d96b3addfbf2481cc2cdb4f5f064c87692", "committedDate": "2020-10-14T13:08:31Z", "message": "add cd to move back"}, "afterCommit": {"oid": "40b3d5f94a4fd38def1a2d0283e95bac82fe3679", "author": {"user": {"login": "SRodenburg", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/40b3d5f94a4fd38def1a2d0283e95bac82fe3679", "committedDate": "2020-10-15T15:55:48Z", "message": "add integration test to load study_es_0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNzg1MDAz", "url": "https://github.com/cBioPortal/cbioportal/pull/7950#pullrequestreview-510785003", "createdAt": "2020-10-16T20:40:04Z", "commit": {"oid": "40b3d5f94a4fd38def1a2d0283e95bac82fe3679"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMDo0MDowNFrOHjPJ6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMDo0MDowNFrOHjPJ6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjcxMDUwNA==", "bodyText": "is there a way to not override the command? Or does one always need to override the entire service?", "url": "https://github.com/cBioPortal/cbioportal/pull/7950#discussion_r506710504", "createdAt": "2020-10-16T20:40:04Z", "author": {"login": "inodb"}, "path": "test/integration/docker-compose-localbuild.yml", "diffHunk": "@@ -0,0 +1,12 @@\n+# this YAML file overrides settings in the cbioportal-docker-compose YAML\n+# and maps a local maven build to appropriate locations in the container (which is retrieved by image).\n+\n+version: '3'\n+\n+services:\n+  cbioportal:\n+    command: /bin/sh -c \"java -Xms2g -Xmx4g -Dauthenticate=noauthsessionservice -Dsession.service.url=http://cbioportal_session:5000/api/sessions/my_portal/ -jar webapp-runner.jar -AmaxHttpHeaderSize=16384 -AconnectionTimeout=20000 --enable-compression /app.war\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40b3d5f94a4fd38def1a2d0283e95bac82fe3679"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNzg1NDM0", "url": "https://github.com/cBioPortal/cbioportal/pull/7950#pullrequestreview-510785434", "createdAt": "2020-10-16T20:40:54Z", "commit": {"oid": "40b3d5f94a4fd38def1a2d0283e95bac82fe3679"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNjYzNzUw", "url": "https://github.com/cBioPortal/cbioportal/pull/7950#pullrequestreview-513663750", "createdAt": "2020-10-21T13:15:40Z", "commit": {"oid": "d82d233da9783f21ecda67acf9df7a9b4497a8b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMzoxNTo0MFrOHlrP4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMzoxNTo0MFrOHlrP4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI2NzkzOQ==", "bodyText": "this looks good to me, but would be nice to reorganize the test files a bit at some point. We have two copies of  study_es_0 I believe (one in frontend, one in here). There's also duplication of commands to load this data, since they exist in frontend localdb e2e tests as well. I guess we could use this script in the localdb e2e tests?", "url": "https://github.com/cBioPortal/cbioportal/pull/7950#discussion_r509267939", "createdAt": "2020-10-21T13:15:40Z", "author": {"login": "inodb"}, "path": "test/integration/test_load_study.sh", "diffHunk": "@@ -0,0 +1,33 @@\n+#!/bin/bash", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d82d233da9783f21ecda67acf9df7a9b4497a8b0"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNjc5NTg3", "url": "https://github.com/cBioPortal/cbioportal/pull/7950#pullrequestreview-513679587", "createdAt": "2020-10-21T13:28:26Z", "commit": {"oid": "d82d233da9783f21ecda67acf9df7a9b4497a8b0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d82d233da9783f21ecda67acf9df7a9b4497a8b0", "author": {"user": {"login": "inodb", "name": "Ino de Bruijn"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/d82d233da9783f21ecda67acf9df7a9b4497a8b0", "committedDate": "2020-10-19T08:20:29Z", "message": "update mvn clean plugin\n\nthis plugin gives some error while building docker (https://github.com/cBioPortal/cbioportal/runs/1247902965)."}, "afterCommit": {"oid": "40b3d5f94a4fd38def1a2d0283e95bac82fe3679", "author": {"user": {"login": "SRodenburg", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/40b3d5f94a4fd38def1a2d0283e95bac82fe3679", "committedDate": "2020-10-15T15:55:48Z", "message": "add integration test to load study_es_0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d53692b6f4e29f8b7d4b30f4e7e44197049d8203", "author": {"user": {"login": "SRodenburg", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/d53692b6f4e29f8b7d4b30f4e7e44197049d8203", "committedDate": "2020-11-05T11:50:11Z", "message": "Merge branch 'study_validate_integration_test' of https://github.com/TheHyve/cbioportal into study_validate_integration_test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1562, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}