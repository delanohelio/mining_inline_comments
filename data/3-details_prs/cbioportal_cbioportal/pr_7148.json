{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNzY0NTg4", "number": 7148, "title": "Fix study view fusion gene filter", "bodyText": "Fix #7145\nTemporary fix until fusion/structural data is fixed", "createdAt": "2020-02-11T16:44:59Z", "url": "https://github.com/cBioPortal/cbioportal/pull/7148", "merged": true, "mergeCommit": {"oid": "a7ef3c099fe8aea1995a439dff3c21e411d7ca3c"}, "closed": true, "closedAt": "2020-02-21T21:38:03Z", "author": {"login": "kalletlak"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFUVbygFqTM1OTk3NDgyMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGmjx1AFqTM2MjkyNjA0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5OTc0ODIy", "url": "https://github.com/cBioPortal/cbioportal/pull/7148#pullrequestreview-359974822", "createdAt": "2020-02-17T21:37:13Z", "commit": {"oid": "942961c6fd68cd878c5fa0d64820291bfa353ba0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "042d404ef577a49b81e3752cb3343dae57d53391", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/042d404ef577a49b81e3752cb3343dae57d53391", "committedDate": "2020-02-18T20:05:47Z", "message": "Fix study view fusion gene filter"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "942961c6fd68cd878c5fa0d64820291bfa353ba0", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/942961c6fd68cd878c5fa0d64820291bfa353ba0", "committedDate": "2020-02-11T16:43:05Z", "message": "Fix study view fusion gene filter"}, "afterCommit": {"oid": "042d404ef577a49b81e3752cb3343dae57d53391", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/042d404ef577a49b81e3752cb3343dae57d53391", "committedDate": "2020-02-18T20:05:47Z", "message": "Fix study view fusion gene filter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNjY2MDgx", "url": "https://github.com/cBioPortal/cbioportal/pull/7148#pullrequestreview-360666081", "createdAt": "2020-02-18T20:56:04Z", "commit": {"oid": "042d404ef577a49b81e3752cb3343dae57d53391"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMDo1NjowNFrOFrSG1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMDo1NjowNFrOFrSG1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkyOTc1MA==", "bodyText": "This is a temporary fix. the _fusion profile is created in the database for studies that still have fusions in the mutation table.", "url": "https://github.com/cBioPortal/cbioportal/pull/7148#discussion_r380929750", "createdAt": "2020-02-18T20:56:04Z", "author": {"login": "zhx828"}, "path": "web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java", "diffHunk": "@@ -125,20 +125,50 @@ public SampleIdentifier apply(Sample sample) {\n \n         if (!CollectionUtils.isEmpty(studyViewFilter.getGeneFilters())) {\n \n-            Set<String> molecularProfileIds = studyViewFilter.getGeneFilters().stream()\n-                    .flatMap(geneFilter -> geneFilter.getMolecularProfileIds().stream()).collect(Collectors.toSet());\n+            Set<String> molecularProfileIds = studyViewFilter.getGeneFilters()\n+                    .stream()\n+                    .flatMap(geneFilter -> {\n+                        // TODO: cleanup once fusion/structural data is fixed in database\n+                        // until then use mutation profile to fetch fusions\n+                        return geneFilter.getMolecularProfileIds().stream().flatMap(molecularProfileId -> {\n+                            ArrayList<String> ids = new ArrayList<String>();\n+                            ids.add(molecularProfileId);\n+                            if (molecularProfileId.endsWith(\"_fusion\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "042d404ef577a49b81e3752cb3343dae57d53391"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNjc2MzQ4", "url": "https://github.com/cBioPortal/cbioportal/pull/7148#pullrequestreview-360676348", "createdAt": "2020-02-18T21:13:09Z", "commit": {"oid": "042d404ef577a49b81e3752cb3343dae57d53391"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjYzNDE3", "url": "https://github.com/cBioPortal/cbioportal/pull/7148#pullrequestreview-362263417", "createdAt": "2020-02-20T21:57:25Z", "commit": {"oid": "042d404ef577a49b81e3752cb3343dae57d53391"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyOTI2MDQ3", "url": "https://github.com/cBioPortal/cbioportal/pull/7148#pullrequestreview-362926047", "createdAt": "2020-02-21T21:25:06Z", "commit": {"oid": "042d404ef577a49b81e3752cb3343dae57d53391"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1544, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}