{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwODM4NDY0", "number": 7894, "title": "RFC56: Add support for custom driver annotations for CNA data", "bodyText": "Add support for custom driver annotations for CNA data\nNote:\n\nThis PR is part of RFC56\nThis PR covers the following sub-task in RFC56:\n\nCustom PD annotations for CNA alteration type\n\n\n\nThis PR will:\n\nUpdate the database schema to hold custom driver annotations for mutations, discrete copy number alterations and structural variants to the alteration_driver_annotation\n\nAdd support in validator for custom driver annotations for discrete CNA data\nUpdate import code for for custom driver annotations for discrete CNA data\nUpdate MyBatis mappers to reflect schema update\nUpdate API for discrete CNA data to return custom driver annotations", "createdAt": "2020-09-22T10:23:22Z", "url": "https://github.com/cBioPortal/cbioportal/pull/7894", "merged": true, "mergeCommit": {"oid": "94a822dab16b7dca6104711d7dbad158b32dab10"}, "closed": true, "closedAt": "2020-11-24T21:35:20Z", "author": {"login": "pvannierop"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMHg20gFqTQ5NTk0MDM2NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoYwg1gFqTU1NjUxNjEyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1OTQwMzY1", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#pullrequestreview-495940365", "createdAt": "2020-09-24T20:49:33Z", "commit": {"oid": "bb0e7e1b3c2ebcd7dc230341b252cb2e1e95f6d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMzkzMDQ1", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#pullrequestreview-501393045", "createdAt": "2020-10-02T19:26:20Z", "commit": {"oid": "bb0e7e1b3c2ebcd7dc230341b252cb2e1e95f6d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxOToyNjoyMVrOHb5KrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxOToyNjoyMVrOHb5KrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTAxMDIyMQ==", "bodyText": "has this query been tested on a db with large number of records/large study? Just wondering if there was any changes in performance that needs to be considered for periodic imports.", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r499010221", "createdAt": "2020-10-02T19:26:21Z", "author": {"login": "averyniceday"}, "path": "core/src/main/java/org/mskcc/cbio/portal/dao/DaoCnaEvent.java", "diffHunk": "@@ -147,38 +159,53 @@ private static long addCnaEventDirectly(CnaEvent cnaEvent) throws DaoException {\n         try {\n             con = JdbcUtil.getDbConnection(DaoCnaEvent.class);\n             pstmt = con.prepareStatement\n-\t\t(\"SELECT sample_cna_event.CNA_EVENT_ID, SAMPLE_ID, GENETIC_PROFILE_ID,\"\n-                    + \" ENTREZ_GENE_ID, ALTERATION FROM sample_cna_event, cna_event\"\n-                    + \" WHERE `GENETIC_PROFILE_ID`=?\"\n+\t\t(\"SELECT sample_cna_event.CNA_EVENT_ID,\"\n+                    + \" sample_cna_event.SAMPLE_ID,\"\n+                    + \" sample_cna_event.GENETIC_PROFILE_ID,\"\n+                    + \" ENTREZ_GENE_ID,\"\n+                    + \" ALTERATION,\"\n+                    + \" alteration_driver_annotation.DRIVER_FILTER,\"\n+                    + \" alteration_driver_annotation.DRIVER_FILTER_ANNOTATION,\"\n+                    + \" alteration_driver_annotation.DRIVER_TIERS_FILTER,\"\n+                    + \" alteration_driver_annotation.DRIVER_TIERS_FILTER_ANNOTATION\"\n+                    + \" FROM sample_cna_event\"\n+                    + \" LEFT JOIN alteration_driver_annotation ON\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb0e7e1b3c2ebcd7dc230341b252cb2e1e95f6d1"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNDAwMDUw", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#pullrequestreview-501400050", "createdAt": "2020-10-02T19:38:46Z", "commit": {"oid": "bb0e7e1b3c2ebcd7dc230341b252cb2e1e95f6d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb0e7e1b3c2ebcd7dc230341b252cb2e1e95f6d1", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/bb0e7e1b3c2ebcd7dc230341b252cb2e1e95f6d1", "committedDate": "2020-09-22T10:19:27Z", "message": "Add support for custom annotations for discrete CNA data\n\nUpdate system test report html"}, "afterCommit": {"oid": "b42c6f5b311d1c63f5c943cc8a4bc80265b2bad7", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/b42c6f5b311d1c63f5c943cc8a4bc80265b2bad7", "committedDate": "2020-11-03T07:58:18Z", "message": "Add support for custom annotations for discrete CNA data\n\nUpdate system test report html"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b42c6f5b311d1c63f5c943cc8a4bc80265b2bad7", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/b42c6f5b311d1c63f5c943cc8a4bc80265b2bad7", "committedDate": "2020-11-03T07:58:18Z", "message": "Add support for custom annotations for discrete CNA data\n\nUpdate system test report html"}, "afterCommit": {"oid": "6e3ebbad2aae9780f611f2427772afd90adc75da", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6e3ebbad2aae9780f611f2427772afd90adc75da", "committedDate": "2020-11-12T05:44:28Z", "message": "Add support for custom annotations for discrete CNA data\n\nUpdate system test report html"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f", "committedDate": "2020-11-19T05:41:41Z", "message": "Add support for custom annotations for discrete CNA data\n\nUpdate system test report html"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e3ebbad2aae9780f611f2427772afd90adc75da", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6e3ebbad2aae9780f611f2427772afd90adc75da", "committedDate": "2020-11-12T05:44:28Z", "message": "Add support for custom annotations for discrete CNA data\n\nUpdate system test report html"}, "afterCommit": {"oid": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f", "author": {"user": {"login": "pvannierop", "name": "Pim van Nierop"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f", "committedDate": "2020-11-19T05:41:41Z", "message": "Add support for custom annotations for discrete CNA data\n\nUpdate system test report html"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NTE0NTY5", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#pullrequestreview-556514569", "createdAt": "2020-12-21T16:42:38Z", "commit": {"oid": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjo0MjozOFrOIJer5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjo0MjozOFrOIJer5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjgxMDg1NQ==", "bodyText": "@pvannierop @dippindots this DAO only has to do with import right?  This is not related to reading db, right?", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r546810855", "createdAt": "2020-12-21T16:42:38Z", "author": {"login": "alisman"}, "path": "core/src/main/java/org/mskcc/cbio/portal/dao/DaoMutation.java", "diffHunk": "@@ -1548,7 +1556,7 @@ public static void deleteAllRecords() throws DaoException {\n                 try {\n                     con = JdbcUtil.getDbConnection(DaoMutation.class);\n                     pstmt = con.prepareStatement(\n-                            \"SELECT DISTINCT DRIVER_TIERS_FILTER FROM mutation \"\n+                            \"SELECT DISTINCT DRIVER_TIERS_FILTER FROM alteration_driver_annotation \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NTE2MTI5", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#pullrequestreview-556516129", "createdAt": "2020-12-21T16:44:55Z", "commit": {"oid": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjo0NDo1NVrOIJewlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNjo0NDo1NVrOIJewlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjgxMjA1Mw==", "bodyText": "@pvannierop is it possible that we haven't introduced appropriate indexing on this table (alteration_driver_annotation) ?", "url": "https://github.com/cBioPortal/cbioportal/pull/7894#discussion_r546812053", "createdAt": "2020-12-21T16:44:55Z", "author": {"login": "alisman"}, "path": "persistence/persistence-mybatis/src/main/resources/org/cbioportal/persistence/mybatis/MutationMapper.xml", "diffHunk": "@@ -61,6 +61,10 @@\n         INNER JOIN sample ON mutation.SAMPLE_ID = sample.INTERNAL_ID\n         INNER JOIN patient ON sample.PATIENT_ID = patient.INTERNAL_ID\n         INNER JOIN cancer_study ON patient.CANCER_STUDY_ID = cancer_study.CANCER_STUDY_ID\n+        LEFT JOIN alteration_driver_annotation ON", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4a17ae06c4c526e47ae2ffe3905179aa7eb3d2f"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1696, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}