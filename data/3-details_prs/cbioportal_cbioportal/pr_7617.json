{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0Mjg4OTkx", "number": 7617, "title": "Accelerate generic assay endpoint response speed", "bodyText": "Fix #7448\nResult: take ccle_broad_2019 as an example, response time dropped from 9s-10s to 0.3-0.5s.\nThis pr will address the issue that causes the slowness of generic assay endpoint.\nThe issue is: the mybatis mapper will be called (2 * number of stable ids) times. So the response speed is very slow.\nDescribe changes proposed in this pull request:\n\ncall mapper just one time\nupdate related unit tests", "createdAt": "2020-06-15T05:06:24Z", "url": "https://github.com/cBioPortal/cbioportal/pull/7617", "merged": true, "mergeCommit": {"oid": "bd5f292550a11d4864732e5963565936e110d9be"}, "closed": true, "closedAt": "2020-06-15T16:51:42Z", "author": {"login": "dippindots"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrhj9NAFqTQzMDcwMDAxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrid-GAFqTQzMDc2MDU5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNzAwMDE3", "url": "https://github.com/cBioPortal/cbioportal/pull/7617#pullrequestreview-430700017", "createdAt": "2020-06-15T14:30:25Z", "commit": {"oid": "3ff98321d348436bdd5389dfda5adedcff5b1a0d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNDozMDoyNVrOGj0xgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNDozMDoyNVrOGj0xgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIxNzk4Ng==", "bodyText": "Main change is at here: we call function getGenericAssayAdditionalproperties once instead of calling N times getGeneticEntityIdByStableId and getGenericAssayMetaPropertiesMap (N is the number of stable ids).", "url": "https://github.com/cBioPortal/cbioportal/pull/7617#discussion_r440217986", "createdAt": "2020-06-15T14:30:25Z", "author": {"login": "dippindots"}, "path": "service/src/main/java/org/cbioportal/service/impl/GenericAssayServiceImpl.java", "diffHunk": "@@ -74,14 +75,19 @@\n                     metaResults.add(new GenericAssayMeta(meta.getStableId()));\n                 }\n             } else {\n-                // get additional properties for each meta data\n+                List<GenericAssayAdditionalProperty> additionalProperties = genericAssayRepository.getGenericAssayAdditionalproperties(distinctStableIds);\n                 for (GenericAssayMeta meta : metaData) {\n-                    int geneticEntityId = genericAssayRepository.getGeneticEntityIdByStableId(meta.getStableId());\n+                    String stableId = meta.getStableId();\n                     HashMap<String, String> map = new HashMap<>();\n-                    for (HashMap<String, String> data : genericAssayRepository.getGenericAssayMetaPropertiesMap(geneticEntityId)) {\n-                        map.put(data.get(\"key\"), data.get(\"value\"));\n+                    List<GenericAssayAdditionalProperty> filteredAdditionalProperties = additionalProperties\n+                            .stream()\n+                            .filter(additionalProperty -> additionalProperty.getStableId().equals(stableId))\n+                            .collect(Collectors.toList());\n+                    for (GenericAssayAdditionalProperty additionalProperty : filteredAdditionalProperties) {\n+                        map.put(additionalProperty.getName(), additionalProperty.getValue());\n                     }\n-                    metaResults.add(new GenericAssayMeta(meta.getEntityType(), meta.getStableId(), map));\n+                    meta.setGenericEntityMetaProperties(map);\n+                    metaResults.add(meta);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ff98321d348436bdd5389dfda5adedcff5b1a0d"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7567255e5fb946a2fbf6b93ff3401e92664fc3b", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/d7567255e5fb946a2fbf6b93ff3401e92664fc3b", "committedDate": "2020-06-15T14:58:08Z", "message": "Accelerate generic assay endpoint response speed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ff98321d348436bdd5389dfda5adedcff5b1a0d", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/3ff98321d348436bdd5389dfda5adedcff5b1a0d", "committedDate": "2020-06-15T04:59:02Z", "message": "Accelerate generic assay endpoint response speed"}, "afterCommit": {"oid": "d7567255e5fb946a2fbf6b93ff3401e92664fc3b", "author": {"user": {"login": "dippindots", "name": "Gaofei Zhao"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/d7567255e5fb946a2fbf6b93ff3401e92664fc3b", "committedDate": "2020-06-15T14:58:08Z", "message": "Accelerate generic assay endpoint response speed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNzYwNTk1", "url": "https://github.com/cBioPortal/cbioportal/pull/7617#pullrequestreview-430760595", "createdAt": "2020-06-15T15:34:20Z", "commit": {"oid": "d7567255e5fb946a2fbf6b93ff3401e92664fc3b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1619, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}