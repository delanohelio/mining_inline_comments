{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNzg1ODI2", "number": 8064, "title": "Validate length of HGVSp_Short values", "bodyText": "Recently, we have encountered very long HGVSp_Short values, like: p.Q3631_Q3632insHQSADSSRHSGIGHGQASSAVRDSGHRGYSGSQASDSEGHSEDSDTQSVSAQGKAGPHQQSHKESARGQSGESSGRSGSFLYQVSTHEQSESTHGQSAPSTGGRQGSHYDQAQDSSRHSASQEGQDTIRGHPGPSRGGRQGSHQEQSVDRSGHSGSHHSHTTSQGRSDASRGQSGSRSASRKTYDKEQSGDGSRHSGSHHHEASSWADSSRHSLVGQGQSSGPRTSRPRGSSVSQDSDSEGHSEDSERRSGSASRNHHGSAQEQSRDGSRHPRSHHEDRAGHGHSAESSRQSGTHHAENSSGGQAASSHEQARSSAGERHGSHHQQSADSSRHSGIGHGQASSAVRDSGHRGSSGSQASDSEGHSEDSDTQSVSAHGQAGPHQQSHQESTRGRSAGRSGRSGSFLYQVSTHEQSESAHGRTGTSTGGRQGSHHKQARDSSRHSTSQEGQDTIHGHPGSSSGGRQGSHYEQLVDRSGHSGSHHSHTTSQGRSDASHGHSGSRSASRQTRNDEQSGDGSRHSGSRHHEASSRADSSGHSQVGQGQSEGPRTSRNWGSSFSQDSDSQGHSEDSERWSGSASRNHHGSAQEQLRDGSRHPRSHQEDRAGHGHSADSSRQSGTRHTQTSSGGQAASSHEQARSSAGERHGSHHQQSADSSRHSGIGHGQASSAVRDSGHRGYSGSQASDNEGHSEDSDTQSVSAHGQAGSHQQSHQESARGRSGETSGHSGSFLYQVSTHEQSESSHGWTGPSTRGRQGSRHEQAQDSSRHSASQDGQDTIRGHPGSSRGGRQGYHHEHSVDSSGHSGSHHSHTTSQGRSDASRGQSGSRSASRTTRNEEQSGDGSRHSGSRHHEASTHADISRHSQAVQGQSEGSRRSRRQGSSVSQDSDSEGHSEDSERWSGSASRNHHGSAQEQLRDGSRHPRSHQEDRAGHGHSADSSRQSGTRHTQTSSGGQAASSHEQARSSAGERHGSHHQQSADSSRHSGIGHGQASSAVRDSGHRGYSGSQASDNEGHSEDSDTQSVSAHGQAGSHQQSHQESARGRSGETSGHSGSFLYQVSTHEQSESSHGWTGPSTRGRQGSRHEQAQDSSRHSASQYGQDTIRGHPGSSRGGRQGYHHEHSVDSSGHSGSHHSHTTSQGRSDASRGQSGSRSASRTTRNEEQSGDSSRHSVSRHHEASTHADISRHSQAVQGQSEGSRRSRRQGSSVSQDSDSEGHSEDSERWSGSASRNHRGSVQEQSRHGSRHPRSHHEDRAGHGHSADRSRQSGTRHAETSSGGQAASSHEQARSSPGERHGSRHQQSADSSRHSGIPRGQASSAVRDSRHWGSSGSQASDSEGHSEESDTQSVSGHGQAGPHQQSHQESARDRSGGRSGRSGSFLYQVSTHEQSESAHGRTRTSTGRRQGSHHEQARDSSRHSASQEGQDTIRGHPGSSRRGRQGSHYEQSVDRSGHSGSHHSHTTSQGRSDASRGQSGSRSASRQTRNDEQSGDGSRHSWSHHHEASTQADSSRHSQSGQGQSAGPRTSRNQGSSVSQDSDSQGHSEDSERWSGSASRNHRGSAQEQSRDGSRHPTSHHEDRAGHGHSAESSRQSGTHHAENSSGGQAASSHEQARSSAGERHGSHHQ\nHGVSp_Short values are saved in the column PROTEIN_CHANGE of the mutation_event table. However, the length of this column is 255, so these long HGVSp_Short values are truncated and prone to raise the error \"Duplicated mutation event\" when loading a study (since PROTEIN_CHANGE is one of the keys of the table).\nThis PR proposes to add validation for the length of HGVSP_Short values and throw an error if the length is higher than 255.", "createdAt": "2020-11-16T16:43:42Z", "url": "https://github.com/cBioPortal/cbioportal/pull/8064", "merged": true, "mergeCommit": {"oid": "8c9f4ec9b98b15462e3c571dd376b033b92cc5c1"}, "closed": true, "closedAt": "2020-11-30T15:53:52Z", "author": {"login": "oplantalech"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddJyM0gFqTUzMTYyMTAyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhnb3MAFqTU0MTA0Mjc2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNjIxMDI5", "url": "https://github.com/cBioPortal/cbioportal/pull/8064#pullrequestreview-531621029", "createdAt": "2020-11-16T19:05:01Z", "commit": {"oid": "854450c701234d7546745880b4efb7b2aec453d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be3eb2a919e3b339b2142ce4473e589533c54c9c", "author": {"user": {"login": "oplantalech", "name": "Oleguer Plantalech-Casals"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/be3eb2a919e3b339b2142ce4473e589533c54c9c", "committedDate": "2020-11-23T09:44:00Z", "message": "Revert some changes"}, "afterCommit": {"oid": "4183c29310be289b93d16303d2eb881584ca259c", "author": {"user": {"login": "oplantalech", "name": "Oleguer Plantalech-Casals"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/4183c29310be289b93d16303d2eb881584ca259c", "committedDate": "2020-11-23T10:41:40Z", "message": "Validate length of HGVSp_Short values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MTEwOTY4", "url": "https://github.com/cBioPortal/cbioportal/pull/8064#pullrequestreview-538110968", "createdAt": "2020-11-25T02:27:42Z", "commit": {"oid": "4183c29310be289b93d16303d2eb881584ca259c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwMjoyNzo0MlrOH5gvvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwMjoyNzo0MlrOH5gvvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDA2NzM5MA==", "bodyText": "Should we assert that there is no error logged for the first record? If some logic flaw in the scripts package caused flagging every record as too long I'm sure we would notice, so maybe we don't have to worry about it - but since there are two records in the test set, it would feel more complete to test the code behavior for both cases. I'm not sure how you assert an absence of error .. maybe self.assertNotEqual(record.levelno, logging.ERROR)?\nHowever, I think this PR can be merged without this added test.", "url": "https://github.com/cBioPortal/cbioportal/pull/8064#discussion_r530067390", "createdAt": "2020-11-25T02:27:42Z", "author": {"login": "sheridancbio"}, "path": "core/src/test/scripts/unit_tests_validate_data.py", "diffHunk": "@@ -1365,6 +1365,22 @@ def test_isValidAminoAcidChange(self):\n         self.assertIn('HGVSp_Short', record.getMessage())\n         self.assertEqual(record.line_number, 8)\n \n+    def throw_error_if_hgvsp_short_is_too_long(self):\n+        \"\"\"Test that an error is thrown if HGVSp_Short value is too long.\"\"\"\n+        # set level according to this test case:\n+        self.logger.setLevel(logging.WARNING)\n+        record_list = self.validate(\n+                'mutations/data_mutations_too_long_hgvsp_short.maf',\n+                validateData.MutationsExtendedValidator,\n+                extra_meta_fields={'swissprot_identifier': 'accession'})\n+        self.assertEqual(len(record_list), 2)\n+        record_iterator = iter(record_list)\n+        # expect an error for the second entry", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4183c29310be289b93d16303d2eb881584ca259c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58da307b6770b3ef19c96b7c42b37a2b0c7289a2", "author": {"user": {"login": "oplantalech", "name": "Oleguer Plantalech-Casals"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/58da307b6770b3ef19c96b7c42b37a2b0c7289a2", "committedDate": "2020-11-26T08:45:49Z", "message": "Validate length of HGVSp_Short values"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bbcd72617cf57c18c914b8d41d1b80ccca6aa5a1", "author": {"user": {"login": "oplantalech", "name": "Oleguer Plantalech-Casals"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/bbcd72617cf57c18c914b8d41d1b80ccca6aa5a1", "committedDate": "2020-11-26T08:36:01Z", "message": "Fix test"}, "afterCommit": {"oid": "58da307b6770b3ef19c96b7c42b37a2b0c7289a2", "author": {"user": {"login": "oplantalech", "name": "Oleguer Plantalech-Casals"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/58da307b6770b3ef19c96b7c42b37a2b0c7289a2", "committedDate": "2020-11-26T08:45:49Z", "message": "Validate length of HGVSp_Short values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMDQyNzY5", "url": "https://github.com/cBioPortal/cbioportal/pull/8064#pullrequestreview-541042769", "createdAt": "2020-11-30T15:53:28Z", "commit": {"oid": "58da307b6770b3ef19c96b7c42b37a2b0c7289a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1579, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}