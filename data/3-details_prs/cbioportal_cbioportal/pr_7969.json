{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0MTg3MTI4", "number": 7969, "title": "Get ref genome from meta_study instead of command line", "bodyText": "The reference genome (and thereby species and build) is now retrieved from the meta_study.txt file after the optional reference_genome tag.\nAllowed values are hg19, hg38 and mm10. The validator will raise an error when any other value is encountered, and will default to hg19.\nI also added a more specific error when validating the NCBI_Build column in MAF files, validating whether the correct reference genome is used.\nThis was already present in the FIle Formats documentation.", "createdAt": "2020-10-15T15:22:53Z", "url": "https://github.com/cBioPortal/cbioportal/pull/7969", "merged": true, "mergeCommit": {"oid": "0f23ed4a79b77fecc9afb16197db90cae4940102"}, "closed": true, "closedAt": "2020-10-16T12:29:34Z", "author": {"login": "SRodenburg"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSzVA5gH2gAyNTA0MTg3MTI4OmU4MDVmZjJmMjk1ZWFlNzEwMzJkNTJkZmNkNzU0ODQ5YTA3YTQwMWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTFjr5AFqTUxMDQyMjg3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c", "author": {"user": {"login": "SRodenburg", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/e805ff2f295eae71032d52dfcd754849a07a401c", "committedDate": "2020-10-15T15:15:59Z", "message": "impl. ref genome parsing from meta_study"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTAxNDA1", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#pullrequestreview-509501405", "createdAt": "2020-10-15T15:23:54Z", "commit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNToyMzo1NVrOHiNZqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNToyMzo1NVrOHiNZqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzMzE5NQ==", "bodyText": "somehow my editor automatically removes trailing whitespace", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r505633195", "createdAt": "2020-10-15T15:23:55Z", "author": {"login": "SRodenburg"}, "path": "core/src/main/scripts/importer/cbioportal_common.py", "diffHunk": "@@ -37,7 +37,7 @@\n ADD_CASE_LIST_CLASS = \"org.mskcc.cbio.portal.scripts.AddCaseList\"\n VERSION_UTIL_CLASS = \"org.mskcc.cbio.portal.util.VersionUtil\"\n \n-# provides a key for data types to metafile specification dict.  \n+# provides a key for data types to metafile specification dict.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTAzNzIz", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#pullrequestreview-509503723", "createdAt": "2020-10-15T15:26:19Z", "commit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNToyNjoxOVrOHiNgnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNToyODoxN1rOHiNmIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzNDk3NQ==", "bodyText": "somehow this parameter is passed on but never used.", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r505634975", "createdAt": "2020-10-15T15:26:19Z", "author": {"login": "SRodenburg"}, "path": "core/src/main/scripts/importer/cbioportal_common.py", "diffHunk": "@@ -685,7 +686,6 @@ def validate_types_and_id(meta_dictionary, logger, filename):\n def parse_metadata_file(filename,\n                         logger,\n                         study_id=None,\n-                        genome_name=None,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzNTM4Mw==", "bodyText": "arguments became obsolete now", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r505635383", "createdAt": "2020-10-15T15:26:52Z", "author": {"login": "SRodenburg"}, "path": "core/src/main/scripts/importer/metaImport.py", "diffHunk": "@@ -70,16 +70,7 @@ def interface():\n     portal_mode_group.add_argument('-n', '--no_portal_checks', default=False,\n                                        action='store_true',\n                                        help='Skip tests requiring information '\n-                                            'from the cBioPortal installation')\n-    parser.add_argument('-species', '--species', type=str, default='human',\n-                        help='species information (default: assumed human)',\n-                        required=False)\n-    parser.add_argument('-ucsc', '--ucsc_build_name', type=str, default='hg19',\n-                        help='UCSC reference genome assembly name (default: assumed hg19)',\n-                        required=False)   \n-    parser.add_argument('-ncbi', '--ncbi_build_number', type=str, default='37',\n-                         help='NCBI reference genome build number (default: assumed 37 for UCSC reference genome build hg19)',\n-                         required=False)                                                                  ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzNjAxMw==", "bodyText": "not sure if we should also allow GRCxXX values", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r505636013", "createdAt": "2020-10-15T15:27:48Z", "author": {"login": "SRodenburg"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -4453,11 +4459,18 @@ def process_metadata_files(directory, portal_instance, logger, relaxed_mode, str\n     global meta_dictionary\n     tags_file_path = None\n \n+    # implemented ref genomes\n+    reference_genome_map = {\n+        'hg19':('human','37','hg19'),\n+        'hg38':('human','38','hg38'),\n+        'mm10':('mouse','38','mm10')\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzNjM4Nw==", "bodyText": "relic from previous work", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r505636387", "createdAt": "2020-10-15T15:28:17Z", "author": {"login": "SRodenburg"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -4864,8 +4892,6 @@ def validate_data_relations(validators_by_meta_type, logger):\n def request_from_portal_api(server_url, api_name, logger):\n     \"\"\"Send a request to the portal API and return the decoded JSON object.\"\"\"\n \n-    print(api_name)\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NzEwNjU5", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#pullrequestreview-509710659", "createdAt": "2020-10-15T19:42:07Z", "commit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMjI4MzI5", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#pullrequestreview-510228329", "createdAt": "2020-10-16T07:45:52Z", "commit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNzo0NTo1MlrOHir_sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQwNzo1MjozNVrOHisRaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzNDQ1MA==", "bodyText": "I think it is wrong to assume that the default is hg19. The default is the genome specified in portal.properties, right?", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r506134450", "createdAt": "2020-10-16T07:45:52Z", "author": {"login": "oplantalech"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -4518,6 +4531,21 @@ def process_metadata_files(directory, portal_instance, logger, relaxed_mode, str\n                         meta_dictionary['add_global_case_list'].lower() == 'true'):\n                     case_list_suffix_fns['all'] = filename\n \n+            if 'reference_genome' in meta_dictionary:\n+                if meta_dictionary['reference_genome'] not in reference_genome_map:\n+                    logger.error('Unknown reference genome defined. Should be one of %s' %\n+                                 list(reference_genome_map.keys()),\n+                                 extra={\n+                                     'filename_':filename,\n+                                     'cause':meta_dictionary['reference_genome'].strip()\n+                                 })\n+                else:\n+                    portal_instance.species, portal_instance.ncbi_build, portal_instance.genome_build = \\\n+                        reference_genome_map[meta_dictionary['reference_genome']]\n+            else:\n+                logger.info('No reference genome specified -- using default (hg19)',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzNzkzOA==", "bodyText": "I think we should follow the values defined in portal.properties, so it's good like this. If you want to add the GRCxXX values we should change it in the properties. And just a thought: if we want to change the genome build properties in portal.properties I think we should simplify it to one property: hg19/hg38/mm10 already gives you all the information given from the three properties that we currently have.", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r506137938", "createdAt": "2020-10-16T07:50:59Z", "author": {"login": "oplantalech"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -4453,11 +4459,18 @@ def process_metadata_files(directory, portal_instance, logger, relaxed_mode, str\n     global meta_dictionary\n     tags_file_path = None\n \n+    # implemented ref genomes\n+    reference_genome_map = {\n+        'hg19':('human','37','hg19'),\n+        'hg38':('human','38','hg38'),\n+        'mm10':('mouse','38','mm10')\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYzNjAxMw=="}, "originalCommit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzODk4NQ==", "bodyText": "Another option would be to set the default to hg19 instead of being defined in portal.properties. But it should be checked if the genome build properties in portal.properties are only used here before removing them.", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r506138985", "createdAt": "2020-10-16T07:52:35Z", "author": {"login": "oplantalech"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -4518,6 +4531,21 @@ def process_metadata_files(directory, portal_instance, logger, relaxed_mode, str\n                         meta_dictionary['add_global_case_list'].lower() == 'true'):\n                     case_list_suffix_fns['all'] = filename\n \n+            if 'reference_genome' in meta_dictionary:\n+                if meta_dictionary['reference_genome'] not in reference_genome_map:\n+                    logger.error('Unknown reference genome defined. Should be one of %s' %\n+                                 list(reference_genome_map.keys()),\n+                                 extra={\n+                                     'filename_':filename,\n+                                     'cause':meta_dictionary['reference_genome'].strip()\n+                                 })\n+                else:\n+                    portal_instance.species, portal_instance.ncbi_build, portal_instance.genome_build = \\\n+                        reference_genome_map[meta_dictionary['reference_genome']]\n+            else:\n+                logger.info('No reference genome specified -- using default (hg19)',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEzNDQ1MA=="}, "originalCommit": {"oid": "e805ff2f295eae71032d52dfcd754849a07a401c"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "860a0a2f85b997fcaf365d16fe4d9b3c47b14f92", "author": {"user": {"login": "SRodenburg", "name": null}}, "url": "https://github.com/cBioPortal/cbioportal/commit/860a0a2f85b997fcaf365d16fe4d9b3c47b14f92", "committedDate": "2020-10-16T09:41:36Z", "message": "update docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzI0NjAy", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#pullrequestreview-510324602", "createdAt": "2020-10-16T09:56:14Z", "commit": {"oid": "860a0a2f85b997fcaf365d16fe4d9b3c47b14f92"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNDIyODc0", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#pullrequestreview-510422874", "createdAt": "2020-10-16T12:30:18Z", "commit": {"oid": "860a0a2f85b997fcaf365d16fe4d9b3c47b14f92"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjozMDoxOFrOHi6DXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjozMDoxOFrOHi6DXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM2NDc2Nw==", "bodyText": "not entirely clear here what the values are supposed to be but will update that", "url": "https://github.com/cBioPortal/cbioportal/pull/7969#discussion_r506364767", "createdAt": "2020-10-16T12:30:18Z", "author": {"login": "inodb"}, "path": "docs/Support-multiple-reference-genomes.md", "diffHunk": "@@ -20,20 +20,4 @@ if your study is profiled by a reference geome other than a default genome value\n    ncbi.build=GRCh37\n    ucsc.build=hg19\n ```\n-* You can also overwrite default genome values by using the following options of the importer script. _**ucsc**_ and _**ncbi**_ are both required when importing a dataset profiled with a reference genome different from a default genome value listed in your portal properties file.\n-```\n-  -species SPECIES, --species SPECIES\n-                        species information (default: assumed human)\n-  -ucsc UCSC_BUILD_NAME, --ucsc_build_name UCSC_BUILD_NAME\n-                        UCSC reference genome assembly name (default: assumed\n-                        hg19)\n-  -ncbi NCBI_BUILD_NUMBER, --ncbi_build_number NCBI_BUILD_NUMBER\n-                        NCBI reference genome build number (default: assumed\n-                        GRCh37 for UCSC reference genome build hg19)\n-```\n-For instance, to load a hg38 dataset:\n-```\n-core/src/main/scripts/importer/metaImport.py  -s /path/to/your/study -jar scripts.jar -ucsc hg38 -ncbi GRCh38 -n -o\n-\n-```\n-\n+* You can also overwrite default genome values by using the following options of the importer script. For that, you have to specify the `reference_genome` field in the `meta_study.txt` file of your study.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "860a0a2f85b997fcaf365d16fe4d9b3c47b14f92"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1568, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}