{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNDExNDQ3", "number": 7762, "title": "SV: add new api to support generic assay chart", "bodyText": "Fix #7700", "createdAt": "2020-08-05T14:13:12Z", "url": "https://github.com/cBioPortal/cbioportal/pull/7762", "merged": true, "mergeCommit": {"oid": "7d21351a3ff41cd22a88afa20da18d80df658324"}, "closed": true, "closedAt": "2020-08-18T18:29:02Z", "author": {"login": "kalletlak"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-L-hbABqjM2NDc4ODUzOTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAKVa8gFqTQ2OTY2NjMwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ccffbd6e195f0f187c46903878e54d6db75112f8", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ccffbd6e195f0f187c46903878e54d6db75112f8", "committedDate": "2020-08-12T01:50:31Z", "message": "Updates"}, "afterCommit": {"oid": "7f8dae38b754091fa4b0cf8871b574e448766867", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/7f8dae38b754091fa4b0cf8871b574e448766867", "committedDate": "2020-08-12T14:06:22Z", "message": "Add generic assay data bin api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f8dae38b754091fa4b0cf8871b574e448766867", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/7f8dae38b754091fa4b0cf8871b574e448766867", "committedDate": "2020-08-12T14:06:22Z", "message": "Add generic assay data bin api"}, "afterCommit": {"oid": "ca772206c9efb0dee20e74bc1638297218999c8b", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ca772206c9efb0dee20e74bc1638297218999c8b", "committedDate": "2020-08-12T18:45:55Z", "message": "Add generic assay data bin api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca772206c9efb0dee20e74bc1638297218999c8b", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/ca772206c9efb0dee20e74bc1638297218999c8b", "committedDate": "2020-08-12T18:45:55Z", "message": "Add generic assay data bin api"}, "afterCommit": {"oid": "12eeb0794eca39dffab78fce3335b27aa70d5085", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/12eeb0794eca39dffab78fce3335b27aa70d5085", "committedDate": "2020-08-12T20:22:22Z", "message": "Add generic assay data bin api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12eeb0794eca39dffab78fce3335b27aa70d5085", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/12eeb0794eca39dffab78fce3335b27aa70d5085", "committedDate": "2020-08-12T20:22:22Z", "message": "Add generic assay data bin api"}, "afterCommit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397", "committedDate": "2020-08-12T20:25:46Z", "message": "Add generic assay data bin api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTM1NzAz", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#pullrequestreview-466935703", "createdAt": "2020-08-13T16:42:33Z", "commit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0MjozM1rOHATr4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo0MjozM1rOHATr4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NDU3Nw==", "bodyText": "Why are we suppressing warnings here (and below)?", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#discussion_r470084577", "createdAt": "2020-08-13T16:42:33Z", "author": {"login": "n1zea144"}, "path": "web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java", "diffHunk": "@@ -546,4 +421,408 @@ private void splitGeneFiltersByMolecularAlterationType(List<GeneFilter> genefilt\n             }\n         }\n     }\n+\n+    public List<String> getUniqkeyKeys(List<String> studyIds, List<String> caseIds) {\n+        List<String> uniqkeyKeys = new ArrayList<String>();\n+        for (int i = 0; i < caseIds.size(); i++) {\n+            uniqkeyKeys.add(studyViewFilterUtil.getCaseUniqueKey(studyIds.get(i), caseIds.get(i)));\n+        }\n+        return uniqkeyKeys;\n+    }\n+\n+    @SuppressWarnings(\"unchecked\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397"}, "originalPosition": 229}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDQ2NjEy", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#pullrequestreview-467046612", "createdAt": "2020-08-13T18:56:44Z", "commit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODo1Njo0NFrOHAZZzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOToxNTozMFrOHAaCuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3ODI1NQ==", "bodyText": "I wouldn't think this was an xor from the name. Maybe isEitherSampleListIdXOrSampleIdsPresent?", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#discussion_r470178255", "createdAt": "2020-08-13T18:56:44Z", "author": {"login": "Luke-Sikina"}, "path": "web/src/main/java/org/cbioportal/web/parameter/GenericAssayFilter.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package org.cbioportal.web.parameter;\n+\n+import javax.validation.constraints.AssertTrue;\n+import javax.validation.constraints.Size;\n+import java.util.List;\n+\n+public class GenericAssayFilter {\n+\n+    @Size(min = 1, max = PagingConstants.MAX_PAGE_SIZE)\n+    private List<String> sampleIds;\n+    private String sampleListId;\n+    @Size(min = 1, max = PagingConstants.MAX_PAGE_SIZE)\n+    private List<String> genericAssayStableId;\n+\n+    @AssertTrue\n+    private boolean isEitherSampleListIdOrSampleIdsPresent() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE4MjU3MQ==", "bodyText": "I would think a test to see if value or range is present would be\nv.getValue() != null || (v.getStart() != null || v.getEnd() != null)\nBy checking that the two checks evaluate to the same boolean, you're marking a rows as invalid when it has both a range and a value, or neither a range nor a value. Is that what you want?", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#discussion_r470182571", "createdAt": "2020-08-13T19:04:03Z", "author": {"login": "Luke-Sikina"}, "path": "web/src/main/java/org/cbioportal/web/parameter/StudyViewFilter.java", "diffHunk": "@@ -61,6 +62,22 @@ private boolean isEitherValueOrRangePresentInGenomicDataIntervalFilters() {\n         return invalidCount == 0;\n     }\n \n+    @AssertTrue\n+    private boolean isEitherValueOrRangePresentInGenericAssayDataIntervalFilters() {\n+        long invalidCount = 0;\n+\n+        if (genericAssayDataFilters != null) {\n+            invalidCount = genericAssayDataFilters\n+                    .stream()\n+                    .flatMap(f -> f.getValues().stream())\n+                    .filter(Objects::nonNull)\n+                    .filter(v -> v.getValue() != null == (v.getStart() != null || v.getEnd() != null))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE4MzM4MQ==", "bodyText": "Is addressing this TODO within the scope of this PR?", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#discussion_r470183381", "createdAt": "2020-08-13T19:05:33Z", "author": {"login": "Luke-Sikina"}, "path": "web/src/main/java/org/cbioportal/web/util/ClinicalDataIntervalFilterApplier.java", "diffHunk": "@@ -134,7 +138,7 @@ else if (value.startsWith(gt)) {\n \n         // TODO also add startInclusive and endInclusive as a filterValue parameter?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE4NDYyOA==", "bodyText": "I didn't see a DataBinHelperTest in the files - this seems like a good method to unit test.", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#discussion_r470184628", "createdAt": "2020-08-13T19:08:01Z", "author": {"login": "Luke-Sikina"}, "path": "web/src/main/java/org/cbioportal/web/util/DataBinHelper.java", "diffHunk": "@@ -308,4 +301,35 @@ public String stripOperator(String value) {\n     public boolean isAgeAttribute(String attributeId) {\n         return attributeId != null && attributeId.matches(\"(^AGE$)|(^AGE_.*)|(.*_AGE_.*)|(.*_AGE&)\");\n     }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE4NTgwNg==", "bodyText": "You added logic to dataBinHelper for when start and end are null. Here, you check that in this ternary, so you never pass null, null. Could you eliminate this check and change the behavior of calcRange, or are you doing calcRange(null, null) elsewhere?", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#discussion_r470185806", "createdAt": "2020-08-13T19:10:30Z", "author": {"login": "Luke-Sikina"}, "path": "web/src/main/java/org/cbioportal/web/util/DataBinner.java", "diffHunk": "@@ -106,7 +96,7 @@ public DataBinner(DataBinHelper dataBinHelper,\n         boolean numericalOnly = false;\n \n         Range<BigDecimal> range = dataBinFilter.getStart() == null && dataBinFilter.getEnd() == null ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE4ODIzMQ==", "bodyText": "What am I missing here? You add the dataBinHelper, but never use it.", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#discussion_r470188231", "createdAt": "2020-08-13T19:14:47Z", "author": {"login": "Luke-Sikina"}, "path": "web/src/main/java/org/cbioportal/web/util/LinearDataBinner.java", "diffHunk": "@@ -34,12 +34,8 @@\n \n     public static final Integer DEFAULT_INTERVAL_COUNT = 20;\n \n-    private DataBinHelper dataBinHelper;\n-\n     @Autowired\n-    public LinearDataBinner(DataBinHelper dataBinHelper) {\n-        this.dataBinHelper = dataBinHelper;\n-    }\n+    private DataBinHelper dataBinHelper;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE4ODcyOQ==", "bodyText": "Same for LogScaleDataBinner.java, ScientificSmallDataBinner.java", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#discussion_r470188729", "createdAt": "2020-08-13T19:15:30Z", "author": {"login": "Luke-Sikina"}, "path": "web/src/main/java/org/cbioportal/web/util/LinearDataBinner.java", "diffHunk": "@@ -34,12 +34,8 @@\n \n     public static final Integer DEFAULT_INTERVAL_COUNT = 20;\n \n-    private DataBinHelper dataBinHelper;\n-\n     @Autowired\n-    public LinearDataBinner(DataBinHelper dataBinHelper) {\n-        this.dataBinHelper = dataBinHelper;\n-    }\n+    private DataBinHelper dataBinHelper;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE4ODIzMQ=="}, "originalCommit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ce576569c868118079889929f1c60251c65e657", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/8ce576569c868118079889929f1c60251c65e657", "committedDate": "2020-08-17T17:34:17Z", "message": "Add generic assay data bin api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/5a0be2f2c0230e6adc4c6cc20c77dcac6b5c6397", "committedDate": "2020-08-12T20:25:46Z", "message": "Add generic assay data bin api"}, "afterCommit": {"oid": "8ce576569c868118079889929f1c60251c65e657", "author": {"user": {"login": "kalletlak", "name": "Karthik K"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/8ce576569c868118079889929f1c60251c65e657", "committedDate": "2020-08-17T17:34:17Z", "message": "Add generic assay data bin api"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NTQxODA5", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#pullrequestreview-469541809", "createdAt": "2020-08-18T14:58:00Z", "commit": {"oid": "8ce576569c868118079889929f1c60251c65e657"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NjY2MzAw", "url": "https://github.com/cBioPortal/cbioportal/pull/7762#pullrequestreview-469666300", "createdAt": "2020-08-18T17:19:41Z", "commit": {"oid": "8ce576569c868118079889929f1c60251c65e657"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1663, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}