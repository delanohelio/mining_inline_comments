{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzODA3NTE2", "number": 7472, "title": "Flag mutations in MAF that occur outside of gene panel", "bodyText": "Related issue: #7274\nPR to update the gene-panels json file for offline validation: cBioPortal/datahub#1112. To be merged simultaneously with this PR.\nDescribe changes proposed in this pull request:\n\nAdded a check to flag variants from genes outside the targeted panel as warning.\n\nChecks\n\n Runs on heroku\n Has tests or has a separate issue that describes the types of test that should be created. If no test is included it should explicitly be mentioned in the PR why there is no test.\n The commit log is comprehensible. It follows 7 rules of great commit messages. For most PRs a single commit should suffice, in some cases multiple topical commits can be useful. During review it is ok to see tiny commits (e.g. Fix reviewer comments), but right before the code gets merged to master or rc branch, any such commits should be squashed since they are useless to the other developers. Definitely avoid merge commits, use rebase instead.\n Is this PR adding logic based on one or more clinical attributes? If yes, please make sure validation for this attribute is also present in the data validation / data loading layers (in backend repo) and documented in File-Formats Clinical data section!\n\nAny screenshots or GIFs?\nIf this is a new visual feature please add a before/after screenshot or gif\nhere with e.g. Giphy CAPTURE or Peek\nNotify reviewers\nRead our Pull request merging\npolicy. It can help to figure out who worked on the\nfile before you. Please use git blame <filename> to determine that\nand notify them either through slack or by assigning them as a reviewer on the PR", "createdAt": "2020-05-05T23:47:32Z", "url": "https://github.com/cBioPortal/cbioportal/pull/7472", "merged": true, "mergeCommit": {"oid": "0e1f7e42b2e8ebd98426b60e00a0e07dd211dd2d"}, "closed": true, "closedAt": "2020-05-20T15:53:26Z", "author": {"login": "rmadupuri"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcec2kEgH2gAyNDEzODA3NTE2OjY5Njg4NGE3MzcxZWI0NWQ5MDY5MzQ5OGJiYzhhNjRmZDkxZjc4MWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci-7u-AFqTQxNDkzNDk5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "696884a7371eb45d90693498bbc8a64fd91f781c", "author": {"user": {"login": "rmadupuri", "name": "Ramya Madupuri"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/696884a7371eb45d90693498bbc8a64fd91f781c", "committedDate": "2020-05-05T23:40:45Z", "message": "flag variants outside gene panel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6906cb9ed75333c3cfa9a173c4ff17da7fc22713", "author": {"user": {"login": "rmadupuri", "name": "Ramya Madupuri"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/6906cb9ed75333c3cfa9a173c4ff17da7fc22713", "committedDate": "2020-05-19T14:10:17Z", "message": "fix tests and update gene panels to flag off panel variants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74f752ca61453a5a08093a60400f15fd7370b25a", "author": {"user": {"login": "rmadupuri", "name": "Ramya Madupuri"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/74f752ca61453a5a08093a60400f15fd7370b25a", "committedDate": "2020-05-19T14:31:51Z", "message": "update variable names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554", "author": {"user": {"login": "rmadupuri", "name": "Ramya Madupuri"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/20bc0ec0687699719a87f4c78c4813fe7cb7f554", "committedDate": "2020-05-19T14:38:29Z", "message": "Flag the off panel variants as warning"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0Nzk2NTYx", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#pullrequestreview-414796561", "createdAt": "2020-05-19T20:26:18Z", "commit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDoyNjoxOFrOGXxVGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMDozOToyMVrOGXxv1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3ODY0OA==", "bodyText": "Do we still need to check NA at here? Not sure will gene_panel_list contains NA.", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427578648", "createdAt": "2020-05-19T20:26:18Z", "author": {"login": "dippindots"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -1484,16 +1485,22 @@ def checkLine(self, data):\n         if 'Hugo_Symbol' in self.cols:\n             hugo_symbol = data[self.cols.index('Hugo_Symbol')].strip()\n             # treat the empty string or 'Unknown' as a missing value\n-            if hugo_symbol in ('', 'Unknown'):\n+            if hugo_symbol in ('NA', '', 'Unknown'):\n                 hugo_symbol = None\n         if 'Entrez_Gene_Id' in self.cols:\n             entrez_id = data[self.cols.index('Entrez_Gene_Id')].strip()\n             # treat the empty string or 0 as a missing value\n-            if entrez_id in ('', '0'):\n+            if entrez_id in ('NA', '', '0'):\n                 entrez_id = None\n         # validate hugo and entrez together:\n-        self.checkGeneIdentification(hugo_symbol, entrez_id)\n-\n+        normalized_gene = self.checkGeneIdentification(hugo_symbol, entrez_id)\n+        \n+        # validate the gene to make sure its from the targeted panel\n+        if normalized_gene and self.portal.gene_panel_list and data[sample_id_column_index] in sample_ids_panel_dict:\n+            panel_id = sample_ids_panel_dict[data[sample_id_column_index]]\n+            if panel_id in self.portal.gene_panel_list and panel_id != 'NA':", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU3OTg4Mg==", "bodyText": "Should we throw a warning or an error when we cannot parse a normalized_gene?", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427579882", "createdAt": "2020-05-19T20:28:38Z", "author": {"login": "dippindots"}, "path": "core/src/main/scripts/importer/validateData.py", "diffHunk": "@@ -1828,6 +1835,23 @@ def checkValidationColumns(self, data):\n \n         return True\n \n+    def checkOffPanelVariant(self, data, normalized_gene, panel_id, hugo_symbol, entrez_id):\n+        try:\n+            normalized_gene = int(normalized_gene)\n+        except:\n+            pass", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4NTM3Ng==", "bodyText": "Same as the next comment, I don't think we expect to see warnings when validate study_es_0. I don't really understand why this warning shows up since I saw those genes in the gene-panels.json.", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427585376", "createdAt": "2020-05-19T20:39:07Z", "author": {"login": "dippindots"}, "path": "core/src/test/scripts/test_data/study_es_0/result_report.html", "diffHunk": "@@ -1259,6 +1259,13 @@ <h4 class=\"panel-title\">data_mutations_extended.maf</h4>\n                 <td>Line will not be loaded due to the variant classification filter. Filtered types: [Silent, Intron, 3&#39;UTR, 3&#39;Flank, 5&#39;UTR, 5&#39;Flank, IGR, RNA]</td>\n                 <td>Silent</td>\n               </tr>\n+              <tr class=\"warning\">\n+                <td><span class=\"glyphicon glyphicon-warning-sign\" aria-hidden=\"true\"></span><span class=\"sr-only\">Warning</span></td>\n+                <td>10, 11, 16, (9 more)</td>\n+                <td>&ndash;</td>\n+                <td>Off panel variant. Gene symbol not known to the targeted panel.</td>\n+                <td>MSH3, MYB, TP53, (4 more)</td>\n+              </tr>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU4NTQ5NA==", "bodyText": "Are we expecting to see warning when we validate study_es_0? I think study_es_0 should pass the validation without any warnings and errors.", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#discussion_r427585494", "createdAt": "2020-05-19T20:39:21Z", "author": {"login": "dippindots"}, "path": "core/src/test/scripts/system_tests_validate_data.py", "diffHunk": "@@ -93,7 +93,7 @@ def test_exit_status_success(self):\n         # execute main function with arguments provided as if from sys.argv\n         args = validateData.interface(args)\n         exit_status = validateData.main_validate(args)\n-        self.assertEqual(0, exit_status)\n+        self.assertEqual(3, exit_status)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20bc0ec0687699719a87f4c78c4813fe7cb7f554"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bc66621a9bbddac7e33c631f25e462cb9b7ff09", "author": {"user": {"login": "rmadupuri", "name": "Ramya Madupuri"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/9bc66621a9bbddac7e33c631f25e462cb9b7ff09", "committedDate": "2020-05-19T23:16:32Z", "message": "updated tests and reverted html reports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0OTM0OTky", "url": "https://github.com/cBioPortal/cbioportal/pull/7472#pullrequestreview-414934992", "createdAt": "2020-05-20T01:38:52Z", "commit": {"oid": "9bc66621a9bbddac7e33c631f25e462cb9b7ff09"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1780, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}