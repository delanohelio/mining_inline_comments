{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5Mzc1Mjg2", "number": 7301, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODowMjoxMVrODocdQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzoyNzoyN1rODoiOBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNzM1ODc1OnYy", "diffSide": "RIGHT", "path": "service/src/main/java/org/cbioportal/service/impl/GenericAssayServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODowMjoxMVrOF2_3Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxOTowMTozNFrOF3CDYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIxMzcwMw==", "bodyText": "here is where we were relying on order yes?", "url": "https://github.com/cBioPortal/cbioportal/pull/7301#discussion_r393213703", "createdAt": "2020-03-16T18:02:11Z", "author": {"login": "alisman"}, "path": "service/src/main/java/org/cbioportal/service/impl/GenericAssayServiceImpl.java", "diffHunk": "@@ -90,20 +91,26 @@\n \n         List<String> distinctMolecularProfileIds = molecularProfileIds.stream().distinct().sorted().collect(Collectors.toList());\n \n-        List<String> commaSeparatedSampleIdsOfMolecularProfiles = molecularDataRepository\n-            .getCommaSeparatedSampleIdsOfMolecularProfiles(distinctMolecularProfileIds);\n-    \n+        List<MolecularProfileSamples> commaSeparatedSampleIdsOfMolecularProfiles = molecularDataRepository\n+                .getCommaSeparatedSampleIdsOfMolecularProfiles(distinctMolecularProfileIds);\n+\n+        Map<String, MolecularProfileSamples> commaSeparatedSampleIdsOfMolecularProfilesMap = commaSeparatedSampleIdsOfMolecularProfiles\n+                .stream()\n+                .collect(Collectors.toMap(MolecularProfileSamples::getMolecularProfileId, Function.identity()));\n+\n         Map<String, Map<Integer, Integer>> internalSampleIdsMap = new HashMap<>();\n         List<Integer> allInternalSampleIds = new ArrayList<>();\n-        \n+\n         for (int i = 0; i < distinctMolecularProfileIds.size(); i++) {\n-            List<Integer> internalSampleIds = Arrays.stream(commaSeparatedSampleIdsOfMolecularProfiles.get(i).split(\",\"))\n-                .mapToInt(Integer::parseInt).boxed().collect(Collectors.toList());\n+            String molecularProfileId = distinctMolecularProfileIds.get(i);\n+            List<Integer> internalSampleIds = Arrays\n+                    .stream(commaSeparatedSampleIdsOfMolecularProfilesMap.get(molecularProfileId).getSplitSampleIds())\n+                    .mapToInt(Integer::parseInt).boxed().collect(Collectors.toList());\n             HashMap<Integer, Integer> molecularProfileSampleMap = new HashMap<Integer, Integer>();\n             for (int lc = 0; lc < internalSampleIds.size(); lc++) {\n                 molecularProfileSampleMap.put(internalSampleIds.get(lc), lc);\n             }\n-            internalSampleIdsMap.put(distinctMolecularProfileIds.get(i), molecularProfileSampleMap);\n+            internalSampleIdsMap.put(molecularProfileId, molecularProfileSampleMap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "720f7386ff9673b2acdf7907b019f634986c28eb"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI0OTYzNA==", "bodyText": "no. its at line 107", "url": "https://github.com/cBioPortal/cbioportal/pull/7301#discussion_r393249634", "createdAt": "2020-03-16T19:01:34Z", "author": {"login": "kalletlak"}, "path": "service/src/main/java/org/cbioportal/service/impl/GenericAssayServiceImpl.java", "diffHunk": "@@ -90,20 +91,26 @@\n \n         List<String> distinctMolecularProfileIds = molecularProfileIds.stream().distinct().sorted().collect(Collectors.toList());\n \n-        List<String> commaSeparatedSampleIdsOfMolecularProfiles = molecularDataRepository\n-            .getCommaSeparatedSampleIdsOfMolecularProfiles(distinctMolecularProfileIds);\n-    \n+        List<MolecularProfileSamples> commaSeparatedSampleIdsOfMolecularProfiles = molecularDataRepository\n+                .getCommaSeparatedSampleIdsOfMolecularProfiles(distinctMolecularProfileIds);\n+\n+        Map<String, MolecularProfileSamples> commaSeparatedSampleIdsOfMolecularProfilesMap = commaSeparatedSampleIdsOfMolecularProfiles\n+                .stream()\n+                .collect(Collectors.toMap(MolecularProfileSamples::getMolecularProfileId, Function.identity()));\n+\n         Map<String, Map<Integer, Integer>> internalSampleIdsMap = new HashMap<>();\n         List<Integer> allInternalSampleIds = new ArrayList<>();\n-        \n+\n         for (int i = 0; i < distinctMolecularProfileIds.size(); i++) {\n-            List<Integer> internalSampleIds = Arrays.stream(commaSeparatedSampleIdsOfMolecularProfiles.get(i).split(\",\"))\n-                .mapToInt(Integer::parseInt).boxed().collect(Collectors.toList());\n+            String molecularProfileId = distinctMolecularProfileIds.get(i);\n+            List<Integer> internalSampleIds = Arrays\n+                    .stream(commaSeparatedSampleIdsOfMolecularProfilesMap.get(molecularProfileId).getSplitSampleIds())\n+                    .mapToInt(Integer::parseInt).boxed().collect(Collectors.toList());\n             HashMap<Integer, Integer> molecularProfileSampleMap = new HashMap<Integer, Integer>();\n             for (int lc = 0; lc < internalSampleIds.size(); lc++) {\n                 molecularProfileSampleMap.put(internalSampleIds.get(lc), lc);\n             }\n-            internalSampleIdsMap.put(distinctMolecularProfileIds.get(i), molecularProfileSampleMap);\n+            internalSampleIdsMap.put(molecularProfileId, molecularProfileSampleMap);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIxMzcwMw=="}, "originalCommit": {"oid": "720f7386ff9673b2acdf7907b019f634986c28eb"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODI1MTg5OnYy", "diffSide": "RIGHT", "path": "model/src/main/java/org/cbioportal/model/MolecularProfileSamples.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzowNDowOVrOF3Irmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzo1NDoyNFrOF3JoDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM1ODIzNA==", "bodyText": "Maybe check for commaSeparatedSampleIds == null here to.", "url": "https://github.com/cBioPortal/cbioportal/pull/7301#discussion_r393358234", "createdAt": "2020-03-16T23:04:09Z", "author": {"login": "n1zea144"}, "path": "model/src/main/java/org/cbioportal/model/MolecularProfileSamples.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package org.cbioportal.model;\n+\n+import java.io.Serializable;\n+\n+public class MolecularProfileSamples implements Serializable {\n+\n+    private String molecularProfileId;\n+    private String commaSeparatedSampleIds;\n+    private String[] splitSampleIds = null;\n+\n+    public String getMolecularProfileId() {\n+        return molecularProfileId;\n+    }\n+\n+    public void setMolecularProfileId(String molecularProfileId) {\n+        this.molecularProfileId = molecularProfileId;\n+    }\n+\n+    public String getCommaSeparatedSampleIds() {\n+        return commaSeparatedSampleIds;\n+    }\n+\n+    /**\n+     * Set the values for all samples.\n+     * \n+     * @param values: string with list of values, comma (,) separated\n+     */\n+    public void setCommaSeparatedSampleIds(String commaSeparatedSampleIds) {\n+        this.commaSeparatedSampleIds = commaSeparatedSampleIds;\n+    }\n+\n+    /**\n+     * Returns the values attribute split on (,).\n+     * \n+     * Remembers last .split to avoid repeating this costly operation.\n+     * \n+     * @return list of values for all samples\n+     */\n+    public String[] getSplitSampleIds() {\n+        if (splitSampleIds == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "720f7386ff9673b2acdf7907b019f634986c28eb"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3MzcxMA==", "bodyText": "commaSeparatedSampleIds won't be null as this is a record from database query.", "url": "https://github.com/cBioPortal/cbioportal/pull/7301#discussion_r393373710", "createdAt": "2020-03-16T23:54:24Z", "author": {"login": "kalletlak"}, "path": "model/src/main/java/org/cbioportal/model/MolecularProfileSamples.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package org.cbioportal.model;\n+\n+import java.io.Serializable;\n+\n+public class MolecularProfileSamples implements Serializable {\n+\n+    private String molecularProfileId;\n+    private String commaSeparatedSampleIds;\n+    private String[] splitSampleIds = null;\n+\n+    public String getMolecularProfileId() {\n+        return molecularProfileId;\n+    }\n+\n+    public void setMolecularProfileId(String molecularProfileId) {\n+        this.molecularProfileId = molecularProfileId;\n+    }\n+\n+    public String getCommaSeparatedSampleIds() {\n+        return commaSeparatedSampleIds;\n+    }\n+\n+    /**\n+     * Set the values for all samples.\n+     * \n+     * @param values: string with list of values, comma (,) separated\n+     */\n+    public void setCommaSeparatedSampleIds(String commaSeparatedSampleIds) {\n+        this.commaSeparatedSampleIds = commaSeparatedSampleIds;\n+    }\n+\n+    /**\n+     * Returns the values attribute split on (,).\n+     * \n+     * Remembers last .split to avoid repeating this costly operation.\n+     * \n+     * @return list of values for all samples\n+     */\n+    public String[] getSplitSampleIds() {\n+        if (splitSampleIds == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM1ODIzNA=="}, "originalCommit": {"oid": "720f7386ff9673b2acdf7907b019f634986c28eb"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODMwMjc5OnYy", "diffSide": "RIGHT", "path": "persistence/persistence-api/src/main/java/org/cbioportal/persistence/MolecularDataRepository.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzoyNzoyN1rOF3JKmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMzoyNzoyN1rOF3JKmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NjE3MA==", "bodyText": "I've noticed many(maybe all?) places in the code where you convert List<MolecularProfileSamples> to Map<String, MolecularProfileSamples>.  Maybe the signature should be updated to support the return of a Map?", "url": "https://github.com/cBioPortal/cbioportal/pull/7301#discussion_r393366170", "createdAt": "2020-03-16T23:27:27Z", "author": {"login": "n1zea144"}, "path": "persistence/persistence-api/src/main/java/org/cbioportal/persistence/MolecularDataRepository.java", "diffHunk": "@@ -6,14 +6,15 @@\n import org.cbioportal.model.GenericAssayMolecularAlteration;\n import org.cbioportal.model.GenesetMolecularAlteration;\n import org.springframework.cache.annotation.Cacheable;\n+import org.cbioportal.model.MolecularProfileSamples;\n \n public interface MolecularDataRepository {\n \n     @Cacheable(cacheNames = \"GeneralRepositoryCache\", condition = \"@cacheEnabledConfig.getEnabled()\")\n-    String getCommaSeparatedSampleIdsOfMolecularProfile(String molecularProfileId);\n+    MolecularProfileSamples getCommaSeparatedSampleIdsOfMolecularProfile(String molecularProfileId);\n \n     @Cacheable(cacheNames = \"GeneralRepositoryCache\", condition = \"@cacheEnabledConfig.getEnabled()\")\n-    List<String> getCommaSeparatedSampleIdsOfMolecularProfiles(List<String> molecularProfileIds);\n+    List<MolecularProfileSamples> getCommaSeparatedSampleIdsOfMolecularProfiles(List<String> molecularProfileIds);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "720f7386ff9673b2acdf7907b019f634986c28eb"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3605, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}