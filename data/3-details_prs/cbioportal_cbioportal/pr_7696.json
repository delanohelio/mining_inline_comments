{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwNTA4MDY2", "number": 7696, "title": "Added spring profiles for redis and ehcache", "bodyText": "Updated ip addresses for redis servers\nChanged ttl to 0 and added comments\nAdded spring profiles for redis and ehcache", "createdAt": "2020-07-16T20:52:58Z", "url": "https://github.com/cBioPortal/cbioportal/pull/7696", "merged": true, "mergeCommit": {"oid": "a421b2798325215ca8edba790a2cc2b9d978c2e2"}, "closed": true, "closedAt": "2020-07-17T16:59:55Z", "author": {"login": "mandawilson"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1esuGAH2gAyNDUwNTA4MDY2OjVmOGRlZWMyNjFjOWVkMTYzMDM3ODU3MThhMDE3ZjRlODUzMTMxMmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1225LAFqTQ1MDgwOTIwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5f8deec261c9ed16303785718a017f4e8531312b", "author": {"user": {"login": "mandawilson", "name": "Manda Wilson"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/5f8deec261c9ed16303785718a017f4e8531312b", "committedDate": "2020-07-16T12:50:04Z", "message": "updated ip addresses for redis servers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d99c796e81d916fc945294718089fe9adadf00d1", "author": {"user": {"login": "mandawilson", "name": "Manda Wilson"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/d99c796e81d916fc945294718089fe9adadf00d1", "committedDate": "2020-07-16T12:50:04Z", "message": "changed ttl to 0 and added comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1900044448a552fcaefaa049a9de6e1210a3487", "author": {"user": {"login": "mandawilson", "name": "Manda Wilson"}}, "url": "https://github.com/cBioPortal/cbioportal/commit/c1900044448a552fcaefaa049a9de6e1210a3487", "committedDate": "2020-07-16T20:49:13Z", "message": "added spring profiles for redis and ehcache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwODA5MjA3", "url": "https://github.com/cBioPortal/cbioportal/pull/7696#pullrequestreview-450809207", "createdAt": "2020-07-17T16:47:37Z", "commit": {"oid": "c1900044448a552fcaefaa049a9de6e1210a3487"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNjo0NzozN1rOGzaBdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNjo1NjoxNVrOGzaR2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU1NjkxNw==", "bodyText": "typos : ehache-heap, ehache-disk, ehache-hybrid\nwe can fix this in a follow up PR", "url": "https://github.com/cBioPortal/cbioportal/pull/7696#discussion_r456556917", "createdAt": "2020-07-17T16:47:37Z", "author": {"login": "sheridancbio"}, "path": "docs/portal.properties-Reference.md", "diffHunk": "@@ -344,22 +344,22 @@ This gene set will add the following in the query box:\n # Ehcache Settings\n cBioPortal is supported on the backend with Ehcache. The configuration, size, and location of these caches are configurable from within portal.properties through the following properties.\n \n-The cache type is set using `ehcache.cache_type`. Valid values are `none`, `heap` (heap-only), `disk` (disk-only), and `hybrid` (disk + heap). By default, `ehcache.cache_type` is set to `none` which disables the cache. When the cache is disabled, no responses will be stored in the cache. \n+The cache type is set using `persistence.cache_type`. Valid values are `no-cache`, `redis` (redis), `ehache-heap` (ehcache heap-only), `ehache-disk` (ehcache disk-only), and `ehache-hybrid` (ehcache disk + heap). By default, `persistence.cache_type` is set to `no-cache` which disables the cache. When the cache is disabled, no responses will be stored in the cache.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1900044448a552fcaefaa049a9de6e1210a3487"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU2MDM2Mg==", "bodyText": "we still need to work these beans out", "url": "https://github.com/cBioPortal/cbioportal/pull/7696#discussion_r456560362", "createdAt": "2020-07-17T16:54:50Z", "author": {"login": "sheridancbio"}, "path": "persistence/persistence-api/src/main/resources/applicationContext-ehcache.xml", "diffHunk": "@@ -9,44 +9,51 @@\n     http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd\n     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd\">\n \n-<!--\n-    <cache:annotation-driven cache-manager=\"ehcacheCacheManager\" key-generator=\"customKeyGenerator\"/>\n--->\n-    <bean id=\"cacheEnabledConfig\" class=\"org.cbioportal.persistence.CacheEnabledConfig\">\n-        <constructor-arg value=\"${ehcache.cache_type:none}\"/>\n-    </bean>\n-\n-    <bean id=\"customEhCacheProvider\" class=\"org.cbioportal.persistence.util.CustomEhCachingProvider\"/>\n-\n-    <bean id=\"getEhcacheCacheManager\" class=\"org.springframework.beans.factory.config.MethodInvokingFactoryBean\">\n-        <property name=\"targetObject\" ref=\"customEhCacheProvider\" />\n-        <property name=\"targetMethod\" value=\"getCacheManager\" />\n-    </bean>\n-\n-    <bean id=\"ehcacheCacheManager\" class=\"org.springframework.cache.jcache.JCacheCacheManager\">\n-        <property name=\"cacheManager\" ref=\"getEhcacheCacheManager\"/>\n-    </bean>\n-\n-    <bean id=\"customKeyGenerator\" class=\"org.cbioportal.persistence.util.CustomKeyGenerator\"/>\n-\n-    <bean id=\"ehcacheStatistics\" class=\"org.cbioportal.persistence.util.EhCacheStatistics\">\n-        <constructor-arg ref=\"getEhcacheCacheManager\"/>\n-    </bean>\n-\n-    <bean class=\"org.springframework.beans.factory.config.MethodInvokingFactoryBean\">\n-        <property name=\"staticMethod\" value=\"org.cbioportal.persistence.util.CacheEventLogger.setCacheStatistics\" />\n-        <property name=\"arguments\">\n-            <list><ref bean=\"ehcacheStatistics\"/></list>\n-        </property>\n-    </bean>\n-\n-    <bean id=\"generalRepositoryCacheResolver\" class=\"org.springframework.cache.interceptor.NamedCacheResolver\">\n-        <constructor-arg index=\"0\" ref=\"ehcacheCacheManager\"/>\n-        <constructor-arg index=\"1\" value=\"GeneralRepositoryCache\"/>\n-    </bean>\n-\n-    <bean id=\"staticRepositoryCacheOneResolver\" class=\"org.springframework.cache.interceptor.NamedCacheResolver\">\n-        <constructor-arg index=\"0\" ref=\"ehcacheCacheManager\"/>\n-        <constructor-arg index=\"1\" value=\"StaticRepositoryCacheOne\"/>\n-    </bean>\n+    <!--\n+        EhCacheStatistics is autowired, and requires a javax.cache.CacheManager\n+        so all (or most) of these beans need to be created even if ehcache is not running\n+    -->\n+    <!--beans profile=\"ehcache-disk,ehcache-heap,ehcache-hybrid\"-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1900044448a552fcaefaa049a9de6e1210a3487"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU2MTExMw==", "bodyText": "we need to work out the wiring of a cache statistics service (maybe a stub) for redis", "url": "https://github.com/cBioPortal/cbioportal/pull/7696#discussion_r456561113", "createdAt": "2020-07-17T16:56:15Z", "author": {"login": "sheridancbio"}, "path": "persistence/persistence-api/src/main/resources/applicationContext-rediscache.xml", "diffHunk": "@@ -9,63 +9,40 @@\n     http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd\n     http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd\">\n \n-    <cache:annotation-driven cache-manager=\"redisCacheManager\" key-generator=\"customKeyGenerator\"/>\n+    <beans profile=\"redis\">\n \n-    <bean id=\"cacheEnabledConfig\" class=\"org.cbioportal.persistence.CacheEnabledConfig\">\n-        <constructor-arg value=\"${ehcache.cache_type:none}\"/>\n-    </bean>\n+        <cache:annotation-driven cache-manager=\"redisCacheManager\" key-generator=\"customKeyGenerator\"/>\n \n-    <bean id=\"customRedisCacheProvider\" class=\"org.cbioportal.persistence.util.CustomRedisCachingProvider\"/>\n+        <bean id=\"cacheEnabledConfig\" class=\"org.cbioportal.persistence.CacheEnabledConfig\">\n+            <constructor-arg value=\"${persistence.cache_type:no-cache}\"/>\n+        </bean>\n \n-    <bean id=\"redissonClient\" class=\"org.springframework.beans.factory.config.MethodInvokingFactoryBean\">\n-        <property name=\"targetObject\" ref=\"customRedisCacheProvider\" />\n-        <property name=\"targetMethod\" value=\"getRedissionClient\" />\n-    </bean>\n+        <bean id=\"customRedisCacheProvider\" class=\"org.cbioportal.persistence.util.CustomRedisCachingProvider\"/>\n \n-    <bean id=\"redisCacheManager\" class=\"org.springframework.beans.factory.config.MethodInvokingFactoryBean\">\n-        <property name=\"targetObject\" ref=\"customRedisCacheProvider\" />\n-        <property name=\"targetMethod\" value=\"getCacheManager\" />\n-        <property name=\"arguments\">\n-            <list><ref bean=\"redissonClient\"/></list>\n-        </property>\n-    </bean>\n+        <bean id=\"redissonClient\" class=\"org.springframework.beans.factory.config.MethodInvokingFactoryBean\">\n+            <property name=\"targetObject\" ref=\"customRedisCacheProvider\" />\n+            <property name=\"targetMethod\" value=\"getRedissionClient\" />\n+        </bean>\n \n-    <bean id=\"generalRepositoryCacheResolver\" class=\"org.springframework.cache.interceptor.NamedCacheResolver\">\n-        <constructor-arg index=\"0\" ref=\"redisCacheManager\"/>\n-        <constructor-arg index=\"1\" value=\"${app.name:cbioportal}GeneralRepositoryCache\"/>\n-    </bean>\n+        <bean id=\"redisCacheManager\" class=\"org.springframework.beans.factory.config.MethodInvokingFactoryBean\">\n+            <property name=\"targetObject\" ref=\"customRedisCacheProvider\" />\n+            <property name=\"targetMethod\" value=\"getCacheManager\" />\n+            <property name=\"arguments\">\n+                <list><ref bean=\"redissonClient\"/></list>\n+            </property>\n+        </bean>\n \n-    <bean id=\"staticRepositoryCacheOneResolver\" class=\"org.springframework.cache.interceptor.NamedCacheResolver\">\n-        <constructor-arg index=\"0\" ref=\"redisCacheManager\"/>\n-        <constructor-arg index=\"1\" value=\"${app.name:cbioportal}StaticRepositoryCacheOne\"/>\n-    </bean>\n+        <bean id=\"generalRepositoryCacheResolver\" class=\"org.springframework.cache.interceptor.NamedCacheResolver\">\n+            <constructor-arg index=\"0\" ref=\"redisCacheManager\"/>\n+            <constructor-arg index=\"1\" value=\"${app.name:cbioportal}GeneralRepositoryCache\"/>\n+        </bean>\n \n-<!--\n-    Note : the following bean is missing arguments to the constructor\n-    <bean id=\"cacheManager\" class=\"org.redisson.spring.cache.RedissonSpringCacheManager\">\n-        <property name=\"cacheManager\" ref=\"getCacheManager\"/>\n-    </bean>\n+        <bean id=\"staticRepositoryCacheOneResolver\" class=\"org.springframework.cache.interceptor.NamedCacheResolver\">\n+            <constructor-arg index=\"0\" ref=\"redisCacheManager\"/>\n+            <constructor-arg index=\"1\" value=\"${app.name:cbioportal}StaticRepositoryCacheOne\"/>\n+        </bean>\n \n-    <bean id=\"springCacheManager\" class=\"org.springframework.cache.CacheManager\">\n-        <property name=\"cacheManager\" ref=\"getCacheManager\"/>\n-    </bean>\n-\n-    <bean id=\"cacheManager\" class=\"org.springframework.cache.jcache.JCacheCacheManager\">\n-        <property name=\"cacheManager\" ref=\"getCacheManager\"/>\n-    </bean>\n-\n--->\n     <bean id=\"customKeyGenerator\" class=\"org.cbioportal.persistence.util.CustomKeyGenerator\"/>\n \n-    <!--bean id=\"ehCacheStatistics\" class=\"org.cbioportal.persistence.util.EhCacheStatistics\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1900044448a552fcaefaa049a9de6e1210a3487"}, "originalPosition": 77}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1651, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}