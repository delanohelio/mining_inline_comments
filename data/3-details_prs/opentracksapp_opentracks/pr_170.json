{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0Njc1OTY4", "number": 170, "title": "TrackDetailActivity starts an actual recording and a stopped recording can be resumed. Fixes #103 and #11", "bodyText": "Describe the pull request\nTrackDetailActivity starts an actual recording.\nAlso, from TrackDetailActivity menu you can resume the track you are seeing.\nPossibly there are things to improve :D\nLink to the the issue\n#103\n#11\nLicense agreement\nBy opening this pull request, you are providing your contribution under the Apache License 2.0 (see LICENSE.md).", "createdAt": "2020-03-27T10:37:44Z", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170", "merged": true, "mergeCommit": {"oid": "d93c2ec5f39f3672fe1c5300eb7cc5dfdfddbe58"}, "closed": true, "closedAt": "2020-03-30T17:25:24Z", "author": {"login": "rgmf"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR4dyigFqTM4MzEwMDI4OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSx5kigFqTM4NDA3MjgyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTAwMjg4", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#pullrequestreview-383100288", "createdAt": "2020-03-27T18:20:56Z", "commit": {"oid": "c400e8423f8a9596804ee356d5e7dca0d20cc8ce"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxODoyMDo1NlrOF88-yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxODozMzozMlrOF89Zlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ1Nzk5NQ==", "bodyText": ":)\ntrue &&", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#discussion_r399457995", "createdAt": "2020-03-27T18:20:56Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/TrackDetailActivity.java", "diffHunk": "@@ -416,9 +453,12 @@ private void updateMenuItems(boolean isPaused) {\n         String title;\n         if (isRecording()) {\n             title = getString(isPaused ? R.string.generic_paused : R.string.generic_recording);\n+            resumeMenuItem.setVisible(false);\n         } else {\n             Track track = contentProviderUtils.getTrack(trackId);\n             title = track != null ? track.getName() : \"\";\n+            // Only visible if there aren't other tracks that is recording.\n+            resumeMenuItem.setVisible(true && recordingTrackId == -1L);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c400e8423f8a9596804ee356d5e7dca0d20cc8ce"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ1OTE1NQ==", "bodyText": "I am not sure the log message is correct; I guess it is more could not get service.", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#discussion_r399459155", "createdAt": "2020-03-27T18:23:00Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/TrackDetailActivity.java", "diffHunk": "@@ -89,6 +92,27 @@ public void run() {\n                     trackController.update(isRecording(), recordingTrackPaused);\n                 }\n             });\n+\n+            if (recordingTrackId == -1L) {\n+                TrackRecordingServiceInterface service = trackRecordingServiceConnection.getServiceIfBound();\n+                if (service == null) {\n+                    Log.d(TAG, \"service not available to start gps or a new recording\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c400e8423f8a9596804ee356d5e7dca0d20cc8ce"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ2MTk1MA==", "bodyText": "I am not a fan of these assignments.\nThey tend to look like boolean comparisions.\nWould you use separate assignments?", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#discussion_r399461950", "createdAt": "2020-03-27T18:28:06Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/TrackDetailActivity.java", "diffHunk": "@@ -89,6 +92,27 @@ public void run() {\n                     trackController.update(isRecording(), recordingTrackPaused);\n                 }\n             });\n+\n+            if (recordingTrackId == -1L) {\n+                TrackRecordingServiceInterface service = trackRecordingServiceConnection.getServiceIfBound();\n+                if (service == null) {\n+                    Log.d(TAG, \"service not available to start gps or a new recording\");\n+                    return;\n+                }\n+\n+                int msg;\n+                if (trackId == -1L) {\n+                    trackId = recordingTrackId = service.startNewTrack();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c400e8423f8a9596804ee356d5e7dca0d20cc8ce"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ2Mjc1NQ==", "bodyText": "Please document that trackId == -1 leads to a new track.\nThere should be at least a comment on top of the class.", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#discussion_r399462755", "createdAt": "2020-03-27T18:29:30Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/TrackDetailActivity.java", "diffHunk": "@@ -89,6 +92,27 @@ public void run() {\n                     trackController.update(isRecording(), recordingTrackPaused);\n                 }\n             });\n+\n+            if (recordingTrackId == -1L) {\n+                TrackRecordingServiceInterface service = trackRecordingServiceConnection.getServiceIfBound();\n+                if (service == null) {\n+                    Log.d(TAG, \"service not available to start gps or a new recording\");\n+                    return;\n+                }\n+\n+                int msg;\n+                if (trackId == -1L) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c400e8423f8a9596804ee356d5e7dca0d20cc8ce"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ2MzQ3MA==", "bodyText": "Could you add a new line before?\nIt looks like the stuff before handles waypoints.", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#discussion_r399463470", "createdAt": "2020-03-27T18:30:59Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/TrackDetailActivity.java", "diffHunk": "@@ -387,9 +421,12 @@ private void handleIntent(Intent intent) {\n                 return;\n             }\n             trackId = waypoint.getTrackId();\n+            if (trackId == -1L) {\n+                finish();\n+                return;\n+            }\n         }\n         if (trackId == -1L) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c400e8423f8a9596804ee356d5e7dca0d20cc8ce"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ2NDg1NA==", "bodyText": "I would go for an Log.e()", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#discussion_r399464854", "createdAt": "2020-03-27T18:33:32Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/services/TrackRecordingService.java", "diffHunk": "@@ -352,6 +352,26 @@ long startNewTrack() {\n         return trackId;\n     }\n \n+    /**\n+     * Resumes the track identified by trackId.\n+     *\n+     * @param trackId\n+     */\n+    void resumeTrack(long trackId) {\n+        Track track = contentProviderUtils.getTrack(trackId);\n+        if (track == null) {\n+            Log.d(TAG, \"Ignore resumeTrack. Track \" + trackId + \" does not exists.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c400e8423f8a9596804ee356d5e7dca0d20cc8ce"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c400e8423f8a9596804ee356d5e7dca0d20cc8ce", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/c400e8423f8a9596804ee356d5e7dca0d20cc8ce", "committedDate": "2020-03-27T10:38:08Z", "message": "TrackDetailActivity starts an actual recording and a stopped recording can be resumed. Fixes #103 and #11."}, "afterCommit": {"oid": "0f9b9ad225b5402a3c49377de9c1d00f59c43567", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/0f9b9ad225b5402a3c49377de9c1d00f59c43567", "committedDate": "2020-03-29T16:10:46Z", "message": "TrackDetailActivity starts an actual recording and a stopped recording can be resumed. Fixes #103 and #11."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f9b9ad225b5402a3c49377de9c1d00f59c43567", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/0f9b9ad225b5402a3c49377de9c1d00f59c43567", "committedDate": "2020-03-29T16:10:46Z", "message": "TrackDetailActivity starts an actual recording and a stopped recording can be resumed. Fixes #103 and #11."}, "afterCommit": {"oid": "f1a5af9fbc22bdacefed467059f4425f41a246e5", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/f1a5af9fbc22bdacefed467059f4425f41a246e5", "committedDate": "2020-03-29T16:25:35Z", "message": "TrackDetailActivity starts an actual recording and a stopped recording can be resumed. Fixes #103 and #11."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNDMzNDY3", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#pullrequestreview-383433467", "createdAt": "2020-03-29T17:12:26Z", "commit": {"oid": "f1a5af9fbc22bdacefed467059f4425f41a246e5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQxNzoxMjoyN1rOF9TcKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQxNzoxMjoyN1rOF9TcKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgyNTk2MQ==", "bodyText": "\"an existing one\"", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#discussion_r399825961", "createdAt": "2020-03-29T17:12:27Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/TrackDetailActivity.java", "diffHunk": "@@ -43,14 +45,15 @@\n import de.dennisguse.opentracks.fragments.ConfirmDeleteDialogFragment;\n import de.dennisguse.opentracks.fragments.StatsFragment;\n import de.dennisguse.opentracks.services.TrackRecordingServiceConnection;\n+import de.dennisguse.opentracks.services.TrackRecordingServiceInterface;\n import de.dennisguse.opentracks.settings.SettingsActivity;\n import de.dennisguse.opentracks.util.IntentUtils;\n import de.dennisguse.opentracks.util.PreferencesUtils;\n import de.dennisguse.opentracks.util.TrackIconUtils;\n import de.dennisguse.opentracks.util.TrackUtils;\n \n /**\n- * An activity to show the track detail.\n+ * An activity to show the track detail, record a new track or resumes an existed one.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1a5af9fbc22bdacefed467059f4425f41a246e5"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNDMzNzUz", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#pullrequestreview-383433753", "createdAt": "2020-03-29T17:15:26Z", "commit": {"oid": "f1a5af9fbc22bdacefed467059f4425f41a246e5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQxNzoxNToyN1rOF9TdgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQxNzoxNToyN1rOF9TdgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgyNjMwNA==", "bodyText": "Unused", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#discussion_r399826304", "createdAt": "2020-03-29T17:15:27Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/fragments/StatsFragment.java", "diffHunk": "@@ -112,6 +112,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n \n     private TextView totalTimeValueView;\n     private final Runnable updateUIeachSecond = new Runnable() {\n+        long i = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1a5af9fbc22bdacefed467059f4425f41a246e5"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1a5af9fbc22bdacefed467059f4425f41a246e5", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/f1a5af9fbc22bdacefed467059f4425f41a246e5", "committedDate": "2020-03-29T16:25:35Z", "message": "TrackDetailActivity starts an actual recording and a stopped recording can be resumed. Fixes #103 and #11."}, "afterCommit": {"oid": "3b615385cd0905a88cd3cc61d9bcfaa312394a00", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/3b615385cd0905a88cd3cc61d9bcfaa312394a00", "committedDate": "2020-03-29T17:36:45Z", "message": "TrackDetailActivity starts an actual recording and a stopped recording can be resumed. Fixes #103 and #11."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b615385cd0905a88cd3cc61d9bcfaa312394a00", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/3b615385cd0905a88cd3cc61d9bcfaa312394a00", "committedDate": "2020-03-29T17:36:45Z", "message": "TrackDetailActivity starts an actual recording and a stopped recording can be resumed. Fixes #103 and #11."}, "afterCommit": {"oid": "dc7c94f24bfba86eb3f37020f77102704d873f67", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/dc7c94f24bfba86eb3f37020f77102704d873f67", "committedDate": "2020-03-29T17:54:24Z", "message": "TrackDetailActivity starts an actual recording and a stopped recording can be resumed. Fixes #103 and #11."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc7c94f24bfba86eb3f37020f77102704d873f67", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/dc7c94f24bfba86eb3f37020f77102704d873f67", "committedDate": "2020-03-29T17:54:24Z", "message": "TrackDetailActivity starts an actual recording and a stopped recording can be resumed. Fixes #103 and #11."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MDIxODEy", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#pullrequestreview-384021812", "createdAt": "2020-03-30T16:22:21Z", "commit": {"oid": "dc7c94f24bfba86eb3f37020f77102704d873f67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNjoyMjoyMlrOF9xzVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNjoyMjoyMlrOF9xzVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDMyMzQxNQ==", "bodyText": "Why was finish() removed?\nThe activity should not start if it got an invalid parameter, right?", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#discussion_r400323415", "createdAt": "2020-03-30T16:22:22Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/TrackDetailActivity.java", "diffHunk": "@@ -387,9 +428,13 @@ private void handleIntent(Intent intent) {\n                 return;\n             }\n             trackId = waypoint.getTrackId();\n+            if (trackId == -1L) {\n+                finish();\n+                return;\n+            }\n         }\n+\n         if (trackId == -1L) {\n-            finish();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc7c94f24bfba86eb3f37020f77102704d873f67"}, "originalPosition": 122}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MDcyODI1", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/170#pullrequestreview-384072825", "createdAt": "2020-03-30T17:24:57Z", "commit": {"oid": "dc7c94f24bfba86eb3f37020f77102704d873f67"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2295, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}