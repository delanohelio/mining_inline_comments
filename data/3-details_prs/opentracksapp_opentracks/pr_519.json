{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMDQ5NjEy", "number": 519, "title": "Import marker photos", "bodyText": "Describe the pull request\nThree bugs fixed:\n\nImport marker with photos didn't saved the photos.\nEdit marker could leave not linked photos in track directory.\nDelete marker didn't work.\n\nLink to the the issue\n#514\nLicense agreement\nBy opening this pull request, you are providing your contribution under the Apache License 2.0 (see LICENSE.md).", "createdAt": "2020-11-14T19:25:50Z", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/519", "merged": true, "mergeCommit": {"oid": "974baaf611ff5970f2ab83b32b4bcd1392eef20b"}, "closed": true, "closedAt": "2020-11-17T21:02:27Z", "author": {"login": "rgmf"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcx0MEAFqTUzMDgwNjk0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddf_NKABqjQwMDc1MDYyNTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODA2OTQ5", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/519#pullrequestreview-530806949", "createdAt": "2020-11-15T15:04:53Z", "commit": {"oid": "eb9889c763739fb4a67c3c475631f8fb45a28b5a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQxNTowNDo1M1rOHzgbyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQxNTowOTowMFrOHzgdnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc3MDgyNw==", "bodyText": "This try-catch is not doing anything.\nIs it not necessary to cleanup the failed import on exception?", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/519#discussion_r523770827", "createdAt": "2020-11-15T15:04:53Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/io/file/importer/KmzTrackImporter.java", "diffHunk": "@@ -69,20 +68,18 @@ public KmzTrackImporter(Context context, Uri uriFile) {\n     public Track.Id importFile(InputStream inputStream) {\n         Track.Id trackId;\n \n-        if (!copyKmzImages()) {\n-            cleanImport(context, importTrackId);\n-            return null;\n-        }\n-\n         try {\n             trackId = findAndParseKmlFile(inputStream);\n         } catch (Exception e) {\n-            cleanImport(context, importTrackId);\n             throw e;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9889c763739fb4a67c3c475631f8fb45a28b5a"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc3MDk4NQ==", "bodyText": "I guess this should not happen.\nWe could improve this by making findAndParseKmlFile to always throw an exception if it would not return a trackId.", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/519#discussion_r523770985", "createdAt": "2020-11-15T15:06:13Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/io/file/importer/KmzTrackImporter.java", "diffHunk": "@@ -69,20 +68,18 @@ public KmzTrackImporter(Context context, Uri uriFile) {\n     public Track.Id importFile(InputStream inputStream) {\n         Track.Id trackId;\n \n-        if (!copyKmzImages()) {\n-            cleanImport(context, importTrackId);\n-            return null;\n-        }\n-\n         try {\n             trackId = findAndParseKmlFile(inputStream);\n         } catch (Exception e) {\n-            cleanImport(context, importTrackId);\n             throw e;\n         }\n \n         if (trackId == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9889c763739fb4a67c3c475631f8fb45a28b5a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc3MTA1Ng==", "bodyText": "fileNameUri should be @nonnull and the null check should be done by the caller (if needed).", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/519#discussion_r523771056", "createdAt": "2020-11-15T15:06:47Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/util/FileUtils.java", "diffHunk": "@@ -289,6 +289,30 @@ public static File getPhotoFileIfExists(Context context, Track.Id trackId, Uri u\n         return file;\n     }\n \n+    /**\n+     * Builds interval photo file object for fileNameUri Uri.\n+     *\n+     * @param context     the Context.\n+     * @param trackId     the id of the Track.\n+     * @param fileNameUri the file name uri.\n+     * @return            file object or null.\n+     */\n+    public static File buildInternalPhotoFile(Context context, Track.Id trackId, Uri fileNameUri) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9889c763739fb4a67c3c475631f8fb45a28b5a"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzc3MTI5Mg==", "bodyText": "Attribute must be removed completely (it is always null) and we have an if (importTrackId == null) on this class.", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/519#discussion_r523771292", "createdAt": "2020-11-15T15:09:00Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/io/file/importer/AbstractFileTrackImporter.java", "diffHunk": "@@ -104,11 +104,6 @@\n         this.recordingDistanceInterval = PreferencesUtils.getRecordingDistanceInterval(context);\n     }\n \n-    AbstractFileTrackImporter(Context context, ContentProviderUtils contentProviderUtils, Track.Id importTrackId) {\n-        this(context, contentProviderUtils);\n-        this.importTrackId = importTrackId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9889c763739fb4a67c3c475631f8fb45a28b5a"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNTk5NDE4", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/519#pullrequestreview-530599418", "createdAt": "2020-11-14T19:29:34Z", "commit": {"oid": "eb9889c763739fb4a67c3c475631f8fb45a28b5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxOToyOTozNFrOHzNGtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxOToyOTozNFrOHzNGtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ1NDEzNA==", "bodyText": "@dennisguse I've removed this but I don't understand... If you selected all markers (markerIds.length == viewBinding.markerList.getCount()) then markerIds was set to null and no deletion was do.\nIs there something I don't get here?", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/519#discussion_r523454134", "createdAt": "2020-11-14T19:29:34Z", "author": {"login": "rgmf"}, "path": "src/main/java/de/dennisguse/opentracks/MarkerListActivity.java", "diffHunk": "@@ -237,9 +237,6 @@ private boolean handleContextItem(int itemId, long... longMarkerIds) {\n                 }\n                 return true;\n             case R.id.list_context_menu_delete:\n-                if (markerIds.length > 1 && markerIds.length == viewBinding.markerList.getCount()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb9889c763739fb4a67c3c475631f8fb45a28b5a"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f195ef5663012d950ac696b17129398e63135b1", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/2f195ef5663012d950ac696b17129398e63135b1", "committedDate": "2020-11-15T16:03:28Z", "message": "Cleanup DeleteMarkerDialogFragment."}, "afterCommit": {"oid": "607ac91440bb499cc2527f9a3754137a6439b571", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/607ac91440bb499cc2527f9a3754137a6439b571", "committedDate": "2020-11-15T16:26:30Z", "message": "Cleanup DeleteMarkerDialogFragment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4b2f2dc7fde1c18b40d679da9fb9dc853587655", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/f4b2f2dc7fde1c18b40d679da9fb9dc853587655", "committedDate": "2020-11-17T20:56:45Z", "message": "Marker Bugfixes: markers deletion didn't work and track import didn't include marker's photos. Fixes #514.\nMarker edition bugfixed: orphan photos are deleted."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c4c1b503512a3a1085e77f9839804a564baa68f", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/3c4c1b503512a3a1085e77f9839804a564baa68f", "committedDate": "2020-11-15T17:09:20Z", "message": "Cleanup."}, "afterCommit": {"oid": "f4b2f2dc7fde1c18b40d679da9fb9dc853587655", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/f4b2f2dc7fde1c18b40d679da9fb9dc853587655", "committedDate": "2020-11-17T20:56:45Z", "message": "Marker Bugfixes: markers deletion didn't work and track import didn't include marker's photos. Fixes #514.\nMarker edition bugfixed: orphan photos are deleted."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2217, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}