{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNDYxOTYz", "number": 178, "title": "Importing creates content:// for attached pictures and exporting with\u2026", "bodyText": "\u2026out points bug fixed. Fixes #166 and #176.\nDescribe the pull request\n\"Import all\" option now creates content:// for attached pictures instead of file://\nAlso, \"Export all\" option doesn't results in a null exception when a file without points is exported.\nLink to the the issue\n#166\n#176\nLicense agreement\nBy opening this pull request, you are providing your contribution under the Apache License 2.0 (see LICENSE.md).", "createdAt": "2020-04-07T19:36:33Z", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/178", "merged": true, "mergeCommit": {"oid": "6d800caab13a1dae59898c99813d02a1e3c4a154"}, "closed": true, "closedAt": "2020-04-10T12:42:12Z", "author": {"login": "rgmf"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVqqlUgBqjMyMTQ5MzQ0MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWQcTsgFqTM5MTQyMjAwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "29f145bbe6f9b45ea6d35ff34736dac4a6b1ebcb", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/29f145bbe6f9b45ea6d35ff34736dac4a6b1ebcb", "committedDate": "2020-04-07T19:34:17Z", "message": "Importing creates content:// for attached pictures and exporting without points bug fixed. Fixes #166 and #176."}, "afterCommit": {"oid": "4e8496fba82c488a8354411da27eb44121f0ea03", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/4e8496fba82c488a8354411da27eb44121f0ea03", "committedDate": "2020-04-08T16:42:07Z", "message": "Importing creates content:// for attached pictures. Also, exporting without points bug fixed and images href contains relative link. Fixes #166 and #176."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e8496fba82c488a8354411da27eb44121f0ea03", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/4e8496fba82c488a8354411da27eb44121f0ea03", "committedDate": "2020-04-08T16:42:07Z", "message": "Importing creates content:// for attached pictures. Also, exporting without points bug fixed and images href contains relative link. Fixes #166 and #176."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTc1MDU1", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/178#pullrequestreview-390175055", "createdAt": "2020-04-08T17:17:29Z", "commit": {"oid": "4e8496fba82c488a8354411da27eb44121f0ea03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxNzoyOVrOGC5G0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxNzoyOVrOGC5G0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NTk3MQ==", "bodyText": "I know it was not handled before, but what happens if the URL is invalid?", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/178#discussion_r405685971", "createdAt": "2020-04-08T17:17:29Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/io/file/exporter/KmlTrackWriter.java", "diffHunk": "@@ -345,7 +347,7 @@ private void writePhotoOverlay(String name, String category, String description,\n             writeCategory(category);\n \n             if (exportPhotos) {\n-                printWriter.println(\"<Icon><href>\" + Uri.decode(photoUrl) + \"</href></Icon>\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e8496fba82c488a8354411da27eb44121f0ea03"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTc1ODQw", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/178#pullrequestreview-390175840", "createdAt": "2020-04-08T17:18:28Z", "commit": {"oid": "4e8496fba82c488a8354411da27eb44121f0ea03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxODoyOFrOGC5JZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxODoyOFrOGC5JZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NjYzMA==", "bodyText": "Better use: \"\"  + photoUri to avoid NullPointer.", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/178#discussion_r405686630", "createdAt": "2020-04-08T17:18:28Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/io/file/importer/AbstractFileTrackImporter.java", "diffHunk": "@@ -372,9 +372,13 @@ protected String getPhotoUrl(String fileName) {\n         if (importTrackId == -1L) {\n             return null;\n         }\n+\n         File dir = FileUtils.getPhotoDir(context, importTrackId);\n         File file = new File(dir, fileName);\n-        return Uri.fromFile(file).toString();\n+\n+        Uri photoUri = FileUtils.getUriForFile(context, file);\n+\n+        return photoUri.toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e8496fba82c488a8354411da27eb44121f0ea03"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTc2MzU4", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/178#pullrequestreview-390176358", "createdAt": "2020-04-08T17:19:11Z", "commit": {"oid": "4e8496fba82c488a8354411da27eb44121f0ea03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxOToxMVrOGC5LHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNzoxOToxMVrOGC5LHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NzA3MQ==", "bodyText": "Uri parsing might fail and there might be no path.\nAnd as we are importing here something from somewhere, we should check this carefully.", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/178#discussion_r405687071", "createdAt": "2020-04-08T17:19:11Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/io/file/importer/KmlFileTrackImporter.java", "diffHunk": "@@ -186,9 +186,9 @@ private void onWaypointEnd() throws SAXException {\n             return;\n         }\n \n+        // If there is photoUrl it has to be changed because that url in kml file isn't a valid content:// to the imported one.\n         if (photoUrl != null) {\n-            Uri uri = Uri.parse(photoUrl);\n-            photoUrl = getPhotoUrl(uri.getLastPathSegment());\n+            photoUrl = getPhotoUrl(Uri.parse(photoUrl).getLastPathSegment());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e8496fba82c488a8354411da27eb44121f0ea03"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1ec4293881cd446d4dc1128ad81d5c78fbe474c", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/a1ec4293881cd446d4dc1128ad81d5c78fbe474c", "committedDate": "2020-04-09T09:34:52Z", "message": "Avoid NullPointer in creating photoUrl when importing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cecdc164a7f02626fc8d2f47c647b3e45a5edbd8", "author": {"user": {"login": "dennisguse", "name": "Dennis Guse"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/cecdc164a7f02626fc8d2f47c647b3e45a5edbd8", "committedDate": "2020-04-10T08:27:07Z", "message": "While importing photos, check url carefully.\n\n(cherry picked from commit 309c96e4789bd7623b84720a8c8f2bf297c95d59)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNDIyMDA3", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/178#pullrequestreview-391422007", "createdAt": "2020-04-10T12:41:49Z", "commit": {"oid": "cecdc164a7f02626fc8d2f47c647b3e45a5edbd8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2301, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}