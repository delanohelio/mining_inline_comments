{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MTQxNjUy", "number": 162, "title": "Share pictures from marker.", "bodyText": "Fixes #89.\nDescribe the pull request\nI added a new menu option in MarkerDetailFragment that only is visible in markers with photo/image. This option can be used to share the photo/image of a marker.\nAlso, I added new strings in english, spanish and catalan languages for images shared (a subject and a text).\nI would like to point out a issue that I think you have to think about:\nI would like to point out an issue that I think you have to think about: I've added a new method in IntentUtils that can be used to share an image but nobody avoid that somebody use this method for share any other file because the only thing it needs is a URI (and an URI can be any kind of file). Do you think, this method should be test that URI is a file before to share, something like that:\npublic static Intent newShareImageIntent(Context context, Uri uri) {\n        if (uri is not an image) {\n                throw new RuntimeException(\"The file to share has to be an image.\");\n        }\n\n        ...\n}\n\nI thought on that but I'd like to know what do you think.\nLink to the the issue\n#89\nLicense agreement\nBy opening this pull request, you are providing your contribution under the Apache License 2.0 (see LICENSE.md).", "createdAt": "2020-03-16T10:39:15Z", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/162", "merged": true, "mergeCommit": {"oid": "8685c9cc88d97bbc8dc806bd30a9e49e1b2dfb55"}, "closed": true, "closedAt": "2020-03-18T21:08:43Z", "author": {"login": "rgmf"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOSflsgBqjMxMzQ0ODk0MTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO7sbggH2gAyMzg5MTQxNjUyOmE2ZjAzZDBmMjMyYWE4MzA5MzRmMzIxMmQ0ODJlOGI3NTcyMGRhZmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43d303022b520b159efd5cb4965b16f43618aebe", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/43d303022b520b159efd5cb4965b16f43618aebe", "committedDate": "2020-03-15T18:39:41Z", "message": "Share pictures from marker.\nFixes #89."}, "afterCommit": {"oid": "0125b940d55b1318c983772b182b1cb5bb576e5e", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/0125b940d55b1318c983772b182b1cb5bb576e5e", "committedDate": "2020-03-16T18:34:45Z", "message": "Share pictures from marker.\nFixes #89."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NTA2NTIz", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/162#pullrequestreview-375506523", "createdAt": "2020-03-16T19:02:34Z", "commit": {"oid": "0125b940d55b1318c983772b182b1cb5bb576e5e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxOTowMjozNFrOF3CGPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxOTowNDoyN1rOF3CJ1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI1MDM2Ng==", "bodyText": "Could you use a line break after every sentence?\nIt is usually easier to read", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/162#discussion_r393250366", "createdAt": "2020-03-16T19:02:34Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/util/IntentUtils.java", "diffHunk": "@@ -99,6 +101,29 @@ public static Intent newShareFileIntent(Context context, long[] trackIds) {\n                 .putExtra(Intent.EXTRA_TEXT, context.getString(R.string.share_track_share_file_body, trackDescription));\n     }\n \n+    /**\n+     * Creates an intent to share a waypoint image with an app.\n+     *\n+     * @param context the context.\n+     * @param uri     uri with the image to share.\n+     */\n+    public static Intent newShareImageIntent(Context context, Uri uri) {\n+        String mime = context.getContentResolver().getType(uri);\n+\n+        // Because the #166 bug, when you import KMZ tracks then it creates file:/// from markers", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0125b940d55b1318c983772b182b1cb5bb576e5e"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI1MDYwMg==", "bodyText": "needs to be:\nintent = Intent.createChooser(intent, null);", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/162#discussion_r393250602", "createdAt": "2020-03-16T19:02:59Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/fragments/MarkerDetailFragment.java", "diffHunk": "@@ -188,6 +197,13 @@ public boolean onOptionsItemSelected(MenuItem item) {\n                         .putExtra(MarkerEditActivity.EXTRA_MARKER_ID, markerId);\n                 startActivity(intent);\n                 return true;\n+            case R.id.marker_detail_share:\n+                if (waypoint.hasPhoto()) {\n+                    intent = IntentUtils.newShareImageIntent(getContext(), waypoint.getPhotoURI());\n+                    Intent.createChooser(intent, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0125b940d55b1318c983772b182b1cb5bb576e5e"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI1MTI4Ng==", "bodyText": "Is this null check required?\nAnd this code could actually be moved into the calling methods (as long as it is only one menuItem).", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/162#discussion_r393251286", "createdAt": "2020-03-16T19:04:27Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/fragments/MarkerDetailFragment.java", "diffHunk": "@@ -170,8 +173,14 @@ public void setMenuVisibility(boolean menuVisible) {\n     @Override\n     public void onCreateOptionsMenu(@NonNull Menu menu, MenuInflater inflater) {\n         inflater.inflate(R.menu.marker_detail, menu);\n-\n+        shareMarkerImageMenuItem = menu.findItem(R.id.marker_detail_share);\n         updateWaypoint(false);\n+        updateMenuItems();\n+    }\n+\n+    private void updateMenuItems() {\n+        if (shareMarkerImageMenuItem != null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0125b940d55b1318c983772b182b1cb5bb576e5e"}, "originalPosition": 28}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0125b940d55b1318c983772b182b1cb5bb576e5e", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/0125b940d55b1318c983772b182b1cb5bb576e5e", "committedDate": "2020-03-16T18:34:45Z", "message": "Share pictures from marker.\nFixes #89."}, "afterCommit": {"oid": "3f01cca724215c21c570a2a1143c60a3a5844e59", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/3f01cca724215c21c570a2a1143c60a3a5844e59", "committedDate": "2020-03-17T08:44:48Z", "message": "Share pictures from marker.\nFixes #89."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f01cca724215c21c570a2a1143c60a3a5844e59", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/3f01cca724215c21c570a2a1143c60a3a5844e59", "committedDate": "2020-03-17T08:44:48Z", "message": "Share pictures from marker.\nFixes #89."}, "afterCommit": {"oid": "821007ab2c146a28dd4e8915cfe6d9f7f20d5d27", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/821007ab2c146a28dd4e8915cfe6d9f7f20d5d27", "committedDate": "2020-03-17T21:29:55Z", "message": "Share pictures from marker.\nFixes #89."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "821007ab2c146a28dd4e8915cfe6d9f7f20d5d27", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/821007ab2c146a28dd4e8915cfe6d9f7f20d5d27", "committedDate": "2020-03-17T21:29:55Z", "message": "Share pictures from marker.\nFixes #89."}, "afterCommit": {"oid": "6ddd97f5795ecbcf1ae43f8bf4829177d97a9650", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/6ddd97f5795ecbcf1ae43f8bf4829177d97a9650", "committedDate": "2020-03-17T21:38:50Z", "message": "Share pictures from marker.\nFixes #89."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NTkzMzM2", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/162#pullrequestreview-376593336", "createdAt": "2020-03-18T06:32:05Z", "commit": {"oid": "0125b940d55b1318c983772b182b1cb5bb576e5e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNjozMjowNVrOF33x8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwNjozMjowNVrOF33x8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEyOTkwNw==", "bodyText": "This is the last one (I promise): but could you modify the comment layout to use:\n\n/* */\nBecause all\nWrite one sentence per line followed by a line break\nIt is usually easier to read and will apply the proper formatting depending on the IDE's window width.", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/162#discussion_r394129907", "createdAt": "2020-03-18T06:32:05Z", "author": {"login": "dennisguse"}, "path": "src/main/java/de/dennisguse/opentracks/util/IntentUtils.java", "diffHunk": "@@ -99,6 +101,29 @@ public static Intent newShareFileIntent(Context context, long[] trackIds) {\n                 .putExtra(Intent.EXTRA_TEXT, context.getString(R.string.share_track_share_file_body, trackDescription));\n     }\n \n+    /**\n+     * Creates an intent to share a waypoint image with an app.\n+     *\n+     * @param context the context.\n+     * @param uri     uri with the image to share.\n+     */\n+    public static Intent newShareImageIntent(Context context, Uri uri) {\n+        String mime = context.getContentResolver().getType(uri);\n+\n+        // Because the #166 bug, when you import KMZ tracks then it creates file:/// from markers", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI1MDM2Ng=="}, "originalCommit": {"oid": "0125b940d55b1318c983772b182b1cb5bb576e5e"}, "originalPosition": 28}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ddd97f5795ecbcf1ae43f8bf4829177d97a9650", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/6ddd97f5795ecbcf1ae43f8bf4829177d97a9650", "committedDate": "2020-03-17T21:38:50Z", "message": "Share pictures from marker.\nFixes #89."}, "afterCommit": {"oid": "eebed68de693c6e69e012ed96ebb05e55ce0d1f5", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/eebed68de693c6e69e012ed96ebb05e55ce0d1f5", "committedDate": "2020-03-18T08:29:47Z", "message": "Share pictures from marker.\nFixes #89."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eebed68de693c6e69e012ed96ebb05e55ce0d1f5", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/eebed68de693c6e69e012ed96ebb05e55ce0d1f5", "committedDate": "2020-03-18T08:29:47Z", "message": "Share pictures from marker.\nFixes #89."}, "afterCommit": {"oid": "a6f03d0f232aa830934f3212d482e8b75720dafd", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/a6f03d0f232aa830934f3212d482e8b75720dafd", "committedDate": "2020-03-18T18:33:57Z", "message": "Share pictures from marker.\nFixes #89."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6f03d0f232aa830934f3212d482e8b75720dafd", "author": {"user": {"login": "rgmf", "name": "Rom\u00e1n Mart\u00ednez"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/a6f03d0f232aa830934f3212d482e8b75720dafd", "committedDate": "2020-03-18T18:33:57Z", "message": "Share pictures from marker.\nFixes #89."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2292, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}