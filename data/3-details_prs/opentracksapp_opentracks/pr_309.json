{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MTk5MDQ0", "number": 309, "title": "Rework track deletion UI", "bodyText": "Replaced the dialog with an overlay infinite progress bar.\nDeletion can be cancelled using the back button.", "createdAt": "2020-07-03T21:36:56Z", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/309", "merged": true, "mergeCommit": {"oid": "4ded3c6bc8232faa0bddc4c7683775f32bcd84aa"}, "closed": true, "closedAt": "2020-07-08T06:25:38Z", "author": {"login": "dennisguse"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyS96sgFqTQ0MzE4MTQ5Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyoaK6gBqjM1MjEyNzEwNTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMTgxNDky", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/309#pullrequestreview-443181492", "createdAt": "2020-07-06T15:28:13Z", "commit": {"oid": "c2ceb88e8376f656093d50a4881376b53e442f44"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNToyODoxM1rOGtcPWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNToyODoxM1rOGtcPWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDMwMTc4Nw==", "bodyText": "When deleting is finished the user can see the spinner going down. Why don't hide it before finish()?\nfindViewById(R.id.progress_bar).setVisibility(View.INVISIBLE);", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/309#discussion_r450301787", "createdAt": "2020-07-06T15:28:13Z", "author": {"login": "rgmf"}, "path": "src/main/java/de/dennisguse/opentracks/TrackDeleteActivity.java", "diffHunk": "@@ -44,53 +42,52 @@ public void onCreate(Bundle savedInstanceState) {\n         setResult(RESULT_CANCELED);\n \n         Intent intent = getIntent();\n-        long[] trackIds = intent.getLongArrayExtra(EXTRA_TRACK_IDS);\n-\n-        Object retained = getLastNonConfigurationInstance();\n-        if (retained instanceof DeleteAsyncTask) {\n-            deleteAsyncTask = (DeleteAsyncTask) retained;\n-            deleteAsyncTask.setActivity(this);\n-        } else {\n-            deleteAsyncTask = new DeleteAsyncTask(this, trackIds);\n-            deleteAsyncTask.execute();\n-        }\n+        trackIds = intent.getLongArrayExtra(EXTRA_TRACK_IDS);\n+\n+        deleteAsyncTask = new DeleteAsyncTask();\n     }\n \n     @Override\n-    public Object onRetainNonConfigurationInstance() {\n-        deleteAsyncTask.setActivity(null);\n-        return deleteAsyncTask;\n+    protected void onStart() {\n+        super.onStart();\n+        deleteAsyncTask.execute();\n     }\n \n     @Override\n-    protected Dialog onCreateDialog(int id) {\n-        if (id != DIALOG_PROGRESS_ID) {\n-            return null;\n-        }\n-        return DialogUtils.createSpinnerProgressDialog(\n-                this, R.string.track_delete_progress_message, new DialogInterface.OnCancelListener() {\n-                    @Override\n-                    public void onCancel(DialogInterface dialog) {\n-                        deleteAsyncTask.cancel(true);\n-                        dialog.dismiss();\n-                        finish();\n-                    }\n-                });\n+    protected void onStop() {\n+        super.onStop();\n+        deleteAsyncTask.cancel(true);\n+    }\n+\n+    @Override\n+    protected int getLayoutResId() {\n+        return R.layout.track_delete;\n     }\n \n-    /**\n-     * Invokes when the associated AsyncTask completes.\n-     */\n     public void onAsyncTaskCompleted() {\n-        removeDialog(DIALOG_PROGRESS_ID);\n         setResult(RESULT_OK);\n         finish();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2ceb88e8376f656093d50a4881376b53e442f44"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMTgzNzMz", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/309#pullrequestreview-443183733", "createdAt": "2020-07-06T15:30:42Z", "commit": {"oid": "c2ceb88e8376f656093d50a4881376b53e442f44"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNTozMDo0MlrOGtcV_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNTozMDo0MlrOGtcV_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDMwMzQ4Ng==", "bodyText": "I like the best this transition for TrackDeleteActivity start (below startActivityForResult):\noverridePendingTransition(android.R.anim.fade_in, android.R.anim.fade_out);", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/309#discussion_r450303486", "createdAt": "2020-07-06T15:30:42Z", "author": {"login": "rgmf"}, "path": "src/main/java/de/dennisguse/opentracks/AbstractListActivity.java", "diffHunk": "@@ -62,17 +62,15 @@ protected void deleteTracks(long[] trackIds) {\n     @Override\n     public void onConfirmDeleteDone(long[] trackIds) {\n         boolean stopRecording = false;\n-        if (trackIds.length == 1 && trackIds[0] == -1L) {\n-            stopRecording = true;\n-        } else {\n-            long recordingTrackId = PreferencesUtils.getRecordingTrackId(this);\n-            for (long trackId : trackIds) {\n-                if (trackId == recordingTrackId) {\n-                    stopRecording = true;\n-                    break;\n-                }\n+\n+        long recordingTrackId = PreferencesUtils.getRecordingTrackId(this);\n+        for (long trackId : trackIds) {\n+            if (trackId == recordingTrackId) {\n+                stopRecording = true;\n+                break;\n             }\n         }\n+\n         if (stopRecording) {\n             getTrackRecordingServiceConnection().stopRecording(this, false);\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2ceb88e8376f656093d50a4881376b53e442f44"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNjExODUy", "url": "https://github.com/OpenTracksApp/OpenTracks/pull/309#pullrequestreview-443611852", "createdAt": "2020-07-07T07:00:33Z", "commit": {"oid": "726b8a7d1c7c189a35ca733f98289d0e5b7fb841"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0911c3f57a9fbba512adb75103e5426326644e69", "author": {"user": {"login": "dennisguse", "name": "Dennis Guse"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/0911c3f57a9fbba512adb75103e5426326644e69", "committedDate": "2020-07-07T16:26:32Z", "message": "Track deletion shows an infinite progressbar.\nFixes #242."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "037cb681494be8491c498652ee74b1077e4f0211", "author": {"user": {"login": "dennisguse", "name": "Dennis Guse"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/037cb681494be8491c498652ee74b1077e4f0211", "committedDate": "2020-07-07T16:26:32Z", "message": "Track deletion UI: code cleanup."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfba3f1dc602bb02a8e4d023bee041e4e2f67a01", "author": {"user": {"login": "dennisguse", "name": "Dennis Guse"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/cfba3f1dc602bb02a8e4d023bee041e4e2f67a01", "committedDate": "2020-07-07T16:26:32Z", "message": "TrackDelete: hide progress bar before finishing and add custom animations."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a85194f896d91aafd58aff97a742023f4717515a", "author": {"user": {"login": "dennisguse", "name": "Dennis Guse"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/a85194f896d91aafd58aff97a742023f4717515a", "committedDate": "2020-07-07T16:26:32Z", "message": "TrackDelete: use a Thread and always require TrackIds."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c586e49737232570452f33cb743e8e271b95f5f1", "author": {"user": {"login": "dennisguse", "name": "Dennis Guse"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/c586e49737232570452f33cb743e8e271b95f5f1", "committedDate": "2020-07-07T16:25:57Z", "message": "TrackDelete: use a Thread and always require TrackIds."}, "afterCommit": {"oid": "a85194f896d91aafd58aff97a742023f4717515a", "author": {"user": {"login": "dennisguse", "name": "Dennis Guse"}}, "url": "https://github.com/OpenTracksApp/OpenTracks/commit/a85194f896d91aafd58aff97a742023f4717515a", "committedDate": "2020-07-07T16:26:32Z", "message": "TrackDelete: use a Thread and always require TrackIds."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2234, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}