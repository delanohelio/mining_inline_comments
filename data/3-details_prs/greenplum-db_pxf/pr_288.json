{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMTk2NjQ2", "number": 288, "title": "Minor code optimizations", "bodyText": "While profiling the code, I noticed some hotspots in\nDataType#isTextForm: Optimized by using an array, iterating over a small\narray is significantly faster than using a HashSet.\nGreenplumCSV#toCsvField: I noticed a high amount of calls to\nString.length. Assign the length to a variable once and use it to\noptimize it.", "createdAt": "2020-01-09T22:48:03Z", "url": "https://github.com/greenplum-db/pxf/pull/288", "merged": true, "mergeCommit": {"oid": "b5df14b540a9a2ffd097d078ef83b5123fe30ec7"}, "closed": true, "closedAt": "2020-01-11T02:06:41Z", "author": {"login": "frankgh"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4x7IAgH2gAyMzYxMTk2NjQ2OjlmN2FjMzI2YjMxYzIwMzU5NTQxNjRkMTA5M2JiYWE1NmViNmU1YTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5H-YUgFqTM0MTQ4NTI2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9f7ac326b31c2035954164d1093bbaa56eb6e5a1", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/9f7ac326b31c2035954164d1093bbaa56eb6e5a1", "committedDate": "2020-01-09T22:44:37Z", "message": "Minor code optimizations\n\nWhile profiling the code, I noticed some hotspots in\n\nDataType#isTextForm: Optimized by using an array, iterating over a small\narray is significantly faster than using a HashSet.\n\nGreenplumCSV#toCsvField: I noticed a high amount of calls to\nString.length. Assign the length to a variable once and use it to\noptimize it."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwOTExNDAy", "url": "https://github.com/greenplum-db/pxf/pull/288#pullrequestreview-340911402", "createdAt": "2020-01-10T01:23:31Z", "commit": {"oid": "9f7ac326b31c2035954164d1093bbaa56eb6e5a1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwMToyMzozMVrOFcIEcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQwMToyNzo1MFrOFcIH7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTAzNjY1Nw==", "bodyText": "wonder how BitSet would behave, the largest int value is 701 (FLOAT8), which will make BitSet-backing array about 88 bytes long, which is not a big deal and checking is a binary operation (actually check : isText = (oid > set.size()-1 || !set.get(oid))\nAlso, there are other OIDs (like NUMERIC(1700)) that are not lister here, but probably are not text also ?", "url": "https://github.com/greenplum-db/pxf/pull/288#discussion_r365036657", "createdAt": "2020-01-10T01:23:31Z", "author": {"login": "denalex"}, "path": "server/pxf-api/src/main/java/org/greenplum/pxf/api/io/DataType.java", "diffHunk": "@@ -64,7 +64,8 @@\n     UNSUPPORTED_TYPE(-1);\n \n     private static final Map<Integer, DataType> lookup = new HashMap<>();\n-    private static final Set<Integer> notText = new HashSet<>();\n+    private static final int[] NOT_TEXT = {BIGINT.OID, BOOLEAN.OID, BYTEA.OID,\n+            FLOAT8.OID, INTEGER.OID, REAL.OID, SMALLINT.OID};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f7ac326b31c2035954164d1093bbaa56eb6e5a1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTAzNzU0OA==", "bodyText": "even better to move to constructor and to withNewLine() method so it is analyzed only once per instance.", "url": "https://github.com/greenplum-db/pxf/pull/288#discussion_r365037548", "createdAt": "2020-01-10T01:27:50Z", "author": {"login": "denalex"}, "path": "server/pxf-api/src/main/java/org/greenplum/pxf/api/model/GreenplumCSV.java", "diffHunk": "@@ -174,28 +174,28 @@ public String toCsvField(String s,\n         if (s == null) return null;\n \n         final int length = s.length();\n-        int i, j, quotes = 0, specialChars = 0, pos = 0, total = length;\n+        int i, j, quotes = 0, specialChars = 0, pos = 0, total = length,\n+                newLineLength = newline != null ? newline.length() : 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f7ac326b31c2035954164d1093bbaa56eb6e5a1"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5a6cd60da05ff0577e071d8d9877f09575fe6f2", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/d5a6cd60da05ff0577e071d8d9877f09575fe6f2", "committedDate": "2020-01-10T13:50:06Z", "message": "Address PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f643b2203d00239fb6af2f5398253bff638ebfc0", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/f643b2203d00239fb6af2f5398253bff638ebfc0", "committedDate": "2020-01-10T14:18:11Z", "message": "GreenplumCSV support setting char values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNDg1MjYx", "url": "https://github.com/greenplum-db/pxf/pull/288#pullrequestreview-341485261", "createdAt": "2020-01-11T00:26:05Z", "commit": {"oid": "f643b2203d00239fb6af2f5398253bff638ebfc0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4972, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}