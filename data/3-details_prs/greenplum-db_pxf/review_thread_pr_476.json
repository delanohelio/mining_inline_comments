{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MTEwMzgx", "number": 476, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMTowNFrOE0d4qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMjo0NFrOE0d7yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUxMDQ4OnYy", "diffSide": "RIGHT", "path": "package/pxf-gp5.spec", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMTowNFrOHsNXkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxOToxMTozNFrOHsSJsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjExODQxOQ==", "bodyText": "is this directory now also provisioned as part of installation of this RPM ? What happens on a clean install ?", "url": "https://github.com/greenplum-db/pxf/pull/476#discussion_r516118419", "createdAt": "2020-11-02T17:01:04Z", "author": {"login": "denalex"}, "path": "package/pxf-gp5.spec", "diffHunk": "@@ -66,3 +66,10 @@ sed -i \"s|module_pathname =.*|module_pathname = '%{prefix}/gpextable/pxf'|g\" %{p\n # only applies for old installations (pre 6.0.0)\n %__rm -f %{prefix}/conf/pxf-private.classpath\n %__rm -rf %{prefix}/pxf-service\n+\n+%posttrans\n+# PXF v5 RPM installation removes the run directory during the %preun step.\n+# The lack of run directory prevents PXF v6+ from starting up.\n+# %posttrans of the new package is the only step that runs after the %preun\n+# of the old package\n+%{__install} -d -m 700 %{prefix}/run", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71d1106609eeb39b3d055bffd073b49dba00f860"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE3NDA1Mg==", "bodyText": "Is there a reason we're creating this directory in a scriptlet? If this directory is needed by pxf, should we have it be be created in the build step above? This will ensure that the package manager sees this directory as being owned by the package.\nI don't know if PXF supports SLES11 (or plans to), but I don't think %posttrans works with the version of RPM there.", "url": "https://github.com/greenplum-db/pxf/pull/476#discussion_r516174052", "createdAt": "2020-11-02T18:28:12Z", "author": {"login": "bradfordb-vmware"}, "path": "package/pxf-gp5.spec", "diffHunk": "@@ -66,3 +66,10 @@ sed -i \"s|module_pathname =.*|module_pathname = '%{prefix}/gpextable/pxf'|g\" %{p\n # only applies for old installations (pre 6.0.0)\n %__rm -f %{prefix}/conf/pxf-private.classpath\n %__rm -rf %{prefix}/pxf-service\n+\n+%posttrans\n+# PXF v5 RPM installation removes the run directory during the %preun step.\n+# The lack of run directory prevents PXF v6+ from starting up.\n+# %posttrans of the new package is the only step that runs after the %preun\n+# of the old package\n+%{__install} -d -m 700 %{prefix}/run", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjExODQxOQ=="}, "originalCommit": {"oid": "71d1106609eeb39b3d055bffd073b49dba00f860"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE3ODUzNA==", "bodyText": "@denalex yes, all the directories we need for PXF to start are provided as part of the RPM installation. That includes the run directory. On a clean install, the run directory is created.", "url": "https://github.com/greenplum-db/pxf/pull/476#discussion_r516178534", "createdAt": "2020-11-02T18:36:21Z", "author": {"login": "frankgh"}, "path": "package/pxf-gp5.spec", "diffHunk": "@@ -66,3 +66,10 @@ sed -i \"s|module_pathname =.*|module_pathname = '%{prefix}/gpextable/pxf'|g\" %{p\n # only applies for old installations (pre 6.0.0)\n %__rm -f %{prefix}/conf/pxf-private.classpath\n %__rm -rf %{prefix}/pxf-service\n+\n+%posttrans\n+# PXF v5 RPM installation removes the run directory during the %preun step.\n+# The lack of run directory prevents PXF v6+ from starting up.\n+# %posttrans of the new package is the only step that runs after the %preun\n+# of the old package\n+%{__install} -d -m 700 %{prefix}/run", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjExODQxOQ=="}, "originalCommit": {"oid": "71d1106609eeb39b3d055bffd073b49dba00f860"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE3OTAzNw==", "bodyText": "even if we create it as part of the spec, which is what @bradfordb-vmware suggests and what we should do, the current PX5 %postun will remove it, so we need to re-create it in the scriptlet again, unless there's a better way.", "url": "https://github.com/greenplum-db/pxf/pull/476#discussion_r516179037", "createdAt": "2020-11-02T18:37:25Z", "author": {"login": "denalex"}, "path": "package/pxf-gp5.spec", "diffHunk": "@@ -66,3 +66,10 @@ sed -i \"s|module_pathname =.*|module_pathname = '%{prefix}/gpextable/pxf'|g\" %{p\n # only applies for old installations (pre 6.0.0)\n %__rm -f %{prefix}/conf/pxf-private.classpath\n %__rm -rf %{prefix}/pxf-service\n+\n+%posttrans\n+# PXF v5 RPM installation removes the run directory during the %preun step.\n+# The lack of run directory prevents PXF v6+ from starting up.\n+# %posttrans of the new package is the only step that runs after the %preun\n+# of the old package\n+%{__install} -d -m 700 %{prefix}/run", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjExODQxOQ=="}, "originalCommit": {"oid": "71d1106609eeb39b3d055bffd073b49dba00f860"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE5Njc4Ng==", "bodyText": "spoke to @bradfordb-vmware and we agreed that the %posttrans approach should be fine, so long SLES11 is not something we need to worry about. To answer Bradford's other question, the RPM includes the run directory, so this should be seen by the package manager as well. We verified that with this fix, running an rpm -V pxf-gp6 did not show the run directory as missing. The run directory was shown as missing in the RPM created in the spring-boot branch", "url": "https://github.com/greenplum-db/pxf/pull/476#discussion_r516196786", "createdAt": "2020-11-02T19:11:34Z", "author": {"login": "frankgh"}, "path": "package/pxf-gp5.spec", "diffHunk": "@@ -66,3 +66,10 @@ sed -i \"s|module_pathname =.*|module_pathname = '%{prefix}/gpextable/pxf'|g\" %{p\n # only applies for old installations (pre 6.0.0)\n %__rm -f %{prefix}/conf/pxf-private.classpath\n %__rm -rf %{prefix}/pxf-service\n+\n+%posttrans\n+# PXF v5 RPM installation removes the run directory during the %preun step.\n+# The lack of run directory prevents PXF v6+ from starting up.\n+# %posttrans of the new package is the only step that runs after the %preun\n+# of the old package\n+%{__install} -d -m 700 %{prefix}/run", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjExODQxOQ=="}, "originalCommit": {"oid": "71d1106609eeb39b3d055bffd073b49dba00f860"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDUxODUwOnYy", "diffSide": "RIGHT", "path": "package/pxf-gp5.spec", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMjo0NFrOHsNcgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxODozNDowOFrOHsQ9qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjExOTY4MQ==", "bodyText": "also, lines 64-68 -- %preun seems to be only for old stuff, should this be now in %prein or %postin to clean up before installing new RPM ?", "url": "https://github.com/greenplum-db/pxf/pull/476#discussion_r516119681", "createdAt": "2020-11-02T17:02:44Z", "author": {"login": "denalex"}, "path": "package/pxf-gp5.spec", "diffHunk": "@@ -66,3 +66,10 @@ sed -i \"s|module_pathname =.*|module_pathname = '%{prefix}/gpextable/pxf'|g\" %{p\n # only applies for old installations (pre 6.0.0)\n %__rm -f %{prefix}/conf/pxf-private.classpath\n %__rm -rf %{prefix}/pxf-service\n+\n+%posttrans\n+# PXF v5 RPM installation removes the run directory during the %preun step.\n+# The lack of run directory prevents PXF v6+ from starting up.\n+# %posttrans of the new package is the only step that runs after the %preun\n+# of the old package\n+%{__install} -d -m 700 %{prefix}/run", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71d1106609eeb39b3d055bffd073b49dba00f860"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE3NzMyMw==", "bodyText": "yes, makes sense", "url": "https://github.com/greenplum-db/pxf/pull/476#discussion_r516177323", "createdAt": "2020-11-02T18:34:08Z", "author": {"login": "frankgh"}, "path": "package/pxf-gp5.spec", "diffHunk": "@@ -66,3 +66,10 @@ sed -i \"s|module_pathname =.*|module_pathname = '%{prefix}/gpextable/pxf'|g\" %{p\n # only applies for old installations (pre 6.0.0)\n %__rm -f %{prefix}/conf/pxf-private.classpath\n %__rm -rf %{prefix}/pxf-service\n+\n+%posttrans\n+# PXF v5 RPM installation removes the run directory during the %preun step.\n+# The lack of run directory prevents PXF v6+ from starting up.\n+# %posttrans of the new package is the only step that runs after the %preun\n+# of the old package\n+%{__install} -d -m 700 %{prefix}/run", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjExOTY4MQ=="}, "originalCommit": {"oid": "71d1106609eeb39b3d055bffd073b49dba00f860"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3512, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}