{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyNjk2MzIy", "number": 496, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDoxMDo1N1rOE6vwXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxODoyNzowM1rOE8V8vQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMDM1Mjk0OnYy", "diffSide": "RIGHT", "path": "concourse/scripts/pxf_common.bash", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDoxMDo1N1rOH2AK9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDozMjo0OVrOH2BCEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4Nzk1OQ==", "bodyText": "Why was this not required before?", "url": "https://github.com/greenplum-db/pxf/pull/496#discussion_r526387959", "createdAt": "2020-11-18T20:10:57Z", "author": {"login": "ashuka24"}, "path": "concourse/scripts/pxf_common.bash", "diffHunk": "@@ -442,6 +451,15 @@ function start_hadoop_services() {\n \tfi\n }\n \n+function init_pxf() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb8bbb2df775676969ad3b427fef41a19163423a"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwMjA2Nw==", "bodyText": "we used to init for PXF 5.x, but we no longer do it. We are bringing the init step back for PXF 5.x installations", "url": "https://github.com/greenplum-db/pxf/pull/496#discussion_r526402067", "createdAt": "2020-11-18T20:32:49Z", "author": {"login": "frankgh"}, "path": "concourse/scripts/pxf_common.bash", "diffHunk": "@@ -442,6 +451,15 @@ function start_hadoop_services() {\n \tfi\n }\n \n+function init_pxf() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4Nzk1OQ=="}, "originalCommit": {"oid": "fb8bbb2df775676969ad3b427fef41a19163423a"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNzA5NjI5OnYy", "diffSide": "RIGHT", "path": "concourse/scripts/install_pxf.bash", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxODoyNzowM1rOH4aJjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxODoyNzowM1rOH4aJjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkxMDczNA==", "bodyText": "If we change this cat <<-EOF > /tmp/pxf_installer/install_component, then we can indent the here-document with tabs and they will be stripped. This would allow indenting in a natural fashion, although we would have a mix of tabs and spaces in the whole file.", "url": "https://github.com/greenplum-db/pxf/pull/496#discussion_r528910734", "createdAt": "2020-11-23T18:27:03Z", "author": {"login": "bradfordb-vmware"}, "path": "concourse/scripts/install_pxf.bash", "diffHunk": "@@ -186,35 +227,55 @@ function run_pxf_installer_scripts() {\n \t\t\tgpstop -u\n \t\tfi &&\n \t\tsed -i '/edw/d' hostfile_all &&\n-\t\tgpscp -f ~gpadmin/hostfile_all -v -u centos ~gpadmin/install_pxf_dependencies.sh centos@=: &&\n+\t\tgpscp -f ~gpadmin/hostfile_all -v -u centos -r ~/pxf_installer ~gpadmin/install_pxf_dependencies.sh centos@=: &&\n \t\tgpssh -f ~gpadmin/hostfile_all -v -u centos -s -e 'sudo ~centos/install_pxf_dependencies.sh' &&\n-\t\tif [[ ${PXF_COMPONENT} == true ]]; then\n-\t\t\tgpscp -f ~gpadmin/hostfile_all -v -u centos -r ~/pxf_tarball centos@=: &&\n-\t\t\tgpssh -f ~gpadmin/hostfile_all -v -u centos -s -e 'tar -xzf ~centos/pxf_tarball/pxf-*.tar.gz -C /tmp'\n-\t\t\tgpssh -f ~gpadmin/hostfile_all -v -u centos -s -e 'sudo GPHOME=${GPHOME} /tmp/pxf*/install_component'\n-\t\t\tgpssh -f ~gpadmin/hostfile_all -v -u centos -s -e 'sudo chown -R gpadmin:gpadmin ${PXF_HOME}'\n+\t\tgpssh -f ~gpadmin/hostfile_all -v -u centos -s -e 'sudo GPHOME=${GPHOME} ~centos/pxf_installer/install_component'\n+\t\tgpssh -f ~gpadmin/hostfile_all -v -u centos -s -e 'sudo chown -R gpadmin:gpadmin ${PXF_HOME}'\n+\t\tif [[ ${PXF_VERSION} == 5 ]]; then\n+\t\t\tGPHOME=${GPHOME} PXF_CONF=${BASE_DIR} ${PXF_HOME}/bin/pxf cluster init\n \t\telse\n-\t\t\tgpscp -f ~gpadmin/hostfile_all -v -u gpadmin -r ~/pxf_tarball gpadmin@=: &&\n-\t\t\tgpssh -f ~gpadmin/hostfile_all -v -u gpadmin -s -e 'tar -xzf ~/pxf_tarball/pxf.tar.gz -C ${GPHOME}'\n+\t\t\t${PXF_HOME}/bin/pxf cluster register\n \t\tfi &&\n-\t\t${PXF_HOME}/bin/pxf cluster register &&\n \t\tif [[ -d ~/dataproc_env_files ]]; then\n \t\t\tgpscp -f ~gpadmin/hostfile_init -v -r -u gpadmin ~/dataproc_env_files =:\n \t\tfi &&\n \t\t~gpadmin/configure_pxf.sh &&\n \t\tgpssh -f ~gpadmin/hostfile_all -v -u centos -s -e \\\"sudo sed -i -e 's/edw0/edw0 hadoop/' /etc/hosts\\\" &&\n-\t\tPXF_BASE=${PXF_BASE_DIR} ${PXF_HOME}/bin/pxf cluster sync &&\n-\t\tPXF_BASE=${PXF_BASE_DIR} ${PXF_HOME}/bin/pxf cluster start &&\n+\t\t${PXF_HOME}/bin/pxf cluster sync &&\n+\t\t${PXF_HOME}/bin/pxf cluster start &&\n \t\tif [[ $INSTALL_GPHDFS == true ]]; then\n \t\t\tgpssh -f ~gpadmin/hostfile_all -v -u centos -s -e '\n-\t\t\t\tsudo cp ${PXF_BASE_DIR}/servers/default/{core,hdfs}-site.xml /etc/hadoop/conf\n+\t\t\t\tsudo cp ${BASE_DIR}/servers/default/{core,hdfs}-site.xml /etc/hadoop/conf\n \t\t\t'\n \t\tfi\n \t\"\n }\n \n function _main() {\n-\tlocal SCP_FILES=(pxf_tarball cluster_env_files/*)\n+\tmkdir -p /tmp/pxf_installer/\n+\tif [[ -d pxf_tarball ]]; then\n+\t\tif [[ ${PXF_COMPONENT} == true ]]; then\n+\t\t\tmkdir -p /tmp/pxf_inflate\n+\t\t\ttar -xzf pxf_tarball/pxf-*.tar.gz -C /tmp/pxf_inflate\n+\t\t\tcp /tmp/pxf_inflate/pxf*/* /tmp/pxf_installer/\n+\t\telse\n+\t\t\tcp pxf_tarball/pxf.tar.gz /tmp/pxf_installer\n+\t\t\tcat << EOF > /tmp/pxf_installer/install_component", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb8bbb2df775676969ad3b427fef41a19163423a"}, "originalPosition": 204}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3553, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}