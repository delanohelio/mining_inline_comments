{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NDM2Mjcw", "number": 304, "title": "Harden PXF's Tomcat configuration", "bodyText": "Remove default applications\nRemove Tomcat version information\nSet logs folder to 300", "createdAt": "2020-02-21T19:27:58Z", "url": "https://github.com/greenplum-db/pxf/pull/304", "merged": true, "mergeCommit": {"oid": "62f1b13271ef3bb95cbab4eba986ffedd7883ccb"}, "closed": true, "closedAt": "2020-02-25T18:58:09Z", "author": {"login": "frankgh"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGlQV_AFqTM2Mjg3MzE5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcH22FZABqjMwNzA1OTA0NTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODczMTkx", "url": "https://github.com/greenplum-db/pxf/pull/304#pullrequestreview-362873191", "createdAt": "2020-02-21T19:44:25Z", "commit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTo0NDoyNVrOFtCh-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTo1Mzo0MVrOFtCy8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MTcwNw==", "bodyText": "this is good, but I think we should do it during Tomcat packaging into the build, it's a bit silly trying to remove something after we install it, and might be tricky for RPM install as well.", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382771707", "createdAt": "2020-02-21T19:44:25Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -118,6 +118,20 @@ function fail()\n     exit 1\n }\n \n+#\n+# tomcatHardening removes tomcat example JSP and servlets,\n+# server banner, default index page\n+#\n+function tomcatHardening()\n+{\n+    # Remove default/unwanted Applications\n+    rm -rf \"$tomcat_root\"/webapps/ROOT\n+    rm -rf \"$tomcat_root\"/webapps/docs\n+    rm -rf \"$tomcat_root\"/webapps/examples\n+    rm -rf \"$tomcat_root\"/webapps/host-manager\n+    rm -rf \"$tomcat_root\"/webapps/manager\n+}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw==", "bodyText": "why so restrictive ? even owner will not be able to list files in this directory", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382773433", "createdAt": "2020-02-21T19:48:07Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -214,7 +228,8 @@ function createLogsDir()\n     if [[ ! -d $PXF_LOGDIR ]]; then\n         echo \"Creating PXF logs directory $PXF_LOGDIR ...\"\n         mkdir -p \"$PXF_LOGDIR\"\n-        chmod 700 \"$PXF_LOGDIR\"\n+        # only write/execute access\n+        chmod 300 \"$PXF_LOGDIR\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3NTQwNQ==", "bodyText": "web.xml also needs to be updated, it contains JSP servlet, welcome pages, etc", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382775405", "createdAt": "2020-02-21T19:52:20Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "diffHunk": "@@ -52,9 +52,13 @@ under the License.\n                        pattern=\"%h %l %u %t &quot;%r&quot; %s %b\"\n                        prefix=\"localhost_access_log.\"\n                        suffix=\".txt\"/>\n+                <Valve className=\"org.apache.catalina.valves.ErrorReportValve\"\n+                       showReport=\"true\"\n+                       showServerInfo=\"false\"/>\n             </Host>\n         </Engine>\n-        <Connector acceptCount=\"100\"\n+        <Connector server=\"PXF Server\"\n+                   acceptCount=\"100\"\n                    connectionTimeout=\"20000\"\n                    executor=\"tomcatThreadPool\"\n                    maxKeepAliveRequests=\"15\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3NjA1MQ==", "bodyText": "we also do not use \"in-memory user database\" in lines 26-31", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382776051", "createdAt": "2020-02-21T19:53:41Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "diffHunk": "@@ -52,9 +52,13 @@ under the License.\n                        pattern=\"%h %l %u %t &quot;%r&quot; %s %b\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/2c81fe5632d2fa12a883168c6a24ebe6b1d790b2", "committedDate": "2020-02-21T19:26:24Z", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications\n- Remove Tomcat version information\n- Set logs folder to 300"}, "afterCommit": {"oid": "3a70e2f13559d7d609eb4b5e7d7eba72da9cd395", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/3a70e2f13559d7d609eb4b5e7d7eba72da9cd395", "committedDate": "2020-02-24T13:17:57Z", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Set logs folder to 300\n- Remove JSP servlet"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a70e2f13559d7d609eb4b5e7d7eba72da9cd395", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/3a70e2f13559d7d609eb4b5e7d7eba72da9cd395", "committedDate": "2020-02-24T13:17:57Z", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Set logs folder to 300\n- Remove JSP servlet"}, "afterCommit": {"oid": "c2f3c6bf56cf05332c2c6e98a41471401e483a6f", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/c2f3c6bf56cf05332c2c6e98a41471401e483a6f", "committedDate": "2020-02-24T13:20:10Z", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Set logs folder to 300\n- Remove JSP servlet\n- Remove in-memory user database"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c2f3c6bf56cf05332c2c6e98a41471401e483a6f", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/c2f3c6bf56cf05332c2c6e98a41471401e483a6f", "committedDate": "2020-02-24T13:20:10Z", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Set logs folder to 300\n- Remove JSP servlet\n- Remove in-memory user database"}, "afterCommit": {"oid": "1d76985218ad756aa001829cb0a64de86e721e03", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/1d76985218ad756aa001829cb0a64de86e721e03", "committedDate": "2020-02-24T15:30:15Z", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Set logs folder to 300\n- Remove JSP servlet\n- Remove in-memory user database"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNzUyODA4", "url": "https://github.com/greenplum-db/pxf/pull/304#pullrequestreview-363752808", "createdAt": "2020-02-24T22:39:05Z", "commit": {"oid": "1d76985218ad756aa001829cb0a64de86e721e03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMjozOTowNVrOFtydzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMjozOTowNVrOFtydzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU1NzA3MA==", "bodyText": "what does adding server field do for security?", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383557070", "createdAt": "2020-02-24T22:39:05Z", "author": {"login": "oliverralbertini"}, "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "diffHunk": "@@ -52,9 +40,13 @@ under the License.\n                        pattern=\"%h %l %u %t &quot;%r&quot; %s %b\"\n                        prefix=\"localhost_access_log.\"\n                        suffix=\".txt\"/>\n+                <Valve className=\"org.apache.catalina.valves.ErrorReportValve\"\n+                       showReport=\"true\"\n+                       showServerInfo=\"false\"/>\n             </Host>\n         </Engine>\n-        <Connector acceptCount=\"100\"\n+        <Connector server=\"PXF Server\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d76985218ad756aa001829cb0a64de86e721e03"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MzYzMjk0", "url": "https://github.com/greenplum-db/pxf/pull/304#pullrequestreview-364363294", "createdAt": "2020-02-25T18:52:31Z", "commit": {"oid": "1d76985218ad756aa001829cb0a64de86e721e03"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "612bcad0f9e90af1867ae422c05729621e6d2cc1", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/612bcad0f9e90af1867ae422c05729621e6d2cc1", "committedDate": "2020-02-25T18:57:17Z", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Remove JSP servlet\n- Remove in-memory user database"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1d76985218ad756aa001829cb0a64de86e721e03", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/1d76985218ad756aa001829cb0a64de86e721e03", "committedDate": "2020-02-24T15:30:15Z", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Set logs folder to 300\n- Remove JSP servlet\n- Remove in-memory user database"}, "afterCommit": {"oid": "612bcad0f9e90af1867ae422c05729621e6d2cc1", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/612bcad0f9e90af1867ae422c05729621e6d2cc1", "committedDate": "2020-02-25T18:57:17Z", "message": "Harden PXF's Tomcat configuration\n\n- Remove default applications during packaging\n- Remove Tomcat version information\n- Remove JSP servlet\n- Remove in-memory user database"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4989, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}