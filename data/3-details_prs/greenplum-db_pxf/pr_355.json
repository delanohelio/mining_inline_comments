{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2ODA1MjM5", "number": 355, "title": "Split dependencies tarball into 2 tarballs", "bodyText": "1 tarball for .gradle, .tomcat, .go\n1 tarball for .m2 (includes all dependencies / allows for offline mode)\n\nThese tarballs will be used in different jobs in different parts of the\npipeline", "createdAt": "2020-05-12T15:34:34Z", "url": "https://github.com/greenplum-db/pxf/pull/355", "merged": true, "mergeCommit": {"oid": "808efc9877b9118fdd5192399a83f37fe52260d1"}, "closed": true, "closedAt": "2020-05-12T18:23:38Z", "author": {"login": "frankgh"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgUHxdgH2gAyNDE2ODA1MjM5OjdiMjFhYTExNjcxNDZjN2QxOTU4Njk5OTkxMjM2MTFlMDE5MzJmMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgofd_AFqTQxMDMwMTc5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b21aa1167146c7d195869999123611e01932f09", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/7b21aa1167146c7d195869999123611e01932f09", "committedDate": "2020-05-11T18:38:15Z", "message": "Split dependencies tarball into 2 tarballs\n\n- 1 tarball for .gradle, .tomcat, .go\n- 1 tarball for .m2\n\nThese tarballs will be used in different jobs in different parts of the\npipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cab4619c6068f23f322eff6709f7b7921771fa8", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/9cab4619c6068f23f322eff6709f7b7921771fa8", "committedDate": "2020-05-11T20:53:03Z", "message": "dependency:go-offline -> make dev"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4f77316332e97a48eb519f920809cc3bf29121a", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/a4f77316332e97a48eb519f920809cc3bf29121a", "committedDate": "2020-05-12T12:57:24Z", "message": "run test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5aaf7927088107fba31795048a262ca50799800e", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/5aaf7927088107fba31795048a262ca50799800e", "committedDate": "2020-05-12T14:21:26Z", "message": "prep templates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "977532c8e011b155f46ff92a6492401ee957d670", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/977532c8e011b155f46ff92a6492401ee957d670", "committedDate": "2020-05-12T14:44:19Z", "message": "create dir"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "428c87f595aab09d23a0cb9176717e996e411673", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/428c87f595aab09d23a0cb9176717e996e411673", "committedDate": "2020-05-12T18:17:06Z", "message": "remove /root/pxf"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzAxNzkz", "url": "https://github.com/greenplum-db/pxf/pull/355#pullrequestreview-410301793", "createdAt": "2020-05-12T18:14:21Z", "commit": {"oid": "977532c8e011b155f46ff92a6492401ee957d670"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxODoxNDoyMVrOGUTEGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxODoxOTo0MVrOGUTQ-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkzNzA0OA==", "bodyText": "should we remove /root/pxf?", "url": "https://github.com/greenplum-db/pxf/pull/355#discussion_r423937048", "createdAt": "2020-05-12T18:14:21Z", "author": {"login": "oliverralbertini"}, "path": "concourse/docker/pxf-build-base/Dockerfile", "diffHunk": "@@ -27,11 +27,16 @@ RUN export BUILD_PARAMS=-Dorg.gradle.daemon=false && \\\n     for X in /tmp/pxf_src/server/build/stage/lib/pxf-*-[0-9]*.jar; do \\\n       ln -sf $X /root/automation_tmp_lib/`echo \\`basename $X\\` | sed -e 's/-[a-zA-Z0-9.]*.jar/.jar/'`; \\\n     done && touch /root/automation_tmp_lib/pxf-extras.jar && \\\n-    cd /tmp/pxf_src/automation && mvn dependency:go-offline -DexcludeGroupIds=org.greenplum && \\\n-    cd - && mkdir -p /tmp/output/.tomcat && \\\n+    make -C /tmp/pxf_src/automation dev && \\\n+    mkdir -p /root/pxf/servers/database/ && cp /tmp/pxf_src/server/pxf-service/src/templates/user/templates/jdbc-site.xml /root/pxf/servers/database/ && \\\n+    mkdir -p /root/pxf/servers/db-session-params/ && cp /tmp/pxf_src/server/pxf-service/src/templates/user/templates/jdbc-site.xml /root/pxf/servers/db-session-params/ && \\\n+    mkdir -p /root/pxf/servers/db-hive/ && cp /tmp/pxf_src/server/pxf-service/src/templates/user/templates/jdbc-site.xml /root/pxf/servers/db-hive/ && \\\n+    make -C /tmp/pxf_src/automation TEST=HdfsSmokeTest || true && \\\n+    mkdir -p /tmp/output/.tomcat && mkdir -p /tmp/automation && \\\n     mv /tmp/pxf_src/pxf_commit_sha /tmp/output/pxf_commit_sha && \\\n     mv /tmp/pxf_src/server/tomcat/build/apache-tomcat-*.tar.gz /tmp/output/.tomcat/ && \\\n     mv /tmp/pxf_src/cli/go/pkg/dep/sources /tmp/output/.go-dep-cached-sources && \\\n-    mv /root/.gradle /tmp/output && mv /root/.m2 /tmp/output && \\\n+    mv /root/.gradle /tmp/output && mv /root/.m2 /tmp/automation && \\\n     cd /tmp/output/ && tar -czf /tmp/pxf-build-dependencies.tar.gz . && \\\n-    rm -rf /tmp/output /tmp/pxf_src /root/.gradle /root/.m2\n+    cd /tmp/automation && tar -czf /tmp/pxf-automation-dependencies.tar.gz . && \\\n+    rm -rf /tmp/output /tmp/pxf_src /root/.gradle /root/.m2 /tmp/automation", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977532c8e011b155f46ff92a6492401ee957d670"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkzODIwMg==", "bodyText": "here and below, I prefer not to cd anywhere if we don't have to:\ntar -czf /tmp/pxf-build-dependencies.tar.gz -C /tmp/output . &&\ntar -czf /tmp/pxf-automation-dependencies.tar.gz -C /tmp/automation .\nMakes the script less error prone, and you don't have to remember to cd back before deleting the directory.", "url": "https://github.com/greenplum-db/pxf/pull/355#discussion_r423938202", "createdAt": "2020-05-12T18:16:05Z", "author": {"login": "oliverralbertini"}, "path": "concourse/docker/pxf-build-base/Dockerfile", "diffHunk": "@@ -27,11 +27,16 @@ RUN export BUILD_PARAMS=-Dorg.gradle.daemon=false && \\\n     for X in /tmp/pxf_src/server/build/stage/lib/pxf-*-[0-9]*.jar; do \\\n       ln -sf $X /root/automation_tmp_lib/`echo \\`basename $X\\` | sed -e 's/-[a-zA-Z0-9.]*.jar/.jar/'`; \\\n     done && touch /root/automation_tmp_lib/pxf-extras.jar && \\\n-    cd /tmp/pxf_src/automation && mvn dependency:go-offline -DexcludeGroupIds=org.greenplum && \\\n-    cd - && mkdir -p /tmp/output/.tomcat && \\\n+    make -C /tmp/pxf_src/automation dev && \\\n+    mkdir -p /root/pxf/servers/database/ && cp /tmp/pxf_src/server/pxf-service/src/templates/user/templates/jdbc-site.xml /root/pxf/servers/database/ && \\\n+    mkdir -p /root/pxf/servers/db-session-params/ && cp /tmp/pxf_src/server/pxf-service/src/templates/user/templates/jdbc-site.xml /root/pxf/servers/db-session-params/ && \\\n+    mkdir -p /root/pxf/servers/db-hive/ && cp /tmp/pxf_src/server/pxf-service/src/templates/user/templates/jdbc-site.xml /root/pxf/servers/db-hive/ && \\\n+    make -C /tmp/pxf_src/automation TEST=HdfsSmokeTest || true && \\\n+    mkdir -p /tmp/output/.tomcat && mkdir -p /tmp/automation && \\\n     mv /tmp/pxf_src/pxf_commit_sha /tmp/output/pxf_commit_sha && \\\n     mv /tmp/pxf_src/server/tomcat/build/apache-tomcat-*.tar.gz /tmp/output/.tomcat/ && \\\n     mv /tmp/pxf_src/cli/go/pkg/dep/sources /tmp/output/.go-dep-cached-sources && \\\n-    mv /root/.gradle /tmp/output && mv /root/.m2 /tmp/output && \\\n+    mv /root/.gradle /tmp/output && mv /root/.m2 /tmp/automation && \\\n     cd /tmp/output/ && tar -czf /tmp/pxf-build-dependencies.tar.gz . && \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977532c8e011b155f46ff92a6492401ee957d670"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk0MDM0Nw==", "bodyText": "minor: here and above you might consider replacing * with {build,automation}", "url": "https://github.com/greenplum-db/pxf/pull/355#discussion_r423940347", "createdAt": "2020-05-12T18:19:41Z", "author": {"login": "oliverralbertini"}, "path": "concourse/docker/pxf-build-base/cloudbuild.yaml", "diffHunk": "@@ -31,9 +31,14 @@ steps:\n   - '-c'\n   - |\n     mkdir /workspace/build\n-    docker run --rm -v /workspace/build:/tmp/build/ pxf-build-dev /bin/bash -c \"cp /tmp/pxf-build-dependencies.tar.gz /tmp/build/\"\n+    docker run --rm -v /workspace/build:/tmp/build/ pxf-build-dev /bin/bash -c \"cp /tmp/pxf-*-dependencies.tar.gz /tmp/build/\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "977532c8e011b155f46ff92a6492401ee957d670"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 57, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}