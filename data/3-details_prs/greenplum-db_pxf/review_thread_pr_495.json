{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMzEyNzMy", "number": 495, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjoyMDo0MlrOE6GbnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxNDoyODoxMlrOFHNI9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MzU4MjM2OnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjoyMDo0MlrOH09aYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDowMTo0NVrOH1_2yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI5NDE3Ng==", "bodyText": "looks like this replaces the Hive profile name with hive, and adds new hive:xxx profiles for the others?  will the user still be able to use Hive?\nare we going to want to deprecate the old Hive* profile names in 6.0.0?", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r525294176", "createdAt": "2020-11-17T16:20:42Z", "author": {"login": "lisakowen"}, "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "diffHunk": "@@ -37,7 +37,7 @@ under the License.\n         </plugins>\n     </profile>\n     <profile>\n-        <name>Hive</name>\n+        <name>hive</name>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4179e68e5ff03afc24669edd9fe78a510028126b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI5NzU4Nw==", "bodyText": "This PR preserves the old names. The old names are cheap in terms of memory footprint, but we should at some point remove them.", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r525297587", "createdAt": "2020-11-17T16:25:03Z", "author": {"login": "frankgh"}, "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "diffHunk": "@@ -37,7 +37,7 @@ under the License.\n         </plugins>\n     </profile>\n     <profile>\n-        <name>Hive</name>\n+        <name>hive</name>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI5NDE3Ng=="}, "originalCommit": {"oid": "4179e68e5ff03afc24669edd9fe78a510028126b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0MDg5OQ==", "bodyText": "Let's make them case-insensitive in the code and lower-cases in documentation / this file. This will apply to Hive, Jdbc, HBase, etc. The old one-word capitalized names will still work, but will be effectively deprecated. Composite ones like HiveORC will be deprecated, meaning they will still work for now, but will not be documented.", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r525340899", "createdAt": "2020-11-17T17:16:57Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "diffHunk": "@@ -37,7 +37,7 @@ under the License.\n         </plugins>\n     </profile>\n     <profile>\n-        <name>Hive</name>\n+        <name>hive</name>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI5NDE3Ng=="}, "originalCommit": {"oid": "4179e68e5ff03afc24669edd9fe78a510028126b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM4Mjc5Mg==", "bodyText": "@denalex's comment make sense and I agree. A follow-up question -- should we log some of kind of warning/notice in addition to marking it deprecated in docs?", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r526382792", "createdAt": "2020-11-18T20:01:45Z", "author": {"login": "bradfordb-vmware"}, "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "diffHunk": "@@ -37,7 +37,7 @@ under the License.\n         </plugins>\n     </profile>\n     <profile>\n-        <name>Hive</name>\n+        <name>hive</name>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI5NDE3Ng=="}, "originalCommit": {"oid": "4179e68e5ff03afc24669edd9fe78a510028126b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5Mzg4NjU3OnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoxODo0N1rOH1AV_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoyNToyOVrOH1AnYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0MjIwNQ==", "bodyText": "should we do hive:orc:vectorized ? Or better yet give it as a user option VECTORIZE=true since other profiles might also want to support vectorized execution or we can even auto-apply it if necessary ?", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r525342205", "createdAt": "2020-11-17T17:18:47Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "diffHunk": "@@ -119,6 +171,19 @@ under the License.\n             <outputFormat>org.greenplum.pxf.api.io.GPDBWritable</outputFormat>\n         </plugins>\n     </profile>\n+    <profile>\n+        <name>hive:vectorizedorc</name>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4179e68e5ff03afc24669edd9fe78a510028126b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0NjY1OA==", "bodyText": "the latter would require a code change, let's discuss further", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r525346658", "createdAt": "2020-11-17T17:25:29Z", "author": {"login": "frankgh"}, "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "diffHunk": "@@ -119,6 +171,19 @@ under the License.\n             <outputFormat>org.greenplum.pxf.api.io.GPDBWritable</outputFormat>\n         </plugins>\n     </profile>\n+    <profile>\n+        <name>hive:vectorizedorc</name>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0MjIwNQ=="}, "originalCommit": {"oid": "4179e68e5ff03afc24669edd9fe78a510028126b"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTkwMjk4OnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODoxNjowN1rOH174FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODoxNjowN1rOH174FA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMxNzU4OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        GPDBWritable and TEXT output formats, as specified in FORMAT header parameter. Primary\n          \n          \n            \n                        GPDBWritable and TEXT output formats, as specified in FORMAT header parameter. Primarily", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r526317588", "createdAt": "2020-11-18T18:16:07Z", "author": {"login": "ashuka24"}, "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "diffHunk": "@@ -73,6 +73,25 @@ under the License.\n             <mapping option=\"ppd\" property=\"pxf.ppd.hive\"/>\n         </optionMappings>\n     </profile>\n+    <profile>\n+        <name>hive:rc</name>\n+        <description>This profile is suitable only for Hive tables stored in RC files and serialized\n+            with either the ColumnarSerDe or the LazyBinaryColumnarSerDe. It is much faster than the\n+            general purpose Hive profile. DELIMITER parameter is mandatory. Supports both\n+            GPDBWritable and TEXT output formats, as specified in FORMAT header parameter. Primary", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4179e68e5ff03afc24669edd9fe78a510028126b"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTkwNTc4OnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODoxNjo1NVrOH1758A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODoxNjo1NVrOH1758A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMxODA2NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Primary optimized for TEXT output format.\n          \n          \n            \n                        Primarily optimized for TEXT output format.", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r526318064", "createdAt": "2020-11-18T18:16:55Z", "author": {"login": "ashuka24"}, "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "diffHunk": "@@ -88,6 +107,21 @@ under the License.\n             <outputFormat>org.greenplum.pxf.api.io.Text</outputFormat>\n         </plugins>\n     </profile>\n+    <profile>\n+        <name>hive:text</name>\n+        <description>This profile is suitable only for Hive tables stored as Text files. It is much\n+            faster than the general purpose Hive profile. DELIMITER parameter is mandatory. Supports\n+            both GPDBWritable and TEXT output formats, as specified in FORMAT header parameter.\n+            Primary optimized for TEXT output format.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4179e68e5ff03afc24669edd9fe78a510028126b"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5OTkxMzA2OnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODoxODo0NVrOH17-lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxODoxODo0NVrOH17-lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMxOTI1NQ==", "bodyText": "shouldn't this be hive:orc now instead of using the HiveORC convention?", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r526319255", "createdAt": "2020-11-18T18:18:45Z", "author": {"login": "ashuka24"}, "path": "server/pxf-service/src/main/resources/pxf-profiles-default.xml", "diffHunk": "@@ -119,6 +171,19 @@ under the License.\n             <outputFormat>org.greenplum.pxf.api.io.GPDBWritable</outputFormat>\n         </plugins>\n     </profile>\n+    <profile>\n+        <name>hive:vectorizedorc</name>\n+        <description>This profile is same as HiveORC profile, but operates on batches of rows", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4179e68e5ff03afc24669edd9fe78a510028126b"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxOTY5MTczOnYy", "diffSide": "RIGHT", "path": "automation/src/main/java/org/greenplum/pxf/automation/structures/tables/utils/TableFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMDo0OToxMVrOIG_MxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMDo0OToxMVrOIG_MxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE5NzgyOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    exTable.setProfile(\"hbaase\");\n          \n          \n            \n                    exTable.setProfile(\"hbase\");", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r544197829", "createdAt": "2020-12-16T10:49:11Z", "author": {"login": "frankgh"}, "path": "automation/src/main/java/org/greenplum/pxf/automation/structures/tables/utils/TableFactory.java", "diffHunk": "@@ -159,7 +159,7 @@ public static ReadableExternalTable getPxfHBaseReadableTable(String tableName,\n                                                                  HBaseTable hbaseTable) {\n         ReadableExternalTable exTable = new ReadableExternalTable(tableName,\n                 fields, hbaseTable.getName(), \"CUSTOM\");\n-        exTable.setProfile(\"HBase\");\n+        exTable.setProfile(\"hbaase\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c434509c665bcfa130c0c90f44effba2b3436d54"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzMDk0ODc3OnYy", "diffSide": "RIGHT", "path": "server/pxf-hive/src/main/java/org/greenplum/pxf/plugins/hive/HiveProtocolHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxNDoxNjowNVrOIIkfDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOTowODoyNVrOIIvTww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg1NzI5NQ==", "bodyText": "should we do a case insensitive check here? or are we always lowercasing the profiles?", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r545857295", "createdAt": "2020-12-18T14:16:05Z", "author": {"login": "frankgh"}, "path": "server/pxf-hive/src/main/java/org/greenplum/pxf/plugins/hive/HiveProtocolHandler.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package org.greenplum.pxf.plugins.hive;\n+\n+import org.greenplum.pxf.api.model.ProtocolHandler;\n+import org.greenplum.pxf.api.model.RequestContext;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Implementation of ProtocolHandler for \"hive\" protocol.\n+ */\n+public class HiveProtocolHandler implements ProtocolHandler {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(HiveProtocolHandler.class);\n+    private static final String HIVE_VECTORIZED_ORC_ACCESSOR = HiveORCVectorizedAccessor.class.getName();\n+    private static final String HIVE_VECTORIZED_ORC_RESOLVER = HiveORCVectorizedResolver.class.getName();\n+    private static final String OPTION_VECTORIZE = \"VECTORIZE\";\n+\n+    @Override\n+    public String getFragmenterClassName(RequestContext context) {\n+        return context.getFragmenter(); // default to fragmenter defined by the profile\n+    }\n+\n+    @Override\n+    public String getAccessorClassName(RequestContext context) {\n+        // default to accessor defined by the profile, switch to vectorized if requested by the user\n+        String accessor = useHiveVectorizedORC(context) ? HIVE_VECTORIZED_ORC_ACCESSOR : context.getAccessor();\n+        LOG.debug(\"Determined to use {} accessor\", accessor);\n+        return accessor;\n+    }\n+\n+    @Override\n+    public String getResolverClassName(RequestContext context) {\n+        // default to resolver defined by the profile, switch to vectorized if requested by the user\n+        String resolver = useHiveVectorizedORC(context) ? HIVE_VECTORIZED_ORC_RESOLVER : context.getResolver();\n+        LOG.debug(\"Determined to use {} resolver\", resolver);\n+        return resolver;\n+    }\n+\n+    /**\n+     * Determines whether the user has requested to use vectorized ORC accessor / resolver\n+     * @param context request context\n+     * @return true if vectorized ORC accessor and resolver will need to be used\n+     */\n+    private boolean useHiveVectorizedORC(RequestContext context) {\n+        return (\"hive:orc\".equals(context.getProfile()) && context.getOption(OPTION_VECTORIZE, false));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75a7eb2e3dbde1d8b2e3b26dd8e54aca6dabe9ab"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzNDYyNw==", "bodyText": "we always lowercase the profile now and options are stored in a case-insensitive map", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r546034627", "createdAt": "2020-12-18T19:08:25Z", "author": {"login": "denalex"}, "path": "server/pxf-hive/src/main/java/org/greenplum/pxf/plugins/hive/HiveProtocolHandler.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package org.greenplum.pxf.plugins.hive;\n+\n+import org.greenplum.pxf.api.model.ProtocolHandler;\n+import org.greenplum.pxf.api.model.RequestContext;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Implementation of ProtocolHandler for \"hive\" protocol.\n+ */\n+public class HiveProtocolHandler implements ProtocolHandler {\n+\n+    private static final Logger LOG = LoggerFactory.getLogger(HiveProtocolHandler.class);\n+    private static final String HIVE_VECTORIZED_ORC_ACCESSOR = HiveORCVectorizedAccessor.class.getName();\n+    private static final String HIVE_VECTORIZED_ORC_RESOLVER = HiveORCVectorizedResolver.class.getName();\n+    private static final String OPTION_VECTORIZE = \"VECTORIZE\";\n+\n+    @Override\n+    public String getFragmenterClassName(RequestContext context) {\n+        return context.getFragmenter(); // default to fragmenter defined by the profile\n+    }\n+\n+    @Override\n+    public String getAccessorClassName(RequestContext context) {\n+        // default to accessor defined by the profile, switch to vectorized if requested by the user\n+        String accessor = useHiveVectorizedORC(context) ? HIVE_VECTORIZED_ORC_ACCESSOR : context.getAccessor();\n+        LOG.debug(\"Determined to use {} accessor\", accessor);\n+        return accessor;\n+    }\n+\n+    @Override\n+    public String getResolverClassName(RequestContext context) {\n+        // default to resolver defined by the profile, switch to vectorized if requested by the user\n+        String resolver = useHiveVectorizedORC(context) ? HIVE_VECTORIZED_ORC_RESOLVER : context.getResolver();\n+        LOG.debug(\"Determined to use {} resolver\", resolver);\n+        return resolver;\n+    }\n+\n+    /**\n+     * Determines whether the user has requested to use vectorized ORC accessor / resolver\n+     * @param context request context\n+     * @return true if vectorized ORC accessor and resolver will need to be used\n+     */\n+    private boolean useHiveVectorizedORC(RequestContext context) {\n+        return (\"hive:orc\".equals(context.getProfile()) && context.getOption(OPTION_VECTORIZE, false));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg1NzI5NQ=="}, "originalCommit": {"oid": "75a7eb2e3dbde1d8b2e3b26dd8e54aca6dabe9ab"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzMDk2NzgxOnYy", "diffSide": "RIGHT", "path": "server/pxf-hive/src/test/java/org/greenplum/pxf/plugins/hive/HiveProtocolHandlerTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxNDoyMDo1N1rOIIkqcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOToxMjozMVrOIIvfRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg2MDIxMA==", "bodyText": "we can use a real RequestContext, any reason why not instantiate an object for the test?", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r545860210", "createdAt": "2020-12-18T14:20:57Z", "author": {"login": "frankgh"}, "path": "server/pxf-hive/src/test/java/org/greenplum/pxf/plugins/hive/HiveProtocolHandlerTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package org.greenplum.pxf.plugins.hive;\n+\n+import org.greenplum.pxf.api.model.RequestContext;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.mockito.Mockito.when;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class HiveProtocolHandlerTest {\n+\n+    @Mock\n+    RequestContext context;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75a7eb2e3dbde1d8b2e3b26dd8e54aca6dabe9ab"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzNTIxNA==", "bodyText": "we can (and do in many places), but using mocks for RequestContext is the proper unit testing technique that does not rely on internal implementation of the RequestContext.", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r546035214", "createdAt": "2020-12-18T19:09:40Z", "author": {"login": "denalex"}, "path": "server/pxf-hive/src/test/java/org/greenplum/pxf/plugins/hive/HiveProtocolHandlerTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package org.greenplum.pxf.plugins.hive;\n+\n+import org.greenplum.pxf.api.model.RequestContext;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.mockito.Mockito.when;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class HiveProtocolHandlerTest {\n+\n+    @Mock\n+    RequestContext context;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg2MDIxMA=="}, "originalCommit": {"oid": "75a7eb2e3dbde1d8b2e3b26dd8e54aca6dabe9ab"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzNzU3Mw==", "bodyText": "either way it's fine, but since RequestContext is a pojo, we should be able to use it a real object.", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r546037573", "createdAt": "2020-12-18T19:12:31Z", "author": {"login": "frankgh"}, "path": "server/pxf-hive/src/test/java/org/greenplum/pxf/plugins/hive/HiveProtocolHandlerTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package org.greenplum.pxf.plugins.hive;\n+\n+import org.greenplum.pxf.api.model.RequestContext;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.mockito.Mockito.when;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class HiveProtocolHandlerTest {\n+\n+    @Mock\n+    RequestContext context;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg2MDIxMA=="}, "originalCommit": {"oid": "75a7eb2e3dbde1d8b2e3b26dd8e54aca6dabe9ab"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzMDk5NjM4OnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/test/java/org/greenplum/pxf/service/HttpRequestParserTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxNDoyODoxMlrOIIk7mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxOTowNzozN1rOIIvSUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg2NDYwMg==", "bodyText": "i see that we always lowercase the profile", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r545864602", "createdAt": "2020-12-18T14:28:12Z", "author": {"login": "frankgh"}, "path": "server/pxf-service/src/test/java/org/greenplum/pxf/service/HttpRequestParserTest.java", "diffHunk": "@@ -432,7 +431,25 @@ public void protocolIsSetWhenProfileIsSpecified() {\n         RequestContext context = parser.parseRequest(parameters, RequestType.FRAGMENTER);\n \n         assertEquals(\"test-protocol\", context.getProfileScheme());\n+    }\n+\n+    @Test\n+    public void protocolIsSetWhenProfileIsSpecifiedInMixedCase() {\n+        parameters.add(\"X-GP-OPTIONS-PROFILE\", \"teST-pROFile\");\n+        when(mockPluginConf.getProtocol(\"test-profile\")).thenReturn(\"test-protocol\");\n+\n+        RequestContext context = parser.parseRequest(parameters, RequestType.FRAGMENTER);\n+\n+        assertEquals(\"test-protocol\", context.getProfileScheme());\n+    }\n+\n+    @Test\n+    public void profileIsSetInLowerCase() {\n+        parameters.add(\"X-GP-OPTIONS-PROFILE\", \"teST-pROFile\");\n+\n+        RequestContext context = parser.parseRequest(parameters, RequestType.FRAGMENTER);\n \n+        assertEquals(\"test-profile\", context.getProfile());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75a7eb2e3dbde1d8b2e3b26dd8e54aca6dabe9ab"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAzNDI1OQ==", "bodyText": "yes, we do now", "url": "https://github.com/greenplum-db/pxf/pull/495#discussion_r546034259", "createdAt": "2020-12-18T19:07:37Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/test/java/org/greenplum/pxf/service/HttpRequestParserTest.java", "diffHunk": "@@ -432,7 +431,25 @@ public void protocolIsSetWhenProfileIsSpecified() {\n         RequestContext context = parser.parseRequest(parameters, RequestType.FRAGMENTER);\n \n         assertEquals(\"test-protocol\", context.getProfileScheme());\n+    }\n+\n+    @Test\n+    public void protocolIsSetWhenProfileIsSpecifiedInMixedCase() {\n+        parameters.add(\"X-GP-OPTIONS-PROFILE\", \"teST-pROFile\");\n+        when(mockPluginConf.getProtocol(\"test-profile\")).thenReturn(\"test-protocol\");\n+\n+        RequestContext context = parser.parseRequest(parameters, RequestType.FRAGMENTER);\n+\n+        assertEquals(\"test-protocol\", context.getProfileScheme());\n+    }\n+\n+    @Test\n+    public void profileIsSetInLowerCase() {\n+        parameters.add(\"X-GP-OPTIONS-PROFILE\", \"teST-pROFile\");\n+\n+        RequestContext context = parser.parseRequest(parameters, RequestType.FRAGMENTER);\n \n+        assertEquals(\"test-profile\", context.getProfile());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg2NDYwMg=="}, "originalCommit": {"oid": "75a7eb2e3dbde1d8b2e3b26dd8e54aca6dabe9ab"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3550, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}