{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4ODE3MjA5", "number": 394, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOToyNDo1NlrOEIf4CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozMjoyN1rOEIgBZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MzQ2MzEzOnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/BridgeResponse.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOToyNDo1NlrOGof9Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozNzoxOVrOGogVqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTExOTc5MQ==", "bodyText": "I don't know if we even should log this as error, since this is not really an error condition when GPDB routinely does this. maybe use WARN ?", "url": "https://github.com/greenplum-db/pxf/pull/394#discussion_r445119791", "createdAt": "2020-06-24T19:24:56Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/BridgeResponse.java", "diffHunk": "@@ -73,17 +73,24 @@ private Void writeToInternal(OutputStream out) throws IOException {\n                 ++recordCount;\n             }\n             LOG.debug(\"Finished streaming fragment {} of resource {}, {} records.\", fragment, dataDir, recordCount);\n-        } catch (ClientAbortException e) {\n-            // Occurs whenever client (GPDB) decides to end the connection\n-            if (LOG.isDebugEnabled()) {\n-                // Stacktrace in debug\n-                LOG.debug(\"Remote connection closed by GPDB\", e);\n+        } catch (Exception e) {\n+            IOException ioe;\n+            if (e instanceof ClientAbortException) {\n+                // Occurs whenever client (GPDB) decides to end the connection\n+                if (LOG.isDebugEnabled()) {\n+                    // Stacktrace in debug\n+                    LOG.debug(\"Remote connection closed by GPDB\", e);\n+                } else {\n+                    LOG.error(\"Remote connection closed by GPDB (Enable debug for stacktrace)\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f29fea0939f93011c18f38f02ebdaa842551f6c"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyNjA1Nw==", "bodyText": "true, it should be a warn", "url": "https://github.com/greenplum-db/pxf/pull/394#discussion_r445126057", "createdAt": "2020-06-24T19:37:19Z", "author": {"login": "frankgh"}, "path": "server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/BridgeResponse.java", "diffHunk": "@@ -73,17 +73,24 @@ private Void writeToInternal(OutputStream out) throws IOException {\n                 ++recordCount;\n             }\n             LOG.debug(\"Finished streaming fragment {} of resource {}, {} records.\", fragment, dataDir, recordCount);\n-        } catch (ClientAbortException e) {\n-            // Occurs whenever client (GPDB) decides to end the connection\n-            if (LOG.isDebugEnabled()) {\n-                // Stacktrace in debug\n-                LOG.debug(\"Remote connection closed by GPDB\", e);\n+        } catch (Exception e) {\n+            IOException ioe;\n+            if (e instanceof ClientAbortException) {\n+                // Occurs whenever client (GPDB) decides to end the connection\n+                if (LOG.isDebugEnabled()) {\n+                    // Stacktrace in debug\n+                    LOG.debug(\"Remote connection closed by GPDB\", e);\n+                } else {\n+                    LOG.error(\"Remote connection closed by GPDB (Enable debug for stacktrace)\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTExOTc5MQ=="}, "originalCommit": {"oid": "9f29fea0939f93011c18f38f02ebdaa842551f6c"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MzQ4Mzk1OnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/BridgeResponse.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozMToyMFrOGogJ6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozMToyMFrOGogJ6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMzA0OQ==", "bodyText": "I kinda like the previous logic better, where we handle ClientAbortException only and the common block of wrapping any exception as IOException, unless it is already an IOException.", "url": "https://github.com/greenplum-db/pxf/pull/394#discussion_r445123049", "createdAt": "2020-06-24T19:31:20Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/BridgeResponse.java", "diffHunk": "@@ -73,17 +73,24 @@ private Void writeToInternal(OutputStream out) throws IOException {\n                 ++recordCount;\n             }\n             LOG.debug(\"Finished streaming fragment {} of resource {}, {} records.\", fragment, dataDir, recordCount);\n-        } catch (ClientAbortException e) {\n-            // Occurs whenever client (GPDB) decides to end the connection\n-            if (LOG.isDebugEnabled()) {\n-                // Stacktrace in debug\n-                LOG.debug(\"Remote connection closed by GPDB\", e);\n+        } catch (Exception e) {\n+            IOException ioe;\n+            if (e instanceof ClientAbortException) {\n+                // Occurs whenever client (GPDB) decides to end the connection\n+                if (LOG.isDebugEnabled()) {\n+                    // Stacktrace in debug\n+                    LOG.debug(\"Remote connection closed by GPDB\", e);\n+                } else {\n+                    LOG.error(\"Remote connection closed by GPDB (Enable debug for stacktrace)\");\n+                }\n+                ioe = (ClientAbortException) e;\n+            } else if (e instanceof IOException) {\n+                ioe = (IOException) e;\n             } else {\n-                LOG.error(\"Remote connection closed by GPDB (Enable debug for stacktrace)\");\n+                ioe = new IOException(e.getMessage(), e);\n             }\n-            throw e;\n-        } catch (Exception e) {\n-            throw e instanceof IOException ? (IOException) e : new IOException(e.getMessage(), e);\n+            // Re-throw the exception so Spring MVC is aware that an IO error has occurred\n+            throw ioe;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f29fea0939f93011c18f38f02ebdaa842551f6c"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MzQ4NzEwOnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/WritableResource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozMjoyN1rOGogL4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozMjoyN1rOGogL4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMzU1NQ==", "bodyText": "why just not throw cae ?", "url": "https://github.com/greenplum-db/pxf/pull/394#discussion_r445123555", "createdAt": "2020-06-24T19:32:27Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/WritableResource.java", "diffHunk": "@@ -165,6 +165,8 @@ public WritableResource(BridgeFactory bridgeFactory, SecurityService securitySer\n                 } else {\n                     LOG.error(\"Remote connection closed by GPDB (Enable debug for stacktrace)\");\n                 }\n+                ex = cae;\n+                throw ex;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f29fea0939f93011c18f38f02ebdaa842551f6c"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3697, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}