{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NDM2Mjcw", "number": 304, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTo0NDoyNVrODh_eBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMjozOTowNVrODigNTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2OTY5NDc2OnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/scripts/pxf-service", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTo0NDoyNVrOFtCh-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTo0NDoyNVrOFtCh-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MTcwNw==", "bodyText": "this is good, but I think we should do it during Tomcat packaging into the build, it's a bit silly trying to remove something after we install it, and might be tricky for RPM install as well.", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382771707", "createdAt": "2020-02-21T19:44:25Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -118,6 +118,20 @@ function fail()\n     exit 1\n }\n \n+#\n+# tomcatHardening removes tomcat example JSP and servlets,\n+# server banner, default index page\n+#\n+function tomcatHardening()\n+{\n+    # Remove default/unwanted Applications\n+    rm -rf \"$tomcat_root\"/webapps/ROOT\n+    rm -rf \"$tomcat_root\"/webapps/docs\n+    rm -rf \"$tomcat_root\"/webapps/examples\n+    rm -rf \"$tomcat_root\"/webapps/host-manager\n+    rm -rf \"$tomcat_root\"/webapps/manager\n+}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2OTcwNTc0OnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/scripts/pxf-service", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTo0ODowN1rOFtCouQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo0OTo1NVrOFuQ8GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw==", "bodyText": "why so restrictive ? even owner will not be able to list files in this directory", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382773433", "createdAt": "2020-02-21T19:48:07Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -214,7 +228,8 @@ function createLogsDir()\n     if [[ ! -d $PXF_LOGDIR ]]; then\n         echo \"Creating PXF logs directory $PXF_LOGDIR ...\"\n         mkdir -p \"$PXF_LOGDIR\"\n-        chmod 700 \"$PXF_LOGDIR\"\n+        # only write/execute access\n+        chmod 300 \"$PXF_LOGDIR\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc4MjAyNg==", "bodyText": "this is the recommended for log files, only write/execute access for the catalina user", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382782026", "createdAt": "2020-02-21T20:07:31Z", "author": {"login": "frankgh"}, "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -214,7 +228,8 @@ function createLogsDir()\n     if [[ ! -d $PXF_LOGDIR ]]; then\n         echo \"Creating PXF logs directory $PXF_LOGDIR ...\"\n         mkdir -p \"$PXF_LOGDIR\"\n-        chmod 700 \"$PXF_LOGDIR\"\n+        # only write/execute access\n+        chmod 300 \"$PXF_LOGDIR\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI1NzY5Mg==", "bodyText": "In my local environment, it has become annoying to tail the pxf logs. Even though 300 is recommended, maybe it's not practical?", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383257692", "createdAt": "2020-02-24T13:15:31Z", "author": {"login": "frankgh"}, "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -214,7 +228,8 @@ function createLogsDir()\n     if [[ ! -d $PXF_LOGDIR ]]; then\n         echo \"Creating PXF logs directory $PXF_LOGDIR ...\"\n         mkdir -p \"$PXF_LOGDIR\"\n-        chmod 700 \"$PXF_LOGDIR\"\n+        # only write/execute access\n+        chmod 300 \"$PXF_LOGDIR\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU1NjEyOA==", "bodyText": "How is it annoying, what's the workaround?", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383556128", "createdAt": "2020-02-24T22:36:36Z", "author": {"login": "oliverralbertini"}, "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -214,7 +228,8 @@ function createLogsDir()\n     if [[ ! -d $PXF_LOGDIR ]]; then\n         echo \"Creating PXF logs directory $PXF_LOGDIR ...\"\n         mkdir -p \"$PXF_LOGDIR\"\n-        chmod 700 \"$PXF_LOGDIR\"\n+        # only write/execute access\n+        chmod 300 \"$PXF_LOGDIR\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg2ODU0Nw==", "bodyText": "sudo tail, but it's not practical, I agree. Maybe we should leave it at 700, but recommend 300 in the documentation?", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383868547", "createdAt": "2020-02-25T13:11:59Z", "author": {"login": "frankgh"}, "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -214,7 +228,8 @@ function createLogsDir()\n     if [[ ! -d $PXF_LOGDIR ]]; then\n         echo \"Creating PXF logs directory $PXF_LOGDIR ...\"\n         mkdir -p \"$PXF_LOGDIR\"\n-        chmod 700 \"$PXF_LOGDIR\"\n+        # only write/execute access\n+        chmod 300 \"$PXF_LOGDIR\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg2OTUxNw==", "bodyText": "after the directory exists, pxf init will not do anything, so maybe it's okay to ship with 300 and let the users decide to change it to 700?", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383869517", "createdAt": "2020-02-25T13:13:55Z", "author": {"login": "frankgh"}, "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -214,7 +228,8 @@ function createLogsDir()\n     if [[ ! -d $PXF_LOGDIR ]]; then\n         echo \"Creating PXF logs directory $PXF_LOGDIR ...\"\n         mkdir -p \"$PXF_LOGDIR\"\n-        chmod 700 \"$PXF_LOGDIR\"\n+        # only write/execute access\n+        chmod 300 \"$PXF_LOGDIR\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1NjM0NA==", "bodyText": "let's not over-restrict things -- they should be usable out-of-the-box and users still can harden it further if required.", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r384056344", "createdAt": "2020-02-25T18:49:55Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/scripts/pxf-service", "diffHunk": "@@ -214,7 +228,8 @@ function createLogsDir()\n     if [[ ! -d $PXF_LOGDIR ]]; then\n         echo \"Creating PXF logs directory $PXF_LOGDIR ...\"\n         mkdir -p \"$PXF_LOGDIR\"\n-        chmod 700 \"$PXF_LOGDIR\"\n+        # only write/execute access\n+        chmod 300 \"$PXF_LOGDIR\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3MzQzMw=="}, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2OTcxODUwOnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTo1MjoyMFrOFtCwbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTo1MjoyMFrOFtCwbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3NTQwNQ==", "bodyText": "web.xml also needs to be updated, it contains JSP servlet, welcome pages, etc", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382775405", "createdAt": "2020-02-21T19:52:20Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "diffHunk": "@@ -52,9 +52,13 @@ under the License.\n                        pattern=\"%h %l %u %t &quot;%r&quot; %s %b\"\n                        prefix=\"localhost_access_log.\"\n                        suffix=\".txt\"/>\n+                <Valve className=\"org.apache.catalina.valves.ErrorReportValve\"\n+                       showReport=\"true\"\n+                       showServerInfo=\"false\"/>\n             </Host>\n         </Engine>\n-        <Connector acceptCount=\"100\"\n+        <Connector server=\"PXF Server\"\n+                   acceptCount=\"100\"\n                    connectionTimeout=\"20000\"\n                    executor=\"tomcatThreadPool\"\n                    maxKeepAliveRequests=\"15\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2OTcyMjI4OnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTo1Mzo0MVrOFtCy8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOTo1Mzo0MVrOFtCy8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc3NjA1MQ==", "bodyText": "we also do not use \"in-memory user database\" in lines 26-31", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r382776051", "createdAt": "2020-02-21T19:53:41Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "diffHunk": "@@ -52,9 +52,13 @@ under the License.\n                        pattern=\"%h %l %u %t &quot;%r&quot; %s %b\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c81fe5632d2fa12a883168c6a24ebe6b1d790b2"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NTA1ODcwOnYy", "diffSide": "RIGHT", "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMjozOTowNVrOFtydzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMzoxNjoxNVrOFuFnKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU1NzA3MA==", "bodyText": "what does adding server field do for security?", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383557070", "createdAt": "2020-02-24T22:39:05Z", "author": {"login": "oliverralbertini"}, "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "diffHunk": "@@ -52,9 +40,13 @@ under the License.\n                        pattern=\"%h %l %u %t &quot;%r&quot; %s %b\"\n                        prefix=\"localhost_access_log.\"\n                        suffix=\".txt\"/>\n+                <Valve className=\"org.apache.catalina.valves.ErrorReportValve\"\n+                       showReport=\"true\"\n+                       showServerInfo=\"false\"/>\n             </Host>\n         </Engine>\n-        <Connector acceptCount=\"100\"\n+        <Connector server=\"PXF Server\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d76985218ad756aa001829cb0a64de86e721e03"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg3MDc2MA==", "bodyText": "It displays PXF Server for the server value in the response headers\n\u00b1  |harden-tomcat \u2192 origin {34} U:1 ?:20 \u2717| \u2192 curl -i http://localhost:5888/pxf/v0\nHTTP/1.1 500 Internal Server Error\nContent-Type: text/plain\nTransfer-Encoding: chunked\nDate: Tue, 25 Feb 2020 13:15:23 GMT\nConnection: close\nServer: PXF Server", "url": "https://github.com/greenplum-db/pxf/pull/304#discussion_r383870760", "createdAt": "2020-02-25T13:16:15Z", "author": {"login": "frankgh"}, "path": "server/pxf-service/src/templates/tomcat/conf/server.xml", "diffHunk": "@@ -52,9 +40,13 @@ under the License.\n                        pattern=\"%h %l %u %t &quot;%r&quot; %s %b\"\n                        prefix=\"localhost_access_log.\"\n                        suffix=\".txt\"/>\n+                <Valve className=\"org.apache.catalina.valves.ErrorReportValve\"\n+                       showReport=\"true\"\n+                       showServerInfo=\"false\"/>\n             </Host>\n         </Engine>\n-        <Connector acceptCount=\"100\"\n+        <Connector server=\"PXF Server\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzU1NzA3MA=="}, "originalCommit": {"oid": "1d76985218ad756aa001829cb0a64de86e721e03"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3578, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}