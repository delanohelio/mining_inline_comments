{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0MDM0OTk2", "number": 302, "title": "Make pxf cluster sync delete files", "bodyText": "Previously pxf cluster sync was not deleting files from PXF_CONF that\nhad been deleted on master. By adding the --delete flag to the rsync\ncommands, we delete files from remote hosts.\nAuthored-by: Oliver Albertini oalbertini@pivotal.io", "createdAt": "2020-02-12T01:10:37Z", "url": "https://github.com/greenplum-db/pxf/pull/302", "merged": true, "mergeCommit": {"oid": "741ab88967216c950616d2cfb224553c2d973cbe"}, "closed": true, "closedAt": "2020-02-25T19:29:24Z", "author": {"login": "oliverralbertini"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcD-oS9gBqjMwMzU4ODkzMTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcH3RMvgBqjMwNzA2ODkxOTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4257b19a1fec589712af96be4034b90e8d121511", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/4257b19a1fec589712af96be4034b90e8d121511", "committedDate": "2020-02-13T17:36:41Z", "message": "pxf cluster sync: add flag to avoid file deletion\n\nWas easier to do by moving the pxf package into cmd.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "aebaa1c6c3ba4e77fc7b0f551603130a65f8b44f", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/aebaa1c6c3ba4e77fc7b0f551603130a65f8b44f", "committedDate": "2020-02-13T17:45:38Z", "message": "pxf cluster sync: add flag to avoid file deletion\n\nWas easier to do by moving the pxf package into cmd.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aebaa1c6c3ba4e77fc7b0f551603130a65f8b44f", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/aebaa1c6c3ba4e77fc7b0f551603130a65f8b44f", "committedDate": "2020-02-13T17:45:38Z", "message": "pxf cluster sync: add flag to avoid file deletion\n\nWas easier to do by moving the pxf package into cmd.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "9c7e5ac06ea2e580f7d2dbcd479b6d7b5b7e713d", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/9c7e5ac06ea2e580f7d2dbcd479b6d7b5b7e713d", "committedDate": "2020-02-13T17:54:05Z", "message": "pxf cluster sync: add flag to avoid file deletion\n\nWas easier to do by moving the pxf package into cmd.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "54f86e177d7f226f23e14a454155cbcf01a17c4b", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/54f86e177d7f226f23e14a454155cbcf01a17c4b", "committedDate": "2020-02-14T06:15:56Z", "message": "Refactor code\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "752447ea037211718d2c55c41ee84932a89ff941", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/752447ea037211718d2c55c41ee84932a89ff941", "committedDate": "2020-02-14T07:26:29Z", "message": "Refactor code\n\nThe code had a lot of exported vars from when pxf was in a separate\npackage. Now that we unified the cmd/pxf pkgs, we don't need to make\nthings externally visible, except for testing. The ones that are\nexternal are now marked with a comment explaining that.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "752447ea037211718d2c55c41ee84932a89ff941", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/752447ea037211718d2c55c41ee84932a89ff941", "committedDate": "2020-02-14T07:26:29Z", "message": "Refactor code\n\nThe code had a lot of exported vars from when pxf was in a separate\npackage. Now that we unified the cmd/pxf pkgs, we don't need to make\nthings externally visible, except for testing. The ones that are\nexternal are now marked with a comment explaining that.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "abfab1f8b73f03e9c62b4ea83d24b0f5d387b64f", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/abfab1f8b73f03e9c62b4ea83d24b0f5d387b64f", "committedDate": "2020-02-14T17:05:02Z", "message": "Refactor code\n\nThe code had a lot of exported vars from when pxf was in a separate\npackage. Now that we unified the cmd/pxf pkgs, we don't need to make\nthings externally visible, except for testing. The ones that are\nexternal are now marked with a comment explaining that.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMTgwMjk3", "url": "https://github.com/greenplum-db/pxf/pull/302#pullrequestreview-361180297", "createdAt": "2020-02-19T14:55:59Z", "commit": {"oid": "abfab1f8b73f03e9c62b4ea83d24b0f5d387b64f"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDo1NTo1OVrOFrrY7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDo1ODo0NlrOFrrhCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0Mzk4MA==", "bodyText": "maybe be more explicit here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tsyncCmd.Flags().BoolVarP(&NonDestructiveSync, \"non-destructive\", \"n\", false, \"Don't delete files on remote host\")\n          \n          \n            \n            \tsyncCmd.Flags().BoolVarP(&NonDestructiveSync, \"non-destructive\", \"n\", false, \"Do not delete files on segment hosts that have been deleted on master host\")", "url": "https://github.com/greenplum-db/pxf/pull/302#discussion_r381343980", "createdAt": "2020-02-19T14:55:59Z", "author": {"login": "frankgh"}, "path": "cli/go/src/pxf-cli/cmd/cluster.go", "diffHunk": "@@ -54,6 +56,7 @@ func init() {\n \tclusterCmd.AddCommand(startCmd)\n \tclusterCmd.AddCommand(stopCmd)\n \tclusterCmd.AddCommand(statusCmd)\n+\tsyncCmd.Flags().BoolVarP(&NonDestructiveSync, \"non-destructive\", \"n\", false, \"Don't delete files on remote host\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abfab1f8b73f03e9c62b4ea83d24b0f5d387b64f"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM0NjA1Nw==", "bodyText": "I assume this is the file that was moved from .../pxf/ to cmd correct?", "url": "https://github.com/greenplum-db/pxf/pull/302#discussion_r381346057", "createdAt": "2020-02-19T14:58:46Z", "author": {"login": "frankgh"}, "path": "cli/go/src/pxf-cli/cmd/pxf.go", "diffHunk": "@@ -0,0 +1,205 @@\n+package cmd", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abfab1f8b73f03e9c62b4ea83d24b0f5d387b64f"}, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e5f0b59267e4f6b7657c138b9b193d705fabd51b", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/e5f0b59267e4f6b7657c138b9b193d705fabd51b", "committedDate": "2020-02-21T01:25:22Z", "message": "Incorporate Lisa's feedback about flag\n\nNow the default is to not delete extraneous files, user provides -d or\n--delete flag to get that behavior, mirrors rsync more closely.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "7136a48276ca59c4bc89a8c440e5d9124061b9b3", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/7136a48276ca59c4bc89a8c440e5d9124061b9b3", "committedDate": "2020-02-21T04:15:55Z", "message": "Incorporate Lisa's feedback about flag\n\nNow the default is to not delete extraneous files, user provides -d or\n--delete flag to get that behavior, mirrors rsync more closely.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7136a48276ca59c4bc89a8c440e5d9124061b9b3", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/7136a48276ca59c4bc89a8c440e5d9124061b9b3", "committedDate": "2020-02-21T04:15:55Z", "message": "Incorporate Lisa's feedback about flag\n\nNow the default is to not delete extraneous files, user provides -d or\n--delete flag to get that behavior, mirrors rsync more closely.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "a655dbba12d5fd58d1f041a531985b2b18409a1b", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/a655dbba12d5fd58d1f041a531985b2b18409a1b", "committedDate": "2020-02-21T04:32:43Z", "message": "Incorporate Lisa's feedback about flag\n\nNow the default is to not delete extraneous files, user provides -d or\n--delete flag to get that behavior, mirrors rsync more closely.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8f3eb6eb70c3244627a1a060b2915038980cd91", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/a8f3eb6eb70c3244627a1a060b2915038980cd91", "committedDate": "2020-02-21T15:57:38Z", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "a1dd31814205a870263a8ede7121524c589023d7", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/a1dd31814205a870263a8ede7121524c589023d7", "committedDate": "2020-02-21T16:01:49Z", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1dd31814205a870263a8ede7121524c589023d7", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/a1dd31814205a870263a8ede7121524c589023d7", "committedDate": "2020-02-21T16:01:49Z", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "2648c8cc7be14bc7b83d0824d1d6caf5c401d3e0", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/2648c8cc7be14bc7b83d0824d1d6caf5c401d3e0", "committedDate": "2020-02-21T16:03:34Z", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2648c8cc7be14bc7b83d0824d1d6caf5c401d3e0", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/2648c8cc7be14bc7b83d0824d1d6caf5c401d3e0", "committedDate": "2020-02-21T16:03:34Z", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "7af037b9d9a3e6f53aaa6d3568fcbd7a88db5343", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/7af037b9d9a3e6f53aaa6d3568fcbd7a88db5343", "committedDate": "2020-02-21T20:21:16Z", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7af037b9d9a3e6f53aaa6d3568fcbd7a88db5343", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/7af037b9d9a3e6f53aaa6d3568fcbd7a88db5343", "committedDate": "2020-02-21T20:21:16Z", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "committedDate": "2020-02-24T23:19:02Z", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "07f60f0943da07a9bb1c6e5654c0c2f1561ee143", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/07f60f0943da07a9bb1c6e5654c0c2f1561ee143", "committedDate": "2020-02-25T00:44:01Z", "message": "Enforce JAVA_HOME is set\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "committedDate": "2020-02-24T23:19:02Z", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MzY0ODE4", "url": "https://github.com/greenplum-db/pxf/pull/302#pullrequestreview-364364818", "createdAt": "2020-02-25T18:54:45Z", "commit": {"oid": "b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo1NDo0NVrOFuRGsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo1NTo1OFrOFuRJVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1OTA1OQ==", "bodyText": "should ERROR be logged at ERROR level rather than INFO ?", "url": "https://github.com/greenplum-db/pxf/pull/302#discussion_r384059059", "createdAt": "2020-02-25T18:54:45Z", "author": {"login": "denalex"}, "path": "cli/go/src/pxf-cli/cmd/cluster.go", "diffHunk": "@@ -111,12 +117,12 @@ func GenerateOutput(command *pxf.Command, clusterData *ClusterData) error {\n \t\t}\n \t\tresponse += fmt.Sprintf(\"%s ==> %s\\n\", host, errorMessage)\n \t}\n-\tgplog.Info(\"ERROR: \"+command.Messages(pxf.Error), numErrors, numHosts)\n+\tgplog.Info(\"ERROR: \"+cmd.messages[err], numErrors, numHosts)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1OTczMg==", "bodyText": "should this be Warn level ?", "url": "https://github.com/greenplum-db/pxf/pull/302#discussion_r384059732", "createdAt": "2020-02-25T18:55:58Z", "author": {"login": "denalex"}, "path": "cli/go/src/pxf-cli/cmd/cluster.go", "diffHunk": "@@ -146,28 +152,28 @@ func adaptContentIDToHostname(cluster *cluster.Cluster, f func(string) string) f\n \t}\n }\n \n-func clusterRun(command *pxf.Command, clusterData *ClusterData) error {\n+func clusterRun(cmd *command, clusterData *ClusterData) error {\n \tdefer clusterData.connection.Close()\n \n-\terr := command.Warn(os.Stdin)\n+\terr := cmd.Warn(os.Stdin)\n \tif err != nil {\n \t\tgplog.Info(fmt.Sprintf(\"%s\", err))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990"}, "originalPosition": 139}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "741ab88967216c950616d2cfb224553c2d973cbe", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/741ab88967216c950616d2cfb224553c2d973cbe", "committedDate": "2020-02-25T19:26:05Z", "message": "pxf cluster sync: support deletion of extraneous files\n\nPreviously pxf [cluster] sync did not delete files from PXF_CONF that\nhad been deleted on master. By adding the `--delete` flag to the rsync\ncommands, we delete files from remote hosts. The user can use this\nfunctionality by doing:\n\npxf cluster sync -d\npxf cluster sync --delete.\npxf sync -d <host>\npxf sync --delete <host>\n\nThis change also consolidates the pxf/cmd go packages into cmd only.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/b74d2dd7213e4e730b4a1eb1d1ce8a71c0199990", "committedDate": "2020-02-24T23:19:02Z", "message": "Add --delete functionality to pxf-service\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}, "afterCommit": {"oid": "741ab88967216c950616d2cfb224553c2d973cbe", "author": {"user": {"login": "oliverralbertini", "name": "Oliver Albertini"}}, "url": "https://github.com/greenplum-db/pxf/commit/741ab88967216c950616d2cfb224553c2d973cbe", "committedDate": "2020-02-25T19:26:05Z", "message": "pxf cluster sync: support deletion of extraneous files\n\nPreviously pxf [cluster] sync did not delete files from PXF_CONF that\nhad been deleted on master. By adding the `--delete` flag to the rsync\ncommands, we delete files from remote hosts. The user can use this\nfunctionality by doing:\n\npxf cluster sync -d\npxf cluster sync --delete.\npxf sync -d <host>\npxf sync --delete <host>\n\nThis change also consolidates the pxf/cmd go packages into cmd only.\n\nAuthored-by: Oliver Albertini <oalbertini@pivotal.io>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4987, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}