{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4Njg2ODMw", "number": 358, "title": "Fix Glob Patterns for Hadoop-Compatible FileSystems", "bodyText": "Added unit tests\nAdded integration tests that test the following:\n\n\n\n\nPattern\nDescription\n\n\n\n\n?\nMatches any single character\n\n\n*\nMatches zero or more characters\n\n\n[abc]\nMatches a single character from character set {a,b,c}.\n\n\n[a-b]\nMatches a single character from the character range {a\u2026b}.\n\n\n[^a]\nMatches a single character that is not from character set or range {a}. Note that the \u201c^\u201dcharacter must occur immediately to the right of the opening bracket.\n\n\n\\c\nRemoves (escapes) any special meaning of character c.\n\n\n{ab,cd}\nMatches a string from the string set {ab, cd}.\n\n\n{ab,c{de, fh}}\nMatches a string from the string set {ab, cde, cfh}.", "createdAt": "2020-05-15T16:27:51Z", "url": "https://github.com/greenplum-db/pxf/pull/358", "merged": true, "mergeCommit": {"oid": "70d0fd96a18183b34b26344cd3401328bb093774"}, "closed": true, "closedAt": "2020-05-22T02:06:45Z", "author": {"login": "frankgh"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchk_2_gBqjMzNDE3NTA3NDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjohVvgBqjMzNjI5NTY0MjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7d0dd9a7576c517bbe85172f451376afba10875", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/b7d0dd9a7576c517bbe85172f451376afba10875", "committedDate": "2020-05-15T16:26:01Z", "message": "Fix Glob Patterns for Hadoop-Compatible FileSystems\n\n- Added unit tests\n- Added integration tests that test the following:\n\n| Pattern        | Description                                                                                                                                                    |\n|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| ?              | Matches any single character                                                                                                                                   |\n| *              | Matches zero or more characters                                                                                                                                |\n| [abc]          | Matches a single character from character set {a,b,c}.                                                                                                         |\n| [a-b]          | Matches a single character from the character range {a\u2026b}.                                                                                                     |\n| [^a]           | Matches a single character that is not from character set or range {a}. Note that the \u201c^\u201dcharacter must occur immediately to the right of the opening bracket. |\n| \\c             | Removes (escapes) any special meaning of character c.                                                                                                          |\n| {ab,cd}        | Matches a string from the string set {ab, cd}.                                                                                                                 |\n| {ab,c{de, fh}} | Matches a string from the string set {ab, cde, cfh}.                                                                                                           |"}, "afterCommit": {"oid": "db1e04bb9c0ce7285c4176089eaeacaff915eb93", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/db1e04bb9c0ce7285c4176089eaeacaff915eb93", "committedDate": "2020-05-15T16:51:47Z", "message": "Fix Glob Patterns for Hadoop-Compatible FileSystems\n\n- Added unit tests\n- Added integration tests that test the following:\n\n| Pattern        | Description                                                                                                                                                    |\n|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| ?              | Matches any single character                                                                                                                                   |\n| *              | Matches zero or more characters                                                                                                                                |\n| [abc]          | Matches a single character from character set {a,b,c}.                                                                                                         |\n| [a-b]          | Matches a single character from the character range {a\u2026b}.                                                                                                     |\n| [^a]           | Matches a single character that is not from character set or range {a}. Note that the \u201c^\u201dcharacter must occur immediately to the right of the opening bracket. |\n| \\c             | Removes (escapes) any special meaning of character c.                                                                                                          |\n| {ab,cd}        | Matches a string from the string set {ab, cd}.                                                                                                                 |\n| {ab,c{de, fh}} | Matches a string from the string set {ab, cde, cfh}.                                                                                                           |"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b19592b9d7cad321497f6fc6ad7b23367b6ffa73", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/b19592b9d7cad321497f6fc6ad7b23367b6ffa73", "committedDate": "2020-05-15T21:54:06Z", "message": "Use collate for consistent output between OSX and linux"}, "afterCommit": {"oid": "6eea6456edd1a8403bdd9aeed40df09c79c4217a", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/6eea6456edd1a8403bdd9aeed40df09c79c4217a", "committedDate": "2020-05-15T22:06:43Z", "message": "Use collate for consistent output between OSX and linux"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "401f08e1c51b65a54ea2ba5481f328922ad9e9d9", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/401f08e1c51b65a54ea2ba5481f328922ad9e9d9", "committedDate": "2020-05-15T22:23:34Z", "message": "Fix expected error message on cloud"}, "afterCommit": {"oid": "69bc3641cc3e82a8b0a088e104cc8dd91cbf55e9", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/69bc3641cc3e82a8b0a088e104cc8dd91cbf55e9", "committedDate": "2020-05-15T23:07:41Z", "message": "Fix expected error message on cloud"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69bc3641cc3e82a8b0a088e104cc8dd91cbf55e9", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/69bc3641cc3e82a8b0a088e104cc8dd91cbf55e9", "committedDate": "2020-05-15T23:07:41Z", "message": "Fix expected error message on cloud"}, "afterCommit": {"oid": "4123bfe8c3fb2c8f8d7ba22dab26d18fccb68599", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/4123bfe8c3fb2c8f8d7ba22dab26d18fccb68599", "committedDate": "2020-05-15T23:46:37Z", "message": "Fix expected error message on cloud"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTAyOTQ1", "url": "https://github.com/greenplum-db/pxf/pull/358#pullrequestreview-416502945", "createdAt": "2020-05-21T21:23:55Z", "commit": {"oid": "62cda9291f992f9d71dd612f0b79915952a171b3"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMToyMzo1NVrOGZDXnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMToyNzowNFrOGZDeCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkyMjc4MQ==", "bodyText": "nice test, would be good to also see smith starting with a slash /foo/bar and variations", "url": "https://github.com/greenplum-db/pxf/pull/358#discussion_r428922781", "createdAt": "2020-05-21T21:23:55Z", "author": {"login": "denalex"}, "path": "server/pxf-api/src/test/java/org/greenplum/pxf/api/utilities/UtilitiesTest.java", "diffHunk": "@@ -413,4 +413,48 @@ public void testSecurityIsEnabledWithKerberosAuthentication() {\n         configuration.set(\"hadoop.security.authentication\", \"kerberos\");\n         assertTrue(Utilities.isSecurityEnabled(configuration));\n     }\n+\n+    @Test\n+    public void testGetHost() {\n+\n+        assertNull(Utilities.getHost(null));\n+        assertNull(Utilities.getHost(\"\"));\n+        assertNull(Utilities.getHost(\"  \"));\n+        assertNull(Utilities.getHost(\":\"));\n+        assertNull(Utilities.getHost(\"#\"));\n+        assertNull(Utilities.getHost(\"/\"));\n+\n+        assertEquals(\"www.google.com\", Utilities.getHost(\"https://www.google.com/\"));\n+        assertEquals(\"www.google.com\", Utilities.getHost(\"http://www.google.com/\"));\n+\n+        assertEquals(\"www.blog.classroom.me.uk\", Utilities.getHost(\"http://www.blog.classroom.me.uk/index.php\"));\n+        assertEquals(\"www.youtube.com\", Utilities.getHost(\"http://www.youtube.com/watch?v=ClkQA2Lb_iE\"));\n+        assertEquals(\"www.youtube.com\", Utilities.getHost(\"https://www.youtube.com/watch?v=ClkQA2Lb_iE\"));\n+        assertEquals(\"www.youtube.com\", Utilities.getHost(\"www.youtube.com/watch?v=ClkQA2Lb_iE\"));\n+        assertEquals(\"ftp.websitename.com\", Utilities.getHost(\"ftps://ftp.websitename.com/dir/file.txt\"));\n+        assertEquals(\"websitename.com\", Utilities.getHost(\"websitename.com:1234/dir/file.txt\"));\n+        assertEquals(\"websitename.com\", Utilities.getHost(\"ftps://websitename.com:1234/dir/file.txt\"));\n+        assertEquals(\"example.com\", Utilities.getHost(\"example.com?param=value\"));\n+        assertEquals(\"facebook.github.io\", Utilities.getHost(\"https://facebook.github.io/jest/\"));\n+        assertEquals(\"youtube.com\", Utilities.getHost(\"//youtube.com/watch?v=ClkQA2Lb_iE\"));\n+        assertEquals(\"localhost\", Utilities.getHost(\"http://localhost:4200/watch?v=ClkQA2Lb_iE\"));\n+\n+        assertEquals(\"127.0.0.1\", Utilities.getHost(\"hdfs://127.0.0.1:8020\"));\n+        assertEquals(\"my-bucket\", Utilities.getHost(\"s3a://my-bucket/foo/ba[rc]\"));\n+        assertEquals(\"foo\", Utilities.getHost(\"s3://foo/bar.txt\"));\n+        assertEquals(\"foo.azuredatalakestore.net\", Utilities.getHost(\"adl://foo.azuredatalakestore.net/foo/bar.txt\"));\n+        assertEquals(\"foo\", Utilities.getHost(\"xyz://foo/bar.txt\"));\n+        assertEquals(\"0.0.0.0\", Utilities.getHost(\"xyz://0.0.0.0:80/foo/bar.txt\"));\n+        assertEquals(\"abc\", Utilities.getHost(\"xyz://abc/foo/bar.txt\"));\n+        assertNull(Utilities.getHost(\"file:///foo/bar.txt\"));\n+        assertEquals(\"0.0.0.0\", Utilities.getHost(\"hdfs://0.0.0.0:8020\"));\n+        assertEquals(\"abc\", Utilities.getHost(\"hdfs://abc:8020/foo/bar.txt\"));\n+        assertEquals(\"0.0.0.0\", Utilities.getHost(\"hdfs://0.0.0.0:8020/tmp/issues/172848577/[a-b].csv\"));\n+\n+        assertEquals(\"0.0.0.0\", Utilities.getHost(\"hdfs://0.0.0.0#anchor\"));\n+        assertEquals(\"0.0.0.0\", Utilities.getHost(\"hdfs://0.0.0.0/p\"));\n+        assertEquals(\"0.0.0.0\", Utilities.getHost(\"hdfs://0.0.0.0?PROFILE=foo\"));\n+        assertEquals(\"www.example.com\", Utilities.getHost(\"www.example.com\"));\n+        assertEquals(\"10.0.0.15\", Utilities.getHost(\"10.0.0.15\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62cda9291f992f9d71dd612f0b79915952a171b3"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkyNDQyNg==", "bodyText": "I would like to preserve the comment on why we are finding the hostname in the first place", "url": "https://github.com/greenplum-db/pxf/pull/358#discussion_r428924426", "createdAt": "2020-05-21T21:27:04Z", "author": {"login": "denalex"}, "path": "server/pxf-hdfs/src/main/java/org/greenplum/pxf/plugins/hdfs/HcfsType.java", "diffHunk": "@@ -235,15 +233,12 @@ protected String getDataUriForPrefix(Configuration configuration, String dataSou\n      * @param configuration configuration used for HCFS operations\n      */\n     protected void disableSecureTokenRenewal(String uri, Configuration configuration) {\n-        if (Utilities.isSecurityEnabled(configuration))\n+        if (Utilities.isSecurityEnabled(configuration) || StringUtils.isBlank(uri))\n             return;\n \n-        // find the \"host\" that TokenCache will check against the exclusion list, for cloud file systems (like S3)\n-        // it might actually be a bucket in the full resource path\n-        String host = URI.create(StringUtils.replace(uri, \" \", \"%20\")).getHost();\n-        // String host = URI.create(uri).getHost();\n-        LOG.debug(\"Disabling token renewal for host {} for path {}\", host, uri);\n+        String host = Utilities.getHost(uri);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62cda9291f992f9d71dd612f0b79915952a171b3"}, "originalPosition": 86}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4353abaa6bdef68644583bf32cab35c106c0ef2", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/b4353abaa6bdef68644583bf32cab35c106c0ef2", "committedDate": "2020-05-22T02:05:49Z", "message": "Fix Glob Patterns for Hadoop-Compatible FileSystems\n\n- Added unit tests\n- Added integration tests that test the following:\n\n| Pattern        | Description                                                                                                                                                    |\n|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| ?              | Matches any single character                                                                                                                                   |\n| *              | Matches zero or more characters                                                                                                                                |\n| [abc]          | Matches a single character from character set {a,b,c}.                                                                                                         |\n| [a-b]          | Matches a single character from the character range {a\u2026b}.                                                                                                     |\n| [^a]           | Matches a single character that is not from character set or range {a}. Note that the \u201c^\u201dcharacter must occur immediately to the right of the opening bracket. |\n| \\c             | Removes (escapes) any special meaning of character c.                                                                                                          |\n| {ab,cd}        | Matches a string from the string set {ab, cd}.                                                                                                                 |\n| {ab,c{de, fh}} | Matches a string from the string set {ab, cde, cfh}.                                                                                                           |"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e654e0422fa888cd11614e23fb77387261e10137", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/e654e0422fa888cd11614e23fb77387261e10137", "committedDate": "2020-05-22T02:05:49Z", "message": "Skip if URI is blank"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8a7d600304667f454fc6f988b4a7451338837a1", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/c8a7d600304667f454fc6f988b4a7451338837a1", "committedDate": "2020-05-22T02:05:49Z", "message": "Fix imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6adb6ea3f557ba247b6567151fc3ce3f63bc777", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/a6adb6ea3f557ba247b6567151fc3ce3f63bc777", "committedDate": "2020-05-22T02:05:49Z", "message": "Implement getHost ourselves to support invalid chars in URI (i.e. [)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ea4a71368b284dfcffe0b7cb23ded362e5ca14d", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/2ea4a71368b284dfcffe0b7cb23ded362e5ca14d", "committedDate": "2020-05-22T02:05:50Z", "message": "Fix automation tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7839745a2fb5a4c09f4efa90bf3cc5775cf93655", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/7839745a2fb5a4c09f4efa90bf3cc5775cf93655", "committedDate": "2020-05-22T02:05:50Z", "message": "Use collate for consistent output between OSX and linux"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1023c831e466de6a719ddbcb6eec0093ee85c0a1", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/1023c831e466de6a719ddbcb6eec0093ee85c0a1", "committedDate": "2020-05-22T02:05:50Z", "message": "Fix expected error message on cloud"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "890a3c76c19314da46908edb48c97009a68461cd", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/890a3c76c19314da46908edb48c97009a68461cd", "committedDate": "2020-05-22T02:05:50Z", "message": "Collate one more"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98b3dc5043ddc5e299038eaad439712ef0a5d6e3", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/98b3dc5043ddc5e299038eaad439712ef0a5d6e3", "committedDate": "2020-05-22T02:05:50Z", "message": "Address PR feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "faecf7fcf777b93859a0dee9c1406332c08ccf60", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/faecf7fcf777b93859a0dee9c1406332c08ccf60", "committedDate": "2020-05-21T21:40:55Z", "message": "Address PR feedback"}, "afterCommit": {"oid": "98b3dc5043ddc5e299038eaad439712ef0a5d6e3", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/98b3dc5043ddc5e299038eaad439712ef0a5d6e3", "committedDate": "2020-05-22T02:05:50Z", "message": "Address PR feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 62, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}