{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMTI1ODAz", "number": 398, "title": "Spring boot Performance", "bodyText": "Settings used to make the performance pipeline pass", "createdAt": "2020-06-30T15:51:59Z", "url": "https://github.com/greenplum-db/pxf/pull/398", "merged": true, "mergeCommit": {"oid": "2659ffed524009b43663758ba03a81240888b381"}, "closed": true, "closedAt": "2020-07-01T23:07:42Z", "author": {"login": "frankgh"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvJlpFgH2gAyNDQyMTI1ODAzOmQwYTJmZjZhMWI2Y2Q2YzU4NmFlMGUwMzkzZDExM2IzNTE3NjBhOWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwyh81gFqTQ0MTI0OTQ4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d0a2ff6a1b6cd6c586ae0e0393d113b351760a9c", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/d0a2ff6a1b6cd6c586ae0e0393d113b351760a9c", "committedDate": "2020-06-26T20:50:47Z", "message": "Add more information for performance testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "943eaed41d51d8a062b19835b98f27f6fac46947", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/943eaed41d51d8a062b19835b98f27f6fac46947", "committedDate": "2020-06-26T20:58:46Z", "message": "set connection-timeout to -1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ef9ce22919f4a36a90a849cbd28517aa387b8e4", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/4ef9ce22919f4a36a90a849cbd28517aa387b8e4", "committedDate": "2020-06-29T20:32:57Z", "message": "120s for connection timeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6731b6beee011662655962faec1b0db7bf9ae5b4", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/6731b6beee011662655962faec1b0db7bf9ae5b4", "committedDate": "2020-06-30T01:08:30Z", "message": " 120s -> 240s"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5856dd5109e3def529dddbf95d6eede535243bc", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/c5856dd5109e3def529dddbf95d6eede535243bc", "committedDate": "2020-06-30T10:49:15Z", "message": "600s"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f54380bac9a19fd716a4607ea5a8dccd91b3d36a", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/f54380bac9a19fd716a4607ea5a8dccd91b3d36a", "committedDate": "2020-06-30T15:08:23Z", "message": "600s -> 10m"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b76f640de7bd084f323bb353aef5fba18f007c10", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/b76f640de7bd084f323bb353aef5fba18f007c10", "committedDate": "2020-06-30T15:48:22Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d65d7ddfa21849ccaae894e94dee01a3a9cf7586", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/d65d7ddfa21849ccaae894e94dee01a3a9cf7586", "committedDate": "2020-06-30T16:33:53Z", "message": "Graceful shutdown"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4292b34ff1d296b1940a80dac208930d679dd62", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/e4292b34ff1d296b1940a80dac208930d679dd62", "committedDate": "2020-06-30T16:46:44Z", "message": "10m -> 5m"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/b4e4357e7ab3aba74b65cb89f8f60b7640d95223", "committedDate": "2020-06-30T19:15:47Z", "message": "Use PXF_CONNECTION_TIMEOUT to tune the connection timeout"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjEzMzAw", "url": "https://github.com/greenplum-db/pxf/pull/398#pullrequestreview-441213300", "createdAt": "2020-07-01T21:38:04Z", "commit": {"oid": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTozODowNVrOGr2Lxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTo0NTozNVrOGr2XzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYyOTcwMw==", "bodyText": "wonder, should we still log at WARN level here to be consistent. Extra context if debug is on is ok.", "url": "https://github.com/greenplum-db/pxf/pull/398#discussion_r448629703", "createdAt": "2020-07-01T21:38:05Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/BridgeResponse.java", "diffHunk": "@@ -77,9 +77,9 @@ private Void writeToInternal(OutputStream out) throws IOException {\n             // Occurs whenever client (GPDB) decides to end the connection\n             if (LOG.isDebugEnabled()) {\n                 // Stacktrace in debug\n-                LOG.debug(\"Remote connection closed by GPDB\", e);\n+                LOG.debug(String.format(\"Remote connection closed by GPDB (segment %s)\", context.getSegmentId()), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYyOTkwNw==", "bodyText": "same question about WARN level.", "url": "https://github.com/greenplum-db/pxf/pull/398#discussion_r448629907", "createdAt": "2020-07-01T21:38:39Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/WritableResource.java", "diffHunk": "@@ -160,9 +160,9 @@ public WritableResource(BridgeFactory bridgeFactory, SecurityService securitySer\n                 // Occurs whenever client (GPDB) decides to end the connection\n                 if (LOG.isDebugEnabled()) {\n                     // Stacktrace in debug\n-                    LOG.debug(\"Remote connection closed by GPDB\", cae);\n+                    LOG.debug(String.format(\"Remote connection closed by GPDB (segment %s)\", context.getSegmentId()), cae);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMDUzNA==", "bodyText": "do we only give the server 1s to fish up work and shutdown ? What about our thread pool, will threads have a chance to finish reading /writing ? that might take a while", "url": "https://github.com/greenplum-db/pxf/pull/398#discussion_r448630534", "createdAt": "2020-07-01T21:40:12Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/main/resources/application.properties", "diffHunk": "@@ -7,7 +7,10 @@ management.endpoint.shutdown.enabled=true\n management.health.probes.enabled=true\n \n server.port=${pxf.port:5888}\n+server.shutdown=graceful\n+spring.lifecycle.timeout-per-shutdown-phase=1s", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMTI5OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    # initialize PXF 6.x on a PXF 5.x installation that had already been\n          \n          \n            \n                    # initialize PXF 6.x using a pre-existing PXF 5.x configuration", "url": "https://github.com/greenplum-db/pxf/pull/398#discussion_r448631298", "createdAt": "2020-07-01T21:41:59Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/scripts/pxf", "diffHunk": "@@ -214,6 +214,13 @@ function generateUserConfigs()\n     setup_conf_directory \"${PXF_CONF}/servers\"\n     setup_conf_directory \"${PXF_CONF}/servers/default\"\n     setup_conf_directory \"${PXF_CONF}/templates\" \"${PXF_HOME}/templates/user/templates\" 'override'\n+\n+    if [[ ! -f \"${PXF_CONF}/conf/pxf-log4j2.xml\" ]]; then\n+        # copy the new pxf-log4j2.xml if it doesn't exist. This allows us to\n+        # initialize PXF 6.x on a PXF 5.x installation that had already been", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMTg3MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # The number of milliseconds the server will wait, after accepting a\n          \n          \n            \n            # The time interval the server will wait, after accepting a\n          \n      \n    \n    \n  \n\nmessage was inconsistent with the value 5m", "url": "https://github.com/greenplum-db/pxf/pull/398#discussion_r448631871", "createdAt": "2020-07-01T21:43:28Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/scripts/pxf-env-default.sh", "diffHunk": "@@ -47,6 +47,11 @@ export PXF_PORT=${PXF_PORT:=5888}\n # Memory\n export PXF_JVM_OPTS=${PXF_JVM_OPTS:='-Xmx2g -Xms1g'}\n \n+# The number of milliseconds the server will wait, after accepting a", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMjUyNg==", "bodyText": "Also, this is too verbose, compared to other properties, maybe just Server connection timeout", "url": "https://github.com/greenplum-db/pxf/pull/398#discussion_r448632526", "createdAt": "2020-07-01T21:45:03Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/scripts/pxf-env-default.sh", "diffHunk": "@@ -47,6 +47,11 @@ export PXF_PORT=${PXF_PORT:=5888}\n # Memory\n export PXF_JVM_OPTS=${PXF_JVM_OPTS:='-Xmx2g -Xms1g'}\n \n+# The number of milliseconds the server will wait, after accepting a", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMTg3MQ=="}, "originalCommit": {"oid": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzMjc4MA==", "bodyText": "same comment", "url": "https://github.com/greenplum-db/pxf/pull/398#discussion_r448632780", "createdAt": "2020-07-01T21:45:35Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/templates/user/conf/pxf-env.sh", "diffHunk": "@@ -19,6 +19,11 @@ PXF_CONF=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )/..\" && pwd )\"\n # Memory\n # export PXF_JVM_OPTS=\"-Xmx2g -Xms1g\"\n \n+# The number of milliseconds the server will wait, after accepting a\n+# connection, for the request URI line to be presented. Use a value of -1 to\n+# indicate no (i.e. infinite) timeout.\n+# export PXF_CONNECTION_TIMEOUT=5m", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f746932de44b791536fdb60e86e10af500896b76", "author": {"user": {"login": "frankgh", "name": "Francisco Guerrero"}}, "url": "https://github.com/greenplum-db/pxf/commit/f746932de44b791536fdb60e86e10af500896b76", "committedDate": "2020-07-01T21:56:59Z", "message": "Update server/pxf-service/src/scripts/pxf\n\nCo-authored-by: Alexander Denissov <denalex@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "607bee17bd054d4cc22410f02b631b9a31793de9", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/607bee17bd054d4cc22410f02b631b9a31793de9", "committedDate": "2020-07-01T21:58:52Z", "message": "Address PR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjI3ODA1", "url": "https://github.com/greenplum-db/pxf/pull/398#pullrequestreview-441227805", "createdAt": "2020-07-01T22:09:03Z", "commit": {"oid": "607bee17bd054d4cc22410f02b631b9a31793de9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMjowOTowNFrOGr26ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMjowOTowNFrOGr26ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY0MTY1OQ==", "bodyText": "this line is no longer needed", "url": "https://github.com/greenplum-db/pxf/pull/398#discussion_r448641659", "createdAt": "2020-07-01T22:09:04Z", "author": {"login": "denalex"}, "path": "server/pxf-service/src/scripts/pxf", "diffHunk": "@@ -214,6 +214,13 @@ function generateUserConfigs()\n     setup_conf_directory \"${PXF_CONF}/servers\"\n     setup_conf_directory \"${PXF_CONF}/servers/default\"\n     setup_conf_directory \"${PXF_CONF}/templates\" \"${PXF_HOME}/templates/user/templates\" 'override'\n+\n+    if [[ ! -f \"${PXF_CONF}/conf/pxf-log4j2.xml\" ]]; then\n+        # copy the new pxf-log4j2.xml if it doesn't exist. This allows us to\n+        # initialize PXF 6.x using a pre-existing PXF 5.x configuration\n+        # initialized", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "607bee17bd054d4cc22410f02b631b9a31793de9"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ee91fee0e64c611657b7cf350783256ed9486ca", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/6ee91fee0e64c611657b7cf350783256ed9486ca", "committedDate": "2020-07-01T22:14:30Z", "message": "Address PR feedback. Add SPRING_LIFECYCLE_TIMEOUT_PER_SHUTDOWN_PHASE variable in pxf-env"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8a88a602e787b62d326b86095a75d6978585034", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/f8a88a602e787b62d326b86095a75d6978585034", "committedDate": "2020-07-01T22:28:52Z", "message": "remove enabling graceful shutdown"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjQ5NDg3", "url": "https://github.com/greenplum-db/pxf/pull/398#pullrequestreview-441249487", "createdAt": "2020-07-01T23:06:47Z", "commit": {"oid": "f8a88a602e787b62d326b86095a75d6978585034"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4803, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}