{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MTEwMzgx", "number": 476, "title": "RPM: Install the $PXF_HOME/run directory during %posttran", "bodyText": "PXF v5 RPM installation removes the run directory during the %preun\nstep. The lack of run directory prevents PXF v6+ from starting up. We\nfix the issue by installing the $PXF_HOME/run directory during the\n%posttran step. %posttrans of the new package is the only step that runs\nafter the %preun of the old package.", "createdAt": "2020-11-02T14:49:25Z", "url": "https://github.com/greenplum-db/pxf/pull/476", "merged": true, "mergeCommit": {"oid": "e97a9a527af914a5f27a1fb899e65afe5b896a45"}, "closed": true, "closedAt": "2020-11-04T18:54:12Z", "author": {"login": "frankgh"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYlVhogH2gAyNTE0MTEwMzgxOmY1NWRlMWE4M2M4NjQ5ZDEzYWUwNzgwNWJiY2I0YjgwMzkxYzgzNmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZSWxDAFqTUyMzY0MjYyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f55de1a83c8649d13ae07805bbcb4b80391c836c", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/f55de1a83c8649d13ae07805bbcb4b80391c836c", "committedDate": "2020-11-02T14:21:25Z", "message": "RPM: Install the $PXF_HOME/run directory during %posttran\n\nPXF v5 RPM installation removes the run directory during the %preun\nstep. The lack of run directory prevents PXF v6+ from starting up. We\nfix the issue by installing the `$PXF_HOME/run` directory during the\n%posttran step. %posttrans of the new package is the only step that runs\nafter the %preun of the old package. Re-installing the `$PXF_HOME/run`\nduring the %posttrans step effectively restores the directory during\ninstallation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxODIyNDc3", "url": "https://github.com/greenplum-db/pxf/pull/476#pullrequestreview-521822477", "createdAt": "2020-11-02T17:01:04Z", "commit": {"oid": "71d1106609eeb39b3d055bffd073b49dba00f860"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMTowNFrOHsNXkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNzowMjo0NFrOHsNcgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjExODQxOQ==", "bodyText": "is this directory now also provisioned as part of installation of this RPM ? What happens on a clean install ?", "url": "https://github.com/greenplum-db/pxf/pull/476#discussion_r516118419", "createdAt": "2020-11-02T17:01:04Z", "author": {"login": "denalex"}, "path": "package/pxf-gp5.spec", "diffHunk": "@@ -66,3 +66,10 @@ sed -i \"s|module_pathname =.*|module_pathname = '%{prefix}/gpextable/pxf'|g\" %{p\n # only applies for old installations (pre 6.0.0)\n %__rm -f %{prefix}/conf/pxf-private.classpath\n %__rm -rf %{prefix}/pxf-service\n+\n+%posttrans\n+# PXF v5 RPM installation removes the run directory during the %preun step.\n+# The lack of run directory prevents PXF v6+ from starting up.\n+# %posttrans of the new package is the only step that runs after the %preun\n+# of the old package\n+%{__install} -d -m 700 %{prefix}/run", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71d1106609eeb39b3d055bffd073b49dba00f860"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjExOTY4MQ==", "bodyText": "also, lines 64-68 -- %preun seems to be only for old stuff, should this be now in %prein or %postin to clean up before installing new RPM ?", "url": "https://github.com/greenplum-db/pxf/pull/476#discussion_r516119681", "createdAt": "2020-11-02T17:02:44Z", "author": {"login": "denalex"}, "path": "package/pxf-gp5.spec", "diffHunk": "@@ -66,3 +66,10 @@ sed -i \"s|module_pathname =.*|module_pathname = '%{prefix}/gpextable/pxf'|g\" %{p\n # only applies for old installations (pre 6.0.0)\n %__rm -f %{prefix}/conf/pxf-private.classpath\n %__rm -rf %{prefix}/pxf-service\n+\n+%posttrans\n+# PXF v5 RPM installation removes the run directory during the %preun step.\n+# The lack of run directory prevents PXF v6+ from starting up.\n+# %posttrans of the new package is the only step that runs after the %preun\n+# of the old package\n+%{__install} -d -m 700 %{prefix}/run", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71d1106609eeb39b3d055bffd073b49dba00f860"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7b79e9b06af100f7ea9916132869f6afb511fba", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/c7b79e9b06af100f7ea9916132869f6afb511fba", "committedDate": "2020-11-02T19:12:13Z", "message": "Address PR comment. preun -> pre"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71d1106609eeb39b3d055bffd073b49dba00f860", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/71d1106609eeb39b3d055bffd073b49dba00f860", "committedDate": "2020-11-02T14:18:50Z", "message": "RPM: Install the $PXF_HOME/run directory during %posttran\n\nPXF v5 RPM installation removes the run directory during the %preun\nstep. The lack of run directory prevents PXF v6+ from starting up. We\nfix the issue by installing the `$PXF_HOME/run` directory during the\n%posttran step. %posttrans of the new package is the only step that runs\nafter the %preun of the old package."}, "afterCommit": {"oid": "c7b79e9b06af100f7ea9916132869f6afb511fba", "author": {"user": null}, "url": "https://github.com/greenplum-db/pxf/commit/c7b79e9b06af100f7ea9916132869f6afb511fba", "committedDate": "2020-11-02T19:12:13Z", "message": "Address PR comment. preun -> pre"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjQyNjIy", "url": "https://github.com/greenplum-db/pxf/pull/476#pullrequestreview-523642622", "createdAt": "2020-11-04T18:48:30Z", "commit": {"oid": "c7b79e9b06af100f7ea9916132869f6afb511fba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4924, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}