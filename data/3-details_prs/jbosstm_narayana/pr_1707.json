{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyMjE3MTEz", "number": 1707, "title": "[JBTM-3381] Enhance LRA Client for Quarkus", "bodyText": "Hey,\nI wanted to do a small contribution to the client after starting to use it. I hope you find my changes useful and relevant.\n\nClean up unnecessary dependencies and reformat pom.\nSet PORT and PATH_KEY as constants. I couldn't import them properly in my code\nFix the clientID param that was sending an object string representation.\njoinLRA with a null timelimit was throwing a NPE during the unboxing.\nOther SonarLint suggestions.\nThe service provided has been replaced by the Microprofile implementation.\n\nI didn't consider meaningful creating a Jira for this but if you feel it's a requirement even for such a small PR I'll do it.\nLet me know if I didn't take something into account, specially regarding the pom.xml.\nThank you in advance.\nSigned-off-by: ruromero rromerom@redhat.com\nFix https://issues.redhat.com/browse/JBTM-3381\nLRA\n!MAIN !CORE !QA_JTA !QA_JTS_JDKORB !QA_JTS_OPENJDKORB !QA_JTS_JACORB !BLACKTIE !XTS !PERF NO_WIN !RTS !AS_TESTS !TOMCAT !JACOCO", "createdAt": "2020-10-29T11:47:56Z", "url": "https://github.com/jbosstm/narayana/pull/1707", "merged": true, "mergeCommit": {"oid": "55e4b71570c05471111a720e2bf4c6ad799c3cf3"}, "closed": true, "closedAt": "2020-10-31T15:18:57Z", "author": {"login": "ruromero"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXXmBBAFqTUyMDAxMDI5OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdX89QFAFqTUyMTE0Njg3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwMDEwMjk5", "url": "https://github.com/jbosstm/narayana/pull/1707#pullrequestreview-520010299", "createdAt": "2020-10-29T19:37:29Z", "commit": {"oid": "a793aa61351ca6f73538b4c83a9e85832afef62e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxOTozNzozMFrOHqrnow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxOTo0NDowOVrOHqr1AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxNjg5OQ==", "bodyText": "This is a nice spot. I think the clientID would be better encoded (URLEncoder.encode).", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r514516899", "createdAt": "2020-10-29T19:37:30Z", "author": {"login": "ochaloup"}, "path": "rts/lra/client/src/main/java/io/narayana/lra/client/NarayanaLRAClient.java", "diffHunk": "@@ -305,7 +306,7 @@ public URI startLRA(URI parentLRA, String clientID, Long timeout, ChronoUnit uni\n \n             response = client.target(base)\n                 .path(START_PATH)\n-                .queryParam(CLIENT_ID_PARAM_NAME, client)\n+                .queryParam(CLIENT_ID_PARAM_NAME, clientID)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a793aa61351ca6f73538b4c83a9e85832afef62e"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxNzY4Ng==", "bodyText": "Please with this remove the method error_nullLraOnCreation from the i18NLogger as well.", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r514517686", "createdAt": "2020-10-29T19:39:05Z", "author": {"login": "ochaloup"}, "path": "rts/lra/client/src/main/java/io/narayana/lra/client/NarayanaLRAClient.java", "diffHunk": "@@ -320,13 +321,6 @@ public URI startLRA(URI parentLRA, String clientID, Long timeout, ChronoUnit uni\n             }\n \n             lra = URI.create(response.getHeaderString(HttpHeaders.LOCATION));\n-\n-            if (lra == null) {\n-                LRALogger.i18NLogger.error_nullLraOnCreation(response.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a793aa61351ca6f73538b4c83a9e85832afef62e"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxODgwOA==", "bodyText": "An idea: what about rather change the joinLRA method to be using long instead of Long?\n(as we are not in 1.0 we can dare to change the public api if agreed it's desirable)", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r514518808", "createdAt": "2020-10-29T19:41:05Z", "author": {"login": "ochaloup"}, "path": "rts/lra/client/src/main/java/io/narayana/lra/client/NarayanaLRAClient.java", "diffHunk": "@@ -641,7 +635,7 @@ private static StringBuilder makeLink(StringBuilder b, String uriPrefix, String\n         return b.append(link);\n     }\n \n-    private URI enlistCompensator(URI lraUri, long timelimit, String uriPrefix,\n+    private URI enlistCompensator(URI lraUri, Long timelimit, String uriPrefix,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a793aa61351ca6f73538b4c83a9e85832afef62e"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUyMDMyMA==", "bodyText": "With this change we should be consistent in whole LRA impl. The same change should be done in https://github.com/jbosstm/narayana/blob/master/rts/lra/jaxrs/src/main/resources/META-INF/services/javax.ws.rs.client.ClientBuilder.\nI think especially this particular change would be nice to be tracked as a jira.\nFYI @xstefank", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r514520320", "createdAt": "2020-10-29T19:44:09Z", "author": {"login": "ochaloup"}, "path": "rts/lra/client/src/main/resources/META-INF/services/javax.ws.rs.client.ClientBuilder", "diffHunk": "@@ -1 +1 @@\n-org.jboss.resteasy.client.jaxrs.ResteasyClientBuilder\n+org.jboss.resteasy.microprofile.client.impl.MpClientBuilderImpl", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a793aa61351ca6f73538b4c83a9e85832afef62e"}, "originalPosition": 2}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7435f523b19d6bf632cc63ca767eb9c6f5d65f25", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/jbosstm/narayana/commit/7435f523b19d6bf632cc63ca767eb9c6f5d65f25", "committedDate": "2020-10-29T21:03:07Z", "message": "remove formatting and code review\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}, "afterCommit": {"oid": "8ae1a6ac13b03b5cad7a45a94322f0b35a808b95", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/jbosstm/narayana/commit/8ae1a6ac13b03b5cad7a45a94322f0b35a808b95", "committedDate": "2020-10-30T10:09:07Z", "message": "[JBTM-3381] Enhance Quarkus compatibility\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNTc1Mjc5", "url": "https://github.com/jbosstm/narayana/pull/1707#pullrequestreview-520575279", "createdAt": "2020-10-30T11:19:56Z", "commit": {"oid": "8ae1a6ac13b03b5cad7a45a94322f0b35a808b95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNjMzNTM4", "url": "https://github.com/jbosstm/narayana/pull/1707#pullrequestreview-520633538", "createdAt": "2020-10-30T12:47:05Z", "commit": {"oid": "8ae1a6ac13b03b5cad7a45a94322f0b35a808b95"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0NzowNlrOHrNhrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo0NzowNlrOHrNhrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3MjQyOA==", "bodyText": "Is it wise to encode the clientID? A few of points:\n\nit is not necessarily a URL since client ids are arbitrary strings and it may be confusing to the client to receive back something other that what he set on the start call;\nthe json data returned by the API call for returning LRAs and the format of the returned data doesn't say anything about us encoding the client id\nencoded urls are usually for use in html pages but the client id is not for this purpose.", "url": "https://github.com/jbosstm/narayana/pull/1707#discussion_r515072428", "createdAt": "2020-10-30T12:47:06Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/client/src/main/java/io/narayana/lra/client/NarayanaLRAClient.java", "diffHunk": "@@ -305,7 +305,7 @@ public URI startLRA(URI parentLRA, String clientID, Long timeout, ChronoUnit uni\n \n             response = client.target(base)\n                 .path(START_PATH)\n-                .queryParam(CLIENT_ID_PARAM_NAME, client)\n+                .queryParam(CLIENT_ID_PARAM_NAME, URLEncoder.encode(clientID, \"UTF-8\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ae1a6ac13b03b5cad7a45a94322f0b35a808b95"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNzM3MzIw", "url": "https://github.com/jbosstm/narayana/pull/1707#pullrequestreview-520737320", "createdAt": "2020-10-30T14:45:14Z", "commit": {"oid": "8ae1a6ac13b03b5cad7a45a94322f0b35a808b95"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50f97bb5b339c31473b0b8b06116e3487791cb75", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/jbosstm/narayana/commit/50f97bb5b339c31473b0b8b06116e3487791cb75", "committedDate": "2020-10-30T16:54:29Z", "message": "[JBTM-3381] Enhance Quarkus compatibility\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ae1a6ac13b03b5cad7a45a94322f0b35a808b95", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/jbosstm/narayana/commit/8ae1a6ac13b03b5cad7a45a94322f0b35a808b95", "committedDate": "2020-10-30T10:09:07Z", "message": "[JBTM-3381] Enhance Quarkus compatibility\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}, "afterCommit": {"oid": "50f97bb5b339c31473b0b8b06116e3487791cb75", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/jbosstm/narayana/commit/50f97bb5b339c31473b0b8b06116e3487791cb75", "committedDate": "2020-10-30T16:54:29Z", "message": "[JBTM-3381] Enhance Quarkus compatibility\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMTQ2ODc1", "url": "https://github.com/jbosstm/narayana/pull/1707#pullrequestreview-521146875", "createdAt": "2020-10-31T15:18:42Z", "commit": {"oid": "50f97bb5b339c31473b0b8b06116e3487791cb75"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4490, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}