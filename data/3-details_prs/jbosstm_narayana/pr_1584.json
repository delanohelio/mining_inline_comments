{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NTI4Mzky", "number": 1584, "title": "JBTM-3261 Merge LRA branch to the master branch", "bodyText": "https://issues.redhat.com/browse/JBTM-3261\nI am disabling all CI testing because there is currently no available MP LRA snapshot that the Narayana implementation would still be able to pass. I am going to work on bring LRA implementation in the master branch up to date with the specification after this PR is merged.\nLRA !TOMCAT !AS_TESTS !RTS !JACOCO !XTS !QA_JTA !QA_JTS_JACORB !QA_JTS_JDKORB !QA_JTS_OPENJDKORB !BLACKTIE !PERF !NO_WIN !DB_TESTS !mysql !db2 !postgres !oracle", "createdAt": "2020-04-02T11:48:58Z", "url": "https://github.com/jbosstm/narayana/pull/1584", "merged": true, "mergeCommit": {"oid": "d33d303abef01190d40cf9a1018cf9cba187b252"}, "closed": true, "closedAt": "2020-04-06T07:49:00Z", "author": {"login": "xstefank"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTpKY_AH2gAyMzk3NTI4MzkyOmY1NGY5NjU2YjdiZTExZTc3NTJmNTEyNzcyMGE4NzFiNjc2MzUxZTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUPINxgBqjMxOTg5OTg2Njc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f54f9656b7be11e7752f5127720a871b676351e9", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/f54f9656b7be11e7752f5127720a871b676351e9", "committedDate": "2020-04-02T09:48:06Z", "message": "JBTM-3204 Upgrade LRA TCK recovery handling to accommodate specification changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "affbb9cc0089a95c3233e067cc1f6f812fdd6f73", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/affbb9cc0089a95c3233e067cc1f6f812fdd6f73", "committedDate": "2020-04-02T10:02:25Z", "message": "JBTM-3217 Take Compensate and Complete timeout information from the LRA annotation in the same class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "945f17a4c80eea8ed89dd22b87de587fa38727e8", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/945f17a4c80eea8ed89dd22b87de587fa38727e8", "committedDate": "2020-04-02T10:02:27Z", "message": "JBTM-3221 Refactor NarayanaLRARecovery according to the specification upgrades"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6550b8fbeb4340df750ccc5eaba29ded9a63287e", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/6550b8fbeb4340df750ccc5eaba29ded9a63287e", "committedDate": "2020-04-02T10:13:59Z", "message": "JBTM-3229 Allow to enlist AfterLRA listeners after the LRA enters the ending phase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "869bea81896d6c68eb7f9abcb5cd70bd42f66983", "author": {"user": {"login": "mmusgrov", "name": "Michael Musgrove"}}, "url": "https://github.com/jbosstm/narayana/commit/869bea81896d6c68eb7f9abcb5cd70bd42f66983", "committedDate": "2020-04-02T10:14:01Z", "message": "JBTM-3229 Fix up previous commit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NTU0NjIx", "url": "https://github.com/jbosstm/narayana/pull/1584#pullrequestreview-386554621", "createdAt": "2020-04-02T15:42:51Z", "commit": {"oid": "f4d347bf84580bd5eb2fb9ff707337481a18efbc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNTo0Mjo1MVrOF_xdOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNTo1NTozNVrOF_yBjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQxNDkwNw==", "bodyText": "Implementations of third party interfaces still need a copyright.", "url": "https://github.com/jbosstm/narayana/pull/1584#discussion_r402414907", "createdAt": "2020-04-02T15:42:51Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/lra-test/lra-test-arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -1,57 +1,27 @@\n-/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4d347bf84580bd5eb2fb9ff707337481a18efbc"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQxNzE2OA==", "bodyText": "Superfluous extra line.", "url": "https://github.com/jbosstm/narayana/pull/1584#discussion_r402417168", "createdAt": "2020-04-02T15:46:05Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/lra-test/lra-test-arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -81,6 +51,7 @@ private boolean recoverLRAs(String host, int port, URI lraId) {\n             String json = response.readEntity(String.class);\n             response.close();\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4d347bf84580bd5eb2fb9ff707337481a18efbc"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyNDAxMA==", "bodyText": "I know it's not part of the PR but the reason we don't need an implementation is that callbacks are invoked synchronously (to the application logic via a JAX-RS server side filter), ie speed is not the reason. And the reason for doing it synchronously is that JAX-RS does not support asynchronous filters. Will you either update or delete the comment altogether.\nBut Resteasy does support them (https://docs.jboss.org/resteasy/docs/3.9.1.Final/userguide/html/Interceptors.html#d4e1983). I will dig out an earlier implementation that did do this to see if it can still be made to work.", "url": "https://github.com/jbosstm/narayana/pull/1584#discussion_r402424010", "createdAt": "2020-04-02T15:55:18Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/lra-test/lra-test-arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -1,57 +1,27 @@\n-/*\n- * JBoss, Home of Professional Open Source.\n- * Copyright 2020, Red Hat, Inc., and individual contributors\n- * as indicated by the @author tags. See the copyright.txt file in the\n- * distribution for a full listing of individual contributors.\n- *\n- * This is free software; you can redistribute it and/or modify it\n- * under the terms of the GNU Lesser General Public License as\n- * published by the Free Software Foundation; either version 2.1 of\n- * the License, or (at your option) any later version.\n- *\n- * This software is distributed in the hope that it will be useful,\n- * but WITHOUT ANY WARRANTY; without even the implied warranty of\n- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n- * Lesser General Public License for more details.\n- *\n- * You should have received a copy of the GNU Lesser General Public\n- * License along with this software; if not, write to the Free\n- * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n- * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n- */\n-\n package io.narayana.lra.arquillian.spi;\n \n import io.narayana.lra.LRAConstants;\n-import io.narayana.lra.logging.LRALogger;\n+import org.eclipse.microprofile.lra.tck.service.spi.LRARecoveryService;\n \n import javax.ws.rs.client.Client;\n import javax.ws.rs.client.ClientBuilder;\n import javax.ws.rs.client.WebTarget;\n import javax.ws.rs.core.Response;\n import java.net.URI;\n \n-public class NarayanaLRARecovery {\n+public class NarayanaLRARecovery implements LRARecoveryService {\n \n+    @Override\n     public void waitForCallbacks(URI lraId) {\n         // no action is needed, tck callbacks calls are sufficiently fast for TCK", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4d347bf84580bd5eb2fb9ff707337481a18efbc"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyNDIwNg==", "bodyText": "typo", "url": "https://github.com/jbosstm/narayana/pull/1584#discussion_r402424206", "createdAt": "2020-04-02T15:55:35Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/lra-test/lra-test-arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -1,57 +1,27 @@\n-/*\n- * JBoss, Home of Professional Open Source.\n- * Copyright 2020, Red Hat, Inc., and individual contributors\n- * as indicated by the @author tags. See the copyright.txt file in the\n- * distribution for a full listing of individual contributors.\n- *\n- * This is free software; you can redistribute it and/or modify it\n- * under the terms of the GNU Lesser General Public License as\n- * published by the Free Software Foundation; either version 2.1 of\n- * the License, or (at your option) any later version.\n- *\n- * This software is distributed in the hope that it will be useful,\n- * but WITHOUT ANY WARRANTY; without even the implied warranty of\n- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n- * Lesser General Public License for more details.\n- *\n- * You should have received a copy of the GNU Lesser General Public\n- * License along with this software; if not, write to the Free\n- * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n- * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n- */\n-\n package io.narayana.lra.arquillian.spi;\n \n import io.narayana.lra.LRAConstants;\n-import io.narayana.lra.logging.LRALogger;\n+import org.eclipse.microprofile.lra.tck.service.spi.LRARecoveryService;\n \n import javax.ws.rs.client.Client;\n import javax.ws.rs.client.ClientBuilder;\n import javax.ws.rs.client.WebTarget;\n import javax.ws.rs.core.Response;\n import java.net.URI;\n \n-public class NarayanaLRARecovery {\n+public class NarayanaLRARecovery implements LRARecoveryService {\n \n+    @Override\n     public void waitForCallbacks(URI lraId) {\n         // no action is needed, tck callbacks calls are sufficiently fast for TCK\n     }\n \n-    // TODO remove once this class implements LRARecoveryService\n-    public void waitForRecovery(URI lraId) {\n-        int counter = 0;\n-\n-        do {\n-            LRALogger.logger.info(\"Recovery attempt #\" + ++counter);\n-        } while (!waitForEndPhaseReplay(lraId));\n-        LRALogger.logger.info(\"LRA \" + lraId + \" has finished the recovery \" + counter);\n-    }\n-\n+    @Override\n     public boolean waitForEndPhaseReplay(URI lraId) {\n         String host = lraId.getHost();\n         int port = lraId.getPort();\n         if (!recoverLRAs(host, port, lraId)) {\n-            // first recovery scan probably collided with periodic recovery which started\n+            // first recovery scan probably collided with periodic recovevery which started", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4d347bf84580bd5eb2fb9ff707337481a18efbc"}, "originalPosition": 59}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4d347bf84580bd5eb2fb9ff707337481a18efbc", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/f4d347bf84580bd5eb2fb9ff707337481a18efbc", "committedDate": "2020-04-02T11:46:09Z", "message": "JBTM-3261 Merge LRA branch to the master branch"}, "afterCommit": {"oid": "a2b008be4577d9340c024d04a2e90819424ffd5c", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/a2b008be4577d9340c024d04a2e90819424ffd5c", "committedDate": "2020-04-02T17:22:51Z", "message": "JBTM-3261 Merge LRA branch to the master branch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MTE2MzMx", "url": "https://github.com/jbosstm/narayana/pull/1584#pullrequestreview-387116331", "createdAt": "2020-04-03T09:56:10Z", "commit": {"oid": "a2b008be4577d9340c024d04a2e90819424ffd5c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a2b008be4577d9340c024d04a2e90819424ffd5c", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/a2b008be4577d9340c024d04a2e90819424ffd5c", "committedDate": "2020-04-02T17:22:51Z", "message": "JBTM-3261 Merge LRA branch to the master branch"}, "afterCommit": {"oid": "852a561025d48f562c8715bf9b2d37c1dbe5b193", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/852a561025d48f562c8715bf9b2d37c1dbe5b193", "committedDate": "2020-04-03T12:46:04Z", "message": "JBTM-3261 Merge LRA branch to the master branch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MjMyNDcw", "url": "https://github.com/jbosstm/narayana/pull/1584#pullrequestreview-387232470", "createdAt": "2020-04-03T13:00:25Z", "commit": {"oid": "852a561025d48f562c8715bf9b2d37c1dbe5b193"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMzowMDoyNVrOGAUaWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMzowMDoyNVrOGAUaWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk4NzYwOA==", "bodyText": "Will you include a comment explaining why these tests are skipped and also update the issue to explain what still needs doing.", "url": "https://github.com/jbosstm/narayana/pull/1584#discussion_r402987608", "createdAt": "2020-04-03T13:00:25Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/lra-test/lra-test-tck/pom.xml", "diffHunk": "@@ -25,6 +25,31 @@\n         <lra.tck.consistency.longDelay>20000</lra.tck.consistency.longDelay>\n \n         <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n+\n+        <it.test>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "852a561025d48f562c8715bf9b2d37c1dbe5b193"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "852a561025d48f562c8715bf9b2d37c1dbe5b193", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/852a561025d48f562c8715bf9b2d37c1dbe5b193", "committedDate": "2020-04-03T12:46:04Z", "message": "JBTM-3261 Merge LRA branch to the master branch"}, "afterCommit": {"oid": "8717da178db8edc8f795ebf14ea02eff36842130", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/8717da178db8edc8f795ebf14ea02eff36842130", "committedDate": "2020-04-03T13:15:17Z", "message": "JBTM-3261 Merge LRA branch to the master branch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MjU4ODQ1", "url": "https://github.com/jbosstm/narayana/pull/1584#pullrequestreview-387258845", "createdAt": "2020-04-03T13:33:03Z", "commit": {"oid": "8717da178db8edc8f795ebf14ea02eff36842130"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d31194430ddd30ccb11b61aba780e8836d7ac9f", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/0d31194430ddd30ccb11b61aba780e8836d7ac9f", "committedDate": "2020-04-04T06:01:57Z", "message": "JBTM-3261 Merge LRA branch to the master branch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8717da178db8edc8f795ebf14ea02eff36842130", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/8717da178db8edc8f795ebf14ea02eff36842130", "committedDate": "2020-04-03T13:15:17Z", "message": "JBTM-3261 Merge LRA branch to the master branch"}, "afterCommit": {"oid": "0d31194430ddd30ccb11b61aba780e8836d7ac9f", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/0d31194430ddd30ccb11b61aba780e8836d7ac9f", "committedDate": "2020-04-04T06:01:57Z", "message": "JBTM-3261 Merge LRA branch to the master branch"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4550, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}