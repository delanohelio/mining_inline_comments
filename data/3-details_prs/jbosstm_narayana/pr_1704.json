{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MzQ2MjM1", "number": 1704, "title": "[JBTM-3378] LRA recovery manager on top of LRA coordinator", "bodyText": "https://issues.redhat.com/browse/JBTM-3378\nLRA\n!MAIN !CORE !QA_JTA !QA_JTS_JDKORB !QA_JTS_OPENJDKORB !QA_JTS_JACORB !BLACKTIE !XTS !PERF NO_WIN !RTS !AS_TESTS !TOMCAT !JACOCO", "createdAt": "2020-10-22T14:44:09Z", "url": "https://github.com/jbosstm/narayana/pull/1704", "merged": true, "mergeCommit": {"oid": "e4cac8afaf750625a927f0927e76d130339423df"}, "closed": true, "closedAt": "2020-10-29T14:01:37Z", "author": {"login": "ochaloup"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVRjW1gFqTUxNTQxNDQ5Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXSI8MgFqTUxOTY1OTk0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1NDE0NDk2", "url": "https://github.com/jbosstm/narayana/pull/1704#pullrequestreview-515414496", "createdAt": "2020-10-23T07:36:39Z", "commit": {"oid": "4db4839de42e541caf7d190714bd4f3ab6acecab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4db4839de42e541caf7d190714bd4f3ab6acecab", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/4db4839de42e541caf7d190714bd4f3ab6acecab", "committedDate": "2020-10-22T14:33:54Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}, "afterCommit": {"oid": "ed7b0f1cd596ca0e84c040f9eb6a3a043e1b14a8", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/ed7b0f1cd596ca0e84c040f9eb6a3a043e1b14a8", "committedDate": "2020-10-23T09:52:32Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed7b0f1cd596ca0e84c040f9eb6a3a043e1b14a8", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/ed7b0f1cd596ca0e84c040f9eb6a3a043e1b14a8", "committedDate": "2020-10-23T09:52:32Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}, "afterCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/207f902250f4248a5684b3092dd06184d7276c38", "committedDate": "2020-10-23T10:06:13Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NjExODE1", "url": "https://github.com/jbosstm/narayana/pull/1704#pullrequestreview-516611815", "createdAt": "2020-10-26T09:48:27Z", "commit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwOTo0ODoyN1rOHoH24A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDowOToxNlrOHoIofg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgzMzgyNA==", "bodyText": "Quote: \"A @path value isn\u2019t required to have leading or trailing slashes (/). The JAX-RS runtime parses URI path templates the same whether or not they have leading or trailing spaces.\"\nSo in this example you do not need the Path annotation at all.", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r511833824", "createdAt": "2020-10-26T09:48:27Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/coordinator/src/main/java/io/narayana/lra/coordinator/api/RecoveryCoordinator.java", "diffHunk": "@@ -147,7 +148,7 @@ public String replaceCompensator(\n     }\n \n     @GET\n-    @Path(\"recovery\")\n+    @Path(\"/\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgzNzE5MA==", "bodyText": "What was intended? The original code with the explicit if branch was clearer.", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r511837190", "createdAt": "2020-10-26T09:54:03Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/test/arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -60,48 +64,86 @@ public void waitForCallbacks(URI lraId) {\n \n     @Override\n     public boolean waitForEndPhaseReplay(URI lraId) {\n-        String host = lraId.getHost();\n-        int port = lraId.getPort();\n-        if (!recoverLRAs(host, port, lraId)) {\n+        if (!recoverLRAs(lraId)) {\n             // first recovery scan probably collided with periodic recovery which started\n             // before the test execution so try once more\n-            return recoverLRAs(host, port, lraId);\n+            return recoverLRAs(lraId);\n         }\n-\n         return true;\n     }\n \n     /**\n-     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happended\n+     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happened\n      *\n-     * @param host  the LRA coordinator host address\n-     * @param port  the LRA coordinator port\n      * @param lraId the LRA id of the LRA that is intended to be recovered\n      * @return true the intended LRA recovered, false otherwise\n      */\n-    private boolean recoverLRAs(String host, int port, URI lraId) {\n+    private boolean recoverLRAs(URI lraId) {\n         // trigger a recovery scan\n         Client recoveryCoordinatorClient = ClientBuilder.newClient();\n \n         try {\n-            String recoveryCoordinatorUrl = String.format(\"http://%s:%d/%s/recovery\",\n-                host, port, LRAConstants.RECOVERY_COORDINATOR_PATH_NAME);\n-            WebTarget recoveryTarget = recoveryCoordinatorClient.target(URI.create(recoveryCoordinatorUrl));\n+            URI lraCoordinatorUri = extractLRACoordinatorUri(lraId);\n+            URI recoveryCoordinatorUri = UriBuilder.fromUri(lraCoordinatorUri)\n+                    .path(RECOVERY_COORDINATOR_PATH_NAME).build();\n+            WebTarget recoveryTarget = recoveryCoordinatorClient.target(recoveryCoordinatorUri);\n \n             // send the request to the recovery coordinator\n             Response response = recoveryTarget.request().get();\n             String json = response.readEntity(String.class);\n             response.close();\n \n-            if (json.contains(lraId.toASCIIString())) {\n-                // intended LRA didn't recover\n-                return false;\n-            }\n-\n-            return true;\n+            // intended LRA didn't recover", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgzODUxNA==", "bodyText": "These comments are confusing and it's not clear why they need to be included.", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r511838514", "createdAt": "2020-10-26T09:56:09Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/test/arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -60,48 +64,86 @@ public void waitForCallbacks(URI lraId) {\n \n     @Override\n     public boolean waitForEndPhaseReplay(URI lraId) {\n-        String host = lraId.getHost();\n-        int port = lraId.getPort();\n-        if (!recoverLRAs(host, port, lraId)) {\n+        if (!recoverLRAs(lraId)) {\n             // first recovery scan probably collided with periodic recovery which started\n             // before the test execution so try once more\n-            return recoverLRAs(host, port, lraId);\n+            return recoverLRAs(lraId);\n         }\n-\n         return true;\n     }\n \n     /**\n-     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happended\n+     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happened\n      *\n-     * @param host  the LRA coordinator host address\n-     * @param port  the LRA coordinator port\n      * @param lraId the LRA id of the LRA that is intended to be recovered\n      * @return true the intended LRA recovered, false otherwise\n      */\n-    private boolean recoverLRAs(String host, int port, URI lraId) {\n+    private boolean recoverLRAs(URI lraId) {\n         // trigger a recovery scan\n         Client recoveryCoordinatorClient = ClientBuilder.newClient();\n \n         try {\n-            String recoveryCoordinatorUrl = String.format(\"http://%s:%d/%s/recovery\",\n-                host, port, LRAConstants.RECOVERY_COORDINATOR_PATH_NAME);\n-            WebTarget recoveryTarget = recoveryCoordinatorClient.target(URI.create(recoveryCoordinatorUrl));\n+            URI lraCoordinatorUri = extractLRACoordinatorUri(lraId);\n+            URI recoveryCoordinatorUri = UriBuilder.fromUri(lraCoordinatorUri)\n+                    .path(RECOVERY_COORDINATOR_PATH_NAME).build();\n+            WebTarget recoveryTarget = recoveryCoordinatorClient.target(recoveryCoordinatorUri);\n \n             // send the request to the recovery coordinator\n             Response response = recoveryTarget.request().get();\n             String json = response.readEntity(String.class);\n             response.close();\n \n-            if (json.contains(lraId.toASCIIString())) {\n-                // intended LRA didn't recover\n-                return false;\n-            }\n-\n-            return true;\n+            // intended LRA didn't recover\n+            return !json.contains(lraId.toASCIIString());\n         } finally {\n             recoveryCoordinatorClient.close();\n         }\n+    }\n \n+    /**\n+     * <p>\n+     * This method extracts the coordinator URI from the provided LRA id.\n+     * The Narayana LRA id consists of an URI of the LRA coordinator followed with the LRA transaction identifier.\n+     * We know the LRA coordinator API is hardcoded with path {@value io.narayana.lra.LRAConstants#COORDINATOR_PATH_NAME}\n+     * and the string will be searched in the original LRA id for.\n+     * </p>\n+     * <p>\n+     * The Narayana LRA works with HTTP requests and URL is used for identification. An example of the standard pattern\n+     * of the provided LRA id URI is:\n+     * {@code http://localhost:8080/deployment/lra-coordinator/0_ffff0a28054b_9133_5f855916_a7}.\n+     * This told us that the LRA can be accessed at the provided address by HTTP call.\n+     * The LRA coordinator API is available at {@code http://localhost:8080/deployment/lra-coordinator}\n+     * and the {@code 0_ffff0a28054b_9133_5f855916_a7} is the LRA transaction identifier used inside of the Coordinator\n+     * to differentiate the LRA instances.\n+     * </p>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0MzkwNA==", "bodyText": "... and the implementation is even harder to understand.", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r511843904", "createdAt": "2020-10-26T10:04:54Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/test/arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -60,48 +64,86 @@ public void waitForCallbacks(URI lraId) {\n \n     @Override\n     public boolean waitForEndPhaseReplay(URI lraId) {\n-        String host = lraId.getHost();\n-        int port = lraId.getPort();\n-        if (!recoverLRAs(host, port, lraId)) {\n+        if (!recoverLRAs(lraId)) {\n             // first recovery scan probably collided with periodic recovery which started\n             // before the test execution so try once more\n-            return recoverLRAs(host, port, lraId);\n+            return recoverLRAs(lraId);\n         }\n-\n         return true;\n     }\n \n     /**\n-     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happended\n+     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happened\n      *\n-     * @param host  the LRA coordinator host address\n-     * @param port  the LRA coordinator port\n      * @param lraId the LRA id of the LRA that is intended to be recovered\n      * @return true the intended LRA recovered, false otherwise\n      */\n-    private boolean recoverLRAs(String host, int port, URI lraId) {\n+    private boolean recoverLRAs(URI lraId) {\n         // trigger a recovery scan\n         Client recoveryCoordinatorClient = ClientBuilder.newClient();\n \n         try {\n-            String recoveryCoordinatorUrl = String.format(\"http://%s:%d/%s/recovery\",\n-                host, port, LRAConstants.RECOVERY_COORDINATOR_PATH_NAME);\n-            WebTarget recoveryTarget = recoveryCoordinatorClient.target(URI.create(recoveryCoordinatorUrl));\n+            URI lraCoordinatorUri = extractLRACoordinatorUri(lraId);\n+            URI recoveryCoordinatorUri = UriBuilder.fromUri(lraCoordinatorUri)\n+                    .path(RECOVERY_COORDINATOR_PATH_NAME).build();\n+            WebTarget recoveryTarget = recoveryCoordinatorClient.target(recoveryCoordinatorUri);\n \n             // send the request to the recovery coordinator\n             Response response = recoveryTarget.request().get();\n             String json = response.readEntity(String.class);\n             response.close();\n \n-            if (json.contains(lraId.toASCIIString())) {\n-                // intended LRA didn't recover\n-                return false;\n-            }\n-\n-            return true;\n+            // intended LRA didn't recover\n+            return !json.contains(lraId.toASCIIString());\n         } finally {\n             recoveryCoordinatorClient.close();\n         }\n+    }\n \n+    /**\n+     * <p>\n+     * This method extracts the coordinator URI from the provided LRA id.\n+     * The Narayana LRA id consists of an URI of the LRA coordinator followed with the LRA transaction identifier.\n+     * We know the LRA coordinator API is hardcoded with path {@value io.narayana.lra.LRAConstants#COORDINATOR_PATH_NAME}\n+     * and the string will be searched in the original LRA id for.\n+     * </p>\n+     * <p>\n+     * The Narayana LRA works with HTTP requests and URL is used for identification. An example of the standard pattern\n+     * of the provided LRA id URI is:\n+     * {@code http://localhost:8080/deployment/lra-coordinator/0_ffff0a28054b_9133_5f855916_a7}.\n+     * This told us that the LRA can be accessed at the provided address by HTTP call.\n+     * The LRA coordinator API is available at {@code http://localhost:8080/deployment/lra-coordinator}\n+     * and the {@code 0_ffff0a28054b_9133_5f855916_a7} is the LRA transaction identifier used inside of the Coordinator\n+     * to differentiate the LRA instances.\n+     * </p>\n+     *\n+     * @param lraId  LRA id URI which is used for extraction of the LRA Coordinator API address\n+     * @return LRA Coordinator API address\n+     */\n+    static URI extractLRACoordinatorUri(URI lraId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0NTY0NQ==", "bodyText": "assertNull is simpler", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r511845645", "createdAt": "2020-10-26T10:07:45Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/test/arquillian-extension/src/test/java/io/narayana/lra/arquillian/spi/NarayanaLRARecoveryTest.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2020, Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags. See the copyright.txt file in the\n+ * distribution for a full listing of individual contributors.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+\n+package io.narayana.lra.arquillian.spi;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.net.URI;\n+\n+public class NarayanaLRARecoveryTest {\n+\n+    @Test\n+    public void extractCoordinatorFromUsualLRAId() {\n+        URI lraId = URI.create(\"http://localhost:8080/lra-coordinator/0_ffff0a28054b_9133_5f855916_a7?query=1#fragment\");\n+        URI coordinatorUri = NarayanaLRARecovery.extractLRACoordinatorUri(lraId);\n+        Assert.assertEquals(\"http\", coordinatorUri.getScheme());\n+        Assert.assertEquals(\"localhost\", coordinatorUri.getHost());\n+        Assert.assertEquals(8080, coordinatorUri.getPort());\n+        Assert.assertEquals(\"/lra-coordinator\", coordinatorUri.getPath());\n+        Assert.assertEquals(null, coordinatorUri.getQuery());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0NjUyNg==", "bodyText": "Why are we testing internals.\nIf our code is constructing invalid LRA ids then a majority of tests will end up failing.\nThese tests are just adding noise to our code base.", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r511846526", "createdAt": "2020-10-26T10:09:16Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/test/arquillian-extension/src/test/java/io/narayana/lra/arquillian/spi/NarayanaLRARecoveryTest.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2020, Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags. See the copyright.txt file in the\n+ * distribution for a full listing of individual contributors.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+\n+package io.narayana.lra.arquillian.spi;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.net.URI;\n+\n+public class NarayanaLRARecoveryTest {\n+\n+    @Test\n+    public void extractCoordinatorFromUsualLRAId() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/207f902250f4248a5684b3092dd06184d7276c38", "committedDate": "2020-10-23T10:06:13Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}, "afterCommit": {"oid": "c6bb21f5b4aa2b487bb51ce4dee8b33e81ba1b99", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/c6bb21f5b4aa2b487bb51ce4dee8b33e81ba1b99", "committedDate": "2020-10-26T23:35:16Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MjM5Mjkz", "url": "https://github.com/jbosstm/narayana/pull/1704#pullrequestreview-517239293", "createdAt": "2020-10-26T23:07:31Z", "commit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMzowNzozMlrOHolpIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQyMzozODo1MlrOHomRWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMyMTgyNA==", "bodyText": "The intend is to make the path dynamic. When the coordinator is run with Quarkus the path is explicit. But in case of e.g. WildFly the path depends on the deployment name. The deployment name may differ for every test.", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r512321824", "createdAt": "2020-10-26T23:07:32Z", "author": {"login": "ochaloup"}, "path": "rts/lra/test/arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -60,48 +64,86 @@ public void waitForCallbacks(URI lraId) {\n \n     @Override\n     public boolean waitForEndPhaseReplay(URI lraId) {\n-        String host = lraId.getHost();\n-        int port = lraId.getPort();\n-        if (!recoverLRAs(host, port, lraId)) {\n+        if (!recoverLRAs(lraId)) {\n             // first recovery scan probably collided with periodic recovery which started\n             // before the test execution so try once more\n-            return recoverLRAs(host, port, lraId);\n+            return recoverLRAs(lraId);\n         }\n-\n         return true;\n     }\n \n     /**\n-     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happended\n+     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happened\n      *\n-     * @param host  the LRA coordinator host address\n-     * @param port  the LRA coordinator port\n      * @param lraId the LRA id of the LRA that is intended to be recovered\n      * @return true the intended LRA recovered, false otherwise\n      */\n-    private boolean recoverLRAs(String host, int port, URI lraId) {\n+    private boolean recoverLRAs(URI lraId) {\n         // trigger a recovery scan\n         Client recoveryCoordinatorClient = ClientBuilder.newClient();\n \n         try {\n-            String recoveryCoordinatorUrl = String.format(\"http://%s:%d/%s/recovery\",\n-                host, port, LRAConstants.RECOVERY_COORDINATOR_PATH_NAME);\n-            WebTarget recoveryTarget = recoveryCoordinatorClient.target(URI.create(recoveryCoordinatorUrl));\n+            URI lraCoordinatorUri = extractLRACoordinatorUri(lraId);\n+            URI recoveryCoordinatorUri = UriBuilder.fromUri(lraCoordinatorUri)\n+                    .path(RECOVERY_COORDINATOR_PATH_NAME).build();\n+            WebTarget recoveryTarget = recoveryCoordinatorClient.target(recoveryCoordinatorUri);\n \n             // send the request to the recovery coordinator\n             Response response = recoveryTarget.request().get();\n             String json = response.readEntity(String.class);\n             response.close();\n \n-            if (json.contains(lraId.toASCIIString())) {\n-                // intended LRA didn't recover\n-                return false;\n-            }\n-\n-            return true;\n+            // intended LRA didn't recover", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgzNzE5MA=="}, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMyMjA3Mg==", "bodyText": "I rephrased the text. I hope it will be better now.", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r512322072", "createdAt": "2020-10-26T23:08:16Z", "author": {"login": "ochaloup"}, "path": "rts/lra/test/arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -60,48 +64,86 @@ public void waitForCallbacks(URI lraId) {\n \n     @Override\n     public boolean waitForEndPhaseReplay(URI lraId) {\n-        String host = lraId.getHost();\n-        int port = lraId.getPort();\n-        if (!recoverLRAs(host, port, lraId)) {\n+        if (!recoverLRAs(lraId)) {\n             // first recovery scan probably collided with periodic recovery which started\n             // before the test execution so try once more\n-            return recoverLRAs(host, port, lraId);\n+            return recoverLRAs(lraId);\n         }\n-\n         return true;\n     }\n \n     /**\n-     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happended\n+     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happened\n      *\n-     * @param host  the LRA coordinator host address\n-     * @param port  the LRA coordinator port\n      * @param lraId the LRA id of the LRA that is intended to be recovered\n      * @return true the intended LRA recovered, false otherwise\n      */\n-    private boolean recoverLRAs(String host, int port, URI lraId) {\n+    private boolean recoverLRAs(URI lraId) {\n         // trigger a recovery scan\n         Client recoveryCoordinatorClient = ClientBuilder.newClient();\n \n         try {\n-            String recoveryCoordinatorUrl = String.format(\"http://%s:%d/%s/recovery\",\n-                host, port, LRAConstants.RECOVERY_COORDINATOR_PATH_NAME);\n-            WebTarget recoveryTarget = recoveryCoordinatorClient.target(URI.create(recoveryCoordinatorUrl));\n+            URI lraCoordinatorUri = extractLRACoordinatorUri(lraId);\n+            URI recoveryCoordinatorUri = UriBuilder.fromUri(lraCoordinatorUri)\n+                    .path(RECOVERY_COORDINATOR_PATH_NAME).build();\n+            WebTarget recoveryTarget = recoveryCoordinatorClient.target(recoveryCoordinatorUri);\n \n             // send the request to the recovery coordinator\n             Response response = recoveryTarget.request().get();\n             String json = response.readEntity(String.class);\n             response.close();\n \n-            if (json.contains(lraId.toASCIIString())) {\n-                // intended LRA didn't recover\n-                return false;\n-            }\n-\n-            return true;\n+            // intended LRA didn't recover\n+            return !json.contains(lraId.toASCIIString());\n         } finally {\n             recoveryCoordinatorClient.close();\n         }\n+    }\n \n+    /**\n+     * <p>\n+     * This method extracts the coordinator URI from the provided LRA id.\n+     * The Narayana LRA id consists of an URI of the LRA coordinator followed with the LRA transaction identifier.\n+     * We know the LRA coordinator API is hardcoded with path {@value io.narayana.lra.LRAConstants#COORDINATOR_PATH_NAME}\n+     * and the string will be searched in the original LRA id for.\n+     * </p>\n+     * <p>\n+     * The Narayana LRA works with HTTP requests and URL is used for identification. An example of the standard pattern\n+     * of the provided LRA id URI is:\n+     * {@code http://localhost:8080/deployment/lra-coordinator/0_ffff0a28054b_9133_5f855916_a7}.\n+     * This told us that the LRA can be accessed at the provided address by HTTP call.\n+     * The LRA coordinator API is available at {@code http://localhost:8080/deployment/lra-coordinator}\n+     * and the {@code 0_ffff0a28054b_9133_5f855916_a7} is the LRA transaction identifier used inside of the Coordinator\n+     * to differentiate the LRA instances.\n+     * </p>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgzODUxNA=="}, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMyMjc1Ng==", "bodyText": "I cleaned it as well.", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r512322756", "createdAt": "2020-10-26T23:10:00Z", "author": {"login": "ochaloup"}, "path": "rts/lra/test/arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -60,48 +64,86 @@ public void waitForCallbacks(URI lraId) {\n \n     @Override\n     public boolean waitForEndPhaseReplay(URI lraId) {\n-        String host = lraId.getHost();\n-        int port = lraId.getPort();\n-        if (!recoverLRAs(host, port, lraId)) {\n+        if (!recoverLRAs(lraId)) {\n             // first recovery scan probably collided with periodic recovery which started\n             // before the test execution so try once more\n-            return recoverLRAs(host, port, lraId);\n+            return recoverLRAs(lraId);\n         }\n-\n         return true;\n     }\n \n     /**\n-     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happended\n+     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happened\n      *\n-     * @param host  the LRA coordinator host address\n-     * @param port  the LRA coordinator port\n      * @param lraId the LRA id of the LRA that is intended to be recovered\n      * @return true the intended LRA recovered, false otherwise\n      */\n-    private boolean recoverLRAs(String host, int port, URI lraId) {\n+    private boolean recoverLRAs(URI lraId) {\n         // trigger a recovery scan\n         Client recoveryCoordinatorClient = ClientBuilder.newClient();\n \n         try {\n-            String recoveryCoordinatorUrl = String.format(\"http://%s:%d/%s/recovery\",\n-                host, port, LRAConstants.RECOVERY_COORDINATOR_PATH_NAME);\n-            WebTarget recoveryTarget = recoveryCoordinatorClient.target(URI.create(recoveryCoordinatorUrl));\n+            URI lraCoordinatorUri = extractLRACoordinatorUri(lraId);\n+            URI recoveryCoordinatorUri = UriBuilder.fromUri(lraCoordinatorUri)\n+                    .path(RECOVERY_COORDINATOR_PATH_NAME).build();\n+            WebTarget recoveryTarget = recoveryCoordinatorClient.target(recoveryCoordinatorUri);\n \n             // send the request to the recovery coordinator\n             Response response = recoveryTarget.request().get();\n             String json = response.readEntity(String.class);\n             response.close();\n \n-            if (json.contains(lraId.toASCIIString())) {\n-                // intended LRA didn't recover\n-                return false;\n-            }\n-\n-            return true;\n+            // intended LRA didn't recover\n+            return !json.contains(lraId.toASCIIString());\n         } finally {\n             recoveryCoordinatorClient.close();\n         }\n+    }\n \n+    /**\n+     * <p>\n+     * This method extracts the coordinator URI from the provided LRA id.\n+     * The Narayana LRA id consists of an URI of the LRA coordinator followed with the LRA transaction identifier.\n+     * We know the LRA coordinator API is hardcoded with path {@value io.narayana.lra.LRAConstants#COORDINATOR_PATH_NAME}\n+     * and the string will be searched in the original LRA id for.\n+     * </p>\n+     * <p>\n+     * The Narayana LRA works with HTTP requests and URL is used for identification. An example of the standard pattern\n+     * of the provided LRA id URI is:\n+     * {@code http://localhost:8080/deployment/lra-coordinator/0_ffff0a28054b_9133_5f855916_a7}.\n+     * This told us that the LRA can be accessed at the provided address by HTTP call.\n+     * The LRA coordinator API is available at {@code http://localhost:8080/deployment/lra-coordinator}\n+     * and the {@code 0_ffff0a28054b_9133_5f855916_a7} is the LRA transaction identifier used inside of the Coordinator\n+     * to differentiate the LRA instances.\n+     * </p>\n+     *\n+     * @param lraId  LRA id URI which is used for extraction of the LRA Coordinator API address\n+     * @return LRA Coordinator API address\n+     */\n+    static URI extractLRACoordinatorUri(URI lraId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0MzkwNA=="}, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMyMzY2OQ==", "bodyText": "I don't think so. This is a unit test which is normal to be used to check the functionality of particular parts of a class. The tests help to do changes and refactoring and not breaking the functionality.\nThe integration tests are the next step in the testing journey that verifies how the whole machinery works together.", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r512323669", "createdAt": "2020-10-26T23:12:30Z", "author": {"login": "ochaloup"}, "path": "rts/lra/test/arquillian-extension/src/test/java/io/narayana/lra/arquillian/spi/NarayanaLRARecoveryTest.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2020, Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags. See the copyright.txt file in the\n+ * distribution for a full listing of individual contributors.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+\n+package io.narayana.lra.arquillian.spi;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.net.URI;\n+\n+public class NarayanaLRARecoveryTest {\n+\n+    @Test\n+    public void extractCoordinatorFromUsualLRAId() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0NjUyNg=="}, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMyNDAwOQ==", "bodyText": "+1", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r512324009", "createdAt": "2020-10-26T23:13:37Z", "author": {"login": "ochaloup"}, "path": "rts/lra/test/arquillian-extension/src/test/java/io/narayana/lra/arquillian/spi/NarayanaLRARecoveryTest.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2020, Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags. See the copyright.txt file in the\n+ * distribution for a full listing of individual contributors.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+\n+package io.narayana.lra.arquillian.spi;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.net.URI;\n+\n+public class NarayanaLRARecoveryTest {\n+\n+    @Test\n+    public void extractCoordinatorFromUsualLRAId() {\n+        URI lraId = URI.create(\"http://localhost:8080/lra-coordinator/0_ffff0a28054b_9133_5f855916_a7?query=1#fragment\");\n+        URI coordinatorUri = NarayanaLRARecovery.extractLRACoordinatorUri(lraId);\n+        Assert.assertEquals(\"http\", coordinatorUri.getScheme());\n+        Assert.assertEquals(\"localhost\", coordinatorUri.getHost());\n+        Assert.assertEquals(8080, coordinatorUri.getPort());\n+        Assert.assertEquals(\"/lra-coordinator\", coordinatorUri.getPath());\n+        Assert.assertEquals(null, coordinatorUri.getQuery());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0NTY0NQ=="}, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjMzMjEyMw==", "bodyText": "+1", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r512332123", "createdAt": "2020-10-26T23:38:52Z", "author": {"login": "ochaloup"}, "path": "rts/lra/coordinator/src/main/java/io/narayana/lra/coordinator/api/RecoveryCoordinator.java", "diffHunk": "@@ -147,7 +148,7 @@ public String replaceCompensator(\n     }\n \n     @GET\n-    @Path(\"recovery\")\n+    @Path(\"/\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTgzMzgyNA=="}, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6bb21f5b4aa2b487bb51ce4dee8b33e81ba1b99", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/c6bb21f5b4aa2b487bb51ce4dee8b33e81ba1b99", "committedDate": "2020-10-26T23:35:16Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}, "afterCommit": {"oid": "37b0381a5228d2ca5c9319d3fa264b881e0d8e51", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/37b0381a5228d2ca5c9319d3fa264b881e0d8e51", "committedDate": "2020-10-29T10:17:14Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NTM4OTIy", "url": "https://github.com/jbosstm/narayana/pull/1704#pullrequestreview-519538922", "createdAt": "2020-10-29T10:45:50Z", "commit": {"oid": "37b0381a5228d2ca5c9319d3fa264b881e0d8e51"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDo0NTo1MFrOHqWGHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMDo0OToyNFrOHqWONQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2NDI1Mg==", "bodyText": "I agree with Mike here, we could use the more efficient method and could give the explanation in java docs?", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r514164252", "createdAt": "2020-10-29T10:45:50Z", "author": {"login": "mayankkunwar"}, "path": "rts/lra/test/arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -60,48 +64,86 @@ public void waitForCallbacks(URI lraId) {\n \n     @Override\n     public boolean waitForEndPhaseReplay(URI lraId) {\n-        String host = lraId.getHost();\n-        int port = lraId.getPort();\n-        if (!recoverLRAs(host, port, lraId)) {\n+        if (!recoverLRAs(lraId)) {\n             // first recovery scan probably collided with periodic recovery which started\n             // before the test execution so try once more\n-            return recoverLRAs(host, port, lraId);\n+            return recoverLRAs(lraId);\n         }\n-\n         return true;\n     }\n \n     /**\n-     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happended\n+     * Invokes LRA coordinator recovery REST endpoint and returns whether the recovery of intended LRAs happened\n      *\n-     * @param host  the LRA coordinator host address\n-     * @param port  the LRA coordinator port\n      * @param lraId the LRA id of the LRA that is intended to be recovered\n      * @return true the intended LRA recovered, false otherwise\n      */\n-    private boolean recoverLRAs(String host, int port, URI lraId) {\n+    private boolean recoverLRAs(URI lraId) {\n         // trigger a recovery scan\n         Client recoveryCoordinatorClient = ClientBuilder.newClient();\n \n         try {\n-            String recoveryCoordinatorUrl = String.format(\"http://%s:%d/%s/recovery\",\n-                host, port, LRAConstants.RECOVERY_COORDINATOR_PATH_NAME);\n-            WebTarget recoveryTarget = recoveryCoordinatorClient.target(URI.create(recoveryCoordinatorUrl));\n+            URI lraCoordinatorUri = extractLRACoordinatorUri(lraId);\n+            URI recoveryCoordinatorUri = UriBuilder.fromUri(lraCoordinatorUri)\n+                    .path(RECOVERY_COORDINATOR_PATH_NAME).build();\n+            WebTarget recoveryTarget = recoveryCoordinatorClient.target(recoveryCoordinatorUri);\n \n             // send the request to the recovery coordinator\n             Response response = recoveryTarget.request().get();\n             String json = response.readEntity(String.class);\n             response.close();\n \n-            if (json.contains(lraId.toASCIIString())) {\n-                // intended LRA didn't recover\n-                return false;\n-            }\n-\n-            return true;\n+            // intended LRA didn't recover\n+            return !json.contains(lraId.toASCIIString());\n         } finally {\n             recoveryCoordinatorClient.close();\n         }\n+    }\n \n+    /**\n+     * <p>\n+     * This method extracts the coordinator URI from the provided LRA id.\n+     * The Narayana LRA id consists of an URI of the LRA coordinator followed with the LRA transaction identifier.\n+     * We know the LRA coordinator API is hardcoded with path {@value io.narayana.lra.LRAConstants#COORDINATOR_PATH_NAME}\n+     * and the string will be searched in the original LRA id for.\n+     * </p>\n+     * <p>\n+     * The Narayana LRA works with HTTP requests and URL is used for identification. An example of the standard pattern\n+     * of the provided LRA id URI is:\n+     * {@code http://localhost:8080/deployment/lra-coordinator/0_ffff0a28054b_9133_5f855916_a7}.\n+     * This told us that the LRA can be accessed at the provided address by HTTP call.\n+     * The LRA coordinator API is available at {@code http://localhost:8080/deployment/lra-coordinator}\n+     * and the {@code 0_ffff0a28054b_9133_5f855916_a7} is the LRA transaction identifier used inside of the Coordinator\n+     * to differentiate the LRA instances.\n+     * </p>\n+     *\n+     * @param lraId  LRA id URI which is used for extraction of the LRA Coordinator API address\n+     * @return LRA Coordinator API address\n+     */\n+    static URI extractLRACoordinatorUri(URI lraId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0MzkwNA=="}, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE2NjMyNQ==", "bodyText": "Unit tests are the first step of testing, I agree.", "url": "https://github.com/jbosstm/narayana/pull/1704#discussion_r514166325", "createdAt": "2020-10-29T10:49:24Z", "author": {"login": "mayankkunwar"}, "path": "rts/lra/test/arquillian-extension/src/test/java/io/narayana/lra/arquillian/spi/NarayanaLRARecoveryTest.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2020, Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags. See the copyright.txt file in the\n+ * distribution for a full listing of individual contributors.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+\n+package io.narayana.lra.arquillian.spi;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.net.URI;\n+\n+public class NarayanaLRARecoveryTest {\n+\n+    @Test\n+    public void extractCoordinatorFromUsualLRAId() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg0NjUyNg=="}, "originalCommit": {"oid": "207f902250f4248a5684b3092dd06184d7276c38"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "37b0381a5228d2ca5c9319d3fa264b881e0d8e51", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/37b0381a5228d2ca5c9319d3fa264b881e0d8e51", "committedDate": "2020-10-29T10:17:14Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}, "afterCommit": {"oid": "e8d9604bc58667772976615ca0de74347be117ab", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/e8d9604bc58667772976615ca0de74347be117ab", "committedDate": "2020-10-29T11:52:38Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1af9493a61611f26567e1d580251bc0aca8868bb", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/1af9493a61611f26567e1d580251bc0aca8868bb", "committedDate": "2020-10-29T12:21:24Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8d9604bc58667772976615ca0de74347be117ab", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/e8d9604bc58667772976615ca0de74347be117ab", "committedDate": "2020-10-29T11:52:38Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}, "afterCommit": {"oid": "1af9493a61611f26567e1d580251bc0aca8868bb", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/1af9493a61611f26567e1d580251bc0aca8868bb", "committedDate": "2020-10-29T12:21:24Z", "message": "[JBTM-3378] LRA recovery manager moved on top of the lra coordinator path\n\nInstead of having two separate paths for LRA coordinator and LRA\nrecovery coordinator at  http://localhost:8080/lra-coordinator and http://localhost:8080/lra-recovery-coordinator\nthe recovery coordinator will be placed under http://localhost:8080/lra-coordinator\nas sub-path  http://localhost:8080/lra-coordinator/recovery"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NjU5OTQx", "url": "https://github.com/jbosstm/narayana/pull/1704#pullrequestreview-519659941", "createdAt": "2020-10-29T13:25:33Z", "commit": {"oid": "1af9493a61611f26567e1d580251bc0aca8868bb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4487, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}