{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2ODkxODg5", "number": 1680, "title": "[JBTM-3363] fixing the timeout adjuster hack to work on OpenJ9", "bodyText": "https://issues.redhat.com/browse/JBTM-3363\n!MAIN !CORE !QA_JTA !QA_JTS_JDKORB !QA_JTS_OPENJDKORB !QA_JTS_JACORB !BLACKTIE !XTS !PERF NO_WIN !RTS !AS_TESTS !TOMCAT !JACOCO\nLRA", "createdAt": "2020-10-02T13:00:10Z", "url": "https://github.com/jbosstm/narayana/pull/1680", "merged": true, "mergeCommit": {"oid": "e5371e03c4d6976dc466be325e9d95b434ee3a05"}, "closed": true, "closedAt": "2020-10-05T09:57:43Z", "author": {"login": "ochaloup"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOlw__gFqTUwMTEyMDczNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPf40WgFqTUwMTg0ODExOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTIwNzM0", "url": "https://github.com/jbosstm/narayana/pull/1680#pullrequestreview-501120734", "createdAt": "2020-10-02T13:11:01Z", "commit": {"oid": "cdd8f9a5d7e285a02a3483f58282fc1b4b421aef"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzoxMTowMVrOHbtBEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzoxMTowMVrOHbtBEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgxMTE1Mg==", "bodyText": "probably mention that this is OpenJ9 so the message is different?", "url": "https://github.com/jbosstm/narayana/pull/1680#discussion_r498811152", "createdAt": "2020-10-02T13:11:01Z", "author": {"login": "xstefank"}, "path": "rts/lra/lra-test/lra-test-arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/LRAAnnotationAdjuster.java", "diffHunk": "@@ -95,6 +97,25 @@ static void adjustLRAAnnotation(Class<?> clazzToLookFor, LRA originalLRAAnnotati\n                 throw new IllegalStateException(\"Cannot change annotation \" + originalLRAAnnotation\n                         + \" of class \" + clazzToLookFor + \" in JDK8 way\", e);\n             }\n+        } else if (doesJDKDefineFieldName(ANNOTATION_CACHE_FIELD_NAME)) {\n+            // OpenJ9\n+            try {\n+                Field cacheField = Class.class.getDeclaredField(ANNOTATION_CACHE_FIELD_NAME);\n+                cacheField.setAccessible(true);\n+                Object cache = cacheField.get(clazzToLookFor);\n+\n+                Class<? extends Object> cacheClass = cache.getClass();\n+                Field mapField = cacheClass.getDeclaredField(ANNOTATION_MAP_FIELD_NAME);\n+                mapField.setAccessible(true);\n+                Map<Class<? extends Annotation>, Annotation> annotationMap = (Map<Class<? extends Annotation>, Annotation>) mapField.get(cache);\n+                annotationMap.put(LRA.class, new LRAWrapped(originalLRAAnnotation));\n+            } catch (Exception e) {\n+                throw new IllegalStateException(\"Cannot change annotation \" + originalLRAAnnotation\n+                        + \" of class \" + clazzToLookFor + \" in JDK8 way\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdd8f9a5d7e285a02a3483f58282fc1b4b421aef"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNjUzMzMy", "url": "https://github.com/jbosstm/narayana/pull/1680#pullrequestreview-501653332", "createdAt": "2020-10-04T19:42:24Z", "commit": {"oid": "cdd8f9a5d7e285a02a3483f58282fc1b4b421aef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf5c42a4009fb7afcd85bccee5e0c2a370c6417a", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/bf5c42a4009fb7afcd85bccee5e0c2a370c6417a", "committedDate": "2020-10-05T08:50:20Z", "message": "[JBTM-3363] fixing the timeout adjuster hack to work on OpenJ9"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdd8f9a5d7e285a02a3483f58282fc1b4b421aef", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/cdd8f9a5d7e285a02a3483f58282fc1b4b421aef", "committedDate": "2020-10-02T12:59:03Z", "message": "[JBTM-3363] fixing the timeout adjuster hack to work on OpenJ9"}, "afterCommit": {"oid": "bf5c42a4009fb7afcd85bccee5e0c2a370c6417a", "author": {"user": {"login": "ochaloup", "name": "chalda"}}, "url": "https://github.com/jbosstm/narayana/commit/bf5c42a4009fb7afcd85bccee5e0c2a370c6417a", "committedDate": "2020-10-05T08:50:20Z", "message": "[JBTM-3363] fixing the timeout adjuster hack to work on OpenJ9"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxODQ4MTE4", "url": "https://github.com/jbosstm/narayana/pull/1680#pullrequestreview-501848118", "createdAt": "2020-10-05T08:55:14Z", "commit": {"oid": "bf5c42a4009fb7afcd85bccee5e0c2a370c6417a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4469, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}