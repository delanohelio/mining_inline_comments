{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNTM3MTgx", "number": 1644, "title": "JBTM-3341 Failed LRA is not kept in FailedTo* state in the object store", "bodyText": "https://issues.redhat.com/browse/JBTM-3341\n!MAIN !TOMCAT !AS_TESTS !RTS !JACOCO !XTS !QA_JTA !QA_JTS_JACORB !QA_JTS_JDKORB !QA_JTS_OPENJDKORB !BLACKTIE !PERF LRA !NO_WIN !DB_TESTS !mysql !db2 !postgres !oracle", "createdAt": "2020-07-02T14:00:45Z", "url": "https://github.com/jbosstm/narayana/pull/1644", "merged": true, "mergeCommit": {"oid": "ff0f7824d668567091473a4186abc54f5a81479f"}, "closed": true, "closedAt": "2020-07-09T10:32:49Z", "author": {"login": "xstefank"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyC8MNgFqTQ0MjcwNTE3Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABczLe79AFqTQ0NTQzNjk2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzA1MTc3", "url": "https://github.com/jbosstm/narayana/pull/1644#pullrequestreview-442705177", "createdAt": "2020-07-05T20:45:22Z", "commit": {"oid": "53887ad28ab62e763a86033f03caff0c24a32359"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQyMDo0NToyMlrOGtEwEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQyMDo0NToyMlrOGtEwEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkxNjk0NQ==", "bodyText": "This code calls into LRAService to convert an id into a transaction and then calls back into lraService with the returned transaction. Why not add a method to LRAService that takes the id (and internally converts it):\npublic boolean remove(URI lra)", "url": "https://github.com/jbosstm/narayana/pull/1644#discussion_r449916945", "createdAt": "2020-07-05T20:45:22Z", "author": {"login": "mmusgrov"}, "path": "rts/lra/lra-coordinator-jar/src/main/java/io/narayana/lra/coordinator/api/Coordinator.java", "diffHunk": "@@ -377,7 +377,7 @@ public Response compensateNestedLRA(@PathParam(\"NestedLraId\") String nestedLraId\n     @PUT\n     @Path(\"nested/{NestedLraId}/forget\")\n     public Response forgetNestedLRA(@PathParam(\"NestedLraId\") String nestedLraId) {\n-        lraService.remove(toURI(nestedLraId));\n+        lraService.remove(lraService.getTransaction(toURI(nestedLraId)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53887ad28ab62e763a86033f03caff0c24a32359"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzODc1NDIy", "url": "https://github.com/jbosstm/narayana/pull/1644#pullrequestreview-443875422", "createdAt": "2020-07-07T13:12:30Z", "commit": {"oid": "53887ad28ab62e763a86033f03caff0c24a32359"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMzoxMjozMVrOGt931Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMzoxODoyOFrOGt-G5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDg1MjgyMQ==", "bodyText": "I think the LRAService#remove should work directly with lraId and not with Transaction.The remove method should probably use the LRA Transaction instance obtained from the list and not the one that comes in argument\n\nthen this line is currently wrong: https://github.com/jbosstm/narayana/blob/5.10.5.Final/rts/lra/lra-coordinator-jar/src/main/java/io/narayana/lra/coordinator/domain/service/LRAService.java#L207", "url": "https://github.com/jbosstm/narayana/pull/1644#discussion_r450852821", "createdAt": "2020-07-07T13:12:31Z", "author": {"login": "ochaloup"}, "path": "rts/lra/lra-coordinator-jar/src/main/java/io/narayana/lra/coordinator/api/Coordinator.java", "diffHunk": "@@ -377,7 +377,7 @@ public Response compensateNestedLRA(@PathParam(\"NestedLraId\") String nestedLraId\n     @PUT\n     @Path(\"nested/{NestedLraId}/forget\")\n     public Response forgetNestedLRA(@PathParam(\"NestedLraId\") String nestedLraId) {\n-        lraService.remove(toURI(nestedLraId));\n+        lraService.remove(lraService.getTransaction(toURI(nestedLraId)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkxNjk0NQ=="}, "originalCommit": {"oid": "53887ad28ab62e763a86033f03caff0c24a32359"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDg1NjY3OQ==", "bodyText": "Thsis is not a request for a change but just a note \"thinking loudly\"\nDo you know why the LRA Transaction instance permits the status to be null?\nI think it could be better to assert that's not null? I can see the code may assign the status to null during recovery. Maybe some future change could adjust it.", "url": "https://github.com/jbosstm/narayana/pull/1644#discussion_r450856679", "createdAt": "2020-07-07T13:18:28Z", "author": {"login": "ochaloup"}, "path": "rts/lra/lra-coordinator-jar/src/main/java/io/narayana/lra/coordinator/domain/model/Transaction.java", "diffHunk": "@@ -374,6 +374,10 @@ public boolean isRecovering() {\n                 (status.equals(LRAStatus.Cancelling) || status.equals(LRAStatus.Closing));\n     }\n \n+    public boolean isFailed() {\n+        return status != null &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53887ad28ab62e763a86033f03caff0c24a32359"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NzcxNTA1", "url": "https://github.com/jbosstm/narayana/pull/1644#pullrequestreview-444771505", "createdAt": "2020-07-08T13:36:43Z", "commit": {"oid": "53887ad28ab62e763a86033f03caff0c24a32359"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86ccff27ddf601ba339ec3e27763f5e38a096d6f", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/86ccff27ddf601ba339ec3e27763f5e38a096d6f", "committedDate": "2020-07-09T09:00:44Z", "message": "JBTM-3341 Failed LRA is not kept in FailedTo* state in the object store"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53887ad28ab62e763a86033f03caff0c24a32359", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/53887ad28ab62e763a86033f03caff0c24a32359", "committedDate": "2020-07-02T13:58:58Z", "message": "JBTM-3341 Failed LRA is not kept in FailedTo* state in the object store"}, "afterCommit": {"oid": "86ccff27ddf601ba339ec3e27763f5e38a096d6f", "author": {"user": {"login": "xstefank", "name": "Martin Stefanko"}}, "url": "https://github.com/jbosstm/narayana/commit/86ccff27ddf601ba339ec3e27763f5e38a096d6f", "committedDate": "2020-07-09T09:00:44Z", "message": "JBTM-3341 Failed LRA is not kept in FailedTo* state in the object store"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NDM2OTY1", "url": "https://github.com/jbosstm/narayana/pull/1644#pullrequestreview-445436965", "createdAt": "2020-07-09T09:18:58Z", "commit": {"oid": "86ccff27ddf601ba339ec3e27763f5e38a096d6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4446, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}