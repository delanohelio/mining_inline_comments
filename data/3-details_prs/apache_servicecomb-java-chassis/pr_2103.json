{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyNDA0ODA5", "number": 2103, "title": "[SCB-2145]fix local yaml unsafe parse problem", "bodyText": "Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Make sure there is a JIRA issue filed for the change (usually before you start working on it).  Trivial changes like typos do not require a JIRA issue.  Your pull request should address just this issue, without pulling in other changes.\n Each commit in the pull request should have a meaningful subject line and body.\n Format the pull request title like [SCB-XXX] Fixes bug in ApproximateQuantiles, where you replace SCB-XXX with the appropriate JIRA issue.\n Write a pull request description that is detailed enough to understand what the pull request does, how, and why.\n Run mvn clean install -Pit to make sure basic checks pass. A more thorough check will be performed on your pull request automatically.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.", "createdAt": "2020-12-04T09:25:57Z", "url": "https://github.com/apache/servicecomb-java-chassis/pull/2103", "merged": true, "mergeCommit": {"oid": "ba4fb37b6ab8bd3a6c3d0693f295d99a94879838"}, "closed": true, "closedAt": "2020-12-06T13:53:26Z", "author": {"login": "liubao68"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdi0QLuAH2gAyNTMyNDA0ODA5OmRkNTBhOTdjNzY4NmUxM2Q3MWJiNDIwMGRjNzZiNzYwNTBiMzhkZmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjhTZHAFqTU0NTcwNzcyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dd50a97c7686e13d71bb4200dc76b76050b38dfc", "author": {"user": {"login": "liubao68", "name": "liubao68"}}, "url": "https://github.com/apache/servicecomb-java-chassis/commit/dd50a97c7686e13d71bb4200dc76b76050b38dfc", "committedDate": "2020-12-04T09:23:24Z", "message": "[SCB-2145]fix local yaml unsafe parse problem"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1Mzk1NjU2", "url": "https://github.com/apache/servicecomb-java-chassis/pull/2103#pullrequestreview-545395656", "createdAt": "2020-12-05T02:43:40Z", "commit": {"oid": "dd50a97c7686e13d71bb4200dc76b76050b38dfc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwMjo0Mzo0MFrOH_omqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwMjo0Mzo0MFrOH_omqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ4NzU5NQ==", "bodyText": "try (InputStream is = url.openStream()) {\n    if (is != null) {\n      beans.addAll(initFromData(is));\n    }\n  }", "url": "https://github.com/apache/servicecomb-java-chassis/pull/2103#discussion_r536487595", "createdAt": "2020-12-05T02:43:40Z", "author": {"login": "wujimin"}, "path": "service-registry/registry-local/src/main/java/org/apache/servicecomb/localregistry/LocalRegistryStore.java", "diffHunk": "@@ -111,37 +111,38 @@ public MicroserviceInstance getSelfMicroserviceInstance() {\n   private List<RegistryBean> loadYamlBeans() {\n     List<RegistryBean> beans = new ArrayList<>();\n \n-    InputStream is = null;\n-\n     try {\n       ClassLoader loader = JvmUtils.findClassLoader();\n       Enumeration<URL> urls = loader.getResources(REGISTRY_FILE_NAME);\n+\n       while (urls.hasMoreElements()) {\n         URL url = urls.nextElement();\n-        is = url.openStream();\n-        if (is != null) {\n-          beans.addAll(initFromData(is));\n+\n+        InputStream is = null;\n+        try {\n+          is = url.openStream();\n+          if (is != null) {\n+            beans.addAll(initFromData(is));\n+          }\n+        } finally {\n+          if (is != null) {\n+            try {\n+              is.close();\n+            } catch (IOException e) {\n+              // nothing to do\n+            }\n+          }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd50a97c7686e13d71bb4200dc76b76050b38dfc"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1Mzk2MTg2", "url": "https://github.com/apache/servicecomb-java-chassis/pull/2103#pullrequestreview-545396186", "createdAt": "2020-12-05T02:50:30Z", "commit": {"oid": "dd50a97c7686e13d71bb4200dc76b76050b38dfc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwMjo1MDozMFrOH_orHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQwMjo1MDozMFrOH_orHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQ4ODczNQ==", "bodyText": "\u521b\u5efastream\u7684\u5730\u65b9\u7528try-with-resource\uff0c\u5e94\u8be5\u66f4\u5408\u9002", "url": "https://github.com/apache/servicecomb-java-chassis/pull/2103#discussion_r536488735", "createdAt": "2020-12-05T02:50:30Z", "author": {"login": "wujimin"}, "path": "service-registry/registry-service-center/src/test/java/org/apache/servicecomb/serviceregistry/client/LocalServiceRegistryClientImpl.java", "diffHunk": "@@ -94,10 +95,16 @@ public LocalServiceRegistryClientImpl(Map<String, Object> data) {\n   }\n \n   private void initFromData(InputStream is) {\n-    Yaml yaml = new Yaml();\n-    @SuppressWarnings(\"unchecked\")\n-    Map<String, Object> data = yaml.loadAs(is, Map.class);\n-    initFromData(data);\n+    try {\n+      Map<String, Object> data = YAMLUtil.yaml2Properties(is);\n+      initFromData(data);\n+    } finally {\n+      try {\n+        is.close();\n+      } catch (IOException e) {\n+        LOGGER.error(\"\", e);\n+      }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd50a97c7686e13d71bb4200dc76b76050b38dfc"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b511190fdd9c33cd3e4e363daced8dad8ddc6cd", "author": {"user": {"login": "liubao68", "name": "liubao68"}}, "url": "https://github.com/apache/servicecomb-java-chassis/commit/5b511190fdd9c33cd3e4e363daced8dad8ddc6cd", "committedDate": "2020-12-05T03:10:58Z", "message": "[SCB-2145]fix review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NzA3NzI1", "url": "https://github.com/apache/servicecomb-java-chassis/pull/2103#pullrequestreview-545707725", "createdAt": "2020-12-06T13:52:38Z", "commit": {"oid": "5b511190fdd9c33cd3e4e363daced8dad8ddc6cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4405, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}