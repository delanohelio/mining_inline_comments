{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNDc3NzIx", "number": 1664, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0MDowNlrODru8KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0NzoxNlrODrvJLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MTg0NDI1OnYy", "diffSide": "RIGHT", "path": "demo/demo-springmvc/springmvc-client/src/main/java/org/apache/servicecomb/demo/springmvc/client/TestDateTimeSchema.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0MDowNlrOF8QAfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMzozOToxOFrOF8iIMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMTE0OQ==", "bodyText": "not so good.\nthis makes parse endpoint for each invocation?", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r398721149", "createdAt": "2020-03-26T16:40:06Z", "author": {"login": "wujimin"}, "path": "demo/demo-springmvc/springmvc-client/src/main/java/org/apache/servicecomb/demo/springmvc/client/TestDateTimeSchema.java", "diffHunk": "@@ -92,4 +119,39 @@ private void testDateTimeSchema() {\n         dateTimeSchemaInf.postLocalDateTime(localDateTime)\n             .format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd'T'HH:mm:ss.SSS\")));\n   }\n+\n+  private void testDateTimeSchemaMulticast() {\n+    DiscoveryContext context = new DiscoveryContext();\n+    VersionedCache serversVersionedCache = discoveryTree.discovery(context, \"springmvctest\", \"springmvc\", \"0+\");\n+    List<String> enpoints = serversVersionedCache.data();\n+\n+    for (String endpoint : enpoints) {\n+      InvocationContext invocationContext = new InvocationContext();\n+      invocationContext.addLocalContext(LoadbalanceHandler.SERVICECOMB_SERVER_ENDPOINT, endpoint);\n+      Date date = new Date();\n+      TestMgr.check(date.getTime(), dateTimeSchemaWithContextInf.getDate(invocationContext, date).getTime());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk4MjEyMw==", "bodyText": "we have to now, because LoadBalanceHandler read string endpoint.", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r398982123", "createdAt": "2020-03-27T01:16:04Z", "author": {"login": "liubao68"}, "path": "demo/demo-springmvc/springmvc-client/src/main/java/org/apache/servicecomb/demo/springmvc/client/TestDateTimeSchema.java", "diffHunk": "@@ -92,4 +119,39 @@ private void testDateTimeSchema() {\n         dateTimeSchemaInf.postLocalDateTime(localDateTime)\n             .format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd'T'HH:mm:ss.SSS\")));\n   }\n+\n+  private void testDateTimeSchemaMulticast() {\n+    DiscoveryContext context = new DiscoveryContext();\n+    VersionedCache serversVersionedCache = discoveryTree.discovery(context, \"springmvctest\", \"springmvc\", \"0+\");\n+    List<String> enpoints = serversVersionedCache.data();\n+\n+    for (String endpoint : enpoints) {\n+      InvocationContext invocationContext = new InvocationContext();\n+      invocationContext.addLocalContext(LoadbalanceHandler.SERVICECOMB_SERVER_ENDPOINT, endpoint);\n+      Date date = new Date();\n+      TestMgr.check(date.getTime(), dateTimeSchemaWithContextInf.getDate(invocationContext, date).getTime());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMTE0OQ=="}, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAwODE1Mg==", "bodyText": "when optimize this, LB should be change too.", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r399008152", "createdAt": "2020-03-27T02:56:49Z", "author": {"login": "wujimin"}, "path": "demo/demo-springmvc/springmvc-client/src/main/java/org/apache/servicecomb/demo/springmvc/client/TestDateTimeSchema.java", "diffHunk": "@@ -92,4 +119,39 @@ private void testDateTimeSchema() {\n         dateTimeSchemaInf.postLocalDateTime(localDateTime)\n             .format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd'T'HH:mm:ss.SSS\")));\n   }\n+\n+  private void testDateTimeSchemaMulticast() {\n+    DiscoveryContext context = new DiscoveryContext();\n+    VersionedCache serversVersionedCache = discoveryTree.discovery(context, \"springmvctest\", \"springmvc\", \"0+\");\n+    List<String> enpoints = serversVersionedCache.data();\n+\n+    for (String endpoint : enpoints) {\n+      InvocationContext invocationContext = new InvocationContext();\n+      invocationContext.addLocalContext(LoadbalanceHandler.SERVICECOMB_SERVER_ENDPOINT, endpoint);\n+      Date date = new Date();\n+      TestMgr.check(date.getTime(), dateTimeSchemaWithContextInf.getDate(invocationContext, date).getTime());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMTE0OQ=="}, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxODAzMw==", "bodyText": "I create a issue for this : https://issues.apache.org/jira/browse/SCB-1831", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r399018033", "createdAt": "2020-03-27T03:39:18Z", "author": {"login": "liubao68"}, "path": "demo/demo-springmvc/springmvc-client/src/main/java/org/apache/servicecomb/demo/springmvc/client/TestDateTimeSchema.java", "diffHunk": "@@ -92,4 +119,39 @@ private void testDateTimeSchema() {\n         dateTimeSchemaInf.postLocalDateTime(localDateTime)\n             .format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd'T'HH:mm:ss.SSS\")));\n   }\n+\n+  private void testDateTimeSchemaMulticast() {\n+    DiscoveryContext context = new DiscoveryContext();\n+    VersionedCache serversVersionedCache = discoveryTree.discovery(context, \"springmvctest\", \"springmvc\", \"0+\");\n+    List<String> enpoints = serversVersionedCache.data();\n+\n+    for (String endpoint : enpoints) {\n+      InvocationContext invocationContext = new InvocationContext();\n+      invocationContext.addLocalContext(LoadbalanceHandler.SERVICECOMB_SERVER_ENDPOINT, endpoint);\n+      Date date = new Date();\n+      TestMgr.check(date.getTime(), dateTimeSchemaWithContextInf.getDate(invocationContext, date).getTime());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMTE0OQ=="}, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MTg1NTU3OnYy", "diffSide": "RIGHT", "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0MjozOVrOF8QHwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMjo1NTo1OVrOF8hgwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMzAxMA==", "bodyText": "maybe there are different consumer interfaces.\nif set back to operationMeta, will cause problem.", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r398723010", "createdAt": "2020-03-26T16:42:39Z", "author": {"login": "wujimin"}, "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "diffHunk": "@@ -162,6 +162,8 @@ public Object invoke(Object proxy, Method method, Object[] args) {\n \n     SwaggerConsumerOperation consumerOperation = pojoConsumerOperationMeta.getSwaggerConsumerOperation();\n     OperationMeta operationMeta = pojoConsumerOperationMeta.getOperationMeta();\n+    // operation meta is static data based on swagger, while consumer operation based on invoker, have interface info\n+    operationMeta.setSwaggerConsumerOperation(consumerOperation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk2Njg4Nw==", "bodyText": "begin from scb-1706, that modify is not a good idea.", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r398966887", "createdAt": "2020-03-27T00:17:44Z", "author": {"login": "wujimin"}, "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "diffHunk": "@@ -162,6 +162,8 @@ public Object invoke(Object proxy, Method method, Object[] args) {\n \n     SwaggerConsumerOperation consumerOperation = pojoConsumerOperationMeta.getSwaggerConsumerOperation();\n     OperationMeta operationMeta = pojoConsumerOperationMeta.getOperationMeta();\n+    // operation meta is static data based on swagger, while consumer operation based on invoker, have interface info\n+    operationMeta.setSwaggerConsumerOperation(consumerOperation);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMzAxMA=="}, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk4NDA2NQ==", "bodyText": "From invocation, can only get OperationMeta. Current code put all invocation data(e.g. response type) to OperationMeta. This is not good, need refactor in future, but this PR not working on this refactoring, because it is related to some other parts besides this issue.  I create an issue and refactoring the code later.", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r398984065", "createdAt": "2020-03-27T01:23:39Z", "author": {"login": "liubao68"}, "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "diffHunk": "@@ -162,6 +162,8 @@ public Object invoke(Object proxy, Method method, Object[] args) {\n \n     SwaggerConsumerOperation consumerOperation = pojoConsumerOperationMeta.getSwaggerConsumerOperation();\n     OperationMeta operationMeta = pojoConsumerOperationMeta.getOperationMeta();\n+    // operation meta is static data based on swagger, while consumer operation based on invoker, have interface info\n+    operationMeta.setSwaggerConsumerOperation(consumerOperation);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMzAxMA=="}, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAwNzkzNw==", "bodyText": "as we disscussed, we create new issue to resolve this.", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r399007937", "createdAt": "2020-03-27T02:55:59Z", "author": {"login": "wujimin"}, "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "diffHunk": "@@ -162,6 +162,8 @@ public Object invoke(Object proxy, Method method, Object[] args) {\n \n     SwaggerConsumerOperation consumerOperation = pojoConsumerOperationMeta.getSwaggerConsumerOperation();\n     OperationMeta operationMeta = pojoConsumerOperationMeta.getOperationMeta();\n+    // operation meta is static data based on swagger, while consumer operation based on invoker, have interface info\n+    operationMeta.setSwaggerConsumerOperation(consumerOperation);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMzAxMA=="}, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MTg3NzU5OnYy", "diffSide": "RIGHT", "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0NzoxNlrOF8QVqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMzo0MDowNVrOF8iI7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNjU3MQ==", "bodyText": "consumerMeta only belongs to this invoker instance\nonly relate to this one consumerIntf class\nseems no need to build a complex key?", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r398726571", "createdAt": "2020-03-26T16:47:16Z", "author": {"login": "wujimin"}, "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "diffHunk": "@@ -148,7 +148,7 @@ public Object invoke(Object proxy, Method method, Object[] args) {\n     }\n \n     PojoConsumerOperationMeta pojoConsumerOperationMeta = consumerMeta\n-        .findOperationMeta(MethodUtils.findSwaggerMethodName(method));\n+        .findOperationMeta(MethodUtils.findSwaggerMethodName(method), consumerIntf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk4MjUzMQ==", "bodyText": "This is what this PR for , two interfaces should working in one consumer\ninterface DateTimeSchemaInf {\n  Date getDate(Date date);\t\n}\n\n\ninterface DateTimeSchemaWithContextInf {\n  Date getDate(InvocationContext context, Date date);\n}", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r398982531", "createdAt": "2020-03-27T01:17:38Z", "author": {"login": "liubao68"}, "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "diffHunk": "@@ -148,7 +148,7 @@ public Object invoke(Object proxy, Method method, Object[] args) {\n     }\n \n     PojoConsumerOperationMeta pojoConsumerOperationMeta = consumerMeta\n-        .findOperationMeta(MethodUtils.findSwaggerMethodName(method));\n+        .findOperationMeta(MethodUtils.findSwaggerMethodName(method), consumerIntf);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNjU3MQ=="}, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAwNzc3Mw==", "bodyText": "meta from Invoker should not set in OperationMeta\nbecause as you said, there are different invokers\nwe can create a new issue to optimize this.", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r399007773", "createdAt": "2020-03-27T02:55:20Z", "author": {"login": "wujimin"}, "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "diffHunk": "@@ -148,7 +148,7 @@ public Object invoke(Object proxy, Method method, Object[] args) {\n     }\n \n     PojoConsumerOperationMeta pojoConsumerOperationMeta = consumerMeta\n-        .findOperationMeta(MethodUtils.findSwaggerMethodName(method));\n+        .findOperationMeta(MethodUtils.findSwaggerMethodName(method), consumerIntf);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNjU3MQ=="}, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxODIyMA==", "bodyText": "issue: https://issues.apache.org/jira/browse/SCB-1830", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r399018220", "createdAt": "2020-03-27T03:40:05Z", "author": {"login": "liubao68"}, "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "diffHunk": "@@ -148,7 +148,7 @@ public Object invoke(Object proxy, Method method, Object[] args) {\n     }\n \n     PojoConsumerOperationMeta pojoConsumerOperationMeta = consumerMeta\n-        .findOperationMeta(MethodUtils.findSwaggerMethodName(method));\n+        .findOperationMeta(MethodUtils.findSwaggerMethodName(method), consumerIntf);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNjU3MQ=="}, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1330, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}