{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNDc3NzIx", "number": 1664, "title": "[SCB-1822]fix problems when using multiple consumer interface for one\u2026", "bodyText": "\u2026 operation and using CseHttpEntity to set localcontext\nFollow this checklist to help us incorporate your contribution quickly and easily:\n\n Make sure there is a JIRA issue filed for the change (usually before you start working on it).  Trivial changes like typos do not require a JIRA issue.  Your pull request should address just this issue, without pulling in other changes.\n Each commit in the pull request should have a meaningful subject line and body.\n Format the pull request title like [SCB-XXX] Fixes bug in ApproximateQuantiles, where you replace SCB-XXX with the appropriate JIRA issue.\n Write a pull request description that is detailed enough to understand what the pull request does, how, and why.\n Run mvn clean install -Pit to make sure basic checks pass. A more thorough check will be performed on your pull request automatically.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.", "createdAt": "2020-03-25T09:30:17Z", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664", "merged": true, "mergeCommit": {"oid": "e3b4b80fc8b25e54c75065ce2cd0356afbe17d68"}, "closed": true, "closedAt": "2020-03-27T03:53:59Z", "author": {"login": "liubao68"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcREFtVgH2gAyMzkzNDc3NzIxOmQ4ZTZjMzg5NWM4OTlhMGZkZGZhYTI5NmIxNGI5MGRjYWUwNWIxNjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRe9oiAFqTM4MjIwMzYwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d8e6c3895c899a0fddfaa296b14b90dcae05b165", "author": {"user": {"login": "liubao68", "name": "liubao68"}}, "url": "https://github.com/apache/servicecomb-java-chassis/commit/d8e6c3895c899a0fddfaa296b14b90dcae05b165", "committedDate": "2020-03-25T09:28:39Z", "message": "[SCB-1822]fix problems when using multiple consumer interface for one operation and using CseHttpEntity to set localcontext"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678", "author": {"user": {"login": "liubao68", "name": "liubao68"}}, "url": "https://github.com/apache/servicecomb-java-chassis/commit/478643f1f8ce88ba7edbe76af108d12144d2e678", "committedDate": "2020-03-25T13:11:30Z", "message": "[SCB-1822]fix random test error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMTk2OTA1", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#pullrequestreview-382196905", "createdAt": "2020-03-26T16:40:05Z", "commit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0MDowNlrOF8QAfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0MDowNlrOF8QAfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMTE0OQ==", "bodyText": "not so good.\nthis makes parse endpoint for each invocation?", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r398721149", "createdAt": "2020-03-26T16:40:06Z", "author": {"login": "wujimin"}, "path": "demo/demo-springmvc/springmvc-client/src/main/java/org/apache/servicecomb/demo/springmvc/client/TestDateTimeSchema.java", "diffHunk": "@@ -92,4 +119,39 @@ private void testDateTimeSchema() {\n         dateTimeSchemaInf.postLocalDateTime(localDateTime)\n             .format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd'T'HH:mm:ss.SSS\")));\n   }\n+\n+  private void testDateTimeSchemaMulticast() {\n+    DiscoveryContext context = new DiscoveryContext();\n+    VersionedCache serversVersionedCache = discoveryTree.discovery(context, \"springmvctest\", \"springmvc\", \"0+\");\n+    List<String> enpoints = serversVersionedCache.data();\n+\n+    for (String endpoint : enpoints) {\n+      InvocationContext invocationContext = new InvocationContext();\n+      invocationContext.addLocalContext(LoadbalanceHandler.SERVICECOMB_SERVER_ENDPOINT, endpoint);\n+      Date date = new Date();\n+      TestMgr.check(date.getTime(), dateTimeSchemaWithContextInf.getDate(invocationContext, date).getTime());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMTk5MjQw", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#pullrequestreview-382199240", "createdAt": "2020-03-26T16:42:39Z", "commit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0MjozOVrOF8QHwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0MjozOVrOF8QHwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyMzAxMA==", "bodyText": "maybe there are different consumer interfaces.\nif set back to operationMeta, will cause problem.", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r398723010", "createdAt": "2020-03-26T16:42:39Z", "author": {"login": "wujimin"}, "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "diffHunk": "@@ -162,6 +162,8 @@ public Object invoke(Object proxy, Method method, Object[] args) {\n \n     SwaggerConsumerOperation consumerOperation = pojoConsumerOperationMeta.getSwaggerConsumerOperation();\n     OperationMeta operationMeta = pojoConsumerOperationMeta.getOperationMeta();\n+    // operation meta is static data based on swagger, while consumer operation based on invoker, have interface info\n+    operationMeta.setSwaggerConsumerOperation(consumerOperation);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMjAzNjA0", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#pullrequestreview-382203604", "createdAt": "2020-03-26T16:47:16Z", "commit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0NzoxNlrOF8QVqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo0NzoxNlrOF8QVqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNjU3MQ==", "bodyText": "consumerMeta only belongs to this invoker instance\nonly relate to this one consumerIntf class\nseems no need to build a complex key?", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1664#discussion_r398726571", "createdAt": "2020-03-26T16:47:16Z", "author": {"login": "wujimin"}, "path": "providers/provider-pojo/src/main/java/org/apache/servicecomb/provider/pojo/Invoker.java", "diffHunk": "@@ -148,7 +148,7 @@ public Object invoke(Object proxy, Method method, Object[] args) {\n     }\n \n     PojoConsumerOperationMeta pojoConsumerOperationMeta = consumerMeta\n-        .findOperationMeta(MethodUtils.findSwaggerMethodName(method));\n+        .findOperationMeta(MethodUtils.findSwaggerMethodName(method), consumerIntf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "478643f1f8ce88ba7edbe76af108d12144d2e678"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4499, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}