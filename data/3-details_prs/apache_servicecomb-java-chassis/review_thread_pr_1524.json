{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNjkwODEw", "number": 1524, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwMTowMDoxOFrODXaCug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwMjo1ODo1MVrODXadBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1ODcwNTIyOnYy", "diffSide": "RIGHT", "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/Configuration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwMTowMDoxOFrOFcsCHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwNzoyNDowNlrOFcunLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYyNTg4NA==", "bodyText": "change to timerIntervalInMillis", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1524#discussion_r365625884", "createdAt": "2020-01-13T01:00:18Z", "author": {"login": "liubao68"}, "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/Configuration.java", "diffHunk": "@@ -31,9 +31,9 @@\n   //// 2.1 configuration items\n   public static final String PROP_ROOT = \"servicecomb.loadbalance.\";\n \n-  public static final String RPOP_SERVER_EXPIRED_IN_SECONDS = \"servicecomb.loadbalance.stats.serverExpiredInSeconds\";\n+  public static final String PROP_SERVER_EXPIRED_IN_SECONDS = \"servicecomb.loadbalance.stats.serverExpiredInSeconds\";\n \n-  public static final String RPOP_TIMER_INTERVAL_IN_MINIS = \"servicecomb.loadbalance.stats.timerIntervalInMilis\";\n+  public static final String PROP_TIMER_INTERVAL_IN_MILLIS = \"servicecomb.loadbalance.stats.timerIntervalInMilis\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61ba0671f5a07eb25e2443cd88062a6624c62b07"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY2ODE0MA==", "bodyText": "done", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1524#discussion_r365668140", "createdAt": "2020-01-13T07:24:06Z", "author": {"login": "AngLi2"}, "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/Configuration.java", "diffHunk": "@@ -31,9 +31,9 @@\n   //// 2.1 configuration items\n   public static final String PROP_ROOT = \"servicecomb.loadbalance.\";\n \n-  public static final String RPOP_SERVER_EXPIRED_IN_SECONDS = \"servicecomb.loadbalance.stats.serverExpiredInSeconds\";\n+  public static final String PROP_SERVER_EXPIRED_IN_SECONDS = \"servicecomb.loadbalance.stats.serverExpiredInSeconds\";\n \n-  public static final String RPOP_TIMER_INTERVAL_IN_MINIS = \"servicecomb.loadbalance.stats.timerIntervalInMilis\";\n+  public static final String PROP_TIMER_INTERVAL_IN_MILLIS = \"servicecomb.loadbalance.stats.timerIntervalInMilis\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYyNTg4NA=="}, "originalCommit": {"oid": "61ba0671f5a07eb25e2443cd88062a6624c62b07"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1ODcwNTgxOnYy", "diffSide": "RIGHT", "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/Configuration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwMTowMTozN1rOFcsCZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwNzoyMzo1NVrOFcunCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYyNTk1OQ==", "bodyText": "getRetry can change to a better name", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1524#discussion_r365625959", "createdAt": "2020-01-13T01:01:37Z", "author": {"login": "liubao68"}, "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/Configuration.java", "diffHunk": "@@ -122,10 +122,14 @@ public boolean isRetryEnabled(String microservice) {\n   }\n \n   public int getRetryOnNext(String microservice) {\n+    return getRetry(microservice, PROP_RETRY_ONNEXT);\n+  }\n+\n+  private int getRetry(String microservice, String propRetry) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61ba0671f5a07eb25e2443cd88062a6624c62b07"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY2ODEwNQ==", "bodyText": "Name changing takes com.netflix.client.DefaultLoadBalanceRetryHandler naming as reference.", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1524#discussion_r365668105", "createdAt": "2020-01-13T07:23:55Z", "author": {"login": "AngLi2"}, "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/Configuration.java", "diffHunk": "@@ -122,10 +122,14 @@ public boolean isRetryEnabled(String microservice) {\n   }\n \n   public int getRetryOnNext(String microservice) {\n+    return getRetry(microservice, PROP_RETRY_ONNEXT);\n+  }\n+\n+  private int getRetry(String microservice, String propRetry) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYyNTk1OQ=="}, "originalCommit": {"oid": "61ba0671f5a07eb25e2443cd88062a6624c62b07"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1ODcwNzU4OnYy", "diffSide": "RIGHT", "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/ServiceCombLoadBalancerStats.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwMTowNToyNVrOFcsDWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwNzoyMDozMlrOFcukaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYyNjIwMA==", "bodyText": "getServiceCombServerOld is never used", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1524#discussion_r365626200", "createdAt": "2020-01-13T01:05:25Z", "author": {"login": "liubao68"}, "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/ServiceCombLoadBalancerStats.java", "diffHunk": "@@ -104,6 +106,10 @@ public ServiceCombServerStats getServiceCombServerStats(ServiceCombServer server\n   }\n \n   public ServiceCombServer getServiceCombServer(MicroserviceInstance instance) {\n+    return serviceCombServers.get(instance.getInstanceId());\n+  }\n+\n+  public ServiceCombServer getServiceCombServerOld(MicroserviceInstance instance) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5235085a94e0f91acd662414fe5cd0ea866f3269"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY2NzQzMw==", "bodyText": "deleted.", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1524#discussion_r365667433", "createdAt": "2020-01-13T07:20:32Z", "author": {"login": "AngLi2"}, "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/ServiceCombLoadBalancerStats.java", "diffHunk": "@@ -104,6 +106,10 @@ public ServiceCombServerStats getServiceCombServerStats(ServiceCombServer server\n   }\n \n   public ServiceCombServer getServiceCombServer(MicroserviceInstance instance) {\n+    return serviceCombServers.get(instance.getInstanceId());\n+  }\n+\n+  public ServiceCombServer getServiceCombServerOld(MicroserviceInstance instance) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYyNjIwMA=="}, "originalCommit": {"oid": "5235085a94e0f91acd662414fe5cd0ea866f3269"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1ODc0MDkzOnYy", "diffSide": "RIGHT", "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/Configuration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwMjoxMDowNVrOFcsWAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwNzoyNDoxOVrOFcunVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYzMDk3Nw==", "bodyText": "timerIntervalInMilis not changed", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1524#discussion_r365630977", "createdAt": "2020-01-13T02:10:05Z", "author": {"login": "liubao68"}, "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/Configuration.java", "diffHunk": "@@ -29,25 +29,25 @@\n  */\n public final class Configuration {\n   //// 2.1 configuration items\n-  public static final String PROP_ROOT = \"servicecomb.loadbalance.\";\n+  public static final String ROOT = \"servicecomb.loadbalance.\";\n \n-  public static final String PROP_SERVER_EXPIRED_IN_SECONDS = \"servicecomb.loadbalance.stats.serverExpiredInSeconds\";\n+  public static final String SERVER_EXPIRED_IN_SECONDS = \"servicecomb.loadbalance.stats.serverExpiredInSeconds\";\n \n-  public static final String PROP_TIMER_INTERVAL_IN_MILLIS = \"servicecomb.loadbalance.stats.timerIntervalInMilis\";\n+  public static final String TIMER_INTERVAL_IN_MILLIS = \"servicecomb.loadbalance.stats.timerIntervalInMilis\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1aa0024d2d762e29de83a8581d41bab0b04794"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY2ODE4MQ==", "bodyText": "done", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1524#discussion_r365668181", "createdAt": "2020-01-13T07:24:19Z", "author": {"login": "AngLi2"}, "path": "handlers/handler-loadbalance/src/main/java/org/apache/servicecomb/loadbalance/Configuration.java", "diffHunk": "@@ -29,25 +29,25 @@\n  */\n public final class Configuration {\n   //// 2.1 configuration items\n-  public static final String PROP_ROOT = \"servicecomb.loadbalance.\";\n+  public static final String ROOT = \"servicecomb.loadbalance.\";\n \n-  public static final String PROP_SERVER_EXPIRED_IN_SECONDS = \"servicecomb.loadbalance.stats.serverExpiredInSeconds\";\n+  public static final String SERVER_EXPIRED_IN_SECONDS = \"servicecomb.loadbalance.stats.serverExpiredInSeconds\";\n \n-  public static final String PROP_TIMER_INTERVAL_IN_MILLIS = \"servicecomb.loadbalance.stats.timerIntervalInMilis\";\n+  public static final String TIMER_INTERVAL_IN_MILLIS = \"servicecomb.loadbalance.stats.timerIntervalInMilis\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYzMDk3Nw=="}, "originalCommit": {"oid": "7e1aa0024d2d762e29de83a8581d41bab0b04794"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1ODc3MjU0OnYy", "diffSide": "RIGHT", "path": "foundations/foundation-config/src/main/resources/mapping.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwMjo1ODo1MVrOFcsn9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwNzoyMDoyM1rOFcukSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYzNTU3NQ==", "bodyText": "Hello, it's better to write a UT case to cover here.\nThis configuration seems wrong. It means mapping servicecomb.loadbalance.stats.timerIntervalInMillis to servicecomb.loadbalance.stats.timerIntervalInMilis, while it doesn't take effect in the opposite direction. Since you get the config value from servicecomb.loadbalance.stats.timerIntervalInMillis, maybe here should be like below?\nservicecomb.loadbalance.stats.timerIntervalInMilis:\n  - servicecomb.loadbalance.stats.timerIntervalInMillis", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1524#discussion_r365635575", "createdAt": "2020-01-13T02:58:51Z", "author": {"login": "yhs0092"}, "path": "foundations/foundation-config/src/main/resources/mapping.yaml", "diffHunk": "@@ -16,3 +16,6 @@\n ## ---------------------------------------------------------------------------\n \n SERVICECOMB_ENV: service_description.environment\n+\n+servicecomb.loadbalance.stats.timerIntervalInMillis:\n+  - servicecomb.loadbalance.stats.timerIntervalInMilis", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6dd9dd3890afda4eb8e0430d3ca153a42c2ebcf6"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY2NzQwMg==", "bodyText": "done, UTs added. PTAL", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1524#discussion_r365667402", "createdAt": "2020-01-13T07:20:23Z", "author": {"login": "AngLi2"}, "path": "foundations/foundation-config/src/main/resources/mapping.yaml", "diffHunk": "@@ -16,3 +16,6 @@\n ## ---------------------------------------------------------------------------\n \n SERVICECOMB_ENV: service_description.environment\n+\n+servicecomb.loadbalance.stats.timerIntervalInMillis:\n+  - servicecomb.loadbalance.stats.timerIntervalInMilis", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYzNTU3NQ=="}, "originalCommit": {"oid": "6dd9dd3890afda4eb8e0430d3ca153a42c2ebcf6"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1359, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}