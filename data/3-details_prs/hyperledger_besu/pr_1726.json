{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMzk2MzU0", "number": 1726, "title": "Generate All Transaction Types and TransactionReceipt Types in BlockDataGenerator", "bodyText": "PR description\nSince we're going to have new transaction types, we should use all the types in our BlockDataGenerator by default to make sure we're getting coverage.\nFixed Issue(s)\nfixes #1667\nChangelog\n\n I thought about the changelog and included a changelog update if required.", "createdAt": "2020-12-16T19:41:15Z", "url": "https://github.com/hyperledger/besu/pull/1726", "merged": true, "mergeCommit": {"oid": "d06393d50f25a932b60a50ca837095247e5a113e"}, "closed": true, "closedAt": "2021-01-14T19:44:02Z", "author": {"login": "RatanRSur"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdm0L-XAH2gAyNTQxMzk2MzU0OjFlODFjMGIxYmFjMWE1MTI5Y2YxMDgwNTM3NTI1OWVkYTkwOWZkYjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdwJdj3AH2gAyNTQxMzk2MzU0OjczNTIyYzMxYzQ3NzU3MzIyOWVmMGQyNWZlOTI5NDc4YTQzZGJkMzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1e81c0b1bac1a5129cf10805375259eda909fdb5", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/1e81c0b1bac1a5129cf10805375259eda909fdb5", "committedDate": "2020-12-16T19:34:30Z", "message": "some test fixes\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6c16f1b6b1f392dd43607279c7412b28baed80c", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/c6c16f1b6b1f392dd43607279c7412b28baed80c", "committedDate": "2020-12-16T19:36:34Z", "message": "spotless\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b3b63165dbcf9743c8b3c9d8cf1173c2cce5949", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/4b3b63165dbcf9743c8b3c9d8cf1173c2cce5949", "committedDate": "2020-12-16T20:03:03Z", "message": "go back to wrap\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef843dd1d787dd01f472fd398b17419d30e3e9a3", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/ef843dd1d787dd01f472fd398b17419d30e3e9a3", "committedDate": "2020-12-16T21:26:14Z", "message": "wrap bytes properly\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17aa80ca7923caf1ff937186f9f21c7da96f2c1b", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/17aa80ca7923caf1ff937186f9f21c7da96f2c1b", "committedDate": "2020-12-16T22:30:51Z", "message": "add TransactionType to BlockOptions\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf0cffed3f19485767e3b26e24f48895f27c3c85", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/cf0cffed3f19485767e3b26e24f48895f27c3c85", "committedDate": "2020-12-17T00:30:16Z", "message": "REPLACE STATE ROOTS\n\nThis happened because the random seed created different payloads\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c500aea89ce3d390312885961932a460c2b39da", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/1c500aea89ce3d390312885961932a460c2b39da", "committedDate": "2020-12-17T15:55:38Z", "message": "don't generate gas price for EIP-1559 transaction\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df5244b5be22383d928acb21ef16ff877a13d3e6", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/df5244b5be22383d928acb21ef16ff877a13d3e6", "committedDate": "2020-12-17T16:35:22Z", "message": "fix hardcoded index\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79eed1df7b0b44a4f98e9f642a37e0c95c5fac8f", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/79eed1df7b0b44a4f98e9f642a37e0c95c5fac8f", "committedDate": "2020-12-17T17:26:37Z", "message": "fix brittle test again\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2782623c5c6204904e889fb586373719846c4bfd", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/2782623c5c6204904e889fb586373719846c4bfd", "committedDate": "2020-12-17T17:28:04Z", "message": "remove unnecessary test\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b4cbae079b3d48c4275dae3e3661fa82b5afd20", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/8b4cbae079b3d48c4275dae3e3661fa82b5afd20", "committedDate": "2020-12-17T17:28:51Z", "message": "private\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00f7c7bbdae4f265e01ae158f90873ca1fbc2b6e", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/00f7c7bbdae4f265e01ae158f90873ca1fbc2b6e", "committedDate": "2021-01-04T18:56:12Z", "message": "fix limited message test\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75a8056a7624f1760a98297fa7c536dbd5a98409", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/75a8056a7624f1760a98297fa7c536dbd5a98409", "committedDate": "2021-01-04T18:56:33Z", "message": "transactions generator change\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "248cfe44d6bdf2ea2576b4f34a2ed6dc083f9bb6", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/248cfe44d6bdf2ea2576b4f34a2ed6dc083f9bb6", "committedDate": "2021-01-04T18:56:51Z", "message": "Merge branch 'master' of github.com:hyperledger/besu into transaction-type-test-support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c6ea0960c4a84946321a832917ee042317230dc", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/2c6ea0960c4a84946321a832917ee042317230dc", "committedDate": "2021-01-04T19:04:24Z", "message": "simplify condition\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74467f4eecb06846016989e9dc41c807bc1de40b", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/74467f4eecb06846016989e9dc41c807bc1de40b", "committedDate": "2021-01-04T19:33:27Z", "message": "unhardcode limits\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMzA2NTc3", "url": "https://github.com/hyperledger/besu/pull/1726#pullrequestreview-561306577", "createdAt": "2021-01-04T20:03:54Z", "commit": {"oid": "74467f4eecb06846016989e9dc41c807bc1de40b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMDowMzo1NVrOIN_Pcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMDowMzo1NVrOIN_Pcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUzODU0Nw==", "bodyText": "@lucassaldanha this test broke because I changed the BlockDataGenerator. I think it's safe to change the state roots here but I don't think the test should rely on hardcoded state roots anyways. Is there a way to determine at test time what the correct state roots should be?", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r551538547", "createdAt": "2021-01-04T20:03:55Z", "author": {"login": "RatanRSur"}, "path": "besu/src/test/java/org/hyperledger/besu/PrivacyReorgTest.java", "diffHunk": "@@ -92,9 +93,9 @@\n       Bytes.fromBase64String(\"A1aVtMxLCUHmBVHXoZzzBgPbW/wj5axDpW9X8l91SGo=\");\n \n   private static final String FIRST_BLOCK_WITH_NO_TRANSACTIONS_STATE_ROOT =\n-      \"0x1bdf13f6d14c7322d6e695498aab258949e55574bef7eac366eb777f43d7dd2b\";\n+      \"0xc9dcaffbebc7edc20839c80e706430a8fa885e8f703bb89f6e95633cc2b05d4d\";\n   private static final String FIRST_BLOCK_WITH_SINGLE_TRANSACTION_STATE_ROOT =\n-      \"0x16979b290f429e06d86a43584c7d8689d4292ade9a602e5c78e2867c6ebd904e\";\n+      \"0x66fbc6ad12ef1da78740093ea2b3362e773e510e27d8f88b68c27bfc1f4d58c8\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74467f4eecb06846016989e9dc41c807bc1de40b"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b279692c9a0247b1300124c7f62b8be10696c555", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/b279692c9a0247b1300124c7f62b8be10696c555", "committedDate": "2021-01-05T15:23:24Z", "message": "Merge branch 'master' of github.com:hyperledger/besu into transaction-type-test-support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b88d32d461b1367aa21a4e025aed33d7445302b", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/1b88d32d461b1367aa21a4e025aed33d7445302b", "committedDate": "2021-01-05T18:54:02Z", "message": "transaction receipt generation with types\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaf0d87fd222db9eb52b3b88159ce41c74d27cee", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/aaf0d87fd222db9eb52b3b88159ce41c74d27cee", "committedDate": "2021-01-05T19:06:54Z", "message": "fix receipt en/decoding\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1ceab797209398c34c184c0633dba7b4bb93531", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/a1ceab797209398c34c184c0633dba7b4bb93531", "committedDate": "2021-01-05T19:16:24Z", "message": "Objects.equals\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyMDY3ODU5", "url": "https://github.com/hyperledger/besu/pull/1726#pullrequestreview-562067859", "createdAt": "2021-01-05T19:25:39Z", "commit": {"oid": "a1ceab797209398c34c184c0633dba7b4bb93531"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxOToyNTozOVrOIOkNkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxOToyNTozOVrOIOkNkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE0NDI3Mw==", "bodyText": "We previously tested only FRONTIER receipts so roundtripping issues that were exposed are fixed here.", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r552144273", "createdAt": "2021-01-05T19:25:39Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/TransactionReceipt.java", "diffHunk": "@@ -171,26 +173,37 @@ public void writeToWithRevertReason(final RLPOutput out) {\n     writeTo(out, true);\n   }\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1ceab797209398c34c184c0633dba7b4bb93531"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a146290174354466232c0823bd738b6393f7630", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/6a146290174354466232c0823bd738b6393f7630", "committedDate": "2021-01-13T16:26:18Z", "message": "Merge branch 'master' of https://github.com/hyperledger/besu into transaction-type-test-support"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MjU5ODk0", "url": "https://github.com/hyperledger/besu/pull/1726#pullrequestreview-568259894", "createdAt": "2021-01-14T14:02:45Z", "commit": {"oid": "6a146290174354466232c0823bd738b6393f7630"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDowMjo0NVrOITl-rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDowMjo0NVrOITl-rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQxNjExMQ==", "bodyText": "We don't fail at deseriailization anymore. We always deserialize and reject in transaction validation based on what fork we're on", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r557416111", "createdAt": "2021-01-14T14:02:45Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/core/encoding/TransactionRLPEncoderTest.java", "diffHunk": "@@ -66,17 +65,4 @@ public void encodeEIP1559TxNominalCase() {\n         .isEqualTo(output.encoded().toHexString());\n     ExperimentalEIPs.eip1559Enabled = ExperimentalEIPs.EIP1559_ENABLED_DEFAULT_VALUE;\n   }\n-\n-  @Test\n-  public void encodeEIP1559TxFailureNotEnabled() {\n-    ExperimentalEIPs.eip1559Enabled = false;\n-    assertThatThrownBy(\n-            () ->\n-                TransactionRLPEncoder.encode(\n-                    TransactionRLPDecoder.decode(RLP.input(Bytes.fromHexString(EIP1559_TX_RLP))),\n-                    new BytesValueRLPOutput()))\n-        .isInstanceOf(RuntimeException.class)\n-        .hasMessageContaining(\"EIP-1559 feature flag\");\n-    ExperimentalEIPs.eip1559Enabled = ExperimentalEIPs.EIP1559_ENABLED_DEFAULT_VALUE;\n-  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a146290174354466232c0823bd738b6393f7630"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY4MjYzOTgy", "url": "https://github.com/hyperledger/besu/pull/1726#pullrequestreview-568263982", "createdAt": "2021-01-14T14:07:12Z", "commit": {"oid": "6a146290174354466232c0823bd738b6393f7630"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDowNzoxM1rOITmKCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDowODozMVrOITmN4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQxOTAxOA==", "bodyText": "I think actually this is not a bad thing to rely on hardcoded state roots on tests. Because when you change something it breaks, and this is good. If you use your code to generate the assertion there is a risk of working only in close loop.", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r557419018", "createdAt": "2021-01-14T14:07:13Z", "author": {"login": "abdelhamidbakhta"}, "path": "besu/src/test/java/org/hyperledger/besu/PrivacyReorgTest.java", "diffHunk": "@@ -92,9 +93,9 @@\n       Bytes.fromBase64String(\"A1aVtMxLCUHmBVHXoZzzBgPbW/wj5axDpW9X8l91SGo=\");\n \n   private static final String FIRST_BLOCK_WITH_NO_TRANSACTIONS_STATE_ROOT =\n-      \"0x1bdf13f6d14c7322d6e695498aab258949e55574bef7eac366eb777f43d7dd2b\";\n+      \"0xc9dcaffbebc7edc20839c80e706430a8fa885e8f703bb89f6e95633cc2b05d4d\";\n   private static final String FIRST_BLOCK_WITH_SINGLE_TRANSACTION_STATE_ROOT =\n-      \"0x16979b290f429e06d86a43584c7d8689d4292ade9a602e5c78e2867c6ebd904e\";\n+      \"0x66fbc6ad12ef1da78740093ea2b3362e773e510e27d8f88b68c27bfc1f4d58c8\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUzODU0Nw=="}, "originalCommit": {"oid": "74467f4eecb06846016989e9dc41c807bc1de40b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQxOTY4Mg==", "bodyText": "Why this change is necessary ?", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r557419682", "createdAt": "2021-01-14T14:08:06Z", "author": {"login": "abdelhamidbakhta"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/Wei.java", "diffHunk": "@@ -18,7 +18,7 @@\n \n import java.math.BigInteger;\n \n-import org.apache.tuweni.bytes.Bytes32;\n+import org.apache.tuweni.bytes.Bytes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a146290174354466232c0823bd738b6393f7630"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQyMDAwMw==", "bodyText": "Why do you remove that ?", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r557420003", "createdAt": "2021-01-14T14:08:31Z", "author": {"login": "abdelhamidbakhta"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/encoding/TransactionRLPEncoder.java", "diffHunk": "@@ -77,8 +76,6 @@ static void encodeFrontier(final Transaction transaction, final RLPOutput out) {\n   }\n \n   static void encodeEIP1559(final Transaction transaction, final RLPOutput out) {\n-    ExperimentalEIPs.eip1559MustBeEnabled();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a146290174354466232c0823bd738b6393f7630"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73522c31c477573229ef0d25fe929478a43dbd34", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/73522c31c477573229ef0d25fe929478a43dbd34", "committedDate": "2021-01-14T19:27:02Z", "message": "Merge branch 'master' into transaction-type-test-support"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2012, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}