{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMzU4NzEz", "number": 1671, "title": "Catch bad IBFT2 round change msgs", "bodyText": "When validating a RoundChange message, its important that not only\nare there sufficient Prepare msgs in the PreparedCertificate, but\nalso that each are from a different validator (i.e. cannot simply\ncount the number msgs, but must count distinct authors).\nSigned-off-by: Trent Mohay trent.mohay@consensys.net", "createdAt": "2020-12-07T04:20:26Z", "url": "https://github.com/hyperledger/besu/pull/1671", "merged": true, "mergeCommit": {"oid": "2544dfd3e80a0410fd9a1a82d3af844d9dedf05e"}, "closed": true, "closedAt": "2021-01-05T01:43:22Z", "author": {"login": "rain-on"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdjtrSwAH2gAyNTMzMzU4NzEzOjljMmM4ZGQ3OTkzYjc4YWQ3NWVkOWFmNTdlY2Y5YWQ3ODg2MjMzN2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtAqNiAH2gAyNTMzMzU4NzEzOmJhMTE2NGJjMGUxZDBhOGVjZTE0NzU2OWM4ZWI4ZDRkN2EzOGMzMzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9c2c8dd7993b78ad75ed9af57ecf9ad78862337c", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/9c2c8dd7993b78ad75ed9af57ecf9ad78862337c", "committedDate": "2020-12-07T04:17:36Z", "message": "Catch bad IBFT2 round change msgs\n\nWhen validating a RoundChange message, its important that not only\nare there sufficient Prepare msgs in the PreparedCertificate, but\nalso that each are from a different validator (i.e. cannot simply\ncount the number msgs, but must count distinct authors).\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1ODIzMjQ1", "url": "https://github.com/hyperledger/besu/pull/1671#pullrequestreview-545823245", "createdAt": "2020-12-07T04:28:40Z", "commit": {"oid": "9c2c8dd7993b78ad75ed9af57ecf9ad78862337c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwNDoyODo0MFrOIAVfYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QwNDoyODo0MFrOIAVfYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIyMzAxMA==", "bodyText": "Do all the prepare authors also need to be unique? Or is it enough the we have minimumPrepareMessages. I guess I'm wondering if need a hasDuplicateAuthors check like in the RoundChangeCertificateValidator.", "url": "https://github.com/hyperledger/besu/pull/1671#discussion_r537223010", "createdAt": "2020-12-07T04:28:40Z", "author": {"login": "jframe"}, "path": "consensus/ibft/src/main/java/org/hyperledger/besu/consensus/ibft/validation/RoundChangePayloadValidator.java", "diffHunk": "@@ -96,10 +96,11 @@ private boolean validateConsistencyOfPrepareCertificateMessages(\n       return false;\n     }\n \n-    if (certificate.getPreparePayloads().size() < minimumPrepareMessages) {\n+    if (certificate.getPreparePayloads().stream().map(SignedData::getAuthor).distinct().count()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c2c8dd7993b78ad75ed9af57ecf9ad78862337c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "489d5139763ba7621e843c0c44a904d56aaf0cfc", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/489d5139763ba7621e843c0c44a904d56aaf0cfc", "committedDate": "2020-12-07T23:25:19Z", "message": "updated post review\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "807fc716ef8eecff8faf67d1ffe2ebd0e8022785", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/807fc716ef8eecff8faf67d1ffe2ebd0e8022785", "committedDate": "2020-12-07T23:26:50Z", "message": "Merge remote-tracking branch 'upstream/master' into ibft2_fix\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNDM5ODQ4", "url": "https://github.com/hyperledger/besu/pull/1671#pullrequestreview-561439848", "createdAt": "2021-01-05T00:27:11Z", "commit": {"oid": "807fc716ef8eecff8faf67d1ffe2ebd0e8022785"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwMDoyNzoxMVrOIOF7BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwMDoyNzoxMVrOIOF7BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTY0ODAwNQ==", "bodyText": "can return early with true if preparePayloads list is empty?", "url": "https://github.com/hyperledger/besu/pull/1671#discussion_r551648005", "createdAt": "2021-01-05T00:27:11Z", "author": {"login": "usmansaleem"}, "path": "consensus/ibft/src/main/java/org/hyperledger/besu/consensus/ibft/validation/RoundChangePayloadValidator.java", "diffHunk": "@@ -113,6 +117,18 @@ private boolean validateConsistencyOfPrepareCertificateMessages(\n     return true;\n   }\n \n+  private boolean hasDuplicateAuthors(\n+      final Collection<SignedData<PreparePayload>> preparePayloads) {\n+    final long distinctAuthorCount =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "807fc716ef8eecff8faf67d1ffe2ebd0e8022785"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNDQwNDYx", "url": "https://github.com/hyperledger/besu/pull/1671#pullrequestreview-561440461", "createdAt": "2021-01-05T00:29:12Z", "commit": {"oid": "807fc716ef8eecff8faf67d1ffe2ebd0e8022785"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b08742dccde65c5b6c7da7a1fb1589111e571299", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/b08742dccde65c5b6c7da7a1fb1589111e571299", "committedDate": "2021-01-05T00:34:23Z", "message": "Merge remote-tracking branch 'upstream/master' into ibft2_fix\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01f0237252b0bbcf01177329c160c2fe932f30cd", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/01f0237252b0bbcf01177329c160c2fe932f30cd", "committedDate": "2021-01-05T00:37:43Z", "message": "move duplicate author check after size\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNDUwNzU3", "url": "https://github.com/hyperledger/besu/pull/1671#pullrequestreview-561450757", "createdAt": "2021-01-05T01:02:20Z", "commit": {"oid": "01f0237252b0bbcf01177329c160c2fe932f30cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba1164bc0e1d0a8ece147569c8eb8d4d7a38c336", "author": {"user": {"login": "rain-on", "name": "Trent Mohay"}}, "url": "https://github.com/hyperledger/besu/commit/ba1164bc0e1d0a8ece147569c8eb8d4d7a38c336", "committedDate": "2021-01-05T01:29:56Z", "message": "Merge branch 'master' into ibft2_fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1954, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}