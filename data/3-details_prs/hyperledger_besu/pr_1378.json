{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1MjA1MDIw", "number": 1378, "title": "Add debug_getBadBlocks method", "bodyText": "Signed-off-by: Karim TAAM karim.t2am@gmail.com\nPR description\nRequest\n{\"jsonrpc\":\"2.0\",\"method\":\"debug_getBadBlocks\",\"params\":[],\"id\":1}\nResponse\n{\n    \"jsonrpc\": \"2.0\",\n    \"id\": 1,\n    \"result\": [\n        {\n            \"block\": {\n                \"number\": \"0xd\",\n                \"hash\": \"0x85c2edc1ca74b4863cab46ff6ed4df514a698aa7c29a9bce58742a33af07d7e6\",\n                \"mixHash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n                \"parentHash\": \"0x544a2f7a4c8defc0d8da44aa0c0db7c36b56db2605c01ed266e919e936579d31\",\n                \"nonce\": \"0x0000000000000000\",\n                \"sha3Uncles\": \"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\",\n                \"logsBloom\": \"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\n                \"transactionsRoot\": \"0x02c387e001cbe2a8296bfa2e18afbc3480d0e49588b05556148b0bf7c17dec41\",\n                \"stateRoot\": \"0x861ab7e868e3c23f84b7c4ed86b52a6a4f063633bc45ef29212c33459df84ea5\",\n                \"receiptsRoot\": \"0xccd2d33763dc0ac3fe02d4ecbbcd7d2bdc6f57db635ba31007184679303721d7\",\n                \"miner\": \"0x0000000000000000000000000000000000000000\",\n                \"difficulty\": \"0x1\",\n                \"totalDifficulty\": \"0x1\",\n                \"extraData\": \"0x00000000000000000000000000000000000000000000000000000000000000008c6a091f07e4ba3930f2f5fabbfc5b1c70986319096760ba200a6abc0d30e33c2d501702d1b58d7f75807bdbf981044557628611319121170b96466ec06bb3fd01\",\n                \"size\": \"0x3a0\",\n                \"gasLimit\": \"0xffffffffffff\",\n                \"gasUsed\": \"0x1a488\",\n                \"timestamp\": \"0x5f5b6824\",\n                \"uncles\": [],\n                \"transactions\": [\n                    {\n                        \"blockHash\": \"0x85c2edc1ca74b4863cab46ff6ed4df514a698aa7c29a9bce58742a33af07d7e6\",\n                        \"blockNumber\": \"0xd\",\n                        \"from\": \"0xfe3b557e8fb62b89f4916b721be55ceb828dbd73\",\n                        \"gas\": \"0x1a49e\",\n                        \"gasPrice\": \"0x3e8\",\n                        \"hash\": \"0xdd8cf045113754c306ba9ac8ac8786235e33bc5c087678084ef260a2a583f127\",\n                        \"input\": \"0x608060405234801561001057600080fd5b5060c78061001f6000396000f3fe6080604052348015600f57600080fd5b506004361060325760003560e01c80636057361d146037578063b05784b8146062575b600080fd5b606060048036036020811015604b57600080fd5b8101908080359060200190929190505050607e565b005b60686088565b6040518082815260200191505060405180910390f35b8060008190555050565b6000805490509056fea26469706673582212208dea039245bf78c381278382d7056eef5083f7d243d8958817ef447e0a403bd064736f6c63430006060033\",\n                        \"nonce\": \"0x0\",\n                        \"to\": null,\n                        \"transactionIndex\": \"0x0\",\n                        \"value\": \"0x0\",\n                        \"v\": \"0xf9d\",\n                        \"r\": \"0xa7a15050302ca4b7d3842d35cdd3cbf25b2c48c0c37f96d78beb6a6a6bc4f1c7\",\n                        \"s\": \"0x130d29294b2b6a2b7e89f501eb27772f7abf37bfa28a1ce300daade975589fca\"\n                    }\n                ]\n            },\n            \"hash\": \"0x85c2edc1ca74b4863cab46ff6ed4df514a698aa7c29a9bce58742a33af07d7e6\",\n            \"rlp\": \"0xf9039df9025ca0544a2f7a4c8defc0d8da44aa0c0db7c36b56db2605c01ed266e919e936579d31a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347940000000000000000000000000000000000000000a0861ab7e868e3c23f84b7c4ed86b52a6a4f063633bc45ef29212c33459df84ea5a002c387e001cbe2a8296bfa2e18afbc3480d0e49588b05556148b0bf7c17dec41a0ccd2d33763dc0ac3fe02d4ecbbcd7d2bdc6f57db635ba31007184679303721d7b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010d86ffffffffffff8301a488845f5b6824b86100000000000000000000000000000000000000000000000000000000000000008c6a091f07e4ba3930f2f5fabbfc5b1c70986319096760ba200a6abc0d30e33c2d501702d1b58d7f75807bdbf981044557628611319121170b96466ec06bb3fd01a00000000000000000000000000000000000000000000000000000000000000000880000000000000000f9013af90137808203e88301a49e8080b8e6608060405234801561001057600080fd5b5060c78061001f6000396000f3fe6080604052348015600f57600080fd5b506004361060325760003560e01c80636057361d146037578063b05784b8146062575b600080fd5b606060048036036020811015604b57600080fd5b8101908080359060200190929190505050607e565b005b60686088565b6040518082815260200191505060405180910390f35b8060008190555050565b6000805490509056fea26469706673582212208dea039245bf78c381278382d7056eef5083f7d243d8958817ef447e0a403bd064736f6c63430006060033820f9da0a7a15050302ca4b7d3842d35cdd3cbf25b2c48c0c37f96d78beb6a6a6bc4f1c7a0130d29294b2b6a2b7e89f501eb27772f7abf37bfa28a1ce300daade975589fcac0\"\n        },\n        {\n            \"block\": {\n                \"number\": \"0x8\",\n                \"hash\": \"0x601a3ae9b6eceb2476d249e1cffe058ba3ff2c9c1b28b1ec7a0259fdd1d90121\",\n                \"mixHash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\n                \"parentHash\": \"0x98ae440cd7b904d842daa6c263608969a3c8ce6a9acd6bd1f99b394f5f28a207\",\n                \"nonce\": \"0x0000000000000000\",\n                \"sha3Uncles\": \"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\",\n                \"logsBloom\": \"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\n                \"transactionsRoot\": \"0x8ee998cc699a1f9310a1079458780b3ebee8756f96a0905f5224b89d0eb17486\",\n                \"stateRoot\": \"0x140a9783291704223eb759e3a0db5471a520d349fc17ac2f77ff8582472e3bac\",\n                \"receiptsRoot\": \"0x2b5c77f6e7764d2468178fab7253346b9b8bb6a34b63946f6bdc2f5ad398bfc3\",\n                \"miner\": \"0x0000000000000000000000000000000000000000\",\n                \"difficulty\": \"0x2\",\n                \"totalDifficulty\": \"0x2\",\n                \"extraData\": \"0x00000000000000000000000000000000000000000000000000000000000000004d04551bdd9ae08af1fd661e49d4ab662c98c532c7ec0e4656a27e4de7d330af578ab1e4f5e49e085ff1d78673c7388ed9ccf017fbe89e53066bfa4018142c0701\",\n                \"size\": \"0x3a0\",\n                \"gasLimit\": \"0xffffffffffff\",\n                \"gasUsed\": \"0x1a4c9\",\n                \"timestamp\": \"0x5f5b6b80\",\n                \"uncles\": [],\n                \"transactions\": [\n                    {\n                        \"blockHash\": \"0x601a3ae9b6eceb2476d249e1cffe058ba3ff2c9c1b28b1ec7a0259fdd1d90121\",\n                        \"blockNumber\": \"0x8\",\n                        \"from\": \"0xfe3b557e8fb62b89f4916b721be55ceb828dbd73\",\n                        \"gas\": \"0x1a4c9\",\n                        \"gasPrice\": \"0x3e8\",\n                        \"hash\": \"0x675e336a4281b29c619dfd4ccfbd2f930f3728b20caf9e0067284aa3224e6758\",\n                        \"input\": \"0x608060405234801561001057600080fd5b5060c78061001f6000396000f3fe6080604052348015600f57600080fd5b506004361060325760003560e01c80636057361d146037578063b05784b8146062575b600080fd5b606060048036036020811015604b57600080fd5b8101908080359060200190929190505050607e565b005b60686088565b6040518082815260200191505060405180910390f35b8060008190555050565b6000805490509056fea26469706673582212208dea039245bf78c381278382d7056eef5083f7d243d8958817ef447e0a403bd064736f6c63430006060033\",\n                        \"nonce\": \"0x0\",\n                        \"to\": null,\n                        \"transactionIndex\": \"0x0\",\n                        \"value\": \"0x0\",\n                        \"v\": \"0xf9d\",\n                        \"r\": \"0x2e30624c0305e64812e1d9e325ba6e50410314634b008edcb50f45be71fa0d4\",\n                        \"s\": \"0x50e205faed23c219ba15610de2451d458cbd4221207b2168344cfc972a7973c0\"\n                    }\n                ]\n            },\n            \"hash\": \"0x601a3ae9b6eceb2476d249e1cffe058ba3ff2c9c1b28b1ec7a0259fdd1d90121\",\n            \"rlp\": \"0xf9039df9025ca098ae440cd7b904d842daa6c263608969a3c8ce6a9acd6bd1f99b394f5f28a207a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347940000000000000000000000000000000000000000a0140a9783291704223eb759e3a0db5471a520d349fc17ac2f77ff8582472e3baca08ee998cc699a1f9310a1079458780b3ebee8756f96a0905f5224b89d0eb17486a02b5c77f6e7764d2468178fab7253346b9b8bb6a34b63946f6bdc2f5ad398bfc3b9010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020886ffffffffffff8301a4c9845f5b6b80b86100000000000000000000000000000000000000000000000000000000000000004d04551bdd9ae08af1fd661e49d4ab662c98c532c7ec0e4656a27e4de7d330af578ab1e4f5e49e085ff1d78673c7388ed9ccf017fbe89e53066bfa4018142c0701a00000000000000000000000000000000000000000000000000000000000000000880000000000000000f9013af90137808203e88301a4c98080b8e6608060405234801561001057600080fd5b5060c78061001f6000396000f3fe6080604052348015600f57600080fd5b506004361060325760003560e01c80636057361d146037578063b05784b8146062575b600080fd5b606060048036036020811015604b57600080fd5b8101908080359060200190929190505050607e565b005b60686088565b6040518082815260200191505060405180910390f35b8060008190555050565b6000805490509056fea26469706673582212208dea039245bf78c381278382d7056eef5083f7d243d8958817ef447e0a403bd064736f6c63430006060033820f9da002e30624c0305e64812e1d9e325ba6e50410314634b008edcb50f45be71fa0d4a050e205faed23c219ba15610de2451d458cbd4221207b2168344cfc972a7973c0c0\"\n        }\n    ]\n}\nTest Performed on a local testnet :\n\nFULL sync with a consensus issue\nFAST sync with a consensus issue\nPeer send a new block with a consensus issue\nReorg with a second consensus issue\nInvalid header or body, evm errors\n\nChangelog\n\n I thought about the changelog and included a changelog update if required.", "createdAt": "2020-09-11T15:43:31Z", "url": "https://github.com/hyperledger/besu/pull/1378", "merged": true, "mergeCommit": {"oid": "be89cd93f79440b816e88b9a27898eed63960fdb"}, "closed": true, "closedAt": "2020-09-17T09:53:05Z", "author": {"login": "matkt"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH3Lt-gH2gAyNDg1MjA1MDIwOjc0ZjliZjNmOTJhMDI1YzdjOGIxMWMzYWUyMGQ4NmY5OWZiMDk2NWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJtp6uAH2gAyNDg1MjA1MDIwOjdmYWExZjQyOTllMzI2YTZiODgyMTNhMzM3MDdlN2I0NmFlYzFiOGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "74f9bf3f92a025c7c8b11c3ae20d86f99fb0965e", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/74f9bf3f92a025c7c8b11c3ae20d86f99fb0965e", "committedDate": "2020-09-11T15:32:17Z", "message": "init getBadBlocks endpoint\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f1f141a1916ce2f43164c996616669c634f8a6c", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/1f1f141a1916ce2f43164c996616669c634f8a6c", "committedDate": "2020-09-11T15:44:30Z", "message": "Merge branch 'master' into feature/add-debug-get-bad-blocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34e139c918cd536658dd43e4cb4c4d47a3c63e75", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/34e139c918cd536658dd43e4cb4c4d47a3c63e75", "committedDate": "2020-09-11T16:26:22Z", "message": "add missing files\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15ead17e84d2d48b11225d6a0c5ba4d722a4100a", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/15ead17e84d2d48b11225d6a0c5ba4d722a4100a", "committedDate": "2020-09-11T16:26:31Z", "message": "Merge remote-tracking branch 'origin/feature/add-debug-get-bad-blocks' into feature/add-debug-get-bad-blocks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f8e7a8f8dc68bada1e25117fbc02be31e096017", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/2f8e7a8f8dc68bada1e25117fbc02be31e096017", "committedDate": "2020-09-11T16:27:42Z", "message": "Merge remote-tracking branch 'origin/feature/add-debug-get-bad-blocks' into feature/add-debug-get-bad-blocks\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15ead17e84d2d48b11225d6a0c5ba4d722a4100a", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/15ead17e84d2d48b11225d6a0c5ba4d722a4100a", "committedDate": "2020-09-11T16:26:31Z", "message": "Merge remote-tracking branch 'origin/feature/add-debug-get-bad-blocks' into feature/add-debug-get-bad-blocks"}, "afterCommit": {"oid": "2f8e7a8f8dc68bada1e25117fbc02be31e096017", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/2f8e7a8f8dc68bada1e25117fbc02be31e096017", "committedDate": "2020-09-11T16:27:42Z", "message": "Merge remote-tracking branch 'origin/feature/add-debug-get-bad-blocks' into feature/add-debug-get-bad-blocks\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b352d66d257109f1550f0f1f8bfb028c79cda1c0", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/b352d66d257109f1550f0f1f8bfb028c79cda1c0", "committedDate": "2020-09-14T09:06:56Z", "message": "fix javadoc\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77d7e92d006c46975c829c7555f0eb4b0a73c274", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/77d7e92d006c46975c829c7555f0eb4b0a73c274", "committedDate": "2020-09-14T09:35:20Z", "message": "fix pipeline\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e03d868da8d770002961e744a5a61b1f7c4e7c4", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/0e03d868da8d770002961e744a5a61b1f7c4e7c4", "committedDate": "2020-09-14T09:57:06Z", "message": "update CHANGELOG.md\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5OTQ3MTcy", "url": "https://github.com/hyperledger/besu/pull/1378#pullrequestreview-489947172", "createdAt": "2020-09-16T19:14:35Z", "commit": {"oid": "0e03d868da8d770002961e744a5a61b1f7c4e7c4"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxOToxNDozNlrOHTAasQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxOToyNDoyMFrOHTBBww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5MTgyNQ==", "bodyText": "Maybe .stream().map(...).collect(Collectors.toList) instead of adding to a mutable collection?", "url": "https://github.com/hyperledger/besu/pull/1378#discussion_r489691825", "createdAt": "2020-09-16T19:14:36Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/DebugGetBadBlocks.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.RpcMethod;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequestContext;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcSuccessResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.BadBlockResult;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.BlockResultFactory;\n+import org.hyperledger.besu.ethereum.api.query.BlockchainQueries;\n+import org.hyperledger.besu.ethereum.chain.BadBlockManager;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSchedule;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class DebugGetBadBlocks implements JsonRpcMethod {\n+\n+  private final BlockchainQueries blockchain;\n+  private final ProtocolSchedule protocolSchedule;\n+  private final BlockResultFactory blockResultFactory;\n+\n+  public DebugGetBadBlocks(\n+      final BlockchainQueries blockchain,\n+      final ProtocolSchedule protocolSchedule,\n+      final BlockResultFactory blockResultFactory) {\n+    this.blockchain = blockchain;\n+    this.protocolSchedule = protocolSchedule;\n+    this.blockResultFactory = blockResultFactory;\n+  }\n+\n+  @Override\n+  public String getName() {\n+    return RpcMethod.DEBUG_GET_BAD_BLOCKS.getMethodName();\n+  }\n+\n+  @Override\n+  public JsonRpcResponse response(final JsonRpcRequestContext requestContext) {\n+    final List<BadBlockResult> response = new ArrayList<>();\n+    final BadBlockManager badBlockManager =\n+        protocolSchedule.getByBlockNumber(blockchain.headBlockNumber()).getBadBlocksManager();\n+    badBlockManager", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e03d868da8d770002961e744a5a61b1f7c4e7c4"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5MjYwNQ==", "bodyText": "What was your take on the Immutable Framework?  Did you like it/not like it?  This is another opportunity here.", "url": "https://github.com/hyperledger/besu/pull/1378#discussion_r489692605", "createdAt": "2020-09-16T19:15:17Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/results/BadBlockResult.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.results;\n+\n+import org.hyperledger.besu.ethereum.core.Hash;\n+\n+import com.fasterxml.jackson.annotation.JsonGetter;\n+import com.fasterxml.jackson.annotation.JsonPropertyOrder;\n+import org.apache.tuweni.bytes.Bytes;\n+\n+@JsonPropertyOrder({\"block\", \"hash\", \"rlp\"})\n+public class BadBlockResult {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e03d868da8d770002961e744a5a61b1f7c4e7c4"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5OTg2NA==", "bodyText": "We want some sort of a limit on the bad blocks we keep around.  Maybe via com.google.common.cache.CacheBuilder?", "url": "https://github.com/hyperledger/besu/pull/1378#discussion_r489699864", "createdAt": "2020-09-16T19:21:57Z", "author": {"login": "shemnon"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/chain/BadBlockManager.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.chain;\n+\n+import org.hyperledger.besu.ethereum.core.Block;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+public class BadBlockManager {\n+\n+  private final Map<Hash, Block> badBlocks = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e03d868da8d770002961e744a5a61b1f7c4e7c4"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTcwMTgyNw==", "bodyText": "Add some comments explaining that even though the header is known bad we are downloading the block body for the debug_badBlocks RPC.", "url": "https://github.com/hyperledger/besu/pull/1378#discussion_r489701827", "createdAt": "2020-09-16T19:24:20Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/tasks/DownloadHeaderSequenceTask.java", "diffHunk": "@@ -195,16 +199,40 @@ public static DownloadHeaderSequenceTask endingAtHeader(\n               child =\n                   (headerIndex == segmentLength - 1) ? referenceHeader : headers[headerIndex + 1];\n             }\n+            final ProtocolSpec protocolSpec = protocolSchedule.getByBlockNumber(child.getNumber());\n+            final BadBlockManager badBlockManager = protocolSpec.getBadBlocksManager();\n \n             if (!validateHeader(child, header)) {\n               // Invalid headers - disconnect from peer\n-              LOG.debug(\n-                  \"Received invalid headers from peer, disconnecting from: {}\",\n-                  headersResult.getPeer());\n-              headersResult.getPeer().disconnect(DisconnectReason.BREACH_OF_PROTOCOL);\n-              future.completeExceptionally(\n-                  new InvalidBlockException(\n-                      \"Header failed validation.\", child.getNumber(), child.getHash()));\n+\n+              final BlockHeader invalidBlock = child;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e03d868da8d770002961e744a5a61b1f7c4e7c4"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "936ad0b7b62f6e22fa7268355b9932089a1a1d21", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/936ad0b7b62f6e22fa7268355b9932089a1a1d21", "committedDate": "2020-09-16T21:00:33Z", "message": "fix review issues\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7faa1f4299e326a6b88213a33707e7b46aec1b8f", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/7faa1f4299e326a6b88213a33707e7b46aec1b8f", "committedDate": "2020-09-17T09:34:04Z", "message": "Merge commit 'master' into feature/add-debug-get-bad-blocks\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1482, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}