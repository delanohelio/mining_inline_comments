{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NTk4ODMx", "number": 1554, "title": "Added zero gasPrice validation for Quorum compatibility mode.", "bodyText": "Signed-off-by: Mark Terry mark.terry@consensys.net\n\n\nPR description\nUpdates transaction validation to enforce zero gasPrice when isQuorum genesis config is set.\nFixed Issue(s)\n\n\nFixes #1551\nChangelog\n\n I thought about the changelog and included a changelog update if required.", "createdAt": "2020-11-12T03:44:00Z", "url": "https://github.com/hyperledger/besu/pull/1554", "merged": true, "mergeCommit": {"oid": "e783dd7294fcafdbfd0a135e275b8b27ff559df1"}, "closed": true, "closedAt": "2020-11-16T03:25:05Z", "author": {"login": "mark-terry"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdb7kYwAFqTUyOTU3NTkxMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdc7xRgAH2gAyNTE5NTk4ODMxOmZkNzYwZGZhNjIyOTVmYWUxMWJlNmUwOGNiZTFkNTBlMmIzOGE5NTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NTc1OTEx", "url": "https://github.com/hyperledger/besu/pull/1554#pullrequestreview-529575911", "createdAt": "2020-11-12T23:11:41Z", "commit": {"oid": "836ce5f75cebd5a34ca2d63d13717690276b418e"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMzoxMTo0MVrOHySfoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMzo0MTo0MVrOHyTXDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ5Mzg1Ng==", "bodyText": "s/Compat/Compatible", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522493856", "createdAt": "2020-11-12T23:11:41Z", "author": {"login": "macfarla"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1406,6 +1406,7 @@ private void issueOptionWarnings() {\n \n   private BesuCommand configure() throws Exception {\n     checkPortClash();\n+    checkQuorumCompatConfig();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836ce5f75cebd5a34ca2d63d13717690276b418e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUwNzIxMw==", "bodyText": "Quorum typo", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522507213", "createdAt": "2020-11-12T23:39:16Z", "author": {"login": "macfarla"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidator.java", "diffHunk": "@@ -94,6 +99,12 @@ public MainnetTransactionValidator(\n       return signatureResult;\n     }\n \n+    if (quorumCompatibilityMode && !transaction.getGasPrice().isZero()) {\n+      return ValidationResult.invalid(\n+          TransactionInvalidReason.GAS_PRICE_MUST_BE_ZERO,\n+          \"gasPrice must be set to zero on a Quroum compatible network\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836ce5f75cebd5a34ca2d63d13717690276b418e"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUwODA0Ng==", "bodyText": "here we're calling it Quorum interop. TransactionValidator has \"Quorum compatible\". I don't have strong feelings but should be consistent.", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522508046", "createdAt": "2020-11-12T23:41:41Z", "author": {"login": "macfarla"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3789,4 +3791,29 @@ public void assertThatAllPortsSpecifiedSucceeds() {\n         \"--miner-stratum-port=15\");\n     assertThat(commandErrorOutput.toString()).isEmpty();\n   }\n+\n+  @Test\n+  public void quorumInteropEnabledFailsWithoutGasPriceSet() throws IOException {\n+    final Path genesisFile = createFakeGenesisFile(GENESIS_QUORUM_INTEROP_ENABLED);\n+    parseCommand(\"--genesis-file\", genesisFile.toString());\n+    assertThat(commandErrorOutput.toString())\n+        .contains(\n+            \"--min-gas-price must be set to zero if Quorum interop is enabled in the genesis config.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836ce5f75cebd5a34ca2d63d13717690276b418e"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bafafaf28a23fa4ea57b117198ee8b6d4ec780c", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/4bafafaf28a23fa4ea57b117198ee8b6d4ec780c", "committedDate": "2020-11-15T13:37:25Z", "message": "Added zero gasPrice validation for Quorum compatibility mode.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5eaf1e9512b8595a60b1722767770d9a0abdb50f", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/5eaf1e9512b8595a60b1722767770d9a0abdb50f", "committedDate": "2020-11-15T13:39:21Z", "message": "Added Quorum interop genesis/config check.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b897ead4f5440a566c2b4e285ec38a95d1fba133", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/b897ead4f5440a566c2b4e285ec38a95d1fba133", "committedDate": "2020-11-15T13:39:21Z", "message": "Test name fix.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fce3e5ab50eb1a2a2a4220a922f87d2525dc716a", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/fce3e5ab50eb1a2a2a4220a922f87d2525dc716a", "committedDate": "2020-11-15T13:39:54Z", "message": "PR fixes - renames.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1ed77f1bd24b1c5911047f00873b4e317821a22", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/c1ed77f1bd24b1c5911047f00873b4e317821a22", "committedDate": "2020-11-15T13:39:54Z", "message": "PR fixes - RPC response improvement + tests.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da972ef63418bb1468a00f10fddb1cee61f96579", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/da972ef63418bb1468a00f10fddb1cee61f96579", "committedDate": "2020-11-15T13:32:05Z", "message": "PR fixes - RPC response improvement + tests.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}, "afterCommit": {"oid": "c1ed77f1bd24b1c5911047f00873b4e317821a22", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/c1ed77f1bd24b1c5911047f00873b4e317821a22", "committedDate": "2020-11-15T13:39:54Z", "message": "PR fixes - RPC response improvement + tests.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1e399d4f7d78fc935507f82bca5ac147e6f462c", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/b1e399d4f7d78fc935507f82bca5ac147e6f462c", "committedDate": "2020-11-15T13:50:51Z", "message": "Merge fix.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODUwMjUy", "url": "https://github.com/hyperledger/besu/pull/1554#pullrequestreview-530850252", "createdAt": "2020-11-15T23:49:59Z", "commit": {"oid": "b1e399d4f7d78fc935507f82bca5ac147e6f462c"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzo0OTo1OVrOHzkPoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzo1MToxMVrOHzkQJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzI0OQ==", "bodyText": "should this be isGoQuorum()", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833249", "createdAt": "2020-11-15T23:49:59Z", "author": {"login": "macfarla"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/difficulty/fixed/FixedDifficultyProtocolSchedule.java", "diffHunk": "@@ -30,7 +30,8 @@ public static ProtocolSchedule create(\n             config,\n             builder -> builder.difficultyCalculator(FixedDifficultyCalculators.calculator(config)),\n             privacyParameters,\n-            isMetadataEnabled)\n+            isMetadataEnabled,\n+            config.isQuorum())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1e399d4f7d78fc935507f82bca5ac147e6f462c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzI4Ng==", "bodyText": "goQuorumCompatibilityMode", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833286", "createdAt": "2020-11-15T23:50:20Z", "author": {"login": "macfarla"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidator.java", "diffHunk": "@@ -48,18 +48,21 @@\n   private Optional<TransactionFilter> transactionFilter = Optional.empty();\n   private final Optional<EIP1559> maybeEip1559;\n   private final AcceptedTransactionTypes acceptedTransactionTypes;\n+  private final boolean quorumCompatibilityMode;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1e399d4f7d78fc935507f82bca5ac147e6f462c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzM0NQ==", "bodyText": "GoQuorum", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833345", "createdAt": "2020-11-15T23:50:48Z", "author": {"login": "macfarla"}, "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidatorTest.java", "diffHunk": "@@ -60,6 +61,8 @@\n           .chainId(Optional.of(BigInteger.ONE))\n           .createTransaction(senderKeys);\n \n+  private final boolean defaultQuorumCompatibilityMode = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1e399d4f7d78fc935507f82bca5ac147e6f462c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzM4Mg==", "bodyText": "goQuorum", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833382", "createdAt": "2020-11-15T23:51:11Z", "author": {"login": "macfarla"}, "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidatorTest.java", "diffHunk": "@@ -332,6 +355,36 @@ public void shouldAcceptValidEIP1559() {\n     ExperimentalEIPs.eip1559Enabled = false;\n   }\n \n+  @Test\n+  public void quorumCompatibilityModeRejectNonZeroGasPrice() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1e399d4f7d78fc935507f82bca5ac147e6f462c"}, "originalPosition": 195}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd760dfa62295fae11be6e08cbe1d50e2b38a954", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/fd760dfa62295fae11be6e08cbe1d50e2b38a954", "committedDate": "2020-11-16T02:45:20Z", "message": "PR fixes.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2081, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}