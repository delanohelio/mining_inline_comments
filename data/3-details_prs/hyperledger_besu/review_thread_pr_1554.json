{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NTk4ODMx", "number": 1554, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMzoxMTo0MVrOE4ZRdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzo1MToxMVrOE5OcHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3NTY5NzgyOnYy", "diffSide": "RIGHT", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMzoxMTo0MVrOHySfoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMzoxMTo0MVrOHySfoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ5Mzg1Ng==", "bodyText": "s/Compat/Compatible", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522493856", "createdAt": "2020-11-12T23:11:41Z", "author": {"login": "macfarla"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1406,6 +1406,7 @@ private void issueOptionWarnings() {\n \n   private BesuCommand configure() throws Exception {\n     checkPortClash();\n+    checkQuorumCompatConfig();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836ce5f75cebd5a34ca2d63d13717690276b418e"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3NTc4NDUyOnYy", "diffSide": "RIGHT", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMzozOToxNlrOHyTTzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwMToyMTo1OVrOHyV4SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUwNzIxMw==", "bodyText": "Quorum typo", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522507213", "createdAt": "2020-11-12T23:39:16Z", "author": {"login": "macfarla"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidator.java", "diffHunk": "@@ -94,6 +99,12 @@ public MainnetTransactionValidator(\n       return signatureResult;\n     }\n \n+    if (quorumCompatibilityMode && !transaction.getGasPrice().isZero()) {\n+      return ValidationResult.invalid(\n+          TransactionInvalidReason.GAS_PRICE_MUST_BE_ZERO,\n+          \"gasPrice must be set to zero on a Quroum compatible network\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836ce5f75cebd5a34ca2d63d13717690276b418e"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU0OTMyMA==", "bodyText": "It's needs to be GoQuorum as well (I feel your pain on misspelling Quorum however - Nico has caught a bunch of those typos from me in the GoQuorum docs) -> Quorum now includes Hyperledger Besu.", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522549320", "createdAt": "2020-11-13T01:21:59Z", "author": {"login": "MadelineMurray"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidator.java", "diffHunk": "@@ -94,6 +99,12 @@ public MainnetTransactionValidator(\n       return signatureResult;\n     }\n \n+    if (quorumCompatibilityMode && !transaction.getGasPrice().isZero()) {\n+      return ValidationResult.invalid(\n+          TransactionInvalidReason.GAS_PRICE_MUST_BE_ZERO,\n+          \"gasPrice must be set to zero on a Quroum compatible network\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUwNzIxMw=="}, "originalCommit": {"oid": "836ce5f75cebd5a34ca2d63d13717690276b418e"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3NTc5MDM5OnYy", "diffSide": "RIGHT", "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMzo0MTo0MVrOHyTXDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwMToyMjozMlrOHyV5DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUwODA0Ng==", "bodyText": "here we're calling it Quorum interop. TransactionValidator has \"Quorum compatible\". I don't have strong feelings but should be consistent.", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522508046", "createdAt": "2020-11-12T23:41:41Z", "author": {"login": "macfarla"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3789,4 +3791,29 @@ public void assertThatAllPortsSpecifiedSucceeds() {\n         \"--miner-stratum-port=15\");\n     assertThat(commandErrorOutput.toString()).isEmpty();\n   }\n+\n+  @Test\n+  public void quorumInteropEnabledFailsWithoutGasPriceSet() throws IOException {\n+    final Path genesisFile = createFakeGenesisFile(GENESIS_QUORUM_INTEROP_ENABLED);\n+    parseCommand(\"--genesis-file\", genesisFile.toString());\n+    assertThat(commandErrorOutput.toString())\n+        .contains(\n+            \"--min-gas-price must be set to zero if Quorum interop is enabled in the genesis config.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "836ce5f75cebd5a34ca2d63d13717690276b418e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU0OTUxNg==", "bodyText": "No strong feelings either.  If you need a tie break, I'd choose \"GoQuorum compatible\"", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r522549516", "createdAt": "2020-11-13T01:22:32Z", "author": {"login": "MadelineMurray"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3789,4 +3791,29 @@ public void assertThatAllPortsSpecifiedSucceeds() {\n         \"--miner-stratum-port=15\");\n     assertThat(commandErrorOutput.toString()).isEmpty();\n   }\n+\n+  @Test\n+  public void quorumInteropEnabledFailsWithoutGasPriceSet() throws IOException {\n+    final Path genesisFile = createFakeGenesisFile(GENESIS_QUORUM_INTEROP_ENABLED);\n+    parseCommand(\"--genesis-file\", genesisFile.toString());\n+    assertThat(commandErrorOutput.toString())\n+        .contains(\n+            \"--min-gas-price must be set to zero if Quorum interop is enabled in the genesis config.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjUwODA0Ng=="}, "originalCommit": {"oid": "836ce5f75cebd5a34ca2d63d13717690276b418e"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NDQwNzU1OnYy", "diffSide": "RIGHT", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/difficulty/fixed/FixedDifficultyProtocolSchedule.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzo0OTo1OVrOHzkPoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzo0OTo1OVrOHzkPoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzI0OQ==", "bodyText": "should this be isGoQuorum()", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833249", "createdAt": "2020-11-15T23:49:59Z", "author": {"login": "macfarla"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/difficulty/fixed/FixedDifficultyProtocolSchedule.java", "diffHunk": "@@ -30,7 +30,8 @@ public static ProtocolSchedule create(\n             config,\n             builder -> builder.difficultyCalculator(FixedDifficultyCalculators.calculator(config)),\n             privacyParameters,\n-            isMetadataEnabled)\n+            isMetadataEnabled,\n+            config.isQuorum())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1e399d4f7d78fc935507f82bca5ac147e6f462c"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NDQwNzgyOnYy", "diffSide": "RIGHT", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzo1MDoyMFrOHzkPxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzo1MDoyMFrOHzkPxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzI4Ng==", "bodyText": "goQuorumCompatibilityMode", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833286", "createdAt": "2020-11-15T23:50:20Z", "author": {"login": "macfarla"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidator.java", "diffHunk": "@@ -48,18 +48,21 @@\n   private Optional<TransactionFilter> transactionFilter = Optional.empty();\n   private final Optional<EIP1559> maybeEip1559;\n   private final AcceptedTransactionTypes acceptedTransactionTypes;\n+  private final boolean quorumCompatibilityMode;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1e399d4f7d78fc935507f82bca5ac147e6f462c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NDQwODMwOnYy", "diffSide": "RIGHT", "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzo1MDo0OFrOHzkQAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzo1MDo0OFrOHzkQAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzM0NQ==", "bodyText": "GoQuorum", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833345", "createdAt": "2020-11-15T23:50:48Z", "author": {"login": "macfarla"}, "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidatorTest.java", "diffHunk": "@@ -60,6 +61,8 @@\n           .chainId(Optional.of(BigInteger.ONE))\n           .createTransaction(senderKeys);\n \n+  private final boolean defaultQuorumCompatibilityMode = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1e399d4f7d78fc935507f82bca5ac147e6f462c"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NDQwODYxOnYy", "diffSide": "RIGHT", "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzo1MToxMVrOHzkQJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMzo1MToxMVrOHzkQJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgzMzM4Mg==", "bodyText": "goQuorum", "url": "https://github.com/hyperledger/besu/pull/1554#discussion_r523833382", "createdAt": "2020-11-15T23:51:11Z", "author": {"login": "macfarla"}, "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidatorTest.java", "diffHunk": "@@ -332,6 +355,36 @@ public void shouldAcceptValidEIP1559() {\n     ExperimentalEIPs.eip1559Enabled = false;\n   }\n \n+  @Test\n+  public void quorumCompatibilityModeRejectNonZeroGasPrice() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1e399d4f7d78fc935507f82bca5ac147e6f462c"}, "originalPosition": 195}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1334, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}