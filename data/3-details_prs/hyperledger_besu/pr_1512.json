{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0Mjg5NjY4", "number": 1512, "title": "Add gas measurement to full import log line", "bodyText": "To provide more context to admins and to add more meaning the full sync\nlog lines report the amount of gas processed in MegaGas/Second.  Some\nblocks are fuller than others and this provides a gauge as to wether the\nimport is slowing down or if the blocks are filling up.\nSigned-off-by: Danno Ferrin danno.ferrin@gmail.com\n\n\nPR description\nFixed Issue(s)\n\n\nChangelog\n\n I thought about the changelog and included a changelog update if required.", "createdAt": "2020-11-02T20:09:19Z", "url": "https://github.com/hyperledger/besu/pull/1512", "merged": true, "mergeCommit": {"oid": "765a3f4204c703243c1a28637359b5f11df13253"}, "closed": true, "closedAt": "2020-11-03T22:49:44Z", "author": {"login": "shemnon"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYqSKSAH2gAyNTE0Mjg5NjY4OjJhNmFjMDNmNTQxZmVlNWEyNzJlMmE0ZDRlOWI4OTc3MDQ4ZjEyMDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZANLQAH2gAyNTE0Mjg5NjY4OjM5MDBiOThmZmJlNjJjOTBlOTM3NDFkMjI4ZDM1MzM1ZTc0NzRiOTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2a6ac03f541fee5a272e2a4d4e9b8977048f1207", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/2a6ac03f541fee5a272e2a4d4e9b8977048f1207", "committedDate": "2020-11-02T20:07:16Z", "message": "Add gas measurement to full import log line\n\nTo provide more context to admins and to add more meaning the full sync\nlog lines report the amount of gas processed in MegaGas/Second.  Some\nblocks are fuller than others and this provides a gauge as to wether the\nimport is slowing down or if the blocks are filling up.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a7f6bcd742d163facd592581169dea7c18d2d6a", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/1a7f6bcd742d163facd592581169dea7c18d2d6a", "committedDate": "2020-11-02T20:10:58Z", "message": "spotless and changelog\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMDgwMzAz", "url": "https://github.com/hyperledger/besu/pull/1512#pullrequestreview-522080303", "createdAt": "2020-11-02T22:37:32Z", "commit": {"oid": "1a7f6bcd742d163facd592581169dea7c18d2d6a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMjozNzozMlrOHsYSPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMjozNzozMlrOHsYSPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI5NzI3Ng==", "bodyText": "Why not just allow it to log the 0? It doesn't do much harm and it makes it more consistent, grepable, etc.", "url": "https://github.com/hyperledger/besu/pull/1512#discussion_r516297276", "createdAt": "2020-11-02T22:37:32Z", "author": {"login": "RatanRSur"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/fullsync/FullImportBlockStep.java", "diffHunk": "@@ -56,12 +60,28 @@ public void accept(final Block block) {\n     if (!importer.importBlock(protocolContext, block, HeaderValidationMode.SKIP_DETACHED)) {\n       throw new InvalidBlockException(\"Failed to import block\", blockNumber, block.getHash());\n     }\n+    gasAccumulator += block.getHeader().getGasUsed();\n     int peerCount = -1; // ethContext is not available in tests\n     if (ethContext != null && ethContext.getEthPeers().peerCount() >= 0) {\n       peerCount = ethContext.getEthPeers().peerCount();\n     }\n     if (blockNumber % 200 == 0) {\n-      LOG.info(\"Import reached block {} ({}), Peers: {}\", blockNumber, shortHash, peerCount);\n+      final long nowMilli = Instant.now().toEpochMilli();\n+      if (lastReportMillis == 0 || gasAccumulator == 0) {\n+        // this is a formatted logger statement\n+        //noinspection PlaceholderCountMatchesArgumentCount\n+        LOG.info(\"Import reached block %d (%s), Peers: %d\", blockNumber, shortHash, peerCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a7f6bcd742d163facd592581169dea7c18d2d6a"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ad768b250622925e0a8c3fd90c0b15f0025d658", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/3ad768b250622925e0a8c3fd90c0b15f0025d658", "committedDate": "2020-11-03T21:20:31Z", "message": "keep a consistant greppable line.\n\nUse a '-' when there is (a) no time measurement or (b) no gas\nmeasurement.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3900b98ffbe62c90e93741d228d35335e7474b91", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/3900b98ffbe62c90e93741d228d35335e7474b91", "committedDate": "2020-11-03T21:39:44Z", "message": "Merge branch 'master' into mgpsImports"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2055, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}