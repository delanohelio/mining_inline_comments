{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MjI0Mzc1", "number": 1132, "title": "Added configurable block reward and recipient for IBFT2", "bodyText": "Allow IBFT2 to deliver block rewards (of a configurable value), and transaction fees to a configured address.", "createdAt": "2020-06-22T23:16:32Z", "url": "https://github.com/hyperledger/besu/pull/1132", "merged": true, "mergeCommit": {"oid": "79ed3f642afb8d1b5757623db9ee91037e6c59a9"}, "closed": true, "closedAt": "2020-06-25T06:44:00Z", "author": {"login": "rain-on"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABct5hX9gFqTQzNTM0MjYxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuncO4AFqTQzNzE2OTYxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MzQyNjEy", "url": "https://github.com/hyperledger/besu/pull/1132#pullrequestreview-435342612", "createdAt": "2020-06-22T23:33:43Z", "commit": {"oid": "8fbe58db9448409985a97bb63252cc51df1d774f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MzQ4NTQ2", "url": "https://github.com/hyperledger/besu/pull/1132#pullrequestreview-435348546", "createdAt": "2020-06-22T23:51:12Z", "commit": {"oid": "8fbe58db9448409985a97bb63252cc51df1d774f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo1MToxMlrOGnUmaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMzo1NDo0NFrOGnUqFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4NTE2MA==", "bodyText": "nit: getBlocKReward/getBlockReward", "url": "https://github.com/hyperledger/besu/pull/1132#discussion_r443885160", "createdAt": "2020-06-22T23:51:12Z", "author": {"login": "jframe"}, "path": "consensus/ibft/src/main/java/org/hyperledger/besu/consensus/ibft/IbftProtocolSchedule.java", "diffHunk": "@@ -60,16 +59,24 @@ public static ProtocolSchedule create(final GenesisConfigOptions config) {\n   }\n \n   private static ProtocolSpecBuilder applyIbftChanges(\n-      final long secondsBetweenBlocks, final ProtocolSpecBuilder builder) {\n-    return builder\n-        .blockHeaderValidatorBuilder(ibftBlockHeaderValidator(secondsBetweenBlocks))\n-        .ommerHeaderValidatorBuilder(ibftBlockHeaderValidator(secondsBetweenBlocks))\n+      final IbftConfigOptions ibftConfig, final ProtocolSpecBuilder builder) {\n+\n+    builder\n+        .blockHeaderValidatorBuilder(ibftBlockHeaderValidator(ibftConfig.getBlockPeriodSeconds()))\n+        .ommerHeaderValidatorBuilder(ibftBlockHeaderValidator(ibftConfig.getBlockPeriodSeconds()))\n         .blockBodyValidatorBuilder(MainnetBlockBodyValidator::new)\n         .blockValidatorBuilder(MainnetBlockValidator::new)\n         .blockImporterBuilder(MainnetBlockImporter::new)\n         .difficultyCalculator((time, parent, protocolContext) -> BigInteger.ONE)\n-        .blockReward(Wei.ZERO)\n+        .blockReward(Wei.of(ibftConfig.getBlocKReward()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fbe58db9448409985a97bb63252cc51df1d774f"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg4NjEwMg==", "bodyText": "Should the block reward be specified as a hex value in the config?", "url": "https://github.com/hyperledger/besu/pull/1132#discussion_r443886102", "createdAt": "2020-06-22T23:54:44Z", "author": {"login": "jframe"}, "path": "consensus/ibft/src/main/java/org/hyperledger/besu/consensus/ibft/IbftProtocolSchedule.java", "diffHunk": "@@ -60,16 +59,24 @@ public static ProtocolSchedule create(final GenesisConfigOptions config) {\n   }\n \n   private static ProtocolSpecBuilder applyIbftChanges(\n-      final long secondsBetweenBlocks, final ProtocolSpecBuilder builder) {\n-    return builder\n-        .blockHeaderValidatorBuilder(ibftBlockHeaderValidator(secondsBetweenBlocks))\n-        .ommerHeaderValidatorBuilder(ibftBlockHeaderValidator(secondsBetweenBlocks))\n+      final IbftConfigOptions ibftConfig, final ProtocolSpecBuilder builder) {\n+\n+    builder\n+        .blockHeaderValidatorBuilder(ibftBlockHeaderValidator(ibftConfig.getBlockPeriodSeconds()))\n+        .ommerHeaderValidatorBuilder(ibftBlockHeaderValidator(ibftConfig.getBlockPeriodSeconds()))\n         .blockBodyValidatorBuilder(MainnetBlockBodyValidator::new)\n         .blockValidatorBuilder(MainnetBlockValidator::new)\n         .blockImporterBuilder(MainnetBlockImporter::new)\n         .difficultyCalculator((time, parent, protocolContext) -> BigInteger.ONE)\n-        .blockReward(Wei.ZERO)\n+        .blockReward(Wei.of(ibftConfig.getBlocKReward()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fbe58db9448409985a97bb63252cc51df1d774f"}, "originalPosition": 41}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aac103c02d152895d41cd9873a1167944028a6f7", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/aac103c02d152895d41cd9873a1167944028a6f7", "committedDate": "2020-06-23T07:35:20Z", "message": "Creating tests\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}, "afterCommit": {"oid": "5770d7a750fa05414478a6a3171778d732b20d6c", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/5770d7a750fa05414478a6a3171778d732b20d6c", "committedDate": "2020-06-24T00:53:55Z", "message": "Added configurable block reward and recipient for IBFT2\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MzI1NTcw", "url": "https://github.com/hyperledger/besu/pull/1132#pullrequestreview-436325570", "createdAt": "2020-06-24T05:03:20Z", "commit": {"oid": "8c462698450381ff2d9f7c36e237e327a9fd4262"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNTowMzoyMVrOGoDBFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNToxMzoyNlrOGoDLoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY0NTY1Mg==", "bodyText": "Do we need a test with multiple validators receiving a fixed reward? Though that get complicated so might not be worth it.", "url": "https://github.com/hyperledger/besu/pull/1132#discussion_r444645652", "createdAt": "2020-06-24T05:03:21Z", "author": {"login": "jframe"}, "path": "acceptance-tests/tests/src/test/java/org/hyperledger/besu/tests/acceptance/ibft2/Ibft2BlockRewardPaymentAcceptanceTest.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.tests.acceptance.ibft2;\n+\n+import static java.util.Collections.singletonList;\n+\n+import org.hyperledger.besu.ethereum.core.Address;\n+import org.hyperledger.besu.tests.acceptance.dsl.AcceptanceTestBase;\n+import org.hyperledger.besu.tests.acceptance.dsl.account.Account;\n+import org.hyperledger.besu.tests.acceptance.dsl.blockchain.Amount;\n+import org.hyperledger.besu.tests.acceptance.dsl.node.BesuNode;\n+\n+import java.io.IOException;\n+import java.math.BigInteger;\n+import java.util.Optional;\n+\n+import org.junit.Test;\n+\n+public class Ibft2BlockRewardPaymentAcceptanceTest extends AcceptanceTestBase {\n+\n+  @Test\n+  public void validatorsArePaidBlockReward() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c462698450381ff2d9f7c36e237e327a9fd4262"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY0Njk1Mg==", "bodyText": "Don't think this need eth as a suffix, no other fields do that. Should be clear enough that it's eth.", "url": "https://github.com/hyperledger/besu/pull/1132#discussion_r444646952", "createdAt": "2020-06-24T05:08:07Z", "author": {"login": "jframe"}, "path": "config/src/main/java/org/hyperledger/besu/config/IbftConfigOptions.java", "diffHunk": "@@ -75,6 +77,14 @@ public int getFutureMessagesMaxDistance() {\n         ibftConfigRoot, \"futuremessagesmaxdistance\", DEFAULT_FUTURE_MESSAGES_MAX_DISTANCE);\n   }\n \n+  public Optional<String> getMiningBeneficiary() {\n+    return JsonUtil.getString(ibftConfigRoot, \"miningbeneficiary\");\n+  }\n+\n+  public long getBlockRewardEth() {\n+    return JsonUtil.getLong(ibftConfigRoot, \"blockrewardeth\", DEFAULT_IBFT_BLOCK_REWARD_ETH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c462698450381ff2d9f7c36e237e327a9fd4262"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY0ODM1Mw==", "bodyText": "Rather the default was left as 0 as what most people will use and just modify the blockreward for the block reward AT", "url": "https://github.com/hyperledger/besu/pull/1132#discussion_r444648353", "createdAt": "2020-06-24T05:13:26Z", "author": {"login": "jframe"}, "path": "acceptance-tests/tests/src/test/resources/ibft/ibft.json", "diffHunk": "@@ -10,7 +10,8 @@\n     \"ibft2\": {\n       \"blockperiodseconds\": 1,\n       \"epochlength\": 30000,\n-      \"requesttimeoutseconds\": 5\n+      \"requesttimeoutseconds\": 5,\n+      \"blockrewardeth\": 5", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c462698450381ff2d9f7c36e237e327a9fd4262"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7008598076cdf7a076b5125edd5aa7930ad77e8c", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/7008598076cdf7a076b5125edd5aa7930ad77e8c", "committedDate": "2020-06-25T03:28:59Z", "message": "Genesis file specifies block reward in Wei\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}, "afterCommit": {"oid": "b5d6c551cf3874de1bd7f19f576020f6d8344ca9", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/b5d6c551cf3874de1bd7f19f576020f6d8344ca9", "committedDate": "2020-06-25T03:30:55Z", "message": "Rebuild PR\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a37329870c7694d619a6f5a42c3fa599c52f86e", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/0a37329870c7694d619a6f5a42c3fa599c52f86e", "committedDate": "2020-06-25T03:40:00Z", "message": "Rebuild PR\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5d6c551cf3874de1bd7f19f576020f6d8344ca9", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/b5d6c551cf3874de1bd7f19f576020f6d8344ca9", "committedDate": "2020-06-25T03:30:55Z", "message": "Rebuild PR\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}, "afterCommit": {"oid": "0a37329870c7694d619a6f5a42c3fa599c52f86e", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/0a37329870c7694d619a6f5a42c3fa599c52f86e", "committedDate": "2020-06-25T03:40:00Z", "message": "Rebuild PR\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTU1MjM4", "url": "https://github.com/hyperledger/besu/pull/1132#pullrequestreview-437155238", "createdAt": "2020-06-25T04:13:41Z", "commit": {"oid": "0a37329870c7694d619a6f5a42c3fa599c52f86e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNDoxMzo0MVrOGoqv-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNDoxMzo0MVrOGoqv-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5NjYzNQ==", "bodyText": "Can you also add a test for block rewards with a decimal number", "url": "https://github.com/hyperledger/besu/pull/1132#discussion_r445296635", "createdAt": "2020-06-25T04:13:41Z", "author": {"login": "jframe"}, "path": "config/src/test/java/org/hyperledger/besu/config/JsonGenesisConfigOptionsTest.java", "diffHunk": "@@ -116,4 +116,40 @@ public void configWithAnIbftWithNoValidatorsListedIsValid() {\n     assertThat(configOptions.getTransitions().getIbftForks().get(1).getValidators().get().size())\n         .isEqualTo(1);\n   }\n+\n+  @Test\n+  public void configWithValidIbftBlockRewardIsParsable() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a37329870c7694d619a6f5a42c3fa599c52f86e"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c685c1c7cef4de174c85cdbd6349be836e9e1871", "author": {"user": null}, "url": "https://github.com/hyperledger/besu/commit/c685c1c7cef4de174c85cdbd6349be836e9e1871", "committedDate": "2020-06-25T04:49:49Z", "message": "Add decimal test\n\nSigned-off-by: Trent Mohay <trent.mohay@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTY5NjEz", "url": "https://github.com/hyperledger/besu/pull/1132#pullrequestreview-437169613", "createdAt": "2020-06-25T05:03:44Z", "commit": {"oid": "c685c1c7cef4de174c85cdbd6349be836e9e1871"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1497, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}