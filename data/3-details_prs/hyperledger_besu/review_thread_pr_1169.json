{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNjUwNjIx", "number": 1169, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMjowMzozNlrOEJ2NGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMjoyMzozN1rOEJ2sTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NzYwNzMxOnYy", "diffSide": "LEFT", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/SyncTargetManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMjowMzozNlrOGqjz9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMjowMzozNlrOGqjz9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI4MDExNw==", "bodyText": "So this is the main change?  the rest are all style adjustments?", "url": "https://github.com/hyperledger/besu/pull/1169#discussion_r447280117", "createdAt": "2020-06-29T22:03:36Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/SyncTargetManager.java", "diffHunk": "@@ -113,7 +113,7 @@ protected SyncTargetManager(\n   protected abstract CompletableFuture<Optional<EthPeer>> selectBestAvailableSyncTarget();\n \n   private CompletableFuture<SyncTarget> waitForPeerAndThenSetSyncTarget() {\n-    return waitForNewPeer().handle((r, t) -> r).thenCompose((r) -> selectNewSyncTarget());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcb58cddeca556a4ba315a20c9670538661b6920"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NzYxMzMxOnYy", "diffSide": "RIGHT", "path": "util/src/main/java/org/hyperledger/besu/util/Subscribers.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMjowNToyMVrOGqj3Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzowMTowNVrOGtfx9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI4MDk2Ng==", "bodyText": "Actually, this is the main change.  Can we move all style changes to a separate PR since they masked where the real change was?", "url": "https://github.com/hyperledger/besu/pull/1169#discussion_r447280966", "createdAt": "2020-06-29T22:05:21Z", "author": {"login": "shemnon"}, "path": "util/src/main/java/org/hyperledger/besu/util/Subscribers.java", "diffHunk": "@@ -101,17 +102,19 @@ public boolean unsubscribe(final long subscriberId) {\n    * @param action the action to perform for each subscriber\n    */\n   public void forEach(final Consumer<T> action) {\n-    subscribers\n-        .values()\n+    ImmutableSet.copyOf(\n+            // we copy here to ensure that our callback, which may add another subscriber on this", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcb58cddeca556a4ba315a20c9670538661b6920"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM1OTc5OQ==", "bodyText": "removed all the other changes", "url": "https://github.com/hyperledger/besu/pull/1169#discussion_r450359799", "createdAt": "2020-07-06T17:01:05Z", "author": {"login": "RatanRSur"}, "path": "util/src/main/java/org/hyperledger/besu/util/Subscribers.java", "diffHunk": "@@ -101,17 +102,19 @@ public boolean unsubscribe(final long subscriberId) {\n    * @param action the action to perform for each subscriber\n    */\n   public void forEach(final Consumer<T> action) {\n-    subscribers\n-        .values()\n+    ImmutableSet.copyOf(\n+            // we copy here to ensure that our callback, which may add another subscriber on this", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI4MDk2Ng=="}, "originalCommit": {"oid": "fcb58cddeca556a4ba315a20c9670538661b6920"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NzY4NzE3OnYy", "diffSide": "RIGHT", "path": "util/src/main/java/org/hyperledger/besu/util/Subscribers.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMjoyMzozN1rOGqkkTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMjozODoxNFrOGuSBlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI5MjQ5Mw==", "bodyText": "changing this from throwable to exception seems important - i.e. prior to this change, throwables would be eaten by the \"suppress\" - now they will always be raised (which maybe the intent, but wanted to confirm).", "url": "https://github.com/hyperledger/besu/pull/1169#discussion_r447292493", "createdAt": "2020-06-29T22:23:37Z", "author": {"login": "rain-on"}, "path": "util/src/main/java/org/hyperledger/besu/util/Subscribers.java", "diffHunk": "@@ -101,17 +102,19 @@ public boolean unsubscribe(final long subscriberId) {\n    * @param action the action to perform for each subscriber\n    */\n   public void forEach(final Consumer<T> action) {\n-    subscribers\n-        .values()\n+    ImmutableSet.copyOf(\n+            // we copy here to ensure that our callback, which may add another subscriber on this\n+            // event, won't trigger that new additional subscriber\n+            subscribers.values())\n         .forEach(\n             subscriber -> {\n               try {\n                 action.accept(subscriber);\n-              } catch (Throwable throwable) {\n+              } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcb58cddeca556a4ba315a20c9670538661b6920"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODA3MjQ4MA==", "bodyText": "The only relevant throwable suppressed are Errors, which generally speaking are non-recoverable (OutOfMemoryError, ThreadDeath, LinkageError, etc.).  When those happen the VM is going down hard.", "url": "https://github.com/hyperledger/besu/pull/1169#discussion_r448072480", "createdAt": "2020-07-01T01:54:28Z", "author": {"login": "shemnon"}, "path": "util/src/main/java/org/hyperledger/besu/util/Subscribers.java", "diffHunk": "@@ -101,17 +102,19 @@ public boolean unsubscribe(final long subscriberId) {\n    * @param action the action to perform for each subscriber\n    */\n   public void forEach(final Consumer<T> action) {\n-    subscribers\n-        .values()\n+    ImmutableSet.copyOf(\n+            // we copy here to ensure that our callback, which may add another subscriber on this\n+            // event, won't trigger that new additional subscriber\n+            subscribers.values())\n         .forEach(\n             subscriber -> {\n               try {\n                 action.accept(subscriber);\n-              } catch (Throwable throwable) {\n+              } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI5MjQ5Mw=="}, "originalCommit": {"oid": "fcb58cddeca556a4ba315a20c9670538661b6920"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM1NjcxMQ==", "bodyText": "@rain-on Are you alright with leaving it as is?", "url": "https://github.com/hyperledger/besu/pull/1169#discussion_r450356711", "createdAt": "2020-07-06T16:55:43Z", "author": {"login": "RatanRSur"}, "path": "util/src/main/java/org/hyperledger/besu/util/Subscribers.java", "diffHunk": "@@ -101,17 +102,19 @@ public boolean unsubscribe(final long subscriberId) {\n    * @param action the action to perform for each subscriber\n    */\n   public void forEach(final Consumer<T> action) {\n-    subscribers\n-        .values()\n+    ImmutableSet.copyOf(\n+            // we copy here to ensure that our callback, which may add another subscriber on this\n+            // event, won't trigger that new additional subscriber\n+            subscribers.values())\n         .forEach(\n             subscriber -> {\n               try {\n                 action.accept(subscriber);\n-              } catch (Throwable throwable) {\n+              } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI5MjQ5Mw=="}, "originalCommit": {"oid": "fcb58cddeca556a4ba315a20c9670538661b6920"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE4Mjk5OA==", "bodyText": "\ud83d\udc4d  all good.", "url": "https://github.com/hyperledger/besu/pull/1169#discussion_r451182998", "createdAt": "2020-07-07T22:38:14Z", "author": {"login": "rain-on"}, "path": "util/src/main/java/org/hyperledger/besu/util/Subscribers.java", "diffHunk": "@@ -101,17 +102,19 @@ public boolean unsubscribe(final long subscriberId) {\n    * @param action the action to perform for each subscriber\n    */\n   public void forEach(final Consumer<T> action) {\n-    subscribers\n-        .values()\n+    ImmutableSet.copyOf(\n+            // we copy here to ensure that our callback, which may add another subscriber on this\n+            // event, won't trigger that new additional subscriber\n+            subscribers.values())\n         .forEach(\n             subscriber -> {\n               try {\n                 action.accept(subscriber);\n-              } catch (Throwable throwable) {\n+              } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI5MjQ5Mw=="}, "originalCommit": {"oid": "fcb58cddeca556a4ba315a20c9670538661b6920"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 834, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}