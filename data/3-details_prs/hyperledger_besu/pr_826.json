{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExOTMyNDk5", "number": 826, "title": "recognize from and to block parameters in eth subscribe", "bodyText": "PR description\nGeth sneakily accepts from and to blocks in its websocket log subscriptions parameters. This extends the websocket subscription to be able to take block parameters. That makes us compatible with their implementation and also our http and ws filter parameters align.\nFixed Issue(s)\nfixes #654", "createdAt": "2020-05-01T01:43:13Z", "url": "https://github.com/hyperledger/besu/pull/826", "merged": true, "mergeCommit": {"oid": "88a0b8faaa674d7f8d60c1790b6a1be11b4117ea"}, "closed": true, "closedAt": "2020-05-03T23:37:16Z", "author": {"login": "RatanRSur"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcc3exUgH2gAyNDExOTMyNDk5OmUwMTRjNWNlYmY1NzlmZjY3OGU5YzYxZGU1YjUwNzQ0MGI3ZTI0NzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcdzXmGgH2gAyNDExOTMyNDk5OjMwZjc0OTY1OWQ0M2JmNWY1YzNmMDMwZjU4NmFjZmY5N2NkZjQ3NjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e014c5cebf579ff678e9c61de5b507440b7e2472", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/e014c5cebf579ff678e9c61de5b507440b7e2472", "committedDate": "2020-05-01T01:34:21Z", "message": "recognize from and to block parameters in eth subscribe\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f944ba84a178f1c5138f425bdb7f3a698a283ada", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/f944ba84a178f1c5138f425bdb7f3a698a283ada", "committedDate": "2020-05-01T01:47:18Z", "message": "Merge remote-tracking branch 'upstream/master' into ws-failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f53766824afb3fc542fde198ad05fc09992a3b9d", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/f53766824afb3fc542fde198ad05fc09992a3b9d", "committedDate": "2020-05-01T17:30:13Z", "message": "mainly argument validation and test fixes\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95cfe6aaa3d73aa2fd8cf5a19f8b09ecc64d9bb1", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/95cfe6aaa3d73aa2fd8cf5a19f8b09ecc64d9bb1", "committedDate": "2020-05-01T17:32:41Z", "message": "add eth new filter test\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d2e8b54a387ca68323b2615baed5de88664e9b1", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/8d2e8b54a387ca68323b2615baed5de88664e9b1", "committedDate": "2020-05-01T17:33:18Z", "message": "remove test\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b7fb38f1fad84262be038f9bbce750cb667c54a", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/5b7fb38f1fad84262be038f9bbce750cb667c54a", "committedDate": "2020-05-01T17:34:45Z", "message": "typo\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80031a8250324dd67bc35a55ba03480b90797418", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/80031a8250324dd67bc35a55ba03480b90797418", "committedDate": "2020-05-01T17:37:18Z", "message": "reinstate test\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91eb33a82d72eec16c2cd76580abf9f66cd2c915", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/91eb33a82d72eec16c2cd76580abf9f66cd2c915", "committedDate": "2020-05-01T17:44:23Z", "message": "use static BlockParams\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34cd770853862ac391941ac33978770e8cdea55a", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/34cd770853862ac391941ac33978770e8cdea55a", "committedDate": "2020-05-01T18:40:56Z", "message": "test FilterParameter invalidity\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzcwNzU4", "url": "https://github.com/hyperledger/besu/pull/826#pullrequestreview-404370758", "createdAt": "2020-05-01T20:02:04Z", "commit": {"oid": "34cd770853862ac391941ac33978770e8cdea55a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzcwODYx", "url": "https://github.com/hyperledger/besu/pull/826#pullrequestreview-404370861", "createdAt": "2020-05-01T20:02:16Z", "commit": {"oid": "34cd770853862ac391941ac33978770e8cdea55a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjY3Mzc0", "url": "https://github.com/hyperledger/besu/pull/826#pullrequestreview-404667374", "createdAt": "2020-05-03T23:18:57Z", "commit": {"oid": "34cd770853862ac391941ac33978770e8cdea55a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMzoxODo1N1rOGPwVYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMzoxODo1N1rOGPwVYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE3MzczMA==", "bodyText": "I think we should update this to be the headBlockNumber as well. This seems to be the \"default\" for Geth APIs. And probably update the PrivGetLogs as well.\nI'm happy to do this in another PR is you don't wanna mix up with the other changes! :)\nhttps://github.com/ethereum/wiki/wiki/JSON-RPC#eth_getlogs", "url": "https://github.com/hyperledger/besu/pull/826#discussion_r419173730", "createdAt": "2020-05-03T23:18:57Z", "author": {"login": "lucassaldanha"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/EthGetLogs.java", "diffHunk": "@@ -41,30 +43,26 @@ public String getName() {\n   @Override\n   public JsonRpcResponse response(final JsonRpcRequestContext requestContext) {\n     final FilterParameter filter = requestContext.getRequiredParameter(0, FilterParameter.class);\n-    final LogsQuery query =\n-        new LogsQuery.Builder().addresses(filter.getAddresses()).topics(filter.getTopics()).build();\n \n-    if (isValid(filter)) {\n+    if (!filter.isValid()) {\n       return new JsonRpcErrorResponse(\n           requestContext.getRequest().getId(), JsonRpcError.INVALID_PARAMS);\n     }\n-    if (filter.getBlockhash() != null) {\n-      return new JsonRpcSuccessResponse(\n-          requestContext.getRequest().getId(),\n-          new LogsResult(blockchain.matchingLogs(filter.getBlockhash(), query)));\n-    }\n \n-    final long fromBlockNumber = filter.getFromBlock().getNumber().orElse(0);\n-    final long toBlockNumber = filter.getToBlock().getNumber().orElse(blockchain.headBlockNumber());\n+    final List<LogWithMetadata> matchingLogs =\n+        filter\n+            .getBlockHash()\n+            .map(blockHash -> blockchain.matchingLogs(blockHash, filter.getLogsQuery()))\n+            .orElseGet(\n+                () -> {\n+                  final long fromBlockNumber = filter.getFromBlock().getNumber().orElse(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34cd770853862ac391941ac33978770e8cdea55a"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30f749659d43bf5f5c3f030f586acff97cdf4762", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/30f749659d43bf5f5c3f030f586acff97cdf4762", "committedDate": "2020-05-03T23:20:49Z", "message": "Merge branch 'master' into ws-failure"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1610, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}