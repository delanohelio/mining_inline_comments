{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MDA2NDIx", "number": 745, "title": "[EIP-1559] Step 9 - Update transaction processing with EIP-1559 rules.", "bodyText": "PR description\n\nCreated TransactionPriceCalculator to compute the transaction gas price.\nCreated CoinbaseFeePriceCalculator to compute the coinbase reward.\nUpdated MainnetTransactionProcessor to apply new consensus rules:\n\nUpdated transaction gas price for EIP-1559 transactions.\nUpdated coinbase reward for EIP-1559 transactions.\n\n\nUpdated MainnetProtocolSpecs to build the correct TransactionProcessor for EIP-1559 definition.\n\nFixed Issue(s)\n\n#601\n#605\n\nSigned-off-by: Abdelhamid Bakhta abdelhamid.bakhta@consensys.net", "createdAt": "2020-04-20T11:31:43Z", "url": "https://github.com/hyperledger/besu/pull/745", "merged": true, "mergeCommit": {"oid": "4f804b375f1b8a5c956624f9a4bb426cac689941"}, "closed": true, "closedAt": "2020-04-22T09:05:30Z", "author": {"login": "abdelhamidbakhta"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZdXHWgH2gAyNDA2MDA2NDIxOjA0N2JmMTg1ZGU3MjhkY2UyOWUzOGYxZTE4NDUxYTA5YWJlMjA0N2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaEVyiAH2gAyNDA2MDA2NDIxOjc2NDU4M2VhYzM2OGU1Y2EzMWMwMTAyMWRkZTg4NDcxNjgzNjNjMGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "047bf185de728dce29e38f1e18451a09abe2047f", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/047bf185de728dce29e38f1e18451a09abe2047f", "committedDate": "2020-04-20T11:26:41Z", "message": "Added changelog entries for PR:\n- https://github.com/hyperledger/besu/pull/430\n- https://github.com/hyperledger/besu/pull/440\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63f32fe18facdafa1820b598c91f4a2d2cd47c7f", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/63f32fe18facdafa1820b598c91f4a2d2cd47c7f", "committedDate": "2020-04-20T11:30:48Z", "message": "Update transaction processing with EIP-1559 rules.\n\n- Created `TransactionPriceCalculator` to compute the transaction gas price.\n- Created `CoinbaseFeePriceCalculator` to compute the coinbase reward.\n- Updated `MainnetTransactionProcessor` to apply new consensus rules:\n    - Updated transaction gas price for EIP-1559 transactions.\n    - Updated coinbase reward for EIP-1559 transactions.\n- Updated `MainnetProtocolSpecs` to build the correct TransactionProcessor for EIP-1559 definition.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a38fa8fb43a367f3b1611f9e2394af2bb4bc10c", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/6a38fa8fb43a367f3b1611f9e2394af2bb4bc10c", "committedDate": "2020-04-20T19:14:17Z", "message": "Merge branch 'master' into eip1559-step9"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6add803ffc871687581eb66f3d4b90aedf73151b", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/6add803ffc871687581eb66f3d4b90aedf73151b", "committedDate": "2020-04-21T08:01:34Z", "message": "Merge branch 'master' into eip1559-step9"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52091fc06faed141571f23f3f571e1f3102a5003", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/52091fc06faed141571f23f3f571e1f3102a5003", "committedDate": "2020-04-21T16:24:31Z", "message": "Merge branch 'master' into eip1559-step9"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NzA4MTIy", "url": "https://github.com/hyperledger/besu/pull/745#pullrequestreview-397708122", "createdAt": "2020-04-21T22:02:21Z", "commit": {"oid": "52091fc06faed141571f23f3f571e1f3102a5003"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowMjoyMVrOGJaXcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowMjoyMVrOGJaXcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMjM1NA==", "bodyText": "This file may need a hand merge.  I don't think there should be any diffs.", "url": "https://github.com/hyperledger/besu/pull/745#discussion_r412522354", "createdAt": "2020-04-21T22:02:21Z", "author": {"login": "shemnon"}, "path": "CHANGELOG.md", "diffHunk": "@@ -160,59 +160,15 @@ Workaround -> When using onchain permissioning, ensure bootnodes are also valida\n ### Additions and Improvements ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52091fc06faed141571f23f3f571e1f3102a5003"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NzA4Nzcx", "url": "https://github.com/hyperledger/besu/pull/745#pullrequestreview-397708771", "createdAt": "2020-04-21T22:03:42Z", "commit": {"oid": "52091fc06faed141571f23f3f571e1f3102a5003"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowMzo0M1rOGJaaIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjowNTowMlrOGJacvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMzA0MQ==", "bodyText": "\ud83d\ude04 This should produce compiler errors now if another method is added to the interface.", "url": "https://github.com/hyperledger/besu/pull/745#discussion_r412523041", "createdAt": "2020-04-21T22:03:43Z", "author": {"login": "shemnon"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/fees/CoinbaseFeePriceCalculator.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.core.fees;\n+\n+import org.hyperledger.besu.config.experimental.ExperimentalEIPs;\n+import org.hyperledger.besu.ethereum.core.Gas;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+\n+import java.util.Optional;\n+\n+@FunctionalInterface", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52091fc06faed141571f23f3f571e1f3102a5003"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyMzcxMQ==", "bodyText": "Will gasPremium and Fee Cap always be in legacy TXes in a mixed 1559/legacy state?  i.e. is there a fixed calculation for them based on gas price?  i.e. orElseThrow will only throw if there are config issues?", "url": "https://github.com/hyperledger/besu/pull/745#discussion_r412523711", "createdAt": "2020-04-21T22:05:02Z", "author": {"login": "shemnon"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/fees/TransactionPriceCalculator.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.core.fees;\n+\n+import org.hyperledger.besu.config.experimental.ExperimentalEIPs;\n+import org.hyperledger.besu.ethereum.core.Transaction;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+\n+import java.util.Optional;\n+\n+@FunctionalInterface\n+public interface TransactionPriceCalculator {\n+  Wei price(Transaction transaction, Optional<Long> baseFee);\n+\n+  static TransactionPriceCalculator frontier() {\n+    return (transaction, baseFee) -> transaction.getGasPrice();\n+  }\n+\n+  static TransactionPriceCalculator eip1559() {\n+    return (transaction, maybeBaseFee) -> {\n+      ExperimentalEIPs.eip1559MustBeEnabled();\n+      final long gasPremium = transaction.getGasPremium().orElseThrow().getValue().longValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52091fc06faed141571f23f3f571e1f3102a5003"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17ef4a0fde665b8295b174099df6a46dfd77a4b7", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/17ef4a0fde665b8295b174099df6a46dfd77a4b7", "committedDate": "2020-04-22T08:49:58Z", "message": "Merge remote-tracking branch 'upstream/master' into eip1559-step9\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "764583eac368e5ca31c01021dde8847168363c0e", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/764583eac368e5ca31c01021dde8847168363c0e", "committedDate": "2020-04-22T08:51:32Z", "message": "Merge master branch\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1576, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}