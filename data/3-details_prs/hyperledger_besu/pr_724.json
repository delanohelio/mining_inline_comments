{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzODY3OTUz", "number": 724, "title": "Fix support of peers that do not support eth/65", "bodyText": "Signed-off-by: Antoine Toulme antoine@lunar-ocean.com\n\n\nPR description\nMake sure to not enroll peers that do not support eth/65 for sending pending transactions, as the client will otherwise throw an error when negotiating sending the message to the peer.\nFixed Issue(s)\nFixes #723", "createdAt": "2020-04-15T16:35:18Z", "url": "https://github.com/hyperledger/besu/pull/724", "merged": true, "mergeCommit": {"oid": "837af6c3b9560db8cb7a7cba8717710dee70e10e"}, "closed": true, "closedAt": "2020-04-15T19:46:07Z", "author": {"login": "atoulme"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcX6xmwgH2gAyNDAzODY3OTUzOjU1NTMyMmRiY2EzYzc4YjE5NDdmNzBmNTAxMzMwNmVjMzdmMjI4MDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX9CTgAH2gAyNDAzODY3OTUzOmFmNTBjOTY2NzdjMzc1NzZjOGU1NTkyNDZiMWMyMzI2MTRlMzcwOTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "555322dbca3c78b1947f70f5013306ec37f22802", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/555322dbca3c78b1947f70f5013306ec37f22802", "committedDate": "2020-04-15T16:35:01Z", "message": "Fix support of peers <eth/65\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af76df0d4e8211b077c66218447375964f8b2170", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/af76df0d4e8211b077c66218447375964f8b2170", "committedDate": "2020-04-15T17:25:29Z", "message": "Fix unit test\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTk0MzM1", "url": "https://github.com/hyperledger/besu/pull/724#pullrequestreview-393994335", "createdAt": "2020-04-15T17:40:48Z", "commit": {"oid": "af76df0d4e8211b077c66218447375964f8b2170"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzo0MDo0OFrOGGEkkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzo0MDo0OFrOGGEkkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAxOTUzOA==", "bodyText": "The protocol should be an argument, for future feature support.  I don't think this will be the first time we will change behavior based on ETH subprotocol support.", "url": "https://github.com/hyperledger/besu/pull/724#discussion_r409019538", "createdAt": "2020-04-15T17:40:48Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/PeerPendingTransactionTracker.java", "diffHunk": "@@ -67,6 +68,10 @@ public synchronized void addToPeerSendQueue(final EthPeer peer, final Hash hash)\n     }\n   }\n \n+  public boolean isPeerSupported(final EthPeer peer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af76df0d4e8211b077c66218447375964f8b2170"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTk1OTkz", "url": "https://github.com/hyperledger/besu/pull/724#pullrequestreview-393995993", "createdAt": "2020-04-15T17:43:07Z", "commit": {"oid": "af76df0d4e8211b077c66218447375964f8b2170"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzo0MzowN1rOGGEqGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzo0MzowN1rOGGEqGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAyMDk1Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public boolean isPeerSupported(final EthPeer peer) {\n          \n          \n            \n                return peer.getAgreedCapabilities().contains(EthProtocol.ETH65);\n          \n          \n            \n              }\n          \n          \n            \n              public boolean isPeerSupported(final EthPeer peer, final Capability capability) {\n          \n          \n            \n                return peer.getAgreedCapabilities().contains(capability);\n          \n          \n            \n              }", "url": "https://github.com/hyperledger/besu/pull/724#discussion_r409020952", "createdAt": "2020-04-15T17:43:07Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/PeerPendingTransactionTracker.java", "diffHunk": "@@ -67,6 +68,10 @@ public synchronized void addToPeerSendQueue(final EthPeer peer, final Hash hash)\n     }\n   }\n \n+  public boolean isPeerSupported(final EthPeer peer) {\n+    return peer.getAgreedCapabilities().contains(EthProtocol.ETH65);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af76df0d4e8211b077c66218447375964f8b2170"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTk2Nzc2", "url": "https://github.com/hyperledger/besu/pull/724#pullrequestreview-393996776", "createdAt": "2020-04-15T17:44:10Z", "commit": {"oid": "af76df0d4e8211b077c66218447375964f8b2170"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzo0NDoxMFrOGGEstQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNzo0NDoxMFrOGGEstQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTAyMTYyMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    .filter(transactionTracker::isPeerSupported)\n          \n          \n            \n                    .filter(peer -> transactionTracker.isPeerSupported(peer, EthProtocol.ETH65)\n          \n      \n    \n    \n  \n\nMay require an import, and similarly to the other 5 places it's called.", "url": "https://github.com/hyperledger/besu/pull/724#discussion_r409021621", "createdAt": "2020-04-15T17:44:10Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/PendingTransactionSender.java", "diffHunk": "@@ -38,6 +38,7 @@ public void onTransactionsAdded(final Iterable<Transaction> transactions) {\n     ethContext\n         .getEthPeers()\n         .streamAvailablePeers()\n+        .filter(transactionTracker::isPeerSupported)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af76df0d4e8211b077c66218447375964f8b2170"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77772a84527a726ab95ec920dd332d59dd7c2a25", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/77772a84527a726ab95ec920dd332d59dd7c2a25", "committedDate": "2020-04-15T17:49:56Z", "message": "Update ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/PeerPendingTransactionTracker.java\n\nCo-Authored-By: Danno Ferrin <danno.ferrin@shemnon.com>\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6d9431495726b656f6ae49c292c28e0cb5cf907", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/c6d9431495726b656f6ae49c292c28e0cb5cf907", "committedDate": "2020-04-15T17:50:02Z", "message": "make protocol version part of the function\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7d1dc31333e463cda79d391a524fe520a380fe6", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/c7d1dc31333e463cda79d391a524fe520a380fe6", "committedDate": "2020-04-15T17:48:58Z", "message": "make protocol version part of the function\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}, "afterCommit": {"oid": "c6d9431495726b656f6ae49c292c28e0cb5cf907", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/c6d9431495726b656f6ae49c292c28e0cb5cf907", "committedDate": "2020-04-15T17:50:02Z", "message": "make protocol version part of the function\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MDQ3MTc2", "url": "https://github.com/hyperledger/besu/pull/724#pullrequestreview-394047176", "createdAt": "2020-04-15T18:54:01Z", "commit": {"oid": "c6d9431495726b656f6ae49c292c28e0cb5cf907"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af50c96677c37576c8e559246b1c232614e37093", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/af50c96677c37576c8e559246b1c232614e37093", "committedDate": "2020-04-15T19:13:04Z", "message": "Merge branch 'master' into eth65_compat"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1735, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}