{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMzgzMDk5", "number": 1182, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNjozMDowNlrOEKwzcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNjozNTowMlrOEKw4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NzIwODE4OnYy", "diffSide": "RIGHT", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNjozMDowNlrOGr_HpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNjozOTo1MFrOGr_WPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3NjEwMQ==", "bodyText": "\"set, each\" ?", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448776101", "createdAt": "2020-07-02T06:30:06Z", "author": {"login": "mark-terry"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -909,7 +909,7 @@ void setBannedNodeIds(final List<String> values) {\n   @Option(\n       names = {\"--target-gas-limit\"},\n       description =\n-          \"Sets target gas limit per block. If set each blocks gas limit will approach this setting over time if the current gas limit is different.\")\n+          \"Sets target gas limit per block. If set each block's gas limit will approach this setting over time if the current gas limit is different.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b599cf9c5901ecf2090b938a446a30f997081eb3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3OTgzOA==", "bodyText": "this sort of thing appears in the help both ways. If we're going to make it consistent that would be a bigger change than this PR.", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448779838", "createdAt": "2020-07-02T06:39:50Z", "author": {"login": "macfarla"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -909,7 +909,7 @@ void setBannedNodeIds(final List<String> values) {\n   @Option(\n       names = {\"--target-gas-limit\"},\n       description =\n-          \"Sets target gas limit per block. If set each blocks gas limit will approach this setting over time if the current gas limit is different.\")\n+          \"Sets target gas limit per block. If set each block's gas limit will approach this setting over time if the current gas limit is different.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3NjEwMQ=="}, "originalCommit": {"oid": "b599cf9c5901ecf2090b938a446a30f997081eb3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NzIxNjU0OnYy", "diffSide": "RIGHT", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNjozMzoyMlrOGr_MmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNjo0MDo1OFrOGr_YNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3NzM2OA==", "bodyText": "\"Private transactions cannot be signed by random (non-funded) accounts in paid gas networks\"\nWould you expect a user to connect that not specifying a key file will mean a random account is used? I'm not sure whether we can expect the user to have enough context to understand the last sentence.", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448777368", "createdAt": "2020-07-02T06:33:22Z", "author": {"login": "mark-terry"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1882,6 +1882,16 @@ private PrivacyParameters privacyParameters() {\n         throw new ParameterException(\n             commandLine, \"Please specify Enclave public key file path to enable privacy\");\n       }\n+\n+      if (Wei.ZERO.compareTo(minTransactionGasPrice) < 0) {\n+        // if gas is required, cannot use random keys to sign private tx\n+        // ie --privacy-marker-transaction-signing-key-file must be set\n+        if (privacyMarkerTransactionSigningKeyPath == null) {\n+          throw new ParameterException(\n+              commandLine,\n+              \"Not a free gas network. --privacy-marker-transaction-signing-key-file must be specified and must be a funded account. Private transactions cannot be signed by random (non-funded) accounts in paid gas networks\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b599cf9c5901ecf2090b938a446a30f997081eb3"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc4MDM0Mg==", "bodyText": "I got that from reading the docs. I think if you're using privacy you should read the docs. Also I asked @MadelineMurray to preapprove this error message", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448780342", "createdAt": "2020-07-02T06:40:58Z", "author": {"login": "macfarla"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1882,6 +1882,16 @@ private PrivacyParameters privacyParameters() {\n         throw new ParameterException(\n             commandLine, \"Please specify Enclave public key file path to enable privacy\");\n       }\n+\n+      if (Wei.ZERO.compareTo(minTransactionGasPrice) < 0) {\n+        // if gas is required, cannot use random keys to sign private tx\n+        // ie --privacy-marker-transaction-signing-key-file must be set\n+        if (privacyMarkerTransactionSigningKeyPath == null) {\n+          throw new ParameterException(\n+              commandLine,\n+              \"Not a free gas network. --privacy-marker-transaction-signing-key-file must be specified and must be a funded account. Private transactions cannot be signed by random (non-funded) accounts in paid gas networks\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3NzM2OA=="}, "originalCommit": {"oid": "b599cf9c5901ecf2090b938a446a30f997081eb3"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NzIyMDM3OnYy", "diffSide": "RIGHT", "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNjozNTowMlrOGr_O6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNjozNzoyNFrOGr_Sog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3Nzk2Mw==", "bodyText": "Does it make sense to rely on a default non-zero gas price, or would it be clearer to have an explicit non-zero gas price?", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448777963", "createdAt": "2020-07-02T06:35:02Z", "author": {"login": "mark-terry"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3073,6 +3089,15 @@ public void onchainPrivacyAndMultiTenancyCannotBeUsedTogether() {\n         .startsWith(\"Privacy multi-tenancy and onchain privacy groups cannot be used together\");\n   }\n \n+  @Test\n+  public void privacyMarkerTransactionSigningKeyFileRequiredIfMinGasPriceNonZero() {\n+    parseCommand(\"--privacy-enabled\", \"--privacy-public-key-file\", ENCLAVE_PUBLIC_KEY_PATH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b599cf9c5901ecf2090b938a446a30f997081eb3"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3ODkxNA==", "bodyText": "changing this is outside the scope of this PR", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448778914", "createdAt": "2020-07-02T06:37:24Z", "author": {"login": "macfarla"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3073,6 +3089,15 @@ public void onchainPrivacyAndMultiTenancyCannotBeUsedTogether() {\n         .startsWith(\"Privacy multi-tenancy and onchain privacy groups cannot be used together\");\n   }\n \n+  @Test\n+  public void privacyMarkerTransactionSigningKeyFileRequiredIfMinGasPriceNonZero() {\n+    parseCommand(\"--privacy-enabled\", \"--privacy-public-key-file\", ENCLAVE_PUBLIC_KEY_PATH);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3Nzk2Mw=="}, "originalCommit": {"oid": "b599cf9c5901ecf2090b938a446a30f997081eb3"}, "originalPosition": 77}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 844, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}