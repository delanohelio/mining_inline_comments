{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMTk3ODgz", "number": 1557, "title": "Add tracing support for internals and JSON-RPC", "bodyText": "Signed-off-by: Antoine Toulme antoine@lunar-ocean.com\nPR description\nAdds tracing support for internals of Besu and the JSON-RPC HTTP service.\nThis was tested with soaking a Besu node for 48 hours against mainnet, with no sync issues oberved.\nChangelog\n\n I thought about the changelog and included a changelog update if required.", "createdAt": "2020-11-12T22:33:00Z", "url": "https://github.com/hyperledger/besu/pull/1557", "merged": true, "mergeCommit": {"oid": "cd66968b6d210fd6960a506840c2432281f28342"}, "closed": true, "closedAt": "2021-01-04T19:11:14Z", "author": {"login": "atoulme"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdb6bnhgBqjM5OTA5NzA2MTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABds5vP7AH2gAyNTIwMTk3ODgzOjgwZjczNDg5ZTY4ZTVjOTdkMGNkMGRhNjVhM2Q0MzFmNzIwYjBjYzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "495c2f88a1fb2ae5dd6440d71f0ecfbdd08f811e", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/495c2f88a1fb2ae5dd6440d71f0ecfbdd08f811e", "committedDate": "2020-11-12T22:31:36Z", "message": "Add tracing support for internals and JSON-RPC\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}, "afterCommit": {"oid": "c10a225fa8be3af446cbcf2d06c986d636585970", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/c10a225fa8be3af446cbcf2d06c986d636585970", "committedDate": "2020-11-12T22:37:43Z", "message": "Add tracing support for internals and JSON-RPC\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c10a225fa8be3af446cbcf2d06c986d636585970", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/c10a225fa8be3af446cbcf2d06c986d636585970", "committedDate": "2020-11-12T22:37:43Z", "message": "Add tracing support for internals and JSON-RPC\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}, "afterCommit": {"oid": "9303e60ecf23fe1f9f4384a9ea273ba6a8ce39ad", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/9303e60ecf23fe1f9f4384a9ea273ba6a8ce39ad", "committedDate": "2020-11-12T23:39:24Z", "message": "Add tracing support for internals and JSON-RPC\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9303e60ecf23fe1f9f4384a9ea273ba6a8ce39ad", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/9303e60ecf23fe1f9f4384a9ea273ba6a8ce39ad", "committedDate": "2020-11-12T23:39:24Z", "message": "Add tracing support for internals and JSON-RPC\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}, "afterCommit": {"oid": "be459ee0ab92e10a33d659cb71d25d2a50fb3d3c", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/be459ee0ab92e10a33d659cb71d25d2a50fb3d3c", "committedDate": "2020-11-13T00:25:08Z", "message": "Add tracing support for internals and JSON-RPC\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc5046744a16c4a5257df666375c98aaeb739567", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/dc5046744a16c4a5257df666375c98aaeb739567", "committedDate": "2020-11-19T01:01:17Z", "message": "Remove traces around trie tree as they slow down syncing significantly\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}, "afterCommit": {"oid": "00db98d9cc39157b007da6c0663a4320be8c2ab5", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/00db98d9cc39157b007da6c0663a4320be8c2ab5", "committedDate": "2020-11-19T01:07:28Z", "message": "Remove traces around trie tree as they slow down syncing significantly\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NDUzNDY5", "url": "https://github.com/hyperledger/besu/pull/1557#pullrequestreview-537453469", "createdAt": "2020-11-24T12:43:36Z", "commit": {"oid": "f5d47a8f0d45959a4e9ac701ebd50cfa42d8bd7f"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMjo0MzozNlrOH4_Hhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMjo1Mzo0OFrOH4_fUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUxNjQyMg==", "bodyText": "org.hyperledger instead of io.hyperledger?", "url": "https://github.com/hyperledger/besu/pull/1557#discussion_r529516422", "createdAt": "2020-11-24T12:43:36Z", "author": {"login": "shemnon"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/AbstractBlockProcessor.java", "diffHunk": "@@ -46,6 +50,9 @@ TransactionReceipt create(\n \n   private static final Logger LOG = LogManager.getLogger();\n \n+  private static final Tracer tracer =\n+      OpenTelemetry.getGlobalTracer(\"io.hyperledger.besu.block\", \"1.0.0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5d47a8f0d45959a4e9ac701ebd50cfa42d8bd7f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUxNzAwMg==", "bodyText": "org.hyperledger instead of io.hyperledger?", "url": "https://github.com/hyperledger/besu/pull/1557#discussion_r529517002", "createdAt": "2020-11-24T12:44:33Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpService.java", "diffHunk": "@@ -169,6 +198,7 @@ private JsonRpcHttpService(\n     this.authenticationService = authenticationService;\n     this.livenessService = livenessService;\n     this.readinessService = readinessService;\n+    this.tracer = OpenTelemetry.getGlobalTracer(\"io.hyperledger.besu.jsonrpc\", \"1.0.0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5d47a8f0d45959a4e9ac701ebd50cfa42d8bd7f"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUxODgxNA==", "bodyText": "Is OpenTelemetry \"always on\"?  Should there be a way for the end user to \"opt out\" like we do for other metrics collection?", "url": "https://github.com/hyperledger/besu/pull/1557#discussion_r529518814", "createdAt": "2020-11-24T12:47:31Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpService.java", "diffHunk": "@@ -279,6 +310,32 @@ private Router buildRouter() {\n     return router;\n   }\n \n+  private void createSpan(final RoutingContext routingContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5d47a8f0d45959a4e9ac701ebd50cfa42d8bd7f"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUyMDI5OQ==", "bodyText": "Ugghh... shaded jars.  Is this necessary?  They have a tendency of making security based library upgrades difficult for the shaded classes.", "url": "https://github.com/hyperledger/besu/pull/1557#discussion_r529520299", "createdAt": "2020-11-24T12:50:02Z", "author": {"login": "shemnon"}, "path": "gradle/versions.gradle", "diffHunk": "@@ -45,18 +45,21 @@ dependencyManagement {\n \n     dependency 'info.picocli:picocli:4.5.0'\n \n-    dependency 'io.grpc:grpc-netty:1.33.0'\n+    dependency 'io.grpc:grpc-netty-shaded:1.33.1'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5d47a8f0d45959a4e9ac701ebd50cfa42d8bd7f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUyMDg5NA==", "bodyText": "unneeded.  please remove.  it makes assessing the history of the file difficult.", "url": "https://github.com/hyperledger/besu/pull/1557#discussion_r529520894", "createdAt": "2020-11-24T12:51:04Z", "author": {"login": "shemnon"}, "path": "gradle/wrapper/gradle-wrapper.properties", "diffHunk": "@@ -1,5 +1,6 @@\n+#Wed Nov 18 15:38:00 PST 2020", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5d47a8f0d45959a4e9ac701ebd50cfa42d8bd7f"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUyMTc0Ng==", "bodyText": "Again, is the shaded version really necessary? I have concerns about proper security auditing.", "url": "https://github.com/hyperledger/besu/pull/1557#discussion_r529521746", "createdAt": "2020-11-24T12:52:30Z", "author": {"login": "shemnon"}, "path": "metrics/core/build.gradle", "diffHunk": "@@ -38,11 +38,12 @@ dependencies {\n   implementation project(':plugin-api')\n \n   implementation 'com.google.guava:guava'\n-  implementation 'io.grpc:grpc-netty'\n+  implementation 'io.grpc:grpc-netty-shaded'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5d47a8f0d45959a4e9ac701ebd50cfa42d8bd7f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTUyMjUxMw==", "bodyText": "org.hyperledger not io.hyperledger", "url": "https://github.com/hyperledger/besu/pull/1557#discussion_r529522513", "createdAt": "2020-11-24T12:53:48Z", "author": {"login": "shemnon"}, "path": "services/pipeline/src/main/java/org/hyperledger/besu/services/pipeline/Pipeline.java", "diffHunk": "@@ -37,6 +41,8 @@\n   private final Collection<Pipe<?>> pipes;\n   private final CompleterStage<?> completerStage;\n   private final AtomicBoolean started = new AtomicBoolean(false);\n+  private final Tracer tracer =\n+      OpenTelemetry.getGlobalTracer(\"io.hyperledger.besu.services.pipeline\", \"1.0.0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5d47a8f0d45959a4e9ac701ebd50cfa42d8bd7f"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "017596ec9bf0bbe8451c8adcfd29c86644e2cb78", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/017596ec9bf0bbe8451c8adcfd29c86644e2cb78", "committedDate": "2020-12-22T02:13:36Z", "message": "Add tracing support for internals and JSON-RPC\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ef03ea81bc325c8fd52287248ceab2d3837f8b6", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/8ef03ea81bc325c8fd52287248ceab2d3837f8b6", "committedDate": "2020-12-22T02:13:39Z", "message": "Remove rocksdb tracing as it slows down execution too much\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edea3bbcf17341f221e9863a8bfe65b2daeabd9f", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/edea3bbcf17341f221e9863a8bfe65b2daeabd9f", "committedDate": "2020-12-22T02:13:39Z", "message": "Add B3 headers extraction on JSON-RPC requests\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "710bd02930e8df051e8bd31df52210dbdfd7579b", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/710bd02930e8df051e8bd31df52210dbdfd7579b", "committedDate": "2020-12-22T02:15:51Z", "message": "Remove traces around trie tree as they slow down syncing significantly\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6efba27c7c9091d0f5e3d84cd84372a4ce7f9f93", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/6efba27c7c9091d0f5e3d84cd84372a4ce7f9f93", "committedDate": "2020-12-22T02:15:53Z", "message": "Add tracing to fast sync pipeline\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22f2e9794063b2afc1f5ea807dedb8b617ba917b", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/22f2e9794063b2afc1f5ea807dedb8b617ba917b", "committedDate": "2020-12-22T02:15:54Z", "message": "Add tracing for all pipelines\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fcc971c96320d06e3b12d6d27e7d6d449725b83", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/6fcc971c96320d06e3b12d6d27e7d6d449725b83", "committedDate": "2020-12-22T02:15:54Z", "message": "Address code review\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38a2fe3f26980e94cbd85b8d10c906f23b84f8d2", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/38a2fe3f26980e94cbd85b8d10c906f23b84f8d2", "committedDate": "2020-12-22T02:33:08Z", "message": "Add acceptance tests and break out the shaded dependency\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ccdefa7e4e7f536f8f6a7033d46e78a005e0ae0", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/6ccdefa7e4e7f536f8f6a7033d46e78a005e0ae0", "committedDate": "2020-12-22T01:42:50Z", "message": "Add acceptance tests and break out the shaded dependency\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}, "afterCommit": {"oid": "38a2fe3f26980e94cbd85b8d10c906f23b84f8d2", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/38a2fe3f26980e94cbd85b8d10c906f23b84f8d2", "committedDate": "2020-12-22T02:33:08Z", "message": "Add acceptance tests and break out the shaded dependency\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75687788ad35258bcb8d56b22cbfd4c0b11b06f6", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/75687788ad35258bcb8d56b22cbfd4c0b11b06f6", "committedDate": "2020-12-22T02:46:20Z", "message": "Fix tracer id\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8afca167e966d4ad5c731c28c96e17bf5859454", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/f8afca167e966d4ad5c731c28c96e17bf5859454", "committedDate": "2020-12-22T02:48:58Z", "message": "Revert changes to trie\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c891724bca4ff06fc69c9e1eb3c75bc78d6ce2f9", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/c891724bca4ff06fc69c9e1eb3c75bc78d6ce2f9", "committedDate": "2020-12-23T22:24:22Z", "message": "Upgrade otel to latest, remove old tracing"}, "afterCommit": {"oid": "3fccb91812f94021d6f36295759a2a3530dcd071", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/3fccb91812f94021d6f36295759a2a3530dcd071", "committedDate": "2020-12-23T22:25:00Z", "message": "Upgrade otel to latest, remove old tracing\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6f2ccd1ff097b1514448ce7fe03a7816976e848", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/c6f2ccd1ff097b1514448ce7fe03a7816976e848", "committedDate": "2020-12-23T23:26:47Z", "message": "Upgrade otel to latest, remove old tracing\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3fccb91812f94021d6f36295759a2a3530dcd071", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/3fccb91812f94021d6f36295759a2a3530dcd071", "committedDate": "2020-12-23T22:25:00Z", "message": "Upgrade otel to latest, remove old tracing\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}, "afterCommit": {"oid": "c6f2ccd1ff097b1514448ce7fe03a7816976e848", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/c6f2ccd1ff097b1514448ce7fe03a7816976e848", "committedDate": "2020-12-23T23:26:47Z", "message": "Upgrade otel to latest, remove old tracing\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMTcyMjMz", "url": "https://github.com/hyperledger/besu/pull/1557#pullrequestreview-561172233", "createdAt": "2021-01-04T16:40:11Z", "commit": {"oid": "c6f2ccd1ff097b1514448ce7fe03a7816976e848"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNjo0MDoxMVrOIN4qcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNjo0OToyOVrOIN5Bmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQzMDc2OA==", "bodyText": "Wrap these two lines inside an if (node.isMetricsEnabled() || metricsConfiguration.isPushEnabled()) { ... }", "url": "https://github.com/hyperledger/besu/pull/1557#discussion_r551430768", "createdAt": "2021-01-04T16:40:11Z", "author": {"login": "shemnon"}, "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/node/ProcessBesuNodeRunner.java", "diffHunk": "@@ -204,6 +204,8 @@ public void startNode(final BesuNode node) {\n         params.add(\"--metrics-category\");\n         params.add(((Enum<?>) category).name());\n       }\n+      params.add(\"--metrics-protocol\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6f2ccd1ff097b1514448ce7fe03a7816976e848"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQzMzgwMA==", "bodyText": "What changed so that we no longer need the java agent for OTEL?  I'm not seeing anything code-wise so I'm concerned this is an accidental deletion.", "url": "https://github.com/hyperledger/besu/pull/1557#discussion_r551433800", "createdAt": "2021-01-04T16:44:55Z", "author": {"login": "shemnon"}, "path": "build.gradle", "diffHunk": "@@ -504,19 +502,6 @@ def tweakStartScript(createScriptTask) {\n \n   createScriptTask.unixScript.text = createScriptTask.unixScript.text.replace('BESU_HOME', '\\$APP_HOME')\n   createScriptTask.windowsScript.text = createScriptTask.windowsScript.text.replace('BESU_HOME', '%~dp0..')\n-  // OpenTelemetry Wiring for unix scripts\n-  def agentFileName = configurations.javaAgent.singleFile.toPath().getFileName()\n-  def unixRegex = $/exec \"$$JAVACMD\" /$\n-  def forwardSlash = \"/\"\n-  def unixReplacement = $/if [ -n \"$$TRACING\" ];then\n- TRACING_AGENT=\"-javaagent:$$APP_HOME/agent${forwardSlash}${agentFileName}\"\n-fi\n-exec \"$$JAVACMD\" $$TRACING_AGENT /$\n-  createScriptTask.unixScript.text = createScriptTask.unixScript.text.replace(unixRegex, unixReplacement)\n-  // OpenTelemetry Wiring for windows scripts\n-  def windowsRegex = $/\"%JAVA_EXE%\" %DEFAULT_JVM_OPTS%/$\n-  def windowsReplacement = $/if Defined TRACING (TRACING_AGENT=\"-javaagent:\" \"%APP_HOME%\\agent\\/$ + agentFileName + '\")\\r\\n\"%JAVA_EXE%\" %DEFAULT_JVM_OPTS% %TRACING_AGENT%'\n-  createScriptTask.windowsScript.text = createScriptTask.windowsScript.text.replace(windowsRegex, windowsReplacement)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6f2ccd1ff097b1514448ce7fe03a7816976e848"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQzNTIxNw==", "bodyText": "Should we add counter name as a logging arg?  Same for timer and gauge.", "url": "https://github.com/hyperledger/besu/pull/1557#discussion_r551435217", "createdAt": "2021-01-04T16:47:11Z", "author": {"login": "shemnon"}, "path": "metrics/core/src/main/java/org/hyperledger/besu/metrics/opentelemetry/OpenTelemetrySystem.java", "diffHunk": "@@ -151,6 +151,7 @@ private Object extractValue(final MetricData.Type type, final MetricData.Point p\n       final String name,\n       final String help,\n       final String... labelNames) {\n+    LOG.trace(\"Creating a counter\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6f2ccd1ff097b1514448ce7fe03a7816976e848"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQzNjY5OQ==", "bodyText": "style nit:  7.0 would be less likely to be confused with hex encoded 125.", "url": "https://github.com/hyperledger/besu/pull/1557#discussion_r551436699", "createdAt": "2021-01-04T16:49:29Z", "author": {"login": "shemnon"}, "path": "metrics/core/src/test/java/org/hyperledger/besu/metrics/opentelemetry/OpenTelemetryMetricsSystemTest.java", "diffHunk": "@@ -175,12 +172,9 @@ public void shouldCreateObservationFromGauge() {\n     final ObservableMetricsSystem localMetricSystem =\n         MetricsSystemFactory.create(metricsConfiguration);\n     localMetricSystem.createGauge(RPC, \"myValue\", \"Help\", () -> 7d);\n-    List<MetricData.ValueAtPercentile> values = new ArrayList<>();\n-    values.add(MetricData.ValueAtPercentile.create(0, 7d));\n-    values.add(MetricData.ValueAtPercentile.create(100, 7d));\n \n     assertThat(localMetricSystem.streamObservations())\n-        .containsExactlyInAnyOrder(new Observation(RPC, \"myValue\", values, emptyList()));\n+        .containsExactlyInAnyOrder(new Observation(RPC, \"myValue\", 7d, emptyList()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6f2ccd1ff097b1514448ce7fe03a7816976e848"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80f73489e68e5c97d0cd0da65a3d431f720b0cc1", "author": {"user": {"login": "atoulme", "name": "Antoine Toulme"}}, "url": "https://github.com/hyperledger/besu/commit/80f73489e68e5c97d0cd0da65a3d431f720b0cc1", "committedDate": "2021-01-04T17:26:06Z", "message": "Code review comments\n\nSigned-off-by: Antoine Toulme <antoine@lunar-ocean.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2088, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}