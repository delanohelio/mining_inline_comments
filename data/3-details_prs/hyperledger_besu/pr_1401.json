{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNzE4NTE3", "number": 1401, "title": "[1340] Added check for duplicate configuration ports.", "bodyText": "Signed-off-by: Mark Terry mark.terry@consensys.net\n\n\nPR description\nAdded a check to throw an exception if duplicate port numbers are specified in the configuration.\nFixed Issue(s)\n\n\nFixes #1340\nChangelog\n\n I thought about the changelog and included a changelog update if required.", "createdAt": "2020-09-27T12:59:25Z", "url": "https://github.com/hyperledger/besu/pull/1401", "merged": true, "mergeCommit": {"oid": "959b432fd9288aa1768a9be32e284dee80ab0a8c"}, "closed": true, "closedAt": "2020-10-01T12:44:12Z", "author": {"login": "mark-terry"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdM-j-UAH2gAyNDkzNzE4NTE3OjY4MzAyNzkxYTg2MmI1NmQ5OTk5Y2ZjMTExMTcwMDRhMjc3ZTNhNWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOHrasAH2gAyNDkzNzE4NTE3OjMyYmE1MDI2OWM5M2QxZWI1MzlhN2VkNTgwNTg4N2U2NzFiYmViODI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "68302791a862b56d9999cfc11117004a277e3a5a", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/68302791a862b56d9999cfc11117004a277e3a5a", "committedDate": "2020-09-27T12:57:44Z", "message": "[1340] Added check for duplicate configuration ports.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NjcyMzY0", "url": "https://github.com/hyperledger/besu/pull/1401#pullrequestreview-497672364", "createdAt": "2020-09-28T15:55:32Z", "commit": {"oid": "68302791a862b56d9999cfc11117004a277e3a5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NTozMlrOHZFEgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTo1NTozMlrOHZFEgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA1OTUyMg==", "bodyText": "Looks like we need to special case port zero, which is designed to conflict.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          if (!allocatedPorts.add(port)) {\n          \n          \n            \n                          if (port != 0 && !allocatedPorts.add(port)) {\n          \n      \n    \n    \n  \n\nWe will also need a unit test for this.", "url": "https://github.com/hyperledger/besu/pull/1401#discussion_r496059522", "createdAt": "2020-09-28T15:55:32Z", "author": {"login": "shemnon"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -2233,6 +2238,31 @@ public EnodeDnsConfiguration getEnodeDnsConfiguration() {\n     return enodeDnsConfiguration;\n   }\n \n+  private void checkPortClash() {\n+    // List of port parameters\n+    final List<Integer> ports =\n+        asList(\n+            p2pPort,\n+            graphQLHttpPort,\n+            rpcHttpPort,\n+            rpcWsPort,\n+            metricsPort,\n+            metricsPushPort,\n+            stratumPort);\n+    ports.stream()\n+        .filter(Objects::nonNull)\n+        .forEach(\n+            port -> {\n+              if (!allocatedPorts.add(port)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68302791a862b56d9999cfc11117004a277e3a5a"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d7084cfbe7b28defcfd3af168ca9121a3e89d39", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/9d7084cfbe7b28defcfd3af168ca9121a3e89d39", "committedDate": "2020-09-29T10:41:52Z", "message": "Update besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\n\nCo-authored-by: Danno Ferrin <danno.ferrin@shemnon.com>\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0dad854c89ff506131c8e9e07535ca2b8290bc14", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/0dad854c89ff506131c8e9e07535ca2b8290bc14", "committedDate": "2020-09-29T10:40:02Z", "message": "Update besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\n\nCo-authored-by: Danno Ferrin <danno.ferrin@shemnon.com>"}, "afterCommit": {"oid": "9d7084cfbe7b28defcfd3af168ca9121a3e89d39", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/9d7084cfbe7b28defcfd3af168ca9121a3e89d39", "committedDate": "2020-09-29T10:41:52Z", "message": "Update besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\n\nCo-authored-by: Danno Ferrin <danno.ferrin@shemnon.com>\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41c4ced11cd2968ff666be23cdc2b34c5ff7cece", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/41c4ced11cd2968ff666be23cdc2b34c5ff7cece", "committedDate": "2020-09-29T13:08:28Z", "message": "Merge branch 'master' into 1340"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c347679c58cb5e64e1aaadf3dabd0ef5ffae5a4e", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/c347679c58cb5e64e1aaadf3dabd0ef5ffae5a4e", "committedDate": "2020-09-29T13:19:45Z", "message": "[1340] Added extra test for new condition.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4ODQ2NDg3", "url": "https://github.com/hyperledger/besu/pull/1401#pullrequestreview-498846487", "createdAt": "2020-09-29T20:18:07Z", "commit": {"oid": "c347679c58cb5e64e1aaadf3dabd0ef5ffae5a4e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMDoxODowN1rOHZ_mwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMDoxODowN1rOHZ_mwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAxODU2MQ==", "bodyText": "Two more tests - no ports specified and every possible port specified - p2pPort, graphQLHttpPort, rpcHttpPort, rpcWsPort, metricsPort, metricsPushPort, stratumPort", "url": "https://github.com/hyperledger/besu/pull/1401#discussion_r497018561", "createdAt": "2020-09-29T20:18:07Z", "author": {"login": "shemnon"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3672,4 +3672,17 @@ public void assertThatInvalidWsTimeoutSecondsFails() {\n     assertThat(commandErrorOutput.toString())\n         .contains(\"Invalid value for option\", \"--Xws-timeout-seconds\", \"abc\", \"is not a long\");\n   }\n+\n+  @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c347679c58cb5e64e1aaadf3dabd0ef5ffae5a4e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32ba50269c93d1eb539a7ed5805887e671bbeb82", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/32ba50269c93d1eb539a7ed5805887e671bbeb82", "committedDate": "2020-10-01T02:08:56Z", "message": "[1340] Extra tests.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2167, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}