{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzMTUyNjA3", "number": 1372, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo0NDo0MVrOEh3qHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo0ODoxMlrOEh3uRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzOTUwMzY3OnYy", "diffSide": "RIGHT", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/TransactionPool.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo0NDo0MVrOHPbYrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo0OToyNlrOHPbhFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkzOTM3NQ==", "bodyText": "I'm assuming there is some reason to go from a for loop iteration to a direct iterator.  Is it because the iterator handles the unstable collection better?", "url": "https://github.com/hyperledger/besu/pull/1372#discussion_r485939375", "createdAt": "2020-09-09T21:44:41Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/TransactionPool.java", "diffHunk": "@@ -126,12 +128,19 @@ void handleConnect(final EthPeer peer) {\n     for (final Transaction transaction : localTransactions) {\n       peerTransactionTracker.addToPeerSendQueue(peer, transaction);\n     }\n-    peerPendingTransactionTracker.ifPresent(\n+    maybePeerPendingTransactionTracker.ifPresent(\n         peerPendingTransactionTracker -> {\n           if (peerPendingTransactionTracker.isPeerSupported(peer, EthProtocol.ETH65)) {\n-            final Collection<Hash> hashes = getNewPooledHashes();\n-            for (final Hash hash : hashes) {\n-              peerPendingTransactionTracker.addToPeerSendQueue(peer, hash);\n+            Iterator<Hash> hashIterator = getNewPooledHashes().iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c4a9a6d3707b025b64e687d574605096a368c7e"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MTUyNg==", "bodyText": "As far as I know you can't catch the exception and continue over the syntactic sugar iterator.", "url": "https://github.com/hyperledger/besu/pull/1372#discussion_r485941526", "createdAt": "2020-09-09T21:49:26Z", "author": {"login": "RatanRSur"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/TransactionPool.java", "diffHunk": "@@ -126,12 +128,19 @@ void handleConnect(final EthPeer peer) {\n     for (final Transaction transaction : localTransactions) {\n       peerTransactionTracker.addToPeerSendQueue(peer, transaction);\n     }\n-    peerPendingTransactionTracker.ifPresent(\n+    maybePeerPendingTransactionTracker.ifPresent(\n         peerPendingTransactionTracker -> {\n           if (peerPendingTransactionTracker.isPeerSupported(peer, EthProtocol.ETH65)) {\n-            final Collection<Hash> hashes = getNewPooledHashes();\n-            for (final Hash hash : hashes) {\n-              peerPendingTransactionTracker.addToPeerSendQueue(peer, hash);\n+            Iterator<Hash> hashIterator = getNewPooledHashes().iterator();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkzOTM3NQ=="}, "originalCommit": {"oid": "3c4a9a6d3707b025b64e687d574605096a368c7e"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzOTUxNDMwOnYy", "diffSide": "RIGHT", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/PendingTransactions.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo0ODoxMlrOHPbe7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo1MjoxNVrOHPbl1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MDk3Mw==", "bodyText": "Why do we need to specialize this type to EveictingQueue?  Isn't iterator available in Queue via the Collection supertype?", "url": "https://github.com/hyperledger/besu/pull/1372#discussion_r485940973", "createdAt": "2020-09-09T21:48:12Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/PendingTransactions.java", "diffHunk": "@@ -67,7 +66,7 @@\n   private final int maxTransactionRetentionHours;\n   private final Clock clock;\n \n-  private final Queue<Hash> newPooledHashes;\n+  private final EvictingQueue<Hash> newPooledHashes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c4a9a6d3707b025b64e687d574605096a368c7e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0Mjc0Mw==", "bodyText": "I was just making it more specific since I was here anyways. Return specific, accept general and all that.", "url": "https://github.com/hyperledger/besu/pull/1372#discussion_r485942743", "createdAt": "2020-09-09T21:52:15Z", "author": {"login": "RatanRSur"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/PendingTransactions.java", "diffHunk": "@@ -67,7 +66,7 @@\n   private final int maxTransactionRetentionHours;\n   private final Clock clock;\n \n-  private final Queue<Hash> newPooledHashes;\n+  private final EvictingQueue<Hash> newPooledHashes;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MDk3Mw=="}, "originalCommit": {"oid": "3c4a9a6d3707b025b64e687d574605096a368c7e"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 776, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}