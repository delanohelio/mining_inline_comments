{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5NzAxNjU2", "number": 1320, "title": "Evmtool tweaks", "bodyText": "Changes to support GoEvmLabs\n\nupdate CLI docs\nallow multiple state tests via stdin\nReport \"correct\" invalid opcode when encountering an unspecified opcode\nCorrect gasCost for fixed cost operations.\nMore tracing output fields.\n\nSigned-off-by: Danno Ferrin danno.ferrin@gmail.com\nChangelog\n\n I thought about the changelog and included a changelog update if required.", "createdAt": "2020-08-18T19:41:16Z", "url": "https://github.com/hyperledger/besu/pull/1320", "merged": true, "mergeCommit": {"oid": "b4e568e0251a2fde482df446ce530423c9059b29"}, "closed": true, "closedAt": "2020-08-25T16:11:43Z", "author": {"login": "shemnon"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAHEYCgH2gAyNDY5NzAxNjU2OjA0Mzc5ZmYwMzY3MTdlODJkMmRiZGEyYTQ2MGE2OWI0NjBjMGQyMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCZULYgH2gAyNDY5NzAxNjU2OmJlZDU5NzVkNWZhMmQxODAzYjNhMzlhNDgyMzA5ZGU1MmUxOTc5YjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "04379ff036717e82d2dbda2a460a69b460c0d239", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/04379ff036717e82d2dbda2a460a69b460c0d239", "committedDate": "2020-08-18T13:31:21Z", "message": "Help Text Updates\n\nUpdate help text of the EvmTool options.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc1894dd5fc953961a5fb21504a8c1758175344f", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/fc1894dd5fc953961a5fb21504a8c1758175344f", "committedDate": "2020-08-18T18:52:18Z", "message": "Merge branch 'master' of github.com:hyperledger/besu into evmTool\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52eea73d4d4b972334a445a5c6e4a0100a1cf718", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/52eea73d4d4b972334a445a5c6e4a0100a1cf718", "committedDate": "2020-08-18T19:25:07Z", "message": "Allow multiple tests via standard input\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5ODUwNDkw", "url": "https://github.com/hyperledger/besu/pull/1320#pullrequestreview-469850490", "createdAt": "2020-08-18T21:41:05Z", "commit": {"oid": "52eea73d4d4b972334a445a5c6e4a0100a1cf718"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "282edd50737d64bfe988bae5b1a3c9740462cac1", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/282edd50737d64bfe988bae5b1a3c9740462cac1", "committedDate": "2020-08-19T17:56:44Z", "message": "Fix  memory expansion bounds checking\n\nWhen a CALL series operation has an erroneous input offset (such as\nstarting at a ETH address instead of a real offset) we threw an\nArithmeticException.\n\n* Restore the old memory bounds checking on memory expansion\n* Treat these formerly uncaught exceptions as invalid transactions and\n  report errors with a stack trace and custom halt reason.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bfc4279e823f1afaa11de13393464e15b50afcc", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/2bfc4279e823f1afaa11de13393464e15b50afcc", "committedDate": "2020-08-19T18:52:40Z", "message": "spotless\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a88837609887f794779a0c3c40a4bf6d58be2db2", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/a88837609887f794779a0c3c40a4bf6d58be2db2", "committedDate": "2020-08-19T18:54:42Z", "message": "Merge branch 'memoryExpansion' into evmtool\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d48cc31819abbf9ece16ebec6109ff42abb1fbe7", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/d48cc31819abbf9ece16ebec6109ff42abb1fbe7", "committedDate": "2020-08-19T23:36:58Z", "message": "align output format with evmlab expectations\n\nre-order calls, and re-work some operations so that oepration cost is\nincluded in exceptions when they cost can be known (such as fixed costs\nor failures unrelated to stack underflow).\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df640521bde89cb0f9bbb06f0c4deb94cc00cae6", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/df640521bde89cb0f9bbb06f0c4deb94cc00cae6", "committedDate": "2020-08-20T13:46:12Z", "message": "Merge branch 'master' into evmtool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24211a701c4493fa9793ac6a1d69b9c004045b8e", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/24211a701c4493fa9793ac6a1d69b9c004045b8e", "committedDate": "2020-08-20T14:10:01Z", "message": "don't lose invalid opcode in trace\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59ff3fae2562d9c901ba4d9d257c3f20db854c65", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/59ff3fae2562d9c901ba4d9d257c3f20db854c65", "committedDate": "2020-08-20T15:54:06Z", "message": "fix unit test\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd0facf00ace6ceafc0d00747df28dcb2b71f0fc", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/dd0facf00ace6ceafc0d00747df28dcb2b71f0fc", "committedDate": "2020-08-20T16:33:21Z", "message": "Merge branch 'master' into evmtool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaf35c51ec95bacc17d0f7a676247a9138c4e895", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/aaf35c51ec95bacc17d0f7a676247a9138c4e895", "committedDate": "2020-08-20T16:37:41Z", "message": "Merge branch 'master' into evmtool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2455a8351144aead542e9db3e1e2ce8745d825b", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/d2455a8351144aead542e9db3e1e2ce8745d825b", "committedDate": "2020-08-23T14:44:55Z", "message": "Merge branch 'master' into evmtool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e65bf52002b78f7d9ac2da8a224ea783b1ecdc36", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/e65bf52002b78f7d9ac2da8a224ea783b1ecdc36", "committedDate": "2020-08-24T19:46:25Z", "message": "move unsingined into to a long\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8031ce9e8214d9350c0e1db3afacbce0f6793582", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/8031ce9e8214d9350c0e1db3afacbce0f6793582", "committedDate": "2020-08-24T19:50:46Z", "message": "different cast\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8ed96a6a04867ce1766cf416e612d53b60642e6", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/a8ed96a6a04867ce1766cf416e612d53b60642e6", "committedDate": "2020-08-24T19:58:35Z", "message": "wire in `--nomemory` to state test tool.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NTQyNDI1", "url": "https://github.com/hyperledger/besu/pull/1320#pullrequestreview-474542425", "createdAt": "2020-08-25T14:32:09Z", "commit": {"oid": "a8ed96a6a04867ce1766cf416e612d53b60642e6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDozMjowOVrOHGbAkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDozOToyOVrOHGbWoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NjAxNw==", "bodyText": "shouldn't we check the \"top-offset\" bounds rather than just offset?", "url": "https://github.com/hyperledger/besu/pull/1320#discussion_r476496017", "createdAt": "2020-08-25T14:32:09Z", "author": {"login": "matkt"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/vm/FixedStack.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.vm;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+\n+import java.lang.reflect.Array;\n+import java.util.Arrays;\n+\n+/**\n+ * An operand stack for the Ethereum Virtual machine (EVM).\n+ *\n+ * <p>The operand stack is responsible for storing the current operands that the EVM can execute. It\n+ * is assumed to have a fixed size.\n+ */\n+public class FixedStack<T> {\n+\n+  private final T[] entries;\n+\n+  private final int maxSize;\n+\n+  private int top;\n+\n+  public static class UnderflowException extends RuntimeException {\n+    // Don't create a stack trace since these are not \"errors\" per say but are using exceptions to\n+    // throw rare control flow conditions (EVM stack overflow) that are expected to be seen in\n+    // normal\n+    // operations.\n+    @Override\n+    public synchronized Throwable fillInStackTrace() {\n+      return this;\n+    }\n+  }\n+\n+  public static class OverflowException extends RuntimeException {\n+    // Don't create a stack trace since these are not \"errors\" per say but are using exceptions to\n+    // throw rare control flow conditions (EVM stack overflow) that are expected to be seen in\n+    // normal\n+    // operations.\n+    @Override\n+    public synchronized Throwable fillInStackTrace() {\n+      return this;\n+    }\n+  }\n+\n+  @SuppressWarnings(\"unchecked\")\n+  public FixedStack(final int maxSize, final Class<T> klass) {\n+    checkArgument(maxSize >= 0, \"max size must be non-negative\");\n+\n+    this.entries = (T[]) Array.newInstance(klass, maxSize);\n+    this.maxSize = maxSize;\n+    this.top = -1;\n+  }\n+\n+  public T get(final int offset) {\n+    if (offset < 0 || offset >= size()) {\n+      throw new IndexOutOfBoundsException();\n+    }\n+\n+    return entries[top - offset];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8ed96a6a04867ce1766cf416e612d53b60642e6"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUwMTY2NA==", "bodyText": "I don't understand why this test had to be modified \ud83e\udd14", "url": "https://github.com/hyperledger/besu/pull/1320#discussion_r476501664", "createdAt": "2020-08-25T14:39:29Z", "author": {"login": "matkt"}, "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/vm/operations/BeginSubOperationTest.java", "diffHunk": "@@ -95,6 +94,6 @@ public void shouldHaltWithInvalidSubRoutineEntryWhenBeginSubIsExecuted() {\n     frame.setPC(CURRENT_PC);\n     final OperationResult result = operation.execute(frame, null);\n \n-    assertThat(result.getHaltReason()).contains(ExceptionalHaltReason.INVALID_SUB_ROUTINE_ENTRY);\n+    assertThat(result.getHaltReason()).isNotEmpty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8ed96a6a04867ce1766cf416e612d53b60642e6"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ed3739f485c902d290eaef941d4c56bcef5c290", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/2ed3739f485c902d290eaef941d4c56bcef5c290", "committedDate": "2020-08-25T14:43:23Z", "message": "change failure mode we are checking for\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NTU4OTY0", "url": "https://github.com/hyperledger/besu/pull/1320#pullrequestreview-474558964", "createdAt": "2020-08-25T14:48:51Z", "commit": {"oid": "2ed3739f485c902d290eaef941d4c56bcef5c290"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bed5975d5fa2d1803b3a39a482309de52e1979b4", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/bed5975d5fa2d1803b3a39a482309de52e1979b4", "committedDate": "2020-08-25T15:54:45Z", "message": "Merge branch 'master' into evmtool"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1469, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}