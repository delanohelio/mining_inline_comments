{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMjIzMzQw", "number": 670, "title": "[EIP-1559] Step 6 - Enforce the per transaction gas limit", "bodyText": "PR description\nWe should enforce the per transaction gas limit, as specified by the EIP, to 8,000,000 gas.\n\nAdded a TransactionInvalidReason: EXCEEDS_PER_TRANSACTION_GAS_LIMIT\nUpdate the validate method in MainnetTransactionValidator to enforce this check.\nUpdate the validation process in MainnetBlockBodyValidator to enforce this check for all transactions within a block.\n\nFixed Issue(s)\n\n\nfixes #599\nSigned-off-by: Abdelhamid Bakhta abdelhamid.bakhta@consensys.net", "createdAt": "2020-04-07T12:00:51Z", "url": "https://github.com/hyperledger/besu/pull/670", "merged": true, "mergeCommit": {"oid": "bb74a4288fc1171456fe8c1e7ec10ca905889bcf"}, "closed": true, "closedAt": "2020-04-09T16:01:37Z", "author": {"login": "abdelhamidbakhta"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM4BqCAH2gAyNDAwMjIzMzQwOmJhMzdmZDBlZmNiYTJkZTRlYTM0Yzk3OTA2MGZmMzYxYTFmZTk3OTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcV-eZ8gFqTM5MDkxMzgzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ba37fd0efcba2de4ea34c979060ff361a1fe9798", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ba37fd0efcba2de4ea34c979060ff361a1fe9798", "committedDate": "2020-03-12T09:09:40Z", "message": "Added changelog entries for PR:\n- https://github.com/hyperledger/besu/pull/430\n- https://github.com/hyperledger/besu/pull/440\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "872f9cc4e93b90829961ebe6e599c51af43c95a7", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/872f9cc4e93b90829961ebe6e599c51af43c95a7", "committedDate": "2020-03-13T08:25:43Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>\n\n# Conflicts:\n#\tCHANGELOG.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e417b30e90cb0b33940adb1bee6a9dc8953c4abd", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e417b30e90cb0b33940adb1bee6a9dc8953c4abd", "committedDate": "2020-03-16T09:10:11Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2fb831c87dae221c92a9f9ec7705500717f1e77", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/a2fb831c87dae221c92a9f9ec7705500717f1e77", "committedDate": "2020-03-17T09:17:25Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c07ed7de515e1e25ea22ef38b59bf8337086812e", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/c07ed7de515e1e25ea22ef38b59bf8337086812e", "committedDate": "2020-03-17T15:26:18Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c1e22fe5a81e6a748b338a2ebedaaa53a00f04d", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/1c1e22fe5a81e6a748b338a2ebedaaa53a00f04d", "committedDate": "2020-03-18T08:29:25Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee10a2590d8e23b95a40c946a2927730714c4793", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ee10a2590d8e23b95a40c946a2927730714c4793", "committedDate": "2020-03-19T16:27:54Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40cd31d7b48aab7b285524661ac17168c0d38467", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/40cd31d7b48aab7b285524661ac17168c0d38467", "committedDate": "2020-03-23T10:35:38Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e96c01a8ca248ded2aa4f22a6f56d9119cabebf2", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e96c01a8ca248ded2aa4f22a6f56d9119cabebf2", "committedDate": "2020-03-25T08:04:10Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c782ba4617a68e42def01737bdc6950ff7f9f53", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/2c782ba4617a68e42def01737bdc6950ff7f9f53", "committedDate": "2020-03-31T09:26:18Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b7f62d00c53ed1e8de940bffc675fad31825ba2", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/8b7f62d00c53ed1e8de940bffc675fad31825ba2", "committedDate": "2020-04-02T11:50:21Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce2a4c9a0d600f1309fc1a6e3be8c3d04c0e543a", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ce2a4c9a0d600f1309fc1a6e3be8c3d04c0e543a", "committedDate": "2020-04-03T08:45:52Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97fc9b5900c05a3f4c18183e1b861fd86b6152b6", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/97fc9b5900c05a3f4c18183e1b861fd86b6152b6", "committedDate": "2020-04-06T10:50:47Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95947ab35e9145c5f788bb98ad1068a3db7a4895", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/95947ab35e9145c5f788bb98ad1068a3db7a4895", "committedDate": "2020-04-06T12:24:48Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8c4e9921430b8a06f8bb882bc9ce4975ce5579b", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e8c4e9921430b8a06f8bb882bc9ce4975ce5579b", "committedDate": "2020-04-06T15:33:44Z", "message": "Implement gas limit and gas price block header validation rules as per specified in EIP-1559\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e911532ffe39cc3d159d29fa8e99b7506fdcf168", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e911532ffe39cc3d159d29fa8e99b7506fdcf168", "committedDate": "2020-04-07T08:15:04Z", "message": "Merge branch 'master' into eip1559-step5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fb289299c04b4afc774b74c51b5ed15ad63882f", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/9fb289299c04b4afc774b74c51b5ed15ad63882f", "committedDate": "2020-04-07T09:00:06Z", "message": "Merge branch 'master' into eip1559-step5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c521cef761d09abb3aee753bf5207fac9574bf87", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/c521cef761d09abb3aee753bf5207fac9574bf87", "committedDate": "2020-04-07T11:18:43Z", "message": "Merge remote-tracking branch 'upstream/master' into eip1559-step5\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa2f839d1218a684625a616a76754af216510221", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/aa2f839d1218a684625a616a76754af216510221", "committedDate": "2020-04-07T11:19:02Z", "message": "Merge branch 'eip1559-step5' of https://github.com/abdelhamidbakhta/besu into eip1559-step5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5899116effcd29e2ce4d33b33f9017dff0471ef4", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/5899116effcd29e2ce4d33b33f9017dff0471ef4", "committedDate": "2020-04-07T11:58:55Z", "message": "We should enforce the per transaction gas limit, as specified by the EIP, to 8,000,000 gas.\nAdd a `TransactionInvalidReason`\nUpdate the `validate` method in `MainnetTransactionValidator` to enforce this check.\nUpdate the validation process in `MainnetBlockBodyValidator` to enforce this check for all transactions within a block.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c01b0e3bc72247e7120147d876cefdf1802fd2a4", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/c01b0e3bc72247e7120147d876cefdf1802fd2a4", "committedDate": "2020-04-07T12:23:54Z", "message": "fix unit test\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29878ceb5401ae7a0af41a3d57e0c4f475b34912", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/29878ceb5401ae7a0af41a3d57e0c4f475b34912", "committedDate": "2020-04-07T16:31:20Z", "message": "Merge branch 'master' into eip1559-step6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfc87ab071b76e6e8abaae598b0b68e770987d57", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/cfc87ab071b76e6e8abaae598b0b68e770987d57", "committedDate": "2020-04-09T08:04:29Z", "message": "Merge remote-tracking branch 'upstream/master' into eip1559-step6\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>\n\n# Conflicts:\n#\tethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetProtocolSpecs.java\n#\tethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/ProtocolSpecBuilder.java\n#\tethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/headervalidationrules/EIP1559BlockHeaderGasLimitValidationRule.java\n#\tethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/headervalidationrules/EIP1559BlockHeaderGasPriceValidationRule.java\n#\tethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/headervalidationrules/EIP1559BlockHeaderGasLimitValidationRuleTest.java\n#\tethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/headervalidationrules/EIP1559BlockHeaderGasPriceValidationRuleTest.java"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "589e2575b2a046e9ef2355e2cac3833cb8da15cf", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/589e2575b2a046e9ef2355e2cac3833cb8da15cf", "committedDate": "2020-04-08T08:50:03Z", "message": "Merge branch 'master' into eip1559-step6"}, "afterCommit": {"oid": "cfc87ab071b76e6e8abaae598b0b68e770987d57", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/cfc87ab071b76e6e8abaae598b0b68e770987d57", "committedDate": "2020-04-09T08:04:29Z", "message": "Merge remote-tracking branch 'upstream/master' into eip1559-step6\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>\n\n# Conflicts:\n#\tethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetProtocolSpecs.java\n#\tethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/ProtocolSpecBuilder.java\n#\tethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/headervalidationrules/EIP1559BlockHeaderGasLimitValidationRule.java\n#\tethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/headervalidationrules/EIP1559BlockHeaderGasPriceValidationRule.java\n#\tethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/headervalidationrules/EIP1559BlockHeaderGasLimitValidationRuleTest.java\n#\tethereum/core/src/test/java/org/hyperledger/besu/ethereum/mainnet/headervalidationrules/EIP1559BlockHeaderGasPriceValidationRuleTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1003315c3d59b84fc1ac948fdea265ef92fa4d93", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/1003315c3d59b84fc1ac948fdea265ef92fa4d93", "committedDate": "2020-04-09T09:48:17Z", "message": "Merge branch 'master' into eip1559-step6"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTAzOTYw", "url": "https://github.com/hyperledger/besu/pull/670#pullrequestreview-390903960", "createdAt": "2020-04-09T15:34:00Z", "commit": {"oid": "1003315c3d59b84fc1ac948fdea265ef92fa4d93"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNTozNDowMFrOGDeHZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNTozNDowMFrOGDeHZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI5MjMyNQ==", "bodyText": "Why do we need the blockNumber?  We get a separate TransactionValidator per fork, so either EIP 1559 will be configured because it applies in that fork or it won't be present because it wasn't configured. It's all kept in the ProtocolSchedule.  I think we should do without it.", "url": "https://github.com/hyperledger/besu/pull/670#discussion_r406292325", "createdAt": "2020-04-09T15:34:00Z", "author": {"login": "shemnon"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/MainnetTransactionValidator.java", "diffHunk": "@@ -40,24 +42,46 @@\n   private final Optional<BigInteger> chainId;\n \n   private Optional<TransactionFilter> transactionFilter = Optional.empty();\n+  private final Optional<EIP1559> maybeEip1559;\n \n   public MainnetTransactionValidator(\n       final GasCalculator gasCalculator,\n       final boolean checkSignatureMalleability,\n       final Optional<BigInteger> chainId) {\n+    this(gasCalculator, checkSignatureMalleability, chainId, Optional.empty());\n+  }\n+\n+  public MainnetTransactionValidator(\n+      final GasCalculator gasCalculator,\n+      final boolean checkSignatureMalleability,\n+      final Optional<BigInteger> chainId,\n+      final Optional<EIP1559> maybeEip1559) {\n     this.gasCalculator = gasCalculator;\n     this.disallowSignatureMalleability = checkSignatureMalleability;\n     this.chainId = chainId;\n+    this.maybeEip1559 = maybeEip1559;\n   }\n \n   @Override\n-  public ValidationResult<TransactionInvalidReason> validate(final Transaction transaction) {\n+  public ValidationResult<TransactionInvalidReason> validate(\n+      final Transaction transaction, final long blockNumber) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1003315c3d59b84fc1ac948fdea265ef92fa4d93"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57d70f632d340202b3c645d176cbed7724e04487", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/57d70f632d340202b3c645d176cbed7724e04487", "committedDate": "2020-04-09T15:43:07Z", "message": "Removed blockNumber from TransactionValidator.validate\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTEzODMy", "url": "https://github.com/hyperledger/besu/pull/670#pullrequestreview-390913832", "createdAt": "2020-04-09T15:45:49Z", "commit": {"oid": "57d70f632d340202b3c645d176cbed7724e04487"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1689, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}