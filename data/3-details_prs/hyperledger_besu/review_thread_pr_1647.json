{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNjc1OTQy", "number": 1647, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMjozNzoyOFrOE_bLCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMjo0MTo1NlrOE_bOxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0OTQwOTM3OnYy", "diffSide": "RIGHT", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMjozNzoyOFrOH9IBnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMzoyOTo1OFrOH9JBSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1NjY3MQ==", "bodyText": "what needs to happen if it is not present?", "url": "https://github.com/hyperledger/besu/pull/1647#discussion_r533856671", "createdAt": "2020-12-02T02:37:28Z", "author": {"login": "pinges"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1404,6 +1404,16 @@ private void validateGoQuorumCompatibilityModeParam() {\n         throw new IllegalStateException(\n             \"GoQuorum compatibility mode (enabled) can only be used if genesis file has 'isQuorum' flag set to true.\");\n       }\n+      genesisConfigOptions\n+          .getChainId()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "784d8a9698e20e2bb707413ce65c932666fba6da"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1ODkxNQ==", "bodyText": "if you don't specify chainId in genesis, it uses network if provided (cmd line) and if not provided then it's mainnet", "url": "https://github.com/hyperledger/besu/pull/1647#discussion_r533858915", "createdAt": "2020-12-02T02:44:50Z", "author": {"login": "macfarla"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1404,6 +1404,16 @@ private void validateGoQuorumCompatibilityModeParam() {\n         throw new IllegalStateException(\n             \"GoQuorum compatibility mode (enabled) can only be used if genesis file has 'isQuorum' flag set to true.\");\n       }\n+      genesisConfigOptions\n+          .getChainId()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1NjY3MQ=="}, "originalCommit": {"oid": "784d8a9698e20e2bb707413ce65c932666fba6da"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg2MDYwNQ==", "bodyText": "the validation against chainId is in a different place to network (because we don't read genesis file until later) but it might make sense to to them both later, together, to make it easier to read", "url": "https://github.com/hyperledger/besu/pull/1647#discussion_r533860605", "createdAt": "2020-12-02T02:49:57Z", "author": {"login": "macfarla"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1404,6 +1404,16 @@ private void validateGoQuorumCompatibilityModeParam() {\n         throw new IllegalStateException(\n             \"GoQuorum compatibility mode (enabled) can only be used if genesis file has 'isQuorum' flag set to true.\");\n       }\n+      genesisConfigOptions\n+          .getChainId()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1NjY3MQ=="}, "originalCommit": {"oid": "784d8a9698e20e2bb707413ce65c932666fba6da"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg3Mjk2OA==", "bodyText": "refactored into a single method", "url": "https://github.com/hyperledger/besu/pull/1647#discussion_r533872968", "createdAt": "2020-12-02T03:29:58Z", "author": {"login": "macfarla"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1404,6 +1404,16 @@ private void validateGoQuorumCompatibilityModeParam() {\n         throw new IllegalStateException(\n             \"GoQuorum compatibility mode (enabled) can only be used if genesis file has 'isQuorum' flag set to true.\");\n       }\n+      genesisConfigOptions\n+          .getChainId()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1NjY3MQ=="}, "originalCommit": {"oid": "784d8a9698e20e2bb707413ce65c932666fba6da"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0OTQxODk0OnYy", "diffSide": "RIGHT", "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMjo0MTo1NlrOH9IHLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwMzoxNTo0NlrOH9Ivzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1ODA5Mg==", "bodyText": "Could you use the valid quorum genesis file here with chainId 1?", "url": "https://github.com/hyperledger/besu/pull/1647#discussion_r533858092", "createdAt": "2020-12-02T02:41:56Z", "author": {"login": "pinges"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3963,4 +3972,31 @@ public void quorumInteropEnabledSucceedsWithGasPriceSetToZero() throws IOExcepti\n         \"0\");\n     assertThat(commandErrorOutput.toString()).isEmpty();\n   }\n+\n+  @Test\n+  public void quorumInteropEnabledFailsWithMainnetDefaultNetwork() throws IOException {\n+    final Path genesisFile = createFakeGenesisFile(INVALID_GENESIS_QUORUM_INTEROP_ENABLED_MAINNET);\n+    parseCommand(\n+        \"--goquorum-compatibility-enabled\",\n+        \"--genesis-file\",\n+        genesisFile.toString(),\n+        \"--min-gas-price\",\n+        \"0\");\n+    assertThat(commandErrorOutput.toString())\n+        .contains(\"GoQuorum compatibility mode (enabled) cannot be used on Mainnet\");\n+  }\n+\n+  @Test\n+  public void quorumInteropEnabledFailsWithMainnetChainId() throws IOException {\n+    final Path genesisFile =\n+        createFakeGenesisFile(INVALID_GENESIS_QUORUM_INTEROP_ENABLED_MAINNET.put(\"chainId\", \"1\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "784d8a9698e20e2bb707413ce65c932666fba6da"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1OTMxOQ==", "bodyText": "yes that would work", "url": "https://github.com/hyperledger/besu/pull/1647#discussion_r533859319", "createdAt": "2020-12-02T02:46:04Z", "author": {"login": "macfarla"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3963,4 +3972,31 @@ public void quorumInteropEnabledSucceedsWithGasPriceSetToZero() throws IOExcepti\n         \"0\");\n     assertThat(commandErrorOutput.toString()).isEmpty();\n   }\n+\n+  @Test\n+  public void quorumInteropEnabledFailsWithMainnetDefaultNetwork() throws IOException {\n+    final Path genesisFile = createFakeGenesisFile(INVALID_GENESIS_QUORUM_INTEROP_ENABLED_MAINNET);\n+    parseCommand(\n+        \"--goquorum-compatibility-enabled\",\n+        \"--genesis-file\",\n+        genesisFile.toString(),\n+        \"--min-gas-price\",\n+        \"0\");\n+    assertThat(commandErrorOutput.toString())\n+        .contains(\"GoQuorum compatibility mode (enabled) cannot be used on Mainnet\");\n+  }\n+\n+  @Test\n+  public void quorumInteropEnabledFailsWithMainnetChainId() throws IOException {\n+    final Path genesisFile =\n+        createFakeGenesisFile(INVALID_GENESIS_QUORUM_INTEROP_ENABLED_MAINNET.put(\"chainId\", \"1\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1ODA5Mg=="}, "originalCommit": {"oid": "784d8a9698e20e2bb707413ce65c932666fba6da"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg2ODQ5NA==", "bodyText": "but it's used in two spots (and the other one doesn't add chainId) so I think it's clearer to use the constant", "url": "https://github.com/hyperledger/besu/pull/1647#discussion_r533868494", "createdAt": "2020-12-02T03:15:46Z", "author": {"login": "macfarla"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3963,4 +3972,31 @@ public void quorumInteropEnabledSucceedsWithGasPriceSetToZero() throws IOExcepti\n         \"0\");\n     assertThat(commandErrorOutput.toString()).isEmpty();\n   }\n+\n+  @Test\n+  public void quorumInteropEnabledFailsWithMainnetDefaultNetwork() throws IOException {\n+    final Path genesisFile = createFakeGenesisFile(INVALID_GENESIS_QUORUM_INTEROP_ENABLED_MAINNET);\n+    parseCommand(\n+        \"--goquorum-compatibility-enabled\",\n+        \"--genesis-file\",\n+        genesisFile.toString(),\n+        \"--min-gas-price\",\n+        \"0\");\n+    assertThat(commandErrorOutput.toString())\n+        .contains(\"GoQuorum compatibility mode (enabled) cannot be used on Mainnet\");\n+  }\n+\n+  @Test\n+  public void quorumInteropEnabledFailsWithMainnetChainId() throws IOException {\n+    final Path genesisFile =\n+        createFakeGenesisFile(INVALID_GENESIS_QUORUM_INTEROP_ENABLED_MAINNET.put(\"chainId\", \"1\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1ODA5Mg=="}, "originalCommit": {"oid": "784d8a9698e20e2bb707413ce65c932666fba6da"}, "originalPosition": 75}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1385, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}