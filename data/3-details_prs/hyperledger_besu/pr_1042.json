{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3Nzg4MDA2", "number": 1042, "title": "Detect zombies backend query and abort useless processing.", "bodyText": "PR description\nThe timeout handler populate the request context with a boolean value indicating whether or not the query is alive, i.e the HTTP request has not expired. Backend queries are now conditioned by this value and can be stopped if needed.\nThis PR experiments this mechanism on a reduced scope. Hence, only backend queries triggered by eth_getLogs RPC endpoint are affected. Websocket and GraphQL support have been added as well.\n\nCreated BackendQuery utility class to run a process only if the query is alive, i.e timeout not expired.\nPut Supplier<Boolean> reference in the JsonRpcRequestContext\nTimeoutHandler sets the alive value to false if the timeout handler is triggered.\nUpdated BlockchainQueries to run steps depending on the value of the AtomicBoolean retrieved from the request context.\nAdded unit tests.\n\nSigned-off-by: Abdelhamid Bakhta abdelhamid.bakhta@consensys.net\nTesting\n\n\n\nItem\nManual tests\nUnit tests\nAcceptance tests\n\n\n\n\nJSON RPC\n*\n\n\n\n\nGRAPHQL\n*\n\n\n\n\nWEB SOCKET\n*\n\n\n\n\n\nNotes\nManual testing of web socket has been performed using web3j.\nThe timeout has been voluntarily set to a small value (3 seconds) for testing purpose. The EthGetLogs has also been updated to sleep for 4 seconds in order to trigger the timeout. This testing code has not been pushed and will not be found during the code review.\nSample code\nWebSocketClient webSocketClient = new WebSocketClient(new URI(\"ws://localhost:8546/\"));\nWebSocketService webSocketService =\n          new WebSocketService(webSocketClient, true);\nwebSocketService.connect();\nRequest<?, EthLog> request =\n          new Request<>(\n              \"eth_getLogs\",\n              Arrays.asList(new FilterParameter()),\n              webSocketService,\n              EthLog.class);\n// Send an asynchronous request via WebSocket protocol\nCompletableFuture<EthLog> reply = webSocketService.sendAsync(request, EthLog.class);\n// Get result of the reply\nEthLog logs = reply.get();\nSample response\n{\n  \"id\": 0,\n  \"jsonrpc\": \"2.0\",\n  \"error\": {\n    \"code\": -32603,\n    \"message\": \"Timeout expired\"\n  },\n  \"rawResponse\": \"\"\n}\nLogging\nBesu must log the following line:\nWARN  | BackendQuery | Zombie backend query detected [ unnamed ], aborting process.\nERROR | BlockchainQueries | Error retrieving matching logs\n\nFixed Issue(s)\nAddresses #944\nSigned-off-by: Abdelhamid Bakhta abdelhamid.bakhta@consensys.net", "createdAt": "2020-06-04T12:03:26Z", "url": "https://github.com/hyperledger/besu/pull/1042", "merged": true, "mergeCommit": {"oid": "903afdedd634e8255be2ff3a54b937cddbd7376d"}, "closed": true, "closedAt": "2020-06-17T08:44:55Z", "author": {"login": "abdelhamidbakhta"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoBgmdABqjM0MDc5NjA5NjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsFrhogFqTQzMjE3OTgzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0cf2c487c3de76311271e8078a5a9d61cfb01c02", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/0cf2c487c3de76311271e8078a5a9d61cfb01c02", "committedDate": "2020-06-04T12:10:51Z", "message": "Reset default timeout value.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}, "afterCommit": {"oid": "952938264dfd1425713bc9b3bcebee94ec2c6eea", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/952938264dfd1425713bc9b3bcebee94ec2c6eea", "committedDate": "2020-06-04T17:28:02Z", "message": "Reset default timeout value.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79abafaf4731e4991cb9c6ccaa9a30da7c79e882", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/79abafaf4731e4991cb9c6ccaa9a30da7c79e882", "committedDate": "2020-06-11T13:17:55Z", "message": "Detect zombies backend query and abort useless processing.\nThe timeout handler populate the request context with a boolean value indicating whether or not the query is alive, i.e the HTTP request has not expired. Backend queries are now conditioned by this value and can be stopped if needed.\nThis PR experiments this mechanism on a reduced scope. Hence, only `eth_getLogs` backend queries are affected.\n\n- Created `BackendQuery` utility class to run a process only if the query is alive, i.e timeout not expired.\n- Put `AtomicBoolean` value in the `JsonRpcRequestContext`\n- `TimeoutHandler` sets the alive value to `false` if the timeout handler is triggered.\n- Updated `BlockchainQueries` to run steps depending on the value of the `AtomicBoolean` retrieved from the request context.\n- Added unit tests.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df8ae42a0b87263aca5775098955ef08e40b7dbe", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/df8ae42a0b87263aca5775098955ef08e40b7dbe", "committedDate": "2020-06-11T13:17:55Z", "message": "Reset default timeout value.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd49e39281b92d0a271f212795e67971a252fd29", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/dd49e39281b92d0a271f212795e67971a252fd29", "committedDate": "2020-06-11T13:17:55Z", "message": "Add named queries\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c250197a6ba84a048b440f45b8a205e1adfc072", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/7c250197a6ba84a048b440f45b8a205e1adfc072", "committedDate": "2020-06-11T13:17:55Z", "message": "Spotless apply\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e8b856ab82dc7f61b770760e5c9529886b7af52", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/0e8b856ab82dc7f61b770760e5c9529886b7af52", "committedDate": "2020-06-11T11:57:48Z", "message": "Merge remote-tracking branch 'upstream/master' into timeout-queries\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}, "afterCommit": {"oid": "7c250197a6ba84a048b440f45b8a205e1adfc072", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/7c250197a6ba84a048b440f45b8a205e1adfc072", "committedDate": "2020-06-11T13:17:55Z", "message": "Spotless apply\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db4f54674e32373b8890d1ac0f77ab5c6ac4d1e1", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/db4f54674e32373b8890d1ac0f77ab5c6ac4d1e1", "committedDate": "2020-06-11T16:16:31Z", "message": "Merge remote-tracking branch 'upstream/master' into timeout-queries\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MDY0NjY1", "url": "https://github.com/hyperledger/besu/pull/1042#pullrequestreview-429064665", "createdAt": "2020-06-11T16:04:06Z", "commit": {"oid": "7c250197a6ba84a048b440f45b8a205e1adfc072"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNjowNDowNlrOGikZ1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNjoxNTozOVrOGik2DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkwMTIwNw==", "bodyText": "We will want to add the zombie thread killer to graphql as well, so it may be worth a comment that the AtomicBoolean(true) prevents the query from self-terminating.", "url": "https://github.com/hyperledger/besu/pull/1042#discussion_r438901207", "createdAt": "2020-06-11T16:04:06Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/graphql/GraphQLDataFetchers.java", "diffHunk": "@@ -238,7 +239,8 @@ public GraphQLDataFetchers(final Set<Capability> supportedCapabilities) {\n       final LogsQuery query =\n           new LogsQuery.Builder().addresses(addrs).topics(transformedTopics).build();\n \n-      final List<LogWithMetadata> logs = blockchainQuery.matchingLogs(fromBlock, toBlock, query);\n+      final List<LogWithMetadata> logs =\n+          blockchainQuery.matchingLogs(fromBlock, toBlock, query, new AtomicBoolean(true));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c250197a6ba84a048b440f45b8a205e1adfc072"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkwMTM0Nw==", "bodyText": "same comment as in GraphQLDataFetchers", "url": "https://github.com/hyperledger/besu/pull/1042#discussion_r438901347", "createdAt": "2020-06-11T16:04:20Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/graphql/internal/pojoadapter/BlockAdapterBase.java", "diffHunk": "@@ -164,7 +165,8 @@\n     final BlockchainQueries blockchain = getBlockchainQueries(environment);\n \n     final Hash hash = header.getHash();\n-    final List<LogWithMetadata> logs = blockchain.matchingLogs(hash, query);\n+    final List<LogWithMetadata> logs =\n+        blockchain.matchingLogs(hash, query, new AtomicBoolean(true));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c250197a6ba84a048b440f45b8a205e1adfc072"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkwMzMyMw==", "bodyText": "Should this be renamed to be more generic?  asAtomicBoolean or fetchAsAtomicBoolean?", "url": "https://github.com/hyperledger/besu/pull/1042#discussion_r438903323", "createdAt": "2020-06-11T16:07:34Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/context/ContextKey.java", "diffHunk": "@@ -14,15 +14,21 @@\n  */\n package org.hyperledger.besu.ethereum.api.jsonrpc.context;\n \n+import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.function.Supplier;\n \n import io.vertx.ext.web.RoutingContext;\n \n public enum ContextKey {\n-  REQUEST_BODY_AS_JSON_OBJECT;\n+  REQUEST_BODY_AS_JSON_OBJECT,\n+  ALIVE;\n \n   public <T> T extractFrom(final RoutingContext ctx, final Supplier<T> defaultSupplier) {\n     final T value = ctx.get(this.name());\n     return value != null ? value : defaultSupplier.get();\n   }\n+\n+  public AtomicBoolean isAlive(final RoutingContext ctx) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c250197a6ba84a048b440f45b8a205e1adfc072"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkwODQyOQ==", "bodyText": "Would a Supplier<Boolean> also work?  we could pass in a lambda that goes () -> ctx.response().closed()  (or () -> true for always alive or when we don't have the request context) and not have to worry about keeping another variable state in sync.", "url": "https://github.com/hyperledger/besu/pull/1042#discussion_r438908429", "createdAt": "2020-06-11T16:15:39Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/JsonRpcRequestContext.java", "diffHunk": "@@ -16,25 +16,38 @@\n \n import java.util.Objects;\n import java.util.Optional;\n+import java.util.concurrent.atomic.AtomicBoolean;\n \n import io.vertx.ext.auth.User;\n \n public class JsonRpcRequestContext {\n \n   private final JsonRpcRequest jsonRpcRequest;\n   private final Optional<User> user;\n+  private final AtomicBoolean alive;\n \n   public JsonRpcRequestContext(final JsonRpcRequest jsonRpcRequest) {\n-    this(jsonRpcRequest, Optional.empty());\n+    this(jsonRpcRequest, new AtomicBoolean(true));\n+  }\n+\n+  public JsonRpcRequestContext(final JsonRpcRequest jsonRpcRequest, final AtomicBoolean alive) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c250197a6ba84a048b440f45b8a205e1adfc072"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eaff4b962612416e97ca9ad3079253d15d80a697", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/eaff4b962612416e97ca9ad3079253d15d80a697", "committedDate": "2020-06-11T17:51:59Z", "message": "Address PR comments\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6bcd19732396c340f4cc1373bc8856742296b8b", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/c6bcd19732396c340f4cc1373bc8856742296b8b", "committedDate": "2020-06-12T11:02:05Z", "message": "Address PR comments\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "133cd991e542d00f1c7f8c049593a1e8451897d6", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/133cd991e542d00f1c7f8c049593a1e8451897d6", "committedDate": "2020-06-12T12:25:03Z", "message": "Address PR comments\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMzMwOTEy", "url": "https://github.com/hyperledger/besu/pull/1042#pullrequestreview-430330912", "createdAt": "2020-06-15T05:29:43Z", "commit": {"oid": "133cd991e542d00f1c7f8c049593a1e8451897d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwNToyOTo0M1rOGjjpiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwNToyOTo0M1rOGjjpiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzNzQxOQ==", "bodyText": "Not a fan of using an exception when we can just check a boolean and exit the method.  The real question is what does the resulting JSON response look like when we throw?  If it looks like what we want the users to see then an exception will read better than a check and return error code segment in the calling RPC method.", "url": "https://github.com/hyperledger/besu/pull/1042#discussion_r439937419", "createdAt": "2020-06-15T05:29:43Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/query/BackendQuery.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.query;\n+\n+import java.util.Optional;\n+import java.util.concurrent.Callable;\n+import java.util.function.Supplier;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+public class BackendQuery {\n+  private static final Logger LOG = LogManager.getLogger();\n+\n+  public static <T> T runIfAlive(final Callable<T> task, final Supplier<Boolean> alive)\n+      throws Exception {\n+    return runIfAlive(Optional.empty(), task, alive);\n+  }\n+\n+  public static <T> T runIfAlive(\n+      final String taskName, final Callable<T> task, final Supplier<Boolean> alive)\n+      throws Exception {\n+    return runIfAlive(Optional.ofNullable(taskName), task, alive);\n+  }\n+\n+  public static <T> T runIfAlive(\n+      final Optional<String> taskName, final Callable<T> task, final Supplier<Boolean> alive)\n+      throws Exception {\n+    if (!alive.get()) {\n+      LOG.warn(\n+          \"Zombie backend query detected [ {} ], aborting process.\", taskName.orElse(\"unnamed\"));\n+      throw new RuntimeException(\"Timeout expired\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "133cd991e542d00f1c7f8c049593a1e8451897d6"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "253a435485944a91b82dbb361efccd731f6a6ab7", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/253a435485944a91b82dbb361efccd731f6a6ab7", "committedDate": "2020-06-15T06:58:44Z", "message": "Merge remote-tracking branch 'upstream/master' into timeout-queries\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "241588c9c12370dd4d486fdb22e4aba63e32c649", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/241588c9c12370dd4d486fdb22e4aba63e32c649", "committedDate": "2020-06-15T09:15:38Z", "message": "Merge remote-tracking branch 'upstream/master' into timeout-queries\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89b1b8a76e42c33eae5da117e9616efbbb4132c7", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/89b1b8a76e42c33eae5da117e9616efbbb4132c7", "committedDate": "2020-06-16T11:11:19Z", "message": "Merge remote-tracking branch 'upstream/master' into timeout-queries\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e05283046bf0bd1db79fb3459e54a3432284d99a", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e05283046bf0bd1db79fb3459e54a3432284d99a", "committedDate": "2020-06-16T12:47:00Z", "message": "Add websocket timeout support.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e255b3d4303fa17ffc4b47e612b5288c0a66120f", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e255b3d4303fa17ffc4b47e612b5288c0a66120f", "committedDate": "2020-06-16T14:25:55Z", "message": "Add websocket timeout support.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee819c7f41a23371c165836e68ba3c7cbcdb9323", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ee819c7f41a23371c165836e68ba3c7cbcdb9323", "committedDate": "2020-06-16T14:38:01Z", "message": "Merge remote-tracking branch 'upstream/master' into timeout-queries\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc9434492f4d0aeb5c5cb3a5f66bc06efcfad79f", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/dc9434492f4d0aeb5c5cb3a5f66bc06efcfad79f", "committedDate": "2020-06-16T17:07:46Z", "message": "Add graphql timeout support.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c21e4f63ead287301f9255fbc9c9ff08678d81b3", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/c21e4f63ead287301f9255fbc9c9ff08678d81b3", "committedDate": "2020-06-16T17:08:25Z", "message": "Merge remote-tracking branch 'upstream/master' into timeout-queries\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMDU2ODc0", "url": "https://github.com/hyperledger/besu/pull/1042#pullrequestreview-432056874", "createdAt": "2020-06-17T04:52:32Z", "commit": {"oid": "c21e4f63ead287301f9255fbc9c9ff08678d81b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNDo1MjozMlrOGk1jCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNDo1MjozMlrOGk1jCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI3OTI0Mw==", "bodyText": "Rather than a decorator perhaps a copy constructor on the old GraphQLDataContext that copies old fields but uses a passed-in isAliveHandler?  Less class files and less indirection.", "url": "https://github.com/hyperledger/besu/pull/1042#discussion_r441279243", "createdAt": "2020-06-17T04:52:32Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/graphql/GraphQLDataFetcherContextDecorator.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.graphql;\n+\n+import org.hyperledger.besu.ethereum.api.handlers.IsAliveHandler;\n+import org.hyperledger.besu.ethereum.api.query.BlockchainQueries;\n+import org.hyperledger.besu.ethereum.blockcreation.MiningCoordinator;\n+import org.hyperledger.besu.ethereum.core.Synchronizer;\n+import org.hyperledger.besu.ethereum.eth.transactions.TransactionPool;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSchedule;\n+\n+public class GraphQLDataFetcherContextDecorator implements GraphQLDataFetcherContext {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c21e4f63ead287301f9255fbc9c9ff08678d81b3"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3239579be568b3a9ceee0164b98c677a66f71670", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/3239579be568b3a9ceee0164b98c677a66f71670", "committedDate": "2020-06-17T06:49:15Z", "message": "Merge remote-tracking branch 'upstream/master' into timeout-queries\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "870eb9ec43251c685fa6b42889901fa474be4d57", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/870eb9ec43251c685fa6b42889901fa474be4d57", "committedDate": "2020-06-17T06:54:29Z", "message": "Address PR comments\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ba270d1b3c6d19b31272f90d64a0086c4d5226d", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/3ba270d1b3c6d19b31272f90d64a0086c4d5226d", "committedDate": "2020-06-17T07:14:15Z", "message": "Use EthScheduler instead of newSingleThreadScheduledExecutor to trigger timeout delayed task.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adf86fab9fdbb6ee2a85b7a50305338d51358bfd", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/adf86fab9fdbb6ee2a85b7a50305338d51358bfd", "committedDate": "2020-06-17T07:41:02Z", "message": "Fix javadoc\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e81fff7a29f71618880dd9e982d7e012c2f3d805", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e81fff7a29f71618880dd9e982d7e012c2f3d805", "committedDate": "2020-06-17T07:59:49Z", "message": "Merge remote-tracking branch 'upstream/master' into timeout-queries\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMTc5ODMy", "url": "https://github.com/hyperledger/besu/pull/1042#pullrequestreview-432179832", "createdAt": "2020-06-17T08:35:49Z", "commit": {"oid": "e81fff7a29f71618880dd9e982d7e012c2f3d805"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1570, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}