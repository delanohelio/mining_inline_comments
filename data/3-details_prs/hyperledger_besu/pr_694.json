{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNDk1OTEz", "number": 694, "title": "[EIP-1559] Step 7 - Check transaction format for send raw transaction", "bodyText": "PR description\nWe must check format of transactions received on the EthSendRawTransaction  JSON RPC API.\nWe must reject legacy transactions if EIP-1559 is finalized.\nWe must reject EIP-1559 transactions if feature flag is not enabled or if current block is not post EIP-1559.\n\nUpdated EIP1559 manager: added isValid method to check whether or not if a transaction is valid according EIP-1559 rules.\nUpdated EthSendRawTransaction : call EIP1559.isValid against the decoded transaction if the EIP feature flag is enabled\n\nFixed Issue(s)\n\n\nfixes #691\nSigned-off-by: Abdelhamid Bakhta abdelhamid.bakhta@consensys.net", "createdAt": "2020-04-09T15:35:38Z", "url": "https://github.com/hyperledger/besu/pull/694", "merged": true, "mergeCommit": {"oid": "5a5f4eb49c42e65761e111001f6561288abea69e"}, "closed": true, "closedAt": "2020-04-10T07:33:58Z", "author": {"login": "abdelhamidbakhta"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM4BqCAH2gAyNDAxNDk1OTEzOmJhMzdmZDBlZmNiYTJkZTRlYTM0Yzk3OTA2MGZmMzYxYTFmZTk3OTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWLiV8gH2gAyNDAxNDk1OTEzOjY0ZmE5YTQ2MzBhZjQ0MDQ0YmRmZGYwYzMwMTA5NTg4YWYyMzI3MGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ba37fd0efcba2de4ea34c979060ff361a1fe9798", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ba37fd0efcba2de4ea34c979060ff361a1fe9798", "committedDate": "2020-03-12T09:09:40Z", "message": "Added changelog entries for PR:\n- https://github.com/hyperledger/besu/pull/430\n- https://github.com/hyperledger/besu/pull/440\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "872f9cc4e93b90829961ebe6e599c51af43c95a7", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/872f9cc4e93b90829961ebe6e599c51af43c95a7", "committedDate": "2020-03-13T08:25:43Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>\n\n# Conflicts:\n#\tCHANGELOG.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e417b30e90cb0b33940adb1bee6a9dc8953c4abd", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e417b30e90cb0b33940adb1bee6a9dc8953c4abd", "committedDate": "2020-03-16T09:10:11Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2fb831c87dae221c92a9f9ec7705500717f1e77", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/a2fb831c87dae221c92a9f9ec7705500717f1e77", "committedDate": "2020-03-17T09:17:25Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c07ed7de515e1e25ea22ef38b59bf8337086812e", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/c07ed7de515e1e25ea22ef38b59bf8337086812e", "committedDate": "2020-03-17T15:26:18Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c1e22fe5a81e6a748b338a2ebedaaa53a00f04d", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/1c1e22fe5a81e6a748b338a2ebedaaa53a00f04d", "committedDate": "2020-03-18T08:29:25Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee10a2590d8e23b95a40c946a2927730714c4793", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ee10a2590d8e23b95a40c946a2927730714c4793", "committedDate": "2020-03-19T16:27:54Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40cd31d7b48aab7b285524661ac17168c0d38467", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/40cd31d7b48aab7b285524661ac17168c0d38467", "committedDate": "2020-03-23T10:35:38Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e96c01a8ca248ded2aa4f22a6f56d9119cabebf2", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e96c01a8ca248ded2aa4f22a6f56d9119cabebf2", "committedDate": "2020-03-25T08:04:10Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c782ba4617a68e42def01737bdc6950ff7f9f53", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/2c782ba4617a68e42def01737bdc6950ff7f9f53", "committedDate": "2020-03-31T09:26:18Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b7f62d00c53ed1e8de940bffc675fad31825ba2", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/8b7f62d00c53ed1e8de940bffc675fad31825ba2", "committedDate": "2020-04-02T11:50:21Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce2a4c9a0d600f1309fc1a6e3be8c3d04c0e543a", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ce2a4c9a0d600f1309fc1a6e3be8c3d04c0e543a", "committedDate": "2020-04-03T08:45:52Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97fc9b5900c05a3f4c18183e1b861fd86b6152b6", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/97fc9b5900c05a3f4c18183e1b861fd86b6152b6", "committedDate": "2020-04-06T10:50:47Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95947ab35e9145c5f788bb98ad1068a3db7a4895", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/95947ab35e9145c5f788bb98ad1068a3db7a4895", "committedDate": "2020-04-06T12:24:48Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63cc0286ffd370cf8e82ede9066b2bd473536ce1", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/63cc0286ffd370cf8e82ede9066b2bd473536ce1", "committedDate": "2020-04-07T11:27:43Z", "message": "Merge branch 'master' of https://github.com/hyperledger/besu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c836959d7bf7da960ebe4e063016f1f191e1467", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/6c836959d7bf7da960ebe4e063016f1f191e1467", "committedDate": "2020-04-09T07:57:49Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9ff23076dd7eded030cc3edb315086c67d6ce70", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/f9ff23076dd7eded030cc3edb315086c67d6ce70", "committedDate": "2020-04-09T11:17:24Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60df7f8825f51f3c6b89274c59cec13ea8ce37fd", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/60df7f8825f51f3c6b89274c59cec13ea8ce37fd", "committedDate": "2020-04-09T15:25:47Z", "message": "Check transaction format for send raw transaction\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTExNTgw", "url": "https://github.com/hyperledger/besu/pull/694#pullrequestreview-390911580", "createdAt": "2020-04-09T15:43:09Z", "commit": {"oid": "60df7f8825f51f3c6b89274c59cec13ea8ce37fd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNTo0MzowOVrOGDefTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNTo0MzowOVrOGDefTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI5ODQ0NA==", "bodyText": "This feels like it should be in MainnetTransactionValidator instead, with two new constructor args.  If we get a third format we can go to an enum set or bitfield.  As part of validate(final Transaction transaction) we check the valid types against the booleans or enum set/bitfield.  Perhaps we need to define two forks for testing, EIP1559 and EIP1559Only", "url": "https://github.com/hyperledger/besu/pull/694#discussion_r406298444", "createdAt": "2020-04-09T15:43:09Z", "author": {"login": "shemnon"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/fees/EIP1559.java", "diffHunk": "@@ -76,6 +79,23 @@ public long getForkBlock() {\n     return initialForkBlknum;\n   }\n \n+  public boolean isValid(final Transaction transaction, final LongSupplier blockNumberSupplier) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60df7f8825f51f3c6b89274c59cec13ea8ce37fd"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c322f1b670347b389848ab7c325ce7e43a6876e", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/5c322f1b670347b389848ab7c325ce7e43a6876e", "committedDate": "2020-04-09T16:02:22Z", "message": "Merge remote-tracking branch 'upstream/master' into eip1559-step7\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee56b8c0703b94a3e0beeb0de8a228d1998becea", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ee56b8c0703b94a3e0beeb0de8a228d1998becea", "committedDate": "2020-04-09T16:40:06Z", "message": "Address PR comments\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTYxMjYy", "url": "https://github.com/hyperledger/besu/pull/694#pullrequestreview-390961262", "createdAt": "2020-04-09T16:46:26Z", "commit": {"oid": "ee56b8c0703b94a3e0beeb0de8a228d1998becea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjo0NjoyNlrOGDg5Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNjo0NjoyNlrOGDg5Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMzNzgzOA==", "bodyText": "I don't think we need any of this logic in the RPC stub. MainnetTransacitonValidator should be catching it when we try and addLocalTransaction.  The RPC stub should have no knowledge of the internals of the block chain.", "url": "https://github.com/hyperledger/besu/pull/694#discussion_r406337838", "createdAt": "2020-04-09T16:46:26Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/EthSendRawTransaction.java", "diffHunk": "@@ -99,4 +114,26 @@ private Transaction decodeRawTransaction(final String hash)\n       throw new InvalidJsonRpcRequestException(\"Invalid raw transaction hex\", e);\n     }\n   }\n+\n+  private Transaction checkEIP1559(final Transaction transaction)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee56b8c0703b94a3e0beeb0de8a228d1998becea"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e68cc2980a5078936e80231958ce5dd8c2fac289", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e68cc2980a5078936e80231958ce5dd8c2fac289", "committedDate": "2020-04-09T16:59:40Z", "message": "Address PR comments\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db1d528ab341f2d1189a04197f1eed5ee959b47b", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/db1d528ab341f2d1189a04197f1eed5ee959b47b", "committedDate": "2020-04-09T16:59:48Z", "message": "Merge remote-tracking branch 'upstream/master' into eip1559-step7\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMDE1ODM1", "url": "https://github.com/hyperledger/besu/pull/694#pullrequestreview-391015835", "createdAt": "2020-04-09T18:04:15Z", "commit": {"oid": "db1d528ab341f2d1189a04197f1eed5ee959b47b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxODowNDoxNVrOGDjnAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxODowNDoxNVrOGDjnAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM4MjMzOA==", "bodyText": "This can be removed.", "url": "https://github.com/hyperledger/besu/pull/694#discussion_r406382338", "createdAt": "2020-04-09T18:04:15Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/EthSendRawTransactionTest.java", "diffHunk": "@@ -42,7 +43,7 @@\n   private static final String VALID_TRANSACTION =\n       \"0xf86d0485174876e800830222e0945aae326516b4f8fe08074b7e972e40a713048d62880de0b6b3a7640000801ba05d4e7998757264daab67df2ce6f7e7a0ae36910778a406ca73898c9899a32b9ea0674700d5c3d1d27f2e6b4469957dfd1a1c49bf92383d80717afc84eb05695d5b\";\n   @Mock private TransactionPool transactionPool;\n-\n+  @Mock private BlockchainQueries blockchainQueries;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db1d528ab341f2d1189a04197f1eed5ee959b47b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64fa9a4630af44044bdfdf0c30109588af23270f", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/64fa9a4630af44044bdfdf0c30109588af23270f", "committedDate": "2020-04-10T06:58:53Z", "message": "remove EthSendRawTransactionTest.blokchainQueries field\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1708, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}