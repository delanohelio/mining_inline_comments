{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MDM0MjA1", "number": 407, "title": "[PIE-2303] Automatic log bloom caching - Remove usage of pending file.", "bodyText": "PR description\nSince we use mutable files for the cache we can directly cache log blooms in the proper cache file.\nThe location of the cache file is deterministic based on the cache directory and the block number.\nThe block number is used to get the index in the binary file to write to.\nFixed Issue(s)\n\n\nPIE-2303\nSigned-off-by: Abdelhamid Bakhta abdelhamid.bakhta@consensys.net", "createdAt": "2020-02-17T09:38:28Z", "url": "https://github.com/hyperledger/besu/pull/407", "merged": true, "mergeCommit": {"oid": "c38152abf0b1ae5573a4221975cb281dbd76fc9c"}, "closed": true, "closedAt": "2020-02-17T14:15:56Z", "author": {"login": "abdelhamidbakhta"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFKCsnAH2gAyMzc2MDM0MjA1OmQ1NzZmYzRlYTJlMjRjMTNiZmMzY2I1ZDgxZGNhZjM1ODBiOTIyODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFOA1QgFqTM1OTc2NDM3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d576fc4ea2e24c13bfc3cb5d81dcaf3580b92283", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/d576fc4ea2e24c13bfc3cb5d81dcaf3580b92283", "committedDate": "2020-02-17T09:37:42Z", "message": "Don't use pending file.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6de9fa9d7fa4edaec21776c66d6dca90c7d101ea", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/6de9fa9d7fa4edaec21776c66d6dca90c7d101ea", "committedDate": "2020-02-17T09:43:16Z", "message": "Don't use pending file.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NzU2ODQ0", "url": "https://github.com/hyperledger/besu/pull/407#pullrequestreview-359756844", "createdAt": "2020-02-17T14:04:28Z", "commit": {"oid": "6de9fa9d7fa4edaec21776c66d6dca90c7d101ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNDowNDoyOFrOFqljdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNDowNDoyOFrOFqljdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE5OTc5Ng==", "bodyText": "Why did ensureChecks get introduced? Performance reasons?", "url": "https://github.com/hyperledger/besu/pull/407#discussion_r380199796", "createdAt": "2020-02-17T14:04:28Z", "author": {"login": "RatanRSur"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/query/TransactionLogBloomCacher.java", "diffHunk": "@@ -134,15 +126,19 @@ private long fillCacheFile(\n       cachingStatus.currentBlock = blockNum;\n       blockNum++;\n     }\n-    return blockNum - startBlock;\n   }\n \n-  public void cacheLogsBloomForBlockHeader(final BlockHeader blockHeader) {\n+  public void cacheLogsBloomForBlockHeader(\n+      final BlockHeader blockHeader,\n+      final Optional<File> reusedCacheFile,\n+      final boolean ensureChecks) {\n     try {\n       final long blockNumber = blockHeader.getNumber();\n       LOG.debug(\"Caching logs bloom for block {}.\", \"0x\" + Long.toHexString(blockNumber));\n-      ensurePreviousSegmentsArePresent(blockNumber);\n-      final File cacheFile = calculateCacheFileName(blockNumber, cacheDir);\n+      if (ensureChecks) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6de9fa9d7fa4edaec21776c66d6dca90c7d101ea"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NzY0Mzc0", "url": "https://github.com/hyperledger/besu/pull/407#pullrequestreview-359764374", "createdAt": "2020-02-17T14:15:17Z", "commit": {"oid": "6de9fa9d7fa4edaec21776c66d6dca90c7d101ea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1777, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}