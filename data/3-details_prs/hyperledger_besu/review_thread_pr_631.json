{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MDA5OTI0", "number": 631, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToyNDozNlrODtrFKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToyNjo1NFrODtrITQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjE4MzQ2OnYy", "diffSide": "RIGHT", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/BlockPropagationManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToyNDozN1rOF_PQWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxODo0MjoyMVrOGAjk8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1NDU1Mg==", "bodyText": "My concern with short hashes is then we cannot go to etherscan from the log.  I do this fairly frequently when analyzing short lived forks.\nPerhaps put the peers not at the end and making the other numbers fixed width?", "url": "https://github.com/hyperledger/besu/pull/631#discussion_r401854552", "createdAt": "2020-04-01T19:24:37Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/BlockPropagationManager.java", "diffHunk": "@@ -341,16 +341,23 @@ private void broadcastBlock(final Block block, final BlockHeader parent) {\n                     block.getHash());\n               } else {\n                 final double timeInS = importTask.getTaskTimeInSec();\n+                final String blockHash = block.getHash().toHexString();\n+                final String shortHash =\n+                    String.format(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bd50239f0f6e4a479c2d7be3804122f736bf9ce"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA5ODk5Ng==", "bodyText": "What about printing out an additional debug level log info with the full hash? My impression is that the full details are too much on info log level.", "url": "https://github.com/hyperledger/besu/pull/631#discussion_r402098996", "createdAt": "2020-04-02T07:15:52Z", "author": {"login": "q9f"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/BlockPropagationManager.java", "diffHunk": "@@ -341,16 +341,23 @@ private void broadcastBlock(final Block block, final BlockHeader parent) {\n                     block.getHash());\n               } else {\n                 final double timeInS = importTask.getTaskTimeInSec();\n+                final String blockHash = block.getHash().toHexString();\n+                final String shortHash =\n+                    String.format(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1NDU1Mg=="}, "originalCommit": {"oid": "0bd50239f0f6e4a479c2d7be3804122f736bf9ce"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIzNjA4Mw==", "bodyText": "Debug is very noisy.  Besu has had it at info since we started logging these lines.", "url": "https://github.com/hyperledger/besu/pull/631#discussion_r403236083", "createdAt": "2020-04-03T18:42:21Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/BlockPropagationManager.java", "diffHunk": "@@ -341,16 +341,23 @@ private void broadcastBlock(final Block block, final BlockHeader parent) {\n                     block.getHash());\n               } else {\n                 final double timeInS = importTask.getTaskTimeInSec();\n+                final String blockHash = block.getHash().toHexString();\n+                final String shortHash =\n+                    String.format(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1NDU1Mg=="}, "originalCommit": {"oid": "0bd50239f0f6e4a479c2d7be3804122f736bf9ce"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjE5MTQ5OnYy", "diffSide": "RIGHT", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/fullsync/FullImportBlockStep.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToyNjo1NFrOF_PVVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToyNjo1NFrOF_PVVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1NTgzMA==", "bodyText": "short hash here is fine.", "url": "https://github.com/hyperledger/besu/pull/631#discussion_r401855830", "createdAt": "2020-04-01T19:26:54Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/fullsync/FullImportBlockStep.java", "diffHunk": "@@ -30,23 +31,37 @@\n   private static final Logger LOG = LogManager.getLogger();\n   private final ProtocolSchedule<C> protocolSchedule;\n   private final ProtocolContext<C> protocolContext;\n+  private final EthContext ethContext;\n \n   public FullImportBlockStep(\n-      final ProtocolSchedule<C> protocolSchedule, final ProtocolContext<C> protocolContext) {\n+      final ProtocolSchedule<C> protocolSchedule,\n+      final ProtocolContext<C> protocolContext,\n+      final EthContext ethContext) {\n     this.protocolSchedule = protocolSchedule;\n     this.protocolContext = protocolContext;\n+    this.ethContext = ethContext;\n   }\n \n   @Override\n   public void accept(final Block block) {\n     final long blockNumber = block.getHeader().getNumber();\n+    final String blockHash = block.getHash().toHexString();\n+    final String shortHash =\n+        String.format(\n+            \"%s..%s\",\n+            blockHash.substring(0, 6),\n+            blockHash.substring(blockHash.length() - 4, blockHash.length()));\n     final BlockImporter<C> importer =\n         protocolSchedule.getByBlockNumber(blockNumber).getBlockImporter();\n     if (!importer.importBlock(protocolContext, block, HeaderValidationMode.SKIP_DETACHED)) {\n       throw new InvalidBlockException(\"Failed to import block\", blockNumber, block.getHash());\n     }\n     if (blockNumber % 200 == 0) {\n-      LOG.info(\"Import reached block {}\", blockNumber);\n+      LOG.info(\n+          \"Import reached block {} ({}), Peers: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bd50239f0f6e4a479c2d7be3804122f736bf9ce"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1015, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}