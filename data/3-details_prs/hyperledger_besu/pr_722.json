{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNzI5MDUy", "number": 722, "title": "[EIP-1559] Step 8 - Disable GasLimitRangeAndDeltaValidationRule and update ProofOfWorkValidationRule", "bodyText": "For post EIP-1559 blocks we must disable GasLimitRangeAndDeltaValidationRule.\nWe must also update ProofOfWorkValidationRule to include base fee field in the hash computation.\nWe must add gas limit and gas price rules for ommer blocks.\nThe rules are:\n\nEIP1559BlockHeaderGasLimitValidationRule\nEIP1559BlockHeaderGasPriceValidationRule\n\nFixed Issue(s)\nfixes #707 #718 #720\nSigned-off-by: Abdelhamid Bakhta abdelhamid.bakhta@consensys.net", "createdAt": "2020-04-15T12:27:40Z", "url": "https://github.com/hyperledger/besu/pull/722", "merged": true, "mergeCommit": {"oid": "4a8f9996d9d3c59ced73188650efa14c6ff42326"}, "closed": true, "closedAt": "2020-04-16T15:40:54Z", "author": {"login": "abdelhamidbakhta"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM4BqCAH2gAyNDAzNzI5MDUyOmJhMzdmZDBlZmNiYTJkZTRlYTM0Yzk3OTA2MGZmMzYxYTFmZTk3OTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYOYJxgH2gAyNDAzNzI5MDUyOjk5NTVkMmJjNTlhNzA2NWE0YmIxZTNjYmUxODk3MjBjZDE5NzU1NDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ba37fd0efcba2de4ea34c979060ff361a1fe9798", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ba37fd0efcba2de4ea34c979060ff361a1fe9798", "committedDate": "2020-03-12T09:09:40Z", "message": "Added changelog entries for PR:\n- https://github.com/hyperledger/besu/pull/430\n- https://github.com/hyperledger/besu/pull/440\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "872f9cc4e93b90829961ebe6e599c51af43c95a7", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/872f9cc4e93b90829961ebe6e599c51af43c95a7", "committedDate": "2020-03-13T08:25:43Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>\n\n# Conflicts:\n#\tCHANGELOG.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e417b30e90cb0b33940adb1bee6a9dc8953c4abd", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e417b30e90cb0b33940adb1bee6a9dc8953c4abd", "committedDate": "2020-03-16T09:10:11Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2fb831c87dae221c92a9f9ec7705500717f1e77", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/a2fb831c87dae221c92a9f9ec7705500717f1e77", "committedDate": "2020-03-17T09:17:25Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c07ed7de515e1e25ea22ef38b59bf8337086812e", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/c07ed7de515e1e25ea22ef38b59bf8337086812e", "committedDate": "2020-03-17T15:26:18Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c1e22fe5a81e6a748b338a2ebedaaa53a00f04d", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/1c1e22fe5a81e6a748b338a2ebedaaa53a00f04d", "committedDate": "2020-03-18T08:29:25Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee10a2590d8e23b95a40c946a2927730714c4793", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ee10a2590d8e23b95a40c946a2927730714c4793", "committedDate": "2020-03-19T16:27:54Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40cd31d7b48aab7b285524661ac17168c0d38467", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/40cd31d7b48aab7b285524661ac17168c0d38467", "committedDate": "2020-03-23T10:35:38Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e96c01a8ca248ded2aa4f22a6f56d9119cabebf2", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e96c01a8ca248ded2aa4f22a6f56d9119cabebf2", "committedDate": "2020-03-25T08:04:10Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c782ba4617a68e42def01737bdc6950ff7f9f53", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/2c782ba4617a68e42def01737bdc6950ff7f9f53", "committedDate": "2020-03-31T09:26:18Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b7f62d00c53ed1e8de940bffc675fad31825ba2", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/8b7f62d00c53ed1e8de940bffc675fad31825ba2", "committedDate": "2020-04-02T11:50:21Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce2a4c9a0d600f1309fc1a6e3be8c3d04c0e543a", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ce2a4c9a0d600f1309fc1a6e3be8c3d04c0e543a", "committedDate": "2020-04-03T08:45:52Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97fc9b5900c05a3f4c18183e1b861fd86b6152b6", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/97fc9b5900c05a3f4c18183e1b861fd86b6152b6", "committedDate": "2020-04-06T10:50:47Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95947ab35e9145c5f788bb98ad1068a3db7a4895", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/95947ab35e9145c5f788bb98ad1068a3db7a4895", "committedDate": "2020-04-06T12:24:48Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63cc0286ffd370cf8e82ede9066b2bd473536ce1", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/63cc0286ffd370cf8e82ede9066b2bd473536ce1", "committedDate": "2020-04-07T11:27:43Z", "message": "Merge branch 'master' of https://github.com/hyperledger/besu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c836959d7bf7da960ebe4e063016f1f191e1467", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/6c836959d7bf7da960ebe4e063016f1f191e1467", "committedDate": "2020-04-09T07:57:49Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9ff23076dd7eded030cc3edb315086c67d6ce70", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/f9ff23076dd7eded030cc3edb315086c67d6ce70", "committedDate": "2020-04-09T11:17:24Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96433d65c57730d87d7aa2a9fed64d14b80dee53", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/96433d65c57730d87d7aa2a9fed64d14b80dee53", "committedDate": "2020-04-10T07:44:03Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd1c9b9145b1e73914ccec65ea3720f579277c38", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/dd1c9b9145b1e73914ccec65ea3720f579277c38", "committedDate": "2020-04-14T07:16:12Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1a337a155e846bb02c693f26ff96a2fe642f61d", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/a1a337a155e846bb02c693f26ff96a2fe642f61d", "committedDate": "2020-04-14T09:02:58Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f258611fa3e3429acffe627a90298a0bfaedc69b", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/f258611fa3e3429acffe627a90298a0bfaedc69b", "committedDate": "2020-04-14T11:40:59Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec0f09a79e9c09a18f385e489fc56a2595158c7d", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ec0f09a79e9c09a18f385e489fc56a2595158c7d", "committedDate": "2020-04-15T10:51:15Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cdeea1b13f545e2c82c8fb479185e4af66a312f", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/9cdeea1b13f545e2c82c8fb479185e4af66a312f", "committedDate": "2020-04-15T12:25:49Z", "message": "For post EIP-1559 blocks we must disable GasLimitRangeAndDeltaValidationRule.\nWe must also update ProofOfWorkValidationRule to include base fee field in the hash computation.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a15a7304608116913f9f752f23277d00ebe2133", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/5a15a7304608116913f9f752f23277d00ebe2133", "committedDate": "2020-04-15T13:25:17Z", "message": "Rename logger\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5ca0b142c8ca2521e977d6c403e9f42e879848e", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/c5ca0b142c8ca2521e977d6c403e9f42e879848e", "committedDate": "2020-04-15T13:25:40Z", "message": "Rename logger\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33be1bb1a52096b8080c97743debeffa55096467", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/33be1bb1a52096b8080c97743debeffa55096467", "committedDate": "2020-04-15T15:00:25Z", "message": "Merge branch 'master' into 720"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc01da3ad40b4af4ce6eda8877255b111cfcee5d", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/dc01da3ad40b4af4ce6eda8877255b111cfcee5d", "committedDate": "2020-04-15T15:19:10Z", "message": "Fix base fee computation and add tests.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df457cea4d99ed09586d12c125661f3ff64ca289", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/df457cea4d99ed09586d12c125661f3ff64ca289", "committedDate": "2020-04-15T15:19:40Z", "message": "Merge branch '720' of https://github.com/abdelhamidbakhta/besu into 720"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MjMxNjAy", "url": "https://github.com/hyperledger/besu/pull/722#pullrequestreview-394231602", "createdAt": "2020-04-16T01:00:06Z", "commit": {"oid": "df457cea4d99ed09586d12c125661f3ff64ca289"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMTowMDowNlrOGGQxyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwMTowMjowNVrOGGQzug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIxOTUyOQ==", "bodyText": "If we are to include the basefee shouldn't we require the header have the base fee?  Or does the spec allow it to be absent?  i.e. if we include base fee should an absent base fee be marked as invalid?", "url": "https://github.com/hyperledger/besu/pull/722#discussion_r409219529", "createdAt": "2020-04-16T01:00:06Z", "author": {"login": "shemnon"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/headervalidationrules/ProofOfWorkValidationRule.java", "diffHunk": "@@ -95,6 +106,10 @@ Hash hashHeader(final BlockHeader header) {\n     out.writeLongScalar(header.getGasUsed());\n     out.writeLongScalar(header.getTimestamp());\n     out.writeBytes(header.getExtraData());\n+    if (includeBaseFee && header.getBaseFee().isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df457cea4d99ed09586d12c125661f3ff64ca289"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTIyMDAyNg==", "bodyText": "Does the basefee increase always at an increment or does it scale per the over/under?  I think a test case where we have the same parent fee but 5 gas used (way more, more, same, less, way less) would be good here to show that whatever the case is.", "url": "https://github.com/hyperledger/besu/pull/722#discussion_r409220026", "createdAt": "2020-04-16T01:02:05Z", "author": {"login": "shemnon"}, "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/core/fees/EIP1559BaseFeeTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.core.fees;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.hyperledger.besu.config.experimental.ExperimentalEIPs;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import org.junit.runners.Parameterized.Parameters;\n+\n+@RunWith(Parameterized.class)\n+public class EIP1559BaseFeeTest {\n+\n+  private static final long FORK_BLOCK = 783L;\n+  private final EIP1559 eip1559 = new EIP1559(FORK_BLOCK);\n+\n+  @Parameters\n+  public static Collection<Object[]> data() {\n+    return Arrays.asList(\n+        new Object[][] {\n+          {1000000000, 10000000, 1000000000},\n+          {1000000000, 7000000, 962500000},\n+          {1100000000, 10000000, 1100000000},\n+          {1100000000, 9000000, 1086250000},\n+          {1086250000, 9000000, 1072671875},\n+          {1072671875, 9000000, 1059263476},\n+          {1059263476, 10001000, 1059276716},\n+          {1059276716, 16000000, 1138722469},\n+          {1049238967, 0, 918084097}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df457cea4d99ed09586d12c125661f3ff64ca289"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb6c120c2d0b4cdc2cd4e0a3647e4fedb70f0110", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/bb6c120c2d0b4cdc2cd4e0a3647e4fedb70f0110", "committedDate": "2020-04-16T09:06:49Z", "message": "Merge remote-tracking branch 'upstream/master' into 720\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e273be4f22a7fc11500dda057a406ce026bf823", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/9e273be4f22a7fc11500dda057a406ce026bf823", "committedDate": "2020-04-16T11:20:49Z", "message": "Address PR comments\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9955d2bc59a7065a4bb1e3cbe189720cd1975545", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/9955d2bc59a7065a4bb1e3cbe189720cd1975545", "committedDate": "2020-04-16T15:25:19Z", "message": "Merge branch 'master' into 720"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1732, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}