{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzMTUyNjA3", "number": 1372, "title": "Don't Fail When Encountering Evicted Pooled Transaction Hash", "bodyText": "PR description\nWe were attempting to use hashes from a queue we frequently evict from and not handling that case in an iterator that walks over that collection.\nFixed Issue(s)\n\n\nfixes #1370", "createdAt": "2020-09-09T21:38:41Z", "url": "https://github.com/hyperledger/besu/pull/1372", "merged": true, "mergeCommit": {"oid": "30ccddc1b48a44c83f4dcfd537b5886f9994b60c"}, "closed": true, "closedAt": "2020-09-09T21:54:35Z", "author": {"login": "RatanRSur"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHTHRvgH2gAyNDgzMTUyNjA3OmZiZjhjNTc1ZGI5YWFjNzNhOTRhOWJlOGVjMjk2ZGM0MDFmNjk2Njg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHTXd4AFqTQ4NTQyNTE4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fbf8c575db9aac73a94a9be8ec296dc401f69668", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/fbf8c575db9aac73a94a9be8ec296dc401f69668", "committedDate": "2020-09-09T21:30:51Z", "message": "ignore evicted hashes\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c4a9a6d3707b025b64e687d574605096a368c7e", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/3c4a9a6d3707b025b64e687d574605096a368c7e", "committedDate": "2020-09-09T21:38:52Z", "message": "Merge branch 'master' into concurrent-modifiation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDI1MTg1", "url": "https://github.com/hyperledger/besu/pull/1372#pullrequestreview-485425185", "createdAt": "2020-09-09T21:44:40Z", "commit": {"oid": "3c4a9a6d3707b025b64e687d574605096a368c7e"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo0NDo0MVrOHPbYrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo0ODoxMlrOHPbe7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkzOTM3NQ==", "bodyText": "I'm assuming there is some reason to go from a for loop iteration to a direct iterator.  Is it because the iterator handles the unstable collection better?", "url": "https://github.com/hyperledger/besu/pull/1372#discussion_r485939375", "createdAt": "2020-09-09T21:44:41Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/TransactionPool.java", "diffHunk": "@@ -126,12 +128,19 @@ void handleConnect(final EthPeer peer) {\n     for (final Transaction transaction : localTransactions) {\n       peerTransactionTracker.addToPeerSendQueue(peer, transaction);\n     }\n-    peerPendingTransactionTracker.ifPresent(\n+    maybePeerPendingTransactionTracker.ifPresent(\n         peerPendingTransactionTracker -> {\n           if (peerPendingTransactionTracker.isPeerSupported(peer, EthProtocol.ETH65)) {\n-            final Collection<Hash> hashes = getNewPooledHashes();\n-            for (final Hash hash : hashes) {\n-              peerPendingTransactionTracker.addToPeerSendQueue(peer, hash);\n+            Iterator<Hash> hashIterator = getNewPooledHashes().iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c4a9a6d3707b025b64e687d574605096a368c7e"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MDk3Mw==", "bodyText": "Why do we need to specialize this type to EveictingQueue?  Isn't iterator available in Queue via the Collection supertype?", "url": "https://github.com/hyperledger/besu/pull/1372#discussion_r485940973", "createdAt": "2020-09-09T21:48:12Z", "author": {"login": "shemnon"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/PendingTransactions.java", "diffHunk": "@@ -67,7 +66,7 @@\n   private final int maxTransactionRetentionHours;\n   private final Clock clock;\n \n-  private final Queue<Hash> newPooledHashes;\n+  private final EvictingQueue<Hash> newPooledHashes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c4a9a6d3707b025b64e687d574605096a368c7e"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1480, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}