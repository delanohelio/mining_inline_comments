{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMDAxMDU2", "number": 805, "title": "[EIP-1559] Handle legacy gas pool and EIP-1559 gas pool when mining blocks.", "bodyText": "PR description\n\nAdded EIP1559 manager class in ProtocolSpec (defaulted to Optional.empty()).\nUpdated MainnetProtocolSpecs EIP-1559 definition to set the EIP1559 manager class.\nUpdated BlockTransactionSelector\n\nAdded eip1559CumulativeGasUsed field in TransactionSelectionResults.\nUpdated updateTransactionResultTracking method to compute cumulative gas used according to EIP-1559 rules.\nUpdated transactionTooLargeForBlock method to compute gas remaining according to EIP-1559 rules.\nUpdated blockOccupancyAboveThreshold method to compute minimum block occupancy ratio according to EIP-1559 rules.\n\n\n\nFixed Issue(s)\n\n\n#804\nSigned-off-by: Abdelhamid Bakhta abdelhamid.bakhta@consensys.net", "createdAt": "2020-04-28T09:37:58Z", "url": "https://github.com/hyperledger/besu/pull/805", "merged": true, "mergeCommit": {"oid": "a3c1b454caed0274d6021624444923446829b44a"}, "closed": true, "closedAt": "2020-04-30T08:53:19Z", "author": {"login": "abdelhamidbakhta"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcb_mjZAH2gAyNDEwMDAxMDU2OjVjY2ZlNDNkZTRlOTFkYjU2ZGJiODhmOTBjMjAxODMzMzViYjk5NzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccpJNsAFqTQwMzMyNTUwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5ccfe43de4e91db56dbb88f90c20183335bb9974", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/5ccfe43de4e91db56dbb88f90c20183335bb9974", "committedDate": "2020-04-28T08:28:10Z", "message": "Added changelog entries for PR:\n- https://github.com/hyperledger/besu/pull/430\n- https://github.com/hyperledger/besu/pull/440\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f62f94574a4a054015de08c0e9e318fc16a6fe05", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/f62f94574a4a054015de08c0e9e318fc16a6fe05", "committedDate": "2020-04-28T08:28:10Z", "message": "handmerge changelog\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a4e60ebdb369d20ea12395027866b4c710d352f", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/2a4e60ebdb369d20ea12395027866b4c710d352f", "committedDate": "2020-04-28T09:35:57Z", "message": "Handle legacy gas pool and EIP-1559 gas pool when mining blocks.\n\n- Added `EIP1559` manager class in `ProtocolSpec` (defaulted to `Optional.empty()`).\n- Updated `MainnetProtocolSpecs` EIP-1559 definition to set the `EIP1559` manager class.\n- Updated `BlockTransactionSelector`\n    - Added `eip1559CumulativeGasUsed` field in `TransactionSelectionResults`.\n    - Updated `updateTransactionResultTracking` method to compute cumulative gas used according to `EIP-1559` rules.\n    - Updated `transactionTooLargeForBlock` method to compute gas remaining according to `EIP-1559` rules.\n    - Updated `blockOccupancyAboveThreshold` method to compute minimum block occupancy ratio according to `EIP-1559` rules.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4372ae8dce45e754e4bd528b1ee11090aeabdace", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/4372ae8dce45e754e4bd528b1ee11090aeabdace", "committedDate": "2020-04-29T10:35:24Z", "message": "Merge remote-tracking branch 'upstream/master' into 736\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "746fc04fedfbc50013055b46a13239ecee62573f", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/746fc04fedfbc50013055b46a13239ecee62573f", "committedDate": "2020-04-29T11:43:44Z", "message": "Added min-block-occupancy-ratio command line option\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f6c63ba3d2c0bb5c3892a0b8dc66f67c56d17a0", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/9f6c63ba3d2c0bb5c3892a0b8dc66f67c56d17a0", "committedDate": "2020-04-29T13:08:37Z", "message": "Fixed unit tests.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9ec78bea9b0faffd8f481f0ce5f5706b90eefe3", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/c9ec78bea9b0faffd8f481f0ce5f5706b90eefe3", "committedDate": "2020-04-29T13:56:12Z", "message": "Fixed unit tests.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b426bc18dc59ce2562aeb6b9edd364cba71d0ae4", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/b426bc18dc59ce2562aeb6b9edd364cba71d0ae4", "committedDate": "2020-04-29T14:35:20Z", "message": "Fixed unit tests.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9dd20a9d400bb7098f5fc4b0f5b62f7a111c268", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/d9dd20a9d400bb7098f5fc4b0f5b62f7a111c268", "committedDate": "2020-04-29T15:18:43Z", "message": "Merge remote-tracking branch 'upstream/master' into 736\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "332eeef2879c847537017770f42ceefdb53f4104", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/332eeef2879c847537017770f42ceefdb53f4104", "committedDate": "2020-04-29T16:18:59Z", "message": "Merge branch 'master' into 736"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37823ba33b6a1a8c31c27aae8270c06f20c36e66", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/37823ba33b6a1a8c31c27aae8270c06f20c36e66", "committedDate": "2020-04-29T21:30:26Z", "message": "Merge branch 'master' into 736"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMjkyODAw", "url": "https://github.com/hyperledger/besu/pull/805#pullrequestreview-403292800", "createdAt": "2020-04-30T08:07:09Z", "commit": {"oid": "37823ba33b6a1a8c31c27aae8270c06f20c36e66"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwODowNzowOVrOGOeV8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwODoxODowNFrOGOetKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgzMDM4Ng==", "bodyText": "the ratio should not be 0.8 in this conf?", "url": "https://github.com/hyperledger/besu/pull/805#discussion_r417830386", "createdAt": "2020-04-30T08:07:09Z", "author": {"login": "matkt"}, "path": "besu/src/test/resources/everything_config.toml", "diffHunk": "@@ -101,6 +101,7 @@ miner-stratum-enabled=false\n miner-coinbase=\"0x0000000000000000000000000000000000000002\"\n miner-extra-data=\"0x444F4E27542050414E4943202120484F444C2C20484F444C2C20484F444C2021\"\n min-gas-price=1\n+min-block-occupancy-ratio=0.7", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37823ba33b6a1a8c31c27aae8270c06f20c36e66"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgzMjMwNQ==", "bodyText": "How can we be sure that this block + 1 will always exist?", "url": "https://github.com/hyperledger/besu/pull/805#discussion_r417832305", "createdAt": "2020-04-30T08:10:56Z", "author": {"login": "matkt"}, "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/AbstractBlockCreator.java", "diffHunk": "@@ -92,8 +96,10 @@ public AbstractBlockCreator(\n     this.protocolSchedule = protocolSchedule;\n     this.gasLimitCalculator = gasLimitCalculator;\n     this.minTransactionGasPrice = minTransactionGasPrice;\n+    this.minBlockOccupancyRatio = minBlockOccupancyRatio;\n     this.miningBeneficiary = miningBeneficiary;\n     this.parentHeader = parentHeader;\n+    this.protocolSpec = protocolSchedule.getByBlockNumber(parentHeader.getNumber() + 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37823ba33b6a1a8c31c27aae8270c06f20c36e66"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgzNjMzMA==", "bodyText": "Is the ratio at 0 normal in this case?", "url": "https://github.com/hyperledger/besu/pull/805#discussion_r417836330", "createdAt": "2020-04-30T08:18:04Z", "author": {"login": "matkt"}, "path": "ethereum/retesteth/src/main/java/org/hyperledger/besu/ethereum/retesteth/methods/TestMineBlocks.java", "diffHunk": "@@ -72,6 +72,7 @@ private boolean mineNewBlock() {\n             Functions.identity(),\n             context.getEthHashSolver(),\n             Wei.ZERO,\n+            0.0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37823ba33b6a1a8c31c27aae8270c06f20c36e66"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzI1NTA4", "url": "https://github.com/hyperledger/besu/pull/805#pullrequestreview-403325508", "createdAt": "2020-04-30T08:52:08Z", "commit": {"oid": "37823ba33b6a1a8c31c27aae8270c06f20c36e66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1602, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}