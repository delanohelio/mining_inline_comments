{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMzk2MzU0", "number": 1726, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMDowMzo1NVrOFLB97Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDowODozMVrOFOr-Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3MTEwODkzOnYy", "diffSide": "RIGHT", "path": "besu/src/test/java/org/hyperledger/besu/PrivacyReorgTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQyMDowMzo1NVrOIN_Pcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDowNzoxM1rOITmKCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUzODU0Nw==", "bodyText": "@lucassaldanha this test broke because I changed the BlockDataGenerator. I think it's safe to change the state roots here but I don't think the test should rely on hardcoded state roots anyways. Is there a way to determine at test time what the correct state roots should be?", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r551538547", "createdAt": "2021-01-04T20:03:55Z", "author": {"login": "RatanRSur"}, "path": "besu/src/test/java/org/hyperledger/besu/PrivacyReorgTest.java", "diffHunk": "@@ -92,9 +93,9 @@\n       Bytes.fromBase64String(\"A1aVtMxLCUHmBVHXoZzzBgPbW/wj5axDpW9X8l91SGo=\");\n \n   private static final String FIRST_BLOCK_WITH_NO_TRANSACTIONS_STATE_ROOT =\n-      \"0x1bdf13f6d14c7322d6e695498aab258949e55574bef7eac366eb777f43d7dd2b\";\n+      \"0xc9dcaffbebc7edc20839c80e706430a8fa885e8f703bb89f6e95633cc2b05d4d\";\n   private static final String FIRST_BLOCK_WITH_SINGLE_TRANSACTION_STATE_ROOT =\n-      \"0x16979b290f429e06d86a43584c7d8689d4292ade9a602e5c78e2867c6ebd904e\";\n+      \"0x66fbc6ad12ef1da78740093ea2b3362e773e510e27d8f88b68c27bfc1f4d58c8\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74467f4eecb06846016989e9dc41c807bc1de40b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQxOTAxOA==", "bodyText": "I think actually this is not a bad thing to rely on hardcoded state roots on tests. Because when you change something it breaks, and this is good. If you use your code to generate the assertion there is a risk of working only in close loop.", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r557419018", "createdAt": "2021-01-14T14:07:13Z", "author": {"login": "abdelhamidbakhta"}, "path": "besu/src/test/java/org/hyperledger/besu/PrivacyReorgTest.java", "diffHunk": "@@ -92,9 +93,9 @@\n       Bytes.fromBase64String(\"A1aVtMxLCUHmBVHXoZzzBgPbW/wj5axDpW9X8l91SGo=\");\n \n   private static final String FIRST_BLOCK_WITH_NO_TRANSACTIONS_STATE_ROOT =\n-      \"0x1bdf13f6d14c7322d6e695498aab258949e55574bef7eac366eb777f43d7dd2b\";\n+      \"0xc9dcaffbebc7edc20839c80e706430a8fa885e8f703bb89f6e95633cc2b05d4d\";\n   private static final String FIRST_BLOCK_WITH_SINGLE_TRANSACTION_STATE_ROOT =\n-      \"0x16979b290f429e06d86a43584c7d8689d4292ade9a602e5c78e2867c6ebd904e\";\n+      \"0x66fbc6ad12ef1da78740093ea2b3362e773e510e27d8f88b68c27bfc1f4d58c8\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTUzODU0Nw=="}, "originalCommit": {"oid": "74467f4eecb06846016989e9dc41c807bc1de40b"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3NTA4MTExOnYy", "diffSide": "RIGHT", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/TransactionReceipt.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxOToyNTozOVrOIOkNkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxOToyNTozOVrOIOkNkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE0NDI3Mw==", "bodyText": "We previously tested only FRONTIER receipts so roundtripping issues that were exposed are fixed here.", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r552144273", "createdAt": "2021-01-05T19:25:39Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/TransactionReceipt.java", "diffHunk": "@@ -171,26 +173,37 @@ public void writeToWithRevertReason(final RLPOutput out) {\n     writeTo(out, true);\n   }\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1ceab797209398c34c184c0633dba7b4bb93531"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUwOTQyMzExOnYy", "diffSide": "LEFT", "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/core/encoding/TransactionRLPEncoderTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDowMjo0NVrOITl-rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDowMjo0NVrOITl-rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQxNjExMQ==", "bodyText": "We don't fail at deseriailization anymore. We always deserialize and reject in transaction validation based on what fork we're on", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r557416111", "createdAt": "2021-01-14T14:02:45Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/core/encoding/TransactionRLPEncoderTest.java", "diffHunk": "@@ -66,17 +65,4 @@ public void encodeEIP1559TxNominalCase() {\n         .isEqualTo(output.encoded().toHexString());\n     ExperimentalEIPs.eip1559Enabled = ExperimentalEIPs.EIP1559_ENABLED_DEFAULT_VALUE;\n   }\n-\n-  @Test\n-  public void encodeEIP1559TxFailureNotEnabled() {\n-    ExperimentalEIPs.eip1559Enabled = false;\n-    assertThatThrownBy(\n-            () ->\n-                TransactionRLPEncoder.encode(\n-                    TransactionRLPDecoder.decode(RLP.input(Bytes.fromHexString(EIP1559_TX_RLP))),\n-                    new BytesValueRLPOutput()))\n-        .isInstanceOf(RuntimeException.class)\n-        .hasMessageContaining(\"EIP-1559 feature flag\");\n-    ExperimentalEIPs.eip1559Enabled = ExperimentalEIPs.EIP1559_ENABLED_DEFAULT_VALUE;\n-  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a146290174354466232c0823bd738b6393f7630"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUwOTQ0NTUwOnYy", "diffSide": "RIGHT", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/Wei.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDowODowNlrOITmMog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDoxNToxNFrOITmfIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQxOTY4Mg==", "bodyText": "Why this change is necessary ?", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r557419682", "createdAt": "2021-01-14T14:08:06Z", "author": {"login": "abdelhamidbakhta"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/Wei.java", "diffHunk": "@@ -18,7 +18,7 @@\n \n import java.math.BigInteger;\n \n-import org.apache.tuweni.bytes.Bytes32;\n+import org.apache.tuweni.bytes.Bytes;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a146290174354466232c0823bd738b6393f7630"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQyMzQ3OA==", "bodyText": "In TransactionRLPDecoder, we previously had Wei.of of a BigInteger, sometimes that BigInteger was negative so the Wei was negative. When I changed it to Wei.wrap I needed to allow Bytes instead of just Bytes32 since it could be shorter.", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r557423478", "createdAt": "2021-01-14T14:13:55Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/Wei.java", "diffHunk": "@@ -18,7 +18,7 @@\n \n import java.math.BigInteger;\n \n-import org.apache.tuweni.bytes.Bytes32;\n+import org.apache.tuweni.bytes.Bytes;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQxOTY4Mg=="}, "originalCommit": {"oid": "6a146290174354466232c0823bd738b6393f7630"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQyNDQxNg==", "bodyText": "That makes sense", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r557424416", "createdAt": "2021-01-14T14:15:14Z", "author": {"login": "abdelhamidbakhta"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/Wei.java", "diffHunk": "@@ -18,7 +18,7 @@\n \n import java.math.BigInteger;\n \n-import org.apache.tuweni.bytes.Bytes32;\n+import org.apache.tuweni.bytes.Bytes;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQxOTY4Mg=="}, "originalCommit": {"oid": "6a146290174354466232c0823bd738b6393f7630"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUwOTQ0NzcxOnYy", "diffSide": "LEFT", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/encoding/TransactionRLPEncoder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDowODozMVrOITmN4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNDoxNTowN1rOITmetg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQyMDAwMw==", "bodyText": "Why do you remove that ?", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r557420003", "createdAt": "2021-01-14T14:08:31Z", "author": {"login": "abdelhamidbakhta"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/encoding/TransactionRLPEncoder.java", "diffHunk": "@@ -77,8 +76,6 @@ static void encodeFrontier(final Transaction transaction, final RLPOutput out) {\n   }\n \n   static void encodeEIP1559(final Transaction transaction, final RLPOutput out) {\n-    ExperimentalEIPs.eip1559MustBeEnabled();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a146290174354466232c0823bd738b6393f7630"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQyNDMxMA==", "bodyText": "In general we're moving the transactions to not be validated at serialization time. All the checks to make sure we're not creating/deserializing transactions for a different fork are done elsewhere.", "url": "https://github.com/hyperledger/besu/pull/1726#discussion_r557424310", "createdAt": "2021-01-14T14:15:07Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/encoding/TransactionRLPEncoder.java", "diffHunk": "@@ -77,8 +76,6 @@ static void encodeFrontier(final Transaction transaction, final RLPOutput out) {\n   }\n \n   static void encodeEIP1559(final Transaction transaction, final RLPOutput out) {\n-    ExperimentalEIPs.eip1559MustBeEnabled();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQyMDAwMw=="}, "originalCommit": {"oid": "6a146290174354466232c0823bd738b6393f7630"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1281, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}