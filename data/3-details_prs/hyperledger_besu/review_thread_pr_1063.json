{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxODQ3NTgz", "number": 1063, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxODowMjoyM1rOEEyx0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxODoxOTowMVrOEEzHmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNDYxNzE0OnYy", "diffSide": "RIGHT", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxODowMjoyM1rOGio4eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNjo1NDozOVrOGjLGYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3NDU4NA==", "bodyText": "Let's make this an --X option for the first few releases.  We can promote it later, but because this becomes part of the public API I want to have a window where it can be easily changed.", "url": "https://github.com/hyperledger/besu/pull/1063#discussion_r438974584", "createdAt": "2020-06-11T18:02:23Z", "author": {"login": "shemnon"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -724,6 +724,12 @@ void setBannedNodeIds(final List<String> values) {\n       description = \"Stratum port binding (default: ${DEFAULT-VALUE})\")\n   private final Integer stratumPort = 8008;\n \n+  @Option(\n+      names = {\"--miner-remote-sealers-limit\"},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "973e240f831ebc2462ae68ff6c64a574fd758e65"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTUzNTIwMA==", "bodyText": "Done", "url": "https://github.com/hyperledger/besu/pull/1063#discussion_r439535200", "createdAt": "2020-06-12T16:54:39Z", "author": {"login": "matkt"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -724,6 +724,12 @@ void setBannedNodeIds(final List<String> values) {\n       description = \"Stratum port binding (default: ${DEFAULT-VALUE})\")\n   private final Integer stratumPort = 8008;\n \n+  @Option(\n+      names = {\"--miner-remote-sealers-limit\"},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3NDU4NA=="}, "originalCommit": {"oid": "973e240f831ebc2462ae68ff6c64a574fd758e65"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNDY0MDE1OnYy", "diffSide": "RIGHT", "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/AbstractMiningCoordinator.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxODowOToxMFrOGipHGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxOToxNjo1MlrOGjPFKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3ODMyOA==", "bodyText": "I think a guava cache may be more appropriate for this particular data set https://github.com/google/guava/wiki/CachesExplained - we can set the max size via the flag and we can expire values after a certain time.  Which given miners come and go I think is a good thing.  Perhaps 10 minutes?  Also set by a flag like the max cache size.", "url": "https://github.com/hyperledger/besu/pull/1063#discussion_r438978328", "createdAt": "2020-06-11T18:09:10Z", "author": {"login": "shemnon"}, "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/AbstractMiningCoordinator.java", "diffHunk": "@@ -40,6 +44,8 @@\n         M extends BlockMiner<? extends AbstractBlockCreator>>\n     implements BlockAddedObserver, MiningCoordinator {\n \n+  private final Map<String, SealerInfo> sealerInfos;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "973e240f831ebc2462ae68ff6c64a574fd758e65"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTUzNTY4MQ==", "bodyText": "Done. The new policy is to delete after 10 minutes of inactivity. And the limit is by default 1000 but configurable via the CLI", "url": "https://github.com/hyperledger/besu/pull/1063#discussion_r439535681", "createdAt": "2020-06-12T16:55:34Z", "author": {"login": "matkt"}, "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/AbstractMiningCoordinator.java", "diffHunk": "@@ -40,6 +44,8 @@\n         M extends BlockMiner<? extends AbstractBlockCreator>>\n     implements BlockAddedObserver, MiningCoordinator {\n \n+  private final Map<String, SealerInfo> sealerInfos;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3ODMyOA=="}, "originalCommit": {"oid": "973e240f831ebc2462ae68ff6c64a574fd758e65"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTUzNjA0OQ==", "bodyText": "I forgot I just need to add the CLI flag for TTL", "url": "https://github.com/hyperledger/besu/pull/1063#discussion_r439536049", "createdAt": "2020-06-12T16:56:15Z", "author": {"login": "matkt"}, "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/AbstractMiningCoordinator.java", "diffHunk": "@@ -40,6 +44,8 @@\n         M extends BlockMiner<? extends AbstractBlockCreator>>\n     implements BlockAddedObserver, MiningCoordinator {\n \n+  private final Map<String, SealerInfo> sealerInfos;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3ODMyOA=="}, "originalCommit": {"oid": "973e240f831ebc2462ae68ff6c64a574fd758e65"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYwMDQyNw==", "bodyText": "Done you need to use --Xminer-remote-sealers-hashrate-ttl=10(default 10 minutes)", "url": "https://github.com/hyperledger/besu/pull/1063#discussion_r439600427", "createdAt": "2020-06-12T19:16:52Z", "author": {"login": "matkt"}, "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/AbstractMiningCoordinator.java", "diffHunk": "@@ -40,6 +44,8 @@\n         M extends BlockMiner<? extends AbstractBlockCreator>>\n     implements BlockAddedObserver, MiningCoordinator {\n \n+  private final Map<String, SealerInfo> sealerInfos;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3ODMyOA=="}, "originalCommit": {"oid": "973e240f831ebc2462ae68ff6c64a574fd758e65"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNDY2OTQ3OnYy", "diffSide": "RIGHT", "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/AbstractMiningCoordinator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxODoxODowMlrOGipZpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNjo1NjozMlrOGjLKOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk4MzA3OQ==", "bodyText": "I think it would be better to move all the logic around submitting hashrate and storing the sealerInfo down into the EthashMiningCoordinator.  IBFT and Clique will never use these.", "url": "https://github.com/hyperledger/besu/pull/1063#discussion_r438983079", "createdAt": "2020-06-11T18:18:02Z", "author": {"login": "shemnon"}, "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/AbstractMiningCoordinator.java", "diffHunk": "@@ -215,4 +232,28 @@ public void setExtraData(final Bytes extraData) {\n \n   protected abstract boolean newChainHeadInvalidatesMiningOperation(\n       final BlockHeader newChainHeadHeader);\n+\n+  @Override\n+  public Map<String, SealerInfo> getSealerInfos() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "973e240f831ebc2462ae68ff6c64a574fd758e65"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTUzNjE4Nw==", "bodyText": "Done", "url": "https://github.com/hyperledger/besu/pull/1063#discussion_r439536187", "createdAt": "2020-06-12T16:56:32Z", "author": {"login": "matkt"}, "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/AbstractMiningCoordinator.java", "diffHunk": "@@ -215,4 +232,28 @@ public void setExtraData(final Bytes extraData) {\n \n   protected abstract boolean newChainHeadInvalidatesMiningOperation(\n       final BlockHeader newChainHeadHeader);\n+\n+  @Override\n+  public Map<String, SealerInfo> getSealerInfos() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk4MzA3OQ=="}, "originalCommit": {"oid": "973e240f831ebc2462ae68ff6c64a574fd758e65"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNDY3Mjg5OnYy", "diffSide": "RIGHT", "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/MiningCoordinator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxODoxOTowMVrOGipbow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNjo1Njo0MFrOGjLKdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk4MzU4Nw==", "bodyText": "I would remove this in favor or a new getHashRate() function that defaults to zero.", "url": "https://github.com/hyperledger/besu/pull/1063#discussion_r438983587", "createdAt": "2020-06-11T18:19:01Z", "author": {"login": "shemnon"}, "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/MiningCoordinator.java", "diffHunk": "@@ -77,6 +81,26 @@ default boolean submitWork(final EthHashSolution solution) {\n         \"Current consensus mechanism prevents submission of work solutions.\");\n   }\n \n+  /**\n+   * Allows to submit the hashrate of a sealer with a specific id\n+   *\n+   * @param id of the sealer\n+   * @param hashrate of the sealer\n+   * @return true if the hashrate has been added otherwise false\n+   */\n+  default boolean submitHashRate(final String id, final Long hashrate) {\n+    return false;\n+  }\n+\n+  /**\n+   * Returns a list of the current sealers\n+   *\n+   * @return a list of {@link SealerInfo}\n+   */\n+  default Map<String, SealerInfo> getSealerInfos() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "973e240f831ebc2462ae68ff6c64a574fd758e65"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTUzNjI0NA==", "bodyText": "Done", "url": "https://github.com/hyperledger/besu/pull/1063#discussion_r439536244", "createdAt": "2020-06-12T16:56:40Z", "author": {"login": "matkt"}, "path": "ethereum/blockcreation/src/main/java/org/hyperledger/besu/ethereum/blockcreation/MiningCoordinator.java", "diffHunk": "@@ -77,6 +81,26 @@ default boolean submitWork(final EthHashSolution solution) {\n         \"Current consensus mechanism prevents submission of work solutions.\");\n   }\n \n+  /**\n+   * Allows to submit the hashrate of a sealer with a specific id\n+   *\n+   * @param id of the sealer\n+   * @param hashrate of the sealer\n+   * @return true if the hashrate has been added otherwise false\n+   */\n+  default boolean submitHashRate(final String id, final Long hashrate) {\n+    return false;\n+  }\n+\n+  /**\n+   * Returns a list of the current sealers\n+   *\n+   * @return a list of {@link SealerInfo}\n+   */\n+  default Map<String, SealerInfo> getSealerInfos() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk4MzU4Nw=="}, "originalCommit": {"oid": "973e240f831ebc2462ae68ff6c64a574fd758e65"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 788, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}