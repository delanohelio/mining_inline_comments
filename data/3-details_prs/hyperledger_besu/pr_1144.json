{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NjE2NzQ1", "number": 1144, "title": "Improvements to authenticated JSON-RPC permissions checking", "bodyText": "Exit early when checking user permissions, ie if matching permission is found, don't keep checking.\nAlso reordered permissions produced by JsonRpcMethod to be in descending order of granularity\nAdded unit test for : permission\nSee #1118", "createdAt": "2020-06-25T02:26:58Z", "url": "https://github.com/hyperledger/besu/pull/1144", "merged": true, "mergeCommit": {"oid": "06e35a58c07a30c0fbdc0aae45a3e8b06b53c022"}, "closed": true, "closedAt": "2020-06-25T23:07:12Z", "author": {"login": "macfarla"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABculC1fgH2gAyNDM5NjE2NzQ1Ojk0ZmJmYjEwZjE2Njk1ZDY2NTlhZWE0OWVmMjM5YjAzOWZjYWE1NjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu23uGAFqTQzNzkxNTMyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "94fbfb10f16695d6659aea49ef239b039fcaa563", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/94fbfb10f16695d6659aea49ef239b039fcaa563", "committedDate": "2020-06-25T02:16:11Z", "message": "exit early if matching permission found; add test for *:* permission\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07286d086b3b9b1088c185037fa6b524f7413e11", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/07286d086b3b9b1088c185037fa6b524f7413e11", "committedDate": "2020-06-25T02:16:22Z", "message": "Merge branch 'master' of https://github.com/hyperledger/besu into permissions-check-1118"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1716ee92e31c3f7161eb05e714fd8f61c754e94", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/c1716ee92e31c3f7161eb05e714fd8f61c754e94", "committedDate": "2020-06-25T03:14:56Z", "message": "Merge branch 'master' of https://github.com/hyperledger/besu into permissions-check-1118"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTQwMzk5", "url": "https://github.com/hyperledger/besu/pull/1144#pullrequestreview-437140399", "createdAt": "2020-06-25T03:15:17Z", "commit": {"oid": "07286d086b3b9b1088c185037fa6b524f7413e11"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMzoxNTozM1rOGop-dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMzoyNDoyMlrOGoqGBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI4Mzk1Nw==", "bodyText": "What's the reason for this change?", "url": "https://github.com/hyperledger/besu/pull/1144#discussion_r445283957", "createdAt": "2020-06-25T03:15:33Z", "author": {"login": "mark-terry"}, "path": "ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/NetListeningTest.java", "diffHunk": "@@ -69,7 +69,7 @@ public void shouldReturnFalseWhenNetworkIsNotListening() {\n   @Test\n   public void getPermissions() {\n     List<String> permissions = method.getPermissions();\n-    assertThat(permissions).containsExactlyInAnyOrder(\"net:*\", \"net:listening\", \"*:*\");\n+    assertThat(permissions).containsExactly(\"*:*\", \"net:*\", \"net:listening\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1716ee92e31c3f7161eb05e714fd8f61c754e94"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI4NTA0Mg==", "bodyText": "Looks like line 67 could be inserted as the else branch here?", "url": "https://github.com/hyperledger/besu/pull/1144#discussion_r445285042", "createdAt": "2020-06-25T03:20:22Z", "author": {"login": "mark-terry"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/authentication/AuthenticationUtils.java", "diffHunk": "@@ -53,6 +53,10 @@ public static boolean isPermitted(\n                   foundMatchingPermission.set(true);\n                 }\n               });\n+          // exit if a matching permission was found, no need to keep checking\n+          if (foundMatchingPermission.get()) {\n+            return foundMatchingPermission.get();\n+          }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1716ee92e31c3f7161eb05e714fd8f61c754e94"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI4NTg5Mg==", "bodyText": "Is the comment on line 41 out of date?", "url": "https://github.com/hyperledger/besu/pull/1144#discussion_r445285892", "createdAt": "2020-06-25T03:24:22Z", "author": {"login": "mark-terry"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/JsonRpcMethod.java", "diffHunk": "@@ -45,8 +45,8 @@\n   default List<String> getPermissions() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1716ee92e31c3f7161eb05e714fd8f61c754e94"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTUyNjg2", "url": "https://github.com/hyperledger/besu/pull/1144#pullrequestreview-437152686", "createdAt": "2020-06-25T04:03:57Z", "commit": {"oid": "c1716ee92e31c3f7161eb05e714fd8f61c754e94"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNDowMzo1N1rOGoqnUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNDowMzo1N1rOGoqnUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5NDQxOA==", "bodyText": "Is it possible to create a test that confirms that this exits early?", "url": "https://github.com/hyperledger/besu/pull/1144#discussion_r445294418", "createdAt": "2020-06-25T04:03:57Z", "author": {"login": "jframe"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/authentication/AuthenticationUtils.java", "diffHunk": "@@ -53,6 +53,10 @@ public static boolean isPermitted(\n                   foundMatchingPermission.set(true);\n                 }\n               });\n+          // exit if a matching permission was found, no need to keep checking\n+          if (foundMatchingPermission.get()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1716ee92e31c3f7161eb05e714fd8f61c754e94"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6888775d998216ce33214e3184e16e1d6550d54e", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/6888775d998216ce33214e3184e16e1d6550d54e", "committedDate": "2020-06-25T06:44:55Z", "message": "updated comment\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MzUyMTgy", "url": "https://github.com/hyperledger/besu/pull/1144#pullrequestreview-437352182", "createdAt": "2020-06-25T10:08:15Z", "commit": {"oid": "6888775d998216ce33214e3184e16e1d6550d54e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDowODoxNVrOGo0KsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMDowODoxNVrOGo0KsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ1MDkyOA==", "bodyText": "The more I read this code the more I think setting a flag async is not ideal...", "url": "https://github.com/hyperledger/besu/pull/1144#discussion_r445450928", "createdAt": "2020-06-25T10:08:15Z", "author": {"login": "mark-terry"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/authentication/AuthenticationUtils.java", "diffHunk": "@@ -53,6 +53,10 @@ public static boolean isPermitted(\n                   foundMatchingPermission.set(true);\n                 }\n               });\n+          // exit if a matching permission was found, no need to keep checking\n+          if (foundMatchingPermission.get()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6888775d998216ce33214e3184e16e1d6550d54e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0ec718d6f322c2745d9d676763251aa2ddeb6b3", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/d0ec718d6f322c2745d9d676763251aa2ddeb6b3", "committedDate": "2020-06-25T20:48:52Z", "message": "minor refactoring and comments\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afdb282dbd222950684e6b8d639488180983f918", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/afdb282dbd222950684e6b8d639488180983f918", "committedDate": "2020-06-25T20:48:59Z", "message": "Merge branch 'master' of https://github.com/hyperledger/besu into permissions-check-1118"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTE1MzI5", "url": "https://github.com/hyperledger/besu/pull/1144#pullrequestreview-437915329", "createdAt": "2020-06-25T23:02:20Z", "commit": {"oid": "afdb282dbd222950684e6b8d639488180983f918"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1500, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}