{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwODMwNTI0", "number": 1563, "title": "eth_gasPrice based on median block cost (#1546)", "bodyText": "Update eth_gasPrice to return the median gas price of transactions in\nthe last 100 blocks (or whole chain if the chain is short).  If there\nare no TXes return the old value.\nSigned-off-by: Danno Ferrin danno.ferrin@gmail.com", "createdAt": "2020-11-13T20:21:57Z", "url": "https://github.com/hyperledger/besu/pull/1563", "merged": true, "mergeCommit": {"oid": "b9deae46f73d189a0ed770e8bb4b4ac81d37880a"}, "closed": true, "closedAt": "2020-11-17T05:11:48Z", "author": {"login": "shemnon"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcM2EbAH2gAyNTIwODMwNTI0OmVlYmZjOTQ2NzNhYzk2MjEzNDEyZDg3ODAxMzBlYzU1ZWVlMTYwMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddSGUfAH2gAyNTIwODMwNTI0OjBmOTZmZGUyZDJiYmRiN2QxNjMyMDU5MGY4MmNkZGZhYmNjNzFkOWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "eebfc94673ac96213412d8780130ec55eee16023", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/eebfc94673ac96213412d8780130ec55eee16023", "committedDate": "2020-11-13T20:05:02Z", "message": "eth_gasPrice based on median block cost (#1546)\n\nUpdate eth_gasPrice to return the median gas price of transactions in\nthe last 100 blocks (or whole chain if the chain is short).  If there\nare no TXes return the old value.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3695791f2999bf67380279a739822f3905aa86f", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/b3695791f2999bf67380279a739822f3905aa86f", "committedDate": "2020-11-14T03:36:01Z", "message": "we need to support GraphQL too.\n\n* Refactor gas price to BlockchainQueries.\n* Adjust tests to reflect new reality of median gas price.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f69f3b51f552bb4d620f371f97d394bc53e7a226", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/f69f3b51f552bb4d620f371f97d394bc53e7a226", "committedDate": "2020-11-16T03:05:49Z", "message": "changelog\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12e9a028d65ad2a1ac43bdb28e2a1f4d726956bc", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/12e9a028d65ad2a1ac43bdb28e2a1f4d726956bc", "committedDate": "2020-11-16T17:39:19Z", "message": "merge with upstream master\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "609b9cd8962be99d92f6538f507f343b9eeeefdf", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/609b9cd8962be99d92f6538f507f343b9eeeefdf", "committedDate": "2020-11-16T22:51:19Z", "message": "add CLI flags\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd87d53e51af0b6b67d23ae20ae33ee31aa0dd23", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/fd87d53e51af0b6b67d23ae20ae33ee31aa0dd23", "committedDate": "2020-11-16T22:52:36Z", "message": "Merge branch 'master' of github.com:hyperledger/besu into gasPrice\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90c468d0545d012129be059dd8aa6ef98ac94c3a", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/90c468d0545d012129be059dd8aa6ef98ac94c3a", "committedDate": "2020-11-16T22:55:22Z", "message": "update changelog.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5c61ab5ccb2bdc6b39efb20887ee85c3c1c8346", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/a5c61ab5ccb2bdc6b39efb20887ee85c3c1c8346", "committedDate": "2020-11-16T23:05:49Z", "message": "Merge branch 'master' into gasPrice"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTM3NzU2", "url": "https://github.com/hyperledger/besu/pull/1563#pullrequestreview-531937756", "createdAt": "2020-11-17T00:44:24Z", "commit": {"oid": "a5c61ab5ccb2bdc6b39efb20887ee85c3c1c8346"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwMDo0NDoyNFrOH0f6fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwMDo0ODoyOFrOH0f_vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgxMDg3Nw==", "bodyText": "I think this case should be an orElseThrow? It doesn't represent a normal case.", "url": "https://github.com/hyperledger/besu/pull/1563#discussion_r524810877", "createdAt": "2020-11-17T00:44:24Z", "author": {"login": "RatanRSur"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/query/BlockchainQueries.java", "diffHunk": "@@ -715,6 +733,34 @@ private TransactionWithMetadata transactionByHeaderAndIndex(\n     return header.map(BlockHeader::getStateRoot).flatMap(worldStateArchive::getMutable);\n   }\n \n+  public Optional<Long> gasPrice() {\n+    final long blockHeight = headBlockNumber();\n+    final long[] gasCollection =\n+        LongStream.range(Math.max(0, blockHeight - apiConfig.getGasPriceBlocks()), blockHeight)\n+            .mapToObj(\n+                l ->\n+                    blockchain\n+                        .getBlockByNumber(l)\n+                        .map(Block::getBody)\n+                        .map(BlockBody::getTransactions)\n+                        .orElse(Collections.emptyList()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5c61ab5ccb2bdc6b39efb20887ee85c3c1c8346"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgxMjIyMA==", "bodyText": "How come this isn't 500_000_000_000L?", "url": "https://github.com/hyperledger/besu/pull/1563#discussion_r524812220", "createdAt": "2020-11-17T00:48:28Z", "author": {"login": "RatanRSur"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/ApiConfiguration.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ *\n+ */\n+\n+package org.hyperledger.besu.ethereum.api;\n+\n+import org.immutables.value.Value;\n+\n+@Value.Immutable\n+@Value.Style(allParameters = true)\n+public abstract class ApiConfiguration {\n+\n+  @Value.Default\n+  public long getGasPriceBlocks() {\n+    return 100;\n+  }\n+\n+  @Value.Default\n+  public double getGasPricePercentile() {\n+    return 50.0d;\n+  }\n+\n+  @Value.Default\n+  public long getGasPriceMin() {\n+    return 1_000_000_000L; // 1 GWei\n+  }\n+\n+  @Value.Default\n+  public long getGasPriceMax() {\n+    return 1_000_000_000_000_000_000L; // 1 Eth\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5c61ab5ccb2bdc6b39efb20887ee85c3c1c8346"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc15a43b82872b939b906808c7c543f7a8cb4e4a", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/cc15a43b82872b939b906808c7c543f7a8cb4e4a", "committedDate": "2020-11-17T03:47:48Z", "message": "review changes\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f96fde2d2bbdb7d16320590f82cddfabcc71d9b", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/0f96fde2d2bbdb7d16320590f82cddfabcc71d9b", "committedDate": "2020-11-17T04:46:14Z", "message": "update unit tests to deal with orElseThrow\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2096, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}