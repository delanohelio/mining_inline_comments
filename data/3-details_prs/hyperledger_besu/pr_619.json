{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2MzUxNzU5", "number": 619, "title": "[EIP-1559] Step 1 - Apply block structure modification", "bodyText": "PR description\nBlockHeader object needs to be modified in order to add the new field (baseFee) as specified in the EIP.\nWe should take care about the RLP encoding/decoding of this structure since it has to include or not the new fields depending on whether we are pre fork or post fork.\n\nUpdate core.BlockHeader.java\n\nAdd baseFee\nUpdate readFrom method for RLP decoding\nUpdate writeTo method for RLP encoding\n\n\n\nFixed Issue(s)\n\n\nfixes #604\nhttps://eips.ethereum.org/EIPS/eip-1559\nSigned-off-by: Abdelhamid Bakhta abdelhamid.bakhta@consensys.net", "createdAt": "2020-03-31T13:52:54Z", "url": "https://github.com/hyperledger/besu/pull/619", "merged": true, "mergeCommit": {"oid": "2148116b3216a874e1d0f68f29c5d558d7837395"}, "closed": true, "closedAt": "2020-04-03T08:40:01Z", "author": {"login": "abdelhamidbakhta"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM4BqCAH2gAyMzk2MzUxNzU5OmJhMzdmZDBlZmNiYTJkZTRlYTM0Yzk3OTA2MGZmMzYxYTFmZTk3OTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcT8mHngH2gAyMzk2MzUxNzU5OmUwNjMwNDA3MzljZWMwZmEyZmRkMmZlY2ZiYmJlOTg5ZTA0NTg2NTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ba37fd0efcba2de4ea34c979060ff361a1fe9798", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ba37fd0efcba2de4ea34c979060ff361a1fe9798", "committedDate": "2020-03-12T09:09:40Z", "message": "Added changelog entries for PR:\n- https://github.com/hyperledger/besu/pull/430\n- https://github.com/hyperledger/besu/pull/440\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "872f9cc4e93b90829961ebe6e599c51af43c95a7", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/872f9cc4e93b90829961ebe6e599c51af43c95a7", "committedDate": "2020-03-13T08:25:43Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>\n\n# Conflicts:\n#\tCHANGELOG.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e417b30e90cb0b33940adb1bee6a9dc8953c4abd", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e417b30e90cb0b33940adb1bee6a9dc8953c4abd", "committedDate": "2020-03-16T09:10:11Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2fb831c87dae221c92a9f9ec7705500717f1e77", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/a2fb831c87dae221c92a9f9ec7705500717f1e77", "committedDate": "2020-03-17T09:17:25Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c07ed7de515e1e25ea22ef38b59bf8337086812e", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/c07ed7de515e1e25ea22ef38b59bf8337086812e", "committedDate": "2020-03-17T15:26:18Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c1e22fe5a81e6a748b338a2ebedaaa53a00f04d", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/1c1e22fe5a81e6a748b338a2ebedaaa53a00f04d", "committedDate": "2020-03-18T08:29:25Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee10a2590d8e23b95a40c946a2927730714c4793", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/ee10a2590d8e23b95a40c946a2927730714c4793", "committedDate": "2020-03-19T16:27:54Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40cd31d7b48aab7b285524661ac17168c0d38467", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/40cd31d7b48aab7b285524661ac17168c0d38467", "committedDate": "2020-03-23T10:35:38Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e96c01a8ca248ded2aa4f22a6f56d9119cabebf2", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e96c01a8ca248ded2aa4f22a6f56d9119cabebf2", "committedDate": "2020-03-25T08:04:10Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c782ba4617a68e42def01737bdc6950ff7f9f53", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/2c782ba4617a68e42def01737bdc6950ff7f9f53", "committedDate": "2020-03-31T09:26:18Z", "message": "Merge remote-tracking branch 'upstream/master'\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "854ed2a6c863415636cd24a0519de23e9471c9fc", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/854ed2a6c863415636cd24a0519de23e9471c9fc", "committedDate": "2020-03-31T13:50:37Z", "message": "### Description\nBlockHeader object needs to be modified in order to add the new field (baseFee) as specified in the EIP.\nWe should take care about the RLP encoding/decoding of this structure since it has to include or not the new fields depending on whether we are pre fork or post fork.\n\n- Update `core.BlockHeader.java`\n    - Add `baseFee`\n    - Update `readFrom` method for RLP decoding\n    - Update `writeTo` method for RLP encoding\n- Update `plugin.data.BlockHeader.java`\n    - Add `getBaseFee` method\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "522c93b058589ad0c4d01249f465dd419a2a8368", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/522c93b058589ad0c4d01249f465dd419a2a8368", "committedDate": "2020-04-01T07:57:14Z", "message": "Merge branch 'master' into step-1-base-fee-block-header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "481b6d3d4743808d221f5f32321ac7149045b07f", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/481b6d3d4743808d221f5f32321ac7149045b07f", "committedDate": "2020-04-01T15:24:35Z", "message": "TODO Add CLI command line flag `--Xeip1559-enabled`.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c06ed3260754bada09462fa99892622c2eff119f", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/c06ed3260754bada09462fa99892622c2eff119f", "committedDate": "2020-04-01T16:09:51Z", "message": "TODO Add CLI command line flag `--Xeip1559-enabled`.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1ODY2NTEx", "url": "https://github.com/hyperledger/besu/pull/619#pullrequestreview-385866511", "createdAt": "2020-04-01T19:01:23Z", "commit": {"oid": "c06ed3260754bada09462fa99892622c2eff119f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOTowMToyM1rOF_OeOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOTowNDo0OFrOF_OlyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0MTcyMQ==", "bodyText": "Should this be guarded with the feature flag?  Either on the parameter or the constructor.", "url": "https://github.com/hyperledger/besu/pull/619#discussion_r401841721", "createdAt": "2020-04-01T19:01:23Z", "author": {"login": "shemnon"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/BlockHeader.java", "diffHunk": "@@ -142,33 +144,50 @@ public void writeTo(final RLPOutput out) {\n     out.writeBytes(extraData);\n     out.writeBytes(mixHash);\n     out.writeLong(nonce);\n-\n+    if (baseFee != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c06ed3260754bada09462fa99892622c2eff119f"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0MjEwNg==", "bodyText": "This too should be feature flag guarded.  So it it isn't enabled we will get RLP errors if they try to use it w/o the flag.", "url": "https://github.com/hyperledger/besu/pull/619#discussion_r401842106", "createdAt": "2020-04-01T19:01:59Z", "author": {"login": "shemnon"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/BlockHeader.java", "diffHunk": "@@ -142,33 +144,50 @@ public void writeTo(final RLPOutput out) {\n     out.writeBytes(extraData);\n     out.writeBytes(mixHash);\n     out.writeLong(nonce);\n-\n+    if (baseFee != null) {\n+      out.writeLongScalar(baseFee);\n+    }\n     out.endList();\n   }\n \n   public static BlockHeader readFrom(\n       final RLPInput input, final BlockHeaderFunctions blockHeaderFunctions) {\n     input.enterList();\n-    final BlockHeader blockHeader =\n-        new BlockHeader(\n-            Hash.wrap(input.readBytes32()),\n-            Hash.wrap(input.readBytes32()),\n-            Address.readFrom(input),\n-            Hash.wrap(input.readBytes32()),\n-            Hash.wrap(input.readBytes32()),\n-            Hash.wrap(input.readBytes32()),\n-            LogsBloomFilter.readFrom(input),\n-            Difficulty.of(input.readUInt256Scalar()),\n-            input.readLongScalar(),\n-            input.readLongScalar(),\n-            input.readLongScalar(),\n-            input.readLongScalar(),\n-            input.readBytes(),\n-            Hash.wrap(input.readBytes32()),\n-            input.readLong(),\n-            blockHeaderFunctions);\n+    final Hash parentHash = Hash.wrap(input.readBytes32());\n+    final Hash ommersHash = Hash.wrap(input.readBytes32());\n+    final Address coinbase = Address.readFrom(input);\n+    final Hash stateRoot = Hash.wrap(input.readBytes32());\n+    final Hash transactionsRoot = Hash.wrap(input.readBytes32());\n+    final Hash receiptsRoot = Hash.wrap(input.readBytes32());\n+    final LogsBloomFilter logsBloom = LogsBloomFilter.readFrom(input);\n+    final Difficulty difficulty = Difficulty.of(input.readUInt256Scalar());\n+    final long number = input.readLongScalar();\n+    final long gasLimit = input.readLongScalar();\n+    final long gasUsed = input.readLongScalar();\n+    final long timestamp = input.readLongScalar();\n+    final Bytes extraData = input.readBytes();\n+    final Hash mixHash = Hash.wrap(input.readBytes32());\n+    final long nonce = input.readLong();\n+    final Long baseFee = input.isEndOfCurrentList() ? null : input.readLongScalar();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c06ed3260754bada09462fa99892622c2eff119f"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0MzY1Ng==", "bodyText": "Should be tagged @Unstable\nShould be a default method, returning null\nAlso, perhaps Optional<Long> instead of just Long?  Always empty when the BASEFEE isn't relevant?  If so the default is Optional.empty()", "url": "https://github.com/hyperledger/besu/pull/619#discussion_r401843656", "createdAt": "2020-04-01T19:04:48Z", "author": {"login": "shemnon"}, "path": "plugin-api/src/main/java/org/hyperledger/besu/plugin/data/BlockHeader.java", "diffHunk": "@@ -154,4 +154,11 @@\n    * @return The Keccak 256-bit hash of this header.\n    */\n   Hash getBlockHash();\n+\n+  /**\n+   * The BASEFEE of this header.\n+   *\n+   * @return TheBASEFEE of this header.\n+   */\n+  Long getBaseFee();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c06ed3260754bada09462fa99892622c2eff119f"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f385963fb358b46119e83ad8a5f8b5d4f7cadfec", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/f385963fb358b46119e83ad8a5f8b5d4f7cadfec", "committedDate": "2020-04-02T12:01:16Z", "message": "Merge remote-tracking branch 'upstream/master' into step-1-base-fee-block-header\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5eab92582a43cd93dbb748fa0f5486f1a8dce54b", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/5eab92582a43cd93dbb748fa0f5486f1a8dce54b", "committedDate": "2020-04-02T12:10:22Z", "message": "Added unstable annotation for getBaseFee. Moved from long to `Optional<Long>`\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9e23e28d1110fe77a644fd077b5544759dd68f4", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/b9e23e28d1110fe77a644fd077b5544759dd68f4", "committedDate": "2020-04-02T12:15:59Z", "message": "Spotless apply\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "482cd3b2e2819dfc78add3ec00d7fb6c6f08228e", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/482cd3b2e2819dfc78add3ec00d7fb6c6f08228e", "committedDate": "2020-04-02T12:18:12Z", "message": "Fixed error\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4bb79fc7392aeeeaf7c4a60c2c6239e2eb71215", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/d4bb79fc7392aeeeaf7c4a60c2c6239e2eb71215", "committedDate": "2020-04-02T12:26:04Z", "message": "fix plugin API hash\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbe9081be47a8c62d85ba9123347c87de1f949f9", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/cbe9081be47a8c62d85ba9123347c87de1f949f9", "committedDate": "2020-04-02T14:27:32Z", "message": "Merge remote-tracking branch 'upstream/master' into step-1-base-fee-block-header\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d7f59b2d35fcf6fb4ec6853a732de388a52859e", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/7d7f59b2d35fcf6fb4ec6853a732de388a52859e", "committedDate": "2020-04-02T14:30:58Z", "message": "RLP encoding / decoding operations are guarded with the feature flag.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68b665c05addc3433096adc81b4e001633ae1150", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/68b665c05addc3433096adc81b4e001633ae1150", "committedDate": "2020-04-02T14:33:51Z", "message": "spotless apply\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8c89ed52c66616a4e62ab2eb82c9e38c8a4be38", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/a8c89ed52c66616a4e62ab2eb82c9e38c8a4be38", "committedDate": "2020-04-02T16:45:22Z", "message": "Merge branch 'master' into step-1-base-fee-block-header"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NjY4MTI2", "url": "https://github.com/hyperledger/besu/pull/619#pullrequestreview-386668126", "createdAt": "2020-04-02T17:59:24Z", "commit": {"oid": "a8c89ed52c66616a4e62ab2eb82c9e38c8a4be38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e063040739cec0fa2fdd2fecfbbbe989e0458651", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/e063040739cec0fa2fdd2fecfbbbe989e0458651", "committedDate": "2020-04-03T08:26:35Z", "message": "Merge remote-tracking branch 'upstream/master' into step-1-base-fee-block-header\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>\n\n# Conflicts:\n#\tplugin-api/build.gradle"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1644, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}