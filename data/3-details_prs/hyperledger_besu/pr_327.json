{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MTU0MTgy", "number": 327, "title": "Fix zip building", "bodyText": "Currently building from a non-git checkout, such as a zip file, does not\nwork because of the way we calculate the git commit hash.  Add a catch\nclause to return 8 \"x\"s in case the calculation fails.\nSigned-off-by: Danno Ferrin danno.ferrin@gmail.com", "createdAt": "2020-01-25T20:55:46Z", "url": "https://github.com/hyperledger/besu/pull/327", "merged": true, "mergeCommit": {"oid": "f224e9f5c0d4b1f6a64bde558d95a235d5415405"}, "closed": true, "closedAt": "2020-01-27T08:58:12Z", "author": {"login": "shemnon"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb958u1AH2gAyMzY3MTU0MTgyOmM3ODI4ZDc5MDQwMjFmMjQwMzE1NTlmODEzODA4ZGQzYzY1MmJkZDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-Yg-DAH2gAyMzY3MTU0MTgyOjgwZDc1YzM4MzliYjQ4MTAxOGQ2MTdjYmIwYzE4ZmZkZTk5ODc2NWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c7828d7904021f24031559f813808dd3c652bdd0", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/c7828d7904021f24031559f813808dd3c652bdd0", "committedDate": "2020-01-25T20:55:14Z", "message": "Fix zip build\n\nCurrently building from a non-git checkout, such as a zip file, does not\nwork because of the way we calculate the git commit hash.  Add a catch\nclause to return 8 \"x\"s in case the calculation fails.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MzQ1NjA1", "url": "https://github.com/hyperledger/besu/pull/327#pullrequestreview-348345605", "createdAt": "2020-01-25T21:08:06Z", "commit": {"oid": "c7828d7904021f24031559f813808dd3c652bdd0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNVQyMTowODowNlrOFhxXvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNVQyMTowODowNlrOFhxXvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NjIyMg==", "bodyText": "It would be worth printing a message here so that if an unexpected exception is thrown in the normal code there\u2019s some info about why.", "url": "https://github.com/hyperledger/besu/pull/327#discussion_r370956222", "createdAt": "2020-01-25T21:08:06Z", "author": {"login": "ajsutton"}, "path": "build.gradle", "diffHunk": "@@ -646,25 +646,29 @@ def calculateVersion() {\n }\n \n def getCheckedOutGitCommitHash() {\n-  def gitFolder = \"$projectDir/.git/\"\n-  if (!file(gitFolder).isDirectory()) {\n-    // We are in a submodule.  The file's contents are `gitdir: <gitFolder>\\n`.\n-    // Read the file, cut off the front, and trim the whitespace.\n-    gitFolder = file(gitFolder).text.substring(8).trim() + \"/\"\n+  try {\n+    def gitFolder = \"$projectDir/.git/\"\n+    if (!file(gitFolder).isDirectory()) {\n+      // We are in a submodule.  The file's contents are `gitdir: <gitFolder>\\n`.\n+      // Read the file, cut off the front, and trim the whitespace.\n+      gitFolder = file(gitFolder).text.substring(8).trim() + \"/\"\n+    }\n+    def takeFromHash = 8\n+    /*\n+     * '.git/HEAD' contains either\n+     *      in case of detached head: the currently checked out commit hash\n+     *      otherwise: a reference to a file containing the current commit hash\n+     */\n+    def head = new File(gitFolder + \"HEAD\").text.split(\":\") // .git/HEAD\n+    def isCommit = head.length == 1 // e5a7c79edabbf7dd39888442df081b1c9d8e88fd\n+\n+    if (isCommit) return head[0].trim().take(takeFromHash) // e5a7c79edabb\n+\n+    def refHead = new File(gitFolder + head[1].trim()) // .git/refs/heads/master\n+    refHead.text.trim().take takeFromHash\n+  } catch (Exception e) {\n+    return \"xxxxxxxx\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7828d7904021f24031559f813808dd3c652bdd0"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69865de03ad032ad8ae8d2fd701331a79d98fff7", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/69865de03ad032ad8ae8d2fd701331a79d98fff7", "committedDate": "2020-01-25T22:57:45Z", "message": "let the user know retrievial failed\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6456afe43ed33ca2a48cd0e44d60993416442dc", "author": {"user": {"login": "shemnon", "name": "Danno Ferrin"}}, "url": "https://github.com/hyperledger/besu/commit/d6456afe43ed33ca2a48cd0e44d60993416442dc", "committedDate": "2020-01-25T22:58:31Z", "message": "left in debugging code tripping the error\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MzU1NTk5", "url": "https://github.com/hyperledger/besu/pull/327#pullrequestreview-348355599", "createdAt": "2020-01-26T02:28:54Z", "commit": {"oid": "d6456afe43ed33ca2a48cd0e44d60993416442dc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNlQwMjoyODo1NFrOFhyKtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNlQwMjoyODo1NFrOFhyKtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk2OTI3MQ==", "bodyText": "+1 seems like a good trade off.", "url": "https://github.com/hyperledger/besu/pull/327#discussion_r370969271", "createdAt": "2020-01-26T02:28:54Z", "author": {"login": "ajsutton"}, "path": "build.gradle", "diffHunk": "@@ -646,25 +646,29 @@ def calculateVersion() {\n }\n \n def getCheckedOutGitCommitHash() {\n-  def gitFolder = \"$projectDir/.git/\"\n-  if (!file(gitFolder).isDirectory()) {\n-    // We are in a submodule.  The file's contents are `gitdir: <gitFolder>\\n`.\n-    // Read the file, cut off the front, and trim the whitespace.\n-    gitFolder = file(gitFolder).text.substring(8).trim() + \"/\"\n+  try {\n+    def gitFolder = \"$projectDir/.git/\"\n+    if (!file(gitFolder).isDirectory()) {\n+      // We are in a submodule.  The file's contents are `gitdir: <gitFolder>\\n`.\n+      // Read the file, cut off the front, and trim the whitespace.\n+      gitFolder = file(gitFolder).text.substring(8).trim() + \"/\"\n+    }\n+    def takeFromHash = 8\n+    /*\n+     * '.git/HEAD' contains either\n+     *      in case of detached head: the currently checked out commit hash\n+     *      otherwise: a reference to a file containing the current commit hash\n+     */\n+    def head = new File(gitFolder + \"HEAD\").text.split(\":\") // .git/HEAD\n+    def isCommit = head.length == 1 // e5a7c79edabbf7dd39888442df081b1c9d8e88fd\n+\n+    if (isCommit) return head[0].trim().take(takeFromHash) // e5a7c79edabb\n+\n+    def refHead = new File(gitFolder + head[1].trim()) // .git/refs/heads/master\n+    refHead.text.trim().take takeFromHash\n+  } catch (Exception e) {\n+    return \"xxxxxxxx\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDk1NjIyMg=="}, "originalCommit": {"oid": "c7828d7904021f24031559f813808dd3c652bdd0"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NDk2NDk5", "url": "https://github.com/hyperledger/besu/pull/327#pullrequestreview-348496499", "createdAt": "2020-01-27T08:31:52Z", "commit": {"oid": "d6456afe43ed33ca2a48cd0e44d60993416442dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80d75c3839bb481018d617cbb0c18ffde998765d", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/80d75c3839bb481018d617cbb0c18ffde998765d", "committedDate": "2020-01-27T08:31:58Z", "message": "Merge branch 'master' into gitversion"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1899, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}