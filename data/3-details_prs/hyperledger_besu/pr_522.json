{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwNDc3NzMx", "number": 522, "title": "[PIE-2333] Fix trace replay block transactions", "bodyText": "PR description\nhttps://pegasys1.atlassian.net/browse/PIE-2333\nSome fields (creationMethod, mem) are missing on the API trace_replayBlockTransactions\n\nAdd creationMethod field\nResolve missing mem field for CALL and DELEGATECALL with RETURN\nResolve invalid cost value for STATICCALL\nAdd new tests", "createdAt": "2020-03-18T14:42:51Z", "url": "https://github.com/hyperledger/besu/pull/522", "merged": true, "mergeCommit": {"oid": "fff1f5e13ff91f7f99efe9b27dc0a0d5da474bad"}, "closed": true, "closedAt": "2020-03-19T14:09:56Z", "author": {"login": "matkt"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM4aWHAH2gAyMzkwNDc3NzMxOjllMWE0OTFmYmUyZjQ3YWE0YjliYjgxMzM3YWRmMTc1MDgwZTAwOGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPJiWugH2gAyMzkwNDc3NzMxOjFjNGVkN2I5NjFmYTg2NjVhZWYxOGJjMDg2Njg3YTgzNjY3MThiYWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9e1a491fbe2f47aa4b9bb81337adf175080e008b", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/9e1a491fbe2f47aa4b9bb81337adf175080e008b", "committedDate": "2020-03-12T09:36:38Z", "message": "update changelog\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f91d6f0cb2305e3decd444d3796edf72da5e0b9", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/4f91d6f0cb2305e3decd444d3796edf72da5e0b9", "committedDate": "2020-03-12T15:28:02Z", "message": "Merge branch 'master' of https://github.com/hyperledger/besu\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>\n\n# Conflicts:\n#\tCHANGELOG.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b72e4aebeed925ea6eff57c6e831786fd2dd920", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/9b72e4aebeed925ea6eff57c6e831786fd2dd920", "committedDate": "2020-03-16T10:27:25Z", "message": "Merge branch 'master' of https://github.com/matkt/besu\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>\n\n# Conflicts:\n#\tCHANGELOG.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6853b33303744e64884eec8953ad8bd838ce07de", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/6853b33303744e64884eec8953ad8bd838ce07de", "committedDate": "2020-03-18T14:13:31Z", "message": "fix trace_replayBlockTransactions and add missing tests\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaa51949bef65c560ddf24453a18d6914a66f108", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/aaa51949bef65c560ddf24453a18d6914a66f108", "committedDate": "2020-03-18T14:28:37Z", "message": "remove useless diff\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddfd1cd10076fec19589a706f22ecb9be941cce0", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/ddfd1cd10076fec19589a706f22ecb9be941cce0", "committedDate": "2020-03-18T14:44:19Z", "message": "rename method addContractCreationMethodTrace\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2OTg3MTM1", "url": "https://github.com/hyperledger/besu/pull/522#pullrequestreview-376987135", "createdAt": "2020-03-18T15:39:19Z", "commit": {"oid": "ddfd1cd10076fec19589a706f22ecb9be941cce0"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNTozOToxOVrOF4K4Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNTo0MDoxMFrOF4K6pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ0Mjc5MQ==", "bodyText": "Why using a local variable there ? You could pass directly this value to the builder", "url": "https://github.com/hyperledger/besu/pull/522#discussion_r394442791", "createdAt": "2020-03-18T15:39:19Z", "author": {"login": "abdelhamidbakhta"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/results/tracing/flat/FlatTraceGenerator.java", "diffHunk": "@@ -428,21 +431,26 @@ private static void addAdditionalTransactionInformationToFlatTrace(\n         .transactionPosition(\n             block.getBody().getTransactions().indexOf(transactionTrace.getTransaction()))\n         .transactionHash(transactionTrace.getTransaction().getHash().toHexString());\n-    // add creationMethod for create action\n-    Optional.ofNullable(builder.getType())\n-        .filter(type -> type.equals(\"create\"))\n-        .ifPresent(__ -> addContractCreationMethodToFlatTrace(transactionTrace, builder));\n+\n+    addContractCreationMethodToTrace(transactionTrace, builder);\n   }\n \n-  private static void addContractCreationMethodToFlatTrace(\n+  private static void addContractCreationMethodToTrace(\n       final TransactionTrace transactionTrace, final FlatTrace.Builder builder) {\n-    final String creationMethod =\n-        transactionTrace.getTraceFrames().stream()\n-            .filter(frame -> \"CREATE2\".equals(frame.getOpcode()))\n-            .findFirst()\n-            .map(TraceFrame::getOpcode)\n-            .orElse(\"CREATE\")\n-            .toLowerCase(Locale.US);\n-    builder.getActionBuilder().creationMethod(creationMethod);\n+\n+    // add creationMethod for create action\n+    Optional.ofNullable(builder.getType())\n+        .filter(type -> type.equals(\"create\"))\n+        .ifPresent(\n+            __ -> {\n+              final String creationMethod =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfd1cd10076fec19589a706f22ecb9be941cce0"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ0MzQzMA==", "bodyText": "Have you tested with several levels deep ?", "url": "https://github.com/hyperledger/besu/pull/522#discussion_r394443430", "createdAt": "2020-03-18T15:40:10Z", "author": {"login": "abdelhamidbakhta"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/results/tracing/vm/VmTraceGenerator.java", "diffHunk": "@@ -172,6 +180,10 @@ private void handleDepthIncreased(\n         } else {\n           if (currentTraceFrame.getPrecompiledGasCost().isPresent()) {\n             op.setCost(op.getCost() + currentTraceFrame.getPrecompiledGasCost().get().toLong());\n+          } else if (currentOperation.equals(\"STATICCALL\")\n+              && nextTraceFrame.map(TraceFrame::getDepth).orElse(0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfd1cd10076fec19589a706f22ecb9be941cce0"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5629419689aaff0f94b8f95e522ebd16dad236a7", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/5629419689aaff0f94b8f95e522ebd16dad236a7", "committedDate": "2020-03-19T10:13:54Z", "message": "update test and fix review issues\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93606fbfadf24d11a2b741598f2d5e0c493f2703", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/93606fbfadf24d11a2b741598f2d5e0c493f2703", "committedDate": "2020-03-19T10:24:21Z", "message": "Merge commit 'bcdb1144b54949edac3b76ed456bf4d8e3e0741c' into feature/PIE-2333-fix-trace-replay-block-transactions\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c4ed7b961fa8665aef18bc086687a8366718bad", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/1c4ed7b961fa8665aef18bc086687a8366718bad", "committedDate": "2020-03-19T10:41:37Z", "message": "fix test after merge\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1833, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}