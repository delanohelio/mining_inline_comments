{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NTg0ODQ1", "number": 1078, "title": "Add cli option to specify the name of the loadbalancer used by the Kubernetes nat manager ", "bodyText": "PR description\nAdd cli option to specify the name of the loadbalancer used by the Kubernetes nat manager\n--Xnat-kube-pod-name\nWe can specify the name of the load balancer\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app.kubernetes.io/name: besu\n    app.kubernetes.io/release: \"1.0.0\"\n  name: besu-custom-name\nspec:\n  ports:\n  - name: \"json-rpc\"\n    port: 8545\n    targetPort: 8545\n  - name: \"rlpx\"\n    port: 30303\n    targetPort: 30303\n  selector:\n    app.kubernetes.io/name: besu\n    app.kubernetes.io/release: \"1.0.0\"\n  type: LoadBalancer\nAnd add the BESU_XNAT_KUBE_POD_NAMEon the deployment script of Besu to specify the name.\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: besu-config\n  labels:\n    app.kubernetes.io/name: besu\n    app.kubernetes.io/release: 1.0.0\ndata:\n  BESU_LOGGING: \"DEBUG\"\n  ....\n  BESU_XNAT_KUBE_POD_NAME: \"besu-custom-name\"\n  KUBE_CONFIG_PATH: \"/opt/besu/shared/kube-config\"\n---\nTested\n\nWith Kubernetes (valid and invalid parameters)\nWithout Kubernetes (valid and invalid parameters)\n\nFixed Issue(s)", "createdAt": "2020-06-15T14:39:55Z", "url": "https://github.com/hyperledger/besu/pull/1078", "merged": true, "mergeCommit": {"oid": "2ef6fe49981cd09decb3e206c0f1f681e0ffc439"}, "closed": true, "closedAt": "2020-06-16T11:09:09Z", "author": {"login": "matkt"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrhnvZAH2gAyNDM0NTg0ODQ1OmY3ODA5NjNmMjU2MWE1NTU2YzY3MTE1NGQ2NmE5YzE1NzdmZjYxMmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcryCP0AH2gAyNDM0NTg0ODQ1OmUxNmE1OWE3NjlkZDBmZDVlOTNjNjlkOGQ5YjM0MWUyZWQyMzE0MmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f780963f2561a5556c671154d66a9c1577ff612b", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/f780963f2561a5556c671154d66a9c1577ff612b", "committedDate": "2020-06-15T14:35:06Z", "message": "add cli option for kubernetes nat manager  (service besu name)\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b251d04a6b622dceeb7213506eafe3fbf7ad118b", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/b251d04a6b622dceeb7213506eafe3fbf7ad118b", "committedDate": "2020-06-15T16:48:44Z", "message": "update test\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwODMxNDE0", "url": "https://github.com/hyperledger/besu/pull/1078#pullrequestreview-430831414", "createdAt": "2020-06-15T17:02:46Z", "commit": {"oid": "b251d04a6b622dceeb7213506eafe3fbf7ad118b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNzowMjo0NlrOGj69hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxNzowOToyMVrOGj7LpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxOTM2Ng==", "bodyText": "Could we create a KubernetesConfiguration object, i suspect we will have more Kubernetes options in the future.", "url": "https://github.com/hyperledger/besu/pull/1078#discussion_r440319366", "createdAt": "2020-06-15T17:02:46Z", "author": {"login": "abdelhamidbakhta"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -419,6 +420,13 @@ void setBannedNodeIds(final List<String> values) {\n               + \" NONE disables NAT functionality. (default: ${DEFAULT-VALUE})\")\n   private final NatMethod natMethod = DEFAULT_NAT_METHOD;\n \n+  @SuppressWarnings({\"FieldCanBeFinal\", \"FieldMayBeFinal\"}) // PicoCLI requires non-final Strings.\n+  @Option(\n+      names = {\"--Xnat-manager-pod-name\"},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b251d04a6b622dceeb7213506eafe3fbf7ad118b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyMDQ1MQ==", "bodyText": "Or maybe NatConfiguration to group all NAT related CLI options.", "url": "https://github.com/hyperledger/besu/pull/1078#discussion_r440320451", "createdAt": "2020-06-15T17:04:42Z", "author": {"login": "abdelhamidbakhta"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -419,6 +420,13 @@ void setBannedNodeIds(final List<String> values) {\n               + \" NONE disables NAT functionality. (default: ${DEFAULT-VALUE})\")\n   private final NatMethod natMethod = DEFAULT_NAT_METHOD;\n \n+  @SuppressWarnings({\"FieldCanBeFinal\", \"FieldMayBeFinal\"}) // PicoCLI requires non-final Strings.\n+  @Option(\n+      names = {\"--Xnat-manager-pod-name\"},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxOTM2Ng=="}, "originalCommit": {"oid": "b251d04a6b622dceeb7213506eafe3fbf7ad118b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyMTYwNQ==", "bodyText": "Can you add a test with a non default value and check the value is used ?", "url": "https://github.com/hyperledger/besu/pull/1078#discussion_r440321605", "createdAt": "2020-06-15T17:06:49Z", "author": {"login": "abdelhamidbakhta"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -1329,6 +1330,16 @@ public void natMethodPropertyDefaultIsAuto() {\n     assertThat(commandErrorOutput.toString()).isEmpty();\n   }\n \n+  @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b251d04a6b622dceeb7213506eafe3fbf7ad118b"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyMjU0Mg==", "bodyText": "Also i would not use the term manager in the name of the option. I would use something like --Xnat-kubernetes-pod-name or --Xnat-kube-pod-name", "url": "https://github.com/hyperledger/besu/pull/1078#discussion_r440322542", "createdAt": "2020-06-15T17:08:33Z", "author": {"login": "abdelhamidbakhta"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -419,6 +420,13 @@ void setBannedNodeIds(final List<String> values) {\n               + \" NONE disables NAT functionality. (default: ${DEFAULT-VALUE})\")\n   private final NatMethod natMethod = DEFAULT_NAT_METHOD;\n \n+  @SuppressWarnings({\"FieldCanBeFinal\", \"FieldMayBeFinal\"}) // PicoCLI requires non-final Strings.\n+  @Option(\n+      names = {\"--Xnat-manager-pod-name\"},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMxOTM2Ng=="}, "originalCommit": {"oid": "b251d04a6b622dceeb7213506eafe3fbf7ad118b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyMjk4MA==", "bodyText": "Can you add a test that would trigger the exception raised by validateNatParams in BesuCommand ?", "url": "https://github.com/hyperledger/besu/pull/1078#discussion_r440322980", "createdAt": "2020-06-15T17:09:21Z", "author": {"login": "abdelhamidbakhta"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -1329,6 +1330,16 @@ public void natMethodPropertyDefaultIsAuto() {\n     assertThat(commandErrorOutput.toString()).isEmpty();\n   }\n \n+  @Test", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyMTYwNQ=="}, "originalCommit": {"oid": "b251d04a6b622dceeb7213506eafe3fbf7ad118b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2932f7b8a79aa728fe9b381f65a501a00c6e4aab", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/2932f7b8a79aa728fe9b381f65a501a00c6e4aab", "committedDate": "2020-06-15T17:28:30Z", "message": "fix review issues\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1f5d16fb481bff10442933fff005cfae17256ab", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/e1f5d16fb481bff10442933fff005cfae17256ab", "committedDate": "2020-06-15T17:35:47Z", "message": "spotless apply\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwODU2NDAw", "url": "https://github.com/hyperledger/besu/pull/1078#pullrequestreview-430856400", "createdAt": "2020-06-15T17:37:47Z", "commit": {"oid": "2932f7b8a79aa728fe9b381f65a501a00c6e4aab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e16a59a769dd0fd5e93c69d8d9b341e2ed23142c", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/e16a59a769dd0fd5e93c69d8d9b341e2ed23142c", "committedDate": "2020-06-16T09:42:32Z", "message": "Merge branch 'upstream/master' into feature/make-name-load-balancer-configurable\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1490, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}