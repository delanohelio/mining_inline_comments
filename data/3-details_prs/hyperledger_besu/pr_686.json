{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMTE1NzY5", "number": 686, "title": "Implemented priv_getLogs", "bodyText": "Implemented priv_getLogs. This JSON-RPC method is similar to eth_getLogs, but used to read logs from private transaction receipts.\nCloses #628", "createdAt": "2020-04-08T22:40:56Z", "url": "https://github.com/hyperledger/besu/pull/686", "merged": true, "mergeCommit": {"oid": "ba6f656e66784c0c48360ce1f8b56426a11a762e"}, "closed": true, "closedAt": "2020-04-14T08:40:29Z", "author": {"login": "lucassaldanha"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVv1urgBqjMyMTYxMTU4Nzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXexgbAFqTM5MjY4NzQxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9330661d86b9ebacd95b472ca1c3466f318c1af9", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/9330661d86b9ebacd95b472ca1c3466f318c1af9", "committedDate": "2020-04-08T22:38:31Z", "message": "Implemented priv_getLogs\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}, "afterCommit": {"oid": "4af9d1c9ab1d4c9cd2bda06eb3592bb6a58a6d85", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/4af9d1c9ab1d4c9cd2bda06eb3592bb6a58a6d85", "committedDate": "2020-04-08T22:42:21Z", "message": "Implemented priv_getLogs\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4af9d1c9ab1d4c9cd2bda06eb3592bb6a58a6d85", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/4af9d1c9ab1d4c9cd2bda06eb3592bb6a58a6d85", "committedDate": "2020-04-08T22:42:21Z", "message": "Implemented priv_getLogs\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}, "afterCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/9a5976865f191fd2d7a804d5a4e59b13318b7dab", "committedDate": "2020-04-08T22:45:55Z", "message": "Implemented priv_getLogs\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5296a576408828686be133a90bcaee3a533145d", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/c5296a576408828686be133a90bcaee3a533145d", "committedDate": "2020-04-14T02:58:53Z", "message": "Implemented priv_getLogs\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b03eca0a0c936a7b58b414b9bb41cb5365e4bf37", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/b03eca0a0c936a7b58b414b9bb41cb5365e4bf37", "committedDate": "2020-04-14T02:59:28Z", "message": "Removing comment\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNTM5Njgz", "url": "https://github.com/hyperledger/besu/pull/686#pullrequestreview-392539683", "createdAt": "2020-04-14T01:15:02Z", "commit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab"}, "state": "COMMENTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwMToxNTowMlrOGE6qKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwNDoxODoyNFrOGE9n7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwODU1Mw==", "bodyText": "The filter parameters are a bit confusing.  I understand that one of them has to be set, but what takes precedence if a from/to is set and the hash as well? Should that fail?", "url": "https://github.com/hyperledger/besu/pull/686#discussion_r407808553", "createdAt": "2020-04-14T01:15:02Z", "author": {"login": "pinges"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/parameters/FilterParameter.java", "diffHunk": "@@ -73,6 +73,14 @@ public Hash getBlockhash() {\n     return blockhash;\n   }\n \n+  public boolean isValid() {\n+    if (!getFromBlock().isLatest() && !getToBlock().isLatest() && getBlockhash() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgxMTU0MA==", "bodyText": "Can we do that check before we are building the query?", "url": "https://github.com/hyperledger/besu/pull/686#discussion_r407811540", "createdAt": "2020-04-14T01:25:51Z", "author": {"login": "pinges"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/privacy/methods/priv/PrivGetLogs.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.privacy.methods.priv;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.RpcMethod;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequestContext;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.JsonRpcMethod;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.parameters.FilterParameter;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.privacy.methods.EnclavePublicKeyProvider;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcError;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcErrorResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcSuccessResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.LogsResult;\n+import org.hyperledger.besu.ethereum.api.query.BlockchainQueries;\n+import org.hyperledger.besu.ethereum.api.query.LogsQuery;\n+import org.hyperledger.besu.ethereum.api.query.PrivacyQueries;\n+import org.hyperledger.besu.ethereum.privacy.PrivacyController;\n+\n+public class PrivGetLogs implements JsonRpcMethod {\n+\n+  private final BlockchainQueries blockchainQueries;\n+  private final PrivacyQueries privacyQueries;\n+  private final PrivacyController privacyController;\n+  private final EnclavePublicKeyProvider enclavePublicKeyProvider;\n+\n+  public PrivGetLogs(\n+      final BlockchainQueries blockchainQueries,\n+      final PrivacyQueries privacyQueries,\n+      final PrivacyController privacyController,\n+      final EnclavePublicKeyProvider enclavePublicKeyProvider) {\n+    this.blockchainQueries = blockchainQueries;\n+    this.privacyQueries = privacyQueries;\n+    this.privacyController = privacyController;\n+    this.enclavePublicKeyProvider = enclavePublicKeyProvider;\n+  }\n+\n+  @Override\n+  public String getName() {\n+    return RpcMethod.PRIV_GET_LOGS.getMethodName();\n+  }\n+\n+  @Override\n+  public JsonRpcResponse response(final JsonRpcRequestContext request) {\n+    final String privacyGroupId = request.getRequiredParameter(0, String.class);\n+    final FilterParameter filter = request.getRequiredParameter(1, FilterParameter.class);\n+\n+    checkIfPrivacyGroupMatchesAuthenticatedEnclaveKey(request, privacyGroupId);\n+\n+    final LogsQuery query =\n+        new LogsQuery.Builder().addresses(filter.getAddresses()).topics(filter.getTopics()).build();\n+\n+    if (!filter.isValid()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgxODgwMQ==", "bodyText": "Why don't you just call it \"privateTransactionMetadataList\"?", "url": "https://github.com/hyperledger/besu/pull/686#discussion_r407818801", "createdAt": "2020-04-14T01:52:14Z", "author": {"login": "pinges"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/query/PrivacyQueries.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.query;\n+\n+import org.hyperledger.besu.ethereum.chain.Blockchain;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.LogWithMetadata;\n+import org.hyperledger.besu.ethereum.privacy.PrivateTransactionReceipt;\n+import org.hyperledger.besu.ethereum.privacy.PrivateWorldStateReader;\n+import org.hyperledger.besu.ethereum.privacy.storage.PrivateTransactionMetadata;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+import java.util.stream.LongStream;\n+\n+public class PrivacyQueries {\n+\n+  private final Blockchain blockchain;\n+  private final PrivateWorldStateReader privateWorldStateReader;\n+\n+  public PrivacyQueries(\n+      final Blockchain blockchain, final PrivateWorldStateReader privateWorldStateReader) {\n+    this.blockchain = blockchain;\n+    this.privateWorldStateReader = privateWorldStateReader;\n+  }\n+\n+  public List<LogWithMetadata> matchingLogs(\n+      final String privacyGroupId,\n+      final long fromBlockNumber,\n+      final long toBlockNumber,\n+      final LogsQuery query) {\n+\n+    return LongStream.rangeClosed(fromBlockNumber, toBlockNumber)\n+        .mapToObj(blockchain::getBlockHashByNumber)\n+        .takeWhile(Optional::isPresent)\n+        .map(Optional::get)\n+        .map(hash -> matchingLogs(privacyGroupId, hash, query))\n+        .flatMap(List::stream)\n+        .collect(Collectors.toList());\n+  }\n+\n+  public List<LogWithMetadata> matchingLogs(\n+      final String privacyGroupId, final Hash blockHash, final LogsQuery query) {\n+\n+    final Optional<BlockHeader> blockHeader = blockchain.getBlockHeader(blockHash);\n+    if (blockHeader.isEmpty()) {\n+      return Collections.emptyList();\n+    }\n+\n+    final List<PrivateTransactionMetadata> privateTransactionMetadatas =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgyNzE0MA==", "bodyText": "privateTransactionReceiptList?", "url": "https://github.com/hyperledger/besu/pull/686#discussion_r407827140", "createdAt": "2020-04-14T02:22:42Z", "author": {"login": "pinges"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/query/PrivacyQueries.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.query;\n+\n+import org.hyperledger.besu.ethereum.chain.Blockchain;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.LogWithMetadata;\n+import org.hyperledger.besu.ethereum.privacy.PrivateTransactionReceipt;\n+import org.hyperledger.besu.ethereum.privacy.PrivateWorldStateReader;\n+import org.hyperledger.besu.ethereum.privacy.storage.PrivateTransactionMetadata;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+import java.util.stream.LongStream;\n+\n+public class PrivacyQueries {\n+\n+  private final Blockchain blockchain;\n+  private final PrivateWorldStateReader privateWorldStateReader;\n+\n+  public PrivacyQueries(\n+      final Blockchain blockchain, final PrivateWorldStateReader privateWorldStateReader) {\n+    this.blockchain = blockchain;\n+    this.privateWorldStateReader = privateWorldStateReader;\n+  }\n+\n+  public List<LogWithMetadata> matchingLogs(\n+      final String privacyGroupId,\n+      final long fromBlockNumber,\n+      final long toBlockNumber,\n+      final LogsQuery query) {\n+\n+    return LongStream.rangeClosed(fromBlockNumber, toBlockNumber)\n+        .mapToObj(blockchain::getBlockHashByNumber)\n+        .takeWhile(Optional::isPresent)\n+        .map(Optional::get)\n+        .map(hash -> matchingLogs(privacyGroupId, hash, query))\n+        .flatMap(List::stream)\n+        .collect(Collectors.toList());\n+  }\n+\n+  public List<LogWithMetadata> matchingLogs(\n+      final String privacyGroupId, final Hash blockHash, final LogsQuery query) {\n+\n+    final Optional<BlockHeader> blockHeader = blockchain.getBlockHeader(blockHash);\n+    if (blockHeader.isEmpty()) {\n+      return Collections.emptyList();\n+    }\n+\n+    final List<PrivateTransactionMetadata> privateTransactionMetadatas =\n+        privateWorldStateReader.getPrivateTransactionsMetadata(privacyGroupId, blockHash);\n+\n+    final List<PrivateTransactionReceipt> privateTransactionReceipts =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgzNTI2Ng==", "bodyText": "You should just use assertThatThrownBy() ...", "url": "https://github.com/hyperledger/besu/pull/686#discussion_r407835266", "createdAt": "2020-04-14T02:52:51Z", "author": {"login": "pinges"}, "path": "ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/privacy/methods/priv/PrivGetLogsTest.java", "diffHunk": "@@ -0,0 +1,233 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.privacy.methods.priv;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.catchThrowable;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.doThrow;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequest;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequestContext;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.exception.InvalidJsonRpcParameters;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.parameters.FilterParameter;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.privacy.methods.EnclavePublicKeyProvider;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcError;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcErrorResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcSuccessResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.LogsResult;\n+import org.hyperledger.besu.ethereum.api.query.BlockchainQueries;\n+import org.hyperledger.besu.ethereum.api.query.LogsQuery;\n+import org.hyperledger.besu.ethereum.api.query.PrivacyQueries;\n+import org.hyperledger.besu.ethereum.core.Address;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.LogTopic;\n+import org.hyperledger.besu.ethereum.core.LogWithMetadata;\n+import org.hyperledger.besu.ethereum.privacy.MultiTenancyValidationException;\n+import org.hyperledger.besu.ethereum.privacy.PrivacyController;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+\n+import com.google.common.collect.Lists;\n+import io.vertx.ext.auth.User;\n+import org.apache.tuweni.bytes.Bytes;\n+import org.apache.tuweni.bytes.Bytes32;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.MockitoJUnitRunner;\n+\n+@RunWith(MockitoJUnitRunner.class)\n+public class PrivGetLogsTest {\n+\n+  private final String ENCLAVE_KEY = \"enclave_key\";\n+  private final String PRIVACY_GROUP_ID = \"B1aVtMxLCUHmBVHXoZzzBgPbW/wj5axDpW9X8l91SGo=\";\n+\n+  @Mock private BlockchainQueries blockchainQueries;\n+  @Mock private PrivacyQueries privacyQueries;\n+  @Mock private PrivacyController privacyController;\n+  @Mock private EnclavePublicKeyProvider enclavePublicKeyProvider;\n+\n+  private PrivGetLogs method;\n+\n+  @Before\n+  public void before() {\n+    method =\n+        new PrivGetLogs(\n+            blockchainQueries, privacyQueries, privacyController, enclavePublicKeyProvider);\n+  }\n+\n+  @Test\n+  public void getMethodReturnsCorrectMethodName() {\n+    assertThat(method.getName()).isEqualTo(\"priv_getLogs\");\n+  }\n+\n+  @Test\n+  public void privacyGroupIdIsRequired() {\n+    final JsonRpcRequestContext request = privGetLogRequest(null, mock(FilterParameter.class));\n+\n+    final Throwable thrown = catchThrowable(() -> method.response(request));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgzNjE3OA==", "bodyText": "s.a.", "url": "https://github.com/hyperledger/besu/pull/686#discussion_r407836178", "createdAt": "2020-04-14T02:56:11Z", "author": {"login": "pinges"}, "path": "ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/privacy/methods/priv/PrivGetLogsTest.java", "diffHunk": "@@ -0,0 +1,233 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.privacy.methods.priv;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.catchThrowable;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.doThrow;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequest;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequestContext;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.exception.InvalidJsonRpcParameters;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.parameters.FilterParameter;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.privacy.methods.EnclavePublicKeyProvider;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcError;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcErrorResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcSuccessResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.LogsResult;\n+import org.hyperledger.besu.ethereum.api.query.BlockchainQueries;\n+import org.hyperledger.besu.ethereum.api.query.LogsQuery;\n+import org.hyperledger.besu.ethereum.api.query.PrivacyQueries;\n+import org.hyperledger.besu.ethereum.core.Address;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.LogTopic;\n+import org.hyperledger.besu.ethereum.core.LogWithMetadata;\n+import org.hyperledger.besu.ethereum.privacy.MultiTenancyValidationException;\n+import org.hyperledger.besu.ethereum.privacy.PrivacyController;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+\n+import com.google.common.collect.Lists;\n+import io.vertx.ext.auth.User;\n+import org.apache.tuweni.bytes.Bytes;\n+import org.apache.tuweni.bytes.Bytes32;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.MockitoJUnitRunner;\n+\n+@RunWith(MockitoJUnitRunner.class)\n+public class PrivGetLogsTest {\n+\n+  private final String ENCLAVE_KEY = \"enclave_key\";\n+  private final String PRIVACY_GROUP_ID = \"B1aVtMxLCUHmBVHXoZzzBgPbW/wj5axDpW9X8l91SGo=\";\n+\n+  @Mock private BlockchainQueries blockchainQueries;\n+  @Mock private PrivacyQueries privacyQueries;\n+  @Mock private PrivacyController privacyController;\n+  @Mock private EnclavePublicKeyProvider enclavePublicKeyProvider;\n+\n+  private PrivGetLogs method;\n+\n+  @Before\n+  public void before() {\n+    method =\n+        new PrivGetLogs(\n+            blockchainQueries, privacyQueries, privacyController, enclavePublicKeyProvider);\n+  }\n+\n+  @Test\n+  public void getMethodReturnsCorrectMethodName() {\n+    assertThat(method.getName()).isEqualTo(\"priv_getLogs\");\n+  }\n+\n+  @Test\n+  public void privacyGroupIdIsRequired() {\n+    final JsonRpcRequestContext request = privGetLogRequest(null, mock(FilterParameter.class));\n+\n+    final Throwable thrown = catchThrowable(() -> method.response(request));\n+\n+    assertThat(thrown)\n+        .isInstanceOf(InvalidJsonRpcParameters.class)\n+        .hasMessageContaining(\"Missing required json rpc parameter at index 0\");\n+  }\n+\n+  @Test\n+  public void filterParameterIsRequired() {\n+    final JsonRpcRequestContext request = privGetLogRequest(PRIVACY_GROUP_ID, null);\n+\n+    final Throwable thrown = catchThrowable(() -> method.response(request));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg0NjE0Mg==", "bodyText": "assertThatThrownBy?", "url": "https://github.com/hyperledger/besu/pull/686#discussion_r407846142", "createdAt": "2020-04-14T03:33:48Z", "author": {"login": "pinges"}, "path": "ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/privacy/methods/priv/PrivGetLogsTest.java", "diffHunk": "@@ -0,0 +1,233 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.privacy.methods.priv;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.catchThrowable;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.doThrow;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequest;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequestContext;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.exception.InvalidJsonRpcParameters;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.parameters.FilterParameter;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.privacy.methods.EnclavePublicKeyProvider;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcError;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcErrorResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.response.JsonRpcSuccessResponse;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.LogsResult;\n+import org.hyperledger.besu.ethereum.api.query.BlockchainQueries;\n+import org.hyperledger.besu.ethereum.api.query.LogsQuery;\n+import org.hyperledger.besu.ethereum.api.query.PrivacyQueries;\n+import org.hyperledger.besu.ethereum.core.Address;\n+import org.hyperledger.besu.ethereum.core.Hash;\n+import org.hyperledger.besu.ethereum.core.LogTopic;\n+import org.hyperledger.besu.ethereum.core.LogWithMetadata;\n+import org.hyperledger.besu.ethereum.privacy.MultiTenancyValidationException;\n+import org.hyperledger.besu.ethereum.privacy.PrivacyController;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+\n+import com.google.common.collect.Lists;\n+import io.vertx.ext.auth.User;\n+import org.apache.tuweni.bytes.Bytes;\n+import org.apache.tuweni.bytes.Bytes32;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.MockitoJUnitRunner;\n+\n+@RunWith(MockitoJUnitRunner.class)\n+public class PrivGetLogsTest {\n+\n+  private final String ENCLAVE_KEY = \"enclave_key\";\n+  private final String PRIVACY_GROUP_ID = \"B1aVtMxLCUHmBVHXoZzzBgPbW/wj5axDpW9X8l91SGo=\";\n+\n+  @Mock private BlockchainQueries blockchainQueries;\n+  @Mock private PrivacyQueries privacyQueries;\n+  @Mock private PrivacyController privacyController;\n+  @Mock private EnclavePublicKeyProvider enclavePublicKeyProvider;\n+\n+  private PrivGetLogs method;\n+\n+  @Before\n+  public void before() {\n+    method =\n+        new PrivGetLogs(\n+            blockchainQueries, privacyQueries, privacyController, enclavePublicKeyProvider);\n+  }\n+\n+  @Test\n+  public void getMethodReturnsCorrectMethodName() {\n+    assertThat(method.getName()).isEqualTo(\"priv_getLogs\");\n+  }\n+\n+  @Test\n+  public void privacyGroupIdIsRequired() {\n+    final JsonRpcRequestContext request = privGetLogRequest(null, mock(FilterParameter.class));\n+\n+    final Throwable thrown = catchThrowable(() -> method.response(request));\n+\n+    assertThat(thrown)\n+        .isInstanceOf(InvalidJsonRpcParameters.class)\n+        .hasMessageContaining(\"Missing required json rpc parameter at index 0\");\n+  }\n+\n+  @Test\n+  public void filterParameterIsRequired() {\n+    final JsonRpcRequestContext request = privGetLogRequest(PRIVACY_GROUP_ID, null);\n+\n+    final Throwable thrown = catchThrowable(() -> method.response(request));\n+\n+    assertThat(thrown)\n+        .isInstanceOf(InvalidJsonRpcParameters.class)\n+        .hasMessageContaining(\"Missing required json rpc parameter at index 1\");\n+  }\n+\n+  @Test\n+  public void filterWithInvalidParameters() {\n+    final FilterParameter invalidFilter =\n+        new FilterParameter(\n+            \"earliest\",\n+            \"earliest\",\n+            Collections.emptyList(),\n+            Collections.emptyList(),\n+            Hash.ZERO.toHexString());\n+\n+    final JsonRpcRequestContext request = privGetLogRequest(PRIVACY_GROUP_ID, invalidFilter);\n+\n+    final JsonRpcResponse expectedResponse =\n+        new JsonRpcErrorResponse(null, JsonRpcError.INVALID_PARAMS);\n+\n+    final JsonRpcResponse response = method.response(request);\n+\n+    assertThat(response).usingRecursiveComparison().isEqualTo(expectedResponse);\n+  }\n+\n+  @Test\n+  public void logQueryIsBuiltCorrectly() {\n+    final Hash blockHash = Hash.hash(Bytes32.random());\n+    final List<Address> addresses = List.of(Address.ZERO);\n+    final List<List<LogTopic>> logTopics = List.of(List.of(LogTopic.of(Bytes32.random())));\n+\n+    final FilterParameter blockHashFilter =\n+        new FilterParameter(null, null, addresses, logTopics, blockHash.toHexString());\n+\n+    final LogsQuery expectedQuery =\n+        new LogsQuery.Builder().addresses(addresses).topics(logTopics).build();\n+\n+    final JsonRpcRequestContext request = privGetLogRequest(PRIVACY_GROUP_ID, blockHashFilter);\n+    method.response(request);\n+\n+    verify(privacyQueries).matchingLogs(eq(PRIVACY_GROUP_ID), eq(blockHash), eq((expectedQuery)));\n+  }\n+\n+  @Test\n+  public void filterWithBlockHashQueriesOneBlockByHash() {\n+    final Hash blockHash = Hash.hash(Bytes32.random());\n+    final FilterParameter blockHashFilter =\n+        new FilterParameter(\n+            null, null, Collections.emptyList(), Collections.emptyList(), blockHash.toHexString());\n+\n+    final List<LogWithMetadata> logWithMetadataList = logWithMetadataList(3);\n+    final LogsResult expectedLogsResult = new LogsResult(logWithMetadataList);\n+\n+    when(privacyQueries.matchingLogs(eq(PRIVACY_GROUP_ID), eq(blockHash), any(LogsQuery.class)))\n+        .thenReturn(logWithMetadataList);\n+\n+    final JsonRpcRequestContext request = privGetLogRequest(PRIVACY_GROUP_ID, blockHashFilter);\n+    final JsonRpcSuccessResponse response = (JsonRpcSuccessResponse) method.response(request);\n+    final LogsResult logsResult = (LogsResult) response.getResult();\n+\n+    assertThat(logsResult).usingRecursiveComparison().isEqualTo(expectedLogsResult);\n+  }\n+\n+  @Test\n+  public void filterWithBlockRangeQueriesRangeOfBlock() {\n+    long chainHeadBlockNumber = 3L;\n+    final FilterParameter blockHashFilter =\n+        new FilterParameter(\n+            \"earliest\", \"latest\", Collections.emptyList(), Collections.emptyList(), null);\n+    final List<LogWithMetadata> logWithMetadataList = logWithMetadataList(3);\n+    final LogsResult expectedLogsResult = new LogsResult(logWithMetadataList);\n+\n+    when(blockchainQueries.headBlockNumber()).thenReturn(chainHeadBlockNumber);\n+    when(privacyQueries.matchingLogs(\n+            eq(PRIVACY_GROUP_ID), eq(0L), eq(chainHeadBlockNumber), any(LogsQuery.class)))\n+        .thenReturn(logWithMetadataList);\n+\n+    final JsonRpcRequestContext request = privGetLogRequest(PRIVACY_GROUP_ID, blockHashFilter);\n+    final JsonRpcSuccessResponse response = (JsonRpcSuccessResponse) method.response(request);\n+    final LogsResult logsResult = (LogsResult) response.getResult();\n+\n+    assertThat(logsResult).usingRecursiveComparison().isEqualTo(expectedLogsResult);\n+  }\n+\n+  @Test\n+  public void multiTenancyCheckFailure() {\n+    final User user = mock(User.class);\n+    final FilterParameter filterParameter = mock(FilterParameter.class);\n+\n+    when(enclavePublicKeyProvider.getEnclaveKey(any())).thenReturn(ENCLAVE_KEY);\n+    doThrow(new MultiTenancyValidationException(\"msg\"))\n+        .when(privacyController)\n+        .verifyPrivacyGroupContainsEnclavePublicKey(eq(PRIVACY_GROUP_ID), eq(ENCLAVE_KEY));\n+\n+    final JsonRpcRequestContext request =\n+        privGetLogRequestWithUser(PRIVACY_GROUP_ID, filterParameter, user);\n+    final Throwable thrown = catchThrowable(() -> method.response(request));\n+\n+    assertThat(thrown).isInstanceOf(MultiTenancyValidationException.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab"}, "originalPosition": 201}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg1NDE2Nw==", "bodyText": "are you sure that the privacyGroup cannot be null?", "url": "https://github.com/hyperledger/besu/pull/686#discussion_r407854167", "createdAt": "2020-04-14T04:06:16Z", "author": {"login": "pinges"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/privacy/MultiTenancyPrivacyController.java", "diffHunk": "@@ -236,7 +236,8 @@ private void verifyPrivateFromMatchesEnclavePublicKey(\n     }\n   }\n \n-  private void verifyPrivacyGroupContainsEnclavePublicKey(\n+  @Override\n+  public void verifyPrivacyGroupContainsEnclavePublicKey(\n       final String privacyGroupId, final String enclavePublicKey) {\n     final PrivacyGroup privacyGroup = enclave.retrievePrivacyGroup(privacyGroupId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg1NDg4MQ==", "bodyText": "should that be \"getPrivateTransactionMetadataList\"?", "url": "https://github.com/hyperledger/besu/pull/686#discussion_r407854881", "createdAt": "2020-04-14T04:09:18Z", "author": {"login": "pinges"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/privacy/PrivateWorldStateReader.java", "diffHunk": "@@ -46,4 +54,20 @@ public PrivateWorldStateReader(\n         .flatMap(worldState -> Optional.ofNullable(worldState.get(contractAddress)))\n         .flatMap(account -> Optional.ofNullable(account.getCode()));\n   }\n+\n+  public List<PrivateTransactionMetadata> getPrivateTransactionsMetadata(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg1NzEzMw==", "bodyText": "Could create a const privacy group ... The same one is used twice.", "url": "https://github.com/hyperledger/besu/pull/686#discussion_r407857133", "createdAt": "2020-04-14T04:18:24Z", "author": {"login": "pinges"}, "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/privacy/MultiTenancyPrivacyControllerTest.java", "diffHunk": "@@ -418,4 +419,26 @@ public void getContractCodeFailsForInvalidEnclaveKey() {\n                     PRIVACY_GROUP_ID, Address.ZERO, Hash.ZERO, ENCLAVE_PUBLIC_KEY2))\n         .hasMessage(\"Privacy group must contain the enclave public key\");\n   }\n+\n+  @Test\n+  public void verifyPrivacyGroupMatchesEnclaveKeySucceeds() {\n+    final PrivacyGroup privacyGroup =\n+        new PrivacyGroup(PRIVACY_GROUP_ID, Type.PANTHEON, \"\", \"\", List.of(ENCLAVE_PUBLIC_KEY1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1092f30885eebe4bcd869cf47fbaa7b80fb9f1f1", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/1092f30885eebe4bcd869cf47fbaa7b80fb9f1f1", "committedDate": "2020-04-14T05:51:22Z", "message": "PR comments\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e97569f70ee8d51acf2e289cc6986c21f8f5a1a", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/0e97569f70ee8d51acf2e289cc6986c21f8f5a1a", "committedDate": "2020-04-14T05:52:52Z", "message": "priv_getLogs ATs\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9a5976865f191fd2d7a804d5a4e59b13318b7dab", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/9a5976865f191fd2d7a804d5a4e59b13318b7dab", "committedDate": "2020-04-08T22:45:55Z", "message": "Implemented priv_getLogs\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}, "afterCommit": {"oid": "0e97569f70ee8d51acf2e289cc6986c21f8f5a1a", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/0e97569f70ee8d51acf2e289cc6986c21f8f5a1a", "committedDate": "2020-04-14T05:52:52Z", "message": "priv_getLogs ATs\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e61cc169a6c711a87a919abd5f74673034931f5d", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/e61cc169a6c711a87a919abd5f74673034931f5d", "committedDate": "2020-04-14T05:55:01Z", "message": "Merge branch 'master' into priv_getLogs\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f724ed40e96a7f45f33fa977f1e1d77352854c4", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/9f724ed40e96a7f45f33fa977f1e1d77352854c4", "committedDate": "2020-04-14T06:01:00Z", "message": "Fix finals\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNjM0MjI4", "url": "https://github.com/hyperledger/besu/pull/686#pullrequestreview-392634228", "createdAt": "2020-04-14T06:26:42Z", "commit": {"oid": "0e97569f70ee8d51acf2e289cc6986c21f8f5a1a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwNjoyNjo0M1rOGE_6JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwNjoyNjo0M1rOGE_6JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzg5NDU2NQ==", "bodyText": "nit: can be final", "url": "https://github.com/hyperledger/besu/pull/686#discussion_r407894565", "createdAt": "2020-04-14T06:26:43Z", "author": {"login": "pinges"}, "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/privacy/contract/CallPrivateSmartContractFunction.java", "diffHunk": "@@ -46,22 +48,65 @@ public CallPrivateSmartContractFunction(\n       final long chainId,\n       final String privateFrom,\n       final List<String> privateFor) {\n+    this(\n+        contractAddress,\n+        encodedFunction,\n+        transactionSigningKey,\n+        chainId,\n+        privateFrom,\n+        privateFor,\n+        null);\n+  }\n+\n+  public CallPrivateSmartContractFunction(\n+      final String contractAddress,\n+      final String encodedFunction,\n+      final String transactionSigningKey,\n+      final long chainId,\n+      final String privateFrom,\n+      final String privacyGroupId) {\n+    this(\n+        contractAddress,\n+        encodedFunction,\n+        transactionSigningKey,\n+        chainId,\n+        privateFrom,\n+        null,\n+        privacyGroupId);\n+  }\n+\n+  private CallPrivateSmartContractFunction(\n+      final String contractAddress,\n+      final String encodedFunction,\n+      final String transactionSigningKey,\n+      final long chainId,\n+      final String privateFrom,\n+      final List<String> privateFor,\n+      final String privacyGroupId) {\n \n     this.contractAddress = contractAddress;\n     this.encodedFunction = encodedFunction;\n     this.senderCredentials = Credentials.create(transactionSigningKey);\n     this.chainId = chainId;\n     this.privateFrom = Base64String.wrap(privateFrom);\n-    this.privateFor = Base64String.wrapList(privateFor);\n+    this.privateFor = privateFor != null ? Base64String.wrapList(privateFor) : null;\n+    this.privacyGroupId = privacyGroupId != null ? Base64String.wrap(privacyGroupId) : null;\n   }\n \n   @Override\n   public String execute(final NodeRequests node) {\n     final Besu besu = node.privacy().getBesuClient();\n \n-    final PrivateTransactionManager privateTransactionManager =\n-        new LegacyPrivateTransactionManager(\n-            besu, GAS_PROVIDER, senderCredentials, chainId, privateFrom, privateFor);\n+    PrivateTransactionManager privateTransactionManager;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e97569f70ee8d51acf2e289cc6986c21f8f5a1a"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f1ce56fc6c5f689e5cc240029a7ec74f114eb39", "author": {"user": {"login": "lucassaldanha", "name": "Lucas Saldanha"}}, "url": "https://github.com/hyperledger/besu/commit/9f1ce56fc6c5f689e5cc240029a7ec74f114eb39", "committedDate": "2020-04-14T07:48:30Z", "message": "Fix tests\n\nSigned-off-by: Lucas Saldanha <lucas.saldanha@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNjg3NDEx", "url": "https://github.com/hyperledger/besu/pull/686#pullrequestreview-392687411", "createdAt": "2020-04-14T07:57:34Z", "commit": {"oid": "9f1ce56fc6c5f689e5cc240029a7ec74f114eb39"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1701, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}