{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2NjYwNTkz", "number": 1022, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNTozNDoyOFrOEBzI1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNTozNDoyOFrOEBzI1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMzIxODc2OnYy", "diffSide": "RIGHT", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/vm/Code.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNTozNDoyOFrOGd3W0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjoxNDo0N1rOGd5f9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk2ODg1MQ==", "bodyText": "I thought this is only an issue for jump sub? I thought we're allowed to have a jumpdest be the last op in the code.", "url": "https://github.com/hyperledger/besu/pull/1022#discussion_r433968851", "createdAt": "2020-06-02T15:34:28Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/vm/Code.java", "diffHunk": "@@ -116,7 +116,7 @@ public boolean isValidJumpSubDestination(\n       final EVM evm, final MessageFrame frame, final UInt256 destination) {\n     if (!destination.fitsInt()) return false;\n     final int jumpDestination = destination.intValue();\n-    if (jumpDestination > getSize()) return false;\n+    if (jumpDestination >= getSize()) return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34e25cf44afd2665751945061b6a1475b42e2cce"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk3ODgyMQ==", "bodyText": "it is true we're allowed to have a jumpdest be the last op in the code. but if the destination is equal to the size of the code it is because we are outside the code (PC == 0). I added a test to validate the fact that we can have a jumpdest at the end of the code shouldJumpWhenLocationIsJumpDestAndAtEndOfCode", "url": "https://github.com/hyperledger/besu/pull/1022#discussion_r433978821", "createdAt": "2020-06-02T15:46:21Z", "author": {"login": "matkt"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/vm/Code.java", "diffHunk": "@@ -116,7 +116,7 @@ public boolean isValidJumpSubDestination(\n       final EVM evm, final MessageFrame frame, final UInt256 destination) {\n     if (!destination.fitsInt()) return false;\n     final int jumpDestination = destination.intValue();\n-    if (jumpDestination > getSize()) return false;\n+    if (jumpDestination >= getSize()) return false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk2ODg1MQ=="}, "originalCommit": {"oid": "34e25cf44afd2665751945061b6a1475b42e2cce"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk4Nzk3NA==", "bodyText": "Ah! Ok, that makes sense.", "url": "https://github.com/hyperledger/besu/pull/1022#discussion_r433987974", "createdAt": "2020-06-02T15:55:24Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/vm/Code.java", "diffHunk": "@@ -116,7 +116,7 @@ public boolean isValidJumpSubDestination(\n       final EVM evm, final MessageFrame frame, final UInt256 destination) {\n     if (!destination.fitsInt()) return false;\n     final int jumpDestination = destination.intValue();\n-    if (jumpDestination > getSize()) return false;\n+    if (jumpDestination >= getSize()) return false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk2ODg1MQ=="}, "originalCommit": {"oid": "34e25cf44afd2665751945061b6a1475b42e2cce"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk4OTcxMg==", "bodyText": "Wait, shouldn't it be something like >= getSize() -1? Because jump sub can't be the last instruction either? So it's technically inbounds but not actually legal.", "url": "https://github.com/hyperledger/besu/pull/1022#discussion_r433989712", "createdAt": "2020-06-02T15:57:05Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/vm/Code.java", "diffHunk": "@@ -116,7 +116,7 @@ public boolean isValidJumpSubDestination(\n       final EVM evm, final MessageFrame frame, final UInt256 destination) {\n     if (!destination.fitsInt()) return false;\n     final int jumpDestination = destination.intValue();\n-    if (jumpDestination > getSize()) return false;\n+    if (jumpDestination >= getSize()) return false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk2ODg1MQ=="}, "originalCommit": {"oid": "34e25cf44afd2665751945061b6a1475b42e2cce"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwMzQ4MQ==", "bodyText": "Jumbsub can be the last instruction. there is a sample in the EIP (https://github.com/ethereum/EIPs/blob/master/EIPS/eip-2315.md#subroutine-at-end-of-code) . You can see the Jumpsub opcode at the end of the code. 0x6005565c5d5b60035e (0x5e)", "url": "https://github.com/hyperledger/besu/pull/1022#discussion_r434003481", "createdAt": "2020-06-02T16:14:02Z", "author": {"login": "matkt"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/vm/Code.java", "diffHunk": "@@ -116,7 +116,7 @@ public boolean isValidJumpSubDestination(\n       final EVM evm, final MessageFrame frame, final UInt256 destination) {\n     if (!destination.fitsInt()) return false;\n     final int jumpDestination = destination.intValue();\n-    if (jumpDestination > getSize()) return false;\n+    if (jumpDestination >= getSize()) return false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk2ODg1MQ=="}, "originalCommit": {"oid": "34e25cf44afd2665751945061b6a1475b42e2cce"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwMzk1OA==", "bodyText": "Ok, all I needed to know, LGTM!", "url": "https://github.com/hyperledger/besu/pull/1022#discussion_r434003958", "createdAt": "2020-06-02T16:14:47Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/vm/Code.java", "diffHunk": "@@ -116,7 +116,7 @@ public boolean isValidJumpSubDestination(\n       final EVM evm, final MessageFrame frame, final UInt256 destination) {\n     if (!destination.fitsInt()) return false;\n     final int jumpDestination = destination.intValue();\n-    if (jumpDestination > getSize()) return false;\n+    if (jumpDestination >= getSize()) return false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk2ODg1MQ=="}, "originalCommit": {"oid": "34e25cf44afd2665751945061b6a1475b42e2cce"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 906, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}