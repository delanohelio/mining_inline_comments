{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NzI0ODg1", "number": 449, "title": "PIE-1961 - Add trace block api", "bodyText": "PR description\nImplement a trace block api (tested with contract creation, selfdetruct, uncle reward, etc.)\nhttps://pegasys1.atlassian.net/browse/PIE-1961\nRequest :\n{\"jsonrpc\":\"2.0\",\"method\":\"trace_block\",\"params\":[\"0x6\"],\"id\":415}\nResponse :\n{\n    \"jsonrpc\": \"2.0\",\n    \"result\": [\n      {\n        \"action\": {\n          \"callType\": \"call\",\n          \"from\": \"0xfe3b557e8fb62b89f4916b721be55ceb828dbd73\",\n          \"gas\": \"0xffad82\",\n          \"input\": \"0x0000000000000000000000000000000000000999\",\n          \"to\": \"0x0020000000000000000000000000000000000000\",\n          \"value\": \"0x0\"\n        },\n        \"blockHash\": \"0x71512d31e18f828cef069a87bc2c7514a8ca334f9ee72625efdf5cc2d43768dd\",\n        \"blockNumber\": 6,\n        \"result\": {\n          \"gasUsed\": \"0x7536\",\n          \"output\": \"0x\"\n        },\n        \"subtraces\": 1,\n        \"traceAddress\": [],\n        \"transactionHash\": \"0x91eeabc671e2dd2b1c8ddebb46ba59e8cb3e7d189f80bcc868a9787728c6e59e\",\n        \"transactionPosition\": 0,\n        \"type\": \"call\"\n      },\n      {\n        \"action\": {\n          \"address\": \"0x0020000000000000000000000000000000000000\",\n          \"balance\": \"0x300\",\n          \"refundAddress\": \"0x0000000000000999000000000000000000000000\"\n        },\n        \"blockHash\": \"0x71512d31e18f828cef069a87bc2c7514a8ca334f9ee72625efdf5cc2d43768dd\",\n        \"blockNumber\": 6,\n        \"result\": null,\n        \"subtraces\": 0,\n        \"traceAddress\": [\n          0\n        ],\n        \"transactionHash\": \"0x91eeabc671e2dd2b1c8ddebb46ba59e8cb3e7d189f80bcc868a9787728c6e59e\",\n        \"transactionPosition\": 0,\n        \"type\": \"suicide\"\n      },\n      {\n        \"action\": {\n          \"author\": \"0x0000000000000000000000000000000000000000\",\n          \"rewardType\": \"block\",\n          \"value\": \"0x1bc16d674ec80000\"\n        },\n        \"blockHash\": \"0x71512d31e18f828cef069a87bc2c7514a8ca334f9ee72625efdf5cc2d43768dd\",\n        \"blockNumber\": 6,\n        \"result\": null,\n        \"subtraces\": 0,\n        \"traceAddress\": [],\n        \"transactionHash\": null,\n        \"transactionPosition\": null,\n        \"type\": \"reward\"\n      }\n    ],\n    \"id\": 415\n  }", "createdAt": "2020-03-11T14:30:45Z", "url": "https://github.com/hyperledger/besu/pull/449", "merged": true, "mergeCommit": {"oid": "3902d00ec2874789780d71ff474610f4ed76e33c"}, "closed": true, "closedAt": "2020-03-17T12:44:50Z", "author": {"login": "matkt"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMSHPBAH2gAyMzg2NzI0ODg1OjAzNDRjYTQ3NGI4MWM2NTY1N2ZjNzA1Yjc4OWJjNmMzMTAwOGQ1NzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOgTtrgH2gAyMzg2NzI0ODg1OmMzZmUyMDJiYzA1MWE2NjMxMzgwY2E5NTA3MDM0YzE3ZWU5ZWRmYmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0344ca474b81c65657fc705b789bc6c31008d571", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/0344ca474b81c65657fc705b789bc6c31008d571", "committedDate": "2020-03-10T12:59:22Z", "message": "init trace_block api\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a39f2a50a710b39ab01d92b5004e4b9151b1d10", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/7a39f2a50a710b39ab01d92b5004e4b9151b1d10", "committedDate": "2020-03-10T13:01:26Z", "message": "add test for trace_block api\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0f63e529cf9f0e747b7ff13968b1b94353ecd9b", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/d0f63e529cf9f0e747b7ff13968b1b94353ecd9b", "committedDate": "2020-03-11T12:36:49Z", "message": "fix trace_block api issue\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b01d32558ae6b0235927fd5db7950ac07430a323", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/b01d32558ae6b0235927fd5db7950ac07430a323", "committedDate": "2020-03-11T13:05:41Z", "message": "fix trace_block api block reward issue\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d7b8d334a8670692508e0fa9050852388f49f5d", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/0d7b8d334a8670692508e0fa9050852388f49f5d", "committedDate": "2020-03-11T13:11:00Z", "message": "fix trace_block api block reward issue order\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "606b8fb6a88768b5e72ab9bf9ae21a5e14ee4632", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/606b8fb6a88768b5e72ab9bf9ae21a5e14ee4632", "committedDate": "2020-03-11T13:16:11Z", "message": "add ommer reward to block reward\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79d2c3334c4d228f3dd2174d3791368ab44594d5", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/79d2c3334c4d228f3dd2174d3791368ab44594d5", "committedDate": "2020-03-11T13:38:45Z", "message": "change to uncle inclusion reward\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39346bdfcd78343e152db09e5a5d74e6b713ca95", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/39346bdfcd78343e152db09e5a5d74e6b713ca95", "committedDate": "2020-03-11T13:42:50Z", "message": "add reward without transaction\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efccea8a8db47c3ce68c0eb96bc050989e218b24", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/efccea8a8db47c3ce68c0eb96bc050989e218b24", "committedDate": "2020-03-11T14:03:29Z", "message": "fix last issues and clean code\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc9f474deca3955e57119922b26be82c3fae85ef", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/cc9f474deca3955e57119922b26be82c3fae85ef", "committedDate": "2020-03-11T14:35:08Z", "message": "rename generate reward method\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd5ad39584a475f3b86bc80808d03132eb079cc6", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/fd5ad39584a475f3b86bc80808d03132eb079cc6", "committedDate": "2020-03-11T15:36:25Z", "message": "Merge commit 'f03061d2b41af012dd1fbefea2d15540de24e015' into feature/pie-1961-add-trace-block-api\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyOTMxNjI1", "url": "https://github.com/hyperledger/besu/pull/449#pullrequestreview-372931625", "createdAt": "2020-03-11T16:36:51Z", "commit": {"oid": "fd5ad39584a475f3b86bc80808d03132eb079cc6"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNjozNjo1MlrOF0_Obw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNjo0MTo0NlrOF0_b5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEwNjE1OQ==", "bodyText": "you can make the mapper static - also reuse the same one with emptyResult", "url": "https://github.com/hyperledger/besu/pull/449#discussion_r391106159", "createdAt": "2020-03-11T16:36:52Z", "author": {"login": "atoulme"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/TraceBlock.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.RpcMethod;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.JsonRpcRequestContext;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.parameters.BlockParameter;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.processor.BlockTracer;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.processor.TransactionTrace;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.tracing.flat.FlatTraceGenerator;\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.tracing.flat.RewardTraceGenerator;\n+import org.hyperledger.besu.ethereum.api.query.BlockchainQueries;\n+import org.hyperledger.besu.ethereum.core.Block;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.debug.TraceOptions;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSchedule;\n+import org.hyperledger.besu.ethereum.vm.DebugOperationTracer;\n+\n+import java.util.List;\n+import java.util.function.Supplier;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+\n+public class TraceBlock extends AbstractBlockParameterMethod {\n+  private final Supplier<BlockTracer> blockTracerSupplier;\n+  private final ProtocolSchedule<?> protocolSchedule;\n+\n+  public TraceBlock(\n+      final Supplier<BlockTracer> blockTracerSupplier,\n+      final ProtocolSchedule<?> protocolSchedule,\n+      final BlockchainQueries queries) {\n+    super(queries);\n+    this.blockTracerSupplier = blockTracerSupplier;\n+    this.protocolSchedule = protocolSchedule;\n+  }\n+\n+  @Override\n+  public String getName() {\n+    return RpcMethod.TRACE_BLOCK.getMethodName();\n+  }\n+\n+  @Override\n+  protected BlockParameter blockParameter(final JsonRpcRequestContext request) {\n+    return request.getRequiredParameter(0, BlockParameter.class);\n+  }\n+\n+  @Override\n+  protected Object resultByBlockNumber(\n+      final JsonRpcRequestContext request, final long blockNumber) {\n+    if (blockNumber == BlockHeader.GENESIS_BLOCK_NUMBER) {\n+      // Nothing to trace for the genesis block\n+      return emptyResult();\n+    }\n+\n+    return getBlockchainQueries()\n+        .getBlockchain()\n+        .getBlockByNumber(blockNumber)\n+        .map(this::traceBlock)\n+        .orElse(null);\n+  }\n+\n+  private Object traceBlock(final Block block) {\n+\n+    if (block == null) {\n+      return emptyResult();\n+    }\n+    final ObjectMapper mapper = new ObjectMapper();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd5ad39584a475f3b86bc80808d03132eb079cc6"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEwNzk3Ng==", "bodyText": "My understanding from working with @shemnon on JSON serialized code is that the team likes to have the right getters, but also to add @JsonProperty with the field names so it's obvious the method is used for JSON serialization.", "url": "https://github.com/hyperledger/besu/pull/449#discussion_r391107976", "createdAt": "2020-03-11T16:39:30Z", "author": {"login": "atoulme"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/results/tracing/flat/Action.java", "diffHunk": "@@ -109,6 +131,14 @@ public String getRefundAddress() {\n     return refundAddress;\n   }\n \n+  public String getAuthor() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd5ad39584a475f3b86bc80808d03132eb079cc6"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEwODE5MA==", "bodyText": "Same here on adding @JsonProperty", "url": "https://github.com/hyperledger/besu/pull/449#discussion_r391108190", "createdAt": "2020-03-11T16:39:47Z", "author": {"login": "atoulme"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/results/tracing/flat/FlatTrace.java", "diffHunk": "@@ -273,6 +265,38 @@ public Builder error(final Optional<String> error) {\n       return this;\n     }\n \n+    public String getType() {\n+      return type;\n+    }\n+\n+    public int getSubtraces() {\n+      return subtraces;\n+    }\n+\n+    public List<Integer> getTraceAddress() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd5ad39584a475f3b86bc80808d03132eb079cc6"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEwODk2MA==", "bodyText": "Is 8 here a magic number?", "url": "https://github.com/hyperledger/besu/pull/449#discussion_r391108960", "createdAt": "2020-03-11T16:40:50Z", "author": {"login": "atoulme"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/results/tracing/flat/RewardTraceGenerator.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.tracing.flat;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.tracing.Trace;\n+import org.hyperledger.besu.ethereum.core.Block;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+import org.hyperledger.besu.ethereum.mainnet.MiningBeneficiaryCalculator;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSchedule;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSpec;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.stream.Stream;\n+\n+public class RewardTraceGenerator {\n+\n+  private static final String REWARD_LABEL = \"reward\";\n+  private static final String BLOCK_LABEL = \"block\";\n+  private static final String UNCLE_LABEL = \"uncle\";\n+\n+  /**\n+   * Generates a stream of reward {@link Trace} from the passed {@link Block} data.\n+   *\n+   * @param protocolSchedule the {@link ProtocolSchedule} to use\n+   * @param block the current {@link Block} to use\n+   * @return a stream of generated reward traces {@link Trace}\n+   */\n+  public static Stream<Trace> generateFromBlock(\n+      final ProtocolSchedule<?> protocolSchedule, final Block block) {\n+\n+    final List<Trace> flatTraces = new ArrayList<>();\n+\n+    final BlockHeader blockHeader = block.getHeader();\n+    final ProtocolSpec<?> protocolSpec = protocolSchedule.getByBlockNumber(blockHeader.getNumber());\n+    final MiningBeneficiaryCalculator miningBeneficiaryCalculator =\n+        protocolSpec.getMiningBeneficiaryCalculator();\n+\n+    final AtomicReference<Wei> totalBlockReward =\n+        new AtomicReference<>(protocolSpec.getBlockReward());\n+\n+    // add uncle reward traces\n+    block\n+        .getBody()\n+        .getOmmers()\n+        .forEach(\n+            ommerBlockHeader -> {\n+              final long distance = blockHeader.getNumber() - ommerBlockHeader.getNumber();\n+              final Wei blockReward = protocolSpec.getBlockReward();\n+              final Wei ommerReward =\n+                  blockReward.subtract(blockReward.multiply(distance).divide(8));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd5ad39584a475f3b86bc80808d03132eb079cc6"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTEwOTYwNw==", "bodyText": "Same, is 32 a magic number? Should that logic be tested elsewhere? It may be impacted by the chain spec (ETH vs ETC have different block rewards)", "url": "https://github.com/hyperledger/besu/pull/449#discussion_r391109607", "createdAt": "2020-03-11T16:41:46Z", "author": {"login": "atoulme"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/results/tracing/flat/RewardTraceGenerator.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.tracing.flat;\n+\n+import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.tracing.Trace;\n+import org.hyperledger.besu.ethereum.core.Block;\n+import org.hyperledger.besu.ethereum.core.BlockHeader;\n+import org.hyperledger.besu.ethereum.core.Wei;\n+import org.hyperledger.besu.ethereum.mainnet.MiningBeneficiaryCalculator;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSchedule;\n+import org.hyperledger.besu.ethereum.mainnet.ProtocolSpec;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.concurrent.atomic.AtomicReference;\n+import java.util.stream.Stream;\n+\n+public class RewardTraceGenerator {\n+\n+  private static final String REWARD_LABEL = \"reward\";\n+  private static final String BLOCK_LABEL = \"block\";\n+  private static final String UNCLE_LABEL = \"uncle\";\n+\n+  /**\n+   * Generates a stream of reward {@link Trace} from the passed {@link Block} data.\n+   *\n+   * @param protocolSchedule the {@link ProtocolSchedule} to use\n+   * @param block the current {@link Block} to use\n+   * @return a stream of generated reward traces {@link Trace}\n+   */\n+  public static Stream<Trace> generateFromBlock(\n+      final ProtocolSchedule<?> protocolSchedule, final Block block) {\n+\n+    final List<Trace> flatTraces = new ArrayList<>();\n+\n+    final BlockHeader blockHeader = block.getHeader();\n+    final ProtocolSpec<?> protocolSpec = protocolSchedule.getByBlockNumber(blockHeader.getNumber());\n+    final MiningBeneficiaryCalculator miningBeneficiaryCalculator =\n+        protocolSpec.getMiningBeneficiaryCalculator();\n+\n+    final AtomicReference<Wei> totalBlockReward =\n+        new AtomicReference<>(protocolSpec.getBlockReward());\n+\n+    // add uncle reward traces\n+    block\n+        .getBody()\n+        .getOmmers()\n+        .forEach(\n+            ommerBlockHeader -> {\n+              final long distance = blockHeader.getNumber() - ommerBlockHeader.getNumber();\n+              final Wei blockReward = protocolSpec.getBlockReward();\n+              final Wei ommerReward =\n+                  blockReward.subtract(blockReward.multiply(distance).divide(8));\n+              final Action.Builder uncleActionBuilder =\n+                  Action.builder()\n+                      .author(\n+                          miningBeneficiaryCalculator\n+                              .calculateBeneficiary(ommerBlockHeader)\n+                              .toHexString())\n+                      .rewardType(UNCLE_LABEL)\n+                      .value(ommerReward.toShortHexString());\n+              flatTraces.add(\n+                  RewardTrace.builder()\n+                      .actionBuilder(uncleActionBuilder)\n+                      .blockHash(block.getHash().toHexString())\n+                      .blockNumber(blockHeader.getNumber())\n+                      .type(REWARD_LABEL)\n+                      .build());\n+\n+              // add uncle inclusion reward\n+              totalBlockReward.set(totalBlockReward.get().add(blockReward.divide(32)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd5ad39584a475f3b86bc80808d03132eb079cc6"}, "originalPosition": 83}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66659877354228a44af3da8b5b9cb6941d7bb87c", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/66659877354228a44af3da8b5b9cb6941d7bb87c", "committedDate": "2020-03-12T13:09:35Z", "message": "fix review issues\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "149e55f82f774203ff23e1052a26564840816344", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/149e55f82f774203ff23e1052a26564840816344", "committedDate": "2020-03-12T13:33:46Z", "message": "fix build\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd98223db85945440a44b195e98e9d5d9b9e9c8f", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/fd98223db85945440a44b195e98e9d5d9b9e9c8f", "committedDate": "2020-03-12T14:05:22Z", "message": "clean code\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3408e1ebedfea13d97f396411f4c147968c4ab7", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/d3408e1ebedfea13d97f396411f4c147968c4ab7", "committedDate": "2020-03-16T09:20:04Z", "message": "Merge commit '46e9d1dc83ac00b9de65f52105b120cbb83ec2b0' into feature/pie-1961-add-trace-block-api\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b85fd5dc7b20e65b48e293689d902bf90be9c73", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/3b85fd5dc7b20e65b48e293689d902bf90be9c73", "committedDate": "2020-03-16T09:39:11Z", "message": "fix the tests to work with the new generation of blocks.bin\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MzkzNjcw", "url": "https://github.com/hyperledger/besu/pull/449#pullrequestreview-375393670", "createdAt": "2020-03-16T16:43:59Z", "commit": {"oid": "3b85fd5dc7b20e65b48e293689d902bf90be9c73"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjo0Mzo1OVrOF28tIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMTowODo0MVrOF3KvMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE2MjAxNw==", "bodyText": "I was hoping this ommer and block reward refactoring was going to happen in another follow on PR, but I'll allow it.", "url": "https://github.com/hyperledger/besu/pull/449#discussion_r393162017", "createdAt": "2020-03-16T16:43:59Z", "author": {"login": "shemnon"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/BlockProcessor.java", "diffHunk": "@@ -80,4 +81,31 @@ Result processBlock(\n       BlockHeader blockHeader,\n       List<Transaction> transactions,\n       List<BlockHeader> ommers);\n+\n+  /**\n+   * Get ommer reward in ${@link Wei}\n+   *\n+   * @param blockReward reward of the block\n+   * @param blockNumber number of the block\n+   * @param ommerBlockNumber number of the block ommer\n+   * @return ommer reward\n+   */\n+  default Wei getOmmerReward(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b85fd5dc7b20e65b48e293689d902bf90be9c73"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM5MTkyMQ==", "bodyText": "I've had a lot of luck changing the order of the fields to match the desired output ordering.", "url": "https://github.com/hyperledger/besu/pull/449#discussion_r393391921", "createdAt": "2020-03-17T01:08:41Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/results/tracing/flat/Action.java", "diffHunk": "@@ -20,8 +20,24 @@\n import org.hyperledger.besu.ethereum.api.jsonrpc.internal.results.Quantity;\n \n import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonPropertyOrder;\n \n @JsonInclude(NON_NULL)\n+@JsonPropertyOrder({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b85fd5dc7b20e65b48e293689d902bf90be9c73"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3fe202bc051a6631380ca9507034c17ee9edfbb", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/c3fe202bc051a6631380ca9507034c17ee9edfbb", "committedDate": "2020-03-17T10:39:31Z", "message": "Merge commit 'ba2f43cbd0dc1f6f6d1a3214ddb696011dcac5bc' into feature/pie-1961-add-trace-block-api\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1823, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}