{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNDQyMzk1", "number": 974, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjoyMTo0M1rOEB0n-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjoyMTo0M1rOEB0n-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMzQ2MjM1OnYy", "diffSide": "RIGHT", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/DefaultSynchronizer.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjoyMTo0M1rOGd5xlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzoyMTo0M1rOGel7DQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwODQ2OA==", "bodyText": "We have a stop method here, we should probably be calling that instead of just exiting. There could be important resources to close or cleanup nicely now or in the future.", "url": "https://github.com/hyperledger/besu/pull/974#discussion_r434008468", "createdAt": "2020-06-02T16:21:43Z", "author": {"login": "RatanRSur"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/DefaultSynchronizer.java", "diffHunk": "@@ -126,7 +126,16 @@ public void start() {\n       LOG.info(\"Starting synchronizer.\");\n       blockPropagationManager.start();\n       if (fastSyncDownloader.isPresent()) {\n-        fastSyncDownloader.get().start().whenComplete(this::handleFastSyncResult);\n+        fastSyncDownloader\n+            .get()\n+            .start()\n+            .whenComplete(this::handleFastSyncResult)\n+            .exceptionally(\n+                ex -> {\n+                  System.exit(0);\n+                  return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ff1912792fadf9323f99f377f4c09e8e63fe999"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEwNTcxMw==", "bodyText": "I think when we call System.exit the shutdown hook will get invoked (which stops everything cleanly), but worth double-checking.", "url": "https://github.com/hyperledger/besu/pull/974#discussion_r434105713", "createdAt": "2020-06-02T18:53:02Z", "author": {"login": "mbaxter"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/DefaultSynchronizer.java", "diffHunk": "@@ -126,7 +126,16 @@ public void start() {\n       LOG.info(\"Starting synchronizer.\");\n       blockPropagationManager.start();\n       if (fastSyncDownloader.isPresent()) {\n-        fastSyncDownloader.get().start().whenComplete(this::handleFastSyncResult);\n+        fastSyncDownloader\n+            .get()\n+            .start()\n+            .whenComplete(this::handleFastSyncResult)\n+            .exceptionally(\n+                ex -> {\n+                  System.exit(0);\n+                  return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwODQ2OA=="}, "originalCommit": {"oid": "4ff1912792fadf9323f99f377f4c09e8e63fe999"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDczMTc4OQ==", "bodyText": "As you may see, the stop method is correctly triggered when the System.exit is called.", "url": "https://github.com/hyperledger/besu/pull/974#discussion_r434731789", "createdAt": "2020-06-03T17:21:43Z", "author": {"login": "br0tchain"}, "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/sync/DefaultSynchronizer.java", "diffHunk": "@@ -126,7 +126,16 @@ public void start() {\n       LOG.info(\"Starting synchronizer.\");\n       blockPropagationManager.start();\n       if (fastSyncDownloader.isPresent()) {\n-        fastSyncDownloader.get().start().whenComplete(this::handleFastSyncResult);\n+        fastSyncDownloader\n+            .get()\n+            .start()\n+            .whenComplete(this::handleFastSyncResult)\n+            .exceptionally(\n+                ex -> {\n+                  System.exit(0);\n+                  return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAwODQ2OA=="}, "originalCommit": {"oid": "4ff1912792fadf9323f99f377f4c09e8e63fe999"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 882, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}