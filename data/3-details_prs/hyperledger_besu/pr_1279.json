{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNzQyNDI0", "number": 1279, "title": "PrivGetLogs needs to check privacy group membership at given block", "bodyText": "Signed-off-by: Sally MacFarlane sally.macfarlane@consensys.net\nWhen getting private logs, pass block number through so group membership can be checked at that point in time.\nSee #882", "createdAt": "2020-08-06T02:33:55Z", "url": "https://github.com/hyperledger/besu/pull/1279", "merged": true, "mergeCommit": {"oid": "def058293097d941f0fb85c59418ec5edc30f738"}, "closed": true, "closedAt": "2020-08-11T03:15:00Z", "author": {"login": "macfarla"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8GcRdgH2gAyNDYzNzQyNDI0OjJiNzRjMzk3ZDk5YjdmODY3NjI4MzdkMjRhNWZmNzg4M2NlYTkyZTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9uCUtAFqTQ2NDcyMDExMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2b74c397d99b7f86762837d24a5ff7883cea92e6", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/2b74c397d99b7f86762837d24a5ff7883cea92e6", "committedDate": "2020-08-06T02:31:51Z", "message": "PrivGetLogs needs to check privacy group membership at given block\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODgzNjM3", "url": "https://github.com/hyperledger/besu/pull/1279#pullrequestreview-462883637", "createdAt": "2020-08-06T21:18:07Z", "commit": {"oid": "2b74c397d99b7f86762837d24a5ff7883cea92e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToxODowN1rOG9EmBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToxODowN1rOG9EmBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY5MTU5MQ==", "bodyText": "We could name this method something like checkIfAuthenticatedUserWasMemberAtBlock. This way we reduce the cognitive gap. Not a big deal though.\nOr if you like checkIfPrivacyGroupMatchesAuthenticatedEnclaveKey  keep it!", "url": "https://github.com/hyperledger/besu/pull/1279#discussion_r466691591", "createdAt": "2020-08-06T21:18:07Z", "author": {"login": "lucassaldanha"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/privacy/methods/priv/PrivGetLogs.java", "diffHunk": "@@ -85,9 +100,17 @@ public JsonRpcResponse response(final JsonRpcRequestContext requestContext) {\n         requestContext.getRequest().getId(), new LogsResult(matchingLogs));\n   }\n \n+  private List<LogWithMetadata> getEmptyList() {\n+    return Collections.emptyList();\n+  }\n+\n   private void checkIfPrivacyGroupMatchesAuthenticatedEnclaveKey(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b74c397d99b7f86762837d24a5ff7883cea92e6"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODg0NDA0", "url": "https://github.com/hyperledger/besu/pull/1279#pullrequestreview-462884404", "createdAt": "2020-08-06T21:19:23Z", "commit": {"oid": "2b74c397d99b7f86762837d24a5ff7883cea92e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToxOToyM1rOG9EoJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToxOToyM1rOG9EoJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY5MjEzMg==", "bodyText": "We could encapsulate the map and orElseGet blocks into their own functions to make this main function a bit cleaner. Something like findLogsForBlockHash and findLogsForBlockRange", "url": "https://github.com/hyperledger/besu/pull/1279#discussion_r466692132", "createdAt": "2020-08-06T21:19:23Z", "author": {"login": "lucassaldanha"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/privacy/methods/priv/PrivGetLogs.java", "diffHunk": "@@ -70,13 +71,27 @@ public JsonRpcResponse response(final JsonRpcRequestContext requestContext) {\n         filter\n             .getBlockHash()\n             .map(\n-                blockHash ->\n-                    privacyQueries.matchingLogs(privacyGroupId, blockHash, filter.getLogsQuery()))\n+                blockHash -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b74c397d99b7f86762837d24a5ff7883cea92e6"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODg0OTk4", "url": "https://github.com/hyperledger/besu/pull/1279#pullrequestreview-462884998", "createdAt": "2020-08-06T21:20:27Z", "commit": {"oid": "2b74c397d99b7f86762837d24a5ff7883cea92e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToyMDoyOFrOG9EqIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMToyMDoyOFrOG9EqIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY5MjY0MA==", "bodyText": "Do we need this extra method? Why not return Collections.emptyList() straight away on line 78?", "url": "https://github.com/hyperledger/besu/pull/1279#discussion_r466692640", "createdAt": "2020-08-06T21:20:28Z", "author": {"login": "lucassaldanha"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/privacy/methods/priv/PrivGetLogs.java", "diffHunk": "@@ -85,9 +100,17 @@ public JsonRpcResponse response(final JsonRpcRequestContext requestContext) {\n         requestContext.getRequest().getId(), new LogsResult(matchingLogs));\n   }\n \n+  private List<LogWithMetadata> getEmptyList() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b74c397d99b7f86762837d24a5ff7883cea92e6"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1395e0df58ae5e4bfeffc16c48706fb141e4564", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/b1395e0df58ae5e4bfeffc16c48706fb141e4564", "committedDate": "2020-08-07T00:22:59Z", "message": "review comments\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef496174992ee19021ece512cfbb9f4f5390df4d", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/ef496174992ee19021ece512cfbb9f4f5390df4d", "committedDate": "2020-08-07T01:20:22Z", "message": "final params\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9646f710181fb8cdfb600bb1255cc277b79812bb", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/9646f710181fb8cdfb600bb1255cc277b79812bb", "committedDate": "2020-08-07T01:20:38Z", "message": "Merge branch 'master' of https://github.com/hyperledger/besu into multi-tenancy-onchain-groups-logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa05ea3e006c77ee8ecab5b90b0d6a016958273f", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/fa05ea3e006c77ee8ecab5b90b0d6a016958273f", "committedDate": "2020-08-07T01:27:24Z", "message": "simplified getting the empty list\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24569b150c28b630a9b372a6193023f702fb6bb1", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/24569b150c28b630a9b372a6193023f702fb6bb1", "committedDate": "2020-08-09T22:38:16Z", "message": "Merge branch 'master' of https://github.com/hyperledger/besu into multi-tenancy-onchain-groups-logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a7ff67dc1e0ef80d5ff75f062c61a2e712a4964", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/8a7ff67dc1e0ef80d5ff75f062c61a2e712a4964", "committedDate": "2020-08-11T00:37:45Z", "message": "Merge branch 'master' of https://github.com/hyperledger/besu into multi-tenancy-onchain-groups-logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0536bfabda222c4bb6fef83afcc7db4bbbc037e", "author": {"user": {"login": "macfarla", "name": "Sally MacFarlane"}}, "url": "https://github.com/hyperledger/besu/commit/b0536bfabda222c4bb6fef83afcc7db4bbbc037e", "committedDate": "2020-08-11T01:11:12Z", "message": "rename method\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzIwMTEw", "url": "https://github.com/hyperledger/besu/pull/1279#pullrequestreview-464720110", "createdAt": "2020-08-11T03:13:38Z", "commit": {"oid": "b0536bfabda222c4bb6fef83afcc7db4bbbc037e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1461, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}