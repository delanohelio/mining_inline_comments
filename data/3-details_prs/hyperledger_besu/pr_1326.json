{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNTYwMzkx", "number": 1326, "title": "Implemented priv_debugGetStateRoot JSON RPC API.", "bodyText": "Signed-off-by: Mark Terry mark.terry@consensys.net\n\n\nPR description\nImplements a \"priv_debugGetStateRoot\" JSON RPC API that allows querying the state root.\nFixed Issue(s)\nFixes #764\nChangelog\n\n I thought about the changelog and included a changelog update if required.", "createdAt": "2020-08-24T14:30:55Z", "url": "https://github.com/hyperledger/besu/pull/1326", "merged": true, "mergeCommit": {"oid": "2691deb12652f2f2c917ed35cc94c550384ac536"}, "closed": true, "closedAt": "2020-08-27T02:12:59Z", "author": {"login": "mark-terry"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCDfpdAH2gAyNDcyNTYwMzkxOmFiNmU0ZGQzMTE3ZTBhMjU1NzBiYTQ4ZTEzNzE1ZTJmOWE1ZGU1NDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC0kszAH2gAyNDcyNTYwMzkxOjUxY2RhZGM4ZTk2NjVkMmU2MTc5MWZmN2FhZTk1ZjAyNGYyZWE1NTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ab6e4dd3117e0a25570ba48e13715e2f9a5de541", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/ab6e4dd3117e0a25570ba48e13715e2f9a5de541", "committedDate": "2020-08-24T14:29:22Z", "message": "Implemented priv_debugGetStateRoot JSON RPC API.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczODkwNDE4", "url": "https://github.com/hyperledger/besu/pull/1326#pullrequestreview-473890418", "createdAt": "2020-08-24T22:07:49Z", "commit": {"oid": "ab6e4dd3117e0a25570ba48e13715e2f9a5de541"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMjowNzo1MFrOHF39MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQyMjo0Nzo1OVrOHF41mQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMTcxMg==", "bodyText": "I am happy to see this refactor", "url": "https://github.com/hyperledger/besu/pull/1326#discussion_r475921712", "createdAt": "2020-08-24T22:07:50Z", "author": {"login": "macfarla"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/methods/PrivJsonRpcMethods.java", "diffHunk": "@@ -65,57 +66,44 @@ protected RpcApi getApiGroup() {\n   protected Map<String, JsonRpcMethod> create(\n       final PrivacyController privacyController,\n       final EnclavePublicKeyProvider enclavePublicKeyProvider) {\n-    if (getPrivacyParameters().isOnchainPrivacyGroupsEnabled()) {\n-      return mapOf(\n-          new PrivGetTransactionReceipt(\n-              getPrivacyParameters().getPrivateStateStorage(),\n-              privacyController,\n-              enclavePublicKeyProvider),\n-          new PrivGetPrivacyPrecompileAddress(getPrivacyParameters()),\n-          new PrivGetTransactionCount(privacyController, enclavePublicKeyProvider),\n-          new PrivGetPrivateTransaction(privacyController, enclavePublicKeyProvider),\n-          new PrivDistributeRawTransaction(\n-              privacyController,\n-              enclavePublicKeyProvider,\n-              getPrivacyParameters().isOnchainPrivacyGroupsEnabled()),\n-          new PrivCall(getBlockchainQueries(), privacyController, enclavePublicKeyProvider),\n-          new PrivGetCode(getBlockchainQueries(), privacyController, enclavePublicKeyProvider),\n-          new PrivGetLogs(\n-              getBlockchainQueries(),\n-              getPrivacyQueries(),\n-              privacyController,\n-              enclavePublicKeyProvider),\n-          new PrivNewFilter(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivUninstallFilter(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivGetFilterLogs(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivGetFilterChanges(filterManager, privacyController, enclavePublicKeyProvider));\n-    } else {\n-      return mapOf(\n-          new PrivGetTransactionReceipt(\n-              getPrivacyParameters().getPrivateStateStorage(),\n-              privacyController,\n-              enclavePublicKeyProvider),\n-          new PrivCreatePrivacyGroup(privacyController, enclavePublicKeyProvider),\n-          new PrivDeletePrivacyGroup(privacyController, enclavePublicKeyProvider),\n-          new PrivFindPrivacyGroup(privacyController, enclavePublicKeyProvider),\n-          new PrivGetPrivacyPrecompileAddress(getPrivacyParameters()),\n-          new PrivGetTransactionCount(privacyController, enclavePublicKeyProvider),\n-          new PrivGetPrivateTransaction(privacyController, enclavePublicKeyProvider),\n-          new PrivDistributeRawTransaction(\n-              privacyController,\n-              enclavePublicKeyProvider,\n-              getPrivacyParameters().isOnchainPrivacyGroupsEnabled()),\n-          new PrivCall(getBlockchainQueries(), privacyController, enclavePublicKeyProvider),\n-          new PrivGetCode(getBlockchainQueries(), privacyController, enclavePublicKeyProvider),\n-          new PrivGetLogs(\n-              getBlockchainQueries(),\n-              getPrivacyQueries(),\n-              privacyController,\n-              enclavePublicKeyProvider),\n-          new PrivNewFilter(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivUninstallFilter(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivGetFilterLogs(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivGetFilterChanges(filterManager, privacyController, enclavePublicKeyProvider));\n+\n+    final Map<String, JsonRpcMethod> RPC_METHODS =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab6e4dd3117e0a25570ba48e13715e2f9a5de541"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkzNjE1Mw==", "bodyText": "adding a unit test would take it to next level", "url": "https://github.com/hyperledger/besu/pull/1326#discussion_r475936153", "createdAt": "2020-08-24T22:47:59Z", "author": {"login": "macfarla"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/methods/PrivJsonRpcMethods.java", "diffHunk": "@@ -65,57 +66,44 @@ protected RpcApi getApiGroup() {\n   protected Map<String, JsonRpcMethod> create(\n       final PrivacyController privacyController,\n       final EnclavePublicKeyProvider enclavePublicKeyProvider) {\n-    if (getPrivacyParameters().isOnchainPrivacyGroupsEnabled()) {\n-      return mapOf(\n-          new PrivGetTransactionReceipt(\n-              getPrivacyParameters().getPrivateStateStorage(),\n-              privacyController,\n-              enclavePublicKeyProvider),\n-          new PrivGetPrivacyPrecompileAddress(getPrivacyParameters()),\n-          new PrivGetTransactionCount(privacyController, enclavePublicKeyProvider),\n-          new PrivGetPrivateTransaction(privacyController, enclavePublicKeyProvider),\n-          new PrivDistributeRawTransaction(\n-              privacyController,\n-              enclavePublicKeyProvider,\n-              getPrivacyParameters().isOnchainPrivacyGroupsEnabled()),\n-          new PrivCall(getBlockchainQueries(), privacyController, enclavePublicKeyProvider),\n-          new PrivGetCode(getBlockchainQueries(), privacyController, enclavePublicKeyProvider),\n-          new PrivGetLogs(\n-              getBlockchainQueries(),\n-              getPrivacyQueries(),\n-              privacyController,\n-              enclavePublicKeyProvider),\n-          new PrivNewFilter(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivUninstallFilter(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivGetFilterLogs(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivGetFilterChanges(filterManager, privacyController, enclavePublicKeyProvider));\n-    } else {\n-      return mapOf(\n-          new PrivGetTransactionReceipt(\n-              getPrivacyParameters().getPrivateStateStorage(),\n-              privacyController,\n-              enclavePublicKeyProvider),\n-          new PrivCreatePrivacyGroup(privacyController, enclavePublicKeyProvider),\n-          new PrivDeletePrivacyGroup(privacyController, enclavePublicKeyProvider),\n-          new PrivFindPrivacyGroup(privacyController, enclavePublicKeyProvider),\n-          new PrivGetPrivacyPrecompileAddress(getPrivacyParameters()),\n-          new PrivGetTransactionCount(privacyController, enclavePublicKeyProvider),\n-          new PrivGetPrivateTransaction(privacyController, enclavePublicKeyProvider),\n-          new PrivDistributeRawTransaction(\n-              privacyController,\n-              enclavePublicKeyProvider,\n-              getPrivacyParameters().isOnchainPrivacyGroupsEnabled()),\n-          new PrivCall(getBlockchainQueries(), privacyController, enclavePublicKeyProvider),\n-          new PrivGetCode(getBlockchainQueries(), privacyController, enclavePublicKeyProvider),\n-          new PrivGetLogs(\n-              getBlockchainQueries(),\n-              getPrivacyQueries(),\n-              privacyController,\n-              enclavePublicKeyProvider),\n-          new PrivNewFilter(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivUninstallFilter(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivGetFilterLogs(filterManager, privacyController, enclavePublicKeyProvider),\n-          new PrivGetFilterChanges(filterManager, privacyController, enclavePublicKeyProvider));\n+\n+    final Map<String, JsonRpcMethod> RPC_METHODS =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkyMTcxMg=="}, "originalCommit": {"oid": "ab6e4dd3117e0a25570ba48e13715e2f9a5de541"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MDYwMDYw", "url": "https://github.com/hyperledger/besu/pull/1326#pullrequestreview-475060060", "createdAt": "2020-08-25T23:51:09Z", "commit": {"oid": "ab6e4dd3117e0a25570ba48e13715e2f9a5de541"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMzo1MTowOVrOHGydhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMzo1MTowOVrOHGydhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njg4MDI2MQ==", "bodyText": "Do we need to expose this method in this interface? Isn't it used internally?\nI recon we could just find the blockhash from the number inside getStateRootByBlockNumber() method.", "url": "https://github.com/hyperledger/besu/pull/1326#discussion_r476880261", "createdAt": "2020-08-25T23:51:09Z", "author": {"login": "lucassaldanha"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/privacy/PrivacyController.java", "diffHunk": "@@ -100,5 +100,8 @@ void verifyPrivacyGroupContainsEnclavePublicKey(\n \n   PrivateTransactionSimulator getTransactionSimulator();\n \n-  Optional<Hash> getBlockHashByBlockNumber(Optional<Long> blockNumber);\n+  Optional<Hash> getBlockHashByBlockNumber(final Long blockNumber);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab6e4dd3117e0a25570ba48e13715e2f9a5de541"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55f9d8c2dd54bf2334959445c96364013bafe01a", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/55f9d8c2dd54bf2334959445c96364013bafe01a", "committedDate": "2020-08-26T03:13:03Z", "message": "PR fixes and improvements.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MTM4MzY3", "url": "https://github.com/hyperledger/besu/pull/1326#pullrequestreview-475138367", "createdAt": "2020-08-26T04:15:29Z", "commit": {"oid": "55f9d8c2dd54bf2334959445c96364013bafe01a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b388588dcbbf7ac77a0267ea697c576b619010bb", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/b388588dcbbf7ac77a0267ea697c576b619010bb", "committedDate": "2020-08-26T10:01:58Z", "message": "Merge branch 'master' into 764"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76de216d0977553743f70e2409138ac40dbd68e2", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/76de216d0977553743f70e2409138ac40dbd68e2", "committedDate": "2020-08-26T10:17:34Z", "message": "Changelog.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MTE1MTk0", "url": "https://github.com/hyperledger/besu/pull/1326#pullrequestreview-476115194", "createdAt": "2020-08-26T23:34:26Z", "commit": {"oid": "76de216d0977553743f70e2409138ac40dbd68e2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMzozNDoyNlrOHHjULQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMzozNDoyNlrOHHjULQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzY4MDY4NQ==", "bodyText": "s/JSON RPC/JSON-RPC", "url": "https://github.com/hyperledger/besu/pull/1326#discussion_r477680685", "createdAt": "2020-08-26T23:34:26Z", "author": {"login": "macfarla"}, "path": "CHANGELOG.md", "diffHunk": "@@ -1,12 +1,16 @@\n # Changelog\n \n+### Additions and Improvements\n+\n+* Added `priv_debugGetStateRoot` JSON RPC API to retrieve the state root of a specified privacy group. [\\#1326](https://github.com/hyperledger/besu/pull/1326)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76de216d0977553743f70e2409138ac40dbd68e2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MTE1Mzg5", "url": "https://github.com/hyperledger/besu/pull/1326#pullrequestreview-476115389", "createdAt": "2020-08-26T23:34:33Z", "commit": {"oid": "76de216d0977553743f70e2409138ac40dbd68e2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMzozNDozM1rOHHjU4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMzozNDozM1rOHHjU4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzY4MDg2Ng==", "bodyText": "good spot", "url": "https://github.com/hyperledger/besu/pull/1326#discussion_r477680866", "createdAt": "2020-08-26T23:34:33Z", "author": {"login": "macfarla"}, "path": "CHANGELOG.md", "diffHunk": "@@ -1,12 +1,16 @@\n # Changelog\n \n+### Additions and Improvements\n+\n+* Added `priv_debugGetStateRoot` JSON RPC API to retrieve the state root of a specified privacy group. [\\#1326](https://github.com/hyperledger/besu/pull/1326)\n+\n ## 1.5.3 \n \n ### Additions and Improvements\n \n * The EvmTool now processes State Tests from the Ethereum Reference Tests. [\\#1311](https://github.com/hyperledger/besu/pull/1311)\n * Experimental dns support added via the `Xdns-enabled` and `Xdns-update-enabled` CLI commands. [\\#1247](https://github.com/hyperledger/besu/pull/1247)\n-* Add genesis config option `ecip1017EraRounds` for Ethereum Classic chanis. [\\#1329](https://github.com/hyperledger/besu/pull/1329)\n+* Add genesis config option `ecip1017EraRounds` for Ethereum Classic chains. [\\#1329](https://github.com/hyperledger/besu/pull/1329)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76de216d0977553743f70e2409138ac40dbd68e2"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc526e862660d92aa26d4794361ea7f16ea92596", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/bc526e862660d92aa26d4794361ea7f16ea92596", "committedDate": "2020-08-26T23:38:38Z", "message": "Changelog fix.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51cdadc8e9665d2e61791ff7aae95f024f2ea554", "author": {"user": {"login": "mark-terry", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/51cdadc8e9665d2e61791ff7aae95f024f2ea554", "committedDate": "2020-08-26T23:40:14Z", "message": "Merge branch 'master' into 764"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1471, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}