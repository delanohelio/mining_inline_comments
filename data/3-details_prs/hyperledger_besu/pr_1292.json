{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1ODMxNDk2", "number": 1292, "title": "[Issue 1278] Rework static peer discovery handling", "bodyText": "PR description\nRework discovery-level handling of static peers to fix a few issues:\n\nMake sure that permissions are respected when pushing static peers into the discovery layer\nInitiate ping-pong bonding cycle rather than directly adding peers to our peer table to ensure that peer is live and running discovery\nCheck that enode url indicates discovery protocol is running before attempting to bond with peer\nRemove duplicate dropPeer logic\n\nFixed Issue(s)\nFixes #1278", "createdAt": "2020-08-11T02:53:19Z", "url": "https://github.com/hyperledger/besu/pull/1292", "merged": true, "mergeCommit": {"oid": "88ce796a2533c1955e82f8f0645b13ee3577c3e5"}, "closed": true, "closedAt": "2020-08-11T18:02:20Z", "author": {"login": "mbaxter"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9tn3WAH2gAyNDY1ODMxNDk2OmFhZGI3ZGViMmM0MTFhZDc3Nzk0M2EzMmFiNTAyNzA2Mzg5YjMzMGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc96PLUAH2gAyNDY1ODMxNDk2OjQ5YjI1Njg3NzViYzIyZTZhMDA5MjNkMzMzOGFjYjJkN2E0YTA4Yzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aadb7deb2c411ad777943a32ab502706389b330f", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/aadb7deb2c411ad777943a32ab502706389b330f", "committedDate": "2020-08-11T02:44:44Z", "message": "Add factory method to construct DiscoveryPeer from generic peer\n\nSigned-off-by: Meredith Baxter <meredith.baxter@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b257df5c1dd37dc9d4fe53e3c0bd7551b93f3c9f", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/b257df5c1dd37dc9d4fe53e3c0bd7551b93f3c9f", "committedDate": "2020-08-11T02:44:44Z", "message": "Add peer to discovery table more safely\n\nSigned-off-by: Meredith Baxter <meredith.baxter@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5747f92163ad4a5585354c34841ce2e218b7ad12", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/5747f92163ad4a5585354c34841ce2e218b7ad12", "committedDate": "2020-08-11T02:44:45Z", "message": "Move static peer handling out of discovery controller\n\nSigned-off-by: Meredith Baxter <meredith.baxter@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "054a162ac94231cd4321b88f127bbfd1e917e38f", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/054a162ac94231cd4321b88f127bbfd1e917e38f", "committedDate": "2020-08-11T02:44:45Z", "message": "Make PeerDiscoveryAgent.bond more generic, add tests\n\nSigned-off-by: Meredith Baxter <meredith.baxter@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35436d777a1eec5bb3d8522a350c5c5a3f06a376", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/35436d777a1eec5bb3d8522a350c5c5a3f06a376", "committedDate": "2020-08-11T02:44:45Z", "message": "Move static peer bonding logic to P2PNetwork\n\nSigned-off-by: Meredith Baxter <meredith.baxter@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NzI0MjY2", "url": "https://github.com/hyperledger/besu/pull/1292#pullrequestreview-464724266", "createdAt": "2020-08-11T03:29:35Z", "commit": {"oid": "35436d777a1eec5bb3d8522a350c5c5a3f06a376"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMzoyOTozNVrOG-nGTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMzoyOTozNVrOG-nGTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMwNTQ4NA==", "bodyText": "Does this mean that we require discovery to be enabled on peers that we want to add using static-nodes.json file or AddPeer API? Because I feel like most uses that are statically mapping their peers might not have discovery enabled (and might not want to).", "url": "https://github.com/hyperledger/besu/pull/1292#discussion_r468305484", "createdAt": "2020-08-11T03:29:35Z", "author": {"login": "lucassaldanha"}, "path": "ethereum/p2p/src/main/java/org/hyperledger/besu/ethereum/p2p/network/DefaultP2PNetwork.java", "diffHunk": "@@ -265,6 +265,7 @@ public void awaitStop() {\n   @Override\n   public boolean addMaintainConnectionPeer(final Peer peer) {\n     final boolean wasAdded = maintainedPeers.add(peer);\n+    peerDiscoveryAgent.bond(peer);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35436d777a1eec5bb3d8522a350c5c5a3f06a376"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MjU0Mzk4", "url": "https://github.com/hyperledger/besu/pull/1292#pullrequestreview-465254398", "createdAt": "2020-08-11T16:54:48Z", "commit": {"oid": "35436d777a1eec5bb3d8522a350c5c5a3f06a376"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b0ad2ddede7126d15675afbfbc4e6788b98ab97", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/1b0ad2ddede7126d15675afbfbc4e6788b98ab97", "committedDate": "2020-08-11T17:07:07Z", "message": "Merge branch 'master' into issue-1278/rework-static-peer-discovery-handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49b2568775bc22e6a00923d3338acb2d7a4a08c8", "author": {"user": {"login": "mbaxter", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/49b2568775bc22e6a00923d3338acb2d7a4a08c8", "committedDate": "2020-08-11T17:26:32Z", "message": "Merge branch 'master' into issue-1278/rework-static-peer-discovery-handling"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1465, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}