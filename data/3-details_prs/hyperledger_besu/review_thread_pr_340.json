{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NDExMDk2", "number": 340, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNDo1ODoyMVrODbzIJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNDo1ODozNlrODbzITQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNDc1ODE0OnYy", "diffSide": "RIGHT", "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNDo1ODoyMVrOFjfdAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNToxNTo0M1rOFjfpFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc1OTgxMA==", "bodyText": "Any reason we need to copy the input params?  It seems odd.  I feel there should be a comment explaining why (it may be a library thing, and it would be worth pointing out) or consider just mutating the options in place.", "url": "https://github.com/hyperledger/besu/pull/340#discussion_r372759810", "createdAt": "2020-01-30T04:58:21Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpService.java", "diffHunk": "@@ -279,34 +281,47 @@ private HttpServerOptions getHttpServerOptions() {\n     return applyTlsConfig(httpServerOptions);\n   }\n \n-  private HttpServerOptions applyTlsConfig(final HttpServerOptions httpServerOptions) {\n-    config\n-        .getTlsConfiguration()\n+  private HttpServerOptions applyTlsConfig(final HttpServerOptions input) {\n+    if (config.getTlsConfiguration().isEmpty()) {\n+      return input;\n+    }\n+\n+    final TlsConfiguration tlsConfiguration = config.getTlsConfiguration().get();\n+    final HttpServerOptions httpServerOptions = new HttpServerOptions(input);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6322e9f9165d7490160a2665d0d3cbc11cba829b"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc2MjQwNw==", "bodyText": "I personally am happy with mutating the original HttpServerOptions, some devs prefer that input params must not be mutated and a clone should be created.", "url": "https://github.com/hyperledger/besu/pull/340#discussion_r372762407", "createdAt": "2020-01-30T05:12:52Z", "author": {"login": "usmansaleem"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpService.java", "diffHunk": "@@ -279,34 +281,47 @@ private HttpServerOptions getHttpServerOptions() {\n     return applyTlsConfig(httpServerOptions);\n   }\n \n-  private HttpServerOptions applyTlsConfig(final HttpServerOptions httpServerOptions) {\n-    config\n-        .getTlsConfiguration()\n+  private HttpServerOptions applyTlsConfig(final HttpServerOptions input) {\n+    if (config.getTlsConfiguration().isEmpty()) {\n+      return input;\n+    }\n+\n+    final TlsConfiguration tlsConfiguration = config.getTlsConfiguration().get();\n+    final HttpServerOptions httpServerOptions = new HttpServerOptions(input);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc1OTgxMA=="}, "originalCommit": {"oid": "6322e9f9165d7490160a2665d0d3cbc11cba829b"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc2MjkwMg==", "bodyText": "Pushing in changes shortly that mutates original HttpServerOption instead.", "url": "https://github.com/hyperledger/besu/pull/340#discussion_r372762902", "createdAt": "2020-01-30T05:15:43Z", "author": {"login": "usmansaleem"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpService.java", "diffHunk": "@@ -279,34 +281,47 @@ private HttpServerOptions getHttpServerOptions() {\n     return applyTlsConfig(httpServerOptions);\n   }\n \n-  private HttpServerOptions applyTlsConfig(final HttpServerOptions httpServerOptions) {\n-    config\n-        .getTlsConfiguration()\n+  private HttpServerOptions applyTlsConfig(final HttpServerOptions input) {\n+    if (config.getTlsConfiguration().isEmpty()) {\n+      return input;\n+    }\n+\n+    final TlsConfiguration tlsConfiguration = config.getTlsConfiguration().get();\n+    final HttpServerOptions httpServerOptions = new HttpServerOptions(input);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc1OTgxMA=="}, "originalCommit": {"oid": "6322e9f9165d7490160a2665d0d3cbc11cba829b"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNDc1ODUzOnYy", "diffSide": "RIGHT", "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNDo1ODozNlrOFjfdNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNDo1ODozNlrOFjfdNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc1OTg2Mw==", "bodyText": "Same copy question above.", "url": "https://github.com/hyperledger/besu/pull/340#discussion_r372759863", "createdAt": "2020-01-30T04:58:36Z", "author": {"login": "shemnon"}, "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpService.java", "diffHunk": "@@ -279,34 +281,47 @@ private HttpServerOptions getHttpServerOptions() {\n     return applyTlsConfig(httpServerOptions);\n   }\n \n-  private HttpServerOptions applyTlsConfig(final HttpServerOptions httpServerOptions) {\n-    config\n-        .getTlsConfiguration()\n+  private HttpServerOptions applyTlsConfig(final HttpServerOptions input) {\n+    if (config.getTlsConfiguration().isEmpty()) {\n+      return input;\n+    }\n+\n+    final TlsConfiguration tlsConfiguration = config.getTlsConfiguration().get();\n+    final HttpServerOptions httpServerOptions = new HttpServerOptions(input);\n+    try {\n+      httpServerOptions\n+          .setSsl(true)\n+          .setPfxKeyCertOptions(\n+              new PfxOptions()\n+                  .setPath(tlsConfiguration.getKeyStorePath().toString())\n+                  .setPassword(tlsConfiguration.getKeyStorePassword()));\n+\n+      if (tlsConfiguration.getClientAuthConfiguration().isEmpty()) {\n+        return httpServerOptions;\n+      }\n+\n+      return applyTlsClientAuth(\n+          tlsConfiguration.getClientAuthConfiguration().get(), httpServerOptions);\n+    } catch (final RuntimeException re) {\n+      throw new JsonRpcServiceException(\n+          String.format(\n+              \"TLS options failed to initialize for Ethereum JSON RPC listener: %s\",\n+              re.getMessage()));\n+    }\n+  }\n+\n+  private HttpServerOptions applyTlsClientAuth(\n+      final TlsClientAuthConfiguration clientAuthConfiguration, final HttpServerOptions input) {\n+    final HttpServerOptions httpServerOptions = new HttpServerOptions(input);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6322e9f9165d7490160a2665d0d3cbc11cba829b"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1215, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}