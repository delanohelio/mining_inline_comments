{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzNjE4MTQz", "number": 1239, "title": "Add ethstats support", "bodyText": "PR description\nAdded support for ethstat in Besu. To send stats you have to start Besu with\n\n--Xethstats=node-name:secret@host:port --Xethstats-contact=karim.taam@consensys.net\n\nSupport with or without SSL\nTested\n\nWith local ethstats server\nWith Goerli ethstats server = https://stats.goerli.net/\n\nFixed Issue(s)", "createdAt": "2020-07-20T16:30:07Z", "url": "https://github.com/hyperledger/besu/pull/1239", "merged": true, "mergeCommit": {"oid": "c8e23c970ebef4297d6e75abec784f7024df340c"}, "closed": true, "closedAt": "2020-08-04T07:54:20Z", "author": {"login": "matkt"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc20CLTAH2gAyNDUzNjE4MTQzOmU5ZTRlNjNhMTUwNDIzZDAyNzkzMzA0NjVkOWUyODk0YWM5Yzk3YzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7hj3DgH2gAyNDUzNjE4MTQzOmRjZjViMTA4ZDhlYjhlYmIwNTZlOTIxNDgyNjE0NzhkNzFkYzdhNTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e9e4e63a150423d0279330465d9e2894ac9c97c6", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/e9e4e63a150423d0279330465d9e2894ac9c97c6", "committedDate": "2020-07-20T16:15:26Z", "message": "add ethstats integration\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c569630785321c350e426b17e5eae14bc10fb29f", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/c569630785321c350e426b17e5eae14bc10fb29f", "committedDate": "2020-07-20T16:16:44Z", "message": "add missing files\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f534e39d789db68814ba7c528dcaa13f0b33b9b", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/3f534e39d789db68814ba7c528dcaa13f0b33b9b", "committedDate": "2020-07-20T16:25:08Z", "message": "Merge branch 'master' into add-ethstats-socket\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27a8ac49934020ec5666fe76dbc0d9ef5f90e90d", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/27a8ac49934020ec5666fe76dbc0d9ef5f90e90d", "committedDate": "2020-07-20T16:25:29Z", "message": "change log level\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c83286cf99d2244f3cf4a8b6600067d7225819c", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/6c83286cf99d2244f3cf4a8b6600067d7225819c", "committedDate": "2020-07-20T16:29:06Z", "message": "clean code\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ad42ac3b08e9d533031755e9fc522e0cc1d0312", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/0ad42ac3b08e9d533031755e9fc522e0cc1d0312", "committedDate": "2020-07-20T16:40:47Z", "message": "reset invalid referencetest modification\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5b3bba781f2ed0c6f51d39b5dd2fc14229dc96b", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/e5b3bba781f2ed0c6f51d39b5dd2fc14229dc96b", "committedDate": "2020-07-20T16:49:01Z", "message": "fix tests\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ddaa2f11841d0bdf7892aebf88347d90e5c4e25", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/4ddaa2f11841d0bdf7892aebf88347d90e5c4e25", "committedDate": "2020-07-20T17:09:02Z", "message": "fix tests\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d288ed636311c266900835c20b0973228bee727c", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/d288ed636311c266900835c20b0973228bee727c", "committedDate": "2020-07-20T17:19:16Z", "message": "fix tests\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28724e5462f70f81dd4a4d2b6bec244e810aa914", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/28724e5462f70f81dd4a4d2b6bec244e810aa914", "committedDate": "2020-07-20T17:19:52Z", "message": "fix tests\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxOTYxNTA5", "url": "https://github.com/hyperledger/besu/pull/1239#pullrequestreview-451961509", "createdAt": "2020-07-20T21:09:48Z", "commit": {"oid": "28724e5462f70f81dd4a4d2b6bec244e810aa914"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTowOTo0OFrOG0fYlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTowOTo0OFrOG0fYlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5MzMzNA==", "bodyText": "Should this and the other object be created using the Immutables framework?  There are some special annotations for immutables: https://immutables.github.io/json.html#jackson", "url": "https://github.com/hyperledger/besu/pull/1239#discussion_r457693334", "createdAt": "2020-07-20T21:09:48Z", "author": {"login": "shemnon"}, "path": "ethereum/ethstats/src/main/java/org/hyperledger/besu/ethstats/authentication/AuthenticationData.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.ethstats.authentication;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+public class AuthenticationData {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28724e5462f70f81dd4a4d2b6bec244e810aa914"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63b9289280ab15a28a163357939a47e908d0716c", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/63b9289280ab15a28a163357939a47e908d0716c", "committedDate": "2020-07-21T13:37:10Z", "message": "add immutables library  for ethstats\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzOTIyODgx", "url": "https://github.com/hyperledger/besu/pull/1239#pullrequestreview-453922881", "createdAt": "2020-07-23T08:21:01Z", "commit": {"oid": "63b9289280ab15a28a163357939a47e908d0716c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwODoyMTowMVrOG2Aqfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwODoyMTowMVrOG2Aqfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTI4NzE2Nw==", "bodyText": "I think you missed the stop", "url": "https://github.com/hyperledger/besu/pull/1239#discussion_r459287167", "createdAt": "2020-07-23T08:21:01Z", "author": {"login": "abdelhamidbakhta"}, "path": "besu/src/main/java/org/hyperledger/besu/Runner.java", "diffHunk": "@@ -122,6 +126,9 @@ public void start() {\n       writeBesuNetworksToFile();\n       autoTransactionLogBloomCachingService.ifPresent(AutoTransactionLogBloomCachingService::start);\n       writePidFile();\n+\n+      ethStatsService.ifPresent(EthStatsService::start);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63b9289280ab15a28a163357939a47e908d0716c"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94aa749557ad40862b64baef4571cfb1d1737caa", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/94aa749557ad40862b64baef4571cfb1d1737caa", "committedDate": "2020-07-23T09:29:42Z", "message": "fix review issues\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35caaee1c818726e81d7f0bf6b2ca0713c8d7793", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/35caaee1c818726e81d7f0bf6b2ca0713c8d7793", "committedDate": "2020-07-23T09:29:58Z", "message": "Merge branch 'master' into add-ethstats-socket"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzOTcwMjc1", "url": "https://github.com/hyperledger/besu/pull/1239#pullrequestreview-453970275", "createdAt": "2020-07-23T09:30:30Z", "commit": {"oid": "35caaee1c818726e81d7f0bf6b2ca0713c8d7793"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMzc0MDY3", "url": "https://github.com/hyperledger/besu/pull/1239#pullrequestreview-453374067", "createdAt": "2020-07-22T14:29:11Z", "commit": {"oid": "63b9289280ab15a28a163357939a47e908d0716c"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNDoyOToxMVrOG1lGRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNDo1OToxM1rOG1mfpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgzNTUyNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                      LOG.error(\"Failed to login to ethstats server \" + ack);\n          \n          \n            \n                                      LOG.error(\"Failed to login to ethstats server {}\", ack);", "url": "https://github.com/hyperledger/besu/pull/1239#discussion_r458835526", "createdAt": "2020-07-22T14:29:11Z", "author": {"login": "shemnon"}, "path": "ethereum/ethstats/src/main/java/org/hyperledger/besu/ethstats/EthStatsService.java", "diffHunk": "@@ -169,8 +177,7 @@ public void start() {\n                           // send a full report after the connection\n                           sendFullReport();\n                         } else {\n-                          LOG.error(\"Failed to login to ethstats server\");\n-                          retryConnect();\n+                          LOG.error(\"Failed to login to ethstats server \" + ack);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63b9289280ab15a28a163357939a47e908d0716c"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg1NzAxMA==", "bodyText": "How would this look with the @Parameter annotation on the key fields?  That would open up the .of(...) static method and these singe use cases could become (I'm guesssing on the auto-formattting)...\n    sendMessage(\n      webSocket, \n      new EthStatsRequest(\n        NODE_PING, \n        ImmutablePingReport.of(\n          enodeURL.getNodeId().toHexString(),\n          String.valueOf(pingTimestamp))));", "url": "https://github.com/hyperledger/besu/pull/1239#discussion_r458857010", "createdAt": "2020-07-22T14:57:16Z", "author": {"login": "shemnon"}, "path": "ethereum/ethstats/src/main/java/org/hyperledger/besu/ethstats/EthStatsService.java", "diffHunk": "@@ -274,22 +285,22 @@ private void sendFullReport() {\n   private void sendPing() {\n     // we store the timestamp when we sent the ping\n     pingTimestamp = System.currentTimeMillis();\n-    final EthStatsRequest ping =\n-        new EthStatsRequest(\n-            NODE_PING,\n-            new PingReport(enodeURL.getNodeId().toHexString(), String.valueOf(pingTimestamp)));\n-    sendMessage(webSocket, ping);\n+    final PingReport pingReport =\n+        ImmutablePingReport.builder()\n+            .id(enodeURL.getNodeId().toHexString())\n+            .currentTime(String.valueOf(pingTimestamp))\n+            .build();\n+    sendMessage(webSocket, new EthStatsRequest(NODE_PING, pingReport));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63b9289280ab15a28a163357939a47e908d0716c"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg1ODQwNA==", "bodyText": "Let's start these out as --X options and make them standard after one dot-dot release cycle without issues.", "url": "https://github.com/hyperledger/besu/pull/1239#discussion_r458858404", "createdAt": "2020-07-22T14:59:13Z", "author": {"login": "shemnon"}, "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1039,6 +1040,21 @@ void setBannedNodeIds(final List<String> values) {\n       arity = \"1\")\n   private final Long wsTimeoutSec = TimeoutOptions.defaultOptions().getTimeoutSeconds();\n \n+  @SuppressWarnings({\"FieldCanBeFinal\", \"FieldMayBeFinal\"})\n+  @Option(\n+      names = {\"--ethstats\"},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63b9289280ab15a28a163357939a47e908d0716c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f614c948c8acfc277ddb3c3f92377c91d9a8ce09", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/f614c948c8acfc277ddb3c3f92377c91d9a8ce09", "committedDate": "2020-07-24T09:11:16Z", "message": "fix review issues\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80cf14a74819d45f070272fd38013e156f732c98", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/80cf14a74819d45f070272fd38013e156f732c98", "committedDate": "2020-07-24T09:11:46Z", "message": "Merge remote-tracking branch 'origin/add-ethstats-socket' into add-ethstats-socket"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "25780ac22c99fc44dda4c332e50d7e2919f41221", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/25780ac22c99fc44dda4c332e50d7e2919f41221", "committedDate": "2020-07-24T09:39:37Z", "message": "Merge branch 'master/master' into add-ethstats-socket\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}, "afterCommit": {"oid": "aaecf7804caede07ad0894377cc3974e5790d9b0", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/aaecf7804caede07ad0894377cc3974e5790d9b0", "committedDate": "2020-07-24T09:41:45Z", "message": "Merge branch 'master/master' into add-ethstats-socket\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d15e47c57dc85ddbe4f7a7fb056dfbfc27ee2031", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/d15e47c57dc85ddbe4f7a7fb056dfbfc27ee2031", "committedDate": "2020-07-24T09:45:18Z", "message": "Merge branch 'upstream/master' into add-ethstats-socket\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "028bff77a3bcd45a63b9999cd54ae491872ac96e", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/028bff77a3bcd45a63b9999cd54ae491872ac96e", "committedDate": "2020-07-24T09:46:46Z", "message": "clean merge\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aaecf7804caede07ad0894377cc3974e5790d9b0", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/aaecf7804caede07ad0894377cc3974e5790d9b0", "committedDate": "2020-07-24T09:41:45Z", "message": "Merge branch 'master/master' into add-ethstats-socket\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}, "afterCommit": {"oid": "028bff77a3bcd45a63b9999cd54ae491872ac96e", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/028bff77a3bcd45a63b9999cd54ae491872ac96e", "committedDate": "2020-07-24T09:46:46Z", "message": "clean merge\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcf5b108d8eb8ebb056e92148261478d71dc7a51", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/dcf5b108d8eb8ebb056e92148261478d71dc7a51", "committedDate": "2020-08-04T07:33:39Z", "message": "Merge branch 'master' into add-ethstats-socket"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1449, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}