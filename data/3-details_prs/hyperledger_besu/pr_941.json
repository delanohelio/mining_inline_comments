{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NTY0OTU4", "number": 941, "title": "Update EIP-2315 implementation (enter only via jumpsub)", "bodyText": "Signed-off-by: Karim TAAM karim.t2am@gmail.com\nPR description\nUpdate implementation of the EIP-2315 after the recent PR (ethereum/EIPs#2646)\n\nExecution of BEGINSUB causes exception (OOG: all gas consumed) and terminates execution.\nJUMPSUB sets the pc to location + 1 .\nIn the edge case when BEGINSUB is the last instruction in code and this subroutine is jumped-to, the implementations should execute STOP .\n\nTested with ethereum/tests#685", "createdAt": "2020-05-18T15:09:38Z", "url": "https://github.com/hyperledger/besu/pull/941", "merged": true, "mergeCommit": {"oid": "e8d4e8a4ccea1ebbf36f5d70ca1ae7d7871aff6e"}, "closed": true, "closedAt": "2020-05-26T15:04:07Z", "author": {"login": "matkt"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcig_LygH2gAyNDE5NTY0OTU4OjYzMzUzYjgwY2YyNTA3Yzg0M2ZmMjZiMDA3MGMzNGU1YTBlMTI0YWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclFuD7gH2gAyNDE5NTY0OTU4OjAzMmRhYTI2ZDFjODZiMzdmNDIyNWMwMGI2YWQwMzA0NDQyYjQzNTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "63353b80cf2507c843ff26b0070c34e5a0e124ad", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/63353b80cf2507c843ff26b0070c34e5a0e124ad", "committedDate": "2020-05-18T14:45:29Z", "message": "implement last version of EIP-2315 (enter only via jumpsub)\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NDk1MTcz", "url": "https://github.com/hyperledger/besu/pull/941#pullrequestreview-414495173", "createdAt": "2020-05-19T14:20:53Z", "commit": {"oid": "63353b80cf2507c843ff26b0070c34e5a0e124ad"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNDoyMDo1M1rOGXiwyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNDoyOTo1N1rOGXjQNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMzOTk3OA==", "bodyText": "(optional) Gas.ZERO", "url": "https://github.com/hyperledger/besu/pull/941#discussion_r427339978", "createdAt": "2020-05-19T14:20:53Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/mainnet/BerlinGasCalculator.java", "diffHunk": "@@ -18,7 +18,7 @@\n \n public class BerlinGasCalculator extends IstanbulGasCalculator {\n \n-  private static final Gas BEGIN_SUB_GAS_COST = Gas.of(1);\n+  private static final Gas BEGIN_SUB_GAS_COST = Gas.of(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63353b80cf2507c843ff26b0070c34e5a0e124ad"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0NTkxMA==", "bodyText": "same as above", "url": "https://github.com/hyperledger/besu/pull/941#discussion_r427345910", "createdAt": "2020-05-19T14:27:26Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/vm/operations/BeginSubOperationTest.java", "diffHunk": "@@ -42,7 +43,7 @@\n   private static final GasCalculator gasCalculator = new BerlinGasCalculator();\n \n   private static final int CURRENT_PC = 1;\n-  private static final Gas BEGIN_SUB_GAS_COST = Gas.of(1);\n+  private static final Gas BEGIN_SUB_GAS_COST = Gas.of(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63353b80cf2507c843ff26b0070c34e5a0e124ad"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM0ODAyMg==", "bodyText": "I guess this is a comment for another PR but why do we have the ReturnStack parameterized by size? The size of it is fixed in the EIP, yes? So we shouldn't expose that detail to the caller.", "url": "https://github.com/hyperledger/besu/pull/941#discussion_r427348022", "createdAt": "2020-05-19T14:29:57Z", "author": {"login": "RatanRSur"}, "path": "ethereum/core/src/test/java/org/hyperledger/besu/ethereum/vm/operations/BeginSubOperationTest.java", "diffHunk": "@@ -85,17 +86,16 @@ public void shouldCalculateGasPrice() {\n   }\n \n   @Test\n-  public void shouldNotConsumeStackItem() {\n+  public void shouldHaltWithOutOfGasWhenBeginSubIsExecuted() {\n     final BeginSubOperation operation = new BeginSubOperation(gasCalculator);\n     final MessageFrame frame =\n         createMessageFrameBuilder(Gas.of(1))\n-            .pushStackItem(Bytes32.fromHexString(\"0xFF\"))\n-            .code(new Code(Bytes.fromHexString(\"0x6004b300b2b7\")))\n+            .pushStackItem(Bytes32.fromHexString(\"0x04\"))\n+            .code(new Code(Bytes.fromHexString(\"0x610400b2\")))\n             .returnStack(new ReturnStack(MessageFrame.DEFAULT_MAX_RETURN_STACK_SIZE))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63353b80cf2507c843ff26b0070c34e5a0e124ad"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ded691632071b9619c3451eef021f4a647a71783", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/ded691632071b9619c3451eef021f4a647a71783", "committedDate": "2020-05-19T14:55:50Z", "message": "fix review issues\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05425f813dd25331f3a711c18a1afa2276211935", "author": {"user": {"login": "RatanRSur", "name": "Ratan (Rai) Sur"}}, "url": "https://github.com/hyperledger/besu/commit/05425f813dd25331f3a711c18a1afa2276211935", "committedDate": "2020-05-19T20:53:56Z", "message": "Merge branch 'master' into feature/eip2315-prevent-walking-into-subroutine"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc0d867376fbc58fa68973de3de5e92a3777a032", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/fc0d867376fbc58fa68973de3de5e92a3777a032", "committedDate": "2020-05-26T09:22:54Z", "message": "update EIP2315 change beginsub gas cost\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e26df2cc0910989472215fcd72fcdab70739f27a", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/e26df2cc0910989472215fcd72fcdab70739f27a", "committedDate": "2020-05-26T09:24:57Z", "message": "merge master\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "960b9d9b9eb97c5020e5eeeecd103c5cfee74279", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/960b9d9b9eb97c5020e5eeeecd103c5cfee74279", "committedDate": "2020-05-26T10:23:58Z", "message": "fix review issues and update eip implementation\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MzU2NTQw", "url": "https://github.com/hyperledger/besu/pull/941#pullrequestreview-418356540", "createdAt": "2020-05-26T14:29:29Z", "commit": {"oid": "960b9d9b9eb97c5020e5eeeecd103c5cfee74279"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "032daa26d1c86b37f4225c00b6ad0304442b4350", "author": {"user": {"login": "matkt", "name": null}}, "url": "https://github.com/hyperledger/besu/commit/032daa26d1c86b37f4225c00b6ad0304442b4350", "committedDate": "2020-05-26T14:41:07Z", "message": "Merge commit 'upstream/master' into feature/eip2315-prevent-walking-into-subroutine\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1522, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}