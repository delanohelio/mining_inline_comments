{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNjIwNTA3", "number": 1065, "title": "Resolve inconsistent handling of certain config options.", "bodyText": "PR Description\nThis PR resolves inconsistent handling of config file options by handling primitives the same as the boxed type.\nCertain bool config options from plugins were required to be treated as strings by wrapping the config option in quotes, whereas other bools in Besu did not require the same treatment.\nThe root cause of the issue was the following code snippet in TomlConfigFileDefaultProvider#getConfigurationValue which handled implementation of the default value provider as required in the picocli IDefaultValueProvider interface:\n    if (optionSpec.type().equals(Boolean.class)) {\n      defaultValue = getBooleanEntryAsString(optionSpec);\n    }\n\nWhile this worked fine if the containing type was a Boolean (the boxed type), it would fail to the default case of treating the option as a string if it containing type was a boolean (the primitive). The fix involves treating both the boxed type as well as the primitive the same in the default value implementation, and this change was made both for booleans and integers in this PR.\nI think it's still best practice to recommend standardizing on one method or the other for our type containers in the Besu documentation. (i.e. all Booleans/Integers, or all booleans/ints)\nTesting\nA plugin with its own boolean configuration options was added to the ./besu/build/install/besu/plugins directory and Besu was first run ./besu/build/install/besu/bin/besu --config-file=\"./config_file.toml\" with the following config file:\nrpc-http-enabled=true\nplugin-kafka-enabled=\"true\"\n\nUpon running, the error spelled out in the linked issue was observed. After the change was made, Besu was run the same way using the following config file:\nrpc-http-enabled=true\nplugin-kafka-enabled=true\n\nAfter the fix was made, it was observed that both boolean values were treated the same, and quotes were no longer required.\nSigned-off-by: Steven J Schroeder steven.schroeder@consensys.net", "createdAt": "2020-06-10T18:13:35Z", "url": "https://github.com/hyperledger/besu/pull/1065", "merged": true, "mergeCommit": {"oid": "4050988bf2bffecad22025fa84afdb8b3d57aed4"}, "closed": true, "closedAt": "2020-06-11T16:15:45Z", "author": {"login": "schroedingerscode"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp9isigH2gAyNDMyNjIwNTA3OmEyNzZjYTRiNWQ5NDFlYTIwYmQ2ZTkzMWRlMmRkNTM4ODY4NWMzNWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqQQfuAH2gAyNDMyNjIwNTA3OmNmM2Y1YWM0ODE3NDFkZmRlY2U5OTMwZTA0NTQ1Njk3YWRkY2YwYzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a276ca4b5d941ea20bd6e931de2dd5388685c35a", "author": {"user": {"login": "schroedingerscode", "name": "Steven Schroeder"}}, "url": "https://github.com/hyperledger/besu/commit/a276ca4b5d941ea20bd6e931de2dd5388685c35a", "committedDate": "2020-06-10T17:59:05Z", "message": "Resolve inconsistent handling of [Bb]oolean config options by handling primitives the same as the boxed type.\n\nSigned-off-by: Steven J Schroeder <steven.schroeder@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MzE3MjMw", "url": "https://github.com/hyperledger/besu/pull/1065#pullrequestreview-428317230", "createdAt": "2020-06-10T18:21:36Z", "commit": {"oid": "4905925d7555761fdc89b6e6da40de748b79a3e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4905925d7555761fdc89b6e6da40de748b79a3e7", "author": {"user": {"login": "schroedingerscode", "name": "Steven Schroeder"}}, "url": "https://github.com/hyperledger/besu/commit/4905925d7555761fdc89b6e6da40de748b79a3e7", "committedDate": "2020-06-10T18:20:48Z", "message": "Include unit tests for inconsistent formatting fix.\n\nSigned-off-by: Steven J Schroeder <steven.schroeder@consensys.net>"}, "afterCommit": {"oid": "426c1665563236f666a1e0e2234034138fe1bae4", "author": {"user": {"login": "schroedingerscode", "name": "Steven Schroeder"}}, "url": "https://github.com/hyperledger/besu/commit/426c1665563236f666a1e0e2234034138fe1bae4", "committedDate": "2020-06-10T18:23:16Z", "message": "Include unit tests for inconsistent formatting fix.\n\nSigned-off-by: Steven J Schroeder <steven.schroeder@consensys.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a78dede764d57bdc948dcd6460a62dbb44b1a240", "author": {"user": {"login": "schroedingerscode", "name": "Steven Schroeder"}}, "url": "https://github.com/hyperledger/besu/commit/a78dede764d57bdc948dcd6460a62dbb44b1a240", "committedDate": "2020-06-10T19:07:05Z", "message": "Include unit tests for inconsistent formatting fix.\n\nSigned-off-by: Steven J Schroeder <steven.schroeder@consensys.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "426c1665563236f666a1e0e2234034138fe1bae4", "author": {"user": {"login": "schroedingerscode", "name": "Steven Schroeder"}}, "url": "https://github.com/hyperledger/besu/commit/426c1665563236f666a1e0e2234034138fe1bae4", "committedDate": "2020-06-10T18:23:16Z", "message": "Include unit tests for inconsistent formatting fix.\n\nSigned-off-by: Steven J Schroeder <steven.schroeder@consensys.net>"}, "afterCommit": {"oid": "a78dede764d57bdc948dcd6460a62dbb44b1a240", "author": {"user": {"login": "schroedingerscode", "name": "Steven Schroeder"}}, "url": "https://github.com/hyperledger/besu/commit/a78dede764d57bdc948dcd6460a62dbb44b1a240", "committedDate": "2020-06-10T19:07:05Z", "message": "Include unit tests for inconsistent formatting fix.\n\nSigned-off-by: Steven J Schroeder <steven.schroeder@consensys.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MzYzNzMz", "url": "https://github.com/hyperledger/besu/pull/1065#pullrequestreview-428363733", "createdAt": "2020-06-10T19:28:27Z", "commit": {"oid": "a78dede764d57bdc948dcd6460a62dbb44b1a240"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOToyODoyN1rOGiDSjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOToyODoyN1rOGiDSjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM1ODY3MQ==", "bodyText": "These unit tests were changed, as they relied on the errant behavior that was fixed in this PR in order to function properly.\nBecause a type was not specified in the OptionSpec Builder, picocli would treat them as boolean primitives. Previously, this would fail through to the default string handler, but would get caught and fail in the boolean handling logic after the change. As integers adequately describe these options in the test, they are explicitly cast as such.\nSingle-quoted literal strings were added to the TOML spec in 2014 by toml-lang/toml#232, however it seems as though version 4.1.4 of picocli fails to infer it is a String by default. In any case, the test is not compromised by this change, as it deals mainly with key matching and not type inference.", "url": "https://github.com/hyperledger/besu/pull/1065#discussion_r438358671", "createdAt": "2020-06-10T19:28:27Z", "author": {"login": "schroedingerscode"}, "path": "besu/src/test/java/org/hyperledger/besu/cli/TomlConfigFileDefaultProviderTest.java", "diffHunk": "@@ -72,21 +72,25 @@ public void defaultValueForMatchingKey() throws IOException {\n           new TomlConfigFileDefaultProvider(mockCommandLine, tempConfigFile);\n \n       // this option must be found in config\n-      assertThat(providerUnderTest.defaultValue(OptionSpec.builder(\"a-short-option\").build()))\n+      assertThat(\n+              providerUnderTest.defaultValue(\n+                  OptionSpec.builder(\"a-short-option\").type(Integer.class).build()))\n           .isEqualTo(\"123\");\n \n       // this option must be found in config as one of its names is present in the file.\n       // also this is the shortest one.\n       assertThat(\n               providerUnderTest.defaultValue(\n-                  OptionSpec.builder(\"a-short-option\", \"another-name-for-the-option\").build()))\n+                  OptionSpec.builder(\"a-short-option\", \"another-name-for-the-option\")\n+                      .type(Integer.class)\n+                      .build()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a78dede764d57bdc948dcd6460a62dbb44b1a240"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MzgwOTEz", "url": "https://github.com/hyperledger/besu/pull/1065#pullrequestreview-428380913", "createdAt": "2020-06-10T19:54:45Z", "commit": {"oid": "a78dede764d57bdc948dcd6460a62dbb44b1a240"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDAyMzAz", "url": "https://github.com/hyperledger/besu/pull/1065#pullrequestreview-428402303", "createdAt": "2020-06-10T20:27:02Z", "commit": {"oid": "a78dede764d57bdc948dcd6460a62dbb44b1a240"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ea0b24b6436f4dc3727b45e9bbd09dd374d4d6c", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/1ea0b24b6436f4dc3727b45e9bbd09dd374d4d6c", "committedDate": "2020-06-10T21:38:22Z", "message": "Merge branch 'master' into bug/inconsistent-config-formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf3f5ac481741dfdece9930e04545697addcf0c8", "author": {"user": {"login": "abdelhamidbakhta", "name": "Abdelhamid Bakhta"}}, "url": "https://github.com/hyperledger/besu/commit/cf3f5ac481741dfdece9930e04545697addcf0c8", "committedDate": "2020-06-11T15:47:24Z", "message": "Merge branch 'master' into bug/inconsistent-config-formatting"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1487, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}