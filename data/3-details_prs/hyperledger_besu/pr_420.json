{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NzIwMzY0", "number": 420, "title": "Kill correctly Besu node processes", "bodyText": "Close leaked clusters\nLog a corner case", "createdAt": "2020-02-20T12:10:48Z", "url": "https://github.com/hyperledger/besu/pull/420", "merged": true, "mergeCommit": {"oid": "56c60e03df82fcf2796c47f847820cd6f3824b5d"}, "closed": true, "closedAt": "2020-03-25T00:10:13Z", "author": {"login": "hmijail"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGJqv8AH2gAyMzc3NzIwMzY0OmY3MzU2M2UzYTIwNDY0ZDg1NDc1Y2UzMWU1NTA3YzM1ZWVjNjQxODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ8GO9gFqTM4MDc4MTE1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f73563e3a20464d85475ce31e5507c35eec64186", "author": {"user": {"login": "hmijail", "name": "Horacio Mijail Ant\u00f3n Quiles"}}, "url": "https://github.com/hyperledger/besu/commit/f73563e3a20464d85475ce31e5507c35eec64186", "committedDate": "2020-02-20T11:45:28Z", "message": "Kill processes correctly\n\nNotify of corner cases\n\nSigned-off-by: Horacio Mijail Anton Quiles <hmijail@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e28ce7ecbe086fa98d52916302f8d76002e1bfbc", "author": {"user": {"login": "hmijail", "name": "Horacio Mijail Ant\u00f3n Quiles"}}, "url": "https://github.com/hyperledger/besu/commit/e28ce7ecbe086fa98d52916302f8d76002e1bfbc", "committedDate": "2020-02-20T12:05:44Z", "message": "Close a leaked cluster\n\nSigned-off-by: Horacio Mijail Anton Quiles <hmijail@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDA1ODY0", "url": "https://github.com/hyperledger/besu/pull/420#pullrequestreview-362405864", "createdAt": "2020-02-21T05:24:29Z", "commit": {"oid": "e28ce7ecbe086fa98d52916302f8d76002e1bfbc"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwNToyNDoyOVrOFssBZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwNTozMDo0N1rOFssGlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMjkxNg==", "bodyText": "final modifier\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Process p = besuProcesses.remove(name);\n          \n          \n            \n                final Process p = besuProcesses.remove(name);", "url": "https://github.com/hyperledger/besu/pull/420#discussion_r382402916", "createdAt": "2020-02-21T05:24:29Z", "author": {"login": "CjHare"}, "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/node/ProcessBesuNodeRunner.java", "diffHunk": "@@ -361,17 +360,25 @@ public boolean isActive(final String nodeName) {\n   private void killBesuProcess(final String name, final Process process) {\n     LOG.info(\"Killing \" + name + \" process\");\n \n-    Awaitility.waitAtMost(30, TimeUnit.SECONDS)\n-        .until(\n-            () -> {\n-              if (process.isAlive()) {\n-                process.destroy();\n-                besuProcesses.remove(name);\n-                return false;\n-              } else {\n-                besuProcesses.remove(name);\n-                return true;\n-              }\n-            });\n+    Process p = besuProcesses.remove(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e28ce7ecbe086fa98d52916302f8d76002e1bfbc"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMzczNA==", "bodyText": "Consistent new line white space\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                if (process.isAlive()) {\n          \n          \n            \n            \n          \n          \n            \n                if (process.isAlive()) {", "url": "https://github.com/hyperledger/besu/pull/420#discussion_r382403734", "createdAt": "2020-02-21T05:28:23Z", "author": {"login": "CjHare"}, "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/node/ProcessBesuNodeRunner.java", "diffHunk": "@@ -361,17 +360,25 @@ public boolean isActive(final String nodeName) {\n   private void killBesuProcess(final String name, final Process process) {\n     LOG.info(\"Killing \" + name + \" process\");\n \n-    Awaitility.waitAtMost(30, TimeUnit.SECONDS)\n-        .until(\n-            () -> {\n-              if (process.isAlive()) {\n-                process.destroy();\n-                besuProcesses.remove(name);\n-                return false;\n-              } else {\n-                besuProcesses.remove(name);\n-                return true;\n-              }\n-            });\n+    Process p = besuProcesses.remove(name);\n+    if (p == null) {\n+      LOG.error(\"Process {} wasn't in our list\", name);\n+    }\n+\n+    process.destroy();\n+    try {\n+      process.waitFor(2, TimeUnit.SECONDS);\n+    } catch (InterruptedException e) {\n+      LOG.warn(\"Wait for death of process \" + name + \" was interrupted\", e);\n+    }\n+    if (process.isAlive()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e28ce7ecbe086fa98d52916302f8d76002e1bfbc"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMzkyMQ==", "bodyText": "Consistency with other log messages\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  LOG.warn(\"Wait for death of process \" + name + \" was interrupted\", e);\n          \n          \n            \n                  LOG.warn(\"Wait for death of process \"{} was interrupted\", name, e);", "url": "https://github.com/hyperledger/besu/pull/420#discussion_r382403921", "createdAt": "2020-02-21T05:29:13Z", "author": {"login": "CjHare"}, "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/node/ProcessBesuNodeRunner.java", "diffHunk": "@@ -361,17 +360,25 @@ public boolean isActive(final String nodeName) {\n   private void killBesuProcess(final String name, final Process process) {\n     LOG.info(\"Killing \" + name + \" process\");\n \n-    Awaitility.waitAtMost(30, TimeUnit.SECONDS)\n-        .until(\n-            () -> {\n-              if (process.isAlive()) {\n-                process.destroy();\n-                besuProcesses.remove(name);\n-                return false;\n-              } else {\n-                besuProcesses.remove(name);\n-                return true;\n-              }\n-            });\n+    Process p = besuProcesses.remove(name);\n+    if (p == null) {\n+      LOG.error(\"Process {} wasn't in our list\", name);\n+    }\n+\n+    process.destroy();\n+    try {\n+      process.waitFor(2, TimeUnit.SECONDS);\n+    } catch (InterruptedException e) {\n+      LOG.warn(\"Wait for death of process \" + name + \" was interrupted\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e28ce7ecbe086fa98d52916302f8d76002e1bfbc"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwNDEzMw==", "bodyText": "final modifier\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  } catch (Exception e) {\n          \n          \n            \n                  } catch (final Exception e) {", "url": "https://github.com/hyperledger/besu/pull/420#discussion_r382404133", "createdAt": "2020-02-21T05:30:20Z", "author": {"login": "CjHare"}, "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/node/ProcessBesuNodeRunner.java", "diffHunk": "@@ -361,17 +360,25 @@ public boolean isActive(final String nodeName) {\n   private void killBesuProcess(final String name, final Process process) {\n     LOG.info(\"Killing \" + name + \" process\");\n \n-    Awaitility.waitAtMost(30, TimeUnit.SECONDS)\n-        .until(\n-            () -> {\n-              if (process.isAlive()) {\n-                process.destroy();\n-                besuProcesses.remove(name);\n-                return false;\n-              } else {\n-                besuProcesses.remove(name);\n-                return true;\n-              }\n-            });\n+    Process p = besuProcesses.remove(name);\n+    if (p == null) {\n+      LOG.error(\"Process {} wasn't in our list\", name);\n+    }\n+\n+    process.destroy();\n+    try {\n+      process.waitFor(2, TimeUnit.SECONDS);\n+    } catch (InterruptedException e) {\n+      LOG.warn(\"Wait for death of process \" + name + \" was interrupted\", e);\n+    }\n+    if (process.isAlive()) {\n+      LOG.warn(\"Process {} still alive, destroying forcibly now\", name);\n+      try {\n+        process.destroyForcibly().waitFor(2, TimeUnit.SECONDS);\n+      } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e28ce7ecbe086fa98d52916302f8d76002e1bfbc"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwNDI0NA==", "bodyText": "final modifier\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                } catch (InterruptedException e) {\n          \n          \n            \n                } catch (final InterruptedException e) {", "url": "https://github.com/hyperledger/besu/pull/420#discussion_r382404244", "createdAt": "2020-02-21T05:30:47Z", "author": {"login": "CjHare"}, "path": "acceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/node/ProcessBesuNodeRunner.java", "diffHunk": "@@ -361,17 +360,25 @@ public boolean isActive(final String nodeName) {\n   private void killBesuProcess(final String name, final Process process) {\n     LOG.info(\"Killing \" + name + \" process\");\n \n-    Awaitility.waitAtMost(30, TimeUnit.SECONDS)\n-        .until(\n-            () -> {\n-              if (process.isAlive()) {\n-                process.destroy();\n-                besuProcesses.remove(name);\n-                return false;\n-              } else {\n-                besuProcesses.remove(name);\n-                return true;\n-              }\n-            });\n+    Process p = besuProcesses.remove(name);\n+    if (p == null) {\n+      LOG.error(\"Process {} wasn't in our list\", name);\n+    }\n+\n+    process.destroy();\n+    try {\n+      process.waitFor(2, TimeUnit.SECONDS);\n+    } catch (InterruptedException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e28ce7ecbe086fa98d52916302f8d76002e1bfbc"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "633237bbb897ed38a9cabff0ce83bff0b92008c4", "author": {"user": {"login": "hmijail", "name": "Horacio Mijail Ant\u00f3n Quiles"}}, "url": "https://github.com/hyperledger/besu/commit/633237bbb897ed38a9cabff0ce83bff0b92008c4", "committedDate": "2020-03-24T05:33:34Z", "message": "Merge branch 'master' into kill-correctly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ca460859800d1bc12d6440d0864ab4d22dc844c", "author": {"user": {"login": "hmijail", "name": "Horacio Mijail Ant\u00f3n Quiles"}}, "url": "https://github.com/hyperledger/besu/commit/1ca460859800d1bc12d6440d0864ab4d22dc844c", "committedDate": "2020-03-24T07:26:15Z", "message": "Address comments\n\nSigned-off-by: Horacio Mijail Anton Quiles <hmijail@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a272ca05d57f9fe9b8d462c9f68f42cf8f8a6f40", "author": {"user": {"login": "hmijail", "name": "Horacio Mijail Ant\u00f3n Quiles"}}, "url": "https://github.com/hyperledger/besu/commit/a272ca05d57f9fe9b8d462c9f68f42cf8f8a6f40", "committedDate": "2020-03-24T08:39:45Z", "message": "Merge branch 'master' into kill-correctly\n\nSigned-off-by: Horacio Mijail Anton Quiles <hmijail@gmail.com>\n\n# Conflicts:\n#\tacceptance-tests/dsl/src/main/java/org/hyperledger/besu/tests/acceptance/dsl/node/ProcessBesuNodeRunner.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzgxMTU0", "url": "https://github.com/hyperledger/besu/pull/420#pullrequestreview-380781154", "createdAt": "2020-03-25T00:09:59Z", "commit": {"oid": "a272ca05d57f9fe9b8d462c9f68f42cf8f8a6f40"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1789, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}