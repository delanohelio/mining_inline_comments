{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExMTQ2NzU5", "number": 181, "reviewThreads": {"totalCount": 36, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxMTozOTo0NlrOD4AW_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDozNDoyMFrOD759UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMDUyNzM0OnYy", "diffSide": "RIGHT", "path": "lib/src/main/java/com/futurewei/alcor/common/constants/Ipv6AddressMode.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxMTozOTo0NlrOGOlebg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxNzowNjowMlrOGPPgeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0NzI0Ng==", "bodyText": "Should we use enum instead?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r417947246", "createdAt": "2020-04-30T11:39:46Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/constants/Ipv6AddressMode.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.futurewei.alcor.common.constants;\n+\n+public class Ipv6AddressMode {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "256a119a6358a6558fb5cc0fddddee337d7577ed"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMDg0Nw==", "bodyText": "I don't think so ~ because \"Ipv6AddressMode\" need String type value", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r418430847", "createdAt": "2020-05-01T06:13:34Z", "author": {"login": "kevin-zhonghao"}, "path": "lib/src/main/java/com/futurewei/alcor/common/constants/Ipv6AddressMode.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.futurewei.alcor.common.constants;\n+\n+public class Ipv6AddressMode {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0NzI0Ng=="}, "originalCommit": {"oid": "256a119a6358a6558fb5cc0fddddee337d7577ed"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYzNTg5Ng==", "bodyText": "You could try something like https://howtodoinjava.com/java/enum/java-enum-string-example/", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r418635896", "createdAt": "2020-05-01T17:06:02Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/constants/Ipv6AddressMode.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package com.futurewei.alcor.common.constants;\n+\n+public class Ipv6AddressMode {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0NzI0Ng=="}, "originalCommit": {"oid": "256a119a6358a6558fb5cc0fddddee337d7577ed"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMDUzNjgyOnYy", "diffSide": "RIGHT", "path": "services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/dao/SubnetRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxMTo0MzowNFrOGOlkeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNjoxNjowOFrOGPDBZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0ODc5Mg==", "bodyText": "@kevin-zhonghao Do we want to split it to web object and db object for subnet?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r417948792", "createdAt": "2020-04-30T11:43:04Z", "author": {"login": "xieus"}, "path": "services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/dao/SubnetRepository.java", "diffHunk": "@@ -33,21 +33,21 @@\n \n @Repository\n @ComponentScan(value=\"com.futurewei.alcor.common.db\")\n-public class SubnetRepository implements ICacheRepository<SubnetState> {\n+public class SubnetRepository implements ICacheRepository<SubnetWebObject> {\n \n     private static final Logger logger = LoggerFactory.getLogger();\n \n     private static final String KEY = \"SubnetState\";\n \n-    public ICache<String, SubnetState> getCache() {\n+    public ICache<String, SubnetWebObject> getCache() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "256a119a6358a6558fb5cc0fddddee337d7577ed"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMTMzNA==", "bodyText": "I think we could just make one object for subnet ~ but we can talk about it", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r418431334", "createdAt": "2020-05-01T06:16:08Z", "author": {"login": "kevin-zhonghao"}, "path": "services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/dao/SubnetRepository.java", "diffHunk": "@@ -33,21 +33,21 @@\n \n @Repository\n @ComponentScan(value=\"com.futurewei.alcor.common.db\")\n-public class SubnetRepository implements ICacheRepository<SubnetState> {\n+public class SubnetRepository implements ICacheRepository<SubnetWebObject> {\n \n     private static final Logger logger = LoggerFactory.getLogger();\n \n     private static final String KEY = \"SubnetState\";\n \n-    public ICache<String, SubnetState> getCache() {\n+    public ICache<String, SubnetWebObject> getCache() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0ODc5Mg=="}, "originalCommit": {"oid": "256a119a6358a6558fb5cc0fddddee337d7577ed"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMDU0MjM1OnYy", "diffSide": "RIGHT", "path": "web/src/main/java/com/futurewei/alcor/web/entity/AllocationPool.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxMTo0NDo0MFrOGOlnmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNjoxODo1M1rOGPDDyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0OTU5NQ==", "bodyText": "This is an interesting class. How will it be used?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r417949595", "createdAt": "2020-04-30T11:44:40Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/AllocationPool.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Data;\n+\n+@Data\n+public class AllocationPool {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "256a119a6358a6558fb5cc0fddddee337d7577ed"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMTk0Ng==", "bodyText": "this is one property of SubnetWebObject. It's a sub-table", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r418431946", "createdAt": "2020-05-01T06:18:53Z", "author": {"login": "kevin-zhonghao"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/AllocationPool.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Data;\n+\n+@Data\n+public class AllocationPool {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzk0OTU5NQ=="}, "originalCommit": {"oid": "256a119a6358a6558fb5cc0fddddee337d7577ed"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjU5MzgyOnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDozOTo1NFrOGQRUxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMTozNDo1NFrOGQTFqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNDI0NA==", "bodyText": "Like switching to enum here.\nBut what if networkType == null..", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419714244", "createdAt": "2020-05-04T20:39:54Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "diffHunk": "@@ -72,6 +73,16 @@ public SegmentWebResponseJson createSegment(@PathVariable String projectid, @Req\n             RestPreconditionsUtil.verifyResourceNotNull(segmentWebResponseObject);\n             RestPreconditionsUtil.populateResourceProjectId(segmentWebResponseObject, projectid);\n \n+            // verify network type\n+            String networkType = segmentWebRequestObject.getNetworkType();\n+            if (networkType.equals(NetworkTypeEnum.VXLAN)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0MzE0NQ==", "bodyText": "I think  networkType == null condition could be checked when we verify resource of SegmentWebRequestJson. If found networkType == null, we could throw an specific exception.\nSo I miss networkType == null here.\nWhat do you think?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419743145", "createdAt": "2020-05-04T21:34:54Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "diffHunk": "@@ -72,6 +73,16 @@ public SegmentWebResponseJson createSegment(@PathVariable String projectid, @Req\n             RestPreconditionsUtil.verifyResourceNotNull(segmentWebResponseObject);\n             RestPreconditionsUtil.populateResourceProjectId(segmentWebResponseObject, projectid);\n \n+            // verify network type\n+            String networkType = segmentWebRequestObject.getNetworkType();\n+            if (networkType.equals(NetworkTypeEnum.VXLAN)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNDI0NA=="}, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjU5ODQ4OnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentRangeController.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDo0MToyM1rOGQRXuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNzoxMjowOVrOGUkRpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNTAwMw==", "bodyText": "I think it is time for us to use standard REST error code that is compatible to OpenStack.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419715003", "createdAt": "2020-05-04T20:41:23Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentRangeController.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package com.futurewei.alcor.vpcmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNullException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.vpcmanager.service.SegmentRangeDatabaseService;\n+import com.futurewei.alcor.vpcmanager.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+public class SegmentRangeController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private SegmentRangeDatabaseService segmentRangeDatabaseService;\n+\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/network_segment_ranges/{network_segment_range_id}\", \"/v4/{projectid}/network_segment_ranges/{network_segment_range_id}\"})\n+    public NetworkSegmentRangeWebResponseJson getSegmentRangeBySegmentRangeId(@PathVariable String projectid, @PathVariable String network_segment_range_id) throws Exception {\n+\n+        NetworkSegmentRangeWebResponseObject segmentRangeWebResponseObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(network_segment_range_id);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            segmentRangeWebResponseObject = this.segmentRangeDatabaseService.getBySegmentRangeId(network_segment_range_id);\n+        } catch (ParameterNullOrEmptyException e) {\n+            //TODO: REST error code", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0NzAxNw==", "bodyText": "Okay ~", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419747017", "createdAt": "2020-05-04T21:43:23Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentRangeController.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package com.futurewei.alcor.vpcmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNullException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.vpcmanager.service.SegmentRangeDatabaseService;\n+import com.futurewei.alcor.vpcmanager.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+public class SegmentRangeController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private SegmentRangeDatabaseService segmentRangeDatabaseService;\n+\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/network_segment_ranges/{network_segment_range_id}\", \"/v4/{projectid}/network_segment_ranges/{network_segment_range_id}\"})\n+    public NetworkSegmentRangeWebResponseJson getSegmentRangeBySegmentRangeId(@PathVariable String projectid, @PathVariable String network_segment_range_id) throws Exception {\n+\n+        NetworkSegmentRangeWebResponseObject segmentRangeWebResponseObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(network_segment_range_id);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            segmentRangeWebResponseObject = this.segmentRangeDatabaseService.getBySegmentRangeId(network_segment_range_id);\n+        } catch (ParameterNullOrEmptyException e) {\n+            //TODO: REST error code", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNTAwMw=="}, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA2MDM5MQ==", "bodyText": "@kevin-zhonghao Can you take a look at this commit: https://github.com/futurewei-cloud/alcor/pull/180/files#diff-17bb45b637cbf4c960554c2ae9fe82bc?\nSpecifically, all the exception classes has an associated error code so when we throw that exception, web layer will throw the associated error code. That is a good pattern to learn.\nFor example,\nservices/port_manager/src/main/java/com/futurewei/alcor/portmanager/exception/ReleaseIpAddrBulkException.java", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424060391", "createdAt": "2020-05-12T22:03:46Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentRangeController.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package com.futurewei.alcor.vpcmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNullException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.vpcmanager.service.SegmentRangeDatabaseService;\n+import com.futurewei.alcor.vpcmanager.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+public class SegmentRangeController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private SegmentRangeDatabaseService segmentRangeDatabaseService;\n+\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/network_segment_ranges/{network_segment_range_id}\", \"/v4/{projectid}/network_segment_ranges/{network_segment_range_id}\"})\n+    public NetworkSegmentRangeWebResponseJson getSegmentRangeBySegmentRangeId(@PathVariable String projectid, @PathVariable String network_segment_range_id) throws Exception {\n+\n+        NetworkSegmentRangeWebResponseObject segmentRangeWebResponseObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(network_segment_range_id);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            segmentRangeWebResponseObject = this.segmentRangeDatabaseService.getBySegmentRangeId(network_segment_range_id);\n+        } catch (ParameterNullOrEmptyException e) {\n+            //TODO: REST error code", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNTAwMw=="}, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIxOTA0Ng==", "bodyText": "Thanks for making the change!", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424219046", "createdAt": "2020-05-13T07:12:09Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentRangeController.java", "diffHunk": "@@ -0,0 +1,174 @@\n+package com.futurewei.alcor.vpcmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNullException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.vpcmanager.service.SegmentRangeDatabaseService;\n+import com.futurewei.alcor.vpcmanager.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+public class SegmentRangeController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private SegmentRangeDatabaseService segmentRangeDatabaseService;\n+\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/network_segment_ranges/{network_segment_range_id}\", \"/v4/{projectid}/network_segment_ranges/{network_segment_range_id}\"})\n+    public NetworkSegmentRangeWebResponseJson getSegmentRangeBySegmentRangeId(@PathVariable String projectid, @PathVariable String network_segment_range_id) throws Exception {\n+\n+        NetworkSegmentRangeWebResponseObject segmentRangeWebResponseObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(network_segment_range_id);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            segmentRangeWebResponseObject = this.segmentRangeDatabaseService.getBySegmentRangeId(network_segment_range_id);\n+        } catch (ParameterNullOrEmptyException e) {\n+            //TODO: REST error code", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNTAwMw=="}, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjYwNzIwOnYy", "diffSide": "RIGHT", "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkSegmentRangeWebRequestJson.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDo0NDowMFrOGQRdFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMjowNDoxNVrOGUamqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNjM3Mg==", "bodyText": "Thanks for adding those new entity classes in AlcorWeb.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419716372", "createdAt": "2020-05-04T20:44:00Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkSegmentRangeWebRequestJson.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import lombok.Data;\n+\n+import java.util.UUID;\n+\n+@Data\n+public class NetworkSegmentRangeWebRequestJson {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNjY3Mg==", "bodyText": "should it be a child class of CustomerResource?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419716672", "createdAt": "2020-05-04T20:44:33Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkSegmentRangeWebRequestJson.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import lombok.Data;\n+\n+import java.util.UUID;\n+\n+@Data\n+public class NetworkSegmentRangeWebRequestJson {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNjM3Mg=="}, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1OTQ5OA==", "bodyText": "I make NetworkSegmentRangeWebRequest be a child class of CustomerResource ~\nNetworkSegmentRangeWebRequestJson maybe not", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419759498", "createdAt": "2020-05-04T22:11:23Z", "author": {"login": "kevin-zhonghao"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkSegmentRangeWebRequestJson.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import lombok.Data;\n+\n+import java.util.UUID;\n+\n+@Data\n+public class NetworkSegmentRangeWebRequestJson {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNjM3Mg=="}, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA2MDU4Nw==", "bodyText": "I see it is okay.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424060587", "createdAt": "2020-05-12T22:04:15Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkSegmentRangeWebRequestJson.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import lombok.Data;\n+\n+import java.util.UUID;\n+\n+@Data\n+public class NetworkSegmentRangeWebRequestJson {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNjM3Mg=="}, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjYxNDg1OnYy", "diffSide": "RIGHT", "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVxlanType.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDo0NjoxN1rOGQRh4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMjowNDo0NlrOGUanig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNzYwMA==", "bodyText": "This class is for VxLan, so the id should be \"vxlan_id\", instead of \"vlan_id\" :-)", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419717600", "createdAt": "2020-05-04T20:46:17Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVxlanType.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Data;\n+import org.springframework.data.annotation.CreatedDate;\n+import org.springframework.data.annotation.LastModifiedDate;\n+\n+@Data\n+public class NetworkVxlanType {\n+\n+    @JsonProperty(\"id\")\n+    private String id;\n+\n+    @JsonProperty(\"name\")\n+    private String name;\n+\n+    @JsonProperty(\"mtu\")\n+    private String mtu;\n+\n+    @JsonProperty(\"vlan_id\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2MDI0Nw==", "bodyText": "I think this property is used to store the vlan_id related to vxlan ~ let us talk about it", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419760247", "createdAt": "2020-05-04T22:13:14Z", "author": {"login": "kevin-zhonghao"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVxlanType.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Data;\n+import org.springframework.data.annotation.CreatedDate;\n+import org.springframework.data.annotation.LastModifiedDate;\n+\n+@Data\n+public class NetworkVxlanType {\n+\n+    @JsonProperty(\"id\")\n+    private String id;\n+\n+    @JsonProperty(\"name\")\n+    private String name;\n+\n+    @JsonProperty(\"mtu\")\n+    private String mtu;\n+\n+    @JsonProperty(\"vlan_id\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNzYwMA=="}, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA2MDgxMA==", "bodyText": "I don't think we discussed this before.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424060810", "createdAt": "2020-05-12T22:04:46Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVxlanType.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Data;\n+import org.springframework.data.annotation.CreatedDate;\n+import org.springframework.data.annotation.LastModifiedDate;\n+\n+@Data\n+public class NetworkVxlanType {\n+\n+    @JsonProperty(\"id\")\n+    private String id;\n+\n+    @JsonProperty(\"name\")\n+    private String name;\n+\n+    @JsonProperty(\"mtu\")\n+    private String mtu;\n+\n+    @JsonProperty(\"vlan_id\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxNzYwMA=="}, "originalCommit": {"oid": "e892cfb84923079b1e10d38cbfb1c1422dee61f7"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMzc0MzczOnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/DebugVpcController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNjoxNjowM1rOGQbs5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNjoxNjowM1rOGQbs5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg4NDI2Mw==", "bodyText": "This is the vpc state retrieved from database, meaning that it is not the \"in\"VpcState any more. Let us use a new variable name, like \"persisted\"VpcState, or \"db\"VpcState, or something else.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419884263", "createdAt": "2020-05-05T06:16:03Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/DebugVpcController.java", "diffHunk": "@@ -92,25 +91,26 @@ public Map getVpcCount() throws CacheException {\n             method = POST,\n             value = {\"/debug/project/{projectid}/vpcs\"})\n     @ResponseStatus(HttpStatus.CREATED)\n-    public VpcStateJson createVpcState(@PathVariable String projectid, @RequestBody VpcStateJson resource) throws Exception {\n-        VpcState vpcState = null;\n+    public VpcWebJson createVpcState(@PathVariable String projectid, @RequestBody VpcWebRequestJson resource) throws Exception {\n+        VpcWebResponseObject inVpcState = new VpcWebResponseObject();\n \n         try {\n             RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n \n-            VpcState inVpcState = resource.getVpc();\n+            VpcWebRequestObject vpcWebRequestObject = resource.getNetwork();\n+            BeanUtils.copyProperties(vpcWebRequestObject, inVpcState);\n             RestPreconditionsUtil.verifyResourceNotNull(inVpcState);\n             RestPreconditionsUtil.populateResourceProjectId(inVpcState, projectid);\n \n             Transaction transaction = this.vpcDatabaseService.getCache().getTransaction();\n             transaction.start();\n \n             this.vpcDatabaseService.addVpc(inVpcState);\n-            vpcState = this.vpcDatabaseService.getByVpcId(inVpcState.getId());\n+            inVpcState = this.vpcDatabaseService.getByVpcId(inVpcState.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3df3d9cd62a784a14158094f0e1cbd237a437aec"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMzc0ODkyOnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/DebugVpcController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNjoxODozMFrOGQbwBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMTowMzoxN1rOGRquww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg4NTA2Mg==", "bodyText": "Do we have to use a GetTransaction for every get request? If so, please move the transaction block code to service layer, instead of keeping it in Controller layer.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419885062", "createdAt": "2020-05-05T06:18:30Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/DebugVpcController.java", "diffHunk": "@@ -92,25 +91,26 @@ public Map getVpcCount() throws CacheException {\n             method = POST,\n             value = {\"/debug/project/{projectid}/vpcs\"})\n     @ResponseStatus(HttpStatus.CREATED)\n-    public VpcStateJson createVpcState(@PathVariable String projectid, @RequestBody VpcStateJson resource) throws Exception {\n-        VpcState vpcState = null;\n+    public VpcWebJson createVpcState(@PathVariable String projectid, @RequestBody VpcWebRequestJson resource) throws Exception {\n+        VpcWebResponseObject inVpcState = new VpcWebResponseObject();\n \n         try {\n             RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n \n-            VpcState inVpcState = resource.getVpc();\n+            VpcWebRequestObject vpcWebRequestObject = resource.getNetwork();\n+            BeanUtils.copyProperties(vpcWebRequestObject, inVpcState);\n             RestPreconditionsUtil.verifyResourceNotNull(inVpcState);\n             RestPreconditionsUtil.populateResourceProjectId(inVpcState, projectid);\n \n             Transaction transaction = this.vpcDatabaseService.getCache().getTransaction();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3df3d9cd62a784a14158094f0e1cbd237a437aec"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE3OTA3NQ==", "bodyText": "Okay ~ I'll revise it in next update", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421179075", "createdAt": "2020-05-07T01:03:17Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/DebugVpcController.java", "diffHunk": "@@ -92,25 +91,26 @@ public Map getVpcCount() throws CacheException {\n             method = POST,\n             value = {\"/debug/project/{projectid}/vpcs\"})\n     @ResponseStatus(HttpStatus.CREATED)\n-    public VpcStateJson createVpcState(@PathVariable String projectid, @RequestBody VpcStateJson resource) throws Exception {\n-        VpcState vpcState = null;\n+    public VpcWebJson createVpcState(@PathVariable String projectid, @RequestBody VpcWebRequestJson resource) throws Exception {\n+        VpcWebResponseObject inVpcState = new VpcWebResponseObject();\n \n         try {\n             RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n \n-            VpcState inVpcState = resource.getVpc();\n+            VpcWebRequestObject vpcWebRequestObject = resource.getNetwork();\n+            BeanUtils.copyProperties(vpcWebRequestObject, inVpcState);\n             RestPreconditionsUtil.verifyResourceNotNull(inVpcState);\n             RestPreconditionsUtil.populateResourceProjectId(inVpcState, projectid);\n \n             Transaction transaction = this.vpcDatabaseService.getCache().getTransaction();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg4NTA2Mg=="}, "originalCommit": {"oid": "3df3d9cd62a784a14158094f0e1cbd237a437aec"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMzc1NDg2OnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/DebugVpcController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwNjoyMDo1MVrOGQbzYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMTowMzoyOFrOGRqu8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg4NTkyMg==", "bodyText": "@kevin-zhonghao I remember there is logics here to call RouteManager to create default route rules. Somehow the logics is gone. Could you recover it and make it ASYNC?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r419885922", "createdAt": "2020-05-05T06:20:51Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/DebugVpcController.java", "diffHunk": "@@ -92,25 +91,26 @@ public Map getVpcCount() throws CacheException {\n             method = POST,\n             value = {\"/debug/project/{projectid}/vpcs\"})\n     @ResponseStatus(HttpStatus.CREATED)\n-    public VpcStateJson createVpcState(@PathVariable String projectid, @RequestBody VpcStateJson resource) throws Exception {\n-        VpcState vpcState = null;\n+    public VpcWebJson createVpcState(@PathVariable String projectid, @RequestBody VpcWebRequestJson resource) throws Exception {\n+        VpcWebResponseObject inVpcState = new VpcWebResponseObject();\n \n         try {\n             RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n \n-            VpcState inVpcState = resource.getVpc();\n+            VpcWebRequestObject vpcWebRequestObject = resource.getNetwork();\n+            BeanUtils.copyProperties(vpcWebRequestObject, inVpcState);\n             RestPreconditionsUtil.verifyResourceNotNull(inVpcState);\n             RestPreconditionsUtil.populateResourceProjectId(inVpcState, projectid);\n \n             Transaction transaction = this.vpcDatabaseService.getCache().getTransaction();\n             transaction.start();\n \n             this.vpcDatabaseService.addVpc(inVpcState);\n-            vpcState = this.vpcDatabaseService.getByVpcId(inVpcState.getId());\n+            inVpcState = this.vpcDatabaseService.getByVpcId(inVpcState.getId());\n \n             transaction.commit();\n \n-            if (vpcState == null) {\n+            if (inVpcState == null) {\n                 throw new ResourcePersistenceException();\n             }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3df3d9cd62a784a14158094f0e1cbd237a437aec"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE3OTEyMA==", "bodyText": "NP", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421179120", "createdAt": "2020-05-07T01:03:28Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/DebugVpcController.java", "diffHunk": "@@ -92,25 +91,26 @@ public Map getVpcCount() throws CacheException {\n             method = POST,\n             value = {\"/debug/project/{projectid}/vpcs\"})\n     @ResponseStatus(HttpStatus.CREATED)\n-    public VpcStateJson createVpcState(@PathVariable String projectid, @RequestBody VpcStateJson resource) throws Exception {\n-        VpcState vpcState = null;\n+    public VpcWebJson createVpcState(@PathVariable String projectid, @RequestBody VpcWebRequestJson resource) throws Exception {\n+        VpcWebResponseObject inVpcState = new VpcWebResponseObject();\n \n         try {\n             RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n \n-            VpcState inVpcState = resource.getVpc();\n+            VpcWebRequestObject vpcWebRequestObject = resource.getNetwork();\n+            BeanUtils.copyProperties(vpcWebRequestObject, inVpcState);\n             RestPreconditionsUtil.verifyResourceNotNull(inVpcState);\n             RestPreconditionsUtil.populateResourceProjectId(inVpcState, projectid);\n \n             Transaction transaction = this.vpcDatabaseService.getCache().getTransaction();\n             transaction.start();\n \n             this.vpcDatabaseService.addVpc(inVpcState);\n-            vpcState = this.vpcDatabaseService.getByVpcId(inVpcState.getId());\n+            inVpcState = this.vpcDatabaseService.getByVpcId(inVpcState.getId());\n \n             transaction.commit();\n \n-            if (vpcState == null) {\n+            if (inVpcState == null) {\n                 throw new ResourcePersistenceException();\n             }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTg4NTkyMg=="}, "originalCommit": {"oid": "3df3d9cd62a784a14158094f0e1cbd237a437aec"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjIxNDU4OnYy", "diffSide": "RIGHT", "path": "docs/design/vpc_manager.adoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzoxNjozM1rOGRs6Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzoxNjozM1rOGRs6Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNDc2Mw==", "bodyText": "The image looks great.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421214763", "createdAt": "2020-05-07T03:16:33Z", "author": {"login": "xieus"}, "path": "docs/design/vpc_manager.adoc", "diffHunk": "@@ -16,7 +16,8 @@ v0.1, 2020-05-04\n === Concurrency Control\n \n == Database Schema\n-\n+=== Network Vlan Range and Vlan State\n+image::images/network_type_vlan.PNG[]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjIxNTU5OnYy", "diffSide": "RIGHT", "path": "lib/pom.xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzoxNzowMFrOGRs6wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMjoyNzo1M1rOGUfU_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNDkxMg==", "bodyText": "Do we really need this dependency for lib?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421214912", "createdAt": "2020-05-07T03:17:00Z", "author": {"login": "xieus"}, "path": "lib/pom.xml", "diffHunk": "@@ -21,6 +21,10 @@\n     </properties>\n \n     <dependencies>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-web</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkyMDAzNQ==", "bodyText": "Yes I add it cause some reasons", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421920035", "createdAt": "2020-05-08T03:44:04Z", "author": {"login": "kevin-zhonghao"}, "path": "lib/pom.xml", "diffHunk": "@@ -21,6 +21,10 @@\n     </properties>\n \n     <dependencies>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-web</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNDkxMg=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEzNzk4MQ==", "bodyText": "Please try to remove this dependency if not necessary.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424137981", "createdAt": "2020-05-13T02:27:53Z", "author": {"login": "xieus"}, "path": "lib/pom.xml", "diffHunk": "@@ -21,6 +21,10 @@\n     </properties>\n \n     <dependencies>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-web</artifactId>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNDkxMg=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjIxNzE0OnYy", "diffSide": "RIGHT", "path": "lib/src/main/java/com/futurewei/alcor/common/constants/NetworkType.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzoxNzo1OFrOGRs7sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzo0Mzo0MlrOGSX8pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNTE1Mg==", "bodyText": "Use 2 ^ 24?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421215152", "createdAt": "2020-05-07T03:17:58Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/constants/NetworkType.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package com.futurewei.alcor.common.constants;\n+\n+public class NetworkType {\n+\n+    public static final int VXLAN_MAX_KEY = 16000000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxOTkwOQ==", "bodyText": "Sure", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421919909", "createdAt": "2020-05-08T03:43:42Z", "author": {"login": "kevin-zhonghao"}, "path": "lib/src/main/java/com/futurewei/alcor/common/constants/NetworkType.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package com.futurewei.alcor.common.constants;\n+\n+public class NetworkType {\n+\n+    public static final int VXLAN_MAX_KEY = 16000000;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNTE1Mg=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjIxOTc5OnYy", "diffSide": "RIGHT", "path": "lib/src/main/java/com/futurewei/alcor/common/exception/InternalDbOperationException.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzoxOTozN1rOGRs9PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzoxOTozN1rOGRs9PA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNTU0OA==", "bodyText": "Space here.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421215548", "createdAt": "2020-05-07T03:19:37Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/exception/InternalDbOperationException.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.common.exception;\n+\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.ResponseStatus;\n+\n+@ResponseStatus(code= HttpStatus.INTERNAL_SERVER_ERROR, reason=\"Internal db operation exception\")\n+public class InternalDbOperationException extends Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjIyMjIwOnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzoyMToxMVrOGRs-qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzo0MzozNFrOGSX8jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNTkxNQ==", "bodyText": "Do we need the parameter of networkType in the addVlanEntity method?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421215915", "createdAt": "2020-05-07T03:21:11Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "diffHunk": "@@ -75,14 +81,18 @@ public SegmentWebResponseJson createSegment(@PathVariable String projectid, @Req\n \n             // verify network type\n             String networkType = segmentWebRequestObject.getNetworkType();\n-            if (networkType.equals(NetworkTypeEnum.VXLAN)) {\n-\n-            } else if (networkType.equals(NetworkTypeEnum.VLAN)) {\n-\n-            }else if (networkType.equals(NetworkTypeEnum.GRE)) {\n-\n+            Long key = null;\n+            if (NetworkTypeEnum.VXLAN.getNetworkType().equals(networkType)) {\n+                key = segmentService.addVxlanEntity(segmentWebRequestObject.getId());\n+            } else if (NetworkTypeEnum.VLAN.getNetworkType().equals(networkType)) {\n+                key = segmentService.addVlanEntity(segmentWebRequestObject.getId(), networkTypeId, networkType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxOTg4Ng==", "bodyText": "Yes", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421919886", "createdAt": "2020-05-08T03:43:34Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "diffHunk": "@@ -75,14 +81,18 @@ public SegmentWebResponseJson createSegment(@PathVariable String projectid, @Req\n \n             // verify network type\n             String networkType = segmentWebRequestObject.getNetworkType();\n-            if (networkType.equals(NetworkTypeEnum.VXLAN)) {\n-\n-            } else if (networkType.equals(NetworkTypeEnum.VLAN)) {\n-\n-            }else if (networkType.equals(NetworkTypeEnum.GRE)) {\n-\n+            Long key = null;\n+            if (NetworkTypeEnum.VXLAN.getNetworkType().equals(networkType)) {\n+                key = segmentService.addVxlanEntity(segmentWebRequestObject.getId());\n+            } else if (NetworkTypeEnum.VLAN.getNetworkType().equals(networkType)) {\n+                key = segmentService.addVlanEntity(segmentWebRequestObject.getId(), networkTypeId, networkType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNTkxNQ=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjIyMzkwOnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzoyMjoxMFrOGRs_jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzo0MzoxMVrOGSX8PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNjE0Mw==", "bodyText": "\"getSegmentUuid\"?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421216143", "createdAt": "2020-05-07T03:22:10Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "diffHunk": "@@ -150,7 +160,19 @@ public ResponseId deleteSegmentBySegmentId(@PathVariable String projectid, @Path\n                 return new ResponseId();\n             }\n \n+            // Release Network Type\n+            String networkType = segmentWebResponseObject.getNetworkType();\n+            Long key = Long.parseLong(String.valueOf(segmentWebResponseObject.getSegmentationId()));\n+            if (NetworkTypeEnum.VXLAN.getNetworkType().equals(networkType)) {\n+\n+            } else if (NetworkTypeEnum.VLAN.getNetworkType().equals(networkType)) {\n+                this.segmentService.releaseVlanEntity(segmentWebResponseObject.getSegmentationUUId(), key);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxOTgwNQ==", "bodyText": "Yeah we need this parameter I think", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421919805", "createdAt": "2020-05-08T03:43:11Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "diffHunk": "@@ -150,7 +160,19 @@ public ResponseId deleteSegmentBySegmentId(@PathVariable String projectid, @Path\n                 return new ResponseId();\n             }\n \n+            // Release Network Type\n+            String networkType = segmentWebResponseObject.getNetworkType();\n+            Long key = Long.parseLong(String.valueOf(segmentWebResponseObject.getSegmentationId()));\n+            if (NetworkTypeEnum.VXLAN.getNetworkType().equals(networkType)) {\n+\n+            } else if (NetworkTypeEnum.VLAN.getNetworkType().equals(networkType)) {\n+                this.segmentService.releaseVlanEntity(segmentWebResponseObject.getSegmentationUUId(), key);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNjE0Mw=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjI0MjA0OnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/dao/SegmentRepository.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzozMzozNFrOGRtKTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzo0MjowOFrOGSX7VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxODg5NQ==", "bodyText": "Remove.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421218895", "createdAt": "2020-05-07T03:33:34Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/dao/SegmentRepository.java", "diffHunk": "@@ -3,6 +3,7 @@\n import com.futurewei.alcor.common.db.CacheException;\n import com.futurewei.alcor.common.db.CacheFactory;\n import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxOTU3Mw==", "bodyText": "Sure", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421919573", "createdAt": "2020-05-08T03:42:08Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/dao/SegmentRepository.java", "diffHunk": "@@ -3,6 +3,7 @@\n import com.futurewei.alcor.common.db.CacheException;\n import com.futurewei.alcor.common.db.CacheFactory;\n import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxODg5NQ=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjI0NDkyOnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/dao/VlanRangeRepository.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzozNTowMFrOGRtL7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzo0MToyOVrOGSX6wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxOTMwOA==", "bodyText": "Like the comment! Can we add it everywhere :-)", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421219308", "createdAt": "2020-05-07T03:35:00Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/dao/VlanRangeRepository.java", "diffHunk": "@@ -0,0 +1,186 @@\n+package com.futurewei.alcor.vpcmanager.dao;\n+\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.db.CacheFactory;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;\n+import com.futurewei.alcor.common.exception.*;\n+import com.futurewei.alcor.common.repo.ICacheRepository;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import com.futurewei.alcor.web.entity.NetworkVlanRange;\n+import com.futurewei.alcor.web.entity.NetworkVlanRangeRequest;\n+import com.futurewei.alcor.web.entity.NetworkVlanType;\n+import com.futurewei.alcor.web.entity.VlanKeyAlloc;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.annotation.PostConstruct;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@Repository\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+public class VlanRangeRepository implements ICacheRepository<NetworkVlanRange> {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    public ICache<String, NetworkVlanRange> getCache() {\n+        return cache;\n+    }\n+\n+    private ICache<String, NetworkVlanRange> cache;\n+\n+\n+    @Autowired\n+    public VlanRangeRepository(CacheFactory cacheFactory) {\n+        cache = cacheFactory.getCache(NetworkVlanRange.class);\n+    }\n+\n+    @PostConstruct\n+    private void init() {\n+        logger.info( \"VlanRangeRepository init completed\");\n+    }\n+\n+    @Override\n+    public synchronized NetworkVlanRange findItem(String id) {\n+        try {\n+            return cache.get(id);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"VlanRangeRepository findItem() exception:\", e);\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public synchronized Map<String, NetworkVlanRange> findAllItems() {\n+        try {\n+            return cache.getAll();\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"VlanRangeRepository findAllItems() exception:\", e);\n+        }\n+\n+        return new HashMap();\n+    }\n+\n+    @Override\n+    public synchronized void addItem(NetworkVlanRange networkVlanRange){\n+        logger.error(\"Add networkVlanRange:{}\", networkVlanRange);\n+\n+        try {\n+            cache.put(networkVlanRange.getId(), networkVlanRange);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"VlanRangeRepository addItem() exception:\", e);\n+        }\n+    }\n+\n+    @Override\n+    public synchronized void deleteItem(String id) {\n+        logger.error(\"Delete rangeId:{}\", id);\n+\n+        try {\n+            cache.remove(id);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"VlanRangeRepository deleteItem() exception:\", e);\n+        }\n+    }\n+\n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxOTQyNg==", "bodyText": "Sure!", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421919426", "createdAt": "2020-05-08T03:41:29Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/dao/VlanRangeRepository.java", "diffHunk": "@@ -0,0 +1,186 @@\n+package com.futurewei.alcor.vpcmanager.dao;\n+\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.db.CacheFactory;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;\n+import com.futurewei.alcor.common.exception.*;\n+import com.futurewei.alcor.common.repo.ICacheRepository;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import com.futurewei.alcor.web.entity.NetworkVlanRange;\n+import com.futurewei.alcor.web.entity.NetworkVlanRangeRequest;\n+import com.futurewei.alcor.web.entity.NetworkVlanType;\n+import com.futurewei.alcor.web.entity.VlanKeyAlloc;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.annotation.PostConstruct;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@Repository\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+public class VlanRangeRepository implements ICacheRepository<NetworkVlanRange> {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    public ICache<String, NetworkVlanRange> getCache() {\n+        return cache;\n+    }\n+\n+    private ICache<String, NetworkVlanRange> cache;\n+\n+\n+    @Autowired\n+    public VlanRangeRepository(CacheFactory cacheFactory) {\n+        cache = cacheFactory.getCache(NetworkVlanRange.class);\n+    }\n+\n+    @PostConstruct\n+    private void init() {\n+        logger.info( \"VlanRangeRepository init completed\");\n+    }\n+\n+    @Override\n+    public synchronized NetworkVlanRange findItem(String id) {\n+        try {\n+            return cache.get(id);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"VlanRangeRepository findItem() exception:\", e);\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public synchronized Map<String, NetworkVlanRange> findAllItems() {\n+        try {\n+            return cache.getAll();\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"VlanRangeRepository findAllItems() exception:\", e);\n+        }\n+\n+        return new HashMap();\n+    }\n+\n+    @Override\n+    public synchronized void addItem(NetworkVlanRange networkVlanRange){\n+        logger.error(\"Add networkVlanRange:{}\", networkVlanRange);\n+\n+        try {\n+            cache.put(networkVlanRange.getId(), networkVlanRange);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"VlanRangeRepository addItem() exception:\", e);\n+        }\n+    }\n+\n+    @Override\n+    public synchronized void deleteItem(String id) {\n+        logger.error(\"Delete rangeId:{}\", id);\n+\n+        try {\n+            cache.remove(id);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"VlanRangeRepository deleteItem() exception:\", e);\n+        }\n+    }\n+\n+    /**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxOTMwOA=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjI1ODE5OnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzo0Mzo0NFrOGRtT0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzo0MDo1M1rOGSX6Jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMTMzMQ==", "bodyText": "can we just get the first range here?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421221331", "createdAt": "2020-05-07T03:43:44Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "diffHunk": "@@ -0,0 +1,254 @@\n+package com.futurewei.alcor.vpcmanager.service.Impl;\n+\n+import com.futurewei.alcor.common.constants.NetworkType;\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.NetworkTypeInvalidException;\n+import com.futurewei.alcor.common.exception.VlanRangeNotFoundException;\n+import com.futurewei.alcor.vpcmanager.dao.GreRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRangeRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VxlanRepository;\n+import com.futurewei.alcor.vpcmanager.service.SegmentService;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+@Service\n+public class SegmentServiceImpl implements SegmentService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private VlanRangeRepository vlanRangeRepository;\n+\n+    @Autowired\n+    private VlanRepository vlanRepository;\n+\n+    @Autowired\n+    private VxlanRepository vxlanRepository;\n+\n+    @Autowired\n+    private GreRepository greRepository;\n+\n+    @Override\n+    public Long addVlanEntity(String segmentId, String vlanId, String networkType) throws DatabasePersistenceException, CacheException {\n+        try {\n+            NetworkVlanType vlan = new NetworkVlanType();\n+            // check if range exist in db\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                String rangeId = UUID.randomUUID().toString();\n+                NetworkVlanRangeRequest request = new NetworkVlanRangeRequest(rangeId, segmentId, networkType, NetworkType.VLAN_FIRST_KEY, NetworkType.VLAN_LAST_KEY);\n+                this.vlanRangeRepository.createRange(request);\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxOTI3MQ==", "bodyText": "We only have one range in vlan range", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421919271", "createdAt": "2020-05-08T03:40:53Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "diffHunk": "@@ -0,0 +1,254 @@\n+package com.futurewei.alcor.vpcmanager.service.Impl;\n+\n+import com.futurewei.alcor.common.constants.NetworkType;\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.NetworkTypeInvalidException;\n+import com.futurewei.alcor.common.exception.VlanRangeNotFoundException;\n+import com.futurewei.alcor.vpcmanager.dao.GreRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRangeRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VxlanRepository;\n+import com.futurewei.alcor.vpcmanager.service.SegmentService;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+@Service\n+public class SegmentServiceImpl implements SegmentService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private VlanRangeRepository vlanRangeRepository;\n+\n+    @Autowired\n+    private VlanRepository vlanRepository;\n+\n+    @Autowired\n+    private VxlanRepository vxlanRepository;\n+\n+    @Autowired\n+    private GreRepository greRepository;\n+\n+    @Override\n+    public Long addVlanEntity(String segmentId, String vlanId, String networkType) throws DatabasePersistenceException, CacheException {\n+        try {\n+            NetworkVlanType vlan = new NetworkVlanType();\n+            // check if range exist in db\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                String rangeId = UUID.randomUUID().toString();\n+                NetworkVlanRangeRequest request = new NetworkVlanRangeRequest(rangeId, segmentId, networkType, NetworkType.VLAN_FIRST_KEY, NetworkType.VLAN_LAST_KEY);\n+                this.vlanRangeRepository.createRange(request);\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMTMzMQ=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjI1OTkyOnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzo0NDo0M1rOGRtUsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzozOTo1N1rOGSX5Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMTU1NA==", "bodyText": "Please uncomment this. We do need MTU.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421221554", "createdAt": "2020-05-07T03:44:43Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "diffHunk": "@@ -0,0 +1,254 @@\n+package com.futurewei.alcor.vpcmanager.service.Impl;\n+\n+import com.futurewei.alcor.common.constants.NetworkType;\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.NetworkTypeInvalidException;\n+import com.futurewei.alcor.common.exception.VlanRangeNotFoundException;\n+import com.futurewei.alcor.vpcmanager.dao.GreRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRangeRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VxlanRepository;\n+import com.futurewei.alcor.vpcmanager.service.SegmentService;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+@Service\n+public class SegmentServiceImpl implements SegmentService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private VlanRangeRepository vlanRangeRepository;\n+\n+    @Autowired\n+    private VlanRepository vlanRepository;\n+\n+    @Autowired\n+    private VxlanRepository vxlanRepository;\n+\n+    @Autowired\n+    private GreRepository greRepository;\n+\n+    @Override\n+    public Long addVlanEntity(String segmentId, String vlanId, String networkType) throws DatabasePersistenceException, CacheException {\n+        try {\n+            NetworkVlanType vlan = new NetworkVlanType();\n+            // check if range exist in db\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                String rangeId = UUID.randomUUID().toString();\n+                NetworkVlanRangeRequest request = new NetworkVlanRangeRequest(rangeId, segmentId, networkType, NetworkType.VLAN_FIRST_KEY, NetworkType.VLAN_LAST_KEY);\n+                this.vlanRangeRepository.createRange(request);\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {\n+                rangeId = entry.getKey();\n+            }\n+\n+            Long key = this.vlanRangeRepository.allocateVlanKey(rangeId);\n+\n+            //vlan.setMtu(mtu);\n+            vlan.setSegmentId(segmentId);\n+            vlan.setVlanId(vlanId);\n+            vlan.setKey(key);\n+\n+            this.vlanRepository.addItem(vlan);\n+            logger.info(\"Allocate vlan key success, key: \" + key);\n+            return key;\n+        } catch (Exception e) {\n+            this.vlanRepository.deleteItem(vlanId);\n+            logger.info(\"Allocate vlan key failed\");\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+\n+    }\n+\n+    @Override\n+    public Long addVxlanEntity(String segmentId) throws DatabasePersistenceException {\n+        try {\n+            String vxlanId = UUID.randomUUID().toString();\n+            NetworkVxlanType vxlan = new NetworkVxlanType();\n+            //vxlan.setMtu(mtu);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxOTA1NQ==", "bodyText": "Yes, but where can we get mtu? segmentRequestObject doesn't include it", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421919055", "createdAt": "2020-05-08T03:39:57Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "diffHunk": "@@ -0,0 +1,254 @@\n+package com.futurewei.alcor.vpcmanager.service.Impl;\n+\n+import com.futurewei.alcor.common.constants.NetworkType;\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.NetworkTypeInvalidException;\n+import com.futurewei.alcor.common.exception.VlanRangeNotFoundException;\n+import com.futurewei.alcor.vpcmanager.dao.GreRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRangeRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VxlanRepository;\n+import com.futurewei.alcor.vpcmanager.service.SegmentService;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+@Service\n+public class SegmentServiceImpl implements SegmentService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private VlanRangeRepository vlanRangeRepository;\n+\n+    @Autowired\n+    private VlanRepository vlanRepository;\n+\n+    @Autowired\n+    private VxlanRepository vxlanRepository;\n+\n+    @Autowired\n+    private GreRepository greRepository;\n+\n+    @Override\n+    public Long addVlanEntity(String segmentId, String vlanId, String networkType) throws DatabasePersistenceException, CacheException {\n+        try {\n+            NetworkVlanType vlan = new NetworkVlanType();\n+            // check if range exist in db\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                String rangeId = UUID.randomUUID().toString();\n+                NetworkVlanRangeRequest request = new NetworkVlanRangeRequest(rangeId, segmentId, networkType, NetworkType.VLAN_FIRST_KEY, NetworkType.VLAN_LAST_KEY);\n+                this.vlanRangeRepository.createRange(request);\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {\n+                rangeId = entry.getKey();\n+            }\n+\n+            Long key = this.vlanRangeRepository.allocateVlanKey(rangeId);\n+\n+            //vlan.setMtu(mtu);\n+            vlan.setSegmentId(segmentId);\n+            vlan.setVlanId(vlanId);\n+            vlan.setKey(key);\n+\n+            this.vlanRepository.addItem(vlan);\n+            logger.info(\"Allocate vlan key success, key: \" + key);\n+            return key;\n+        } catch (Exception e) {\n+            this.vlanRepository.deleteItem(vlanId);\n+            logger.info(\"Allocate vlan key failed\");\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+\n+    }\n+\n+    @Override\n+    public Long addVxlanEntity(String segmentId) throws DatabasePersistenceException {\n+        try {\n+            String vxlanId = UUID.randomUUID().toString();\n+            NetworkVxlanType vxlan = new NetworkVxlanType();\n+            //vxlan.setMtu(mtu);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMTU1NA=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjI2MTUzOnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzo0NTo1NlrOGRtVoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzozNzo1MVrOGSX3Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMTc5Mg==", "bodyText": "Response should be \"VlanKeyResponse\", right?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421221792", "createdAt": "2020-05-07T03:45:56Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "diffHunk": "@@ -0,0 +1,254 @@\n+package com.futurewei.alcor.vpcmanager.service.Impl;\n+\n+import com.futurewei.alcor.common.constants.NetworkType;\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.NetworkTypeInvalidException;\n+import com.futurewei.alcor.common.exception.VlanRangeNotFoundException;\n+import com.futurewei.alcor.vpcmanager.dao.GreRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRangeRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VxlanRepository;\n+import com.futurewei.alcor.vpcmanager.service.SegmentService;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+@Service\n+public class SegmentServiceImpl implements SegmentService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private VlanRangeRepository vlanRangeRepository;\n+\n+    @Autowired\n+    private VlanRepository vlanRepository;\n+\n+    @Autowired\n+    private VxlanRepository vxlanRepository;\n+\n+    @Autowired\n+    private GreRepository greRepository;\n+\n+    @Override\n+    public Long addVlanEntity(String segmentId, String vlanId, String networkType) throws DatabasePersistenceException, CacheException {\n+        try {\n+            NetworkVlanType vlan = new NetworkVlanType();\n+            // check if range exist in db\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                String rangeId = UUID.randomUUID().toString();\n+                NetworkVlanRangeRequest request = new NetworkVlanRangeRequest(rangeId, segmentId, networkType, NetworkType.VLAN_FIRST_KEY, NetworkType.VLAN_LAST_KEY);\n+                this.vlanRangeRepository.createRange(request);\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {\n+                rangeId = entry.getKey();\n+            }\n+\n+            Long key = this.vlanRangeRepository.allocateVlanKey(rangeId);\n+\n+            //vlan.setMtu(mtu);\n+            vlan.setSegmentId(segmentId);\n+            vlan.setVlanId(vlanId);\n+            vlan.setKey(key);\n+\n+            this.vlanRepository.addItem(vlan);\n+            logger.info(\"Allocate vlan key success, key: \" + key);\n+            return key;\n+        } catch (Exception e) {\n+            this.vlanRepository.deleteItem(vlanId);\n+            logger.info(\"Allocate vlan key failed\");\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+\n+    }\n+\n+    @Override\n+    public Long addVxlanEntity(String segmentId) throws DatabasePersistenceException {\n+        try {\n+            String vxlanId = UUID.randomUUID().toString();\n+            NetworkVxlanType vxlan = new NetworkVxlanType();\n+            //vxlan.setMtu(mtu);\n+            vxlan.setSegmentId(segmentId);\n+            vxlan.setVxlanId(vxlanId);\n+\n+            this.vxlanRepository.addItem(vxlan);\n+            return null;\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public Long addGreEntity(String segmentId) throws DatabasePersistenceException {\n+        try {\n+            String greId = UUID.randomUUID().toString();\n+            NetworkVGREType gre = new NetworkVGREType();\n+            gre.setSegmentId(segmentId);\n+            gre.setGreId(greId);\n+\n+            this.greRepository.addItem(gre);\n+            return null;\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public void releaseVlanEntity(String vlanId, Long key) throws DatabasePersistenceException {\n+        try {\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                // TO DO: throw exception\n+                return;\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {\n+                rangeId = entry.getKey();\n+            }\n+\n+            this.vlanRangeRepository.releaseVlanKey(rangeId, key);\n+            this.vlanRepository.deleteItem(vlanId);\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public VlanKeyRequest allocateVlan(VlanKeyRequest request) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxODU0Ng==", "bodyText": "Yeah ~ althought VlanKeyResponse is same as VlanKeyRequest here", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421918546", "createdAt": "2020-05-08T03:37:51Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "diffHunk": "@@ -0,0 +1,254 @@\n+package com.futurewei.alcor.vpcmanager.service.Impl;\n+\n+import com.futurewei.alcor.common.constants.NetworkType;\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.NetworkTypeInvalidException;\n+import com.futurewei.alcor.common.exception.VlanRangeNotFoundException;\n+import com.futurewei.alcor.vpcmanager.dao.GreRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRangeRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VxlanRepository;\n+import com.futurewei.alcor.vpcmanager.service.SegmentService;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+@Service\n+public class SegmentServiceImpl implements SegmentService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private VlanRangeRepository vlanRangeRepository;\n+\n+    @Autowired\n+    private VlanRepository vlanRepository;\n+\n+    @Autowired\n+    private VxlanRepository vxlanRepository;\n+\n+    @Autowired\n+    private GreRepository greRepository;\n+\n+    @Override\n+    public Long addVlanEntity(String segmentId, String vlanId, String networkType) throws DatabasePersistenceException, CacheException {\n+        try {\n+            NetworkVlanType vlan = new NetworkVlanType();\n+            // check if range exist in db\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                String rangeId = UUID.randomUUID().toString();\n+                NetworkVlanRangeRequest request = new NetworkVlanRangeRequest(rangeId, segmentId, networkType, NetworkType.VLAN_FIRST_KEY, NetworkType.VLAN_LAST_KEY);\n+                this.vlanRangeRepository.createRange(request);\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {\n+                rangeId = entry.getKey();\n+            }\n+\n+            Long key = this.vlanRangeRepository.allocateVlanKey(rangeId);\n+\n+            //vlan.setMtu(mtu);\n+            vlan.setSegmentId(segmentId);\n+            vlan.setVlanId(vlanId);\n+            vlan.setKey(key);\n+\n+            this.vlanRepository.addItem(vlan);\n+            logger.info(\"Allocate vlan key success, key: \" + key);\n+            return key;\n+        } catch (Exception e) {\n+            this.vlanRepository.deleteItem(vlanId);\n+            logger.info(\"Allocate vlan key failed\");\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+\n+    }\n+\n+    @Override\n+    public Long addVxlanEntity(String segmentId) throws DatabasePersistenceException {\n+        try {\n+            String vxlanId = UUID.randomUUID().toString();\n+            NetworkVxlanType vxlan = new NetworkVxlanType();\n+            //vxlan.setMtu(mtu);\n+            vxlan.setSegmentId(segmentId);\n+            vxlan.setVxlanId(vxlanId);\n+\n+            this.vxlanRepository.addItem(vxlan);\n+            return null;\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public Long addGreEntity(String segmentId) throws DatabasePersistenceException {\n+        try {\n+            String greId = UUID.randomUUID().toString();\n+            NetworkVGREType gre = new NetworkVGREType();\n+            gre.setSegmentId(segmentId);\n+            gre.setGreId(greId);\n+\n+            this.greRepository.addItem(gre);\n+            return null;\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public void releaseVlanEntity(String vlanId, Long key) throws DatabasePersistenceException {\n+        try {\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                // TO DO: throw exception\n+                return;\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {\n+                rangeId = entry.getKey();\n+            }\n+\n+            this.vlanRangeRepository.releaseVlanKey(rangeId, key);\n+            this.vlanRepository.deleteItem(vlanId);\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public VlanKeyRequest allocateVlan(VlanKeyRequest request) throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMTc5Mg=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 130}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjI2NDU3OnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzo0Nzo0OVrOGRtXWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzozNDo1NlrOGSX07Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMjIzMw==", "bodyText": "Either rename the method to GetVlanRange, or change the response type to a more generic name like NetworkSegmentRange etc..", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421222233", "createdAt": "2020-05-07T03:47:49Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "diffHunk": "@@ -0,0 +1,254 @@\n+package com.futurewei.alcor.vpcmanager.service.Impl;\n+\n+import com.futurewei.alcor.common.constants.NetworkType;\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.NetworkTypeInvalidException;\n+import com.futurewei.alcor.common.exception.VlanRangeNotFoundException;\n+import com.futurewei.alcor.vpcmanager.dao.GreRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRangeRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VxlanRepository;\n+import com.futurewei.alcor.vpcmanager.service.SegmentService;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+@Service\n+public class SegmentServiceImpl implements SegmentService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private VlanRangeRepository vlanRangeRepository;\n+\n+    @Autowired\n+    private VlanRepository vlanRepository;\n+\n+    @Autowired\n+    private VxlanRepository vxlanRepository;\n+\n+    @Autowired\n+    private GreRepository greRepository;\n+\n+    @Override\n+    public Long addVlanEntity(String segmentId, String vlanId, String networkType) throws DatabasePersistenceException, CacheException {\n+        try {\n+            NetworkVlanType vlan = new NetworkVlanType();\n+            // check if range exist in db\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                String rangeId = UUID.randomUUID().toString();\n+                NetworkVlanRangeRequest request = new NetworkVlanRangeRequest(rangeId, segmentId, networkType, NetworkType.VLAN_FIRST_KEY, NetworkType.VLAN_LAST_KEY);\n+                this.vlanRangeRepository.createRange(request);\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {\n+                rangeId = entry.getKey();\n+            }\n+\n+            Long key = this.vlanRangeRepository.allocateVlanKey(rangeId);\n+\n+            //vlan.setMtu(mtu);\n+            vlan.setSegmentId(segmentId);\n+            vlan.setVlanId(vlanId);\n+            vlan.setKey(key);\n+\n+            this.vlanRepository.addItem(vlan);\n+            logger.info(\"Allocate vlan key success, key: \" + key);\n+            return key;\n+        } catch (Exception e) {\n+            this.vlanRepository.deleteItem(vlanId);\n+            logger.info(\"Allocate vlan key failed\");\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+\n+    }\n+\n+    @Override\n+    public Long addVxlanEntity(String segmentId) throws DatabasePersistenceException {\n+        try {\n+            String vxlanId = UUID.randomUUID().toString();\n+            NetworkVxlanType vxlan = new NetworkVxlanType();\n+            //vxlan.setMtu(mtu);\n+            vxlan.setSegmentId(segmentId);\n+            vxlan.setVxlanId(vxlanId);\n+\n+            this.vxlanRepository.addItem(vxlan);\n+            return null;\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public Long addGreEntity(String segmentId) throws DatabasePersistenceException {\n+        try {\n+            String greId = UUID.randomUUID().toString();\n+            NetworkVGREType gre = new NetworkVGREType();\n+            gre.setSegmentId(segmentId);\n+            gre.setGreId(greId);\n+\n+            this.greRepository.addItem(gre);\n+            return null;\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public void releaseVlanEntity(String vlanId, Long key) throws DatabasePersistenceException {\n+        try {\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                // TO DO: throw exception\n+                return;\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {\n+                rangeId = entry.getKey();\n+            }\n+\n+            this.vlanRangeRepository.releaseVlanKey(rangeId, key);\n+            this.vlanRepository.deleteItem(vlanId);\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public VlanKeyRequest allocateVlan(VlanKeyRequest request) throws Exception {\n+        logger.debug(\"Allocate vlan key, request: {}\", request);\n+\n+        Long key = vlanRangeRepository.allocateVlanKey(request.getRangeId());\n+\n+        request.setKey(key);\n+\n+        logger.info(\"Allocate vlan key success, request: {}\", request);\n+\n+        return request;\n+    }\n+\n+    @Override\n+    public VlanKeyRequest releaseVlan(String networkType, String rangeId, Long key) throws Exception {\n+        logger.debug(\"Release vlan key, ipAddr: {}\", key);\n+\n+        vlanRangeRepository.releaseVlanKey(rangeId, key);\n+\n+        VlanKeyRequest result = new VlanKeyRequest();\n+        result.setNetworkType(networkType);\n+        result.setRangeId(rangeId);\n+        result.setKey(key);\n+\n+        logger.info(\"Release vlan key success, result: {}\", result);\n+\n+        return result;\n+    }\n+\n+    @Override\n+    public VlanKeyRequest getVlan(String networkType, String rangeId, Long key) throws Exception {\n+        logger.debug(\"Get vlan key, rangeId: {}, ipAddr: {}\", rangeId, key);\n+\n+        VlanKeyAlloc vlanKeyAlloc = vlanRangeRepository.getVlanKeyAlloc(rangeId, key);\n+        if (vlanKeyAlloc.getNetworkType() != networkType) {\n+            throw new NetworkTypeInvalidException();\n+        }\n+\n+        VlanKeyRequest result = new VlanKeyRequest();\n+\n+        result.setNetworkType(vlanKeyAlloc.getNetworkType());\n+        result.setRangeId(vlanKeyAlloc.getRangeId());\n+        result.setKey(vlanKeyAlloc.getKey());\n+\n+        logger.info(\"Get vlan key success, result: {}\", result);\n+\n+        return result;\n+    }\n+\n+    @Override\n+    public NetworkVlanRangeRequest createRange(NetworkVlanRangeRequest request) throws Exception {\n+        logger.debug(\"Create vlan range, request: {}\", request);\n+\n+        vlanRangeRepository.createRange(request);\n+\n+        logger.info(\"Create vlan range success, request: {}\", request);\n+\n+        return request;\n+    }\n+\n+    @Override\n+    public NetworkVlanRangeRequest deleteRange(String rangeId) throws Exception {\n+        logger.debug(\"Delete vlan range, rangeId: {}\", rangeId);\n+\n+        NetworkVlanRange networkVlanRange = vlanRangeRepository.deleteRange(rangeId);\n+\n+        NetworkVlanRangeRequest request = new NetworkVlanRangeRequest();\n+        request.setId(networkVlanRange.getId());\n+        request.setSegmentId(networkVlanRange.getSegmentId());\n+        request.setNetworkType(networkVlanRange.getNetworkType());\n+        request.setFirstKey(networkVlanRange.getFirstKey());\n+        request.setLastKey(networkVlanRange.getLastKey());\n+        request.setUsedKeys(networkVlanRange.getUsedKeys());\n+        request.setTotalKeys(networkVlanRange.getTotalKeys());\n+\n+        logger.info(\"Delete vlan range success, request: {}\", request);\n+\n+        return request;\n+    }\n+\n+    @Override\n+    public NetworkVlanRangeRequest getRange(String rangeId) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 210}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNzkzMw==", "bodyText": "Okay ~ you are right", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421917933", "createdAt": "2020-05-08T03:34:56Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/Impl/SegmentServiceImpl.java", "diffHunk": "@@ -0,0 +1,254 @@\n+package com.futurewei.alcor.vpcmanager.service.Impl;\n+\n+import com.futurewei.alcor.common.constants.NetworkType;\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.common.exception.NetworkTypeInvalidException;\n+import com.futurewei.alcor.common.exception.VlanRangeNotFoundException;\n+import com.futurewei.alcor.vpcmanager.dao.GreRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRangeRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VlanRepository;\n+import com.futurewei.alcor.vpcmanager.dao.VxlanRepository;\n+import com.futurewei.alcor.vpcmanager.service.SegmentService;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+@Service\n+public class SegmentServiceImpl implements SegmentService {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private VlanRangeRepository vlanRangeRepository;\n+\n+    @Autowired\n+    private VlanRepository vlanRepository;\n+\n+    @Autowired\n+    private VxlanRepository vxlanRepository;\n+\n+    @Autowired\n+    private GreRepository greRepository;\n+\n+    @Override\n+    public Long addVlanEntity(String segmentId, String vlanId, String networkType) throws DatabasePersistenceException, CacheException {\n+        try {\n+            NetworkVlanType vlan = new NetworkVlanType();\n+            // check if range exist in db\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                String rangeId = UUID.randomUUID().toString();\n+                NetworkVlanRangeRequest request = new NetworkVlanRangeRequest(rangeId, segmentId, networkType, NetworkType.VLAN_FIRST_KEY, NetworkType.VLAN_LAST_KEY);\n+                this.vlanRangeRepository.createRange(request);\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {\n+                rangeId = entry.getKey();\n+            }\n+\n+            Long key = this.vlanRangeRepository.allocateVlanKey(rangeId);\n+\n+            //vlan.setMtu(mtu);\n+            vlan.setSegmentId(segmentId);\n+            vlan.setVlanId(vlanId);\n+            vlan.setKey(key);\n+\n+            this.vlanRepository.addItem(vlan);\n+            logger.info(\"Allocate vlan key success, key: \" + key);\n+            return key;\n+        } catch (Exception e) {\n+            this.vlanRepository.deleteItem(vlanId);\n+            logger.info(\"Allocate vlan key failed\");\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+\n+    }\n+\n+    @Override\n+    public Long addVxlanEntity(String segmentId) throws DatabasePersistenceException {\n+        try {\n+            String vxlanId = UUID.randomUUID().toString();\n+            NetworkVxlanType vxlan = new NetworkVxlanType();\n+            //vxlan.setMtu(mtu);\n+            vxlan.setSegmentId(segmentId);\n+            vxlan.setVxlanId(vxlanId);\n+\n+            this.vxlanRepository.addItem(vxlan);\n+            return null;\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public Long addGreEntity(String segmentId) throws DatabasePersistenceException {\n+        try {\n+            String greId = UUID.randomUUID().toString();\n+            NetworkVGREType gre = new NetworkVGREType();\n+            gre.setSegmentId(segmentId);\n+            gre.setGreId(greId);\n+\n+            this.greRepository.addItem(gre);\n+            return null;\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public void releaseVlanEntity(String vlanId, Long key) throws DatabasePersistenceException {\n+        try {\n+            Map<String, NetworkVlanRange> map = this.vlanRangeRepository.findAllItems();\n+            if (map.size() == 0) {\n+                // TO DO: throw exception\n+                return;\n+            }\n+\n+            String rangeId = \"\";\n+            for (Map.Entry<String, NetworkVlanRange> entry : map.entrySet()) {\n+                rangeId = entry.getKey();\n+            }\n+\n+            this.vlanRangeRepository.releaseVlanKey(rangeId, key);\n+            this.vlanRepository.deleteItem(vlanId);\n+        } catch (Exception e) {\n+            throw new DatabasePersistenceException(e.getMessage());\n+        }\n+    }\n+\n+    @Override\n+    public VlanKeyRequest allocateVlan(VlanKeyRequest request) throws Exception {\n+        logger.debug(\"Allocate vlan key, request: {}\", request);\n+\n+        Long key = vlanRangeRepository.allocateVlanKey(request.getRangeId());\n+\n+        request.setKey(key);\n+\n+        logger.info(\"Allocate vlan key success, request: {}\", request);\n+\n+        return request;\n+    }\n+\n+    @Override\n+    public VlanKeyRequest releaseVlan(String networkType, String rangeId, Long key) throws Exception {\n+        logger.debug(\"Release vlan key, ipAddr: {}\", key);\n+\n+        vlanRangeRepository.releaseVlanKey(rangeId, key);\n+\n+        VlanKeyRequest result = new VlanKeyRequest();\n+        result.setNetworkType(networkType);\n+        result.setRangeId(rangeId);\n+        result.setKey(key);\n+\n+        logger.info(\"Release vlan key success, result: {}\", result);\n+\n+        return result;\n+    }\n+\n+    @Override\n+    public VlanKeyRequest getVlan(String networkType, String rangeId, Long key) throws Exception {\n+        logger.debug(\"Get vlan key, rangeId: {}, ipAddr: {}\", rangeId, key);\n+\n+        VlanKeyAlloc vlanKeyAlloc = vlanRangeRepository.getVlanKeyAlloc(rangeId, key);\n+        if (vlanKeyAlloc.getNetworkType() != networkType) {\n+            throw new NetworkTypeInvalidException();\n+        }\n+\n+        VlanKeyRequest result = new VlanKeyRequest();\n+\n+        result.setNetworkType(vlanKeyAlloc.getNetworkType());\n+        result.setRangeId(vlanKeyAlloc.getRangeId());\n+        result.setKey(vlanKeyAlloc.getKey());\n+\n+        logger.info(\"Get vlan key success, result: {}\", result);\n+\n+        return result;\n+    }\n+\n+    @Override\n+    public NetworkVlanRangeRequest createRange(NetworkVlanRangeRequest request) throws Exception {\n+        logger.debug(\"Create vlan range, request: {}\", request);\n+\n+        vlanRangeRepository.createRange(request);\n+\n+        logger.info(\"Create vlan range success, request: {}\", request);\n+\n+        return request;\n+    }\n+\n+    @Override\n+    public NetworkVlanRangeRequest deleteRange(String rangeId) throws Exception {\n+        logger.debug(\"Delete vlan range, rangeId: {}\", rangeId);\n+\n+        NetworkVlanRange networkVlanRange = vlanRangeRepository.deleteRange(rangeId);\n+\n+        NetworkVlanRangeRequest request = new NetworkVlanRangeRequest();\n+        request.setId(networkVlanRange.getId());\n+        request.setSegmentId(networkVlanRange.getSegmentId());\n+        request.setNetworkType(networkVlanRange.getNetworkType());\n+        request.setFirstKey(networkVlanRange.getFirstKey());\n+        request.setLastKey(networkVlanRange.getLastKey());\n+        request.setUsedKeys(networkVlanRange.getUsedKeys());\n+        request.setTotalKeys(networkVlanRange.getTotalKeys());\n+\n+        logger.info(\"Delete vlan range success, request: {}\", request);\n+\n+        return request;\n+    }\n+\n+    @Override\n+    public NetworkVlanRangeRequest getRange(String rangeId) throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMjIzMw=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 210}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjI2OTcwOnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/SegmentService.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzo1MDoxNVrOGRtaEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNzozNTo0OVrOGUlCTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMjkzMQ==", "bodyText": "Ideally, the Segment Service could have a generic method name like addEntity(segmentId, segmentationId, networkType) so that it could have different implementation for various network types.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421222931", "createdAt": "2020-05-07T03:50:15Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/SegmentService.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.futurewei.alcor.vpcmanager.service;\n+\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.web.entity.NetworkVlanRangeRequest;\n+import com.futurewei.alcor.web.entity.VlanKeyRequest;\n+\n+import java.util.List;\n+\n+public interface SegmentService {\n+\n+    public Long addVlanEntity (String segmentId, String vlanId, String networkType) throws DatabasePersistenceException, CacheException;\n+    public Long addVxlanEntity (String segmentId) throws DatabasePersistenceException;\n+    public Long addGreEntity (String segmentId) throws DatabasePersistenceException;\n+    public void releaseVlanEntity (String vlanId, Long key) throws DatabasePersistenceException;\n+    public VlanKeyRequest allocateVlan(VlanKeyRequest request) throws Exception;\n+    public VlanKeyRequest releaseVlan(String networkType, String rangeId, Long key) throws Exception;\n+    public VlanKeyRequest getVlan(String networkType, String rangeId, Long key) throws Exception;\n+    public NetworkVlanRangeRequest createRange(NetworkVlanRangeRequest request) throws Exception;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNzQ1Mg==", "bodyText": "Yeah it looks better in structure ~ but if we have that in SegmentService, we maybe not implement three different implementations in SegmentServiceImpl", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421917452", "createdAt": "2020-05-08T03:32:59Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/SegmentService.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.futurewei.alcor.vpcmanager.service;\n+\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.web.entity.NetworkVlanRangeRequest;\n+import com.futurewei.alcor.web.entity.VlanKeyRequest;\n+\n+import java.util.List;\n+\n+public interface SegmentService {\n+\n+    public Long addVlanEntity (String segmentId, String vlanId, String networkType) throws DatabasePersistenceException, CacheException;\n+    public Long addVxlanEntity (String segmentId) throws DatabasePersistenceException;\n+    public Long addGreEntity (String segmentId) throws DatabasePersistenceException;\n+    public void releaseVlanEntity (String vlanId, Long key) throws DatabasePersistenceException;\n+    public VlanKeyRequest allocateVlan(VlanKeyRequest request) throws Exception;\n+    public VlanKeyRequest releaseVlan(String networkType, String rangeId, Long key) throws Exception;\n+    public VlanKeyRequest getVlan(String networkType, String rangeId, Long key) throws Exception;\n+    public NetworkVlanRangeRequest createRange(NetworkVlanRangeRequest request) throws Exception;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMjkzMQ=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIzMTUwMg==", "bodyText": "Three implementation would look fantastic. why not? :-)", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424231502", "createdAt": "2020-05-13T07:35:49Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/SegmentService.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.futurewei.alcor.vpcmanager.service;\n+\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.web.entity.NetworkVlanRangeRequest;\n+import com.futurewei.alcor.web.entity.VlanKeyRequest;\n+\n+import java.util.List;\n+\n+public interface SegmentService {\n+\n+    public Long addVlanEntity (String segmentId, String vlanId, String networkType) throws DatabasePersistenceException, CacheException;\n+    public Long addVxlanEntity (String segmentId) throws DatabasePersistenceException;\n+    public Long addGreEntity (String segmentId) throws DatabasePersistenceException;\n+    public void releaseVlanEntity (String vlanId, Long key) throws DatabasePersistenceException;\n+    public VlanKeyRequest allocateVlan(VlanKeyRequest request) throws Exception;\n+    public VlanKeyRequest releaseVlan(String networkType, String rangeId, Long key) throws Exception;\n+    public VlanKeyRequest getVlan(String networkType, String rangeId, Long key) throws Exception;\n+    public NetworkVlanRangeRequest createRange(NetworkVlanRangeRequest request) throws Exception;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMjkzMQ=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjI3Mjc5OnYy", "diffSide": "RIGHT", "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVlanRange.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzo1MjoxN1rOGRtb2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNToxMDo0NlrOGUhpLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzM4Ng==", "bodyText": "Should a VlanRange be associated with a segment id?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421223386", "createdAt": "2020-05-07T03:52:17Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVlanRange.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.futurewei.alcor.common.enumClass.NetworkTypeEnum;\n+import com.futurewei.alcor.common.exception.KeyInvalidException;\n+import com.futurewei.alcor.common.exception.VlanKeyAllocNotFoundException;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import lombok.Data;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@Data\n+public class NetworkVlanRange {\n+\n+    private String id;\n+    private String segmentId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNjYxMg==", "bodyText": "I see it in the resource that \"If there are different tenants and different private networks are created, in order to isolate packets on the data network, you need to specify segmentid when creating the private network\"", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421916612", "createdAt": "2020-05-08T03:29:27Z", "author": {"login": "kevin-zhonghao"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVlanRange.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.futurewei.alcor.common.enumClass.NetworkTypeEnum;\n+import com.futurewei.alcor.common.exception.KeyInvalidException;\n+import com.futurewei.alcor.common.exception.VlanKeyAllocNotFoundException;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import lombok.Data;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@Data\n+public class NetworkVlanRange {\n+\n+    private String id;\n+    private String segmentId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzM4Ng=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NjczMg==", "bodyText": "yes but NetworkVlanRange is about the range of Vlan Segmentation Id, right? Let us discuss on these.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424166732", "createdAt": "2020-05-13T04:32:33Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVlanRange.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.futurewei.alcor.common.enumClass.NetworkTypeEnum;\n+import com.futurewei.alcor.common.exception.KeyInvalidException;\n+import com.futurewei.alcor.common.exception.VlanKeyAllocNotFoundException;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import lombok.Data;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@Data\n+public class NetworkVlanRange {\n+\n+    private String id;\n+    private String segmentId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzM4Ng=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NTkxNg==", "bodyText": "I got the point. Actually the Range entity does not need segment Id, but network type entity does", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424175916", "createdAt": "2020-05-13T05:10:46Z", "author": {"login": "kevin-zhonghao"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVlanRange.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.futurewei.alcor.common.enumClass.NetworkTypeEnum;\n+import com.futurewei.alcor.common.exception.KeyInvalidException;\n+import com.futurewei.alcor.common.exception.VlanKeyAllocNotFoundException;\n+import com.futurewei.alcor.web.allocator.VlanKeyAllocator;\n+import lombok.Data;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@Data\n+public class NetworkVlanRange {\n+\n+    private String id;\n+    private String segmentId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzM4Ng=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjI3MzI2OnYy", "diffSide": "RIGHT", "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVlanRangeRequest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzo1Mjo0MlrOGRtcKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMjowNTo0OVrOGUapVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzQ2Nw==", "bodyText": "Split it to NetworkValanRangeRequest and Response", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421223467", "createdAt": "2020-05-07T03:52:42Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVlanRangeRequest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Data;\n+\n+@Data\n+public class NetworkVlanRangeRequest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNTQ4OQ==", "bodyText": "Now I make it as NetworkRangeRequest. All network type use the same range request class", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421915489", "createdAt": "2020-05-08T03:25:04Z", "author": {"login": "kevin-zhonghao"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVlanRangeRequest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Data;\n+\n+@Data\n+public class NetworkVlanRangeRequest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzQ2Nw=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA2MTI2OA==", "bodyText": "Cool thanks for making this change.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424061268", "createdAt": "2020-05-12T22:05:49Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVlanRangeRequest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Data;\n+\n+@Data\n+public class NetworkVlanRangeRequest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzQ2Nw=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjI3NDQ2OnYy", "diffSide": "RIGHT", "path": "web/src/main/java/com/futurewei/alcor/web/entity/SegmentWebResponseObject.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzo1MzozMVrOGRtc7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzoyMjowN1rOGSXoXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzY2MA==", "bodyText": "String \"segmentationUuid\" or \"segmentationUUID\"", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421223660", "createdAt": "2020-05-07T03:53:31Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/SegmentWebResponseObject.java", "diffHunk": "@@ -21,6 +21,9 @@\n     @JsonProperty(\"segmentation_id\")\n     private Integer segmentationId;\n \n+    @JsonProperty(\"segmentation_uuid\")\n+    private String segmentationUUId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNDcxOA==", "bodyText": "okay", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421914718", "createdAt": "2020-05-08T03:22:07Z", "author": {"login": "kevin-zhonghao"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/SegmentWebResponseObject.java", "diffHunk": "@@ -21,6 +21,9 @@\n     @JsonProperty(\"segmentation_id\")\n     private Integer segmentationId;\n \n+    @JsonProperty(\"segmentation_uuid\")\n+    private String segmentationUUId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzY2MA=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjI3NTUwOnYy", "diffSide": "RIGHT", "path": "web/src/main/java/com/futurewei/alcor/web/entity/VlanKeyAlloc.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzo1Mzo1OVrOGRtddw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMzoyMTozMFrOGSXn3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzc5OQ==", "bodyText": "Add License statement.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421223799", "createdAt": "2020-05-07T03:53:59Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/VlanKeyAlloc.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.futurewei.alcor.web.entity;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTkxNDU5MA==", "bodyText": "NP", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r421914590", "createdAt": "2020-05-08T03:21:30Z", "author": {"login": "kevin-zhonghao"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/VlanKeyAlloc.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.futurewei.alcor.web.entity;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzc5OQ=="}, "originalCommit": {"oid": "65306b72a412a33ceaf8668818b6d1261ef6f9f3"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTIzNzk1OnYy", "diffSide": "RIGHT", "path": "lib/src/main/java/com/futurewei/alcor/common/config/MockIgniteConfiguration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMjoyODoyOFrOGUfVnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNToxMzoxNVrOGUhrtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEzODE0MQ==", "bodyText": "I think we could remove it for now.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424138141", "createdAt": "2020-05-13T02:28:28Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/config/MockIgniteConfiguration.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.futurewei.alcor.common.config;\n+\n+import org.apache.ignite.Ignite;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.Ignition;\n+import org.apache.ignite.configuration.ClientConnectorConfiguration;\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+\n+public class MockIgniteConfiguration {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NjU2Ng==", "bodyText": "Sure", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424176566", "createdAt": "2020-05-13T05:13:15Z", "author": {"login": "kevin-zhonghao"}, "path": "lib/src/main/java/com/futurewei/alcor/common/config/MockIgniteConfiguration.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.futurewei.alcor.common.config;\n+\n+import org.apache.ignite.Ignite;\n+import org.apache.ignite.IgniteException;\n+import org.apache.ignite.Ignition;\n+import org.apache.ignite.configuration.ClientConnectorConfiguration;\n+import org.junit.AfterClass;\n+import org.junit.BeforeClass;\n+\n+public class MockIgniteConfiguration {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEzODE0MQ=="}, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTM4NTMwOnYy", "diffSide": "RIGHT", "path": "lib/src/main/java/com/futurewei/alcor/common/exception/NetworkKeyAllocNotFoundException.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDowODoxOVrOGUgwcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNToxNToyOVrOGUhuAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2MTM5Mw==", "bodyText": "Thanks for adding all these exceptions!\nDo you expect the same exceptions to be used by other services? If those are VPC manager specific, maybe we should move them to VpcManager?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424161393", "createdAt": "2020-05-13T04:08:19Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/exception/NetworkKeyAllocNotFoundException.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package com.futurewei.alcor.common.exception;\n+\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.ResponseStatus;\n+\n+@ResponseStatus(code= HttpStatus.NOT_FOUND, reason=\"Key allocation is not found\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NzE1NQ==", "bodyText": "Thanks Liguang ~ I am not sure if there are any other microservice creating vlan , vxlan or gre. Let's talk about it", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424177155", "createdAt": "2020-05-13T05:15:29Z", "author": {"login": "kevin-zhonghao"}, "path": "lib/src/main/java/com/futurewei/alcor/common/exception/NetworkKeyAllocNotFoundException.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package com.futurewei.alcor.common.exception;\n+\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.ResponseStatus;\n+\n+@ResponseStatus(code= HttpStatus.NOT_FOUND, reason=\"Key allocation is not found\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2MTM5Mw=="}, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTM4NjE4OnYy", "diffSide": "RIGHT", "path": "services/api_gateway/src/main/java/com/futurewei/alcor/apigateway/vpc/VpcWebConfiguration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDowOTowNlrOGUgxAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNToxNzo0N1rOGUhwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2MTUzOQ==", "bodyText": "Add POST and DELETE as well.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424161539", "createdAt": "2020-05-13T04:09:06Z", "author": {"login": "xieus"}, "path": "services/api_gateway/src/main/java/com/futurewei/alcor/apigateway/vpc/VpcWebConfiguration.java", "diffHunk": "@@ -36,6 +36,7 @@\n     public RouterFunction<ServerResponse> vpcHandlerRouting(VpcWebHandlers vpcWebHandlers) {\n         return\n                 route(GET(\"/project/{projectId}/vpcs/{vpcId}\"), vpcWebHandlers::getVpc)\n+                        .andRoute(GET(\"/project/{projectId}/network/{vpcId}\"), vpcWebHandlers::getVpc)\n                         .andRoute(POST(\"/project/{projectId}/vpcs\").and(accept(APPLICATION_JSON)).and(contentType(APPLICATION_JSON)), vpcWebHandlers::createVpc)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NzcxNg==", "bodyText": "NP", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424177716", "createdAt": "2020-05-13T05:17:47Z", "author": {"login": "kevin-zhonghao"}, "path": "services/api_gateway/src/main/java/com/futurewei/alcor/apigateway/vpc/VpcWebConfiguration.java", "diffHunk": "@@ -36,6 +36,7 @@\n     public RouterFunction<ServerResponse> vpcHandlerRouting(VpcWebHandlers vpcWebHandlers) {\n         return\n                 route(GET(\"/project/{projectId}/vpcs/{vpcId}\"), vpcWebHandlers::getVpc)\n+                        .andRoute(GET(\"/project/{projectId}/network/{vpcId}\"), vpcWebHandlers::getVpc)\n                         .andRoute(POST(\"/project/{projectId}/vpcs\").and(accept(APPLICATION_JSON)).and(contentType(APPLICATION_JSON)), vpcWebHandlers::createVpc)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2MTUzOQ=="}, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTQwMDA5OnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDoxODo1OVrOGUg5WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDoyMDo0OVrOGUg6_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2MzY3Mw==", "bodyText": "Usually DELETE is the reverse order of POST. Let us do this:\n(1) segmentDatabaseService.deleteSegment(segmentid);\n(2) segmentService.release VxLan/VLan/Gre entity.\nIf segmentService tries to release entity first and the process crashes before segmentDatabaseService.deleteSegment, the segmentation Id might be released already so will be allocated to other segment, which causes \"one key shared by two segments\" issue.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424163673", "createdAt": "2020-05-13T04:18:59Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "diffHunk": "@@ -0,0 +1,208 @@\n+package com.futurewei.alcor.vpcmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.enumClass.NetworkTypeEnum;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNullException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.vpcmanager.service.SegmentDatabaseService;\n+import com.futurewei.alcor.vpcmanager.service.SegmentService;\n+import com.futurewei.alcor.vpcmanager.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+public class SegmentController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private SegmentDatabaseService segmentDatabaseService;\n+\n+    @Autowired\n+    private SegmentService segmentService;\n+\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/segments/{segmentid}\", \"/v4/{projectid}/segments/{segmentid}\"})\n+    public SegmentWebResponseJson getSegmentBySegmentId(@PathVariable String projectid, @PathVariable String segmentid) throws Exception {\n+\n+        SegmentWebResponseObject segmentWebResponseObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(segmentid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            segmentWebResponseObject = this.segmentDatabaseService.getBySegmentId(segmentid);\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        }\n+\n+        if (segmentWebResponseObject == null) {\n+            return new SegmentWebResponseJson();\n+        }\n+\n+        return new SegmentWebResponseJson(segmentWebResponseObject);\n+\n+    }\n+\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/project/{projectid}/segments\", \"/v4/{projectid}/segments\"})\n+    @ResponseStatus(HttpStatus.CREATED)\n+    public SegmentWebResponseJson createSegment(@PathVariable String projectid, @RequestBody SegmentWebRequestJson resource) throws Exception {\n+\n+        SegmentWebResponseObject segmentWebResponseObject = new SegmentWebResponseObject();\n+        String networkTypeId = UUID.randomUUID().toString();\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            SegmentWebRequestObject segmentWebRequestObject = resource.getSegment();\n+            BeanUtils.copyProperties(segmentWebRequestObject, segmentWebResponseObject);\n+            RestPreconditionsUtil.verifyResourceNotNull(segmentWebResponseObject);\n+            RestPreconditionsUtil.populateResourceProjectId(segmentWebResponseObject, projectid);\n+\n+            // verify network type\n+            String networkType = segmentWebRequestObject.getNetworkType();\n+            Long key = null;\n+            if (NetworkTypeEnum.VXLAN.getNetworkType().equals(networkType)) {\n+                key = segmentService.addVxlanEntity(segmentWebRequestObject.getId(), networkTypeId, networkType, segmentWebRequestObject.getVpcId());\n+            } else if (NetworkTypeEnum.VLAN.getNetworkType().equals(networkType)) {\n+                key = segmentService.addVlanEntity(segmentWebRequestObject.getId(), networkTypeId, networkType, segmentWebRequestObject.getVpcId());\n+            }else if (NetworkTypeEnum.GRE.getNetworkType().equals(networkType)) {\n+                key = segmentService.addGreEntity(segmentWebRequestObject.getId(), networkTypeId, networkType, segmentWebRequestObject.getVpcId());\n+            }\n+\n+            if (key != null) {\n+                segmentWebResponseObject.setSegmentationId(Integer.parseInt(String.valueOf(key)));\n+            }\n+            segmentWebResponseObject.setSegmentationUUID(networkTypeId);\n+\n+            this.segmentDatabaseService.addSegment(segmentWebResponseObject);\n+\n+            segmentWebResponseObject = this.segmentDatabaseService.getBySegmentId(segmentWebResponseObject.getId());\n+            if (segmentWebResponseObject == null) {\n+                throw new ResourcePersistenceException();\n+            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        } catch (ResourceNullException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new SegmentWebResponseJson(segmentWebResponseObject);\n+\n+    }\n+\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/segments/{segmentid}\", \"/v4/{projectid}/segments/{segmentid}\"})\n+    public SegmentWebResponseJson updateSegmentBySegmentId(@PathVariable String projectid, @PathVariable String segmentid, @RequestBody SegmentWebRequestJson resource) throws Exception {\n+\n+        SegmentWebResponseObject segmentWebResponseObject = new SegmentWebResponseObject();\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(segmentid);\n+            SegmentWebRequestObject segmentWebRequestObject = resource.getSegment();\n+            BeanUtils.copyProperties(segmentWebRequestObject, segmentWebResponseObject);\n+            RestPreconditionsUtil.verifyResourceNotNull(segmentWebResponseObject);\n+            RestPreconditionsUtil.populateResourceProjectId(segmentWebResponseObject, projectid);\n+            RestPreconditionsUtil.populateResourceSegmentId(segmentWebResponseObject, segmentid);\n+\n+            segmentWebResponseObject = this.segmentDatabaseService.getBySegmentId(segmentid);\n+            if (segmentWebResponseObject == null) {\n+                throw new ResourceNotFoundException(\"Segment not found : \" + segmentid);\n+            }\n+\n+            this.segmentDatabaseService.addSegment(segmentWebResponseObject);\n+\n+            segmentWebResponseObject = this.segmentDatabaseService.getBySegmentId(segmentid);\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new SegmentWebResponseJson(segmentWebResponseObject);\n+\n+    }\n+\n+    @RequestMapping(\n+            method = DELETE,\n+            value = {\"/project/{projectid}/segments/{segmentid}\", \"/v4/{projectid}/segments/{segmentid}\"})\n+    public ResponseId deleteSegmentBySegmentId(@PathVariable String projectid, @PathVariable String segmentid) throws Exception {\n+\n+        SegmentWebResponseObject segmentWebResponseObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(segmentid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            segmentWebResponseObject = this.segmentDatabaseService.getBySegmentId(segmentid);\n+            if (segmentWebResponseObject == null) {\n+                return new ResponseId();\n+            }\n+\n+            // Release Network Type\n+            String networkType = segmentWebResponseObject.getNetworkType();\n+            Long key = Long.parseLong(String.valueOf(segmentWebResponseObject.getSegmentationId()));\n+            if (NetworkTypeEnum.VXLAN.getNetworkType().equals(networkType)) {\n+                this.segmentService.releaseVxlanEntity(segmentWebResponseObject.getSegmentationUUID(), key);\n+            } else if (NetworkTypeEnum.VLAN.getNetworkType().equals(networkType)) {\n+                this.segmentService.releaseVlanEntity(segmentWebResponseObject.getSegmentationUUID(), key);\n+            }else if (NetworkTypeEnum.GRE.getNetworkType().equals(networkType)) {\n+                this.segmentService.releaseGreEntity(segmentWebResponseObject.getSegmentationUUID(), key);\n+            }\n+\n+            segmentDatabaseService.deleteSegment(segmentid);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 172}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NDA5NA==", "bodyText": "We might need to visit other Controller in VPC/subnet/Route to see if we hit the same issue elsewhere.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424164094", "createdAt": "2020-05-13T04:20:49Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/controller/SegmentController.java", "diffHunk": "@@ -0,0 +1,208 @@\n+package com.futurewei.alcor.vpcmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.enumClass.NetworkTypeEnum;\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.common.exception.ResourceNullException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.vpcmanager.service.SegmentDatabaseService;\n+import com.futurewei.alcor.vpcmanager.service.SegmentService;\n+import com.futurewei.alcor.vpcmanager.utils.RestPreconditionsUtil;\n+import com.futurewei.alcor.web.entity.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.BeanUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+public class SegmentController {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    @Autowired\n+    private SegmentDatabaseService segmentDatabaseService;\n+\n+    @Autowired\n+    private SegmentService segmentService;\n+\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/project/{projectid}/segments/{segmentid}\", \"/v4/{projectid}/segments/{segmentid}\"})\n+    public SegmentWebResponseJson getSegmentBySegmentId(@PathVariable String projectid, @PathVariable String segmentid) throws Exception {\n+\n+        SegmentWebResponseObject segmentWebResponseObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(segmentid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            segmentWebResponseObject = this.segmentDatabaseService.getBySegmentId(segmentid);\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        }\n+\n+        if (segmentWebResponseObject == null) {\n+            return new SegmentWebResponseJson();\n+        }\n+\n+        return new SegmentWebResponseJson(segmentWebResponseObject);\n+\n+    }\n+\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/project/{projectid}/segments\", \"/v4/{projectid}/segments\"})\n+    @ResponseStatus(HttpStatus.CREATED)\n+    public SegmentWebResponseJson createSegment(@PathVariable String projectid, @RequestBody SegmentWebRequestJson resource) throws Exception {\n+\n+        SegmentWebResponseObject segmentWebResponseObject = new SegmentWebResponseObject();\n+        String networkTypeId = UUID.randomUUID().toString();\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            SegmentWebRequestObject segmentWebRequestObject = resource.getSegment();\n+            BeanUtils.copyProperties(segmentWebRequestObject, segmentWebResponseObject);\n+            RestPreconditionsUtil.verifyResourceNotNull(segmentWebResponseObject);\n+            RestPreconditionsUtil.populateResourceProjectId(segmentWebResponseObject, projectid);\n+\n+            // verify network type\n+            String networkType = segmentWebRequestObject.getNetworkType();\n+            Long key = null;\n+            if (NetworkTypeEnum.VXLAN.getNetworkType().equals(networkType)) {\n+                key = segmentService.addVxlanEntity(segmentWebRequestObject.getId(), networkTypeId, networkType, segmentWebRequestObject.getVpcId());\n+            } else if (NetworkTypeEnum.VLAN.getNetworkType().equals(networkType)) {\n+                key = segmentService.addVlanEntity(segmentWebRequestObject.getId(), networkTypeId, networkType, segmentWebRequestObject.getVpcId());\n+            }else if (NetworkTypeEnum.GRE.getNetworkType().equals(networkType)) {\n+                key = segmentService.addGreEntity(segmentWebRequestObject.getId(), networkTypeId, networkType, segmentWebRequestObject.getVpcId());\n+            }\n+\n+            if (key != null) {\n+                segmentWebResponseObject.setSegmentationId(Integer.parseInt(String.valueOf(key)));\n+            }\n+            segmentWebResponseObject.setSegmentationUUID(networkTypeId);\n+\n+            this.segmentDatabaseService.addSegment(segmentWebResponseObject);\n+\n+            segmentWebResponseObject = this.segmentDatabaseService.getBySegmentId(segmentWebResponseObject.getId());\n+            if (segmentWebResponseObject == null) {\n+                throw new ResourcePersistenceException();\n+            }\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        } catch (ResourceNullException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new SegmentWebResponseJson(segmentWebResponseObject);\n+\n+    }\n+\n+    @RequestMapping(\n+            method = PUT,\n+            value = {\"/project/{projectid}/segments/{segmentid}\", \"/v4/{projectid}/segments/{segmentid}\"})\n+    public SegmentWebResponseJson updateSegmentBySegmentId(@PathVariable String projectid, @PathVariable String segmentid, @RequestBody SegmentWebRequestJson resource) throws Exception {\n+\n+        SegmentWebResponseObject segmentWebResponseObject = new SegmentWebResponseObject();\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(segmentid);\n+            SegmentWebRequestObject segmentWebRequestObject = resource.getSegment();\n+            BeanUtils.copyProperties(segmentWebRequestObject, segmentWebResponseObject);\n+            RestPreconditionsUtil.verifyResourceNotNull(segmentWebResponseObject);\n+            RestPreconditionsUtil.populateResourceProjectId(segmentWebResponseObject, projectid);\n+            RestPreconditionsUtil.populateResourceSegmentId(segmentWebResponseObject, segmentid);\n+\n+            segmentWebResponseObject = this.segmentDatabaseService.getBySegmentId(segmentid);\n+            if (segmentWebResponseObject == null) {\n+                throw new ResourceNotFoundException(\"Segment not found : \" + segmentid);\n+            }\n+\n+            this.segmentDatabaseService.addSegment(segmentWebResponseObject);\n+\n+            segmentWebResponseObject = this.segmentDatabaseService.getBySegmentId(segmentid);\n+\n+        } catch (ParameterNullOrEmptyException e) {\n+            throw new Exception(e);\n+        }\n+\n+        return new SegmentWebResponseJson(segmentWebResponseObject);\n+\n+    }\n+\n+    @RequestMapping(\n+            method = DELETE,\n+            value = {\"/project/{projectid}/segments/{segmentid}\", \"/v4/{projectid}/segments/{segmentid}\"})\n+    public ResponseId deleteSegmentBySegmentId(@PathVariable String projectid, @PathVariable String segmentid) throws Exception {\n+\n+        SegmentWebResponseObject segmentWebResponseObject = null;\n+\n+        try {\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(projectid);\n+            RestPreconditionsUtil.verifyParameterNotNullorEmpty(segmentid);\n+            RestPreconditionsUtil.verifyResourceFound(projectid);\n+\n+            segmentWebResponseObject = this.segmentDatabaseService.getBySegmentId(segmentid);\n+            if (segmentWebResponseObject == null) {\n+                return new ResponseId();\n+            }\n+\n+            // Release Network Type\n+            String networkType = segmentWebResponseObject.getNetworkType();\n+            Long key = Long.parseLong(String.valueOf(segmentWebResponseObject.getSegmentationId()));\n+            if (NetworkTypeEnum.VXLAN.getNetworkType().equals(networkType)) {\n+                this.segmentService.releaseVxlanEntity(segmentWebResponseObject.getSegmentationUUID(), key);\n+            } else if (NetworkTypeEnum.VLAN.getNetworkType().equals(networkType)) {\n+                this.segmentService.releaseVlanEntity(segmentWebResponseObject.getSegmentationUUID(), key);\n+            }else if (NetworkTypeEnum.GRE.getNetworkType().equals(networkType)) {\n+                this.segmentService.releaseGreEntity(segmentWebResponseObject.getSegmentationUUID(), key);\n+            }\n+\n+            segmentDatabaseService.deleteSegment(segmentid);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2MzY3Mw=="}, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 172}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTQwODMwOnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/dao/GreRangeRepository.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDoyNDoxN1rOGUg-Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNToyOToxOVrOGUh8qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NDkwNw==", "bodyText": "These comments are really good. Let us try to spread it elsewhere for important Controller and Service methods.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424164907", "createdAt": "2020-05-13T04:24:17Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/dao/GreRangeRepository.java", "diffHunk": "@@ -0,0 +1,211 @@\n+package com.futurewei.alcor.vpcmanager.dao;\n+\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.db.CacheFactory;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;\n+import com.futurewei.alcor.common.exception.*;\n+import com.futurewei.alcor.common.repo.ICacheRepository;\n+import com.futurewei.alcor.web.entity.KeyAlloc;\n+import com.futurewei.alcor.web.entity.NetworkGRERange;\n+\n+import com.futurewei.alcor.web.entity.NetworkRangeRequest;\n+import com.futurewei.alcor.web.entity.NetworkVxlanRange;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.annotation.PostConstruct;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@Repository\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+public class GreRangeRepository implements ICacheRepository<NetworkGRERange> {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    public ICache<String, NetworkGRERange> getCache() {\n+        return cache;\n+    }\n+\n+    private ICache<String, NetworkGRERange> cache;\n+\n+\n+    @Autowired\n+    public GreRangeRepository(CacheFactory cacheFactory) {\n+        cache = cacheFactory.getCache(NetworkGRERange.class);\n+    }\n+\n+    @PostConstruct\n+    private void init() {\n+        logger.info( \"GreRangeRepository init completed\");\n+    }\n+\n+\n+    @Override\n+    public NetworkGRERange findItem(String id) {\n+        try {\n+            return cache.get(id);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"GreRangeRepository findItem() exception:\", e);\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public Map<String, NetworkGRERange> findAllItems() {\n+        try {\n+            return cache.getAll();\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"GreRangeRepository findAllItems() exception:\", e);\n+        }\n+\n+        return new HashMap();\n+    }\n+\n+    @Override\n+    public void addItem(NetworkGRERange networkGRERange) {\n+        logger.error(\"Add networkGreRange:{}\", networkGRERange);\n+\n+        try {\n+            cache.put(networkGRERange.getId(), networkGRERange);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"GreRangeRepository addItem() exception:\", e);\n+        }\n+    }\n+\n+    @Override\n+    public void deleteItem(String id) {\n+        logger.error(\"Delete rangeId:{}\", id);\n+\n+        try {\n+            cache.remove(id);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"GreRangeRepository deleteItem() exception:\", e);\n+        }\n+    }\n+\n+    /**\n+     * Allocate a key from GreRange repository\n+     * @param rangeId\n+     * @return range key in db\n+     * @throws Exception Db operation or key assignment exception\n+     */\n+    public synchronized Long allocateGreKey (String rangeId) throws Exception {\n+        Long key;\n+\n+        try (Transaction tx = cache.getTransaction().start()) {\n+            NetworkGRERange networkGRERange = cache.get(rangeId);\n+            if (networkGRERange == null) {\n+                throw new RangeNotFoundException();\n+            }\n+\n+            key = networkGRERange.allocateKey();\n+            cache.put(networkGRERange.getId(), networkGRERange);\n+\n+            tx.commit();\n+        }\n+\n+        return key;\n+    }\n+\n+    /**\n+     * Release a key from GreRange repository\n+     * @param rangId\n+     * @param key\n+     * @throws Exception Range Not Found Exception\n+     */\n+    public synchronized void releaseGreKey(String rangId, Long key) throws Exception {\n+        try (Transaction tx = cache.getTransaction().start()) {\n+            NetworkGRERange networkGRERange = cache.get(rangId);\n+            if (networkGRERange == null) {\n+                throw new RangeNotFoundException();\n+            }\n+\n+            networkGRERange.release(key);\n+            cache.put(networkGRERange.getId(), networkGRERange);\n+\n+            tx.commit();\n+        }\n+    }\n+\n+    public synchronized KeyAlloc getGreKeyAlloc(String rangeId, Long key) throws Exception {\n+        NetworkGRERange networkGRERange = cache.get(rangeId);\n+        if (networkGRERange == null) {\n+            throw new RangeNotFoundException();\n+        }\n+\n+        return networkGRERange.getNetworkKey(key);\n+    }\n+\n+    /**\n+     * Create a range entity from range repo\n+     * @param request\n+     * @throws Exception Network Range Already Exist Exception\n+     * @throws Exception Internal Db Operation Exception\n+     */\n+    public synchronized void createRange(NetworkRangeRequest request) throws Exception {\n+        try (Transaction tx = cache.getTransaction().start()) {\n+            if (cache.get(request.getId()) != null) {\n+                logger.warn(\"Create network range failed: Network Range already exists\");\n+                throw new NetworkRangeExistException();\n+            }\n+\n+            NetworkGRERange range = new NetworkGRERange(request.getId(), request.getSegmentId(),\n+                    request.getNetworkType(), request.getPartition(), request.getFirstKey(), request.getLastKey());\n+\n+            cache.put(request.getId(), range);\n+\n+            range = cache.get(request.getId());\n+            if (range == null) {\n+                logger.warn(\"Create network range failed: Internal db operation error\");\n+                throw new InternalDbOperationException();\n+            }\n+\n+            request.setUsedKeys(range.getUsedKeys());\n+            request.setTotalKeys(range.getTotalKeys());\n+\n+            tx.commit();\n+        }\n+\n+    }\n+\n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 180}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE4MDkwNw==", "bodyText": "Sure", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424180907", "createdAt": "2020-05-13T05:29:19Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/dao/GreRangeRepository.java", "diffHunk": "@@ -0,0 +1,211 @@\n+package com.futurewei.alcor.vpcmanager.dao;\n+\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.db.CacheFactory;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;\n+import com.futurewei.alcor.common.exception.*;\n+import com.futurewei.alcor.common.repo.ICacheRepository;\n+import com.futurewei.alcor.web.entity.KeyAlloc;\n+import com.futurewei.alcor.web.entity.NetworkGRERange;\n+\n+import com.futurewei.alcor.web.entity.NetworkRangeRequest;\n+import com.futurewei.alcor.web.entity.NetworkVxlanRange;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.annotation.PostConstruct;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@Repository\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+public class GreRangeRepository implements ICacheRepository<NetworkGRERange> {\n+\n+    private Logger logger = LoggerFactory.getLogger(this.getClass());\n+\n+    public ICache<String, NetworkGRERange> getCache() {\n+        return cache;\n+    }\n+\n+    private ICache<String, NetworkGRERange> cache;\n+\n+\n+    @Autowired\n+    public GreRangeRepository(CacheFactory cacheFactory) {\n+        cache = cacheFactory.getCache(NetworkGRERange.class);\n+    }\n+\n+    @PostConstruct\n+    private void init() {\n+        logger.info( \"GreRangeRepository init completed\");\n+    }\n+\n+\n+    @Override\n+    public NetworkGRERange findItem(String id) {\n+        try {\n+            return cache.get(id);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"GreRangeRepository findItem() exception:\", e);\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public Map<String, NetworkGRERange> findAllItems() {\n+        try {\n+            return cache.getAll();\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"GreRangeRepository findAllItems() exception:\", e);\n+        }\n+\n+        return new HashMap();\n+    }\n+\n+    @Override\n+    public void addItem(NetworkGRERange networkGRERange) {\n+        logger.error(\"Add networkGreRange:{}\", networkGRERange);\n+\n+        try {\n+            cache.put(networkGRERange.getId(), networkGRERange);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"GreRangeRepository addItem() exception:\", e);\n+        }\n+    }\n+\n+    @Override\n+    public void deleteItem(String id) {\n+        logger.error(\"Delete rangeId:{}\", id);\n+\n+        try {\n+            cache.remove(id);\n+        } catch (CacheException e) {\n+            e.printStackTrace();\n+            logger.error(\"GreRangeRepository deleteItem() exception:\", e);\n+        }\n+    }\n+\n+    /**\n+     * Allocate a key from GreRange repository\n+     * @param rangeId\n+     * @return range key in db\n+     * @throws Exception Db operation or key assignment exception\n+     */\n+    public synchronized Long allocateGreKey (String rangeId) throws Exception {\n+        Long key;\n+\n+        try (Transaction tx = cache.getTransaction().start()) {\n+            NetworkGRERange networkGRERange = cache.get(rangeId);\n+            if (networkGRERange == null) {\n+                throw new RangeNotFoundException();\n+            }\n+\n+            key = networkGRERange.allocateKey();\n+            cache.put(networkGRERange.getId(), networkGRERange);\n+\n+            tx.commit();\n+        }\n+\n+        return key;\n+    }\n+\n+    /**\n+     * Release a key from GreRange repository\n+     * @param rangId\n+     * @param key\n+     * @throws Exception Range Not Found Exception\n+     */\n+    public synchronized void releaseGreKey(String rangId, Long key) throws Exception {\n+        try (Transaction tx = cache.getTransaction().start()) {\n+            NetworkGRERange networkGRERange = cache.get(rangId);\n+            if (networkGRERange == null) {\n+                throw new RangeNotFoundException();\n+            }\n+\n+            networkGRERange.release(key);\n+            cache.put(networkGRERange.getId(), networkGRERange);\n+\n+            tx.commit();\n+        }\n+    }\n+\n+    public synchronized KeyAlloc getGreKeyAlloc(String rangeId, Long key) throws Exception {\n+        NetworkGRERange networkGRERange = cache.get(rangeId);\n+        if (networkGRERange == null) {\n+            throw new RangeNotFoundException();\n+        }\n+\n+        return networkGRERange.getNetworkKey(key);\n+    }\n+\n+    /**\n+     * Create a range entity from range repo\n+     * @param request\n+     * @throws Exception Network Range Already Exist Exception\n+     * @throws Exception Internal Db Operation Exception\n+     */\n+    public synchronized void createRange(NetworkRangeRequest request) throws Exception {\n+        try (Transaction tx = cache.getTransaction().start()) {\n+            if (cache.get(request.getId()) != null) {\n+                logger.warn(\"Create network range failed: Network Range already exists\");\n+                throw new NetworkRangeExistException();\n+            }\n+\n+            NetworkGRERange range = new NetworkGRERange(request.getId(), request.getSegmentId(),\n+                    request.getNetworkType(), request.getPartition(), request.getFirstKey(), request.getLastKey());\n+\n+            cache.put(request.getId(), range);\n+\n+            range = cache.get(request.getId());\n+            if (range == null) {\n+                logger.warn(\"Create network range failed: Internal db operation error\");\n+                throw new InternalDbOperationException();\n+            }\n+\n+            request.setUsedKeys(range.getUsedKeys());\n+            request.setTotalKeys(range.getTotalKeys());\n+\n+            tx.commit();\n+        }\n+\n+    }\n+\n+    /**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NDkwNw=="}, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 180}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTQxNDc2OnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/SegmentDatabaseService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDoyOTowNlrOGUhCTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNToyNzo1MVrOGUh7AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NTk2NA==", "bodyText": "There is another service interface called \"SegmentService\" but it also deals with database access, right? In this case, we should use names that match what it is exactly?\nA renaming suggestion:\n(1) SegmentDatabaseService  => SegmentManagementService\n(2) SegmentService  => SegmentKeyManagementService", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424165964", "createdAt": "2020-05-13T04:29:06Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/SegmentDatabaseService.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.futurewei.alcor.vpcmanager.service;\n+\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.web.entity.SegmentWebResponseObject;\n+import com.futurewei.alcor.web.entity.VpcWebResponseObject;\n+\n+import java.util.Map;\n+\n+public interface SegmentDatabaseService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE4MDQ4MA==", "bodyText": "Let's talk about it", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424180480", "createdAt": "2020-05-13T05:27:51Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/service/SegmentDatabaseService.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.futurewei.alcor.vpcmanager.service;\n+\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.exception.DatabasePersistenceException;\n+import com.futurewei.alcor.web.entity.SegmentWebResponseObject;\n+import com.futurewei.alcor.web.entity.VpcWebResponseObject;\n+\n+import java.util.Map;\n+\n+public interface SegmentDatabaseService {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NTk2NA=="}, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTQxNjU5OnYy", "diffSide": "RIGHT", "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/utils/RestPreconditionsUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDozMDoyMVrOGUhDeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNToyNTo1OVrOGUh4mQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NjI2Ng==", "bodyText": "Try not use \"println\"", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424166266", "createdAt": "2020-05-13T04:30:21Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/utils/RestPreconditionsUtil.java", "diffHunk": "@@ -79,4 +81,32 @@ public static void populateResourceVpcId(CustomerResource resource, String vpcId\n             resource.setId(vpcId);\n         }\n     }\n+\n+    public static void populateResourceSegmentId(CustomerResource resource, String segmentId) {\n+        String resourceSegmentId = null;\n+        if (resource instanceof SegmentWebResponseObject) {\n+            resourceSegmentId = resource.getId();\n+        }\n+\n+        if (StringUtils.isEmpty(resourceSegmentId)) {\n+            resource.setId(segmentId);\n+        } else if (!resourceSegmentId.equalsIgnoreCase(segmentId)) {\n+            System.out.println(\"Resource segment id not matched \" + resourceSegmentId + \" : \" + segmentId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3OTg2NQ==", "bodyText": "I replace it with log info", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424179865", "createdAt": "2020-05-13T05:25:59Z", "author": {"login": "kevin-zhonghao"}, "path": "services/vpc_manager/src/main/java/com/futurewei/alcor/vpcmanager/utils/RestPreconditionsUtil.java", "diffHunk": "@@ -79,4 +81,32 @@ public static void populateResourceVpcId(CustomerResource resource, String vpcId\n             resource.setId(vpcId);\n         }\n     }\n+\n+    public static void populateResourceSegmentId(CustomerResource resource, String segmentId) {\n+        String resourceSegmentId = null;\n+        if (resource instanceof SegmentWebResponseObject) {\n+            resourceSegmentId = resource.getId();\n+        }\n+\n+        if (StringUtils.isEmpty(resourceSegmentId)) {\n+            resource.setId(segmentId);\n+        } else if (!resourceSegmentId.equalsIgnoreCase(segmentId)) {\n+            System.out.println(\"Resource segment id not matched \" + resourceSegmentId + \" : \" + segmentId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NjI2Ng=="}, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTQyMDkyOnYy", "diffSide": "RIGHT", "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVlanType.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDozMzo0MVrOGUhGPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDozMzo0MVrOGUhGPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2Njk3Mg==", "bodyText": "Could you comment the usage of 0 and 4095?", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424166972", "createdAt": "2020-05-13T04:33:41Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVlanType.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Data;\n+import org.springframework.data.annotation.CreatedDate;\n+import org.springframework.data.annotation.Id;\n+import org.springframework.data.annotation.LastModifiedDate;\n+\n+@Data\n+public class NetworkVlanType {\n+\n+    @Id\n+    private Long key; // 1 - 4094", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MTQyMTYxOnYy", "diffSide": "RIGHT", "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVxlanRange.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDozNDoyMFrOGUhGuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNToxOTowOFrOGUhxhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NzA5Nw==", "bodyText": "I think segmentId should be removed from NetworkVxlanRange as well.", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424167097", "createdAt": "2020-05-13T04:34:20Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVxlanRange.java", "diffHunk": "@@ -0,0 +1,75 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.futurewei.alcor.common.exception.KeyInvalidException;\n+import com.futurewei.alcor.common.exception.NetworkKeyAllocNotFoundException;\n+import com.futurewei.alcor.web.allocator.NetworkKeyAllocator;\n+import lombok.Data;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@Data\n+public class NetworkVxlanRange {\n+\n+    private String id;\n+    private String segmentId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3ODA1Mw==", "bodyText": "Yeah", "url": "https://github.com/futurewei-cloud/alcor/pull/181#discussion_r424178053", "createdAt": "2020-05-13T05:19:08Z", "author": {"login": "kevin-zhonghao"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/NetworkVxlanRange.java", "diffHunk": "@@ -0,0 +1,75 @@\n+package com.futurewei.alcor.web.entity;\n+\n+import com.futurewei.alcor.common.exception.KeyInvalidException;\n+import com.futurewei.alcor.common.exception.NetworkKeyAllocNotFoundException;\n+import com.futurewei.alcor.web.allocator.NetworkKeyAllocator;\n+import lombok.Data;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+@Data\n+public class NetworkVxlanRange {\n+\n+    private String id;\n+    private String segmentId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2NzA5Nw=="}, "originalCommit": {"oid": "66499cea9aa1af74c9d129b93daed6556bbf9ecb"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4733, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}