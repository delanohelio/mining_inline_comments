{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5ODAzMzk1", "number": 79, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNjozOToxM1rODWKaRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNjo1MTo1MlrODWKgyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NTY1ODI5OnYy", "diffSide": "RIGHT", "path": "src/com/futurewei/alcor/controller/app/AlcorControllerApp.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNjozOToxM1rOFaw8kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxODowNjowN1rOFbBUfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwOTIzMw==", "bodyText": "I wonder if it is better to do:\nimport com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.*;\nInstead of the below since all the three lines are from alcor:\nimport com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfigLoader;\nimport com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfig;\nimport com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.NodeManager;", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363609233", "createdAt": "2020-01-07T06:39:13Z", "author": {"login": "er1cthe0ne"}, "path": "src/com/futurewei/alcor/controller/app/AlcorControllerApp.java", "diffHunk": "@@ -23,7 +23,9 @@\n import com.futurewei.alcor.controller.app.onebox.OneBoxUtil;\n import com.futurewei.alcor.controller.cache.config.*;\n import com.futurewei.alcor.controller.model.HostInfo;\n-import com.futurewei.alcor.controller.resourcemgr.physical.DataCenterConfigLoader;\n+import com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfigLoader;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg3NzUwMg==", "bodyText": "nodemgmt is not a big package. Will update as suggested.", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363877502", "createdAt": "2020-01-07T18:06:07Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/app/AlcorControllerApp.java", "diffHunk": "@@ -23,7 +23,9 @@\n import com.futurewei.alcor.controller.app.onebox.OneBoxUtil;\n import com.futurewei.alcor.controller.cache.config.*;\n import com.futurewei.alcor.controller.model.HostInfo;\n-import com.futurewei.alcor.controller.resourcemgr.physical.DataCenterConfigLoader;\n+import com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfigLoader;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwOTIzMw=="}, "originalCommit": {"oid": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NTY2MDQ1OnYy", "diffSide": "RIGHT", "path": "src/com/futurewei/alcor/controller/app/onebox/OneBoxConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNjo0MDo1NFrOFaw96A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxODoxNjo1MVrOFbBlPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwOTU3Ng==", "bodyText": "would it be better to set IS_K8S and IS_Onebox to false as default and change it to true when needed?", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363609576", "createdAt": "2020-01-07T06:40:54Z", "author": {"login": "er1cthe0ne"}, "path": "src/com/futurewei/alcor/controller/app/onebox/OneBoxConfig.java", "diffHunk": "@@ -29,6 +29,7 @@\n \n public class OneBoxConfig {\n \n+    public static boolean IS_K8S = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg4MTc5MQ==", "bodyText": "True, but it doesn't quite matter if hard-coded.. Instead we should update controller config to set up those parameters actually which we will do in next PR.", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363881791", "createdAt": "2020-01-07T18:16:51Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/app/onebox/OneBoxConfig.java", "diffHunk": "@@ -29,6 +29,7 @@\n \n public class OneBoxConfig {\n \n+    public static boolean IS_K8S = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwOTU3Ng=="}, "originalCommit": {"oid": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NTY3MTcyOnYy", "diffSide": "RIGHT", "path": "src/com/futurewei/alcor/controller/utilities/Common.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNjo0OToyN1rOFaxEuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxODowOTo0N1rOFbBaAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMTMyMA==", "bodyText": "nextInt expect a positive number, correct me if I am wrong, what if:\nmax = -100\nmin = -1000\nmax - min = -1100", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363611320", "createdAt": "2020-01-07T06:49:27Z", "author": {"login": "er1cthe0ne"}, "path": "src/com/futurewei/alcor/controller/utilities/Common.java", "diffHunk": "@@ -26,4 +27,14 @@\n \n         return bytes;\n     }\n+\n+    public static int getRandomNumberInRange(int min, int max) {\n+\n+        if (min >= max) {\n+            throw new IllegalArgumentException(\"Max must be greater than min\");\n+        }\n+\n+        Random r = new Random();\n+        return r.nextInt((max - min) + 1) + min;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg3Nzg2Ng==", "bodyText": "Are you sure that (-100) - (-1000) = -1100 ? :-)", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363877866", "createdAt": "2020-01-07T18:07:06Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/utilities/Common.java", "diffHunk": "@@ -26,4 +27,14 @@\n \n         return bytes;\n     }\n+\n+    public static int getRandomNumberInRange(int min, int max) {\n+\n+        if (min >= max) {\n+            throw new IllegalArgumentException(\"Max must be greater than min\");\n+        }\n+\n+        Random r = new Random();\n+        return r.nextInt((max - min) + 1) + min;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMTMyMA=="}, "originalCommit": {"oid": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg3ODkxNQ==", "bodyText": ":) I am not sure now when I look at it this morning...", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363878915", "createdAt": "2020-01-07T18:09:47Z", "author": {"login": "er1cthe0ne"}, "path": "src/com/futurewei/alcor/controller/utilities/Common.java", "diffHunk": "@@ -26,4 +27,14 @@\n \n         return bytes;\n     }\n+\n+    public static int getRandomNumberInRange(int min, int max) {\n+\n+        if (min >= max) {\n+            throw new IllegalArgumentException(\"Max must be greater than min\");\n+        }\n+\n+        Random r = new Random();\n+        return r.nextInt((max - min) + 1) + min;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMTMyMA=="}, "originalCommit": {"oid": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NTY3NDk2OnYy", "diffSide": "RIGHT", "path": "src/com/futurewei/alcor/controller/web/util/ControllerUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QwNjo1MTo1MlrOFaxGiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxODoyMDowMlrOFbBqeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMTc4Nw==", "bodyText": "is this function for OneBox only? If yes, it will be better to name this function accordingly.", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363611787", "createdAt": "2020-01-07T06:51:52Z", "author": {"login": "er1cthe0ne"}, "path": "src/com/futurewei/alcor/controller/web/util/ControllerUtil.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.controller.web.util;\n+\n+import com.futurewei.alcor.controller.app.onebox.OneBoxConfig;\n+import com.futurewei.alcor.controller.model.HostInfo;\n+import com.futurewei.alcor.controller.model.PortState;\n+import com.futurewei.alcor.controller.model.SubnetState;\n+import com.futurewei.alcor.controller.resourcemgr.physical.goalstatemgmt.GoalStateWorker;\n+import com.futurewei.alcor.controller.resourcemgr.physical.goalstatemgmt.PortProgramInfo;\n+import com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfig;\n+\n+public class ControllerUtil {\n+\n+    public static PortState CreatePort(PortState portState) {\n+\n+        HostInfo epHost = DataCenterConfig.nodeManager.getHostInfoById(portState.getBindingHostId());\n+        PortState customerPortState = ControllerUtil.AssignVipMacToPort(portState, OneBoxConfig.epCounter);\n+        SubnetState customerSubnetState = ControllerConfig.customerSubnetState;\n+        HostInfo[] transitSwitchHostsForSubnet = ControllerConfig.transitSwitchHosts;\n+\n+        System.out.println(\"EP host counter :\" + OneBoxConfig.epHostCounter + \"| ep counter: \" + OneBoxConfig.epCounter);\n+        OneBoxConfig.epCounter++;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg4MzEyOQ==", "bodyText": "This is for general usage actually. It has been updated with the correct config.", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363883129", "createdAt": "2020-01-07T18:20:02Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/web/util/ControllerUtil.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.controller.web.util;\n+\n+import com.futurewei.alcor.controller.app.onebox.OneBoxConfig;\n+import com.futurewei.alcor.controller.model.HostInfo;\n+import com.futurewei.alcor.controller.model.PortState;\n+import com.futurewei.alcor.controller.model.SubnetState;\n+import com.futurewei.alcor.controller.resourcemgr.physical.goalstatemgmt.GoalStateWorker;\n+import com.futurewei.alcor.controller.resourcemgr.physical.goalstatemgmt.PortProgramInfo;\n+import com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfig;\n+\n+public class ControllerUtil {\n+\n+    public static PortState CreatePort(PortState portState) {\n+\n+        HostInfo epHost = DataCenterConfig.nodeManager.getHostInfoById(portState.getBindingHostId());\n+        PortState customerPortState = ControllerUtil.AssignVipMacToPort(portState, OneBoxConfig.epCounter);\n+        SubnetState customerSubnetState = ControllerConfig.customerSubnetState;\n+        HostInfo[] transitSwitchHostsForSubnet = ControllerConfig.transitSwitchHosts;\n+\n+        System.out.println(\"EP host counter :\" + OneBoxConfig.epHostCounter + \"| ep counter: \" + OneBoxConfig.epCounter);\n+        OneBoxConfig.epCounter++;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMTc4Nw=="}, "originalCommit": {"oid": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4669, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}