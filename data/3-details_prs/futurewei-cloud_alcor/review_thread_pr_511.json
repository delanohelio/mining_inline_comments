{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0ODk2OTk3", "number": 511, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDo0NjoxM1rOFG5hSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDo1OToxN1rOFG5z8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzc4MTg1OnYy", "diffSide": "RIGHT", "path": "services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/controller/SubnetController.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDo0NjoxM1rOIIIIPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxNzo0NjozNFrOIIsk1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5MjcwMQ==", "bodyText": "@kevin-zhonghao Please check PM's new API for port count in a subnet, it should be {\"/project/{project_id}/subnet-port-count/{subnet_id}. This api will only return non-gateway port count. If it's not zero, the subnet cannot be deleted. If it returns zero, we need to ask PM to delete the gateway port first before delete the subnet.", "url": "https://github.com/futurewei-cloud/alcor/pull/511#discussion_r545392701", "createdAt": "2020-12-17T20:46:13Z", "author": {"login": "cj-chung"}, "path": "services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/controller/SubnetController.java", "diffHunk": "@@ -523,8 +523,10 @@ public ResponseId deleteSubnetState(@PathVariable String projectId, @PathVariabl\n             } else {\n                 rangeId = ipV6RangeId;\n             }\n-//            Boolean checkIfAnyPortInSubnet = this.subnetService.checkIfAnyPortInSubnet(rangeId);\n-//            if (checkIfAnyPortInSubnet) {\n+\n+            // TODO: check if there is any gateway / non-gateway port for the subnet, waiting for PM new API\n+//            Boolean checkIfAnyNoneGatewayPortInSubnet = this.subnetService.checkIfAnyPortInSubnet(rangeId);\n+//            if (checkIfAnyNoneGatewayPortInSubnet) {\n //                throw new HavePortInSubnet();\n //            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0599937a476aa1b217733736bd29e7ee6a353df1"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4OTg0Ng==", "bodyText": "Sure", "url": "https://github.com/futurewei-cloud/alcor/pull/511#discussion_r545989846", "createdAt": "2020-12-18T17:46:34Z", "author": {"login": "kevin-zhonghao"}, "path": "services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/controller/SubnetController.java", "diffHunk": "@@ -523,8 +523,10 @@ public ResponseId deleteSubnetState(@PathVariable String projectId, @PathVariabl\n             } else {\n                 rangeId = ipV6RangeId;\n             }\n-//            Boolean checkIfAnyPortInSubnet = this.subnetService.checkIfAnyPortInSubnet(rangeId);\n-//            if (checkIfAnyPortInSubnet) {\n+\n+            // TODO: check if there is any gateway / non-gateway port for the subnet, waiting for PM new API\n+//            Boolean checkIfAnyNoneGatewayPortInSubnet = this.subnetService.checkIfAnyPortInSubnet(rangeId);\n+//            if (checkIfAnyNoneGatewayPortInSubnet) {\n //                throw new HavePortInSubnet();\n //            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5MjcwMQ=="}, "originalCommit": {"oid": "0599937a476aa1b217733736bd29e7ee6a353df1"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzgyOTYwOnYy", "diffSide": "RIGHT", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/RouterToPMServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDo1OToxN1rOIIIkGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxNzo0Njo0NVrOIIslPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5OTgzNA==", "bodyText": "@kevin-zhonghao please prepare a RouterUpdateInfo object here for request body. @chenpiaoping's code for this API requires RouterUpdateInfo object.", "url": "https://github.com/futurewei-cloud/alcor/pull/511#discussion_r545399834", "createdAt": "2020-12-17T20:59:17Z", "author": {"login": "cj-chung"}, "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/RouterToPMServiceImpl.java", "diffHunk": "@@ -81,4 +81,10 @@ public void updatePort(String projectid, String portId, PortEntity portEntity) {\n         HttpEntity<PortWebJson> request = new HttpEntity<>(new PortWebJson(portEntity));\n         restTemplate.put(portManagerServiceUrl, request, PortWebJson.class);\n     }\n+\n+    @Override\n+    public void updateL3Neighbors(String projectid, List<String> gatewayPorts) {\n+        String portManagerServiceUrl = portUrl + \"/project/\" + projectid + \"/update-l3-neighbors\";\n+        //restTemplate.put(portManagerServiceUrl, request, PortWebJson.class);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0599937a476aa1b217733736bd29e7ee6a353df1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4OTk0OQ==", "bodyText": "Added it", "url": "https://github.com/futurewei-cloud/alcor/pull/511#discussion_r545989949", "createdAt": "2020-12-18T17:46:45Z", "author": {"login": "kevin-zhonghao"}, "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/RouterToPMServiceImpl.java", "diffHunk": "@@ -81,4 +81,10 @@ public void updatePort(String projectid, String portId, PortEntity portEntity) {\n         HttpEntity<PortWebJson> request = new HttpEntity<>(new PortWebJson(portEntity));\n         restTemplate.put(portManagerServiceUrl, request, PortWebJson.class);\n     }\n+\n+    @Override\n+    public void updateL3Neighbors(String projectid, List<String> gatewayPorts) {\n+        String portManagerServiceUrl = portUrl + \"/project/\" + projectid + \"/update-l3-neighbors\";\n+        //restTemplate.put(portManagerServiceUrl, request, PortWebJson.class);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5OTgzNA=="}, "originalCommit": {"oid": "0599937a476aa1b217733736bd29e7ee6a353df1"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4484, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}