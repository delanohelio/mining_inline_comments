{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NTI4OTQ1", "number": 189, "title": "[Microservice] Node Manager - Metadata Management", "bodyText": "Node Manager (Part I) manages host/node metadata such as id, name, ip address, MAC address, veth, etc. . Here is the brief description of node manager:\n\nNode management functions: create, get, list, allocate, update, delete, bulk load\nRepository: Interact with ignite and build/manage host table.\nDeployment: Update Application.properties and pom file\nTest: Junit test cases to test REST APIs\n\nNOTE:  Link to PR (#185) for comment tracking.", "createdAt": "2020-05-09T06:51:37Z", "url": "https://github.com/futurewei-cloud/alcor/pull/189", "merged": true, "mergeCommit": {"oid": "598bf8442f3b2b58edcf8f0727055af97fb1e4cf"}, "closed": true, "closedAt": "2020-05-14T07:29:07Z", "author": {"login": "kimeunju108"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfguFbAH2gAyNDE1NTI4OTQ1OjgzYzQ5YWQyMWVlMjVhYTEwNmQxOTdlYzAwZjgwNTViMmYwNDRjOGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchBd_pgH2gAyNDE1NTI4OTQ1Ojc1MzBkNjFjNGMyNGU4YWIxZDQ4ZDIwZWYxYTJiZGEwNDNiYjZmNDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "83c49ad21ee25aa106d197ec00f8055b2f044c8a", "author": {"user": {"login": "kimeunju108", "name": "kimeunju108"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/83c49ad21ee25aa106d197ec00f8055b2f044c8a", "committedDate": "2020-05-09T06:45:02Z", "message": "[Micro services] Node manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c19d8f4661e34e09312b192a875d0114bdcb02b9", "author": {"user": {"login": "xieus", "name": "Liguang Xie"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/c19d8f4661e34e09312b192a875d0114bdcb02b9", "committedDate": "2020-05-11T00:34:49Z", "message": "Enable Swagger UI and docs for Node Manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f87a95a5dba8c4f42c2c428295f24a7e56286f8", "author": {"user": {"login": "xieus", "name": "Liguang Xie"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/1f87a95a5dba8c4f42c2c428295f24a7e56286f8", "committedDate": "2020-05-11T04:00:31Z", "message": "Add Docker for Node Manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83fc1e4c757d6c59dfbe28f04f465fc7c892e7f5", "author": {"user": {"login": "kimeunju108", "name": "kimeunju108"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/83fc1e4c757d6c59dfbe28f04f465fc7c892e7f5", "committedDate": "2020-05-11T22:51:09Z", "message": "[Micro service] Node manager - Added UTs, consolidated classes, orgarnized files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268", "author": {"user": {"login": "kimeunju108", "name": "kimeunju108"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/f7d885af1d9db68a810e4158dcad25c5b23f7268", "committedDate": "2020-05-11T22:57:02Z", "message": "Merge branch 'eunju/nodemanager' of https://github.com/kimeunju108/alcor into eunju/nodemanager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NjQ2MTMw", "url": "https://github.com/futurewei-cloud/alcor/pull/189#pullrequestreview-409646130", "createdAt": "2020-05-12T01:52:43Z", "commit": {"oid": "83fc1e4c757d6c59dfbe28f04f465fc7c892e7f5"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMTo1Mjo0M1rOGTzV2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMTo1Nzo1MlrOGTzbXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQxNzMwNA==", "bodyText": "Remove this block.", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r423417304", "createdAt": "2020-05-12T01:52:43Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/main/java/com/futurewei/alcor/nodemanager/dao/NodeRepository.java", "diffHunk": "@@ -60,17 +60,17 @@ public Map findAllItems() throws CacheException {\n         return cache.getAll();\n     }\n \n-    @Override\n-    public void addItem(NodeInfo nodeInfo) throws CacheException {\n-        logger.info(\"Add node, Node Id:\" + nodeInfo.getId());\n-        cache.put(nodeInfo.getId(), nodeInfo);\n-    }\n-\n-    @Override\n-    public void deleteItem(String id) throws CacheException {\n-        logger.info(\"Delete node, Node Id:\" + id);\n-        cache.remove(id);\n-    }\n+//    @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83fc1e4c757d6c59dfbe28f04f465fc7c892e7f5"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQxODcxNw==", "bodyText": "Could you move NodeInfo and NodeInfoJson under AlcorWeb project (/alcor/web/....)", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r423418717", "createdAt": "2020-05-12T01:57:52Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/main/java/com/futurewei/alcor/nodemanager/entity/NodeInfo.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.nodemanager.entity;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NjUzODMw", "url": "https://github.com/futurewei-cloud/alcor/pull/189#pullrequestreview-409653830", "createdAt": "2020-05-12T02:18:44Z", "commit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMjoxODo0NVrOGTzvbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMjoxODo0NVrOGTzvbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQyMzg1NA==", "bodyText": "Current UTs test the happy path. Should add more UTs to cover the sad path.\nFor example, what is supposed to happen if a hacker tries to send some random Ip and Mac addresses to NodeManager? The correct behavior is to reject those calls.\nDon't see necessary verification for NodeManager.", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r423423854", "createdAt": "2020-05-12T02:18:45Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/test/java/com/futurewei/alcor/nodemanager/controller/NodeControllerTest.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.nodemanager.controller;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.futurewei.alcor.nodemanager.entity.NodeInfo;\n+import com.futurewei.alcor.nodemanager.entity.NodeInfoJson;\n+import com.futurewei.alcor.nodemanager.service.NodeService;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.MediaType;\n+import org.springframework.mock.web.MockMultipartFile;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+import java.net.InetAddress;\n+\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+@AutoConfigureMockMvc\n+public class NodeControllerTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NjU0MTM1", "url": "https://github.com/futurewei-cloud/alcor/pull/189#pullrequestreview-409654135", "createdAt": "2020-05-12T02:19:49Z", "commit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMjoxOTo0OVrOGTzwXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMjoxOTo0OVrOGTzwXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQyNDA5NQ==", "bodyText": "We should do all necessary verification before persisting the states to database.", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r423424095", "createdAt": "2020-05-12T02:19:49Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/main/java/com/futurewei/alcor/nodemanager/service/implement/NodeServiceImpl.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.nodemanager.service.implement;\n+\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.nodemanager.dao.NodeRepository;\n+import com.futurewei.alcor.nodemanager.entity.NodeInfo;\n+import com.futurewei.alcor.nodemanager.service.NodeService;\n+import com.futurewei.alcor.nodemanager.utils.NodeManagerConstant;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+import org.springframework.web.multipart.MultipartFile;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.Reader;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+@Service\n+public class NodeServiceImpl implements NodeService {\n+    private static final Logger logger = LoggerFactory.getLogger(NodeServiceImpl.class);\n+\n+    @Autowired\n+    private NodeRepository nodeRepository;\n+\n+    public int getNodeInfoFromUpload(MultipartFile file) throws Exception {\n+        int nReturn = 0;\n+        List<NodeInfo> nodeList = new ArrayList<NodeInfo>();\n+        try {\n+            Reader reader = new BufferedReader(new InputStreamReader(file.getInputStream()));\n+            NodeFileLoader dataCenterConfigLoader = new NodeFileLoader();\n+            nodeList = dataCenterConfigLoader.getHostNodeListFromUpload(reader);\n+            if (nodeList != null) {\n+                nodeRepository.addItemBulkTransaction(nodeList);\n+                nReturn = nodeList.size();\n+            }\n+        } catch (IOException e) {\n+            e.printStackTrace();\n+        }\n+        return nReturn;\n+    }\n+\n+    @Override\n+    public int getNodeInfoFromFile(String path) throws Exception {\n+        int nReturn = 0;\n+        NodeFileLoader dataCenterConfigLoader = new NodeFileLoader();\n+        List<NodeInfo> nodeList = dataCenterConfigLoader.loadAndGetHostNodeList(path);\n+        if (nodeList != null) {\n+            nodeRepository.addItemBulkTransaction(nodeList);\n+            nReturn = nodeList.size();\n+        }\n+        return nReturn;\n+    }\n+\n+    @Override\n+    public NodeInfo getNodeInfoById(String nodeId) throws Exception {\n+        if (nodeId == null)\n+            throw (new ParameterNullOrEmptyException(NodeManagerConstant.NODE_EXCEPTION_PARAMETER_NULL_EMPTY));\n+        NodeInfo nodeInfo = null;\n+        try {\n+            nodeInfo = nodeRepository.findItem(nodeId);\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+        return nodeInfo;\n+    }\n+\n+    @Override\n+    public List<NodeInfo> getAllNodes() throws Exception {\n+        List<NodeInfo> nodes = new ArrayList<NodeInfo>();\n+        try {\n+            nodes = new ArrayList(nodeRepository.findAllItems().values());\n+        } catch (Exception e) {\n+            throw e;\n+        }\n+        return nodes;\n+    }\n+\n+    @Override\n+    public NodeInfo createNodeInfo(NodeInfo nodeInfo) throws Exception {\n+        if (nodeInfo == null)\n+            throw (new ParameterNullOrEmptyException(NodeManagerConstant.NODE_EXCEPTION_PARAMETER_NULL_EMPTY));\n+        NodeInfo node = getNodeInfoById(nodeInfo.getId());\n+        if (nodeInfo != null) {\n+            try {\n+                nodeRepository.addItem(nodeInfo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268"}, "originalPosition": 102}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NjU0ODU2", "url": "https://github.com/futurewei-cloud/alcor/pull/189#pullrequestreview-409654856", "createdAt": "2020-05-12T02:22:21Z", "commit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMjoyMjoyMVrOGTzy2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMjoyMjoyMVrOGTzy2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQyNDczMQ==", "bodyText": "Any reason that we want to pass InetAddress as an parameter?\nThe object is quite complicated.\n{\n\"host_info\": {\n\"local_ip\": {\n\"address\": [\n\"string\"\n],\n\"anyLocalAddress\": true,\n\"canonicalHostName\": \"string\",\n\"hostAddress\": \"string\",\n\"hostName\": \"string\",\n\"linkLocalAddress\": true,\n\"loopbackAddress\": true,\n\"mcglobal\": true,\n\"mclinkLocal\": true,\n\"mcnodeLocal\": true,\n\"mcorgLocal\": true,\n\"mcsiteLocal\": true,\n\"multicastAddress\": true,\n\"siteLocalAddress\": true\n},\n\"mac_address\": \"string\",\n\"node_id\": \"string\",\n\"node_name\": \"string\",\n\"server_port\": 0,\n\"veth\": \"string\"\n}\n}", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r423424731", "createdAt": "2020-05-12T02:22:21Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/main/java/com/futurewei/alcor/nodemanager/entity/NodeInfo.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.nodemanager.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonAutoDetect;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.futurewei.alcor.nodemanager.utils.NodeManagerConstant;\n+import lombok.Data;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.Serializable;\n+import java.net.InetAddress;\n+import java.net.UnknownHostException;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+@Data\n+@JsonAutoDetect(fieldVisibility = JsonAutoDetect.Visibility.ANY, getterVisibility = JsonAutoDetect.Visibility.NONE,\n+        setterVisibility = JsonAutoDetect.Visibility.NONE, creatorVisibility = JsonAutoDetect.Visibility.NONE)\n+public class NodeInfo implements Serializable {\n+    private static final Logger logger = LoggerFactory.getLogger(NodeInfo.class);\n+\n+    @JsonProperty(\"node_id\")\n+    private String id;\n+\n+    @JsonProperty(\"node_name\")\n+    private String name;\n+\n+    @JsonProperty(\"local_ip\")\n+    private InetAddress localIp;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NjU3MDk0", "url": "https://github.com/futurewei-cloud/alcor/pull/189#pullrequestreview-409657094", "createdAt": "2020-05-12T02:29:58Z", "commit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMjoyOTo1OFrOGTz5nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMjoyOTo1OFrOGTz5nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQyNjQ2MA==", "bodyText": "Regarding old comments left for PR (#185), are these configuration related to the upload file API to limit the file uploading? If so, those are good configuration. Otherwise, completely remove them.", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r423426460", "createdAt": "2020-05-12T02:29:58Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/main/resources/application.properties", "diffHunk": "@@ -0,0 +1,17 @@\n+#ignite configuration\n+ignite.host=localhost\n+ignite.port=10800\n+ignite.key-store-path=keystore.jks\n+ignite.key-store-password=123456\n+ignite.trust-store-path=truststore.jks\n+ignite.trust-store-password=123456\n+## MULTIPART (MultipartProperties)\n+# Enable multipart uploads\n+#spring.servlet.multipart.enabled=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "119d91d5775da7ca1bcfd13b5fbe6fdff050f7b1", "author": {"user": {"login": "kimeunju108", "name": "kimeunju108"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/119d91d5775da7ca1bcfd13b5fbe6fdff050f7b1", "committedDate": "2020-05-12T13:44:46Z", "message": "[Micro services] Node manager - Moved NodeInfo & NodeInfoJson to alcor/web/entity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTg3MzI5", "url": "https://github.com/futurewei-cloud/alcor/pull/189#pullrequestreview-410587329", "createdAt": "2020-05-13T04:58:27Z", "commit": {"oid": "119d91d5775da7ca1bcfd13b5fbe6fdff050f7b1"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDo1ODoyN1rOGUhcQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNTowMzo1OVrOGUhhxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MjYxMQ==", "bodyText": "A good example of exceptions handling:\nhttps://github.com/futurewei-cloud/alcor/pull/180/files#diff-9c86731ca636830c35d171bddafb3ed2\nservices/port_manager/src/main/java/com/futurewei/alcor/portmanager/exception/AllocateIpAddrException.java\nWe should identify various specific exceptions that a services might throw, and handle them in different catch blocks (although using a generic exception is easy, it leaves headaches for operation people to see the service logs as it is too generic).", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r424172611", "createdAt": "2020-05-13T04:58:27Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/main/java/com/futurewei/alcor/nodemanager/controller/NodeController.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.nodemanager.controller;\n+\n+import com.futurewei.alcor.common.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.common.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.web.entity.NodeInfo;\n+import com.futurewei.alcor.web.entity.NodeInfoJson;\n+import com.futurewei.alcor.nodemanager.service.NodeService;\n+import com.futurewei.alcor.nodemanager.utils.NodeManagerConstant;\n+import com.futurewei.alcor.common.utils.RestPreconditionsUtil;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.*;\n+import org.springframework.web.multipart.MultipartFile;\n+import org.springframework.web.servlet.HandlerMapping;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+\n+@RestController\n+public class NodeController {\n+\n+    @Autowired\n+    private NodeService service;\n+\n+    @RequestMapping(\n+            method = POST,\n+            value = {\"/nodes/upload\", \"/v4/nodes/upload\"})\n+    public String uploadFile(@RequestParam(\"file\") MultipartFile file) throws Exception {\n+        int nNode = 0;\n+        if (file == null) {\n+            return NodeManagerConstant.NODE_EXCEPTION_FILE_EMPTY;\n+        }\n+        try {\n+            nNode = service.getNodeInfoFromUpload(file);\n+        } catch (Exception e) {\n+            throw e;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "119d91d5775da7ca1bcfd13b5fbe6fdff050f7b1"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MjgwOA==", "bodyText": "Comments are very good. Let us add more to elsewhere, especially for Controller, Services and Repo codes.", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r424172808", "createdAt": "2020-05-13T04:59:21Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/main/java/com/futurewei/alcor/nodemanager/dao/NodeRepository.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.nodemanager.dao;\n+\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.db.CacheFactory;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;\n+import com.futurewei.alcor.common.repo.ICacheRepository;\n+import com.futurewei.alcor.web.entity.NodeInfo;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.annotation.PostConstruct;\n+import java.util.List;\n+import java.util.Map;\n+\n+@Repository\n+@ComponentScan(value = \"com.futurewei.alcor.common.db\")\n+public class NodeRepository implements ICacheRepository<NodeInfo> {\n+    private static final Logger logger = LoggerFactory.getLogger(NodeRepository.class);\n+    private ICache<String, NodeInfo> cache;\n+\n+    @Autowired\n+    public NodeRepository(CacheFactory cacheFactory) {\n+        cache = cacheFactory.getCache(NodeInfo.class);\n+    }\n+\n+    public ICache<String, NodeInfo> getCache() {\n+        return cache;\n+    }\n+\n+    @PostConstruct\n+    private void init() {\n+        logger.info(\"NodeRepository init completed\");\n+    }\n+\n+    @Override\n+    public NodeInfo findItem(String id) throws CacheException {\n+        return cache.get(id);\n+    }\n+\n+    @Override\n+    public Map findAllItems() throws CacheException {\n+        return cache.getAll();\n+    }\n+\n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "119d91d5775da7ca1bcfd13b5fbe6fdff050f7b1"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MzIzOA==", "bodyText": "This hides the exception on the service level which Controller don't have visibility. Please check the good example in the comments above related to exception handling.", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r424173238", "createdAt": "2020-05-13T05:00:53Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/main/java/com/futurewei/alcor/nodemanager/service/implement/NodeFileLoader.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.nodemanager.service.implement;\n+\n+import com.futurewei.alcor.nodemanager.exception.InvalidDataException;\n+import com.futurewei.alcor.nodemanager.utils.NodeManagerConstant;\n+import com.futurewei.alcor.web.entity.NodeInfo;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.parser.JSONParser;\n+import org.json.simple.parser.ParseException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.io.Reader;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class NodeFileLoader {\n+    private static final Logger logger = LoggerFactory.getLogger(NodeFileLoader.class);\n+\n+    public NodeFileLoader() {\n+    }\n+\n+    public List<NodeInfo> getHostNodeListFromUpload(Reader reader) {\n+        JSONParser jsonParser = new JSONParser();\n+        List<NodeInfo> nodeInfos = new ArrayList<>();\n+        logger.info(this.getClass().getName(), \"getHostNodeListFromUpload\");\n+        try {\n+            JSONObject obj = (JSONObject) jsonParser.parse(reader);\n+            JSONArray nodeList = (JSONArray) obj.get(\"Hosts\");\n+\n+            nodeList.forEach(node -> {\n+                NodeInfo hostNode = null;\n+                try {\n+                    hostNode = this.parseNodeObject((JSONObject) node);\n+                } catch (Exception e) {\n+                    throw new RuntimeException(e);\n+                }\n+                if (hostNode != null) nodeInfos.add(hostNode);\n+            });\n+        } catch (FileNotFoundException e) {\n+            e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "119d91d5775da7ca1bcfd13b5fbe6fdff050f7b1"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3Mzg1OA==", "bodyText": "Based on my comments above, these are good configuration and we should enable them on, instead of remove .", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r424173858", "createdAt": "2020-05-13T05:03:15Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/main/resources/application.properties", "diffHunk": "@@ -0,0 +1,17 @@\n+#ignite configuration\n+ignite.host=localhost\n+ignite.port=10800\n+ignite.key-store-path=keystore.jks\n+ignite.key-store-password=123456\n+ignite.trust-store-path=truststore.jks\n+ignite.trust-store-password=123456\n+## MULTIPART (MultipartProperties)\n+# Enable multipart uploads\n+#spring.servlet.multipart.enabled=true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQyNjQ2MA=="}, "originalCommit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3NDAyMg==", "bodyText": "Didn't see the response so I am assuming that you are still working on these UTs.\nA good discussion about UT handling on the Alcor channel on Slack today. Please take a look.", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r424174022", "createdAt": "2020-05-13T05:03:59Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/test/java/com/futurewei/alcor/nodemanager/controller/NodeControllerTest.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.nodemanager.controller;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.futurewei.alcor.nodemanager.entity.NodeInfo;\n+import com.futurewei.alcor.nodemanager.entity.NodeInfoJson;\n+import com.futurewei.alcor.nodemanager.service.NodeService;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.MediaType;\n+import org.springframework.mock.web.MockMultipartFile;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;\n+\n+import java.net.InetAddress;\n+\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@RunWith(SpringRunner.class)\n+@SpringBootTest\n+@AutoConfigureMockMvc\n+public class NodeControllerTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQyMzg1NA=="}, "originalCommit": {"oid": "f7d885af1d9db68a810e4158dcad25c5b23f7268"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c9ac32de9ac4532244eadda8d5bd26c2ea8246a", "author": {"user": {"login": "kimeunju108", "name": "kimeunju108"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/1c9ac32de9ac4532244eadda8d5bd26c2ea8246a", "committedDate": "2020-05-13T15:55:38Z", "message": "[Micro services] Node manager - add sad pass UTs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9264354b5ec5cbde604a1077a613996b05b17e65", "author": {"user": {"login": "kimeunju108", "name": "kimeunju108"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/9264354b5ec5cbde604a1077a613996b05b17e65", "committedDate": "2020-05-13T16:14:02Z", "message": "[Micro services] Node manager - add sad pass & exception handling UTs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed223b7cf018a077752f180e1fbbdec613fb0885", "author": {"user": {"login": "kimeunju108", "name": "kimeunju108"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/ed223b7cf018a077752f180e1fbbdec613fb0885", "committedDate": "2020-05-13T18:35:54Z", "message": "[Micro services] Node manager - added exceptions and updated application.properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMzI4NjA2", "url": "https://github.com/futurewei-cloud/alcor/pull/189#pullrequestreview-411328606", "createdAt": "2020-05-13T21:57:44Z", "commit": {"oid": "ed223b7cf018a077752f180e1fbbdec613fb0885"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTo1Nzo0NFrOGVE98w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMTo1Nzo0NFrOGVE98w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc1NDY3NQ==", "bodyText": "Maybe we could use Logger to give a bit more details.\nThe current handling does not differentiate exceptions.", "url": "https://github.com/futurewei-cloud/alcor/pull/189#discussion_r424754675", "createdAt": "2020-05-13T21:57:44Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/main/java/com/futurewei/alcor/nodemanager/service/implement/NodeFileLoader.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.nodemanager.service.implement;\n+\n+import com.futurewei.alcor.nodemanager.exception.InvalidDataException;\n+import com.futurewei.alcor.nodemanager.utils.NodeManagerConstant;\n+import com.futurewei.alcor.web.entity.NodeInfo;\n+import org.json.simple.JSONArray;\n+import org.json.simple.JSONObject;\n+import org.json.simple.parser.JSONParser;\n+import org.json.simple.parser.ParseException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.io.Reader;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class NodeFileLoader {\n+    private static final Logger logger = LoggerFactory.getLogger(NodeFileLoader.class);\n+\n+    public NodeFileLoader() {\n+    }\n+\n+    public List<NodeInfo> getHostNodeListFromUpload(Reader reader) {\n+        JSONParser jsonParser = new JSONParser();\n+        List<NodeInfo> nodeInfos = new ArrayList<>();\n+        logger.info(this.getClass().getName(), \"getHostNodeListFromUpload\");\n+        try {\n+            JSONObject obj = (JSONObject) jsonParser.parse(reader);\n+            JSONArray nodeList = (JSONArray) obj.get(\"Hosts\");\n+\n+            nodeList.forEach(node -> {\n+                NodeInfo hostNode = null;\n+                try {\n+                    hostNode = this.parseNodeObject((JSONObject) node);\n+                } catch (Exception e) {\n+                    throw new RuntimeException(e);\n+                }\n+                if (hostNode != null) nodeInfos.add(hostNode);\n+            });\n+        } catch (FileNotFoundException e) {\n+            e.printStackTrace();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE3MzIzOA=="}, "originalCommit": {"oid": "119d91d5775da7ca1bcfd13b5fbe6fdff050f7b1"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7530d61c4c24e8ab1d48d20ef1a2bda043bb6f41", "author": {"user": {"login": "kimeunju108", "name": "kimeunju108"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/7530d61c4c24e8ab1d48d20ef1a2bda043bb6f41", "committedDate": "2020-05-13T23:28:15Z", "message": "[Micro services] Node manager - added comments and logs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2452, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}