{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwODM2ODcy", "number": 515, "title": "Correctly Handle Fields with Null Value for JSON Deserialization", "bodyText": "Correctly Handle Fields with Null Value for JSON Deserialization\nProvides the interface to get # of ports in the subnet", "createdAt": "2020-12-16T02:05:52Z", "url": "https://github.com/futurewei-cloud/alcor/pull/515", "merged": true, "mergeCommit": {"oid": "488e422da0de4185aff7b3e42ea23bab22e12291"}, "closed": true, "closedAt": "2020-12-18T02:54:04Z", "author": {"login": "chenpiaoping"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmlLNGgH2gAyNTQwODM2ODcyOjcxMWNmNDFmNjVlMjJhNzVjNzliOTMxZWU4ZjdkNGQyZjc4MmJhZDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnO1PFAFqTU1NTEzNDQyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "711cf41f65e22a75c79b931ee8f7d4d2f782bad7", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/711cf41f65e22a75c79b931ee8f7d4d2f782bad7", "committedDate": "2020-12-16T02:05:05Z", "message": "Correctly handle fields whose value is null when json deserialization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f324f817241f201d014c4d86fd823b4040f498c", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/2f324f817241f201d014c4d86fd823b4040f498c", "committedDate": "2020-12-16T10:08:15Z", "message": "Get port id list by subnet id"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MTk2NjYy", "url": "https://github.com/futurewei-cloud/alcor/pull/515#pullrequestreview-554196662", "createdAt": "2020-12-17T00:40:32Z", "commit": {"oid": "2f324f817241f201d014c4d86fd823b4040f498c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMDo0MDozM1rOIHfZ2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMDo0MDozM1rOIHfZ2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcyNTQ2Nw==", "bodyText": "@chenpiaoping This API just need to return # of ports in the subnet, you don't need to return their port ids. Subnet Manager will check this return value when the subnet is going to be deleted.", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r544725467", "createdAt": "2020-12-17T00:40:33Z", "author": {"login": "cj-chung"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/service/PortServiceImpl.java", "diffHunk": "@@ -296,4 +295,9 @@ public RouterUpdateInfo updateL3Neighbors(String projectId, RouterUpdateInfo rou\n \n         return routerUpdateInfo;\n     }\n+\n+    @Override\n+    public SubnetPortIds getSubnetPorts(String projectId, String subnetId) throws Exception {\n+        return portRepository.getSubnetPortIds(subnetId);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f324f817241f201d014c4d86fd823b4040f498c"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aca83a133d0c17cf9e4deaedf63e4ab594e39a3", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/8aca83a133d0c17cf9e4deaedf63e4ab594e39a3", "committedDate": "2020-12-17T07:06:25Z", "message": "Fix compilation errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f728fa1d6de2cf5e08b75b2a02c0ab9c9e3e5df", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/5f728fa1d6de2cf5e08b75b2a02c0ab9c9e3e5df", "committedDate": "2020-12-17T08:02:31Z", "message": "Returns the number of non-gateway port by subnet id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6", "committedDate": "2020-12-17T12:29:01Z", "message": "Ignore absent fields in json when deserialization"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f58a530fb6fa9e6880db63c1589f3a38a9c5f58", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/4f58a530fb6fa9e6880db63c1589f3a38a9c5f58", "committedDate": "2020-12-17T11:51:34Z", "message": "Ignore absent fields in json when deserialization"}, "afterCommit": {"oid": "fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6", "committedDate": "2020-12-17T12:29:01Z", "message": "Ignore absent fields in json when deserialization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0OTQ0MTYy", "url": "https://github.com/futurewei-cloud/alcor/pull/515#pullrequestreview-554944162", "createdAt": "2020-12-17T20:01:22Z", "commit": {"oid": "fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDowMToyMlrOIIGllg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDowMToyMlrOIIGllg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM2NzQ0Ng==", "bodyText": "@chenpiaoping Should include gateway port here and  distinguish it from a normal port? or add another field for gateway ports?", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r545367446", "createdAt": "2020-12-17T20:01:22Z", "author": {"login": "cj-chung"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/entity/SubnetPortIds.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.portmanager.entity;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+import java.util.Set;\n+\n+public class SubnetPortIds {\n+    @JsonProperty(\"subnet_id\")\n+    private String subnetId;\n+\n+    @JsonProperty(\"port_ids\")\n+    private Set<String> portIds;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0OTY4NDYz", "url": "https://github.com/futurewei-cloud/alcor/pull/515#pullrequestreview-554968463", "createdAt": "2020-12-17T20:37:03Z", "commit": {"oid": "fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDozNzowM1rOIIH1Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QyMDozNzowM1rOIIH1Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM4NzgyMw==", "bodyText": "@chenpiaoping do you think function name getSubnetPortCount would be better? Same as the API name: subnet-port-count.", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r545387823", "createdAt": "2020-12-17T20:37:03Z", "author": {"login": "cj-chung"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/controller/PortController.java", "diffHunk": "@@ -221,4 +221,16 @@ public RouterUpdateInfo updateL3Neighbors(@PathVariable(\"project_id\") String pro\n         checkRouterSubnetUpdateInfo(routerUpdateInfo);\n         return portService.updateL3Neighbors(projectId, routerUpdateInfo);\n     }\n+\n+    @Rbac(resource =\"port\")\n+    @GetMapping({\"/project/{project_id}/subnet-port-number/{subnet_id}\", \"v4/{project_id}/subnet-port-number/{subnet_id}\"})\n+    @DurationStatistics\n+    public int getSubnetPortNumber(@PathVariable(\"project_id\") String projectId,\n+                                             @PathVariable(\"subnet_id\") String subnetId) throws Exception {\n+        if (StringUtil.isNullOrEmpty(subnetId)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa0cd127e0ef1aa36e12caa4873edb37cc1f09b6"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d11b117c8792b2eeab8b38bbabecd367cba1a9f", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/0d11b117c8792b2eeab8b38bbabecd367cba1a9f", "committedDate": "2020-12-18T01:57:43Z", "message": "Rename the API name from subnet-port-number to subnet-port-count"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MTMyMDQ1", "url": "https://github.com/futurewei-cloud/alcor/pull/515#pullrequestreview-555132045", "createdAt": "2020-12-18T02:29:50Z", "commit": {"oid": "0d11b117c8792b2eeab8b38bbabecd367cba1a9f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwMjoyOTo1MFrOIIQsHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwMjoyOTo1MFrOIIQsHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTUzMjk1OQ==", "bodyText": "A constant string would be better.", "url": "https://github.com/futurewei-cloud/alcor/pull/515#discussion_r545532959", "createdAt": "2020-12-18T02:29:50Z", "author": {"login": "xieus"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/repo/PortRepository.java", "diffHunk": "@@ -263,6 +264,33 @@ private String getNeighborCacheName(String suffix) {\n         return NEIGHBOR_CACHE_NAME_PREFIX + suffix;\n     }\n \n+    private List<SubnetPortIds> getSubnetPortIds(List<PortEntity> portEntities) {\n+        Map<String, SubnetPortIds> subnetPortIdsMap = new HashMap<>();\n+        for (PortEntity portEntity: portEntities) {\n+            if (\"network:router_interface\".equals(portEntity.getDeviceOwner())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d11b117c8792b2eeab8b38bbabecd367cba1a9f"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MTM0NDI3", "url": "https://github.com/futurewei-cloud/alcor/pull/515#pullrequestreview-555134427", "createdAt": "2020-12-18T02:37:06Z", "commit": {"oid": "0d11b117c8792b2eeab8b38bbabecd367cba1a9f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2060, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}