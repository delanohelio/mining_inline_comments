{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NTc1NjQx", "number": 129, "title": "Replace Redis with Apache Ignite for in memory cache and db", "bodyText": "This PR implements the abstraction layer of the in-memory database, which i also call it db cache.  underlying component that really provide cache services that include redis and ignite currently. The ICache interface defines the basic interface for cache operations, such as add, delete, and modify. The cache also supports Transaction,Transaction interface provides transaction-related interfaces. If the underlying cache chooses ignite, it also supports security features and uses SLL to establish a secure link with the ignite server.", "createdAt": "2020-03-17T01:43:37Z", "url": "https://github.com/futurewei-cloud/alcor/pull/129", "merged": true, "mergeCommit": {"oid": "efe828ec7619ce34dcb725039e0f65f73c26ca3c"}, "closed": true, "closedAt": "2020-03-25T13:21:05Z", "author": {"login": "chenpiaoping"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJBdUoAH2gAyMzg5NTc1NjQxOmY3Y2RjOGQ0NzJhMGU3YWJhMmJiOWM2NDEwNzVkYzJmOTNlNDNjZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRC-qdgH2gAyMzg5NTc1NjQxOjY5NGE1YjY1MDBkOTU3YzQyYTEzMzY3NGM5YjIwM2ZiNDRlYWU5NDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f7cdc8d472a0e7aba2bb9c641075dc2f93e43cdf", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/f7cdc8d472a0e7aba2bb9c641075dc2f93e43cdf", "committedDate": "2020-02-29T09:53:20Z", "message": "Add ignite cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "277b709c11af1695262ce96ee1d63a94a2d3764a", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/277b709c11af1695262ce96ee1d63a94a2d3764a", "committedDate": "2020-02-29T09:58:17Z", "message": "Add ignite cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "481f50396be5be6f4598224717446873a472421b", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/481f50396be5be6f4598224717446873a472421b", "committedDate": "2020-03-09T03:26:58Z", "message": "Solve the problem that test cases cannot pass without ignite configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b2daa0605b667d5baf4697642bd39f34af9e4bc", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/2b2daa0605b667d5baf4697642bd39f34af9e4bc", "committedDate": "2020-03-16T10:07:14Z", "message": "Add db modue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40bff2a35081adfeec0d9051aae6b22a443a2de5", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/40bff2a35081adfeec0d9051aae6b22a443a2de5", "committedDate": "2020-03-17T01:41:11Z", "message": "Fix test case failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NzIwNDE5", "url": "https://github.com/futurewei-cloud/alcor/pull/129#pullrequestreview-375720419", "createdAt": "2020-03-17T03:38:03Z", "commit": {"oid": "40bff2a35081adfeec0d9051aae6b22a443a2de5"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMzozODowM1rOF3M74w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMzo0ODoxM1rOF3NEvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyNzkzOQ==", "bodyText": "This is a very good start with the abstraction layer on DB access.\nCouple of suggestions:\n\nWe likely want to uncomment the ignite configuration.\nPlace ignite cluster on other hosts, and support remote IPs/URLs instead of localhost\nDeploy Ignite clusters as a K8s service", "url": "https://github.com/futurewei-cloud/alcor/pull/129#discussion_r393427939", "createdAt": "2020-03-17T03:38:03Z", "author": {"login": "xieus"}, "path": "src/resources/application.properties", "diffHunk": "@@ -9,3 +9,7 @@ logging.level.root=info\n logging.level.org.springframework.web=info\n logging.file.path=.\n logging.type=file\n+#Ignite configuration\n+#ignite.host=localhost", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bff2a35081adfeec0d9051aae6b22a443a2de5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyODI1NQ==", "bodyText": "Good idea of using /debug URL", "url": "https://github.com/futurewei-cloud/alcor/pull/129#discussion_r393428255", "createdAt": "2020-03-17T03:39:20Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/web/DebugVpcController.java", "diffHunk": "@@ -0,0 +1,134 @@\n+package com.futurewei.alcor.controller.web;\n+\n+import com.futurewei.alcor.controller.cache.repo.VpcRepository;\n+import com.futurewei.alcor.controller.exception.ParameterNullOrEmptyException;\n+import com.futurewei.alcor.controller.exception.ResourceNotFoundException;\n+import com.futurewei.alcor.controller.exception.ResourceNullException;\n+import com.futurewei.alcor.controller.exception.ResourcePersistenceException;\n+import com.futurewei.alcor.controller.model.ResponseId;\n+import com.futurewei.alcor.controller.model.VpcState;\n+import com.futurewei.alcor.controller.model.VpcStateJson;\n+import com.futurewei.alcor.controller.web.util.RestPreconditions;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.*;\n+\n+import static org.springframework.web.bind.annotation.RequestMethod.*;\n+import static org.springframework.web.bind.annotation.RequestMethod.DELETE;\n+\n+@RestController\n+public class DebugVpcController {\n+    @Autowired(required = false)\n+    private VpcRepository vpcRepository;\n+\n+    @RequestMapping(\n+            method = GET,\n+            value = {\"/debug/project/{projectid}/vpcs/{vpcid}\"})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bff2a35081adfeec0d9051aae6b22a443a2de5"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyODc2Nw==", "bodyText": "Shall we use other name like \"cache_name\" to be differentiated with the KEY in K-V?", "url": "https://github.com/futurewei-cloud/alcor/pull/129#discussion_r393428767", "createdAt": "2020-03-17T03:41:45Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/db/redis/RedisCache.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package com.futurewei.alcor.controller.db.redis;\n+\n+import com.futurewei.alcor.controller.db.ICache;\n+import org.springframework.data.redis.core.HashOperations;\n+import org.springframework.data.redis.core.RedisTemplate;\n+\n+import java.util.Map;\n+\n+public class RedisCache<K, V> implements ICache<K, V> {\n+    private HashOperations hashOperations;\n+    private String key;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bff2a35081adfeec0d9051aae6b22a443a2de5"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyODg0OA==", "bodyText": "Let us use \"Key\" instead of \"var\"", "url": "https://github.com/futurewei-cloud/alcor/pull/129#discussion_r393428848", "createdAt": "2020-03-17T03:42:06Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/db/redis/RedisCache.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package com.futurewei.alcor.controller.db.redis;\n+\n+import com.futurewei.alcor.controller.db.ICache;\n+import org.springframework.data.redis.core.HashOperations;\n+import org.springframework.data.redis.core.RedisTemplate;\n+\n+import java.util.Map;\n+\n+public class RedisCache<K, V> implements ICache<K, V> {\n+    private HashOperations hashOperations;\n+    private String key;\n+\n+    public RedisCache(RedisTemplate<K, V> redisTemplate, String key) {\n+        hashOperations = redisTemplate.opsForHash();\n+        this.key = key;\n+    }\n+\n+    @Override\n+    public V get(K var1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bff2a35081adfeec0d9051aae6b22a443a2de5"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyOTAzMA==", "bodyText": "Consider to add SSL support.", "url": "https://github.com/futurewei-cloud/alcor/pull/129#discussion_r393429030", "createdAt": "2020-03-17T03:43:01Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/db/ignite/IgniteConfiguration.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package com.futurewei.alcor.controller.db.ignite;\n+\n+import com.futurewei.alcor.controller.logging.Logger;\n+import com.futurewei.alcor.controller.logging.LoggerFactory;\n+import org.apache.ignite.Ignition;\n+import org.apache.ignite.client.ClientException;\n+import org.apache.ignite.client.IgniteClient;\n+import org.apache.ignite.configuration.ClientConfiguration;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+import org.springframework.boot.autoconfigure.domain.EntityScan;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.util.Assert;\n+import java.util.logging.Level;\n+\n+@Configuration\n+@ComponentScan(\"com.futurewei.alcor.controller.cache\")\n+@EntityScan(\"com.futurewei.alcor.controller.cache\")\n+@ConditionalOnProperty(prefix = \"ignite\", name = \"host\")\n+public class IgniteConfiguration {\n+    private static final Logger logger = LoggerFactory.getLogger();\n+\n+    @Value(\"${ignite.host}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bff2a35081adfeec0d9051aae6b22a443a2de5"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyOTIzMw==", "bodyText": "Do we know how the page size impacts perf? Could we make it configurable?", "url": "https://github.com/futurewei-cloud/alcor/pull/129#discussion_r393429233", "createdAt": "2020-03-17T03:43:51Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/db/ignite/IgniteCache.java", "diffHunk": "@@ -0,0 +1,74 @@\n+package com.futurewei.alcor.controller.db.ignite;\n+\n+import com.futurewei.alcor.controller.db.ICache;\n+import com.futurewei.alcor.controller.logging.Logger;\n+import com.futurewei.alcor.controller.logging.LoggerFactory;\n+import org.apache.ignite.cache.query.Query;\n+import org.apache.ignite.cache.query.QueryCursor;\n+import org.apache.ignite.cache.query.ScanQuery;\n+import org.apache.ignite.client.ClientCache;\n+import org.apache.ignite.client.ClientException;\n+import org.apache.ignite.client.IgniteClient;\n+import org.springframework.util.Assert;\n+\n+import javax.cache.Cache;\n+import java.util.Map;\n+import java.util.logging.Level;\n+import java.util.stream.Collectors;\n+\n+\n+public class IgniteCache<K, V> implements ICache<K, V> {\n+    private static final Logger logger = LoggerFactory.getLogger();\n+    private static final int QUERY_PAGE_SIZE = 1000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bff2a35081adfeec0d9051aae6b22a443a2de5"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyOTQ4Mw==", "bodyText": "Like this class!", "url": "https://github.com/futurewei-cloud/alcor/pull/129#discussion_r393429483", "createdAt": "2020-03-17T03:44:58Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/db/ICache.java", "diffHunk": "@@ -0,0 +1,18 @@\n+package com.futurewei.alcor.controller.db;\n+\n+import java.util.Map;\n+\n+public interface ICache<K, V> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bff2a35081adfeec0d9051aae6b22a443a2de5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQzMDIwNQ==", "bodyText": "The class name \"Database\" is a bit generic. Use something more specific like DB\nIf different microservices uses different template, how are we going to leverage this class? For example, VPC manager might use vpcTemplate, Subnet Manager might use subnetTemplate etc.", "url": "https://github.com/futurewei-cloud/alcor/pull/129#discussion_r393430205", "createdAt": "2020-03-17T03:48:13Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/db/Database.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package com.futurewei.alcor.controller.db;\n+\n+import com.futurewei.alcor.controller.db.ignite.IgniteCache;\n+import com.futurewei.alcor.controller.db.redis.RedisCache;\n+import com.futurewei.alcor.controller.model.PortState;\n+import com.futurewei.alcor.controller.model.SubnetState;\n+import com.futurewei.alcor.controller.model.VpcState;\n+import org.apache.ignite.client.IgniteClient;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.data.redis.core.RedisTemplate;\n+import org.springframework.stereotype.Component;\n+\n+@ComponentScan\n+@Component\n+public class Database {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40bff2a35081adfeec0d9051aae6b22a443a2de5"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ff34ff9b6d5cfc440bb1d5519a123ae4cf56d23", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/0ff34ff9b6d5cfc440bb1d5519a123ae4cf56d23", "committedDate": "2020-03-19T10:35:49Z", "message": "add transaction for db cahche and SSL for ignite connection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11af7fa64e8dead0e43c0e01dfa7fc4a9acaf981", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/11af7fa64e8dead0e43c0e01dfa7fc4a9acaf981", "committedDate": "2020-03-19T12:35:09Z", "message": "SSL for ignite connection is optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "874f5ebabad9fa5c776494a931ae176d2be5132f", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/874f5ebabad9fa5c776494a931ae176d2be5132f", "committedDate": "2020-03-20T03:17:19Z", "message": "Set the default value of ignite's SSL configuration to null"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODk2NjE3", "url": "https://github.com/futurewei-cloud/alcor/pull/129#pullrequestreview-380896617", "createdAt": "2020-03-25T07:05:46Z", "commit": {"oid": "874f5ebabad9fa5c776494a931ae176d2be5132f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwNzowNTo0N1rOF7OPXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwNzowNTo0N1rOF7OPXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY0MzYxMw==", "bodyText": "Revert this local change.", "url": "https://github.com/futurewei-cloud/alcor/pull/129#discussion_r397643613", "createdAt": "2020-03-25T07:05:47Z", "author": {"login": "xieus"}, "path": "src/resources/application.properties", "diffHunk": "@@ -1,11 +1,18 @@\n #Machine configuration\n alcor.machine.config=classpath:.\\\\config\\\\machine.json\n #Connecton configuration\n-spring.redis.host=localhost\n+spring.redis.host=192.168.131.131", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874f5ebabad9fa5c776494a931ae176d2be5132f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTAyMDkz", "url": "https://github.com/futurewei-cloud/alcor/pull/129#pullrequestreview-380902093", "createdAt": "2020-03-25T07:19:24Z", "commit": {"oid": "874f5ebabad9fa5c776494a931ae176d2be5132f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwNzoxOToyNVrOF7Ohzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwNzoxOToyNVrOF7Ohzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY0ODMzNA==", "bodyText": "Can you rename this directory from cache.repo to db.repo? Thanks.", "url": "https://github.com/futurewei-cloud/alcor/pull/129#discussion_r397648334", "createdAt": "2020-03-25T07:19:25Z", "author": {"login": "xieus"}, "path": "src/com/futurewei/alcor/controller/cache/repo/ICacheRepository.java", "diffHunk": "@@ -16,15 +16,17 @@\n \n package com.futurewei.alcor.controller.cache.repo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874f5ebabad9fa5c776494a931ae176d2be5132f"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTAzMTY3", "url": "https://github.com/futurewei-cloud/alcor/pull/129#pullrequestreview-380903167", "createdAt": "2020-03-25T07:22:07Z", "commit": {"oid": "874f5ebabad9fa5c776494a931ae176d2be5132f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "694a5b6500d957c42a133674c9b203fb44eae940", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/694a5b6500d957c42a133674c9b203fb44eae940", "committedDate": "2020-03-25T08:11:03Z", "message": "Rename the directory cache.repo to db.repo"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2370, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}