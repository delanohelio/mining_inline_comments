{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0Mjk3OTc2", "number": 484, "title": "[Contract] Update Contract for DNS/Router, Resolve Discrepancy", "bodyText": "This is a contract update which includes the below changes:\n\nUpdated dns entry and extra dhcp options in subnet.proto, remove the ones in dhcp.proto to avoid duplication\nRemoved default_routing_table in router.proto\nRemoved DPM code to populate network_type from port.proto per number 3 in #386\nDon't populate format_version and remove that field for all top level resources per number 4 in #386\nDon't populate project_id and remove that field for all top level resources except vpc\nper number 5 in #386\nChanged from MessageType to UpdateType for all resources per number 6 in #386", "createdAt": "2020-11-19T23:26:09Z", "url": "https://github.com/futurewei-cloud/alcor/pull/484", "merged": true, "mergeCommit": {"oid": "2d1490ddeb4bf18c537129bced7caf30d5a6d55a"}, "closed": true, "closedAt": "2020-11-22T18:51:54Z", "author": {"login": "er1cthe0ne"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeLMfrAH2gAyNTI0Mjk3OTc2OjA0MTI0MDI5NTYxNGU1NGM1OTAxNWIxYWE2ZWM1YmM4ZGMwNDdjZDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdegrliAFqTUzNTg1NDc2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "041240295614e54c59015b1aa6ec5bc8dc047cd7", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/041240295614e54c59015b1aa6ec5bc8dc047cd7", "committedDate": "2020-11-19T23:17:34Z", "message": "update contract per discussion, also address some point on #386"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0OTk5OTI0", "url": "https://github.com/futurewei-cloud/alcor/pull/484#pullrequestreview-534999924", "createdAt": "2020-11-20T01:03:24Z", "commit": {"oid": "041240295614e54c59015b1aa6ec5bc8dc047cd7"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMTowMzoyNVrOH25jAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwMToxMDozOVrOH25r0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMyODAwMA==", "bodyText": "This PR starts a good effort to cut our protobuf message size. \ud83d\udc4d", "url": "https://github.com/futurewei-cloud/alcor/pull/484#discussion_r527328000", "createdAt": "2020-11-20T01:03:25Z", "author": {"login": "xieus"}, "path": "schema/proto3/dhcp.proto", "diffHunk": "@@ -24,28 +24,15 @@ option java_outer_classname = \"DHCP\";\n import \"common.proto\";\n \n message DHCPConfiguration {\n-    uint32 format_version = 1;\n-    uint32 revision_number = 2;\n-\n-    string request_id = 3;\n-    MessageType message_type = 4; // DELTA (default) or FULL\n-    string subnet_id = 5;\n-    string mac_address = 6;\n-    string ipv4_address = 7;\n-    string ipv6_address = 8;\n-    string port_host_name = 9; // for local DNS response\n-\n-    message ExtraDhcpOption {\n-        string name = 1;\n-        string value = 2;\n-    }\n-\n-    message DnsEntry {\n-        string entry = 1;\n-    }\n-\n-    repeated ExtraDhcpOption extra_dhcp_options = 10;\n-    repeated DnsEntry dns_entry_list = 11;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "041240295614e54c59015b1aa6ec5bc8dc047cd7"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMyODE0OA==", "bodyText": "format_version and project id are all cut, right?", "url": "https://github.com/futurewei-cloud/alcor/pull/484#discussion_r527328148", "createdAt": "2020-11-20T01:04:00Z", "author": {"login": "xieus"}, "path": "schema/proto3/neighbor.proto", "diffHunk": "@@ -29,17 +29,15 @@ enum NeighborType {\n }\n \n message NeighborConfiguration {\n-    uint32 format_version = 1;\n-    uint32 revision_number = 2;\n-\n-    string request_id = 3;\n-    string id = 4;\n-    MessageType message_type = 5; // DELTA (default) or FULL\n-    string project_id = 6;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "041240295614e54c59015b1aa6ec5bc8dc047cd7"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMyOTMxMQ==", "bodyText": "Instead of \"!!!\", let us use //TODO to remind us for real.", "url": "https://github.com/futurewei-cloud/alcor/pull/484#discussion_r527329311", "createdAt": "2020-11-20T01:07:49Z", "author": {"login": "xieus"}, "path": "services/data_plane_manager/src/main/java/com/futurewei/alcor/dataplane/service/ovs/DataPlaneServiceImpl.java", "diffHunk": "@@ -266,10 +252,8 @@ private void buildPortState(NetworkConfiguration networkConfig, List<InternalPor\n \n     private NeighborState buildNeighborState(NeighborEntry neighborEntry, NeighborInfo neighborInfo, OperationType operationType) {\n         NeighborConfiguration.Builder neighborConfigBuilder = NeighborConfiguration.newBuilder();\n-        neighborConfigBuilder.setFormatVersion(FORMAT_REVISION_NUMBER);\n         neighborConfigBuilder.setRevisionNumber(FORMAT_REVISION_NUMBER);\n-        //neighborConfigBuilder.setId();\n-        //neighborConfigBuilder.setProjectId();\n+        //neighborConfigBuilder.setId(); // !!!We are going to need this per latest ACA change!!!", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "041240295614e54c59015b1aa6ec5bc8dc047cd7"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMyOTQ3Ng==", "bodyText": "@kevin-zhonghao can help to add this in next DPM change.", "url": "https://github.com/futurewei-cloud/alcor/pull/484#discussion_r527329476", "createdAt": "2020-11-20T01:08:25Z", "author": {"login": "xieus"}, "path": "services/data_plane_manager/src/main/java/com/futurewei/alcor/dataplane/service/ovs/DataPlaneServiceImpl.java", "diffHunk": "@@ -266,10 +252,8 @@ private void buildPortState(NetworkConfiguration networkConfig, List<InternalPor\n \n     private NeighborState buildNeighborState(NeighborEntry neighborEntry, NeighborInfo neighborInfo, OperationType operationType) {\n         NeighborConfiguration.Builder neighborConfigBuilder = NeighborConfiguration.newBuilder();\n-        neighborConfigBuilder.setFormatVersion(FORMAT_REVISION_NUMBER);\n         neighborConfigBuilder.setRevisionNumber(FORMAT_REVISION_NUMBER);\n-        //neighborConfigBuilder.setId();\n-        //neighborConfigBuilder.setProjectId();\n+        //neighborConfigBuilder.setId(); // !!!We are going to need this per latest ACA change!!!", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMyOTMxMQ=="}, "originalCommit": {"oid": "041240295614e54c59015b1aa6ec5bc8dc047cd7"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMzMDA0Mg==", "bodyText": "sorry what is this about?", "url": "https://github.com/futurewei-cloud/alcor/pull/484#discussion_r527330042", "createdAt": "2020-11-20T01:10:01Z", "author": {"login": "xieus"}, "path": "services/data_plane_manager/src/main/java/com/futurewei/alcor/dataplane/utils/GoalStateManager.java", "diffHunk": "@@ -32,6 +32,7 @@\n \n @Component\n public class GoalStateManager {\n+  public static final int GOAL_STATE_MESSAGE_FORMAT_VERSION = 101;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "041240295614e54c59015b1aa6ec5bc8dc047cd7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMzMDI1OQ==", "bodyText": "Let us add //TODO to remind us we need to set DNS based on latest contract.", "url": "https://github.com/futurewei-cloud/alcor/pull/484#discussion_r527330259", "createdAt": "2020-11-20T01:10:39Z", "author": {"login": "xieus"}, "path": "services/data_plane_manager/src/test/java/com/futurewei/alcor/dataplane/utils/DataPlaneManagerUtil.java", "diffHunk": "@@ -443,13 +441,6 @@ private void buildSubnetState(NetworkConfiguration networkConfig, Goalstate.Goal\n             if (subnetEntity.getAvailabilityZone() != null) {\n                 subnetConfigBuilder.setAvailabilityZone(subnetEntity.getAvailabilityZone());\n             }\n-            if (subnetEntity.getPrimaryDns() != null) {\n-                subnetConfigBuilder.setPrimaryDns(subnetEntity.getPrimaryDns());\n-            }\n-\n-            if (subnetEntity.getSecondaryDns() != null) {\n-                subnetConfigBuilder.setSecondaryDns(subnetEntity.getSecondaryDns());\n-            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "041240295614e54c59015b1aa6ec5bc8dc047cd7"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c77c84a312f0a0a6be9548f1faaf0cf122577cd4", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/c77c84a312f0a0a6be9548f1faaf0cf122577cd4", "committedDate": "2020-11-20T01:49:59Z", "message": "update per PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdbd9410369d947caf314a0223e92db8bc0c72b1", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/fdbd9410369d947caf314a0223e92db8bc0c72b1", "committedDate": "2020-11-20T04:52:30Z", "message": "update per PR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MTMwMzY1", "url": "https://github.com/futurewei-cloud/alcor/pull/484#pullrequestreview-535130365", "createdAt": "2020-11-20T05:46:09Z", "commit": {"oid": "fdbd9410369d947caf314a0223e92db8bc0c72b1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNTo0NjowOVrOH2_h9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNTo1NjozNlrOH3AHzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQyNjAzOA==", "bodyText": "Please add //TODO comment as well as this is the v2.0 implementation.", "url": "https://github.com/futurewei-cloud/alcor/pull/484#discussion_r527426038", "createdAt": "2020-11-20T05:46:09Z", "author": {"login": "xieus"}, "path": "services/data_plane_manager/src/main/java/com/futurewei/alcor/dataplane/service/ovs/DataPlaneServiceImpl.java", "diffHunk": "@@ -191,14 +189,6 @@ private void buildSubnetStates(NetworkConfiguration networkConfig, UnicastGoalSt\n                 subnetConfigBuilder.setAvailabilityZone(subnetEntity.getAvailabilityZone());\n             }\n \n-            if (subnetEntity.getPrimaryDns() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdbd9410369d947caf314a0223e92db8bc0c72b1"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQzNTcyNg==", "bodyText": "Sure. Here are three steps to make the change:\n(1) Define a configuration in application.properties with default value\nhttps://github.com/futurewei-cloud/alcor/blob/master/services/data_plane_manager/src/main/resources/application.properties\n(2) \"Autowire\" the configuration to a java config class\nhttps://github.com/futurewei-cloud/alcor/blob/master/services/data_plane_manager/src/main/java/com/futurewei/alcor/dataplane/config/Config.java\n(3) Assign the config value in the code to a local variable, for example,\n\n  \n    \n      alcor/services/data_plane_manager/src/main/java/com/futurewei/alcor/dataplane/client/grpc/DataPlaneClientImpl.java\n    \n    \n         Line 49\n      in\n      ff19c6b\n    \n    \n    \n    \n\n        \n          \n           public DataPlaneClientImpl(Config globalConfig) {", "url": "https://github.com/futurewei-cloud/alcor/pull/484#discussion_r527435726", "createdAt": "2020-11-20T05:56:36Z", "author": {"login": "xieus"}, "path": "services/data_plane_manager/src/main/java/com/futurewei/alcor/dataplane/utils/GoalStateManager.java", "diffHunk": "@@ -32,6 +32,7 @@\n \n @Component\n public class GoalStateManager {\n+  public static final int GOAL_STATE_MESSAGE_FORMAT_VERSION = 101;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMzMDA0Mg=="}, "originalCommit": {"oid": "041240295614e54c59015b1aa6ec5bc8dc047cd7"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "687fd215e66ac9765ce0ceaa0e3d17799ded35e3", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/687fd215e66ac9765ce0ceaa0e3d17799ded35e3", "committedDate": "2020-11-20T22:18:46Z", "message": "update per PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ad136b5ba6f6d873968674be96540b8312500c8", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/1ad136b5ba6f6d873968674be96540b8312500c8", "committedDate": "2020-11-20T23:39:41Z", "message": "change MessageType to UpdateType in all proto files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODU0NzY3", "url": "https://github.com/futurewei-cloud/alcor/pull/484#pullrequestreview-535854767", "createdAt": "2020-11-21T00:19:32Z", "commit": {"oid": "1ad136b5ba6f6d873968674be96540b8312500c8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2037, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}