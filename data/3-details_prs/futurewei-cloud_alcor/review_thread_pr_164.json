{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNzc4NzA2", "number": 164, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDozMTo1MFrODyGXYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwMDo0NDoxNVrODzSjrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODU5NjgzOnYy", "diffSide": "RIGHT", "path": "services/ip_manager/.gitignore", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDozMTo1MFrOGF8kvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDozMTo1MFrOGF8kvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg4ODUxMQ==", "bodyText": "General comment: let us use \"private_ip_manager\" for the directory name.", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r408888511", "createdAt": "2020-04-15T14:31:50Z", "author": {"login": "xieus"}, "path": "services/ip_manager/.gitignore", "diffHunk": "@@ -0,0 +1,31 @@\n+HELP.md\n+target/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "093440a0e001194fadf456943d1a81c7de7dd3d5"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODU5OTA5OnYy", "diffSide": "RIGHT", "path": "services/ip_manager/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDozMjoyMVrOGF8mPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDozMjoyMVrOGF8mPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg4ODg5NQ==", "bodyText": "like the pom file! no extra dependencies.", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r408888895", "createdAt": "2020-04-15T14:32:21Z", "author": {"login": "xieus"}, "path": "services/ip_manager/pom.xml", "diffHunk": "@@ -0,0 +1,61 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>org.springframework.boot</groupId>\n+        <artifactId>spring-boot-starter-parent</artifactId>\n+        <version>2.2.6.RELEASE</version>\n+        <relativePath/> <!-- lookup parent from repository -->\n+    </parent>\n+    <groupId>com.futurewei.alcor</groupId>\n+    <artifactId>ipmanager</artifactId>\n+    <version>0.0.1-SNAPSHOT</version>\n+    <name>ipmanager</name>\n+    <description>ip manager micrservice</description>\n+\n+    <properties>\n+        <java.version>1.8</java.version>\n+    </properties>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-web</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "093440a0e001194fadf456943d1a81c7de7dd3d5"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODYwNjA0OnYy", "diffSide": "RIGHT", "path": "services/ip_manager/src/main/java/com/futurewei/alcor/ipmanager/controller/Ipv4AddrController.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDozMzozOFrOGF8qcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDozMzozOFrOGF8qcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg4OTk3MQ==", "bodyText": "Seems the first iteration focuses on IPv4, which is totally fine. IPv6 will also be supported, right?", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r408889971", "createdAt": "2020-04-15T14:33:38Z", "author": {"login": "xieus"}, "path": "services/ip_manager/src/main/java/com/futurewei/alcor/ipmanager/controller/Ipv4AddrController.java", "diffHunk": "@@ -0,0 +1,168 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.ipmanager.controller;\n+import com.futurewei.alcor.ipmanager.entity.Ipv4AddrState;\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRequest;\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRangeRequest;\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRequestBulk;\n+import com.futurewei.alcor.ipmanager.http.status.Ipv4AddrInvalidException;\n+import com.futurewei.alcor.ipmanager.http.status.Ipv4AddrRangeInvalidException;\n+import com.futurewei.alcor.ipmanager.http.status.Ipv4AddrStateInvalidException;\n+import com.futurewei.alcor.ipmanager.http.status.SubnetIdInvalidException;\n+import com.futurewei.alcor.ipmanager.service.Ipv4AddrService;\n+import com.futurewei.alcor.utils.Ipv4AddrUtil;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.util.Map;\n+\n+\n+@RestController\n+public class Ipv4AddrController {\n+    @Autowired\n+    Ipv4AddrService ipv4AddrService;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "093440a0e001194fadf456943d1a81c7de7dd3d5"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODYwOTk5OnYy", "diffSide": "RIGHT", "path": "services/ip_manager/src/main/java/com/futurewei/alcor/ipmanager/controller/Ipv4AddrController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDozNDoyNVrOGF8s6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNjo0MTozOVrOGHBtfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5MDYwMQ==", "bodyText": "When you get a chance, please include the design doc in the PR as well. Thanks.", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r408890601", "createdAt": "2020-04-15T14:34:25Z", "author": {"login": "xieus"}, "path": "services/ip_manager/src/main/java/com/futurewei/alcor/ipmanager/controller/Ipv4AddrController.java", "diffHunk": "@@ -0,0 +1,168 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.ipmanager.controller;\n+import com.futurewei.alcor.ipmanager.entity.Ipv4AddrState;\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRequest;\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRangeRequest;\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRequestBulk;\n+import com.futurewei.alcor.ipmanager.http.status.Ipv4AddrInvalidException;\n+import com.futurewei.alcor.ipmanager.http.status.Ipv4AddrRangeInvalidException;\n+import com.futurewei.alcor.ipmanager.http.status.Ipv4AddrStateInvalidException;\n+import com.futurewei.alcor.ipmanager.http.status.SubnetIdInvalidException;\n+import com.futurewei.alcor.ipmanager.service.Ipv4AddrService;\n+import com.futurewei.alcor.utils.Ipv4AddrUtil;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.util.Map;\n+\n+\n+@RestController\n+public class Ipv4AddrController {\n+    @Autowired\n+    Ipv4AddrService ipv4AddrService;\n+\n+    private void checkSubnetId(String subnetId) throws SubnetIdInvalidException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "093440a0e001194fadf456943d1a81c7de7dd3d5"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAyMTI0NA==", "bodyText": "Can you update concurrency handling section? When multiple clients try to allocate IPs from the same subnet, it could potentially get the same IPs. how do you handle this situation?", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r410021244", "createdAt": "2020-04-17T06:41:39Z", "author": {"login": "xieus"}, "path": "services/ip_manager/src/main/java/com/futurewei/alcor/ipmanager/controller/Ipv4AddrController.java", "diffHunk": "@@ -0,0 +1,168 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.ipmanager.controller;\n+import com.futurewei.alcor.ipmanager.entity.Ipv4AddrState;\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRequest;\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRangeRequest;\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRequestBulk;\n+import com.futurewei.alcor.ipmanager.http.status.Ipv4AddrInvalidException;\n+import com.futurewei.alcor.ipmanager.http.status.Ipv4AddrRangeInvalidException;\n+import com.futurewei.alcor.ipmanager.http.status.Ipv4AddrStateInvalidException;\n+import com.futurewei.alcor.ipmanager.http.status.SubnetIdInvalidException;\n+import com.futurewei.alcor.ipmanager.service.Ipv4AddrService;\n+import com.futurewei.alcor.utils.Ipv4AddrUtil;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.util.Map;\n+\n+\n+@RestController\n+public class Ipv4AddrController {\n+    @Autowired\n+    Ipv4AddrService ipv4AddrService;\n+\n+    private void checkSubnetId(String subnetId) throws SubnetIdInvalidException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5MDYwMQ=="}, "originalCommit": {"oid": "093440a0e001194fadf456943d1a81c7de7dd3d5"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODYxNTI0OnYy", "diffSide": "RIGHT", "path": "services/ip_manager/src/test/java/com/futurewei/alcor/ipmanager/IpManagerApplicationTests.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDozNTozM1rOGF8wQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwMzozNTozOFrOGJhyiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5MTQ1Ng==", "bodyText": "Let us plan to add more UTs as well.", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r408891456", "createdAt": "2020-04-15T14:35:33Z", "author": {"login": "xieus"}, "path": "services/ip_manager/src/test/java/com/futurewei/alcor/ipmanager/IpManagerApplicationTests.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.futurewei.alcor.ipmanager;\n+\n+import org.junit.jupiter.api.Test;\n+import org.springframework.boot.test.context.SpringBootTest;\n+\n+@SpringBootTest\n+class IpManagerApplicationTests {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "093440a0e001194fadf456943d1a81c7de7dd3d5"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDAyMTI5Mw==", "bodyText": "+1", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r410021293", "createdAt": "2020-04-17T06:41:49Z", "author": {"login": "xieus"}, "path": "services/ip_manager/src/test/java/com/futurewei/alcor/ipmanager/IpManagerApplicationTests.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.futurewei.alcor.ipmanager;\n+\n+import org.junit.jupiter.api.Test;\n+import org.springframework.boot.test.context.SpringBootTest;\n+\n+@SpringBootTest\n+class IpManagerApplicationTests {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5MTQ1Ng=="}, "originalCommit": {"oid": "093440a0e001194fadf456943d1a81c7de7dd3d5"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY0Mzk3Ng==", "bodyText": "One general comment: We will need to verify the response as well. We could do it later.", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r412643976", "createdAt": "2020-04-22T03:35:38Z", "author": {"login": "xieus"}, "path": "services/ip_manager/src/test/java/com/futurewei/alcor/ipmanager/IpManagerApplicationTests.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.futurewei.alcor.ipmanager;\n+\n+import org.junit.jupiter.api.Test;\n+import org.springframework.boot.test.context.SpringBootTest;\n+\n+@SpringBootTest\n+class IpManagerApplicationTests {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5MTQ1Ng=="}, "originalCommit": {"oid": "093440a0e001194fadf456943d1a81c7de7dd3d5"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODYyMTI2OnYy", "diffSide": "RIGHT", "path": "services/ip_manager/src/main/java/com/futurewei/alcor/ipmanager/service/Ipv4AddrService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDozNjo1NVrOGF80Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDozNjo1NVrOGF80Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5MjQ1MA==", "bodyText": "For IPv4AddrService, I would suggest to split into two layers, service layer and service impl layer.\nService Layer: Show the interface\nService Impl Layer: Show the implementation of the interface. This design allows different implementations later on.\nOne example of the above design is SubnetManager:\nhttps://github.com/kevin-zhonghao/alcor/tree/feature/route_manager/services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/service", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r408892450", "createdAt": "2020-04-15T14:36:55Z", "author": {"login": "xieus"}, "path": "services/ip_manager/src/main/java/com/futurewei/alcor/ipmanager/service/Ipv4AddrService.java", "diffHunk": "@@ -0,0 +1,420 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.ipmanager.service;\n+\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRequest;\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRangeRequest;\n+import com.futurewei.alcor.ipmanager.entity.Ipv4AddrState;\n+import com.futurewei.alcor.ipmanager.entity.Ipv4AddrAlloc;\n+import com.futurewei.alcor.ipmanager.entity.Ipv4AddrRange;\n+import com.futurewei.alcor.ipmanager.http.Ipv4AddrRequestBulk;\n+import com.futurewei.alcor.ipmanager.http.status.*;\n+import com.futurewei.alcor.ipmanager.repo.Ipv4AddrRangeRepo;\n+import com.futurewei.alcor.ipmanager.repo.Ipv4AddrRepo;\n+import com.futurewei.alcor.utils.Ipv4AddrUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import java.util.*;\n+import java.util.stream.Collectors;\n+\n+\n+@Service\n+public class Ipv4AddrService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "093440a0e001194fadf456943d1a81c7de7dd3d5"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MTA1NTMzOnYy", "diffSide": "RIGHT", "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/allocator/Ipv4AddrAllocator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwMDoyNTozN1rOGHv9gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwMTo0MDo1OFrOGIAA9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc3OTAxMA==", "bodyText": "Let us add a section on the design doc about the allocation algorithm :-)", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r410779010", "createdAt": "2020-04-19T00:25:37Z", "author": {"login": "xieus"}, "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/allocator/Ipv4AddrAllocator.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.privateipmanager.allocator;\n+\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrInvalidException;\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrNotEnoughException;\n+import com.futurewei.alcor.privateipmanager.utils.Ipv4AddrUtil;\n+\n+import java.util.*;\n+\n+public class Ipv4AddrAllocator implements IpAddrAllocator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "652e6122f517cffecfa66993d2e20e1bf13282ff"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTA0MjAzOA==", "bodyText": "okay\uff0cI will do that.", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r411042038", "createdAt": "2020-04-20T01:40:58Z", "author": {"login": "chenpiaoping"}, "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/allocator/Ipv4AddrAllocator.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.privateipmanager.allocator;\n+\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrInvalidException;\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrNotEnoughException;\n+import com.futurewei.alcor.privateipmanager.utils.Ipv4AddrUtil;\n+\n+import java.util.*;\n+\n+public class Ipv4AddrAllocator implements IpAddrAllocator {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc3OTAxMA=="}, "originalCommit": {"oid": "652e6122f517cffecfa66993d2e20e1bf13282ff"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MTA2NzQ3OnYy", "diffSide": "RIGHT", "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/repo/IpAddrRangeRepo.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwMDozNToxMlrOGHwCrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTozNjozOFrOGIzUsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc4MDMzNA==", "bodyText": "The key here is the subnet Id. How about multiple ip ranges per subnet?", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r410780334", "createdAt": "2020-04-19T00:35:12Z", "author": {"login": "xieus"}, "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/repo/IpAddrRangeRepo.java", "diffHunk": "@@ -0,0 +1,259 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.privateipmanager.repo;\n+\n+import com.futurewei.alcor.common.db.CacheFactory;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;\n+import com.futurewei.alcor.common.repo.ICacheRepository;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrAlloc;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrRange;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrRangeRequest;\n+import com.futurewei.alcor.privateipmanager.exception.InternalDbOperationException;\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrRangeNotFoundException;\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrRangeExistException;\n+import com.futurewei.alcor.privateipmanager.exception.SubnetNotFoundException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+import com.futurewei.alcor.common.db.CacheException;\n+import javax.annotation.PostConstruct;\n+import java.util.*;\n+\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+@Repository\n+public class IpAddrRangeRepo implements ICacheRepository<IpAddrRange> {\n+    private static final Logger LOG = LoggerFactory.getLogger(IpAddrRangeRepo.class);\n+    private ICache<String, IpAddrRange> ipAddrRangeCache;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "652e6122f517cffecfa66993d2e20e1bf13282ff"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAzNzU1Nw==", "bodyText": "I think an ip range is actually a subnet , maybe i should called it rangeId instead of subnetId?", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r411037557", "createdAt": "2020-04-20T01:21:06Z", "author": {"login": "chenpiaoping"}, "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/repo/IpAddrRangeRepo.java", "diffHunk": "@@ -0,0 +1,259 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.privateipmanager.repo;\n+\n+import com.futurewei.alcor.common.db.CacheFactory;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;\n+import com.futurewei.alcor.common.repo.ICacheRepository;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrAlloc;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrRange;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrRangeRequest;\n+import com.futurewei.alcor.privateipmanager.exception.InternalDbOperationException;\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrRangeNotFoundException;\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrRangeExistException;\n+import com.futurewei.alcor.privateipmanager.exception.SubnetNotFoundException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+import com.futurewei.alcor.common.db.CacheException;\n+import javax.annotation.PostConstruct;\n+import java.util.*;\n+\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+@Repository\n+public class IpAddrRangeRepo implements ICacheRepository<IpAddrRange> {\n+    private static final Logger LOG = LoggerFactory.getLogger(IpAddrRangeRepo.class);\n+    private ICache<String, IpAddrRange> ipAddrRangeCache;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc4MDMzNA=="}, "originalCommit": {"oid": "652e6122f517cffecfa66993d2e20e1bf13282ff"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg3Nzc2OQ==", "bodyText": "Hmm, a subnet could have at least one Ipv4 range and one Ipv6 range.", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r411877769", "createdAt": "2020-04-21T05:23:15Z", "author": {"login": "xieus"}, "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/repo/IpAddrRangeRepo.java", "diffHunk": "@@ -0,0 +1,259 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.privateipmanager.repo;\n+\n+import com.futurewei.alcor.common.db.CacheFactory;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;\n+import com.futurewei.alcor.common.repo.ICacheRepository;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrAlloc;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrRange;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrRangeRequest;\n+import com.futurewei.alcor.privateipmanager.exception.InternalDbOperationException;\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrRangeNotFoundException;\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrRangeExistException;\n+import com.futurewei.alcor.privateipmanager.exception.SubnetNotFoundException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+import com.futurewei.alcor.common.db.CacheException;\n+import javax.annotation.PostConstruct;\n+import java.util.*;\n+\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+@Repository\n+public class IpAddrRangeRepo implements ICacheRepository<IpAddrRange> {\n+    private static final Logger LOG = LoggerFactory.getLogger(IpAddrRangeRepo.class);\n+    private ICache<String, IpAddrRange> ipAddrRangeCache;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc4MDMzNA=="}, "originalCommit": {"oid": "652e6122f517cffecfa66993d2e20e1bf13282ff"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg4MjY3NQ==", "bodyText": "Use RangeId as the key sounds better. We could add an ID field in the IpAddrRange class.", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r411882675", "createdAt": "2020-04-21T05:36:38Z", "author": {"login": "xieus"}, "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/repo/IpAddrRangeRepo.java", "diffHunk": "@@ -0,0 +1,259 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.privateipmanager.repo;\n+\n+import com.futurewei.alcor.common.db.CacheFactory;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;\n+import com.futurewei.alcor.common.repo.ICacheRepository;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrAlloc;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrRange;\n+import com.futurewei.alcor.privateipmanager.entity.IpAddrRangeRequest;\n+import com.futurewei.alcor.privateipmanager.exception.InternalDbOperationException;\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrRangeNotFoundException;\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrRangeExistException;\n+import com.futurewei.alcor.privateipmanager.exception.SubnetNotFoundException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+import com.futurewei.alcor.common.db.CacheException;\n+import javax.annotation.PostConstruct;\n+import java.util.*;\n+\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+@Repository\n+public class IpAddrRangeRepo implements ICacheRepository<IpAddrRange> {\n+    private static final Logger LOG = LoggerFactory.getLogger(IpAddrRangeRepo.class);\n+    private ICache<String, IpAddrRange> ipAddrRangeCache;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc4MDMzNA=="}, "originalCommit": {"oid": "652e6122f517cffecfa66993d2e20e1bf13282ff"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MTA4MDE1OnYy", "diffSide": "RIGHT", "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/allocator/IpAddrAllocator.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwMDo0NDoxNVrOGHwIEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNTowMzoxNVrOGIyntg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc4MTcxNQ==", "bodyText": "validate?", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r410781715", "createdAt": "2020-04-19T00:44:15Z", "author": {"login": "xieus"}, "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/allocator/IpAddrAllocator.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.privateipmanager.allocator;\n+\n+\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrNotEnoughException;\n+\n+import java.util.List;\n+\n+public interface IpAddrAllocator {\n+\n+    String allocate() throws Exception;\n+\n+    List<String> allocateBulk(int num) throws IpAddrNotEnoughException, Exception;\n+\n+    void release(String ipAddr) throws Exception;\n+\n+    void releaseBulk(List<String> ipAddrList) throws Exception;\n+\n+    boolean valid(String ipv4Addr);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d6b6cec936aa2766490eebff725e00fac927196"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAzOTY4Ng==", "bodyText": "This method checks whether the  ipv4Addr is valid in this ip range, which means greater than or equal to firstAddr and less than or equal to lastAddr.", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r411039686", "createdAt": "2020-04-20T01:30:25Z", "author": {"login": "chenpiaoping"}, "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/allocator/IpAddrAllocator.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.privateipmanager.allocator;\n+\n+\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrNotEnoughException;\n+\n+import java.util.List;\n+\n+public interface IpAddrAllocator {\n+\n+    String allocate() throws Exception;\n+\n+    List<String> allocateBulk(int num) throws IpAddrNotEnoughException, Exception;\n+\n+    void release(String ipAddr) throws Exception;\n+\n+    void releaseBulk(List<String> ipAddrList) throws Exception;\n+\n+    boolean valid(String ipv4Addr);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc4MTcxNQ=="}, "originalCommit": {"oid": "9d6b6cec936aa2766490eebff725e00fac927196"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg3MTE1OA==", "bodyText": "Correct. I meant to use the verb \"validate\" as the method name to be consistent with other names.", "url": "https://github.com/futurewei-cloud/alcor/pull/164#discussion_r411871158", "createdAt": "2020-04-21T05:03:15Z", "author": {"login": "xieus"}, "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/allocator/IpAddrAllocator.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.privateipmanager.allocator;\n+\n+\n+import com.futurewei.alcor.privateipmanager.exception.IpAddrNotEnoughException;\n+\n+import java.util.List;\n+\n+public interface IpAddrAllocator {\n+\n+    String allocate() throws Exception;\n+\n+    List<String> allocateBulk(int num) throws IpAddrNotEnoughException, Exception;\n+\n+    void release(String ipAddr) throws Exception;\n+\n+    void releaseBulk(List<String> ipAddrList) throws Exception;\n+\n+    boolean valid(String ipv4Addr);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc4MTcxNQ=="}, "originalCommit": {"oid": "9d6b6cec936aa2766490eebff725e00fac927196"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4716, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}