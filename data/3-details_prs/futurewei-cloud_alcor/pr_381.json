{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzMTc1MTQw", "number": 381, "title": "[DPM/ACA Schema] Update Routing_rules and Add RoutingRuleExtraInfo Message", "bodyText": "This is a proposal of DPM/ACA contract change to support routing rules in Alcor Control Agent. In a high-level, routing rules are use for:\n\ninternet - route to sent to internet gateway\ncustom gateway\ncustom host route\ncross VPC - route to VPC (peering) gateway\n\nNotable changes includes\n\nUpdate routing_rules message to include NextHopInfo for looking up with additional needed information.\nRemove the neighbor host DVR mac for L3 neighbor configuration as an optimization\nUpdate the router e2e workflow accordingly", "createdAt": "2020-09-09T22:30:32Z", "url": "https://github.com/futurewei-cloud/alcor/pull/381", "merged": true, "mergeCommit": {"oid": "30ec1f2f52b84c33d5cacefc3bdd456f6aea7b80"}, "closed": true, "closedAt": "2020-09-11T01:10:11Z", "author": {"login": "er1cthe0ne"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHT3LLAH2gAyNDgzMTc1MTQwOjFlMjY5NWYzMjc4M2U4ZjkxMjYxMGJlY2JjMzliMDZjNzdkMTdiYzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHqu54gFqTQ4NjQwNTM5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1e2695f32783e8f912610becbc39b06c77d17bc2", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/1e2695f32783e8f912610becbc39b06c77d17bc2", "committedDate": "2020-09-09T22:23:10Z", "message": "added new NextHopInfo message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4266c86083fe2f028c7c80a2ad832f15a7c7305b", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/4266c86083fe2f028c7c80a2ad832f15a7c7305b", "committedDate": "2020-09-10T02:33:46Z", "message": "remove neighbor_host_dvr_mac"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b961f0edee1adc81d28ab0c79fa85533f20ea9b", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/0b961f0edee1adc81d28ab0c79fa85533f20ea9b", "committedDate": "2020-09-10T18:56:00Z", "message": "update per discussion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a64d8cf203c4cfe224a26696b5a6484f1e36b329", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/a64d8cf203c4cfe224a26696b5a6484f1e36b329", "committedDate": "2020-09-10T20:06:33Z", "message": "update router e2e workflow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MzM5MDgy", "url": "https://github.com/futurewei-cloud/alcor/pull/381#pullrequestreview-486339082", "createdAt": "2020-09-10T21:58:06Z", "commit": {"oid": "a64d8cf203c4cfe224a26696b5a6484f1e36b329"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMTo1ODowNlrOHQHKxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMTo1ODowNlrOHQHKxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY1NjcwOQ==", "bodyText": "Do we expect this has to be IP, or could be others like a label?", "url": "https://github.com/futurewei-cloud/alcor/pull/381#discussion_r486656709", "createdAt": "2020-09-10T21:58:06Z", "author": {"login": "xieus"}, "path": "schema/proto3/router.proto", "diffHunk": "@@ -32,13 +37,19 @@ message RouterConfiguration {\n     MessageType message_type = 5; // DELTA (default) or FULL\n     string host_dvr_mac_address = 6;\n \n+    message RoutingRuleExtraInfo{\n+        DestinationType destination_type = 1;\n+        string next_hop_mac = 2;\n+        }\n+\n     message RoutingRule {\n         OperationType operation_type = 1;\n         string id = 2;\n         string name = 3;\n-        string destination = 4;\n-        string nextHop = 5;\n+        string destination = 4;  // destination IP, could be 154.12.42.24/32 (host address) or 0.0.0.0/0 (network address)\n+        string next_hop_ip = 5;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a64d8cf203c4cfe224a26696b5a6484f1e36b329"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NDA1Mzk3", "url": "https://github.com/futurewei-cloud/alcor/pull/381#pullrequestreview-486405397", "createdAt": "2020-09-11T00:58:23Z", "commit": {"oid": "a64d8cf203c4cfe224a26696b5a6484f1e36b329"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMDo1ODoyM1rOHQKl1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMDo1ODoyM1rOHQKl1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjcxMjc4OA==", "bodyText": "Okay thanks for the confirmation.\nKeep in mind that this change will ask an upstream microservices (either RM or others) to read the user-input rules (which uses next_hop) and convert the customer object into an infra object (with next_hop_ip).", "url": "https://github.com/futurewei-cloud/alcor/pull/381#discussion_r486712788", "createdAt": "2020-09-11T00:58:23Z", "author": {"login": "xieus"}, "path": "schema/proto3/router.proto", "diffHunk": "@@ -32,13 +37,19 @@ message RouterConfiguration {\n     MessageType message_type = 5; // DELTA (default) or FULL\n     string host_dvr_mac_address = 6;\n \n+    message RoutingRuleExtraInfo{\n+        DestinationType destination_type = 1;\n+        string next_hop_mac = 2;\n+        }\n+\n     message RoutingRule {\n         OperationType operation_type = 1;\n         string id = 2;\n         string name = 3;\n-        string destination = 4;\n-        string nextHop = 5;\n+        string destination = 4;  // destination IP, could be 154.12.42.24/32 (host address) or 0.0.0.0/0 (network address)\n+        string next_hop_ip = 5;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY1NjcwOQ=="}, "originalCommit": {"oid": "a64d8cf203c4cfe224a26696b5a6484f1e36b329"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1938, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}