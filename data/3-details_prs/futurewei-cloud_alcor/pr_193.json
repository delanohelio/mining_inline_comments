{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MTYyMzQw", "number": 193, "title": "[Schema Update] Schema Support for OVS and DHCP", "bodyText": "This is the initial schema update to support OVS. The high-level ideas are:\n\nAdded fields needed to support OVS port configuration update\nAdded DHCP configuration\nKeep mizar support for so that it is not a major breaking change for Alcor Control Agent, because ACA still using it for its unit/functional tests\n\nNOTE: It is a draft with a lot of \"FIXME\" comments for internal discussions.", "createdAt": "2020-05-14T18:04:36Z", "url": "https://github.com/futurewei-cloud/alcor/pull/193", "merged": true, "mergeCommit": {"oid": "d0d5c193c13c68713915d1a34ec9a6600ffebe19"}, "closed": true, "closedAt": "2020-05-22T05:53:21Z", "author": {"login": "er1cthe0ne"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchRWVjAH2gAyNDE4MTYyMzQwOjU5NzEyMDI3YTZmMjQ4YTkzYmFjNzJiMjAwYTljY2Y2OTZkMjM5MGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjnjhsAFqTQxNjU4NDM3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "59712027a6f248a93bac72b200a9ccf696d2390b", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/59712027a6f248a93bac72b200a9ccf696d2390b", "committedDate": "2020-05-14T17:58:22Z", "message": "initial schema update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDg1Njgz", "url": "https://github.com/futurewei-cloud/alcor/pull/193#pullrequestreview-412085683", "createdAt": "2020-05-14T18:40:57Z", "commit": {"oid": "59712027a6f248a93bac72b200a9ccf696d2390b"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODo0MDo1N1rOGVpgwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODo0ODo0MlrOGVpyYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM1MzQxMA==", "bodyText": "CREATE_UPDATE_SWITCH and CREATE_UPDATE_ROUTER shouldn't be used for OVS scenarios. CREATE_UPDATE_GATEWAY might be. Let us discuss.", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r425353410", "createdAt": "2020-05-14T18:40:57Z", "author": {"login": "xieus"}, "path": "schema/proto3/common.proto", "diffHunk": "@@ -34,10 +35,11 @@ enum OperationType {\n     GET = 2;\n     DELETE = 3;\n     INFO = 4;\n-    FINALIZE = 5;\n-    CREATE_UPDATE_SWITCH = 6;\n+    FINALIZE = 5; // FIXME: we will try to the whole port operation in the FINALIZE call\n+    CREATE_UPDATE_SWITCH = 6; // FIXME: I don't think we need this for OVS?\n     CREATE_UPDATE_ROUTER = 7;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59712027a6f248a93bac72b200a9ccf696d2390b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM1Mzc4OQ==", "bodyText": "Is it worth mentioning VXLAN-GPE here?", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r425353789", "createdAt": "2020-05-14T18:41:34Z", "author": {"login": "xieus"}, "path": "schema/proto3/common.proto", "diffHunk": "@@ -58,3 +60,10 @@ enum Protocol {\n     HTTP = 3;\n     ARP = 4;\n }\n+\n+enum NetworkType { \n+    VXLAN = 0; // the default type\n+    VLAN = 1;\n+    GRE = 2;\n+    GENEVE = 3;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59712027a6f248a93bac72b200a9ccf696d2390b"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM1NDQ0MQ==", "bodyText": "Version shall be needed for other protobuf message as well.", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r425354441", "createdAt": "2020-05-14T18:42:41Z", "author": {"login": "xieus"}, "path": "schema/proto3/dhcp.proto", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+syntax = \"proto3\";\n+\n+package alcor.schema;\n+\n+option java_package = \"com.futurewei.alcor.schema\";\n+option java_outer_classname = \"DHCP\";\n+\n+import \"common.proto\";\n+\n+message DHCPConfiguration {\n+    int32 version = 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59712027a6f248a93bac72b200a9ccf696d2390b"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM1NDgwMg==", "bodyText": "We need to discuss the naming of GoalState.", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r425354802", "createdAt": "2020-05-14T18:43:16Z", "author": {"login": "xieus"}, "path": "schema/proto3/goalstate.proto", "diffHunk": "@@ -24,10 +24,12 @@ import \"vpc.proto\";\n import \"subnet.proto\";\n import \"port.proto\";\n import \"securitygroup.proto\";\n+import \"dhcp.proto\";\n \n message GoalState {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59712027a6f248a93bac72b200a9ccf696d2390b"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM1NTMxMA==", "bodyText": "New field to be placed at the end after discussion.", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r425355310", "createdAt": "2020-05-14T18:44:13Z", "author": {"login": "xieus"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -26,6 +26,11 @@ import \"common.proto\";\n message PortConfiguration {\n     int32 version = 1;\n \n+    // FIXME: the options for NetworkType are:\n+    // 1. put in PortConfiguration here since only useful for Port, ACA programming will be direct and easier\n+    // 2. put in VPC configuration since it is a \"network level\" configuration, \n+    //      that mean every port configuration needs to go with VPC config for ACA to look up\n+    NetworkType network_type = 13;  // TODO: the ID will be update after discussion", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59712027a6f248a93bac72b200a9ccf696d2390b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM1NTk0Ng==", "bodyText": "Is dhcp options completely covered by the new dhcp.proto", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r425355946", "createdAt": "2020-05-14T18:45:20Z", "author": {"login": "xieus"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -53,16 +58,14 @@ message PortConfiguration {\n         string mac_address = 2;\n     }\n \n-    message ExtraDhcpOption {\n-        string name = 1;\n-        string value = 2;\n-    }\n-\n-    HostInfo host_info = 9;\n+    HostInfo host_info = 9; // FIXME: will be used to populate neighbor info only\n     repeated FixedIp fixed_ips = 10;\n     repeated SecurityGroupId security_group_ids = 11;\n     repeated AllowAddressPair allow_address_pairs = 12;\n-    repeated ExtraDhcpOption extra_dhcp_options = 13;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59712027a6f248a93bac72b200a9ccf696d2390b"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM1Nzc4NQ==", "bodyText": "It is a list of dns name servers associated with the subnet. Default is an empty list.\nDNS servers needed to be included by dhcp.proto, right?\n\u00a0", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r425357785", "createdAt": "2020-05-14T18:48:27Z", "author": {"login": "xieus"}, "path": "schema/proto3/subnet.proto", "diffHunk": "@@ -61,9 +61,9 @@ message SubnetConfiguration {\n         string mac_address = 4;\n     }\n \n-    repeated DnsEntry dns_list = 13;\n-    repeated SecurityGroupId security_group_ids = 14;\n-    repeated TransitSwitch transit_switches = 15;\n+    repeated DnsEntry dns_list = 13; // FIXME: what is this for?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59712027a6f248a93bac72b200a9ccf696d2390b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM1NzkyMQ==", "bodyText": "Like it.", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r425357921", "createdAt": "2020-05-14T18:48:42Z", "author": {"login": "xieus"}, "path": "schema/proto3/vpc.proto", "diffHunk": "@@ -49,7 +53,7 @@ message VpcConfiguration {\n \n     repeated SubnetId subnet_ids = 7;\n     repeated Route routes = 8;\n-    repeated TransitRouter transit_routers = 9;\n+    repeated TransitRouter transit_routers = 9; // FIXME: to be removed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59712027a6f248a93bac72b200a9ccf696d2390b"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a330e42ae40d4cdab1b9432dbd9b88d9c6ff0a05", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/a330e42ae40d4cdab1b9432dbd9b88d9c6ff0a05", "committedDate": "2020-05-15T22:00:01Z", "message": "update per PR feedback/discussion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04985a33fe35748d2f865fd392b93d0800c61593", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/04985a33fe35748d2f865fd392b93d0800c61593", "committedDate": "2020-05-16T17:18:17Z", "message": "added NEIGHBOR_INFO per team discussion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTgyNzE5", "url": "https://github.com/futurewei-cloud/alcor/pull/193#pullrequestreview-413182719", "createdAt": "2020-05-17T17:31:54Z", "commit": {"oid": "04985a33fe35748d2f865fd392b93d0800c61593"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xN1QxNzozMTo1NFrOGWiaJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNTo1NTozMlrOGY4uPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI4NTYwNQ==", "bodyText": "Like it!", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r426285605", "createdAt": "2020-05-17T17:31:54Z", "author": {"login": "xieus"}, "path": "schema/proto3/vpc.proto", "diffHunk": "@@ -24,13 +24,17 @@ option java_outer_classname = \"Vpc\";\n import \"common.proto\";\n \n message VpcConfiguration {\n-    int32 version = 1;\n+    uint32 version = 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04985a33fe35748d2f865fd392b93d0800c61593"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc0NTY2NQ==", "bodyText": "Let us close on all the FIXME staff and plan to merge it :-)", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r428745665", "createdAt": "2020-05-21T15:52:04Z", "author": {"login": "xieus"}, "path": "schema/proto3/common.proto", "diffHunk": "@@ -34,10 +35,11 @@ enum OperationType {\n     GET = 2;\n     DELETE = 3;\n     INFO = 4;\n-    FINALIZE = 5;\n-    CREATE_UPDATE_SWITCH = 6;\n-    CREATE_UPDATE_ROUTER = 7;\n-    CREATE_UPDATE_GATEWAY = 8;\n+    NEIGHBOR_INFO = 5; // FIXME: we may need CRUD for NEIGHBOR_INFO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04985a33fe35748d2f865fd392b93d0800c61593"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc0NzgyNA==", "bodyText": "Sounds like a plan. One more question before we call it good: Can VxLan-GPE VNI overlap with \"regular\" VxLan VNI? Will this cause conflict on the host?", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r428747824", "createdAt": "2020-05-21T15:54:35Z", "author": {"login": "xieus"}, "path": "schema/proto3/common.proto", "diffHunk": "@@ -58,3 +60,10 @@ enum Protocol {\n     HTTP = 3;\n     ARP = 4;\n }\n+\n+enum NetworkType { \n+    VXLAN = 0; // the default type\n+    VLAN = 1;\n+    GRE = 2;\n+    GENEVE = 3;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM1Mzc4OQ=="}, "originalCommit": {"oid": "59712027a6f248a93bac72b200a9ccf696d2390b"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc0ODM1MQ==", "bodyText": "Fix FIXME", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r428748351", "createdAt": "2020-05-21T15:55:32Z", "author": {"login": "xieus"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -24,15 +24,21 @@ option java_outer_classname = \"Port\";\n import \"common.proto\";\n \n message PortConfiguration {\n-    int32 version = 1;\n-\n-    string project_id = 2;\n-    string network_id = 3;\n-    string id = 4;\n-    string name = 5;\n-    string network_ns = 6;\n-    string mac_address = 7;\n-    string veth_name = 8;\n+    uint32 version = 1;\n+\n+    // FIXME: the options for NetworkType are:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04985a33fe35748d2f865fd392b93d0800c61593"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e01593b3222e72ad703e20a502e2ed84e2cb80fd", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/e01593b3222e72ad703e20a502e2ed84e2cb80fd", "committedDate": "2020-05-21T23:07:03Z", "message": "update per feedback and discussion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTg0Mzcw", "url": "https://github.com/futurewei-cloud/alcor/pull/193#pullrequestreview-416584370", "createdAt": "2020-05-22T00:56:08Z", "commit": {"oid": "e01593b3222e72ad703e20a502e2ed84e2cb80fd"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMDo1NjowOFrOGZHe0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMDo1NzoyNVrOGZHgCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk5MDE2Mg==", "bodyText": "Let us scope a MVP for basic port programming. We will revisit this part shortly.", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r428990162", "createdAt": "2020-05-22T00:56:08Z", "author": {"login": "xieus"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -63,10 +59,6 @@ message PortConfiguration {\n     repeated FixedIp fixed_ips = 12;\n     repeated AllowAddressPair allow_address_pairs = 13;\n     repeated SecurityGroupId security_group_ids = 14;\n-\n-    // FIXME: note that for neutron, it sends down more stuff than this", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e01593b3222e72ad703e20a502e2ed84e2cb80fd"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk5MDQ3Mg==", "bodyText": "That is right. MTU will be on vpc level.\nDoes this mean that they will use the same MTU on a region basis and ignore MTU value from Neutron Server.", "url": "https://github.com/futurewei-cloud/alcor/pull/193#discussion_r428990472", "createdAt": "2020-05-22T00:57:25Z", "author": {"login": "xieus"}, "path": "schema/proto3/vpc.proto", "diffHunk": "@@ -31,10 +31,6 @@ message VpcConfiguration {\n     string name = 4;\n     string cidr = 5;\n     int64 tunnel_id = 6;\n-    // FIXME: MTU info would be part VPC right?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e01593b3222e72ad703e20a502e2ed84e2cb80fd"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2456, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}