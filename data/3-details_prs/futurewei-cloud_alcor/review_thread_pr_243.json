{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNTE5NzQ2", "number": 243, "reviewThreads": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToxMzo1NlrOEEV2Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNDoxMjozNFrOEMvACA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTg3NzAyOnYy", "diffSide": "RIGHT", "path": "services/elastic_ip_manager/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToxMzo1NlrOGh5tQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToxMzo1NlrOGh5tQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIwMTY2Nw==", "bodyText": "Please add the following new plugins to this pom.xml file to enable code coverage report (ref: https://github.com/futurewei-cloud/alcor/pull/241/files#diff-9fe0ed938fde38c66436944093832b38)\n        <plugin>\n             <groupId>org.jacoco</groupId>\n             <artifactId>jacoco-maven-plugin</artifactId>\n             <version>0.8.5</version>\n             <executions>\n                 <execution>\n                     <goals>\n                         <goal>prepare-agent</goal>\n                     </goals>\n                 </execution>\n                 <!-- attached to Maven test phase -->\n                 <execution>\n                     <id>report</id>\n                     <phase>test</phase>\n                     <goals>\n                         <goal>report</goal>\n                     </goals>\n                 </execution>\n             </executions>\n         </plugin>", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r438201667", "createdAt": "2020-06-10T15:13:56Z", "author": {"login": "xieus"}, "path": "services/elastic_ip_manager/pom.xml", "diffHunk": "@@ -0,0 +1,138 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>org.springframework.boot</groupId>\n+        <artifactId>spring-boot-starter-parent</artifactId>\n+        <version>2.2.6.RELEASE</version>\n+        <relativePath/> <!-- lookup parent from repository -->\n+    </parent>\n+    <groupId>com.futurewei.alcor</groupId>\n+    <artifactId>elasticipmanager</artifactId>\n+    <version>0.1.0-SNAPSHOT</version>\n+    <name>AlcorElasticIpManager</name>\n+    <description>Alcor Elastic Ip Manager Module</description>\n+\n+    <properties>\n+        <java.version>1.8</java.version>\n+        <swagger.output.dir>${project.build.directory}/swagger</swagger.output.dir>\n+        <swagger2markup.version>1.2.0</swagger2markup.version>\n+    </properties>\n+\n+    <repositories>\n+        <repository>\n+            <snapshots>\n+                <enabled>false</enabled>\n+            </snapshots>\n+            <id>jcenter-releases</id>\n+            <name>jcenter</name>\n+            <url>https://jcenter.bintray.com</url>\n+        </repository>\n+    </repositories>\n+\n+    <dependencies>\n+\n+        <!--Service Basic dependencies-->\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-actuator</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-web</artifactId>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.apache.commons</groupId>\n+            <artifactId>commons-pool2</artifactId>\n+            <version>2.4.2</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-test</artifactId>\n+            <scope>test</scope>\n+        </dependency>\n+\n+        <!--Swagger dependencies-->\n+        <dependency>\n+            <groupId>io.springfox</groupId>\n+            <artifactId>springfox-swagger2</artifactId>\n+            <version>2.6.1</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.springfox</groupId>\n+            <artifactId>springfox-swagger-ui</artifactId>\n+            <version>2.2.2</version>\n+        </dependency>\n+        <dependency>\n+            <groupId>io.github.swagger2markup</groupId>\n+            <artifactId>swagger2markup-spring-restdocs-ext</artifactId>\n+            <version>${swagger2markup.version}</version>\n+            <scope>test</scope>\n+        </dependency>\n+\n+        <!--Internal dependencies-->\n+        <dependency>\n+            <groupId>com.futurewei.alcor</groupId>\n+            <artifactId>common</artifactId>\n+            <version>0.1.0-SNAPSHOT</version>\n+            <scope>compile</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.futurewei.alcor</groupId>\n+            <artifactId>schema</artifactId>\n+            <version>0.1.0-SNAPSHOT</version>\n+            <scope>compile</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.futurewei.alcor</groupId>\n+            <artifactId>web</artifactId>\n+            <version>0.1.0-SNAPSHOT</version>\n+            <scope>compile</scope>\n+        </dependency>\n+\n+    </dependencies>\n+\n+    <build>\n+        <extensions>\n+            <extension>\n+                <groupId>kr.motd.maven</groupId>\n+                <artifactId>os-maven-plugin</artifactId>\n+                <version>1.4.1.Final</version>\n+            </extension>\n+        </extensions>\n+        <plugins>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79ada1b01bee01b9d812cb7a71c012e895b7665f"}, "originalPosition": 104}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTg4NDgwOnYy", "diffSide": "RIGHT", "path": "lib/src/main/java/com/futurewei/alcor/common/entity/Resource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToxNTo0NlrOGh5ygg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToxNTo0NlrOGh5ygg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIwMzAxMA==", "bodyText": "Like it.", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r438203010", "createdAt": "2020-06-10T15:15:46Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/entity/Resource.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package com.futurewei.alcor.common.entity;\r\n+\r\n+import com.fasterxml.jackson.annotation.JsonProperty;\r\n+\r\n+import java.io.Serializable;\r\n+\r\n+public class Resource implements Serializable {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79ada1b01bee01b9d812cb7a71c012e895b7665f"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTk0ODQwOnYy", "diffSide": "RIGHT", "path": "lib/src/main/java/com/futurewei/alcor/common/db/ignite/IgniteDistributedLock.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToyODowOFrOGh6a5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzoxMDoyNVrOGicVxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxMzM0OQ==", "bodyText": "Please consider to make the thread sleep time configurable (in a application.properties file or other configuration file) with a default value of your choice, or keep it in a constant file.", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r438213349", "createdAt": "2020-06-10T15:28:08Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/ignite/IgniteDistributedLock.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package com.futurewei.alcor.common.db.ignite;\r\n+\r\n+import com.futurewei.alcor.common.db.IDistributedLock;\r\n+import com.futurewei.alcor.common.exception.DistributedLockException;\r\n+import com.futurewei.alcor.common.logging.Logger;\r\n+import com.futurewei.alcor.common.logging.LoggerFactory;\r\n+import org.apache.ignite.client.ClientCache;\r\n+import org.apache.ignite.client.ClientException;\r\n+import org.apache.ignite.client.IgniteClient;\r\n+import org.springframework.util.Assert;\r\n+\r\n+import java.util.logging.Level;\r\n+\r\n+public class IgniteDistributedLock implements IDistributedLock {\r\n+    private static final Logger logger = LoggerFactory.getLogger();\r\n+    private String name;\r\n+    private ClientCache<String, String> cache;\r\n+    private IgniteClient igniteClient;\r\n+\r\n+    public IgniteDistributedLock(IgniteClient igniteClient, String name) {\r\n+        this.igniteClient = igniteClient;\r\n+        this.name = name;\r\n+\r\n+        try {\r\n+            cache = igniteClient.getOrCreateCache(name);\r\n+        } catch (ClientException e) {\r\n+            logger.log(Level.WARNING, \"Create distributed lock cache failed:\" + e.getMessage());\r\n+        } catch (Exception e) {\r\n+            logger.log(Level.WARNING, \"Unexpected failure:\" + e.getMessage());\r\n+        }\r\n+\r\n+        Assert.notNull(igniteClient, \"Create distributed lock failed\");\r\n+    }\r\n+\r\n+    @Override\r\n+    public void lock(String lockKey) throws DistributedLockException {\r\n+        Boolean locked = false;\r\n+        String lockKeyWithPrefix = name + \" lock:\" + lockKey;\r\n+\r\n+        try {\r\n+            while (!locked) {\r\n+                locked = cache.putIfAbsent(lockKeyWithPrefix, \"lock\");\r\n+                Assert.notNull(locked, \"Redis lock should not run within a transaction\");\r\n+                if (!locked) {\r\n+                    Thread.sleep(10);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79ada1b01bee01b9d812cb7a71c012e895b7665f"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc2OTA5Mw==", "bodyText": "Done", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r438769093", "createdAt": "2020-06-11T13:10:25Z", "author": {"login": "Eric-Yuan"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/ignite/IgniteDistributedLock.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package com.futurewei.alcor.common.db.ignite;\r\n+\r\n+import com.futurewei.alcor.common.db.IDistributedLock;\r\n+import com.futurewei.alcor.common.exception.DistributedLockException;\r\n+import com.futurewei.alcor.common.logging.Logger;\r\n+import com.futurewei.alcor.common.logging.LoggerFactory;\r\n+import org.apache.ignite.client.ClientCache;\r\n+import org.apache.ignite.client.ClientException;\r\n+import org.apache.ignite.client.IgniteClient;\r\n+import org.springframework.util.Assert;\r\n+\r\n+import java.util.logging.Level;\r\n+\r\n+public class IgniteDistributedLock implements IDistributedLock {\r\n+    private static final Logger logger = LoggerFactory.getLogger();\r\n+    private String name;\r\n+    private ClientCache<String, String> cache;\r\n+    private IgniteClient igniteClient;\r\n+\r\n+    public IgniteDistributedLock(IgniteClient igniteClient, String name) {\r\n+        this.igniteClient = igniteClient;\r\n+        this.name = name;\r\n+\r\n+        try {\r\n+            cache = igniteClient.getOrCreateCache(name);\r\n+        } catch (ClientException e) {\r\n+            logger.log(Level.WARNING, \"Create distributed lock cache failed:\" + e.getMessage());\r\n+        } catch (Exception e) {\r\n+            logger.log(Level.WARNING, \"Unexpected failure:\" + e.getMessage());\r\n+        }\r\n+\r\n+        Assert.notNull(igniteClient, \"Create distributed lock failed\");\r\n+    }\r\n+\r\n+    @Override\r\n+    public void lock(String lockKey) throws DistributedLockException {\r\n+        Boolean locked = false;\r\n+        String lockKeyWithPrefix = name + \" lock:\" + lockKey;\r\n+\r\n+        try {\r\n+            while (!locked) {\r\n+                locked = cache.putIfAbsent(lockKeyWithPrefix, \"lock\");\r\n+                Assert.notNull(locked, \"Redis lock should not run within a transaction\");\r\n+                if (!locked) {\r\n+                    Thread.sleep(10);\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxMzM0OQ=="}, "originalCommit": {"oid": "79ada1b01bee01b9d812cb7a71c012e895b7665f"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTk1Mjk0OnYy", "diffSide": "RIGHT", "path": "lib/src/main/java/com/futurewei/alcor/common/db/ignite/IgniteDistributedLock.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToyOToxMFrOGh6dtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzoxMDozNFrOGicWEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxNDA3MA==", "bodyText": "\"Redis lock\" => \"Ignite lock\"", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r438214070", "createdAt": "2020-06-10T15:29:10Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/ignite/IgniteDistributedLock.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package com.futurewei.alcor.common.db.ignite;\r\n+\r\n+import com.futurewei.alcor.common.db.IDistributedLock;\r\n+import com.futurewei.alcor.common.exception.DistributedLockException;\r\n+import com.futurewei.alcor.common.logging.Logger;\r\n+import com.futurewei.alcor.common.logging.LoggerFactory;\r\n+import org.apache.ignite.client.ClientCache;\r\n+import org.apache.ignite.client.ClientException;\r\n+import org.apache.ignite.client.IgniteClient;\r\n+import org.springframework.util.Assert;\r\n+\r\n+import java.util.logging.Level;\r\n+\r\n+public class IgniteDistributedLock implements IDistributedLock {\r\n+    private static final Logger logger = LoggerFactory.getLogger();\r\n+    private String name;\r\n+    private ClientCache<String, String> cache;\r\n+    private IgniteClient igniteClient;\r\n+\r\n+    public IgniteDistributedLock(IgniteClient igniteClient, String name) {\r\n+        this.igniteClient = igniteClient;\r\n+        this.name = name;\r\n+\r\n+        try {\r\n+            cache = igniteClient.getOrCreateCache(name);\r\n+        } catch (ClientException e) {\r\n+            logger.log(Level.WARNING, \"Create distributed lock cache failed:\" + e.getMessage());\r\n+        } catch (Exception e) {\r\n+            logger.log(Level.WARNING, \"Unexpected failure:\" + e.getMessage());\r\n+        }\r\n+\r\n+        Assert.notNull(igniteClient, \"Create distributed lock failed\");\r\n+    }\r\n+\r\n+    @Override\r\n+    public void lock(String lockKey) throws DistributedLockException {\r\n+        Boolean locked = false;\r\n+        String lockKeyWithPrefix = name + \" lock:\" + lockKey;\r\n+\r\n+        try {\r\n+            while (!locked) {\r\n+                locked = cache.putIfAbsent(lockKeyWithPrefix, \"lock\");\r\n+                Assert.notNull(locked, \"Redis lock should not run within a transaction\");\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79ada1b01bee01b9d812cb7a71c012e895b7665f"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc2OTE3MQ==", "bodyText": "Done", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r438769171", "createdAt": "2020-06-11T13:10:34Z", "author": {"login": "Eric-Yuan"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/ignite/IgniteDistributedLock.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package com.futurewei.alcor.common.db.ignite;\r\n+\r\n+import com.futurewei.alcor.common.db.IDistributedLock;\r\n+import com.futurewei.alcor.common.exception.DistributedLockException;\r\n+import com.futurewei.alcor.common.logging.Logger;\r\n+import com.futurewei.alcor.common.logging.LoggerFactory;\r\n+import org.apache.ignite.client.ClientCache;\r\n+import org.apache.ignite.client.ClientException;\r\n+import org.apache.ignite.client.IgniteClient;\r\n+import org.springframework.util.Assert;\r\n+\r\n+import java.util.logging.Level;\r\n+\r\n+public class IgniteDistributedLock implements IDistributedLock {\r\n+    private static final Logger logger = LoggerFactory.getLogger();\r\n+    private String name;\r\n+    private ClientCache<String, String> cache;\r\n+    private IgniteClient igniteClient;\r\n+\r\n+    public IgniteDistributedLock(IgniteClient igniteClient, String name) {\r\n+        this.igniteClient = igniteClient;\r\n+        this.name = name;\r\n+\r\n+        try {\r\n+            cache = igniteClient.getOrCreateCache(name);\r\n+        } catch (ClientException e) {\r\n+            logger.log(Level.WARNING, \"Create distributed lock cache failed:\" + e.getMessage());\r\n+        } catch (Exception e) {\r\n+            logger.log(Level.WARNING, \"Unexpected failure:\" + e.getMessage());\r\n+        }\r\n+\r\n+        Assert.notNull(igniteClient, \"Create distributed lock failed\");\r\n+    }\r\n+\r\n+    @Override\r\n+    public void lock(String lockKey) throws DistributedLockException {\r\n+        Boolean locked = false;\r\n+        String lockKeyWithPrefix = name + \" lock:\" + lockKey;\r\n+\r\n+        try {\r\n+            while (!locked) {\r\n+                locked = cache.putIfAbsent(lockKeyWithPrefix, \"lock\");\r\n+                Assert.notNull(locked, \"Redis lock should not run within a transaction\");\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxNDA3MA=="}, "originalCommit": {"oid": "79ada1b01bee01b9d812cb7a71c012e895b7665f"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTk1OTc2OnYy", "diffSide": "RIGHT", "path": "lib/src/main/java/com/futurewei/alcor/common/db/ignite/IgniteDistributedLock.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNTozMDo0MVrOGh6iGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzoxMDo0MVrOGicWYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxNTE5NA==", "bodyText": "Recommend to use this.name instead of name.", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r438215194", "createdAt": "2020-06-10T15:30:41Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/ignite/IgniteDistributedLock.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package com.futurewei.alcor.common.db.ignite;\r\n+\r\n+import com.futurewei.alcor.common.db.IDistributedLock;\r\n+import com.futurewei.alcor.common.exception.DistributedLockException;\r\n+import com.futurewei.alcor.common.logging.Logger;\r\n+import com.futurewei.alcor.common.logging.LoggerFactory;\r\n+import org.apache.ignite.client.ClientCache;\r\n+import org.apache.ignite.client.ClientException;\r\n+import org.apache.ignite.client.IgniteClient;\r\n+import org.springframework.util.Assert;\r\n+\r\n+import java.util.logging.Level;\r\n+\r\n+public class IgniteDistributedLock implements IDistributedLock {\r\n+    private static final Logger logger = LoggerFactory.getLogger();\r\n+    private String name;\r\n+    private ClientCache<String, String> cache;\r\n+    private IgniteClient igniteClient;\r\n+\r\n+    public IgniteDistributedLock(IgniteClient igniteClient, String name) {\r\n+        this.igniteClient = igniteClient;\r\n+        this.name = name;\r\n+\r\n+        try {\r\n+            cache = igniteClient.getOrCreateCache(name);\r\n+        } catch (ClientException e) {\r\n+            logger.log(Level.WARNING, \"Create distributed lock cache failed:\" + e.getMessage());\r\n+        } catch (Exception e) {\r\n+            logger.log(Level.WARNING, \"Unexpected failure:\" + e.getMessage());\r\n+        }\r\n+\r\n+        Assert.notNull(igniteClient, \"Create distributed lock failed\");\r\n+    }\r\n+\r\n+    @Override\r\n+    public void lock(String lockKey) throws DistributedLockException {\r\n+        Boolean locked = false;\r\n+        String lockKeyWithPrefix = name + \" lock:\" + lockKey;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79ada1b01bee01b9d812cb7a71c012e895b7665f"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc2OTI0OA==", "bodyText": "Done", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r438769248", "createdAt": "2020-06-11T13:10:41Z", "author": {"login": "Eric-Yuan"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/ignite/IgniteDistributedLock.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package com.futurewei.alcor.common.db.ignite;\r\n+\r\n+import com.futurewei.alcor.common.db.IDistributedLock;\r\n+import com.futurewei.alcor.common.exception.DistributedLockException;\r\n+import com.futurewei.alcor.common.logging.Logger;\r\n+import com.futurewei.alcor.common.logging.LoggerFactory;\r\n+import org.apache.ignite.client.ClientCache;\r\n+import org.apache.ignite.client.ClientException;\r\n+import org.apache.ignite.client.IgniteClient;\r\n+import org.springframework.util.Assert;\r\n+\r\n+import java.util.logging.Level;\r\n+\r\n+public class IgniteDistributedLock implements IDistributedLock {\r\n+    private static final Logger logger = LoggerFactory.getLogger();\r\n+    private String name;\r\n+    private ClientCache<String, String> cache;\r\n+    private IgniteClient igniteClient;\r\n+\r\n+    public IgniteDistributedLock(IgniteClient igniteClient, String name) {\r\n+        this.igniteClient = igniteClient;\r\n+        this.name = name;\r\n+\r\n+        try {\r\n+            cache = igniteClient.getOrCreateCache(name);\r\n+        } catch (ClientException e) {\r\n+            logger.log(Level.WARNING, \"Create distributed lock cache failed:\" + e.getMessage());\r\n+        } catch (Exception e) {\r\n+            logger.log(Level.WARNING, \"Unexpected failure:\" + e.getMessage());\r\n+        }\r\n+\r\n+        Assert.notNull(igniteClient, \"Create distributed lock failed\");\r\n+    }\r\n+\r\n+    @Override\r\n+    public void lock(String lockKey) throws DistributedLockException {\r\n+        Boolean locked = false;\r\n+        String lockKeyWithPrefix = name + \" lock:\" + lockKey;\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxNTE5NA=="}, "originalCommit": {"oid": "79ada1b01bee01b9d812cb7a71c012e895b7665f"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTk4Njk4OnYy", "diffSide": "RIGHT", "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/exception/ElasticIpExistsException.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNTozNzowNlrOGh6zuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjozNzowOVrOGqtxGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxOTcwNA==", "bodyText": "License statement is needed :-)", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r438219704", "createdAt": "2020-06-10T15:37:06Z", "author": {"login": "xieus"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/exception/ElasticIpExistsException.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package com.futurewei.alcor.elasticipmanager.exception;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79ada1b01bee01b9d812cb7a71c012e895b7665f"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0MzIyNA==", "bodyText": "Done", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r447443224", "createdAt": "2020-06-30T06:37:09Z", "author": {"login": "Eric-Yuan"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/exception/ElasticIpExistsException.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package com.futurewei.alcor.elasticipmanager.exception;\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxOTcwNA=="}, "originalCommit": {"oid": "79ada1b01bee01b9d812cb7a71c012e895b7665f"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0OTUzMjk5OnYy", "diffSide": "RIGHT", "path": "lib/src/main/java/com/futurewei/alcor/common/db/DistributedLockFactory.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNjo0OToyMlrOGk34zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjo0MDo0MlrOGqt3Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMxNzU4MA==", "bodyText": "Quick question: I see these two configurations are added to the pom file of AlcorLib which means that it will applied to multiple microservices. Do you expect the need of customizing it differently?", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r441317580", "createdAt": "2020-06-17T06:49:22Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/DistributedLockFactory.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\r\n+Copyright 2019 The Alcor Authors.\r\n+\r\n+Licensed under the Apache License, Version 2.0 (the \"License\");\r\n+        you may not use this file except in compliance with the License.\r\n+        You may obtain a copy of the License at\r\n+\r\n+        http://www.apache.org/licenses/LICENSE-2.0\r\n+\r\n+        Unless required by applicable law or agreed to in writing, software\r\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\r\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n+        See the License for the specific language governing permissions and\r\n+        limitations under the License.\r\n+*/\r\n+package com.futurewei.alcor.common.db;\r\n+\r\n+import com.futurewei.alcor.common.db.ignite.IgniteDistributedLock;\r\n+import com.futurewei.alcor.common.db.redis.RedisDistributedLock;\r\n+import org.apache.ignite.client.IgniteClient;\r\n+import org.springframework.beans.factory.annotation.Autowired;\r\n+import org.springframework.beans.factory.annotation.Value;\r\n+import org.springframework.context.annotation.ComponentScan;\r\n+import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;\r\n+import org.springframework.data.redis.core.StringRedisTemplate;\r\n+import org.springframework.stereotype.Component;\r\n+\r\n+@ComponentScan\r\n+@Component\r\n+public class DistributedLockFactory {\r\n+    @Autowired(required = false)\r\n+    private IgniteClient igniteClient;\r\n+\r\n+    @Value(\"${lock.try.interval}\")\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c37f67188298aca95c0c7f922d171438de4364e1"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzExMTEyNw==", "bodyText": "No, it is no need to set different values at those two configurations. I am just not familiar with the usage of configuration file...", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r443111127", "createdAt": "2020-06-20T07:53:10Z", "author": {"login": "Eric-Yuan"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/DistributedLockFactory.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\r\n+Copyright 2019 The Alcor Authors.\r\n+\r\n+Licensed under the Apache License, Version 2.0 (the \"License\");\r\n+        you may not use this file except in compliance with the License.\r\n+        You may obtain a copy of the License at\r\n+\r\n+        http://www.apache.org/licenses/LICENSE-2.0\r\n+\r\n+        Unless required by applicable law or agreed to in writing, software\r\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\r\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n+        See the License for the specific language governing permissions and\r\n+        limitations under the License.\r\n+*/\r\n+package com.futurewei.alcor.common.db;\r\n+\r\n+import com.futurewei.alcor.common.db.ignite.IgniteDistributedLock;\r\n+import com.futurewei.alcor.common.db.redis.RedisDistributedLock;\r\n+import org.apache.ignite.client.IgniteClient;\r\n+import org.springframework.beans.factory.annotation.Autowired;\r\n+import org.springframework.beans.factory.annotation.Value;\r\n+import org.springframework.context.annotation.ComponentScan;\r\n+import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;\r\n+import org.springframework.data.redis.core.StringRedisTemplate;\r\n+import org.springframework.stereotype.Component;\r\n+\r\n+@ComponentScan\r\n+@Component\r\n+public class DistributedLockFactory {\r\n+    @Autowired(required = false)\r\n+    private IgniteClient igniteClient;\r\n+\r\n+    @Value(\"${lock.try.interval}\")\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMxNzU4MA=="}, "originalCommit": {"oid": "c37f67188298aca95c0c7f922d171438de4364e1"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk4NTg0Nw==", "bodyText": "oh okay. Got it :-)", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r443985847", "createdAt": "2020-06-23T06:17:51Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/DistributedLockFactory.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\r\n+Copyright 2019 The Alcor Authors.\r\n+\r\n+Licensed under the Apache License, Version 2.0 (the \"License\");\r\n+        you may not use this file except in compliance with the License.\r\n+        You may obtain a copy of the License at\r\n+\r\n+        http://www.apache.org/licenses/LICENSE-2.0\r\n+\r\n+        Unless required by applicable law or agreed to in writing, software\r\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\r\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n+        See the License for the specific language governing permissions and\r\n+        limitations under the License.\r\n+*/\r\n+package com.futurewei.alcor.common.db;\r\n+\r\n+import com.futurewei.alcor.common.db.ignite.IgniteDistributedLock;\r\n+import com.futurewei.alcor.common.db.redis.RedisDistributedLock;\r\n+import org.apache.ignite.client.IgniteClient;\r\n+import org.springframework.beans.factory.annotation.Autowired;\r\n+import org.springframework.beans.factory.annotation.Value;\r\n+import org.springframework.context.annotation.ComponentScan;\r\n+import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;\r\n+import org.springframework.data.redis.core.StringRedisTemplate;\r\n+import org.springframework.stereotype.Component;\r\n+\r\n+@ComponentScan\r\n+@Component\r\n+public class DistributedLockFactory {\r\n+    @Autowired(required = false)\r\n+    private IgniteClient igniteClient;\r\n+\r\n+    @Value(\"${lock.try.interval}\")\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMxNzU4MA=="}, "originalCommit": {"oid": "c37f67188298aca95c0c7f922d171438de4364e1"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0NDc4Mg==", "bodyText": "Done. Changed to use default values instead of modifying all configuration files", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r447444782", "createdAt": "2020-06-30T06:40:42Z", "author": {"login": "Eric-Yuan"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/DistributedLockFactory.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\r\n+Copyright 2019 The Alcor Authors.\r\n+\r\n+Licensed under the Apache License, Version 2.0 (the \"License\");\r\n+        you may not use this file except in compliance with the License.\r\n+        You may obtain a copy of the License at\r\n+\r\n+        http://www.apache.org/licenses/LICENSE-2.0\r\n+\r\n+        Unless required by applicable law or agreed to in writing, software\r\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\r\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n+        See the License for the specific language governing permissions and\r\n+        limitations under the License.\r\n+*/\r\n+package com.futurewei.alcor.common.db;\r\n+\r\n+import com.futurewei.alcor.common.db.ignite.IgniteDistributedLock;\r\n+import com.futurewei.alcor.common.db.redis.RedisDistributedLock;\r\n+import org.apache.ignite.client.IgniteClient;\r\n+import org.springframework.beans.factory.annotation.Autowired;\r\n+import org.springframework.beans.factory.annotation.Value;\r\n+import org.springframework.context.annotation.ComponentScan;\r\n+import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;\r\n+import org.springframework.data.redis.core.StringRedisTemplate;\r\n+import org.springframework.stereotype.Component;\r\n+\r\n+@ComponentScan\r\n+@Component\r\n+public class DistributedLockFactory {\r\n+    @Autowired(required = false)\r\n+    private IgniteClient igniteClient;\r\n+\r\n+    @Value(\"${lock.try.interval}\")\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMxNzU4MA=="}, "originalCommit": {"oid": "c37f67188298aca95c0c7f922d171438de4364e1"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODU1NzU5OnYy", "diffSide": "RIGHT", "path": "docs/modules/ROOT/pages/mgmt_services/elastic_ip_manager.adoc", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNTozNToyM1rOGqsYFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwNjowMzoyNlrOGrX5eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyMDQzNg==", "bodyText": "Is range_id an optional or a required parameter here?", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r447420436", "createdAt": "2020-06-30T05:35:23Z", "author": {"login": "xieus"}, "path": "docs/modules/ROOT/pages/mgmt_services/elastic_ip_manager.adoc", "diffHunk": "@@ -50,153 +50,727 @@ Note that those IP ranges should be owned by cloud provider.\n \n == REST APIs\n \n-TBD: to follow REST API specification.\n-\n === API Snapshot\n \n [width=\"100%\",cols=\"22%,12%,50%,17%\"]\n |===\n |*API Name* |*Method* |*Request*|*Response*\n \n-//|Verify IP State\n-//|GET\n-//|/ips/{range_id}/{ip}\n-//|ip state\n-//<<IP_Get,[sample]>>\n-//\n-//|List all allocated IP State\n-//|GET\n-//|/ips/{range_id}\n-//|ip state list\n-//<<IP_List,[sample]>>\n-//\n-//|Create IP State\n-//|POST\n-//|/ips\n-//|ip state\n-//<<IP_Post,[sample]>>\n-//\n-//|Create IP State Bulk\n-//|POST\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Post_Bulk,[sample]>>\n-//\n-//|Activate IP Address\n-//|PUT\n-//|/ips\n-//|ip state\n-//<<IP_Put1,[sample]>>\n-//\n-//|Activate IP Address Bulk\n-//|PUT\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Put1_Bulk,[sample]>>\n-//\n-//|Deactivate IP Address\n-//|PUT\n-//|/ips\n-//|ip state\n-//<<IP_Put2,[sample]>>\n-//\n-//|Deactivate IP Address Bulk\n-//|PUT\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Put2_Bulk,[sample]>>\n-//\n-//|Release IP State\n-//|DELETE\n-//|/ips/{range_id}/{ip}\n-//|ip state\n-//<<IP_Delete,[sample]>>\n-//\n-//|Release IP State Bulk\n-//|DELETE\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Delete_Bulk,[sample]>>\n-//\n-//|Create IP Range\n-//|POST\n-//|/ips/range\n-//|ip range\n-//<<IP_Range_Post,[sample]>>\n-//\n-//|Get IP Range\n-//|GET\n-//|/ips/range/{range_id}\n-//|ip range\n-//<<IP_Range_Get,[sample]>>\n-//\n-//|List all IP Range\n-//|GET\n-//|/ips/range\n-//|ip range list\n-//<<IP_Range_List,[sample]>>\n+|Create an elastic IP\n+|POST\n+|/project/{project_id}/elasticips\n+|elasticip info\n+<<Elastic_IP_Create,[sample]>>\n+\n+|Get the elastic IP\n+|GET\n+|/project/{project_id}/elasticips/{elasticip_id}\n+|elasticip info\n+<<Elastic_IP_Get,[sample]>>\n+\n+|Get all elastic IPs\n+|GET\n+|/project/{project_id}/elasticips\n+|elasticip info list\n+<<Elastic_IP_Get_List,[sample]>>\n+\n+|Delete the elastic IP\n+|DELETE\n+|/project/{project_id}/elasticips/{elasticip_id}\n+|\n+<<Elastic_IP_Delete,[sample]>>\n+\n+|Bulk create elastic IPs\n+|POST\n+|/project/{project_id}/elasticips\n+|elasticip info list\n+<<Elastic_IP_Bulk_Create,[sample]>>\n+\n+|Bulk delete elastic IPs\n+|DELETE\n+|/project/{project_id}/elasticips\n+|\n+<<Elastic_IP_Bulk_Delete,[sample]>>\n+\n+|Update the elastic IP\n+|PUT\n+|/project/{project_id}/elasticips/{elasticip_id}\n+|elasticip info\n+<<Elastic_IP_Update,[sample]>>\n+\n+|Create an elastic IP range\n+|POST\n+|/elasticip-ranges\n+|elasticip range info\n+<<Elastic_IP_Range_Create,[sample]>>\n+\n+|Get the elastic IP range\n+|GET\n+|/elasticip-ranges/{elasticip_range_id}\n+|elasticip range info\n+<<Elastic_IP_Range_Get,[sample]>>\n+\n+|Get all elastic IP ranges\n+|GET\n+|/elasticip-ranges\n+|elasticip range info list\n+<<Elastic_IP_Range_Get_List,[sample]>>\n+\n+|Delete the elastic IP range\n+|DELETE\n+|/elasticip-ranges/{elasticip_range_id}\n+|\n+<<Elastic_IP_Range_Delete,[sample]>>\n+\n+|Update the elastic IP range\n+|PUT\n+|/project/{project_id}/elasticip-ranges/{elasticip_range_id}\n+|elasticip range info\n+<<Elastic_IP_Range_Update,[sample]>>\n+\n |===\n \n === API Specification\n \n-NOTE: The follows is an example from link:private_ip_manager.adoc[private IP manager].\n+anchor:Elastic_IP_Create[]\n+**(1) Create an elastic IP**\n+\n+* Method: `POST`\n+\n+* Request: `/project/{project_id}/elasticips`\n+\n+* Request Parameter: `@PathVariable String project_id, @RequestBody ElasticIpStateJson elasticip`\n+\n+* Response: elastic ip info\n+* Normal response codes: 200\n+* Error response codes: 400, 412, 500\n+\n+* Example\n+\n+....\n+Request:\n+http://127.0.0.1:8080/elasticips\n+\n+Body:\n+{\n+    \"elasticip\":\n+    {\n+        \"id\": null,\n+        \"project_id\":\"11223344-5566-7788-990011223300\",\n+        \"name\":\"eip1\",\n+        \"description\":\"elastic ip 1\",\n+        \"range_id\":\"11223344-5566-7788-990011223301\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52dc126fb56313b9c5489dc4ea32b85276f28e6b"}, "originalPosition": 193}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzODg2Ng==", "bodyText": "you are right, in mostly scenarios there is only one existing elasticip range. I will remove the range_id parameter", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r447438866", "createdAt": "2020-06-30T06:26:57Z", "author": {"login": "Eric-Yuan"}, "path": "docs/modules/ROOT/pages/mgmt_services/elastic_ip_manager.adoc", "diffHunk": "@@ -50,153 +50,727 @@ Note that those IP ranges should be owned by cloud provider.\n \n == REST APIs\n \n-TBD: to follow REST API specification.\n-\n === API Snapshot\n \n [width=\"100%\",cols=\"22%,12%,50%,17%\"]\n |===\n |*API Name* |*Method* |*Request*|*Response*\n \n-//|Verify IP State\n-//|GET\n-//|/ips/{range_id}/{ip}\n-//|ip state\n-//<<IP_Get,[sample]>>\n-//\n-//|List all allocated IP State\n-//|GET\n-//|/ips/{range_id}\n-//|ip state list\n-//<<IP_List,[sample]>>\n-//\n-//|Create IP State\n-//|POST\n-//|/ips\n-//|ip state\n-//<<IP_Post,[sample]>>\n-//\n-//|Create IP State Bulk\n-//|POST\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Post_Bulk,[sample]>>\n-//\n-//|Activate IP Address\n-//|PUT\n-//|/ips\n-//|ip state\n-//<<IP_Put1,[sample]>>\n-//\n-//|Activate IP Address Bulk\n-//|PUT\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Put1_Bulk,[sample]>>\n-//\n-//|Deactivate IP Address\n-//|PUT\n-//|/ips\n-//|ip state\n-//<<IP_Put2,[sample]>>\n-//\n-//|Deactivate IP Address Bulk\n-//|PUT\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Put2_Bulk,[sample]>>\n-//\n-//|Release IP State\n-//|DELETE\n-//|/ips/{range_id}/{ip}\n-//|ip state\n-//<<IP_Delete,[sample]>>\n-//\n-//|Release IP State Bulk\n-//|DELETE\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Delete_Bulk,[sample]>>\n-//\n-//|Create IP Range\n-//|POST\n-//|/ips/range\n-//|ip range\n-//<<IP_Range_Post,[sample]>>\n-//\n-//|Get IP Range\n-//|GET\n-//|/ips/range/{range_id}\n-//|ip range\n-//<<IP_Range_Get,[sample]>>\n-//\n-//|List all IP Range\n-//|GET\n-//|/ips/range\n-//|ip range list\n-//<<IP_Range_List,[sample]>>\n+|Create an elastic IP\n+|POST\n+|/project/{project_id}/elasticips\n+|elasticip info\n+<<Elastic_IP_Create,[sample]>>\n+\n+|Get the elastic IP\n+|GET\n+|/project/{project_id}/elasticips/{elasticip_id}\n+|elasticip info\n+<<Elastic_IP_Get,[sample]>>\n+\n+|Get all elastic IPs\n+|GET\n+|/project/{project_id}/elasticips\n+|elasticip info list\n+<<Elastic_IP_Get_List,[sample]>>\n+\n+|Delete the elastic IP\n+|DELETE\n+|/project/{project_id}/elasticips/{elasticip_id}\n+|\n+<<Elastic_IP_Delete,[sample]>>\n+\n+|Bulk create elastic IPs\n+|POST\n+|/project/{project_id}/elasticips\n+|elasticip info list\n+<<Elastic_IP_Bulk_Create,[sample]>>\n+\n+|Bulk delete elastic IPs\n+|DELETE\n+|/project/{project_id}/elasticips\n+|\n+<<Elastic_IP_Bulk_Delete,[sample]>>\n+\n+|Update the elastic IP\n+|PUT\n+|/project/{project_id}/elasticips/{elasticip_id}\n+|elasticip info\n+<<Elastic_IP_Update,[sample]>>\n+\n+|Create an elastic IP range\n+|POST\n+|/elasticip-ranges\n+|elasticip range info\n+<<Elastic_IP_Range_Create,[sample]>>\n+\n+|Get the elastic IP range\n+|GET\n+|/elasticip-ranges/{elasticip_range_id}\n+|elasticip range info\n+<<Elastic_IP_Range_Get,[sample]>>\n+\n+|Get all elastic IP ranges\n+|GET\n+|/elasticip-ranges\n+|elasticip range info list\n+<<Elastic_IP_Range_Get_List,[sample]>>\n+\n+|Delete the elastic IP range\n+|DELETE\n+|/elasticip-ranges/{elasticip_range_id}\n+|\n+<<Elastic_IP_Range_Delete,[sample]>>\n+\n+|Update the elastic IP range\n+|PUT\n+|/project/{project_id}/elasticip-ranges/{elasticip_range_id}\n+|elasticip range info\n+<<Elastic_IP_Range_Update,[sample]>>\n+\n |===\n \n === API Specification\n \n-NOTE: The follows is an example from link:private_ip_manager.adoc[private IP manager].\n+anchor:Elastic_IP_Create[]\n+**(1) Create an elastic IP**\n+\n+* Method: `POST`\n+\n+* Request: `/project/{project_id}/elasticips`\n+\n+* Request Parameter: `@PathVariable String project_id, @RequestBody ElasticIpStateJson elasticip`\n+\n+* Response: elastic ip info\n+* Normal response codes: 200\n+* Error response codes: 400, 412, 500\n+\n+* Example\n+\n+....\n+Request:\n+http://127.0.0.1:8080/elasticips\n+\n+Body:\n+{\n+    \"elasticip\":\n+    {\n+        \"id\": null,\n+        \"project_id\":\"11223344-5566-7788-990011223300\",\n+        \"name\":\"eip1\",\n+        \"description\":\"elastic ip 1\",\n+        \"range_id\":\"11223344-5566-7788-990011223301\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyMDQzNg=="}, "originalCommit": {"oid": "52dc126fb56313b9c5489dc4ea32b85276f28e6b"}, "originalPosition": 193}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEzMzQ5OA==", "bodyText": "Cool thanks!", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r448133498", "createdAt": "2020-07-01T06:03:26Z", "author": {"login": "xieus"}, "path": "docs/modules/ROOT/pages/mgmt_services/elastic_ip_manager.adoc", "diffHunk": "@@ -50,153 +50,727 @@ Note that those IP ranges should be owned by cloud provider.\n \n == REST APIs\n \n-TBD: to follow REST API specification.\n-\n === API Snapshot\n \n [width=\"100%\",cols=\"22%,12%,50%,17%\"]\n |===\n |*API Name* |*Method* |*Request*|*Response*\n \n-//|Verify IP State\n-//|GET\n-//|/ips/{range_id}/{ip}\n-//|ip state\n-//<<IP_Get,[sample]>>\n-//\n-//|List all allocated IP State\n-//|GET\n-//|/ips/{range_id}\n-//|ip state list\n-//<<IP_List,[sample]>>\n-//\n-//|Create IP State\n-//|POST\n-//|/ips\n-//|ip state\n-//<<IP_Post,[sample]>>\n-//\n-//|Create IP State Bulk\n-//|POST\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Post_Bulk,[sample]>>\n-//\n-//|Activate IP Address\n-//|PUT\n-//|/ips\n-//|ip state\n-//<<IP_Put1,[sample]>>\n-//\n-//|Activate IP Address Bulk\n-//|PUT\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Put1_Bulk,[sample]>>\n-//\n-//|Deactivate IP Address\n-//|PUT\n-//|/ips\n-//|ip state\n-//<<IP_Put2,[sample]>>\n-//\n-//|Deactivate IP Address Bulk\n-//|PUT\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Put2_Bulk,[sample]>>\n-//\n-//|Release IP State\n-//|DELETE\n-//|/ips/{range_id}/{ip}\n-//|ip state\n-//<<IP_Delete,[sample]>>\n-//\n-//|Release IP State Bulk\n-//|DELETE\n-//|/ips/bulk\n-//|ip state list\n-//<<IP_Delete_Bulk,[sample]>>\n-//\n-//|Create IP Range\n-//|POST\n-//|/ips/range\n-//|ip range\n-//<<IP_Range_Post,[sample]>>\n-//\n-//|Get IP Range\n-//|GET\n-//|/ips/range/{range_id}\n-//|ip range\n-//<<IP_Range_Get,[sample]>>\n-//\n-//|List all IP Range\n-//|GET\n-//|/ips/range\n-//|ip range list\n-//<<IP_Range_List,[sample]>>\n+|Create an elastic IP\n+|POST\n+|/project/{project_id}/elasticips\n+|elasticip info\n+<<Elastic_IP_Create,[sample]>>\n+\n+|Get the elastic IP\n+|GET\n+|/project/{project_id}/elasticips/{elasticip_id}\n+|elasticip info\n+<<Elastic_IP_Get,[sample]>>\n+\n+|Get all elastic IPs\n+|GET\n+|/project/{project_id}/elasticips\n+|elasticip info list\n+<<Elastic_IP_Get_List,[sample]>>\n+\n+|Delete the elastic IP\n+|DELETE\n+|/project/{project_id}/elasticips/{elasticip_id}\n+|\n+<<Elastic_IP_Delete,[sample]>>\n+\n+|Bulk create elastic IPs\n+|POST\n+|/project/{project_id}/elasticips\n+|elasticip info list\n+<<Elastic_IP_Bulk_Create,[sample]>>\n+\n+|Bulk delete elastic IPs\n+|DELETE\n+|/project/{project_id}/elasticips\n+|\n+<<Elastic_IP_Bulk_Delete,[sample]>>\n+\n+|Update the elastic IP\n+|PUT\n+|/project/{project_id}/elasticips/{elasticip_id}\n+|elasticip info\n+<<Elastic_IP_Update,[sample]>>\n+\n+|Create an elastic IP range\n+|POST\n+|/elasticip-ranges\n+|elasticip range info\n+<<Elastic_IP_Range_Create,[sample]>>\n+\n+|Get the elastic IP range\n+|GET\n+|/elasticip-ranges/{elasticip_range_id}\n+|elasticip range info\n+<<Elastic_IP_Range_Get,[sample]>>\n+\n+|Get all elastic IP ranges\n+|GET\n+|/elasticip-ranges\n+|elasticip range info list\n+<<Elastic_IP_Range_Get_List,[sample]>>\n+\n+|Delete the elastic IP range\n+|DELETE\n+|/elasticip-ranges/{elasticip_range_id}\n+|\n+<<Elastic_IP_Range_Delete,[sample]>>\n+\n+|Update the elastic IP range\n+|PUT\n+|/project/{project_id}/elasticip-ranges/{elasticip_range_id}\n+|elasticip range info\n+<<Elastic_IP_Range_Update,[sample]>>\n+\n |===\n \n === API Specification\n \n-NOTE: The follows is an example from link:private_ip_manager.adoc[private IP manager].\n+anchor:Elastic_IP_Create[]\n+**(1) Create an elastic IP**\n+\n+* Method: `POST`\n+\n+* Request: `/project/{project_id}/elasticips`\n+\n+* Request Parameter: `@PathVariable String project_id, @RequestBody ElasticIpStateJson elasticip`\n+\n+* Response: elastic ip info\n+* Normal response codes: 200\n+* Error response codes: 400, 412, 500\n+\n+* Example\n+\n+....\n+Request:\n+http://127.0.0.1:8080/elasticips\n+\n+Body:\n+{\n+    \"elasticip\":\n+    {\n+        \"id\": null,\n+        \"project_id\":\"11223344-5566-7788-990011223300\",\n+        \"name\":\"eip1\",\n+        \"description\":\"elastic ip 1\",\n+        \"range_id\":\"11223344-5566-7788-990011223301\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyMDQzNg=="}, "originalCommit": {"oid": "52dc126fb56313b9c5489dc4ea32b85276f28e6b"}, "originalPosition": 193}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODU5MTgxOnYy", "diffSide": "RIGHT", "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/controller/ElasticIpController.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNTo1MTozOFrOGqssCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNjoyNzo0N1rOGtDaWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyNTU0NQ==", "bodyText": "Recommend to add comments to public controller methods as well as important private methods.", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r447425545", "createdAt": "2020-06-30T05:51:38Z", "author": {"login": "xieus"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/controller/ElasticIpController.java", "diffHunk": "@@ -0,0 +1,412 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.elasticipmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.utils.Ipv4AddrUtil;\n+import com.futurewei.alcor.common.utils.Ipv6AddrUtil;\n+import com.futurewei.alcor.elasticipmanager.config.IpVersion;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpIdConfilictException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpNoProjectIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpProjectIdConflictException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.*;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpQueryFormatException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeBadRangesException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeNoIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeVersionException;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpRangeService;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpService;\n+import com.futurewei.alcor.web.entity.elasticip.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.util.StringUtils;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.math.BigInteger;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+\n+@RestController\n+public class ElasticIpController {\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticIpController.class);\n+\n+    @Autowired\n+    ElasticIpService elasticipService;\n+\n+    @Autowired\n+    ElasticIpRangeService elasticIpRangeService;\n+\n+    private boolean isIpAddressInvalid(String ipAddress, Integer ipVersion) {\n+        boolean isInvalid = true;\n+        if (ipVersion.equals(IpVersion.IPV4.getVersion())) {\n+            isInvalid = !Ipv4AddrUtil.formatCheck(ipAddress);\n+        } else if (ipVersion.equals(IpVersion.IPV6.getVersion())) {\n+            isInvalid = !Ipv6AddrUtil.formatCheck(ipAddress);\n+        }\n+\n+        return isInvalid;\n+    }\n+\n+    private boolean isIpVersionInvalid(Integer ipVersion) {\n+        return !ipVersion.equals(IpVersion.IPV4.getVersion()) && !ipVersion.equals(IpVersion.IPV6.getVersion());\n+    }\n+\n+    private boolean isAllocationRangesInvalid(Integer ipVersion,\n+                                              List<ElasticIpRange.AllocationRange> allocationRanges) {\n+\n+        boolean isInvalid = false;\n+        if (allocationRanges != null) {\n+\n+            try {\n+                if (ipVersion.equals(IpVersion.IPV4.getVersion())) {\n+                    for (ElasticIpRange.AllocationRange range: allocationRanges) {\n+                        long start = Ipv4AddrUtil.ipv4ToLong(range.getStart());\n+                        long end = Ipv4AddrUtil.ipv4ToLong(range.getEnd());\n+                        if (start > end) {\n+                            isInvalid = true;\n+                        }\n+                    }\n+                } else if (ipVersion.equals(IpVersion.IPV6.getVersion())) {\n+                    for (ElasticIpRange.AllocationRange range: allocationRanges) {\n+                        BigInteger start = Ipv6AddrUtil.ipv6ToBitInt(range.getStart());\n+                        BigInteger end = Ipv6AddrUtil.ipv6ToBitInt(range.getEnd());\n+                        if (start.compareTo(end) > 0) {\n+                            isInvalid = true;\n+                        }\n+                    }\n+                }\n+            } catch (NumberFormatException e) {\n+                isInvalid = true;\n+            }\n+        }\n+        return isInvalid;\n+    }\n+\n+    private void createElasticIpParameterProcess(String projectId, ElasticIpInfo elasticIpInfo) throws Exception {\n+\n+        if (elasticIpInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (StringUtils.isEmpty(projectId)) {\n+            throw new ElasticIpNoProjectIdException();\n+        } else if (elasticIpInfo.getProjectId() == null) {\n+            elasticIpInfo.setProjectId(projectId);\n+        } else if (!projectId.equals(elasticIpInfo.getProjectId())) {\n+            throw new ElasticIpProjectIdConflictException();\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpInfo.getRangeId())) {\n+            throw new ElasticIpNoRangeIdException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIpVersion() == null) {\n+            elasticIpInfo.setElasticIpVersion(IpVersion.IPV4.getVersion());\n+        } else if (this.isIpVersionInvalid(elasticIpInfo.getElasticIpVersion())) {\n+            throw new ElasticIpEipVersionException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIp() != null) {\n+            if (this.isIpAddressInvalid(elasticIpInfo.getElasticIp(), elasticIpInfo.getElasticIpVersion())) {\n+                throw new ElasticIpEipAddressException();\n+            }\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpInfo.getPortId())) {\n+            if (elasticIpInfo.getPrivateIp()!= null || elasticIpInfo.getPrivateIpVersion() != null) {\n+                throw new ElasticIpNoPortIdException();\n+            }\n+        } else {\n+            if (elasticIpInfo.getPrivateIpVersion() == null) {\n+                elasticIpInfo.setPrivateIpVersion(IpVersion.IPV4.getVersion());\n+            } else if (this.isIpVersionInvalid(elasticIpInfo.getPrivateIpVersion())) {\n+                throw new ElasticIpPipVersionException();\n+            }\n+\n+            if (elasticIpInfo.getPrivateIp() != null) {\n+                if (this.isIpAddressInvalid(elasticIpInfo.getPrivateIp(), elasticIpInfo.getPrivateIpVersion())) {\n+                    throw new ElasticIpPipAddressException();\n+                }\n+            }\n+        }\n+\n+        if (elasticIpInfo.getName() == null) {\n+            elasticIpInfo.setName(\"\");\n+        }\n+\n+        if (elasticIpInfo.getDescription() == null) {\n+            elasticIpInfo.setDescription(\"\");\n+        }\n+    }\n+\n+    private void updateElasticIpParameterProcess(String projectId, String elasticIpId, ElasticIpInfo elasticIpInfo)\n+            throws Exception {\n+\n+        if (elasticIpInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (StringUtils.isEmpty(projectId)) {\n+            throw new ElasticIpNoProjectIdException();\n+        } else if (elasticIpInfo.getProjectId() == null) {\n+            elasticIpInfo.setProjectId(projectId);\n+        } else if (!projectId.equals(elasticIpInfo.getProjectId())) {\n+            throw new ElasticIpProjectIdConflictException();\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpId)) {\n+            throw new ElasticIpNoIdException();\n+        } else if (elasticIpInfo.getId() == null) {\n+            elasticIpInfo.setId(elasticIpId);\n+        } else if (!elasticIpId.equals(elasticIpInfo.getId())) {\n+            throw new ElasticIpIdConfilictException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIpVersion() != null &&\n+                this.isIpVersionInvalid(elasticIpInfo.getElasticIpVersion())) {\n+            throw new ElasticIpEipVersionException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIp() != null) {\n+            if (elasticIpInfo.getElasticIpVersion() == null) {\n+                elasticIpInfo.setElasticIpVersion(IpVersion.IPV4.getVersion());\n+            }\n+            if (this.isIpAddressInvalid(elasticIpInfo.getElasticIp(), elasticIpInfo.getElasticIpVersion())) {\n+                throw new ElasticIpEipAddressException();\n+            }\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpInfo.getPortId())) {\n+            if (elasticIpInfo.getPrivateIp() != null || elasticIpInfo.getPrivateIpVersion() != null) {\n+                throw new ElasticIpNoPortIdException();\n+            }\n+        } else {\n+            if (elasticIpInfo.getPrivateIpVersion() != null &&\n+                    this.isIpVersionInvalid(elasticIpInfo.getPrivateIpVersion())) {\n+                throw new ElasticIpPipVersionException();\n+            }\n+\n+            if (elasticIpInfo.getPrivateIp() != null) {\n+                if (elasticIpInfo.getPrivateIp() == null) {\n+                    elasticIpInfo.setPrivateIpVersion(IpVersion.IPV4.getVersion());\n+                }\n+                if (this.isIpAddressInvalid(elasticIpInfo.getPrivateIp(), elasticIpInfo.getPrivateIpVersion())) {\n+                    throw new ElasticIpPipAddressException();\n+                }\n+            }\n+        }\n+    }\n+\n+    private void createElasticIpRangeParameterProcess(ElasticIpRangeInfo elasticIpRangeInfo) throws Exception {\n+\n+        if (elasticIpRangeInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (elasticIpRangeInfo.getIpVersion() == null) {\n+            elasticIpRangeInfo.setIpVersion(IpVersion.IPV4.getVersion());\n+        } else if (this.isIpVersionInvalid(elasticIpRangeInfo.getIpVersion())) {\n+            throw new ElasticIpRangeVersionException();\n+        }\n+\n+        List<ElasticIpRange.AllocationRange> allocationRanges = elasticIpRangeInfo.getAllocationRanges();\n+        if (allocationRanges != null) {\n+            if (this.isAllocationRangesInvalid(elasticIpRangeInfo.getIpVersion(), allocationRanges)) {\n+                throw new ElasticIpRangeBadRangesException();\n+            }\n+        } else {\n+            elasticIpRangeInfo.setAllocationRanges(new ArrayList<>());\n+        }\n+\n+        if (elasticIpRangeInfo.getName() == null) {\n+            elasticIpRangeInfo.setName(\"\");\n+        }\n+\n+        if (elasticIpRangeInfo.getDescription() == null) {\n+            elasticIpRangeInfo.setDescription(\"\");\n+        }\n+    }\n+\n+    private void updateElasticIpRangeParameterProcess(String elasticipRangeId,\n+                                                      ElasticIpRangeInfo elasticIpRangeInfo) throws Exception {\n+\n+        if (elasticIpRangeInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (StringUtils.isEmpty(elasticipRangeId)) {\n+            throw new ElasticIpRangeNoIdException();\n+        } else if (elasticIpRangeInfo.getId() == null) {\n+            elasticIpRangeInfo.setId(elasticipRangeId);\n+        } else if (!elasticipRangeId.equals(elasticIpRangeInfo.getId())) {\n+            throw new ElasticIpIdConfilictException();\n+        }\n+\n+        if (elasticIpRangeInfo.getIpVersion() != null && this.isIpVersionInvalid(elasticIpRangeInfo.getIpVersion())) {\n+            throw new ElasticIpRangeVersionException();\n+        }\n+\n+        List<ElasticIpRange.AllocationRange> allocationRanges = elasticIpRangeInfo.getAllocationRanges();\n+        if (allocationRanges != null) {\n+            if (this.isAllocationRangesInvalid(elasticIpRangeInfo.getIpVersion(), allocationRanges)) {\n+                throw new ElasticIpRangeBadRangesException();\n+            }\n+        }\n+    }\n+\n+    @PostMapping(\"/project/{project_id}/elasticips\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52dc126fb56313b9c5489dc4ea32b85276f28e6b"}, "originalPosition": 274}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzOTMzMQ==", "bodyText": "Yes, I will do that", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r447439331", "createdAt": "2020-06-30T06:28:07Z", "author": {"login": "Eric-Yuan"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/controller/ElasticIpController.java", "diffHunk": "@@ -0,0 +1,412 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.elasticipmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.utils.Ipv4AddrUtil;\n+import com.futurewei.alcor.common.utils.Ipv6AddrUtil;\n+import com.futurewei.alcor.elasticipmanager.config.IpVersion;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpIdConfilictException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpNoProjectIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpProjectIdConflictException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.*;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpQueryFormatException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeBadRangesException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeNoIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeVersionException;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpRangeService;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpService;\n+import com.futurewei.alcor.web.entity.elasticip.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.util.StringUtils;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.math.BigInteger;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+\n+@RestController\n+public class ElasticIpController {\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticIpController.class);\n+\n+    @Autowired\n+    ElasticIpService elasticipService;\n+\n+    @Autowired\n+    ElasticIpRangeService elasticIpRangeService;\n+\n+    private boolean isIpAddressInvalid(String ipAddress, Integer ipVersion) {\n+        boolean isInvalid = true;\n+        if (ipVersion.equals(IpVersion.IPV4.getVersion())) {\n+            isInvalid = !Ipv4AddrUtil.formatCheck(ipAddress);\n+        } else if (ipVersion.equals(IpVersion.IPV6.getVersion())) {\n+            isInvalid = !Ipv6AddrUtil.formatCheck(ipAddress);\n+        }\n+\n+        return isInvalid;\n+    }\n+\n+    private boolean isIpVersionInvalid(Integer ipVersion) {\n+        return !ipVersion.equals(IpVersion.IPV4.getVersion()) && !ipVersion.equals(IpVersion.IPV6.getVersion());\n+    }\n+\n+    private boolean isAllocationRangesInvalid(Integer ipVersion,\n+                                              List<ElasticIpRange.AllocationRange> allocationRanges) {\n+\n+        boolean isInvalid = false;\n+        if (allocationRanges != null) {\n+\n+            try {\n+                if (ipVersion.equals(IpVersion.IPV4.getVersion())) {\n+                    for (ElasticIpRange.AllocationRange range: allocationRanges) {\n+                        long start = Ipv4AddrUtil.ipv4ToLong(range.getStart());\n+                        long end = Ipv4AddrUtil.ipv4ToLong(range.getEnd());\n+                        if (start > end) {\n+                            isInvalid = true;\n+                        }\n+                    }\n+                } else if (ipVersion.equals(IpVersion.IPV6.getVersion())) {\n+                    for (ElasticIpRange.AllocationRange range: allocationRanges) {\n+                        BigInteger start = Ipv6AddrUtil.ipv6ToBitInt(range.getStart());\n+                        BigInteger end = Ipv6AddrUtil.ipv6ToBitInt(range.getEnd());\n+                        if (start.compareTo(end) > 0) {\n+                            isInvalid = true;\n+                        }\n+                    }\n+                }\n+            } catch (NumberFormatException e) {\n+                isInvalid = true;\n+            }\n+        }\n+        return isInvalid;\n+    }\n+\n+    private void createElasticIpParameterProcess(String projectId, ElasticIpInfo elasticIpInfo) throws Exception {\n+\n+        if (elasticIpInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (StringUtils.isEmpty(projectId)) {\n+            throw new ElasticIpNoProjectIdException();\n+        } else if (elasticIpInfo.getProjectId() == null) {\n+            elasticIpInfo.setProjectId(projectId);\n+        } else if (!projectId.equals(elasticIpInfo.getProjectId())) {\n+            throw new ElasticIpProjectIdConflictException();\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpInfo.getRangeId())) {\n+            throw new ElasticIpNoRangeIdException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIpVersion() == null) {\n+            elasticIpInfo.setElasticIpVersion(IpVersion.IPV4.getVersion());\n+        } else if (this.isIpVersionInvalid(elasticIpInfo.getElasticIpVersion())) {\n+            throw new ElasticIpEipVersionException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIp() != null) {\n+            if (this.isIpAddressInvalid(elasticIpInfo.getElasticIp(), elasticIpInfo.getElasticIpVersion())) {\n+                throw new ElasticIpEipAddressException();\n+            }\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpInfo.getPortId())) {\n+            if (elasticIpInfo.getPrivateIp()!= null || elasticIpInfo.getPrivateIpVersion() != null) {\n+                throw new ElasticIpNoPortIdException();\n+            }\n+        } else {\n+            if (elasticIpInfo.getPrivateIpVersion() == null) {\n+                elasticIpInfo.setPrivateIpVersion(IpVersion.IPV4.getVersion());\n+            } else if (this.isIpVersionInvalid(elasticIpInfo.getPrivateIpVersion())) {\n+                throw new ElasticIpPipVersionException();\n+            }\n+\n+            if (elasticIpInfo.getPrivateIp() != null) {\n+                if (this.isIpAddressInvalid(elasticIpInfo.getPrivateIp(), elasticIpInfo.getPrivateIpVersion())) {\n+                    throw new ElasticIpPipAddressException();\n+                }\n+            }\n+        }\n+\n+        if (elasticIpInfo.getName() == null) {\n+            elasticIpInfo.setName(\"\");\n+        }\n+\n+        if (elasticIpInfo.getDescription() == null) {\n+            elasticIpInfo.setDescription(\"\");\n+        }\n+    }\n+\n+    private void updateElasticIpParameterProcess(String projectId, String elasticIpId, ElasticIpInfo elasticIpInfo)\n+            throws Exception {\n+\n+        if (elasticIpInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (StringUtils.isEmpty(projectId)) {\n+            throw new ElasticIpNoProjectIdException();\n+        } else if (elasticIpInfo.getProjectId() == null) {\n+            elasticIpInfo.setProjectId(projectId);\n+        } else if (!projectId.equals(elasticIpInfo.getProjectId())) {\n+            throw new ElasticIpProjectIdConflictException();\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpId)) {\n+            throw new ElasticIpNoIdException();\n+        } else if (elasticIpInfo.getId() == null) {\n+            elasticIpInfo.setId(elasticIpId);\n+        } else if (!elasticIpId.equals(elasticIpInfo.getId())) {\n+            throw new ElasticIpIdConfilictException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIpVersion() != null &&\n+                this.isIpVersionInvalid(elasticIpInfo.getElasticIpVersion())) {\n+            throw new ElasticIpEipVersionException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIp() != null) {\n+            if (elasticIpInfo.getElasticIpVersion() == null) {\n+                elasticIpInfo.setElasticIpVersion(IpVersion.IPV4.getVersion());\n+            }\n+            if (this.isIpAddressInvalid(elasticIpInfo.getElasticIp(), elasticIpInfo.getElasticIpVersion())) {\n+                throw new ElasticIpEipAddressException();\n+            }\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpInfo.getPortId())) {\n+            if (elasticIpInfo.getPrivateIp() != null || elasticIpInfo.getPrivateIpVersion() != null) {\n+                throw new ElasticIpNoPortIdException();\n+            }\n+        } else {\n+            if (elasticIpInfo.getPrivateIpVersion() != null &&\n+                    this.isIpVersionInvalid(elasticIpInfo.getPrivateIpVersion())) {\n+                throw new ElasticIpPipVersionException();\n+            }\n+\n+            if (elasticIpInfo.getPrivateIp() != null) {\n+                if (elasticIpInfo.getPrivateIp() == null) {\n+                    elasticIpInfo.setPrivateIpVersion(IpVersion.IPV4.getVersion());\n+                }\n+                if (this.isIpAddressInvalid(elasticIpInfo.getPrivateIp(), elasticIpInfo.getPrivateIpVersion())) {\n+                    throw new ElasticIpPipAddressException();\n+                }\n+            }\n+        }\n+    }\n+\n+    private void createElasticIpRangeParameterProcess(ElasticIpRangeInfo elasticIpRangeInfo) throws Exception {\n+\n+        if (elasticIpRangeInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (elasticIpRangeInfo.getIpVersion() == null) {\n+            elasticIpRangeInfo.setIpVersion(IpVersion.IPV4.getVersion());\n+        } else if (this.isIpVersionInvalid(elasticIpRangeInfo.getIpVersion())) {\n+            throw new ElasticIpRangeVersionException();\n+        }\n+\n+        List<ElasticIpRange.AllocationRange> allocationRanges = elasticIpRangeInfo.getAllocationRanges();\n+        if (allocationRanges != null) {\n+            if (this.isAllocationRangesInvalid(elasticIpRangeInfo.getIpVersion(), allocationRanges)) {\n+                throw new ElasticIpRangeBadRangesException();\n+            }\n+        } else {\n+            elasticIpRangeInfo.setAllocationRanges(new ArrayList<>());\n+        }\n+\n+        if (elasticIpRangeInfo.getName() == null) {\n+            elasticIpRangeInfo.setName(\"\");\n+        }\n+\n+        if (elasticIpRangeInfo.getDescription() == null) {\n+            elasticIpRangeInfo.setDescription(\"\");\n+        }\n+    }\n+\n+    private void updateElasticIpRangeParameterProcess(String elasticipRangeId,\n+                                                      ElasticIpRangeInfo elasticIpRangeInfo) throws Exception {\n+\n+        if (elasticIpRangeInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (StringUtils.isEmpty(elasticipRangeId)) {\n+            throw new ElasticIpRangeNoIdException();\n+        } else if (elasticIpRangeInfo.getId() == null) {\n+            elasticIpRangeInfo.setId(elasticipRangeId);\n+        } else if (!elasticipRangeId.equals(elasticIpRangeInfo.getId())) {\n+            throw new ElasticIpIdConfilictException();\n+        }\n+\n+        if (elasticIpRangeInfo.getIpVersion() != null && this.isIpVersionInvalid(elasticIpRangeInfo.getIpVersion())) {\n+            throw new ElasticIpRangeVersionException();\n+        }\n+\n+        List<ElasticIpRange.AllocationRange> allocationRanges = elasticIpRangeInfo.getAllocationRanges();\n+        if (allocationRanges != null) {\n+            if (this.isAllocationRangesInvalid(elasticIpRangeInfo.getIpVersion(), allocationRanges)) {\n+                throw new ElasticIpRangeBadRangesException();\n+            }\n+        }\n+    }\n+\n+    @PostMapping(\"/project/{project_id}/elasticips\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyNTU0NQ=="}, "originalCommit": {"oid": "52dc126fb56313b9c5489dc4ea32b85276f28e6b"}, "originalPosition": 274}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTAwMw==", "bodyText": "Thank you! Those comments are all good.", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r449895003", "createdAt": "2020-07-05T16:27:47Z", "author": {"login": "xieus"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/controller/ElasticIpController.java", "diffHunk": "@@ -0,0 +1,412 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.elasticipmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.utils.Ipv4AddrUtil;\n+import com.futurewei.alcor.common.utils.Ipv6AddrUtil;\n+import com.futurewei.alcor.elasticipmanager.config.IpVersion;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpIdConfilictException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpNoProjectIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpProjectIdConflictException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.*;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpQueryFormatException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeBadRangesException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeNoIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeVersionException;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpRangeService;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpService;\n+import com.futurewei.alcor.web.entity.elasticip.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.util.StringUtils;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.math.BigInteger;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+\n+@RestController\n+public class ElasticIpController {\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticIpController.class);\n+\n+    @Autowired\n+    ElasticIpService elasticipService;\n+\n+    @Autowired\n+    ElasticIpRangeService elasticIpRangeService;\n+\n+    private boolean isIpAddressInvalid(String ipAddress, Integer ipVersion) {\n+        boolean isInvalid = true;\n+        if (ipVersion.equals(IpVersion.IPV4.getVersion())) {\n+            isInvalid = !Ipv4AddrUtil.formatCheck(ipAddress);\n+        } else if (ipVersion.equals(IpVersion.IPV6.getVersion())) {\n+            isInvalid = !Ipv6AddrUtil.formatCheck(ipAddress);\n+        }\n+\n+        return isInvalid;\n+    }\n+\n+    private boolean isIpVersionInvalid(Integer ipVersion) {\n+        return !ipVersion.equals(IpVersion.IPV4.getVersion()) && !ipVersion.equals(IpVersion.IPV6.getVersion());\n+    }\n+\n+    private boolean isAllocationRangesInvalid(Integer ipVersion,\n+                                              List<ElasticIpRange.AllocationRange> allocationRanges) {\n+\n+        boolean isInvalid = false;\n+        if (allocationRanges != null) {\n+\n+            try {\n+                if (ipVersion.equals(IpVersion.IPV4.getVersion())) {\n+                    for (ElasticIpRange.AllocationRange range: allocationRanges) {\n+                        long start = Ipv4AddrUtil.ipv4ToLong(range.getStart());\n+                        long end = Ipv4AddrUtil.ipv4ToLong(range.getEnd());\n+                        if (start > end) {\n+                            isInvalid = true;\n+                        }\n+                    }\n+                } else if (ipVersion.equals(IpVersion.IPV6.getVersion())) {\n+                    for (ElasticIpRange.AllocationRange range: allocationRanges) {\n+                        BigInteger start = Ipv6AddrUtil.ipv6ToBitInt(range.getStart());\n+                        BigInteger end = Ipv6AddrUtil.ipv6ToBitInt(range.getEnd());\n+                        if (start.compareTo(end) > 0) {\n+                            isInvalid = true;\n+                        }\n+                    }\n+                }\n+            } catch (NumberFormatException e) {\n+                isInvalid = true;\n+            }\n+        }\n+        return isInvalid;\n+    }\n+\n+    private void createElasticIpParameterProcess(String projectId, ElasticIpInfo elasticIpInfo) throws Exception {\n+\n+        if (elasticIpInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (StringUtils.isEmpty(projectId)) {\n+            throw new ElasticIpNoProjectIdException();\n+        } else if (elasticIpInfo.getProjectId() == null) {\n+            elasticIpInfo.setProjectId(projectId);\n+        } else if (!projectId.equals(elasticIpInfo.getProjectId())) {\n+            throw new ElasticIpProjectIdConflictException();\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpInfo.getRangeId())) {\n+            throw new ElasticIpNoRangeIdException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIpVersion() == null) {\n+            elasticIpInfo.setElasticIpVersion(IpVersion.IPV4.getVersion());\n+        } else if (this.isIpVersionInvalid(elasticIpInfo.getElasticIpVersion())) {\n+            throw new ElasticIpEipVersionException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIp() != null) {\n+            if (this.isIpAddressInvalid(elasticIpInfo.getElasticIp(), elasticIpInfo.getElasticIpVersion())) {\n+                throw new ElasticIpEipAddressException();\n+            }\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpInfo.getPortId())) {\n+            if (elasticIpInfo.getPrivateIp()!= null || elasticIpInfo.getPrivateIpVersion() != null) {\n+                throw new ElasticIpNoPortIdException();\n+            }\n+        } else {\n+            if (elasticIpInfo.getPrivateIpVersion() == null) {\n+                elasticIpInfo.setPrivateIpVersion(IpVersion.IPV4.getVersion());\n+            } else if (this.isIpVersionInvalid(elasticIpInfo.getPrivateIpVersion())) {\n+                throw new ElasticIpPipVersionException();\n+            }\n+\n+            if (elasticIpInfo.getPrivateIp() != null) {\n+                if (this.isIpAddressInvalid(elasticIpInfo.getPrivateIp(), elasticIpInfo.getPrivateIpVersion())) {\n+                    throw new ElasticIpPipAddressException();\n+                }\n+            }\n+        }\n+\n+        if (elasticIpInfo.getName() == null) {\n+            elasticIpInfo.setName(\"\");\n+        }\n+\n+        if (elasticIpInfo.getDescription() == null) {\n+            elasticIpInfo.setDescription(\"\");\n+        }\n+    }\n+\n+    private void updateElasticIpParameterProcess(String projectId, String elasticIpId, ElasticIpInfo elasticIpInfo)\n+            throws Exception {\n+\n+        if (elasticIpInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (StringUtils.isEmpty(projectId)) {\n+            throw new ElasticIpNoProjectIdException();\n+        } else if (elasticIpInfo.getProjectId() == null) {\n+            elasticIpInfo.setProjectId(projectId);\n+        } else if (!projectId.equals(elasticIpInfo.getProjectId())) {\n+            throw new ElasticIpProjectIdConflictException();\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpId)) {\n+            throw new ElasticIpNoIdException();\n+        } else if (elasticIpInfo.getId() == null) {\n+            elasticIpInfo.setId(elasticIpId);\n+        } else if (!elasticIpId.equals(elasticIpInfo.getId())) {\n+            throw new ElasticIpIdConfilictException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIpVersion() != null &&\n+                this.isIpVersionInvalid(elasticIpInfo.getElasticIpVersion())) {\n+            throw new ElasticIpEipVersionException();\n+        }\n+\n+        if (elasticIpInfo.getElasticIp() != null) {\n+            if (elasticIpInfo.getElasticIpVersion() == null) {\n+                elasticIpInfo.setElasticIpVersion(IpVersion.IPV4.getVersion());\n+            }\n+            if (this.isIpAddressInvalid(elasticIpInfo.getElasticIp(), elasticIpInfo.getElasticIpVersion())) {\n+                throw new ElasticIpEipAddressException();\n+            }\n+        }\n+\n+        if (StringUtils.isEmpty(elasticIpInfo.getPortId())) {\n+            if (elasticIpInfo.getPrivateIp() != null || elasticIpInfo.getPrivateIpVersion() != null) {\n+                throw new ElasticIpNoPortIdException();\n+            }\n+        } else {\n+            if (elasticIpInfo.getPrivateIpVersion() != null &&\n+                    this.isIpVersionInvalid(elasticIpInfo.getPrivateIpVersion())) {\n+                throw new ElasticIpPipVersionException();\n+            }\n+\n+            if (elasticIpInfo.getPrivateIp() != null) {\n+                if (elasticIpInfo.getPrivateIp() == null) {\n+                    elasticIpInfo.setPrivateIpVersion(IpVersion.IPV4.getVersion());\n+                }\n+                if (this.isIpAddressInvalid(elasticIpInfo.getPrivateIp(), elasticIpInfo.getPrivateIpVersion())) {\n+                    throw new ElasticIpPipAddressException();\n+                }\n+            }\n+        }\n+    }\n+\n+    private void createElasticIpRangeParameterProcess(ElasticIpRangeInfo elasticIpRangeInfo) throws Exception {\n+\n+        if (elasticIpRangeInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (elasticIpRangeInfo.getIpVersion() == null) {\n+            elasticIpRangeInfo.setIpVersion(IpVersion.IPV4.getVersion());\n+        } else if (this.isIpVersionInvalid(elasticIpRangeInfo.getIpVersion())) {\n+            throw new ElasticIpRangeVersionException();\n+        }\n+\n+        List<ElasticIpRange.AllocationRange> allocationRanges = elasticIpRangeInfo.getAllocationRanges();\n+        if (allocationRanges != null) {\n+            if (this.isAllocationRangesInvalid(elasticIpRangeInfo.getIpVersion(), allocationRanges)) {\n+                throw new ElasticIpRangeBadRangesException();\n+            }\n+        } else {\n+            elasticIpRangeInfo.setAllocationRanges(new ArrayList<>());\n+        }\n+\n+        if (elasticIpRangeInfo.getName() == null) {\n+            elasticIpRangeInfo.setName(\"\");\n+        }\n+\n+        if (elasticIpRangeInfo.getDescription() == null) {\n+            elasticIpRangeInfo.setDescription(\"\");\n+        }\n+    }\n+\n+    private void updateElasticIpRangeParameterProcess(String elasticipRangeId,\n+                                                      ElasticIpRangeInfo elasticIpRangeInfo) throws Exception {\n+\n+        if (elasticIpRangeInfo == null) {\n+            throw new ElasticIpQueryFormatException();\n+        }\n+\n+        if (StringUtils.isEmpty(elasticipRangeId)) {\n+            throw new ElasticIpRangeNoIdException();\n+        } else if (elasticIpRangeInfo.getId() == null) {\n+            elasticIpRangeInfo.setId(elasticipRangeId);\n+        } else if (!elasticipRangeId.equals(elasticIpRangeInfo.getId())) {\n+            throw new ElasticIpIdConfilictException();\n+        }\n+\n+        if (elasticIpRangeInfo.getIpVersion() != null && this.isIpVersionInvalid(elasticIpRangeInfo.getIpVersion())) {\n+            throw new ElasticIpRangeVersionException();\n+        }\n+\n+        List<ElasticIpRange.AllocationRange> allocationRanges = elasticIpRangeInfo.getAllocationRanges();\n+        if (allocationRanges != null) {\n+            if (this.isAllocationRangesInvalid(elasticIpRangeInfo.getIpVersion(), allocationRanges)) {\n+                throw new ElasticIpRangeBadRangesException();\n+            }\n+        }\n+    }\n+\n+    @PostMapping(\"/project/{project_id}/elasticips\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyNTU0NQ=="}, "originalCommit": {"oid": "52dc126fb56313b9c5489dc4ea32b85276f28e6b"}, "originalPosition": 274}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODU5NTkyOnYy", "diffSide": "RIGHT", "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/service/implement/ElasticIpServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNTo1MzoyNFrOGqsucA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjoyODozN1rOGqtipQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyNjE2MA==", "bodyText": "I think range id is not available to our end users.", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r447426160", "createdAt": "2020-06-30T05:53:24Z", "author": {"login": "xieus"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/service/implement/ElasticIpServiceImpl.java", "diffHunk": "@@ -0,0 +1,231 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.elasticipmanager.service.implement;\n+\n+import com.futurewei.alcor.elasticipmanager.dao.ElasticIpAllocator;\n+import com.futurewei.alcor.elasticipmanager.dao.ElasticIpRangeRepo;\n+import com.futurewei.alcor.elasticipmanager.dao.ElasticIpRepo;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.ElasticIpAllocationException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.ElasticIpInUseException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.ElasticIpNotFoundException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpQueryFormatException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeInUseException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeNotFoundException;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpService;\n+import com.futurewei.alcor.web.entity.elasticip.ElasticIp;\n+import com.futurewei.alcor.web.entity.elasticip.ElasticIpRange;\n+import com.futurewei.alcor.web.entity.elasticip.ElasticIpInfo;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+import java.util.*;\n+\n+\n+@Service\n+public class ElasticIpServiceImpl implements ElasticIpService {\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticIpServiceImpl.class);\n+\n+    @Autowired\n+    ElasticIpRepo elasticIpRepo;\n+\n+    @Autowired\n+    ElasticIpRangeRepo elasticIpRangeRepo;\n+\n+    @Autowired\n+    ElasticIpAllocator elasticIpAllocator;\n+\n+    public ElasticIpInfo createElasticIp(ElasticIpInfo request) throws Exception {\n+        LOG.debug(\"Create an elastic ip, request: {}\", request);\n+\n+        String rangeId = request.getRangeId();\n+        ElasticIpRange range = elasticIpRangeRepo.findItem(rangeId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52dc126fb56313b9c5489dc4ea32b85276f28e6b"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQzOTUyNQ==", "bodyText": "OK", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r447439525", "createdAt": "2020-06-30T06:28:37Z", "author": {"login": "Eric-Yuan"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/service/implement/ElasticIpServiceImpl.java", "diffHunk": "@@ -0,0 +1,231 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.elasticipmanager.service.implement;\n+\n+import com.futurewei.alcor.elasticipmanager.dao.ElasticIpAllocator;\n+import com.futurewei.alcor.elasticipmanager.dao.ElasticIpRangeRepo;\n+import com.futurewei.alcor.elasticipmanager.dao.ElasticIpRepo;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.ElasticIpAllocationException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.ElasticIpInUseException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.ElasticIpNotFoundException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpQueryFormatException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeInUseException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeNotFoundException;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpService;\n+import com.futurewei.alcor.web.entity.elasticip.ElasticIp;\n+import com.futurewei.alcor.web.entity.elasticip.ElasticIpRange;\n+import com.futurewei.alcor.web.entity.elasticip.ElasticIpInfo;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+import java.util.*;\n+\n+\n+@Service\n+public class ElasticIpServiceImpl implements ElasticIpService {\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticIpServiceImpl.class);\n+\n+    @Autowired\n+    ElasticIpRepo elasticIpRepo;\n+\n+    @Autowired\n+    ElasticIpRangeRepo elasticIpRangeRepo;\n+\n+    @Autowired\n+    ElasticIpAllocator elasticIpAllocator;\n+\n+    public ElasticIpInfo createElasticIp(ElasticIpInfo request) throws Exception {\n+        LOG.debug(\"Create an elastic ip, request: {}\", request);\n+\n+        String rangeId = request.getRangeId();\n+        ElasticIpRange range = elasticIpRangeRepo.findItem(rangeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyNjE2MA=="}, "originalCommit": {"oid": "52dc126fb56313b9c5489dc4ea32b85276f28e6b"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODYwODY1OnYy", "diffSide": "RIGHT", "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/dao/ElasticIpAllocator.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNTo1ODoyM1rOGqs1oA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNjozNjo0NVrOGqtwcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyODAwMA==", "bodyText": "Like it!", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r447428000", "createdAt": "2020-06-30T05:58:23Z", "author": {"login": "xieus"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/dao/ElasticIpAllocator.java", "diffHunk": "@@ -0,0 +1,685 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.elasticipmanager.dao;\n+\n+import com.futurewei.alcor.common.db.*;\n+import com.futurewei.alcor.common.exception.DistributedLockException;\n+import com.futurewei.alcor.common.utils.Ipv4AddrUtil;\n+import com.futurewei.alcor.common.utils.Ipv6AddrUtil;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAllocatedIpv4;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAllocatedIpv6;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAvailableBucketsSet;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.ElasticIpExistsException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpQueryFormatException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeInUseException;\n+import com.futurewei.alcor.web.entity.elasticip.ElasticIpRange;\n+import com.futurewei.alcor.web.entity.ip.IpVersion;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+\n+import java.math.BigInteger;\n+import java.util.*;\n+\n+\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+@Repository\n+public class ElasticIpAllocator {\n+    private static final Random random = new Random(System.currentTimeMillis());\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticIpAllocator.class);\n+    public static final int IPv4_BUCKETS_COUNT = 256;\n+    private static final int IPV4_ALLOCATION_MAX_RETRY_COUNT = 10;\n+    private static final int IPV6_ALLOCATION_MAX_RETRY_COUNT = 2000;\n+    public static final BigInteger EIGHT_BYTES_SCOPE_RANGE = BigInteger.valueOf(Long.MAX_VALUE).multiply(\n+            BigInteger.valueOf(2)).add(BigInteger.valueOf(2));\n+\n+    private final ICache<String, ElasticIpAllocatedIpv4> allocatedIpv4Cache;\n+    private final ICache<String, ElasticIpAllocatedIpv6> allocatedIpv6Cache;\n+    private final ICache<String, ElasticIpAvailableBucketsSet> availableBucketsCache;\n+    private final IDistributedLock allocatedIpv4Lock;\n+    private final IDistributedLock allocatedIpv6Lock;\n+    private final IDistributedLock availableBucketsLock;\n+\n+    @Autowired\n+    public ElasticIpAllocator(CacheFactory cacheFactor, DistributedLockFactory lockFactory) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52dc126fb56313b9c5489dc4ea32b85276f28e6b"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyODYxNg==", "bodyText": "I know you are working on the UTs. I would recommend to add extensive UTs to cover ElasticIpAllocator. So important :)", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r447428616", "createdAt": "2020-06-30T06:00:06Z", "author": {"login": "xieus"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/dao/ElasticIpAllocator.java", "diffHunk": "@@ -0,0 +1,685 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.elasticipmanager.dao;\n+\n+import com.futurewei.alcor.common.db.*;\n+import com.futurewei.alcor.common.exception.DistributedLockException;\n+import com.futurewei.alcor.common.utils.Ipv4AddrUtil;\n+import com.futurewei.alcor.common.utils.Ipv6AddrUtil;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAllocatedIpv4;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAllocatedIpv6;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAvailableBucketsSet;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.ElasticIpExistsException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpQueryFormatException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeInUseException;\n+import com.futurewei.alcor.web.entity.elasticip.ElasticIpRange;\n+import com.futurewei.alcor.web.entity.ip.IpVersion;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+\n+import java.math.BigInteger;\n+import java.util.*;\n+\n+\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+@Repository\n+public class ElasticIpAllocator {\n+    private static final Random random = new Random(System.currentTimeMillis());\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticIpAllocator.class);\n+    public static final int IPv4_BUCKETS_COUNT = 256;\n+    private static final int IPV4_ALLOCATION_MAX_RETRY_COUNT = 10;\n+    private static final int IPV6_ALLOCATION_MAX_RETRY_COUNT = 2000;\n+    public static final BigInteger EIGHT_BYTES_SCOPE_RANGE = BigInteger.valueOf(Long.MAX_VALUE).multiply(\n+            BigInteger.valueOf(2)).add(BigInteger.valueOf(2));\n+\n+    private final ICache<String, ElasticIpAllocatedIpv4> allocatedIpv4Cache;\n+    private final ICache<String, ElasticIpAllocatedIpv6> allocatedIpv6Cache;\n+    private final ICache<String, ElasticIpAvailableBucketsSet> availableBucketsCache;\n+    private final IDistributedLock allocatedIpv4Lock;\n+    private final IDistributedLock allocatedIpv6Lock;\n+    private final IDistributedLock availableBucketsLock;\n+\n+    @Autowired\n+    public ElasticIpAllocator(CacheFactory cacheFactor, DistributedLockFactory lockFactory) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyODAwMA=="}, "originalCommit": {"oid": "52dc126fb56313b9c5489dc4ea32b85276f28e6b"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0MzA1Nw==", "bodyText": "OK, I plan to take the mocks deeper to the database operations level, that should cover mostly function paths of ElasticIpAllocator. The existing one UT is just for test ;)", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r447443057", "createdAt": "2020-06-30T06:36:45Z", "author": {"login": "Eric-Yuan"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/dao/ElasticIpAllocator.java", "diffHunk": "@@ -0,0 +1,685 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.elasticipmanager.dao;\n+\n+import com.futurewei.alcor.common.db.*;\n+import com.futurewei.alcor.common.exception.DistributedLockException;\n+import com.futurewei.alcor.common.utils.Ipv4AddrUtil;\n+import com.futurewei.alcor.common.utils.Ipv6AddrUtil;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAllocatedIpv4;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAllocatedIpv6;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAvailableBucketsSet;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.ElasticIpExistsException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpQueryFormatException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeInUseException;\n+import com.futurewei.alcor.web.entity.elasticip.ElasticIpRange;\n+import com.futurewei.alcor.web.entity.ip.IpVersion;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+\n+import java.math.BigInteger;\n+import java.util.*;\n+\n+\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+@Repository\n+public class ElasticIpAllocator {\n+    private static final Random random = new Random(System.currentTimeMillis());\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticIpAllocator.class);\n+    public static final int IPv4_BUCKETS_COUNT = 256;\n+    private static final int IPV4_ALLOCATION_MAX_RETRY_COUNT = 10;\n+    private static final int IPV6_ALLOCATION_MAX_RETRY_COUNT = 2000;\n+    public static final BigInteger EIGHT_BYTES_SCOPE_RANGE = BigInteger.valueOf(Long.MAX_VALUE).multiply(\n+            BigInteger.valueOf(2)).add(BigInteger.valueOf(2));\n+\n+    private final ICache<String, ElasticIpAllocatedIpv4> allocatedIpv4Cache;\n+    private final ICache<String, ElasticIpAllocatedIpv6> allocatedIpv6Cache;\n+    private final ICache<String, ElasticIpAvailableBucketsSet> availableBucketsCache;\n+    private final IDistributedLock allocatedIpv4Lock;\n+    private final IDistributedLock allocatedIpv6Lock;\n+    private final IDistributedLock availableBucketsLock;\n+\n+    @Autowired\n+    public ElasticIpAllocator(CacheFactory cacheFactor, DistributedLockFactory lockFactory) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyODAwMA=="}, "originalCommit": {"oid": "52dc126fb56313b9c5489dc4ea32b85276f28e6b"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDY5NjQ2OnYy", "diffSide": "RIGHT", "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/entity/ElasticIpAllocatedIpv6.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNjoyMDo0M1rOGtDYGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNjoyMDo0M1rOGtDYGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NDQyNg==", "bodyText": "ElasticIpAllocatedIpv4 support a set of ip address while Ipv6 has an individual ip. Do we expect to extend it to a set later?", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r449894426", "createdAt": "2020-07-05T16:20:43Z", "author": {"login": "xieus"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/entity/ElasticIpAllocatedIpv6.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\r\n+Copyright 2019 The Alcor Authors.\r\n+\r\n+Licensed under the Apache License, Version 2.0 (the \"License\");\r\n+        you may not use this file except in compliance with the License.\r\n+        You may obtain a copy of the License at\r\n+\r\n+        http://www.apache.org/licenses/LICENSE-2.0\r\n+\r\n+        Unless required by applicable law or agreed to in writing, software\r\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\r\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n+        See the License for the specific language governing permissions and\r\n+        limitations under the License.\r\n+*/\r\n+\r\n+package com.futurewei.alcor.elasticipmanager.entity;\r\n+\r\n+\r\n+import com.fasterxml.jackson.annotation.JsonProperty;\r\n+\r\n+\r\n+public class ElasticIpAllocatedIpv6 {\r\n+\r\n+    @JsonProperty(\"range_id\")\r\n+    private String rangeId;\r\n+\r\n+    @JsonProperty(\"allocated_ipv6\")\r\n+    private String allocatedIpv6;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ad33a7cd1a9b1ed1a6285c077ce3366899ebab8"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDY5Njg1OnYy", "diffSide": "RIGHT", "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/entity/ElasticIpAvailableBucketsSet.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNjoyMToyMFrOGtDYSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNjoyMToyMFrOGtDYSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NDQ3NA==", "bodyText": "Like the bucket design and impl!", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r449894474", "createdAt": "2020-07-05T16:21:20Z", "author": {"login": "xieus"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/entity/ElasticIpAvailableBucketsSet.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package com.futurewei.alcor.elasticipmanager.entity;\r\n+\r\n+import com.fasterxml.jackson.annotation.JsonProperty;\r\n+\r\n+import java.util.BitSet;\r\n+\r\n+\r\n+public class ElasticIpAvailableBucketsSet {\r\n+    @JsonProperty(\"range_id\")\r\n+    private String rangeId;\r\n+\r\n+    @JsonProperty(\"available_buckets_bitset\")\r\n+    private BitSet AvailableBucketsBitset;\r\n+\r\n+    public ElasticIpAvailableBucketsSet(String rangeId, BitSet availableBucketsBitset) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ad33a7cd1a9b1ed1a6285c077ce3366899ebab8"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDcwMDQ4OnYy", "diffSide": "RIGHT", "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/controller/ElasticIpController.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNjoyNjo1M1rOGtDaEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNTowODo1MVrOGtbcEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NDkzMQ==", "bodyText": "To make the controller method a bit explicit, I would recommend to create a controllerUtil class and move the private methods there.", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r449894931", "createdAt": "2020-07-05T16:26:53Z", "author": {"login": "xieus"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/controller/ElasticIpController.java", "diffHunk": "@@ -0,0 +1,484 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.elasticipmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.utils.Ipv4AddrUtil;\n+import com.futurewei.alcor.common.utils.Ipv6AddrUtil;\n+import com.futurewei.alcor.elasticipmanager.config.IpVersion;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpIdConfilictException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpNoProjectIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpProjectIdConflictException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.*;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpQueryFormatException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeBadRangesException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeNoIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeVersionException;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpRangeService;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpService;\n+import com.futurewei.alcor.web.entity.elasticip.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.util.StringUtils;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.math.BigInteger;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+\n+@RestController\n+public class ElasticIpController {\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticIpController.class);\n+\n+    @Autowired\n+    ElasticIpService elasticipService;\n+\n+    @Autowired\n+    ElasticIpRangeService elasticIpRangeService;\n+\n+    private boolean isIpAddressInvalid(String ipAddress, Integer ipVersion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ad33a7cd1a9b1ed1a6285c077ce3366899ebab8"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDI3NTM2OA==", "bodyText": "OK, will do", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r450275368", "createdAt": "2020-07-06T14:49:46Z", "author": {"login": "Eric-Yuan"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/controller/ElasticIpController.java", "diffHunk": "@@ -0,0 +1,484 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.elasticipmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.utils.Ipv4AddrUtil;\n+import com.futurewei.alcor.common.utils.Ipv6AddrUtil;\n+import com.futurewei.alcor.elasticipmanager.config.IpVersion;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpIdConfilictException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpNoProjectIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpProjectIdConflictException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.*;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpQueryFormatException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeBadRangesException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeNoIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeVersionException;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpRangeService;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpService;\n+import com.futurewei.alcor.web.entity.elasticip.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.util.StringUtils;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.math.BigInteger;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+\n+@RestController\n+public class ElasticIpController {\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticIpController.class);\n+\n+    @Autowired\n+    ElasticIpService elasticipService;\n+\n+    @Autowired\n+    ElasticIpRangeService elasticIpRangeService;\n+\n+    private boolean isIpAddressInvalid(String ipAddress, Integer ipVersion) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NDkzMQ=="}, "originalCommit": {"oid": "7ad33a7cd1a9b1ed1a6285c077ce3366899ebab8"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDI4ODY1OA==", "bodyText": "Done", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r450288658", "createdAt": "2020-07-06T15:08:51Z", "author": {"login": "Eric-Yuan"}, "path": "services/elastic_ip_manager/src/main/java/com/futurewei/alcor/elasticipmanager/controller/ElasticIpController.java", "diffHunk": "@@ -0,0 +1,484 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+\n+package com.futurewei.alcor.elasticipmanager.controller;\n+\n+import com.futurewei.alcor.common.entity.ResponseId;\n+import com.futurewei.alcor.common.utils.Ipv4AddrUtil;\n+import com.futurewei.alcor.common.utils.Ipv6AddrUtil;\n+import com.futurewei.alcor.elasticipmanager.config.IpVersion;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpIdConfilictException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpNoProjectIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpProjectIdConflictException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticip.*;\n+import com.futurewei.alcor.elasticipmanager.exception.ElasticIpQueryFormatException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeBadRangesException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeNoIdException;\n+import com.futurewei.alcor.elasticipmanager.exception.elasticiprange.ElasticIpRangeVersionException;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpRangeService;\n+import com.futurewei.alcor.elasticipmanager.service.ElasticIpService;\n+import com.futurewei.alcor.web.entity.elasticip.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.util.StringUtils;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.math.BigInteger;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+\n+@RestController\n+public class ElasticIpController {\n+    private static final Logger LOG = LoggerFactory.getLogger(ElasticIpController.class);\n+\n+    @Autowired\n+    ElasticIpService elasticipService;\n+\n+    @Autowired\n+    ElasticIpRangeService elasticIpRangeService;\n+\n+    private boolean isIpAddressInvalid(String ipAddress, Integer ipVersion) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NDkzMQ=="}, "originalCommit": {"oid": "7ad33a7cd1a9b1ed1a6285c077ce3366899ebab8"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNzg4MDAwOnYy", "diffSide": "RIGHT", "path": "pom.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNDoxMDowOFrOGvA_zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNjoyMToyN1rOGvDNTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk1MjU4OA==", "bodyText": "Not sure why we make the main JDK version here. Is it a merge issue?", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r451952588", "createdAt": "2020-07-09T04:10:08Z", "author": {"login": "xieus"}, "path": "pom.xml", "diffHunk": "@@ -11,9 +11,9 @@\n     <description>Alcor Controller Project</description>\n \n     <properties>\n-        <java.version>11</java.version>\n-        <maven.compiler.source>11</maven.compiler.source>\n-        <maven.compiler.target>11</maven.compiler.target>\n+        <java.version>1.8</java.version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af3cd287532bdbc64613686582f9370cf952061d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk4ODgxMw==", "bodyText": "sorry, It is a merge issue... I fixed it", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r451988813", "createdAt": "2020-07-09T06:21:27Z", "author": {"login": "Eric-Yuan"}, "path": "pom.xml", "diffHunk": "@@ -11,9 +11,9 @@\n     <description>Alcor Controller Project</description>\n \n     <properties>\n-        <java.version>11</java.version>\n-        <maven.compiler.source>11</maven.compiler.source>\n-        <maven.compiler.target>11</maven.compiler.target>\n+        <java.version>1.8</java.version>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk1MjU4OA=="}, "originalCommit": {"oid": "af3cd287532bdbc64613686582f9370cf952061d"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNzg4NDI0OnYy", "diffSide": "RIGHT", "path": "services/elastic_ip_manager/src/test/java/com/futurewei/alcor/elasticipmanager/ElasticIpControllerTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNDoxMjozNFrOGvBCNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNDoxMjozNFrOGvBCNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk1MzIwNQ==", "bodyText": "Like the comprehensive set of UTs. This is really good.", "url": "https://github.com/futurewei-cloud/alcor/pull/243#discussion_r451953205", "createdAt": "2020-07-09T04:12:34Z", "author": {"login": "xieus"}, "path": "services/elastic_ip_manager/src/test/java/com/futurewei/alcor/elasticipmanager/ElasticIpControllerTests.java", "diffHunk": "@@ -0,0 +1,1029 @@\n+/*\n+Copyright 2020 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.elasticipmanager;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.futurewei.alcor.common.db.CacheFactory;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.ignite.MockIgniteServer;\n+import com.futurewei.alcor.common.utils.Ipv4AddrUtil;\n+import com.futurewei.alcor.common.utils.Ipv6AddrUtil;\n+import com.futurewei.alcor.elasticipmanager.config.UnitTestConfig;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAllocatedIpv4;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAllocatedIpv6;\n+import com.futurewei.alcor.elasticipmanager.entity.ElasticIpAvailableBucketsSet;\n+import com.futurewei.alcor.web.entity.elasticip.*;\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.http.MediaType;\n+import org.springframework.test.context.junit4.SpringRunner;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.result.MockMvcResultMatchers;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.BitSet;\n+import java.util.List;\n+import java.util.Map;\n+\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.delete;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+\n+@RunWith(SpringRunner.class)\n+@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT,\n+        properties = {\"httpbin=http://localhost:${wiremock.server.port}\"})\n+@AutoConfigureMockMvc\n+@ComponentScan(value = \"com.futurewei.alcor.common.test.config\")\n+public class ElasticIpControllerTests extends MockIgniteServer {\n+\n+    @Autowired\n+    private MockMvc mockMvc;\n+\n+    @Autowired\n+    CacheFactory cacheFactor;\n+\n+    private void perpareRange() throws Exception {\n+        try {\n+            // create ipv4 elastic ip range\n+            List<ElasticIpRange.AllocationRange> allocationRanges = new ArrayList<>();\n+            allocationRanges.add(new ElasticIpRange.AllocationRange(\n+                    UnitTestConfig.elasticIpRangeStart1,\n+                    UnitTestConfig.elasticIpRangeEnd1));\n+\n+            ElasticIpRange eipRange = new ElasticIpRange(\n+                    UnitTestConfig.elasticIpRange1,\n+                    UnitTestConfig.elasticIpRangeName1,\n+                    UnitTestConfig.elasticIpRangeDescription1,\n+                    UnitTestConfig.elasticIpVersion1,\n+                    allocationRanges);\n+\n+            ElasticIpRangeInfoWrapper rangeRequest = new ElasticIpRangeInfoWrapper(new ElasticIpRangeInfo(eipRange));\n+            ObjectMapper mapper = new ObjectMapper();\n+            String rangeRequestStr =  mapper.writeValueAsString(rangeRequest);\n+            String createRangeUri = \"/elasticip-ranges\";\n+\n+            this.mockMvc.perform(post(createRangeUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(rangeRequestStr))\n+                    .andDo(print())\n+                    .andExpect(status().isCreated())\n+                    .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip-range.id\")\n+                            .value(UnitTestConfig.elasticIpRange1));\n+\n+            // get the elastic ip range and check cidrs\n+            String getEipRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange1;\n+            String responseStr = this.mockMvc.perform(get(getEipRangeUri))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andReturn().getResponse().getContentAsString();\n+\n+            ElasticIpRangeInfoWrapper response = mapper.readValue(responseStr, ElasticIpRangeInfoWrapper.class);\n+            Assert.assertEquals(UnitTestConfig.elasticIpRange1, response.getElasticIpRange().getId());\n+            Assert.assertEquals(UnitTestConfig.elasticIpRangeStart1,\n+                    response.getElasticIpRange().getAllocationRanges().get(0).getStart());\n+            Assert.assertEquals(UnitTestConfig.elasticIpRangeEnd1,\n+                    response.getElasticIpRange().getAllocationRanges().get(0).getEnd());\n+\n+            // create ipv6 elastic ip range\n+            List<ElasticIpRange.AllocationRange> allocationRangesIpv6 = new ArrayList<>();\n+            allocationRangesIpv6.add(new ElasticIpRange.AllocationRange(\n+                    UnitTestConfig.elasticIpRangeStart2,\n+                    UnitTestConfig.elasticIpRangeEnd2));\n+\n+            ElasticIpRange eipRangeIpv6 = new ElasticIpRange(\n+                    UnitTestConfig.elasticIpRange2,\n+                    UnitTestConfig.elasticIpRangeName2,\n+                    UnitTestConfig.elasticIpRangeDescription2,\n+                    UnitTestConfig.elasticIpVersion2,\n+                    allocationRangesIpv6);\n+\n+            ElasticIpRangeInfoWrapper rangeRequestIpv6 = new ElasticIpRangeInfoWrapper(new ElasticIpRangeInfo(eipRangeIpv6));\n+            String rangeRequestIpv6Str = mapper.writeValueAsString(rangeRequestIpv6);\n+\n+            this.mockMvc.perform(post(createRangeUri).contentType(MediaType.APPLICATION_JSON)\n+                    .content(rangeRequestIpv6Str))\n+                    .andDo(print())\n+                    .andExpect(status().isCreated())\n+                    .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip-range.id\")\n+                            .value(UnitTestConfig.elasticIpRange2));\n+\n+            // get the ipv6 elastic ip range and check cidrs\n+            getEipRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange2;\n+            responseStr = this.mockMvc.perform(get(getEipRangeUri))\n+                    .andDo(print())\n+                    .andExpect(status().isOk())\n+                    .andReturn().getResponse().getContentAsString();\n+\n+            response = mapper.readValue(responseStr, ElasticIpRangeInfoWrapper.class);\n+            Assert.assertEquals(UnitTestConfig.elasticIpRange2, response.getElasticIpRange().getId());\n+            Assert.assertEquals(UnitTestConfig.elasticIpRangeStart2,\n+                    response.getElasticIpRange().getAllocationRanges().get(0).getStart());\n+            Assert.assertEquals(UnitTestConfig.elasticIpRangeEnd2,\n+                    response.getElasticIpRange().getAllocationRanges().get(0).getEnd());\n+\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+            throw e;\n+        }\n+    }\n+\n+    private void cleanRange() throws Exception {\n+        try {\n+            String deleteRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange1;\n+            this.mockMvc.perform(delete(deleteRangeUri))\n+                    .andDo(print())\n+                    .andExpect(status().isOk());\n+\n+            deleteRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange2;\n+            this.mockMvc.perform(delete(deleteRangeUri))\n+                    .andDo(print())\n+                    .andExpect(status().isOk());\n+\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+            throw e;\n+        }\n+    }\n+\n+    private void showIPv4AllocationInfo() throws Exception {\n+        try {\n+            ICache<String, ElasticIpAvailableBucketsSet> availableBuckets = cacheFactor.getCache(\n+                    ElasticIpAvailableBucketsSet.class);\n+            System.out.print(\"\\nIpv4 available buckets: \\n\");\n+            for (Map.Entry<String, ElasticIpAvailableBucketsSet> item : availableBuckets.getAll().entrySet()) {\n+                System.out.print(\"Key \" + item.getKey() + \"\\n\");\n+                BitSet bitset = item.getValue().getAvailableBucketsBitset();\n+                int i = bitset.nextSetBit(0);\n+                while (i != -1 && i < 256 ) {\n+                    System.out.print(i + \" \");\n+                    i = bitset.nextSetBit(i + 1);\n+                }\n+            }\n+\n+            ICache<String, ElasticIpAllocatedIpv4> allocatedIpv4Cache = cacheFactor.getCache(ElasticIpAllocatedIpv4.class);\n+            for (Map.Entry<String, ElasticIpAllocatedIpv4> item : allocatedIpv4Cache.getAll().entrySet()) {\n+                System.out.print(\"\\nIpv4 allocation bucket \" + item.getKey() + \"\\n\");\n+                ElasticIpAllocatedIpv4 loop = item.getValue();\n+                System.out.print(\"Ipv4 allocation bucket allocated ips: \");\n+                for (Long allocatedIp: loop.getAllocatedIps()) {\n+                    System.out.print(Ipv4AddrUtil.longToIpv4(allocatedIp) + \", \");\n+                }\n+                System.out.print(\"\\n Ipv4 allocation bucket available ips: \");\n+                for (Long availableIp: loop.getAvailableIps()) {\n+                    System.out.print(Ipv4AddrUtil.longToIpv4(availableIp) + \", \");\n+                }\n+            }\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+            throw e;\n+        }\n+    }\n+\n+    private void showIPv6AllocationInfo() throws Exception {\n+        try {\n+            ICache<String, ElasticIpAllocatedIpv6> allocatedIpv6Cache = cacheFactor.getCache(ElasticIpAllocatedIpv6.class);\n+            System.out.print(\"\\nIpv6 allocated ips: \\n\");\n+            for (Map.Entry<String, ElasticIpAllocatedIpv6> item : allocatedIpv6Cache.getAll().entrySet()) {\n+                ElasticIpAllocatedIpv6 loop = item.getValue();\n+                System.out.print(loop.getAllocatedIpv6());\n+            }\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+            throw e;\n+        }\n+    }\n+\n+    @Test\n+    public void elasticIp_IpSpecified_create_update_delete() throws Exception {\n+        this.perpareRange();\n+\n+        // create the elastic ip\n+        ElasticIp postRequest = new ElasticIp();\n+        postRequest.setProjectId(UnitTestConfig.projectId1);\n+        postRequest.setElasticIp(UnitTestConfig.elasticIpv4Address1);\n+        postRequest.setElasticIpVersion(UnitTestConfig.elasticIpVersion1);\n+        postRequest.setName(UnitTestConfig.elasticIpName1);\n+        postRequest.setDescription(UnitTestConfig.elasticIpDescription1);\n+\n+        ElasticIpInfoWrapper requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(postRequest));\n+        ObjectMapper mapper = new ObjectMapper();\n+        String requestStr =  mapper.writeValueAsString(requestWraper);\n+        String createEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips\";\n+        String responseStr = this.mockMvc.perform(post(createEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isCreated())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.elastic_ip\")\n+                        .value(UnitTestConfig.elasticIpv4Address1))\n+                .andReturn().getResponse().getContentAsString();\n+        ElasticIpInfoWrapper response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        String elasticIpId = response.getElasticip().getId();\n+\n+        // get the elastic ip and check the ip address\n+        String getEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        responseStr = this.mockMvc.perform(get(getEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andReturn().getResponse().getContentAsString();\n+\n+        response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        Assert.assertEquals(UnitTestConfig.elasticIpv4Address1, response.getElasticip().getElasticIp());\n+        Assert.assertEquals(UnitTestConfig.elasticIpVersion1, response.getElasticip().getElasticIpVersion());\n+        Assert.assertEquals(UnitTestConfig.elasticIpName1, response.getElasticip().getName());\n+        Assert.assertEquals(UnitTestConfig.elasticIpDescription1, response.getElasticip().getDescription());\n+        Assert.assertEquals(elasticIpId, response.getElasticip().getId());\n+\n+\n+        // update the address of the elastic ip\n+        ElasticIp putRequest = new ElasticIp();\n+        putRequest.setProjectId(UnitTestConfig.projectId1);\n+        putRequest.setId(elasticIpId);\n+        putRequest.setElasticIp(UnitTestConfig.elasticIpv4Address2);\n+        putRequest.setElasticIpVersion(UnitTestConfig.elasticIpVersion1);\n+\n+        requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(requestWraper);\n+\n+        String updateEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(put(updateEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isBadRequest());\n+\n+        // this.showIPv4AllocationInfo();\n+\n+        // delete the elastic ip\n+        String deleteEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(delete(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        // this.showIPv4AllocationInfo();\n+\n+        // check the elastic ip does not exist\n+        this.mockMvc.perform(get(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isNotFound());\n+\n+        this.cleanRange();\n+    }\n+\n+    @Test\n+    public void elasticIp_IpNotSpecified_create_delete() throws Exception {\n+        this.perpareRange();\n+\n+        // create the elastic ip\n+        ElasticIp postRequest = new ElasticIp();\n+        postRequest.setProjectId(UnitTestConfig.projectId1);\n+\n+        ElasticIpInfoWrapper requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(postRequest));\n+        ObjectMapper mapper = new ObjectMapper();\n+        String requestStr =  mapper.writeValueAsString(requestWraper);\n+        String createEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips\";\n+        String responseStr = this.mockMvc.perform(post(createEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isCreated())\n+                .andReturn().getResponse().getContentAsString();\n+        ElasticIpInfoWrapper response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        String elasticIpId = response.getElasticip().getId();\n+\n+        // check the elastic ip exists\n+        String getEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(get(getEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        // this.showIPv4AllocationInfo();\n+\n+        // delete the elastic ip\n+        String deleteEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(delete(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        // this.showIPv4AllocationInfo();\n+\n+        // check the elastic ip does not exist\n+        this.mockMvc.perform(get(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isNotFound());\n+\n+        this.cleanRange();\n+    }\n+\n+    @Test\n+    public void elasticIp_Ipv6Specified_create_update_delete() throws Exception {\n+        this.perpareRange();\n+\n+        // create the elastic ip (version IPv6)\n+        ElasticIp postRequest = new ElasticIp();\n+        postRequest.setProjectId(UnitTestConfig.projectId1);\n+        postRequest.setElasticIp(UnitTestConfig.elasticIpv6Address1);\n+        postRequest.setElasticIpVersion(UnitTestConfig.elasticIpVersion2);\n+        postRequest.setName(UnitTestConfig.elasticIpName2);\n+        postRequest.setDescription(UnitTestConfig.elasticIpDescription2);\n+\n+        this.showIPv6AllocationInfo();\n+\n+        ElasticIpInfoWrapper requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(postRequest));\n+        ObjectMapper mapper = new ObjectMapper();\n+        String requestStr =  mapper.writeValueAsString(requestWraper);\n+        String createEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips\";\n+        String responseStr = this.mockMvc.perform(post(createEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isCreated())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.elastic_ip\")\n+                        .value(UnitTestConfig.elasticIpv6Address1))\n+                .andReturn().getResponse().getContentAsString();\n+        ElasticIpInfoWrapper response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        String elasticIpId = response.getElasticip().getId();\n+\n+        // get the elastic ip and check the ip address\n+        String getEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        responseStr = this.mockMvc.perform(get(getEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andReturn().getResponse().getContentAsString();\n+\n+        response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        Assert.assertEquals(UnitTestConfig.elasticIpv6Address1, response.getElasticip().getElasticIp());\n+        Assert.assertEquals(UnitTestConfig.elasticIpVersion2, response.getElasticip().getElasticIpVersion());\n+        Assert.assertEquals(UnitTestConfig.elasticIpName2, response.getElasticip().getName());\n+        Assert.assertEquals(UnitTestConfig.elasticIpDescription2, response.getElasticip().getDescription());\n+        Assert.assertEquals(elasticIpId, response.getElasticip().getId());\n+\n+        // update the address of the elastic ip\n+        ElasticIp putRequest = new ElasticIp();\n+        putRequest.setProjectId(UnitTestConfig.projectId1);\n+        putRequest.setId(elasticIpId);\n+        putRequest.setElasticIp(UnitTestConfig.elasticIpv6Address2);\n+        putRequest.setElasticIpVersion(UnitTestConfig.elasticIpVersion2);\n+\n+        requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(requestWraper);\n+\n+        String updateEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(put(updateEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isBadRequest());\n+\n+        // this.showIPv6AllocationInfo();\n+\n+        // delete the elastic ip\n+        String deleteEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(delete(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        // this.showIPv6AllocationInfo();\n+\n+        // check the elastic ip does not exist\n+        this.mockMvc.perform(get(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isNotFound());\n+\n+        this.cleanRange();\n+    }\n+\n+    @Test\n+    public void elasticIp_Ipv6NotSpecified_create_delete() throws Exception {\n+        this.perpareRange();\n+\n+        // create the elastic ip (version IPv6)\n+        ElasticIp postRequest = new ElasticIp();\n+        postRequest.setProjectId(UnitTestConfig.projectId1);\n+        postRequest.setElasticIpVersion(UnitTestConfig.elasticIpVersion2);\n+\n+        ElasticIpInfoWrapper requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(postRequest));\n+        ObjectMapper mapper = new ObjectMapper();\n+        String requestStr =  mapper.writeValueAsString(requestWraper);\n+        String createEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips\";\n+        String responseStr = this.mockMvc.perform(post(createEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isCreated())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.elastic_ip_version\")\n+                        .value(UnitTestConfig.elasticIpVersion2))\n+                .andReturn().getResponse().getContentAsString();\n+        ElasticIpInfoWrapper response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        String elasticIpId = response.getElasticip().getId();\n+        String ipv6Address = response.getElasticip().getElasticIp();\n+\n+        // get the elastic ip and check the ip address\n+        String getEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        responseStr = this.mockMvc.perform(get(getEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andReturn().getResponse().getContentAsString();\n+\n+        response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        Assert.assertEquals(ipv6Address, response.getElasticip().getElasticIp());\n+        Assert.assertEquals(UnitTestConfig.elasticIpVersion2, response.getElasticip().getElasticIpVersion());\n+        Assert.assertEquals(elasticIpId, response.getElasticip().getId());\n+\n+        // delete the elastic ip\n+        String deleteEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(delete(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        // this.showIPv6AllocationInfo();\n+\n+        // check the elastic ip does not exist\n+        this.mockMvc.perform(get(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isNotFound());\n+\n+        this.cleanRange();\n+    }\n+\n+    @Test\n+    public void elasticIpRange_ipv4Range_update_delete() throws Exception {\n+        this.perpareRange();\n+\n+        // create an Ipv4 elastic ip\n+        ElasticIp postRequest = new ElasticIp();\n+        postRequest.setProjectId(UnitTestConfig.projectId1);\n+        postRequest.setElasticIp(UnitTestConfig.elasticIpv4Address1);\n+        postRequest.setElasticIpVersion(UnitTestConfig.elasticIpVersion1);\n+\n+        ElasticIpInfoWrapper requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(postRequest));\n+        ObjectMapper mapper = new ObjectMapper();\n+        String requestStr =  mapper.writeValueAsString(requestWraper);\n+        String createEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips\";\n+        String responseStr = this.mockMvc.perform(post(createEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isCreated())\n+                .andReturn().getResponse().getContentAsString();\n+        ElasticIpInfoWrapper response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        String elasticIpId = response.getElasticip().getId();\n+\n+        // try to delete the range\n+        String deleteRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange1;\n+        this.mockMvc.perform(delete(deleteRangeUri))\n+                .andDo(print())\n+                .andExpect(status().isNotAcceptable());\n+\n+        // try to update the allocation ranges to new ranges\n+        ElasticIpRange putRequest = new ElasticIpRange();\n+\n+        List<ElasticIpRange.AllocationRange> allocationRanges = new ArrayList<>();\n+        allocationRanges.add(new ElasticIpRange.AllocationRange(\n+                UnitTestConfig.elasticIpRangeStart3,\n+                UnitTestConfig.elasticIpRangeEnd3));\n+        putRequest.setAllocationRanges(allocationRanges);\n+        putRequest.setId(UnitTestConfig.elasticIpRange1);\n+\n+        ElasticIpRangeInfoWrapper rangeRequestWraper = new ElasticIpRangeInfoWrapper(new ElasticIpRangeInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(rangeRequestWraper);\n+        String updateEipRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange1;\n+        this.mockMvc.perform(put(updateEipRangeUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isNotAcceptable());\n+\n+        // add new range to allocation ranges\n+        putRequest = new ElasticIpRange();\n+        allocationRanges = new ArrayList<>();\n+        allocationRanges.add(new ElasticIpRange.AllocationRange(\n+                UnitTestConfig.elasticIpRangeStart1,\n+                UnitTestConfig.elasticIpRangeEnd1));\n+        allocationRanges.add(new ElasticIpRange.AllocationRange(\n+                UnitTestConfig.elasticIpRangeStart3,\n+                UnitTestConfig.elasticIpRangeEnd3));\n+        putRequest.setAllocationRanges(allocationRanges);\n+        putRequest.setId(UnitTestConfig.elasticIpRange1);\n+\n+        rangeRequestWraper = new ElasticIpRangeInfoWrapper(new ElasticIpRangeInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(rangeRequestWraper);\n+        updateEipRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange1;\n+        responseStr = this.mockMvc.perform(put(updateEipRangeUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andReturn().getResponse().getContentAsString();\n+        ElasticIpRangeInfoWrapper rangeResponse = mapper.readValue(responseStr, ElasticIpRangeInfoWrapper.class);\n+        List<ElasticIpRange.AllocationRange> resultRanges = rangeResponse.getElasticIpRange().getAllocationRanges();\n+        Assert.assertEquals(2, resultRanges.size());\n+\n+        // create an new Ipv4 elastic ip using new ranges\n+        postRequest = new ElasticIp();\n+        postRequest.setProjectId(UnitTestConfig.projectId1);\n+        postRequest.setElasticIp(UnitTestConfig.elasticIpv4Address3);\n+        postRequest.setElasticIpVersion(UnitTestConfig.elasticIpVersion1);\n+\n+        requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(postRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(requestWraper);\n+        createEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips\";\n+        responseStr = this.mockMvc.perform(post(createEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isCreated())\n+                .andReturn().getResponse().getContentAsString();\n+        response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        String elasticIpId2 = response.getElasticip().getId();\n+\n+        // delete the new created elastic ip\n+        String deleteEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId2;\n+        this.mockMvc.perform(delete(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        // remove a range from allocation ranges\n+        putRequest = new ElasticIpRange();\n+        allocationRanges = new ArrayList<>();\n+        allocationRanges.add(new ElasticIpRange.AllocationRange(\n+                UnitTestConfig.elasticIpRangeStart1,\n+                UnitTestConfig.elasticIpRangeEnd1));\n+        putRequest.setAllocationRanges(allocationRanges);\n+        putRequest.setId(UnitTestConfig.elasticIpRange1);\n+\n+        rangeRequestWraper = new ElasticIpRangeInfoWrapper(new ElasticIpRangeInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(rangeRequestWraper);\n+        updateEipRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange1;\n+        responseStr = this.mockMvc.perform(put(updateEipRangeUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andReturn().getResponse().getContentAsString();\n+        rangeResponse = mapper.readValue(responseStr, ElasticIpRangeInfoWrapper.class);\n+        resultRanges = rangeResponse.getElasticIpRange().getAllocationRanges();\n+        Assert.assertEquals(1, resultRanges.size());\n+\n+        // delete the elastic ip\n+        deleteEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(delete(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        this.cleanRange();\n+    }\n+\n+    @Test\n+    public void elasticIpRange_ipv6Range_update_delete() throws Exception {\n+        this.perpareRange();\n+\n+        // create an Ipv6 elastic ip\n+        ElasticIp postRequest = new ElasticIp();\n+        postRequest.setProjectId(UnitTestConfig.projectId1);\n+        postRequest.setElasticIp(UnitTestConfig.elasticIpv6Address1);\n+        postRequest.setElasticIpVersion(UnitTestConfig.elasticIpVersion2);\n+\n+        ElasticIpInfoWrapper requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(postRequest));\n+        ObjectMapper mapper = new ObjectMapper();\n+        String requestStr =  mapper.writeValueAsString(requestWraper);\n+        String createEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips\";\n+        String responseStr = this.mockMvc.perform(post(createEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isCreated())\n+                .andReturn().getResponse().getContentAsString();\n+        ElasticIpInfoWrapper response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        String elasticIpId = response.getElasticip().getId();\n+\n+        // try to delete the range\n+        String deleteRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange2;\n+        this.mockMvc.perform(delete(deleteRangeUri))\n+                .andDo(print())\n+                .andExpect(status().isNotAcceptable());\n+\n+        // try to update the allocation ranges to new ranges\n+        ElasticIpRange putRequest = new ElasticIpRange();\n+\n+        List<ElasticIpRange.AllocationRange> allocationRanges = new ArrayList<>();\n+        allocationRanges.add(new ElasticIpRange.AllocationRange(\n+                UnitTestConfig.elasticIpRangeStart4,\n+                UnitTestConfig.elasticIpRangeEnd4));\n+        putRequest.setIpVersion(UnitTestConfig.elasticIpRangeIpVersion2);\n+        putRequest.setAllocationRanges(allocationRanges);\n+        putRequest.setId(UnitTestConfig.elasticIpRange2);\n+\n+        ElasticIpRangeInfoWrapper rangeRequestWraper = new ElasticIpRangeInfoWrapper(new ElasticIpRangeInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(rangeRequestWraper);\n+        String updateEipRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange2;\n+        this.mockMvc.perform(put(updateEipRangeUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isNotAcceptable());\n+\n+        // add new range to allocation ranges\n+        putRequest = new ElasticIpRange();\n+        allocationRanges = new ArrayList<>();\n+        allocationRanges.add(new ElasticIpRange.AllocationRange(\n+                UnitTestConfig.elasticIpRangeStart2,\n+                UnitTestConfig.elasticIpRangeEnd2));\n+        allocationRanges.add(new ElasticIpRange.AllocationRange(\n+                UnitTestConfig.elasticIpRangeStart4,\n+                UnitTestConfig.elasticIpRangeEnd4));\n+        putRequest.setIpVersion(UnitTestConfig.elasticIpRangeIpVersion2);\n+        putRequest.setAllocationRanges(allocationRanges);\n+        putRequest.setId(UnitTestConfig.elasticIpRange2);\n+\n+        rangeRequestWraper = new ElasticIpRangeInfoWrapper(new ElasticIpRangeInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(rangeRequestWraper);\n+        updateEipRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange2;\n+        responseStr = this.mockMvc.perform(put(updateEipRangeUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andReturn().getResponse().getContentAsString();\n+        ElasticIpRangeInfoWrapper rangeResponse = mapper.readValue(responseStr, ElasticIpRangeInfoWrapper.class);\n+        List<ElasticIpRange.AllocationRange> resultRanges = rangeResponse.getElasticIpRange().getAllocationRanges();\n+        Assert.assertEquals(2, resultRanges.size());\n+\n+        // create an Ipv6 elastic ip using new ranges\n+        postRequest = new ElasticIp();\n+        postRequest.setProjectId(UnitTestConfig.projectId1);\n+        postRequest.setElasticIp(UnitTestConfig.elasticIpv6Address3);\n+        postRequest.setElasticIpVersion(UnitTestConfig.elasticIpVersion2);\n+\n+        requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(postRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(requestWraper);\n+        createEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips\";\n+        responseStr = this.mockMvc.perform(post(createEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isCreated())\n+                .andReturn().getResponse().getContentAsString();\n+        response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        String elasticIpId2 = response.getElasticip().getId();\n+\n+        // delete the new created elastic ip\n+        String deleteEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId2;\n+        this.mockMvc.perform(delete(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        // remove a range from allocation ranges\n+        putRequest = new ElasticIpRange();\n+        allocationRanges = new ArrayList<>();\n+        allocationRanges.add(new ElasticIpRange.AllocationRange(\n+                UnitTestConfig.elasticIpRangeStart2,\n+                UnitTestConfig.elasticIpRangeEnd2));\n+        putRequest.setAllocationRanges(allocationRanges);\n+        putRequest.setIpVersion(UnitTestConfig.elasticIpRangeIpVersion2);\n+        putRequest.setId(UnitTestConfig.elasticIpRange2);\n+\n+        rangeRequestWraper = new ElasticIpRangeInfoWrapper(new ElasticIpRangeInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(rangeRequestWraper);\n+        updateEipRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange2;\n+        responseStr = this.mockMvc.perform(put(updateEipRangeUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andReturn().getResponse().getContentAsString();\n+        rangeResponse = mapper.readValue(responseStr, ElasticIpRangeInfoWrapper.class);\n+        resultRanges = rangeResponse.getElasticIpRange().getAllocationRanges();\n+        Assert.assertEquals(1, resultRanges.size());\n+\n+        // delete the elastic ip\n+        deleteEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(delete(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        this.cleanRange();\n+    }\n+\n+    @Test\n+    public void elasticIp_updateDns() throws Exception {\n+        this.perpareRange();\n+\n+        // create the elastic ip\n+        ElasticIp postRequest = new ElasticIp();\n+        postRequest.setProjectId(UnitTestConfig.projectId1);\n+        postRequest.setElasticIpVersion(UnitTestConfig.elasticIpVersion1);\n+\n+        ElasticIpInfoWrapper requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(postRequest));\n+        ObjectMapper mapper = new ObjectMapper();\n+        String requestStr =  mapper.writeValueAsString(requestWraper);\n+        String createEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips\";\n+        String responseStr = this.mockMvc.perform(post(createEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isCreated())\n+                .andReturn().getResponse().getContentAsString();\n+        ElasticIpInfoWrapper response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        String elasticIpId = response.getElasticip().getId();\n+\n+        // get the elastic ip and check dns config is empty\n+        String getEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        responseStr = this.mockMvc.perform(get(getEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andReturn().getResponse().getContentAsString();\n+\n+        response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        Assert.assertEquals(\"\", response.getElasticip().getDnsDomain());\n+        Assert.assertEquals(\"\", response.getElasticip().getDnsName());\n+\n+        // update dns config of the elastic ip\n+        ElasticIp putRequest = new ElasticIp();\n+        putRequest.setProjectId(UnitTestConfig.projectId1);\n+        putRequest.setId(elasticIpId);\n+        putRequest.setDnsDomain(UnitTestConfig.elasticIpDnsDomain1);\n+        putRequest.setDnsName(UnitTestConfig.elasticIpDnsName1);\n+\n+        requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(requestWraper);\n+\n+        String updateEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(put(updateEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        // get the elastic ip and check dns config success\n+        getEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        responseStr = this.mockMvc.perform(get(getEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.dns_domain\")\n+                        .value(UnitTestConfig.elasticIpDnsDomain1))\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.dns_name\")\n+                        .value(UnitTestConfig.elasticIpDnsName1))\n+                .andReturn().getResponse().getContentAsString();\n+\n+        response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        Assert.assertEquals(UnitTestConfig.elasticIpDnsDomain1, response.getElasticip().getDnsDomain());\n+        Assert.assertEquals(UnitTestConfig.elasticIpDnsName1, response.getElasticip().getDnsName());\n+\n+        // update other config of the elastic ip and check dns config not changed\n+        putRequest = new ElasticIp();\n+        putRequest.setProjectId(UnitTestConfig.projectId1);\n+        putRequest.setId(elasticIpId);\n+        putRequest.setDescription(UnitTestConfig.elasticIpRangeDescription1);\n+\n+        requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(requestWraper);\n+\n+        updateEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(put(updateEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.dns_domain\")\n+                        .value(UnitTestConfig.elasticIpDnsDomain1))\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.dns_name\")\n+                        .value(UnitTestConfig.elasticIpDnsName1));\n+\n+        // update dns config of the elastic ip to empty str\n+        putRequest = new ElasticIp();\n+        putRequest.setProjectId(UnitTestConfig.projectId1);\n+        putRequest.setId(elasticIpId);\n+        putRequest.setDnsDomain(\"\");\n+        putRequest.setDnsName(\"\");\n+\n+        requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(requestWraper);\n+\n+        updateEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(put(updateEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.dns_domain\").value(\"\"))\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.dns_name\").value(\"\"));\n+\n+        // delete the elastic ip\n+        String deleteEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(delete(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        this.cleanRange();\n+    }\n+\n+    @Test\n+    public void elasticIp_updateNameAndDescription() throws Exception {\n+        this.perpareRange();\n+\n+        // create the elastic ip\n+        ElasticIp postRequest = new ElasticIp();\n+        postRequest.setProjectId(UnitTestConfig.projectId1);\n+        postRequest.setElasticIpVersion(UnitTestConfig.elasticIpVersion1);\n+\n+        ElasticIpInfoWrapper requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(postRequest));\n+        ObjectMapper mapper = new ObjectMapper();\n+        String requestStr =  mapper.writeValueAsString(requestWraper);\n+        String createEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips\";\n+        String responseStr = this.mockMvc.perform(post(createEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isCreated())\n+                .andReturn().getResponse().getContentAsString();\n+        ElasticIpInfoWrapper response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        String elasticIpId = response.getElasticip().getId();\n+\n+        // get the elastic ip and check name and description are empty\n+        String getEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        responseStr = this.mockMvc.perform(get(getEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andReturn().getResponse().getContentAsString();\n+\n+        response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        Assert.assertEquals(\"\", response.getElasticip().getName());\n+        Assert.assertEquals(\"\", response.getElasticip().getDescription());\n+\n+        // update name and description of the elastic ip\n+        ElasticIp putRequest = new ElasticIp();\n+        putRequest.setProjectId(UnitTestConfig.projectId1);\n+        putRequest.setId(elasticIpId);\n+        putRequest.setName(UnitTestConfig.elasticIpName1);\n+        putRequest.setDescription(UnitTestConfig.elasticIpDescription1);\n+\n+        requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(requestWraper);\n+\n+        String updateEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(put(updateEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        // get the elastic ip and check name and descritpion config success\n+        getEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        responseStr = this.mockMvc.perform(get(getEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.name\")\n+                        .value(UnitTestConfig.elasticIpName1))\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.description\")\n+                        .value(UnitTestConfig.elasticIpDescription1))\n+                .andReturn().getResponse().getContentAsString();\n+\n+        response = mapper.readValue(responseStr, ElasticIpInfoWrapper.class);\n+        Assert.assertEquals(UnitTestConfig.elasticIpName1, response.getElasticip().getName());\n+        Assert.assertEquals(UnitTestConfig.elasticIpDescription1, response.getElasticip().getDescription());\n+\n+        // update other config of the elastic ip and name and description not changed\n+        putRequest = new ElasticIp();\n+        putRequest.setProjectId(UnitTestConfig.projectId1);\n+        putRequest.setId(elasticIpId);\n+        putRequest.setDnsDomain(UnitTestConfig.elasticIpDnsDomain1);\n+        putRequest.setDnsName(UnitTestConfig.elasticIpDnsName1);\n+\n+        requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(requestWraper);\n+\n+        updateEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(put(updateEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.name\")\n+                        .value(UnitTestConfig.elasticIpName1))\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.description\")\n+                        .value(UnitTestConfig.elasticIpDescription1));\n+\n+        // update name and description of the elastic ip to empty str\n+        putRequest = new ElasticIp();\n+        putRequest.setProjectId(UnitTestConfig.projectId1);\n+        putRequest.setId(elasticIpId);\n+        putRequest.setName(\"\");\n+        putRequest.setDescription(\"\");\n+\n+        requestWraper = new ElasticIpInfoWrapper(new ElasticIpInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(requestWraper);\n+\n+        updateEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(put(updateEipUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.name\").value(\"\"))\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip.description\").value(\"\"));\n+\n+        // delete the elastic ip\n+        String deleteEipUri = \"/project/\" + UnitTestConfig.projectId1 + \"/elasticips/\" + elasticIpId;\n+        this.mockMvc.perform(delete(deleteEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk());\n+\n+        this.cleanRange();\n+    }\n+\n+    @Test\n+    public void elasticIpRange_updateNameAndDescription() throws Exception {\n+        this.perpareRange();\n+\n+        // update other config and check name and description not changed\n+        ElasticIpRange putRequest = new ElasticIpRange();\n+        List<ElasticIpRange.AllocationRange> allocationRanges = new ArrayList<>();\n+        allocationRanges.add(new ElasticIpRange.AllocationRange(\n+                UnitTestConfig.elasticIpRangeStart1,\n+                UnitTestConfig.elasticIpRangeEnd1));\n+        allocationRanges.add(new ElasticIpRange.AllocationRange(\n+                UnitTestConfig.elasticIpRangeStart3,\n+                UnitTestConfig.elasticIpRangeEnd3));\n+        putRequest.setAllocationRanges(allocationRanges);\n+        putRequest.setId(UnitTestConfig.elasticIpRange1);\n+\n+        ElasticIpRangeInfoWrapper rangeRequestWraper = new ElasticIpRangeInfoWrapper(new ElasticIpRangeInfo(putRequest));\n+        ObjectMapper mapper = new ObjectMapper();\n+        String requestStr =  mapper.writeValueAsString(rangeRequestWraper);\n+        String updateEipRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange1;\n+        this.mockMvc.perform(put(updateEipRangeUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip-range.name\")\n+                        .value(UnitTestConfig.elasticIpRangeName1))\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip-range.description\")\n+                        .value(UnitTestConfig.elasticIpRangeDescription1));\n+\n+        String getEipUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange1;\n+        this.mockMvc.perform(get(getEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip-range.name\")\n+                        .value(UnitTestConfig.elasticIpRangeName1))\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip-range.description\")\n+                        .value(UnitTestConfig.elasticIpRangeDescription1));\n+\n+        // update name and description of the elastic ip range to empty str\n+        putRequest = new ElasticIpRange();\n+        putRequest.setName(\"\");\n+        putRequest.setDescription(\"\");\n+        putRequest.setId(UnitTestConfig.elasticIpRange1);\n+\n+        rangeRequestWraper = new ElasticIpRangeInfoWrapper(new ElasticIpRangeInfo(putRequest));\n+        mapper = new ObjectMapper();\n+        requestStr =  mapper.writeValueAsString(rangeRequestWraper);\n+        updateEipRangeUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange1;\n+        this.mockMvc.perform(put(updateEipRangeUri).contentType(MediaType.APPLICATION_JSON)\n+                .content(requestStr))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip-range.name\")\n+                        .value(\"\"))\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip-range.description\")\n+                        .value(\"\"));\n+\n+        getEipUri = \"/elasticip-ranges/\" + UnitTestConfig.elasticIpRange1;\n+        this.mockMvc.perform(get(getEipUri))\n+                .andDo(print())\n+                .andExpect(status().isOk())\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip-range.name\")\n+                        .value(\"\"))\n+                .andExpect(MockMvcResultMatchers.jsonPath(\"$.elasticip-range.description\")\n+                        .value(\"\"));\n+\n+        this.cleanRange();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af3cd287532bdbc64613686582f9370cf952061d"}, "originalPosition": 1017}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4551, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}