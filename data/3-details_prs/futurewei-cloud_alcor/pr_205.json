{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNzU0Mzc0", "number": 205, "title": "[Documentation] Migration Plan for OpenStack Users", "bodyText": "Some main steps of migration:\n\nIntercept Neutron messages: save a copy and redirect them back to Neutron\nTransform original data: batch pull network resources from Neutron, transform those data in the form of Alcor, and processed them as bulk create operations.\nreprocess cached messages: reprocess those cached messages", "createdAt": "2020-05-20T13:33:34Z", "url": "https://github.com/futurewei-cloud/alcor/pull/205", "merged": true, "mergeCommit": {"oid": "e9c9f02d0ce037823927dc90ab1234cbc47e986c"}, "closed": true, "closedAt": "2020-05-23T14:27:45Z", "author": {"login": "Eric-Yuan"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjDp9vgH2gAyNDIwNzU0Mzc0OjQxMGZkY2NmMWQ1YWM4Yzg1YzFmMWRkMDhmNGMzNjM3NmEyMWI0ODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABckHuXUAFqTQxNzI4MjkwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "410fdccf1d5ac8c85c1f1dd08f4c36376a21b480", "author": {"user": {"login": "Eric-Yuan", "name": "Wei Yuan"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/410fdccf1d5ac8c85c1f1dd08f4c36376a21b480", "committedDate": "2020-05-20T07:08:59Z", "message": "Merge pull request #1 from futurewei-cloud/master\n\npull update from source"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f1fc262b657299acf6da89850513fadc6aabdcf", "author": {"user": {"login": "Eric-Yuan", "name": "Wei Yuan"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/5f1fc262b657299acf6da89850513fadc6aabdcf", "committedDate": "2020-05-20T13:28:47Z", "message": "[Document] Some design thought of migration from Neutron"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64ee5fc7bc11f5fc01575da273575af151a03203", "author": {"user": {"login": "Eric-Yuan", "name": "Wei Yuan"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/64ee5fc7bc11f5fc01575da273575af151a03203", "committedDate": "2020-05-21T03:58:42Z", "message": "[Document] Some design thought of migration from Neutron\nSome main steps of migration:\n1) Intercept Neutron messages: save a copy and redirect them back to Neutron\n2) Transform original data: batch pull network resources from Neutron, transform those data in the form of Alcor, and processed them as bulk create operations.\n3) reprocess cached messages: reprocess those cached messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ac6507a61605354f89259fe50d40964780c327d", "author": {"user": {"login": "Eric-Yuan", "name": "Wei Yuan"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/2ac6507a61605354f89259fe50d40964780c327d", "committedDate": "2020-05-21T03:59:00Z", "message": "Merge branch 'neutron-migration' of https://github.com/Eric-Yuan/alcor into neutron-migration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjMyMzc1", "url": "https://github.com/futurewei-cloud/alcor/pull/205#pullrequestreview-417232375", "createdAt": "2020-05-23T00:23:45Z", "commit": {"oid": "2ac6507a61605354f89259fe50d40964780c327d"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjM3OTYz", "url": "https://github.com/futurewei-cloud/alcor/pull/205#pullrequestreview-417237963", "createdAt": "2020-05-23T01:16:57Z", "commit": {"oid": "2ac6507a61605354f89259fe50d40964780c327d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwMToxNjo1N1rOGZmqow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwMTo0NzowNVrOGZmz6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTA5MQ==", "bodyText": "Like this idea!", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429501091", "createdAt": "2020-05-23T01:16:57Z", "author": {"login": "xieus"}, "path": "docs/design/deployment.adoc", "diffHunk": "@@ -5,7 +5,35 @@ v0.1, 2020-05-17\n \n NOTE: This document is under development\n \n-== Migration Plane from Openstack Neutron\n+== Migration Plan from Openstack Neutron\n+\n+First, the structures of Neutron models are not consistent with the Alcor's. \n+We need a tool that can transform the existing Neutron network configurations into the Alcor's, so that Alcor can process it.\n+These converted network configurations should be handled by Alcor as batch creation operation messages with all parameters specified.\n+\n+However, we still want users to be able to continue configuring on this openstack environment, \n+as we use the tool to convert the netruon network configurations to Alcors.\n+At this time, the virtual switch in compute node side should still be taken over by neutron agents, ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ac6507a61605354f89259fe50d40964780c327d"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMTQ2Nw==", "bodyText": "The idea of this three-step migration plan is awesome. Let us explicit call it out.\nSuggest to use the following subtitles:\n\"=== Step 1: Active Neutron and Passive Alcor with Request Caching\"\n\"=== Step 2: Proactive Request Processing by Alcor\"\n\"=== Step 3: Seamless Transition to Active Alcor\"", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429501467", "createdAt": "2020-05-23T01:21:10Z", "author": {"login": "xieus"}, "path": "docs/design/deployment.adoc", "diffHunk": "@@ -5,7 +5,35 @@ v0.1, 2020-05-17\n \n NOTE: This document is under development\n \n-== Migration Plane from Openstack Neutron\n+== Migration Plan from Openstack Neutron\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ac6507a61605354f89259fe50d40964780c327d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMjgzMw==", "bodyText": "Let us talk about message forwarding and cache more :-)\nIn some regions with high QPS, the migration proxy could become the potential bottleneck and we would need careful plan for that, in terms of latency overhead and size of cached requests. Could you get a rough idea of how much requests could be processed?", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429502833", "createdAt": "2020-05-23T01:39:17Z", "author": {"login": "xieus"}, "path": "docs/design/deployment.adoc", "diffHunk": "@@ -5,7 +5,35 @@ v0.1, 2020-05-17\n \n NOTE: This document is under development\n \n-== Migration Plane from Openstack Neutron\n+== Migration Plan from Openstack Neutron\n+\n+First, the structures of Neutron models are not consistent with the Alcor's. \n+We need a tool that can transform the existing Neutron network configurations into the Alcor's, so that Alcor can process it.\n+These converted network configurations should be handled by Alcor as batch creation operation messages with all parameters specified.\n+\n+However, we still want users to be able to continue configuring on this openstack environment, \n+as we use the tool to convert the netruon network configurations to Alcors.\n+At this time, the virtual switch in compute node side should still be taken over by neutron agents, \n+and an alcor control agent should be in a state that can normally receive configuration, \n+but does not send configuration to the virtual switch.\n+The newly generated configuration during this conversion may not be simultaneously converted to Alcor and processed, \n+therefore, we also need to intercept all the operation messages received by the Neutron during the conversion period.\n+And in addition to passing them through to the Neutron so that the Neutron can normally process the messages,\n+we also need to copy those operation messages and temporarily cache them.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ac6507a61605354f89259fe50d40964780c327d"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMzQ2Nw==", "bodyText": "This OpenStack CLI changes fall into one question: are we capable of asking all clients of the existing in-house OpenStack clusters upgrade with new pointer to Alcor? It might or may not.\nThe existing Neutron APIs could be called by clients in house (like Nova) and in customer's sides (like deployment scripts).\n\nEasier for the in-house clients\nAs we don't have control customer's clients, it would be very tricky here. One possible option is use to same DNS name pointing to different backend IP addresses. But need to handle with long DNS expiration.\n\nLet us have more discussion on this.", "url": "https://github.com/futurewei-cloud/alcor/pull/205#discussion_r429503467", "createdAt": "2020-05-23T01:47:05Z", "author": {"login": "xieus"}, "path": "docs/design/deployment.adoc", "diffHunk": "@@ -5,7 +5,35 @@ v0.1, 2020-05-17\n \n NOTE: This document is under development\n \n-== Migration Plane from Openstack Neutron\n+== Migration Plan from Openstack Neutron\n+\n+First, the structures of Neutron models are not consistent with the Alcor's. \n+We need a tool that can transform the existing Neutron network configurations into the Alcor's, so that Alcor can process it.\n+These converted network configurations should be handled by Alcor as batch creation operation messages with all parameters specified.\n+\n+However, we still want users to be able to continue configuring on this openstack environment, \n+as we use the tool to convert the netruon network configurations to Alcors.\n+At this time, the virtual switch in compute node side should still be taken over by neutron agents, \n+and an alcor control agent should be in a state that can normally receive configuration, \n+but does not send configuration to the virtual switch.\n+The newly generated configuration during this conversion may not be simultaneously converted to Alcor and processed, \n+therefore, we also need to intercept all the operation messages received by the Neutron during the conversion period.\n+And in addition to passing them through to the Neutron so that the Neutron can normally process the messages,\n+we also need to copy those operation messages and temporarily cache them.\n+\n+image::images/neutron_migration_phase1.png[\"Migration Phase1\", width=1024, link=\"images/neutron_migration_phase1.png\"]\n+\n+After the conversion of the original network configurations is completed, \n+these cached operation messages should also be converted to alcor's messages and processed.\n+\n+image::images/neutron_migration_phase2.png[\"Migration Phase2\", width=1024, link=\"images/neutron_migration_phase2.png\"]\n+\n+After that, the openstack CLI can switch to send operation messages directly to Alcor.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ac6507a61605354f89259fe50d40964780c327d"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9607d43218cb7f6da4e5a49937194f8bb3cb2edd", "author": {"user": {"login": "Eric-Yuan", "name": "Wei Yuan"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/9607d43218cb7f6da4e5a49937194f8bb3cb2edd", "committedDate": "2020-05-23T03:46:29Z", "message": "Merge pull request #2 from futurewei-cloud/master\n\nsync original repository codes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e495791e486c5edb9eb714c93652cee45cadc663", "author": {"user": {"login": "Eric-Yuan", "name": "Wei Yuan"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/e495791e486c5edb9eb714c93652cee45cadc663", "committedDate": "2020-05-23T03:55:55Z", "message": "adjust picture width"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "904aba95322c9cad593bb14920227f760f44702f", "author": {"user": {"login": "Eric-Yuan", "name": "Wei Yuan"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/904aba95322c9cad593bb14920227f760f44702f", "committedDate": "2020-05-23T07:25:29Z", "message": "1. update the document's position\n2. add some explain about that only need proxy write requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94e6beda1cd343225f0946c56d0d90a1e93caa2a", "author": {"user": {"login": "Eric-Yuan", "name": "Wei Yuan"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/94e6beda1cd343225f0946c56d0d90a1e93caa2a", "committedDate": "2020-05-23T07:29:10Z", "message": "Merge branch 'neutron-migration' of https://github.com/Eric-Yuan/alcor into neutron-migration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84196d5edeb11d6c2758c3d552fbb00a02755a5f", "author": {"user": {"login": "Eric-Yuan", "name": "Wei Yuan"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/84196d5edeb11d6c2758c3d552fbb00a02755a5f", "committedDate": "2020-05-23T07:30:31Z", "message": "remove old file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjgyNzQy", "url": "https://github.com/futurewei-cloud/alcor/pull/205#pullrequestreview-417282742", "createdAt": "2020-05-23T14:25:17Z", "commit": {"oid": "84196d5edeb11d6c2758c3d552fbb00a02755a5f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjgyOTAz", "url": "https://github.com/futurewei-cloud/alcor/pull/205#pullrequestreview-417282903", "createdAt": "2020-05-23T14:27:20Z", "commit": {"oid": "84196d5edeb11d6c2758c3d552fbb00a02755a5f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2089, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}