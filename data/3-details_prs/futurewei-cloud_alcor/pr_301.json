{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwODkyODEy", "number": 301, "title": "[Microservice] Port Manager 2.0 Implementation", "bodyText": "This PR includes the following features:\n\nRefactoring port-manager.\nVpc supports batch acquisition.\nSubnet supports batch acquisition.\nMac address supports batch creation.\nIp address supports batch creation.\nSecurity groups support batch acquisition and binding/unbinding.", "createdAt": "2020-07-17T08:06:21Z", "url": "https://github.com/futurewei-cloud/alcor/pull/301", "merged": true, "mergeCommit": {"oid": "76707cfdcea91bfcb2c7b34815a3892a03309dfd"}, "closed": true, "closedAt": "2020-08-10T23:48:02Z", "author": {"login": "chenpiaoping"}, "timelineItems": {"totalCount": 53, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1vszygBqjM1NTcwMzg4MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9q95agFqTQ2NDY0ODI5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b876082599ec4a9dd358e9ed72bdc59139e62df", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/3b876082599ec4a9dd358e9ed72bdc59139e62df", "committedDate": "2020-07-17T08:21:26Z", "message": "Fix compile error"}, "afterCommit": {"oid": "451e09acad3250629e679cbc2142f03724068bc3", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/451e09acad3250629e679cbc2142f03724068bc3", "committedDate": "2020-07-17T08:35:29Z", "message": "Fix compile error"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "451e09acad3250629e679cbc2142f03724068bc3", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/451e09acad3250629e679cbc2142f03724068bc3", "committedDate": "2020-07-17T08:35:29Z", "message": "Fix compile error"}, "afterCommit": {"oid": "d5788815c4f6113e60c8f75c152dd5d685eaac35", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/d5788815c4f6113e60c8f75c152dd5d685eaac35", "committedDate": "2020-07-17T10:08:06Z", "message": "Fix compile error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNTkxNTM2", "url": "https://github.com/futurewei-cloud/alcor/pull/301#pullrequestreview-450591536", "createdAt": "2020-07-17T11:48:35Z", "commit": {"oid": "d5788815c4f6113e60c8f75c152dd5d685eaac35"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMTo0ODozNVrOGzP-tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMjowMDoxN1rOGzQSqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5MjM3NQ==", "bodyText": "Cool. Like the change.\nPR #297 also sets this flag as true for existing microservices, but we also need to change it fundamentally in DB module.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r456392375", "createdAt": "2020-07-17T11:48:35Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/ignite/IgniteConfiguration.java", "diffHunk": "@@ -70,7 +70,7 @@\n     @Value(\"${ignite.trust-store-password:#{null}}\")\n     private String trustStorePassword;\n \n-    @Value(\"${ignite.thin.client.enable: #{false}}\")\n+    @Value(\"${ignite.thin.client.enable: #{true}}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5788815c4f6113e60c8f75c152dd5d685eaac35"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5Mzc3OA==", "bodyText": "These are duplicated. Please remove.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r456393778", "createdAt": "2020-07-17T11:51:35Z", "author": {"login": "xieus"}, "path": "services/mac_manager/src/main/resources/application.properties", "diffHunk": "@@ -1,6 +1,14 @@\n server.port=9005\n-\n #####MAC manager configuration######\n+#Machine configuration", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5788815c4f6113e60c8f75c152dd5d685eaac35"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5NTM2MQ==", "bodyText": "Will this give us some false positive information that the duration is zero? :-)", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r456395361", "createdAt": "2020-07-17T11:55:18Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/stats/DurationCalculator.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.common.stats;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class DurationCalculator {\n+    private static final Logger LOG = LoggerFactory.getLogger(DurationCalculator.class);\n+\n+    private static Map<Long, Long> startTimes = new HashMap<>();\n+\n+    public static void begin() {\n+        long id = Thread.currentThread().getId();\n+        startTimes.put(id, System.nanoTime());\n+    }\n+\n+    public static void end(String description) {\n+        long id = Thread.currentThread().getId();\n+        long endTime = System.nanoTime();\n+        long startTime;\n+        if (startTimes.containsKey(id)) {\n+            startTime = startTimes.get(id);\n+        } else {\n+            startTime = endTime;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5788815c4f6113e60c8f75c152dd5d685eaac35"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5NTc4Ng==", "bodyText": "Remove?", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r456395786", "createdAt": "2020-07-17T11:56:26Z", "author": {"login": "xieus"}, "path": "services/node_manager/src/main/resources/application.properties", "diffHunk": "@@ -1,9 +1,11 @@\n server.port=9007\n-\n #####Ignite configuration######\n ignite.host=localhost\n ignite.port=10800\n-ignite.thin.client.enable=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5788815c4f6113e60c8f75c152dd5d685eaac35"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5NjE1OA==", "bodyText": "Interesting!", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r456396158", "createdAt": "2020-07-17T11:57:23Z", "author": {"login": "xieus"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/service/implement/PortServiceImpl.java", "diffHunk": "@@ -37,9 +38,10 @@\n import java.util.*;\n import java.util.concurrent.CompletableFuture;\n \n-@Service\n-@ComponentScan(value = \"com.futurewei.alcor.common.utils\")\n-@ComponentScan(value = \"com.futurewei.alcor.web.restclient\")\n+//@Service\n+//@ComponentScan(value = \"com.futurewei.alcor.common.utils\")\n+//@ComponentScan(value = \"com.futurewei.alcor.web.restclient\")\n+@Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5788815c4f6113e60c8f75c152dd5d685eaac35"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5NjMzNg==", "bodyText": "Which guy replace this? Let me keep looking.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r456396336", "createdAt": "2020-07-17T11:57:47Z", "author": {"login": "xieus"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/service/implement/PortServiceImpl.java", "diffHunk": "@@ -37,9 +38,10 @@\n import java.util.*;\n import java.util.concurrent.CompletableFuture;\n \n-@Service\n-@ComponentScan(value = \"com.futurewei.alcor.common.utils\")\n-@ComponentScan(value = \"com.futurewei.alcor.web.restclient\")\n+//@Service\n+//@ComponentScan(value = \"com.futurewei.alcor.common.utils\")\n+//@ComponentScan(value = \"com.futurewei.alcor.web.restclient\")\n+@Deprecated", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5NjE1OA=="}, "originalCommit": {"oid": "d5788815c4f6113e60c8f75c152dd5d685eaac35"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5NjY4OA==", "bodyText": "I think we have some merge issue for application.properties. These are also duplicated.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r456396688", "createdAt": "2020-07-17T11:58:36Z", "author": {"login": "xieus"}, "path": "services/port_manager/src/main/resources/application.properties", "diffHunk": "@@ -1,6 +1,15 @@\n server.port=9006\n-\n #####Microservice url configuration######\n+#Redis configuration", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5788815c4f6113e60c8f75c152dd5d685eaac35"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5NzQ4Mw==", "bodyText": "This is a very good annotation. Consider to apply it to all other services as well \ud83d\udc4d", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r456397483", "createdAt": "2020-07-17T12:00:17Z", "author": {"login": "xieus"}, "path": "services/private_ip_manager/src/main/java/com/futurewei/alcor/privateipmanager/controller/IpAddrController.java", "diffHunk": "@@ -82,6 +85,7 @@ private int checkIpVersion(String ipAddress) throws Exception {\n     @PostMapping(\"/ips\")\n     @ResponseBody\n     @ResponseStatus(HttpStatus.CREATED)\n+    @DurationStatistics", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5788815c4f6113e60c8f75c152dd5d685eaac35"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5788815c4f6113e60c8f75c152dd5d685eaac35", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/d5788815c4f6113e60c8f75c152dd5d685eaac35", "committedDate": "2020-07-17T10:08:06Z", "message": "Fix compile error"}, "afterCommit": {"oid": "13d5c8d261adb763ee8647118a7cb05e94e568a1", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/13d5c8d261adb763ee8647118a7cb05e94e568a1", "committedDate": "2020-07-20T01:48:49Z", "message": "Fix compile error"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13d5c8d261adb763ee8647118a7cb05e94e568a1", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/13d5c8d261adb763ee8647118a7cb05e94e568a1", "committedDate": "2020-07-20T01:48:49Z", "message": "Fix compile error"}, "afterCommit": {"oid": "f75247816e55e0b63dc5a17c3ff63ed700abfefa", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/f75247816e55e0b63dc5a17c3ff63ed700abfefa", "committedDate": "2020-07-20T01:55:48Z", "message": "Fix compile error"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34acc081d44f277f8ab35c4d53cd20d720bb2bd9", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/34acc081d44f277f8ab35c4d53cd20d720bb2bd9", "committedDate": "2020-07-20T09:30:34Z", "message": "private-ip-manager performance optimization"}, "afterCommit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/439252a00868f8a417be17e73a9e67a1e2ca6616", "committedDate": "2020-07-20T10:48:45Z", "message": "private-ip-manager performance optimization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMDMyOTA0", "url": "https://github.com/futurewei-cloud/alcor/pull/301#pullrequestreview-452032904", "createdAt": "2020-07-20T23:47:47Z", "commit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMzo0Nzo0N1rOG0jEbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwMDoyODoxOVrOG0jyfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc1MzcxMA==", "bodyText": "Can we explicit set it to false?", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r457753710", "createdAt": "2020-07-20T23:47:47Z", "author": {"login": "xieus"}, "path": "lib/src/main/java/com/futurewei/alcor/common/db/ignite/MockIgniteServer.java", "diffHunk": "@@ -55,6 +57,11 @@ public static void init() {\n                 tcpDiscoverySpi.setLocalPortRange(LISTEN_PORT_RANGE);\n                 cfg.setDiscoverySpi(tcpDiscoverySpi);\n //                cfg.setPeerClassLoadingEnabled(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MTAwMQ==", "bodyText": "Can we use Alcor logger or you need something special from slf4j?", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r457761001", "createdAt": "2020-07-21T00:12:26Z", "author": {"login": "xieus"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/processor/AbstractProcessor.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.portmanager.processor;\n+\n+import org.slf4j.Logger;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MjU2Nw==", "bodyText": "We should keep this configuration as thick client is not fully supported in K8s scenario.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r457762567", "createdAt": "2020-07-21T00:17:53Z", "author": {"login": "xieus"}, "path": "services/vpc_manager/src/main/resources/application.properties", "diffHunk": "@@ -1,12 +1,10 @@\n server.port=9001\n-\n #####Microservice url configuration######\n microservices.route.service.url=http://localhost:9003/vpcs/\n \n #####Ignite configuration######\n ignite.host=localhost\n ignite.port=10800\n-ignite.thin.client.enable=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2MzQwOA==", "bodyText": "Does the @DaTa annotation not work here?", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r457763408", "createdAt": "2020-07-21T00:20:51Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/entity/subnet/SubnetEntity.java", "diffHunk": "@@ -208,4 +208,284 @@ public SubnetEntity(SubnetEntity subnetEntity) {\n                 subnetEntity.getHostRoutes(), subnetEntity.getPrefixlen(), subnetEntity.useDefaultSubnetpool, subnetEntity.getServiceTypes(), subnetEntity.getCreated_at(),\n                 subnetEntity.getUpdated_at());\n     }\n+\n+    public String getVpcId() {\n+        return vpcId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2NDA2NQ==", "bodyText": "Keep this configuration as well.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r457764065", "createdAt": "2020-07-21T00:23:12Z", "author": {"login": "xieus"}, "path": "services/security_group_manager/src/main/resources/application.properties", "diffHunk": "@@ -1,9 +1,7 @@\n server.port=9008\n-\n #####Ignite configuration######\n ignite.host=localhost\n ignite.port=10800\n-ignite.thin.client.enable=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2NDk3MQ==", "bodyText": "@chenpiaoping Can you test the SG APIs from API GW to see if anything is expected? Recently there is a minor change of List SG API introduced by PR ##304. The List SG contract was not fully compatible wit Neutron. Can you check others as well.\nThanks.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r457764971", "createdAt": "2020-07-21T00:26:18Z", "author": {"login": "xieus"}, "path": "services/security_group_manager/src/main/java/com/futurewei/alcor/securitygroup/controller/SecurityGroupRuleController.java", "diffHunk": "@@ -15,24 +15,28 @@\n */\n package com.futurewei.alcor.securitygroup.controller;\n \n+import com.futurewei.alcor.common.stats.DurationStatistics;\n import com.futurewei.alcor.securitygroup.service.SecurityGroupRuleService;\n import com.futurewei.alcor.web.entity.securitygroup.SecurityGroupRule;\n import com.futurewei.alcor.web.entity.securitygroup.SecurityGroupRuleBulkJson;\n import com.futurewei.alcor.web.entity.securitygroup.SecurityGroupRuleJson;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n import org.springframework.http.HttpStatus;\n import org.springframework.web.bind.annotation.*;\n import java.util.List;\n import static com.futurewei.alcor.securitygroup.utils.RestParameterValidator.*;\n \n @RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2NTEzNQ==", "bodyText": "You can do it a separate/small PR if any change is needed.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r457765135", "createdAt": "2020-07-21T00:26:56Z", "author": {"login": "xieus"}, "path": "services/security_group_manager/src/main/java/com/futurewei/alcor/securitygroup/controller/SecurityGroupRuleController.java", "diffHunk": "@@ -15,24 +15,28 @@\n */\n package com.futurewei.alcor.securitygroup.controller;\n \n+import com.futurewei.alcor.common.stats.DurationStatistics;\n import com.futurewei.alcor.securitygroup.service.SecurityGroupRuleService;\n import com.futurewei.alcor.web.entity.securitygroup.SecurityGroupRule;\n import com.futurewei.alcor.web.entity.securitygroup.SecurityGroupRuleBulkJson;\n import com.futurewei.alcor.web.entity.securitygroup.SecurityGroupRuleJson;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n import org.springframework.http.HttpStatus;\n import org.springframework.web.bind.annotation.*;\n import java.util.List;\n import static com.futurewei.alcor.securitygroup.utils.RestParameterValidator.*;\n \n @RestController\n+@ComponentScan(value = \"com.futurewei.alcor.common.stats\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2NDk3MQ=="}, "originalCommit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2NTIyOQ==", "bodyText": "Keep this as well.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r457765229", "createdAt": "2020-07-21T00:27:15Z", "author": {"login": "xieus"}, "path": "services/route_manager/src/main/resources/application.properties", "diffHunk": "@@ -1,9 +1,7 @@\n server.port=9003\n-\n #####Ignite configuration######\n ignite.host=localhost\n ignite.port=10800\n-ignite.thin.client.enable=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2NTUwMA==", "bodyText": "Keep this as well.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r457765500", "createdAt": "2020-07-21T00:28:19Z", "author": {"login": "xieus"}, "path": "services/private_ip_manager/src/main/resources/application.properties", "diffHunk": "@@ -1,9 +1,7 @@\n server.port=9004\n-\n #####Ignite configuration######\n ignite.host=localhost\n ignite.port=10800\n-ignite.thin.client.enable=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "439252a00868f8a417be17e73a9e67a1e2ca6616", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/439252a00868f8a417be17e73a9e67a1e2ca6616", "committedDate": "2020-07-20T10:48:45Z", "message": "private-ip-manager performance optimization"}, "afterCommit": {"oid": "89faca6d64234992ff388d8cd1d4572f94016f5d", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/89faca6d64234992ff388d8cd1d4572f94016f5d", "committedDate": "2020-07-22T01:48:11Z", "message": "private-ip-manager performance optimization"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "132cad8cd5e73199157728e854e07c2efe590298", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/132cad8cd5e73199157728e854e07c2efe590298", "committedDate": "2020-07-22T07:40:14Z", "message": "add thin ignite config item"}, "afterCommit": {"oid": "9e59445e8c3080c828e6d75f9bb94000215d998a", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/9e59445e8c3080c828e6d75f9bb94000215d998a", "committedDate": "2020-07-22T08:27:04Z", "message": "add thin ignite config item"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e59445e8c3080c828e6d75f9bb94000215d998a", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/9e59445e8c3080c828e6d75f9bb94000215d998a", "committedDate": "2020-07-22T08:27:04Z", "message": "add thin ignite config item"}, "afterCommit": {"oid": "54882bf3e04f5d82945561c10d80e2b3e4fb0686", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/54882bf3e04f5d82945561c10d80e2b3e4fb0686", "committedDate": "2020-07-22T08:34:26Z", "message": "add thin ignite config item"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1dec6edef9b1b67b6059269cd0309115a04f8f51", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/1dec6edef9b1b67b6059269cd0309115a04f8f51", "committedDate": "2020-07-23T09:15:26Z", "message": "Rest client supports batch interface"}, "afterCommit": {"oid": "0b8fb2c5d283342b5c47d66b06a748c1e6f0630f", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/0b8fb2c5d283342b5c47d66b06a748c1e6f0630f", "committedDate": "2020-07-23T09:30:44Z", "message": "Rest client supports batch interface"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b8fb2c5d283342b5c47d66b06a748c1e6f0630f", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/0b8fb2c5d283342b5c47d66b06a748c1e6f0630f", "committedDate": "2020-07-23T09:30:44Z", "message": "Rest client supports batch interface"}, "afterCommit": {"oid": "3f4fd270359f4f6ce3abd0af2cb1714f3cf4d820", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/3f4fd270359f4f6ce3abd0af2cb1714f3cf4d820", "committedDate": "2020-07-23T12:09:12Z", "message": "Rest client supports batch interface"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f4fd270359f4f6ce3abd0af2cb1714f3cf4d820", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/3f4fd270359f4f6ce3abd0af2cb1714f3cf4d820", "committedDate": "2020-07-23T12:09:12Z", "message": "Rest client supports batch interface"}, "afterCommit": {"oid": "9b8dc67b0156e8f46063b94c4be82e56c6689bd3", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/9b8dc67b0156e8f46063b94c4be82e56c6689bd3", "committedDate": "2020-07-24T01:43:40Z", "message": "Rest client supports batch interface"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ece36ae0327513a37ed946f33fe4bda483b35386", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/ece36ae0327513a37ed946f33fe4bda483b35386", "committedDate": "2020-07-24T04:42:35Z", "message": "security group support query with parameters"}, "afterCommit": {"oid": "3197a817214edfd85b59b949bdfea6bdfe5dae0b", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/3197a817214edfd85b59b949bdfea6bdfe5dae0b", "committedDate": "2020-07-24T04:44:38Z", "message": "security group support query with parameters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb02fdb2256e0df28716d71f516c55a5e2b1f874", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/cb02fdb2256e0df28716d71f516c55a5e2b1f874", "committedDate": "2020-07-25T06:50:18Z", "message": "Batch port binding security groups are supported"}, "afterCommit": {"oid": "c66982ef723401725daece88c7379b7315428534", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/c66982ef723401725daece88c7379b7315428534", "committedDate": "2020-07-25T08:56:41Z", "message": "Batch port binding security groups are supported"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c66982ef723401725daece88c7379b7315428534", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/c66982ef723401725daece88c7379b7315428534", "committedDate": "2020-07-25T08:56:41Z", "message": "Batch port binding security groups are supported"}, "afterCommit": {"oid": "8d593dcbec9d0beb957815020b7f14dd2b198881", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/8d593dcbec9d0beb957815020b7f14dd2b198881", "committedDate": "2020-07-27T02:08:47Z", "message": "Rebase from alcor master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MjYxODcx", "url": "https://github.com/futurewei-cloud/alcor/pull/301#pullrequestreview-455261871", "createdAt": "2020-07-25T05:06:53Z", "commit": {"oid": "ba6c9ba4bbc267ce46391c31da94822541f6182a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQwNTowNjo1M1rOG3Chog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNVQwNTowNjo1M1rOG3Chog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM2NjI0Mg==", "bodyText": "extra line.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r460366242", "createdAt": "2020-07-25T05:06:53Z", "author": {"login": "xieus"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/processor/CallbackFunction.java", "diffHunk": "@@ -0,0 +1,9 @@\n+package com.futurewei.alcor.portmanager.processor;\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba6c9ba4bbc267ce46391c31da94822541f6182a"}, "originalPosition": 3}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d593dcbec9d0beb957815020b7f14dd2b198881", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/8d593dcbec9d0beb957815020b7f14dd2b198881", "committedDate": "2020-07-27T02:08:47Z", "message": "Rebase from alcor master"}, "afterCommit": {"oid": "f83279f8884c6c02ec072479f4d141ad4c04fc43", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/f83279f8884c6c02ec072479f4d141ad4c04fc43", "committedDate": "2020-07-30T03:44:12Z", "message": "Rebase from alcor master"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "180aa0e86e430130a6aaaa3af9c6a88b3448e8fa", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/180aa0e86e430130a6aaaa3af9c6a88b3448e8fa", "committedDate": "2020-07-31T10:26:58Z", "message": "Allocate ip address by subnet id"}, "afterCommit": {"oid": "a0788ea1840ced34fb3acb70b7d0ce4cbda56227", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/a0788ea1840ced34fb3acb70b7d0ce4cbda56227", "committedDate": "2020-08-03T01:55:17Z", "message": "Allocate ip address by subnet id"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad395dc08f0f47c57fcb40521f234fa39082d21a", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/ad395dc08f0f47c57fcb40521f234fa39082d21a", "committedDate": "2020-08-03T09:02:56Z", "message": "Build the correct network configuration when updating port"}, "afterCommit": {"oid": "103ea6688c839194a76091f2d6e43c357b7dc9e5", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/103ea6688c839194a76091f2d6e43c357b7dc9e5", "committedDate": "2020-08-03T09:11:19Z", "message": "Build the correct network configuration when updating port"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15590e633a6efef0e14d15417ad2de31bbf73ad3", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/15590e633a6efef0e14d15417ad2de31bbf73ad3", "committedDate": "2020-08-04T04:37:47Z", "message": "Fix the problem of incorrect network configuration"}, "afterCommit": {"oid": "c11f91ed078d021b72cd76fdb2b2dcc3452c89a9", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/c11f91ed078d021b72cd76fdb2b2dcc3452c89a9", "committedDate": "2020-08-04T06:26:48Z", "message": "Fix the problem of incorrect network configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c11f91ed078d021b72cd76fdb2b2dcc3452c89a9", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/c11f91ed078d021b72cd76fdb2b2dcc3452c89a9", "committedDate": "2020-08-04T06:26:48Z", "message": "Fix the problem of incorrect network configuration"}, "afterCommit": {"oid": "56836b8f740691248a4a04d41f8d96104c8dee94", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/56836b8f740691248a4a04d41f8d96104c8dee94", "committedDate": "2020-08-04T07:22:12Z", "message": "Query node info by name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56836b8f740691248a4a04d41f8d96104c8dee94", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/56836b8f740691248a4a04d41f8d96104c8dee94", "committedDate": "2020-08-04T07:22:12Z", "message": "Query node info by name"}, "afterCommit": {"oid": "e9cb38564ee41aec2f776e19190630cd94072d2d", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/e9cb38564ee41aec2f776e19190630cd94072d2d", "committedDate": "2020-08-04T07:27:02Z", "message": "Query node info by name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9cb38564ee41aec2f776e19190630cd94072d2d", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/e9cb38564ee41aec2f776e19190630cd94072d2d", "committedDate": "2020-08-04T07:27:02Z", "message": "Query node info by name"}, "afterCommit": {"oid": "9c81f1e185eb2b28c174f68a3915f2105242dddd", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/9c81f1e185eb2b28c174f68a3915f2105242dddd", "committedDate": "2020-08-04T08:06:25Z", "message": "Query node info by name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMTc1MDkz", "url": "https://github.com/futurewei-cloud/alcor/pull/301#pullrequestreview-461175093", "createdAt": "2020-08-04T21:06:44Z", "commit": {"oid": "9c81f1e185eb2b28c174f68a3915f2105242dddd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMTowNjo0NFrOG7xhTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQyMTowNjo1OVrOG7xh3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMzMDUwOQ==", "bodyText": "\"node_name\" => \"name\"", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r465330509", "createdAt": "2020-08-04T21:06:44Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/restclient/NodeManagerRestClient.java", "diffHunk": "@@ -34,8 +38,23 @@\n \n     @DurationStatistics\n     public NodeInfoJson getNodeInfo(String nodeId) throws Exception {\n-        String url = nodeManagerUrl + \"/\" + nodeId;\n-        return getRequest(url, NodeInfoJson.class);\n+        String queryParameter = buildQueryParameter(\"node_name\", Collections.singletonList(nodeId));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c81f1e185eb2b28c174f68a3915f2105242dddd"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMzMDY1Mw==", "bodyText": "\"node_name\" => \"name\"", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r465330653", "createdAt": "2020-08-04T21:06:59Z", "author": {"login": "xieus"}, "path": "web/src/main/java/com/futurewei/alcor/web/restclient/NodeManagerRestClient.java", "diffHunk": "@@ -34,8 +38,23 @@\n \n     @DurationStatistics\n     public NodeInfoJson getNodeInfo(String nodeId) throws Exception {\n-        String url = nodeManagerUrl + \"/\" + nodeId;\n-        return getRequest(url, NodeInfoJson.class);\n+        String queryParameter = buildQueryParameter(\"node_name\", Collections.singletonList(nodeId));\n+        String url = nodeManagerUrl + \"?\" + queryParameter;\n+        NodesWebJson nodesWebJson = getForObject(url, NodesWebJson.class);\n+        if (nodesWebJson == null ||\n+                nodesWebJson.getNodeInfos() == null ||\n+                nodesWebJson.getNodeInfos().size() != 1) {\n+            return new NodeInfoJson();\n+        }\n+\n+        return new NodeInfoJson(nodesWebJson.getNodeInfos().get(0));\n+    }\n+\n+    @DurationStatistics\n+    public NodesWebJson getNodeInfoBulk(List<String> nodeIds) throws Exception {\n+        String queryParameter = buildQueryParameter(\"node_name\", nodeIds);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c81f1e185eb2b28c174f68a3915f2105242dddd"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNDA1MjUx", "url": "https://github.com/futurewei-cloud/alcor/pull/301#pullrequestreview-461405251", "createdAt": "2020-08-05T07:25:21Z", "commit": {"oid": "27d5b642ae0b5e117494d88c91a1d80868fb31e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNzoyNToyMVrOG79fpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNzoyNToyMVrOG79fpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUyNjY5NQ==", "bodyText": "@chenpiaoping  Piaoping, our debug session doesn't include the commit 27d5b64 \"Change the name of neighbor cache\" which was just committed right before the meeting. Do you think this would make the difference?\nAlso can you pull from the latest master later today as we want to make sure your private branch has all the master payload? Thanks.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r465526695", "createdAt": "2020-08-05T07:25:21Z", "author": {"login": "xieus"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/repo/PortRepository.java", "diffHunk": "@@ -243,4 +257,67 @@ public PortNeighbors getPortNeighbors(Object arg) throws CacheException {\n \n         return portNeighbors;\n     }\n+\n+    private String getNeighborCacheName(String suffix) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27d5b642ae0b5e117494d88c91a1d80868fb31e7"}, "originalPosition": 83}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "27d5b642ae0b5e117494d88c91a1d80868fb31e7", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/27d5b642ae0b5e117494d88c91a1d80868fb31e7", "committedDate": "2020-08-05T01:56:36Z", "message": "Change the name of neighbor cache"}, "afterCommit": {"oid": "0f917a2dd602eff59409e10b878ce4feda196d07", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/0f917a2dd602eff59409e10b878ce4feda196d07", "committedDate": "2020-08-06T04:49:54Z", "message": "Fix issue of Missing Neighbor Info in Cross-Node Scenario"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f917a2dd602eff59409e10b878ce4feda196d07", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/0f917a2dd602eff59409e10b878ce4feda196d07", "committedDate": "2020-08-06T04:49:54Z", "message": "Fix issue of Missing Neighbor Info in Cross-Node Scenario"}, "afterCommit": {"oid": "90198918ea53a162ec96e08d3a4579d36deebb1d", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/90198918ea53a162ec96e08d3a4579d36deebb1d", "committedDate": "2020-08-06T06:22:04Z", "message": "Fix issue of Missing Neighbor Info in Cross-Node Scenario"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "10515f25379f6ecf78cd643633f87484dc0ba37a", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/10515f25379f6ecf78cd643633f87484dc0ba37a", "committedDate": "2020-08-08T02:13:04Z", "message": "Fix the problem of missing tunnel id"}, "afterCommit": {"oid": "5d034e94aeb9de09176a7c1fd5f213c1ee0c400a", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/5d034e94aeb9de09176a7c1fd5f213c1ee0c400a", "committedDate": "2020-08-08T02:22:12Z", "message": "Fix the problem of missing tunnel id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a577b17c13f0f7c60f78f719df25d48afe8e26d4", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/a577b17c13f0f7c60f78f719df25d48afe8e26d4", "committedDate": "2020-08-10T06:59:12Z", "message": "Refactoring port manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69330bf32d4a0350ff23db0e31d5a376eec8dc30", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/69330bf32d4a0350ff23db0e31d5a376eec8dc30", "committedDate": "2020-08-10T06:59:18Z", "message": "Refactor: Delete port"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10b7f1c4802d32eb8a7815ad7ff8967eaae58231", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/10b7f1c4802d32eb8a7815ad7ff8967eaae58231", "committedDate": "2020-08-10T06:59:20Z", "message": "Refactor: Update port"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56eaf2557e3813dd4def38df34956dd58509f6f9", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/56eaf2557e3813dd4def38df34956dd58509f6f9", "committedDate": "2020-08-10T06:59:22Z", "message": "Refactor: Add some logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ce05e80c373787de06dc6c7ec84020c9b52292b", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/2ce05e80c373787de06dc6c7ec84020c9b52292b", "committedDate": "2020-08-10T06:59:26Z", "message": "Fix compile error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4162ef84cce0d0541c63099ebe468397f776799", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/d4162ef84cce0d0541c63099ebe468397f776799", "committedDate": "2020-08-10T06:59:29Z", "message": "private-ip-manager performance optimization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1415c9c8e7d325dd4364f9c54892438fc6ad191", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/e1415c9c8e7d325dd4364f9c54892438fc6ad191", "committedDate": "2020-08-10T06:59:32Z", "message": "add thin ignite config item"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "466166eb51e7a5e0db3ab577a77f49e0202eead5", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/466166eb51e7a5e0db3ab577a77f49e0202eead5", "committedDate": "2020-08-10T06:59:37Z", "message": "Rest client supports batch interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "335bc2500d76d7b6f9cd596779131229afaf6d3e", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/335bc2500d76d7b6f9cd596779131229afaf6d3e", "committedDate": "2020-08-10T06:59:39Z", "message": "security group support query with parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12f129c79a4ca9b4062f032b4b156108d8bf49bb", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/12f129c79a4ca9b4062f032b4b156108d8bf49bb", "committedDate": "2020-08-10T06:59:40Z", "message": "Close some useless logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfcebaaa4843c9a9899d2ff9f02a36384bcb4c39", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/dfcebaaa4843c9a9899d2ff9f02a36384bcb4c39", "committedDate": "2020-08-10T06:59:44Z", "message": "Batch port binding security groups are supported"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e69dabecd6baff911c55b48c1cd8af9be3f05bc6", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/e69dabecd6baff911c55b48c1cd8af9be3f05bc6", "committedDate": "2020-08-10T06:59:47Z", "message": "Rebase from alcor master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5da04e304b1dbe28821d0096fbc04418a79bd910", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/5da04e304b1dbe28821d0096fbc04418a79bd910", "committedDate": "2020-08-10T06:59:49Z", "message": "Rebase from master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b08026f777a066f09101eabf0c5f3de467e92026", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/b08026f777a066f09101eabf0c5f3de467e92026", "committedDate": "2020-08-10T06:59:52Z", "message": "Allocate ip address by subnet id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62bc67659446b7762758edb41023beaa98e2d10b", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/62bc67659446b7762758edb41023beaa98e2d10b", "committedDate": "2020-08-10T06:59:54Z", "message": "Rebase from master and fix some UTs error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e3a92da48aa79d7670b9f04baca3c98b2245b6d", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/1e3a92da48aa79d7670b9f04baca3c98b2245b6d", "committedDate": "2020-08-10T06:59:56Z", "message": "Build the correct network configuration when updating port"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca4f7537bb39c8759e45208d8b814681f6876488", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/ca4f7537bb39c8759e45208d8b814681f6876488", "committedDate": "2020-08-10T06:59:58Z", "message": "Fix the problem of incorrect network configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8b70ba6791eca722d5f6a28978239aee42e02f1", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/e8b70ba6791eca722d5f6a28978239aee42e02f1", "committedDate": "2020-08-10T07:00:01Z", "message": "Query node info by name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bc758d38984a1faee7d879aabda34f7dff35580", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/9bc758d38984a1faee7d879aabda34f7dff35580", "committedDate": "2020-08-10T07:00:03Z", "message": "Change the name of neighbor cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85b410b736b1ffb4eaa9c694049f06f8411ecf21", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/85b410b736b1ffb4eaa9c694049f06f8411ecf21", "committedDate": "2020-08-10T07:00:04Z", "message": "Fix issue of Missing Neighbor Info in Cross-Node Scenario"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e23bb69cf9c2c80dec36ae0cbacb9835b997279", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/6e23bb69cf9c2c80dec36ae0cbacb9835b997279", "committedDate": "2020-08-10T07:00:05Z", "message": "Fix the problem of missing tunnel id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0827dc546153d7bac41bc2c44eab610715b6d700", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/0827dc546153d7bac41bc2c44eab610715b6d700", "committedDate": "2020-08-10T07:02:04Z", "message": "Fix the problem that take a long time to create an ip range"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d034e94aeb9de09176a7c1fd5f213c1ee0c400a", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/5d034e94aeb9de09176a7c1fd5f213c1ee0c400a", "committedDate": "2020-08-08T02:22:12Z", "message": "Fix the problem of missing tunnel id"}, "afterCommit": {"oid": "0827dc546153d7bac41bc2c44eab610715b6d700", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/0827dc546153d7bac41bc2c44eab610715b6d700", "committedDate": "2020-08-10T07:02:04Z", "message": "Fix the problem that take a long time to create an ip range"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NjQ4Mjk3", "url": "https://github.com/futurewei-cloud/alcor/pull/301#pullrequestreview-464648297", "createdAt": "2020-08-10T23:14:43Z", "commit": {"oid": "0827dc546153d7bac41bc2c44eab610715b6d700"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzoxNDo0M1rOG-i3Pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMzozMDoyNFrOG-jKYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIzNjA5NA==", "bodyText": "This createProcess only applies to port with binding host id. How about those without binding host id?", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r468236094", "createdAt": "2020-08-10T23:14:43Z", "author": {"login": "xieus"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/processor/PortProcessor.java", "diffHunk": "@@ -0,0 +1,239 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.portmanager.processor;\n+\n+import com.futurewei.alcor.web.entity.dataplane.InternalPortEntity;\n+import com.futurewei.alcor.web.entity.port.BindingProfile;\n+import com.futurewei.alcor.web.entity.port.PortEntity;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.UUID;\n+\n+public class PortProcessor extends AbstractProcessor {\n+    private void updateName(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        String newName = newPortEntity.getName();\n+        String oldName = oldPortEntity.getName();\n+\n+        if (newName != null && !newName.equals(oldName)) {\n+            oldPortEntity.setName(newName);\n+        }\n+    }\n+\n+    private void updateAdminState(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        boolean newAdminStateUp = newPortEntity.isAdminStateUp();\n+        boolean oldAdminStateUp = oldPortEntity.isAdminStateUp();\n+\n+        if (newAdminStateUp != oldAdminStateUp) {\n+            oldPortEntity.setAdminStateUp(newAdminStateUp);\n+        }\n+    }\n+\n+    private void updateBindingHostId(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        String newBindingHostId = newPortEntity.getBindingHostId();\n+        String oldBindingHostId = oldPortEntity.getBindingHostId();\n+\n+        if (newBindingHostId != null && !newBindingHostId.equals(oldBindingHostId)) {\n+            oldPortEntity.setBindingHostId(newBindingHostId);\n+        }\n+    }\n+\n+    private void updateBindingProfile(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        BindingProfile newBindingProfile = newPortEntity.getBindingProfile();\n+        BindingProfile oldBindingProfile = oldPortEntity.getBindingProfile();\n+\n+        if (newBindingProfile != null && !newBindingProfile.equals(oldBindingProfile)) {\n+            oldPortEntity.setBindingProfile(newBindingProfile);\n+        }\n+    }\n+\n+    private void updateBindingVnicType(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        String newBindingVnicType = newPortEntity.getBindingVnicType();\n+        String oldBindingVnicType = oldPortEntity.getBindingVnicType();\n+\n+        if (newBindingVnicType != null && !newBindingVnicType.equals(oldBindingVnicType)) {\n+            oldPortEntity.setBindingVnicType(newBindingVnicType);\n+        }\n+    }\n+\n+    private void updateDescription(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        String newDescription = newPortEntity.getDescription();\n+        String oldDescription = oldPortEntity.getDescription();\n+\n+        if (newDescription != null && !newDescription.equals(oldDescription)) {\n+            oldPortEntity.setDescription(newDescription);\n+        }\n+    }\n+\n+    private void updateDeviceId(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        String newDeviceId = newPortEntity.getDeviceId();\n+        String oldDeviceId = oldPortEntity.getDeviceId();\n+\n+        if (newDeviceId != null && !newDeviceId.equals(oldDeviceId)) {\n+            oldPortEntity.setDeviceId(newDeviceId);\n+        }\n+    }\n+\n+    private void updateDeviceOwner(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        String newDeviceOwner = newPortEntity.getDeviceOwner();\n+        String oldDeviceOwner = oldPortEntity.getDeviceOwner();\n+\n+        if (newDeviceOwner != null && !newDeviceOwner.equals(oldDeviceOwner)) {\n+            oldPortEntity.setDeviceOwner(newDeviceOwner);\n+        }\n+    }\n+\n+    private void updateDnsDomain(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        String newDnsDomain = newPortEntity.getDnsDomain();\n+        String oldDnsDomain = oldPortEntity.getDnsDomain();\n+\n+        if (newDnsDomain != null && !newDnsDomain.equals(oldDnsDomain)) {\n+            oldPortEntity.setDnsDomain(newDnsDomain);\n+        }\n+    }\n+\n+    private void updateDnsName(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        String newDnsName = newPortEntity.getDnsName();\n+        String oldDnsName = oldPortEntity.getDnsName();\n+\n+        if (newDnsName != null && !newDnsName.equals(oldDnsName)) {\n+            oldPortEntity.setDnsName(newDnsName);\n+        }\n+    }\n+\n+    private void updateExtraDhcpOpts(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        List<PortEntity.ExtraDhcpOpt> newExtraDhcpOpts = newPortEntity.getExtraDhcpOpts();\n+        List<PortEntity.ExtraDhcpOpt> oldExtraDhcpOpts = oldPortEntity.getExtraDhcpOpts();\n+\n+        if (newExtraDhcpOpts != null && !newExtraDhcpOpts.equals(oldExtraDhcpOpts)) {\n+            oldPortEntity.setExtraDhcpOpts(newExtraDhcpOpts);\n+        }\n+    }\n+\n+    private void updateAllowedAddressPairs(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        List<PortEntity.AllowAddressPair> newAllowedAddressPairs = newPortEntity.getAllowedAddressPairs();\n+        List<PortEntity.AllowAddressPair> oldAllowedAddressPairs = oldPortEntity.getAllowedAddressPairs();\n+\n+        if (newAllowedAddressPairs != null && !newAllowedAddressPairs.equals(oldAllowedAddressPairs)) {\n+            oldPortEntity.setAllowedAddressPairs(newAllowedAddressPairs);\n+        }\n+    }\n+\n+    private void updatePortSecurityEnabled(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        boolean newPortSecurityEnabled = newPortEntity.isPortSecurityEnabled();\n+        boolean oldPortSecurityEnabled = oldPortEntity.isPortSecurityEnabled();\n+\n+        if (newPortSecurityEnabled != oldPortSecurityEnabled) {\n+            oldPortEntity.setPortSecurityEnabled(newPortSecurityEnabled);\n+        }\n+    }\n+\n+    private void updateQosPolicyId(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        String newQosPolicyId = newPortEntity.getQosPolicyId();\n+        String oldQosPolicyId = oldPortEntity.getQosPolicyId();\n+\n+        if (newQosPolicyId != null && !newQosPolicyId.equals(oldQosPolicyId)) {\n+            oldPortEntity.setQosPolicyId(newQosPolicyId);\n+        }\n+    }\n+\n+\n+    private void updateMacLearningEnabled(PortEntity newPortEntity, PortEntity oldPortEntity) {\n+        boolean newMacLearningEnabled = newPortEntity.isMacLearningEnabled();\n+        boolean oldMacLearningEnabled = oldPortEntity.isMacLearningEnabled();\n+\n+        if (newMacLearningEnabled != oldMacLearningEnabled) {\n+            oldPortEntity.setMacLearningEnabled(newMacLearningEnabled);\n+        }\n+    }\n+\n+    private InternalPortEntity buildInternalPortEntity(PortEntity portEntity) {\n+        InternalPortEntity internalPortEntity =\n+                new InternalPortEntity(portEntity, null, null, null);\n+        NetworkConfig.ExtendPortEntity extendPortEntity =\n+                new NetworkConfig.ExtendPortEntity(internalPortEntity, portEntity.getBindingHostId());\n+\n+        return extendPortEntity;\n+    }\n+\n+    private void buildInternalPortEntities(PortContext context, List<PortEntity> portEntities) {\n+        List<InternalPortEntity> internalPortEntities = new ArrayList<>();\n+\n+        for (PortEntity portEntity: portEntities) {\n+            if (portEntity.getBindingHostId() != null) {\n+                internalPortEntities.add(buildInternalPortEntity(portEntity));\n+            }\n+        }\n+\n+        context.getNetworkConfig().setPortEntities(internalPortEntities);\n+    }\n+\n+    @Override\n+    void createProcess(PortContext context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0827dc546153d7bac41bc2c44eab610715b6d700"}, "originalPosition": 186}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIzODU1OQ==", "bodyText": "Can you give some comments to ProcessManager, AbstractProcess, PortProcess, and other types of processes etc.?", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r468238559", "createdAt": "2020-08-10T23:22:26Z", "author": {"login": "xieus"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/processor/ProcessorManager.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.portmanager.processor;\n+\n+import com.futurewei.alcor.portmanager.util.ReflectionUtil;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import javax.annotation.PostConstruct;\n+import java.util.*;\n+\n+@Component\n+public class ProcessorManager {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0827dc546153d7bac41bc2c44eab610715b6d700"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI0MDk5NA==", "bodyText": "Please make some comments to RequestManager, and some other important requests as well.", "url": "https://github.com/futurewei-cloud/alcor/pull/301#discussion_r468240994", "createdAt": "2020-08-10T23:30:24Z", "author": {"login": "xieus"}, "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/request/RequestManager.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.portmanager.request;\n+\n+import com.futurewei.alcor.common.executor.AsyncExecutor;\n+import com.futurewei.alcor.portmanager.processor.CallbackFunction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CompletionException;\n+\n+public class RequestManager {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0827dc546153d7bac41bc2c44eab610715b6d700"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2220, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}