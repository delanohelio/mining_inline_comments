{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMjI5NTQw", "number": 212, "title": "[Schema Update] Add Version Support and Delta/Full Message Type", "bodyText": "This schema update PR includes the following changes:\n\nReorder fields, and move up important fields\nAdd two version fields, format_version to mark the version of message format, and revision_number to mark the version of message content\nAdd a new field call MessageType which could represent full configuration or delta configuration\n\nNote that this is a breaking change for Alcor Control Agent.", "createdAt": "2020-05-23T06:17:17Z", "url": "https://github.com/futurewei-cloud/alcor/pull/212", "merged": true, "mergeCommit": {"oid": "993746bf72b00b1019a2e28bbf3a5acd32684f57"}, "closed": true, "closedAt": "2020-05-31T06:47:08Z", "author": {"login": "er1cthe0ne"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckAo25gH2gAyNDIyMjI5NTQwOjI3ZTg0ZDZmNmMwMDVkMGFiZTVkNjkxNzIxYWE5ODQzOTg3N2Y0MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmlGoUAFqTQyMTQ0OTY3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "27e84d6f6c005d0abe5d691721aa98439877f407", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/27e84d6f6c005d0abe5d691721aa98439877f407", "committedDate": "2020-05-23T06:11:59Z", "message": "added mq_subscription_index per team discussion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjU0ODM2", "url": "https://github.com/futurewei-cloud/alcor/pull/212#pullrequestreview-417254836", "createdAt": "2020-05-23T06:20:59Z", "commit": {"oid": "27e84d6f6c005d0abe5d691721aa98439877f407"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwNjoyMDo1OVrOGZnxNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwNjoyMDo1OVrOGZnxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxOTE1Ng==", "bodyText": "@xieus - I didn't add the \"message version/timestamp\" at this point to handle out of order message. With multiple DPMs running for scale, out of order message could happen. Should we go ahead and add \"uint32 message_version\" for our \"GoalState\" message?", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429519156", "createdAt": "2020-05-23T06:20:59Z", "author": {"login": "er1cthe0ne"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -28,13 +28,14 @@ message PortConfiguration {\n     ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27e84d6f6c005d0abe5d691721aa98439877f407"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjgyMDIy", "url": "https://github.com/futurewei-cloud/alcor/pull/212#pullrequestreview-417282022", "createdAt": "2020-05-23T14:14:31Z", "commit": {"oid": "27e84d6f6c005d0abe5d691721aa98439877f407"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNDoxNDozMVrOGZpojw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNDoxODoxNVrOGZppog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0OTcxMQ==", "bodyText": "This new field would work for Kafka. How about RocketMQ or Pulsar? @haboy52581 @er1cthe0ne", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429549711", "createdAt": "2020-05-23T14:14:31Z", "author": {"login": "xieus"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -28,13 +28,14 @@ message PortConfiguration {\n     \n     NetworkType network_type = 2;\n     string project_id = 3;\n-    string network_id = 4;\n-    string id = 5;\n-    string name = 6;\n-    string network_ns = 7;\n-    string mac_address = 8;\n-    string veth_name = 9;\n-    bool admin_state_up = 10;\n+    string subnet_id = 4;\n+    uint32 mq_subscription_index = 5;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27e84d6f6c005d0abe5d691721aa98439877f407"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0OTk4Ng==", "bodyText": "I would say that is the way to go. My recommendation is:\n\nuse the existing version, or rename it to \"content_version\" to track the content version of the message\nuse \"format_version\" or some better name to track the formatting version of the message (e.g. adding a new field)", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429549986", "createdAt": "2020-05-23T14:18:15Z", "author": {"login": "xieus"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -28,13 +28,14 @@ message PortConfiguration {\n     ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxOTE1Ng=="}, "originalCommit": {"oid": "27e84d6f6c005d0abe5d691721aa98439877f407"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "346d838e872e10ab2ae29b4d5e5d253df870d2e2", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/346d838e872e10ab2ae29b4d5e5d253df870d2e2", "committedDate": "2020-05-24T18:18:02Z", "message": "changed to NEIGHBOR_CREATE_UPDATE OperationType per discussion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NDU0ODE0", "url": "https://github.com/futurewei-cloud/alcor/pull/212#pullrequestreview-417454814", "createdAt": "2020-05-25T04:53:19Z", "commit": {"oid": "346d838e872e10ab2ae29b4d5e5d253df870d2e2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNDo1MzoxOVrOGZ0qoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwNDo1NDowMlrOGZ0rGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczMDQ2NA==", "bodyText": "Should we move id up a bit?", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429730464", "createdAt": "2020-05-25T04:53:19Z", "author": {"login": "xieus"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -28,13 +28,14 @@ message PortConfiguration {\n     \n     NetworkType network_type = 2;\n     string project_id = 3;\n-    string network_id = 4;\n-    string id = 5;\n-    string name = 6;\n-    string network_ns = 7;\n-    string mac_address = 8;\n-    string veth_name = 9;\n-    bool admin_state_up = 10;\n+    string subnet_id = 4;\n+    uint32 mq_subscription_index = 5;\n+    string id = 6;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "346d838e872e10ab2ae29b4d5e5d253df870d2e2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczMDU4NA==", "bodyText": "Do we need all of these fields for port given that we have better picture of OVS?", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r429730584", "createdAt": "2020-05-25T04:54:02Z", "author": {"login": "xieus"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -28,13 +28,14 @@ message PortConfiguration {\n     \n     NetworkType network_type = 2;\n     string project_id = 3;\n-    string network_id = 4;\n-    string id = 5;\n-    string name = 6;\n-    string network_ns = 7;\n-    string mac_address = 8;\n-    string veth_name = 9;\n-    bool admin_state_up = 10;\n+    string subnet_id = 4;\n+    uint32 mq_subscription_index = 5;\n+    string id = 6;\n+    string name = 7;\n+    string network_ns = 8;\n+    string mac_address = 9;\n+    string veth_name = 10;\n+    bool admin_state_up = 11;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "346d838e872e10ab2ae29b4d5e5d253df870d2e2"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "067bbdf41613a00c0e375b06c3edcdfc7fc840c5", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/067bbdf41613a00c0e375b06c3edcdfc7fc840c5", "committedDate": "2020-05-25T05:56:49Z", "message": "update per PR feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f15e0e034082a5c95a92b8cb555c7c18ff5645f", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/0f15e0e034082a5c95a92b8cb555c7c18ff5645f", "committedDate": "2020-05-27T20:10:56Z", "message": "update per team discussion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34cebb5d25847195cc52c7e44461291471bf996b", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/34cebb5d25847195cc52c7e44461291471bf996b", "committedDate": "2020-05-27T20:20:58Z", "message": "fix build issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741", "committedDate": "2020-05-30T00:43:28Z", "message": "update per team discussion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzY4NTI1", "url": "https://github.com/futurewei-cloud/alcor/pull/212#pullrequestreview-421368525", "createdAt": "2020-05-30T02:00:42Z", "commit": {"oid": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741"}, "state": "APPROVED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMjowMDo0MlrOGcwBrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQwMjowNToxNlrOGcwDAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDE3Mg==", "bodyText": "Suggest to use \"revision_number\", which is used by controller APIs.", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800172", "createdAt": "2020-05-30T02:00:42Z", "author": {"login": "xieus"}, "path": "schema/proto3/dhcp.proto", "diffHunk": "@@ -24,12 +24,13 @@ option java_outer_classname = \"DHCP\";\n import \"common.proto\";\n \n message DHCPConfiguration {\n-    uint32 version = 1;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDIyOA==", "bodyText": "\"revision_number\"", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800228", "createdAt": "2020-05-30T02:01:32Z", "author": {"login": "xieus"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -23,18 +23,24 @@ option java_outer_classname = \"Port\";\n \n import \"common.proto\";\n \n+enum MessageType { \n+    DELTA = 0; // the default type\n+    FULL = 1;\n+}\n+\n message PortConfiguration {\n-    uint32 version = 1;\n-    \n-    NetworkType network_type = 2;\n-    string project_id = 3;\n-    string network_id = 4;\n-    string id = 5;\n-    string name = 6;\n-    string network_ns = 7;\n-    string mac_address = 8;\n-    string veth_name = 9;\n-    bool admin_state_up = 10;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDMxMg==", "bodyText": "Is network_ns used for Mizar only? If so, we could move it to the end.", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800312", "createdAt": "2020-05-30T02:02:47Z", "author": {"login": "xieus"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -23,18 +23,24 @@ option java_outer_classname = \"Port\";\n \n import \"common.proto\";\n \n+enum MessageType { \n+    DELTA = 0; // the default type\n+    FULL = 1;\n+}\n+\n message PortConfiguration {\n-    uint32 version = 1;\n-    \n-    NetworkType network_type = 2;\n-    string project_id = 3;\n-    string network_id = 4;\n-    string id = 5;\n-    string name = 6;\n-    string network_ns = 7;\n-    string mac_address = 8;\n-    string veth_name = 9;\n-    bool admin_state_up = 10;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;\n+    MessageType message_type = 3;\n+\n+    string id = 4;\n+    NetworkType network_type = 5;\n+    string project_id = 6;\n+    string subnet_id = 7;\n+    string name = 8;\n+    string network_ns = 9;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDM0Nw==", "bodyText": "\"revision_number\"", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800347", "createdAt": "2020-05-30T02:03:09Z", "author": {"login": "xieus"}, "path": "schema/proto3/securitygroup.proto", "diffHunk": "@@ -24,12 +24,13 @@ option java_outer_classname = \"SecurityGroup\";\n import \"common.proto\";\n \n message SecurityGroupConfiguration {\n-    uint32 version = 1;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDQ3OQ==", "bodyText": "\"revision_number\"", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800479", "createdAt": "2020-05-30T02:04:58Z", "author": {"login": "xieus"}, "path": "schema/proto3/subnet.proto", "diffHunk": "@@ -24,14 +24,15 @@ option java_outer_classname = \"Subnet\";\n import \"common.proto\";\n \n message SubnetConfiguration {\n-    uint32 version = 1;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDUxMg==", "bodyText": "\"revision_number\"", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432800512", "createdAt": "2020-05-30T02:05:16Z", "author": {"login": "xieus"}, "path": "schema/proto3/vpc.proto", "diffHunk": "@@ -24,13 +24,14 @@ option java_outer_classname = \"Vpc\";\n import \"common.proto\";\n \n message VpcConfiguration {\n-    uint32 version = 1;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9331a6d19ad44dafbf8e5ac26eaa81a01089d871", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/9331a6d19ad44dafbf8e5ac26eaa81a01089d871", "committedDate": "2020-05-30T17:31:28Z", "message": "update to revision_number"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b719e25117a5a8b3dcb2afa1fc054cea5ea7d3f7", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/b719e25117a5a8b3dcb2afa1fc054cea5ea7d3f7", "committedDate": "2020-05-31T03:36:24Z", "message": "update FixedIp in PortConfiguration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd0f739b6628a071be82f06efe5b60f07470d433", "author": {"user": {"login": "er1cthe0ne", "name": "Eric Li"}}, "url": "https://github.com/futurewei-cloud/alcor/commit/bd0f739b6628a071be82f06efe5b60f07470d433", "committedDate": "2020-05-31T05:19:40Z", "message": "move mac_address back to top level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDQ5Njcx", "url": "https://github.com/futurewei-cloud/alcor/pull/212#pullrequestreview-421449671", "createdAt": "2020-05-30T23:11:02Z", "commit": {"oid": "9331a6d19ad44dafbf8e5ac26eaa81a01089d871"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMzoxMTowM1rOGc1yXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMzoxMTowM1rOGc1yXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg5NDU1Nw==", "bodyText": "Got it.Thanks.", "url": "https://github.com/futurewei-cloud/alcor/pull/212#discussion_r432894557", "createdAt": "2020-05-30T23:11:03Z", "author": {"login": "xieus"}, "path": "schema/proto3/port.proto", "diffHunk": "@@ -23,18 +23,24 @@ option java_outer_classname = \"Port\";\n \n import \"common.proto\";\n \n+enum MessageType { \n+    DELTA = 0; // the default type\n+    FULL = 1;\n+}\n+\n message PortConfiguration {\n-    uint32 version = 1;\n-    \n-    NetworkType network_type = 2;\n-    string project_id = 3;\n-    string network_id = 4;\n-    string id = 5;\n-    string name = 6;\n-    string network_ns = 7;\n-    string mac_address = 8;\n-    string veth_name = 9;\n-    bool admin_state_up = 10;\n+    uint32 format_version = 1;\n+    uint32 content_version = 2;\n+    MessageType message_type = 3;\n+\n+    string id = 4;\n+    NetworkType network_type = 5;\n+    string project_id = 6;\n+    string subnet_id = 7;\n+    string name = 8;\n+    string network_ns = 9;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgwMDMxMg=="}, "originalCommit": {"oid": "0ee5ce1d18322b700cdc6b4a51cadb6bc2c30741"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2100, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}