{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1MTA0ODkz", "number": 251, "title": "[Microservice] Network ACL Manager", "bodyText": "This PR contains the following features:\n\nNetwork ACL create/update/delete/query interfaces\nNetwork ACL rule create/delete/query interfaces\nNetwork ACL batch interfaces\nNetwork ACL rule batch interfaces\nInteract with vpc manager to verify that if vpc id is validate\nInteract with subnet manager to verify that if subnet id is validate", "createdAt": "2020-06-16T09:57:00Z", "url": "https://github.com/futurewei-cloud/alcor/pull/251", "merged": true, "mergeCommit": {"oid": "0ab5df6274de7cadfface8c9d760baf854067d96"}, "closed": true, "closedAt": "2020-09-25T15:58:46Z", "author": {"login": "chenpiaoping"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrzQjiAFqTQzMTM5NTk1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMPjqFgFqTQ5NjEyNjM0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMzk1OTU0", "url": "https://github.com/futurewei-cloud/alcor/pull/251#pullrequestreview-431395954", "createdAt": "2020-06-16T11:08:04Z", "commit": {"oid": "d1be9b8555ff3fe843c232e41d89a3ff6acfe03b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMTowODowNFrOGkWbtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMTowODowNFrOGkWbtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc2OTQ2Mg==", "bodyText": "@chenpiaoping Thanks for making this change.\nCan you refer to other pom files, for example, https://github.com/futurewei-cloud/alcor/blob/master/services/security_group_manager/pom.xml as it got updated recently?\nMainly to add Swagger doc/UT dependencies and plugins, code coverage plugins etc.", "url": "https://github.com/futurewei-cloud/alcor/pull/251#discussion_r440769462", "createdAt": "2020-06-16T11:08:04Z", "author": {"login": "xieus"}, "path": "services/network_acl_manager/pom.xml", "diffHunk": "@@ -0,0 +1,63 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>org.springframework.boot</groupId>\n+        <artifactId>spring-boot-starter-parent</artifactId>\n+        <version>2.3.1.RELEASE</version>\n+        <relativePath/> <!-- lookup parent from repository -->\n+    </parent>\n+    <groupId>com.futurewei.alcor</groupId>\n+    <artifactId>network-acl-manager</artifactId>\n+    <version>0.0.1-SNAPSHOT</version>\n+    <name>AlcorNetworkAclManager</name>\n+    <description>Alcor Network ACL Manager Module</description>\n+\n+    <properties>\n+        <java.version>1.8</java.version>\n+    </properties>\n+\n+    <dependencies>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-web</artifactId>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-test</artifactId>\n+            <scope>test</scope>\n+            <exclusions>\n+                <exclusion>\n+                    <groupId>org.junit.vintage</groupId>\n+                    <artifactId>junit-vintage-engine</artifactId>\n+                </exclusion>\n+            </exclusions>\n+        </dependency>\n+\n+        <!--Internal dependencies-->\n+        <dependency>\n+            <groupId>com.futurewei.alcor</groupId>\n+            <artifactId>common</artifactId>\n+            <version>0.1.0-SNAPSHOT</version>\n+            <scope>compile</scope>\n+        </dependency>\n+        <dependency>\n+            <groupId>com.futurewei.alcor</groupId>\n+            <artifactId>web</artifactId>\n+            <version>0.1.0-SNAPSHOT</version>\n+            <scope>compile</scope>\n+        </dependency>\n+    </dependencies>\n+\n+    <build>\n+        <plugins>\n+            <plugin>\n+                <groupId>org.springframework.boot</groupId>\n+                <artifactId>spring-boot-maven-plugin</artifactId>\n+            </plugin>\n+        </plugins>\n+    </build>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1be9b8555ff3fe843c232e41d89a3ff6acfe03b"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMzk4NTEx", "url": "https://github.com/futurewei-cloud/alcor/pull/251#pullrequestreview-431398511", "createdAt": "2020-06-16T11:12:02Z", "commit": {"oid": "d1be9b8555ff3fe843c232e41d89a3ff6acfe03b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMToxMjowMlrOGkWjJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMToxMjowMlrOGkWjJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc3MTM2NA==", "bodyText": "Could you please add swagger/SwaggerJsonTest.java to the NACL UT?\nOne example is https://github.com/futurewei-cloud/alcor/blob/master/services/security_group_manager/src/test/java/com/futurewei/alcor/securitygroup/swagger/SwaggerJsonTest.java.", "url": "https://github.com/futurewei-cloud/alcor/pull/251#discussion_r440771364", "createdAt": "2020-06-16T11:12:02Z", "author": {"login": "xieus"}, "path": "services/network_acl_manager/src/test/java/com/futurewei/alcor/networkaclmanager/config/UnitTestConfig.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.networkaclmanager.config;\n+\n+public class UnitTestConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1be9b8555ff3fe843c232e41d89a3ff6acfe03b"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNDAwNzQw", "url": "https://github.com/futurewei-cloud/alcor/pull/251#pullrequestreview-431400740", "createdAt": "2020-06-16T11:15:29Z", "commit": {"oid": "d1be9b8555ff3fe843c232e41d89a3ff6acfe03b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMToxNToyOVrOGkWpuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMToxNjo1OFrOGkWshA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc3MzA1MQ==", "bodyText": "server.port=9008\nThis is the default port for NACL manager. The default port for other services could be referred to https://github.com/futurewei-cloud/alcor/blob/master/services/port_manager/src/main/resources/application.properties (updated recently)\nThis will help to avoid port conflict for e2e integration.", "url": "https://github.com/futurewei-cloud/alcor/pull/251#discussion_r440773051", "createdAt": "2020-06-16T11:15:29Z", "author": {"login": "xieus"}, "path": "services/network_acl_manager/src/main/resources/application.properties", "diffHunk": "@@ -0,0 +1,4 @@\n+#server.port=9000", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1be9b8555ff3fe843c232e41d89a3ff6acfe03b"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc3Mzc2NA==", "bodyText": "As usual, could you please create a doc for this new microservice? Thank you.", "url": "https://github.com/futurewei-cloud/alcor/pull/251#discussion_r440773764", "createdAt": "2020-06-16T11:16:58Z", "author": {"login": "xieus"}, "path": "services/network_acl_manager/src/main/java/com/futurewei/alcor/networkaclmanager/controller/NetworkAclController.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.networkaclmanager.controller;\n+\n+import com.futurewei.alcor.networkaclmanager.service.NetworkAclService;\n+import com.futurewei.alcor.web.entity.networkacl.NetworkAclEntity;\n+import com.futurewei.alcor.web.entity.networkacl.NetworkAclWebJson;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.util.List;\n+\n+import static com.futurewei.alcor.networkaclmanager.util.RestParameterValidator.checkNetworkAcl;\n+\n+@RestController\n+public class NetworkAclController {\n+    @Autowired\n+    private NetworkAclService networkAclService;\n+\n+    @PostMapping(\"/project/{project_id}/network-acls\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1be9b8555ff3fe843c232e41d89a3ff6acfe03b"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5fd1181430bf92d713b0bb3ef794344743f225b6", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/5fd1181430bf92d713b0bb3ef794344743f225b6", "committedDate": "2020-06-18T09:30:02Z", "message": "add batch interfaces for network acl manager"}, "afterCommit": {"oid": "806deaf830fc0b58566114584f6757a21000f9f0", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/806deaf830fc0b58566114584f6757a21000f9f0", "committedDate": "2020-06-18T09:48:14Z", "message": "add batch interfaces for network acl manager"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "806deaf830fc0b58566114584f6757a21000f9f0", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/806deaf830fc0b58566114584f6757a21000f9f0", "committedDate": "2020-06-18T09:48:14Z", "message": "add batch interfaces for network acl manager"}, "afterCommit": {"oid": "21998e3522a68e6a14209b492e7eeeb458a638ce", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/21998e3522a68e6a14209b492e7eeeb458a638ce", "committedDate": "2020-06-28T08:30:36Z", "message": "add design doc for network acl manager"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21998e3522a68e6a14209b492e7eeeb458a638ce", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/21998e3522a68e6a14209b492e7eeeb458a638ce", "committedDate": "2020-06-28T08:30:36Z", "message": "add design doc for network acl manager"}, "afterCommit": {"oid": "c8b1725368bd4fdb5d8a9eac816128f00d97512a", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/c8b1725368bd4fdb5d8a9eac816128f00d97512a", "committedDate": "2020-06-28T08:44:03Z", "message": "add design doc for network acl manager"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d901d4e21f314e5c45e4db6f9dccbbdf72b7f85", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/8d901d4e21f314e5c45e4db6f9dccbbdf72b7f85", "committedDate": "2020-06-29T07:51:53Z", "message": "add synchronized to all the interfaces that need to start transaction"}, "afterCommit": {"oid": "dbde5dcaf94c1fdfa97c44609b28b1d237c6eee5", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/dbde5dcaf94c1fdfa97c44609b28b1d237c6eee5", "committedDate": "2020-07-02T07:52:46Z", "message": "Undo changes to AsyncExecutor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjk0NTQ0", "url": "https://github.com/futurewei-cloud/alcor/pull/251#pullrequestreview-442694544", "createdAt": "2020-07-05T17:39:11Z", "commit": {"oid": "dbde5dcaf94c1fdfa97c44609b28b1d237c6eee5"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNzozOToxMVrOGtDytA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNzozOTo0NFrOGtDy9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMTIzNg==", "bodyText": "Inline\uff1a Use space instead of tab.", "url": "https://github.com/futurewei-cloud/alcor/pull/251#discussion_r449901236", "createdAt": "2020-07-05T17:39:11Z", "author": {"login": "xieus"}, "path": "pom.xml", "diffHunk": "@@ -38,6 +38,7 @@\n         <module>services/port_manager</module>\n         <module>services/node_manager</module>\n         <module>services/security_group_manager</module>\n+\t\t<module>services/network_acl_manager</module>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbde5dcaf94c1fdfa97c44609b28b1d237c6eee5"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwMTMwMQ==", "bodyText": "We've upgraded to Java 11. Please change it accordingly.", "url": "https://github.com/futurewei-cloud/alcor/pull/251#discussion_r449901301", "createdAt": "2020-07-05T17:39:44Z", "author": {"login": "xieus"}, "path": "services/network_acl_manager/pom.xml", "diffHunk": "@@ -0,0 +1,125 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <parent>\n+        <groupId>org.springframework.boot</groupId>\n+        <artifactId>spring-boot-starter-parent</artifactId>\n+        <version>2.3.1.RELEASE</version>\n+        <relativePath/> <!-- lookup parent from repository -->\n+    </parent>\n+    <groupId>com.futurewei.alcor</groupId>\n+    <artifactId>network-acl-manager</artifactId>\n+    <version>0.0.1-SNAPSHOT</version>\n+    <name>AlcorNetworkAclManager</name>\n+    <description>Alcor Network ACL Manager Module</description>\n+\n+    <properties>\n+        <java.version>1.8</java.version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbde5dcaf94c1fdfa97c44609b28b1d237c6eee5"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c109161fc02e270cce3354f11230ab469edae4d2", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/c109161fc02e270cce3354f11230ab469edae4d2", "committedDate": "2020-09-23T01:56:33Z", "message": "network acl manager service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9acd37079c11192266fc6976b2453c076b81e53", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/a9acd37079c11192266fc6976b2453c076b81e53", "committedDate": "2020-09-23T02:12:15Z", "message": "add some test cases for network acl rule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9c95bf1a0280ea0f12ff1e274fa673dc8445c36", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/e9c95bf1a0280ea0f12ff1e274fa673dc8445c36", "committedDate": "2020-09-23T02:12:18Z", "message": "add batch interfaces for network acl manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05f535514b8b0e9addc673cad9597c45a04a4ef1", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/05f535514b8b0e9addc673cad9597c45a04a4ef1", "committedDate": "2020-09-23T02:12:19Z", "message": "add design doc for network acl manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8baf5c14c28977edb8a62524573c140c18369a81", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/8baf5c14c28977edb8a62524573c140c18369a81", "committedDate": "2020-09-23T02:12:19Z", "message": "add synchronized to all the interfaces that need to start transaction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1675e6c9acd8d1781b32e2a364a4aff599254d37", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/1675e6c9acd8d1781b32e2a364a4aff599254d37", "committedDate": "2020-09-23T02:12:21Z", "message": "Undo changes to AsyncExecutor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dbde5dcaf94c1fdfa97c44609b28b1d237c6eee5", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/dbde5dcaf94c1fdfa97c44609b28b1d237c6eee5", "committedDate": "2020-07-02T07:52:46Z", "message": "Undo changes to AsyncExecutor"}, "afterCommit": {"oid": "19fd1c71399e6080f624f3448f38423050c21b5e", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/19fd1c71399e6080f624f3448f38423050c21b5e", "committedDate": "2020-09-23T02:34:23Z", "message": "Rebase from master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42d04d5cbc2770c810d11967efb069e6c1c14833", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/42d04d5cbc2770c810d11967efb069e6c1c14833", "committedDate": "2020-09-23T02:48:24Z", "message": "Rebase from master"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19fd1c71399e6080f624f3448f38423050c21b5e", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/19fd1c71399e6080f624f3448f38423050c21b5e", "committedDate": "2020-09-23T02:34:23Z", "message": "Rebase from master"}, "afterCommit": {"oid": "42d04d5cbc2770c810d11967efb069e6c1c14833", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/42d04d5cbc2770c810d11967efb069e6c1c14833", "committedDate": "2020-09-23T02:48:24Z", "message": "Rebase from master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb93a99f87d870aaf4cdf5b30051bb89633a57c8", "author": {"user": {"login": "chenpiaoping", "name": null}}, "url": "https://github.com/futurewei-cloud/alcor/commit/fb93a99f87d870aaf4cdf5b30051bb89633a57c8", "committedDate": "2020-09-23T03:34:43Z", "message": "Update java version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MDg2MjA5", "url": "https://github.com/futurewei-cloud/alcor/pull/251#pullrequestreview-496086209", "createdAt": "2020-09-25T03:25:01Z", "commit": {"oid": "fb93a99f87d870aaf4cdf5b30051bb89633a57c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwMzoyNTowMlrOHXzrGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwMzoyNTowMlrOHXzrGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDcyNTkxNA==", "bodyText": "One important comment :-)\nCan you add @DurationStatistics to NACL mgr?", "url": "https://github.com/futurewei-cloud/alcor/pull/251#discussion_r494725914", "createdAt": "2020-09-25T03:25:02Z", "author": {"login": "xieus"}, "path": "services/network_acl_manager/src/main/java/com/futurewei/alcor/networkaclmanager/controller/NetworkAclController.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.networkaclmanager.controller;\n+\n+import com.futurewei.alcor.networkaclmanager.service.NetworkAclService;\n+import com.futurewei.alcor.web.entity.networkacl.NetworkAclBulkWebJson;\n+import com.futurewei.alcor.web.entity.networkacl.NetworkAclEntity;\n+import com.futurewei.alcor.web.entity.networkacl.NetworkAclWebJson;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.web.bind.annotation.*;\n+\n+import java.util.List;\n+\n+import static com.futurewei.alcor.networkaclmanager.util.RestParameterValidator.checkNetworkAcl;\n+import static com.futurewei.alcor.networkaclmanager.util.RestParameterValidator.checkProjectId;\n+\n+@RestController\n+public class NetworkAclController {\n+    @Autowired\n+    private NetworkAclService networkAclService;\n+\n+    @PostMapping(\"/project/{project_id}/network-acls\")\n+    @ResponseBody\n+    @ResponseStatus(HttpStatus.CREATED)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb93a99f87d870aaf4cdf5b30051bb89633a57c8"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MTI2MzQ1", "url": "https://github.com/futurewei-cloud/alcor/pull/251#pullrequestreview-496126345", "createdAt": "2020-09-25T05:50:03Z", "commit": {"oid": "fb93a99f87d870aaf4cdf5b30051bb89633a57c8"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNTo1MDowNFrOHX11Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNjowMTozNlrOHX2Cig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc2MTI0Mg==", "bodyText": "Checking to see what the impact is.", "url": "https://github.com/futurewei-cloud/alcor/pull/251#discussion_r494761242", "createdAt": "2020-09-25T05:50:04Z", "author": {"login": "xieus"}, "path": "services/network_acl_manager/src/main/java/com/futurewei/alcor/networkaclmanager/repo/NetworkAclRepository.java", "diffHunk": "@@ -0,0 +1,208 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.networkaclmanager.repo;\n+\n+import com.futurewei.alcor.common.db.CacheException;\n+import com.futurewei.alcor.common.db.CacheFactory;\n+import com.futurewei.alcor.common.db.ICache;\n+import com.futurewei.alcor.common.db.Transaction;\n+import com.futurewei.alcor.web.entity.networkacl.*;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.annotation.PostConstruct;\n+import java.util.*;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n+@Repository\n+@ComponentScan(value=\"com.futurewei.alcor.common.db\")\n+public class NetworkAclRepository {\n+    private static final Logger LOG = LoggerFactory.getLogger(NetworkAclRepository.class);\n+\n+    private ICache<String, NetworkAclEntity> networkAclCache;\n+    private ICache<String, NetworkAclRuleEntity> networkAclRuleCache;\n+\n+    public NetworkAclRepository() {\n+\n+    }\n+\n+    public NetworkAclRepository(ICache<String, NetworkAclEntity> networkAclCache, ICache<String, NetworkAclRuleEntity> networkAclRuleCache) {\n+        this.networkAclCache = networkAclCache;\n+        this.networkAclRuleCache = networkAclRuleCache;\n+    }\n+\n+    @Autowired\n+    public NetworkAclRepository(CacheFactory cacheFactory) {\n+        networkAclCache = cacheFactory.getCache(NetworkAclEntity.class);\n+        networkAclRuleCache = cacheFactory.getCache(NetworkAclRuleEntity.class);\n+    }\n+\n+    @PostConstruct\n+    private void init() throws Exception {\n+        LOG.info(\"NetworkAclRepository init done\");\n+    }\n+\n+    private NetworkAclRuleEntity buildDefaultNetworkAclRule(String ipPrefix, String direction) {\n+        NetworkAclRuleEntity networkAclRuleEntity = new NetworkAclRuleEntity();\n+        networkAclRuleEntity.setId(UUID.randomUUID().toString());\n+        networkAclRuleEntity.setNumber(NetworkAclRuleEntity.NUMBER_MAX_VALUE);\n+        networkAclRuleEntity.setIpPrefix(ipPrefix);\n+        networkAclRuleEntity.setProtocol(Protocol.ALL.getProtocol());\n+        networkAclRuleEntity.setDirection(direction);\n+        networkAclRuleEntity.setAction(Action.DENY.getAction());\n+\n+        return networkAclRuleEntity;\n+    }\n+\n+    private synchronized void createDefaultNetworkAclRules() throws Exception {\n+        try (Transaction tx = networkAclCache.getTransaction().start()) {\n+            List<NetworkAclRuleEntity> networkAclRules = getNetworkAclRulesByNumber(NetworkAclRuleEntity.NUMBER_MAX_VALUE);\n+\n+            if (networkAclRules == null) {\n+                List<String> ipPrefixes = Arrays.asList(NetworkAclRuleEntity.DEFAULT_IPV4_PREFIX,\n+                        NetworkAclRuleEntity.DEFAULT_IPV6_PREFIX);\n+                Map<String, NetworkAclRuleEntity> networkAclRuleEntityMap = new HashMap<>();\n+\n+                for (String ipPrefix: ipPrefixes) {\n+                    List<Direction> directions = Arrays.asList(Direction.INGRESS,\n+                            Direction.EGRESS);\n+\n+                    for (Direction direction : directions) {\n+                        NetworkAclRuleEntity networkAclRuleEntity =\n+                                buildDefaultNetworkAclRule(ipPrefix, direction.getDirection());\n+                        networkAclRuleEntityMap.put(networkAclRuleEntity.getId(), networkAclRuleEntity);\n+                    }\n+                }\n+\n+                networkAclRuleCache.putAll(networkAclRuleEntityMap);\n+            }\n+\n+            tx.commit();\n+        }\n+    }\n+\n+    public List<NetworkAclRuleEntity> getDefaultNetworkAclRules() throws Exception {\n+        List<NetworkAclRuleEntity> networkAclRules = getNetworkAclRulesByNumber(NetworkAclRuleEntity.NUMBER_MAX_VALUE);\n+        if (networkAclRules.isEmpty()) {\n+            try {\n+                createDefaultNetworkAclRules();\n+            } catch (Exception e) {\n+                LOG.warn(\"Create default Network ACL rules failed\");\n+            }\n+\n+            networkAclRules = getNetworkAclRulesByNumber(NetworkAclRuleEntity.NUMBER_MAX_VALUE);\n+        }\n+\n+        return networkAclRules;\n+    }\n+\n+    public void addNetworkAcl(NetworkAclEntity networkAclEntity) throws CacheException {\n+        LOG.debug(\"Add Network ACL:{}\", networkAclEntity);\n+\n+        networkAclCache.put(networkAclEntity.getId(), networkAclEntity);\n+    }\n+\n+    public void addNetworkAclBulk(List<NetworkAclEntity> networkAclEntities) throws CacheException {\n+        LOG.debug(\"Add Network ACL Bulk:{}\", networkAclEntities);\n+\n+        Map<String, NetworkAclEntity> networkAclEntityMap = networkAclEntities.stream()\n+                .collect(Collectors.toMap(NetworkAclEntity::getId, Function.identity()));\n+        networkAclCache.putAll(networkAclEntityMap);\n+    }\n+\n+    public void deleteNetworkAcl(String networkAclId) throws CacheException {\n+        LOG.debug(\"Delete Network ACL, Network ACL Id:{}\", networkAclId);\n+        networkAclCache.remove(networkAclId);\n+    }\n+\n+    public NetworkAclEntity getNetworkAcl(String networkAclId) throws Exception {\n+        NetworkAclEntity networkAclEntity = networkAclCache.get(networkAclId);\n+        if (networkAclEntity == null) {\n+            return null;\n+        }\n+\n+        List<NetworkAclRuleEntity> networkAclRules =\n+                getNetworkAclRulesByNetworkAclId(networkAclEntity.getId());\n+        if (networkAclRules == null) {\n+            networkAclRules = getDefaultNetworkAclRules();\n+        }\n+\n+        networkAclEntity.setNetworkAclRuleEntities(networkAclRules);\n+\n+        return networkAclEntity;\n+    }\n+\n+    public Map<String, NetworkAclEntity> getAllNetworkAcls() throws Exception {\n+        Map<String, NetworkAclEntity> networkAclEntityMap = networkAclCache.getAll();\n+        if (networkAclEntityMap == null) {\n+            return null;\n+        }\n+\n+        for (Map.Entry<String, NetworkAclEntity> entry: networkAclEntityMap.entrySet()) {\n+            List<NetworkAclRuleEntity> networkAclRules = getNetworkAclRulesByNetworkAclId(entry.getKey());\n+            if (networkAclRules == null) {\n+                networkAclRules = getDefaultNetworkAclRules();\n+            }\n+\n+            entry.getValue().setNetworkAclRuleEntities(networkAclRules);\n+        }\n+\n+        return networkAclEntityMap;\n+    }\n+\n+    public void addNetworkAclRule(NetworkAclRuleEntity networkAclRuleEntity) throws Exception {\n+        LOG.debug(\"Add Network ACL Rule:{}\", networkAclRuleEntity);\n+\n+        networkAclRuleCache.put(networkAclRuleEntity.getId(), networkAclRuleEntity);\n+    }\n+\n+    public void addNetworkAclRuleBulk(List<NetworkAclRuleEntity> networkAclRuleEntities) throws Exception {\n+        LOG.debug(\"Add Network ACL Rule Bulk:{}\", networkAclRuleEntities);\n+\n+        Map<String, NetworkAclRuleEntity> networkAclRuleEntityMap = networkAclRuleEntities.stream()\n+                .collect(Collectors.toMap(NetworkAclRuleEntity::getId, Function.identity()));\n+        networkAclRuleCache.putAll(networkAclRuleEntityMap);\n+    }\n+\n+    public void deleteNetworkAclRule(String networkAclRuleId) throws CacheException {\n+        LOG.debug(\"Delete Network ACL Rule, Network ACL Rule Id:{}\", networkAclRuleId);\n+        networkAclRuleCache.remove(networkAclRuleId);\n+    }\n+\n+    public NetworkAclRuleEntity getNetworkAclRule(String networkAclRuleId) throws CacheException {\n+        return networkAclRuleCache.get(networkAclRuleId);\n+    }\n+\n+    public Map<String, NetworkAclRuleEntity> getAllNetworkAclRules() throws CacheException {\n+        return networkAclRuleCache.getAll();\n+    }\n+\n+    public List<NetworkAclRuleEntity> getNetworkAclRulesByNumber(Integer number) throws CacheException {\n+        List<NetworkAclRuleEntity> networkAclRuleEntities = new ArrayList<>();\n+        //FIXME: not support yet", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb93a99f87d870aaf4cdf5b30051bb89633a57c8"}, "originalPosition": 199}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc2NDIwOQ==", "bodyText": "9008 is used by SGM. Could you change it to 9013?", "url": "https://github.com/futurewei-cloud/alcor/pull/251#discussion_r494764209", "createdAt": "2020-09-25T05:59:58Z", "author": {"login": "xieus"}, "path": "services/network_acl_manager/src/main/resources/application.properties", "diffHunk": "@@ -0,0 +1,7 @@\n+#server.port=9000\n+#Ignite configuration\n+ignite.host=localhost\n+ignite.port=10801\n+server.port=9008", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb93a99f87d870aaf4cdf5b30051bb89633a57c8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc2NDY4Mg==", "bodyText": "Cool \ud83d\udc4d Like it.", "url": "https://github.com/futurewei-cloud/alcor/pull/251#discussion_r494764682", "createdAt": "2020-09-25T06:01:36Z", "author": {"login": "xieus"}, "path": "services/network_acl_manager/src/test/java/com/futurewei/alcor/networkaclmanager/controller/CreateNetworkAclRuleTest.java", "diffHunk": "@@ -0,0 +1,381 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.networkaclmanager.controller;\n+\n+import com.futurewei.alcor.networkaclmanager.config.UnitTestConfig;\n+import com.futurewei.alcor.networkaclmanager.repo.NetworkAclRepository;\n+import com.futurewei.alcor.networkaclmanager.util.NetworkAclBuilder;\n+import com.futurewei.alcor.web.entity.networkacl.NetworkAclRuleEntity;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.context.annotation.ComponentScan;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.MediaType;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.result.MockMvcResultMatchers;\n+\n+import static com.futurewei.alcor.networkaclmanager.util.NetworkAclRuleBuilder.*;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@SpringBootTest\n+@AutoConfigureMockMvc\n+@ComponentScan(value = \"com.futurewei.alcor.common.test.config\")\n+public class CreateNetworkAclRuleTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb93a99f87d870aaf4cdf5b30051bb89633a57c8"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2156, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}