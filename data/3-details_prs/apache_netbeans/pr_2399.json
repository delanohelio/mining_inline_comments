{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNzg1NjMx", "number": 2399, "title": "[NETBEANS-4832] Avoid assertion & NPE in fxml code completion", "bodyText": "@sdedic could you take a look at this fix.\nThe assertion was due to CompilerInfo not having a list of modules. Fixed in FXMLCompletion2.Q.Taks.run with the getPackageElement:\n    ci = CompilationInfo.get(result);\n    // following populates module info, partial fix for [NETBEANS-4832]\n    ci.getElements().getPackageElement(\"java.lang\");\n\nThis fixed code completion inside an UI element, for example<Label.../>\"\nHowever there was an NPE inside a list, for example in<children>...</children>. This was fixed by what looks like a bug/oversight in ElementUtils.getTypeElementByBinaryName.\nIn FxIncludeCompleter.createCompleter\n    TypeMirror tm = prop.getType().resolve(ctx.getCompilationInfo());\n\nreturned null which causes NPE in jdk.  fixed by the identity check in\n    ElementUtils.getTypeElementByBinaryName", "createdAt": "2020-09-25T01:48:09Z", "url": "https://github.com/apache/netbeans/pull/2399", "merged": true, "mergeCommit": {"oid": "794e55ab43740e8d8186941635cb728e143d239a"}, "closed": true, "closedAt": "2020-10-08T04:25:47Z", "author": {"login": "errael"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMLblsgH2gAyNDkyNzg1NjMxOjY2ZDlmMWNmODNlYmExNmVkYjY4ZTBhOGJiODMyZTQ5MjAwZmQxMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQO5dFgFqTUwNDAxNzUzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "66d9f1cf83eba16edb68e0a8bb832e49200fd126", "author": {"user": {"login": "errael", "name": "errael"}}, "url": "https://github.com/apache/netbeans/commit/66d9f1cf83eba16edb68e0a8bb832e49200fd126", "committedDate": "2020-09-25T01:23:25Z", "message": "[NETBEANS-4832] Avoid assertion & NPE in fxml code completion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDc2MjE0", "url": "https://github.com/apache/netbeans/pull/2399#pullrequestreview-497076214", "createdAt": "2020-09-27T11:56:12Z", "commit": {"oid": "8cd0308d63c79157c92b6b738f4e3ee5c311363b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxMTo1NjoxMlrOHYm54A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxMTo1NjoxMlrOHYm54A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU2NTI4MA==", "bodyText": "Not related to this bug, but a few lines below: (elem.getKind() == ElementKind.CLASS || elem.getKind() == ElementKind.INTERFACE) IMHO does not work for ANNOTATION_TYPE and ENUM. Could be worth to fix as\nelem.getKind().isClass() || elem.getKind().isInterface ?", "url": "https://github.com/apache/netbeans/pull/2399#discussion_r495565280", "createdAt": "2020-09-27T11:56:12Z", "author": {"login": "sdedic"}, "path": "java/java.source.base/src/org/netbeans/modules/java/source/ElementUtils.java", "diffHunk": "@@ -60,6 +60,11 @@ public static TypeElement getTypeElementByBinaryName(JavacTask task, String name\n         for (ModuleElement me : allModules) {\n             TypeElement found = getTypeElementByBinaryName(task, me, name);\n \n+            if (result == found) {\n+                // avoid returning null, partial fix for [NETBEANS-4832]\n+                continue;\n+            }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cd0308d63c79157c92b6b738f4e3ee5c311363b"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDc2MzQw", "url": "https://github.com/apache/netbeans/pull/2399#pullrequestreview-497076340", "createdAt": "2020-09-27T11:58:41Z", "commit": {"oid": "8cd0308d63c79157c92b6b738f4e3ee5c311363b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxMTo1ODo0MVrOHYm6kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxMTo1ODo0MVrOHYm6kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU2NTQ1OQ==", "bodyText": "I understand the trigger, but couldn't it be fixed right in the getPackagElement(), @jlahoda ?", "url": "https://github.com/apache/netbeans/pull/2399#discussion_r495565459", "createdAt": "2020-09-27T11:58:41Z", "author": {"login": "sdedic"}, "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/FXMLCompletion2.java", "diffHunk": "@@ -161,6 +161,8 @@ public void run(ResultIterator resultIterator) throws Exception {\n                 }\n                 Parser.Result result = resultIterator.getParserResult();\n                 ci = CompilationInfo.get(result);\n+                // following populates module info, partial fix for [NETBEANS-4832]\n+                ci.getElements().getPackageElement(\"java.lang\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cd0308d63c79157c92b6b738f4e3ee5c311363b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d1875b837c34275230b244b28c5ce075ff1b9a6", "author": {"user": {"login": "errael", "name": "errael"}}, "url": "https://github.com/apache/netbeans/commit/1d1875b837c34275230b244b28c5ce075ff1b9a6", "committedDate": "2020-09-30T14:17:35Z", "message": "Handle ANNOTATION_TYPE and ENUM in getTypeElementByBinaryName()."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8cd0308d63c79157c92b6b738f4e3ee5c311363b", "author": {"user": {"login": "errael", "name": "errael"}}, "url": "https://github.com/apache/netbeans/commit/8cd0308d63c79157c92b6b738f4e3ee5c311363b", "committedDate": "2020-09-25T01:23:25Z", "message": "[NETBEANS-4832] Avoid assertion & NPE in fxml code completion"}, "afterCommit": {"oid": "1d1875b837c34275230b244b28c5ce075ff1b9a6", "author": {"user": {"login": "errael", "name": "errael"}}, "url": "https://github.com/apache/netbeans/commit/1d1875b837c34275230b244b28c5ce075ff1b9a6", "committedDate": "2020-09-30T14:17:35Z", "message": "Handle ANNOTATION_TYPE and ENUM in getTypeElementByBinaryName()."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MDE3NTMy", "url": "https://github.com/apache/netbeans/pull/2399#pullrequestreview-504017532", "createdAt": "2020-10-07T15:41:27Z", "commit": {"oid": "1d1875b837c34275230b244b28c5ce075ff1b9a6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 528, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}