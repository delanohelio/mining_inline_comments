{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0OTk4NjIw", "number": 2333, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNzo1MTowMlrOEeM0jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwODoxNDoxOFrOEeNSQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMTAyNzk5OnYy", "diffSide": "RIGHT", "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/BeanModelBuilder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNzo1MTowM1rOHJuTvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDo0MDoyN1rOHKIeXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk1Nzk0OA==", "bodyText": "I would suggest to use either ((TypeElement)(am.getAnnotationType()).asElement()).getQualifiedName().toString() or use compilationInfo.getElements().getTypeElement(NAMED_ARG) and compare asElement() to it. toString() is a diagnostic method, may change.", "url": "https://github.com/apache/netbeans/pull/2333#discussion_r479957948", "createdAt": "2020-08-31T07:51:03Z", "author": {"login": "sdedic"}, "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/BeanModelBuilder.java", "diffHunk": "@@ -310,6 +310,78 @@ private void processGetters() {\n                 addMapProperty(m, n);\n             }\n         }\n+        if (allProperties.isEmpty() && !resultInfo.isFxInstance()) {\n+            processGettersCheckForImmutables();\n+        }\n+    }\n+\n+    private static final String NAMED_ARG = \"javafx.beans.NamedArg\";\n+\n+    /** Some javafx classes, such as Insets, are immutable and do not have\n+     * no argument constructors or setters; so they are not found.\n+     * Accept a property if there is a getter with a corresponding\n+     * constructor param declared with NamedArg annotation; use constructor\n+     * with the most NamedArg parameters.\n+     * <p/>\n+     * One alternate strategy would be to provide a document with lines like:\n+     * \"Insets: top bottom left right\" and use this info.\n+     */\n+    private void processGettersCheckForImmutables() {\n+        Set<String> propsConstructor = Collections.emptySet();\n+        Set<String> props1 = new HashSet<>();\n+        CHECK_CONSTR: for (ExecutableElement c : ElementFilter.constructorsIn(classElement.getEnclosedElements())) {\n+            props1.clear();\n+\n+            CHECK_PARAMS: for (VariableElement p : c.getParameters()) {\n+                for (AnnotationMirror am : p.getAnnotationMirrors()) {\n+                    if (NAMED_ARG.equals(am.getAnnotationType().toString())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33ebc27e64e1e2557b004dc10b9e35698d65143b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM4NjY1Mg==", "bodyText": "Exactly stuff I was looking for. Much cleaner/better.\nThough note am.getAnnotationType() javadoc for this toString does say If possible, the string should be of a form suitable for representing this type in source code.", "url": "https://github.com/apache/netbeans/pull/2333#discussion_r480386652", "createdAt": "2020-08-31T20:40:27Z", "author": {"login": "errael"}, "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/BeanModelBuilder.java", "diffHunk": "@@ -310,6 +310,78 @@ private void processGetters() {\n                 addMapProperty(m, n);\n             }\n         }\n+        if (allProperties.isEmpty() && !resultInfo.isFxInstance()) {\n+            processGettersCheckForImmutables();\n+        }\n+    }\n+\n+    private static final String NAMED_ARG = \"javafx.beans.NamedArg\";\n+\n+    /** Some javafx classes, such as Insets, are immutable and do not have\n+     * no argument constructors or setters; so they are not found.\n+     * Accept a property if there is a getter with a corresponding\n+     * constructor param declared with NamedArg annotation; use constructor\n+     * with the most NamedArg parameters.\n+     * <p/>\n+     * One alternate strategy would be to provide a document with lines like:\n+     * \"Insets: top bottom left right\" and use this info.\n+     */\n+    private void processGettersCheckForImmutables() {\n+        Set<String> propsConstructor = Collections.emptySet();\n+        Set<String> props1 = new HashSet<>();\n+        CHECK_CONSTR: for (ExecutableElement c : ElementFilter.constructorsIn(classElement.getEnclosedElements())) {\n+            props1.clear();\n+\n+            CHECK_PARAMS: for (VariableElement p : c.getParameters()) {\n+                for (AnnotationMirror am : p.getAnnotationMirrors()) {\n+                    if (NAMED_ARG.equals(am.getAnnotationType().toString())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk1Nzk0OA=="}, "originalCommit": {"oid": "33ebc27e64e1e2557b004dc10b9e35698d65143b"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMTA2NjQ0OnYy", "diffSide": "RIGHT", "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/BeanModelBuilder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwODowMjo0M1rOHJuqfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDo0NzoyMFrOHKIrWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk2Mzc3Mw==", "bodyText": "Better check the Map.Entry's key for \"value\", there's also a defaultValue declared. Also it may be better to use getValue() to get the String instead of stripping \" from toString().", "url": "https://github.com/apache/netbeans/pull/2333#discussion_r479963773", "createdAt": "2020-08-31T08:02:43Z", "author": {"login": "sdedic"}, "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/BeanModelBuilder.java", "diffHunk": "@@ -310,6 +310,78 @@ private void processGetters() {\n                 addMapProperty(m, n);\n             }\n         }\n+        if (allProperties.isEmpty() && !resultInfo.isFxInstance()) {\n+            processGettersCheckForImmutables();\n+        }\n+    }\n+\n+    private static final String NAMED_ARG = \"javafx.beans.NamedArg\";\n+\n+    /** Some javafx classes, such as Insets, are immutable and do not have\n+     * no argument constructors or setters; so they are not found.\n+     * Accept a property if there is a getter with a corresponding\n+     * constructor param declared with NamedArg annotation; use constructor\n+     * with the most NamedArg parameters.\n+     * <p/>\n+     * One alternate strategy would be to provide a document with lines like:\n+     * \"Insets: top bottom left right\" and use this info.\n+     */\n+    private void processGettersCheckForImmutables() {\n+        Set<String> propsConstructor = Collections.emptySet();\n+        Set<String> props1 = new HashSet<>();\n+        CHECK_CONSTR: for (ExecutableElement c : ElementFilter.constructorsIn(classElement.getEnclosedElements())) {\n+            props1.clear();\n+\n+            CHECK_PARAMS: for (VariableElement p : c.getParameters()) {\n+                for (AnnotationMirror am : p.getAnnotationMirrors()) {\n+                    if (NAMED_ARG.equals(am.getAnnotationType().toString())) {\n+                        String prop = am.getElementValues().values().iterator().next().toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33ebc27e64e1e2557b004dc10b9e35698d65143b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM4OTk3OA==", "bodyText": "I looked around, but I didn't see it... Here's what I'm looking at now\nif (am.getAnnotationType().asElement().equals(\n        compilationInfo.getElements().getTypeElement(NAMED_ARG))) {\n    for (Entry<? extends ExecutableElement, ? extends AnnotationValue> entry\n            : am.getElementValues().entrySet()) {\n        if (entry.getKey().getSimpleName().toString().equals(\"value\")) {\n            props1.add((String)entry.getValue().getValue());\n            continue CHECK_PARAMS;\n        }\n    }\n\nI looked around for some way to do am.getElementValues().get(keyForValue), but couldn't see a way to get the key.", "url": "https://github.com/apache/netbeans/pull/2333#discussion_r480389978", "createdAt": "2020-08-31T20:47:20Z", "author": {"login": "errael"}, "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/BeanModelBuilder.java", "diffHunk": "@@ -310,6 +310,78 @@ private void processGetters() {\n                 addMapProperty(m, n);\n             }\n         }\n+        if (allProperties.isEmpty() && !resultInfo.isFxInstance()) {\n+            processGettersCheckForImmutables();\n+        }\n+    }\n+\n+    private static final String NAMED_ARG = \"javafx.beans.NamedArg\";\n+\n+    /** Some javafx classes, such as Insets, are immutable and do not have\n+     * no argument constructors or setters; so they are not found.\n+     * Accept a property if there is a getter with a corresponding\n+     * constructor param declared with NamedArg annotation; use constructor\n+     * with the most NamedArg parameters.\n+     * <p/>\n+     * One alternate strategy would be to provide a document with lines like:\n+     * \"Insets: top bottom left right\" and use this info.\n+     */\n+    private void processGettersCheckForImmutables() {\n+        Set<String> propsConstructor = Collections.emptySet();\n+        Set<String> props1 = new HashSet<>();\n+        CHECK_CONSTR: for (ExecutableElement c : ElementFilter.constructorsIn(classElement.getEnclosedElements())) {\n+            props1.clear();\n+\n+            CHECK_PARAMS: for (VariableElement p : c.getParameters()) {\n+                for (AnnotationMirror am : p.getAnnotationMirrors()) {\n+                    if (NAMED_ARG.equals(am.getAnnotationType().toString())) {\n+                        String prop = am.getElementValues().values().iterator().next().toString();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk2Mzc3Mw=="}, "originalCommit": {"oid": "33ebc27e64e1e2557b004dc10b9e35698d65143b"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMTA5MTcxOnYy", "diffSide": "RIGHT", "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/BeanModelBuilder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwODoxMDoyNlrOHJu5PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDo0Nzo0NFrOHKIsEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk2NzU0OQ==", "bodyText": "Leftover, or turn to Logger.", "url": "https://github.com/apache/netbeans/pull/2333#discussion_r479967549", "createdAt": "2020-08-31T08:10:26Z", "author": {"login": "sdedic"}, "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/BeanModelBuilder.java", "diffHunk": "@@ -310,6 +310,78 @@ private void processGetters() {\n                 addMapProperty(m, n);\n             }\n         }\n+        if (allProperties.isEmpty() && !resultInfo.isFxInstance()) {\n+            processGettersCheckForImmutables();\n+        }\n+    }\n+\n+    private static final String NAMED_ARG = \"javafx.beans.NamedArg\";\n+\n+    /** Some javafx classes, such as Insets, are immutable and do not have\n+     * no argument constructors or setters; so they are not found.\n+     * Accept a property if there is a getter with a corresponding\n+     * constructor param declared with NamedArg annotation; use constructor\n+     * with the most NamedArg parameters.\n+     * <p/>\n+     * One alternate strategy would be to provide a document with lines like:\n+     * \"Insets: top bottom left right\" and use this info.\n+     */\n+    private void processGettersCheckForImmutables() {\n+        Set<String> propsConstructor = Collections.emptySet();\n+        Set<String> props1 = new HashSet<>();\n+        CHECK_CONSTR: for (ExecutableElement c : ElementFilter.constructorsIn(classElement.getEnclosedElements())) {\n+            props1.clear();\n+\n+            CHECK_PARAMS: for (VariableElement p : c.getParameters()) {\n+                for (AnnotationMirror am : p.getAnnotationMirrors()) {\n+                    if (NAMED_ARG.equals(am.getAnnotationType().toString())) {\n+                        String prop = am.getElementValues().values().iterator().next().toString();\n+                        // Strip off leading/trailing quotes\n+                        props1.add(prop.substring(1, prop.length() - 1));\n+                        continue CHECK_PARAMS;\n+                    }\n+                }\n+                // At least one of the parameters wasn't NAMED_ARG; skip it.\n+                continue CHECK_CONSTR;\n+            }\n+            if (propsConstructor.size() < props1.size()) {\n+                propsConstructor = new HashSet<>(props1);\n+            }\n+        }\n+\n+        if (propsConstructor.isEmpty()) {\n+            return;\n+        }\n+\n+        // problem if not all constructor args are covered?\n+        boolean fxInstance = false;\n+        for (ExecutableElement m : getters) {\n+            String n = getPropertyName(m.getSimpleName().toString());\n+            if (propsConstructor.contains(n)) {\n+                addGetterOnlyProperty(m, n);\n+                fxInstance = true;\n+            }\n+        }\n+        resultInfo.setFxInstance(fxInstance);\n+\n+        // if (fxInstance) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33ebc27e64e1e2557b004dc10b9e35698d65143b"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM5MDE2Mg==", "bodyText": "K. removed", "url": "https://github.com/apache/netbeans/pull/2333#discussion_r480390162", "createdAt": "2020-08-31T20:47:44Z", "author": {"login": "errael"}, "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/BeanModelBuilder.java", "diffHunk": "@@ -310,6 +310,78 @@ private void processGetters() {\n                 addMapProperty(m, n);\n             }\n         }\n+        if (allProperties.isEmpty() && !resultInfo.isFxInstance()) {\n+            processGettersCheckForImmutables();\n+        }\n+    }\n+\n+    private static final String NAMED_ARG = \"javafx.beans.NamedArg\";\n+\n+    /** Some javafx classes, such as Insets, are immutable and do not have\n+     * no argument constructors or setters; so they are not found.\n+     * Accept a property if there is a getter with a corresponding\n+     * constructor param declared with NamedArg annotation; use constructor\n+     * with the most NamedArg parameters.\n+     * <p/>\n+     * One alternate strategy would be to provide a document with lines like:\n+     * \"Insets: top bottom left right\" and use this info.\n+     */\n+    private void processGettersCheckForImmutables() {\n+        Set<String> propsConstructor = Collections.emptySet();\n+        Set<String> props1 = new HashSet<>();\n+        CHECK_CONSTR: for (ExecutableElement c : ElementFilter.constructorsIn(classElement.getEnclosedElements())) {\n+            props1.clear();\n+\n+            CHECK_PARAMS: for (VariableElement p : c.getParameters()) {\n+                for (AnnotationMirror am : p.getAnnotationMirrors()) {\n+                    if (NAMED_ARG.equals(am.getAnnotationType().toString())) {\n+                        String prop = am.getElementValues().values().iterator().next().toString();\n+                        // Strip off leading/trailing quotes\n+                        props1.add(prop.substring(1, prop.length() - 1));\n+                        continue CHECK_PARAMS;\n+                    }\n+                }\n+                // At least one of the parameters wasn't NAMED_ARG; skip it.\n+                continue CHECK_CONSTR;\n+            }\n+            if (propsConstructor.size() < props1.size()) {\n+                propsConstructor = new HashSet<>(props1);\n+            }\n+        }\n+\n+        if (propsConstructor.isEmpty()) {\n+            return;\n+        }\n+\n+        // problem if not all constructor args are covered?\n+        boolean fxInstance = false;\n+        for (ExecutableElement m : getters) {\n+            String n = getPropertyName(m.getSimpleName().toString());\n+            if (propsConstructor.contains(n)) {\n+                addGetterOnlyProperty(m, n);\n+                fxInstance = true;\n+            }\n+        }\n+        resultInfo.setFxInstance(fxInstance);\n+\n+        // if (fxInstance) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk2NzU0OQ=="}, "originalCommit": {"oid": "33ebc27e64e1e2557b004dc10b9e35698d65143b"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMTEwNDAyOnYy", "diffSide": "RIGHT", "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/FxDefinitionKind.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwODoxNDoxOFrOHJvA0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQyMDo0Nzo1N1rOHKIsbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk2OTQ4OA==", "bodyText": "This value is not used anywhere after construction - correct ?", "url": "https://github.com/apache/netbeans/pull/2333#discussion_r479969488", "createdAt": "2020-08-31T08:14:18Z", "author": {"login": "sdedic"}, "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/FxDefinitionKind.java", "diffHunk": "@@ -47,6 +47,11 @@\n      */\n     LIST,\n \n+    /**\n+     * Readonly/immutable object, type is getter return type.\n+     */\n+    GETTER,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "33ebc27e64e1e2557b004dc10b9e35698d65143b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM5MDI1NA==", "bodyText": "That is correct.", "url": "https://github.com/apache/netbeans/pull/2333#discussion_r480390254", "createdAt": "2020-08-31T20:47:57Z", "author": {"login": "errael"}, "path": "javafx/javafx2.editor/src/org/netbeans/modules/javafx2/editor/completion/beans/FxDefinitionKind.java", "diffHunk": "@@ -47,6 +47,11 @@\n      */\n     LIST,\n \n+    /**\n+     * Readonly/immutable object, type is getter return type.\n+     */\n+    GETTER,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTk2OTQ4OA=="}, "originalCommit": {"oid": "33ebc27e64e1e2557b004dc10b9e35698d65143b"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 392, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}