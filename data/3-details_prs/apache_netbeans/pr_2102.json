{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4MDY4NjQx", "number": 2102, "title": "[NETBEANS-4203] for InputOutput.reset() do NbWriter.reset() as needed", "bodyText": "The new I/O API and SPI, introduced around 2014, has never had a working \"reset()\" to clear the output window, AFAICT.\nIt looks like this new interface delegates to platform/core.output2 and this in turn is based on the old stuff in platform/openide.windows. The new interface gave us the long promised InputOutput.reset() and hid the older OutputWriter.reset(). The older OutputWriter.reset has some essential code that the newer InputOutput.reset() never invokes.\nThis PR makes sure there's a full reset and the output window is cleared when using the default api implementation.\nTesting is tricky. The tests for the new stuff test that delegation occurs. It never actually tests a real output window. Based on the tests for the old api I've put together some tests as a module that uses reflection for verification. I don't know if there's any way to incorporate these tests into netbeans. I'm cleaning them up and will attach them to the issue.", "createdAt": "2020-04-23T17:32:16Z", "url": "https://github.com/apache/netbeans/pull/2102", "merged": true, "mergeCommit": {"oid": "1983ffca4b19e47026c2eeddc5dba072a82f4eae"}, "closed": true, "closedAt": "2020-05-05T09:04:56Z", "author": {"login": "errael"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaewxMAH2gAyNDA4MDY4NjQxOmU2MWNiZmJkYjIxNjAzMmJmOWRlZjgwNDM0NWVlYTFkZjVjNzc2NzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceJuLuAFqTQwNTQ0Nzg0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e61cbfbdb216032bf9def804345eea1df5c77676", "author": {"user": {"login": "errael", "name": "errael"}}, "url": "https://github.com/apache/netbeans/commit/e61cbfbdb216032bf9def804345eea1df5c77676", "committedDate": "2020-04-23T15:38:32Z", "message": "[NETBEANS-4203] for InputOutput.reset() do NbWriter.reset() as needed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NDMwNzMx", "url": "https://github.com/apache/netbeans/pull/2102#pullrequestreview-404430731", "createdAt": "2020-05-01T22:26:38Z", "commit": {"oid": "4f7ceae1f038839939f5f66c7c9ed8ce4b5f3601"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMjoyNjozOFrOGPXSuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMjozNjo1MlrOGPXc2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc2MzQ0OQ==", "bodyText": "The comment seems correct. At first I thought maybe io.getIn().reset() would also need to be called, but as the comment says, we the implementation of NbWriter will call NbIO.reset() in turn..", "url": "https://github.com/apache/netbeans/pull/2102#discussion_r418763449", "createdAt": "2020-05-01T22:26:38Z", "author": {"login": "eirikbakke"}, "path": "platform/core.output2/src/org/netbeans/core/output2/NbIOProvider.java", "diffHunk": "@@ -214,7 +214,17 @@ public Lookup getIOLookup(InputOutput io) {\n     @Override\n     public void resetIO(InputOutput io) {\n         if (io instanceof NbIO) {\n-            ((NbIO) io).reset();\n+            if(io.getOut() instanceof NbWriter) {\n+                try {\n+                    // NbWriter does OutWriter fixup,\n+                    // then NbWriter invokes ((NbIO) io).reset()\n+                    io.getOut().reset();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f7ceae1f038839939f5f66c7c9ed8ce4b5f3601"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc2MzQ5Mg==", "bodyText": "space after if", "url": "https://github.com/apache/netbeans/pull/2102#discussion_r418763492", "createdAt": "2020-05-01T22:26:48Z", "author": {"login": "eirikbakke"}, "path": "platform/core.output2/src/org/netbeans/core/output2/NbIOProvider.java", "diffHunk": "@@ -214,7 +214,17 @@ public Lookup getIOLookup(InputOutput io) {\n     @Override\n     public void resetIO(InputOutput io) {\n         if (io instanceof NbIO) {\n-            ((NbIO) io).reset();\n+            if(io.getOut() instanceof NbWriter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f7ceae1f038839939f5f66c7c9ed8ce4b5f3601"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc2NjAyOA==", "bodyText": "This seems to be the way errors are handled in this class, I guess.", "url": "https://github.com/apache/netbeans/pull/2102#discussion_r418766028", "createdAt": "2020-05-01T22:36:49Z", "author": {"login": "eirikbakke"}, "path": "platform/core.output2/src/org/netbeans/core/output2/NbIOProvider.java", "diffHunk": "@@ -214,7 +214,17 @@ public Lookup getIOLookup(InputOutput io) {\n     @Override\n     public void resetIO(InputOutput io) {\n         if (io instanceof NbIO) {\n-            ((NbIO) io).reset();\n+            if(io.getOut() instanceof NbWriter) {\n+                try {\n+                    // NbWriter does OutWriter fixup,\n+                    // then NbWriter invokes ((NbIO) io).reset()\n+                    io.getOut().reset();\n+                } catch(IOException ex) {\n+                    Exceptions.printStackTrace(ex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f7ceae1f038839939f5f66c7c9ed8ce4b5f3601"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc2NjA0Mw==", "bodyText": "space before (", "url": "https://github.com/apache/netbeans/pull/2102#discussion_r418766043", "createdAt": "2020-05-01T22:36:52Z", "author": {"login": "eirikbakke"}, "path": "platform/core.output2/src/org/netbeans/core/output2/NbIOProvider.java", "diffHunk": "@@ -214,7 +214,17 @@ public Lookup getIOLookup(InputOutput io) {\n     @Override\n     public void resetIO(InputOutput io) {\n         if (io instanceof NbIO) {\n-            ((NbIO) io).reset();\n+            if(io.getOut() instanceof NbWriter) {\n+                try {\n+                    // NbWriter does OutWriter fixup,\n+                    // then NbWriter invokes ((NbIO) io).reset()\n+                    io.getOut().reset();\n+                } catch(IOException ex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f7ceae1f038839939f5f66c7c9ed8ce4b5f3601"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzA4NzI3", "url": "https://github.com/apache/netbeans/pull/2102#pullrequestreview-404708727", "createdAt": "2020-05-04T04:54:21Z", "commit": {"oid": "4f7ceae1f038839939f5f66c7c9ed8ce4b5f3601"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNDo1NDoyMVrOGPyv6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwNDo1NDoyMVrOGPyv6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIxMzI5MQ==", "bodyText": "This will probably show a dialog to the user. If you just want to print errors to console, consider Exceptions.attachSeverity first.", "url": "https://github.com/apache/netbeans/pull/2102#discussion_r419213291", "createdAt": "2020-05-04T04:54:21Z", "author": {"login": "JaroslavTulach"}, "path": "platform/core.output2/src/org/netbeans/core/output2/NbIOProvider.java", "diffHunk": "@@ -214,7 +214,17 @@ public Lookup getIOLookup(InputOutput io) {\n     @Override\n     public void resetIO(InputOutput io) {\n         if (io instanceof NbIO) {\n-            ((NbIO) io).reset();\n+            if(io.getOut() instanceof NbWriter) {\n+                try {\n+                    // NbWriter does OutWriter fixup,\n+                    // then NbWriter invokes ((NbIO) io).reset()\n+                    io.getOut().reset();\n+                } catch(IOException ex) {\n+                    Exceptions.printStackTrace(ex);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc2NjAyOA=="}, "originalCommit": {"oid": "4f7ceae1f038839939f5f66c7c9ed8ce4b5f3601"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDQ3ODQ1", "url": "https://github.com/apache/netbeans/pull/2102#pullrequestreview-405447845", "createdAt": "2020-05-05T01:23:24Z", "commit": {"oid": "e61cbfbdb216032bf9def804345eea1df5c77676"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4941, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}