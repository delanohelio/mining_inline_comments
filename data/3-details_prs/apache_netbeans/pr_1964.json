{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NjgyNzQy", "number": 1964, "title": "More stabilization fixes for vanilla indexerer - mostly stabilizing b\u2026", "bodyText": "\u2026roken annotations.", "createdAt": "2020-02-23T08:53:31Z", "url": "https://github.com/apache/netbeans/pull/1964", "merged": true, "mergeCommit": {"oid": "4f3cfbea89a85be47fa51024c7acfa31bab302b9"}, "closed": true, "closedAt": "2020-03-05T07:10:50Z", "author": {"login": "jlahoda"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHE9hLAH2gAyMzc4NjgyNzQyOmQxMmJhYTcwYmZhMzA2MjdhMGNlNzBlMjZkZmQxYjdjMWI5NjdhNWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIjiZ8AFqTM2NjA2MDkzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d12baa70bfa30627a0ce70e26dfd1b7c1b967a5e", "author": {"user": {"login": "jlahoda", "name": "Jan Lahoda"}}, "url": "https://github.com/apache/netbeans/commit/d12baa70bfa30627a0ce70e26dfd1b7c1b967a5e", "committedDate": "2020-02-23T08:50:22Z", "message": "More stabilization fixes for vanilla indexerer - mostly stabilizing broken annotations."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMDgwNjAx", "url": "https://github.com/apache/netbeans/pull/1964#pullrequestreview-363080601", "createdAt": "2020-02-23T09:11:22Z", "commit": {"oid": "d12baa70bfa30627a0ce70e26dfd1b7c1b967a5e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMjAzNjAy", "url": "https://github.com/apache/netbeans/pull/1964#pullrequestreview-363203602", "createdAt": "2020-02-24T07:38:36Z", "commit": {"oid": "d12baa70bfa30627a0ce70e26dfd1b7c1b967a5e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwNzozODozN1rOFtXdcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwNzozODozN1rOFtXdcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzExNDYwOA==", "bodyText": "This appears to be duplicate", "url": "https://github.com/apache/netbeans/pull/1964#discussion_r383114608", "createdAt": "2020-02-24T07:38:37Z", "author": {"login": "mklaehn"}, "path": "java/java.source.base/src/org/netbeans/modules/java/source/indexing/VanillaCompileWorker.java", "diffHunk": "@@ -595,19 +608,56 @@ private void clearAnnotations(SymbolMetadata metadata) {\n                 com.sun.tools.javac.util.List<Attribute.Compound> annotations = metadata.getDeclarationAttributes();\n                 com.sun.tools.javac.util.List<Attribute.Compound> prev = null;\n                 while (annotations.nonEmpty()) {\n-                    if (isErroneous(annotations.head.type)) {\n+                    if (isAnnotationErroneous(annotations.head)) {\n                         if (prev == null) {\n                             metadata.reset();\n                             metadata.setDeclarationAttributes(annotations.tail);\n                         } else {\n                             prev.tail = annotations.tail;\n                         }\n+                    } else {\n+                        prev = annotations;\n                     }\n-                    prev = annotations;\n                     annotations = annotations.tail;\n                 }\n             }\n \n+            private boolean isAnnotationErroneous(Attribute annotation) {\n+                if (isErroneous(annotation.type)) {\n+                    return true;\n+                } else if (annotation instanceof Attribute.Array) {\n+                    for (Attribute nested : ((Attribute.Array) annotation).values) {\n+                        if (isAnnotationErroneous(nested)) {\n+                            return true;\n+                        }\n+                    }\n+                    return false;\n+                } else if (annotation instanceof Attribute.Class) {\n+                    if (isErroneous(((Attribute.Class) annotation).classType)) {\n+                        return true;\n+                    }\n+                    return false;\n+                } else if (annotation instanceof Attribute.Compound) {\n+                    for (Pair<MethodSymbol, Attribute> p : ((Attribute.Compound) annotation).values) {\n+                        if (isAnnotationErroneous(p.snd)) {\n+                            return true;\n+                        }\n+                    }\n+                    return false;\n+                } else if (annotation instanceof Attribute.Constant) {\n+                    return false;\n+                } else if (annotation instanceof Attribute.Enum) {\n+                    return false;\n+                } else if (annotation instanceof Attribute.Enum) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d12baa70bfa30627a0ce70e26dfd1b7c1b967a5e"}, "originalPosition": 120}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b9122a993a491290aaf48995de4b8733f6391e0", "author": {"user": {"login": "jlahoda", "name": "Jan Lahoda"}}, "url": "https://github.com/apache/netbeans/commit/9b9122a993a491290aaf48995de4b8733f6391e0", "committedDate": "2020-02-27T21:03:28Z", "message": "Merge branch 'master' into improving-vanilla-indexer-feb-2020"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1c714e8d90eb661bec9a26168fdccedf62ebd96", "author": {"user": {"login": "jlahoda", "name": "Jan Lahoda"}}, "url": "https://github.com/apache/netbeans/commit/a1c714e8d90eb661bec9a26168fdccedf62ebd96", "committedDate": "2020-02-27T21:05:55Z", "message": "Removing duplicated branch, as noted on review."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MDYwOTM2", "url": "https://github.com/apache/netbeans/pull/1964#pullrequestreview-366060936", "createdAt": "2020-02-27T23:01:44Z", "commit": {"oid": "a1c714e8d90eb661bec9a26168fdccedf62ebd96"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 195, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}