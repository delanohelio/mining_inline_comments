{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMTY1MTM2", "number": 2578, "title": "[NETBEANS-5091] PHP - more improvements for constants in code completion", "bodyText": "https://issues.apache.org/jira/browse/NETBEANS-5091\n\nImproved display of class constants (previous change affected only global constants).\nDisplay more values, not only the first one.\nUnsupported key or value is displayed as \"?\".\nConversion code was moved to parent class (ClassConstantDeclarationInfo) and child class (ConstantDeclarationInfo) uses the same method.\nAdded new tests and updated existing.\n\nExample:", "createdAt": "2020-12-03T22:38:31Z", "url": "https://github.com/apache/netbeans/pull/2578", "merged": true, "mergeCommit": {"oid": "e5a80b4fffcfa2b67e447ab52f03ea11ced0e249"}, "closed": true, "closedAt": "2020-12-06T22:56:21Z", "author": {"login": "KacerCZ"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdis0M1AFqTU0NDU3NjI4NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjauvPABqjQwNzYzMjAyMzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NTc2Mjg1", "url": "https://github.com/apache/netbeans/pull/2578#pullrequestreview-544576285", "createdAt": "2020-12-04T00:43:29Z", "commit": {"oid": "3732ec28ffb49398e8f43d1cc8a301aec3608a58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMDo0MzoyOVrOH-7srA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMDo0MzoyOVrOH-7srA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc1MTg1Mg==", "bodyText": "Nitpick: NOI18N", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r535751852", "createdAt": "2020-12-04T00:43:29Z", "author": {"login": "junichi11"}, "path": "php/php.editor/src/org/netbeans/modules/php/editor/model/nodes/ClassConstantDeclarationInfo.java", "diffHunk": "@@ -97,4 +96,61 @@ public PhpModifiers getAccessModifiers() {\n         return PhpModifiers.fromBitMask(constantDeclaration.getModifier());\n     }\n \n+    @CheckForNull\n+    protected static String getConstantValue(Expression expr) {\n+        if (expr instanceof Scalar) {\n+            return ((Scalar) expr).getStringValue();\n+        }\n+        if (expr instanceof UnaryOperation) {\n+            UnaryOperation up = (UnaryOperation) expr;\n+            if (up.getOperator() == UnaryOperation.Operator.MINUS\n+                    && up.getExpression() instanceof Scalar) {\n+                return \"-\" + ((Scalar) up.getExpression()).getStringValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3732ec28ffb49398e8f43d1cc8a301aec3608a58"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NTc2Njkx", "url": "https://github.com/apache/netbeans/pull/2578#pullrequestreview-544576691", "createdAt": "2020-12-04T00:44:28Z", "commit": {"oid": "3732ec28ffb49398e8f43d1cc8a301aec3608a58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMDo0NDoyOFrOH-7uWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMDo0NDoyOFrOH-7uWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc1MjI4MQ==", "bodyText": "Why Integer?", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r535752281", "createdAt": "2020-12-04T00:44:28Z", "author": {"login": "junichi11"}, "path": "php/php.editor/src/org/netbeans/modules/php/editor/model/nodes/ClassConstantDeclarationInfo.java", "diffHunk": "@@ -22,20 +22,28 @@\n import java.util.ArrayList;\n import java.util.Iterator;\n import java.util.List;\n+import org.netbeans.api.annotations.common.CheckForNull;\n import org.netbeans.modules.csl.api.OffsetRange;\n import org.netbeans.modules.php.editor.api.PhpModifiers;\n import org.netbeans.modules.php.editor.api.QualifiedName;\n import org.netbeans.modules.php.editor.model.nodes.ASTNodeInfo.Kind;\n+import org.netbeans.modules.php.editor.parser.astnodes.ArrayCreation;\n+import org.netbeans.modules.php.editor.parser.astnodes.ArrayElement;\n import org.netbeans.modules.php.editor.parser.astnodes.ConstantDeclaration;\n import org.netbeans.modules.php.editor.parser.astnodes.Expression;\n import org.netbeans.modules.php.editor.parser.astnodes.Identifier;\n import org.netbeans.modules.php.editor.parser.astnodes.Scalar;\n import org.netbeans.modules.php.editor.parser.astnodes.UnaryOperation;\n+import org.netbeans.modules.php.editor.parser.astnodes.UnpackableArrayElement;\n \n /**\n  * @author Radek Matous\n  */\n public class ClassConstantDeclarationInfo extends ASTNodeInfo<Identifier> {\n+    // Array display is stopped after this length of string is reached.\n+    private static final Integer ARRAY_CUT_LENGTH = 50;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3732ec28ffb49398e8f43d1cc8a301aec3608a58"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NTgzMjky", "url": "https://github.com/apache/netbeans/pull/2578#pullrequestreview-544583292", "createdAt": "2020-12-04T01:02:30Z", "commit": {"oid": "3732ec28ffb49398e8f43d1cc8a301aec3608a58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMTowMjozMVrOH-8IMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQwMTowMjozMVrOH-8IMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc1ODg5Ng==", "bodyText": "The rat does not check the license header of test files. However, we should add it to new test files if possible. Of course, we need not add it to *.completion, *.pass, and so on.", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r535758896", "createdAt": "2020-12-04T01:02:31Z", "author": {"login": "junichi11"}, "path": "php/php.editor/test/unit/data/testfiles/completion/lib/php56/classConst.php", "diffHunk": "@@ -0,0 +1,23 @@\n+<?php\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3732ec28ffb49398e8f43d1cc8a301aec3608a58"}, "originalPosition": 2}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3732ec28ffb49398e8f43d1cc8a301aec3608a58", "author": {"user": {"login": "KacerCZ", "name": "Tom\u00e1\u0161 Proch\u00e1zka"}}, "url": "https://github.com/apache/netbeans/commit/3732ec28ffb49398e8f43d1cc8a301aec3608a58", "committedDate": "2020-12-03T22:36:06Z", "message": "[NETBEANS-5091] PHP - more improvements for constants in code completion\n\nhttps://issues.apache.org/jira/browse/NETBEANS-5091\n\n- Improved display of class constants (previous change affected only global constants).\n- Display more values, not only the first one.\n- Unsupported key or value is displayed as \"?\".\n- Conversion code was moved to parent class (`ClassConstantDeclarationInfo`) and child class (`ConstantDeclarationInfo`) uses the same method.\n- Added new tests and updated existing."}, "afterCommit": {"oid": "fc7e43902c3a4e19c07749db96f8a73b6afda4b2", "author": {"user": {"login": "KacerCZ", "name": "Tom\u00e1\u0161 Proch\u00e1zka"}}, "url": "https://github.com/apache/netbeans/commit/fc7e43902c3a4e19c07749db96f8a73b6afda4b2", "committedDate": "2020-12-04T14:03:57Z", "message": "[NETBEANS-5091] PHP - more improvements for constants in code completion\n\nhttps://issues.apache.org/jira/browse/NETBEANS-5091\n\n- Improved display of class constants (previous change affected only global constants).\n- Display more values, not only the first one.\n- Unsupported key or value is displayed as \"?\".\n- Conversion code was moved to parent class (`ClassConstantDeclarationInfo`) and child class (`ConstantDeclarationInfo`) uses the same method.\n- Added new tests and updated existing."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzkwNDY2", "url": "https://github.com/apache/netbeans/pull/2578#pullrequestreview-545390466", "createdAt": "2020-12-05T01:49:15Z", "commit": {"oid": "fc7e43902c3a4e19c07749db96f8a73b6afda4b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NjQ0MDk5", "url": "https://github.com/apache/netbeans/pull/2578#pullrequestreview-545644099", "createdAt": "2020-12-05T19:34:26Z", "commit": {"oid": "fc7e43902c3a4e19c07749db96f8a73b6afda4b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxOTozNDoyNlrOIAAfAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNVQxOTozNDoyNlrOIAAfAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3ODg1MQ==", "bodyText": "Perhaps instead of ... we could show something like ... (5 more elements)?", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r536878851", "createdAt": "2020-12-05T19:34:26Z", "author": {"login": "tmysik"}, "path": "php/php.editor/src/org/netbeans/modules/php/editor/model/nodes/ClassConstantDeclarationInfo.java", "diffHunk": "@@ -97,4 +96,61 @@ public PhpModifiers getAccessModifiers() {\n         return PhpModifiers.fromBitMask(constantDeclaration.getModifier());\n     }\n \n+    @CheckForNull\n+    protected static String getConstantValue(Expression expr) {\n+        if (expr instanceof Scalar) {\n+            return ((Scalar) expr).getStringValue();\n+        }\n+        if (expr instanceof UnaryOperation) {\n+            UnaryOperation up = (UnaryOperation) expr;\n+            if (up.getOperator() == UnaryOperation.Operator.MINUS\n+                    && up.getExpression() instanceof Scalar) {\n+                return \"-\" + ((Scalar) up.getExpression()).getStringValue(); //NOI18N\n+            }\n+        }\n+        if (expr instanceof ArrayCreation) {\n+            return getConstantValue((ArrayCreation) expr);\n+        }\n+        return null;\n+    }\n+\n+    private static String getConstantValue(ArrayCreation expr) {\n+        String debug = expr.toString();\n+        StringBuilder sb = new StringBuilder(\"[\"); //NOI18N\n+        Integer displayedElements = 0;\n+        List<ArrayElement> elements = expr.getElements();\n+        for (ArrayElement element : elements) {\n+            if (displayedElements > 0) {\n+                sb.append(\", \"); //NOI18N\n+            }\n+            sb.append(getConstantValue(element));\n+            displayedElements++;\n+            if (sb.length() > ARRAY_CUT_LENGTH) {\n+                break;\n+            }\n+        }\n+        if (displayedElements < elements.size()) {\n+            sb.append(\", ...\"); //NOI18N", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc7e43902c3a4e19c07749db96f8a73b6afda4b2"}, "originalPosition": 87}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1NjQ0MjA1", "url": "https://github.com/apache/netbeans/pull/2578#pullrequestreview-545644205", "createdAt": "2020-12-05T19:36:10Z", "commit": {"oid": "fc7e43902c3a4e19c07749db96f8a73b6afda4b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d139f6d1ab0a833407b75e6e419ea0b75ecd6b5e", "author": {"user": {"login": "KacerCZ", "name": "Tom\u00e1\u0161 Proch\u00e1zka"}}, "url": "https://github.com/apache/netbeans/commit/d139f6d1ab0a833407b75e6e419ea0b75ecd6b5e", "committedDate": "2020-12-06T06:12:50Z", "message": "[NETBEANS-5091] PHP - more improvements for constants in code completion\n\nhttps://issues.apache.org/jira/browse/NETBEANS-5091\n\n- Improved display of class constants (previous change affected only global constants).\n- Display more values, not only the first one.\n- Unsupported key or value is displayed as \"?\".\n- Conversion code was moved to parent class (`ClassConstantDeclarationInfo`) and child class (`ConstantDeclarationInfo`) uses the same method.\n- Added new tests and updated existing."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc7e43902c3a4e19c07749db96f8a73b6afda4b2", "author": {"user": {"login": "KacerCZ", "name": "Tom\u00e1\u0161 Proch\u00e1zka"}}, "url": "https://github.com/apache/netbeans/commit/fc7e43902c3a4e19c07749db96f8a73b6afda4b2", "committedDate": "2020-12-04T14:03:57Z", "message": "[NETBEANS-5091] PHP - more improvements for constants in code completion\n\nhttps://issues.apache.org/jira/browse/NETBEANS-5091\n\n- Improved display of class constants (previous change affected only global constants).\n- Display more values, not only the first one.\n- Unsupported key or value is displayed as \"?\".\n- Conversion code was moved to parent class (`ClassConstantDeclarationInfo`) and child class (`ConstantDeclarationInfo`) uses the same method.\n- Added new tests and updated existing."}, "afterCommit": {"oid": "d139f6d1ab0a833407b75e6e419ea0b75ecd6b5e", "author": {"user": {"login": "KacerCZ", "name": "Tom\u00e1\u0161 Proch\u00e1zka"}}, "url": "https://github.com/apache/netbeans/commit/d139f6d1ab0a833407b75e6e419ea0b75ecd6b5e", "committedDate": "2020-12-06T06:12:50Z", "message": "[NETBEANS-5091] PHP - more improvements for constants in code completion\n\nhttps://issues.apache.org/jira/browse/NETBEANS-5091\n\n- Improved display of class constants (previous change affected only global constants).\n- Display more values, not only the first one.\n- Unsupported key or value is displayed as \"?\".\n- Conversion code was moved to parent class (`ClassConstantDeclarationInfo`) and child class (`ConstantDeclarationInfo`) uses the same method.\n- Added new tests and updated existing."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 391, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}