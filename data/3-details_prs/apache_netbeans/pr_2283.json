{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5MjEyMDQ5", "number": 2283, "title": "[NETBEANS-3990]: Auto completion for Sealed Types", "bodyText": "Auto completion of keywords sealed, non-sealed, permits and classes,records names inside permits clause.", "createdAt": "2020-07-30T14:03:35Z", "url": "https://github.com/apache/netbeans/pull/2283", "merged": true, "mergeCommit": {"oid": "429c454735489613f26a9cfea714ef3fa696d9b2"}, "closed": true, "closedAt": "2020-10-10T20:39:52Z", "author": {"login": "Akshay-Gupta-Oracle"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6SwhngBqjM2MDgxNTA0MjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN4nJzABqjM4MjMzMTk1NjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d737c625669289f0df0e5965b5c71910a4d62d5b", "author": {"user": {"login": "Akshay-Gupta-Oracle", "name": "Akshay Gupta"}}, "url": "https://github.com/apache/netbeans/commit/d737c625669289f0df0e5965b5c71910a4d62d5b", "committedDate": "2020-07-30T14:42:57Z", "message": "[NETBEANS-4311]: Auto completion for Sealed Types"}, "afterCommit": {"oid": "b1882b897070f602ebe51c2c707ebd26fd9482c4", "author": {"user": {"login": "Akshay-Gupta-Oracle", "name": "Akshay Gupta"}}, "url": "https://github.com/apache/netbeans/commit/b1882b897070f602ebe51c2c707ebd26fd9482c4", "committedDate": "2020-07-31T11:44:18Z", "message": "[NETBEANS-4311]: Auto completion for Sealed Types"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MTc5MDQ3", "url": "https://github.com/apache/netbeans/pull/2283#pullrequestreview-459179047", "createdAt": "2020-07-31T13:36:51Z", "commit": {"oid": "b1882b897070f602ebe51c2c707ebd26fd9482c4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxMzozNjo1MVrOG6I0aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNToxMTo0N1rOG6MIJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzYxNTA4Mw==", "bodyText": "Please do not return internal javac types (i.e. anything from com.sun.tools.**) from API or semi-API methods like this. It should be simply List, or something similar.", "url": "https://github.com/apache/netbeans/pull/2283#discussion_r463615083", "createdAt": "2020-07-31T13:36:51Z", "author": {"login": "lahodaj"}, "path": "java/java.source.base/src/org/netbeans/modules/java/source/TreeShims.java", "diffHunk": "@@ -149,6 +151,33 @@ public static Name getBinding(Tree node) {\n         }\n     }\n \n+    public static List<JCTree.JCExpression> getPermits(JCClassDecl newT) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1882b897070f602ebe51c2c707ebd26fd9482c4"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY2ODQ0OA==", "bodyText": "Please no internal types inside language features (besides the language infrastructure, like java.source{.base}, etc.).", "url": "https://github.com/apache/netbeans/pull/2283#discussion_r463668448", "createdAt": "2020-07-31T15:10:21Z", "author": {"login": "lahodaj"}, "path": "java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java", "diffHunk": "@@ -22,6 +22,7 @@\n import com.sun.source.tree.*;\n import com.sun.source.tree.Tree.Kind;\n import com.sun.source.util.*;\n+import com.sun.tools.javac.tree.JCTree.JCExpression;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1882b897070f602ebe51c2c707ebd26fd9482c4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY2OTI4Nw==", "bodyText": "I think I would prefer to only have the keywords for an appropriate source level. The existing tests are probably not setting source level to 14, so I would incline to not add the keywords there. New tests may set source level to 14 and check the keywords are proposed by the code completion.", "url": "https://github.com/apache/netbeans/pull/2283#discussion_r463669287", "createdAt": "2020-07-31T15:11:47Z", "author": {"login": "lahodaj"}, "path": "java/java.completion/test/unit/data/goldenfiles/org/netbeans/modules/java/completion/JavaCompletionTaskTest/1.8/CreateConstructorNonDefaultConstructor.pass", "diffHunk": "@@ -25,9 +25,11 @@ int\n interface\n long\n native\n+non-sealed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1882b897070f602ebe51c2c707ebd26fd9482c4"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NTA0NjYx", "url": "https://github.com/apache/netbeans/pull/2283#pullrequestreview-459504661", "createdAt": "2020-07-31T22:17:02Z", "commit": {"oid": "b1882b897070f602ebe51c2c707ebd26fd9482c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMjoxNzowMlrOG6YWCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMjoxNzowMlrOG6YWCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg2OTQ1MA==", "bodyText": "should use TokenUtilities.textEquals().\nPlease reformat each your change. (Select your changes > Source > Format)", "url": "https://github.com/apache/netbeans/pull/2283#discussion_r463869450", "createdAt": "2020-07-31T22:17:02Z", "author": {"login": "junichi11"}, "path": "java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java", "diffHunk": "@@ -780,6 +813,13 @@ private void insideClass(Env env) throws IOException {\n                 controller.toPhase(Phase.ELEMENTS_RESOLVED);\n                 env.addToExcludes(controller.getTrees().getElement(path));\n                 addTypes(env, EnumSet.of(INTERFACE, ANNOTATION_TYPE), null);\n+            } else if (last != null && last.token().text().toString().equals(\"permits\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1882b897070f602ebe51c2c707ebd26fd9482c4"}, "originalPosition": 110}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dec0cf2042bdcd23be615063a892b50bf04c59a9", "author": {"user": {"login": "Akshay-Gupta-Oracle", "name": "Akshay Gupta"}}, "url": "https://github.com/apache/netbeans/commit/dec0cf2042bdcd23be615063a892b50bf04c59a9", "committedDate": "2020-09-24T16:58:08Z", "message": "[NETBEANS-4311]: Auto completion for Sealed Types"}, "afterCommit": {"oid": "582a7ab1020fe3a2e5c03e767e34fc012f884433", "author": {"user": {"login": "Akshay-Gupta-Oracle", "name": "Akshay Gupta"}}, "url": "https://github.com/apache/netbeans/commit/582a7ab1020fe3a2e5c03e767e34fc012f884433", "committedDate": "2020-09-25T08:52:59Z", "message": "[NETBEANS-4311]: Auto completion for Sealed Types"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzU5NzU1", "url": "https://github.com/apache/netbeans/pull/2283#pullrequestreview-498359755", "createdAt": "2020-09-29T11:13:05Z", "commit": {"oid": "582a7ab1020fe3a2e5c03e767e34fc012f884433"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzcxODI3", "url": "https://github.com/apache/netbeans/pull/2283#pullrequestreview-498371827", "createdAt": "2020-09-29T11:30:57Z", "commit": {"oid": "582a7ab1020fe3a2e5c03e767e34fc012f884433"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTozMDo1N1rOHZotQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTozMDo1N1rOHZotQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY0MzM5Mw==", "bodyText": "Please format and use {}", "url": "https://github.com/apache/netbeans/pull/2283#discussion_r496643393", "createdAt": "2020-09-29T11:30:57Z", "author": {"login": "junichi11"}, "path": "java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java", "diffHunk": "@@ -792,8 +830,14 @@ private void insideClass(Env env) throws IOException {\n                     controller.toPhase(Phase.ELEMENTS_RESOLVED);\n                     env.addToExcludes(controller.getTrees().getElement(path));\n                     addTypes(env, EnumSet.of(INTERFACE, ANNOTATION_TYPE), null);\n+                } else if (isSealedSupported(env) && last != null && TokenUtilities.textEquals(last.token().text(),PERMITS_KEYWORD)) {\n+                    controller.toPhase(Phase.ELEMENTS_RESOLVED);\n+                    env.addToExcludes(controller.getTrees().getElement(path));\n+                    addClassTypes(env, null);\n                 } else {\n                     addKeyword(env, IMPLEMENTS_KEYWORD, SPACE, false);\n+                   if(isSealedSupported(env)) \n+                       addKeyword(env, PERMITS_KEYWORD, SPACE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "582a7ab1020fe3a2e5c03e767e34fc012f884433"}, "originalPosition": 113}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzcyMjc1", "url": "https://github.com/apache/netbeans/pull/2283#pullrequestreview-498372275", "createdAt": "2020-09-29T11:31:36Z", "commit": {"oid": "582a7ab1020fe3a2e5c03e767e34fc012f884433"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTozMTozNlrOHZoueQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTozMTozNlrOHZoueQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY0MzcwNQ==", "bodyText": "Please revert.", "url": "https://github.com/apache/netbeans/pull/2283#discussion_r496643705", "createdAt": "2020-09-29T11:31:36Z", "author": {"login": "junichi11"}, "path": "java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java", "diffHunk": "@@ -858,13 +905,22 @@ private void insideClass(Env env) throws IOException {\n                     addTypes(env, EnumSet.of(INTERFACE, ANNOTATION_TYPE), null);\n                     break;\n                 case IDENTIFIER:\n+                    if (isSealedSupported(env) && TokenUtilities.textEquals(lastNonWhitespaceToken.token().text(),PERMITS_KEYWORD)) {\n+                        controller.toPhase(Phase.ELEMENTS_RESOLVED);\n+                        env.addToExcludes(controller.getTrees().getElement(path));\n+                        addClassTypes(env, null);\n+                        break;\n+                    }\n                     if (!tu.isAnnotation(cls)) {\n                         if (!tu.isEnum(cls)) {\n                             addKeyword(env, EXTENDS_KEYWORD, SPACE, false);\n+                            if (isSealedSupported(env)) {\n+                                addKeyword(env, PERMITS_KEYWORD, SPACE, false);\n+                            }\n                         }\n                         if (!tu.isInterface(cls)) {\n                             addKeyword(env, IMPLEMENTS_KEYWORD, SPACE, false);\n-                        }\n+                         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "582a7ab1020fe3a2e5c03e767e34fc012f884433"}, "originalPosition": 147}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzcyNTkz", "url": "https://github.com/apache/netbeans/pull/2283#pullrequestreview-498372593", "createdAt": "2020-09-29T11:32:04Z", "commit": {"oid": "582a7ab1020fe3a2e5c03e767e34fc012f884433"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTozMjowNFrOHZovVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTozMjowNFrOHZovVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY0MzkyNQ==", "bodyText": "Please format.", "url": "https://github.com/apache/netbeans/pull/2283#discussion_r496643925", "createdAt": "2020-09-29T11:32:04Z", "author": {"login": "junichi11"}, "path": "java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java", "diffHunk": "@@ -4779,9 +4850,13 @@ private void addClassModifiers(Env env, Set<Modifier> modifiers) {\n         if (!modifiers.contains(PUBLIC) && !modifiers.contains(PRIVATE)) {\n             kws.add(PUBLIC_KEYWORD);\n         }\n-        if (!modifiers.contains(FINAL) && !modifiers.contains(ABSTRACT)) {\n+        if (!modifiers.contains(FINAL) && !modifiers.contains(ABSTRACT) && !modifiers.contains(SEALED_KEYWORD) && !modifiers.contains(NON_SEALED_KEYWORD)) {\n             kws.add(ABSTRACT_KEYWORD);\n             kws.add(FINAL_KEYWORD);\n+            if(isSealedSupported(env)){\n+                kws.add(SEALED_KEYWORD);\n+                kws.add(NON_SEALED_KEYWORD);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "582a7ab1020fe3a2e5c03e767e34fc012f884433"}, "originalPosition": 198}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MzczNTg3", "url": "https://github.com/apache/netbeans/pull/2283#pullrequestreview-498373587", "createdAt": "2020-09-29T11:33:28Z", "commit": {"oid": "582a7ab1020fe3a2e5c03e767e34fc012f884433"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTozMzoyOFrOHZoyLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTozMzoyOFrOHZoyLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjY0NDY1NA==", "bodyText": "Please format.", "url": "https://github.com/apache/netbeans/pull/2283#discussion_r496644654", "createdAt": "2020-09-29T11:33:28Z", "author": {"login": "junichi11"}, "path": "java/java.completion/src/org/netbeans/modules/java/completion/JavaCompletionTask.java", "diffHunk": "@@ -780,6 +812,12 @@ private void insideClass(Env env) throws IOException {\n                 controller.toPhase(Phase.ELEMENTS_RESOLVED);\n                 env.addToExcludes(controller.getTrees().getElement(path));\n                 addTypes(env, EnumSet.of(INTERFACE, ANNOTATION_TYPE), null);\n+            } else if (isSealedSupported(env) && last != null && TokenUtilities.textEquals(last.token().text(),PERMITS_KEYWORD)) {\n+                controller.toPhase(Phase.ELEMENTS_RESOLVED);\n+                env.addToExcludes(controller.getTrees().getElement(path));\n+                addClassTypes(env, null);\n+            } else if(isSealedSupported(env)){\n+                addKeyword(env, PERMITS_KEYWORD, SPACE, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "582a7ab1020fe3a2e5c03e767e34fc012f884433"}, "originalPosition": 98}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c53bab9dc3aeea0eb98fa85ad1c7ff35e40cc36", "author": {"user": {"login": "Akshay-Gupta-Oracle", "name": "Akshay Gupta"}}, "url": "https://github.com/apache/netbeans/commit/0c53bab9dc3aeea0eb98fa85ad1c7ff35e40cc36", "committedDate": "2020-09-30T08:32:05Z", "message": "[NETBEANS-4311]: Auto completion for Sealed Types"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "582a7ab1020fe3a2e5c03e767e34fc012f884433", "author": {"user": {"login": "Akshay-Gupta-Oracle", "name": "Akshay Gupta"}}, "url": "https://github.com/apache/netbeans/commit/582a7ab1020fe3a2e5c03e767e34fc012f884433", "committedDate": "2020-09-25T08:52:59Z", "message": "[NETBEANS-4311]: Auto completion for Sealed Types"}, "afterCommit": {"oid": "0c53bab9dc3aeea0eb98fa85ad1c7ff35e40cc36", "author": {"user": {"login": "Akshay-Gupta-Oracle", "name": "Akshay Gupta"}}, "url": "https://github.com/apache/netbeans/commit/0c53bab9dc3aeea0eb98fa85ad1c7ff35e40cc36", "committedDate": "2020-09-30T08:32:05Z", "message": "[NETBEANS-4311]: Auto completion for Sealed Types"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4933, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}