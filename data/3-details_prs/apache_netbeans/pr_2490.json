{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5NjU3NTE3", "number": 2490, "title": "[NETBEANS-3789] Fix missing artitact nodes in Gradle Project Configurations.", "bodyText": "Well, this one brings back the module dependencies under the configuration node in Gradle Projects.\nHalf of this PR allows the Gradle side of the tooling library debugged.\nThe GradleModuleFileCache21 is a bit odd ball here using NIO Path instead of File or File Objects, that might be reworked later, I just had it on hand from another project of mine.\nProbably this PR finishes my Gradle work for 12.2.", "createdAt": "2020-10-25T20:35:22Z", "url": "https://github.com/apache/netbeans/pull/2490", "merged": true, "mergeCommit": {"oid": "dd7e74b2e470346867b8c0ac205e82ecc59f31ea"}, "closed": true, "closedAt": "2020-10-26T22:41:52Z", "author": {"login": "lkishalmi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWMcDIAFqTUxNjQ1NzQ5Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWZxKvABqjM5MjI1MTY0Nzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NDU3NDky", "url": "https://github.com/apache/netbeans/pull/2490#pullrequestreview-516457492", "createdAt": "2020-10-26T04:06:52Z", "commit": {"oid": "1a9644c40677934a0a99da60f0bff461e49118bc"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNDowNjo1M1rOHoATHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNDoxMDoyNFrOHoAVsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcwOTk4MA==", "bodyText": "Isn't this an API? If so, I'd better be documented in arch.xml as <arch group=\"systemproperty\" stability=\"private\" .../>", "url": "https://github.com/apache/netbeans/pull/2490#discussion_r511709980", "createdAt": "2020-10-26T04:06:53Z", "author": {"login": "JaroslavTulach"}, "path": "extide/gradle/src/org/netbeans/modules/gradle/GradleProjectCache.java", "diffHunk": "@@ -88,6 +88,8 @@\n     private static AtomicLong timeInLoad = new AtomicLong();\n     private static AtomicInteger loadedProjects = new AtomicInteger();\n \n+    private static final boolean DEBUG_GRADLE_INFO_ACTION = Boolean.getBoolean(\"netbeans.debug.gradle.info.action\"); //NOI18N", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a9644c40677934a0a99da60f0bff461e49118bc"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcxMDQ2Mg==", "bodyText": "Is gradle_user_name also some kind of API as it is read elsewhere?", "url": "https://github.com/apache/netbeans/pull/2490#discussion_r511710462", "createdAt": "2020-10-26T04:09:35Z", "author": {"login": "JaroslavTulach"}, "path": "extide/gradle/netbeans-gradle-tooling/src/main/groovy/org/netbeans/modules/gradle/tooling/NbProjectInfoBuilder.groovy", "diffHunk": "@@ -99,6 +99,7 @@ class NbProjectInfoBuilder {\n         model.info.project_buildDir = project.buildDir;\n         model.info.project_projectDir = project.projectDir;\n         model.info.project_rootDir = project.rootDir;\n+        model.info.gradle_user_home = project.gradle.gradleUserHomeDir;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a9644c40677934a0a99da60f0bff461e49118bc"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcxMDY0MQ==", "bodyText": "Here the gradle_user_home value is read...", "url": "https://github.com/apache/netbeans/pull/2490#discussion_r511710641", "createdAt": "2020-10-26T04:10:24Z", "author": {"login": "JaroslavTulach"}, "path": "extide/gradle/src/org/netbeans/modules/gradle/api/GradleBaseProjectBuilder.java", "diffHunk": "@@ -125,6 +127,9 @@ void processTasks() {\n \n     void processDependencies() {\n \n+        File gradleUserHome = (File) info.get(\"gradle_user_home\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a9644c40677934a0a99da60f0bff461e49118bc"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NTMzNjI5", "url": "https://github.com/apache/netbeans/pull/2490#pullrequestreview-516533629", "createdAt": "2020-10-26T07:59:02Z", "commit": {"oid": "1a9644c40677934a0a99da60f0bff461e49118bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNzo1OTowMlrOHoEHAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNzo1OTowMlrOHoEHAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc3MjQxNw==", "bodyText": "Actually this is the primary fix. The transient data (I called that ext for whatever reason) shall be not cached to the disk, but when NetBeans process the project information it holds important data on binary, source and javadoc location which are stored in the GradleAtrifactStore. Returning an empty map when the project is not restored from serialization, made that these location data were never stored in the artifact store.", "url": "https://github.com/apache/netbeans/pull/2490#discussion_r511772417", "createdAt": "2020-10-26T07:59:02Z", "author": {"login": "lkishalmi"}, "path": "extide/gradle/src/org/netbeans/modules/gradle/cache/ProjectInfoDiskCache.java", "diffHunk": "@@ -83,7 +86,7 @@ public QualifiedProjectInfo(Quality quality, NbProjectInfo pinfo) {\n \n         @Override\n         public Map<String, Object> getExt() {\n-            return Collections.emptyMap();\n+            return ext != null ? ext : Collections.emptyMap();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a9644c40677934a0a99da60f0bff461e49118bc"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NTM1NDYx", "url": "https://github.com/apache/netbeans/pull/2490#pullrequestreview-516535461", "createdAt": "2020-10-26T08:02:14Z", "commit": {"oid": "1a9644c40677934a0a99da60f0bff461e49118bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwODowMjoxNFrOHoEMyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwODowMjoxNFrOHoEMyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc3Mzg5Ng==", "bodyText": "This makes the module dependency resolution more stable. If the ArtifactStore has no information on a module for whatever reason, NetBeans tries to resolve it using the Gradle Module Cache directory structure.", "url": "https://github.com/apache/netbeans/pull/2490#discussion_r511773896", "createdAt": "2020-10-26T08:02:14Z", "author": {"login": "lkishalmi"}, "path": "extide/gradle/src/org/netbeans/modules/gradle/api/GradleBaseProjectBuilder.java", "diffHunk": "@@ -242,6 +244,23 @@ void processDependencies() {\n         problems.addAll(unresolvedProblems.values());\n     }\n \n+    private ModuleDependency resolveModuleDependency(File gradleUserHome, String c) {\n+        GradleModuleFileCache21 moduleCache = GradleModuleFileCache21.getGradleFileCache(gradleUserHome.toPath());\n+        GradleModuleFileCache21.CachedArtifactVersion artVersion = moduleCache.resolveModule(c);\n+        Set<File> binaries = artifactSore.getBinaries(c);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a9644c40677934a0a99da60f0bff461e49118bc"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a9644c40677934a0a99da60f0bff461e49118bc", "author": {"user": {"login": "lkishalmi", "name": "Laszlo Kishalmi"}}, "url": "https://github.com/apache/netbeans/commit/1a9644c40677934a0a99da60f0bff461e49118bc", "committedDate": "2020-10-25T20:22:08Z", "message": "[NETBEANS-3789] Fix missing configuration nodes."}, "afterCommit": {"oid": "11165e5d43ce3f98e6c6c0eb3a57d43404b634bf", "author": {"user": {"login": "lkishalmi", "name": "Laszlo Kishalmi"}}, "url": "https://github.com/apache/netbeans/commit/11165e5d43ce3f98e6c6c0eb3a57d43404b634bf", "committedDate": "2020-10-26T16:02:46Z", "message": "[NETBEANS-3789] Fix missing configuration nodes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d192365b9b6499ae82add6467cc025fd5b37cbbc", "author": {"user": {"login": "lkishalmi", "name": "Laszlo Kishalmi"}}, "url": "https://github.com/apache/netbeans/commit/d192365b9b6499ae82add6467cc025fd5b37cbbc", "committedDate": "2020-10-26T19:44:20Z", "message": "[NETBEANS-3789] Fix missing configuration nodes."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "11165e5d43ce3f98e6c6c0eb3a57d43404b634bf", "author": {"user": {"login": "lkishalmi", "name": "Laszlo Kishalmi"}}, "url": "https://github.com/apache/netbeans/commit/11165e5d43ce3f98e6c6c0eb3a57d43404b634bf", "committedDate": "2020-10-26T16:02:46Z", "message": "[NETBEANS-3789] Fix missing configuration nodes."}, "afterCommit": {"oid": "d192365b9b6499ae82add6467cc025fd5b37cbbc", "author": {"user": {"login": "lkishalmi", "name": "Laszlo Kishalmi"}}, "url": "https://github.com/apache/netbeans/commit/d192365b9b6499ae82add6467cc025fd5b37cbbc", "committedDate": "2020-10-26T19:44:20Z", "message": "[NETBEANS-3789] Fix missing configuration nodes."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 505, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}