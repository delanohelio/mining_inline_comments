{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MzgwMjgy", "number": 2549, "title": "Initial VSNetBeans extension integration tests.", "bodyText": "Executing some VS Code extension integration tests. The execution of the first test failed - e.g. the travis gate correctly verifies the behavior of our extension.\nNext step is to initialize the extension and get its (programmatic) version: 9219db8 - that shall succeed.\nThe last test creates pom.xml and a .java source in a workspace and invokes its compilation. Then it checks the result. I guess that is enough for now and quite a bit of functionality is covered.\nThis was failing on the gate as the \"compile\" command was executed sooner than language client with its java.build.workspace action was really initialized. This should be fixed now. Please review.", "createdAt": "2020-11-20T03:21:05Z", "url": "https://github.com/apache/netbeans/pull/2549", "merged": true, "mergeCommit": {"oid": "eb4ee48877a29c6674bf760d5053799180a31beb"}, "closed": true, "closedAt": "2020-11-24T18:07:41Z", "author": {"login": "JaroslavTulach"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeasYJAFqTUzNTYyNzczNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdftAVjgFqTUzNzczNTQ3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NjI3NzM0", "url": "https://github.com/apache/netbeans/pull/2549#pullrequestreview-535627734", "createdAt": "2020-11-20T17:20:57Z", "commit": {"oid": "263da69b2f7e254b3a5ed52ca54e79612fda1c98"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNzoyMDo1OFrOH3Y-zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxNzoyMDo1OFrOH3Y-zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzg0MzAyMA==", "bodyText": "Can you help, @dbalek? I need to wait for the java.workspace.compile task to finish and just using await isn't enough.  Instead I have to setTimeout(_, 20s) and that isn't pretty at all.", "url": "https://github.com/apache/netbeans/pull/2549#discussion_r527843020", "createdAt": "2020-11-20T17:20:58Z", "author": {"login": "JaroslavTulach"}, "path": "java/java.lsp.server/vscode/src/test/suite/extension.test.ts", "diffHunk": "@@ -21,4 +28,56 @@ suite('Extension Test Suite', () => {\n \t\t}\n \t\tassert.ok(cannotReassignVersion, \"Cannot reassign value of version\");\n \t});\n+\ttest(\"Compile workspace\", async () => {\n+\t\tlet folder: string = assertWorkspace();\n+\n+\t\tfs.writeFileSync(path.join(folder, 'pom.xml'), `\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+    <modelVersion>4.0.0</modelVersion>\n+    <groupId>org.netbeans.demo.vscode.t1</groupId>\n+    <artifactId>basicapp</artifactId>\n+    <version>1.0</version>\n+    <properties>\n+        <maven.compiler.source>1.8</maven.compiler.source>\n+        <maven.compiler.target>1.8</maven.compiler.target>\n+    </properties>\n+</project>\n+\t\t`);\n+\n+\t\tlet pkg = path.join(folder, 'src', 'main', 'java', 'pkg');\n+\t\tlet mainJava = path.join(pkg, 'Main.java');\n+\n+\t\tfs.mkdirSync(pkg, { recursive: true });\n+\t\tfs.writeFileSync(mainJava, `\n+package pkg;\n+class Main {\n+\tpublic static void main(String... args) {\n+\t\tSystem.out.println(\"Hello World!\");\n+\t}\n+}\n+\t\t`);\n+\n+\t\tvscode.workspace.saveAll();\n+\n+\t\tlet delayPromise = new Promise((r) => setTimeout(r, 20000));\n+\t\tvscode.window.showInformationMessage('Invoking compile command');\n+\t\tawait vscode.commands.executeCommand(\"java.workspace.compile\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "263da69b2f7e254b3a5ed52ca54e79612fda1c98"}, "originalPosition": 57}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8cb17c8400a9775ad1aa227701ac62c42adf1eac", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/8cb17c8400a9775ad1aa227701ac62c42adf1eac", "committedDate": "2020-11-23T11:44:35Z", "message": "Prepare the userdir before running the tests"}, "afterCommit": {"oid": "62dd163fb5bd7fe7ce841603fad27bc41a1a5995", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/62dd163fb5bd7fe7ce841603fad27bc41a1a5995", "committedDate": "2020-11-23T12:05:47Z", "message": "Prepare parent of userdir before running the tests on node < 10.12"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "396635abd2838ef38c21d89b621dd6b81e135dcc", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/396635abd2838ef38c21d89b621dd6b81e135dcc", "committedDate": "2020-11-23T13:50:12Z", "message": "VS Code version 1.50 is using node.js version 12.x"}, "afterCommit": {"oid": "b15a2e04fb22ba4d5db46786ba0fe1d6c44476c0", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/b15a2e04fb22ba4d5db46786ba0fe1d6c44476c0", "committedDate": "2020-11-23T14:50:48Z", "message": "VS Code version 1.50 is using node.js version 12.x"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b15a2e04fb22ba4d5db46786ba0fe1d6c44476c0", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/b15a2e04fb22ba4d5db46786ba0fe1d6c44476c0", "committedDate": "2020-11-23T14:50:48Z", "message": "VS Code version 1.50 is using node.js version 12.x"}, "afterCommit": {"oid": "010c2db4bdff563bc5d877d14d86fd69ac166c57", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/010c2db4bdff563bc5d877d14d86fd69ac166c57", "committedDate": "2020-11-23T15:01:32Z", "message": "VS Code version 1.50 is using node.js version 12.x"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48412fe552788bb686ea7c20927239d21660a480", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/48412fe552788bb686ea7c20927239d21660a480", "committedDate": "2020-11-23T15:37:22Z", "message": "Debugging the compile workspace workload"}, "afterCommit": {"oid": "4d1f85a6c3515218376861a68770ab537c4c7473", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/4d1f85a6c3515218376861a68770ab537c4c7473", "committedDate": "2020-11-23T16:27:43Z", "message": "Debugging the compile workspace workload"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b0a398e57b0deab4e37cbb9f9dcf6bdbe36220d", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/0b0a398e57b0deab4e37cbb9f9dcf6bdbe36220d", "committedDate": "2020-11-24T05:44:12Z", "message": "Log asynchronous stacktraces"}, "afterCommit": {"oid": "041dd82f8f862bc7bcda98d87ee7857384807581", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/041dd82f8f862bc7bcda98d87ee7857384807581", "committedDate": "2020-11-24T06:24:29Z", "message": "Log asynchronous stacktraces"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "041dd82f8f862bc7bcda98d87ee7857384807581", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/041dd82f8f862bc7bcda98d87ee7857384807581", "committedDate": "2020-11-24T06:24:29Z", "message": "Log asynchronous stacktraces"}, "afterCommit": {"oid": "d5bee2a6e9ec927c38bf31f3de1fe9518c0ac558", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/d5bee2a6e9ec927c38bf31f3de1fe9518c0ac558", "committedDate": "2020-11-24T06:34:34Z", "message": "Log asynchronous stacktraces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "234392d4fc125d4e20a116598821b2cfd378dfc6", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/234392d4fc125d4e20a116598821b2cfd378dfc6", "committedDate": "2020-11-24T09:39:38Z", "message": "Use ant -f java/java.lsp.server test-vscode-ext to execute integration tests for VSNetBeans"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "923704569822d171c2cbfe861897d5b16ff4b99b", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/923704569822d171c2cbfe861897d5b16ff4b99b", "committedDate": "2020-11-24T09:41:55Z", "message": "Wait for LanguageClient to get started before running java.compile.workspace command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c7145c144b3b024f18f64fb7706c421ede4189b", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/1c7145c144b3b024f18f64fb7706c421ede4189b", "committedDate": "2020-11-24T09:43:16Z", "message": "Wait for build to be over before completing actions's CompletableFuture"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3dbed9d6b1f5855ce99cc227bff928568273b722", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/3dbed9d6b1f5855ce99cc227bff928568273b722", "committedDate": "2020-11-24T09:17:18Z", "message": "Wait for client to be started before executing the compile workspace action"}, "afterCommit": {"oid": "1c7145c144b3b024f18f64fb7706c421ede4189b", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/1c7145c144b3b024f18f64fb7706c421ede4189b", "committedDate": "2020-11-24T09:43:16Z", "message": "Wait for build to be over before completing actions's CompletableFuture"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NzM1NDc4", "url": "https://github.com/apache/netbeans/pull/2549#pullrequestreview-537735478", "createdAt": "2020-11-24T17:14:59Z", "commit": {"oid": "1c7145c144b3b024f18f64fb7706c421ede4189b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 347, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}