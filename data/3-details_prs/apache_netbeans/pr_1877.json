{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNjQ4Njk4", "number": 1877, "title": "[NETBEANS-3604]Supports for Records (JEP 359) in JDK-14\"", "bodyText": "Jira ref : https://issues.apache.org/jira/browse/NETBEANS-3604", "createdAt": "2020-01-16T13:35:43Z", "url": "https://github.com/apache/netbeans/pull/1877", "merged": true, "mergeCommit": {"oid": "ee208250c47cc95a60054550ebdcf31f5be533eb"}, "closed": true, "closedAt": "2020-01-19T08:58:41Z", "author": {"login": "singh-akhilesh"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbemcyzAH2gAyMzYzNjQ4Njk4OjhmYjYyZDljYWE4Nzg0ODVkYWE4MDc1OTczMGUxMjMyNjA3YzRiNGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7zTbBAH2gAyMzYzNjQ4Njk4OjFkMDVjZGUwZDJhODNiODQzN2ZjZmI1NThiOWEwOGJlMTM3NGUxYjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8fb62d9caa878485daa80759730e1232607c4b4c", "author": {"user": {"login": "jlahoda", "name": "Jan Lahoda"}}, "url": "https://github.com/apache/netbeans/commit/8fb62d9caa878485daa80759730e1232607c4b4c", "committedDate": "2019-10-20T14:40:30Z", "message": "Working on records support."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14be4a90605aec9ab19c91fdfcf42007626c9d63", "author": {"user": null}, "url": "https://github.com/apache/netbeans/commit/14be4a90605aec9ab19c91fdfcf42007626c9d63", "committedDate": "2020-01-08T07:10:04Z", "message": "Merge remote-tracking branch 'upstream1/jdk/amber/records'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27282a6ef6b33c71ef27df888ca102c36bf7756f", "author": {"user": {"login": "singh-akhilesh", "name": "Akhilesh Singh"}}, "url": "https://github.com/apache/netbeans/commit/27282a6ef6b33c71ef27df888ca102c36bf7756f", "committedDate": "2020-01-16T11:16:41Z", "message": "Merge remote-tracking branch 'upstream/master' into record-fix-br"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "403d4fb2ea1faeb5237553bc99f77b8b278185a3", "author": {"user": {"login": "singh-akhilesh", "name": "Akhilesh Singh"}}, "url": "https://github.com/apache/netbeans/commit/403d4fb2ea1faeb5237553bc99f77b8b278185a3", "committedDate": "2020-01-16T13:29:09Z", "message": "[NETBEANS-3604]Supports for Records (JEP 359) in JDK-14"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcdce1510e8c68deb020e322395bf07389dfd1b2", "author": {"user": {"login": "singh-akhilesh", "name": "Akhilesh Singh"}}, "url": "https://github.com/apache/netbeans/commit/bcdce1510e8c68deb020e322395bf07389dfd1b2", "committedDate": "2020-01-17T08:43:24Z", "message": "[NETBEANS-3604]Supports for Records (JEP 359) in JDK-14"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2a5f82640562ca604075278850ba93bbf5d9905", "author": {"user": {"login": "singh-akhilesh", "name": "Akhilesh Singh"}}, "url": "https://github.com/apache/netbeans/commit/a2a5f82640562ca604075278850ba93bbf5d9905", "committedDate": "2020-01-17T10:51:10Z", "message": "[NETBEANS-3604] : Sync-up with master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522", "author": {"user": {"login": "singh-akhilesh", "name": "Akhilesh Singh"}}, "url": "https://github.com/apache/netbeans/commit/2396970deba7ebeec57f785ee0049b96c9127522", "committedDate": "2020-01-17T11:12:13Z", "message": "Merge branch 'master' into record-fix-br"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NTE4ODg5", "url": "https://github.com/apache/netbeans/pull/1877#pullrequestreview-344518889", "createdAt": "2020-01-17T11:27:35Z", "commit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMToyNzozNVrOFe2Sxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMTozNjoxNVrOFe2e-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MTE0Mg==", "bodyText": "Unless this was tried already, and rejected for some reason, I would recommend to add Tree.Kind.RECORD into TreeUtilities.CLASS_TREE_KINDS. The purpose of that constant is to keep all kinds that map to ClassTree.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367891142", "createdAt": "2020-01-17T11:27:35Z", "author": {"login": "lahodaj"}, "path": "java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/Utilities.java", "diffHunk": "@@ -557,7 +557,7 @@ private static int findBodyStartImpl(CompilationInfo info, Tree cltree, Compilat\n     \n     public static int findBodyStart(final CompilationInfo info, final Tree cltree, final CompilationUnitTree cu, final SourcePositions positions, final Document doc) {\n         Kind kind = cltree.getKind();\n-        if (!TreeUtilities.CLASS_TREE_KINDS.contains(kind) && kind != Kind.METHOD)\n+        if (!TreeUtilities.CLASS_TREE_KINDS.contains(kind) && kind != Kind.METHOD && !cltree.getKind().toString().equals(\"RECORD\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MTY0MQ==", "bodyText": "There should be a SourceVersion check, or something along those lines, and the test case should be skipped if the current javac does not support records. Otherwise, the test will fail when running e.g. with nb-javac without records. (Dtto the other occurrence below.)", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367891641", "createdAt": "2020-01-17T11:28:54Z", "author": {"login": "lahodaj"}, "path": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/DetectorTest.java", "diffHunk": "@@ -508,6 +508,62 @@ public void testIncDecReading230408() throws Exception {\n         performTest(\"IncDecReading230408\");\n     }\n \n+    public void testRecord1() throws Exception {\n+        //TODO: check records are available, skip if they are not.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MTgwNw==", "bodyText": "Ideally, unnecessary changes should be undone.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367891807", "createdAt": "2020-01-17T11:29:21Z", "author": {"login": "lahodaj"}, "path": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/TestBase.java", "diffHunk": "@@ -35,6 +35,7 @@\n import java.util.Collection;\n import java.util.Comparator;\n import java.util.EnumSet;\n+import java.util.Iterator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MjMxNg==", "bodyText": "I wonder if the reflection should be separated into TreeShims. But this can wait.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367892316", "createdAt": "2020-01-17T11:30:43Z", "author": {"login": "lahodaj"}, "path": "java/java.editor/src/org/netbeans/modules/editor/java/GoToSupport.java", "diffHunk": "@@ -381,6 +385,35 @@ public static Context resolveContext(CompilationInfo controller, Document doc, i\n                             el = e;\n                         }\n                     }\n+                    if (el != null && el.getKind() == ElementKind.METHOD) {\n+                        for (Element peer : el.getEnclosingElement().getEnclosedElements()) {\n+                            if (peer.getKind().name().contains(\"RECORD_COMPONENT\")) {\n+                                try {\n+                                    Class<?> recordComponent = Class.forName(\"javax.lang.model.element.RecordComponentElement\", true, VariableTree.class.getClassLoader());\n+                                    Method getAccessor = recordComponent.getDeclaredMethod(\"getAccessor\");\n+                                    Method getRecordComponents = TypeElement.class.getDeclaredMethod(\"getRecordComponents\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MzA2Mw==", "bodyText": "Ideally comments like \"//To change...\" should be deleted.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367893063", "createdAt": "2020-01-17T11:32:53Z", "author": {"login": "lahodaj"}, "path": "java/java.editor/src/org/netbeans/modules/editor/java/GoToSupport.java", "diffHunk": "@@ -986,6 +1020,14 @@ public Void visitTypeParameter(TypeParameterElement e, Boolean highlightName) {\n             return null;\n         }\n         \n+        @Override\n+        public Void visitUnknown(Element e, Boolean p) {\n+            if (TreeShims.isRecordComponent(e)) {\n+                return visitVariable((VariableElement) e, p);\n+            }\n+            return super.visitUnknown(e, p); //To change body of generated methods, choose Tools | Templates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MzM1NA==", "bodyText": "This should be (presumably?) uncomentted. (Dtto the other occurrences below.)", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367893354", "createdAt": "2020-01-17T11:33:41Z", "author": {"login": "lahodaj"}, "path": "java/java.editor/test/unit/src/org/netbeans/modules/editor/java/GoToSupportTest.java", "diffHunk": "@@ -1282,4 +1297,223 @@ private static boolean hasPatterns() {\n             return false;\n         }\n     }\n+    \n+    public void testRecords1() throws Exception {\n+//        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5NDI2NQ==", "bodyText": "Can TreeShims.toRecordComponent be used here?", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367894265", "createdAt": "2020-01-17T11:36:15Z", "author": {"login": "lahodaj"}, "path": "java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/SemanticHighlighterBase.java", "diffHunk": "@@ -573,6 +582,27 @@ private void addModifiers(Element decl, Collection<ColoringAttributes> c) {\n             return null;\n         }\n \n+        private boolean isRecordComponent(ElementKind kind) {\n+            return \"RECORD_COMPONENT\".equals(kind.name());\n+        }\n+\n+        private Element toRecordComponent(Element el) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb7f0b8bed9f03301602da99540ef5f42b092660", "author": {"user": {"login": "singh-akhilesh", "name": "Akhilesh Singh"}}, "url": "https://github.com/apache/netbeans/commit/fb7f0b8bed9f03301602da99540ef5f42b092660", "committedDate": "2020-01-18T02:12:05Z", "message": "NETBEANS-3604 : Addressed code review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce6e89af4de546475086fb4445dcdeb923398fdc", "author": {"user": {"login": "jlahoda", "name": "Jan Lahoda"}}, "url": "https://github.com/apache/netbeans/commit/ce6e89af4de546475086fb4445dcdeb923398fdc", "committedDate": "2020-01-19T07:05:04Z", "message": "Fixing broken merge."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d05cde0d2a83b8437fcfb558b9a08be1374e1b2", "author": {"user": {"login": "jlahoda", "name": "Jan Lahoda"}}, "url": "https://github.com/apache/netbeans/commit/1d05cde0d2a83b8437fcfb558b9a08be1374e1b2", "committedDate": "2020-01-19T08:02:50Z", "message": "Fixing GoToSupportTest"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 276, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}