{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxOTUyMDEx", "number": 1991, "title": "[NETBEANS-3918] defer creation of target folder until/if needed", "bodyText": "Without this change, there is some directory creation in BasicPanelVisual.store, but that method is called in several situations where directory/DataFolder creation should not occur. This PR moves the creation code to TemplateWizard.getTargetFolder(), which defers the creation until needed. Unfortunately, with a breakpoint, I have not seen getTargetFolder() invoked when creating a maven project.\nThis PR is designed to preserve semantic; it is highly targeted and relatively simple. There may be better/simpler/more-direct fixes; but I am unfamiliar with the overall architecture; revset which introduced the spurious directory creation:\n    changeset:   301468:76d9cafcee35\n    branch:      ArchetypesUI268677\n    parent:      299970:0c5aa5cdb86a\n    user:        Jaroslav Tulach <jtulach@netbeans.org>\n    date:        Tue Oct 25 21:52:49 2016 +0200\n    summary:     #268677: Recognizing .archetype template files and using them to instantiate projects via mvn archetype\n\nThis simplest fix would be to simply remove the directory creation from BasicPanelVisual and not put it in getTargetFolder(). This would fix the cases I have seen; in those cases the directory is created by maven project instantiation and the data fold is not referenced. But this would not preserve semantics around TemplateWizard and DataFolder.\nThis PR also fixes [NETBEANS-3875] which is about failure of maven artifact creation.", "createdAt": "2020-02-29T22:29:56Z", "url": "https://github.com/apache/netbeans/pull/1991", "merged": true, "mergeCommit": {"oid": "6d97666eb492f45b88fc0ead9561d3a8995d8e2d"}, "closed": true, "closedAt": "2020-03-02T04:41:42Z", "author": {"login": "errael"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJLlzjgH2gAyMzgxOTUyMDExOjAyMzdmZWJmNDJjZWNlZWUzNjBkMGE5M2ZkNDc3MzczZmVlMjA2ZTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJSQItgFqTM2NjgzNTU0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0237febf42ceceee360d0a93fd477373fee206e9", "author": {"user": {"login": "errael", "name": "errael"}}, "url": "https://github.com/apache/netbeans/commit/0237febf42ceceee360d0a93fd477373fee206e9", "committedDate": "2020-02-29T21:41:39Z", "message": "[NETBEANS-3918] defer creation of target folder until/if needed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODM1NTQz", "url": "https://github.com/apache/netbeans/pull/1991#pullrequestreview-366835543", "createdAt": "2020-03-01T05:05:18Z", "commit": {"oid": "c4051d6f3fabf3ac6e69d483b71a172c42d95dbd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQwNTowNToxOFrOFwMTOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQwNToyNTozMVrOFwMWuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA3NzQ5OQ==", "bodyText": "The proposed property PROP_TARGET_FOLDR_HINT can hold any value, not just File. To prevent ClassCastException change this and next line to if (value instanceof File) { ... }.", "url": "https://github.com/apache/netbeans/pull/1991#discussion_r386077499", "createdAt": "2020-03-01T05:05:18Z", "author": {"login": "jtulach"}, "path": "platform/openide.loaders/src/org/openide/loaders/TemplateWizard.java", "diffHunk": "@@ -244,7 +252,14 @@ public DataFolder getTemplatesFolder () {\n     public DataFolder getTargetFolder () throws IOException {\n         LOG.log(Level.FINE, \"targetFolder={0} for {1}\", new Object[] {targetDataFolder, this});\n         if (targetDataFolder == null) {\n-            throw new IOException(NbBundle.getMessage(TemplateWizard.class, \"ERR_NoFilesystem\"));\n+            // Fix for [NETBEANS-3918] and [NETBEANS-3875]\n+            File targetFolderFile = (File) getProperty(PROP_TARGET_FOLDER_HINT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4051d6f3fabf3ac6e69d483b71a172c42d95dbd"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA3NzgyMQ==", "bodyText": "This would be an API change and as such it would need additional attributes of an API change. See the wiki page for overall description. Here is the enumeration of what I am missing the most:\n\nincrementing module version, using @since tag\nmodifying apichanges.xml\ntesting the change", "url": "https://github.com/apache/netbeans/pull/1991#discussion_r386077821", "createdAt": "2020-03-01T05:12:08Z", "author": {"login": "jtulach"}, "path": "platform/openide.loaders/src/org/openide/loaders/TemplateWizard.java", "diffHunk": "@@ -47,6 +48,13 @@\n * @see TemplateRegistration\n */\n public class TemplateWizard extends WizardDescriptor {\n+    /** Set to <CODE>File</CODE> to use for deferred creation of target folder.\n+     * If <CODE>TemplateWizard.getTargetFolder()</CODE> is called and the\n+     * the target folder has not been set then this property value is\n+     * used to create the directory and DataFolder. This allows deferral\n+     * of creation of DataFolder until and <em>if</em> it is needed.\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4051d6f3fabf3ac6e69d483b71a172c42d95dbd"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA3ODM5Mg==", "bodyText": "Please note that TemplateWizard hasn't yet been using java.io.File. This would be the first time and I am not happy about it as it limits the usage of TemplateWizard to local disk. Could you consider alternative solution? Could you introduce\npublic void setTargetFolder(Supplier<DataFolder> toBeCreatedFolder) {\n}\ne.g. give the code a chance to work with DataFolder and FileObject only, but delay creation of the actual folder as much as possible?", "url": "https://github.com/apache/netbeans/pull/1991#discussion_r386078392", "createdAt": "2020-03-01T05:25:31Z", "author": {"login": "jtulach"}, "path": "platform/openide.loaders/src/org/openide/loaders/TemplateWizard.java", "diffHunk": "@@ -244,7 +252,14 @@ public DataFolder getTemplatesFolder () {\n     public DataFolder getTargetFolder () throws IOException {\n         LOG.log(Level.FINE, \"targetFolder={0} for {1}\", new Object[] {targetDataFolder, this});\n         if (targetDataFolder == null) {\n-            throw new IOException(NbBundle.getMessage(TemplateWizard.class, \"ERR_NoFilesystem\"));\n+            // Fix for [NETBEANS-3918] and [NETBEANS-3875]\n+            File targetFolderFile = (File) getProperty(PROP_TARGET_FOLDER_HINT);\n+            if(targetFolderFile != null) {\n+                targetFolderFile.mkdirs();\n+                setTargetFolder(DataFolder.findFolder(FileUtil.toFileObject(targetFolderFile)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4051d6f3fabf3ac6e69d483b71a172c42d95dbd"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 218, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}