{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4OTU4MjMx", "number": 2480, "title": "Search for JDK in typical location", "bodyText": "It all started with a bug report: Java Language Server ignores JAVA_HOME environment variable. Then it continued with a discussion and the conclusion was made to mimic behavior of the existing VSCode Java extension. E.g. to search locations:\n\nnetbeans.jdkhome setting (workspace then user settings)\njava.home setting (workspace then user settings)\nJDK_HOME environment variable\nJAVA_HOME environment variable\ncurrent system path\n\nnetbeans.jdkhome is checked to give the user chance to exactly specify JDK just for NbCode. Other locations are checked for compatibility reasons.\nAs soon as netbeans.jdkhome or  java.home settings are set the NbCode Java part is restarted.", "createdAt": "2020-10-23T13:13:52Z", "url": "https://github.com/apache/netbeans/pull/2480", "merged": true, "mergeCommit": {"oid": "a8dbed122ec002bfd8d2c0cc0620be370f2f198c"}, "closed": true, "closedAt": "2020-10-25T06:42:17Z", "author": {"login": "JaroslavTulach"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVVKUFgH2gAyNTA4OTU4MjMxOmUzZDBkYzZjZWZjNmM0MTg1Njg2N2E2M2NhNmM0ZGJkNmUxY2IzMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVkQqxAFqTUxNjE2MDgzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e3d0dc6cefc6c41856867a63ca6c4dbd6e1cb322", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/e3d0dc6cefc6c41856867a63ca6c4dbd6e1cb322", "committedDate": "2020-10-23T11:48:55Z", "message": "Applying typescript hints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69af7491fae42e876de0cb068d85e2886d1eebf7", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/69af7491fae42e876de0cb068d85e2886d1eebf7", "committedDate": "2020-10-23T13:10:02Z", "message": "Search for JDK in typical location"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a41a4906084a17d178a7658146d53ab76c00e721", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/a41a4906084a17d178a7658146d53ab76c00e721", "committedDate": "2020-10-23T13:22:15Z", "message": "Start the LanguageClient just once"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1NzIxMjk3", "url": "https://github.com/apache/netbeans/pull/2480#pullrequestreview-515721297", "createdAt": "2020-10-23T14:29:39Z", "commit": {"oid": "a41a4906084a17d178a7658146d53ab76c00e721"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNDoyOTozOVrOHnQV6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNDoyOTozOVrOHnQV6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDkyNDI2Ng==", "bodyText": "I would rather check on full property name: java.home and netbeans.jdkhome...", "url": "https://github.com/apache/netbeans/pull/2480#discussion_r510924266", "createdAt": "2020-10-23T14:29:39Z", "author": {"login": "Ondrej-Douda"}, "path": "java/java.lsp.server/vscode/src/extension.ts", "diffHunk": "@@ -65,33 +65,112 @@ function findClusters(myPath : string): string[] {\n     return clusters;\n }\n \n-export function activate(context: ExtensionContext) {\n-    //verify acceptable JDK is available/set:\n-    let specifiedJDK = workspace.getConfiguration('netbeans').get('jdkhome');\n-    const beVerbose : boolean = workspace.getConfiguration('netbeans').get('verbose', false);\n-    let info = {\n-        clusters : findClusters(context.extensionPath),\n-        extensionPath: context.extensionPath,\n-        storagePath : context.globalStoragePath,\n-        jdkHome : specifiedJDK,\n-        verbose: beVerbose\n-    };\n-    \n-    let log = vscode.window.createOutputChannel(\"Java Language Server\");\n+function findJDK(onChange: (path : string | null) => void): void {\n+    function find(): string | null {\n+        let nbJdk = workspace.getConfiguration('netbeans').get('jdkhome');\n+        if (nbJdk) {\n+            return nbJdk as string;\n+        }\n+        let javahome = workspace.getConfiguration('java').get('home');\n+        if (javahome) {\n+            return javahome as string;\n+        }\n \n-    vscode.extensions.all.forEach((e, index) => {\n+        let jdkHome: any = process.env.JDK_HOME;\n+        if (jdkHome) {\n+            return jdkHome as string;\n+        }\n+        let jHome: any = process.env.JAVA_HOME;\n+        if (jHome) {\n+            return jHome as string;\n+        }\n+        return null;\n+    }\n+\n+    let currentJdk = find();\n+    workspace.onDidChangeConfiguration(params => {\n+        if (!params.affectsConfiguration('java') && !params.affectsConfiguration('netbeans')) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a41a4906084a17d178a7658146d53ab76c00e721"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1NzIzMTM0", "url": "https://github.com/apache/netbeans/pull/2480#pullrequestreview-515723134", "createdAt": "2020-10-23T14:31:30Z", "commit": {"oid": "a41a4906084a17d178a7658146d53ab76c00e721"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNDozMTozMFrOHnQayg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNDozMTozMFrOHnQayg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDkyNTUxNA==", "bodyText": "This asks for vscode.extensions.getExtension('redhat.java') !== undefined...", "url": "https://github.com/apache/netbeans/pull/2480#discussion_r510925514", "createdAt": "2020-10-23T14:31:30Z", "author": {"login": "Ondrej-Douda"}, "path": "java/java.lsp.server/vscode/src/extension.ts", "diffHunk": "@@ -65,33 +65,112 @@ function findClusters(myPath : string): string[] {\n     return clusters;\n }\n \n-export function activate(context: ExtensionContext) {\n-    //verify acceptable JDK is available/set:\n-    let specifiedJDK = workspace.getConfiguration('netbeans').get('jdkhome');\n-    const beVerbose : boolean = workspace.getConfiguration('netbeans').get('verbose', false);\n-    let info = {\n-        clusters : findClusters(context.extensionPath),\n-        extensionPath: context.extensionPath,\n-        storagePath : context.globalStoragePath,\n-        jdkHome : specifiedJDK,\n-        verbose: beVerbose\n-    };\n-    \n-    let log = vscode.window.createOutputChannel(\"Java Language Server\");\n+function findJDK(onChange: (path : string | null) => void): void {\n+    function find(): string | null {\n+        let nbJdk = workspace.getConfiguration('netbeans').get('jdkhome');\n+        if (nbJdk) {\n+            return nbJdk as string;\n+        }\n+        let javahome = workspace.getConfiguration('java').get('home');\n+        if (javahome) {\n+            return javahome as string;\n+        }\n \n-    vscode.extensions.all.forEach((e, index) => {\n+        let jdkHome: any = process.env.JDK_HOME;\n+        if (jdkHome) {\n+            return jdkHome as string;\n+        }\n+        let jHome: any = process.env.JAVA_HOME;\n+        if (jHome) {\n+            return jHome as string;\n+        }\n+        return null;\n+    }\n+\n+    let currentJdk = find();\n+    workspace.onDidChangeConfiguration(params => {\n+        if (!params.affectsConfiguration('java') && !params.affectsConfiguration('netbeans')) {\n+            return;\n+        }\n+        let newJdk = find();\n+        if (newJdk !== currentJdk) {\n+            onChange(newJdk);\n+        }\n+    });\n+    onChange(currentJdk);\n+}\n+\n+export function activate(context: ExtensionContext) {\n+    vscode.extensions.all.forEach((e) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a41a4906084a17d178a7658146d53ab76c00e721"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb591a879ad742cc8d0cedcf977eda9a89746279", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/bb591a879ad742cc8d0cedcf977eda9a89746279", "committedDate": "2020-10-23T14:38:57Z", "message": "Consistently using: Apache Netbeans Language Server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e38771f24ab1926a6718f559204cd47a1e137996", "author": {"user": {"login": "JaroslavTulach", "name": "Jaroslav Tulach"}}, "url": "https://github.com/apache/netbeans/commit/e38771f24ab1926a6718f559204cd47a1e137996", "committedDate": "2020-10-23T16:53:12Z", "message": "Only set the workspace setting when workspace.name is defined"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1ODk4NTYy", "url": "https://github.com/apache/netbeans/pull/2480#pullrequestreview-515898562", "createdAt": "2020-10-23T18:13:44Z", "commit": {"oid": "e38771f24ab1926a6718f559204cd47a1e137996"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1OTk5ODE1", "url": "https://github.com/apache/netbeans/pull/2480#pullrequestreview-515999815", "createdAt": "2020-10-23T20:45:24Z", "commit": {"oid": "e38771f24ab1926a6718f559204cd47a1e137996"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MTYwODM3", "url": "https://github.com/apache/netbeans/pull/2480#pullrequestreview-516160837", "createdAt": "2020-10-24T05:24:26Z", "commit": {"oid": "e38771f24ab1926a6718f559204cd47a1e137996"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 497, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}