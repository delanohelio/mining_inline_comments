{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NjI4MDgy", "number": 2139, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQyMTo1MToxNFrOD9BnjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQyMTo1MjozNFrOD9Bohw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MzE2MjM3OnYy", "diffSide": "RIGHT", "path": "ide/editor.fold.nbui/src/org/netbeans/modules/editor/fold/ui/FoldViewFactory.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQyMTo1MToxNFrOGWUzoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQwNTo0MDo1OFrOGWYYoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA2Mjc1Mg==", "bodyText": "Should this variable perhaps be called \"changeToCollapsed\" rather than \"changedToCollapsed\"?\nAlso, why keep this variable at all--why not just do \"collapsedFoldEncountered = true\" instead?", "url": "https://github.com/apache/netbeans/pull/2139#discussion_r426062752", "createdAt": "2020-05-15T21:51:14Z", "author": {"login": "eirikbakke"}, "path": "ide/editor.fold.nbui/src/org/netbeans/modules/editor/fold/ui/FoldViewFactory.java", "diffHunk": "@@ -260,24 +260,25 @@ public void finishCreation() {\n \n     @Override\n     public void foldHierarchyChanged(FoldHierarchyEvent evt) {\n-        if (!collapsedFoldEncountered) {\n-            // Check if any collapsed fold was added or a collapsed/expanded state changed\n-            for (int i = evt.getAddedFoldCount() - 1; i >= 0; i--) {\n-                if (evt.getAddedFold(i).isCollapsed()) {\n-                    collapsedFoldEncountered = true;\n-                    break;\n-                }\n+        boolean collapsedAdded = false;\n+        boolean changedToCollapsed = false;\n+        // Check if any collapsed fold was added or a collapsed/expanded state changed\n+        for (int i = evt.getAddedFoldCount() - 1; i >= 0; i--) {\n+            if (evt.getAddedFold(i).isCollapsed()) {\n+                collapsedAdded = true;\n+                break;\n             }\n-            if (!collapsedFoldEncountered) {\n-                for (int i = evt.getFoldStateChangeCount() - 1; i >= 0; i--) {\n-                    FoldStateChange foldStateChange = evt.getFoldStateChange(i);\n-                    if (foldStateChange.isCollapsedChanged() && foldStateChange.getFold().isCollapsed()) {\n-                        collapsedFoldEncountered = true;\n-                        break;\n-                    }\n+        }\n+        if (!collapsedAdded) {\n+            for (int i = evt.getFoldStateChangeCount() - 1; i >= 0; i--) {\n+                FoldStateChange foldStateChange = evt.getFoldStateChange(i);\n+                if (foldStateChange.isCollapsedChanged() && foldStateChange.getFold().isCollapsed()) {\n+                    changedToCollapsed = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39f56ef4b49b26bb77d3c0b7ab3a025aa4f6df04"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyMDQzNw==", "bodyText": "strictly speaking, the folds have been already changed when this event is inspected :) Or is the extra 'd' some typo/grammar-like error ?\nI like more to update the shared variable from a single assignment; does the suggestion bring some objective improvement, or is it rather a personal taste ?", "url": "https://github.com/apache/netbeans/pull/2139#discussion_r426120437", "createdAt": "2020-05-16T05:25:06Z", "author": {"login": "sdedic"}, "path": "ide/editor.fold.nbui/src/org/netbeans/modules/editor/fold/ui/FoldViewFactory.java", "diffHunk": "@@ -260,24 +260,25 @@ public void finishCreation() {\n \n     @Override\n     public void foldHierarchyChanged(FoldHierarchyEvent evt) {\n-        if (!collapsedFoldEncountered) {\n-            // Check if any collapsed fold was added or a collapsed/expanded state changed\n-            for (int i = evt.getAddedFoldCount() - 1; i >= 0; i--) {\n-                if (evt.getAddedFold(i).isCollapsed()) {\n-                    collapsedFoldEncountered = true;\n-                    break;\n-                }\n+        boolean collapsedAdded = false;\n+        boolean changedToCollapsed = false;\n+        // Check if any collapsed fold was added or a collapsed/expanded state changed\n+        for (int i = evt.getAddedFoldCount() - 1; i >= 0; i--) {\n+            if (evt.getAddedFold(i).isCollapsed()) {\n+                collapsedAdded = true;\n+                break;\n             }\n-            if (!collapsedFoldEncountered) {\n-                for (int i = evt.getFoldStateChangeCount() - 1; i >= 0; i--) {\n-                    FoldStateChange foldStateChange = evt.getFoldStateChange(i);\n-                    if (foldStateChange.isCollapsedChanged() && foldStateChange.getFold().isCollapsed()) {\n-                        collapsedFoldEncountered = true;\n-                        break;\n-                    }\n+        }\n+        if (!collapsedAdded) {\n+            for (int i = evt.getFoldStateChangeCount() - 1; i >= 0; i--) {\n+                FoldStateChange foldStateChange = evt.getFoldStateChange(i);\n+                if (foldStateChange.isCollapsedChanged() && foldStateChange.getFold().isCollapsed()) {\n+                    changedToCollapsed = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA2Mjc1Mg=="}, "originalCommit": {"oid": "39f56ef4b49b26bb77d3c0b7ab3a025aa4f6df04"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyMTM3Ng==", "bodyText": "Oh, I see, it's not just that there has been a change to a collapsed fold, but that it has been changed from not collapsed to collapsed. Your name makes sense now.\nIt's fine as it stands.", "url": "https://github.com/apache/netbeans/pull/2139#discussion_r426121376", "createdAt": "2020-05-16T05:40:58Z", "author": {"login": "eirikbakke"}, "path": "ide/editor.fold.nbui/src/org/netbeans/modules/editor/fold/ui/FoldViewFactory.java", "diffHunk": "@@ -260,24 +260,25 @@ public void finishCreation() {\n \n     @Override\n     public void foldHierarchyChanged(FoldHierarchyEvent evt) {\n-        if (!collapsedFoldEncountered) {\n-            // Check if any collapsed fold was added or a collapsed/expanded state changed\n-            for (int i = evt.getAddedFoldCount() - 1; i >= 0; i--) {\n-                if (evt.getAddedFold(i).isCollapsed()) {\n-                    collapsedFoldEncountered = true;\n-                    break;\n-                }\n+        boolean collapsedAdded = false;\n+        boolean changedToCollapsed = false;\n+        // Check if any collapsed fold was added or a collapsed/expanded state changed\n+        for (int i = evt.getAddedFoldCount() - 1; i >= 0; i--) {\n+            if (evt.getAddedFold(i).isCollapsed()) {\n+                collapsedAdded = true;\n+                break;\n             }\n-            if (!collapsedFoldEncountered) {\n-                for (int i = evt.getFoldStateChangeCount() - 1; i >= 0; i--) {\n-                    FoldStateChange foldStateChange = evt.getFoldStateChange(i);\n-                    if (foldStateChange.isCollapsedChanged() && foldStateChange.getFold().isCollapsed()) {\n-                        collapsedFoldEncountered = true;\n-                        break;\n-                    }\n+        }\n+        if (!collapsedAdded) {\n+            for (int i = evt.getFoldStateChangeCount() - 1; i >= 0; i--) {\n+                FoldStateChange foldStateChange = evt.getFoldStateChange(i);\n+                if (foldStateChange.isCollapsedChanged() && foldStateChange.getFold().isCollapsed()) {\n+                    changedToCollapsed = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA2Mjc1Mg=="}, "originalCommit": {"oid": "39f56ef4b49b26bb77d3c0b7ab3a025aa4f6df04"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MzE2NDg3OnYy", "diffSide": "RIGHT", "path": "ide/editor.fold.nbui/src/org/netbeans/modules/editor/fold/ui/FoldViewFactory.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQyMTo1MjozNFrOGWU1Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQwNTo0MzowN1rOGWYZMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA2MzE0Ng==", "bodyText": "Would be good to add a comment here referencing the bug that is fixed by doing updateRetainsVisibleOnce only in the collapsedAdded case, and why this fixes the bug.", "url": "https://github.com/apache/netbeans/pull/2139#discussion_r426063146", "createdAt": "2020-05-15T21:52:34Z", "author": {"login": "eirikbakke"}, "path": "ide/editor.fold.nbui/src/org/netbeans/modules/editor/fold/ui/FoldViewFactory.java", "diffHunk": "@@ -289,7 +290,9 @@ public void foldHierarchyChanged(FoldHierarchyEvent evt) {\n                 ViewUtils.log(CHANGE_LOG, \"CHANGE in FoldViewFactory: <\" + // NOI18N\n                         startOffset + \",\" + endOffset + \">\\n\"); // NOI18N\n             }\n-            comp.putClientProperty(\"editorcaret.updateRetainsVisibleOnce\", Boolean.TRUE);\n+            if (collapsedAdded) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39f56ef4b49b26bb77d3c0b7ab3a025aa4f6df04"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyMDIzNg==", "bodyText": "Usually that's why the commit message references a JIRA issue; for more context. But will leave a short comment here.", "url": "https://github.com/apache/netbeans/pull/2139#discussion_r426120236", "createdAt": "2020-05-16T05:21:40Z", "author": {"login": "sdedic"}, "path": "ide/editor.fold.nbui/src/org/netbeans/modules/editor/fold/ui/FoldViewFactory.java", "diffHunk": "@@ -289,7 +290,9 @@ public void foldHierarchyChanged(FoldHierarchyEvent evt) {\n                 ViewUtils.log(CHANGE_LOG, \"CHANGE in FoldViewFactory: <\" + // NOI18N\n                         startOffset + \",\" + endOffset + \">\\n\"); // NOI18N\n             }\n-            comp.putClientProperty(\"editorcaret.updateRetainsVisibleOnce\", Boolean.TRUE);\n+            if (collapsedAdded) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA2MzE0Ng=="}, "originalCommit": {"oid": "39f56ef4b49b26bb77d3c0b7ab3a025aa4f6df04"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjEyMTUyMQ==", "bodyText": "The principle I like to follow is that the the code should be readable without doing a \"git blame\" on it, and ideally without reading the JIRA description either (though the comment can certainly be short).", "url": "https://github.com/apache/netbeans/pull/2139#discussion_r426121521", "createdAt": "2020-05-16T05:43:07Z", "author": {"login": "eirikbakke"}, "path": "ide/editor.fold.nbui/src/org/netbeans/modules/editor/fold/ui/FoldViewFactory.java", "diffHunk": "@@ -289,7 +290,9 @@ public void foldHierarchyChanged(FoldHierarchyEvent evt) {\n                 ViewUtils.log(CHANGE_LOG, \"CHANGE in FoldViewFactory: <\" + // NOI18N\n                         startOffset + \",\" + endOffset + \">\\n\"); // NOI18N\n             }\n-            comp.putClientProperty(\"editorcaret.updateRetainsVisibleOnce\", Boolean.TRUE);\n+            if (collapsedAdded) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA2MzE0Ng=="}, "originalCommit": {"oid": "39f56ef4b49b26bb77d3c0b7ab3a025aa4f6df04"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 538, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}