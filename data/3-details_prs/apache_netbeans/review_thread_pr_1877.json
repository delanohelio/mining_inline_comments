{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNjQ4Njk4", "number": 1877, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMToyNzozNVrODYyjBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMTozNjoxNVrODYyqwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MzIwNTgxOnYy", "diffSide": "RIGHT", "path": "java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/Utilities.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMToyNzozNVrOFe2Sxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxNjo1ODoyNVrOFfLZJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MTE0Mg==", "bodyText": "Unless this was tried already, and rejected for some reason, I would recommend to add Tree.Kind.RECORD into TreeUtilities.CLASS_TREE_KINDS. The purpose of that constant is to keep all kinds that map to ClassTree.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367891142", "createdAt": "2020-01-17T11:27:35Z", "author": {"login": "lahodaj"}, "path": "java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/Utilities.java", "diffHunk": "@@ -557,7 +557,7 @@ private static int findBodyStartImpl(CompilationInfo info, Tree cltree, Compilat\n     \n     public static int findBodyStart(final CompilationInfo info, final Tree cltree, final CompilationUnitTree cu, final SourcePositions positions, final Document doc) {\n         Kind kind = cltree.getKind();\n-        if (!TreeUtilities.CLASS_TREE_KINDS.contains(kind) && kind != Kind.METHOD)\n+        if (!TreeUtilities.CLASS_TREE_KINDS.contains(kind) && kind != Kind.METHOD && !cltree.getKind().toString().equals(\"RECORD\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzNjgzOQ==", "bodyText": "Tree.Kind.RECORD is a final Enumset, So adding RECORD here as a preview feature would result a compilation failure for the versions below 14.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r368236839", "createdAt": "2020-01-18T16:58:25Z", "author": {"login": "singh-akhilesh"}, "path": "java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/Utilities.java", "diffHunk": "@@ -557,7 +557,7 @@ private static int findBodyStartImpl(CompilationInfo info, Tree cltree, Compilat\n     \n     public static int findBodyStart(final CompilationInfo info, final Tree cltree, final CompilationUnitTree cu, final SourcePositions positions, final Document doc) {\n         Kind kind = cltree.getKind();\n-        if (!TreeUtilities.CLASS_TREE_KINDS.contains(kind) && kind != Kind.METHOD)\n+        if (!TreeUtilities.CLASS_TREE_KINDS.contains(kind) && kind != Kind.METHOD && !cltree.getKind().toString().equals(\"RECORD\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MTE0Mg=="}, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MzIwODk5OnYy", "diffSide": "RIGHT", "path": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/DetectorTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMToyODo1NFrOFe2UuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxNjo0OToxNVrOFfLXPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MTY0MQ==", "bodyText": "There should be a SourceVersion check, or something along those lines, and the test case should be skipped if the current javac does not support records. Otherwise, the test will fail when running e.g. with nb-javac without records. (Dtto the other occurrence below.)", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367891641", "createdAt": "2020-01-17T11:28:54Z", "author": {"login": "lahodaj"}, "path": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/DetectorTest.java", "diffHunk": "@@ -508,6 +508,62 @@ public void testIncDecReading230408() throws Exception {\n         performTest(\"IncDecReading230408\");\n     }\n \n+    public void testRecord1() throws Exception {\n+        //TODO: check records are available, skip if they are not.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzNjM1MQ==", "bodyText": "Comment addressed.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r368236351", "createdAt": "2020-01-18T16:49:15Z", "author": {"login": "singh-akhilesh"}, "path": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/DetectorTest.java", "diffHunk": "@@ -508,6 +508,62 @@ public void testIncDecReading230408() throws Exception {\n         performTest(\"IncDecReading230408\");\n     }\n \n+    public void testRecord1() throws Exception {\n+        //TODO: check records are available, skip if they are not.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MTY0MQ=="}, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MzIwOTg2OnYy", "diffSide": "RIGHT", "path": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/TestBase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMToyOToyMVrOFe2VXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxNjo0OTozMVrOFfLXSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MTgwNw==", "bodyText": "Ideally, unnecessary changes should be undone.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367891807", "createdAt": "2020-01-17T11:29:21Z", "author": {"login": "lahodaj"}, "path": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/TestBase.java", "diffHunk": "@@ -35,6 +35,7 @@\n import java.util.Collection;\n import java.util.Comparator;\n import java.util.EnumSet;\n+import java.util.Iterator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzNjM2Mg==", "bodyText": "Comment addressed.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r368236362", "createdAt": "2020-01-18T16:49:31Z", "author": {"login": "singh-akhilesh"}, "path": "java/java.editor.base/test/unit/src/org/netbeans/modules/java/editor/base/semantic/TestBase.java", "diffHunk": "@@ -35,6 +35,7 @@\n import java.util.Collection;\n import java.util.Comparator;\n import java.util.EnumSet;\n+import java.util.Iterator;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MTgwNw=="}, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MzIxMzAxOnYy", "diffSide": "RIGHT", "path": "java/java.editor/src/org/netbeans/modules/editor/java/GoToSupport.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMTozMDo0M1rOFe2XXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxNjo1MTowNFrOFfLXqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MjMxNg==", "bodyText": "I wonder if the reflection should be separated into TreeShims. But this can wait.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367892316", "createdAt": "2020-01-17T11:30:43Z", "author": {"login": "lahodaj"}, "path": "java/java.editor/src/org/netbeans/modules/editor/java/GoToSupport.java", "diffHunk": "@@ -381,6 +385,35 @@ public static Context resolveContext(CompilationInfo controller, Document doc, i\n                             el = e;\n                         }\n                     }\n+                    if (el != null && el.getKind() == ElementKind.METHOD) {\n+                        for (Element peer : el.getEnclosingElement().getEnclosedElements()) {\n+                            if (peer.getKind().name().contains(\"RECORD_COMPONENT\")) {\n+                                try {\n+                                    Class<?> recordComponent = Class.forName(\"javax.lang.model.element.RecordComponentElement\", true, VariableTree.class.getClassLoader());\n+                                    Method getAccessor = recordComponent.getDeclaredMethod(\"getAccessor\");\n+                                    Method getRecordComponents = TypeElement.class.getDeclaredMethod(\"getRecordComponents\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzNjQ1Nw==", "bodyText": "It would be good if we wait and fix this at later stage.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r368236457", "createdAt": "2020-01-18T16:51:04Z", "author": {"login": "singh-akhilesh"}, "path": "java/java.editor/src/org/netbeans/modules/editor/java/GoToSupport.java", "diffHunk": "@@ -381,6 +385,35 @@ public static Context resolveContext(CompilationInfo controller, Document doc, i\n                             el = e;\n                         }\n                     }\n+                    if (el != null && el.getKind() == ElementKind.METHOD) {\n+                        for (Element peer : el.getEnclosingElement().getEnclosedElements()) {\n+                            if (peer.getKind().name().contains(\"RECORD_COMPONENT\")) {\n+                                try {\n+                                    Class<?> recordComponent = Class.forName(\"javax.lang.model.element.RecordComponentElement\", true, VariableTree.class.getClassLoader());\n+                                    Method getAccessor = recordComponent.getDeclaredMethod(\"getAccessor\");\n+                                    Method getRecordComponents = TypeElement.class.getDeclaredMethod(\"getRecordComponents\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MjMxNg=="}, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MzIxNzUxOnYy", "diffSide": "RIGHT", "path": "java/java.editor/src/org/netbeans/modules/editor/java/GoToSupport.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMTozMjo1M1rOFe2aRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxNjo1MToxNVrOFfLXtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MzA2Mw==", "bodyText": "Ideally comments like \"//To change...\" should be deleted.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367893063", "createdAt": "2020-01-17T11:32:53Z", "author": {"login": "lahodaj"}, "path": "java/java.editor/src/org/netbeans/modules/editor/java/GoToSupport.java", "diffHunk": "@@ -986,6 +1020,14 @@ public Void visitTypeParameter(TypeParameterElement e, Boolean highlightName) {\n             return null;\n         }\n         \n+        @Override\n+        public Void visitUnknown(Element e, Boolean p) {\n+            if (TreeShims.isRecordComponent(e)) {\n+                return visitVariable((VariableElement) e, p);\n+            }\n+            return super.visitUnknown(e, p); //To change body of generated methods, choose Tools | Templates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzNjQ2OQ==", "bodyText": "Comment addressed.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r368236469", "createdAt": "2020-01-18T16:51:15Z", "author": {"login": "singh-akhilesh"}, "path": "java/java.editor/src/org/netbeans/modules/editor/java/GoToSupport.java", "diffHunk": "@@ -986,6 +1020,14 @@ public Void visitTypeParameter(TypeParameterElement e, Boolean highlightName) {\n             return null;\n         }\n         \n+        @Override\n+        public Void visitUnknown(Element e, Boolean p) {\n+            if (TreeShims.isRecordComponent(e)) {\n+                return visitVariable((VariableElement) e, p);\n+            }\n+            return super.visitUnknown(e, p); //To change body of generated methods, choose Tools | Templates.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MzA2Mw=="}, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MzIxOTMzOnYy", "diffSide": "RIGHT", "path": "java/java.editor/test/unit/src/org/netbeans/modules/editor/java/GoToSupportTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMTozMzo0MVrOFe2bag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxNjo1MToyM1rOFfLXwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MzM1NA==", "bodyText": "This should be (presumably?) uncomentted. (Dtto the other occurrences below.)", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367893354", "createdAt": "2020-01-17T11:33:41Z", "author": {"login": "lahodaj"}, "path": "java/java.editor/test/unit/src/org/netbeans/modules/editor/java/GoToSupportTest.java", "diffHunk": "@@ -1282,4 +1297,223 @@ private static boolean hasPatterns() {\n             return false;\n         }\n     }\n+    \n+    public void testRecords1() throws Exception {\n+//        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzNjQ4MA==", "bodyText": "Comment addressed.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r368236480", "createdAt": "2020-01-18T16:51:23Z", "author": {"login": "singh-akhilesh"}, "path": "java/java.editor/test/unit/src/org/netbeans/modules/editor/java/GoToSupportTest.java", "diffHunk": "@@ -1282,4 +1297,223 @@ private static boolean hasPatterns() {\n             return false;\n         }\n     }\n+    \n+    public void testRecords1() throws Exception {\n+//        try {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MzM1NA=="}, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3MzIyNTYxOnYy", "diffSide": "RIGHT", "path": "java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/SemanticHighlighterBase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMTozNjoxNVrOFe2e-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQxNjo1MTozNlrOFfLXzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5NDI2NQ==", "bodyText": "Can TreeShims.toRecordComponent be used here?", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r367894265", "createdAt": "2020-01-17T11:36:15Z", "author": {"login": "lahodaj"}, "path": "java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/SemanticHighlighterBase.java", "diffHunk": "@@ -573,6 +582,27 @@ private void addModifiers(Element decl, Collection<ColoringAttributes> c) {\n             return null;\n         }\n \n+        private boolean isRecordComponent(ElementKind kind) {\n+            return \"RECORD_COMPONENT\".equals(kind.name());\n+        }\n+\n+        private Element toRecordComponent(Element el) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzNjQ5NA==", "bodyText": "Comment addressed.", "url": "https://github.com/apache/netbeans/pull/1877#discussion_r368236494", "createdAt": "2020-01-18T16:51:36Z", "author": {"login": "singh-akhilesh"}, "path": "java/java.editor.base/src/org/netbeans/modules/java/editor/base/semantic/SemanticHighlighterBase.java", "diffHunk": "@@ -573,6 +582,27 @@ private void addModifiers(Element decl, Collection<ColoringAttributes> c) {\n             return null;\n         }\n \n+        private boolean isRecordComponent(ElementKind kind) {\n+            return \"RECORD_COMPONENT\".equals(kind.name());\n+        }\n+\n+        private Element toRecordComponent(Element el) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5NDI2NQ=="}, "originalCommit": {"oid": "2396970deba7ebeec57f785ee0049b96c9127522"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 719, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}