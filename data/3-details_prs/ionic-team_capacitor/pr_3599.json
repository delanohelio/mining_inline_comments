{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMjM1OTQw", "number": 3599, "title": "feat(cli): add `capacitor run` command", "bodyText": "TODO:\n\n iOS\n native-run installation instructions when not found\n more error handling\n\ncloses #3142\ndepends on #3565", "createdAt": "2020-09-22T22:56:51Z", "url": "https://github.com/ionic-team/capacitor/pull/3599", "merged": true, "mergeCommit": {"oid": "8576b0ff6a048981a07cab91135a0071b724e043"}, "closed": true, "closedAt": "2020-10-16T15:42:26Z", "author": {"login": "imhoffd"}, "timelineItems": {"totalCount": 42, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHUQD8gH2gAyNDkxMjM1OTQwOjhjM2QzZTA5NjVlN2Q4NGVlMTgyOTMzOGMxODBhODAxMjMzZTQzZmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTEkNZAH2gAyNDkxMjM1OTQwOjM4YmRiY2EwOGJhMTllMWRmMWM4Nzc4MGQwMjAxM2U1ZDFiZTgwOWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8c3d3e0965e7d84ee1829338c180a801233e43ff", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/8c3d3e0965e7d84ee1829338c180a801233e43ff", "committedDate": "2020-09-09T22:50:21Z", "message": "strip params from check functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2762d7fb5303665f1799e83b6cc8eee04839bfec", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/2762d7fb5303665f1799e83b6cc8eee04839bfec", "committedDate": "2020-09-09T23:19:29Z", "message": "resolveNode doesn't need config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca1510d5397d59810d67564688565b906801decf", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/ca1510d5397d59810d67564688565b906801decf", "committedDate": "2020-09-10T00:32:43Z", "message": "remove public config methods and unused properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "172f594ad35af59716ffaede3991323527596abe", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/172f594ad35af59716ffaede3991323527596abe", "committedDate": "2020-09-10T01:26:59Z", "message": "config refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5381669fcec5ab87cc3106f6f8b125fa9c73919e", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/5381669fcec5ab87cc3106f6f8b125fa9c73919e", "committedDate": "2020-09-10T01:41:23Z", "message": "readonly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8665579235e43bd4ba0cacaf8a58fc3d140fe1fd", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/8665579235e43bd4ba0cacaf8a58fc3d140fe1fd", "committedDate": "2020-09-10T01:52:17Z", "message": "bug fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2c4f92a58850736d4c74ddfe789da02ce805fb6", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/b2c4f92a58850736d4c74ddfe789da02ce805fb6", "committedDate": "2020-09-10T02:11:27Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b0f13af57b7ddd9d5347cf46edd88bd29525b4f", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/5b0f13af57b7ddd9d5347cf46edd88bd29525b4f", "committedDate": "2020-09-10T16:10:54Z", "message": "be more clear about resolving package.json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff836cba2144c86864e01e8ee87b36771653ea4b", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/ff836cba2144c86864e01e8ee87b36771653ea4b", "committedDate": "2020-09-14T22:07:18Z", "message": "Merge branch 'main' into config-refactor\n\nConflicts:\n\tcli/src/android/add.ts\n\tcli/src/android/common.ts\n\tcli/src/android/doctor.ts\n\tcli/src/android/open.ts\n\tcli/src/android/update.ts\n\tcli/src/common.ts\n\tcli/src/config.ts\n\tcli/src/cordova.ts\n\tcli/src/index.ts\n\tcli/src/ios/add.ts\n\tcli/src/ios/common.ts\n\tcli/src/ios/doctor.ts\n\tcli/src/ios/open.ts\n\tcli/src/ios/update.ts\n\tcli/src/plugin.ts\n\tcli/src/tasks/add.ts\n\tcli/src/tasks/copy.ts\n\tcli/src/tasks/create.ts\n\tcli/src/tasks/doctor.ts\n\tcli/src/tasks/init.ts\n\tcli/src/tasks/list.ts\n\tcli/src/tasks/new-plugin.ts\n\tcli/src/tasks/open.ts\n\tcli/src/tasks/serve.ts\n\tcli/src/tasks/sync.ts\n\tcli/src/tasks/update.ts\n\tcli/src/web/copy.ts\n\tcli/test/util.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9ee8be99c0d0e2bb19030da505b438573f79fd9", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/a9ee8be99c0d0e2bb19030da505b438573f79fd9", "committedDate": "2020-09-16T00:14:51Z", "message": "Merge branch 'main' into config-refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c04c10f9134a57a11d736bb27ac075b8622d08b7", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/c04c10f9134a57a11d736bb27ac075b8622d08b7", "committedDate": "2020-09-16T20:21:48Z", "message": "refactor platformDir"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6f3407e02c54dd1246b2fc8d2efc0de9b0ab6d3", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/b6f3407e02c54dd1246b2fc8d2efc0de9b0ab6d3", "committedDate": "2020-09-16T20:45:46Z", "message": "implement ios.path and android.path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16ce02cae9808249907030745c9aefc740db34ec", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/16ce02cae9808249907030745c9aefc740db34ec", "committedDate": "2020-09-17T21:46:06Z", "message": "Merge branch 'main' into config-refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "151a41f3b06e32c969fe5f54b48426f2432edad9", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/151a41f3b06e32c969fe5f54b48426f2432edad9", "committedDate": "2020-09-18T16:40:29Z", "message": "Update cli/src/config.ts\n\nCo-authored-by: jcesarmobile <jcesarmobile@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be4e89d5a07bb530de54878a893ffaf403d73636", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/be4e89d5a07bb530de54878a893ffaf403d73636", "committedDate": "2020-09-18T17:25:08Z", "message": "show plugin config last when adding it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cf2ac8f3e6b48cb6682e4770860a45e4478c089", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/8cf2ac8f3e6b48cb6682e4770860a45e4478c089", "committedDate": "2020-09-18T17:27:57Z", "message": "Merge branch 'main' into config-refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74b85beb2c1d207cf6e784aa56cdf7f82ed7e85a", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/74b85beb2c1d207cf6e784aa56cdf7f82ed7e85a", "committedDate": "2020-09-21T18:34:30Z", "message": "write plugin last (attempt 2 \ud83d\ude02)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "146907dcfef9236a0c4643f381c24c4336198797", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/146907dcfef9236a0c4643f381c24c4336198797", "committedDate": "2020-09-21T23:21:55Z", "message": "FS refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0e4d0956ab17927a6d7e65fd5659addd172e9ee", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/f0e4d0956ab17927a6d7e65fd5659addd172e9ee", "committedDate": "2020-09-22T16:26:27Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b2242c0d1633729ba7e893cef01e2c0b76419e2", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/2b2242c0d1633729ba7e893cef01e2c0b76419e2", "committedDate": "2020-09-22T16:35:03Z", "message": "Merge remote-tracking branch 'origin/main' into feat-2294\n\nConflicts:\n\tcli/src/android/update.ts\n\tcli/src/common.ts\n\tcli/src/config.ts\n\tcli/src/definitions.ts\n\tcli/src/ios/common.ts\n\tcli/src/tasks/add.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cf740de6fa35ab3b1a2f3bab48afd0996279cfc", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/9cf740de6fa35ab3b1a2f3bab48afd0996279cfc", "committedDate": "2020-09-22T21:19:20Z", "message": "Merge branch 'feat-2294' into run-command\n\nConflicts:\n\tcli/src/android/common.ts\n\tcli/src/android/doctor.ts\n\tcli/src/common.ts\n\tcli/src/config.ts\n\tcli/src/ios/common.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9801331d24e5ab65004c2ef3ac39e1939d0a7c06", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/9801331d24e5ab65004c2ef3ac39e1939d0a7c06", "committedDate": "2020-09-22T21:48:26Z", "message": "refactor runCommand to use subprocess lib"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "953e91b4da9c270b9cb1fe589188ef72c724f888", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/953e91b4da9c270b9cb1fe589188ef72c724f888", "committedDate": "2020-09-22T22:48:09Z", "message": "poc for android"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7865fca69dc61c4a608fbf80dfe4dcd6b339442", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/c7865fca69dc61c4a608fbf80dfe4dcd6b339442", "committedDate": "2020-09-22T22:50:41Z", "message": "test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d1f242f483d0e830416267d05876409e16225d9", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/6d1f242f483d0e830416267d05876409e16225d9", "committedDate": "2020-09-23T23:47:30Z", "message": "Merge remote-tracking branch 'origin/main' into run-command\n\nConflicts:\n\tcli/src/android/common.ts\n\tcli/src/android/doctor.ts\n\tcli/src/common.ts\n\tcli/src/ios/common.ts\n\tcli/src/ios/update.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9eeb26abfa75e64b3858ba6c377a59bfb41ff81c", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/9eeb26abfa75e64b3858ba6c377a59bfb41ff81c", "committedDate": "2020-09-28T22:21:56Z", "message": "target and list options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b35810297148cc368c83bf40717bcfa102d693db", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/b35810297148cc368c83bf40717bcfa102d693db", "committedDate": "2020-09-28T23:17:21Z", "message": "debug messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b189dc2df27ddedad9141fe1a926f138863b90e0", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/b189dc2df27ddedad9141fe1a926f138863b90e0", "committedDate": "2020-09-28T23:20:54Z", "message": "ignore DerivedData where builds are placed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4815bc1440825fe987f28a74dc3af57c6bb8866", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/a4815bc1440825fe987f28a74dc3af57c6bb8866", "committedDate": "2020-09-29T18:31:44Z", "message": "Merge branch 'main' into run-command\n\nConflicts:\n\tcli/src/common.ts\n\tcli/src/util/fs.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b276fe4fab5a3ac2145d57990cb16f2b96abe90", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/4b276fe4fab5a3ac2145d57990cb16f2b96abe90", "committedDate": "2020-09-29T22:20:16Z", "message": "native-run not installed error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8a8941e37f44ad1f9c2a628e65dd9c4e13fc10e", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/f8a8941e37f44ad1f9c2a628e65dd9c4e13fc10e", "committedDate": "2020-09-29T22:27:25Z", "message": "remove unused spinner option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ec1a27d6d355de8da22b587958a939f2cf231dd", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/8ec1a27d6d355de8da22b587958a939f2cf231dd", "committedDate": "2020-10-13T00:54:59Z", "message": "Merge branch 'main' into run-command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a67f8a166c7d64ebb3d5f2db3f0d7810c446081", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/7a67f8a166c7d64ebb3d5f2db3f0d7810c446081", "committedDate": "2020-10-13T01:44:24Z", "message": "fix lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "470434975ecf482449322246add6ebd58c9d7f56", "author": {"user": {"login": "jcesarmobile", "name": "jcesarmobile"}}, "url": "https://github.com/ionic-team/capacitor/commit/470434975ecf482449322246add6ebd58c9d7f56", "committedDate": "2020-10-14T13:33:13Z", "message": "Merge branch 'main' into run-command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07ae6798edf35b57f727c7f807aca31a12b3c85d", "author": {"user": {"login": "jcesarmobile", "name": "jcesarmobile"}}, "url": "https://github.com/ionic-team/capacitor/commit/07ae6798edf35b57f727c7f807aca31a12b3c85d", "committedDate": "2020-10-14T18:03:05Z", "message": "Merge branch 'main' into run-command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e00cd79e75d7397ff2e272b3c7efb2759505798a", "author": {"user": {"login": "jcesarmobile", "name": "jcesarmobile"}}, "url": "https://github.com/ionic-team/capacitor/commit/e00cd79e75d7397ff2e272b3c7efb2759505798a", "committedDate": "2020-10-15T16:43:47Z", "message": "Merge branch 'main' into run-command"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTc2NzEy", "url": "https://github.com/ionic-team/capacitor/pull/3599#pullrequestreview-509576712", "createdAt": "2020-10-15T16:46:58Z", "commit": {"oid": "e00cd79e75d7397ff2e272b3c7efb2759505798a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNjo0Njo1OFrOHiQ7BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNjo0Njo1OFrOHiQ7BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY5MDg4NQ==", "bodyText": "would be good to give some insight about native-run, install from where? or how?", "url": "https://github.com/ionic-team/capacitor/pull/3599#discussion_r505690885", "createdAt": "2020-10-15T16:46:58Z", "author": {"login": "jcesarmobile"}, "path": "cli/src/common.ts", "diffHunk": "@@ -292,28 +288,62 @@ export async function runPlatformHook(\n   });\n }\n \n-export function runCommand(command: string): Promise<string> {\n-  return new Promise((resolve, reject) => {\n-    exec(command, (error, stdout, stderr) => {\n-      if (error) {\n-        reject(stdout + stderr);\n-      } else {\n-        resolve(stdout);\n-      }\n-    });\n-  });\n+export interface RunCommandOptions {\n+  cwd?: string;\n+}\n+\n+export async function runCommand(\n+  command: string,\n+  args: readonly string[],\n+  options: RunCommandOptions = {},\n+): Promise<string> {\n+  const p = new Subprocess(command, args, options);\n+\n+  try {\n+    return await p.output();\n+  } catch (e) {\n+    if (e instanceof SubprocessError) {\n+      // old behavior of just throwing the stdout/stderr strings\n+      throw e.output ? e.output : e.code;\n+    }\n+\n+    throw e;\n+  }\n+}\n+\n+export async function runNativeRun(\n+  args: readonly string[],\n+  options: RunCommandOptions = {},\n+): Promise<string> {\n+  try {\n+    return await runCommand('native-run', args, options);\n+  } catch (e) {\n+    if (e === ERROR_COMMAND_NOT_FOUND) {\n+      logFatal(\n+        `${c.input('native-run')} not found in PATH\\n` +\n+          `Are you sure ${c.strong('native-run')} is installed?`,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00cd79e75d7397ff2e272b3c7efb2759505798a"}, "originalPosition": 164}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTc4MTQ0", "url": "https://github.com/ionic-team/capacitor/pull/3599#pullrequestreview-509578144", "createdAt": "2020-10-15T16:48:47Z", "commit": {"oid": "e00cd79e75d7397ff2e272b3c7efb2759505798a"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4304e17e185585006c485974cf51d12ed6ef03c7", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/4304e17e185585006c485974cf51d12ed6ef03c7", "committedDate": "2020-10-15T18:13:53Z", "message": "show example install command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b110df1d8793eeca45baaaae5084171f0385c9d", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/0b110df1d8793eeca45baaaae5084171f0385c9d", "committedDate": "2020-10-15T19:03:16Z", "message": "add native-run as dependency of CLI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwMzE4Mzg4", "url": "https://github.com/ionic-team/capacitor/pull/3599#pullrequestreview-510318388", "createdAt": "2020-10-16T09:47:29Z", "commit": {"oid": "0b110df1d8793eeca45baaaae5084171f0385c9d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38bdbca08ba19e1df1c87780d02013e5d1be809c", "author": {"user": {"login": "jcesarmobile", "name": "jcesarmobile"}}, "url": "https://github.com/ionic-team/capacitor/commit/38bdbca08ba19e1df1c87780d02013e5d1be809c", "committedDate": "2020-10-16T11:20:58Z", "message": "Merge branch 'main' into run-command"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1057, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}