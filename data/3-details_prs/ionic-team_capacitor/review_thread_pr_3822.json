{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNjMyNDc4", "number": 3822, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNTowOTowMFrOE64L2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzozOTo1MFrOE7KwVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTczNDAwOnYy", "diffSide": "RIGHT", "path": "android/capacitor/src/main/java/com/getcapacitor/annotation/Permission.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNTowOTowMFrOH2M9eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzo0Mzo0NFrOH2qTpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU5NzQ5Ng==", "bodyText": "Thoughts on pluralizing it now that it's an array?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String[] permission() default {};\n          \n          \n            \n                String[] permissions() default {};", "url": "https://github.com/ionic-team/capacitor/pull/3822#discussion_r526597496", "createdAt": "2020-11-19T05:09:00Z", "author": {"login": "imhoffd"}, "path": "android/capacitor/src/main/java/com/getcapacitor/annotation/Permission.java", "diffHunk": "@@ -9,11 +9,11 @@\n @Retention(RetentionPolicy.RUNTIME)\n public @interface Permission {\n     /**\n-     * The Android string for the permission.\n-     * Eg: Manifest.permission.ACCESS_COARSE_LOCATION\n-     *     or \"android.permission.ACCESS_COARSE_LOCATION\"\n+     * An array of Android permission strings.\n+     * Eg: {Manifest.permission.ACCESS_COARSE_LOCATION}\n+     *     or {\"android.permission.ACCESS_COARSE_LOCATION\"}\n      */\n-    String permission() default \"\";\n+    String[] permission() default {};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "947fc6db86412198b9cccc7b3bae13f9a2b314c4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYyNTMwMg==", "bodyText": "It makes sense because it can be one or many but I hesitate because the parent element is called \"permissions\" which is made up of one or many @Permission annotations, which then can contain one or many \"permission\" manifest constants. Im thinking of renaming it to something like \"constants\" or \"strings\" but that sounds awfully generic", "url": "https://github.com/ionic-team/capacitor/pull/3822#discussion_r526625302", "createdAt": "2020-11-19T06:36:57Z", "author": {"login": "carlpoole"}, "path": "android/capacitor/src/main/java/com/getcapacitor/annotation/Permission.java", "diffHunk": "@@ -9,11 +9,11 @@\n @Retention(RetentionPolicy.RUNTIME)\n public @interface Permission {\n     /**\n-     * The Android string for the permission.\n-     * Eg: Manifest.permission.ACCESS_COARSE_LOCATION\n-     *     or \"android.permission.ACCESS_COARSE_LOCATION\"\n+     * An array of Android permission strings.\n+     * Eg: {Manifest.permission.ACCESS_COARSE_LOCATION}\n+     *     or {\"android.permission.ACCESS_COARSE_LOCATION\"}\n      */\n-    String permission() default \"\";\n+    String[] permission() default {};", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU5NzQ5Ng=="}, "originalCommit": {"oid": "947fc6db86412198b9cccc7b3bae13f9a2b314c4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3ODMwOA==", "bodyText": "I don't mind strings, because that's what they're called in Android and we already have the context of permissions given the @Permission annotation.\n@Permission(strings = { Manifest.permission.WRITE_EXTERNAL_STORAGE, Manifest.permission.READ_EXTERNAL_STORAGE }, alias = \"publicStorage\")\n^ This looks good to me. \ud83d\ude01", "url": "https://github.com/ionic-team/capacitor/pull/3822#discussion_r527078308", "createdAt": "2020-11-19T17:43:44Z", "author": {"login": "imhoffd"}, "path": "android/capacitor/src/main/java/com/getcapacitor/annotation/Permission.java", "diffHunk": "@@ -9,11 +9,11 @@\n @Retention(RetentionPolicy.RUNTIME)\n public @interface Permission {\n     /**\n-     * The Android string for the permission.\n-     * Eg: Manifest.permission.ACCESS_COARSE_LOCATION\n-     *     or \"android.permission.ACCESS_COARSE_LOCATION\"\n+     * An array of Android permission strings.\n+     * Eg: {Manifest.permission.ACCESS_COARSE_LOCATION}\n+     *     or {\"android.permission.ACCESS_COARSE_LOCATION\"}\n      */\n-    String permission() default \"\";\n+    String[] permission() default {};", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU5NzQ5Ng=="}, "originalCommit": {"oid": "947fc6db86412198b9cccc7b3bae13f9a2b314c4"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTc0MDEyOnYy", "diffSide": "RIGHT", "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNToxMjowMlrOH2NAww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNToxMjowMlrOH2NAww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU5ODMzOQ==", "bodyText": "Can you make a code comment on why this if-test is necessary?", "url": "https://github.com/ionic-team/capacitor/pull/3822#discussion_r526598339", "createdAt": "2020-11-19T05:12:02Z", "author": {"login": "imhoffd"}, "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "diffHunk": "@@ -489,15 +509,25 @@ public void requestPermissions(PluginCall call) {\n         } else {\n             // If call was made without any custom permissions, request all from plugin annotation\n             if (providedPermsList == null || providedPermsList.isEmpty()) {\n-                perms = new String[annotation.permissions().length];\n-                for (int i = 0; i < perms.length; i++) {\n-                    perms[i] = annotation.permissions()[i].permission();\n+                HashSet<String> permsSet = new HashSet<>();\n+                for (Permission perm : annotation.permissions()) {\n+                    if (perm.permission().length == 0 || (perm.permission().length == 1 && perm.permission()[0].isEmpty())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "947fc6db86412198b9cccc7b3bae13f9a2b314c4"}, "originalPosition": 122}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDc3NjUzOnYy", "diffSide": "RIGHT", "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzozOTo1MFrOH2qJ-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODowMTo1M1rOH2rCRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NTgzMw==", "bodyText": "I'm still confused as to why this part is necessary: (perm.permission().length == 1 && perm.permission()[0].isEmpty())\nIt is handling this case?\n@Permission(permission = {\"\"}, alias = ...", "url": "https://github.com/ionic-team/capacitor/pull/3822#discussion_r527075833", "createdAt": "2020-11-19T17:39:50Z", "author": {"login": "imhoffd"}, "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "diffHunk": "@@ -489,15 +511,27 @@ public void requestPermissions(PluginCall call) {\n         } else {\n             // If call was made without any custom permissions, request all from plugin annotation\n             if (providedPermsList == null || providedPermsList.isEmpty()) {\n-                perms = new String[annotation.permissions().length];\n-                for (int i = 0; i < perms.length; i++) {\n-                    perms[i] = annotation.permissions()[i].permission();\n+                HashSet<String> permsSet = new HashSet<>();\n+                for (Permission perm : annotation.permissions()) {\n+                    // If a permission is defined with no permission constants, separate it for auto-granting.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "048de0e67aa755513d59a90e30419448c1b41f53"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NzE3NQ==", "bodyText": "yes or this valid definition\n@Permission(permission = \"\", alias = ...\n\nwhich on the back end translates to an array containing one empty element", "url": "https://github.com/ionic-team/capacitor/pull/3822#discussion_r527077175", "createdAt": "2020-11-19T17:41:55Z", "author": {"login": "carlpoole"}, "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "diffHunk": "@@ -489,15 +511,27 @@ public void requestPermissions(PluginCall call) {\n         } else {\n             // If call was made without any custom permissions, request all from plugin annotation\n             if (providedPermsList == null || providedPermsList.isEmpty()) {\n-                perms = new String[annotation.permissions().length];\n-                for (int i = 0; i < perms.length; i++) {\n-                    perms[i] = annotation.permissions()[i].permission();\n+                HashSet<String> permsSet = new HashSet<>();\n+                for (Permission perm : annotation.permissions()) {\n+                    // If a permission is defined with no permission constants, separate it for auto-granting.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NTgzMw=="}, "originalCommit": {"oid": "048de0e67aa755513d59a90e30419448c1b41f53"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA5MDI0Ng==", "bodyText": "Let's switch to Kotlin.", "url": "https://github.com/ionic-team/capacitor/pull/3822#discussion_r527090246", "createdAt": "2020-11-19T18:01:53Z", "author": {"login": "imhoffd"}, "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "diffHunk": "@@ -489,15 +511,27 @@ public void requestPermissions(PluginCall call) {\n         } else {\n             // If call was made without any custom permissions, request all from plugin annotation\n             if (providedPermsList == null || providedPermsList.isEmpty()) {\n-                perms = new String[annotation.permissions().length];\n-                for (int i = 0; i < perms.length; i++) {\n-                    perms[i] = annotation.permissions()[i].permission();\n+                HashSet<String> permsSet = new HashSet<>();\n+                for (Permission perm : annotation.permissions()) {\n+                    // If a permission is defined with no permission constants, separate it for auto-granting.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NTgzMw=="}, "originalCommit": {"oid": "048de0e67aa755513d59a90e30419448c1b41f53"}, "originalPosition": 124}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3472, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}