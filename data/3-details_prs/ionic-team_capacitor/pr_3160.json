{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMTU2Njkx", "number": 3160, "title": "fix(iOS): Making permissions switch statements exhaustive & supporting new iOS 14 cases", "bodyText": "This PR supersedes #3135 and #3149. It unifies the handling of permission enums and fixes the compiler errors under Xcode 12 with the iOS 14 SDK.", "createdAt": "2020-06-25T17:20:57Z", "url": "https://github.com/ionic-team/capacitor/pull/3160", "merged": true, "mergeCommit": {"oid": "f1d8c8c14020b06101980098aca8708c2be8c357"}, "closed": true, "closedAt": "2020-07-01T13:59:06Z", "author": {"login": "ikeith"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcux3wjgH2gAyNDQwMTU2NjkxOjJmMTRjNTdhMDAwNzg3NTM5ZWM3MDVkM2I0MDJhNzQ3NWI3OTI1YzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwqO2mgFqTQ0MDg2NzE5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2f14c57a000787539ec705d3b402a7475b7925c5", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/2f14c57a000787539ec705d3b402a7475b7925c5", "committedDate": "2020-06-25T17:12:51Z", "message": "Cleaned up permissions enum handling. Added unknown default handlers and new iOS 14 enum cases."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NzA2Mjk2", "url": "https://github.com/ionic-team/capacitor/pull/3160#pullrequestreview-437706296", "createdAt": "2020-06-25T17:25:41Z", "commit": {"oid": "2f14c57a000787539ec705d3b402a7475b7925c5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNzoyNTo0MVrOGpEkWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNzoyNTo0MVrOGpEkWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcxOTY0Mw==", "bodyText": "In addition to the new case, authorizationStatus() is being deprecated in favor of authorizationStatus(for:). The implications of .limited aren't fully clear to me yet so I'm adding this warning to be sure that it gets revisited before the beta period is over since it might require changes across more of Capacitor. But this addresses the immediate problem of compiles breaking with Xcode 12 until that time.", "url": "https://github.com/ionic-team/capacitor/pull/3160#discussion_r445719643", "createdAt": "2020-06-25T17:25:41Z", "author": {"login": "ikeith"}, "path": "ios/Capacitor/Capacitor/Plugins/Permissions.swift", "diffHunk": "@@ -52,16 +54,25 @@ public class CAPPermissionsPlugin: CAPPlugin {\n \n   func checkPhotos(_ call: CAPPluginCall) {\n     let photoAuthorizationStatus = PHPhotoLibrary.authorizationStatus()\n-\n-    var ret = \"prompt\"\n+    \n+    let ret: String\n     switch (photoAuthorizationStatus) {\n-      case .notDetermined:\n-        ret = \"prompt\"\n-      case .denied, .restricted:\n-        ret = \"denied\"\n-      case .authorized:\n-        ret = \"granted\"\n+    case .denied, .restricted:\n+      ret = \"denied\"\n+    case .authorized:\n+      ret = \"granted\"\n+    #if swift(>=5.3)\n+    case .limited:\n+      // TODO: address this new case properly\n+      #warning(\".limited != .authorized, authorization status should be revisted for iOS 14\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f14c57a000787539ec705d3b402a7475b7925c5"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7479349eccb46637e644c61afb1a644953e19d4b", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/7479349eccb46637e644c61afb1a644953e19d4b", "committedDate": "2020-06-25T19:58:50Z", "message": "Missed a type declaration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODE1OTQ0", "url": "https://github.com/ionic-team/capacitor/pull/3160#pullrequestreview-437815944", "createdAt": "2020-06-25T20:00:29Z", "commit": {"oid": "7479349eccb46637e644c61afb1a644953e19d4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDowMDoyOVrOGpJy9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDowMDoyOVrOGpJy9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgwNTMwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  #warning(\".limited != .authorized, authorization status should be revisted for iOS 14\")\n          \n          \n            \n                  #warning(\".limited != .authorized, authorization status should be revisited for iOS 14\")", "url": "https://github.com/ionic-team/capacitor/pull/3160#discussion_r445805303", "createdAt": "2020-06-25T20:00:29Z", "author": {"login": "imhoffd"}, "path": "ios/Capacitor/Capacitor/Plugins/Permissions.swift", "diffHunk": "@@ -52,31 +54,42 @@ public class CAPPermissionsPlugin: CAPPlugin {\n \n   func checkPhotos(_ call: CAPPluginCall) {\n     let photoAuthorizationStatus = PHPhotoLibrary.authorizationStatus()\n-\n-    var ret = \"prompt\"\n+    \n+    let ret: String\n     switch (photoAuthorizationStatus) {\n-      case .notDetermined:\n-        ret = \"prompt\"\n-      case .denied, .restricted:\n-        ret = \"denied\"\n-      case .authorized:\n-        ret = \"granted\"\n+    case .denied, .restricted:\n+      ret = \"denied\"\n+    case .authorized:\n+      ret = \"granted\"\n+    #if swift(>=5.3)\n+    case .limited:\n+      // TODO: address this new case properly\n+      #warning(\".limited != .authorized, authorization status should be revisted for iOS 14\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7479349eccb46637e644c61afb1a644953e19d4b"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78fc230ed01a447ce5b5b7396574fff6dceca26d", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/78fc230ed01a447ce5b5b7396574fff6dceca26d", "committedDate": "2020-06-25T20:27:31Z", "message": "Update ios/Capacitor/Capacitor/Plugins/Permissions.swift\n\nCo-authored-by: Dan Imhoff <dwieeb@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5ODY4NTgz", "url": "https://github.com/ionic-team/capacitor/pull/3160#pullrequestreview-439868583", "createdAt": "2020-06-30T10:08:25Z", "commit": {"oid": "78fc230ed01a447ce5b5b7396574fff6dceca26d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac4bea895ae154931af4d7be32695f2bada6621a", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/ac4bea895ae154931af4d7be32695f2bada6621a", "committedDate": "2020-06-30T14:42:38Z", "message": "Changing @unknown default to be a failure case."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56ffb24f8434d94c3a5965f23e6b1410116e8895", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/56ffb24f8434d94c3a5965f23e6b1410116e8895", "committedDate": "2020-06-30T14:42:44Z", "message": "Merge branch 'permission-enums' of github.com:ionic-team/capacitor into permission-enums"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08310b9c334879b96c58c2f913ad707e8ee02f8f", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/08310b9c334879b96c58c2f913ad707e8ee02f8f", "committedDate": "2020-06-30T14:43:09Z", "message": "Merge branch 'master' into permission-enums"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNjUwNzU4", "url": "https://github.com/ionic-team/capacitor/pull/3160#pullrequestreview-440650758", "createdAt": "2020-07-01T08:22:15Z", "commit": {"oid": "08310b9c334879b96c58c2f913ad707e8ee02f8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwODoyMjoxNlrOGrb47w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwODoyMjoxNlrOGrb47w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE5ODg5NQ==", "bodyText": "The new enum cases are not bound to Swift 5.3. They are added in iOS 14 and the availability check should check for os version instead.", "url": "https://github.com/ionic-team/capacitor/pull/3160#discussion_r448198895", "createdAt": "2020-07-01T08:22:16Z", "author": {"login": "MortenGregersen"}, "path": "ios/Capacitor/Capacitor/Plugins/Permissions.swift", "diffHunk": "@@ -52,31 +56,44 @@ public class CAPPermissionsPlugin: CAPPlugin {\n \n   func checkPhotos(_ call: CAPPluginCall) {\n     let photoAuthorizationStatus = PHPhotoLibrary.authorizationStatus()\n-\n-    var ret = \"prompt\"\n+    \n+    let ret: String\n     switch (photoAuthorizationStatus) {\n-      case .notDetermined:\n-        ret = \"prompt\"\n-      case .denied, .restricted:\n-        ret = \"denied\"\n-      case .authorized:\n-        ret = \"granted\"\n+    case .denied, .restricted:\n+      ret = \"denied\"\n+    case .authorized:\n+      ret = \"granted\"\n+    #if swift(>=5.3)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08310b9c334879b96c58c2f913ad707e8ee02f8f"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e1bd25791d5dfd60eefd196090e990284beddb8", "author": {"user": {"login": "jcesarmobile", "name": "jcesarmobile"}}, "url": "https://github.com/ionic-team/capacitor/commit/4e1bd25791d5dfd60eefd196090e990284beddb8", "committedDate": "2020-07-01T10:40:46Z", "message": "Merge branch 'master' into permission-enums"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwODY3MTk5", "url": "https://github.com/ionic-team/capacitor/pull/3160#pullrequestreview-440867199", "createdAt": "2020-07-01T13:26:41Z", "commit": {"oid": "4e1bd25791d5dfd60eefd196090e990284beddb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1199, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}