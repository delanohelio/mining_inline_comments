{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NjU3MDcy", "number": 2933, "title": "feat(ios): improve webview background experience", "bodyText": "Based on a few different posts from the forum, the configuration for how the webview handles backgrounds can lead to a flash of white when starting up, especially in dark mode.\nThis PR attempts to improve this by first\n\nSetting the webview to not be isOpaque\nif you're on iOS 13, use the system background color for the webview\nif you're not on iOS 13, use the color declared in the capacitor config.\n\nThere could be room for further improvements, but I think this is a good first step.", "createdAt": "2020-05-15T15:28:38Z", "url": "https://github.com/ionic-team/capacitor/pull/2933", "merged": true, "mergeCommit": {"oid": "49720a5414b5d1f3bf7dadf5ac351a3ccef5133a"}, "closed": true, "closedAt": "2020-07-13T18:27:10Z", "author": {"login": "mhartington"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchkCQnAFqTQxMjc2MTg4MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0laPzAH2gAyNDE4NjU3MDcyOmI5NzlmNjgxMjc2YmNlNDU1YTg1NThmNTFjZThjMjdiODgzMDU2NmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNzYxODgw", "url": "https://github.com/ionic-team/capacitor/pull/2933#pullrequestreview-412761880", "createdAt": "2020-05-15T15:43:58Z", "commit": {"oid": "3bcb50284ace3d62b2b4e3f62c43a1c198e2f956"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNTo0Mzo1OFrOGWKLsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNTo0NDozMlrOGWKM2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg4ODY4OA==", "bodyText": "what is this supposed to do? shouldn't it be reset to the default value after the splash disappears?", "url": "https://github.com/ionic-team/capacitor/pull/2933#discussion_r425888688", "createdAt": "2020-05-15T15:43:58Z", "author": {"login": "jcesarmobile"}, "path": "ios/Capacitor/Capacitor/CAPBridgeViewController.swift", "diffHunk": "@@ -89,15 +89,21 @@ public class CAPBridgeViewController: UIViewController, CAPBridgeDelegate, WKScr\n     }\n     webView?.configuration.preferences.setValue(true, forKey: \"allowFileAccessFromFileURLs\")\n     view = webView\n-    \n+\n     setKeyboardRequiresUserInteraction(false)\n-    \n+\n     bridge = CAPBridge(self, o, capConfig, specifiedScheme)\n \n+    webView?.isOpaque = false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bcb50284ace3d62b2b4e3f62c43a1c198e2f956"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg4ODk4NQ==", "bodyText": "this will break the background color functionality using the systemBackground color on iOS 13 despite the value used", "url": "https://github.com/ionic-team/capacitor/pull/2933#discussion_r425888985", "createdAt": "2020-05-15T15:44:32Z", "author": {"login": "jcesarmobile"}, "path": "ios/Capacitor/Capacitor/CAPBridgeViewController.swift", "diffHunk": "@@ -89,15 +89,21 @@ public class CAPBridgeViewController: UIViewController, CAPBridgeDelegate, WKScr\n     }\n     webView?.configuration.preferences.setValue(true, forKey: \"allowFileAccessFromFileURLs\")\n     view = webView\n-    \n+\n     setKeyboardRequiresUserInteraction(false)\n-    \n+\n     bridge = CAPBridge(self, o, capConfig, specifiedScheme)\n \n+    webView?.isOpaque = false\n     if let backgroundColor = (bridge!.config.getValue(\"ios.backgroundColor\") as? String) ?? (bridge!.config.getValue(\"backgroundColor\") as? String) {\n-      webView?.backgroundColor = UIColor(fromHex: backgroundColor)\n-      webView?.scrollView.backgroundColor = UIColor(fromHex: backgroundColor)\n+        if #available(iOS 13.0, *) {\n+            webView?.backgroundColor = UIColor.systemBackground", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3bcb50284ace3d62b2b4e3f62c43a1c198e2f956"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e0a2cbf1211d85e11b87703f7bae9de936727ce", "author": {"user": {"login": "mhartington", "name": "Mike Hartington"}}, "url": "https://github.com/ionic-team/capacitor/commit/1e0a2cbf1211d85e11b87703f7bae9de936727ce", "committedDate": "2020-06-30T17:37:31Z", "message": "feat(ios): improve webview background experience"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50a50409f1e85fcaac5b0540549f5bd2cf21d1e2", "author": {"user": {"login": "mhartington", "name": "Mike Hartington"}}, "url": "https://github.com/ionic-team/capacitor/commit/50a50409f1e85fcaac5b0540549f5bd2cf21d1e2", "committedDate": "2020-07-02T17:13:33Z", "message": "updates based on feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3bcb50284ace3d62b2b4e3f62c43a1c198e2f956", "author": {"user": {"login": "mhartington", "name": "Mike Hartington"}}, "url": "https://github.com/ionic-team/capacitor/commit/3bcb50284ace3d62b2b4e3f62c43a1c198e2f956", "committedDate": "2020-05-15T15:21:24Z", "message": "feat(ios): improve webview background experience"}, "afterCommit": {"oid": "50a50409f1e85fcaac5b0540549f5bd2cf21d1e2", "author": {"user": {"login": "mhartington", "name": "Mike Hartington"}}, "url": "https://github.com/ionic-team/capacitor/commit/50a50409f1e85fcaac5b0540549f5bd2cf21d1e2", "committedDate": "2020-07-02T17:13:33Z", "message": "updates based on feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08bb4685034b58bd238bc023adeea7c52e49b09d", "author": {"user": {"login": "mhartington", "name": "Mike Hartington"}}, "url": "https://github.com/ionic-team/capacitor/commit/08bb4685034b58bd238bc023adeea7c52e49b09d", "committedDate": "2020-07-02T17:33:42Z", "message": "Merge branch 'master' into webview-background-enhancments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4cf61280ed2a72af835f6217e83edee1bb78fbf", "author": {"user": {"login": "mhartington", "name": "Mike Hartington"}}, "url": "https://github.com/ionic-team/capacitor/commit/c4cf61280ed2a72af835f6217e83edee1bb78fbf", "committedDate": "2020-07-02T20:32:50Z", "message": "apply feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b505676dbe3b13b572daf4071d2d7e2c305d4f4b", "author": {"user": {"login": "mhartington", "name": "Mike Hartington"}}, "url": "https://github.com/ionic-team/capacitor/commit/b505676dbe3b13b572daf4071d2d7e2c305d4f4b", "committedDate": "2020-07-02T20:44:51Z", "message": "fix build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "109a7c3c8c163cc6eb51f557b86ab8aea46a1fb6", "author": {"user": {"login": "mhartington", "name": "Mike Hartington"}}, "url": "https://github.com/ionic-team/capacitor/commit/109a7c3c8c163cc6eb51f557b86ab8aea46a1fb6", "committedDate": "2020-07-02T20:47:50Z", "message": "actually fix build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NzY0MzY3", "url": "https://github.com/ionic-team/capacitor/pull/2933#pullrequestreview-445764367", "createdAt": "2020-07-09T16:08:58Z", "commit": {"oid": "109a7c3c8c163cc6eb51f557b86ab8aea46a1fb6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjowODo1OFrOGvYDEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjowODo1OFrOGvYDEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMDI1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Use the system background colors if background is not set by user\n          \n          \n            \n                    webView?.backgroundColor = UIColor.systemBackground\n          \n          \n            \n                    webView?.scrollView.backgroundColor = UIColor.systemBackground\n          \n          \n            \n                  // Use the system background colors if background is not set by user\n          \n          \n            \n                  webView?.backgroundColor = UIColor.systemBackground\n          \n          \n            \n                  webView?.scrollView.backgroundColor = UIColor.systemBackground", "url": "https://github.com/ionic-team/capacitor/pull/2933#discussion_r452330256", "createdAt": "2020-07-09T16:08:58Z", "author": {"login": "jcesarmobile"}, "path": "ios/Capacitor/Capacitor/CAPBridgeViewController.swift", "diffHunk": "@@ -97,7 +97,12 @@ public class CAPBridgeViewController: UIViewController, CAPBridgeDelegate, WKScr\n     if let backgroundColor = (bridge!.config.getValue(\"ios.backgroundColor\") as? String) ?? (bridge!.config.getValue(\"backgroundColor\") as? String) {\n       webView?.backgroundColor = UIColor(fromHex: backgroundColor)\n       webView?.scrollView.backgroundColor = UIColor(fromHex: backgroundColor)\n+    } else if #available(iOS 13, *) {\n+        // Use the system background colors if background is not set by user\n+        webView?.backgroundColor = UIColor.systemBackground\n+        webView?.scrollView.backgroundColor = UIColor.systemBackground", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "109a7c3c8c163cc6eb51f557b86ab8aea46a1fb6"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fa5be932d1118cb8b69a6682182bc3aad43c563", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/3fa5be932d1118cb8b69a6682182bc3aad43c563", "committedDate": "2020-07-10T19:23:20Z", "message": "Added state to only adjust the webview's `isOpaque` property on initial load and preserve the value in case it was modified by a plugin."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "112354ae10085ff059e244d3157d9dae98faa8b2", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/112354ae10085ff059e244d3157d9dae98faa8b2", "committedDate": "2020-07-10T19:23:33Z", "message": "Update ios/Capacitor/Capacitor/CAPBridgeViewController.swift\n\nCo-authored-by: jcesarmobile <jcesarmobile@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64dbbc419faaf8c3ba8fbd8f199e49ffa2ad2311", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/64dbbc419faaf8c3ba8fbd8f199e49ffa2ad2311", "committedDate": "2020-07-10T19:23:45Z", "message": "Merge branch 'webview-background-enhancments' of github.com:ionic-team/capacitor into webview-background-enhancments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "816803d9435062f8ac4690809bed31171eac4b26", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/816803d9435062f8ac4690809bed31171eac4b26", "committedDate": "2020-07-10T19:46:41Z", "message": "Fixing optional handling."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc428c27c05b2dac6fb0ba68621c619866ac1891", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/fc428c27c05b2dac6fb0ba68621c619866ac1891", "committedDate": "2020-07-10T19:53:14Z", "message": "Fixing optional"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NDU5MDM1", "url": "https://github.com/ionic-team/capacitor/pull/2933#pullrequestreview-447459035", "createdAt": "2020-07-13T17:34:24Z", "commit": {"oid": "fc428c27c05b2dac6fb0ba68621c619866ac1891"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b979f681276bce455a8558f51ce8c27b8830566c", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/b979f681276bce455a8558f51ce8c27b8830566c", "committedDate": "2020-07-13T18:05:18Z", "message": "Merge branch 'master' into webview-background-enhancments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1231, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}