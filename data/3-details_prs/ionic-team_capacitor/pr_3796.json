{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NDg1MjM0", "number": 3796, "title": "feat(iOS): Add local and remote notification router", "bodyText": "TODO:\n\n Set UNUserNotificationCenter.delegate via configuration (waiting on config stuff to get merged)\n\nwaiting on #3759", "createdAt": "2020-11-11T22:25:32Z", "url": "https://github.com/ionic-team/capacitor/pull/3796", "merged": true, "mergeCommit": {"oid": "f3edaf93d4328ea3ee90df573bf14ef0efc7553b"}, "closed": true, "closedAt": "2020-11-25T20:32:21Z", "author": {"login": "imhoffd"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdblol-gH2gAyNTE5NDg1MjM0OjVmNTNkZTAyMGFhNDJmNWMyMDZkODc1ZmVhMjc0MDk3NjUwZjk0Y2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgENJ4AH2gAyNTE5NDg1MjM0OmIzM2Y1NTY3OGJiMTU4M2E5MTljNjQxNTNjNmJkNjY5MDI2NzEzZWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5f53de020aa42f5c206d875fea274097650f94ca", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/5f53de020aa42f5c206d875fea274097650f94ca", "committedDate": "2020-11-11T22:24:01Z", "message": "add notification delegate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28ac7ddfb06f4089e524246592989c4afd2db613", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/28ac7ddfb06f4089e524246592989c4afd2db613", "committedDate": "2020-11-11T22:54:34Z", "message": "expose notification delegate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a1a2cdbc56ae73ae7f18dcaa3a780481b140190", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/0a1a2cdbc56ae73ae7f18dcaa3a780481b140190", "committedDate": "2020-11-11T22:57:21Z", "message": "remove redundant modifiers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "445d0dd5bd8709c37988deef768af98ce7477b56", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/445d0dd5bd8709c37988deef768af98ce7477b56", "committedDate": "2020-11-20T00:10:50Z", "message": "these must be public, otherwise 'internal'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b85d4a374785f71cd0790cb1d004a04152869b9", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/2b85d4a374785f71cd0790cb1d004a04152869b9", "committedDate": "2020-11-20T00:12:57Z", "message": "Merge branch 'main' into notification-delegate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1c87898fa4528be46231b5e00a550964dac090f", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/b1c87898fa4528be46231b5e00a550964dac090f", "committedDate": "2020-11-20T18:18:31Z", "message": "Merge branch 'main' into notification-delegate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "caf7c744218cab7004003967045c592df9adda35", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/caf7c744218cab7004003967045c592df9adda35", "committedDate": "2020-11-20T18:29:38Z", "message": "Merge branch 'main' into notification-delegate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b296de50f3368db3a27a5d7549f694366d3bc29d", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/b296de50f3368db3a27a5d7549f694366d3bc29d", "committedDate": "2020-11-24T20:49:47Z", "message": "Merge branch 'main' into notification-delegate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58cade0f1db15b86e3b4ec7378de5ab771e2bf03", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/58cade0f1db15b86e3b4ec7378de5ab771e2bf03", "committedDate": "2020-11-25T01:24:10Z", "message": "configurable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ec72b177a935a6324d0f75479d51db9eb3d85c5", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/5ec72b177a935a6324d0f75479d51db9eb3d85c5", "committedDate": "2020-11-25T01:25:37Z", "message": "Merge branch 'main' into notification-delegate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NTcwMDky", "url": "https://github.com/ionic-team/capacitor/pull/3796#pullrequestreview-538570092", "createdAt": "2020-11-25T14:44:25Z", "commit": {"oid": "5ec72b177a935a6324d0f75479d51db9eb3d85c5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNDo0NDoyNVrOH52mhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNTowMTo1N1rOH53ZyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQyNTQ3Nw==", "bodyText": "This should not be weak. Something needs to keep the instance in memory. Since the bridge creates the object then it should own it.\nAlso, it should be marked as public to match the protocol declaration. The protocol defines the property as read-only so that's how outside classes will see it.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private(set) weak var userNotificationDelegate: UserNotificationCenterDelegate\n          \n          \n            \n                public var userNotificationDelegate: UserNotificationCenterDelegate", "url": "https://github.com/ionic-team/capacitor/pull/3796#discussion_r530425477", "createdAt": "2020-11-25T14:44:25Z", "author": {"login": "ikeith"}, "path": "ios/Capacitor/Capacitor/CapacitorBridge.swift", "diffHunk": "@@ -16,6 +16,8 @@ internal class CapacitorBridge: NSObject, CAPBridgeProtocol {\n         return bridgeDelegate?.bridgedWebView\n     }\n \n+    private(set) weak var userNotificationDelegate: UserNotificationCenterDelegate", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec72b177a935a6324d0f75479d51db9eb3d85c5"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzMTMwMg==", "bodyText": "Does this need a field in the config file? Otherwise turning it off will require that the app developer subclass the view controller to programmatically set it.", "url": "https://github.com/ionic-team/capacitor/pull/3796#discussion_r530431302", "createdAt": "2020-11-25T14:52:22Z", "author": {"login": "ikeith"}, "path": "ios/Capacitor/Capacitor/CAPInstanceConfiguration.h", "diffHunk": "@@ -17,6 +17,7 @@ NS_SWIFT_NAME(InstanceConfiguration)\n @property (nonatomic, readonly) BOOL enableLogging;\n @property (nonatomic, readonly) BOOL enableScrolling;\n @property (nonatomic, readonly) BOOL allowLinkPreviews;\n+@property (nonatomic, readonly) BOOL assignUserNotificationCenterDelegate;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec72b177a935a6324d0f75479d51db9eb3d85c5"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzODYwMA==", "bodyText": "What if this was moved into UserNotificationCenterDelegate? It could have a computed property that both returned whether or not it was the active delegate and allowed it be to set. The bridge, then, could just set the flag like:\nuserNotificationDelegate.handleNotifications = configuration.assignUserNotificationDelegate", "url": "https://github.com/ionic-team/capacitor/pull/3796#discussion_r530438600", "createdAt": "2020-11-25T15:01:57Z", "author": {"login": "ikeith"}, "path": "ios/Capacitor/Capacitor/CapacitorBridge.swift", "diffHunk": "@@ -172,6 +174,12 @@ internal class CapacitorBridge: NSObject, CAPBridgeProtocol {\n         self.messageHandlerWrapper = messageHandlerWrapper\n         self.config = configuration\n         self.cordovaParser = cordovaConfiguration\n+        self.userNotificationDelegate = UserNotificationCenterDelegate()\n+\n+        if configuration.assignUserNotificationCenterDelegate {\n+            let center = UNUserNotificationCenter.current()\n+            center.delegate = userNotificationDelegate\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec72b177a935a6324d0f75479d51db9eb3d85c5"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d083b6704c71e20d3209ad60e55f8bff9cde733c", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/d083b6704c71e20d3209ad60e55f8bff9cde733c", "committedDate": "2020-11-25T17:39:28Z", "message": "Update ios/Capacitor/Capacitor/CapacitorBridge.swift\n\nCo-authored-by: Ian Keith <iankeith@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7d99ba11cd91bf12a4fe82fb371067b57116151", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/e7d99ba11cd91bf12a4fe82fb371067b57116151", "committedDate": "2020-11-25T17:53:14Z", "message": "move delegate setup into property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a25fff90b4a40ba625957a2c1ef274d6243cc23", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/0a25fff90b4a40ba625957a2c1ef274d6243cc23", "committedDate": "2020-11-25T18:01:31Z", "message": "renames"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4ODAxODQy", "url": "https://github.com/ionic-team/capacitor/pull/3796#pullrequestreview-538801842", "createdAt": "2020-11-25T19:43:29Z", "commit": {"oid": "0a25fff90b4a40ba625957a2c1ef274d6243cc23"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b33f55678bb1583a919c64153c6bd669026713ed", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/b33f55678bb1583a919c64153c6bd669026713ed", "committedDate": "2020-11-25T20:16:48Z", "message": "Merge branch 'main' into notification-delegate"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1110, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}