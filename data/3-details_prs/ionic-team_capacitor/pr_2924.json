{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3OTU0NTM0", "number": 2924, "title": "fix(android): incorrect keyboard height", "bodyText": "At the moment, the Keyboard plugin returns incorrect keyboard height on Android phones with cutouts. This fixes it by subtracting the size of the bottom cutout from the total screen height.\nI also removed obsolete code ensuring backwards-compatibility with Android SDK versions <21 since Capacitor doesn't support these versions.", "createdAt": "2020-05-14T12:12:14Z", "url": "https://github.com/ionic-team/capacitor/pull/2924", "merged": true, "mergeCommit": {"oid": "035f74e91f42e4630d019687046e74f13d3cd5f7"}, "closed": true, "closedAt": "2020-06-10T17:03:46Z", "author": {"login": "duryno"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchMT9tgH2gAyNDE3OTU0NTM0OmUxZDYwNzY3ODRiZDU3OTczOWRjNTE5ZmY3NWVkZGU3MDNlODY3MDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp8pgYgH2gAyNDE3OTU0NTM0Ojg3NzMwMDBiMjRjNWVjZTUzZThjYzE0MDQ1NTYxMWYxYWIzNDBjNjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e1d6076784bd579739dc519ff75edde703e86708", "author": {"user": {"login": "duryno", "name": "Juraj Orszag"}}, "url": "https://github.com/ionic-team/capacitor/commit/e1d6076784bd579739dc519ff75edde703e86708", "committedDate": "2020-05-14T12:06:15Z", "message": "fix(android): incorrect keyboard height"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "626f856256cd89bcfca410d495d0a3064d85dbb0", "author": {"user": {"login": "jcesarmobile", "name": "jcesarmobile"}}, "url": "https://github.com/ionic-team/capacitor/commit/626f856256cd89bcfca410d495d0a3064d85dbb0", "committedDate": "2020-06-10T13:19:58Z", "message": "Merge branch 'master' into android-keyboard-fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MTE3NDU0", "url": "https://github.com/ionic-team/capacitor/pull/2924#pullrequestreview-428117454", "createdAt": "2020-06-10T14:32:34Z", "commit": {"oid": "626f856256cd89bcfca410d495d0a3064d85dbb0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNDozMjozNFrOGh3w7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNDozMjozNFrOGh3w7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE2OTgzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          screenHeight = rootViewHeight - stableInsetBottom;\n          \n          \n            \n                          screenHeight = rootViewHeight;\n          \n          \n            \n                          resultBottom = resultBottom + stableInsetBottom;\n          \n      \n    \n    \n  \n\nI think it makes more sense to add stableInsetBottom to resultBottom instead of substract it from rootViewHeight.\nThe result is the same, but it's better code legibility to add bottom to bottom.", "url": "https://github.com/ionic-team/capacitor/pull/2924#discussion_r438169837", "createdAt": "2020-06-10T14:32:34Z", "author": {"login": "jcesarmobile"}, "path": "android/capacitor/src/main/java/com/getcapacitor/plugin/Keyboard.java", "diffHunk": "@@ -54,18 +55,19 @@ public void onGlobalLayout() {\n             // cache properties for later use\n             int rootViewHeight = rootView.getRootView().getHeight();\n             int resultBottom = r.bottom;\n-\n-            // calculate screen height differently for android versions >= 21: Lollipop 5.x, Marshmallow 6.x\n-            //http://stackoverflow.com/a/29257533/3642890 beware of nexus 5\n             int screenHeight;\n \n-            if (Build.VERSION.SDK_INT >= 21) {\n+            if (Build.VERSION.SDK_INT >= 23) {\n+              WindowInsets windowInsets = rootView.getRootWindowInsets();\n+              int stableInsetBottom = windowInsets.getStableInsetBottom();\n+              screenHeight = rootViewHeight - stableInsetBottom;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "626f856256cd89bcfca410d495d0a3064d85dbb0"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MTE5NTM4", "url": "https://github.com/ionic-team/capacitor/pull/2924#pullrequestreview-428119538", "createdAt": "2020-06-10T14:34:40Z", "commit": {"oid": "626f856256cd89bcfca410d495d0a3064d85dbb0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8773000b24c5ece53e8cc140455611f1ab340c68", "author": {"user": {"login": "jcesarmobile", "name": "jcesarmobile"}}, "url": "https://github.com/ionic-team/capacitor/commit/8773000b24c5ece53e8cc140455611f1ab340c68", "committedDate": "2020-06-10T16:56:37Z", "message": "Update android/capacitor/src/main/java/com/getcapacitor/plugin/Keyboard.java"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1226, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}