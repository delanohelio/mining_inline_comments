{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2Mjk5NDUw", "number": 3999, "title": "feat(cli): create TS configuration files in `init`", "bodyText": "", "createdAt": "2020-12-29T02:33:05Z", "url": "https://github.com/ionic-team/capacitor/pull/3999", "merged": true, "mergeCommit": {"oid": "fa7003e4ef1d988633abb85b1b109c51b94fda42"}, "closed": true, "closedAt": "2021-01-11T18:22:52Z", "author": {"login": "imhoffd"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqxWpEAH2gAyNTQ2Mjk5NDUwOmM3OTViOGMxOTI2N2U4YTg4YjBjYWJhMTk2YThmODRlYzNhNjA4ZDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdvKNZ1AFqTU2NTU5NTIyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c795b8c19267e8a88b0caba196a8f84ec3a608d5", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/c795b8c19267e8a88b0caba196a8f84ec3a608d5", "committedDate": "2020-12-29T02:32:08Z", "message": "feat(cli): create TS configuration files in `init`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "029f04bb377b0d5b207cd144b47115cd439bdf7e", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/029f04bb377b0d5b207cd144b47115cd439bdf7e", "committedDate": "2020-12-29T02:40:40Z", "message": "only use TS if typescript is installed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "768d86299bcb2f0a6611cd87143db818d04016fe", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/768d86299bcb2f0a6611cd87143db818d04016fe", "committedDate": "2020-12-29T02:41:19Z", "message": "add back old default"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzNzI1MDM1", "url": "https://github.com/ionic-team/capacitor/pull/3999#pullrequestreview-563725035", "createdAt": "2021-01-07T18:32:04Z", "commit": {"oid": "768d86299bcb2f0a6611cd87143db818d04016fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxODozMjowNFrOIP3cYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxODozMjowNFrOIP3cYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzUwNzkzOA==", "bodyText": "Not related to this change since you just moved it, but, since platforms are not automatically installed anymore, this commands will end up in errors, so maybe we should remove it or reword?", "url": "https://github.com/ionic-team/capacitor/pull/3999#discussion_r553507938", "createdAt": "2021-01-07T18:32:04Z", "author": {"login": "jcesarmobile"}, "path": "cli/src/tasks/init.ts", "diffHunk": "@@ -132,18 +124,68 @@ async function getWebDir(config: Config, webDir?: string) {\n   return webDir;\n }\n \n+async function runMergeConfig(\n+  config: Config,\n+  extConfig: ExternalConfig,\n+  type: 'json' | 'ts',\n+) {\n+  const configDirectory = dirname(config.app.extConfigFilePath);\n+  const newConfigPath = resolve(\n+    configDirectory,\n+    type === 'ts' ? CONFIG_FILE_NAME_TS : CONFIG_FILE_NAME_JSON,\n+  );\n+\n+  await runTask(\n+    `Creating ${c.strong(basename(newConfigPath))} in ${c.input(\n+      config.app.rootDir,\n+    )}`,\n+    async () => {\n+      await mergeConfig(config, extConfig, newConfigPath);\n+    },\n+  );\n+\n+  if (\n+    newConfigPath !== config.app.extConfigFilePath &&\n+    (await pathExists(config.app.extConfigFilePath))\n+  ) {\n+    const answers = await logPrompt(\n+      `${c.strong(`Remove old ${config.app.extConfigName} file?`)}\\n` +\n+        `The path to your configuration file changed. Would you like to delete the old configuration file?`,\n+      {\n+        type: 'confirm',\n+        name: 'confirm',\n+        message: `Delete ${c.strong(config.app.extConfigName)}?`,\n+        initial: true,\n+      },\n+    );\n+\n+    if (answers.confirm) {\n+      await unlink(config.app.extConfigFilePath);\n+    }\n+  }\n+\n+  printNextSteps(basename(newConfigPath));\n+}\n+\n async function mergeConfig(\n   config: Config,\n   extConfig: ExternalConfig,\n+  newConfigPath: string,\n ): Promise<void> {\n   const oldConfig = { ...config.app.extConfig };\n+  const newConfig = { ...oldConfig, ...extConfig };\n \n-  await writeJSON(\n-    config.app.extConfigFilePath,\n-    {\n-      ...oldConfig,\n-      ...extConfig,\n-    },\n-    { spaces: 2 },\n+  await writeConfig(newConfig, newConfigPath);\n+}\n+\n+function printNextSteps(newConfigName: string) {\n+  logSuccess(`${c.strong(newConfigName)} created!`);\n+  output.write(\n+    `\\nAdd platforms using ${c.input('npx cap add')}:\\n` +\n+      `  ${c.input('npx cap add android')}\\n` +\n+      `  ${c.input('npx cap add ios')}\\n\\n` +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "768d86299bcb2f0a6611cd87143db818d04016fe"}, "originalPosition": 149}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzNzQ3NjU1", "url": "https://github.com/ionic-team/capacitor/pull/3999#pullrequestreview-563747655", "createdAt": "2021-01-07T19:06:18Z", "commit": {"oid": "768d86299bcb2f0a6611cd87143db818d04016fe"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f223f9e26609d9afbab00185b11b27897f710698", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/f223f9e26609d9afbab00185b11b27897f710698", "committedDate": "2021-01-07T20:41:43Z", "message": "Merge branch 'main' into init-ts-file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "871b710f6e90e95fc1aa1a61b2c73d1cddb46f51", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/871b710f6e90e95fc1aa1a61b2c73d1cddb46f51", "committedDate": "2021-01-08T18:05:18Z", "message": "Merge branch 'main' into init-ts-file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e83fafaf62e22ca37f4146e338ad5b49837eeffc", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/e83fafaf62e22ca37f4146e338ad5b49837eeffc", "committedDate": "2021-01-08T18:56:06Z", "message": "Merge branch 'main' into init-ts-file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddd676ef58ba9123766e6c81cd4f58c62e67056f", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/ddd676ef58ba9123766e6c81cd4f58c62e67056f", "committedDate": "2021-01-08T18:59:07Z", "message": "prefer 'export default'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afc27af72acf8acaffdfe9fd1679711ed28d25d4", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/afc27af72acf8acaffdfe9fd1679711ed28d25d4", "committedDate": "2021-01-08T19:03:44Z", "message": "remove unused prompt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "158310d49ada88ba108bb1b8adf8206746cc15a2", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/158310d49ada88ba108bb1b8adf8206746cc15a2", "committedDate": "2021-01-11T16:53:50Z", "message": "Merge branch 'main' into init-ts-file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1NTk1MjIz", "url": "https://github.com/ionic-team/capacitor/pull/3999#pullrequestreview-565595223", "createdAt": "2021-01-11T17:45:22Z", "commit": {"oid": "158310d49ada88ba108bb1b8adf8206746cc15a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1050, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}