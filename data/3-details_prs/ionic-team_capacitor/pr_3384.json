{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyODQ1ODA2", "number": 3384, "title": "chore(iOS): Cleaning up types for JavaScript <-> Native bridging", "bodyText": "This branch updates the iOS code's type system to address several issues:\n\n\nThe JSON serialization is not type-safe because the values are defined as Any, which includes Swift value-types such as structs and enums that cannot be bridged to the JS environment.\n\n\nThe convenience accessors on CAPPluginCall support default values but always return an optional. That leads to many force unwraps and noisy complaints from the linter.\n\n\nThe generic get convenience accessor cannot justify its existence because it offers no benefit over raw access to the underlying dictionary and generates confusion by defining an additional way to retrieve values. (and only really exists as a historical artifact according to @mlynch)\n\n\nJSArray is defined as an array of dictionaries, which is insufficient since it cannot include numbers, strings, etc that make up valid JSON.\n\n\nTo that end, this branch does 4 things:\n\n\nDefines a JSValue \"type\" (enforced via an empty, specializing protocol) to ensure that only expected types are used for bridging communication. This moves potential runtime errors to compile time errors instead.\n\n\nThe convenience get accessors are now split into two separate methods for each type: one to return an optional and one that supports a default value but returns a non-optional. (the simple get accessor has been removed) This should improve clarity at the point of use and reduce confusion over the use of optionals.\n\n\nProtocols! The new accessors are built using composable protocols so they can be inherited by other objects by conforming to the JSValueContainer protocol. (this would allow them to be leveraged in the future for things like configuration... \ud83e\udd14)\n\n\nRather than mixing Obj-C and Swift support such that it is hard to tell what is expected to work where, the new protocols are purely swift (as is required by the underlying types), and the Obj-C convenience accessors are split out into a separate file so only Obj-C code that needs it can import it.", "createdAt": "2020-08-04T15:36:41Z", "url": "https://github.com/ionic-team/capacitor/pull/3384", "merged": true, "mergeCommit": {"oid": "8c96b52e834ab0148b1545ffd3ee921a67bed0b6"}, "closed": true, "closedAt": "2020-10-26T21:25:28Z", "author": {"login": "ikeith"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSlwXJgFqTUwODgzODgyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWZaelgH2gAyNDYyODQ1ODA2OjNmZjIyMmRlOGZiYjVjZjIyMWNhNzZjMjBhOGRlY2E4YTViNTJhNTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODM4ODI5", "url": "https://github.com/ionic-team/capacitor/pull/3384#pullrequestreview-508838829", "createdAt": "2020-10-14T23:27:11Z", "commit": {"oid": "1547a9f218e86b9d6fafba83258d7659689ca992"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfc4306d48d76608a84dc6882875665b726a4f78", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/dfc4306d48d76608a84dc6882875665b726a4f78", "committedDate": "2020-10-15T14:45:31Z", "message": "Minor cleanup to eliminate compiler warnings in Capacitor Cordova project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1df74d6c6a3e4409b27690e3a2d0bdb3e22728b9", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/1df74d6c6a3e4409b27690e3a2d0bdb3e22728b9", "committedDate": "2020-10-15T14:45:54Z", "message": "Support direct building of the capacitor framework. Added modulemaps, updated umbrella headers, updated project settings, removed Capacitor project's Podfile. Updated respective podspecs to match."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "413af81a62174710655db6e29c0465087da10bb8", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/413af81a62174710655db6e29c0465087da10bb8", "committedDate": "2020-10-15T14:47:02Z", "message": "Removing unneeded pod install step so build will work."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5338f02c2baf466949de285cf3553a942d94276f", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/5338f02c2baf466949de285cf3553a942d94276f", "committedDate": "2020-10-15T14:52:06Z", "message": "Cleanup from cherry-picking commits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a40a6ab6d1511187b58b0302a9021f7e1e02753", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/8a40a6ab6d1511187b58b0302a9021f7e1e02753", "committedDate": "2020-10-15T15:28:18Z", "message": "Deleted exclusion of removed file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b0798e22ce689ffee1fa83b5ad56a58e0e6e3dd", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/6b0798e22ce689ffee1fa83b5ad56a58e0e6e3dd", "committedDate": "2020-10-15T15:33:08Z", "message": "Defining new JS types and supporting protocols."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "005ccb8282e989b2f86432eb6007076015c33e92", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/005ccb8282e989b2f86432eb6007076015c33e92", "committedDate": "2020-10-15T15:33:13Z", "message": "Updating CAPPluginCall to use new types."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "216bb707fb979ad6d7768d1e54f400a62d0c682c", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/216bb707fb979ad6d7768d1e54f400a62d0c682c", "committedDate": "2020-10-15T15:34:27Z", "message": "Updating existing code to use new types and accessors."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5274e81e23f70098d18beb60aa6d80ad25c2310b", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/5274e81e23f70098d18beb60aa6d80ad25c2310b", "committedDate": "2020-10-15T15:34:42Z", "message": "Swiftlint changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1597b404fb22ccb58626f4772b8fe17d77efffaf", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/1597b404fb22ccb58626f4772b8fe17d77efffaf", "committedDate": "2020-10-15T15:47:10Z", "message": "Adding excluded header, file references in project."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1547a9f218e86b9d6fafba83258d7659689ca992", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/1547a9f218e86b9d6fafba83258d7659689ca992", "committedDate": "2020-10-14T22:03:57Z", "message": "Removing references to deleted files."}, "afterCommit": {"oid": "1597b404fb22ccb58626f4772b8fe17d77efffaf", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/1597b404fb22ccb58626f4772b8fe17d77efffaf", "committedDate": "2020-10-15T15:47:10Z", "message": "Adding excluded header, file references in project."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d69c8e3d488bb6ec35469e5150b007f929c6924", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/2d69c8e3d488bb6ec35469e5150b007f929c6924", "committedDate": "2020-10-15T21:22:22Z", "message": "Adding explicit type coercion to ensure conformance to expected protocol."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "293d17cee88c8fd56fd9732df8c106d5dc093e23", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/293d17cee88c8fd56fd9732df8c106d5dc093e23", "committedDate": "2020-10-15T21:24:07Z", "message": "Swiftlint format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d15ab9fdb5b7b71578bfa0e0b10eea4a7324de54", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/d15ab9fdb5b7b71578bfa0e0b10eea4a7324de54", "committedDate": "2020-10-16T16:48:25Z", "message": "Merge branch 'main' into ios-build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ecc74f1ab45b45977031c8021696626cadcecd3", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/3ecc74f1ab45b45977031c8021696626cadcecd3", "committedDate": "2020-10-16T16:48:33Z", "message": "Merge branch 'main' into jstypes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28f1eed110f3795cd47e00efea7bf2e02074615e", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/28f1eed110f3795cd47e00efea7bf2e02074615e", "committedDate": "2020-10-16T19:34:26Z", "message": "Reworked CAPLog to prevent race condition between it and CAPConfig."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d92dd0fc2825ec92638d1b481f832856d5a9f24", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/3d92dd0fc2825ec92638d1b481f832856d5a9f24", "committedDate": "2020-10-16T19:42:11Z", "message": "Adding empty application shell to host framework for unit tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3581e0f30ec9f0c510bc562b494f4273fb4cec4", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/f3581e0f30ec9f0c510bc562b494f4273fb4cec4", "committedDate": "2020-10-16T19:57:28Z", "message": "Merge branch 'ios-build' into jstypes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bbcb563ecae83f6c256f4a7df69626d34e21074", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/2bbcb563ecae83f6c256f4a7df69626d34e21074", "committedDate": "2020-10-19T18:44:04Z", "message": "Adding unit tests for the type bridging."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "223b683d2f496e1f50bc25dad836e313d66ecacd", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/223b683d2f496e1f50bc25dad836e313d66ecacd", "committedDate": "2020-10-19T18:47:23Z", "message": "Merge branch 'main' into jstypes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84cb33aa7534bb7603fd4a5f6bcffd62b033084c", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/84cb33aa7534bb7603fd4a5f6bcffd62b033084c", "committedDate": "2020-10-19T18:48:26Z", "message": "Removing deleted file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32bfa11ba4b514233861bed13b48b42e5f2ae40f", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/32bfa11ba4b514233861bed13b48b42e5f2ae40f", "committedDate": "2020-10-19T19:14:06Z", "message": "Adding swift lint config file to exclude tests and host app from linting rules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6598cf6c557bc045be2e6d16a32c19b445b93732", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/6598cf6c557bc045be2e6d16a32c19b445b93732", "committedDate": "2020-10-19T21:15:36Z", "message": "Merge branch 'main' into ios-build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0e5e24c968a906fa8fff5280d696a8749419e8f", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/a0e5e24c968a906fa8fff5280d696a8749419e8f", "committedDate": "2020-10-19T21:28:37Z", "message": "Removing reference to deleted file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6d1955bb3c9795848b15870b188d0684f4140fd", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/d6d1955bb3c9795848b15870b188d0684f4140fd", "committedDate": "2020-10-19T21:28:57Z", "message": "Merge branch 'ios-build' into jstypes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fb3deb7791a894bb42fa098648dc39f954abfe6", "author": {"user": {"login": "imhoffd", "name": "Dan Imhoff"}}, "url": "https://github.com/ionic-team/capacitor/commit/7fb3deb7791a894bb42fa098648dc39f954abfe6", "committedDate": "2020-10-19T23:00:03Z", "message": "Merge branch 'main' into ios-build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4495117f5ce440857491b57debf8c3d2434298be", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/4495117f5ce440857491b57debf8c3d2434298be", "committedDate": "2020-10-20T18:24:10Z", "message": "Merge branch 'main' into ios-build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36ecfcef7086395b0afa43579b80e3e17fd256ef", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/36ecfcef7086395b0afa43579b80e3e17fd256ef", "committedDate": "2020-10-20T18:26:58Z", "message": "Merge branch 'ios-build' into jstypes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d44d62b3fe4cb1c55905f51369f8ca8c143e98ff", "author": {"user": {"login": "jcesarmobile", "name": "jcesarmobile"}}, "url": "https://github.com/ionic-team/capacitor/commit/d44d62b3fe4cb1c55905f51369f8ca8c143e98ff", "committedDate": "2020-10-21T10:13:38Z", "message": "Merge branch 'main' into ios-build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9e996985c0c692bc4e10f27b5521a78dcda333c", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/b9e996985c0c692bc4e10f27b5521a78dcda333c", "committedDate": "2020-10-21T17:16:30Z", "message": "Removing deleted file reference."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41151eb4a27f73a980e04964278fcf8af9a7415b", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/41151eb4a27f73a980e04964278fcf8af9a7415b", "committedDate": "2020-10-21T17:16:45Z", "message": "Merge branch 'ios-build' into jstypes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbad714be66e96428527c65f5320d3b62a52cc6b", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/fbad714be66e96428527c65f5320d3b62a52cc6b", "committedDate": "2020-10-22T18:21:27Z", "message": "Merge branch 'main' into jstypes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91ffe8b891e6528935b78bef87aec9943e723659", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/91ffe8b891e6528935b78bef87aec9943e723659", "committedDate": "2020-10-22T18:53:50Z", "message": "Revert \"Reworked CAPLog to prevent race condition between it and CAPConfig.\"\n\nThis reverts commit 28f1eed110f3795cd47e00efea7bf2e02074615e."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b72720a3fccfb22fd8c9d2cbd44424ff524208b9", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/b72720a3fccfb22fd8c9d2cbd44424ff524208b9", "committedDate": "2020-10-22T18:57:16Z", "message": "Deleting extraneous log statement in test."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f12d1ee194ad971e8c4a017aa6e111d815fb81f3", "author": {"user": {"login": "jcesarmobile", "name": "jcesarmobile"}}, "url": "https://github.com/ionic-team/capacitor/commit/f12d1ee194ad971e8c4a017aa6e111d815fb81f3", "committedDate": "2020-10-23T11:34:29Z", "message": "Merge branch 'main' into jstypes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1ODM2NDU1", "url": "https://github.com/ionic-team/capacitor/pull/3384#pullrequestreview-515836455", "createdAt": "2020-10-23T16:44:04Z", "commit": {"oid": "f12d1ee194ad971e8c4a017aa6e111d815fb81f3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjo0NDowNFrOHnVj5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjo0NDowNFrOHnVj5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAwOTc2NA==", "bodyText": "Can something like this be used in this 3 fors instead of the guards?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for type in actionTypes {\n          \n          \n            \n                        guard let type = type as? JSObject else {\n          \n          \n            \n                          continue\n          \n          \n            \n                        }\n          \n          \n            \n                    for case let type as JSObject in actionTypes {", "url": "https://github.com/ionic-team/capacitor/pull/3384#discussion_r511009764", "createdAt": "2020-10-23T16:44:04Z", "author": {"login": "jcesarmobile"}, "path": "ios/Capacitor/Capacitor/Plugins/LocalNotifications.swift", "diffHunk": "@@ -338,6 +338,9 @@ public class CAPLocalNotificationsPlugin: CAPPlugin {\n \n         createdCategories.append(generalCategory)\n         for type in actionTypes {\n+            guard let type = type as? JSObject else {\n+              continue\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12d1ee194ad971e8c4a017aa6e111d815fb81f3"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "847e8ee6f6e8366520d85e7546825de3436700f2", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/847e8ee6f6e8366520d85e7546825de3436700f2", "committedDate": "2020-10-23T22:02:09Z", "message": "Cleaning up type handling in LocalNotifications plugin."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NjAxNjc1", "url": "https://github.com/ionic-team/capacitor/pull/3384#pullrequestreview-516601675", "createdAt": "2020-10-26T09:35:17Z", "commit": {"oid": "847e8ee6f6e8366520d85e7546825de3436700f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ff222de8fbb5cf221ca76c20a8deca8a5b52a54", "author": {"user": {"login": "ikeith", "name": "Ian Keith"}}, "url": "https://github.com/ionic-team/capacitor/commit/3ff222de8fbb5cf221ca76c20a8deca8a5b52a54", "committedDate": "2020-10-26T19:20:07Z", "message": "Merge branch 'main' into jstypes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1149, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}