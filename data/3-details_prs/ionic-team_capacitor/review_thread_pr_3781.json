{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3ODczNjY0", "number": 3781, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzo1Nzo0OFrOE30GkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxODowNToyNFrOE30ROQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2OTYwNzg1OnYy", "diffSide": "RIGHT", "path": "android/capacitor/src/main/java/com/getcapacitor/Bridge.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzo1Nzo0OFrOHxYQgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzo1Nzo0OFrOHxYQgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUzOTcxMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import com.getcapacitor.util.PermissionHelper;\n          \n      \n    \n    \n  \n\nunused", "url": "https://github.com/ionic-team/capacitor/pull/3781#discussion_r521539712", "createdAt": "2020-11-11T17:57:48Z", "author": {"login": "jcesarmobile"}, "path": "android/capacitor/src/main/java/com/getcapacitor/Bridge.java", "diffHunk": "@@ -18,6 +18,7 @@\n import com.getcapacitor.annotation.CapacitorPlugin;\n import com.getcapacitor.plugin.SplashScreen;\n import com.getcapacitor.util.HostMask;\n+import com.getcapacitor.util.PermissionHelper;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f330760a439e14243d563d64c123ef5dd7193bb1"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2OTYxNDI1OnYy", "diffSide": "RIGHT", "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzo1OTozNVrOHxYUqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNDo0MToxM1rOHxqS5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU0MDc3OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } else {\n          \n          \n            \n                        return;\n          \n          \n            \n                    }\n          \n          \n            \n                    }\n          \n      \n    \n    \n  \n\nremove the else and in line 569 call freeSavedCall() instead of savedCall.release(bridge);\nIt does that and also sets the call to null", "url": "https://github.com/ionic-team/capacitor/pull/3781#discussion_r521540779", "createdAt": "2020-11-11T17:59:35Z", "author": {"login": "jcesarmobile"}, "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "diffHunk": "@@ -560,20 +560,27 @@ protected void onRequestPermissionsResult(int requestCode, String[] permissions,\n             return;\n         }\n \n-        this.handlePermissions(permissions, grantResults);\n+        if (validatePermissions(permissions, grantResults)) {\n+            savedCall.resolve(getPermissionStates());\n+        } else {\n+            return;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f330760a439e14243d563d64c123ef5dd7193bb1"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTgzNTIzOA==", "bodyText": "thanks, this is a lot cleaner. I applied your suggestion", "url": "https://github.com/ionic-team/capacitor/pull/3781#discussion_r521835238", "createdAt": "2020-11-12T04:41:13Z", "author": {"login": "carlpoole"}, "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "diffHunk": "@@ -560,20 +560,27 @@ protected void onRequestPermissionsResult(int requestCode, String[] permissions,\n             return;\n         }\n \n-        this.handlePermissions(permissions, grantResults);\n+        if (validatePermissions(permissions, grantResults)) {\n+            savedCall.resolve(getPermissionStates());\n+        } else {\n+            return;\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU0MDc3OQ=="}, "originalCommit": {"oid": "f330760a439e14243d563d64c123ef5dd7193bb1"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2OTYzNTEzOnYy", "diffSide": "RIGHT", "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxODowNToyNFrOHxYhnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxODowNToyNFrOHxYhnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTU0NDA5NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        savedLastCall = null;\n          \n      \n    \n    \n  \n\ndon't set the call to null, let the code after the removed else do it.", "url": "https://github.com/ionic-team/capacitor/pull/3781#discussion_r521544095", "createdAt": "2020-11-11T18:05:24Z", "author": {"login": "jcesarmobile"}, "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "diffHunk": "@@ -602,6 +609,20 @@ public void handlePermissions(String[] permissions, int[] grantResults) {\n                 editor.apply();\n             }\n         }\n+\n+        if (!hasDefinedPermissions(permissions)) {\n+            StringBuilder builder = new StringBuilder();\n+            builder.append(\"Missing the following permissions in AndroidManifest.xml:\\n\");\n+            String[] missing = PermissionHelper.getUndefinedPermissions(getContext(), permissions);\n+            for (String perm : missing) {\n+                builder.append(perm + \"\\n\");\n+            }\n+            savedLastCall.reject(builder.toString());\n+            savedLastCall = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f330760a439e14243d563d64c123ef5dd7193bb1"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3452, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}