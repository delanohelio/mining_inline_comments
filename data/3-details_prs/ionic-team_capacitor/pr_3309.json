{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0NDE5NjQ3", "number": 3309, "title": "add preserveAspectRatio to CameraOptions while resizing an image", "bodyText": "This PR is a re-opening of #3297 because of wrong base branch and a retry of #2050 and should fix ionic-team/capacitor-plugins#2 (also the discussion #1952). I've used the Android implementation of @sandstrom (shout-out) and also did an implementation for iOS.\nThere's now a preserveAspectRatio flag on CameraOptions which is set to false by default.\nI've also fixed a bug where the app would crash while saving an image to the gallery on Android. This only happens on certain devices but I was able to reproduce it by creating 32 images until it crashed. A random UUID gets now appended to the file name to make sure no name clashes happen anymore.\n@dwieeb is there anything I can do to provide some testing or how do you test this fix?", "createdAt": "2020-07-21T11:39:26Z", "url": "https://github.com/ionic-team/capacitor/pull/3309", "merged": true, "mergeCommit": {"oid": "27a8bcba31e7224c0ec533af96fca9450086ea31"}, "closed": true, "closedAt": "2020-07-24T18:06:01Z", "author": {"login": "iphilgood"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3CwxeAH2gAyNDU0NDE5NjQ3OjhlZDlkZGQwYmY5MjRmNDkxZmRlYzY2YzA5YTI3NDA3M2I5YzAyZDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4Ht64AFqTQ1NTA3MzY0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8ed9ddd0bf924f491fdec66c09a274073b9c02d5", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/8ed9ddd0bf924f491fdec66c09a274073b9c02d5", "committedDate": "2020-07-21T09:25:00Z", "message": "Merge remote-tracking branch 'upstream/2.x' into 2.x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41c5c5d7b487738f25af6b28d0a32d46dbec9af7", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/41c5c5d7b487738f25af6b28d0a32d46dbec9af7", "committedDate": "2020-07-21T10:12:00Z", "message": "add preserveAspectRatio to CameraOptions to preserve aspect ratio of image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79863659188fcd59bd219a004f37e2226abf0bcb", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/79863659188fcd59bd219a004f37e2226abf0bcb", "committedDate": "2020-07-21T10:12:24Z", "message": "prevent app crash while saving to gallery on android"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNzE4MDAy", "url": "https://github.com/ionic-team/capacitor/pull/3309#pullrequestreview-452718002", "createdAt": "2020-07-21T18:21:28Z", "commit": {"oid": "79863659188fcd59bd219a004f37e2226abf0bcb"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODoyMToyOFrOG1EZIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODoyNDo0OVrOG1EgYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5OTY4Mw==", "bodyText": "Will this be a breaking change? You've added a new parameter to this public method in the Android platform. Will calls such as ImageUtils.resize(bitmap, 100, 100) continue to work?\nYou can mitigate this by adding the following method:\n  public static Bitmap resize(Bitmap bitmap, final int width, final int height) {\n    resize(bitmap, width, height, false);\n  }", "url": "https://github.com/ionic-team/capacitor/pull/3309#discussion_r458299683", "createdAt": "2020-07-21T18:21:28Z", "author": {"login": "imhoffd"}, "path": "android/capacitor/src/main/java/com/getcapacitor/plugin/camera/ImageUtils.java", "diffHunk": "@@ -17,6 +17,21 @@\n \n public class ImageUtils {\n \n+  /**\n+   * Resize an image to the given width and height considering the preserveAspectRatio flag.\n+   * @param bitmap\n+   * @param width\n+   * @param height\n+   * @param preserveAspectRatio\n+   * @return a new, scaled Bitmap\n+   */\n+  public static Bitmap resize(Bitmap bitmap, final int width, final int height, final boolean preserveAspectRatio) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79863659188fcd59bd219a004f37e2226abf0bcb"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMTUzOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Wheter to preserve the aspect ratio of the image.\n          \n          \n            \n               * If the this flag is true the width and height will be used as max values\n          \n          \n            \n               * and the aspect ratio will be preserved\n          \n          \n            \n               * Default: false\n          \n          \n            \n               * Whether to preserve the aspect ratio of the image.\n          \n          \n            \n               * If this flag is true, the width and height will be used as max values\n          \n          \n            \n               * and the aspect ratio will be preserved.\n          \n          \n            \n               * Default: false", "url": "https://github.com/ionic-team/capacitor/pull/3309#discussion_r458301539", "createdAt": "2020-07-21T18:24:49Z", "author": {"login": "imhoffd"}, "path": "core/src/core-plugin-definitions.ts", "diffHunk": "@@ -321,6 +321,13 @@ export interface CameraOptions {\n    * The height of the saved image\n    */\n   height?: number;\n+  /**\n+   * Wheter to preserve the aspect ratio of the image.\n+   * If the this flag is true the width and height will be used as max values\n+   * and the aspect ratio will be preserved\n+   * Default: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79863659188fcd59bd219a004f37e2226abf0bcb"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "beec0bc78c73a08acf092001ea4d34bb49213505", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/beec0bc78c73a08acf092001ea4d34bb49213505", "committedDate": "2020-07-22T07:03:49Z", "message": "re-add resize method without preserveAspectRatio flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2138fc590b09370c38c6d2ad0981d421b20406aa", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/2138fc590b09370c38c6d2ad0981d421b20406aa", "committedDate": "2020-07-22T07:04:41Z", "message": "update doc of preserveAspectRatio flag in CameraOptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9025dd394426566ce822a030bd980895aee9df4", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/d9025dd394426566ce822a030bd980895aee9df4", "committedDate": "2020-07-22T07:07:49Z", "message": "add missing return statement :grin:"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec45c8ee33ca30cf1d21e104645bfc41ad97573d", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/ec45c8ee33ca30cf1d21e104645bfc41ad97573d", "committedDate": "2020-07-22T07:14:05Z", "message": "add missing semicolon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bd7192d91f59ca19d26de5af09aff3945ad1aa3", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/9bd7192d91f59ca19d26de5af09aff3945ad1aa3", "committedDate": "2020-07-22T08:01:52Z", "message": "add camera button to test preserved aspect ratio"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNjg3NTAz", "url": "https://github.com/ionic-team/capacitor/pull/3309#pullrequestreview-453687503", "createdAt": "2020-07-22T21:10:01Z", "commit": {"oid": "9bd7192d91f59ca19d26de5af09aff3945ad1aa3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MzI2ODYx", "url": "https://github.com/ionic-team/capacitor/pull/3309#pullrequestreview-454326861", "createdAt": "2020-07-23T16:59:51Z", "commit": {"oid": "9bd7192d91f59ca19d26de5af09aff3945ad1aa3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNjo1OTo1MlrOG2Tdfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNzowMjowN1rOG2Ti5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU5NTEzNA==", "bodyText": "This is not related to the aspect ratio PR, please, keep separate fixes in separate PRs so they can be evaluated independently and the git history have proper information about this change.\nAlso, instead of using UUID, you can get the image name from the path, it should be unique too since is generated from the timeStamp of when the picture was taken", "url": "https://github.com/ionic-team/capacitor/pull/3309#discussion_r459595134", "createdAt": "2020-07-23T16:59:52Z", "author": {"login": "jcesarmobile"}, "path": "android/capacitor/src/main/java/com/getcapacitor/plugin/Camera.java", "diffHunk": "@@ -341,7 +343,12 @@ private void returnResult(PluginCall call, Bitmap bitmap, Uri u) {\n     if (saveToGallery && (imageEditedFileSavePath != null || imageFileSavePath != null)) {\n       try {\n         String fileToSave = imageEditedFileSavePath != null ? imageEditedFileSavePath : imageFileSavePath;\n-        MediaStore.Images.Media.insertImage(getActivity().getContentResolver(), fileToSave, \"\", \"\");\n+        MediaStore.Images.Media.insertImage(\n+            getActivity().getContentResolver(),\n+            fileToSave,\n+            \"IMG_\" + UUID.randomUUID().toString(),\n+            \"\"\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bd7192d91f59ca19d26de5af09aff3945ad1aa3"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU5NjUxOA==", "bodyText": "Aspect ratio is already respected if only height or width is passed, so this should make more clear that is for when both height and width are passed", "url": "https://github.com/ionic-team/capacitor/pull/3309#discussion_r459596518", "createdAt": "2020-07-23T17:02:07Z", "author": {"login": "jcesarmobile"}, "path": "core/src/core-plugin-definitions.ts", "diffHunk": "@@ -321,6 +321,13 @@ export interface CameraOptions {\n    * The height of the saved image\n    */\n   height?: number;\n+  /**\n+   * Whether to preserve the aspect ratio of the image.\n+   * If this flag is true, the width and height will be used as max values\n+   * and the aspect ratio will be preserved.\n+   * Default: false\n+   */\n+  preserveAspectRatio?: boolean;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bd7192d91f59ca19d26de5af09aff3945ad1aa3"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd850719c2269dc41c928c769cbbedf3d9e0a9b7", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/dd850719c2269dc41c928c769cbbedf3d9e0a9b7", "committedDate": "2020-07-24T14:56:01Z", "message": "restore save to gallery handling on android\n\nit has nothing to do with aspect ratio"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6db358b716d33e495d33c70c705ee16163a7d3b1", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/6db358b716d33e495d33c70c705ee16163a7d3b1", "committedDate": "2020-07-24T14:57:21Z", "message": "Merge remote-tracking branch 'upstream/2.x' into preserve-aspect-ratio-2.x"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02a4ea9bc8e78cfd883c342ca5d11e07ab99a7e6", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/02a4ea9bc8e78cfd883c342ca5d11e07ab99a7e6", "committedDate": "2020-07-24T15:05:38Z", "message": "remove unused UUID import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4869ef8b9e7a8f67ccfa8350ff3e00e8facf10fc", "author": {"user": {"login": "iphilgood", "name": "Phil Schilter"}}, "url": "https://github.com/ionic-team/capacitor/commit/4869ef8b9e7a8f67ccfa8350ff3e00e8facf10fc", "committedDate": "2020-07-24T17:39:23Z", "message": "update the definition of preserveAspectRatio in CameraOptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MDczMDg3", "url": "https://github.com/ionic-team/capacitor/pull/3309#pullrequestreview-455073087", "createdAt": "2020-07-24T17:44:22Z", "commit": {"oid": "4869ef8b9e7a8f67ccfa8350ff3e00e8facf10fc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNzo0NDoyMlrOG24TNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNzo0NDoyMlrOG24TNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE5ODcxMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * both a width and height is passed. When only width or height is provided\n          \n          \n            \n               * both a width and height are passed. When only width or height is provided", "url": "https://github.com/ionic-team/capacitor/pull/3309#discussion_r460198711", "createdAt": "2020-07-24T17:44:22Z", "author": {"login": "jcesarmobile"}, "path": "core/src/core-plugin-definitions.ts", "diffHunk": "@@ -321,6 +321,18 @@ export interface CameraOptions {\n    * The height of the saved image\n    */\n   height?: number;\n+  /**\n+   * Whether to preserve the aspect ratio of the image.\n+   * If this flag is true, the width and height will be used as max values\n+   * and the aspect ratio will be preserved. This is only relevant when\n+   * both a width and height is passed. When only width or height is provided", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4869ef8b9e7a8f67ccfa8350ff3e00e8facf10fc"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f89c07deb1804cdf8771cd4c4e07a401068d5af", "author": {"user": {"login": "jcesarmobile", "name": "jcesarmobile"}}, "url": "https://github.com/ionic-team/capacitor/commit/8f89c07deb1804cdf8771cd4c4e07a401068d5af", "committedDate": "2020-07-24T17:45:00Z", "message": "fix typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MDczNjQ1", "url": "https://github.com/ionic-team/capacitor/pull/3309#pullrequestreview-455073645", "createdAt": "2020-07-24T17:45:20Z", "commit": {"oid": "8f89c07deb1804cdf8771cd4c4e07a401068d5af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1134, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}