{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNjU5NTcw", "number": 3967, "title": "refactor(android): represent permission states using enum", "bodyText": "Breaks current plugins targeting 3.0 alphas/beta.\nExample use:\n@Override\nprotected void onRequestPermissionsResult(PluginCall savedCall, Map<String, PermissionState> permissionResults) {\n    if (savedCall.getMethodName().equals(\"takePhoto\")) {\n        if(permissionResults.get(CAMERA_ALIAS) == PermissionState.GRANTED){\n            camera.takePhoto();\n        } else {\n            savedCall.reject(\"Permission for Camera was not granted\");\n        }\n    } else if (savedCall.getMethodName().equals(\"write\")) {\n        if(permissionResults.get(STORAGE_ALIAS) == PermissionState.GRANTED){\n            camera.write();\n        } else {\n            savedCall.reject(\"Permission for Storage was not granted\");\n        }\n    }\n}", "createdAt": "2020-12-18T16:49:44Z", "url": "https://github.com/ionic-team/capacitor/pull/3967", "merged": true, "mergeCommit": {"oid": "67a0eba10a13e1a6354c372059323d5857da2e24"}, "closed": true, "closedAt": "2020-12-18T23:07:43Z", "author": {"login": "carlpoole"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnJbgIAH2gAyNTQyNjU5NTcwOjQ5NGRiYWExYjE3MmViY2ZhZDFlMGYzMzdlNzcyZjg1NTMzYTIwYjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdngXdWAFqTU1NTg2OTY3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "494dbaa1b172ebcfad1e0f337e772f85533a20b0", "author": {"user": {"login": "carlpoole", "name": "Carl Poole"}}, "url": "https://github.com/ionic-team/capacitor/commit/494dbaa1b172ebcfad1e0f337e772f85533a20b0", "committedDate": "2020-12-17T20:19:28Z", "message": "removing requestCode, permissions, grantResults from onRequestPermissionsResult and providing states"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fb263422d9e014d52c06dc16eaf5b17a945e4c9", "author": {"user": {"login": "carlpoole", "name": "Carl Poole"}}, "url": "https://github.com/ionic-team/capacitor/commit/8fb263422d9e014d52c06dc16eaf5b17a945e4c9", "committedDate": "2020-12-17T22:39:48Z", "message": "saving work so far"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2b78912c96a9a1526d77a6ff81ef68e0c147713", "author": {"user": {"login": "carlpoole", "name": "Carl Poole"}}, "url": "https://github.com/ionic-team/capacitor/commit/d2b78912c96a9a1526d77a6ff81ef68e0c147713", "committedDate": "2020-12-17T23:00:49Z", "message": "Replace internal use of JSObject with Map"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da44f4453eb43d28870603630b7fe9db1b2e4566", "author": {"user": {"login": "carlpoole", "name": "Carl Poole"}}, "url": "https://github.com/ionic-team/capacitor/commit/da44f4453eb43d28870603630b7fe9db1b2e4566", "committedDate": "2020-12-17T23:12:14Z", "message": "Merge branch 'perm-states-type' into perm-result"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17d6ed5e74d26f9d19d67ac938822a9ba2d448da", "author": {"user": {"login": "carlpoole", "name": "Carl Poole"}}, "url": "https://github.com/ionic-team/capacitor/commit/17d6ed5e74d26f9d19d67ac938822a9ba2d448da", "committedDate": "2020-12-17T23:46:18Z", "message": "new PermissionState enum to represent the permission states possible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2af06a2add0537f8615240fb05eb1fc78eb9f950", "author": {"user": {"login": "carlpoole", "name": "Carl Poole"}}, "url": "https://github.com/ionic-team/capacitor/commit/2af06a2add0537f8615240fb05eb1fc78eb9f950", "committedDate": "2020-12-17T23:47:03Z", "message": "Merge branch 'perm-states-type' into perm-result"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d4886efb34918d98cabcd8d575b6566fbec5806", "author": {"user": {"login": "carlpoole", "name": "Carl Poole"}}, "url": "https://github.com/ionic-team/capacitor/commit/0d4886efb34918d98cabcd8d575b6566fbec5806", "committedDate": "2020-12-18T16:10:21Z", "message": "remove JSObject update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3789cf0c040a4a77d38664dd016402cfd01a7c99", "author": {"user": {"login": "carlpoole", "name": "Carl Poole"}}, "url": "https://github.com/ionic-team/capacitor/commit/3789cf0c040a4a77d38664dd016402cfd01a7c99", "committedDate": "2020-12-18T16:45:45Z", "message": "doc and removed unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1ODQ4NDQy", "url": "https://github.com/ionic-team/capacitor/pull/3967#pullrequestreview-555848442", "createdAt": "2020-12-18T22:21:40Z", "commit": {"oid": "3789cf0c040a4a77d38664dd016402cfd01a7c99"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQyMjoyMTo0MVrOII0bAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQyMjoyMzoyNlrOII0dnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjExODQwMg==", "bodyText": "We should probably rephrase this to talk about the \"alias\"", "url": "https://github.com/ionic-team/capacitor/pull/3967#discussion_r546118402", "createdAt": "2020-12-18T22:21:41Z", "author": {"login": "imhoffd"}, "path": "android/capacitor/src/main/java/com/getcapacitor/Plugin.java", "diffHunk": "@@ -364,9 +363,9 @@ public void pluginRequestPermission(String permission, int requestCode) {\n      * Helper to check all permissions defined on a plugin and see the state of each.\n      *\n      * @since 3.0.0\n-     * @return an object containing the permission names and the permission result\n+     * @return an map containing the permission names and the permission state", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3789cf0c040a4a77d38664dd016402cfd01a7c99"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjExOTA3MQ==", "bodyText": "Do we want to call the plugin instance version?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    plugin.getInstance().onRequestPermissionsResult(savedPermissionCall, getPermissionStates(plugin.getInstance()));\n          \n          \n            \n                                    plugin.getInstance().onRequestPermissionsResult(savedPermissionCall, plugin.getInstance().getPermissionStates());", "url": "https://github.com/ionic-team/capacitor/pull/3967#discussion_r546119071", "createdAt": "2020-12-18T22:23:26Z", "author": {"login": "imhoffd"}, "path": "android/capacitor/src/main/java/com/getcapacitor/Bridge.java", "diffHunk": "@@ -786,10 +787,10 @@ public void onRequestPermissionsResult(int requestCode, String[] permissions, in\n                 if (validatePermissions(plugin.getInstance(), savedPermissionCall, permissions, grantResults)) {\n                     // handle request permissions call\n                     if (savedPermissionCall.getMethodName().equals(\"requestPermissions\")) {\n-                        savedPermissionCall.resolve(plugin.getInstance().getPermissionStates());\n+                        plugin.getInstance().checkPermissions(savedPermissionCall);\n                     } else {\n                         // handle permission requests by other methods on the plugin\n-                        plugin.getInstance().onRequestPermissionsResult(savedPermissionCall, requestCode, permissions, grantResults);\n+                        plugin.getInstance().onRequestPermissionsResult(savedPermissionCall, getPermissionStates(plugin.getInstance()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3789cf0c040a4a77d38664dd016402cfd01a7c99"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1e0f3b5d97e6ca0c5eaad4b3e13c6844536aa1a", "author": {"user": {"login": "carlpoole", "name": "Carl Poole"}}, "url": "https://github.com/ionic-team/capacitor/commit/d1e0f3b5d97e6ca0c5eaad4b3e13c6844536aa1a", "committedDate": "2020-12-18T22:39:35Z", "message": "call plugin getPermissionStates\n\nCo-authored-by: Dan Imhoff <dwieeb@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3aafb44c51feecb7c450922a27d00247cb01a43b", "author": {"user": {"login": "carlpoole", "name": "Carl Poole"}}, "url": "https://github.com/ionic-team/capacitor/commit/3aafb44c51feecb7c450922a27d00247cb01a43b", "committedDate": "2020-12-18T22:45:15Z", "message": "clarified javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1ODY5Njcw", "url": "https://github.com/ionic-team/capacitor/pull/3967#pullrequestreview-555869670", "createdAt": "2020-12-18T23:02:52Z", "commit": {"oid": "3aafb44c51feecb7c450922a27d00247cb01a43b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1044, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}