{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1OTc2NTk4", "number": 7998, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODoyNDozN1rODZ7kJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0NTowM1rODbRQAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NTE2OTAzOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODoyNDozN1rOFgmTow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOTozNjo1MFrOFgogHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcyNjM3MQ==", "bodyText": "We should say that TLSv1 and TLSv1.1 are also discouraged.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r369726371", "createdAt": "2020-01-22T18:24:37Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,7 +50,7 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"\n-            + \"Allowed values in recent JVMs are TLS, TLSv1.1 and TLSv1.2. SSL, SSLv2 and SSLv3 \"\n+            + \"Allowed values in recent JVMs are TLS, TLSv1.1, TLSv1.2 and TLSv1.3. SSL, SSLv2 and SSLv3 \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc2MjMzMg==", "bodyText": "Fixed.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r369762332", "createdAt": "2020-01-22T19:36:50Z", "author": {"login": "nizhikov"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,7 +50,7 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"\n-            + \"Allowed values in recent JVMs are TLS, TLSv1.1 and TLSv1.2. SSL, SSLv2 and SSLv3 \"\n+            + \"Allowed values in recent JVMs are TLS, TLSv1.1, TLSv1.2 and TLSv1.3. SSL, SSLv2 and SSLv3 \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcyNjM3MQ=="}, "originalCommit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NTE3MDIwOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODoyNTowNlrOFgmUbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOTozNjo1OFrOFgogWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcyNjU3Mw==", "bodyText": "We should make this TLSv1.2 as well.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r369726573", "createdAt": "2020-01-22T18:25:06Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,7 +50,7 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"\n-            + \"Allowed values in recent JVMs are TLS, TLSv1.1 and TLSv1.2. SSL, SSLv2 and SSLv3 \"\n+            + \"Allowed values in recent JVMs are TLS, TLSv1.1, TLSv1.2 and TLSv1.3. SSL, SSLv2 and SSLv3 \"\n             + \"may be supported in older JVMs, but their usage is discouraged due to known security vulnerabilities.\";\n \n     public static final String DEFAULT_SSL_PROTOCOL = \"TLS\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc2MjM5Mg==", "bodyText": "Fixed.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r369762392", "createdAt": "2020-01-22T19:36:58Z", "author": {"login": "nizhikov"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,7 +50,7 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"\n-            + \"Allowed values in recent JVMs are TLS, TLSv1.1 and TLSv1.2. SSL, SSLv2 and SSLv3 \"\n+            + \"Allowed values in recent JVMs are TLS, TLSv1.1, TLSv1.2 and TLSv1.3. SSL, SSLv2 and SSLv3 \"\n             + \"may be supported in older JVMs, but their usage is discouraged due to known security vulnerabilities.\";\n \n     public static final String DEFAULT_SSL_PROTOCOL = \"TLS\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcyNjU3Mw=="}, "originalCommit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NTE5MDM5OnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODozMToxNVrOFgmg9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODo0MjozNFrOFgm3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcyOTc4Mg==", "bodyText": "Does this need to change as well?  Or does the enabled protocol list constrain it?", "url": "https://github.com/apache/kafka/pull/7998#discussion_r369729782", "createdAt": "2020-01-22T18:31:15Z", "author": {"login": "rondagostino"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,7 +50,7 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"\n-            + \"Allowed values in recent JVMs are TLS, TLSv1.1 and TLSv1.2. SSL, SSLv2 and SSLv3 \"\n+            + \"Allowed values in recent JVMs are TLS, TLSv1.1, TLSv1.2 and TLSv1.3. SSL, SSLv2 and SSLv3 \"\n             + \"may be supported in older JVMs, but their usage is discouraged due to known security vulnerabilities.\";\n \n     public static final String DEFAULT_SSL_PROTOCOL = \"TLS\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTczNTQ4MA==", "bodyText": "It seems, doc inconsistent for now.\nWe do support TLVv1.3.\nsee e275742", "url": "https://github.com/apache/kafka/pull/7998#discussion_r369735480", "createdAt": "2020-01-22T18:42:34Z", "author": {"login": "nizhikov"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,7 +50,7 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"\n-            + \"Allowed values in recent JVMs are TLS, TLSv1.1 and TLSv1.2. SSL, SSLv2 and SSLv3 \"\n+            + \"Allowed values in recent JVMs are TLS, TLSv1.1, TLSv1.2 and TLSv1.3. SSL, SSLv2 and SSLv3 \"\n             + \"may be supported in older JVMs, but their usage is discouraged due to known security vulnerabilities.\";\n \n     public static final String DEFAULT_SSL_PROTOCOL = \"TLS\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcyOTc4Mg=="}, "originalCommit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQ1NDUxOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjoxMjo0NVrOFiiyjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMzoxNjo0NVrOFikitQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2NTkwMg==", "bodyText": "Can you update this to say TLSv1.2?", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371765902", "createdAt": "2020-01-28T12:12:45Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,10 +50,10 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc5NDYxMw==", "bodyText": "fixed.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371794613", "createdAt": "2020-01-28T13:16:45Z", "author": {"login": "nizhikov"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,10 +50,10 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2NTkwMg=="}, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQ3Njg0OnYy", "diffSide": "RIGHT", "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjoyMDo0NVrOFii_yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMzozNToyM1rOFilIaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2OTI5MQ==", "bodyText": "It would be better to use NetworkTestUtils.checkClientConnection(selector, node, 100, 10); which actually uses the connection.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371769291", "createdAt": "2020-01-28T12:20:45Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -551,6 +551,35 @@ public void testInvalidKeyPassword() throws Exception {\n         server.verifyAuthenticationMetrics(0, 1);\n     }\n \n+    /**\n+     * Tests that connection sucess with the default TLS version.\n+     */\n+    @Test\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);\n+\n+        server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        final String node = \"0\";\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(node, addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.waitForChannelClose(selector, node, ChannelState.State.READY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgwNDI2NA==", "bodyText": "Fixed.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371804264", "createdAt": "2020-01-28T13:35:23Z", "author": {"login": "nizhikov"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -551,6 +551,35 @@ public void testInvalidKeyPassword() throws Exception {\n         server.verifyAuthenticationMetrics(0, 1);\n     }\n \n+    /**\n+     * Tests that connection sucess with the default TLS version.\n+     */\n+    @Test\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);\n+\n+        server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        final String node = \"0\";\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(node, addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.waitForChannelClose(selector, node, ChannelState.State.READY);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2OTI5MQ=="}, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQ4OTUzOnYy", "diffSide": "RIGHT", "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjoyNToxOFrOFijHNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMzo1NDo1NFrOFilxrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MTE5MQ==", "bodyText": "Not sure if these configs actually come from the default configs. I think these may be explicitly configured in the tests.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371771191", "createdAt": "2020-01-28T12:25:18Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -551,6 +551,35 @@ public void testInvalidKeyPassword() throws Exception {\n         server.verifyAuthenticationMetrics(0, 1);\n     }\n \n+    /**\n+     * Tests that connection sucess with the default TLS version.\n+     */\n+    @Test\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxNDgyOQ==", "bodyText": "This comes from TestSslUtils#DEFAULT_TLS_PROTOCOL_FOR_TESTS - chaned it to\n    public static final String DEFAULT_TLS_PROTOCOL_FOR_TESTS = SslConfigs.DEFAULT_SSL_PROTOCOL;", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371814829", "createdAt": "2020-01-28T13:54:54Z", "author": {"login": "nizhikov"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -551,6 +551,35 @@ public void testInvalidKeyPassword() throws Exception {\n         server.verifyAuthenticationMetrics(0, 1);\n     }\n \n+    /**\n+     * Tests that connection sucess with the default TLS version.\n+     */\n+    @Test\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MTE5MQ=="}, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODQ5MjQxOnYy", "diffSide": "RIGHT", "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjoyNjoxMVrOFijI7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMzo0Njo1NVrOFilgBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MTYyOA==", "bodyText": "We should also create a client connection with one of the newly disabled protocols like TLSv1.1 and verify that the client connection fails.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371771628", "createdAt": "2020-01-28T12:26:11Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -551,6 +551,35 @@ public void testInvalidKeyPassword() throws Exception {\n         server.verifyAuthenticationMetrics(0, 1);\n     }\n \n+    /**\n+     * Tests that connection sucess with the default TLS version.\n+     */\n+    @Test\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);\n+\n+        server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        final String node = \"0\";\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(node, addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.waitForChannelClose(selector, node, ChannelState.State.READY);\n+        server.verifyAuthenticationMetrics(1, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxMDMwOQ==", "bodyText": "Done.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371810309", "createdAt": "2020-01-28T13:46:55Z", "author": {"login": "nizhikov"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -551,6 +551,35 @@ public void testInvalidKeyPassword() throws Exception {\n         server.verifyAuthenticationMetrics(0, 1);\n     }\n \n+    /**\n+     * Tests that connection sucess with the default TLS version.\n+     */\n+    @Test\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);\n+\n+        server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        final String node = \"0\";\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(node, addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.waitForChannelClose(selector, node, ChannelState.State.READY);\n+        server.verifyAuthenticationMetrics(1, 0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MTYyOA=="}, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODg4Njg1OnYy", "diffSide": "RIGHT", "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyNjoxOVrOFim4SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDozNDowOFrOFinL9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzMjkwNA==", "bodyText": "nit: typo success\nAlso mention that it tests that insecure protocols are not enabled by default.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371832904", "createdAt": "2020-01-28T14:26:19Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,60 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection sucess with the default TLS version.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f90f72505beaf68bc82d6c8dea8a34d97e532c58"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzNzk0MA==", "bodyText": "Fixed.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371837940", "createdAt": "2020-01-28T14:34:08Z", "author": {"login": "nizhikov"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,60 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection sucess with the default TLS version.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzMjkwNA=="}, "originalCommit": {"oid": "f90f72505beaf68bc82d6c8dea8a34d97e532c58"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODg5MDU5OnYy", "diffSide": "RIGHT", "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyNzoxN1rOFim6jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDozNjo0N1rOFinSiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzMzQ4NA==", "bodyText": "This selector is never used since we create a Selector a couple of lines below using createSelector. We should remove these three lines and the logContext created at the start of this test.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371833484", "createdAt": "2020-01-28T14:27:17Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,60 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection sucess with the default TLS version.\n      */\n     @Test\n-    public void testUnsupportedTLSVersion() throws Exception {\n-        String node = \"0\";\n-        sslServerConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.2\"));\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f90f72505beaf68bc82d6c8dea8a34d97e532c58"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzOTYyNQ==", "bodyText": "Fixed.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371839625", "createdAt": "2020-01-28T14:36:47Z", "author": {"login": "nizhikov"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,60 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection sucess with the default TLS version.\n      */\n     @Test\n-    public void testUnsupportedTLSVersion() throws Exception {\n-        String node = \"0\";\n-        sslServerConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.2\"));\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzMzQ4NA=="}, "originalCommit": {"oid": "f90f72505beaf68bc82d6c8dea8a34d97e532c58"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODg5Njc1OnYy", "diffSide": "RIGHT", "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyODo0OFrOFim-bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDozNjozOFrOFinSIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzNDQ3Ng==", "bodyText": "We tend to use different node value when multiple connections are created by a test. You could just replace node here with \"1\" and a couple of lines below with \"2\".", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371834476", "createdAt": "2020-01-28T14:28:48Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,60 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection sucess with the default TLS version.\n      */\n     @Test\n-    public void testUnsupportedTLSVersion() throws Exception {\n-        String node = \"0\";\n-        sslServerConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.2\"));\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);\n+\n         server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        final String node = \"0\";\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(node, addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.checkClientConnection(selector, node, 10, 100);\n+        server.verifyAuthenticationMetrics(1, 0);\n \n-        sslClientConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.1\"));\n+        checkAuthentiationFailed(node, \"TLSv1.1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f90f72505beaf68bc82d6c8dea8a34d97e532c58"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzOTUyMg==", "bodyText": "Fixed.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371839522", "createdAt": "2020-01-28T14:36:38Z", "author": {"login": "nizhikov"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,60 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection sucess with the default TLS version.\n      */\n     @Test\n-    public void testUnsupportedTLSVersion() throws Exception {\n-        String node = \"0\";\n-        sslServerConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.2\"));\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);\n+\n         server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        final String node = \"0\";\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(node, addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.checkClientConnection(selector, node, 10, 100);\n+        server.verifyAuthenticationMetrics(1, 0);\n \n-        sslClientConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.1\"));\n+        checkAuthentiationFailed(node, \"TLSv1.1\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzNDQ3Ng=="}, "originalCommit": {"oid": "f90f72505beaf68bc82d6c8dea8a34d97e532c58"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5OTIwNzcxOnYy", "diffSide": "RIGHT", "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0NTowM1rOFip_1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo1MDoyMVrOFiqOcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg4Mzk5MA==", "bodyText": "Sorry, missed this earlier: We are creating a new selector in checkAuthentiationFailed, so we should ensure that the previous selector is closed. You could call selector.close() just before calling checkAuthenticationFailed here and also a couple of lines below.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371883990", "createdAt": "2020-01-28T15:45:03Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,51 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection success with the default TLS version.\n      */\n     @Test\n-    public void testUnsupportedTLSVersion() throws Exception {\n-        String node = \"0\";\n-        sslServerConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.2\"));\n+    public void testTLSDefaults() throws Exception {\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n         server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(\"0\", addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.checkClientConnection(selector, \"0\", 10, 100);\n+        server.verifyAuthenticationMetrics(1, 0);\n+\n+        checkAuthentiationFailed(\"1\", \"TLSv1.1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2784b7b35c8aeec9a4b64be7aca47b8daa9e644"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg4NzczMQ==", "bodyText": "Fixed.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371887731", "createdAt": "2020-01-28T15:50:21Z", "author": {"login": "nizhikov"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,51 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection success with the default TLS version.\n      */\n     @Test\n-    public void testUnsupportedTLSVersion() throws Exception {\n-        String node = \"0\";\n-        sslServerConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.2\"));\n+    public void testTLSDefaults() throws Exception {\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n         server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(\"0\", addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.checkClientConnection(selector, \"0\", 10, 100);\n+        server.verifyAuthenticationMetrics(1, 0);\n+\n+        checkAuthentiationFailed(\"1\", \"TLSv1.1\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg4Mzk5MA=="}, "originalCommit": {"oid": "f2784b7b35c8aeec9a4b64be7aca47b8daa9e644"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4422, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}