{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExOTg2MDk1", "number": 9525, "title": "KAFKA-10658 ErrantRecordReporter.report always return completed futur\u2026", "bodyText": "issue: https://issues.apache.org/jira/browse/KAFKA-10658\nThis issue happens when both DLQ and error log are enabled. There is a incorrect filter in handling multiple reports and it results in the uncompleted future is filtered out. Hence, users always receive a completed future even though the record is still in producer buffer.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-10-29T03:32:48Z", "url": "https://github.com/apache/kafka/pull/9525", "merged": true, "mergeCommit": {"oid": "923dea34b8b778a17080a3d8a4d9d9f36410e1ba"}, "closed": true, "closedAt": "2021-01-28T06:12:55Z", "author": {"login": "chia7712"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXO3-LAFqTUxOTQ4MTgzMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABd0eDX4AFqTU3ODAwMjI0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NDgxODMw", "url": "https://github.com/apache/kafka/pull/9525#pullrequestreview-519481830", "createdAt": "2020-10-29T09:35:21Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTozNToyMlrOHqTfww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwOTozNToyMlrOHqTfww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDEyMTY2Nw==", "bodyText": "testReportWithTwoReporters -> testReportWithMultipleReporters", "url": "https://github.com/apache/kafka/pull/9525#discussion_r514121667", "createdAt": "2020-10-29T09:35:22Z", "author": {"login": "showuon"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/errors/ProcessingContextTest.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.connect.runtime.errors;\n+\n+import org.apache.kafka.clients.producer.RecordMetadata;\n+import org.apache.kafka.common.TopicPartition;\n+import org.junit.Test;\n+\n+import java.util.List;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.Future;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+\n+public class ProcessingContextTest {\n+\n+    @Test\n+    public void testReportWithSingleReporter() {\n+        testReport(1);\n+    }\n+\n+    @Test\n+    public void testReportWithTwoReporters() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 40}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "14f83e4a970104b0a0085a0b835efe8e58e73c68", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/14f83e4a970104b0a0085a0b835efe8e58e73c68", "committedDate": "2020-11-24T07:07:46Z", "message": "KAFKA-10658 ErrantRecordReporter.report always return completed future even though the record is not sent to DLQ topic yet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5710d4e09a7e16ea368bece355d39a441913aacb", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/5710d4e09a7e16ea368bece355d39a441913aacb", "committedDate": "2020-11-24T07:07:46Z", "message": "rename testReportWithTwoReporters to testReportWithMultipleReporters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "5710d4e09a7e16ea368bece355d39a441913aacb", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/5710d4e09a7e16ea368bece355d39a441913aacb", "committedDate": "2020-11-24T07:07:46Z", "message": "rename testReportWithTwoReporters to testReportWithMultipleReporters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3368e8116acf50d8ceb293f7e597da572ce96cbd", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/3368e8116acf50d8ceb293f7e597da572ce96cbd", "committedDate": "2021-01-25T07:21:25Z", "message": "Merge branch 'trunk' into KAFKA-10658"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc4MDAyMjQw", "url": "https://github.com/apache/kafka/pull/9525#pullrequestreview-578002240", "createdAt": "2021-01-28T05:42:08Z", "commit": {"oid": "3368e8116acf50d8ceb293f7e597da572ce96cbd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2625, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}