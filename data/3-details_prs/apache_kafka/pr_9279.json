{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0MzExNTgz", "number": 9279, "title": "MINOR: Fix common struct `JsonConverter` and `Schema` generation", "bodyText": "This patch fixes a couple problems with the use of the StructRegistry. First, it fixes registration so that it is consistently based on the typename of the struct. Previously structs were registered under the field name which meant that fields which referred to common structs resulted in multiple entries. Second, the patch fixes SchemaGenerator so that common structs are considered first.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-09-10T20:45:08Z", "url": "https://github.com/apache/kafka/pull/9279", "merged": true, "mergeCommit": {"oid": "97d1a3248a4184da1e8ef47c1b94986665b941bf"}, "closed": true, "closedAt": "2020-09-17T21:37:52Z", "author": {"login": "hachikuji"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHm9ngAH2gAyNDg0MzExNTgzOjYxYTNjZTdkYmM5MWQ2ZjFiMmQwYzk5MmM2ZDZmNjgxZTUwZDMzNzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI8MqjABqjM3NjU4MTYxNjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61a3ce7dbc91d6f1b2d0c992c6d6f681e50d3375", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/61a3ce7dbc91d6f1b2d0c992c6d6f681e50d3375", "committedDate": "2020-09-10T20:38:24Z", "message": "MINOR: Fix common struct `JsonConverter` and `Schema` generation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MjA0NDU3", "url": "https://github.com/apache/kafka/pull/9279#pullrequestreview-488204457", "createdAt": "2020-09-14T22:41:26Z", "commit": {"oid": "61a3ce7dbc91d6f1b2d0c992c6d6f681e50d3375"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQyMjo0MToyN1rOHRqDLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQyMjo0MToyN1rOHRqDLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODI3Njc4Mg==", "bodyText": "It's not clear whether we need to generate the common struct JSON converters first.  Can you try without (or explain why it needs to be with?)  Or is the iterator returned from structs not returning the correct data for common structs?", "url": "https://github.com/apache/kafka/pull/9279#discussion_r488276782", "createdAt": "2020-09-14T22:41:27Z", "author": {"login": "cmccabe"}, "path": "generator/src/main/java/org/apache/kafka/message/JsonConverterGenerator.java", "diffHunk": "@@ -53,17 +53,17 @@ public void generateAndWrite(MessageSpec message, BufferedWriter writer)\n         buffer.incrementIndent();\n         generateConverters(message.dataClassName(), message.struct(),\n             message.validVersions());\n+\n+        for (Iterator<StructSpec> iter = structRegistry.commonStructs(); iter.hasNext(); ) {\n+            generateStructClass(iter.next(), message.validVersions());\n+        }\n+\n         for (Iterator<StructRegistry.StructInfo> iter = structRegistry.structs();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61a3ce7dbc91d6f1b2d0c992c6d6f681e50d3375"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d7aa5801ed321e94a4f9930dabbcfc597ac62b6", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/9d7aa5801ed321e94a4f9930dabbcfc597ac62b6", "committedDate": "2020-09-14T23:38:03Z", "message": "Track which structs refer to common structs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a3ac41b2e808e255cfc0141a8aeace67dc18219", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/3a3ac41b2e808e255cfc0141a8aeace67dc18219", "committedDate": "2020-09-14T23:56:32Z", "message": "Struct registry should key structs by type name"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "3a3ac41b2e808e255cfc0141a8aeace67dc18219", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/3a3ac41b2e808e255cfc0141a8aeace67dc18219", "committedDate": "2020-09-14T23:56:32Z", "message": "Struct registry should key structs by type name"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 606, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}