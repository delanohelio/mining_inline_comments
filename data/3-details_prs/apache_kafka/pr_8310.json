{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODM5NzYx", "number": 8310, "title": "HOTFIX: fix flaky StateDirectoryTest.shouldReturnEmptyArrayIfListFile\u2026", "bodyText": "StateDirectoryTest.shouldReturnEmptyArrayIfListFilesReturnsNull always moves the stage dir to /tmp/state-renamed so it always fails if there is already a folder (for example, the stuff leaved by previous test)\nWe should just delete the folder to make stage dir disappear\nrelated to #8304\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-03-17T13:34:06Z", "url": "https://github.com/apache/kafka/pull/8310", "merged": true, "mergeCommit": {"oid": "f08c9c7de6f7b85bddc6c83c0d852b5b3b1f430a"}, "closed": true, "closedAt": "2020-03-18T05:13:14Z", "author": {"login": "chia7712"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOpVmDgFqTM3NjQwODA4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOwMc-AFqTM3NjU2NzkzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NDA4MDgz", "url": "https://github.com/apache/kafka/pull/8310#pullrequestreview-376408083", "createdAt": "2020-03-17T21:10:43Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NDE4MDg3", "url": "https://github.com/apache/kafka/pull/8310#pullrequestreview-376418087", "createdAt": "2020-03-17T21:27:27Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMToyNzoyOFrOF3urow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMToyNzoyOFrOF3urow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4MDgzNQ==", "bodyText": "We don't want to remove the stateDir entirely, because then stateDir.exists will return false and we won't actually call listFiles which is what this test is trying to test. Can we just rename to \"state-renamed\" + TestUtils.randomString(5)? Or, clean up the previous contents at the beginning of the test?\nThat said, cleanUp should be called after every test, so there shouldn't be any left over state...right? cc/ @guozhangwang", "url": "https://github.com/apache/kafka/pull/8310#discussion_r393980835", "createdAt": "2020-03-17T21:27:28Z", "author": {"login": "ableegoldman"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StateDirectoryTest.java", "diffHunk": "@@ -329,7 +329,8 @@ public void shouldReturnEmptyArrayIfListFilesReturnsNull() {\n             time, true);\n         appDir = new File(stateDir, applicationId);\n \n-        assertTrue(stateDir.renameTo(new File(TestUtils.IO_TMP_DIR, \"state-renamed\")));\n+        // make stateDir disappear", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81a7328bf46bb055bfb5ce23799fd19885d53cb8", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/81a7328bf46bb055bfb5ce23799fd19885d53cb8", "committedDate": "2020-03-18T04:02:08Z", "message": "HOTFIX: fix flaky StateDirectoryTest.shouldReturnEmptyArrayIfListFilesReturnsNull"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "81a7328bf46bb055bfb5ce23799fd19885d53cb8", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/81a7328bf46bb055bfb5ce23799fd19885d53cb8", "committedDate": "2020-03-18T04:02:08Z", "message": "HOTFIX: fix flaky StateDirectoryTest.shouldReturnEmptyArrayIfListFilesReturnsNull"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NTY3OTM3", "url": "https://github.com/apache/kafka/pull/8310#pullrequestreview-376567937", "createdAt": "2020-03-18T05:10:04Z", "commit": {"oid": "81a7328bf46bb055bfb5ce23799fd19885d53cb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 301, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}