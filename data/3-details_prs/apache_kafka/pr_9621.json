{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzODcwODk1", "number": 9621, "title": "KAFKA-9892: Producer state snapshot needs to be forced to disk", "bodyText": "FileChannel.close() does not guarantee modified buffer would be written on the file system. We are changing  it with force() semantics to enforce file buffer and metadata written to filesystem ( FileChannel.force(true) updates buffer and metadata).\n*Summary of testing strategy (including rationale)\nI have run unittests after making the changes.", "createdAt": "2020-11-19T11:16:49Z", "url": "https://github.com/apache/kafka/pull/9621", "merged": true, "mergeCommit": {"oid": "fa93982d3a65ff800b9bef2039a15421ca1b46c9"}, "closed": true, "closedAt": "2020-12-09T22:13:37Z", "author": {"login": "bristy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeAtz2AH2gAyNTIzODcwODk1Ojg2YmRlZGIyMWE1NmM5YmUxZDMwZTRkMTAzOTNlYzgzMTliMWFlMDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkjeg9gFqTU0ODUxMDU1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "86bdedb21a56c9be1d30e4d10393ec8319b1ae04", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/86bdedb21a56c9be1d30e4d10393ec8319b1ae04", "committedDate": "2020-11-19T11:05:00Z", "message": "Forcing producer snapshot to write on disk. #KAFKA-9892"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NzMxMDE5", "url": "https://github.com/apache/kafka/pull/9621#pullrequestreview-534731019", "createdAt": "2020-11-19T18:25:43Z", "commit": {"oid": "86bdedb21a56c9be1d30e4d10393ec8319b1ae04"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODoyNTo0NFrOH2r85A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODoyNTo0NFrOH2r85A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwNTI1Mg==", "bodyText": "I think we need to do force and then close.", "url": "https://github.com/apache/kafka/pull/9621#discussion_r527105252", "createdAt": "2020-11-19T18:25:44Z", "author": {"login": "junrao"}, "path": "core/src/main/scala/kafka/log/ProducerStateManager.scala", "diffHunk": "@@ -437,7 +437,7 @@ object ProducerStateManager {\n \n     val fileChannel = FileChannel.open(file.toPath, StandardOpenOption.CREATE, StandardOpenOption.WRITE)\n     try fileChannel.write(buffer)\n-    finally fileChannel.close()\n+    finally fileChannel.force(true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86bdedb21a56c9be1d30e4d10393ec8319b1ae04"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ced3d0d9c2956aa8d433d1eff8f2482f3dee330", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/9ced3d0d9c2956aa8d433d1eff8f2482f3dee330", "committedDate": "2020-12-09T18:52:57Z", "message": "Addressed CR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NTA4MDgx", "url": "https://github.com/apache/kafka/pull/9621#pullrequestreview-548508081", "createdAt": "2020-12-09T18:56:17Z", "commit": {"oid": "9ced3d0d9c2956aa8d433d1eff8f2482f3dee330"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NTEwNTU4", "url": "https://github.com/apache/kafka/pull/9621#pullrequestreview-548510558", "createdAt": "2020-12-09T18:58:31Z", "commit": {"oid": "9ced3d0d9c2956aa8d433d1eff8f2482f3dee330"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2827, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}