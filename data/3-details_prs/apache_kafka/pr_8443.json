{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNTc0NTQ2", "number": 8443, "title": "KAFKA-9832: Extend Streams system tests for EOS-beta", "bodyText": "Other system tests that need an update.\nCall for review @abbccdda @guozhangwang\nSystem test for both tests passed:\n\nhttps://jenkins.confluent.io/job/system-test-kafka-branch-builder/3890/\nhttps://jenkins.confluent.io/job/system-test-kafka-branch-builder/3888/", "createdAt": "2020-04-08T01:05:59Z", "url": "https://github.com/apache/kafka/pull/8443", "merged": true, "mergeCommit": {"oid": "20e4a74c3579837df7b46ce1a5dcea37b6e1e452"}, "closed": true, "closedAt": "2020-04-10T18:55:02Z", "author": {"login": "mjsax"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVblKNgH2gAyNDAwNTc0NTQ2OjQ3OTQzMTdmMjM5MDExYWMyMjVlYzRjZDQ1ZTJiMDk2MTE5NDMwOGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWDkgEAFqTM5MTE1MTk0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4794317f239011ac225ec4cd45e2b0961194308a", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/4794317f239011ac225ec4cd45e2b0961194308a", "committedDate": "2020-04-07T23:06:31Z", "message": "KAFKA-9832: Extend Streams system tests for EOS-beta"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5ccabaff269b5c5de80714e967554f1e7e45773", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/d5ccabaff269b5c5de80714e967554f1e7e45773", "committedDate": "2020-04-07T23:31:15Z", "message": "Extend RelationalSmokeTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d05897d258cc0af8f7515e57f4814eb7d76a155", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/6d05897d258cc0af8f7515e57f4814eb7d76a155", "committedDate": "2020-04-07T23:49:23Z", "message": "fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTk1MTM1", "url": "https://github.com/apache/kafka/pull/8443#pullrequestreview-389595135", "createdAt": "2020-04-08T01:25:41Z", "commit": {"oid": "6d05897d258cc0af8f7515e57f4814eb7d76a155"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMToyNTo0MlrOGCbzWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMjozMDoyMVrOGCc2gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwNTg1MA==", "bodyText": "nit: we could add all 3 modes in this test too", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405205850", "createdAt": "2020-04-08T01:25:42Z", "author": {"login": "abbccdda"}, "path": "streams/src/test/java/org/apache/kafka/streams/tests/RelationalSmokeTestTest.java", "diffHunk": "@@ -39,6 +41,7 @@ public void verifySmokeTestLogic() {\n                                             \"nothing:0\",\n                                             \"test\",\n                                             \"test\",\n+                                            StreamsConfig.AT_LEAST_ONCE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d05897d258cc0af8f7515e57f4814eb7d76a155"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIyMzA0MA==", "bodyText": "Reading from the comment, the RelationalSmokeTest has nothing to do with EOS, why do we need to expand this test? cc @vvcephei", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405223040", "createdAt": "2020-04-08T02:30:21Z", "author": {"login": "abbccdda"}, "path": "streams/src/test/java/org/apache/kafka/streams/tests/RelationalSmokeTest.java", "diffHunk": "@@ -637,13 +637,14 @@ public static Topology getTopology() {\n         public static Properties getConfig(final String broker,\n                                            final String application,\n                                            final String id,\n+                                           final String processingGuarantee,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d05897d258cc0af8f7515e57f4814eb7d76a155"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMjE0NjIx", "url": "https://github.com/apache/kafka/pull/8443#pullrequestreview-390214621", "createdAt": "2020-04-08T18:12:31Z", "commit": {"oid": "6d05897d258cc0af8f7515e57f4814eb7d76a155"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxODoxMjozMlrOGC7Fzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxODoxMjozMlrOGC7Fzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcxODQ3OA==", "bodyText": "I think it worth adding both eos mode for this test --- if we only have this test with eos-beta there may be some regressions not captured.\nIn the future, when we deprecate eos-alpha in some release version that requires broker > 2.5 we can remove eos-alpha parameters in all these.", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405718478", "createdAt": "2020-04-08T18:12:32Z", "author": {"login": "guozhangwang"}, "path": "streams/src/test/java/org/apache/kafka/streams/tests/RelationalSmokeTest.java", "diffHunk": "@@ -637,13 +637,14 @@ public static Topology getTopology() {\n         public static Properties getConfig(final String broker,\n                                            final String application,\n                                            final String id,\n+                                           final String processingGuarantee,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIyMzA0MA=="}, "originalCommit": {"oid": "6d05897d258cc0af8f7515e57f4814eb7d76a155"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f7ee56278adb524ab04ec1cde667ec8e06e69ed", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/6f7ee56278adb524ab04ec1cde667ec8e06e69ed", "committedDate": "2020-04-09T01:44:45Z", "message": "Set transaction.id correctly"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNDQwMzEx", "url": "https://github.com/apache/kafka/pull/8443#pullrequestreview-390440311", "createdAt": "2020-04-09T01:46:32Z", "commit": {"oid": "6f7ee56278adb524ab04ec1cde667ec8e06e69ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMTo0NjozMlrOGDGywQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMTo0NjozMlrOGDGywQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkxMDIwOQ==", "bodyText": "@guozhangwang @abbccdda this was the correct way to set the transaction.id -- during the refactoring this code was not moved into StreamsProducer as it should have", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405910209", "createdAt": "2020-04-09T01:46:32Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ActiveTaskCreator.java", "diffHunk": "@@ -87,8 +86,6 @@\n         this.log = log;\n \n         createTaskSensor = ThreadMetrics.createTaskSensor(threadId, streamsMetrics);\n-        final String applicationId = config.getString(StreamsConfig.APPLICATION_ID_CONFIG);\n-        transactionalId = applicationId + \"-\" + processId + \"-StreamThread-\" + threadId.split(\"-StreamThread-\")[1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f7ee56278adb524ab04ec1cde667ec8e06e69ed"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNDQwNzky", "url": "https://github.com/apache/kafka/pull/8443#pullrequestreview-390440792", "createdAt": "2020-04-09T01:48:10Z", "commit": {"oid": "6f7ee56278adb524ab04ec1cde667ec8e06e69ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMTo0ODoxMFrOGDG0bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMTo0ODoxMFrOGDG0bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkxMDYzNg==", "bodyText": "Include the thread-index in the transactional.id to generate unique IDs for different threads within the same process.\n(I stripped out the \"-StreamThread-\" string in contrast to the old code for shorten the ID)", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405910636", "createdAt": "2020-04-09T01:48:10Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamsProducer.java", "diffHunk": "@@ -113,7 +113,9 @@ public StreamsProducer(final StreamsConfig config,\n                 final String applicationId = config.getString(StreamsConfig.APPLICATION_ID_CONFIG);\n                 producerConfigs.put(\n                     ProducerConfig.TRANSACTIONAL_ID_CONFIG,\n-                    applicationId + \"-\" + Objects.requireNonNull(processId, \"processId cannot be null for exactly-once beta\"));\n+                    applicationId + \"-\" +\n+                        Objects.requireNonNull(processId, \"processId cannot be null for exactly-once beta\") +\n+                        \"-\" + threadId.split(\"-StreamThread-\")[1]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f7ee56278adb524ab04ec1cde667ec8e06e69ed"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxMTUxOTQw", "url": "https://github.com/apache/kafka/pull/8443#pullrequestreview-391151940", "createdAt": "2020-04-09T21:42:00Z", "commit": {"oid": "6f7ee56278adb524ab04ec1cde667ec8e06e69ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1410, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}