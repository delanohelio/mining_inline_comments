{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3OTA2OTcz", "number": 8411, "title": "KAFKA-9812: fix infinite loop in test code", "bodyText": "If the EosIntegrationTest fails an assertion after setting gcInjected:=true but before it gets to set doGC=false, then it would never set the flag, and the transformer would become an infinite loop.\nThere are a couple of ways to tackle this, but I opted to just check inside the loop that we're not currently shutting down.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-04-03T02:54:13Z", "url": "https://github.com/apache/kafka/pull/8411", "merged": true, "mergeCommit": {"oid": "726a7d5de27dda6968643f1557d3478a436a4a63"}, "closed": true, "closedAt": "2020-04-03T16:29:34Z", "author": {"login": "vvcephei"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcT3t2RAH2gAyMzk3OTA2OTczOmIyNDAzYWQ5OWQzNzI1YWUwMjEyNTFmMGViZWU1ZDhhZmJhZmM0MDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcT3-X4gFqTM4NjkwODMxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b2403ad99d3725ae021251f0ebee5d8afbafc401", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/b2403ad99d3725ae021251f0ebee5d8afbafc401", "committedDate": "2020-04-03T02:45:30Z", "message": "KAFKA-9812: fix infinite loop in test code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2OTA4MzE5", "url": "https://github.com/apache/kafka/pull/8411#pullrequestreview-386908319", "createdAt": "2020-04-03T03:02:04Z", "commit": {"oid": "b2403ad99d3725ae021251f0ebee5d8afbafc401"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMzowMjowNVrOGADg-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMzowMjowNVrOGADg-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcxMDc3OQ==", "bodyText": "In KafkaStreams.close, we don't interrupt the StreamThreads but set them to state:=PENDING_SHUTDOWN. I'm checking both here, though, because the thread might be interrupted for other reasons, though, and it's generally polite to make sure you haven't been interrupted if you're blocking.", "url": "https://github.com/apache/kafka/pull/8411#discussion_r402710779", "createdAt": "2020-04-03T03:02:05Z", "author": {"login": "vvcephei"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/EosIntegrationTest.java", "diffHunk": "@@ -654,6 +655,10 @@ public void init(final ProcessorContext context) {\n                     public KeyValue<Long, Long> transform(final Long key, final Long value) {\n                         if (gcInjected.compareAndSet(true, false)) {\n                             while (doGC) {\n+                                final StreamThread thread = (StreamThread) Thread.currentThread();\n+                                if (thread.isInterrupted() || !thread.isRunning()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2403ad99d3725ae021251f0ebee5d8afbafc401"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 60, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}