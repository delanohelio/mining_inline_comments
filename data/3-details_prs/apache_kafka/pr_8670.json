{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MzE1NzY0", "number": 8670, "title": "KAFKA-10001: Should trigger store specific callback if it is also a listener", "bodyText": "The store's registered callback could also be a restore listener, in which case it should be triggered along with the user specified global listener as well.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-05-15T00:43:47Z", "url": "https://github.com/apache/kafka/pull/8670", "merged": true, "mergeCommit": {"oid": "d534b5d81771148b3b1db2db837ef72c84b2f61d"}, "closed": true, "closedAt": "2020-05-15T18:27:03Z", "author": {"login": "guozhangwang"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchXISTgH2gAyNDE4MzE1NzY0OjNlMDgyYzQyM2Y0MGU5NmIzNTI5MTZiNzc1MDAzMDExZDYxNjA3MmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchmQq3gH2gAyNDE4MzE1NzY0OmQ0MmFmMTBiZTBhMWYzNjg2ZDM0MGM3NGI4YzVhMzllNGZjN2ExYjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3e082c423f40e96b352916b775003011d616072c", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/3e082c423f40e96b352916b775003011d616072c", "committedDate": "2020-05-15T00:42:27Z", "message": "should trigger store specific callback if it is also a listener"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMjg1ODg4", "url": "https://github.com/apache/kafka/pull/8670#pullrequestreview-412285888", "createdAt": "2020-05-15T01:17:16Z", "commit": {"oid": "3e082c423f40e96b352916b775003011d616072c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMToxNzoxN1rOGVzT6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMToxNzoyNVrOGVzUHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTUxMzk2Mw==", "bodyText": "Nit: we get storeMetadata above already (similar below) also the if is redundant  -- should we unify it?", "url": "https://github.com/apache/kafka/pull/8670#discussion_r425513963", "createdAt": "2020-05-15T01:17:17Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StoreChangelogReader.java", "diffHunk": "@@ -522,6 +523,12 @@ private void restoreChangelog(final ChangelogMetadata changelogMetadata) {\n             // do not trigger restore listener if we are processing standby tasks\n             if (changelogMetadata.stateManager.taskType() == Task.TaskType.ACTIVE) {\n                 try {\n+                    // first trigger the store's specific listener if its registered callback is also an lister,\n+                    // then trigger the user registered global listener\n+                    final StateRestoreCallback restoreCallback = changelogMetadata.storeMetadata.restoreCallback();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e082c423f40e96b352916b775003011d616072c"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTUxNDAxMw==", "bodyText": "Nit: opening/closing { } are missing", "url": "https://github.com/apache/kafka/pull/8670#discussion_r425514013", "createdAt": "2020-05-15T01:17:25Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StoreChangelogReader.java", "diffHunk": "@@ -522,6 +523,12 @@ private void restoreChangelog(final ChangelogMetadata changelogMetadata) {\n             // do not trigger restore listener if we are processing standby tasks\n             if (changelogMetadata.stateManager.taskType() == Task.TaskType.ACTIVE) {\n                 try {\n+                    // first trigger the store's specific listener if its registered callback is also an lister,\n+                    // then trigger the user registered global listener\n+                    final StateRestoreCallback restoreCallback = changelogMetadata.storeMetadata.restoreCallback();\n+                    if (restoreCallback instanceof StateRestoreListener)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e082c423f40e96b352916b775003011d616072c"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNzM3NzMw", "url": "https://github.com/apache/kafka/pull/8670#pullrequestreview-412737730", "createdAt": "2020-05-15T15:13:45Z", "commit": {"oid": "3e082c423f40e96b352916b775003011d616072c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5f42343c58c188f70a2cb95ea6aa2d69238220a", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/b5f42343c58c188f70a2cb95ea6aa2d69238220a", "committedDate": "2020-05-15T18:12:37Z", "message": "add unit tests; address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d42af10be0a1f3686d340c74b8c5a39e4fc7a1b3", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/d42af10be0a1f3686d340c74b8c5a39e4fc7a1b3", "committedDate": "2020-05-15T18:20:11Z", "message": "remove unused imports"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1010, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}