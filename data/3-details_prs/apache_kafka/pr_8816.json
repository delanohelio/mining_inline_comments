{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NTg2NDE0", "number": 8816, "title": "MINOR: Print all removed dynamic members during join complete", "bodyText": "For better visibility on the group rebalance, we are trying to print out the evicted members inside the group coordinator during rebalance complete.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-06-05T17:01:40Z", "url": "https://github.com/apache/kafka/pull/8816", "merged": true, "mergeCommit": {"oid": "84051e0e886de46b8320e3ee222d380b00459b26"}, "closed": true, "closedAt": "2020-06-10T00:33:44Z", "author": {"login": "abbccdda"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoVsuvgH2gAyNDI4NTg2NDE0OmU2M2I0NjQxZjI0YjE3Y2Y0ZTc1MjM5NTE1YTI3MjEzZmI1YmMxZWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpuj7NgFqTQyNzYzNDMxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e63b4641f24b17cf4e75239515a27213fb5bc1ee", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/e63b4641f24b17cf4e75239515a27213fb5bc1ee", "committedDate": "2020-06-05T16:59:55Z", "message": "add dynamic member function and enhance the test cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NDcyMzUy", "url": "https://github.com/apache/kafka/pull/8816#pullrequestreview-425472352", "createdAt": "2020-06-05T17:02:37Z", "commit": {"oid": "e63b4641f24b17cf4e75239515a27213fb5bc1ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNzowMjozN1rOGf2TSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNzowMjozN1rOGf2TSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA0ODcxMw==", "bodyText": "This is a cleanup. In the current logic we should never hit a static member in this block", "url": "https://github.com/apache/kafka/pull/8816#discussion_r436048713", "createdAt": "2020-06-05T17:02:37Z", "author": {"login": "abbccdda"}, "path": "core/src/main/scala/kafka/coordinator/group/GroupCoordinator.scala", "diffHunk": "@@ -1150,7 +1150,6 @@ class GroupCoordinator(val brokerId: Int,\n       group.notYetRejoinedMembers.filterNot(_.isStaticMember) foreach { failedMember =>\n         removeHeartbeatForLeavingMember(group, failedMember)\n         group.remove(failedMember.memberId)\n-        group.removeStaticMember(failedMember.groupInstanceId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63b4641f24b17cf4e75239515a27213fb5bc1ee"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NTg1NDEx", "url": "https://github.com/apache/kafka/pull/8816#pullrequestreview-425585411", "createdAt": "2020-06-05T19:51:20Z", "commit": {"oid": "e63b4641f24b17cf4e75239515a27213fb5bc1ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxOTo1MToyMFrOGf7Xmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxOTo1MToyMFrOGf7Xmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEzMTczOQ==", "bodyText": "Shouldn't we include the group id in the log as well?", "url": "https://github.com/apache/kafka/pull/8816#discussion_r436131739", "createdAt": "2020-06-05T19:51:20Z", "author": {"login": "dajac"}, "path": "core/src/main/scala/kafka/coordinator/group/GroupCoordinator.scala", "diffHunk": "@@ -1186,6 +1185,8 @@ class GroupCoordinator(val brokerId: Int,\n           for (member <- group.allMemberMetadata) {\n             val joinResult = JoinGroupResult(\n               members = if (group.isLeader(member.memberId)) {\n+                info(s\"Reply the group leader with the following dynamic members' metadata: ${group.allDynamicMembers}\" +\n+                  s\"and static members' metadata: ${group.allStaticMembers}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63b4641f24b17cf4e75239515a27213fb5bc1ee"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c968af37aa8dd1d073074b69afa14a86e141b11b", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/c968af37aa8dd1d073074b69afa14a86e141b11b", "committedDate": "2020-06-05T20:07:50Z", "message": "add group id"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NjYxNjUw", "url": "https://github.com/apache/kafka/pull/8816#pullrequestreview-425661650", "createdAt": "2020-06-05T22:25:31Z", "commit": {"oid": "c968af37aa8dd1d073074b69afa14a86e141b11b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMjoyNTozMVrOGf-_5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMjoyNTozMVrOGf-_5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE5MTIwNg==", "bodyText": "Do we need to print this for every member? That is O(n^2). Keep in mind that groups in the thousands are not unheard of. I think it would be better if we just ensured that we log the id of every member entering and leaving the group.", "url": "https://github.com/apache/kafka/pull/8816#discussion_r436191206", "createdAt": "2020-06-05T22:25:31Z", "author": {"login": "hachikuji"}, "path": "core/src/main/scala/kafka/coordinator/group/GroupCoordinator.scala", "diffHunk": "@@ -1186,6 +1185,9 @@ class GroupCoordinator(val brokerId: Int,\n           for (member <- group.allMemberMetadata) {\n             val joinResult = JoinGroupResult(\n               members = if (group.isLeader(member.memberId)) {\n+                info(s\"Group ${group.groupId} replies the leader with \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c968af37aa8dd1d073074b69afa14a86e141b11b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcfb77f0960625746f76c42bbb30cb6827d04f76", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/fcfb77f0960625746f76c42bbb30cb6827d04f76", "committedDate": "2020-06-06T00:32:03Z", "message": "only log removed members"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "fcfb77f0960625746f76c42bbb30cb6827d04f76", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/fcfb77f0960625746f76c42bbb30cb6827d04f76", "committedDate": "2020-06-06T00:32:03Z", "message": "only log removed members"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72012b2f9eba7e557170c62b2cab93a17b313c4f", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/72012b2f9eba7e557170c62b2cab93a17b313c4f", "committedDate": "2020-06-08T15:51:53Z", "message": "fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjM0MzE3", "url": "https://github.com/apache/kafka/pull/8816#pullrequestreview-427634317", "createdAt": "2020-06-10T00:31:16Z", "commit": {"oid": "72012b2f9eba7e557170c62b2cab93a17b313c4f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMDozMToxNlrOGhg57Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwMDozMToxNlrOGhg57Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc5NTMwOQ==", "bodyText": "Nice catch.", "url": "https://github.com/apache/kafka/pull/8816#discussion_r437795309", "createdAt": "2020-06-10T00:31:16Z", "author": {"login": "guozhangwang"}, "path": "core/src/main/scala/kafka/coordinator/group/GroupCoordinator.scala", "diffHunk": "@@ -1146,12 +1146,16 @@ class GroupCoordinator(val brokerId: Int,\n \n   def onCompleteJoin(group: GroupMetadata): Unit = {\n     group.inLock {\n-      // remove dynamic members who haven't joined the group yet\n-      group.notYetRejoinedMembers.filterNot(_.isStaticMember) foreach { failedMember =>\n-        removeHeartbeatForLeavingMember(group, failedMember)\n-        group.remove(failedMember.memberId)\n-        group.removeStaticMember(failedMember.groupInstanceId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "72012b2f9eba7e557170c62b2cab93a17b313c4f"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 884, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}