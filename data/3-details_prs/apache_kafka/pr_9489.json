{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5Mjg3ODQ2", "number": 9489, "title": "MINOR: demote \"Committing task offsets\" log to DEBUG", "bodyText": "This message absolutely floods the logs, especially in an eos application where the commit interval is just 100ms. It's definitely a useful message but I don't think there's any justification for it being at the INFO level when it's logged 10 times a second.\u00a0", "createdAt": "2020-10-24T00:02:47Z", "url": "https://github.com/apache/kafka/pull/9489", "merged": true, "mergeCommit": {"oid": "cfc813537e955c267106eea989f6aec4879e14d7"}, "closed": true, "closedAt": "2020-11-13T21:25:44Z", "author": {"login": "ableegoldman"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABda6XpFgH2gAyNTA5Mjg3ODQ2OjhiMGNiZjBmMDNmYTAzNjJhZDIwYjU0ZGFiMTE3YjNhNzEzMGFiOWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcNVFxgFqTUzMDQwMDI5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8b0cbf0f03fa0362ad20b54dab117b3a7130ab9f", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/8b0cbf0f03fa0362ad20b54dab117b3a7130ab9f", "committedDate": "2020-11-09T19:59:35Z", "message": "demote to debug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8310e6a4e4ebc65ca7616d5fae7479b200e5d6ff", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/8310e6a4e4ebc65ca7616d5fae7479b200e5d6ff", "committedDate": "2020-11-10T01:41:47Z", "message": "add new INFO-level log in its place"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "8310e6a4e4ebc65ca7616d5fae7479b200e5d6ff", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/8310e6a4e4ebc65ca7616d5fae7479b200e5d6ff", "committedDate": "2020-11-10T01:41:47Z", "message": "add new INFO-level log in its place"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65f9dd7840f5f1da6811597ce499337e100dab07", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/65f9dd7840f5f1da6811597ce499337e100dab07", "committedDate": "2020-11-10T01:55:05Z", "message": "move INFO log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NzE5ODU2", "url": "https://github.com/apache/kafka/pull/9489#pullrequestreview-527719856", "createdAt": "2020-11-11T00:24:48Z", "commit": {"oid": "65f9dd7840f5f1da6811597ce499337e100dab07"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMDoyNDo0OFrOHw00xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMDoyNDo0OFrOHw00xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk1OTE3NA==", "bodyText": "Could we log the owned task here as well?", "url": "https://github.com/apache/kafka/pull/9489#discussion_r520959174", "createdAt": "2020-11-11T00:24:48Z", "author": {"login": "abbccdda"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -703,6 +703,14 @@ void runOnce() {\n             // we record the ratio out of the while loop so that the accumulated latency spans over\n             // multiple iterations with reasonably large max.num.records and hence is less vulnerable to outliers\n             taskManager.recordTaskProcessRatio(totalProcessLatency, now);\n+\n+            // Only log this when we actually processed some records to avoid flooding INFO-level logs when there are\n+            // no records on the input topics\n+            if (totalProcessed > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65f9dd7840f5f1da6811597ce499337e100dab07"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NzMwMjEy", "url": "https://github.com/apache/kafka/pull/9489#pullrequestreview-527730212", "createdAt": "2020-11-11T00:31:19Z", "commit": {"oid": "65f9dd7840f5f1da6811597ce499337e100dab07"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMDozMToxOVrOHw09WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMDozMToxOVrOHw09WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk2MTM2OA==", "bodyText": "Is it important to make the distinction between \"Processed zero records, going to poll again\" and \"Finished processing 0 records, going to poll again\"?\nAlso if we are not saying its processed anything maybe we should log what it is pulling from", "url": "https://github.com/apache/kafka/pull/9489#discussion_r520961368", "createdAt": "2020-11-11T00:31:19Z", "author": {"login": "wcarlson5"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -703,6 +703,14 @@ void runOnce() {\n             // we record the ratio out of the while loop so that the accumulated latency spans over\n             // multiple iterations with reasonably large max.num.records and hence is less vulnerable to outliers\n             taskManager.recordTaskProcessRatio(totalProcessLatency, now);\n+\n+            // Only log this when we actually processed some records to avoid flooding INFO-level logs when there are\n+            // no records on the input topics\n+            if (totalProcessed > 0) {\n+                log.info(\"Finished processing {} records, going to poll again\", totalProcessed);\n+            } else {\n+                log.debug(\"Processed zero records, going to poll again\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65f9dd7840f5f1da6811597ce499337e100dab07"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "385fd21d07e8ecf890faaba64ea21025da3c3181", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/385fd21d07e8ecf890faaba64ea21025da3c3181", "committedDate": "2020-11-11T00:53:49Z", "message": "review feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MjE2NTc1", "url": "https://github.com/apache/kafka/pull/9489#pullrequestreview-529216575", "createdAt": "2020-11-12T15:41:32Z", "commit": {"oid": "385fd21d07e8ecf890faaba64ea21025da3c3181"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTo0MTozMlrOHyAxWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTo0NDo0MFrOHyA7Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIwMzQ4Mg==", "bodyText": "This line looks about the same as L665. I'm wondering if we really need the \"else\" in this case.", "url": "https://github.com/apache/kafka/pull/9489#discussion_r522203482", "createdAt": "2020-11-12T15:41:32Z", "author": {"login": "vvcephei"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -703,6 +703,16 @@ void runOnce() {\n             // we record the ratio out of the while loop so that the accumulated latency spans over\n             // multiple iterations with reasonably large max.num.records and hence is less vulnerable to outliers\n             taskManager.recordTaskProcessRatio(totalProcessLatency, now);\n+\n+            // Only log this at INFO when we actually processed some records to avoid flooding INFO-level logs when\n+            // there are no records on the input topics\n+            if (totalProcessed > 0) {\n+                log.info(\"Processed {} records for tasks {}, polling for more records now\",\n+                         totalProcessed, taskManager.activeTaskIds());\n+            } else {\n+                log.debug(\"Processed {} records for tasks {}, polling for more records now\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "385fd21d07e8ecf890faaba64ea21025da3c3181"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIwNTk1OQ==", "bodyText": "Since this is at the end of runOnce, I'm wondering if it also makes sense to log whether we committed or punctuated, and whether/how many records we polled at the beginning of the method.\nBasically, it seems like, if it's a good idea to log some information once per cycle, then it's probably a good idea to summarize everything you'd want to know.", "url": "https://github.com/apache/kafka/pull/9489#discussion_r522205959", "createdAt": "2020-11-12T15:44:40Z", "author": {"login": "vvcephei"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -703,6 +703,16 @@ void runOnce() {\n             // we record the ratio out of the while loop so that the accumulated latency spans over\n             // multiple iterations with reasonably large max.num.records and hence is less vulnerable to outliers\n             taskManager.recordTaskProcessRatio(totalProcessLatency, now);\n+\n+            // Only log this at INFO when we actually processed some records to avoid flooding INFO-level logs when\n+            // there are no records on the input topics\n+            if (totalProcessed > 0) {\n+                log.info(\"Processed {} records for tasks {}, polling for more records now\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "385fd21d07e8ecf890faaba64ea21025da3c3181"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06ddcbb164b94839c07b798044eaaa9fcc1aabb6", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/06ddcbb164b94839c07b798044eaaa9fcc1aabb6", "committedDate": "2020-11-13T03:29:06Z", "message": "review feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "06ddcbb164b94839c07b798044eaaa9fcc1aabb6", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/06ddcbb164b94839c07b798044eaaa9fcc1aabb6", "committedDate": "2020-11-13T03:29:06Z", "message": "review feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDAwMjkx", "url": "https://github.com/apache/kafka/pull/9489#pullrequestreview-530400291", "createdAt": "2020-11-13T20:38:55Z", "commit": {"oid": "06ddcbb164b94839c07b798044eaaa9fcc1aabb6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2866, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}