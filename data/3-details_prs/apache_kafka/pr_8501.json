{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0Mzg2MjE4", "number": 8501, "title": "KAFKA-9881: Convert integration test to verify measurements from RocksDB to unit test", "bodyText": "The integration test RocksDBMetricsIntegrationTest takes pretty long to complete.\nMost of the runtime is spent in the two tests that verify whether the RocksDB\nmetrics get actual measurements from RocksDB. Those tests need to wait for the thread\nthat collects the measurements of the RocksDB metrics to trigger the first recordings\nof the metrics.\nThis PR adds a unit test that verifies whether the Kafka Streams metrics get the\nmeasurements from RocksDB and removes the two integration tests that verified it\nbefore. The verification of the creation and scheduling of the RocksDB metrics\nrecording trigger thread is already contained in KafkaStreamsTest and consequently\nit is not part of this PR.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-04-16T13:52:33Z", "url": "https://github.com/apache/kafka/pull/8501", "merged": true, "mergeCommit": {"oid": "a0173ec45d83a38512c724b801d8c176c1f510db"}, "closed": true, "closedAt": "2020-04-17T17:49:41Z", "author": {"login": "cadonna"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYNBc8gH2gAyNDA0Mzg2MjE4OjM3Y2M1ZWY1OTJjYmZjNGI1ZTIwYzU5YzlkMzY0MjBmYzQxYjVhZTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYTn2JgFqTM5NTAxMTYwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "37cc5ef592cbfc4b5e20c59c9d36420fc41b5ae0", "author": {"user": {"login": "cadonna", "name": "Bruno Cadonna"}}, "url": "https://github.com/apache/kafka/commit/37cc5ef592cbfc4b5e20c59c9d36420fc41b5ae0", "committedDate": "2020-04-16T13:50:37Z", "message": "KAFKA-9881: Convert integration test to verify measurements from RocksDB to unit test\n\nThe integration test RocksDBMetricsIntegrationTest takes pretty long to complete.\nMost of the runtime is spent in the two tests that verify whether the RocksDB\nmetrics get actual measurements from RocksDB. Those tests need to wait for the thread\nthat collects the measurements of the RocksDB metrics to trigger the first recordings\nof the metrics.\n\nThis PR adds a unit test that verifies whether the Kafka Streams metrics get the\nmeasurements from RocksDB and removes the two integration tests that verified it\nbefore. The verification of the creation and scheduling of the RocksDB metrics\nrecording trigger thread is already contained in KafkaStreamsTest and consequently\nit is not part of this PR."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDExNjA1", "url": "https://github.com/apache/kafka/pull/8501#pullrequestreview-395011605", "createdAt": "2020-04-16T21:27:15Z", "commit": {"oid": "37cc5ef592cbfc4b5e20c59c9d36420fc41b5ae0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMToyNzoxNVrOGG3yAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMTozMToyN1rOGG35ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg1ODU2Mg==", "bodyText": "Nice cleanup!", "url": "https://github.com/apache/kafka/pull/8501#discussion_r409858562", "createdAt": "2020-04-16T21:27:15Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/state/internals/RocksDBStore.java", "diffHunk": "@@ -190,13 +190,13 @@ void openDB(final ProcessorContext context) {\n \n         // Setup metrics before the database is opened, otherwise the metrics are not updated\n         // with the measurements from Rocks DB\n-        maybeSetUpMetricsRecorder(context, configs);\n+        maybeSetUpMetricsRecorder(configs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37cc5ef592cbfc4b5e20c59c9d36420fc41b5ae0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg2MDQ1OA==", "bodyText": "This is just for my own understanding: for line 144 / 172 above, what kind of simulated failure did we introduce? Seems like we just start and close the stream app while verifying metrics twice?", "url": "https://github.com/apache/kafka/pull/8501#discussion_r409860458", "createdAt": "2020-04-16T21:31:27Z", "author": {"login": "guozhangwang"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/RocksDBMetricsIntegrationTest.java", "diffHunk": "@@ -181,40 +181,6 @@ public void shouldExposeRocksDBMetricsForSegmentedStateStoreBeforeAndAfterFailur\n         );\n     }\n \n-    @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37cc5ef592cbfc4b5e20c59c9d36420fc41b5ae0"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1543, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}