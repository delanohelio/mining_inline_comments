{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxODUyMDY2", "number": 9416, "title": "MINOR: more log4j entry on elect / resignation of coordinators", "bodyText": "When a coordinator module is being elected / resigned, our log entry is usually associated with a background scheduler on loading / unloading entries and hence it is unclear at the exact time when the election or resignation happens, and we have to then compare with the KafkaAPI's log entry for leaderAndISR / StopReplica to infer the actual time. I think add a couple new log entries indicating the exact time when it happens is helpful.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-10-12T22:23:25Z", "url": "https://github.com/apache/kafka/pull/9416", "merged": true, "mergeCommit": {"oid": "236daf294dd844b1273f2f5af7ba60cbd428af41"}, "closed": true, "closedAt": "2020-10-15T17:08:56Z", "author": {"login": "guozhangwang"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdR7kvwgH2gAyNTAxODUyMDY2OmE3ZTAzZDUxZDNkMzE4ZDZmMmUxYzNiYjZhNmNlODRiMzMyMjk4Y2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdS0ngMgFqTUwOTU3NjAxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a7e03d51d3d318d6f2e1c3bb6a6ce84b332298ce", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/a7e03d51d3d318d6f2e1c3bb6a6ce84b332298ce", "committedDate": "2020-10-12T22:18:29Z", "message": "more log4j"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MTUwMTY1", "url": "https://github.com/apache/kafka/pull/9416#pullrequestreview-507150165", "createdAt": "2020-10-13T07:39:50Z", "commit": {"oid": "a7e03d51d3d318d6f2e1c3bb6a6ce84b332298ce"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNzozOTo1MFrOHgZY4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMToxMDo1OVrOHghd9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzczMjQ0OA==", "bodyText": "Shouldn't this be Resigning as the group coordinator or Resigning as group coordinator?", "url": "https://github.com/apache/kafka/pull/9416#discussion_r503732448", "createdAt": "2020-10-13T07:39:50Z", "author": {"login": "cadonna"}, "path": "core/src/main/scala/kafka/coordinator/group/GroupCoordinator.scala", "diffHunk": "@@ -917,6 +918,7 @@ class GroupCoordinator(val brokerId: Int,\n    * @param offsetTopicPartitionId The partition we are no longer leading\n    */\n   def onResignation(offsetTopicPartitionId: Int): Unit = {\n+    info(s\"Resigning the group coordinator for partition $offsetTopicPartitionId\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7e03d51d3d318d6f2e1c3bb6a6ce84b332298ce"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzczMjYyNQ==", "bodyText": "Same as above.", "url": "https://github.com/apache/kafka/pull/9416#discussion_r503732625", "createdAt": "2020-10-13T07:40:04Z", "author": {"login": "cadonna"}, "path": "core/src/main/scala/kafka/coordinator/transaction/TransactionCoordinator.scala", "diffHunk": "@@ -329,6 +330,7 @@ class TransactionCoordinator(brokerId: Int,\n    *                         are resigning after receiving a StopReplica request from the controller\n    */\n   def onResignation(txnTopicPartitionId: Int, coordinatorEpoch: Option[Int]): Unit = {\n+    info(s\"Resigning the txn coordinator for partition $txnTopicPartitionId at epoch $coordinatorEpoch\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7e03d51d3d318d6f2e1c3bb6a6ce84b332298ce"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg2NDgyMw==", "bodyText": "It would also be nice to have the groups that are coordinated in the log message. I guess that is hardly possible, isn't it?", "url": "https://github.com/apache/kafka/pull/9416#discussion_r503864823", "createdAt": "2020-10-13T11:10:59Z", "author": {"login": "cadonna"}, "path": "core/src/main/scala/kafka/coordinator/group/GroupCoordinator.scala", "diffHunk": "@@ -908,6 +908,7 @@ class GroupCoordinator(val brokerId: Int,\n    * @param offsetTopicPartitionId The partition we are now leading\n    */\n   def onElection(offsetTopicPartitionId: Int): Unit = {\n+    info(s\"Becoming the group coordinator for partition $offsetTopicPartitionId\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7e03d51d3d318d6f2e1c3bb6a6ce84b332298ce"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b789a7b9db3837d15a5591650509c47e1ddc8cd", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/4b789a7b9db3837d15a5591650509c47e1ddc8cd", "committedDate": "2020-10-15T04:13:16Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into KMinor-broker-log-upon-elecion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10808ca01c3c2de974803b1bdf848a27a057f3de", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/10808ca01c3c2de974803b1bdf848a27a057f3de", "committedDate": "2020-10-15T05:22:40Z", "message": "github comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5MDAxMzM1", "url": "https://github.com/apache/kafka/pull/9416#pullrequestreview-509001335", "createdAt": "2020-10-15T06:09:28Z", "commit": {"oid": "10808ca01c3c2de974803b1bdf848a27a057f3de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NDE5OTU3", "url": "https://github.com/apache/kafka/pull/9416#pullrequestreview-509419957", "createdAt": "2020-10-15T14:07:47Z", "commit": {"oid": "10808ca01c3c2de974803b1bdf848a27a057f3de"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNDowNzo0N1rOHiJszg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNDowODo1M1rOHiJwFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU3MjU1OA==", "bodyText": "Shouldn't that read Elected as the group coordinator ...?", "url": "https://github.com/apache/kafka/pull/9416#discussion_r505572558", "createdAt": "2020-10-15T14:07:47Z", "author": {"login": "cadonna"}, "path": "core/src/main/scala/kafka/coordinator/group/GroupCoordinator.scala", "diffHunk": "@@ -908,6 +908,7 @@ class GroupCoordinator(val brokerId: Int,\n    * @param offsetTopicPartitionId The partition we are now leading\n    */\n   def onElection(offsetTopicPartitionId: Int): Unit = {\n+    info(s\"Electing as the group coordinator for partition $offsetTopicPartitionId\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10808ca01c3c2de974803b1bdf848a27a057f3de"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU3MzE3Mg==", "bodyText": "Do you also plan to change this to Elected as ...?", "url": "https://github.com/apache/kafka/pull/9416#discussion_r505573172", "createdAt": "2020-10-15T14:08:35Z", "author": {"login": "cadonna"}, "path": "core/src/main/scala/kafka/coordinator/transaction/TransactionCoordinator.scala", "diffHunk": "@@ -311,6 +311,7 @@ class TransactionCoordinator(brokerId: Int,\n    * @param coordinatorEpoch The partition coordinator (or leader) epoch from the received LeaderAndIsr request\n    */\n   def onElection(txnTopicPartitionId: Int, coordinatorEpoch: Int): Unit = {\n+    info(s\"Becoming the txn coordinator for partition $txnTopicPartitionId at epoch $coordinatorEpoch\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10808ca01c3c2de974803b1bdf848a27a057f3de"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU3MzM5OA==", "bodyText": "This still needs to be changed.", "url": "https://github.com/apache/kafka/pull/9416#discussion_r505573398", "createdAt": "2020-10-15T14:08:53Z", "author": {"login": "cadonna"}, "path": "core/src/main/scala/kafka/coordinator/transaction/TransactionCoordinator.scala", "diffHunk": "@@ -329,6 +330,7 @@ class TransactionCoordinator(brokerId: Int,\n    *                         are resigning after receiving a StopReplica request from the controller\n    */\n   def onResignation(txnTopicPartitionId: Int, coordinatorEpoch: Option[Int]): Unit = {\n+    info(s\"Resigning the txn coordinator for partition $txnTopicPartitionId at epoch $coordinatorEpoch\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzczMjYyNQ=="}, "originalCommit": {"oid": "a7e03d51d3d318d6f2e1c3bb6a6ce84b332298ce"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc2b6ea03067095ac4f0a9939ac3bd54f973ded6", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/fc2b6ea03067095ac4f0a9939ac3bd54f973ded6", "committedDate": "2020-10-15T16:27:30Z", "message": "github comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTc2MDE4", "url": "https://github.com/apache/kafka/pull/9416#pullrequestreview-509576018", "createdAt": "2020-10-15T16:46:05Z", "commit": {"oid": "fc2b6ea03067095ac4f0a9939ac3bd54f973ded6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 511, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}