{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2NDUzMjg0", "number": 9731, "title": "MINOR: Make Log.recordVersion private and other small cleanups", "bodyText": "Couple small cleanups in this PR:\n\nI've converted Log.recordVersion to be private, since it is used only inside Log class. I've also changed one of the call sites to reuse the same method.\nIn a few classes I've removed a redundant default parameter fileAlreadyExists = false in a call to LogSegment.open.\n\nTests:\nRelying on existing unit & integration tests.", "createdAt": "2020-12-11T03:22:18Z", "url": "https://github.com/apache/kafka/pull/9731", "merged": true, "mergeCommit": {"oid": "4401f52d17b41bc560b04f0883d2cb57c3c983aa"}, "closed": true, "closedAt": "2020-12-14T07:20:21Z", "author": {"login": "kowshik"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk_UUHgH2gAyNTM2NDUzMjg0OjQ5NjU1NGJlMTE1MDkzZDRhNTIzYjBjMGE4MGU1YTU3OWIwZjA1ODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlWgEFAFqTU1MDY5NTY1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "496554be115093d4a523b0c0a80e5a579b0f0584", "author": {"user": {"login": "kowshik", "name": "Kowshik Prakasam"}}, "url": "https://github.com/apache/kafka/commit/496554be115093d4a523b0c0a80e5a579b0f0584", "committedDate": "2020-12-11T03:24:43Z", "message": "MINOR: Make Log.recordVersion private and refactor to use the same"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d7ada2cbeddcc372b3bde8d88f08c299e4db800", "author": {"user": {"login": "kowshik", "name": "Kowshik Prakasam"}}, "url": "https://github.com/apache/kafka/commit/4d7ada2cbeddcc372b3bde8d88f08c299e4db800", "committedDate": "2020-12-11T03:19:14Z", "message": "MINOR: Make Log.recordVersion private and refactor to use the same"}, "afterCommit": {"oid": "496554be115093d4a523b0c0a80e5a579b0f0584", "author": {"user": {"login": "kowshik", "name": "Kowshik Prakasam"}}, "url": "https://github.com/apache/kafka/commit/496554be115093d4a523b0c0a80e5a579b0f0584", "committedDate": "2020-12-11T03:24:43Z", "message": "MINOR: Make Log.recordVersion private and refactor to use the same"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5Nzc3NjE2", "url": "https://github.com/apache/kafka/pull/9731#pullrequestreview-549777616", "createdAt": "2020-12-11T03:30:34Z", "commit": {"oid": "496554be115093d4a523b0c0a80e5a579b0f0584"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwMzozMDozNVrOIDniyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwMzozMzo0NVrOIDnmqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY2NDUyMQ==", "bodyText": "How about replacing messageFormatVersion by recordVersion.value for all usages in this method.", "url": "https://github.com/apache/kafka/pull/9731#discussion_r540664521", "createdAt": "2020-12-11T03:30:35Z", "author": {"login": "chia7712"}, "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -893,7 +892,7 @@ class Log(@volatile private var _dir: File,\n     // offset (see below). The next time the log is reloaded, we will load producer state using this snapshot\n     // (or later snapshots). Otherwise, if there is no snapshot file, then we have to rebuild producer state\n     // from the first segment.\n-    if (messageFormatVersion < RecordBatch.MAGIC_VALUE_V2 ||\n+    if (recordVersion.value < RecordBatch.MAGIC_VALUE_V2 ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "496554be115093d4a523b0c0a80e5a579b0f0584"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY2NTUxNA==", "bodyText": "there is a same issue https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/log/LogCleaner.scala#L456", "url": "https://github.com/apache/kafka/pull/9731#discussion_r540665514", "createdAt": "2020-12-11T03:33:45Z", "author": {"login": "chia7712"}, "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -1970,7 +1969,6 @@ class Log(@volatile private var _dir: File,\n           baseOffset = newOffset,\n           config,\n           time = time,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "496554be115093d4a523b0c0a80e5a579b0f0584"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d2b4a2e732b42397df62da141df30856e5c88db", "author": {"user": {"login": "kowshik", "name": "Kowshik Prakasam"}}, "url": "https://github.com/apache/kafka/commit/2d2b4a2e732b42397df62da141df30856e5c88db", "committedDate": "2020-12-11T04:32:48Z", "message": "Address comments from @chia7712"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjk1NjU3", "url": "https://github.com/apache/kafka/pull/9731#pullrequestreview-550695657", "createdAt": "2020-12-12T06:25:22Z", "commit": {"oid": "2d2b4a2e732b42397df62da141df30856e5c88db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2246, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}