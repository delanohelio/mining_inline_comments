{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NDkwNjAw", "number": 8154, "title": "KAFKA-9530; Fix flaky test `testDescribeGroupWithShortInitializationTimeout`", "bodyText": "This should fix the flakiness with this test case. With a short timeout, the call may timeout and the client might disconnect. Currently this can be exposed to the user as either a TimeoutException or a DisconnectException. To be consistent, rather than exposing the underlying retriable error, we handle both cases with a TimeoutException.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-02-21T21:59:13Z", "url": "https://github.com/apache/kafka/pull/8154", "merged": true, "mergeCommit": {"oid": "2df7ea5a4a43920ae1ac8a259f6f69846011eda7"}, "closed": true, "closedAt": "2020-02-23T18:16:32Z", "author": {"login": "hachikuji"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGnq4nAH2gAyMzc4NDkwNjAwOjlkNzA4MDdiYWFlMGFkNmJiNWYyNDhkNjA2OTAwYWM1NjJhZTg0ODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcG-FWRgFqTM2MzA1ODkxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d70807baae0ad6bb5f248d606900ac562ae8483", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/9d70807baae0ad6bb5f248d606900ac562ae8483", "committedDate": "2020-02-21T22:42:46Z", "message": "KAFKA-9530; Fix flaky test `testDescribeGroupWithShortInitializationTimeout`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "9d70807baae0ad6bb5f248d606900ac562ae8483", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/9d70807baae0ad6bb5f248d606900ac562ae8483", "committedDate": "2020-02-21T22:42:46Z", "message": "KAFKA-9530; Fix flaky test `testDescribeGroupWithShortInitializationTimeout`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyOTczMjE3", "url": "https://github.com/apache/kafka/pull/8154#pullrequestreview-362973217", "createdAt": "2020-02-21T23:21:01Z", "commit": {"oid": "9d70807baae0ad6bb5f248d606900ac562ae8483"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMzoyMTowMlrOFtHXhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMzoyMTowMlrOFtHXhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg1MDk1MQ==", "bodyText": "nit: retriable", "url": "https://github.com/apache/kafka/pull/8154#discussion_r382850951", "createdAt": "2020-02-21T23:21:02Z", "author": {"login": "abbccdda"}, "path": "clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java", "diffHunk": "@@ -729,13 +725,10 @@ final void fail(long now, Throwable throwable) {\n             tries++;\n             nextAllowedTryMs = now + retryBackoffMs;\n \n+\n             // If the call has timed out, fail.\n             if (calcTimeoutMsRemainingAsInt(now, deadlineMs) < 0) {\n-                if (log.isDebugEnabled()) {\n-                    log.debug(\"{} timed out at {} after {} attempt(s)\", this, now, tries,\n-                        new Exception(prettyPrintException(throwable)));\n-                }\n-                handleFailure(throwable);\n+                failWithTimeout(now, throwable);\n                 return;\n             }\n             // If the exception is not retryable, fail.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d70807baae0ad6bb5f248d606900ac562ae8483"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1db9a0ab0808dedd4dad0fb4651307437e989a9", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/a1db9a0ab0808dedd4dad0fb4651307437e989a9", "committedDate": "2020-02-22T01:18:06Z", "message": "retryable -> retriable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMDE0NTQ1", "url": "https://github.com/apache/kafka/pull/8154#pullrequestreview-363014545", "createdAt": "2020-02-22T06:58:30Z", "commit": {"oid": "a1db9a0ab0808dedd4dad0fb4651307437e989a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQwNjo1ODozMFrOFtJ5vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQwNjo1ODozMFrOFtJ5vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg5MjQ3OQ==", "bodyText": "Below, we have a case where we throw the underlying exception if we run out of retries. Is that intentional?", "url": "https://github.com/apache/kafka/pull/8154#discussion_r382892479", "createdAt": "2020-02-22T06:58:30Z", "author": {"login": "ijuma"}, "path": "clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java", "diffHunk": "@@ -731,14 +727,10 @@ final void fail(long now, Throwable throwable) {\n \n             // If the call has timed out, fail.\n             if (calcTimeoutMsRemainingAsInt(now, deadlineMs) < 0) {\n-                if (log.isDebugEnabled()) {\n-                    log.debug(\"{} timed out at {} after {} attempt(s)\", this, now, tries,\n-                        new Exception(prettyPrintException(throwable)));\n-                }\n-                handleFailure(throwable);\n+                failWithTimeout(now, throwable);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1db9a0ab0808dedd4dad0fb4651307437e989a9"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "631112b9a9396db915652297da6ae80157cd42a1", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/631112b9a9396db915652297da6ae80157cd42a1", "committedDate": "2020-02-22T22:48:48Z", "message": "Use TimeoutException when retries are exhausted"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMDU4OTE5", "url": "https://github.com/apache/kafka/pull/8154#pullrequestreview-363058919", "createdAt": "2020-02-23T00:49:35Z", "commit": {"oid": "631112b9a9396db915652297da6ae80157cd42a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1534, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}