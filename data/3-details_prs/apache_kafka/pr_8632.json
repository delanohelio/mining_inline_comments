{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MDYyMjI3", "number": 8632, "title": "KAFKA-9972: Only commit tasks with valid states", "bodyText": "We spotted a case in the soak test where a standby task could be in CREATED state during commit, which causes an illegal state exception. To prevent this from happening, the solution is to always enforce a state check.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-05-08T05:59:14Z", "url": "https://github.com/apache/kafka/pull/8632", "merged": true, "mergeCommit": {"oid": "fe2742e1b23158ca697cdf00cd027031403f979d"}, "closed": true, "closedAt": "2020-05-11T19:12:53Z", "author": {"login": "abbccdda"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfLvW2gFqTQwODAyMDg4Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgUmzygFqTQwOTQ1NDc1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MDIwODg2", "url": "https://github.com/apache/kafka/pull/8632#pullrequestreview-408020886", "createdAt": "2020-05-08T06:18:25Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "879c78120d9cff5bdada400c1c6120cf36baf763", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/879c78120d9cff5bdada400c1c6120cf36baf763", "committedDate": "2020-05-08T17:03:19Z", "message": "fix commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3a532c57d3e538ea2b108237a8742960eccf674", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/c3a532c57d3e538ea2b108237a8742960eccf674", "committedDate": "2020-05-08T17:59:48Z", "message": "add test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "c3a532c57d3e538ea2b108237a8742960eccf674", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/c3a532c57d3e538ea2b108237a8742960eccf674", "committedDate": "2020-05-08T17:59:48Z", "message": "add test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NDcxNDMz", "url": "https://github.com/apache/kafka/pull/8632#pullrequestreview-408471433", "createdAt": "2020-05-08T19:28:14Z", "commit": {"oid": "c3a532c57d3e538ea2b108237a8742960eccf674"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxOToyODoxNVrOGSw-HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxOToyODoxNVrOGSw-HQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjMyOTg4NQ==", "bodyText": "FWIW, I'd rather just inline it and avoid maintaining APIs that are just for tests in our production code.", "url": "https://github.com/apache/kafka/pull/8632#discussion_r422329885", "createdAt": "2020-05-08T19:28:15Z", "author": {"login": "vvcephei"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/TaskManager.java", "diffHunk": "@@ -732,15 +732,16 @@ Task taskForInputPartition(final TopicPartition partition) {\n         return tasks.values().stream().filter(t -> !t.isActive());\n     }\n \n+    // For testing only.\n+    int commitAll() {\n+        return commit(tasks.values());\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3a532c57d3e538ea2b108237a8742960eccf674"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NDU0NzU1", "url": "https://github.com/apache/kafka/pull/8632#pullrequestreview-409454755", "createdAt": "2020-05-11T19:12:09Z", "commit": {"oid": "c3a532c57d3e538ea2b108237a8742960eccf674"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1388, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}