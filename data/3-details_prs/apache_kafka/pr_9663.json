{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5ODY0NTUx", "number": 9663, "title": "MINOR: Small cleanups in `AlterIsr` handling logic", "bodyText": "A few small cleanups in Partition handling of AlterIsr:\n\nFactor state update and log message into sendAlterIsrRequest\nEnsure illegal state error gets raised if a retry fails to be enqueued\nAlways check the proposed state against the current state in handleAlterIsrResponse\nAdd toString implementations to IsrState case classes\n\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-11-30T23:09:22Z", "url": "https://github.com/apache/kafka/pull/9663", "merged": true, "mergeCommit": {"oid": "8839514efb9f037462541b8c1957a47ec19a1565"}, "closed": true, "closedAt": "2020-12-01T19:17:09Z", "author": {"login": "hachikuji"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhtoYJAH2gAyNTI5ODY0NTUxOmZhY2IzZjhlOTY0NmM2MGQwMTFmZjNmMGU5YWI1NDYzNDZiZThmYmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdh8pAnAH2gAyNTI5ODY0NTUxOmE3OTkwNzMzMDljOTYxMmZiYTllMmQ0ZTk4NzU5N2FlZGIxNDlkZGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "facb3f8e9646c60d011ff3f0e9ab546346be8fba", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/facb3f8e9646c60d011ff3f0e9ab546346be8fba", "committedDate": "2020-11-30T23:06:34Z", "message": "MINOR: Small cleanups in `AlterIsr` handling logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNTU0MDgy", "url": "https://github.com/apache/kafka/pull/9663#pullrequestreview-541554082", "createdAt": "2020-12-01T07:39:19Z", "commit": {"oid": "facb3f8e9646c60d011ff3f0e9ab546346be8fba"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwNzozOToyMFrOH8beWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwNzozOToyMFrOH8beWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzEyNjc0NQ==", "bodyText": "Could we rewrite it by currying?\nBefore\n    val callbackPartial = handleAlterIsrResponse(proposedIsrState, _ : Either[Errors, LeaderAndIsr])\n\n    if (!alterIsrManager.enqueue(AlterIsrItem(topicPartition, newLeaderAndIsr, callbackPartial))) {\n      throw new IllegalStateException(s\"Failed to enqueue `AlterIsr` request with state \" +\n        s\"$newLeaderAndIsr for partition $topicPartition\")\n    }\nAfter\n    if (!alterIsrManager.enqueue(AlterIsrItem(topicPartition, newLeaderAndIsr, handleAlterIsrResponse(proposedIsrState)))) {\n      throw new IllegalStateException(s\"Failed to enqueue `AlterIsr` request with state \" +\n        s\"$newLeaderAndIsr for partition $topicPartition\")\n    }", "url": "https://github.com/apache/kafka/pull/9663#discussion_r533126745", "createdAt": "2020-12-01T07:39:20Z", "author": {"login": "chia7712"}, "path": "core/src/main/scala/kafka/cluster/Partition.scala", "diffHunk": "@@ -1372,23 +1390,27 @@ class Partition(val topicPartition: TopicPartition,\n    * Since our error was non-retryable we are okay staying in this state until we see new metadata from UpdateMetadata\n    * or LeaderAndIsr\n    */\n-  private def handleAlterIsrResponse(proposedIsr: Set[Int], result: Either[Errors, LeaderAndIsr]): Unit = {\n+  private def handleAlterIsrResponse(proposedIsrState: IsrState, result: Either[Errors, LeaderAndIsr]): Unit = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "facb3f8e9646c60d011ff3f0e9ab546346be8fba"}, "originalPosition": 123}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a799073309c9612fba9e2d4e987597aedb149ddc", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/a799073309c9612fba9e2d4e987597aedb149ddc", "committedDate": "2020-12-01T16:35:50Z", "message": "Use curryed `handleAlterIsrResponse`"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2494, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}