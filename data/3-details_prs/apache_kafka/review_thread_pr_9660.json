{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4ODMwNjkz", "number": 9660, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxNjowNzozOVrOE-R3xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDowMTo0OVrOE-5FOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNzM5OTcyOnYy", "diffSide": "RIGHT", "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxNjowNzozOVrOH7aG9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQyMTowMjowOVrOH7dMcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NTc5Ng==", "bodyText": "the config is not from empty properties so it may be incorrect to remove config.", "url": "https://github.com/apache/kafka/pull/9660#discussion_r532055796", "createdAt": "2020-11-28T16:07:39Z", "author": {"login": "chia7712"}, "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "diffHunk": "@@ -471,7 +471,7 @@ public void shouldCloseProcessor() {\n \n     @Test\n     public void shouldThrowForUnknownTopic() {\n-        testDriver = new TopologyTestDriver(new Topology(), config);\n+        testDriver = new TopologyTestDriver(new Topology());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d62c8fc0ab33e4ac779f60f00e514af1c1024373"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NjEwNg==", "bodyText": "there are a lot of similar code change.", "url": "https://github.com/apache/kafka/pull/9660#discussion_r532056106", "createdAt": "2020-11-28T16:11:05Z", "author": {"login": "chia7712"}, "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "diffHunk": "@@ -471,7 +471,7 @@ public void shouldCloseProcessor() {\n \n     @Test\n     public void shouldThrowForUnknownTopic() {\n-        testDriver = new TopologyTestDriver(new Topology(), config);\n+        testDriver = new TopologyTestDriver(new Topology());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NTc5Ng=="}, "originalCommit": {"oid": "d62c8fc0ab33e4ac779f60f00e514af1c1024373"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjEwNjM1Mw==", "bodyText": "Default config in the test provides application_id and state_dir_config parameters. Majority of the tests like shouldThrowForUnknownTopic,  shouldThrowForMissingTime,  shouldThrowNoSuchElementExceptionForUnusedOutputTopicWithDynamicRoutingdon't,  shouldCaptureSinkTopicNamesIfWrittenInto,  shouldProcessRecordForTopic, shouldSetRecordMetadata don't require these config parameters.                                                                                                                                                                    But tests using state stores such as shouldPopulateGlobalStore, shouldReturnAllStores and shouldThrowIfBuiltInStoreIsAccessedWithUntypedMethod may need specific dir config to clean up after the test. Right now I am relying on default state-dir-config value for these few tests which use state stores. I am open to change those specific tests which use state stores.", "url": "https://github.com/apache/kafka/pull/9660#discussion_r532106353", "createdAt": "2020-11-28T21:02:09Z", "author": {"login": "rohitrmd"}, "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "diffHunk": "@@ -471,7 +471,7 @@ public void shouldCloseProcessor() {\n \n     @Test\n     public void shouldThrowForUnknownTopic() {\n-        testDriver = new TopologyTestDriver(new Topology(), config);\n+        testDriver = new TopologyTestDriver(new Topology());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NTc5Ng=="}, "originalCommit": {"oid": "d62c8fc0ab33e4ac779f60f00e514af1c1024373"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNzQwMTY2OnYy", "diffSide": "RIGHT", "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxNjoxMDoyMFrOH7aH1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQyMDozNzo0M1rOH7dDXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NjAyMw==", "bodyText": "It seems to me putIfAbsent is more readable than containsKey + setProperty.", "url": "https://github.com/apache/kafka/pull/9660#discussion_r532056023", "createdAt": "2020-11-28T16:10:20Z", "author": {"login": "chia7712"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -298,8 +322,14 @@ private TopologyTestDriver(final InternalTopologyBuilder builder,\n                                final long initialWallClockTimeMs) {\n         final Properties configCopy = new Properties();\n         configCopy.putAll(config);\n-        configCopy.putIfAbsent(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, \"dummy-bootstrap-host:0\");\n-        configCopy.putIfAbsent(StreamsConfig.APPLICATION_ID_CONFIG, \"dummy-topology-test-driver-app-id\");\n+        if (!configCopy.containsKey(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d62c8fc0ab33e4ac779f60f00e514af1c1024373"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjEwNDAyOA==", "bodyText": "@chia7712 fixed it.", "url": "https://github.com/apache/kafka/pull/9660#discussion_r532104028", "createdAt": "2020-11-28T20:37:43Z", "author": {"login": "rohitrmd"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -298,8 +322,14 @@ private TopologyTestDriver(final InternalTopologyBuilder builder,\n                                final long initialWallClockTimeMs) {\n         final Properties configCopy = new Properties();\n         configCopy.putAll(config);\n-        configCopy.putIfAbsent(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, \"dummy-bootstrap-host:0\");\n-        configCopy.putIfAbsent(StreamsConfig.APPLICATION_ID_CONFIG, \"dummy-topology-test-driver-app-id\");\n+        if (!configCopy.containsKey(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NjAyMw=="}, "originalCommit": {"oid": "d62c8fc0ab33e4ac779f60f00e514af1c1024373"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNzQwMjg1OnYy", "diffSide": "RIGHT", "path": "streams/src/test/java/org/apache/kafka/streams/TopologyTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQxNjoxMTozM1rOH7aIXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yOFQyMDozNDo1NFrOH7dCOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NjE1Ng==", "bodyText": "Is it ok to remove StreamsConfig.STATE_DIR_CONFIG here?", "url": "https://github.com/apache/kafka/pull/9660#discussion_r532056156", "createdAt": "2020-11-28T16:11:33Z", "author": {"login": "chia7712"}, "path": "streams/src/test/java/org/apache/kafka/streams/TopologyTest.java", "diffHunk": "@@ -353,8 +349,7 @@ public void shouldThrowOnUnassignedStateStoreAccess() {\n             .addProcessor(badNodeName, new LocalMockProcessorSupplier(), sourceNodeName);\n \n         try {\n-            new TopologyTestDriver(topology, mkProperties(\n-                mkMap(mkEntry(StreamsConfig.STATE_DIR_CONFIG, TestUtils.tempDirectory().getAbsolutePath()))));\n+            new TopologyTestDriver(topology);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d62c8fc0ab33e4ac779f60f00e514af1c1024373"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjEwMzczNw==", "bodyText": "That's a good point. This test is validating if exception is thrown when topology is created with processor node which doesn't have state store specified. Providing STATE_DIR_CONFIG config parameter in properties won't alter desired outcome of the test. Hence I removed it.", "url": "https://github.com/apache/kafka/pull/9660#discussion_r532103737", "createdAt": "2020-11-28T20:34:54Z", "author": {"login": "rohitrmd"}, "path": "streams/src/test/java/org/apache/kafka/streams/TopologyTest.java", "diffHunk": "@@ -353,8 +349,7 @@ public void shouldThrowOnUnassignedStateStoreAccess() {\n             .addProcessor(badNodeName, new LocalMockProcessorSupplier(), sourceNodeName);\n \n         try {\n-            new TopologyTestDriver(topology, mkProperties(\n-                mkMap(mkEntry(StreamsConfig.STATE_DIR_CONFIG, TestUtils.tempDirectory().getAbsolutePath()))));\n+            new TopologyTestDriver(topology);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NjE1Ng=="}, "originalCommit": {"oid": "d62c8fc0ab33e4ac779f60f00e514af1c1024373"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzgyMzk1OnYy", "diffSide": "RIGHT", "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDowMTo0OVrOH8SuLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwNjoyNTo0MFrOH8Zx-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk4MzM0Mg==", "bodyText": "This overload takes initialWallClockTimeMs, thus this sentence seems to be incorrect? Should go to TopologyTestDriver(final Topology topology) instead?", "url": "https://github.com/apache/kafka/pull/9660#discussion_r532983342", "createdAt": "2020-12-01T00:01:49Z", "author": {"login": "mjsax"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -254,6 +265,19 @@ public TopologyTestDriver(final Topology topology,\n         this(topology, config, null);\n     }\n \n+    /**\n+     * Create a new test diver instance.\n+     * Initialized the internally mocked wall-clock time with {@link System#currentTimeMillis() current system time}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b098e345a0df5151c57c6831571be85fbf0de769"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA5OTAwMw==", "bodyText": "@mjsax fixed the comment.", "url": "https://github.com/apache/kafka/pull/9660#discussion_r533099003", "createdAt": "2020-12-01T06:25:40Z", "author": {"login": "rohitrmd"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -254,6 +265,19 @@ public TopologyTestDriver(final Topology topology,\n         this(topology, config, null);\n     }\n \n+    /**\n+     * Create a new test diver instance.\n+     * Initialized the internally mocked wall-clock time with {@link System#currentTimeMillis() current system time}.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk4MzM0Mg=="}, "originalCommit": {"oid": "b098e345a0df5151c57c6831571be85fbf0de769"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3629, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}