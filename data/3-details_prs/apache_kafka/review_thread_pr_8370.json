{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NDg4OTYy", "number": 8370, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDozMzoxN1rODr4hZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1MTowN1rODtPhYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MzQxNDEzOnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/Task.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDozMzoxN1rOF8fQ9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjo0MDozN1rOF-qykA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk3MTEyNw==", "bodyText": "This is a bit awkward.. if anyone have a more elegant solution I'm all ears.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r398971127", "createdAt": "2020-03-27T00:33:17Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/Task.java", "diffHunk": "@@ -192,6 +192,10 @@ public boolean isValidTransition(final State newState) {\n \n     void markChangelogAsCorrupted(final Collection<TopicPartition> partitions);\n \n+    void recordProcessLatency(final long elapsedLatencyMs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "decaa94dbbf1cc5b4370c196e8dc284fe9618381"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEzNTYzMw==", "bodyText": "prop: You could record the time spent in processing in Task#process() and just have a method Task#recordProcessRatio(final long totalProcessTime) in the interface.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401135633", "createdAt": "2020-03-31T18:45:47Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/Task.java", "diffHunk": "@@ -192,6 +192,10 @@ public boolean isValidTransition(final State newState) {\n \n     void markChangelogAsCorrupted(final Collection<TopicPartition> partitions);\n \n+    void recordProcessLatency(final long elapsedLatencyMs);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk3MTEyNw=="}, "originalCommit": {"oid": "decaa94dbbf1cc5b4370c196e8dc284fe9618381"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE5NTM2Ng==", "bodyText": "Hey @guozhangwang , I did have some ideas (similar to @cadonna 's), but it might be easier to just present it as a diff: guozhangwang#12", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401195366", "createdAt": "2020-03-31T20:29:50Z", "author": {"login": "vvcephei"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/Task.java", "diffHunk": "@@ -192,6 +192,10 @@ public boolean isValidTransition(final State newState) {\n \n     void markChangelogAsCorrupted(final Collection<TopicPartition> partitions);\n \n+    void recordProcessLatency(final long elapsedLatencyMs);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk3MTEyNw=="}, "originalCommit": {"oid": "decaa94dbbf1cc5b4370c196e8dc284fe9618381"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1NzEwNA==", "bodyText": "I originally did this, but I'm concerned that the latency for processing a single record is sub-milliseconds and hence the cumulated latency would be zero.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401257104", "createdAt": "2020-03-31T22:40:37Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/Task.java", "diffHunk": "@@ -192,6 +192,10 @@ public boolean isValidTransition(final State newState) {\n \n     void markChangelogAsCorrupted(final Collection<TopicPartition> partitions);\n \n+    void recordProcessLatency(final long elapsedLatencyMs);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk3MTEyNw=="}, "originalCommit": {"oid": "decaa94dbbf1cc5b4370c196e8dc284fe9618381"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NzEyNjI0OnYy", "diffSide": "RIGHT", "path": "streams/src/test/java/org/apache/kafka/streams/integration/QueryableStateIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMTo0Nzo1NlrOF9C0MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODoyOTo1OFrOF-ix4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1MzU4NA==", "bodyText": "This test becomes more flaky than before after the main loop refactoring, shown as the following:\njava.lang.AssertionError: Did not receive all 48 records from topic output-concurrent-2 within 120000 ms\nExpected: is a value equal to or greater than <48>\n     but: <38> was less than <48>\n\nEach iteration has 48 words, and 38 unique words, and when it fails it reported only 38 records ever consumed from the output topic. I suspect this is because of the caching effects, we processed all 500000 iterations without sending out any updates to the resulted count table output topic (seems we process too fast?).\nI piggy-backed a fix for this flakiness by reducing the requirement that we start the verification as long as we've seen one record in the output, similar as we do in other tests, and then in verifyGreaterOrEqual we do not require all keys been populated already.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r399553584", "createdAt": "2020-03-27T21:47:56Z", "author": {"login": "guozhangwang"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/QueryableStateIntegrationTest.java", "diffHunk": "@@ -646,8 +645,8 @@ public void concurrentAccesses() throws Exception {\n         producerThread.start();\n \n         try {\n-            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrent, numberOfWordsPerIteration);\n-            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrentWindowed, numberOfWordsPerIteration);\n+            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrent, 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyNTg1Ng==", "bodyText": "prop: I would prefer to have this fix in its own PR, because the commit would be easier to retrieve and to reference on failure tickets.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401125856", "createdAt": "2020-03-31T18:29:58Z", "author": {"login": "cadonna"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/QueryableStateIntegrationTest.java", "diffHunk": "@@ -646,8 +645,8 @@ public void concurrentAccesses() throws Exception {\n         producerThread.start();\n \n         try {\n-            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrent, numberOfWordsPerIteration);\n-            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrentWindowed, numberOfWordsPerIteration);\n+            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrent, 1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1MzU4NA=="}, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3NzEyODI2OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMTo0ODo0OFrOF9C1WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjo0NTo0OVrOF-q5sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1Mzg4MQ==", "bodyText": "Note we should only call this inside the if (state == State.RUNNING) condition otherwise we may get ConcurrentModification exception.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r399553881", "createdAt": "2020-03-27T21:48:48Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -704,6 +707,10 @@ void runOnce() {\n                     numIterations++;\n                 }\n             } while (true);\n+\n+            // we record the ratio out of the while loop so that the accumulated latency spans over\n+            // multiple iterations with reasonably large max.num.records and hence is less vulnerable to outliers\n+            taskManager.recordTaskProcessRatio(totalProcessLatency);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyMjI1Mg==", "bodyText": "Q: Could you elaborate on this?", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401122252", "createdAt": "2020-03-31T18:24:13Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -704,6 +707,10 @@ void runOnce() {\n                     numIterations++;\n                 }\n             } while (true);\n+\n+            // we record the ratio out of the while loop so that the accumulated latency spans over\n+            // multiple iterations with reasonably large max.num.records and hence is less vulnerable to outliers\n+            taskManager.recordTaskProcessRatio(totalProcessLatency);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1Mzg4MQ=="}, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1ODkyOQ==", "bodyText": "I do not know exactly what's happening here, my guess is that in PARTITION_REVOKED state the tasks might be modified.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401258929", "createdAt": "2020-03-31T22:45:49Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -704,6 +707,10 @@ void runOnce() {\n                     numIterations++;\n                 }\n             } while (true);\n+\n+            // we record the ratio out of the while loop so that the accumulated latency spans over\n+            // multiple iterations with reasonably large max.num.records and hence is less vulnerable to outliers\n+            taskManager.recordTaskProcessRatio(totalProcessLatency);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1Mzg4MQ=="}, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzA2NjE0OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/metrics/TaskMetrics.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoxNjozOFrOF-dpQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjo1MzozMVrOF-rEMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0MTczMA==", "bodyText": "req: Could you please add tests for this new sensor to TaskMetricsTest.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401041730", "createdAt": "2020-03-31T16:16:38Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/metrics/TaskMetrics.java", "diffHunk": "@@ -96,6 +103,22 @@ public static Sensor processLatencySensor(final String threadId,\n         return emptySensor(threadId, taskId, PROCESS_LATENCY, RecordingLevel.DEBUG, streamsMetrics);\n     }\n \n+    public static Sensor activeProcessRatioSensor(final String threadId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI2MTYxNg==", "bodyText": "ack.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401261616", "createdAt": "2020-03-31T22:53:31Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/metrics/TaskMetrics.java", "diffHunk": "@@ -96,6 +103,22 @@ public static Sensor processLatencySensor(final String threadId,\n         return emptySensor(threadId, taskId, PROCESS_LATENCY, RecordingLevel.DEBUG, streamsMetrics);\n     }\n \n+    public static Sensor activeProcessRatioSensor(final String threadId,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0MTczMA=="}, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzEyNDU5OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/metrics/TaskMetrics.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjozMDozNlrOF-eOvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjo0Njo1MVrOF-q7GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA1MTMyNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    sensor.add(\n          \n          \n            \n                        new MetricName(\n          \n          \n            \n                            name,\n          \n          \n            \n                            TASK_LEVEL_GROUP,\n          \n          \n            \n                            PROCESS_RATIO_DESCRIPTION,\n          \n          \n            \n                            streamsMetrics.taskLevelTagMap(threadId, taskId)),\n          \n          \n            \n                        new Value()\n          \n          \n            \n                    );\n          \n          \n            \n                    addValueMetricToSensor(\n          \n          \n            \n                        sensor,\n          \n          \n            \n                        TASK_LEVEL_GROUP,\n          \n          \n            \n                        streamsMetrics.taskLevelTagMap(threadId, taskId),\n          \n          \n            \n                        name,\n          \n          \n            \n                        PROCESS_RATIO_DESCRIPTION\n          \n          \n            \n                    );\n          \n      \n    \n    \n  \n\nreq: Please use StreamsMetricsImpl#addValueMetricToSensor()", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401051326", "createdAt": "2020-03-31T16:30:36Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/metrics/TaskMetrics.java", "diffHunk": "@@ -96,6 +103,22 @@ public static Sensor processLatencySensor(final String threadId,\n         return emptySensor(threadId, taskId, PROCESS_LATENCY, RecordingLevel.DEBUG, streamsMetrics);\n     }\n \n+    public static Sensor activeProcessRatioSensor(final String threadId,\n+                                                  final String taskId,\n+                                                  final StreamsMetricsImpl streamsMetrics) {\n+        final String name = ACTIVE_TASK_PREFIX + PROCESS + RATIO_SUFFIX;\n+        final Sensor sensor = streamsMetrics.taskLevelSensor(threadId, taskId, name, Sensor.RecordingLevel.INFO);\n+        sensor.add(\n+            new MetricName(\n+                name,\n+                TASK_LEVEL_GROUP,\n+                PROCESS_RATIO_DESCRIPTION,\n+                streamsMetrics.taskLevelTagMap(threadId, taskId)),\n+            new Value()\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1OTI4OQ==", "bodyText": "ack.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401259289", "createdAt": "2020-03-31T22:46:51Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/metrics/TaskMetrics.java", "diffHunk": "@@ -96,6 +103,22 @@ public static Sensor processLatencySensor(final String threadId,\n         return emptySensor(threadId, taskId, PROCESS_LATENCY, RecordingLevel.DEBUG, streamsMetrics);\n     }\n \n+    public static Sensor activeProcessRatioSensor(final String threadId,\n+                                                  final String taskId,\n+                                                  final StreamsMetricsImpl streamsMetrics) {\n+        final String name = ACTIVE_TASK_PREFIX + PROCESS + RATIO_SUFFIX;\n+        final Sensor sensor = streamsMetrics.taskLevelSensor(threadId, taskId, name, Sensor.RecordingLevel.INFO);\n+        sensor.add(\n+            new MetricName(\n+                name,\n+                TASK_LEVEL_GROUP,\n+                PROCESS_RATIO_DESCRIPTION,\n+                streamsMetrics.taskLevelTagMap(threadId, taskId)),\n+            new Value()\n+        );", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA1MTMyNg=="}, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzUzNDQyOnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/AbstractTask.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODoxNTo1MVrOF-iQjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMjo1Mzo0NFrOF-rEgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExNzMyNg==", "bodyText": "prop: I find processLatency and totalLatency a bit misleading. What about processTime and totalProcessTime.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401117326", "createdAt": "2020-03-31T18:15:51Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/AbstractTask.java", "diffHunk": "@@ -68,6 +70,17 @@ public void markChangelogAsCorrupted(final Collection<TopicPartition> partitions\n         stateMgr.markChangelogAsCorrupted(partitions);\n     }\n \n+    @Override\n+    public void recordProcessLatency(final long elapsedLatencyMs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI2MTY5OA==", "bodyText": "ack.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401261698", "createdAt": "2020-03-31T22:53:44Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/AbstractTask.java", "diffHunk": "@@ -68,6 +70,17 @@ public void markChangelogAsCorrupted(final Collection<TopicPartition> partitions\n         stateMgr.markChangelogAsCorrupted(partitions);\n     }\n \n+    @Override\n+    public void recordProcessLatency(final long elapsedLatencyMs) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExNzMyNg=="}, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzU1MzQ3OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODoyMToyMFrOF-ic4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODoyMToyMFrOF-ic4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyMDQ4Mg==", "bodyText": "prop: Could you rename recordTotalLatency() to recordProcessRatioAndReset().", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401120482", "createdAt": "2020-03-31T18:21:20Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -616,6 +619,12 @@ public boolean process(final long wallClockTime) {\n         return true;\n     }\n \n+    @Override\n+    public void recordTotalLatency(final long elapsedLatencyMs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzY2NzE1OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1MDo1MVrOF-jkBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1MDo1MVrOF-jkBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEzODY5Mw==", "bodyText": "req: Could you please add a unit test for this method?", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401138693", "createdAt": "2020-03-31T18:50:51Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -616,6 +619,12 @@ public boolean process(final long wallClockTime) {\n         return true;\n     }\n \n+    @Override\n+    public void recordTotalLatency(final long elapsedLatencyMs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzY2ODE5OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/AbstractTask.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1MTowN1rOF-jkrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1MTowN1rOF-jkrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEzODg2MA==", "bodyText": "req: Could you please add a unit test for this method?", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401138860", "createdAt": "2020-03-31T18:51:07Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/AbstractTask.java", "diffHunk": "@@ -68,6 +70,17 @@ public void markChangelogAsCorrupted(final Collection<TopicPartition> partitions\n         stateMgr.markChangelogAsCorrupted(partitions);\n     }\n \n+    @Override\n+    public void recordProcessLatency(final long elapsedLatencyMs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3131, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}