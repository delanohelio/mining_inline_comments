{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNTc0NTQ2", "number": 8443, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMToyNTo0MlrODvzJ2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMTo0ODoxMFrODwOcWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDQ3NzY5OnYy", "diffSide": "RIGHT", "path": "streams/src/test/java/org/apache/kafka/streams/tests/RelationalSmokeTestTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMToyNTo0MlrOGCbzWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwNTo0MzozMFrOGCfvdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwNTg1MA==", "bodyText": "nit: we could add all 3 modes in this test too", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405205850", "createdAt": "2020-04-08T01:25:42Z", "author": {"login": "abbccdda"}, "path": "streams/src/test/java/org/apache/kafka/streams/tests/RelationalSmokeTestTest.java", "diffHunk": "@@ -39,6 +41,7 @@ public void verifySmokeTestLogic() {\n                                             \"nothing:0\",\n                                             \"test\",\n                                             \"test\",\n+                                            StreamsConfig.AT_LEAST_ONCE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d05897d258cc0af8f7515e57f4814eb7d76a155"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI3MDM4OQ==", "bodyText": "This is just a \"sanity\" check using TopologyTestDriver -- running it with all 3 modes does not buy us anything as the TTD does not work any different for the 3 modes.", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405270389", "createdAt": "2020-04-08T05:43:30Z", "author": {"login": "mjsax"}, "path": "streams/src/test/java/org/apache/kafka/streams/tests/RelationalSmokeTestTest.java", "diffHunk": "@@ -39,6 +41,7 @@ public void verifySmokeTestLogic() {\n                                             \"nothing:0\",\n                                             \"test\",\n                                             \"test\",\n+                                            StreamsConfig.AT_LEAST_ONCE,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwNTg1MA=="}, "originalCommit": {"oid": "6d05897d258cc0af8f7515e57f4814eb7d76a155"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDU4OTE4OnYy", "diffSide": "RIGHT", "path": "streams/src/test/java/org/apache/kafka/streams/tests/RelationalSmokeTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMjozMDoyMVrOGCc2gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxODoxMjozMlrOGC7Fzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIyMzA0MA==", "bodyText": "Reading from the comment, the RelationalSmokeTest has nothing to do with EOS, why do we need to expand this test? cc @vvcephei", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405223040", "createdAt": "2020-04-08T02:30:21Z", "author": {"login": "abbccdda"}, "path": "streams/src/test/java/org/apache/kafka/streams/tests/RelationalSmokeTest.java", "diffHunk": "@@ -637,13 +637,14 @@ public static Topology getTopology() {\n         public static Properties getConfig(final String broker,\n                                            final String application,\n                                            final String id,\n+                                           final String processingGuarantee,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d05897d258cc0af8f7515e57f4814eb7d76a155"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTI3MDAyNw==", "bodyText": "The test had EOS enabled. So I extended it to now run with both EOS versions.", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405270027", "createdAt": "2020-04-08T05:42:18Z", "author": {"login": "mjsax"}, "path": "streams/src/test/java/org/apache/kafka/streams/tests/RelationalSmokeTest.java", "diffHunk": "@@ -637,13 +637,14 @@ public static Topology getTopology() {\n         public static Properties getConfig(final String broker,\n                                            final String application,\n                                            final String id,\n+                                           final String processingGuarantee,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIyMzA0MA=="}, "originalCommit": {"oid": "6d05897d258cc0af8f7515e57f4814eb7d76a155"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcxODQ3OA==", "bodyText": "I think it worth adding both eos mode for this test --- if we only have this test with eos-beta there may be some regressions not captured.\nIn the future, when we deprecate eos-alpha in some release version that requires broker > 2.5 we can remove eos-alpha parameters in all these.", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405718478", "createdAt": "2020-04-08T18:12:32Z", "author": {"login": "guozhangwang"}, "path": "streams/src/test/java/org/apache/kafka/streams/tests/RelationalSmokeTest.java", "diffHunk": "@@ -637,13 +637,14 @@ public static Topology getTopology() {\n         public static Properties getConfig(final String broker,\n                                            final String application,\n                                            final String id,\n+                                           final String processingGuarantee,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIyMzA0MA=="}, "originalCommit": {"oid": "6d05897d258cc0af8f7515e57f4814eb7d76a155"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODk0NTk4OnYy", "diffSide": "LEFT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ActiveTaskCreator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMTo0NjozMlrOGDGywQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMTo0NjozMlrOGDGywQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkxMDIwOQ==", "bodyText": "@guozhangwang @abbccdda this was the correct way to set the transaction.id -- during the refactoring this code was not moved into StreamsProducer as it should have", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405910209", "createdAt": "2020-04-09T01:46:32Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ActiveTaskCreator.java", "diffHunk": "@@ -87,8 +86,6 @@\n         this.log = log;\n \n         createTaskSensor = ThreadMetrics.createTaskSensor(threadId, streamsMetrics);\n-        final String applicationId = config.getString(StreamsConfig.APPLICATION_ID_CONFIG);\n-        transactionalId = applicationId + \"-\" + processId + \"-StreamThread-\" + threadId.split(\"-StreamThread-\")[1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f7ee56278adb524ab04ec1cde667ec8e06e69ed"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxODk0ODc1OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamsProducer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMTo0ODoxMFrOGDG0bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwMTo0ODoxMFrOGDG0bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkxMDYzNg==", "bodyText": "Include the thread-index in the transactional.id to generate unique IDs for different threads within the same process.\n(I stripped out the \"-StreamThread-\" string in contrast to the old code for shorten the ID)", "url": "https://github.com/apache/kafka/pull/8443#discussion_r405910636", "createdAt": "2020-04-09T01:48:10Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamsProducer.java", "diffHunk": "@@ -113,7 +113,9 @@ public StreamsProducer(final StreamsConfig config,\n                 final String applicationId = config.getString(StreamsConfig.APPLICATION_ID_CONFIG);\n                 producerConfigs.put(\n                     ProducerConfig.TRANSACTIONAL_ID_CONFIG,\n-                    applicationId + \"-\" + Objects.requireNonNull(processId, \"processId cannot be null for exactly-once beta\"));\n+                    applicationId + \"-\" +\n+                        Objects.requireNonNull(processId, \"processId cannot be null for exactly-once beta\") +\n+                        \"-\" + threadId.split(\"-StreamThread-\")[1]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f7ee56278adb524ab04ec1cde667ec8e06e69ed"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2933, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}