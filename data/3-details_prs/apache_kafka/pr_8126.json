{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1ODc0MDI0", "number": 8126, "title": "KAFKA-8025: Fix flaky RocksDB test", "bodyText": "Reading the stack trace on the Jira, I think the issue might be related to the shared mock object we use.\nThe test testup is a little bit upside down to allow the usage of reflection. The test verifies that a method is called, by not registering an expected call, and catching the corresponding exception from verify() (because we use reflections, we cannot easily register an expected call and let verify() throw if the call was not made).\nThus, the expected message from verify() is something like:\nUnexpected method call DBOptions.setEnableThreadTracking(true):\n\nWhen the test fails the stack trace says:\nUnexpected method call DBOptions.setEnableThreadTracking(true):\\n    DBOptions.close(): expected: 1, actual: 0\n\nIt indicates that an expected call was registered, however, the test actually never does this. Thus, I suspect that the mocked object is not isolated and as the tests are executed in parallel some race-condition applies (eg, one thread calls a method in the actual test to eventually trigger the exception in verify, while the other thread is just calling replay() accidentally register the call of the other thread as expected method call).\nThis fix tries to address the issue, by moving the mocked objects as local variables into the test methods.\nCall for review @vvcephei @bbejeck @cadonna", "createdAt": "2020-02-16T21:14:49Z", "url": "https://github.com/apache/kafka/pull/8126", "merged": true, "mergeCommit": {"oid": "ebcdcd9fa94efbff80e52b02c85d4a61c09f850b"}, "closed": true, "closedAt": "2020-02-18T19:29:15Z", "author": {"login": "mjsax"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcE_JzDAH2gAyMzc1ODc0MDI0OmRjNTdhM2UzMTZiNGMwZTNkNzZmM2M0ZTViMTdiMDdmOWRlNDBmM2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFUQQvAFqTM1OTk3MzExNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dc57a3e316b4c0e3d76f3c4e5b17b07f9de40f3b", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/dc57a3e316b4c0e3d76f3c4e5b17b07f9de40f3b", "committedDate": "2020-02-16T20:56:30Z", "message": "KAFKA-8025: Fix flaky RocksDB test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32986a6c32fc4f5064b5bf430f645f2777bd8d38", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/32986a6c32fc4f5064b5bf430f645f2777bd8d38", "committedDate": "2020-02-16T21:24:51Z", "message": "Rearrage methods to group want belongs together"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NDMwMjc0", "url": "https://github.com/apache/kafka/pull/8126#pullrequestreview-359430274", "createdAt": "2020-02-16T21:26:23Z", "commit": {"oid": "32986a6c32fc4f5064b5bf430f645f2777bd8d38"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQyMToyNjoyNFrOFqVXhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQyMToyNjoyNFrOFqVXhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzNDU5OQ==", "bodyText": "Just moving them to the end of the test to group methods that belong together.", "url": "https://github.com/apache/kafka/pull/8126#discussion_r379934599", "createdAt": "2020-02-16T21:26:24Z", "author": {"login": "mjsax"}, "path": "streams/src/test/java/org/apache/kafka/streams/state/internals/RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.java", "diffHunk": "@@ -112,47 +107,16 @@ public void shouldForwardAllDbOptionsCalls() throws Exception {\n         }\n     }\n \n-    @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32986a6c32fc4f5064b5bf430f645f2777bd8d38"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5OTczMTE1", "url": "https://github.com/apache/kafka/pull/8126#pullrequestreview-359973115", "createdAt": "2020-02-17T21:31:34Z", "commit": {"oid": "32986a6c32fc4f5064b5bf430f645f2777bd8d38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1470, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}