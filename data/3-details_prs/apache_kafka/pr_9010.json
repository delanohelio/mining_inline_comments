{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3Njg2NjE4", "number": 9010, "title": "KAFKA-10262: Ensure that creating task directory is thread safe", "bodyText": "More detailed description of your change,\nif necessary. The PR title and PR message become\nthe squashed commit message, so use a separate\ncomment to ping reviewers.\nSummary of testing strategy (including rationale)\nfor the feature or bug fix. Unit and/or integration\ntests are expected for any behaviour change and\nsystem tests should be considered for larger changes.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-07-10T23:56:25Z", "url": "https://github.com/apache/kafka/pull/9010", "merged": true, "mergeCommit": {"oid": "f2db8d5318e099e492e44effbfcea57005c1cf94"}, "closed": true, "closedAt": "2020-07-11T18:11:07Z", "author": {"login": "mjsax"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczsnQJgH2gAyNDQ3Njg2NjE4OjE1YTg5M2U2YzVjMThjOWViNGVhMzI3NTY2ZjY4MjFmZmU5MDg3NDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcztfsdAH2gAyNDQ3Njg2NjE4OjM4NmZhN2FiYTI2MzY0NTRlZDZlYWY3OThhNTQxM2VhNDlkNzc0NTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15a893e6c5c18c9eb4ea327566f6821ffe908741", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/15a893e6c5c18c9eb4ea327566f6821ffe908741", "committedDate": "2020-07-10T23:54:55Z", "message": "KAFKA-10262: Ensure that creating task directory is thread safe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdbc4fae6cf8cbafbc06c43c6a697a9db3d03a66", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/bdbc4fae6cf8cbafbc06c43c6a697a9db3d03a66", "committedDate": "2020-07-11T00:30:16Z", "message": "Add test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzYwMTIz", "url": "https://github.com/apache/kafka/pull/9010#pullrequestreview-446760123", "createdAt": "2020-07-11T00:32:43Z", "commit": {"oid": "bdbc4fae6cf8cbafbc06c43c6a697a9db3d03a66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwMDozMjo0M1rOGwI8-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwMDozMjo0M1rOGwI8-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEzMTUxNQ==", "bodyText": "Without the fix, this test fails like 100% of the time for me. (Kinda surprising -- seems that the disk IO operations give us nice thread context switches so we hit the issue reliably.)", "url": "https://github.com/apache/kafka/pull/9010#discussion_r453131515", "createdAt": "2020-07-11T00:32:43Z", "author": {"login": "mjsax"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StateDirectoryTest.java", "diffHunk": "@@ -507,4 +510,51 @@ public void shouldLockGlobalStateDirectoryWhenDirectoryCreationDisabled() throws\n         initializeStateDirectory(false);\n         assertTrue(directory.lockGlobalState());\n     }\n+\n+    @Test\n+    public void shouldNotFailWhenCreatingTaskDirectoryInParallel() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdbc4fae6cf8cbafbc06c43c6a697a9db3d03a66"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzYxMzY0", "url": "https://github.com/apache/kafka/pull/9010#pullrequestreview-446761364", "createdAt": "2020-07-11T00:42:32Z", "commit": {"oid": "bdbc4fae6cf8cbafbc06c43c6a697a9db3d03a66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwMDo0MjozM1rOGwJCRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwMDo0MjozM1rOGwJCRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEzMjg3MQ==", "bodyText": "super nit: taskCreationLock --> taskDirCreationLock", "url": "https://github.com/apache/kafka/pull/9010#discussion_r453132871", "createdAt": "2020-07-11T00:42:33Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StateDirectory.java", "diffHunk": "@@ -47,10 +47,10 @@\n public class StateDirectory {\n \n     private static final Pattern PATH_NAME = Pattern.compile(\"\\\\d+_\\\\d+\");\n-\n-    static final String LOCK_FILE_NAME = \".lock\";\n     private static final Logger log = LoggerFactory.getLogger(StateDirectory.class);\n+    static final String LOCK_FILE_NAME = \".lock\";\n \n+    private final Object taskCreationLock = new Object();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdbc4fae6cf8cbafbc06c43c6a697a9db3d03a66"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzYxMzM4", "url": "https://github.com/apache/kafka/pull/9010#pullrequestreview-446761338", "createdAt": "2020-07-11T00:42:17Z", "commit": {"oid": "bdbc4fae6cf8cbafbc06c43c6a697a9db3d03a66"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwMDo0MjoxN1rOGwJCNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMVQwMDo0MjoxN1rOGwJCNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEzMjg1Mw==", "bodyText": "Huh, neat!", "url": "https://github.com/apache/kafka/pull/9010#discussion_r453132853", "createdAt": "2020-07-11T00:42:17Z", "author": {"login": "vvcephei"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StateDirectoryTest.java", "diffHunk": "@@ -507,4 +510,51 @@ public void shouldLockGlobalStateDirectoryWhenDirectoryCreationDisabled() throws\n         initializeStateDirectory(false);\n         assertTrue(directory.lockGlobalState());\n     }\n+\n+    @Test\n+    public void shouldNotFailWhenCreatingTaskDirectoryInParallel() throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEzMTUxNQ=="}, "originalCommit": {"oid": "bdbc4fae6cf8cbafbc06c43c6a697a9db3d03a66"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzYyMTkx", "url": "https://github.com/apache/kafka/pull/9010#pullrequestreview-446762191", "createdAt": "2020-07-11T00:49:04Z", "commit": {"oid": "bdbc4fae6cf8cbafbc06c43c6a697a9db3d03a66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "386fa7aba2636454ed6eaf798a5413ea49d77459", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/386fa7aba2636454ed6eaf798a5413ea49d77459", "committedDate": "2020-07-11T00:56:34Z", "message": "Github comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1265, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}