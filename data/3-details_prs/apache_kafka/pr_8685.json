{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MzQ0NTU1", "number": 8685, "title": "KAFKA-10014 Always try to close all channels in Selector#close", "bodyText": "https://issues.apache.org/jira/browse/KAFKA-10014\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-05-18T08:37:26Z", "url": "https://github.com/apache/kafka/pull/8685", "merged": true, "mergeCommit": {"oid": "164db1a6611224e0289df15215344ce6d600d7b1"}, "closed": true, "closedAt": "2020-06-10T19:24:32Z", "author": {"login": "chia7712"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcilIKxgFqTQxMzg4MzIxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp8orpgFqTQyODI1MjU3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzODgzMjE1", "url": "https://github.com/apache/kafka/pull/8685#pullrequestreview-413883215", "createdAt": "2020-05-18T19:34:55Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxOTozNDo1NVrOGXE3uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxOTozNDo1NVrOGXE3uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg1MDIzMg==", "bodyText": "Have we considered using Utils.closeAll instead of multiple closeQuietly?", "url": "https://github.com/apache/kafka/pull/8685#discussion_r426850232", "createdAt": "2020-05-18T19:34:55Z", "author": {"login": "ijuma"}, "path": "clients/src/main/java/org/apache/kafka/common/network/Selector.java", "diffHunk": "@@ -363,23 +363,14 @@ public void wakeup() {\n     @Override\n     public void close() {\n         List<String> connections = new ArrayList<>(channels.keySet());\n-        try {\n-            for (String id : connections)\n-                close(id);\n-        } finally {\n-            // If there is any exception thrown in close(id), we should still be able\n-            // to close the remaining objects, especially the sensors because keeping\n-            // the sensors may lead to failure to start up the ReplicaFetcherThread if\n-            // the old sensors with the same names has not yet been cleaned up.\n-            AtomicReference<Throwable> firstException = new AtomicReference<>();\n-            Utils.closeQuietly(nioSelector, \"nioSelector\", firstException);\n-            Utils.closeQuietly(sensors, \"sensors\", firstException);\n-            Utils.closeQuietly(channelBuilder, \"channelBuilder\", firstException);\n-            Throwable exception = firstException.get();\n-            if (exception instanceof RuntimeException && !(exception instanceof SecurityException)) {\n-                throw (RuntimeException) exception;\n-            }\n-\n+        AtomicReference<Throwable> firstException = new AtomicReference<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "c6adcca95f03758089715c60e806a8090f5422d9", "author": {"user": {"login": "lbradstreet", "name": "Lucas Bradstreet"}}, "url": "https://github.com/apache/kafka/commit/c6adcca95f03758089715c60e806a8090f5422d9", "committedDate": "2020-05-26T04:51:14Z", "message": "MINOR: avoid unnecessary list iteration in ApiVersion.lastVersion (#8708)\n\nWe unnecessarily iterate the versions list each time we lookup\r\nlastVersion, including in the hotpath Log.appendAsFollower.\r\nGiven that allVersions is a constant, this is unnecessary.\r\n\r\nReviewers: Chia-Ping Tsai <chia7712@gmail.com>, Ismael Juma <ismael@juma.me.uk>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "665e7efd171a17ef783ec82bb87cde17b7deb5d7", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/665e7efd171a17ef783ec82bb87cde17b7deb5d7", "committedDate": "2020-06-08T03:52:40Z", "message": "KAFKA-10014 Always try to close all channels in Selector#close"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "665e7efd171a17ef783ec82bb87cde17b7deb5d7", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/665e7efd171a17ef783ec82bb87cde17b7deb5d7", "committedDate": "2020-06-08T03:52:40Z", "message": "KAFKA-10014 Always try to close all channels in Selector#close"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MjUyNTc4", "url": "https://github.com/apache/kafka/pull/8685#pullrequestreview-428252578", "createdAt": "2020-06-10T16:55:43Z", "commit": {"oid": "665e7efd171a17ef783ec82bb87cde17b7deb5d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1075, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}