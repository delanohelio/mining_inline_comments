{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MDQ1Njk0", "number": 8631, "title": "MINOR: improve tests for TopologyTestDriver", "bodyText": "Follow up to #8483 (in particular #8483 (comment))\nCall for review @big-andy-coates @vvcephei", "createdAt": "2020-05-08T04:57:14Z", "url": "https://github.com/apache/kafka/pull/8631", "merged": true, "mergeCommit": {"oid": "c9dc0cd9cf474794ceee1977542740bcb64e4439"}, "closed": true, "closedAt": "2020-05-12T22:10:23Z", "author": {"login": "mjsax"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfKjAIgH2gAyNDE1MDQ1Njk0OmIxY2IwOTBjMTgxNzE4YTQ4ZjUwMmQ2NmE1NGY1Mzc4ZTRjZTU3MDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcggr8QgFqTQwOTg1MzE0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b1cb090c181718a48f502d66a54f5378e4ce5702", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/b1cb090c181718a48f502d66a54f5378e4ce5702", "committedDate": "2020-05-08T04:55:01Z", "message": "MINOR: improve tests for TopologyTestDriver"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b94b59e26b27c4290ebb44f67f0034cd8f52db71", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/b94b59e26b27c4290ebb44f67f0034cd8f52db71", "committedDate": "2020-05-08T05:04:01Z", "message": "minor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NTgxODA0", "url": "https://github.com/apache/kafka/pull/8631#pullrequestreview-408581804", "createdAt": "2020-05-08T23:46:43Z", "commit": {"oid": "b94b59e26b27c4290ebb44f67f0034cd8f52db71"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODUzMTQx", "url": "https://github.com/apache/kafka/pull/8631#pullrequestreview-409853141", "createdAt": "2020-05-12T09:16:11Z", "commit": {"oid": "b94b59e26b27c4290ebb44f67f0034cd8f52db71"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwOToxNjoxMVrOGT9qFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwOToxNjoxMVrOGT9qFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU4NjMyNg==", "bodyText": "Would this test still pass, even without the global table?", "url": "https://github.com/apache/kafka/pull/8631#discussion_r423586326", "createdAt": "2020-05-12T09:16:11Z", "author": {"login": "big-andy-coates"}, "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "diffHunk": "@@ -467,23 +471,62 @@ public void shouldThrowForUnknownTopicDeprecated() {\n     }\n \n     @Test\n-    public void shouldGetSinkTopicNames() {\n+    public void shouldCaptureSinkTopicNamesIfWrittenInto() {\n         testDriver = new TopologyTestDriver(setupSourceSinkTopology(), config);\n \n-        pipeRecord(SOURCE_TOPIC_1, testRecord1);\n+        assertThat(testDriver.producedTopicNames(), is(Collections.emptySet()));\n \n+        pipeRecord(SOURCE_TOPIC_1, testRecord1);\n         assertThat(testDriver.producedTopicNames(), hasItem(SINK_TOPIC_1));\n     }\n \n     @Test\n-    public void shouldGetInternalTopicNames() {\n-        testDriver = new TopologyTestDriver(setupTopologyWithInternalTopic(), config);\n+    public void shouldCaptureInternalTopicNamesIfWrittenInto() {\n+        testDriver = new TopologyTestDriver(\n+            setupTopologyWithInternalTopic(\"table1\", \"table2\", \"join\"),\n+            config\n+        );\n+\n+        assertThat(testDriver.producedTopicNames(), is(Collections.emptySet()));\n \n         pipeRecord(SOURCE_TOPIC_1, testRecord1);\n+        assertThat(\n+            testDriver.producedTopicNames(),\n+            equalTo(mkSet(\n+                config.getProperty(StreamsConfig.APPLICATION_ID_CONFIG) + \"-table1-repartition\",\n+                config.getProperty(StreamsConfig.APPLICATION_ID_CONFIG) + \"-table1-changelog\"\n+            ))\n+        );\n+\n+        pipeRecord(SOURCE_TOPIC_2, testRecord1);\n+        assertThat(\n+            testDriver.producedTopicNames(),\n+            equalTo(mkSet(\n+                config.getProperty(StreamsConfig.APPLICATION_ID_CONFIG) + \"-table1-repartition\",\n+                config.getProperty(StreamsConfig.APPLICATION_ID_CONFIG) + \"-table1-changelog\",\n+                config.getProperty(StreamsConfig.APPLICATION_ID_CONFIG) + \"-table2-changelog\",\n+                config.getProperty(StreamsConfig.APPLICATION_ID_CONFIG) + \"-join-subscription-registration-topic\",\n+                config.getProperty(StreamsConfig.APPLICATION_ID_CONFIG) + \"-join-subscription-store-changelog\",\n+                config.getProperty(StreamsConfig.APPLICATION_ID_CONFIG) + \"-join-subscription-response-topic\"\n+            ))\n+        );\n+    }\n+\n+    @Test\n+    public void shouldCaptureGlobalTopicNameIfWrittenInto() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b94b59e26b27c4290ebb44f67f0034cd8f52db71"}, "originalPosition": 96}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1384, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}