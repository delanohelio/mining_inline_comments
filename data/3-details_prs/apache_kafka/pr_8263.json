{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MTQ1NjQ4", "number": 8263, "title": "MINOR: Add method to Herder to control logging of connector configs during validation", "bodyText": "Connector validation API is useful in validating connector configs before starting connector. And our application counts on it to generate friendly feedback to users. However, Connector validation API always log all configs when handling validation request since it creates AbstractConfig to check the overridable configs (introduced by #6624) and AbstractConfig, by default, logs all configs. In our case, the worker logs are filled with the following messages when there are a log of validation requests.\nINFO AbstractConfig values:\nxxx\nxxx\nxxx\n\nIt seems to me the response of Connector validation API is good enough. By contrast, the logs are a bit noisy and useless.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-03-10T13:51:30Z", "url": "https://github.com/apache/kafka/pull/8263", "merged": true, "mergeCommit": {"oid": "a5c257890e843ea7d755aee8ecde2e4e4f89d0ab"}, "closed": true, "closedAt": "2020-03-24T23:41:59Z", "author": {"login": "chia7712"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMS4TpABqjMxMTQ3OTYyOTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ7lPogFqTM4MDc2ODgzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4OTcwNzc3", "url": "https://github.com/apache/kafka/pull/8263#pullrequestreview-378970777", "createdAt": "2020-03-22T04:14:00Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MDM3ODIy", "url": "https://github.com/apache/kafka/pull/8263#pullrequestreview-379037822", "createdAt": "2020-03-22T19:14:12Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxOToxNDoxMlrOF5x3VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxOToxODowM1rOF5x42Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzMDEzMw==", "bodyText": "Actually, it's the new method that needs a default implementation if we choose to add it to this interface.", "url": "https://github.com/apache/kafka/pull/8263#discussion_r396130133", "createdAt": "2020-03-22T19:14:12Z", "author": {"login": "kkonstantine"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/Herder.java", "diffHunk": "@@ -178,7 +178,17 @@\n      * Validate the provided connector config values against the configuration definition.\n      * @param connectorConfig the provided connector config values\n      */\n-    ConfigInfos validateConnectorConfig(Map<String, String> connectorConfig);\n+    default ConfigInfos validateConnectorConfig(Map<String, String> connectorConfig) {\n+        return validateConnectorConfig(connectorConfig, true);\n+    }\n+\n+    /**\n+     * Validate the provided connector config values against the configuration definition.\n+     * @param connectorConfig the provided connector config values\n+     * @param doLog set it to true to log all connectorConfig with INFO level. false to log nothing.\n+     *              Noted: there are many endpoints requiring this method but not all configs are worth being logged.\n+     */\n+    ConfigInfos validateConnectorConfig(Map<String, String> connectorConfig, boolean doLog);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzMDE5Nw==", "bodyText": "A per argument inline comment is not something I've seen being used widely in Connect's codebase.", "url": "https://github.com/apache/kafka/pull/8263#discussion_r396130197", "createdAt": "2020-03-22T19:15:00Z", "author": {"login": "kkonstantine"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/rest/resources/ConnectorPluginsResource.java", "diffHunk": "@@ -78,7 +78,9 @@ public ConfigInfos validateConfigs(\n             );\n         }\n \n-        return herder.validateConnectorConfig(connectorConfig);\n+        return herder.validateConnectorConfig(connectorConfig,\n+            // the validated configs don't need to be logger.", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzMDIzMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return herder.validateConnectorConfig(connectorConfig,\n          \n          \n            \n                        // the validated configs don't need to be logger.\n          \n          \n            \n                        false);\n          \n          \n            \n                    // the validated configs don't need to be logger.\n          \n          \n            \n                    return herder.validateConnectorConfig(connectorConfig, false);", "url": "https://github.com/apache/kafka/pull/8263#discussion_r396130230", "createdAt": "2020-03-22T19:15:32Z", "author": {"login": "kkonstantine"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/rest/resources/ConnectorPluginsResource.java", "diffHunk": "@@ -78,7 +78,9 @@ public ConfigInfos validateConfigs(\n             );\n         }\n \n-        return herder.validateConnectorConfig(connectorConfig);\n+        return herder.validateConnectorConfig(connectorConfig,\n+            // the validated configs don't need to be logger.\n+            false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEzMDUyMQ==", "bodyText": "Related to the other comment, we'll need to keep the @Override of the previous method, and just have it call the new method that will also be overridden.", "url": "https://github.com/apache/kafka/pull/8263#discussion_r396130521", "createdAt": "2020-03-22T19:18:03Z", "author": {"login": "kkonstantine"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/AbstractHerder.java", "diffHunk": "@@ -299,7 +299,7 @@ public StatusBackingStore statusBackingStore() {\n     }\n \n     @Override\n-    public ConfigInfos validateConnectorConfig(Map<String, String> connectorProps) {\n+    public ConfigInfos validateConnectorConfig(Map<String, String> connectorProps, boolean doLog) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbd10d486e764088a984094c0517dc15924d0170", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/dbd10d486e764088a984094c0517dc15924d0170", "committedDate": "2020-03-24T03:42:52Z", "message": "Minor: remove useless log messages from connector configs validation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "dbd10d486e764088a984094c0517dc15924d0170", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/dbd10d486e764088a984094c0517dc15924d0170", "committedDate": "2020-03-24T03:42:52Z", "message": "Minor: remove useless log messages from connector configs validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c60d83e6589c034cb0079b9d6d10233acbcbfe70", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/apache/kafka/commit/c60d83e6589c034cb0079b9d6d10233acbcbfe70", "committedDate": "2020-03-24T23:28:17Z", "message": "MINOR: Slight rewording and fixing typos"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzY4ODM2", "url": "https://github.com/apache/kafka/pull/8263#pullrequestreview-380768836", "createdAt": "2020-03-24T23:33:57Z", "commit": {"oid": "c60d83e6589c034cb0079b9d6d10233acbcbfe70"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 208, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}