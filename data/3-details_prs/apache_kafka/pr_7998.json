{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1OTc2NTk4", "number": 7998, "title": "KAFKA-9460: Enable TLSv1.2 by default and disable all others protocol versions", "bodyText": "This PR by default disable all SSL protocols except TLSv1.2.\nChanges discussed in KIP-553.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-01-22T17:30:45Z", "url": "https://github.com/apache/kafka/pull/7998", "merged": true, "mergeCommit": {"oid": "172409c44b8551e2315bd93044a8a95ccda4699f"}, "closed": true, "closedAt": "2020-01-28T18:57:24Z", "author": {"login": "nizhikov"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb85LydgH2gAyMzY1OTc2NTk4OmIyYTRmYWMwYWRiMmJlMmM4YzllZjFlNjc2YzBmMThjYjcyNDllNjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-019TAFqTM0OTU2NjYwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/kafka/commit/b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64", "committedDate": "2020-01-22T17:27:51Z", "message": "KAFKA-9460: Enable TLSv1.2 by default and disable all others protocol versions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2ODA4MjU0", "url": "https://github.com/apache/kafka/pull/7998#pullrequestreview-346808254", "createdAt": "2020-01-22T18:31:14Z", "commit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODozMToxNVrOFgmg9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODozMToxNVrOFgmg9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcyOTc4Mg==", "bodyText": "Does this need to change as well?  Or does the enabled protocol list constrain it?", "url": "https://github.com/apache/kafka/pull/7998#discussion_r369729782", "createdAt": "2020-01-22T18:31:15Z", "author": {"login": "rondagostino"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,7 +50,7 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"\n-            + \"Allowed values in recent JVMs are TLS, TLSv1.1 and TLSv1.2. SSL, SSLv2 and SSLv3 \"\n+            + \"Allowed values in recent JVMs are TLS, TLSv1.1, TLSv1.2 and TLSv1.3. SSL, SSLv2 and SSLv3 \"\n             + \"may be supported in older JVMs, but their usage is discouraged due to known security vulnerabilities.\";\n \n     public static final String DEFAULT_SSL_PROTOCOL = \"TLS\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2ODA0MTI3", "url": "https://github.com/apache/kafka/pull/7998#pullrequestreview-346804127", "createdAt": "2020-01-22T18:24:36Z", "commit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODoyNDozN1rOFgmTow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODoyNTowNlrOFgmUbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcyNjM3MQ==", "bodyText": "We should say that TLSv1 and TLSv1.1 are also discouraged.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r369726371", "createdAt": "2020-01-22T18:24:37Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,7 +50,7 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"\n-            + \"Allowed values in recent JVMs are TLS, TLSv1.1 and TLSv1.2. SSL, SSLv2 and SSLv3 \"\n+            + \"Allowed values in recent JVMs are TLS, TLSv1.1, TLSv1.2 and TLSv1.3. SSL, SSLv2 and SSLv3 \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTcyNjU3Mw==", "bodyText": "We should make this TLSv1.2 as well.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r369726573", "createdAt": "2020-01-22T18:25:06Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,7 +50,7 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"\n-            + \"Allowed values in recent JVMs are TLS, TLSv1.1 and TLSv1.2. SSL, SSLv2 and SSLv3 \"\n+            + \"Allowed values in recent JVMs are TLS, TLSv1.1, TLSv1.2 and TLSv1.3. SSL, SSLv2 and SSLv3 \"\n             + \"may be supported in older JVMs, but their usage is discouraged due to known security vulnerabilities.\";\n \n     public static final String DEFAULT_SSL_PROTOCOL = \"TLS\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2a4fac0adb2be2c8c9ef1e676c0f18cb7249e64"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "491f8a3b603bbf3489b2cc2fd9fdf58193e65c76", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/kafka/commit/491f8a3b603bbf3489b2cc2fd9fdf58193e65c76", "committedDate": "2020-01-22T19:39:24Z", "message": "KAFKA-9460: Code review fixes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35868d2f68730739b739875fb3ec9509ba5ace98", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/kafka/commit/35868d2f68730739b739875fb3ec9509ba5ace98", "committedDate": "2020-01-27T10:16:31Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into KAFKA-9460"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db602b3f5b699f9e2b1cce26ac018361992d281b", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/kafka/commit/db602b3f5b699f9e2b1cce26ac018361992d281b", "committedDate": "2020-01-27T13:47:03Z", "message": "KAFKA-9460: Code review fixes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a44b3fb3d1eddc8aa1603f0c3b4ccd8497278a72", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/kafka/commit/a44b3fb3d1eddc8aa1603f0c3b4ccd8497278a72", "committedDate": "2020-01-27T13:49:00Z", "message": "KAFKA-9460: Code review fixes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/kafka/commit/32535001b7a813c3373138c1b6803b7596a83d97", "committedDate": "2020-01-27T13:51:51Z", "message": "KAFKA-9460: Code review fixes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MzI3Mzk3", "url": "https://github.com/apache/kafka/pull/7998#pullrequestreview-349327397", "createdAt": "2020-01-28T12:12:45Z", "commit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjoxMjo0NVrOFiiyjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxMjoyNjoxMVrOFijI7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2NTkwMg==", "bodyText": "Can you update this to say TLSv1.2?", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371765902", "createdAt": "2020-01-28T12:12:45Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/main/java/org/apache/kafka/common/config/SslConfigs.java", "diffHunk": "@@ -50,10 +50,10 @@\n     public static final String SSL_PROTOCOL_CONFIG = \"ssl.protocol\";\n     public static final String SSL_PROTOCOL_DOC = \"The SSL protocol used to generate the SSLContext. \"\n             + \"Default setting is TLS, which is fine for most cases. \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc2OTI5MQ==", "bodyText": "It would be better to use NetworkTestUtils.checkClientConnection(selector, node, 100, 10); which actually uses the connection.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371769291", "createdAt": "2020-01-28T12:20:45Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -551,6 +551,35 @@ public void testInvalidKeyPassword() throws Exception {\n         server.verifyAuthenticationMetrics(0, 1);\n     }\n \n+    /**\n+     * Tests that connection sucess with the default TLS version.\n+     */\n+    @Test\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);\n+\n+        server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        final String node = \"0\";\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(node, addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.waitForChannelClose(selector, node, ChannelState.State.READY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MTE5MQ==", "bodyText": "Not sure if these configs actually come from the default configs. I think these may be explicitly configured in the tests.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371771191", "createdAt": "2020-01-28T12:25:18Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -551,6 +551,35 @@ public void testInvalidKeyPassword() throws Exception {\n         server.verifyAuthenticationMetrics(0, 1);\n     }\n \n+    /**\n+     * Tests that connection sucess with the default TLS version.\n+     */\n+    @Test\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc3MTYyOA==", "bodyText": "We should also create a client connection with one of the newly disabled protocols like TLSv1.1 and verify that the client connection fails.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371771628", "createdAt": "2020-01-28T12:26:11Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -551,6 +551,35 @@ public void testInvalidKeyPassword() throws Exception {\n         server.verifyAuthenticationMetrics(0, 1);\n     }\n \n+    /**\n+     * Tests that connection sucess with the default TLS version.\n+     */\n+    @Test\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);\n+\n+        server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        final String node = \"0\";\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(node, addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.waitForChannelClose(selector, node, ChannelState.State.READY);\n+        server.verifyAuthenticationMetrics(1, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32535001b7a813c3373138c1b6803b7596a83d97"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f90f72505beaf68bc82d6c8dea8a34d97e532c58", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/kafka/commit/f90f72505beaf68bc82d6c8dea8a34d97e532c58", "committedDate": "2020-01-28T13:57:44Z", "message": "KAFKA-9460: Code review fixes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NDEzNjgx", "url": "https://github.com/apache/kafka/pull/7998#pullrequestreview-349413681", "createdAt": "2020-01-28T14:26:19Z", "commit": {"oid": "f90f72505beaf68bc82d6c8dea8a34d97e532c58"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyNjoxOVrOFim4SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyODo0OFrOFim-bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzMjkwNA==", "bodyText": "nit: typo success\nAlso mention that it tests that insecure protocols are not enabled by default.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371832904", "createdAt": "2020-01-28T14:26:19Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,60 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection sucess with the default TLS version.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f90f72505beaf68bc82d6c8dea8a34d97e532c58"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzMzQ4NA==", "bodyText": "This selector is never used since we create a Selector a couple of lines below using createSelector. We should remove these three lines and the logContext created at the start of this test.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371833484", "createdAt": "2020-01-28T14:27:17Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,60 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection sucess with the default TLS version.\n      */\n     @Test\n-    public void testUnsupportedTLSVersion() throws Exception {\n-        String node = \"0\";\n-        sslServerConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.2\"));\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f90f72505beaf68bc82d6c8dea8a34d97e532c58"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzNDQ3Ng==", "bodyText": "We tend to use different node value when multiple connections are created by a test. You could just replace node here with \"1\" and a couple of lines below with \"2\".", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371834476", "createdAt": "2020-01-28T14:28:48Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,60 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection sucess with the default TLS version.\n      */\n     @Test\n-    public void testUnsupportedTLSVersion() throws Exception {\n-        String node = \"0\";\n-        sslServerConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.2\"));\n+    public void testTLSDefaults() throws Exception {\n+        final LogContext logContext = new LogContext();\n+\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n+        channelBuilder = new SslChannelBuilder(Mode.CLIENT, null, false, logContext);\n+        channelBuilder.configure(sslServerConfigs);\n+        selector = new Selector(5000, new Metrics(), time, \"MetricGroup\", channelBuilder, logContext);\n+\n         server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        final String node = \"0\";\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(node, addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.checkClientConnection(selector, node, 10, 100);\n+        server.verifyAuthenticationMetrics(1, 0);\n \n-        sslClientConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.1\"));\n+        checkAuthentiationFailed(node, \"TLSv1.1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f90f72505beaf68bc82d6c8dea8a34d97e532c58"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2784b7b35c8aeec9a4b64be7aca47b8daa9e644", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/kafka/commit/f2784b7b35c8aeec9a4b64be7aca47b8daa9e644", "committedDate": "2020-01-28T14:37:56Z", "message": "KAFKA-9460: Code review fixes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NDgwNzc0", "url": "https://github.com/apache/kafka/pull/7998#pullrequestreview-349480774", "createdAt": "2020-01-28T15:45:02Z", "commit": {"oid": "f2784b7b35c8aeec9a4b64be7aca47b8daa9e644"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0NTowM1rOFip_1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNTo0NTowM1rOFip_1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg4Mzk5MA==", "bodyText": "Sorry, missed this earlier: We are creating a new selector in checkAuthentiationFailed, so we should ensure that the previous selector is closed. You could call selector.close() just before calling checkAuthenticationFailed here and also a couple of lines below.", "url": "https://github.com/apache/kafka/pull/7998#discussion_r371883990", "createdAt": "2020-01-28T15:45:03Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/test/java/org/apache/kafka/common/network/SslTransportLayerTest.java", "diffHunk": "@@ -552,20 +552,51 @@ public void testInvalidKeyPassword() throws Exception {\n     }\n \n     /**\n-     * Tests that connections cannot be made with unsupported TLS versions\n+     * Tests that connection success with the default TLS version.\n      */\n     @Test\n-    public void testUnsupportedTLSVersion() throws Exception {\n-        String node = \"0\";\n-        sslServerConfigs.put(SslConfigs.SSL_ENABLED_PROTOCOLS_CONFIG, Arrays.asList(\"TLSv1.2\"));\n+    public void testTLSDefaults() throws Exception {\n+        sslServerConfigs = serverCertStores.getTrustingConfig(clientCertStores);\n+        sslClientConfigs = clientCertStores.getTrustingConfig(serverCertStores);\n+\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslServerConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+        assertEquals(SslConfigs.DEFAULT_SSL_PROTOCOL, sslClientConfigs.get(SslConfigs.SSL_PROTOCOL_CONFIG));\n+\n         server = createEchoServer(SecurityProtocol.SSL);\n+        createSelector(sslClientConfigs);\n+\n+        InetSocketAddress addr = new InetSocketAddress(\"localhost\", server.port());\n+        selector.connect(\"0\", addr, BUFFER_SIZE, BUFFER_SIZE);\n+\n+        NetworkTestUtils.checkClientConnection(selector, \"0\", 10, 100);\n+        server.verifyAuthenticationMetrics(1, 0);\n+\n+        checkAuthentiationFailed(\"1\", \"TLSv1.1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2784b7b35c8aeec9a4b64be7aca47b8daa9e644"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c2051bcd136dd65ae7eb0ce3ef5f25187d746e3", "author": {"user": {"login": "nizhikov", "name": "Nikolay"}}, "url": "https://github.com/apache/kafka/commit/6c2051bcd136dd65ae7eb0ce3ef5f25187d746e3", "committedDate": "2020-01-28T15:49:56Z", "message": "KAFKA-9460: Code review fixes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NTY2NjA4", "url": "https://github.com/apache/kafka/pull/7998#pullrequestreview-349566608", "createdAt": "2020-01-28T17:32:14Z", "commit": {"oid": "6c2051bcd136dd65ae7eb0ce3ef5f25187d746e3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2098, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}