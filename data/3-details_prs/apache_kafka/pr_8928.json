{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMTU4NDM3", "number": 8928, "title": "KAFKA-10192: Wait for REST API to become available before testing blocked connectors in integration tests", "bodyText": "Jira\nThe testBlockInConnectorStop test is failing semi-frequently on Jenkins. It's difficult to verify the cause without complete logs and I'm unable to reproduce locally, but I suspect the cause may be that the Connect worker hasn't completed startup yet by the time the test begins and so the initial REST request to create a connector times out with a 500 error. This isn't an issue for normal tests but we artificially reduce the REST request timeout for these tests as some requests are meant to exhaust that timeout.\nThe changes here use a small hack to verify that the worker has started and is ready to handle all types of REST requests before tests start.\nIf possible, we might want to run Jenkins tests on this PR 5-10 times to see if the changes have any effect.\ncc @abbccdda\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-06-25T17:24:42Z", "url": "https://github.com/apache/kafka/pull/8928", "merged": true, "mergeCommit": {"oid": "cf69bdc713cf72a0407d46e0d07f6d77512ebfaf"}, "closed": true, "closedAt": "2020-07-14T04:02:04Z", "author": {"login": "C0urante"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcux91OgH2gAyNDQwMTU4NDM3OmJjMWZkMDJmM2JlYjlhYTdlOWVlOTU3ZjBlMDgyNjM0OTFiN2E5ZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0t59pgFqTQ0Nzc2ODI0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bc1fd02f3beb9aa7e9ee957f0e08263491b7a9fe", "author": {"user": {"login": "C0urante", "name": "Chris Egerton"}}, "url": "https://github.com/apache/kafka/commit/bc1fd02f3beb9aa7e9ee957f0e08263491b7a9fe", "committedDate": "2020-06-25T17:19:29Z", "message": "KAFKA-10192: Wait for REST API to become available before testing blocked connectors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MzY0ODYx", "url": "https://github.com/apache/kafka/pull/8928#pullrequestreview-438364861", "createdAt": "2020-06-26T14:55:58Z", "commit": {"oid": "bc1fd02f3beb9aa7e9ee957f0e08263491b7a9fe"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjE5ODA1", "url": "https://github.com/apache/kafka/pull/8928#pullrequestreview-442619805", "createdAt": "2020-07-04T16:42:53Z", "commit": {"oid": "bc1fd02f3beb9aa7e9ee957f0e08263491b7a9fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQxNjo0Mjo1M1rOGs82MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQxNjo0Mjo1M1rOGs82MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc4NzQ0MQ==", "bodyText": "We have EmbeddedConnectClusterAssertions#assertExactlyNumWorkersAreUp\nShould we use this high level assertion to confirm that the workers are up?", "url": "https://github.com/apache/kafka/pull/8928#discussion_r449787441", "createdAt": "2020-07-04T16:42:53Z", "author": {"login": "kkonstantine"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/integration/BlockingConnectorTest.java", "diffHunk": "@@ -76,6 +78,15 @@ public void setup() {\n \n         // start the clusters\n         connect.start();\n+\n+        // wait for the Connect REST API to become available. necessary because of the reduced REST\n+        // request timeout; otherwise, we may get an unexpected 500 with our first real REST request\n+        // if the worker is still getting on its feet.\n+        waitForCondition(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc1fd02f3beb9aa7e9ee957f0e08263491b7a9fe"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NzY4MjQ0", "url": "https://github.com/apache/kafka/pull/8928#pullrequestreview-447768244", "createdAt": "2020-07-14T03:59:11Z", "commit": {"oid": "bc1fd02f3beb9aa7e9ee957f0e08263491b7a9fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 735, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}