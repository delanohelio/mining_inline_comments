{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5ODY4NTY5", "number": 8169, "title": "KAFKA-9610: Do not throw illegal state when remaining partitions are not empty", "bodyText": "For handleRevocation, it is possible that previous onAssignment callback has cleaned up the stream tasks, which means no corresponding task could be found for given partitions. We should not throw here as this is expected behavior.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-02-25T23:17:33Z", "url": "https://github.com/apache/kafka/pull/8169", "merged": true, "mergeCommit": {"oid": "a983545d3c8a059d290db832e1bfcf9c9e38b1ce"}, "closed": true, "closedAt": "2020-02-26T22:05:43Z", "author": {"login": "abbccdda"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcH6utgAFqTM2NDUyNTUxMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcH_z3EgBqjMwNzIxODI1NTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NTI1NTEz", "url": "https://github.com/apache/kafka/pull/8169#pullrequestreview-364525513", "createdAt": "2020-02-25T23:29:03Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyOTowM1rOFuZGAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzoyOTowM1rOFuZGAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE4OTk1Mg==", "bodyText": "This doesn't really make sense, onPartitionsRevoked is always called before onAssignment", "url": "https://github.com/apache/kafka/pull/8169#discussion_r384189952", "createdAt": "2020-02-25T23:29:03Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/TaskManager.java", "diffHunk": "@@ -304,8 +304,8 @@ void handleRevocation(final Collection<TopicPartition> revokedPartitions) {\n         }\n \n         if (!remainingPartitions.isEmpty()) {\n-            throw new IllegalStateException(\"Some revoked partitions that do not belong \" +\n-                \"to any tasks remain: \" + remainingPartitions);\n+            log.info(\"The following partitions {} are missing from the task partitions. It is possible that\" +\n+                \"they have been cleaned up by the onAssignment callback\", remainingPartitions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NjE0NDg4", "url": "https://github.com/apache/kafka/pull/8169#pullrequestreview-364614488", "createdAt": "2020-02-26T04:18:51Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "67e9be7d1a39e581ba24a00bfc1fd6562d6e65f3", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/67e9be7d1a39e581ba24a00bfc1fd6562d6e65f3", "committedDate": "2020-02-26T05:23:57Z", "message": "do not throw illegal state exception for remaining partitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98e8f2816533f78e7b0c655694f781a1921fd623", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/98e8f2816533f78e7b0c655694f781a1921fd623", "committedDate": "2020-02-26T05:23:57Z", "message": "Revert \"Close the producer only in EOS\"\n\nThis reverts commit db81ce6b7cd31f6b133c044cec6f3a9742573a4e."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "904985357962c26b36350de5969b388aad8b016a", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/904985357962c26b36350de5969b388aad8b016a", "committedDate": "2020-02-26T05:23:57Z", "message": "fix wording"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2231605016b4f00196f0e83b222349d7f40ad945", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/2231605016b4f00196f0e83b222349d7f40ad945", "committedDate": "2020-02-26T05:23:57Z", "message": "unit test for warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f85b121a482ae2423422d12d96dfe0eeae3c700", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/4f85b121a482ae2423422d12d96dfe0eeae3c700", "committedDate": "2020-02-26T05:23:57Z", "message": "Revert \"Revert \"Close the producer only in EOS\"\"\n\nThis reverts commit b87d35f7eeec2a70a10a86ced9e300bccefc8c13."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "4f85b121a482ae2423422d12d96dfe0eeae3c700", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/4f85b121a482ae2423422d12d96dfe0eeae3c700", "committedDate": "2020-02-26T05:23:57Z", "message": "Revert \"Revert \"Close the producer only in EOS\"\"\n\nThis reverts commit b87d35f7eeec2a70a10a86ced9e300bccefc8c13."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1573, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}