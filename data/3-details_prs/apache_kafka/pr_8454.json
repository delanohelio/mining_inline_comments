{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMzk2NDk4", "number": 8454, "title": "KAFKA-9844; Maximum number of members within a group is not always enforced due to a race condition in join group", "bodyText": "This patch fixes a race condition in the join group request handling which sometimes results in not enforcing the maximum number of members allowed in a group. The JIRA provides an example: https://issues.apache.org/jira/browse/KAFKA-9844\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-04-09T12:31:27Z", "url": "https://github.com/apache/kafka/pull/8454", "merged": true, "mergeCommit": {"oid": "85e81d48c81a11f8e32a734703c2103c655a4cc9"}, "closed": true, "closedAt": "2020-04-23T20:37:20Z", "author": {"login": "dajac"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV7pplgH2gAyNDAxMzk2NDk4OjIyZTczNDlkYjU0N2E3NTM1NmZhOWMzZjdjODhkYzBlYTI3ZDQ1Y2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcafmyOAFqTM5OTI3OTgxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "22e7349db547a75356fa9c3f7c88dc0ea27d45ce", "author": {"user": {"login": "dajac", "name": "David Jacot"}}, "url": "https://github.com/apache/kafka/commit/22e7349db547a75356fa9c3f7c88dc0ea27d45ce", "committedDate": "2020-04-09T12:28:23Z", "message": "KAFKA-9844; Maximum number of members within a group is not always enforced due to a race condition in join group"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dab5f151f0017ee82d6de6839941f86899c9775", "author": {"user": {"login": "dajac", "name": "David Jacot"}}, "url": "https://github.com/apache/kafka/commit/1dab5f151f0017ee82d6de6839941f86899c9775", "committedDate": "2020-04-09T12:36:05Z", "message": "fixup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTM4OTQw", "url": "https://github.com/apache/kafka/pull/8454#pullrequestreview-390938940", "createdAt": "2020-04-09T16:16:43Z", "commit": {"oid": "1dab5f151f0017ee82d6de6839941f86899c9775"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16bb5e402e8ba1838b13cc53d2ef1f7736936dd0", "author": {"user": {"login": "dajac", "name": "David Jacot"}}, "url": "https://github.com/apache/kafka/commit/16bb5e402e8ba1838b13cc53d2ef1f7736936dd0", "committedDate": "2020-04-13T17:50:09Z", "message": "add unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMzgzNDA1", "url": "https://github.com/apache/kafka/pull/8454#pullrequestreview-392383405", "createdAt": "2020-04-13T19:38:36Z", "commit": {"oid": "16bb5e402e8ba1838b13cc53d2ef1f7736936dd0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxOTozODozN1rOGEygsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxOTozODozN1rOGEygsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY3NTA1OQ==", "bodyText": "I must make a copy of the props here otherwise it will alter the other tests.", "url": "https://github.com/apache/kafka/pull/8454#discussion_r407675059", "createdAt": "2020-04-13T19:38:37Z", "author": {"login": "dajac"}, "path": "core/src/test/scala/unit/kafka/coordinator/group/GroupCoordinatorConcurrencyTest.scala", "diffHunk": "@@ -124,6 +126,33 @@ class GroupCoordinatorConcurrencyTest extends AbstractCoordinatorConcurrencyTest\n     verifyConcurrentRandomSequences(createGroupMembers, allOperationsWithTxn)\n   }\n \n+  @Test\n+  def testConcurrentJoinGroupEnforceGroupMaxSize(): Unit = {\n+    val groupMaxSize = 1\n+    serverProps.put(KafkaConfig.GroupMaxSizeProp, groupMaxSize.toString)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16bb5e402e8ba1838b13cc53d2ef1f7736936dd0"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dce9dd22a861abc182b5f64974e2f9442305ff07", "author": {"user": {"login": "dajac", "name": "David Jacot"}}, "url": "https://github.com/apache/kafka/commit/dce9dd22a861abc182b5f64974e2f9442305ff07", "committedDate": "2020-04-14T07:08:47Z", "message": "fixup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDU0MzMy", "url": "https://github.com/apache/kafka/pull/8454#pullrequestreview-395054332", "createdAt": "2020-04-16T22:56:01Z", "commit": {"oid": "dce9dd22a861abc182b5f64974e2f9442305ff07"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMjo1NjowMVrOGG6CFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMjo1NjowMVrOGG6CFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg5NTQ0Nw==", "bodyText": "Optional arguments are best avoided. Maybe we could split this into two methods getOrCreateGroup and getGroup?", "url": "https://github.com/apache/kafka/pull/8454#discussion_r409895447", "createdAt": "2020-04-16T22:56:01Z", "author": {"login": "hachikuji"}, "path": "core/src/main/scala/kafka/coordinator/group/GroupMetadataManager.scala", "diffHunk": "@@ -209,10 +209,14 @@ class GroupMetadataManager(brokerId: Int,\n       false\n   }\n   /**\n-   * Get the group associated with the given groupId, or null if not found\n+   * Get the group associated with the given groupId - the group is created if createIfNotExist\n+   * is true - or null if not found\n    */\n-  def getGroup(groupId: String): Option[GroupMetadata] = {\n-    Option(groupMetadataCache.get(groupId))\n+  def getGroup(groupId: String, createIfNotExist: Boolean = false): Option[GroupMetadata] = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dce9dd22a861abc182b5f64974e2f9442305ff07"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c08ba9576f94a0bba6639bc2233e81bc0756a3c5", "author": {"user": {"login": "dajac", "name": "David Jacot"}}, "url": "https://github.com/apache/kafka/commit/c08ba9576f94a0bba6639bc2233e81bc0756a3c5", "committedDate": "2020-04-17T09:33:00Z", "message": "Address review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5Mjc5ODE5", "url": "https://github.com/apache/kafka/pull/8454#pullrequestreview-399279819", "createdAt": "2020-04-23T16:37:32Z", "commit": {"oid": "c08ba9576f94a0bba6639bc2233e81bc0756a3c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1442, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}