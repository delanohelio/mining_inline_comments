{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MzcxMDk4", "number": 9541, "title": "KAFKA-10675: Add schema name to ConnectSchema.validateValue() error message", "bodyText": "https://issues.apache.org/jira/browse/KAFKA-10675\nThe following error message\norg.apache.kafka.connect.errors.DataException: Invalid Java object for schema type INT64: class java.lang.Long for field: \"moderate_time\"\ncan be confusing because java.lang.Long is acceptable type for schema INT64.\nIn fact, in this case org.apache.kafka.connect.data.Timestamp is used but this info is not logged.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-11-02T22:34:14Z", "url": "https://github.com/apache/kafka/pull/9541", "merged": true, "mergeCommit": {"oid": "efe6029f9c2b70cebc4359913ff809b7efa31daa"}, "closed": true, "closedAt": "2021-07-10T05:35:02Z", "author": {"login": "Iskuskov"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABd8ELhnABqjQzNTU2NTAyNTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeo7jNcgFqTcwMzQ3MzI5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdfbd04a8a124ba8d7e14b6e5f20e982a79af588", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/cdfbd04a8a124ba8d7e14b6e5f20e982a79af588", "committedDate": "2020-11-02T22:30:24Z", "message": "KAFKA-10675 Add schema name to error message from ConnectSchema.validateValue()"}, "afterCommit": {"oid": "b6912b942670404d5a41f7b8506e9493a53e3b5f", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/b6912b942670404d5a41f7b8506e9493a53e3b5f", "committedDate": "2021-02-20T20:04:19Z", "message": "KAFKA-10675 Add schema name to error message from ConnectSchema.validateValue()"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6912b942670404d5a41f7b8506e9493a53e3b5f", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/b6912b942670404d5a41f7b8506e9493a53e3b5f", "committedDate": "2021-02-20T20:04:19Z", "message": "KAFKA-10675 Add schema name to error message from ConnectSchema.validateValue()"}, "afterCommit": {"oid": "12ddffd7ba7741cac15bf1491e82902a02298579", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/12ddffd7ba7741cac15bf1491e82902a02298579", "committedDate": "2021-02-20T22:45:04Z", "message": "KAFKA-10675 Add schema name to error message from ConnectSchema.validateValue()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjAwODYyMzcx", "url": "https://github.com/apache/kafka/pull/9541#pullrequestreview-600862371", "createdAt": "2021-03-01T15:34:43Z", "commit": {"oid": "1b02708a04d0c290e700db722dc0b2f77cf0bbcd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wMVQxNTozNDo0M1rOItuA9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0wMVQxNTozNDo0M1rOItuA9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4NDgxMDc0Mg==", "bodyText": "Given that this is only used in one place, and the string that it creates is itself added to a formatted string, I think it'd be a bit more readable if we removed this method and inlined all the logic where it's being invoked right now.", "url": "https://github.com/apache/kafka/pull/9541#discussion_r584810742", "createdAt": "2021-03-01T15:34:43Z", "author": {"login": "C0urante"}, "path": "connect/api/src/main/java/org/apache/kafka/connect/data/ConnectSchema.java", "diffHunk": "@@ -266,10 +261,19 @@ public static void validateValue(String name, Schema schema, Object value) {\n     private static List<Class> expectedClassesFor(Schema schema) {\n         List<Class> expectedClasses = LOGICAL_TYPE_CLASSES.get(schema.name());\n         if (expectedClasses == null)\n-            expectedClasses = SCHEMA_TYPE_CLASSES.get(schema.type());\n+            expectedClasses = SCHEMA_TYPE_CLASSES.getOrDefault(schema.type(), Collections.emptyList());\n         return expectedClasses;\n     }\n \n+    private static String buildSchemaInfo(Schema schema) {\n+        StringBuilder schemaInfo = new StringBuilder(\"schema\");\n+        if (schema.name() != null) {\n+            schemaInfo.append(\" \\\"\").append(schema.name()).append(\"\\\"\");\n+        }\n+        schemaInfo.append(\" with type \").append(schema.type());\n+        return schemaInfo.toString();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b02708a04d0c290e700db722dc0b2f77cf0bbcd"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjAwODY5NDY0", "url": "https://github.com/apache/kafka/pull/9541#pullrequestreview-600869464", "createdAt": "2021-03-01T15:37:55Z", "commit": {"oid": "1b02708a04d0c290e700db722dc0b2f77cf0bbcd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e509dfc500dc360495b520ed97f1db1afc9b5a58", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/e509dfc500dc360495b520ed97f1db1afc9b5a58", "committedDate": "2021-03-04T20:30:33Z", "message": "KAFKA-10675 fix after review"}, "afterCommit": {"oid": "9cfcb66adda23cc84556a9ca02169dadb01a6f57", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/9cfcb66adda23cc84556a9ca02169dadb01a6f57", "committedDate": "2021-03-04T20:36:43Z", "message": "KAFKA-10675 fix after review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9cfcb66adda23cc84556a9ca02169dadb01a6f57", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/9cfcb66adda23cc84556a9ca02169dadb01a6f57", "committedDate": "2021-03-04T20:36:43Z", "message": "KAFKA-10675 fix after review"}, "afterCommit": {"oid": "c8a361cf23bc1803402fc139c047db7c1fbdca07", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/c8a361cf23bc1803402fc139c047db7c1fbdca07", "committedDate": "2021-03-04T20:53:18Z", "message": "KAFKA-10675 fix after review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM5MDQxNDg5", "url": "https://github.com/apache/kafka/pull/9541#pullrequestreview-639041489", "createdAt": "2021-04-19T15:58:51Z", "commit": {"oid": "c8a361cf23bc1803402fc139c047db7c1fbdca07"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xOVQxNTo1ODo1MVrOJLcJFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xOVQxNTo1ODo1MVrOJLcJFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxNTk3NTE4OA==", "bodyText": "Strictly speaking, this shouldn't be necessary as SCHEMA_TYPE_CLASSES should have a Schema instance for all Schema.Type literals. And with SchemaBuilder a connector or converter cannot create a schema instance with a null Schema.Type.\nHowever, it is possible to construct a ConnectSchema instance with a null Type reference (like what FakeSchema essentially does in the existing test), which of course without this change would result in this method returning a null list.\nSo +1 for this line change since it simplifies the error handling in the calling code.", "url": "https://github.com/apache/kafka/pull/9541#discussion_r615975188", "createdAt": "2021-04-19T15:58:51Z", "author": {"login": "rhauch"}, "path": "connect/api/src/main/java/org/apache/kafka/connect/data/ConnectSchema.java", "diffHunk": "@@ -266,7 +267,7 @@ public static void validateValue(String name, Schema schema, Object value) {\n     private static List<Class> expectedClassesFor(Schema schema) {\n         List<Class> expectedClasses = LOGICAL_TYPE_CLASSES.get(schema.name());\n         if (expectedClasses == null)\n-            expectedClasses = SCHEMA_TYPE_CLASSES.get(schema.type());\n+            expectedClasses = SCHEMA_TYPE_CLASSES.getOrDefault(schema.type(), Collections.emptyList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8a361cf23bc1803402fc139c047db7c1fbdca07"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "468790f2fae38e50c4c80d964962d8fda6f8ecb0", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/468790f2fae38e50c4c80d964962d8fda6f8ecb0", "committedDate": "2021-07-09T09:12:25Z", "message": "KAFKA-10675 Add schema name to error message from ConnectSchema.validateValue()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea28af762c8b57971c6ab2244754a18ef4b09f15", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/ea28af762c8b57971c6ab2244754a18ef4b09f15", "committedDate": "2021-07-09T09:27:06Z", "message": "KAFKA-10675 refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c25fdfc7e74f56d36159a6aa8b2ce1f056348d1", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/3c25fdfc7e74f56d36159a6aa8b2ce1f056348d1", "committedDate": "2021-07-09T09:27:09Z", "message": "KAFKA-10675 fix after review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8a361cf23bc1803402fc139c047db7c1fbdca07", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/c8a361cf23bc1803402fc139c047db7c1fbdca07", "committedDate": "2021-03-04T20:53:18Z", "message": "KAFKA-10675 fix after review"}, "afterCommit": {"oid": "3c25fdfc7e74f56d36159a6aa8b2ce1f056348d1", "author": {"user": {"login": "Iskuskov", "name": "Alexander Iskuskov"}}, "url": "https://github.com/apache/kafka/commit/3c25fdfc7e74f56d36159a6aa8b2ce1f056348d1", "committedDate": "2021-07-09T09:27:09Z", "message": "KAFKA-10675 fix after review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAzNDEwMzMw", "url": "https://github.com/apache/kafka/pull/9541#pullrequestreview-703410330", "createdAt": "2021-07-09T21:45:14Z", "commit": {"oid": "3c25fdfc7e74f56d36159a6aa8b2ce1f056348d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0wOVQyMTo0NToxNVrOJ8UOgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0wOVQyMTo0NToxNVrOJ8UOgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzIyNTczMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<Class> expectedClasses = expectedClassesFor(schema);\n          \n          \n            \n                    List<Class<?>> expectedClasses = expectedClassesFor(schema);", "url": "https://github.com/apache/kafka/pull/9541#discussion_r667225730", "createdAt": "2021-07-09T21:45:15Z", "author": {"login": "kkonstantine"}, "path": "connect/api/src/main/java/org/apache/kafka/connect/data/ConnectSchema.java", "diffHunk": "@@ -221,13 +221,7 @@ public static void validateValue(String name, Schema schema, Object value) {\n             return;\n         }\n \n-        List<Class<?>> expectedClasses = expectedClassesFor(schema);\n-\n-        if (expectedClasses == null)\n-            throw new DataException(\"Invalid Java object for schema type \" + schema.type()\n-                    + \": \" + value.getClass()\n-                    + \" for field: \\\"\" + name + \"\\\"\");\n-\n+        List<Class> expectedClasses = expectedClassesFor(schema);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c25fdfc7e74f56d36159a6aa8b2ce1f056348d1"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5b765f5ade561451b71c1fdd4b5a4c19ed5131b", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/apache/kafka/commit/a5b765f5ade561451b71c1fdd4b5a4c19ed5131b", "committedDate": "2021-07-09T21:47:56Z", "message": "Don't use raw type for Class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAzNDczMjk0", "url": "https://github.com/apache/kafka/pull/9541#pullrequestreview-703473294", "createdAt": "2021-07-10T05:28:13Z", "commit": {"oid": "a5b765f5ade561451b71c1fdd4b5a4c19ed5131b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2657, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}