{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNzkwNDU3", "number": 8324, "title": "KAFKA-9701 (fix): Only check protocol name when generation is valid", "bodyText": "This bug was incurred by #7994 with a too-strong consistency check. It is because a reset generation operation could be called in between the joinGroupRequest -> joinGroupResponse -> SyncGroupRequest -> SyncGroupResponse sequence of events, if user calls unsubscribe in the middle of consumer#poll().\nProper fix is to avoid the protocol name check when the generation is invalid.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-03-21T00:31:13Z", "url": "https://github.com/apache/kafka/pull/8324", "merged": true, "mergeCommit": {"oid": "c75dc5e2e09cee4ba47a9b6c484cb225acdb086e"}, "closed": true, "closedAt": "2020-03-21T04:26:58Z", "author": {"login": "abbccdda"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPp8UIAH2gAyMzkxNzkwNDU3OjllMzZmNDk3Yzg3Zjc2ZmIyMzdlNTZlY2M5ZjI5NTIyMjRiNTVkOTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQZ5PQgFqTM3OTIwNzY2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9e36f497c87f76fb237e56ecc9f2952224b55d98", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/9e36f497c87f76fb237e56ecc9f2952224b55d98", "committedDate": "2020-03-21T00:26:56Z", "message": "Check for no generation during sync group response"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODc5MzEw", "url": "https://github.com/apache/kafka/pull/8324#pullrequestreview-378879310", "createdAt": "2020-03-21T01:19:38Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMToxOTozOFrOF5mtWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMToxOTozOFrOF5mtWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk0NzM1Mw==", "bodyText": "Just side cleanups starting L700", "url": "https://github.com/apache/kafka/pull/8324#discussion_r395947353", "createdAt": "2020-03-21T01:19:38Z", "author": {"login": "abbccdda"}, "path": "clients/src/test/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinatorTest.java", "diffHunk": "@@ -665,7 +698,7 @@ public boolean matches(AbstractRequest body) {\n         try {\n             coordinator.ensureActiveGroup();\n             fail(\"Should have woken up from ensureActiveGroup()\");\n-        } catch (WakeupException e) {\n+        } catch (WakeupException ignored) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fccb32033c53fb3be3ea04fc99bb989913722ea", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/5fccb32033c53fb3be3ea04fc99bb989913722ea", "committedDate": "2020-03-21T01:31:05Z", "message": "add unit test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "5fccb32033c53fb3be3ea04fc99bb989913722ea", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/5fccb32033c53fb3be3ea04fc99bb989913722ea", "committedDate": "2020-03-21T01:31:05Z", "message": "add unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MjA3NjY2", "url": "https://github.com/apache/kafka/pull/8324#pullrequestreview-379207666", "createdAt": "2020-03-23T08:19:00Z", "commit": {"oid": "5fccb32033c53fb3be3ea04fc99bb989913722ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwODoxOTowMVrOF56ohw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwODoxOTowMVrOF56ohw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjI3Mzc5OQ==", "bodyText": "@guozhangwang @abbccdda Shouldn't we synchronise this or use a local reference of the generation to be 100% safe?", "url": "https://github.com/apache/kafka/pull/8324#discussion_r396273799", "createdAt": "2020-03-23T08:19:01Z", "author": {"login": "dajac"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -913,7 +913,8 @@ private boolean isProtocolTypeInconsistent(String protocolType) {\n     }\n \n     private boolean isProtocolNameInconsistent(String protocolName) {\n-        return protocolName != null && !protocolName.equals(generation().protocolName);\n+        return protocolName != null && generation() != Generation.NO_GENERATION\n+                   && !protocolName.equals(generation().protocolName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fccb32033c53fb3be3ea04fc99bb989913722ea"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 339, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}