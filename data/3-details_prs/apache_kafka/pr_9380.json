{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NDYzNjA0", "number": 9380, "title": "KAFKA-7334: Suggest changing config for state.dir in case of FileNotF\u2026", "bodyText": "When state.dir is left at default configuration, there is a chance that certain files under the state directory are cleaned by OS since the default dir starts with /tmp/kafka-streams.\nI've added suggestion to change state.dir config in the exception message.\n(https://issues.apache.org/jira/browse/KAFKA-7334)", "createdAt": "2020-10-06T11:21:52Z", "url": "https://github.com/apache/kafka/pull/9380", "merged": true, "mergeCommit": {"oid": "5fc3f73f087a0c85a79e39a9a4b85e827c570c2d"}, "closed": true, "closedAt": "2020-10-08T19:20:21Z", "author": {"login": "voffcheg109"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP4qW9gH2gAyNDk4NDYzNjA0OjA4YWJhYjM4YzI3MDBiNzBkN2MzODFkOWQxMmE2NTVmYzFkZjU2NGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQbmgPgH2gAyNDk4NDYzNjA0OjNjOTU3OTNiNWE4NThmY2RmMTg1NTM4MzAzMzYzMjViMTZkMDhlOGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "08abab38c2700b70d7c381d9d12a655fc1df564c", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/08abab38c2700b70d7c381d9d12a655fc1df564c", "committedDate": "2020-10-06T13:47:03Z", "message": "KAFKA-7334: Suggest changing config for state.dir in case of FileNotFoundException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "08abab38c2700b70d7c381d9d12a655fc1df564c", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/08abab38c2700b70d7c381d9d12a655fc1df564c", "committedDate": "2020-10-06T13:47:03Z", "message": "KAFKA-7334: Suggest changing config for state.dir in case of FileNotFoundException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjgzMDkx", "url": "https://github.com/apache/kafka/pull/9380#pullrequestreview-503283091", "createdAt": "2020-10-06T19:17:35Z", "commit": {"oid": "08abab38c2700b70d7c381d9d12a655fc1df564c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "704b7063e7588c2e55c2d06e298d60a7a90765b9", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/704b7063e7588c2e55c2d06e298d60a7a90765b9", "committedDate": "2020-10-07T08:06:37Z", "message": "KAFKA-7334: Add additional warning and notes to errors."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MTA2NDEy", "url": "https://github.com/apache/kafka/pull/9380#pullrequestreview-504106412", "createdAt": "2020-10-07T17:24:32Z", "commit": {"oid": "704b7063e7588c2e55c2d06e298d60a7a90765b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MzU2Mjcz", "url": "https://github.com/apache/kafka/pull/9380#pullrequestreview-504356273", "createdAt": "2020-10-08T00:34:02Z", "commit": {"oid": "704b7063e7588c2e55c2d06e298d60a7a90765b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMDozNDowMlrOHeKHQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMDozNDowMlrOHeKHQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM4NTAyNA==", "bodyText": "it located -> it is located\nin /tmp directory -> in the (default) /tmp/kafka-streams directory ?", "url": "https://github.com/apache/kafka/pull/9380#discussion_r501385024", "createdAt": "2020-10-08T00:34:02Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/GlobalStateManagerImpl.java", "diffHunk": "@@ -446,7 +446,9 @@ public void checkpoint() {\n         try {\n             checkpointFile.write(filteredOffsets);\n         } catch (final IOException e) {\n-            log.warn(\"Failed to write offset checkpoint file to {} for global stores: {}\", checkpointFile, e);\n+            log.warn(\"Failed to write offset checkpoint file to {} for global stores: {}.\" +\n+                \" This may occur if OS cleaned the state.dir in case when it located in /tmp directory.\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "704b7063e7588c2e55c2d06e298d60a7a90765b9"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MzU2NjI4", "url": "https://github.com/apache/kafka/pull/9380#pullrequestreview-504356628", "createdAt": "2020-10-08T00:35:16Z", "commit": {"oid": "704b7063e7588c2e55c2d06e298d60a7a90765b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMDozNToxN1rOHeKInA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMDozNToxN1rOHeKInA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM4NTM3Mg==", "bodyText": "Do we know that it will resolve the problem? Maybe better:\nChanging the location of state.dir may resolve the problem", "url": "https://github.com/apache/kafka/pull/9380#discussion_r501385372", "createdAt": "2020-10-08T00:35:17Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/GlobalStateManagerImpl.java", "diffHunk": "@@ -446,7 +446,9 @@ public void checkpoint() {\n         try {\n             checkpointFile.write(filteredOffsets);\n         } catch (final IOException e) {\n-            log.warn(\"Failed to write offset checkpoint file to {} for global stores: {}\", checkpointFile, e);\n+            log.warn(\"Failed to write offset checkpoint file to {} for global stores: {}.\" +\n+                \" This may occur if OS cleaned the state.dir in case when it located in /tmp directory.\" +\n+                \" You can change location for state.dir to resolve problem\", checkpointFile, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "704b7063e7588c2e55c2d06e298d60a7a90765b9"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MzU3MTk4", "url": "https://github.com/apache/kafka/pull/9380#pullrequestreview-504357198", "createdAt": "2020-10-08T00:37:07Z", "commit": {"oid": "704b7063e7588c2e55c2d06e298d60a7a90765b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMDozNzowN1rOHeKKcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMDozNzowN1rOHeKKcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM4NTg0MQ==", "bodyText": "Wondering if this should go into StreamsConfig ?", "url": "https://github.com/apache/kafka/pull/9380#discussion_r501385841", "createdAt": "2020-10-08T00:37:07Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StateDirectory.java", "diffHunk": "@@ -98,6 +98,10 @@ public StateDirectory(final StreamsConfig config, final Time time, final boolean\n             throw new ProcessorStateException(\n                 String.format(\"state directory [%s] doesn't exist and couldn't be created\", stateDir.getPath()));\n         }\n+        if (stateDirName.startsWith(\"/tmp\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "704b7063e7588c2e55c2d06e298d60a7a90765b9"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MzU4MDIy", "url": "https://github.com/apache/kafka/pull/9380#pullrequestreview-504358022", "createdAt": "2020-10-08T00:39:50Z", "commit": {"oid": "704b7063e7588c2e55c2d06e298d60a7a90765b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMDozOTo1MFrOHeKNGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwMDozOTo1MFrOHeKNGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM4NjUyMg==", "bodyText": "Hmmm... Not sure if I can follow? Why?\nAlso, if you run multiple instances on the same machine, it seems to be the same as running multiple threads in the same KafkaStreams client?\nAlso, if you configure different state directories, local state cannot be shared what might be wasteful?\nCan you elaborate on this sentence?", "url": "https://github.com/apache/kafka/pull/9380#discussion_r501386522", "createdAt": "2020-10-08T00:39:50Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorStateManager.java", "diffHunk": "@@ -603,7 +603,11 @@ public void checkpoint() {\n         try {\n             checkpointFile.write(checkpointingOffsets);\n         } catch (final IOException e) {\n-            log.warn(\"Failed to write offset checkpoint file to [{}]\", checkpointFile, e);\n+            log.warn(\"Failed to write offset checkpoint file to [{}].\" +\n+                \" This may occur if OS cleaned the state.dir in case when it located in /tmp directory.\" +\n+                \" You can change location for state.dir to resolve problem.\" +\n+                \" This can also occur due to running multiple instances on the same machine using the same state dir.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "704b7063e7588c2e55c2d06e298d60a7a90765b9"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c95793b5a858fcdf18553830336325b16d08e8f", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/3c95793b5a858fcdf18553830336325b16d08e8f", "committedDate": "2020-10-08T06:29:31Z", "message": "KAFKA-7334: Fix warnings in log."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 447, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}