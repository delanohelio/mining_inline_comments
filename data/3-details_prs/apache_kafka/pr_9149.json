{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MzEzMDU1", "number": 9149, "title": "KAFKA-10340: Improve the trace logging under connector based topic creation", "bodyText": "Improve the logging in maybeCreateTopic to let user know if  !topicCreation.isTopicCreationRequired(topic), we won't create this topic because the topic creation setting is disabled or the topic name is already created. Also, we should let user know that if the topic doesn't exist, we'll rely on the auto.create.topics.enable setting in broker side to see if the topic can be auto created or not. Otherwise, if the auto.create.topics.enable is disabled, the producer.send will get only TimeoutException and no other valuable clue for users.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-08-10T06:45:09Z", "url": "https://github.com/apache/kafka/pull/9149", "merged": true, "mergeCommit": {"oid": "c217788e699db66ba1aa2e6e9d48d1ca92a19625"}, "closed": true, "closedAt": "2020-10-15T18:14:54Z", "author": {"login": "showuon"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9d7FrgBqjM2Mzc3MjcyMzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSpKRcAFqTUwODkxMDgwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDM5ODcw", "url": "https://github.com/apache/kafka/pull/9149#pullrequestreview-464039870", "createdAt": "2020-08-10T08:27:51Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwODoyNzo1MVrOG-FiyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwODoyNzo1MVrOG-FiyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc1NTcyMQ==", "bodyText": "should be newTopic here for error message.", "url": "https://github.com/apache/kafka/pull/9149#discussion_r467755721", "createdAt": "2020-08-10T08:27:51Z", "author": {"login": "showuon"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java", "diffHunk": "@@ -430,7 +434,7 @@ private void maybeCreateTopic(String topic) {\n             log.info(\"Created topic '{}' using creation group {}\", newTopic, topicGroup);\n         } else {\n             log.warn(\"Request to create new topic '{}' failed\", topic);\n-            throw new ConnectException(\"Task failed to create new topic \" + topic + \". Ensure \"\n+            throw new ConnectException(\"Task failed to create new topic \" + newTopic + \". Ensure \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "committedDate": "2020-08-12T13:10:30Z", "message": "KAFKA-10340: improve the logging to help user know what is going on"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "committedDate": "2020-08-12T13:10:30Z", "message": "KAFKA-10340: improve the logging to help user know what is going on"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "committedDate": "2020-08-12T13:10:30Z", "message": "KAFKA-10340: improve the logging to help user know what is going on"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1131ffaa1403c581ef5cd5adcae42b1cca9900d", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/b1131ffaa1403c581ef5cd5adcae42b1cca9900d", "committedDate": "2020-09-12T14:12:01Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into KAFKA-10340"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxODQ3MDg1", "url": "https://github.com/apache/kafka/pull/9149#pullrequestreview-491847085", "createdAt": "2020-09-19T01:20:01Z", "commit": {"oid": "b1131ffaa1403c581ef5cd5adcae42b1cca9900d"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwMToyMDowMlrOHUfjNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwMTo1NDo1NFrOHUfzxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI1MDQ4Nw==", "bodyText": "Writing one log message per record, seems excessive, even for DEBUG\nThere's a trace level message above for the record. Maybe we want to append the topic name there.", "url": "https://github.com/apache/kafka/pull/9149#discussion_r491250487", "createdAt": "2020-09-19T01:20:02Z", "author": {"login": "kkonstantine"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java", "diffHunk": "@@ -363,6 +363,7 @@ private boolean sendRecords() {\n             try {\n                 maybeCreateTopic(record.topic());\n                 final String topic = producerRecord.topic();\n+                log.debug(\"{} is going to send record to {}\", WorkerSourceTask.this, topic);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1131ffaa1403c581ef5cd5adcae42b1cca9900d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI1MTgxOA==", "bodyText": "This is going to be very repetitive after the first time during which the topic might be created.\nWhat's the hint we are trying to extract here?", "url": "https://github.com/apache/kafka/pull/9149#discussion_r491251818", "createdAt": "2020-09-19T01:27:52Z", "author": {"login": "kkonstantine"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java", "diffHunk": "@@ -409,6 +410,9 @@ private boolean sendRecords() {\n     // RegexRouter) topic creation can not be batched for multiple topics\n     private void maybeCreateTopic(String topic) {\n         if (!topicCreation.isTopicCreationRequired(topic)) {\n+            log.trace(\"The topic creation setting is disabled or the topic name {} is already in the topic cache.\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1131ffaa1403c581ef5cd5adcae42b1cca9900d"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI1NDcyNg==", "bodyText": "You are referring to the inclusion of topic properties besides the topic name. Yeah that's fine.", "url": "https://github.com/apache/kafka/pull/9149#discussion_r491254726", "createdAt": "2020-09-19T01:54:54Z", "author": {"login": "kkonstantine"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java", "diffHunk": "@@ -430,7 +434,7 @@ private void maybeCreateTopic(String topic) {\n             log.info(\"Created topic '{}' using creation group {}\", newTopic, topicGroup);\n         } else {\n             log.warn(\"Request to create new topic '{}' failed\", topic);\n-            throw new ConnectException(\"Task failed to create new topic \" + topic + \". Ensure \"\n+            throw new ConnectException(\"Task failed to create new topic \" + newTopic + \". Ensure \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc1NTcyMQ=="}, "originalCommit": null, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb771714c15a704f26c34010f80f7f707fea54f1", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/fb771714c15a704f26c34010f80f7f707fea54f1", "committedDate": "2020-09-21T09:51:35Z", "message": "KAFKA-10340: address reviewer's comment to append to trace level log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed949d7a7688fac66ce40207079769a5b23ddb28", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/ed949d7a7688fac66ce40207079769a5b23ddb28", "committedDate": "2020-09-21T09:52:41Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into KAFKA-10340"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4OTA0NjEw", "url": "https://github.com/apache/kafka/pull/9149#pullrequestreview-508904610", "createdAt": "2020-10-15T03:03:42Z", "commit": {"oid": "ed949d7a7688fac66ce40207079769a5b23ddb28"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMzowMzo0MlrOHhvGZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMzowNjozNVrOHhvJNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzNjc0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.trace(\"The topic creation setting is disabled or the topic name {} is already in the topic cache.\" +\n          \n          \n            \n                        log.trace(\"Topic creation by the connector is disabled or the topic {} was previously created.\" +", "url": "https://github.com/apache/kafka/pull/9149#discussion_r505136741", "createdAt": "2020-10-15T03:03:42Z", "author": {"login": "kkonstantine"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java", "diffHunk": "@@ -409,6 +409,9 @@ private boolean sendRecords() {\n     // RegexRouter) topic creation can not be batched for multiple topics\n     private void maybeCreateTopic(String topic) {\n         if (!topicCreation.isTopicCreationRequired(topic)) {\n+            log.trace(\"The topic creation setting is disabled or the topic name {} is already in the topic cache.\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed949d7a7688fac66ce40207079769a5b23ddb28"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzNzQ2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"If the topic doesn't exist, we'll rely on the auto.create.topics.enable setting in broker side \" +\n          \n          \n            \n                            \"to see if the topic can be auto created or not\", topic);\n          \n          \n            \n                            \"If auto.create.topics.enable is enabled on the broker, the topic will be created with  \" +\n          \n          \n            \n                            \"default settings\", topic);", "url": "https://github.com/apache/kafka/pull/9149#discussion_r505137462", "createdAt": "2020-10-15T03:06:35Z", "author": {"login": "kkonstantine"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java", "diffHunk": "@@ -409,6 +409,9 @@ private boolean sendRecords() {\n     // RegexRouter) topic creation can not be batched for multiple topics\n     private void maybeCreateTopic(String topic) {\n         if (!topicCreation.isTopicCreationRequired(topic)) {\n+            log.trace(\"The topic creation setting is disabled or the topic name {} is already in the topic cache.\" +\n+                \"If the topic doesn't exist, we'll rely on the auto.create.topics.enable setting in broker side \" +\n+                \"to see if the topic can be auto created or not\", topic);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed949d7a7688fac66ce40207079769a5b23ddb28"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "094ee6acc772f0532f5513f9d29e5b46f165bd01", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/094ee6acc772f0532f5513f9d29e5b46f165bd01", "committedDate": "2020-10-15T03:19:31Z", "message": "KAFKA-10340: improve the logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4OTEwODAy", "url": "https://github.com/apache/kafka/pull/9149#pullrequestreview-508910802", "createdAt": "2020-10-15T03:25:12Z", "commit": {"oid": "094ee6acc772f0532f5513f9d29e5b46f165bd01"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1109, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}