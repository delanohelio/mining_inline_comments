{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0MzAwMDY4", "number": 8626, "title": "KAFKA-9921: explicit handling of null values with retainDuplicates", "bodyText": "In general the behavior of window stores with retainDuplicates is not well documented or enforced, so we should attempt to clarify things better in the javadocs and in the code itself. This explicitly skips the put/delete when the value is null and duplicates are allowed, and specifies this behavior in the docs.\nAlso adds in a test I left out in the earlier PR #8564", "createdAt": "2020-05-06T19:52:03Z", "url": "https://github.com/apache/kafka/pull/8626", "merged": true, "mergeCommit": {"oid": "72d72a974c660db7851c1f053ae4a64dfc913837"}, "closed": true, "closedAt": "2020-05-11T23:35:03Z", "author": {"login": "ableegoldman"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcet-SDAH2gAyNDE0MzAwMDY4OmM5ODUyNTQ1MGNiNDBjZDA2MjM5MWQxZjEyMDc3ZjVkNWNlN2EzYmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfZRZnAFqTQwODU1MzQ5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c98525450cb40cd062391d1f12077f5d5ce7a3be", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/c98525450cb40cd062391d1f12077f5d5ce7a3be", "committedDate": "2020-05-06T19:37:34Z", "message": "add missing test, clarify nulls in jvadocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c223e0faaeaefdc1f361311b41e6dd4b5a3b8f0", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/0c223e0faaeaefdc1f361311b41e6dd4b5a3b8f0", "committedDate": "2020-05-06T19:48:24Z", "message": "skip delete with duplicates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf73d40632d232592b972653803a679386748307", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/bf73d40632d232592b972653803a679386748307", "committedDate": "2020-05-08T20:05:06Z", "message": "add to WindowStore#put docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NTEzMTEx", "url": "https://github.com/apache/kafka/pull/8626#pullrequestreview-408513111", "createdAt": "2020-05-08T20:40:59Z", "commit": {"oid": "bf73d40632d232592b972653803a679386748307"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQyMDo0MDo1OVrOGSy_sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQyMDo0MDo1OVrOGSy_sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM2MzA1OA==", "bodyText": "I would use the 'interpreted' instead of 'treated' to be more consistent with the rest of the javadoc (at least in this file). The behavior is not really due to an optimization and that's not really the point IMO. Also, 'retain duplicates' in the more common term instead of 'allow duplicates'. I would rephrase it to something like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * If serialized value bytes are null it is treated as delete. Note that as an optimization, deletes will be\n          \n          \n            \n                 * skipped in the case of an underlying store that allows duplicates.\n          \n          \n            \n                 * If serialized value bytes are null it is treated as delete. Note that deletes will be\n          \n          \n            \n                 * ignored in the case of an underlying store that retains duplicates.", "url": "https://github.com/apache/kafka/pull/8626#discussion_r422363058", "createdAt": "2020-05-08T20:40:59Z", "author": {"login": "GeorgiPetkov"}, "path": "streams/src/main/java/org/apache/kafka/streams/state/WindowStore.java", "diffHunk": "@@ -57,6 +57,10 @@\n \n     /**\n      * Put a key-value pair into the window with given window start timestamp\n+     * <p>\n+     * If serialized value bytes are null it is treated as delete. Note that as an optimization, deletes will be\n+     * skipped in the case of an underlying store that allows duplicates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf73d40632d232592b972653803a679386748307"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d565d18e3f06f1f4665c273ad7938e9aed4d93dd", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/d565d18e3f06f1f4665c273ad7938e9aed4d93dd", "committedDate": "2020-05-08T20:46:46Z", "message": "CR suggestion\n\nCo-authored-by: GeorgiPetkov <gp000077@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fbe78afd19250fc5dc1d476967ced6ec3c687d7", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/5fbe78afd19250fc5dc1d476967ced6ec3c687d7", "committedDate": "2020-05-08T20:51:41Z", "message": "use ineterpreted"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NTUzNDkw", "url": "https://github.com/apache/kafka/pull/8626#pullrequestreview-408553490", "createdAt": "2020-05-08T22:04:22Z", "commit": {"oid": "5fbe78afd19250fc5dc1d476967ced6ec3c687d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1369, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}