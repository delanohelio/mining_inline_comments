{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5NzI5NzU3", "number": 9499, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNToyOToxMlrOExwTuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNTozMjo1M1rOEx9Uxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNjA3MTYxOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/record/CompressionType.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNToyOToxMlrOHoBS2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNToyMjozM1rOHoUyyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNjI5OQ==", "bodyText": "Is BufferedOutputStream good to other compression also?", "url": "https://github.com/apache/kafka/pull/9499#discussion_r511726299", "createdAt": "2020-10-26T05:29:12Z", "author": {"login": "chia7712"}, "path": "clients/src/main/java/org/apache/kafka/common/record/CompressionType.java", "diffHunk": "@@ -119,7 +119,9 @@ public InputStream wrapForInput(ByteBuffer inputBuffer, byte messageVersion, Buf\n         @Override\n         public OutputStream wrapForOutput(ByteBufferOutputStream buffer, byte messageVersion) {\n             try {\n-                return (OutputStream) ZstdConstructors.OUTPUT.invoke(buffer);\n+                // Set input buffer (uncompressed) to 16 KB (none by default) to ensure reasonable performance\n+                // in cases where the caller passes a small number of bytes to write (potentially a single byte)\n+                return new BufferedOutputStream((OutputStream) ZstdConstructors.OUTPUT.invoke(buffer), 16 * 1024);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87d625fd38e79df43053e4812820cfe53e928757"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA0NTc2OA==", "bodyText": "This should be safe. It is used already in this file to wrap the GZIPOutputStream which also does not buffer uncompressed data prior to compression.", "url": "https://github.com/apache/kafka/pull/9499#discussion_r512045768", "createdAt": "2020-10-26T15:22:33Z", "author": {"login": "yuzawa-san"}, "path": "clients/src/main/java/org/apache/kafka/common/record/CompressionType.java", "diffHunk": "@@ -119,7 +119,9 @@ public InputStream wrapForInput(ByteBuffer inputBuffer, byte messageVersion, Buf\n         @Override\n         public OutputStream wrapForOutput(ByteBufferOutputStream buffer, byte messageVersion) {\n             try {\n-                return (OutputStream) ZstdConstructors.OUTPUT.invoke(buffer);\n+                // Set input buffer (uncompressed) to 16 KB (none by default) to ensure reasonable performance\n+                // in cases where the caller passes a small number of bytes to write (potentially a single byte)\n+                return new BufferedOutputStream((OutputStream) ZstdConstructors.OUTPUT.invoke(buffer), 16 * 1024);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcyNjI5OQ=="}, "originalCommit": {"oid": "87d625fd38e79df43053e4812820cfe53e928757"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwODIwNDIyOnYy", "diffSide": "RIGHT", "path": "gradle/dependencies.gradle", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNTozMjo1M1rOHoVTFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNTozNToyMlrOHoVaww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA1NDAzNw==", "bodyText": "This change means we are using the recycling buffer pool, right? I think we should be passing our own buffer pool.", "url": "https://github.com/apache/kafka/pull/9499#discussion_r512054037", "createdAt": "2020-10-26T15:32:53Z", "author": {"login": "ijuma"}, "path": "gradle/dependencies.gradle", "diffHunk": "@@ -116,7 +116,7 @@ versions += [\n   testRetryPlugin: \"1.1.6\",\n   zinc: \"1.3.5\",\n   zookeeper: \"3.5.8\",\n-  zstd: \"1.4.5-6\"\n+  zstd: \"1.4.5-8\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87d625fd38e79df43053e4812820cfe53e928757"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA1NjAwMw==", "bodyText": "Ah, you explained this in the PR description. Let me think about that.", "url": "https://github.com/apache/kafka/pull/9499#discussion_r512056003", "createdAt": "2020-10-26T15:35:22Z", "author": {"login": "ijuma"}, "path": "gradle/dependencies.gradle", "diffHunk": "@@ -116,7 +116,7 @@ versions += [\n   testRetryPlugin: \"1.1.6\",\n   zinc: \"1.3.5\",\n   zookeeper: \"3.5.8\",\n-  zstd: \"1.4.5-6\"\n+  zstd: \"1.4.5-8\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA1NDAzNw=="}, "originalCommit": {"oid": "87d625fd38e79df43053e4812820cfe53e928757"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3975, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}