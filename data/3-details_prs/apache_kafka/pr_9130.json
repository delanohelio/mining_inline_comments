{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNDU1NTMx", "number": 9130, "title": "KAFKA-10492; Core Kafka Raft Implementation (KIP-595)", "bodyText": "This is the core Raft implementation specified by KIP-595: https://cwiki.apache.org/confluence/display/KAFKA/KIP-595%3A+A+Raft+Protocol+for+the+Metadata+Quorum. We have created a separate \"raft\" module where most of the logic resides. The new APIs introduced in this patch in order to support Raft election and such are disabled in the server until the integration with the controller is complete. Until then, there is a standalone server which can be used for testing the performance of the Raft implementation. See raft/README.md for details.\nCo-authored-by: Boyang Chen boyang@confluent.io\nCo-authored-by: Guozhang Wang wangguoz@gmail.com\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-08-05T15:23:31Z", "url": "https://github.com/apache/kafka/pull/9130", "merged": true, "mergeCommit": {"oid": "b7c8490cf47b0c18253d6a776b2b35c76c71c65d"}, "closed": true, "closedAt": "2020-09-22T18:32:44Z", "author": {"login": "hachikuji"}, "timelineItems": {"totalCount": 59, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-jgmGABqjM2NTMxMDM3MzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLaKltABqjM3OTQwMjYyMDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "b552aa3ecadc7717f843f452755e24da7f9c1617", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/b552aa3ecadc7717f843f452755e24da7f9c1617", "committedDate": "2020-08-13T17:31:17Z", "message": "KC-660: Add append commit mode for perf (#367)\n\n1. Added AppendCommitMode to RecordAppender interface; keep future objects within uncommittedAppend if QUORUM mode is used and complete only after hw advanced beyond.\r\n2. Used another purgatory to expire uncommitted future.\r\n3. Some other minor fixes (comments inlined).\r\n\r\nCo-authored-by: Jason Gustafson <jason@confluent.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjYzMjkx", "url": "https://github.com/apache/kafka/pull/9130#pullrequestreview-491663291", "createdAt": "2020-09-18T17:43:00Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMjMwOTI5", "url": "https://github.com/apache/kafka/pull/9130#pullrequestreview-492230929", "createdAt": "2020-09-20T23:09:28Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMFQyMzowOToyOFrOHU9ylQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMFQyMzoxMjoxNlrOHU9zqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc0NTk0MQ==", "bodyText": "nit: if this is only used for unit tests, better add a one-liner comment for that.", "url": "https://github.com/apache/kafka/pull/9130#discussion_r491745941", "createdAt": "2020-09-20T23:09:28Z", "author": {"login": "guozhangwang"}, "path": "clients/src/main/java/org/apache/kafka/common/protocol/ApiKeys.java", "diffHunk": "@@ -415,4 +444,10 @@ public void visit(Type field) {\n         return hasBuffer.get();\n     }\n \n+    public static Set<ApiKeys> enabledApis() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc0NjIxOA==", "bodyText": "I feel this is not necessary since we would throw in processCompletedReceives at SocketServer already as processChannelException, but no harm guarding them as well.", "url": "https://github.com/apache/kafka/pull/9130#discussion_r491746218", "createdAt": "2020-09-20T23:12:16Z", "author": {"login": "guozhangwang"}, "path": "core/src/main/scala/kafka/server/KafkaApis.scala", "diffHunk": "@@ -182,10 +182,13 @@ class KafkaApis(val requestChannel: RequestChannel,\n         case ApiKeys.ALTER_CLIENT_QUOTAS => handleAlterClientQuotasRequest(request)\n         case ApiKeys.DESCRIBE_USER_SCRAM_CREDENTIALS => handleDescribeUserScramCredentialsRequest(request)\n         case ApiKeys.ALTER_USER_SCRAM_CREDENTIALS => handleAlterUserScramCredentialsRequest(request)\n-        case ApiKeys.VOTE => handleVote(request)\n-        case ApiKeys.BEGIN_QUORUM_EPOCH => handleBeginEpoch(request)\n-        case ApiKeys.END_QUORUM_EPOCH => handleEndEpoch(request)\n-        case ApiKeys.DESCRIBE_QUORUM => handleDescribeQuorum(request)\n+\n+        // Until we are ready to integrate the Raft layer, these APIs are treated as\n+        // unexpected and we just close the connection.\n+        case ApiKeys.VOTE => closeConnection(request, util.Collections.emptyMap())", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6ef8255376701b0390db95ab728ec29e5bf52bc", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/d6ef8255376701b0390db95ab728ec29e5bf52bc", "committedDate": "2020-09-22T15:56:35Z", "message": "Add core Raft request/response schemas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d58ac82f9233d08af5bd031659f3ae8f6fea090b", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/d58ac82f9233d08af5bd031659f3ae8f6fea090b", "committedDate": "2020-09-22T15:56:35Z", "message": "Add interfaces and mock implementations for network and log layers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba5105b124b4c12cbcb270e14b057714e56f65ef", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/ba5105b124b4c12cbcb270e14b057714e56f65ef", "committedDate": "2020-09-22T15:56:35Z", "message": "Core Raft implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faf8786ee959132f10988b1746d4a196f3fa4832", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/faf8786ee959132f10988b1746d4a196f3fa4832", "committedDate": "2020-09-22T15:56:35Z", "message": "Add simulation testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a7553e3c20df5f37a17894affbaad025dcc10ab", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/8a7553e3c20df5f37a17894affbaad025dcc10ab", "committedDate": "2020-09-22T15:56:35Z", "message": "Simple key value store implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d38428c1515185f25367d16b3dab0c9bc555a353", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/d38428c1515185f25367d16b3dab0c9bc555a353", "committedDate": "2020-09-22T15:56:35Z", "message": "Integration with kafka log/network layer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c53ba4b48ea2322031784062198ccbc3c630412", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/5c53ba4b48ea2322031784062198ccbc3c630412", "committedDate": "2020-09-22T15:56:35Z", "message": "Create RaftClient interface and rename RaftManager to KafkaRaftClient"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03e84a6b0a0fec67005c77d0d89f3f40e534a195", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/03e84a6b0a0fec67005c77d0d89f3f40e534a195", "committedDate": "2020-09-22T15:56:35Z", "message": "Fix bugs in KafkaNetworkChannel and add test cases (#303)\n\nThis patch fixes a few problems in `KafkaNetworkChannel` found in #301: \r\n- Check for authentication errors before checking for disconnects\r\n- Check for connection failures prior to calling `ready`\r\n- Call `ready` instead of `isReady` to ensure we initiate the connection\r\nAlso remove one of the unneeded conversion methods."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d97b153bf17de71f7d39ff41e9eca2d79b24f28", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/2d97b153bf17de71f7d39ff41e9eca2d79b24f28", "committedDate": "2020-09-22T15:56:36Z", "message": "Add leader change control message (#304)\n\nAdds the leader change control message schema and the logic to append it to the log after becoming leader."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "666c85d0859cd7113a3180d205d5ae6ded8cdbce", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/666c85d0859cd7113a3180d205d5ae6ded8cdbce", "committedDate": "2020-09-22T15:56:36Z", "message": "rename file (#311)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c6128ce10671c77bb5e48ca5035f80de6765f8f", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/7c6128ce10671c77bb5e48ca5035f80de6765f8f", "committedDate": "2020-09-22T15:56:36Z", "message": "Add test logging support (#312)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36d36fa90c8c273b469c5c86cc7b8c69e5a4f2e6", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/36d36fa90c8c273b469c5c86cc7b8c69e5a4f2e6", "committedDate": "2020-09-22T15:56:36Z", "message": "Mix of testing/naming improvements  (#307)\n\nThis patch makes the following improvements:\n\n1. Replace the usage of `requestId` with `correlationId`, which is already widely used in Kafka.\n2. Make `MockLog` aware of record batching to make its behavior more consistent with the `Log` implementation and to\n3. Add test coverage to `ConnectionCache`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1a4f13447a51e09b3622a1d7834172f727a787f", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/c1a4f13447a51e09b3622a1d7834172f727a787f", "committedDate": "2020-09-22T15:56:36Z", "message": "Fix compilation breakage after rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25f9753d4318975b02cefc3dcbc4f41aa2286103", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/25f9753d4318975b02cefc3dcbc4f41aa2286103", "committedDate": "2020-09-22T15:59:05Z", "message": "Add quorum-state file (#302)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6da773bb63f7b57d9f36eff45c420cd2b07783c", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/d6da773bb63f7b57d9f36eff45c420cd2b07783c", "committedDate": "2020-09-22T15:59:05Z", "message": "Ensure jitter respected after candidacy fails plus other cosmetic improvements (#309)\n\nAddress review comments from 9f52a74. Most of the changes are cosmetic (changing naming or state representation), but we also fix a couple issues:\r\n\r\n- We ensure that jitter is respected after the election timeout expires when we are a candidate.\r\n- We reject appends if we are not the leader."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4570930474fd524e5376165a4fc056e7bdb618ac", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/4570930474fd524e5376165a4fc056e7bdb618ac", "committedDate": "2020-09-22T15:59:05Z", "message": "Correct Quorum size in simulation tests (#323)\n\nObservers were not being created in the simulation test due to an invalid range check. This patch fixes the range check."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03a737f579edb776996ff2c6f25a84c5b9a99565", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/03a737f579edb776996ff2c6f25a84c5b9a99565", "committedDate": "2020-09-22T15:59:06Z", "message": "Add raft test coverage (#314)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe1a0d0362d942541f5cb98b0850a008bfc0b22d", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/fe1a0d0362d942541f5cb98b0850a008bfc0b22d", "committedDate": "2020-09-22T15:59:06Z", "message": "Make request/response error handling more conventional (#319)\n\nVarious improvements in error handling:\n\n1) Add new INCONSISTENT_VOTER_SET as a more useful error for voter-only requests\n2) Remove the logic to return some errors which should not be possible. For example, there should never be a reason why we return `NOT_LEADER_FOR_PARTITION` from `FetchQuorumRecords` in normal circumstances. A stale fetch request would get fenced by the epoch. And unlike with topic partitions, a follower cannot learn about the leader before the leader itself.\n3) Add some additional validations. For example, we now add checks to make sure that we reject requests which indicate we are the leader when we know we are not. We also validate all offsets and epochs strictly in both FetchQuorumRecords and Vote requests.\n4) Refine/fix error handling in `EndQuorumEpoch` to handle requests from followers or candidates and to only trigger new election when necessary."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "178f21d3c8879484dd0e1c65abe5d44e2f6fc6f3", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/178f21d3c8879484dd0e1c65abe5d44e2f6fc6f3", "committedDate": "2020-09-22T15:59:06Z", "message": "Leader progress timeout (#324)\n\n1. Introduce the fetch timeout config.\n2. Leader relying on the fetch timeout to send find-quorum if does not receive from a majority of quorum.\n3. Voter relying on fetch timeout to become candidate (not relying on election timeout).\n\nWe also merge the two timers into a single timer, and also added unit tests. Simulation tests now passed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c34f3577750fcf76c760fa51248aa4adbf8e0ff", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/7c34f3577750fcf76c760fa51248aa4adbf8e0ff", "committedDate": "2020-09-22T15:59:06Z", "message": "Add basic purgatory for quorum fetches (#322)\n\nThis patch adds a simple purgatory interface and integration with Kafka's `DelayedOperationPurgatory`. For the moment, we only support max wait time, which has been added to the `FetchQuorumRecords` request schema."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80d4f031f11aa08b93f6f6d53f01b19a8fe08f8e", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/80d4f031f11aa08b93f6f6d53f01b19a8fe08f8e", "committedDate": "2020-09-22T15:59:06Z", "message": "Refactor Raft StateMachine API (#321)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dd86f80c97963fc0fa3e225b6bbae248aa0fe2a", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/9dd86f80c97963fc0fa3e225b6bbae248aa0fe2a", "committedDate": "2020-09-22T15:59:06Z", "message": "Add voter information towards the quorum-state file (#325)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f45975e80684e603e38fd023bc68c6e2b8d71938", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/f45975e80684e603e38fd023bc68c6e2b8d71938", "committedDate": "2020-09-22T15:59:06Z", "message": "Minimal raft server implementation for more interesting testing (#301)\n\nThis patch adds the wiring to startup a dummy server which uses the `ReplicatedCounter` state machine."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fc674554670c310c3afec334e0d5315258c39c7", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/7fc674554670c310c3afec334e0d5315258c39c7", "committedDate": "2020-09-22T15:59:06Z", "message": "Revise EndQuorum logic to send to preferred followers first (#320)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "520a43a8bee21629033ae7e759d754791cfca5f1", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/520a43a8bee21629033ae7e759d754791cfca5f1", "committedDate": "2020-09-22T15:59:06Z", "message": "Add raft metrics (#329)\n\nWhile looking at the SimpleKeyValueStore impl, I realized that we should return the last offset, not the base offset, in the append future; because the caller (replicated-state-machine) needs the last offset to determine which operations has been committed. Before this, the SimpleKeyValueStore is actually committing puts compared with the base offset.\n\nAdded raft metrics."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81f1cca61d4b6263f1e8b56faf94344954a7cadc", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/81f1cca61d4b6263f1e8b56faf94344954a7cadc", "committedDate": "2020-09-22T15:59:06Z", "message": "MockLog should only read full batches (#347)\n\nIt is important that we preserve batch boundaries in the MockLog implementation since they may (eventually) have semantic significance. For example, we may use batches to atomically apply a set of operations.\r\n\r\nNote that the replication protocol guarantees that followers can only send fetch offsets on batch boundaries, which also implies that the high watermark is aligned. If there was a misaligned fetch, then it would result in a validation error and an offset reset."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d0a9f6e15042ec580b9e98afc631dfd900f1c10", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/9d0a9f6e15042ec580b9e98afc631dfd900f1c10", "committedDate": "2020-09-22T15:59:06Z", "message": "Require non-empty record set in append APIs (#349)\n\nIf the fetch response has no data, then the log append currently fails with an `Append failed unexpectedly` error. The problem is that there is no start offset for an empty append. This patch fixes the problem by adding a check in the response handler and skipping the append if the record set is empty. We also formally make empty appends invalid in the API and add some testing for this."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b48f2942c843d1bd2de6121ecfe760fc8de868c8", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/b48f2942c843d1bd2de6121ecfe760fc8de868c8", "committedDate": "2020-09-22T15:59:06Z", "message": "Improve simulation performance and validation (#350)\n\nMost of the time running the simulation test was spent validating committed data. I turned this into a `Validation`, which is run after simulation completion rather than an `Invariant` which is checked after each event. I have also added a couple additional invariants. This dropped the time to run these tests from over 3-5 minutes to about 30 seconds."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7cf3940ef6052fdb4de112309fa406e22f1675f", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/c7cf3940ef6052fdb4de112309fa406e22f1675f", "committedDate": "2020-09-22T15:59:07Z", "message": "Cache high watermark on the leader (#346)\n\nCache the high watermark by remembering all replica's end offset as the LogOffsetMetadata.\n\nNote that comparing with #344 we are only caching hw on the leader side, not on follower since the updated HW does not match the append log info, while the state machine application executes on both leader and followers --- i.e. on follower-side we still need to read the hw every time."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b1f2eda3fae0eab4cbd8f942cef7a8bcb830c27", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/3b1f2eda3fae0eab4cbd8f942cef7a8bcb830c27", "committedDate": "2020-09-22T15:59:07Z", "message": "Graceful shutdown improvements (#348)\n\nThis patch does the following:\r\n\r\n- Fixes shutdown logic so that the resigning leader stays alive long enough to help its successor get elected.\r\n- Add graceful shutdown to simulation test cases\r\n- Add graceful shutdown logic to `RaftServer`\r\n- Improve graceful shutdown test coverage\r\n- Add more logging on shutdown"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fac5bfe8aaece4d3a0ee2b4f138c39cef80c2d00", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/fac5bfe8aaece4d3a0ee2b4f138c39cef80c2d00", "committedDate": "2020-09-22T15:59:07Z", "message": "Integrate ProducerPerformance with RaftServer (#330)\n\nAdd Producer Performance integration with Raft server.\nIntroduce an no-op state machine for log appending and benchmark\nRemoved self increment logic to replace with VerifiableProducer data population\nAdd the README for Raft module to kick-off the benchmark\n\nReviewers: Jason Gustafson <jason@confluent.io>, Guozhang Wang <wangguoz@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "328af019184af25c4423d26f7d9daa7795f75a3b", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/328af019184af25c4423d26f7d9daa7795f75a3b", "committedDate": "2020-09-22T15:59:07Z", "message": "Improve range checking in MockLog (#351)\n\nThis patch includes a few small fixes in `MockLog`. In particular, it makes the range checking consistent with the standard `Log` implementation. It also adds some additional testing and fixes some of the start offset return logic in `read`."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a88e8439040f3a70c587c4dc792f9fb9002f3b94", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/a88e8439040f3a70c587c4dc792f9fb9002f3b94", "committedDate": "2020-09-22T15:59:07Z", "message": "Introduce the election backoff mechanism (#340)\n\nImprovements to election timeout/backoff behavior. Specifically:\n\n1. Do not use jitter for election timeout anymore, instead setting it as uniform(T, 2T) where T is the configured election timeout.\n2. The jitter config would instead be used as the binary exponential backoff 's upper bound."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d77da6a00a61f5ef039892531d25fc3c326b3c73", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/d77da6a00a61f5ef039892531d25fc3c326b3c73", "committedDate": "2020-09-22T15:59:07Z", "message": "Add DescribeQuorum API (#345)\n\nAdd describe quorum API.\n\n1. Add data templates\n2. Consolidate fetch time and offset updates\n3. Separate replica State from voter state for observers\n4. Bookkeep seen observers\n5. Attach topic partition to the Replicated log\n\nReviewers: Guozhang Wang <wangguoz@gmail.com>, Jason Gustafson <jason@confluent.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5905f57bddde754f27f8abffe798310b9f84bf31", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/5905f57bddde754f27f8abffe798310b9f84bf31", "committedDate": "2020-09-22T15:59:07Z", "message": "remove target voters from quorum state (#365)\n\nAs title suggests, matching KIP-595 quorum state data format.\r\n\r\nReviewers: Jason Gustafson <jason@confluent.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c69a4ff94dcbaa2e0372ed6fce6e1363fd4bb5c1", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/c69a4ff94dcbaa2e0372ed6fce6e1363fd4bb5c1", "committedDate": "2020-09-22T15:59:07Z", "message": "Replace Vote RPC to be multi-raft (#357)\n\nUse multi-raft API stated in KIP-595 on VoteRequest.\n\nReviewers: Jason Gustafson <jason@confluent.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf7e35757c716bd498c0f494947404830e005873", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/bf7e35757c716bd498c0f494947404830e005873", "committedDate": "2020-09-22T15:59:07Z", "message": "Fix compilation errors after rebasing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d78f280f7af852e27e4255d7f9437d941c63dcb", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/8d78f280f7af852e27e4255d7f9437d941c63dcb", "committedDate": "2020-09-22T15:59:07Z", "message": "Fix message generator and deprecation warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fdb728d0e861e3e5174a775e197eaf36c007598", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/9fdb728d0e861e3e5174a775e197eaf36c007598", "committedDate": "2020-09-22T15:59:07Z", "message": "Replace Begin/EndQuorum RPC with Multi-raft\n\nReplace begin/end quorum RPC with Multi-raft API, and try to simplify generated module names.\n\nReviewers: Jason Gustafson <jason@confluent.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dda5f512b3318c8246844eb36f85e904a2930c5b", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/dda5f512b3318c8246844eb36f85e904a2930c5b", "committedDate": "2020-09-22T15:59:07Z", "message": "Use Fetch API in Raft and get rid of FetchQuorumRecords (#380)\n\nDrops the FetchQuorumRecords API and replaces usages with Fetch in KafkaRaftClient and test cases."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a346cbc0af482d97a88a7bf5e342f5a2f6aa35e6", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/a346cbc0af482d97a88a7bf5e342f5a2f6aa35e6", "committedDate": "2020-09-22T15:59:08Z", "message": "Add append commit mode for perf (#367)\n\n1. Added AppendCommitMode to RecordAppender interface; keep future objects within uncommittedAppend if QUORUM mode is used and complete only after hw advanced beyond.\n2. Used another purgatory to expire uncommitted future.\n3. Some other minor fixes (comments inlined).\n\nCo-authored-by: Jason Gustafson <jason@confluent.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58ad58928565182161c56dfe304bff74d0360d17", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/58ad58928565182161c56dfe304bff74d0360d17", "committedDate": "2020-09-22T15:59:08Z", "message": "Move state machine outside of RaftClient (#377)\n\nThe purpose of this PR is to move the `ReplicatedStateMachine` interface outside of `KafkaRaftClient`. Instead of relying on the raft client to push changes into the state machine, we leave it to the state machine to read changes from the client. This takes state machine processing out of the core IO loop and allows for an \"apples to apples\" comparison with normal log replication."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92432a4fc13d1d040928c4e0ada737c445863b97", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/92432a4fc13d1d040928c4e0ada737c445863b97", "committedDate": "2020-09-22T15:59:08Z", "message": "Remove `FindQuorum` API (#390)\n\nThis PR drops the `FindQuorum` API and adds new logic to use `Fetch` for quorum discovery instead."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f856200b015f4ebeb08e6785bfa5d6061d410ad9", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/f856200b015f4ebeb08e6785bfa5d6061d410ad9", "committedDate": "2020-09-22T15:59:08Z", "message": "Refactor state/poll backoffs and timeouts (#402)\n\nThis PR attempts to improve timeout/backoff logic in the raft client. It does the following:\r\n\r\n- Split the Follower state into three separates and document all state transitions \r\n- Move fetch/election timer into respective `EpochState` implementations\r\n- Take into account backoffs when setting poll timeout\r\n- Improve test coverage of timeout behavior\r\n- Fixes various small issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acbaef071488df30c271474401cd50a6ab65ebcc", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/acbaef071488df30c271474401cd50a6ab65ebcc", "committedDate": "2020-09-22T15:59:08Z", "message": "Fix some breakage after rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7f8436ea36c3c833c3033a9fabc9a0782b6a6c0", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/b7f8436ea36c3c833c3033a9fabc9a0782b6a6c0", "committedDate": "2020-09-22T15:59:08Z", "message": "Update for upstream changes to `Fetch` response schema"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f3bd678fe1bf71fdf1d440c315b5073e8725aa8", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/5f3bd678fe1bf71fdf1d440c315b5073e8725aa8", "committedDate": "2020-09-22T15:59:08Z", "message": "Ensure raft request APIs are not exposed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aad7243d675e03874daaa38efeac90cf872d8a83", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/aad7243d675e03874daaa38efeac90cf872d8a83", "committedDate": "2020-09-22T15:59:08Z", "message": "Move scripts and such into raft subdirectory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fed23c9ad499068c4bffb6b81d7e859bfd4914d", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/1fed23c9ad499068c4bffb6b81d7e859bfd4914d", "committedDate": "2020-09-22T15:59:09Z", "message": "Use a different approach to ensure disabled APIs are not handled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b129703c50e4dd8fde91cda44ff26a0fc336ce6f", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/b129703c50e4dd8fde91cda44ff26a0fc336ce6f", "committedDate": "2020-09-22T15:59:09Z", "message": "Reduce number of simulation tests to speed up build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d48cf34f331aea3773775cc761c73f3ec0fe8c92", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/d48cf34f331aea3773775cc761c73f3ec0fe8c92", "committedDate": "2020-09-22T15:59:09Z", "message": "Fix failing tests due to disabled api keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "385f3780cd4e3bfbe43741206e705500e78783a6", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/385f3780cd4e3bfbe43741206e705500e78783a6", "committedDate": "2020-09-22T15:59:09Z", "message": "Fix test failures due to disabled Raft APIs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "385f3780cd4e3bfbe43741206e705500e78783a6", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/385f3780cd4e3bfbe43741206e705500e78783a6", "committedDate": "2020-09-22T15:59:09Z", "message": "Fix test failures due to disabled Raft APIs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1060, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}