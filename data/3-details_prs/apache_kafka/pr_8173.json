{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNDM1MjU4", "number": 8173, "title": "KAFKA-9614: Not initialize topology twice in StreamTask", "bodyText": "We only initialize topology when transiting from restoring -> running.\nAlso tighten some unit tests for this fix:\na. restoring -> suspended should just write checkpoint file without committing.\nb. suspended -> restoring should not need any inner updates.\nc. restoring -> running should always try to fetch committed offsets, and forward timeout exceptions.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-02-26T18:24:38Z", "url": "https://github.com/apache/kafka/pull/8173", "merged": true, "mergeCommit": {"oid": "dfef2a3ec2f69a5159cc6d1def3130197dba9cf9"}, "closed": true, "closedAt": "2020-02-26T22:03:17Z", "author": {"login": "guozhangwang"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIKZF2AH2gAyMzgwNDM1MjU4OjU4YzgxN2FmMTFjMmJlMzIxMzdjMjE5OWI4MTliYzJhM2EwOGNkOGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcINo-iAFqTM2NTI1NzEwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "58c817af11c2be32137c2199b819bc2a3a08cd8e", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/58c817af11c2be32137c2199b819bc2a3a08cd8e", "committedDate": "2020-02-26T17:43:56Z", "message": "first step"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e507c88ccb0196b53ddad7105bf37b1fefcd2785", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/e507c88ccb0196b53ddad7105bf37b1fefcd2785", "committedDate": "2020-02-26T17:44:04Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into KMinor-not-initialize-topology-twice"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef60891ca88d46a9f2bf6d26dfa16626420b4df9", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/ef60891ca88d46a9f2bf6d26dfa16626420b4df9", "committedDate": "2020-02-26T18:22:00Z", "message": "fix unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MTk4NTEy", "url": "https://github.com/apache/kafka/pull/8173#pullrequestreview-365198512", "createdAt": "2020-02-26T19:56:53Z", "commit": {"oid": "ef60891ca88d46a9f2bf6d26dfa16626420b4df9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MjE0ODg1", "url": "https://github.com/apache/kafka/pull/8173#pullrequestreview-365214885", "createdAt": "2020-02-26T20:22:59Z", "commit": {"oid": "ef60891ca88d46a9f2bf6d26dfa16626420b4df9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MjU3MTAz", "url": "https://github.com/apache/kafka/pull/8173#pullrequestreview-365257103", "createdAt": "2020-02-26T21:30:59Z", "commit": {"oid": "ef60891ca88d46a9f2bf6d26dfa16626420b4df9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMTozMDo1OVrOFu8_-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMTozMDo1OVrOFu8_-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc3ODIzNQ==", "bodyText": "Seems like maybe we could just get rid of the suspended state entirely, but I guess we plan to do that anyway if/when we remove support for EAGER", "url": "https://github.com/apache/kafka/pull/8173#discussion_r384778235", "createdAt": "2020-02-26T21:30:59Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -282,9 +282,8 @@ public void resume() {\n                 break;\n \n             case SUSPENDED:\n-                // just re-initilaize the topology is sufficient\n-                initializeTopology();\n-\n+                // just transit the state without any logical changes: suspended and restoring states\n+                // are not actually any different for inner modules", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef60891ca88d46a9f2bf6d26dfa16626420b4df9"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1580, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}