{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMzY4MTc1", "number": 8602, "title": "KAFKA-9947; Ensure proper shutdown of components in `TransactionsBounceTest`", "bodyText": "This test case should ensure that clients and the bounce scheduler get shutdown properly.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-05-02T00:09:24Z", "url": "https://github.com/apache/kafka/pull/8602", "merged": true, "mergeCommit": {"oid": "849b65a13a2587044e965d755c820c78590af51a"}, "closed": true, "closedAt": "2020-05-06T22:22:59Z", "author": {"login": "hachikuji"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcdK1rXAH2gAyNDEyMzY4MTc1OjAyMDU5NjhhOGEyNWMwZjUxYzMzYmNlYTRhOWZkOTlhMjA4YWI1ODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcetw2rAH2gAyNDEyMzY4MTc1OjYwMTViYzBmYjA3NWNkMTVhNzhmMDBkZDFjMWYyM2JkMDY1NGZjZmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0205968a8a25c0f51c33bcea4a9fd99a208ab589", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/0205968a8a25c0f51c33bcea4a9fd99a208ab589", "committedDate": "2020-05-02T00:07:34Z", "message": "KAFKA-9947; Ensure proper shutdown of components in `TransactionsBounceTest`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "740dbb0fb893ef1fa3da5e86fe13f7f547671146", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/740dbb0fb893ef1fa3da5e86fe13f7f547671146", "committedDate": "2020-05-02T01:17:07Z", "message": "Fix compilation issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjU3NzIy", "url": "https://github.com/apache/kafka/pull/8602#pullrequestreview-404657722", "createdAt": "2020-05-03T21:09:28Z", "commit": {"oid": "740dbb0fb893ef1fa3da5e86fe13f7f547671146"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMTowOToyOFrOGPviKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMTowOToyOFrOGPviKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MDYxNw==", "bodyText": "We are now relying on the lifecycle methods to close the producer and consumer. Did you do that to simplify the code, i.e. it has no impact on the behavior of the test?", "url": "https://github.com/apache/kafka/pull/8602#discussion_r419160617", "createdAt": "2020-05-03T21:09:28Z", "author": {"login": "ijuma"}, "path": "core/src/test/scala/integration/kafka/api/TransactionsBounceTest.scala", "diffHunk": "@@ -130,13 +129,10 @@ class TransactionsBounceTest extends KafkaServerTestHarness {\n         iteration += 1\n       }\n     } finally {\n-      producer.close()\n-      consumer.close()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "740dbb0fb893ef1fa3da5e86fe13f7f547671146"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2ODA0OTU1", "url": "https://github.com/apache/kafka/pull/8602#pullrequestreview-406804955", "createdAt": "2020-05-06T16:53:52Z", "commit": {"oid": "740dbb0fb893ef1fa3da5e86fe13f7f547671146"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNjo1Mzo1MlrOGRcTUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNjo1Mzo1MlrOGRcTUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk0MjY3Mg==", "bodyText": "I was checking the difference between what we do now and before and noticed that we have this line in the helper method we were using previously:\n\nprops.put(ProducerConfig.REQUEST_TIMEOUT_MS_CONFIG, deliveryTimeoutMs.toString)\n\nThat seems a bit questionable. Should we remove it from that method?", "url": "https://github.com/apache/kafka/pull/8602#discussion_r420942672", "createdAt": "2020-05-06T16:53:52Z", "author": {"login": "ijuma"}, "path": "core/src/test/scala/integration/kafka/api/TransactionsBounceTest.scala", "diffHunk": "@@ -156,17 +152,26 @@ class TransactionsBounceTest extends KafkaServerTestHarness {\n \n     val expectedValues = (0 until numInputRecords).toSet\n     assertEquals(s\"Missing messages: ${expectedValues -- recordSet}\", expectedValues, recordSet)\n+  }\n \n-    verifyingConsumer.close()\n+  private def createTransactionalProducer(transactionalId: String) = {\n+    val props = new Properties()\n+    props.put(ProducerConfig.ACKS_CONFIG, \"all\")\n+    props.put(ProducerConfig.BATCH_SIZE_CONFIG, \"512\")\n+    props.put(ProducerConfig.TRANSACTIONAL_ID_CONFIG, transactionalId)\n+    props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, \"true\")\n+    createProducer(configOverrides = props)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "740dbb0fb893ef1fa3da5e86fe13f7f547671146"}, "originalPosition": 102}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec883189a86bcf5234926a235b92cd4279d65549", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/ec883189a86bcf5234926a235b92cd4279d65549", "committedDate": "2020-05-06T17:10:29Z", "message": "Use separate requestTimeout parameter in createTransactionalProducer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2ODI3NDUy", "url": "https://github.com/apache/kafka/pull/8602#pullrequestreview-406827452", "createdAt": "2020-05-06T17:21:53Z", "commit": {"oid": "ec883189a86bcf5234926a235b92cd4279d65549"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6015bc0fb075cd15a78f00dd1c1f23bd0654fcfa", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/6015bc0fb075cd15a78f00dd1c1f23bd0654fcfa", "committedDate": "2020-05-06T19:22:54Z", "message": "Use request timeout consistent with delivery timeout"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1322, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}