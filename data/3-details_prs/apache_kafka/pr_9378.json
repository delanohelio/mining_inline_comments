{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MTk5MzU2", "number": 9378, "title": "MINOR: ACLs for secured cluster system tests", "bodyText": "This PR adds missing broker ACLs required to create topics and SCRAM credentials when ACLs are enabled for a system test.   These ACLs were missed for system tests in the PR for KAFKA-10131 (#9274).  This PR also adds support for using PLAINTEXT as the inter broker security protocol when using SCRAM from the client in a system test with a secured cluster-- without this it would always be necessary to set both the inter-broker and client mechanisms to a SCRAM mechanism.", "createdAt": "2020-10-06T00:58:47Z", "url": "https://github.com/apache/kafka/pull/9378", "merged": true, "mergeCommit": {"oid": "147a19036ee4bce9091575f23e1338527c618290"}, "closed": true, "closedAt": "2020-10-09T14:34:53Z", "author": {"login": "rondagostino"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP69zfAFqTUwMzE0MjEwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQ1oXegH2gAyNDk4MTk5MzU2OmE3MmQ1OTg2ZGRlZTVlMTQ3ZWU5Y2QxNjRlZDBkM2NmZjY3ZWU0MDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTQyMTAy", "url": "https://github.com/apache/kafka/pull/9378#pullrequestreview-503142102", "createdAt": "2020-10-06T16:19:49Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjoxOTo1MFrOHdPyQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjoyNDo1NFrOHdP_xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQyOTM3Nw==", "bodyText": "should we add a method to KafkaService or SecurityConfig that tells you which listener to use for tools? Using inter-broker here looks a bit odd, even though it becomes clear when you look at the other changes.", "url": "https://github.com/apache/kafka/pull/9378#discussion_r500429377", "createdAt": "2020-10-06T16:19:50Z", "author": {"login": "rajinisivaram"}, "path": "tests/kafkatest/services/kafka/kafka.py", "diffHunk": "@@ -451,7 +451,8 @@ def _kafka_topics_cmd(self, node, force_use_zk_connection):\n         set. If Admin client is not going to be used, don't set the environment variable.\n         \"\"\"\n         kafka_topic_script = self.path.script(\"kafka-topics.sh\", node)\n-        skip_security_settings = force_use_zk_connection or not self.all_nodes_topic_command_supports_bootstrap_server()\n+        skip_security_settings = force_use_zk_connection or not self.all_nodes_topic_command_supports_bootstrap_server() \\\n+                                 or self.interbroker_security_protocol == SecurityConfig.PLAINTEXT", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzMTAyOA==", "bodyText": "Is this assuming that else section always means PLAINTEXT since there are no security configs here?", "url": "https://github.com/apache/kafka/pull/9378#discussion_r500431028", "createdAt": "2020-10-06T16:22:11Z", "author": {"login": "rajinisivaram"}, "path": "tests/kafkatest/services/kafka/kafka.py", "diffHunk": "@@ -983,7 +988,10 @@ def _topic_command_connect_setting(self, node, force_use_zk_connection):\n         bootstrap server, otherwise returns zookeeper connection string.\n         \"\"\"\n         if not force_use_zk_connection and self.all_nodes_topic_command_supports_bootstrap_server():\n-            connection_setting = \"--bootstrap-server %s\" % (self.bootstrap_servers(self.security_protocol))\n+            if self.interbroker_security_protocol == SecurityConfig.PLAINTEXT:\n+                connection_setting = \"--bootstrap-server %s\" % (self.bootstrap_servers(self.interbroker_security_protocol))\n+            else:\n+                connection_setting = \"--bootstrap-server %s\" % (self.bootstrap_servers(self.security_protocol))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzMjgzNg==", "bodyText": "we are adding more ACLs than we had before. Are they necessary - it is better to limit ACLs unless they are necessary for the tests.", "url": "https://github.com/apache/kafka/pull/9378#discussion_r500432836", "createdAt": "2020-10-06T16:24:54Z", "author": {"login": "rajinisivaram"}, "path": "tests/kafkatest/services/security/kafka_acls.py", "diffHunk": "@@ -93,11 +97,13 @@ def add_cluster_acl(self, kafka, principal, force_use_zk_connection=False):\n \n         force_use_zk_connection = force_use_zk_connection or not kafka.all_nodes_acl_command_supports_bootstrap_server()\n \n-        cmd = \"%(cmd_prefix)s --add --cluster --operation=ClusterAction --allow-principal=%(principal)s\" % {\n-            'cmd_prefix': self._acl_cmd_prefix(kafka, node, force_use_zk_connection),\n-            'principal': principal\n-        }\n-        kafka.run_cli_tool(node, cmd)\n+        for operation in ['ClusterAction', 'Alter', 'Create']:", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MTIwNjEx", "url": "https://github.com/apache/kafka/pull/9378#pullrequestreview-504120611", "createdAt": "2020-10-07T17:42:46Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d721c1211b4f7004a5021713932319587084b7ba", "author": {"user": {"login": "rondagostino", "name": "Ron Dagostino"}}, "url": "https://github.com/apache/kafka/commit/d721c1211b4f7004a5021713932319587084b7ba", "committedDate": "2020-10-08T13:01:28Z", "message": "MINOR: system test ACLs and PLAINTEXT for SCRAM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ada90d368ad014856a3ee4fc6fefe88b2db5b138", "author": {"user": {"login": "rondagostino", "name": "Ron Dagostino"}}, "url": "https://github.com/apache/kafka/commit/ada90d368ad014856a3ee4fc6fefe88b2db5b138", "committedDate": "2020-10-08T13:01:29Z", "message": "refactor/consolidate based on review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a43bc7eb7fa31a60fcfb1ac2e5915bf00d4828d8", "author": {"user": {"login": "rondagostino", "name": "Ron Dagostino"}}, "url": "https://github.com/apache/kafka/commit/a43bc7eb7fa31a60fcfb1ac2e5915bf00d4828d8", "committedDate": "2020-10-08T13:01:30Z", "message": "fix export error, port selection"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "a43bc7eb7fa31a60fcfb1ac2e5915bf00d4828d8", "author": {"user": {"login": "rondagostino", "name": "Ron Dagostino"}}, "url": "https://github.com/apache/kafka/commit/a43bc7eb7fa31a60fcfb1ac2e5915bf00d4828d8", "committedDate": "2020-10-08T13:01:30Z", "message": "fix export error, port selection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ca559f83424a93ce8ab9469b9427213983c2bb2", "author": {"user": {"login": "rondagostino", "name": "Ron Dagostino"}}, "url": "https://github.com/apache/kafka/commit/8ca559f83424a93ce8ab9469b9427213983c2bb2", "committedDate": "2020-10-08T20:20:39Z", "message": "Fix for non-SCRAM as inter-broker-mechanism"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a72d5986ddee5e147ee9cd164ed0d3cff67ee403", "author": {"user": {"login": "rondagostino", "name": "Ron Dagostino"}}, "url": "https://github.com/apache/kafka/commit/a72d5986ddee5e147ee9cd164ed0d3cff67ee403", "committedDate": "2020-10-09T12:49:05Z", "message": "fix ZooKeeperSecurityUpgradeTest"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 444, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}