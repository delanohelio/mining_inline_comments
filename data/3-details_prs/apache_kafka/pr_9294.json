{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MjQ5MDE2", "number": 9294, "title": "MINOR: Fix now that kafka.apache.org resolves to 3 IP addresses", "bodyText": "ClusterConnectStatesTest and ClientUtilsTest were failing because they expected kafka.apache.org to resolve to 2 IP addresses. This updates the tests so they reflect that DNS resolves to 3 addresses.", "createdAt": "2020-09-16T21:14:36Z", "url": "https://github.com/apache/kafka/pull/9294", "merged": true, "mergeCommit": {"oid": "1443f24ace98aac9e15f5ec8178040f848ff3d74"}, "closed": true, "closedAt": "2020-09-17T20:44:44Z", "author": {"login": "jolshan"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJjBsigH2gAyNDg4MjQ5MDE2OmNkNDkyODg3NzFjM2RkYmRkNDRlYjY4MjRhNmViYWM1Mjc3NWMwMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJ3MxcgFqTQ5MDk3MzExNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cd49288771c3ddbdd44eb6824a6ebac52775c034", "author": {"user": {"login": "jolshan", "name": "Justine Olshan"}}, "url": "https://github.com/apache/kafka/commit/cd49288771c3ddbdd44eb6824a6ebac52775c034", "committedDate": "2020-09-16T21:11:05Z", "message": "Fix now that kafka.apache.org resolves to 3 IP addresses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMDkwNTMw", "url": "https://github.com/apache/kafka/pull/9294#pullrequestreview-490090530", "createdAt": "2020-09-16T23:46:14Z", "commit": {"oid": "cd49288771c3ddbdd44eb6824a6ebac52775c034"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac97f2b37836493aa398d15f0be72ed1f244bbbc", "author": {"user": {"login": "jolshan", "name": "Justine Olshan"}}, "url": "https://github.com/apache/kafka/commit/ac97f2b37836493aa398d15f0be72ed1f244bbbc", "committedDate": "2020-09-17T15:37:09Z", "message": "Changed to assert the number of addresses is greater than 1."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwODA3MTU1", "url": "https://github.com/apache/kafka/pull/9294#pullrequestreview-490807155", "createdAt": "2020-09-17T16:58:53Z", "commit": {"oid": "ac97f2b37836493aa398d15f0be72ed1f244bbbc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNjo1ODo1M1rOHTsskw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNjo1OTozM1rOHTsuFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQxNzI5OQ==", "bodyText": "Comment here and below refer to 2 IP addresses still.", "url": "https://github.com/apache/kafka/pull/9294#discussion_r490417299", "createdAt": "2020-09-17T16:58:53Z", "author": {"login": "mumrah"}, "path": "clients/src/test/java/org/apache/kafka/clients/ClientUtilsTest.java", "diffHunk": "@@ -102,20 +102,20 @@ public void testResolveUnknownHostException() throws UnknownHostException {\n \n     @Test\n     public void testResolveDnsLookup() throws UnknownHostException {\n-        // Note that kafka.apache.org resolves to 2 IP addresses\n+        // Note that kafka.apache.org resolves to at least 2 IP addresses", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac97f2b37836493aa398d15f0be72ed1f244bbbc"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQxNzY4NQ==", "bodyText": "Hmm, so previously (and also with this change) we are assuming that we will get different resolved IPs for each connection to apache.kafka.org? This seems to rely on round-robbin DNS resolution that we can't really control. I think these assertions will always be prone to failure unless we can control the DNS server like @dajac suggested.\nI guess we can commit this to unblock the tests, but we should definitely prioritize a better fix.", "url": "https://github.com/apache/kafka/pull/9294#discussion_r490417685", "createdAt": "2020-09-17T16:59:33Z", "author": {"login": "mumrah"}, "path": "clients/src/test/java/org/apache/kafka/clients/ClusterConnectionStatesTest.java", "diffHunk": "@@ -273,22 +273,21 @@ public void testMultipleIPsWithDefault() throws UnknownHostException {\n \n     @Test\n     public void testMultipleIPsWithUseAll() throws UnknownHostException {\n-        assertEquals(2, ClientUtils.resolve(hostTwoIps, ClientDnsLookup.USE_ALL_DNS_IPS).size());\n+        assertTrue(ClientUtils.resolve(hostTwoIps, ClientDnsLookup.USE_ALL_DNS_IPS).size() > 1);\n \n         connectionStates.connecting(nodeId1, time.milliseconds(), hostTwoIps, ClientDnsLookup.USE_ALL_DNS_IPS);\n         InetAddress addr1 = connectionStates.currentAddress(nodeId1);\n         connectionStates.connecting(nodeId1, time.milliseconds(), hostTwoIps, ClientDnsLookup.USE_ALL_DNS_IPS);\n         InetAddress addr2 = connectionStates.currentAddress(nodeId1);\n         assertNotSame(addr1, addr2);\n-\n         connectionStates.connecting(nodeId1, time.milliseconds(), hostTwoIps, ClientDnsLookup.USE_ALL_DNS_IPS);\n         InetAddress addr3 = connectionStates.currentAddress(nodeId1);\n-        assertSame(addr1, addr3);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac97f2b37836493aa398d15f0be72ed1f244bbbc"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwOTczMTE2", "url": "https://github.com/apache/kafka/pull/9294#pullrequestreview-490973116", "createdAt": "2020-09-17T20:41:17Z", "commit": {"oid": "ac97f2b37836493aa398d15f0be72ed1f244bbbc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 628, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}