{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MjM2MTUx", "number": 8738, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNDoxMzowNFrOEAWm1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMjoxMzozM1rOEAsYiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODA1ODQ0OnYy", "diffSide": "LEFT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/InternalTopicManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNDoxMzowNFrOGblBMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNDoxMzowNFrOGblBMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3MTI1MA==", "bodyText": "Moved to ClientUtil", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431571250", "createdAt": "2020-05-28T04:13:04Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/InternalTopicManager.java", "diffHunk": "@@ -44,12 +45,6 @@\n     private final static String INTERRUPTED_ERROR_MESSAGE = \"Thread got interrupted. This indicates a bug. \" +\n         \"Please report at https://issues.apache.org/jira/projects/KAFKA or dev-mailing list (https://kafka.apache.org/contact).\";\n \n-    private static final class InternalAdminClientConfig extends AdminClientConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "702187a4518c2dc29a6123a89be14475c3617ecb"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODA2MjgwOnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwNDoxNjowOFrOGblD6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNzo0NDo0N1rOGcAABw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3MTk0Nw==", "bodyText": "This is neither relevant to this PR nor required for correctness, but I noticed the log message above tends to spam the logs in some tests. Since this gets set/reset at the end of every rebalance, we may as well reset it here to avoid an avalanche of Triggering the followup rebalance...", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431571947", "createdAt": "2020-05-28T04:16:08Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -551,6 +551,7 @@ void runLoop() {\n                 if (nextProbingRebalanceMs.get() < time.milliseconds()) {\n                     log.info(\"Triggering the followup rebalance scheduled for {} ms.\", nextProbingRebalanceMs.get());\n                     mainConsumer.enforceRebalance();\n+                    nextProbingRebalanceMs.set(Long.MAX_VALUE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "702187a4518c2dc29a6123a89be14475c3617ecb"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAwOTM3MQ==", "bodyText": "enforceRebalance is guaranteed not to actually run the assignment logic, right? That will only run during a call to poll, I'm hoping. Otherwise, this line should go before the call.", "url": "https://github.com/apache/kafka/pull/8738#discussion_r432009371", "createdAt": "2020-05-28T17:37:37Z", "author": {"login": "vvcephei"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -551,6 +551,7 @@ void runLoop() {\n                 if (nextProbingRebalanceMs.get() < time.milliseconds()) {\n                     log.info(\"Triggering the followup rebalance scheduled for {} ms.\", nextProbingRebalanceMs.get());\n                     mainConsumer.enforceRebalance();\n+                    nextProbingRebalanceMs.set(Long.MAX_VALUE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3MTk0Nw=="}, "originalCommit": {"oid": "702187a4518c2dc29a6123a89be14475c3617ecb"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxMzMxOQ==", "bodyText": "Yep. It just provides a notice to the consumer to enforce that a rebalance will occur on the next poll", "url": "https://github.com/apache/kafka/pull/8738#discussion_r432013319", "createdAt": "2020-05-28T17:44:47Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -551,6 +551,7 @@ void runLoop() {\n                 if (nextProbingRebalanceMs.get() < time.milliseconds()) {\n                     log.info(\"Triggering the followup rebalance scheduled for {} ms.\", nextProbingRebalanceMs.get());\n                     mainConsumer.enforceRebalance();\n+                    nextProbingRebalanceMs.set(Long.MAX_VALUE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3MTk0Nw=="}, "originalCommit": {"oid": "702187a4518c2dc29a6123a89be14475c3617ecb"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4ODk4NDMxOnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ClientUtils.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMDowMTowOFrOGbuNJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjo0MTo0MFrOGb9uYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyMTc2NQ==", "bodyText": "It seems to me Duration is more readable than long. Is there a reason to make this change?", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431721765", "createdAt": "2020-05-28T10:01:08Z", "author": {"login": "chia7712"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ClientUtils.java", "diffHunk": "@@ -90,24 +96,21 @@ public static String getTaskProducerClientId(final String threadClientId, final\n         return result;\n     }\n \n-    public static Map<TopicPartition, ListOffsetsResultInfo> fetchEndOffsetsWithoutTimeout(final Collection<TopicPartition> partitions,\n-                                                                                           final Admin adminClient) {\n-        return fetchEndOffsets(partitions, adminClient, null);\n+    public static int getAdminDefaultApiTimeoutMs(final StreamsConfig streamsConfig) {\n+        final InternalAdminClientConfig dummyAdmin = new InternalAdminClientConfig(streamsConfig.getAdminConfigs(\"dummy\"));\n+        return dummyAdmin.getInt(AdminClientConfig.DEFAULT_API_TIMEOUT_MS_CONFIG);\n     }\n \n     public static Map<TopicPartition, ListOffsetsResultInfo> fetchEndOffsets(final Collection<TopicPartition> partitions,\n                                                                              final Admin adminClient,\n-                                                                             final Duration timeout) {\n+                                                                             final long timeoutMs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2ODU1OQ==", "bodyText": "I think it's because we're now also calling it right after calling getAdminDefaultApiTimeoutMs, so it seems a bummer to create a Duration from millis and then immediately convert it back to millis.", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431968559", "createdAt": "2020-05-28T16:29:19Z", "author": {"login": "vvcephei"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ClientUtils.java", "diffHunk": "@@ -90,24 +96,21 @@ public static String getTaskProducerClientId(final String threadClientId, final\n         return result;\n     }\n \n-    public static Map<TopicPartition, ListOffsetsResultInfo> fetchEndOffsetsWithoutTimeout(final Collection<TopicPartition> partitions,\n-                                                                                           final Admin adminClient) {\n-        return fetchEndOffsets(partitions, adminClient, null);\n+    public static int getAdminDefaultApiTimeoutMs(final StreamsConfig streamsConfig) {\n+        final InternalAdminClientConfig dummyAdmin = new InternalAdminClientConfig(streamsConfig.getAdminConfigs(\"dummy\"));\n+        return dummyAdmin.getInt(AdminClientConfig.DEFAULT_API_TIMEOUT_MS_CONFIG);\n     }\n \n     public static Map<TopicPartition, ListOffsetsResultInfo> fetchEndOffsets(final Collection<TopicPartition> partitions,\n                                                                              final Admin adminClient,\n-                                                                             final Duration timeout) {\n+                                                                             final long timeoutMs) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyMTc2NQ=="}, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3NjAzMw==", "bodyText": "Yep", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431976033", "createdAt": "2020-05-28T16:41:40Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ClientUtils.java", "diffHunk": "@@ -90,24 +96,21 @@ public static String getTaskProducerClientId(final String threadClientId, final\n         return result;\n     }\n \n-    public static Map<TopicPartition, ListOffsetsResultInfo> fetchEndOffsetsWithoutTimeout(final Collection<TopicPartition> partitions,\n-                                                                                           final Admin adminClient) {\n-        return fetchEndOffsets(partitions, adminClient, null);\n+    public static int getAdminDefaultApiTimeoutMs(final StreamsConfig streamsConfig) {\n+        final InternalAdminClientConfig dummyAdmin = new InternalAdminClientConfig(streamsConfig.getAdminConfigs(\"dummy\"));\n+        return dummyAdmin.getInt(AdminClientConfig.DEFAULT_API_TIMEOUT_MS_CONFIG);\n     }\n \n     public static Map<TopicPartition, ListOffsetsResultInfo> fetchEndOffsets(final Collection<TopicPartition> partitions,\n                                                                              final Admin adminClient,\n-                                                                             final Duration timeout) {\n+                                                                             final long timeoutMs) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyMTc2NQ=="}, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4OTAwMTAxOnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/KafkaStreams.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMDowNjowNFrOGbuX0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMTowNjo1MVrOGcGvMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyNDQ5Nw==", "bodyText": "The admin configs is built in KafkaStreams construction. Could we reuse it?\n        adminClient = clientSupplier.getAdmin(config.getAdminConfigs(ClientUtils.getSharedAdminClientId(clientId)));", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431724497", "createdAt": "2020-05-28T10:06:04Z", "author": {"login": "chia7712"}, "path": "streams/src/main/java/org/apache/kafka/streams/KafkaStreams.java", "diffHunk": "@@ -1246,7 +1247,12 @@ public void cleanUp() {\n         }\n \n         log.debug(\"Current changelog positions: {}\", allChangelogPositions);\n-        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets = fetchEndOffsetsWithoutTimeout(allPartitions, adminClient);\n+        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets =\n+            fetchEndOffsets(\n+                allPartitions,\n+                adminClient,\n+                getAdminDefaultApiTimeoutMs(config)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4NDgxNw==", "bodyText": "I did it this way since we need to get the admin's default.api.timeout in other places where we only have the streamsConfig, so we may as well just pass that as the argument to getAdminDefaultApiTimeoutMs", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431984817", "createdAt": "2020-05-28T16:56:32Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/KafkaStreams.java", "diffHunk": "@@ -1246,7 +1247,12 @@ public void cleanUp() {\n         }\n \n         log.debug(\"Current changelog positions: {}\", allChangelogPositions);\n-        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets = fetchEndOffsetsWithoutTimeout(allPartitions, adminClient);\n+        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets =\n+            fetchEndOffsets(\n+                allPartitions,\n+                adminClient,\n+                getAdminDefaultApiTimeoutMs(config)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyNDQ5Nw=="}, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEyMzM2MQ==", "bodyText": "We should update the JavaDocs that this method may throw a TimeoutException now. What make we wondering if this is a public API change? Was there any discussion on the original KIP about the behavior of allLocalStorePartitionLags ?", "url": "https://github.com/apache/kafka/pull/8738#discussion_r432123361", "createdAt": "2020-05-28T21:06:09Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/KafkaStreams.java", "diffHunk": "@@ -1246,7 +1247,12 @@ public void cleanUp() {\n         }\n \n         log.debug(\"Current changelog positions: {}\", allChangelogPositions);\n-        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets = fetchEndOffsetsWithoutTimeout(allPartitions, adminClient);\n+        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets =\n+            fetchEndOffsets(\n+                allPartitions,\n+                adminClient,\n+                getAdminDefaultApiTimeoutMs(config)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyNDQ5Nw=="}, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEyMzY5Nw==", "bodyText": "This change might require a KIP... \\cc @vvcephei @guozhangwang WDYT?", "url": "https://github.com/apache/kafka/pull/8738#discussion_r432123697", "createdAt": "2020-05-28T21:06:51Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/KafkaStreams.java", "diffHunk": "@@ -1246,7 +1247,12 @@ public void cleanUp() {\n         }\n \n         log.debug(\"Current changelog positions: {}\", allChangelogPositions);\n-        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets = fetchEndOffsetsWithoutTimeout(allPartitions, adminClient);\n+        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets =\n+            fetchEndOffsets(\n+                allPartitions,\n+                adminClient,\n+                getAdminDefaultApiTimeoutMs(config)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyNDQ5Nw=="}, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4OTAwNjM0OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ClientUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMDowNzo0MVrOGbubJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjo1Njo0M1rOGb-RKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyNTM1MQ==", "bodyText": "Could you add comment for the \"dummy\"?", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431725351", "createdAt": "2020-05-28T10:07:41Z", "author": {"login": "chia7712"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ClientUtils.java", "diffHunk": "@@ -90,24 +96,21 @@ public static String getTaskProducerClientId(final String threadClientId, final\n         return result;\n     }\n \n-    public static Map<TopicPartition, ListOffsetsResultInfo> fetchEndOffsetsWithoutTimeout(final Collection<TopicPartition> partitions,\n-                                                                                           final Admin adminClient) {\n-        return fetchEndOffsets(partitions, adminClient, null);\n+    public static int getAdminDefaultApiTimeoutMs(final StreamsConfig streamsConfig) {\n+        final InternalAdminClientConfig dummyAdmin = new InternalAdminClientConfig(streamsConfig.getAdminConfigs(\"dummy\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4NDkzNw==", "bodyText": "Ack", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431984937", "createdAt": "2020-05-28T16:56:43Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ClientUtils.java", "diffHunk": "@@ -90,24 +96,21 @@ public static String getTaskProducerClientId(final String threadClientId, final\n         return result;\n     }\n \n-    public static Map<TopicPartition, ListOffsetsResultInfo> fetchEndOffsetsWithoutTimeout(final Collection<TopicPartition> partitions,\n-                                                                                           final Admin adminClient) {\n-        return fetchEndOffsets(partitions, adminClient, null);\n+    public static int getAdminDefaultApiTimeoutMs(final StreamsConfig streamsConfig) {\n+        final InternalAdminClientConfig dummyAdmin = new InternalAdminClientConfig(streamsConfig.getAdminConfigs(\"dummy\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyNTM1MQ=="}, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MDQ3OTU1OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ClientUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjoyNTo1MFrOGb9Ijg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjozOTo0OVrOGb9pzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2NjM1MA==", "bodyText": "How about QuietAdminClientConfig, like QuietStreamsConfig?", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431966350", "createdAt": "2020-05-28T16:25:50Z", "author": {"login": "vvcephei"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ClientUtils.java", "diffHunk": "@@ -40,9 +41,14 @@\n import org.slf4j.LoggerFactory;\n \n public class ClientUtils {\n-\n     private static final Logger LOG = LoggerFactory.getLogger(ClientUtils.class);\n \n+    static final class InternalAdminClientConfig extends AdminClientConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3NDg2Mg==", "bodyText": "Good call", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431974862", "createdAt": "2020-05-28T16:39:49Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ClientUtils.java", "diffHunk": "@@ -40,9 +41,14 @@\n import org.slf4j.LoggerFactory;\n \n public class ClientUtils {\n-\n     private static final Logger LOG = LoggerFactory.getLogger(ClientUtils.class);\n \n+    static final class InternalAdminClientConfig extends AdminClientConfig {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2NjM1MA=="}, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MDUwNjA4OnYy", "diffSide": "RIGHT", "path": "streams/src/test/java/org/apache/kafka/streams/integration/TaskAssignorIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjozMjo0MlrOGb9ZbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNzozMTo1N1rOGb_kog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3MDY2OQ==", "bodyText": "Just curious, why the change from 9 to 90,000?", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431970669", "createdAt": "2020-05-28T16:32:42Z", "author": {"login": "vvcephei"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/TaskAssignorIntegrationTest.java", "diffHunk": "@@ -89,7 +89,7 @@ public void shouldProperlyConfigureTheAssignor() throws NoSuchFieldException, Il\n                 mkEntry(StreamsConfig.MAX_WARMUP_REPLICAS_CONFIG, \"7\"),\n                 mkEntry(StreamsConfig.PROBING_REBALANCE_INTERVAL_MS_CONFIG, \"480000\"),\n                 mkEntry(StreamsConfig.InternalConfig.ASSIGNMENT_LISTENER, configuredAssignmentListener),\n-                mkEntry(AdminClientConfig.REQUEST_TIMEOUT_MS_CONFIG, 9)\n+                mkEntry(AdminClientConfig.DEFAULT_API_TIMEOUT_MS_CONFIG, 90_000)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3NDY3OQ==", "bodyText": "For fun", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431974679", "createdAt": "2020-05-28T16:39:29Z", "author": {"login": "ableegoldman"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/TaskAssignorIntegrationTest.java", "diffHunk": "@@ -89,7 +89,7 @@ public void shouldProperlyConfigureTheAssignor() throws NoSuchFieldException, Il\n                 mkEntry(StreamsConfig.MAX_WARMUP_REPLICAS_CONFIG, \"7\"),\n                 mkEntry(StreamsConfig.PROBING_REBALANCE_INTERVAL_MS_CONFIG, \"480000\"),\n                 mkEntry(StreamsConfig.InternalConfig.ASSIGNMENT_LISTENER, configuredAssignmentListener),\n-                mkEntry(AdminClientConfig.REQUEST_TIMEOUT_MS_CONFIG, 9)\n+                mkEntry(AdminClientConfig.DEFAULT_API_TIMEOUT_MS_CONFIG, 90_000)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3MDY2OQ=="}, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3NDcxNQ==", "bodyText": "I mean, because the value has to be larger than the request.timeout.ms which defaults to 30,000", "url": "https://github.com/apache/kafka/pull/8738#discussion_r431974715", "createdAt": "2020-05-28T16:39:33Z", "author": {"login": "ableegoldman"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/TaskAssignorIntegrationTest.java", "diffHunk": "@@ -89,7 +89,7 @@ public void shouldProperlyConfigureTheAssignor() throws NoSuchFieldException, Il\n                 mkEntry(StreamsConfig.MAX_WARMUP_REPLICAS_CONFIG, \"7\"),\n                 mkEntry(StreamsConfig.PROBING_REBALANCE_INTERVAL_MS_CONFIG, \"480000\"),\n                 mkEntry(StreamsConfig.InternalConfig.ASSIGNMENT_LISTENER, configuredAssignmentListener),\n-                mkEntry(AdminClientConfig.REQUEST_TIMEOUT_MS_CONFIG, 9)\n+                mkEntry(AdminClientConfig.DEFAULT_API_TIMEOUT_MS_CONFIG, 90_000)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3MDY2OQ=="}, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAwNjMwNg==", "bodyText": "Ah, thanks.", "url": "https://github.com/apache/kafka/pull/8738#discussion_r432006306", "createdAt": "2020-05-28T17:31:57Z", "author": {"login": "vvcephei"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/TaskAssignorIntegrationTest.java", "diffHunk": "@@ -89,7 +89,7 @@ public void shouldProperlyConfigureTheAssignor() throws NoSuchFieldException, Il\n                 mkEntry(StreamsConfig.MAX_WARMUP_REPLICAS_CONFIG, \"7\"),\n                 mkEntry(StreamsConfig.PROBING_REBALANCE_INTERVAL_MS_CONFIG, \"480000\"),\n                 mkEntry(StreamsConfig.InternalConfig.ASSIGNMENT_LISTENER, configuredAssignmentListener),\n-                mkEntry(AdminClientConfig.REQUEST_TIMEOUT_MS_CONFIG, 9)\n+                mkEntry(AdminClientConfig.DEFAULT_API_TIMEOUT_MS_CONFIG, 90_000)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk3MDY2OQ=="}, "originalCommit": {"oid": "8b5766a45520aff27623d6df4ad33048444784e7"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MTQyMzMwOnYy", "diffSide": "RIGHT", "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/ClientUtilsTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMTowMTo1MVrOGcGlqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMTowMTo1MVrOGcGlqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEyMTI1OA==", "bodyText": "Should we pass in MAX_VALUE to avoid introducing test flakyness?", "url": "https://github.com/apache/kafka/pull/8738#discussion_r432121258", "createdAt": "2020-05-28T21:01:51Z", "author": {"login": "mjsax"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/ClientUtilsTest.java", "diffHunk": "@@ -45,42 +50,42 @@ public void fetchEndOffsetsShouldRethrowRuntimeExceptionAsStreamsException() {\n         final Admin adminClient = EasyMock.createMock(AdminClient.class);\n         EasyMock.expect(adminClient.listOffsets(EasyMock.anyObject())).andThrow(new RuntimeException());\n         replay(adminClient);\n-        assertThrows(StreamsException.class, () ->  fetchEndOffsetsWithoutTimeout(emptyList(), adminClient));\n+        assertThrows(StreamsException.class, () ->  fetchEndOffsets(emptyList(), adminClient, 60_000L));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c55e557223324208e782a23a196aa95c98fd8402"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MTQyNTgyOnYy", "diffSide": "RIGHT", "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/ClientUtilsTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMTowMjo0M1rOGcGnNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMTowMjo0M1rOGcGnNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEyMTY1NQ==", "bodyText": "As above (also below)\nAlso nit: 60_000L (if just 60 and TimeUnit.SECONDS?)", "url": "https://github.com/apache/kafka/pull/8738#discussion_r432121655", "createdAt": "2020-05-28T21:02:43Z", "author": {"login": "mjsax"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/ClientUtilsTest.java", "diffHunk": "@@ -45,42 +50,42 @@ public void fetchEndOffsetsShouldRethrowRuntimeExceptionAsStreamsException() {\n         final Admin adminClient = EasyMock.createMock(AdminClient.class);\n         EasyMock.expect(adminClient.listOffsets(EasyMock.anyObject())).andThrow(new RuntimeException());\n         replay(adminClient);\n-        assertThrows(StreamsException.class, () ->  fetchEndOffsetsWithoutTimeout(emptyList(), adminClient));\n+        assertThrows(StreamsException.class, () ->  fetchEndOffsets(emptyList(), adminClient, 60_000L));\n         verify(adminClient);\n     }\n \n     @Test\n-    public void fetchEndOffsetsShouldRethrowInterruptedExceptionAsStreamsException() throws InterruptedException, ExecutionException {\n+    public void fetchEndOffsetsShouldRethrowInterruptedExceptionAsStreamsException() throws Exception {\n         final Admin adminClient = EasyMock.createMock(AdminClient.class);\n         final ListOffsetsResult result = EasyMock.createNiceMock(ListOffsetsResult.class);\n         final KafkaFuture<Map<TopicPartition, ListOffsetsResultInfo>> allFuture = EasyMock.createMock(KafkaFuture.class);\n \n         EasyMock.expect(adminClient.listOffsets(EasyMock.anyObject())).andStubReturn(result);\n         EasyMock.expect(result.all()).andStubReturn(allFuture);\n-        EasyMock.expect(allFuture.get()).andThrow(new InterruptedException());\n+        EasyMock.expect(allFuture.get(60000L, TimeUnit.MILLISECONDS)).andThrow(new InterruptedException());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c55e557223324208e782a23a196aa95c98fd8402"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MTYyNjMzOnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/KafkaStreams.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMjoxMzozM1rOGcIkFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMjoyNzo0NFrOGcI4Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE1MzYyMw==", "bodyText": "Can we please update the JavaDocs of allLocalStorePartitionLags to state that a StreamsException could be thrown?", "url": "https://github.com/apache/kafka/pull/8738#discussion_r432153623", "createdAt": "2020-05-28T22:13:33Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/KafkaStreams.java", "diffHunk": "@@ -1246,7 +1246,7 @@ public void cleanUp() {\n         }\n \n         log.debug(\"Current changelog positions: {}\", allChangelogPositions);\n-        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets = fetchEndOffsetsWithoutTimeout(allPartitions, adminClient);\n+        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets = fetchEndOffsets(allPartitions, adminClient);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54ea20bea7070784a490eaeff64feffda5d79ba3"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE1ODc2Ng==", "bodyText": "ack, done", "url": "https://github.com/apache/kafka/pull/8738#discussion_r432158766", "createdAt": "2020-05-28T22:27:44Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/KafkaStreams.java", "diffHunk": "@@ -1246,7 +1246,7 @@ public void cleanUp() {\n         }\n \n         log.debug(\"Current changelog positions: {}\", allChangelogPositions);\n-        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets = fetchEndOffsetsWithoutTimeout(allPartitions, adminClient);\n+        final Map<TopicPartition, ListOffsetsResultInfo> allEndOffsets = fetchEndOffsets(allPartitions, adminClient);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjE1MzYyMw=="}, "originalCommit": {"oid": "54ea20bea7070784a490eaeff64feffda5d79ba3"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2455, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}