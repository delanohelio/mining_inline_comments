{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MjM0Nzgy", "number": 9095, "title": "KAFKA-10321: fix infinite blocking for global stream thread startup", "bodyText": "In the unit test shouldDieOnInvalidOffsetExceptionDuringStartup for JDK 11, we spotted a case where a global stream thread startup would stall if it fails immediately upon the first poll. The reason is that start() function only checks whether the thread is not running, as it needs to block until it finishes the initialization. However, if the thread transits to DEAD immediately, the start() call would block forever.\nUse the failed unit test to verify it works.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-07-29T06:53:22Z", "url": "https://github.com/apache/kafka/pull/9095", "merged": true, "mergeCommit": {"oid": "2f64f6deb906cdfe4d006e530edeff2e79c05f76"}, "closed": true, "closedAt": "2020-07-30T04:04:21Z", "author": {"login": "abbccdda"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5lVplAH2gAyNDU4MjM0NzgyOmM3M2VmNThkMTc5YTg4MTY4MGFjZjA3N2UyMzg2NzE5YWU0OTA4NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5yxopAH2gAyNDU4MjM0NzgyOmMyMzEyMzMxN2FlMWI5MGE3MDVlMzUzNTg4YjU0ZTFhMzI5NGZjYzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c73ef58d179a881680acf077e2386719ae490859", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/c73ef58d179a881680acf077e2386719ae490859", "committedDate": "2020-07-29T06:49:54Z", "message": "fix infinite blocking for global stream thread startup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3ODMzMjA0", "url": "https://github.com/apache/kafka/pull/9095#pullrequestreview-457833204", "createdAt": "2020-07-29T19:43:04Z", "commit": {"oid": "c73ef58d179a881680acf077e2386719ae490859"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49f36eb1c009b072d80ad2dd5b17c09c5173a50f", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/49f36eb1c009b072d80ad2dd5b17c09c5173a50f", "committedDate": "2020-07-29T20:41:23Z", "message": "address John's comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "928c61b718c631ff35fef8d5a57ce31aeabe0769", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/928c61b718c631ff35fef8d5a57ce31aeabe0769", "committedDate": "2020-07-29T20:51:11Z", "message": "make the start call safe"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3ODk3NzI5", "url": "https://github.com/apache/kafka/pull/9095#pullrequestreview-457897729", "createdAt": "2020-07-29T21:06:27Z", "commit": {"oid": "928c61b718c631ff35fef8d5a57ce31aeabe0769"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMTowNjoyN1rOG5KMVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMTowNjoyN1rOG5KMVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU4OTAxNQ==", "bodyText": "Why not just state.CREATED as we are excluding three out of four states here?", "url": "https://github.com/apache/kafka/pull/9095#discussion_r462589015", "createdAt": "2020-07-29T21:06:27Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/GlobalStreamThread.java", "diffHunk": "@@ -173,6 +178,18 @@ public boolean stillRunning() {\n         }\n     }\n \n+    public boolean inErrorState() {\n+        synchronized (stateLock) {\n+            return state.inErrorState();\n+        }\n+    }\n+\n+    public boolean stillInitializing() {\n+        synchronized (stateLock) {\n+            return !state.isRunning() && !state.inErrorState();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "928c61b718c631ff35fef8d5a57ce31aeabe0769"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c23123317ae1b90a705e353588b54e1a3294fcc0", "author": {"user": {"login": "abbccdda", "name": "Boyang Chen"}}, "url": "https://github.com/apache/kafka/commit/c23123317ae1b90a705e353588b54e1a3294fcc0", "committedDate": "2020-07-29T22:29:14Z", "message": "use created instead"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 962, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}