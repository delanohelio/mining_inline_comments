{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1MzcyMDUy", "number": 8759, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMTo0MjoyMlrOEBJhyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNzozNDoyNlrOEBKYgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjQwMTM5OnYy", "diffSide": "RIGHT", "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMTo0MjoyMlrOGc2NRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNjowMDoyNFrOGc_leQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwMTQ0Nw==", "bodyText": "DeSerializers -> Deserializers", "url": "https://github.com/apache/kafka/pull/8759#discussion_r432901447", "createdAt": "2020-05-31T01:42:22Z", "author": {"login": "abbccdda"}, "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "diffHunk": "@@ -711,6 +715,56 @@ public void shouldUseSourceSpecificDeserializers() {\n         assertThat(result2.getValue(), equalTo(source2Value));\n     }\n \n+    @Test\n+    public void shouldPassRecordHeadersIntoDeSerializers() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA1NTA5Nw==", "bodyText": "The capital S was on purpose; it's short for IntoDeserializersAndSerializers", "url": "https://github.com/apache/kafka/pull/8759#discussion_r433055097", "createdAt": "2020-06-01T06:00:24Z", "author": {"login": "mjsax"}, "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "diffHunk": "@@ -711,6 +715,56 @@ public void shouldUseSourceSpecificDeserializers() {\n         assertThat(result2.getValue(), equalTo(source2Value));\n     }\n \n+    @Test\n+    public void shouldPassRecordHeadersIntoDeSerializers() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwMTQ0Nw=="}, "originalCommit": null, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjQwMjg4OnYy", "diffSide": "RIGHT", "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwMTo0NjoyMVrOGc2N8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNjowMzo0MlrOGc_o-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwMTYxOA==", "bodyText": "It seems like we are just verifying the headers are deserialized. Should we just use mock deserializers? Moreover, we could build a customized boolean deserializer which outputs true when the header is provided, or false otherwise.", "url": "https://github.com/apache/kafka/pull/8759#discussion_r432901618", "createdAt": "2020-05-31T01:46:21Z", "author": {"login": "abbccdda"}, "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "diffHunk": "@@ -711,6 +715,56 @@ public void shouldUseSourceSpecificDeserializers() {\n         assertThat(result2.getValue(), equalTo(source2Value));\n     }\n \n+    @Test\n+    public void shouldPassRecordHeadersIntoDeSerializers() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA1NTk5NA==", "bodyText": "We don't verify that header are deserialized -- we just verify that the right function is called, that hands the header into the deserializer (ie, to allow used to read them as metadata).\nI guess we should use mocks for the deserializers, but not for the serializers. Thus, not using mocks make the test use the same patter for both what seems \"nicer\".\n\nMoreover, we could build a customized boolean deserializer which outputs true when the header is provided, or false otherwise.\n\nWould this make the test simpler? I personally doubt it.", "url": "https://github.com/apache/kafka/pull/8759#discussion_r433055994", "createdAt": "2020-06-01T06:03:42Z", "author": {"login": "mjsax"}, "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "diffHunk": "@@ -711,6 +715,56 @@ public void shouldUseSourceSpecificDeserializers() {\n         assertThat(result2.getValue(), equalTo(source2Value));\n     }\n \n+    @Test\n+    public void shouldPassRecordHeadersIntoDeSerializers() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkwMTYxOA=="}, "originalCommit": null, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjU0MTQ1OnYy", "diffSide": "RIGHT", "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNzozNDoyNlrOGc3Sqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMzoxMDoxM1rOGdgoVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxOTIxMQ==", "bodyText": "Nice finding!\nhttps://github.com/apache/kafka/blob/trunk/streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java#L805 has similar issue. Should we fix it as well?", "url": "https://github.com/apache/kafka/pull/8759#discussion_r432919211", "createdAt": "2020-05-31T07:34:26Z", "author": {"login": "chia7712"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -906,8 +906,8 @@ public void advanceWallClockTime(final Duration advance) {\n         if (record == null) {\n             throw new NoSuchElementException(\"Empty topic: \" + topic);\n         }\n-        final K key = keyDeserializer.deserialize(record.topic(), record.key());\n-        final V value = valueDeserializer.deserialize(record.topic(), record.value());\n+        final K key = keyDeserializer.deserialize(record.topic(), record.headers(), record.key());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA1NDg4NQ==", "bodyText": "readOutput is deprecated. Thus not sure if it's worth to fix?", "url": "https://github.com/apache/kafka/pull/8759#discussion_r433054885", "createdAt": "2020-06-01T05:59:37Z", "author": {"login": "mjsax"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -906,8 +906,8 @@ public void advanceWallClockTime(final Duration advance) {\n         if (record == null) {\n             throw new NoSuchElementException(\"Empty topic: \" + topic);\n         }\n-        final K key = keyDeserializer.deserialize(record.topic(), record.key());\n-        final V value = valueDeserializer.deserialize(record.topic(), record.value());\n+        final K key = keyDeserializer.deserialize(record.topic(), record.headers(), record.key());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxOTIxMQ=="}, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM2NDc3Ng==", "bodyText": "Thus not sure if it's worth to fix?\n\nPersonally, what we should add to readOutput is \"deprecation\" rather than \"a bug\". Hence, it is worthwhile to fix if the fix does not break anything.", "url": "https://github.com/apache/kafka/pull/8759#discussion_r433364776", "createdAt": "2020-06-01T16:59:49Z", "author": {"login": "chia7712"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -906,8 +906,8 @@ public void advanceWallClockTime(final Duration advance) {\n         if (record == null) {\n             throw new NoSuchElementException(\"Empty topic: \" + topic);\n         }\n-        final K key = keyDeserializer.deserialize(record.topic(), record.key());\n-        final V value = valueDeserializer.deserialize(record.topic(), record.value());\n+        final K key = keyDeserializer.deserialize(record.topic(), record.headers(), record.key());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxOTIxMQ=="}, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2NDc5OA==", "bodyText": "Not sure if I can follow? readOutput is marked as deprecated: https://github.com/apache/kafka/blob/trunk/streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java#L797\nI can still fix it on the side, but nobody should use it any longer and thus the gain seems minimal.", "url": "https://github.com/apache/kafka/pull/8759#discussion_r433564798", "createdAt": "2020-06-02T00:57:09Z", "author": {"login": "mjsax"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -906,8 +906,8 @@ public void advanceWallClockTime(final Duration advance) {\n         if (record == null) {\n             throw new NoSuchElementException(\"Empty topic: \" + topic);\n         }\n-        final K key = keyDeserializer.deserialize(record.topic(), record.key());\n-        final V value = valueDeserializer.deserialize(record.topic(), record.value());\n+        final K key = keyDeserializer.deserialize(record.topic(), record.headers(), record.key());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxOTIxMQ=="}, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU5NjUwMQ==", "bodyText": "but nobody should use it any longer and thus the gain seems minimal.\n\nYou are right. The benefit is too low.", "url": "https://github.com/apache/kafka/pull/8759#discussion_r433596501", "createdAt": "2020-06-02T03:10:13Z", "author": {"login": "chia7712"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -906,8 +906,8 @@ public void advanceWallClockTime(final Duration advance) {\n         if (record == null) {\n             throw new NoSuchElementException(\"Empty topic: \" + topic);\n         }\n-        final K key = keyDeserializer.deserialize(record.topic(), record.key());\n-        final V value = valueDeserializer.deserialize(record.topic(), record.value());\n+        final K key = keyDeserializer.deserialize(record.topic(), record.headers(), record.key());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxOTIxMQ=="}, "originalCommit": null, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2467, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}