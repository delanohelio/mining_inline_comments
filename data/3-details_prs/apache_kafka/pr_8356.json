{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzODg1NjU1", "number": 8356, "title": "KAFKA-9441: Cleanup Streams metrics for removed task commit latency metrics", "bodyText": "Follow up to #8218 (KIP-447) that remove usage of task commit latency sensor. However, the underlying metrics were still registered, even if unused. This PR does the follow up cleanup to remove the metrics entirely.\nThe thread level commit metrics are no rollups but tracked individually and thus are not affected.\nCall for review @cadonna @abbccdda @guozhangwang", "createdAt": "2020-03-25T23:59:29Z", "url": "https://github.com/apache/kafka/pull/8356", "merged": true, "mergeCommit": {"oid": "6a49ede9475a8bb50e85d10a5c1b60179f8a0888"}, "closed": true, "closedAt": "2020-04-01T03:07:18Z", "author": {"login": "mjsax"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRhJ6EgFqTM4MjMzOTYwMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTLb4PgH2gAyMzkzODg1NjU1OmYzNzJmYzE4MjgwMDc0OWRmZjAxZmEzYTA5Y2I3NjZkZTdmODVhODI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMzM5NjAx", "url": "https://github.com/apache/kafka/pull/8356#pullrequestreview-382339601", "createdAt": "2020-03-26T19:20:29Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b69f3abe847fd179e7bb203a7dd019f7e25effb6", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/b69f3abe847fd179e7bb203a7dd019f7e25effb6", "committedDate": "2020-03-27T20:37:06Z", "message": "KAFKA-9441: Cleanup Streams metrics for removed task commit latency metrics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "b69f3abe847fd179e7bb203a7dd019f7e25effb6", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/b69f3abe847fd179e7bb203a7dd019f7e25effb6", "committedDate": "2020-03-27T20:37:06Z", "message": "KAFKA-9441: Cleanup Streams metrics for removed task commit latency metrics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDI4NDM1", "url": "https://github.com/apache/kafka/pull/8356#pullrequestreview-385028435", "createdAt": "2020-03-31T19:13:08Z", "commit": {"oid": "b69f3abe847fd179e7bb203a7dd019f7e25effb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxOToxMzowOFrOF-kXjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxOToxMzowOFrOF-kXjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE1MTg4Ng==", "bodyText": "req: Please keep this test and do only remove the following part (and of course the parts that become obsolete):\nStreamsMetricsImpl.addAvgAndMaxToSensor(\n            expectedSensor,\n            TASK_LEVEL_GROUP,\n            tagMap,\n            operationLatency,\n            avgLatencyDescription,\n            maxLatencyDescription\n        );", "url": "https://github.com/apache/kafka/pull/8356#discussion_r401151886", "createdAt": "2020-03-31T19:13:08Z", "author": {"login": "cadonna"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/metrics/ThreadMetricsTest.java", "diffHunk": "@@ -298,41 +297,4 @@ public void shouldGetSkipRecordSensor() {\n         assertThat(sensor, is(expectedSensor));\n     }\n \n-    @Test\n-    public void shouldGetCommitOverTasksSensor() {\n-        final String operation = \"commit\";\n-        final String operationLatency = operation + StreamsMetricsImpl.LATENCY_SUFFIX;\n-        final String totalDescription =\n-            \"The total number of calls to commit over all tasks assigned to one stream thread\";\n-        final String rateDescription =\n-            \"The average per-second number of calls to commit over all tasks assigned to one stream thread\";\n-        final String avgLatencyDescription =\n-            \"The average commit latency over all tasks assigned to one stream thread\";\n-        final String maxLatencyDescription =\n-            \"The maximum commit latency over all tasks assigned to one stream thread\";\n-        expect(streamsMetrics.threadLevelSensor(THREAD_ID, operation, RecordingLevel.DEBUG)).andReturn(expectedSensor);\n-        expect(streamsMetrics.taskLevelTagMap(THREAD_ID, ROLLUP_VALUE)).andReturn(tagMap);\n-        StreamsMetricsImpl.addInvocationRateAndCountToSensor(\n-            expectedSensor,\n-            TASK_LEVEL_GROUP,\n-            tagMap,\n-            operation,\n-            rateDescription,\n-            totalDescription\n-        );\n-        StreamsMetricsImpl.addAvgAndMaxToSensor(\n-            expectedSensor,\n-            TASK_LEVEL_GROUP,\n-            tagMap,\n-            operationLatency,\n-            avgLatencyDescription,\n-            maxLatencyDescription\n-        );\n-        replay(StreamsMetricsImpl.class, streamsMetrics);\n-\n-        final Sensor sensor = ThreadMetrics.commitOverTasksSensor(THREAD_ID, streamsMetrics);\n-\n-        verify(StreamsMetricsImpl.class, streamsMetrics);\n-        assertThat(sensor, is(expectedSensor));\n-    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b69f3abe847fd179e7bb203a7dd019f7e25effb6"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f372fc182800749dff01fa3a09cb766de7f85a82", "author": {"user": {"login": "mjsax", "name": "Matthias J. Sax"}}, "url": "https://github.com/apache/kafka/commit/f372fc182800749dff01fa3a09cb766de7f85a82", "committedDate": "2020-03-31T23:10:03Z", "message": "Github comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1669, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}