{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MTY4NTk0", "number": 8736, "title": "KAFKA-9802; Increase transaction timeout in system tests to reduce flakiness", "bodyText": "We have been seeing increased flakiness in transaction system tests. I believe the cause might be due to KIP-537, which increased the default zk session timeout from 6s to 18s and the default replica lag timeout from 10s to 30s. In the system test, we use the default transaction timeout of 10s. However, since the system test involves hard failures, the Produce request could be blocking for as long as the max of these two in order to wait for an ISR shrink. Hence this patch increases the timeout to 30s.\nNote this patch also includes a minor logging fix in Partition. Previously we would see messages like the following:\n[Broker id=3] Leader output-topic-0 starts at leader epoch 0 from offset 0 with high watermark 0 ISR 3,2,1 addingReplicas  removingReplicas .Previous leader epoch was -1.\n\nThis patch fixes the log to print as the following:\n[Broker id=3] Leader output-topic-0 starts at leader epoch 0 from offset 0 with high watermark 0 ISR [3,2,1] addingReplicas []  removingReplicas []. Previous leader epoch was -1.\n\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-05-27T23:41:53Z", "url": "https://github.com/apache/kafka/pull/8736", "merged": true, "mergeCommit": {"oid": "d9fe30dab0fc56318b012731c348ed1ddae2ec04"}, "closed": true, "closedAt": "2020-05-28T03:54:10Z", "author": {"login": "hachikuji"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclh90OAH2gAyNDI0MTY4NTk0OmE5ZjkyMTA4MTcwMzI0ZmI1ZTU3Yjc5MDhiNWU2MDRjMjUwZmFiZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcllodzAH2gAyNDI0MTY4NTk0OmQxN2JjZDZkYWRjYzM1MTdhM2I5NjM5ZTJlM2Q4YjA3OGU0YTUxMTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a9f92108170324fb5e57b7908b5e604c250fabef", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/a9f92108170324fb5e57b7908b5e604c250fabef", "committedDate": "2020-05-27T23:35:40Z", "message": "KAFKA-9802; Increase transaction timeout in system tests to reduce flakiness"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5Njk0MTgz", "url": "https://github.com/apache/kafka/pull/8736#pullrequestreview-419694183", "createdAt": "2020-05-28T00:12:36Z", "commit": {"oid": "a9f92108170324fb5e57b7908b5e604c250fabef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5Njk0NDQw", "url": "https://github.com/apache/kafka/pull/8736#pullrequestreview-419694440", "createdAt": "2020-05-28T00:13:28Z", "commit": {"oid": "a9f92108170324fb5e57b7908b5e604c250fabef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwMDoxMzoyOFrOGbhcnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwMDoxMzoyOFrOGbhcnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTUxMjczNQ==", "bodyText": "If the producer can block for up to 30 seconds, do we want a slightly longer transaction timeout, just to have some buffer?", "url": "https://github.com/apache/kafka/pull/8736#discussion_r431512735", "createdAt": "2020-05-28T00:13:28Z", "author": {"login": "bob-barrett"}, "path": "tests/kafkatest/tests/core/transactions_test.py", "diffHunk": "@@ -47,7 +47,7 @@ def __init__(self, test_context):\n         self.num_output_partitions = 3\n         self.num_seed_messages = 100000\n         self.transaction_size = 750\n-        self.transaction_timeout = 10000\n+        self.transaction_timeout = 30000", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9f92108170324fb5e57b7908b5e604c250fabef"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d17bcd6dadcc3517a3b9639e2e3d8b078e4a5118", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/d17bcd6dadcc3517a3b9639e2e3d8b078e4a5118", "committedDate": "2020-05-28T03:51:58Z", "message": "Increase timeout to 40s"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 752, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}