{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5OTcxNzA3", "number": 9253, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNzoxNjoxM1rOFRh_Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQwNjowMDozNVrOFUXtSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzOTI2OTY3OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/kstream/TimeWindowedDeserializer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNzoxNjoxM1rOIYBLQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNzoxNjoxM1rOIYBLQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjA1NjAwMA==", "bodyText": "The console consumer made this check necessary - if there's a simpler way to do this lmk", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562056000", "createdAt": "2021-01-21T17:16:13Z", "author": {"login": "lct45"}, "path": "streams/src/main/java/org/apache/kafka/streams/kstream/TimeWindowedDeserializer.java", "diffHunk": "@@ -61,6 +61,21 @@ public Long getWindowSize() {\n     @SuppressWarnings(\"unchecked\")\n     @Override\n     public void configure(final Map<String, ?> configs, final boolean isKey) {\n+        //check if the config is set and the window size is already set from the constructor\n+        final Long configWindowSize;\n+        if (configs.get(StreamsConfig.WINDOW_SIZE_MS_CONFIG) instanceof String) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f91dafc47c61e5688a727ec9bc55cb16557dc84"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzOTg0MzYyOnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/kstream/TimeWindowedDeserializer.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxOTozNjowM1rOIYGt4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxODoyMzoyMlrOIYwCEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE0Njc4NQ==", "bodyText": "Do you want to change this from Long.MAX_VALUE as well?", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562146785", "createdAt": "2021-01-21T19:36:03Z", "author": {"login": "wcarlson5"}, "path": "streams/src/main/java/org/apache/kafka/streams/kstream/TimeWindowedDeserializer.java", "diffHunk": "@@ -33,22 +33,22 @@\n  */\n public class TimeWindowedDeserializer<T> implements Deserializer<Windowed<T>> {\n \n-    private final Long windowSize;\n+    private Long windowSize;\n     private boolean isChangelogTopic;\n \n     private Deserializer<T> inner;\n-    \n+\n     // Default constructor needed by Kafka\n     public TimeWindowedDeserializer() {\n-        this(null, Long.MAX_VALUE);\n+        this(null, null);\n     }\n \n-    // TODO: fix this part as last bits of KAFKA-4468\n+    @Deprecated\n     public TimeWindowedDeserializer(final Deserializer<T> inner) {\n         this(inner, Long.MAX_VALUE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b367798b2a111a065632113eb82dfae5f02e00e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE1NjAxOQ==", "bodyText": "I thought about it but figured since it's deprecated anyway and we want to keep backwards compatibility I would leave it. WDYT?", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562156019", "createdAt": "2021-01-21T19:52:23Z", "author": {"login": "lct45"}, "path": "streams/src/main/java/org/apache/kafka/streams/kstream/TimeWindowedDeserializer.java", "diffHunk": "@@ -33,22 +33,22 @@\n  */\n public class TimeWindowedDeserializer<T> implements Deserializer<Windowed<T>> {\n \n-    private final Long windowSize;\n+    private Long windowSize;\n     private boolean isChangelogTopic;\n \n     private Deserializer<T> inner;\n-    \n+\n     // Default constructor needed by Kafka\n     public TimeWindowedDeserializer() {\n-        this(null, Long.MAX_VALUE);\n+        this(null, null);\n     }\n \n-    // TODO: fix this part as last bits of KAFKA-4468\n+    @Deprecated\n     public TimeWindowedDeserializer(final Deserializer<T> inner) {\n         this(inner, Long.MAX_VALUE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE0Njc4NQ=="}, "originalCommit": {"oid": "2b367798b2a111a065632113eb82dfae5f02e00e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjgyMzY5OA==", "bodyText": "You are probably right since we are deprecating it. But I don't have a strong opinion on this either way", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562823698", "createdAt": "2021-01-22T18:23:22Z", "author": {"login": "wcarlson5"}, "path": "streams/src/main/java/org/apache/kafka/streams/kstream/TimeWindowedDeserializer.java", "diffHunk": "@@ -33,22 +33,22 @@\n  */\n public class TimeWindowedDeserializer<T> implements Deserializer<Windowed<T>> {\n \n-    private final Long windowSize;\n+    private Long windowSize;\n     private boolean isChangelogTopic;\n \n     private Deserializer<T> inner;\n-    \n+\n     // Default constructor needed by Kafka\n     public TimeWindowedDeserializer() {\n-        this(null, Long.MAX_VALUE);\n+        this(null, null);\n     }\n \n-    // TODO: fix this part as last bits of KAFKA-4468\n+    @Deprecated\n     public TimeWindowedDeserializer(final Deserializer<T> inner) {\n         this(inner, Long.MAX_VALUE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE0Njc4NQ=="}, "originalCommit": {"oid": "2b367798b2a111a065632113eb82dfae5f02e00e"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzOTg1ODk5OnYy", "diffSide": "LEFT", "path": "streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxOTo0MDoyNVrOIYG3YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxODoyMToyN1rOIYv-NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE0OTIxNw==", "bodyText": "I don't think we should get rid of the generics unless we have to", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562149217", "createdAt": "2021-01-21T19:40:25Z", "author": {"login": "wcarlson5"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java", "diffHunk": "@@ -327,7 +329,7 @@ public void shouldAggregateWindowed() throws Exception {\n         startStreams();\n \n         final List<KeyValueTimestamp<Windowed<String>, Integer>> windowedMessages = receiveMessagesWithTimestamp(\n-            new TimeWindowedDeserializer<>(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b367798b2a111a065632113eb82dfae5f02e00e"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjY5ODczMA==", "bodyText": "The window size has to be set either in the constructor or in the configs so if we use the generics we have to use the configs, but the general idea was to push users to do the constructor over the configs. Also in this scenario, I wanted to confirm that it would work fine without configs", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562698730", "createdAt": "2021-01-22T15:13:00Z", "author": {"login": "lct45"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java", "diffHunk": "@@ -327,7 +329,7 @@ public void shouldAggregateWindowed() throws Exception {\n         startStreams();\n \n         final List<KeyValueTimestamp<Windowed<String>, Integer>> windowedMessages = receiveMessagesWithTimestamp(\n-            new TimeWindowedDeserializer<>(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE0OTIxNw=="}, "originalCommit": {"oid": "2b367798b2a111a065632113eb82dfae5f02e00e"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjgyMjcwOQ==", "bodyText": "That is fine. but I think It should be like new TimeWindowedDeserializer<String>(windowedSerde.deserializer(), 500L) if that complies. We want to keep the type checking", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562822709", "createdAt": "2021-01-22T18:21:27Z", "author": {"login": "wcarlson5"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java", "diffHunk": "@@ -327,7 +329,7 @@ public void shouldAggregateWindowed() throws Exception {\n         startStreams();\n \n         final List<KeyValueTimestamp<Windowed<String>, Integer>> windowedMessages = receiveMessagesWithTimestamp(\n-            new TimeWindowedDeserializer<>(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE0OTIxNw=="}, "originalCommit": {"oid": "2b367798b2a111a065632113eb82dfae5f02e00e"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzOTg2NDE3OnYy", "diffSide": "RIGHT", "path": "streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxOTo0MTo1OFrOIYG6gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxODoxODo0OFrOIYv4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE1MDAxOQ==", "bodyText": "Why don't you use timeDifference like you did below?", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562150019", "createdAt": "2021-01-21T19:41:58Z", "author": {"login": "wcarlson5"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java", "diffHunk": "@@ -235,25 +235,27 @@ public void shouldReduceWindowed() throws Exception {\n                 .thenComparing(KeyValueTimestamp::value);\n \n         windowedOutput.sort(comparator);\n-        final long firstBatchWindow = firstBatchTimestamp / 500 * 500;\n-        final long secondBatchWindow = secondBatchTimestamp / 500 * 500;\n+        final long firstBatchWindowStart = firstBatchTimestamp / 500 * 500;\n+        final long firstBatchWindowEnd = firstBatchWindowStart + 500;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b367798b2a111a065632113eb82dfae5f02e00e"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjY5OTkzOQ==", "bodyText": "These are time windows so it would be windowSize, but I didn't write this test, just updated it to fit with the updated deserializer. I can switch it out to windowSize if you think it would help with readability, WYDT?", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562699939", "createdAt": "2021-01-22T15:14:40Z", "author": {"login": "lct45"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java", "diffHunk": "@@ -235,25 +235,27 @@ public void shouldReduceWindowed() throws Exception {\n                 .thenComparing(KeyValueTimestamp::value);\n \n         windowedOutput.sort(comparator);\n-        final long firstBatchWindow = firstBatchTimestamp / 500 * 500;\n-        final long secondBatchWindow = secondBatchTimestamp / 500 * 500;\n+        final long firstBatchWindowStart = firstBatchTimestamp / 500 * 500;\n+        final long firstBatchWindowEnd = firstBatchWindowStart + 500;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE1MDAxOQ=="}, "originalCommit": {"oid": "2b367798b2a111a065632113eb82dfae5f02e00e"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjgyMTE3NA==", "bodyText": "It would probably be better practice but it's not necessary to fix. So if you feel like it", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562821174", "createdAt": "2021-01-22T18:18:48Z", "author": {"login": "wcarlson5"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java", "diffHunk": "@@ -235,25 +235,27 @@ public void shouldReduceWindowed() throws Exception {\n                 .thenComparing(KeyValueTimestamp::value);\n \n         windowedOutput.sort(comparator);\n-        final long firstBatchWindow = firstBatchTimestamp / 500 * 500;\n-        final long secondBatchWindow = secondBatchTimestamp / 500 * 500;\n+        final long firstBatchWindowStart = firstBatchTimestamp / 500 * 500;\n+        final long firstBatchWindowEnd = firstBatchWindowStart + 500;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE1MDAxOQ=="}, "originalCommit": {"oid": "2b367798b2a111a065632113eb82dfae5f02e00e"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzOTg2ODY3OnYy", "diffSide": "RIGHT", "path": "streams/src/test/java/org/apache/kafka/streams/kstream/TimeWindowedDeserializerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxOTo0MzoxOFrOIYG9Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxNToyNzo0MVrOIYpCwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE1MDc0Mg==", "bodyText": "Is there some sort of check you can verify here?", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562150742", "createdAt": "2021-01-21T19:43:18Z", "author": {"login": "wcarlson5"}, "path": "streams/src/test/java/org/apache/kafka/streams/kstream/TimeWindowedDeserializerTest.java", "diffHunk": "@@ -56,4 +57,23 @@ public void testWindowedValueDeserializerNoArgConstructors() {\n         assertNotNull(\"Inner deserializer should be not null\", inner);\n         assertTrue(\"Inner deserializer type should be ByteArrayDeserializer\", inner instanceof ByteArrayDeserializer);\n     }\n+\n+    @Test\n+    public void setWindowSizeThroughConfigs() {\n+        props.put(StreamsConfig.WINDOW_SIZE_MS_CONFIG, \"500\");\n+        final TimeWindowedDeserializer<?> deserializer = new TimeWindowedDeserializer<>();\n+        deserializer.configure(props, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b367798b2a111a065632113eb82dfae5f02e00e"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjcwOTE4NA==", "bodyText": "Ah yeah, good catch", "url": "https://github.com/apache/kafka/pull/9253#discussion_r562709184", "createdAt": "2021-01-22T15:27:41Z", "author": {"login": "lct45"}, "path": "streams/src/test/java/org/apache/kafka/streams/kstream/TimeWindowedDeserializerTest.java", "diffHunk": "@@ -56,4 +57,23 @@ public void testWindowedValueDeserializerNoArgConstructors() {\n         assertNotNull(\"Inner deserializer should be not null\", inner);\n         assertTrue(\"Inner deserializer type should be ByteArrayDeserializer\", inner instanceof ByteArrayDeserializer);\n     }\n+\n+    @Test\n+    public void setWindowSizeThroughConfigs() {\n+        props.put(StreamsConfig.WINDOW_SIZE_MS_CONFIG, \"500\");\n+        final TimeWindowedDeserializer<?> deserializer = new TimeWindowedDeserializer<>();\n+        deserializer.configure(props, false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjE1MDc0Mg=="}, "originalCommit": {"oid": "2b367798b2a111a065632113eb82dfae5f02e00e"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU1Nzk1MDQxOnYy", "diffSide": "RIGHT", "path": "streams/streams-scala/src/test/scala/org/apache/kafka/streams/scala/SerdesUnitTest.scala", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNlQyMjozNTozOVrOIatniA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQxNjo1MzoxNlrOIcsV6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg4MTI4OA==", "bodyText": "Not sure if this is the most secure check - went through a few different iterations but got type issues with all of them except this one. If someone has a better idea, lmk", "url": "https://github.com/apache/kafka/pull/9253#discussion_r564881288", "createdAt": "2021-01-26T22:35:39Z", "author": {"login": "lct45"}, "path": "streams/streams-scala/src/test/scala/org/apache/kafka/streams/scala/SerdesUnitTest.scala", "diffHunk": "@@ -0,0 +1,35 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.streams.scala\n+\n+import org.apache.kafka.streams.processor.internals.testutil.LogCaptureAppender\n+import org.apache.kafka.streams.kstream.WindowedSerdes.TimeWindowedSerde\n+import org.junit.Assert.assertFalse\n+import org.junit.Test\n+\n+class SerdesUnitTest {\n+\n+  @Test\n+  def shouldLogMessageWhenTimeWindowedSerdeIsUsed(): Unit = {\n+\n+    Serdes.timeWindowedSerde(new TimeWindowedSerde[String]())\n+    val appender = LogCaptureAppender.createAndRegister()\n+    val warning = appender.getMessages()\n+    assertFalse(\"There should be a warning about TimeWindowedDeserializer\", warning.isEmpty)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "688b59b0f9aa5ee154a025b442135365add985d7"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDkwNjgzOQ==", "bodyText": "This test also appears to fail locally since it uses the constructor we deprecate in this PR and from a quick search it doesn't look like scala suppresses these warnings as easily as Java. Any thoughts on if this test is vital / a way to make this work? cc @guozhangwang\nIf I suppress warnings, the test fails (: thoughts on viability?", "url": "https://github.com/apache/kafka/pull/9253#discussion_r564906839", "createdAt": "2021-01-26T23:23:39Z", "author": {"login": "lct45"}, "path": "streams/streams-scala/src/test/scala/org/apache/kafka/streams/scala/SerdesUnitTest.scala", "diffHunk": "@@ -0,0 +1,35 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.streams.scala\n+\n+import org.apache.kafka.streams.processor.internals.testutil.LogCaptureAppender\n+import org.apache.kafka.streams.kstream.WindowedSerdes.TimeWindowedSerde\n+import org.junit.Assert.assertFalse\n+import org.junit.Test\n+\n+class SerdesUnitTest {\n+\n+  @Test\n+  def shouldLogMessageWhenTimeWindowedSerdeIsUsed(): Unit = {\n+\n+    Serdes.timeWindowedSerde(new TimeWindowedSerde[String]())\n+    val appender = LogCaptureAppender.createAndRegister()\n+    val warning = appender.getMessages()\n+    assertFalse(\"There should be a warning about TimeWindowedDeserializer\", warning.isEmpty)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg4MTI4OA=="}, "originalCommit": {"oid": "688b59b0f9aa5ee154a025b442135365add985d7"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjYwMjEyNA==", "bodyText": "Personally I'm not a big fan to add tests coverage for deprecated functions to make sure the expected warning is generated :) Also, is this test correct? Since currently the Serdes.timeWindowedSerde itself would not log any warning, and we would only log when the deserialize is called right (see my other comment)?\nAnyways, I'm actually okay if you would like to just remove this test. But on the other hand we should try to avoid a WARN at a per-record granularity too.", "url": "https://github.com/apache/kafka/pull/9253#discussion_r566602124", "createdAt": "2021-01-29T06:17:59Z", "author": {"login": "guozhangwang"}, "path": "streams/streams-scala/src/test/scala/org/apache/kafka/streams/scala/SerdesUnitTest.scala", "diffHunk": "@@ -0,0 +1,35 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.streams.scala\n+\n+import org.apache.kafka.streams.processor.internals.testutil.LogCaptureAppender\n+import org.apache.kafka.streams.kstream.WindowedSerdes.TimeWindowedSerde\n+import org.junit.Assert.assertFalse\n+import org.junit.Test\n+\n+class SerdesUnitTest {\n+\n+  @Test\n+  def shouldLogMessageWhenTimeWindowedSerdeIsUsed(): Unit = {\n+\n+    Serdes.timeWindowedSerde(new TimeWindowedSerde[String]())\n+    val appender = LogCaptureAppender.createAndRegister()\n+    val warning = appender.getMessages()\n+    assertFalse(\"There should be a warning about TimeWindowedDeserializer\", warning.isEmpty)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg4MTI4OA=="}, "originalCommit": {"oid": "688b59b0f9aa5ee154a025b442135365add985d7"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njk1NzU0Nw==", "bodyText": "Cool, I'm going to go ahead and take the test out. Thanks!", "url": "https://github.com/apache/kafka/pull/9253#discussion_r566957547", "createdAt": "2021-01-29T16:53:16Z", "author": {"login": "lct45"}, "path": "streams/streams-scala/src/test/scala/org/apache/kafka/streams/scala/SerdesUnitTest.scala", "diffHunk": "@@ -0,0 +1,35 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.streams.scala\n+\n+import org.apache.kafka.streams.processor.internals.testutil.LogCaptureAppender\n+import org.apache.kafka.streams.kstream.WindowedSerdes.TimeWindowedSerde\n+import org.junit.Assert.assertFalse\n+import org.junit.Test\n+\n+class SerdesUnitTest {\n+\n+  @Test\n+  def shouldLogMessageWhenTimeWindowedSerdeIsUsed(): Unit = {\n+\n+    Serdes.timeWindowedSerde(new TimeWindowedSerde[String]())\n+    val appender = LogCaptureAppender.createAndRegister()\n+    val warning = appender.getMessages()\n+    assertFalse(\"There should be a warning about TimeWindowedDeserializer\", warning.isEmpty)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDg4MTI4OA=="}, "originalCommit": {"oid": "688b59b0f9aa5ee154a025b442135365add985d7"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU2OTA0MjY0OnYy", "diffSide": "RIGHT", "path": "streams/streams-scala/src/main/scala/org/apache/kafka/streams/scala/Serdes.scala", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQwNjowMDozNVrOIcWVnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQxODoyOTowNVrOIcvvbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU5NzAyMA==", "bodyText": "Thinking about this once again: if users did used the timeWindowedSerde, then we would log a WARN on each record, which would soon flood the log files. So instead of log at the deserialize function, maybe it's better to just log once at the timeWindowedSerde itself?", "url": "https://github.com/apache/kafka/pull/9253#discussion_r566597020", "createdAt": "2021-01-29T06:00:35Z", "author": {"login": "guozhangwang"}, "path": "streams/streams-scala/src/main/scala/org/apache/kafka/streams/scala/Serdes.scala", "diffHunk": "@@ -41,8 +43,19 @@ object Serdes {\n   implicit def Integer: Serde[Int] = JSerdes.Integer().asInstanceOf[Serde[Int]]\n   implicit def JavaInteger: Serde[java.lang.Integer] = JSerdes.Integer()\n \n-  implicit def timeWindowedSerde[T](implicit tSerde: Serde[T]): WindowedSerdes.TimeWindowedSerde[T] =\n-    new WindowedSerdes.TimeWindowedSerde[T](tSerde)\n+  implicit def timeWindowedSerde[T](implicit inner: Serde[T]): Serde[Windowed[T]] =\n+    new JSerdes.WrapperSerde[Windowed[T]](\n+      new TimeWindowedSerializer[T](inner.serializer),\n+      new TimeWindowedDeserializer[T](inner.deserializer) {\n+        override def deserialize(topic: String, data: Array[Byte]): Windowed[T] = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff96cebb4639b03244e32287cb0d9be32964c899"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Njk1NzIwNA==", "bodyText": "Yeah, I agree that we don't want to spam the logs. There is the deprecated annotation above as well - with that do we even need the log messaged for the timeWindowedSerde?", "url": "https://github.com/apache/kafka/pull/9253#discussion_r566957204", "createdAt": "2021-01-29T16:52:41Z", "author": {"login": "lct45"}, "path": "streams/streams-scala/src/main/scala/org/apache/kafka/streams/scala/Serdes.scala", "diffHunk": "@@ -41,8 +43,19 @@ object Serdes {\n   implicit def Integer: Serde[Int] = JSerdes.Integer().asInstanceOf[Serde[Int]]\n   implicit def JavaInteger: Serde[java.lang.Integer] = JSerdes.Integer()\n \n-  implicit def timeWindowedSerde[T](implicit tSerde: Serde[T]): WindowedSerdes.TimeWindowedSerde[T] =\n-    new WindowedSerdes.TimeWindowedSerde[T](tSerde)\n+  implicit def timeWindowedSerde[T](implicit inner: Serde[T]): Serde[Windowed[T]] =\n+    new JSerdes.WrapperSerde[Windowed[T]](\n+      new TimeWindowedSerializer[T](inner.serializer),\n+      new TimeWindowedDeserializer[T](inner.deserializer) {\n+        override def deserialize(topic: String, data: Array[Byte]): Windowed[T] = {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU5NzAyMA=="}, "originalCommit": {"oid": "ff96cebb4639b03244e32287cb0d9be32964c899"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzAxMDgzMQ==", "bodyText": "Sorry if I'm missing the point here, @lct45 , but why do we need any custom code at all in the scala wrapper? Shouldn't we just wrap the Java Serde, which you've already set up to warn upon configure if there's no constructor arg and no configured value?", "url": "https://github.com/apache/kafka/pull/9253#discussion_r567010831", "createdAt": "2021-01-29T18:24:53Z", "author": {"login": "vvcephei"}, "path": "streams/streams-scala/src/main/scala/org/apache/kafka/streams/scala/Serdes.scala", "diffHunk": "@@ -41,8 +43,19 @@ object Serdes {\n   implicit def Integer: Serde[Int] = JSerdes.Integer().asInstanceOf[Serde[Int]]\n   implicit def JavaInteger: Serde[java.lang.Integer] = JSerdes.Integer()\n \n-  implicit def timeWindowedSerde[T](implicit tSerde: Serde[T]): WindowedSerdes.TimeWindowedSerde[T] =\n-    new WindowedSerdes.TimeWindowedSerde[T](tSerde)\n+  implicit def timeWindowedSerde[T](implicit inner: Serde[T]): Serde[Windowed[T]] =\n+    new JSerdes.WrapperSerde[Windowed[T]](\n+      new TimeWindowedSerializer[T](inner.serializer),\n+      new TimeWindowedDeserializer[T](inner.deserializer) {\n+        override def deserialize(topic: String, data: Array[Byte]): Windowed[T] = {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU5NzAyMA=="}, "originalCommit": {"oid": "ff96cebb4639b03244e32287cb0d9be32964c899"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzAxMzIyOA==", "bodyText": "Hmm, maybe we don't need custom code? I did this implementation back in the fall before KIP-616 was merged. You know the scala better than I do, but I think you're right that the deprecated warning in the TimeWindowedDeserializer will be enough now that KIP-616 added the deprecated annotation to this class", "url": "https://github.com/apache/kafka/pull/9253#discussion_r567013228", "createdAt": "2021-01-29T18:29:05Z", "author": {"login": "lct45"}, "path": "streams/streams-scala/src/main/scala/org/apache/kafka/streams/scala/Serdes.scala", "diffHunk": "@@ -41,8 +43,19 @@ object Serdes {\n   implicit def Integer: Serde[Int] = JSerdes.Integer().asInstanceOf[Serde[Int]]\n   implicit def JavaInteger: Serde[java.lang.Integer] = JSerdes.Integer()\n \n-  implicit def timeWindowedSerde[T](implicit tSerde: Serde[T]): WindowedSerdes.TimeWindowedSerde[T] =\n-    new WindowedSerdes.TimeWindowedSerde[T](tSerde)\n+  implicit def timeWindowedSerde[T](implicit inner: Serde[T]): Serde[Windowed[T]] =\n+    new JSerdes.WrapperSerde[Windowed[T]](\n+      new TimeWindowedSerializer[T](inner.serializer),\n+      new TimeWindowedDeserializer[T](inner.deserializer) {\n+        override def deserialize(topic: String, data: Array[Byte]): Windowed[T] = {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU5NzAyMA=="}, "originalCommit": {"oid": "ff96cebb4639b03244e32287cb0d9be32964c899"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1995, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}