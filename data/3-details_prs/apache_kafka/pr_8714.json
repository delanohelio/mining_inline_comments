{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxOTIwMTY3", "number": 8714, "title": "MINOR: Improve broker registration and Log logging", "bodyText": "Broker registration previously:\n\nINFO Registered broker 0 at path /brokers/ids/0 with addresses: ArraySeq(EndPoint(localhost,9092,ListenerName(PLAINTEXT),PLAINTEXT),EndPoint(localhost,9093,ListenerName(SSL),SSL)), czxid (broker epoch):\n4294967320 (kafka.zk.KafkaZkClient)\n\nNow:\n\nINFO Registered broker 0 at path /brokers/ids/0 with addresses: PLAINTEXT://localhost:9092,SSL://localhost:9093, czxid (broker epoch):\n4294967320 (kafka.zk.KafkaZkClient)\n\nThe second improvement is to avoid logging messages like:\n\n\"Deleting segments List()\"\n\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-05-22T13:31:20Z", "url": "https://github.com/apache/kafka/pull/8714", "merged": true, "mergeCommit": {"oid": "5302efb2d1b7a69bcd3173a13b2d08a2666979ed"}, "closed": true, "closedAt": "2020-05-24T16:35:25Z", "author": {"login": "ijuma"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjyR3eAH2gAyNDIxOTIwMTY3OmRlNTQ1MGU1ZTQxNGFlY2EwYTg4ZjZmNDU2NGI1Njg4M2ExODY4MTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcj7s4PgFqTQxNzIzMjcyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de5450e5e414aeca0a88f6f4564b56883a186816", "author": {"user": {"login": "ijuma", "name": "Ismael Juma"}}, "url": "https://github.com/apache/kafka/commit/de5450e5e414aeca0a88f6f4564b56883a186816", "committedDate": "2020-05-22T13:28:12Z", "message": "MINOR: Improve broker registration message\n\nIt was previously:\n\n> INFO Registered broker 0 at path /brokers/ids/0 with addresses: ArraySeq(EndPoint(localhost,9092,ListenerName(PLAINTEXT),PLAINTEXT),EndPoint(localhost,9093,ListenerName(SSL),SSL)), czxid (broker epoch):\n4294967320 (kafka.zk.KafkaZkClient)\n\nIt's now:\n\n> INFO Registered broker 0 at path /brokers/ids/0 with addresses: PLAINTEXT://localhost:9092,SSL://localhost:9093, czxid (broker epoch):\n4294967320 (kafka.zk.KafkaZkClient)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbd9df44d6a0fe94e4aca4d21078be4d0815878c", "author": {"user": {"login": "ijuma", "name": "Ismael Juma"}}, "url": "https://github.com/apache/kafka/commit/dbd9df44d6a0fe94e4aca4d21078be4d0815878c", "committedDate": "2020-05-22T14:34:40Z", "message": "Logging improvements to Log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2OTYyNTM4", "url": "https://github.com/apache/kafka/pull/8714#pullrequestreview-416962538", "createdAt": "2020-05-22T14:37:56Z", "commit": {"oid": "dbd9df44d6a0fe94e4aca4d21078be4d0815878c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNDozNzo1N1rOGZZiNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNDozNzo1N1rOGZZiNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTI4NTk0Mg==", "bodyText": "This doesn't change behavior, but makes the code a bit less weird. Previously, we would special case the log, but rely on the called method to check again if deletable is empty.", "url": "https://github.com/apache/kafka/pull/8714#discussion_r429285942", "createdAt": "2020-05-22T14:37:57Z", "author": {"login": "ijuma"}, "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -1694,9 +1694,10 @@ class Log(@volatile private var _dir: File,\n   private def deleteOldSegments(predicate: (LogSegment, Option[LogSegment]) => Boolean, reason: String): Int = {\n     lock synchronized {\n       val deletable = deletableSegments(predicate)\n-      if (deletable.nonEmpty)\n+      if (deletable.nonEmpty) {\n         info(s\"Found deletable segments with base offsets [${deletable.map(_.baseOffset).mkString(\",\")}] due to $reason\")\n-      deleteSegments(deletable)\n+        deleteSegments(deletable)\n+      } else 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbd9df44d6a0fe94e4aca4d21078be4d0815878c"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjMyNzI1", "url": "https://github.com/apache/kafka/pull/8714#pullrequestreview-417232725", "createdAt": "2020-05-23T00:26:51Z", "commit": {"oid": "dbd9df44d6a0fe94e4aca4d21078be4d0815878c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1143, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}