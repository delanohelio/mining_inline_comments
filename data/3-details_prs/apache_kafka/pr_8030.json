{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5OTE3MDkx", "number": 8030, "title": "KAFKA-9492; Ignore record errors in ProduceResponse for older versions", "bodyText": "f41a5c2 caused a regression in version compatibility. We populate record errors in ProduceResponse regardless of the request version.  ProduceResponse.toStruct(version) was attempting to populate record_errors if errors were present without checking if the version supported this. This PR adds a version check.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-02-01T16:57:21Z", "url": "https://github.com/apache/kafka/pull/8030", "merged": true, "mergeCommit": {"oid": "281ed90cd8f6d5221b4a87def8019a5b881898c8"}, "closed": true, "closedAt": "2020-02-04T17:01:09Z", "author": {"login": "rajinisivaram"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAGt7sgH2gAyMzY5OTE3MDkxOjRlNzEzMjE4NGIwZTI0MmQ3NzIxOTNiYzAyNTIyY2ExODhjMTJmNDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBB8_oAFqTM1Mjk5MTk1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e7132184b0e242d772193bc02522ca188c12f43", "author": {"user": {"login": "rajinisivaram", "name": "Rajini Sivaram"}}, "url": "https://github.com/apache/kafka/commit/4e7132184b0e242d772193bc02522ca188c12f43", "committedDate": "2020-02-01T16:55:41Z", "message": "KAFKA-9492; Ignore record errors in ProduceResponse for older versions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxOTU2MjQ2", "url": "https://github.com/apache/kafka/pull/8030#pullrequestreview-351956246", "createdAt": "2020-02-02T17:41:46Z", "commit": {"oid": "4e7132184b0e242d772193bc02522ca188c12f43"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQxNzo0MTo0NlrOFkixeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQxNzo0MTo0NlrOFkixeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg2Mjc3OA==", "bodyText": "Maybe this should be in ProduceResponseTest? We started writing this type of test in dedicated classes as this class was getting too large.", "url": "https://github.com/apache/kafka/pull/8030#discussion_r373862778", "createdAt": "2020-02-02T17:41:46Z", "author": {"login": "ijuma"}, "path": "clients/src/test/java/org/apache/kafka/common/requests/RequestResponseTest.java", "diffHunk": "@@ -653,6 +654,33 @@ public void produceResponseVersionTest() {\n         assertEquals(\"Response data does not match\", responseData, v2Response.responses());\n     }\n \n+    @Test\n+    public void produceResponseRecordErrorsTest() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e7132184b0e242d772193bc02522ca188c12f43"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyMzcwNTM2", "url": "https://github.com/apache/kafka/pull/8030#pullrequestreview-352370536", "createdAt": "2020-02-03T16:07:17Z", "commit": {"oid": "4e7132184b0e242d772193bc02522ca188c12f43"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNjowNzoxN1rOFk20HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNjowNzoxN1rOFk20HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDE5MTEzMg==", "bodyText": "Should we convert the type of LOG_APPEND_TIME_KEY_NAME from long to Field.Int64? the benefit of using Field.Int64 is shown below.\n\nremove the duplicate code of converting LOG_APPEND_TIME_KEY_NAME  to Field.Int64\nuse more readable method - getOrElse", "url": "https://github.com/apache/kafka/pull/8030#discussion_r374191132", "createdAt": "2020-02-03T16:07:17Z", "author": {"login": "chia7712"}, "path": "clients/src/main/java/org/apache/kafka/common/requests/ProduceResponse.java", "diffHunk": "@@ -222,7 +222,8 @@ public ProduceResponse(Struct struct) {\n                 int partition = partRespStruct.get(PARTITION_ID);\n                 Errors error = Errors.forCode(partRespStruct.get(ERROR_CODE));\n                 long offset = partRespStruct.getLong(BASE_OFFSET_KEY_NAME);\n-                long logAppendTime = partRespStruct.getLong(LOG_APPEND_TIME_KEY_NAME);\n+                long logAppendTime = partRespStruct.hasField(LOG_APPEND_TIME_KEY_NAME) ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e7132184b0e242d772193bc02522ca188c12f43"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNDcxMjIz", "url": "https://github.com/apache/kafka/pull/8030#pullrequestreview-352471223", "createdAt": "2020-02-03T18:36:02Z", "commit": {"oid": "4e7132184b0e242d772193bc02522ca188c12f43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNTY4OTIw", "url": "https://github.com/apache/kafka/pull/8030#pullrequestreview-352568920", "createdAt": "2020-02-03T21:17:53Z", "commit": {"oid": "4e7132184b0e242d772193bc02522ca188c12f43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2585cc329ad15ec0b3a1e760018a6a4bf08917bd", "author": {"user": {"login": "rajinisivaram", "name": "Rajini Sivaram"}}, "url": "https://github.com/apache/kafka/commit/2585cc329ad15ec0b3a1e760018a6a4bf08917bd", "committedDate": "2020-02-04T11:48:14Z", "message": "Address review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyOTkxOTUy", "url": "https://github.com/apache/kafka/pull/8030#pullrequestreview-352991952", "createdAt": "2020-02-04T13:56:32Z", "commit": {"oid": "2585cc329ad15ec0b3a1e760018a6a4bf08917bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1700, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}