{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NTU3MTQ4", "number": 8924, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMjo0Njo0NVrOEIjckQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMjo0Njo0NVrOEIjckQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NDA0ODE3OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMjo0Njo0NVrOGoloXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMjo0Njo0NVrOGoloXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIxMjc2NQ==", "bodyText": "This diff turned out a bit awkward, basically I just factored this check out into a separate method that we should call at the beginning of both flavors of clean close", "url": "https://github.com/apache/kafka/pull/8924#discussion_r445212765", "createdAt": "2020-06-24T22:46:45Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -515,17 +517,20 @@ private void writeCheckpoint() {\n         stateMgr.checkpoint(checkpointableOffsets());\n     }\n \n-    /**\n-     * You must commit a task and checkpoint the state manager before closing as this will release the state dir lock\n-     */\n-    private void close(final boolean clean) {\n-        if (clean && commitNeeded) {\n-            // It may be that we failed to commit a task during handleRevocation, but \"forgot\" this and tried to\n-            // closeClean in handleAssignment. We should throw if we detect this to force the TaskManager to closeDirty\n+    private void validateClean() {\n+        // It may be that we failed to commit a task during handleRevocation, but \"forgot\" this and tried to\n+        // closeClean in handleAssignment. We should throw if we detect this to force the TaskManager to closeDirty\n+        if (commitNeeded) {\n             log.debug(\"Tried to close clean but there was pending uncommitted data, this means we failed to\"\n                           + \" commit and should close as dirty instead\");\n             throw new TaskMigratedException(\"Tried to close dirty task as clean\");\n         }\n+    }\n+\n+    /**\n+     * You must commit a task and checkpoint the state manager before closing as this will release the state dir lock\n+     */\n+    private void close(final boolean clean) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c27a0ffb26322a78f14ad4fd205b26abfea5d3f6"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2430, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}