{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4MDcwNTQ2", "number": 9247, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo1MDowN1rOEh3wfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo1MToyNVrOEh3x1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzOTUxOTk2OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorStateManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo1MDowN1rOHPbiRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNDozNTozNFrOHSfuBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MTgyOA==", "bodyText": "nit: I'd suggest we just inline this function inside StreamTask since 1) this is only triggered with EOS enabled, and its name deleteCheckPointFile maybe a bit misleading, and 2) it is a very simply function anyways.", "url": "https://github.com/apache/kafka/pull/9247#discussion_r485941828", "createdAt": "2020-09-09T21:50:07Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorStateManager.java", "diffHunk": "@@ -662,4 +662,10 @@ public TopicPartition registeredChangelogPartitionFor(final String storeName) {\n     public String changelogFor(final String storeName) {\n         return storeToChangelogTopic.get(storeName);\n     }\n+\n+    public void deleteCheckPointFile() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae073ba496f1b00c586fe804688892129980199"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQzMTUzOQ==", "bodyText": "Hi @guozhangwang\nI agree with you that name deleteCheckPointFile is a bit misleading, i think we can have a better name ( please suggest a better name :) )\nThe reasons I had written a new method inside ProcessorStateManager is because\n\nI felt that, logically; deleting the checkpoint file operation should be under ProcessorStateManager as deleting file comes under state management\nIf I have to write this inline, i will have to import checkpointFile and eosEnabled into StreamTask class; but these were already imported in ProcessorStateManager, so I created a new method in ProcessorStateManager\n\nPlease suggest how to go about it.", "url": "https://github.com/apache/kafka/pull/9247#discussion_r487431539", "createdAt": "2020-09-12T17:38:15Z", "author": {"login": "DOJI45"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorStateManager.java", "diffHunk": "@@ -662,4 +662,10 @@ public TopicPartition registeredChangelogPartitionFor(final String storeName) {\n     public String changelogFor(final String storeName) {\n         return storeToChangelogTopic.get(storeName);\n     }\n+\n+    public void deleteCheckPointFile() throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MTgyOA=="}, "originalCommit": {"oid": "aae073ba496f1b00c586fe804688892129980199"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE1NjEwMA==", "bodyText": "SGTM. We can keep it as is then.", "url": "https://github.com/apache/kafka/pull/9247#discussion_r489156100", "createdAt": "2020-09-16T04:35:34Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorStateManager.java", "diffHunk": "@@ -662,4 +662,10 @@ public TopicPartition registeredChangelogPartitionFor(final String storeName) {\n     public String changelogFor(final String storeName) {\n         return storeToChangelogTopic.get(storeName);\n     }\n+\n+    public void deleteCheckPointFile() throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MTgyOA=="}, "originalCommit": {"oid": "aae073ba496f1b00c586fe804688892129980199"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzOTUyMzQwOnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo1MToyNVrOHPbkcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQxNzozODo1OVrOHQ2d1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MjM4NA==", "bodyText": "nit: log.debug(\"Deleted check point file upon resuming with EOS enabled\");", "url": "https://github.com/apache/kafka/pull/9247#discussion_r485942384", "createdAt": "2020-09-09T21:51:25Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -332,6 +332,15 @@ public void resume() {\n             case SUSPENDED:\n                 // just transit the state without any logical changes: suspended and restoring states\n                 // are not actually any different for inner modules\n+\n+                // Deleting checkpoint file before transition to RESTORING state (KAFKA-10362)\n+                try {\n+                    stateMgr.deleteCheckPointFile();\n+                    log.debug(\"Deleted check point file\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae073ba496f1b00c586fe804688892129980199"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQzMTYzNw==", "bodyText": "I will change the log message", "url": "https://github.com/apache/kafka/pull/9247#discussion_r487431637", "createdAt": "2020-09-12T17:38:59Z", "author": {"login": "DOJI45"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -332,6 +332,15 @@ public void resume() {\n             case SUSPENDED:\n                 // just transit the state without any logical changes: suspended and restoring states\n                 // are not actually any different for inner modules\n+\n+                // Deleting checkpoint file before transition to RESTORING state (KAFKA-10362)\n+                try {\n+                    stateMgr.deleteCheckPointFile();\n+                    log.debug(\"Deleted check point file\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MjM4NA=="}, "originalCommit": {"oid": "aae073ba496f1b00c586fe804688892129980199"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1988, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}