{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMjMxODgx", "number": 8483, "title": "KAFKA-9865: Expose output topic names from TopologyTestDriver", "bodyText": "fixes: https://issues.apache.org/jira/browse/KAFKA-9865\nkip: https://cwiki.apache.org/confluence/display/KAFKA/KIP-594%3A+Expose+output+topic+names+from+TopologyTestDriver\nThis commit exposes the names of the topics the topology produced output to during its run.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-04-14T14:48:57Z", "url": "https://github.com/apache/kafka/pull/8483", "merged": true, "mergeCommit": {"oid": "33bfdacd7ab5afefbc8d494aeab6957b33b1354c"}, "closed": true, "closedAt": "2020-05-07T14:57:55Z", "author": {"login": "big-andy-coates"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXknmzgH2gAyNDAzMjMxODgxOjJjZTUxZTFmZGYwNWM3NWYzY2M0Y2Q3Mzg4MGM0YjAwM2Q5MGQ3ZTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcelQd2gH2gAyNDAzMjMxODgxOmVkNGRmODE1YWM0NDhiNzI0NGRiMGYxMzE4MzQwNzk5Yjc5OGI2N2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2ce51e1fdf05c75f3cc4cd73880c4b003d90d7e2", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/apache/kafka/commit/2ce51e1fdf05c75f3cc4cd73880c4b003d90d7e2", "committedDate": "2020-04-14T14:46:11Z", "message": "fixes: https://issues.apache.org/jira/browse/KAFKA-9864\n\nExpose the set of output topic names the topology produced records to during its test run."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMTI2ODIx", "url": "https://github.com/apache/kafka/pull/8483#pullrequestreview-400126821", "createdAt": "2020-04-24T17:11:50Z", "commit": {"oid": "2ce51e1fdf05c75f3cc4cd73880c4b003d90d7e2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzoxMTo1MFrOGLhQRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzoxMTo1MFrOGLhQRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDczMjM1Ng==", "bodyText": "@big-andy-coates Can you update the method name according to the KIP discussion?", "url": "https://github.com/apache/kafka/pull/8483#discussion_r414732356", "createdAt": "2020-04-24T17:11:50Z", "author": {"login": "mjsax"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -855,6 +856,20 @@ public void advanceWallClockTime(final Duration advance) {\n         return new TestOutputTopic<>(this, topicName, keyDeserializer, valueDeserializer);\n     }\n \n+    /**\n+     * Get all the names of all the topics to which records have been output.\n+     * <p>\n+     * Call this method after piping the input into the test driver to retrieve the full set of topics the topology\n+     * produced records to.\n+     * <p>\n+     * The returned set of topic names includes changelog, repartition and sink topic names.\n+     *\n+     * @return the set of output topic names.\n+     */\n+    public final Set<String> getOutputTopicNames() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ce51e1fdf05c75f3cc4cd73880c4b003d90d7e2"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "668be47015255ca9a6efd5064baeb583ed83fca5", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/apache/kafka/commit/668be47015255ca9a6efd5064baeb583ed83fca5", "committedDate": "2020-04-26T11:10:34Z", "message": "update method name inline with kip"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NDg2NzI2", "url": "https://github.com/apache/kafka/pull/8483#pullrequestreview-404486726", "createdAt": "2020-05-02T01:12:52Z", "commit": {"oid": "668be47015255ca9a6efd5064baeb583ed83fca5"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQwMToxMjo1MlrOGPaECA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQwMToxOToxM1rOGPaOTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgwODg0MA==", "bodyText": "IMHO, this should be it's own test similar to the one from above. (Btw: what is \"globule\" -> should we fix those names?)", "url": "https://github.com/apache/kafka/pull/8483#discussion_r418808840", "createdAt": "2020-05-02T01:12:52Z", "author": {"login": "mjsax"}, "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "diffHunk": "@@ -1643,6 +1663,8 @@ public void process(final String key, final String value) {\n                     new KeyValue<>(\"A\", \"recurse-alpha\")\n                 ))\n             );\n+\n+            assertThat(topologyTestDriver.producedTopicNames(), hasItem(\"globule-topic\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "668be47015255ca9a6efd5064baeb583ed83fca5"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgwOTAyNg==", "bodyText": "This does not setup a topology with an internal topic names. You would need to have a store or use the StreamsBuilder with some repartition topic. Or do you not care as you are just interested in the \"chaining\" itself? (than maybe change the test name?)\nOr even better, add tests for all cases, including repartition and changelog? Guess, it could even be one single test that covers all cases at once?", "url": "https://github.com/apache/kafka/pull/8483#discussion_r418809026", "createdAt": "2020-05-02T01:13:19Z", "author": {"login": "mjsax"}, "path": "streams/test-utils/src/test/java/org/apache/kafka/streams/TopologyTestDriverTest.java", "diffHunk": "@@ -450,6 +452,24 @@ public void shouldThrowForUnknownTopicDeprecated() {\n         }\n     }\n \n+    @Test\n+    public void shouldGetSinkTopicNames() {\n+        testDriver = new TopologyTestDriver(setupSourceSinkTopology(), config);\n+\n+        pipeRecord(SOURCE_TOPIC_1, testRecord1);\n+\n+        assertThat(testDriver.producedTopicNames(), hasItem(SINK_TOPIC_1));\n+    }\n+\n+    @Test\n+    public void shouldGetInternalTopicNames() {\n+        testDriver = new TopologyTestDriver(setupTopologyWithTwoSubtopologies(), config);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "668be47015255ca9a6efd5064baeb583ed83fca5"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgxMDgwNQ==", "bodyText": "nit: changelog, repartition and output topics names (as there are other internal topics, we might want to rephrase this more general:\nThe returned set of topic names may include user (e.g., output) and internal (e.g., changelog, repartition) topic names.", "url": "https://github.com/apache/kafka/pull/8483#discussion_r418810805", "createdAt": "2020-05-02T01:17:35Z", "author": {"login": "mjsax"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -855,6 +856,20 @@ public void advanceWallClockTime(final Duration advance) {\n         return new TestOutputTopic<>(this, topicName, keyDeserializer, valueDeserializer);\n     }\n \n+    /**\n+     * Get all the names of all the topics to which records have been produced during the test run.\n+     * <p>\n+     * Call this method after piping the input into the test driver to retrieve the full set of topic names the topology\n+     * produced records to.\n+     * <p>\n+     * The returned set of topic names includes changelog, repartition and output topic names.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "668be47015255ca9a6efd5064baeb583ed83fca5"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODgxMTQ2OQ==", "bodyText": "super nit: no . at the end or start sentence with [T]he :)", "url": "https://github.com/apache/kafka/pull/8483#discussion_r418811469", "createdAt": "2020-05-02T01:19:13Z", "author": {"login": "mjsax"}, "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -855,6 +856,20 @@ public void advanceWallClockTime(final Duration advance) {\n         return new TestOutputTopic<>(this, topicName, keyDeserializer, valueDeserializer);\n     }\n \n+    /**\n+     * Get all the names of all the topics to which records have been produced during the test run.\n+     * <p>\n+     * Call this method after piping the input into the test driver to retrieve the full set of topic names the topology\n+     * produced records to.\n+     * <p>\n+     * The returned set of topic names includes changelog, repartition and output topic names.\n+     *\n+     * @return the set of topic names the topology has produced to.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "668be47015255ca9a6efd5064baeb583ed83fca5"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed4df815ac448b7244db0f1318340799b798b67e", "author": {"user": {"login": "big-andy-coates", "name": "Andy Coates"}}, "url": "https://github.com/apache/kafka/commit/ed4df815ac448b7244db0f1318340799b798b67e", "committedDate": "2020-05-06T09:28:17Z", "message": "Matthias's requested changes."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1508, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}