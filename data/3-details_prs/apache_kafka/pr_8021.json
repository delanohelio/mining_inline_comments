{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5MTQxMjQw", "number": 8021, "title": "Add retries to release.py script", "bodyText": "On a spotty internet connection, the SFTP connections to the Apache servers can timeout or fail occasionally. These errors are usually recoverable by re-running release.py, but that's inconvenient.\nThis adds a simple retry mechanism to the cmd method which for now is only utilized by sftp_mkdir.", "createdAt": "2020-01-30T15:36:20Z", "url": "https://github.com/apache/kafka/pull/8021", "merged": true, "mergeCommit": {"oid": "0780f0043d4f9e43d38a3490a8159fef3702f949"}, "closed": true, "closedAt": "2020-01-30T19:29:14Z", "author": {"login": "mumrah"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_cVh8gH2gAyMzY5MTQxMjQwOmY3YjRlZTFlMGM1MDg1MTRhY2Q4NWE4OTBlNGVlMjRmYWU3MWZjMTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_faSuAFqTM1MTA2OTU5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f7b4ee1e0c508514acd85a890e4ee24fae71fc10", "author": {"user": {"login": "mumrah", "name": "David Arthur"}}, "url": "https://github.com/apache/kafka/commit/f7b4ee1e0c508514acd85a890e4ee24fae71fc10", "committedDate": "2020-01-30T15:33:01Z", "message": "Add a retry count to the \"cmd\" method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d4656753d1ecbf039287360d44273c68d976b2e", "author": {"user": {"login": "mumrah", "name": "David Arthur"}}, "url": "https://github.com/apache/kafka/commit/3d4656753d1ecbf039287360d44273c68d976b2e", "committedDate": "2020-01-30T15:37:54Z", "message": "Fix comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMDY5NTkw", "url": "https://github.com/apache/kafka/pull/8021#pullrequestreview-351069590", "createdAt": "2020-01-30T19:06:48Z", "commit": {"oid": "3d4656753d1ecbf039287360d44273c68d976b2e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxOTowNjo0OFrOFj2fxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxOTowNjo0OFrOFj2fxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzEzNzM1MQ==", "bodyText": "Do we need this? Shouldn't it behave as expected just by continuing to pass through the existing kwargs?", "url": "https://github.com/apache/kafka/pull/8021#discussion_r373137351", "createdAt": "2020-01-30T19:06:48Z", "author": {"login": "ewencp"}, "path": "release.py", "diffHunk": "@@ -109,13 +111,20 @@ def cmd(action, cmd, *args, **kwargs):\n         stdin.seek(0)\n         kwargs[\"stdin\"] = stdin\n \n-    print(action, cmd, stdin_log)\n+    print(action, cmd_arg, stdin_log)\n     try:\n-        output = subprocess.check_output(cmd, *args, stderr=subprocess.STDOUT, **kwargs)\n+        output = subprocess.check_output(cmd_arg, *args, stderr=subprocess.STDOUT, **kwargs)\n         print_output(output)\n     except subprocess.CalledProcessError as e:\n         print_output(e.output)\n \n+        if num_retries > 0:\n+            kwargs['num_retries'] = num_retries - 1\n+            kwargs['allow_failure'] = allow_failure", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d4656753d1ecbf039287360d44273c68d976b2e"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1675, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}