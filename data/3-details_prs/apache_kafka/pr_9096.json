{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MjM0ODMx", "number": 9096, "title": "MINOR: Add comments to constrainedAssign and generalAssign method", "bodyText": "Recently, I tried to read the codes to understand what the constrainedAssign and generalAssign method is doing, but it is so difficult and suffering due to the complexity of the algorithm. And then I traced back to the JIRA ticket and KIP to get much more information about them. So, I think we should put at least the algorithm goal and main steps in the code comments, to let other developers better understand them and better do trouble shooting if any.\nreference for constrainedAssign algorithm:\nhttps://issues.apache.org/jira/browse/KAFKA-9987?focusedCommentId=17106832&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-17106832\nreference for generalAssign algorithm:\nhttps://cwiki.apache.org/confluence/display/KAFKA/KIP-54+-+Sticky+Partition+Assignment+Strategy\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-07-29T06:53:30Z", "url": "https://github.com/apache/kafka/pull/9096", "merged": true, "mergeCommit": {"oid": "28b7d8e21656649fb09b09f9bacfe865b0ca133c"}, "closed": true, "closedAt": "2020-08-03T18:51:21Z", "author": {"login": "showuon"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcn42NAgH2gAyNDU4MjM0ODMxOmYwZTk3NGM1NTIwODc3NGUzMWE4ZmUzZTlkZGQ4YzE1ZDNlZGY2YjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7JdgHgH2gAyNDU4MjM0ODMxOmQ0ZDVkNzI4MWNiNTlmNDQxYTUwN2VjY2UxZDc3NzkxMGM2NDU4MDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f0e974c55208774e31a8fe3e9ddd8c15d3edf6b6", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/f0e974c55208774e31a8fe3e9ddd8c15d3edf6b6", "committedDate": "2020-06-04T07:23:01Z", "message": "add generalAssign and constrainedAssign algorithm description and high level executing steps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "741df127fc0795878814fcc0244e590c724acea6", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/741df127fc0795878814fcc0244e590c724acea6", "committedDate": "2020-07-29T03:41:44Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into addCommentsToAssign"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1140f60ce0ba602281a69a43cf1d2c74007d7bc7", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/1140f60ce0ba602281a69a43cf1d2c74007d7bc7", "committedDate": "2020-07-30T06:15:51Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into addCommentsToAssign"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NzQzNDQy", "url": "https://github.com/apache/kafka/pull/9096#pullrequestreview-458743442", "createdAt": "2020-07-30T20:45:42Z", "commit": {"oid": "741df127fc0795878814fcc0244e590c724acea6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQyMDo0NTo0MlrOG5zMzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQyMDo0NTo0MlrOG5zMzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2MDg3OA==", "bodyText": "nit: I don't think we need steps here, which makes it hard to squeeze in more comments later.", "url": "https://github.com/apache/kafka/pull/9096#discussion_r463260878", "createdAt": "2020-07-30T20:45:42Z", "author": {"login": "abbccdda"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractStickyAssignor.java", "diffHunk": "@@ -163,6 +183,7 @@ private boolean allSubscriptionsEqual(Set<String> allTopics,\n         Map<String, List<TopicPartition>> assignment = new HashMap<>(\n             consumerToOwnedPartitions.keySet().stream().collect(Collectors.toMap(c -> c, c -> new ArrayList<>(minQuota))));\n \n+        // step 1: Reassign as many previously owned partitions as possible", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "741df127fc0795878814fcc0244e590c724acea6"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "005d64c45a4f42b14f3e3f66d7fdfd1d886732fe", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/005d64c45a4f42b14f3e3f66d7fdfd1d886732fe", "committedDate": "2020-07-31T02:23:27Z", "message": "address reviewer's conmment to remove step word"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MzU5NTIy", "url": "https://github.com/apache/kafka/pull/9096#pullrequestreview-459359522", "createdAt": "2020-07-31T17:58:43Z", "commit": {"oid": "005d64c45a4f42b14f3e3f66d7fdfd1d886732fe"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNzo1ODo0NFrOG6RLyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNzo1ODo0NFrOG6RLyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc1MjEzOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * 1. Reassign as many previously owned partitions as possible\n          \n          \n            \n                 * 1. Reassign as many previously owned partitions as possible, up to the maxQuota", "url": "https://github.com/apache/kafka/pull/9096#discussion_r463752139", "createdAt": "2020-07-31T17:58:44Z", "author": {"login": "ableegoldman"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractStickyAssignor.java", "diffHunk": "@@ -144,15 +144,35 @@ private boolean allSubscriptionsEqual(Set<String> allTopics,\n         return true;\n     }\n \n+\n+    /**\n+     * This constrainedAssign optimizes the assignment algorithm when all consumers were subscribed to same set of topics.\n+     * The method includes the following steps:\n+     *\n+     * 1. Reassign as many previously owned partitions as possible", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "005d64c45a4f42b14f3e3f66d7fdfd1d886732fe"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4d5d7281cb59f441a507ecce1d777910c645809", "author": {"user": {"login": "showuon", "name": "Luke Chen"}}, "url": "https://github.com/apache/kafka/commit/d4d5d7281cb59f441a507ecce1d777910c645809", "committedDate": "2020-08-03T03:28:59Z", "message": "address reviewer's comments\n\nCo-authored-by: A. Sophie Blee-Goldman <ableegoldman@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 967, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}