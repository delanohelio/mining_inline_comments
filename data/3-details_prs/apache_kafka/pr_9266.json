{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMTU2Mjg3", "number": 9266, "title": "KAFKA-10469: Resolve logger levels hierarchically", "bodyText": "Previous to root logger level was used, ignoring intervening loggers with different levels.", "createdAt": "2020-09-08T16:18:28Z", "url": "https://github.com/apache/kafka/pull/9266", "merged": true, "mergeCommit": {"oid": "fda67018375ce3f6b90658e1ae9c30ab463e0240"}, "closed": true, "closedAt": "2020-09-30T13:51:03Z", "author": {"login": "tombentley"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdG6rjngFqTQ4NDMzMzA0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN9GgbAFqTQ5OTQ1MDk0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MzMzMDQ5", "url": "https://github.com/apache/kafka/pull/9266#pullrequestreview-484333049", "createdAt": "2020-09-08T17:02:51Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0Mzc0NDk4", "url": "https://github.com/apache/kafka/pull/9266#pullrequestreview-484374498", "createdAt": "2020-09-08T18:01:39Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MDE4MjEy", "url": "https://github.com/apache/kafka/pull/9266#pullrequestreview-485018212", "createdAt": "2020-09-09T13:39:19Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMzozOToxOVrOHPH0Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMzozOToxOVrOHPH0Ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYxODc3OQ==", "bodyText": "@tombentley A small propsal: would org.apache.log4j.Level.TRACE.toString be better?\nIt passes compilation checks.", "url": "https://github.com/apache/kafka/pull/9266#discussion_r485618779", "createdAt": "2020-09-09T13:39:19Z", "author": {"login": "dongjinleekr"}, "path": "core/src/test/scala/kafka/utils/LoggingTest.scala", "diffHunk": "@@ -58,4 +60,20 @@ class LoggingTest extends Logging {\n \n     assertEquals(logging.getClass.getName, logging.log.underlying.getName)\n   }\n+\n+  @Test\n+  def testLoggerLevelIsResolved(): Unit = {\n+    val controller = new Log4jController()\n+    val previousLevel = controller.getLogLevel(\"kafka\")\n+    try {\n+      controller.setLogLevel(\"kafka\", \"TRACE\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNjA4MTI2", "url": "https://github.com/apache/kafka/pull/9266#pullrequestreview-490608126", "createdAt": "2020-09-17T13:42:43Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzo0Mjo0M1rOHTi3Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzo0Mjo0M1rOHTi3Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI1NjIyNw==", "bodyText": "Can we add a comment explaining why we are invoking the logger here?", "url": "https://github.com/apache/kafka/pull/9266#discussion_r490256227", "createdAt": "2020-09-17T13:42:43Z", "author": {"login": "ijuma"}, "path": "core/src/test/scala/kafka/utils/LoggingTest.scala", "diffHunk": "@@ -58,4 +60,20 @@ class LoggingTest extends Logging {\n \n     assertEquals(logging.getClass.getName, logging.log.underlying.getName)\n   }\n+\n+  @Test\n+  def testLoggerLevelIsResolved(): Unit = {\n+    val controller = new Log4jController()\n+    val previousLevel = controller.getLogLevel(\"kafka\")\n+    try {\n+      controller.setLogLevel(\"kafka\", \"TRACE\")\n+      Logger(LoggerFactory.getLogger(\"kafka.utils.Log4jControllerTest\")).trace(\"test\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNjEyNDEx", "url": "https://github.com/apache/kafka/pull/9266#pullrequestreview-490612411", "createdAt": "2020-09-17T13:47:14Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzo0NzoxNFrOHTjEAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzo0NzoxNFrOHTjEAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI1OTQ1OA==", "bodyText": "Should this be private?", "url": "https://github.com/apache/kafka/pull/9266#discussion_r490259458", "createdAt": "2020-09-17T13:47:14Z", "author": {"login": "ijuma"}, "path": "core/src/main/scala/kafka/utils/Log4jController.scala", "diffHunk": "@@ -29,6 +29,24 @@ import scala.jdk.CollectionConverters._\n object Log4jController {\n   val ROOT_LOGGER = \"root\"\n \n+  def resolveLevel(logger: Logger): String = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNjE0NTIz", "url": "https://github.com/apache/kafka/pull/9266#pullrequestreview-490614523", "createdAt": "2020-09-17T13:49:12Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzo0OToxM1rOHTjJ1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzo0OToxM1rOHTjJ1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI2MDk0OA==", "bodyText": "Nit: we don't usually include the Assert. prefix in test assertions.", "url": "https://github.com/apache/kafka/pull/9266#discussion_r490260948", "createdAt": "2020-09-17T13:49:13Z", "author": {"login": "ijuma"}, "path": "core/src/test/scala/kafka/utils/LoggingTest.scala", "diffHunk": "@@ -58,4 +60,22 @@ class LoggingTest extends Logging {\n \n     assertEquals(logging.getClass.getName, logging.log.underlying.getName)\n   }\n+\n+  @Test\n+  def testLoggerLevelIsResolved(): Unit = {\n+    val controller = new Log4jController()\n+    val previousLevel = controller.getLogLevel(\"kafka\")\n+    try {\n+      controller.setLogLevel(\"kafka\", \"TRACE\")\n+      // Do some logging so that the Logger is created within the hierarchy\n+      // (until loggers are used only loggers in the config file exist)\n+      Logger(LoggerFactory.getLogger(\"kafka.utils.Log4jControllerTest\")).trace(\"test\")\n+      Assert.assertEquals(\"TRACE\", controller.getLogLevel(\"kafka\"))\n+      Assert.assertEquals(\"TRACE\", controller.getLogLevel(\"kafka.utils.Log4jControllerTest\"))\n+      Assert.assertTrue(controller.getLoggers.contains(\"kafka=TRACE\"))\n+      Assert.assertTrue(controller.getLoggers.contains(\"kafka.utils.Log4jControllerTest=TRACE\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNjM0NTUy", "url": "https://github.com/apache/kafka/pull/9266#pullrequestreview-490634552", "createdAt": "2020-09-17T14:08:06Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNzc0NDI5", "url": "https://github.com/apache/kafka/pull/9266#pullrequestreview-490774429", "createdAt": "2020-09-17T16:18:35Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwODMwNzkx", "url": "https://github.com/apache/kafka/pull/9266#pullrequestreview-490830791", "createdAt": "2020-09-17T17:28:18Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2272bf33b7606162c7b2006910b8ccd975232601", "author": {"user": {"login": "tombentley", "name": "Tom Bentley"}}, "url": "https://github.com/apache/kafka/commit/2272bf33b7606162c7b2006910b8ccd975232601", "committedDate": "2020-09-22T07:58:48Z", "message": "KAFKA-10469: Resolve logger levels hierarchically\n\nPrevious to root logger level was used, ignoring intervening loggers with\ndifferent levels."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b75b0b69e8d70a97716ccb3e3dfdb5fca31b691", "author": {"user": {"login": "tombentley", "name": "Tom Bentley"}}, "url": "https://github.com/apache/kafka/commit/3b75b0b69e8d70a97716ccb3e3dfdb5fca31b691", "committedDate": "2020-09-22T07:58:48Z", "message": "Fix logic & move test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fe8c465a8b0253237250930b59fff9eb5429b4b", "author": {"user": {"login": "tombentley", "name": "Tom Bentley"}}, "url": "https://github.com/apache/kafka/commit/9fe8c465a8b0253237250930b59fff9eb5429b4b", "committedDate": "2020-09-22T07:58:48Z", "message": "comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "814431e048668486ad145f6f92e30d31e54d6e55", "author": {"user": {"login": "tombentley", "name": "Tom Bentley"}}, "url": "https://github.com/apache/kafka/commit/814431e048668486ad145f6f92e30d31e54d6e55", "committedDate": "2020-09-22T07:58:48Z", "message": "make private"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbeead90e038f463445e84efd387aa083378d554", "author": {"user": {"login": "tombentley", "name": "Tom Bentley"}}, "url": "https://github.com/apache/kafka/commit/dbeead90e038f463445e84efd387aa083378d554", "committedDate": "2020-09-22T07:58:48Z", "message": "Assert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9110d76ec416907a3f75478d5d2b77777cc31f13", "author": {"user": {"login": "tombentley", "name": "Tom Bentley"}}, "url": "https://github.com/apache/kafka/commit/9110d76ec416907a3f75478d5d2b77777cc31f13", "committedDate": "2020-09-22T07:58:48Z", "message": "Remove com.typesafe.scalalogging.Logger"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6310c039f94e10eb9f219acd16f946c27b4fa711", "author": {"user": {"login": "tombentley", "name": "Tom Bentley"}}, "url": "https://github.com/apache/kafka/commit/6310c039f94e10eb9f219acd16f946c27b4fa711", "committedDate": "2020-09-22T09:55:23Z", "message": "Fix infinite loop"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "6310c039f94e10eb9f219acd16f946c27b4fa711", "author": {"user": {"login": "tombentley", "name": "Tom Bentley"}}, "url": "https://github.com/apache/kafka/commit/6310c039f94e10eb9f219acd16f946c27b4fa711", "committedDate": "2020-09-22T09:55:23Z", "message": "Fix infinite loop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42ddf73d99da8f47489af13016172b3151eec618", "author": {"user": {"login": "tombentley", "name": "Tom Bentley"}}, "url": "https://github.com/apache/kafka/commit/42ddf73d99da8f47489af13016172b3151eec618", "committedDate": "2020-09-22T15:43:49Z", "message": "Fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NTYwMzU5", "url": "https://github.com/apache/kafka/pull/9266#pullrequestreview-497560359", "createdAt": "2020-09-28T14:19:04Z", "commit": {"oid": "42ddf73d99da8f47489af13016172b3151eec618"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNDoxOTowNFrOHY_7nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNDoxOTowNFrOHY_7nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk3NTMyNQ==", "bodyText": "Wouldn't the first ancestor be kafka.cluster?", "url": "https://github.com/apache/kafka/pull/9266#discussion_r495975325", "createdAt": "2020-09-28T14:19:04Z", "author": {"login": "ijuma"}, "path": "core/src/test/scala/integration/kafka/api/PlaintextAdminIntegrationTest.scala", "diffHunk": "@@ -2061,11 +2062,12 @@ class PlaintextAdminIntegrationTest extends BaseAdminIntegrationTest {\n   @Test\n   def testDescribeConfigsForLog4jLogLevels(): Unit = {\n     client = Admin.create(createConfig)\n-\n+    LoggerFactory.getLogger(\"kafka.cluster.Replica\").trace(\"Message to create the logger\")\n     val loggerConfig = describeBrokerLoggers()\n-    val rootLogLevel = loggerConfig.get(Log4jController.ROOT_LOGGER).value()\n+    val kafkaLogLevel = loggerConfig.get(\"kafka\").value()\n     val logCleanerLogLevelConfig = loggerConfig.get(\"kafka.cluster.Replica\")\n-    assertEquals(rootLogLevel, logCleanerLogLevelConfig.value()) // we expect an undefined log level to be the same as the root logger\n+    // we expect an undefined log level to be the same as its first ancestor logger", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42ddf73d99da8f47489af13016172b3151eec618"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4ec8437a361a289bc2da2f15f44df1fa69595a1", "author": {"user": {"login": "tombentley", "name": "Tom Bentley"}}, "url": "https://github.com/apache/kafka/commit/a4ec8437a361a289bc2da2f15f44df1fa69595a1", "committedDate": "2020-09-28T15:41:17Z", "message": "Review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NDUwOTQ1", "url": "https://github.com/apache/kafka/pull/9266#pullrequestreview-499450945", "createdAt": "2020-09-30T13:49:35Z", "commit": {"oid": "a4ec8437a361a289bc2da2f15f44df1fa69595a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 915, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}