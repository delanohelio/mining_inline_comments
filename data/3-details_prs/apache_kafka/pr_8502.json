{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0Njk3ODA5", "number": 8502, "title": "KAFKA-9066: Retain metrics for failed tasks", "bodyText": "Jira\nRight now, sink and source task JMX metrics are dropped as soon as the task fails. The changes here cause these metrics to be retained even if the task fails, and instead only be removed when the task has been shut down (in preparation for a rebalance, due to reconfiguration, or because of connector deletion) or abandoned during that shutdown process by the worker.\nExisting unit tests are modified to account for this tweak in the worker logic.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-04-16T20:25:29Z", "url": "https://github.com/apache/kafka/pull/8502", "merged": true, "mergeCommit": {"oid": "775f0d484b6fccc3d985a9d53d86d7a3710c0b22"}, "closed": true, "closedAt": "2020-06-11T03:03:26Z", "author": {"login": "C0urante"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYmskIAFqTM5NTcyNTgwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqFUHgAFqTQyODU2MDc4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzI1ODA4", "url": "https://github.com/apache/kafka/pull/8502#pullrequestreview-395725808", "createdAt": "2020-04-17T19:41:46Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTo0MTo0NlrOGHa1sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOTo0MTo0NlrOGHa1sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzMjk0NA==", "bodyText": "I am not sure I understand the need for WorkerTask and WorkerSource/SinkTask to implement different methods. Usually, this would be done by the subclasses overriding the parent class implementation and making sure to call the parent implementation somewhere with super.xxx(). Am I missing some requirement here that necessitates the separate methods?", "url": "https://github.com/apache/kafka/pull/8502#discussion_r410432944", "createdAt": "2020-04-17T19:41:46Z", "author": {"login": "ncliang"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerTask.java", "diffHunk": "@@ -144,15 +144,25 @@ public boolean awaitStop(long timeoutMs) {\n         }\n     }\n \n+    /**\n+     * Remove all metrics published by this task.\n+     */\n+    public void removeMetrics() {\n+        try {\n+            removeAdditionalMetrics();\n+        } finally {\n+            taskMetricsGroup.close();\n+        }\n+    }\n+\n     protected abstract void execute();\n \n     protected abstract void close();\n \n     /**\n-     * Method called when this worker task has been completely closed, and when the subclass should clean up\n-     * all resources.\n+     * Remove any metrics specific to the subclass. Invoked as part of {@link #removeMetrics}.\n      */\n-    protected abstract void releaseResources();\n+    protected abstract void removeAdditionalMetrics();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODA3MDI3", "url": "https://github.com/apache/kafka/pull/8502#pullrequestreview-395807027", "createdAt": "2020-04-17T22:26:02Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7e4f190327548ebec08b89c6a8b5618af38b32e", "author": {"user": {"login": "C0urante", "name": "Chris Egerton"}}, "url": "https://github.com/apache/kafka/commit/b7e4f190327548ebec08b89c6a8b5618af38b32e", "committedDate": "2020-05-29T19:03:24Z", "message": "KAFKA-9066: Retain metrics for failed tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d191a225eeaf61b717fff4f976e41685b8c1f037", "author": {"user": {"login": "C0urante", "name": "Chris Egerton"}}, "url": "https://github.com/apache/kafka/commit/d191a225eeaf61b717fff4f976e41685b8c1f037", "committedDate": "2020-05-29T19:03:24Z", "message": "KAFKA-9066: Address review feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23006980861f55f34af20673da14253b134a94b6", "author": {"user": {"login": "C0urante", "name": "Chris Egerton"}}, "url": "https://github.com/apache/kafka/commit/23006980861f55f34af20673da14253b134a94b6", "committedDate": "2020-05-29T19:22:54Z", "message": "KAFKA-9066: Fix unit tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "23006980861f55f34af20673da14253b134a94b6", "author": {"user": {"login": "C0urante", "name": "Chris Egerton"}}, "url": "https://github.com/apache/kafka/commit/23006980861f55f34af20673da14253b134a94b6", "committedDate": "2020-05-29T19:22:54Z", "message": "KAFKA-9066: Fix unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NTYwNzg4", "url": "https://github.com/apache/kafka/pull/8502#pullrequestreview-428560788", "createdAt": "2020-06-11T03:02:24Z", "commit": {"oid": "23006980861f55f34af20673da14253b134a94b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1547, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}