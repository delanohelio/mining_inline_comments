{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NzMxMjEy", "number": 9309, "title": "KAFKA-10503: MockProducer doesn't throw ClassCastException when no", "bodyText": "partition for topic\nThough MockProducer admits serializers in its constructors, it doesn't check during send method that those serializers are the proper ones to serialize key/value included into the ProducerRecord.\nThis check is only done if there is a partition assigned for that topic.\nIt would be an enhancement if these serialize methods were also invoked in simple scenarios, where no partition is assigned to a topic.\nAdded a unit test to check expected behaviour\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-09-19T14:04:05Z", "url": "https://github.com/apache/kafka/pull/9309", "merged": true, "mergeCommit": {"oid": "901bf57c0825f4ae88d057a99020344b4b26baab"}, "closed": true, "closedAt": "2020-10-01T05:31:08Z", "author": {"login": "gmunozfe"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOBBe7AFqTQ5OTY5ODYwOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOEmWYgBqjM4MjY3MDkzMjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5Njk4NjA5", "url": "https://github.com/apache/kafka/pull/9309#pullrequestreview-499698609", "createdAt": "2020-09-30T18:22:05Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODoyMjowNVrOHap9nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODoyMzoyMlrOHaqAUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMjU0MQ==", "bodyText": "We should avoid to suppress warning. Seems, you need to add generics to ProducerRecord in L774 to fix it?", "url": "https://github.com/apache/kafka/pull/9309#discussion_r497712541", "createdAt": "2020-09-30T18:22:05Z", "author": {"login": "mjsax"}, "path": "clients/src/test/java/org/apache/kafka/clients/producer/MockProducerTest.java", "diffHunk": "@@ -765,6 +766,16 @@ public void shouldThrowOnFlushProducerIfProducerIsClosed() {\n             fail(\"Should have thrown as producer is already closed\");\n         } catch (IllegalStateException e) { }\n     }\n+    \n+    @Test\n+    @SuppressWarnings(\"unchecked\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMzIzNQ==", "bodyText": "instead of fail we should use ```\nassertThrows(\nClassCastException.class,\n() -> producer.send(record);\n);\n\nFor this case, we can remove the `catch` block below.", "url": "https://github.com/apache/kafka/pull/9309#discussion_r497713235", "createdAt": "2020-09-30T18:23:22Z", "author": {"login": "mjsax"}, "path": "clients/src/test/java/org/apache/kafka/clients/producer/MockProducerTest.java", "diffHunk": "@@ -765,6 +766,16 @@ public void shouldThrowOnFlushProducerIfProducerIsClosed() {\n             fail(\"Should have thrown as producer is already closed\");\n         } catch (IllegalStateException e) { }\n     }\n+    \n+    @Test\n+    @SuppressWarnings(\"unchecked\")\n+    public void shouldThrowClassCastException() {\n+        try (MockProducer<Integer, String> producer = new MockProducer<>(true, new IntegerSerializer(), new StringSerializer());) {\n+            ProducerRecord record = new ProducerRecord(topic, \"key1\", \"value1\");\n+            producer.send(record);\n+            fail(\"Should have thrown ClassCastException because record cannot be casted with serializers\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bcdb44e764ebe93af78ad8910b549915b9fdd97", "author": {"user": {"login": "gmunozfe", "name": "Gonzalo Mu\u00f1oz"}}, "url": "https://github.com/apache/kafka/commit/5bcdb44e764ebe93af78ad8910b549915b9fdd97", "committedDate": "2020-09-30T22:33:05Z", "message": "[KAFKA-10503] MockProducer doesn't throw ClassCastException when no\npartition for topic"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "5bcdb44e764ebe93af78ad8910b549915b9fdd97", "author": {"user": {"login": "gmunozfe", "name": "Gonzalo Mu\u00f1oz"}}, "url": "https://github.com/apache/kafka/commit/5bcdb44e764ebe93af78ad8910b549915b9fdd97", "committedDate": "2020-09-30T22:33:05Z", "message": "[KAFKA-10503] MockProducer doesn't throw ClassCastException when no\npartition for topic"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 653, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}