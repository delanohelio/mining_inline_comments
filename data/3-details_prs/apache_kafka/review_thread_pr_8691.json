{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5Nzk2NjIx", "number": 8691, "reviewThreads": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMTowMDo1MFrOD9mcgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzo0Mzo0MFrOD_4dhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTE5NjE5OnYy", "diffSide": "RIGHT", "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorConnectorConfig.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMTowMDo1MFrOGXMQog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMjo1NDo0NVrOGYgltw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MTI5OA==", "bodyText": "I don't think the KIP mentioned this kafka.connect.mirror metrics context. It's probably worthwhile to update the KIP and then notify the vote thread of the minor change noticed during implementation.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r426971298", "createdAt": "2020-05-19T01:00:50Z", "author": {"login": "rhauch"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorConnectorConfig.java", "diffHunk": "@@ -270,9 +272,15 @@ Duration adminTimeout() {\n     List<MetricsReporter> metricsReporters() {\n         List<MetricsReporter> reporters = getConfiguredInstances(\n                 CommonClientConfigs.METRIC_REPORTER_CLASSES_CONFIG, MetricsReporter.class);\n-        JmxReporter jmxReporter = new JmxReporter(\"kafka.connect.mirror\");\n+        JmxReporter jmxReporter = new JmxReporter();\n         jmxReporter.configure(this.originals());\n         reporters.add(jmxReporter);\n+        MetricsContext metricsContext = new KafkaMetricsContext(\"kafka.connect.mirror\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM1Mjk1MQ==", "bodyText": "the KIP mentions that we are deprecating the jmx prefix directly on the JmxReporter, and instead are passing it via the metrics context as the _namespace parameter. This doesn't change the prefix or how they are exposed in jmx.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428352951", "createdAt": "2020-05-20T22:54:45Z", "author": {"login": "xvrl"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorConnectorConfig.java", "diffHunk": "@@ -270,9 +272,15 @@ Duration adminTimeout() {\n     List<MetricsReporter> metricsReporters() {\n         List<MetricsReporter> reporters = getConfiguredInstances(\n                 CommonClientConfigs.METRIC_REPORTER_CLASSES_CONFIG, MetricsReporter.class);\n-        JmxReporter jmxReporter = new JmxReporter(\"kafka.connect.mirror\");\n+        JmxReporter jmxReporter = new JmxReporter();\n         jmxReporter.configure(this.originals());\n         reporters.add(jmxReporter);\n+        MetricsContext metricsContext = new KafkaMetricsContext(\"kafka.connect.mirror\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MTI5OA=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTIwNDU4OnYy", "diffSide": "RIGHT", "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorMaker.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMTowNToxOVrOGXMVeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxOToyNTowMlrOGYapbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MjUzOA==", "bodyText": "Do we need to modify the KafkaOffsetBackingStore() constructor? The ConnectUtils.lookupKafkaClusterId(...) can be called with the WorkerConfig (which is the parent class of DistributedConfig) passed to it via the configure(...) method, so couldn't the configure(...) method call the lookup method?\nThis may seem minor, but it follows the existing pattern for this class.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r426972538", "createdAt": "2020-05-19T01:05:19Z", "author": {"login": "rhauch"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorMaker.java", "diffHunk": "@@ -233,17 +233,18 @@ private void addHerder(SourceAndTarget sourceAndTarget) {\n         plugins.compareAndSwapWithDelegatingLoader();\n         DistributedConfig distributedConfig = new DistributedConfig(workerProps);\n         String kafkaClusterId = ConnectUtils.lookupKafkaClusterId(distributedConfig);\n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(distributedConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwMTczOA==", "bodyText": "Removed clusterId from KafkaOffsetBackingStore constructor.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428201738", "createdAt": "2020-05-20T17:55:51Z", "author": {"login": "xiaodongdu"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorMaker.java", "diffHunk": "@@ -233,17 +233,18 @@ private void addHerder(SourceAndTarget sourceAndTarget) {\n         plugins.compareAndSwapWithDelegatingLoader();\n         DistributedConfig distributedConfig = new DistributedConfig(workerProps);\n         String kafkaClusterId = ConnectUtils.lookupKafkaClusterId(distributedConfig);\n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(distributedConfig);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MjUzOA=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI1NTU5OA==", "bodyText": "Get kafkaClusterId from ConnectUtils.lookupKafkaClusterId in configure(...) of KafkaOffsetBackingStore", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428255598", "createdAt": "2020-05-20T19:25:02Z", "author": {"login": "xiaodongdu"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorMaker.java", "diffHunk": "@@ -233,17 +233,18 @@ private void addHerder(SourceAndTarget sourceAndTarget) {\n         plugins.compareAndSwapWithDelegatingLoader();\n         DistributedConfig distributedConfig = new DistributedConfig(workerProps);\n         String kafkaClusterId = ConnectUtils.lookupKafkaClusterId(distributedConfig);\n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(distributedConfig);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MjUzOA=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTIwNjkwOnYy", "diffSide": "RIGHT", "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorMaker.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMTowNjozNVrOGXMW4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1NjoyMFrOGYXYIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3Mjg5OQ==", "bodyText": "Could the KafkaConfigBackingStore(...) get the cluster ID from the distributedConfig? One of the reasons why we pass the whole worker config to the constructor is so that we don't have to always modify the constructor to pass in additional information that can be derived from the worker config.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r426972899", "createdAt": "2020-05-19T01:06:35Z", "author": {"login": "rhauch"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorMaker.java", "diffHunk": "@@ -233,17 +233,18 @@ private void addHerder(SourceAndTarget sourceAndTarget) {\n         plugins.compareAndSwapWithDelegatingLoader();\n         DistributedConfig distributedConfig = new DistributedConfig(workerProps);\n         String kafkaClusterId = ConnectUtils.lookupKafkaClusterId(distributedConfig);\n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(distributedConfig);\n-        Worker worker = new Worker(workerId, time, plugins, distributedConfig, offsetBackingStore, CLIENT_CONFIG_OVERRIDE_POLICY);\n+        Worker worker = new Worker(workerId, time, plugins, distributedConfig, offsetBackingStore, CLIENT_CONFIG_OVERRIDE_POLICY, kafkaClusterId);\n         WorkerConfigTransformer configTransformer = worker.configTransformer();\n         Converter internalValueConverter = worker.getInternalValueConverter();\n-        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter);\n+        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter, kafkaClusterId);\n         statusBackingStore.configure(distributedConfig);\n         ConfigBackingStore configBackingStore = new KafkaConfigBackingStore(\n                 internalValueConverter,\n                 distributedConfig,\n-                configTransformer);\n+                configTransformer,\n+                kafkaClusterId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwMjAxNg==", "bodyText": "Removed clusterId from KafkaConfigBackingStore constructor.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428202016", "createdAt": "2020-05-20T17:56:20Z", "author": {"login": "xiaodongdu"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorMaker.java", "diffHunk": "@@ -233,17 +233,18 @@ private void addHerder(SourceAndTarget sourceAndTarget) {\n         plugins.compareAndSwapWithDelegatingLoader();\n         DistributedConfig distributedConfig = new DistributedConfig(workerProps);\n         String kafkaClusterId = ConnectUtils.lookupKafkaClusterId(distributedConfig);\n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(distributedConfig);\n-        Worker worker = new Worker(workerId, time, plugins, distributedConfig, offsetBackingStore, CLIENT_CONFIG_OVERRIDE_POLICY);\n+        Worker worker = new Worker(workerId, time, plugins, distributedConfig, offsetBackingStore, CLIENT_CONFIG_OVERRIDE_POLICY, kafkaClusterId);\n         WorkerConfigTransformer configTransformer = worker.configTransformer();\n         Converter internalValueConverter = worker.getInternalValueConverter();\n-        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter);\n+        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter, kafkaClusterId);\n         statusBackingStore.configure(distributedConfig);\n         ConfigBackingStore configBackingStore = new KafkaConfigBackingStore(\n                 internalValueConverter,\n                 distributedConfig,\n-                configTransformer);\n+                configTransformer,\n+                kafkaClusterId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3Mjg5OQ=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTIwODk3OnYy", "diffSide": "RIGHT", "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorMaker.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMTowNzo0NVrOGXMYDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1Njo0NVrOGYXZHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzE5Ng==", "bodyText": "Could the KafkaStatusBackingStore(...) get the cluster ID from the distributedConfig passed into the configure(...) method, similar to the KafkaOffsetBackingStore?", "url": "https://github.com/apache/kafka/pull/8691#discussion_r426973196", "createdAt": "2020-05-19T01:07:45Z", "author": {"login": "rhauch"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorMaker.java", "diffHunk": "@@ -233,17 +233,18 @@ private void addHerder(SourceAndTarget sourceAndTarget) {\n         plugins.compareAndSwapWithDelegatingLoader();\n         DistributedConfig distributedConfig = new DistributedConfig(workerProps);\n         String kafkaClusterId = ConnectUtils.lookupKafkaClusterId(distributedConfig);\n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(distributedConfig);\n-        Worker worker = new Worker(workerId, time, plugins, distributedConfig, offsetBackingStore, CLIENT_CONFIG_OVERRIDE_POLICY);\n+        Worker worker = new Worker(workerId, time, plugins, distributedConfig, offsetBackingStore, CLIENT_CONFIG_OVERRIDE_POLICY, kafkaClusterId);\n         WorkerConfigTransformer configTransformer = worker.configTransformer();\n         Converter internalValueConverter = worker.getInternalValueConverter();\n-        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter);\n+        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter, kafkaClusterId);\n         statusBackingStore.configure(distributedConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwMjI3MA==", "bodyText": "Removed clusterId from KafkaStatusBackingStore constructor", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428202270", "createdAt": "2020-05-20T17:56:45Z", "author": {"login": "xiaodongdu"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorMaker.java", "diffHunk": "@@ -233,17 +233,18 @@ private void addHerder(SourceAndTarget sourceAndTarget) {\n         plugins.compareAndSwapWithDelegatingLoader();\n         DistributedConfig distributedConfig = new DistributedConfig(workerProps);\n         String kafkaClusterId = ConnectUtils.lookupKafkaClusterId(distributedConfig);\n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(distributedConfig);\n-        Worker worker = new Worker(workerId, time, plugins, distributedConfig, offsetBackingStore, CLIENT_CONFIG_OVERRIDE_POLICY);\n+        Worker worker = new Worker(workerId, time, plugins, distributedConfig, offsetBackingStore, CLIENT_CONFIG_OVERRIDE_POLICY, kafkaClusterId);\n         WorkerConfigTransformer configTransformer = worker.configTransformer();\n         Converter internalValueConverter = worker.getInternalValueConverter();\n-        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter);\n+        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter, kafkaClusterId);\n         statusBackingStore.configure(distributedConfig);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzE5Ng=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTIxMDI3OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMTowODozN1rOGXMY3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1NzoxNVrOGYXaJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzQwNQ==", "bodyText": "Same comment here as in MirrorMaker: the backing store's configure(...) method could get the Kafka cluster ID directly from the worker config.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r426973405", "createdAt": "2020-05-19T01:08:37Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "diffHunk": "@@ -101,24 +101,25 @@ public Connect startConnect(Map<String, String> workerProps) {\n         URI advertisedUrl = rest.advertisedUrl();\n         String workerId = advertisedUrl.getHost() + \":\" + advertisedUrl.getPort();\n \n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwMjUzMg==", "bodyText": "Removed clusterId from KafkaOffsetBackingStore constructor", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428202532", "createdAt": "2020-05-20T17:57:15Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "diffHunk": "@@ -101,24 +101,25 @@ public Connect startConnect(Map<String, String> workerProps) {\n         URI advertisedUrl = rest.advertisedUrl();\n         String workerId = advertisedUrl.getHost() + \":\" + advertisedUrl.getPort();\n \n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzQwNQ=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTIxMTEzOnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMTowOTowNlrOGXMZYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1NzozNVrOGYXa9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzUzOQ==", "bodyText": "Same comment here as in MirrorMaker: the worker's constructor could get the Kafka cluster ID directly from the worker config.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r426973539", "createdAt": "2020-05-19T01:09:06Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "diffHunk": "@@ -101,24 +101,25 @@ public Connect startConnect(Map<String, String> workerProps) {\n         URI advertisedUrl = rest.advertisedUrl();\n         String workerId = advertisedUrl.getHost() + \":\" + advertisedUrl.getPort();\n \n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(config);\n \n         ConnectorClientConfigOverridePolicy connectorClientConfigOverridePolicy = plugins.newPlugin(\n                 config.getString(WorkerConfig.CONNECTOR_CLIENT_POLICY_CLASS_CONFIG),\n                 config, ConnectorClientConfigOverridePolicy.class);\n \n-        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy);\n+        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy, kafkaClusterId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwMjc0Mg==", "bodyText": "Removed clusterId from Worker constructor.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428202742", "createdAt": "2020-05-20T17:57:35Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "diffHunk": "@@ -101,24 +101,25 @@ public Connect startConnect(Map<String, String> workerProps) {\n         URI advertisedUrl = rest.advertisedUrl();\n         String workerId = advertisedUrl.getHost() + \":\" + advertisedUrl.getPort();\n \n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(config);\n \n         ConnectorClientConfigOverridePolicy connectorClientConfigOverridePolicy = plugins.newPlugin(\n                 config.getString(WorkerConfig.CONNECTOR_CLIENT_POLICY_CLASS_CONFIG),\n                 config, ConnectorClientConfigOverridePolicy.class);\n \n-        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy);\n+        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy, kafkaClusterId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzUzOQ=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTIxMTYwOnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMTowOToxOVrOGXMZpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1ODowMVrOGYXcAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzYwNQ==", "bodyText": "Same comment here as in MirrorMaker: the backing store's constructor could get the Kafka cluster ID directly from the worker config.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r426973605", "createdAt": "2020-05-19T01:09:19Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "diffHunk": "@@ -101,24 +101,25 @@ public Connect startConnect(Map<String, String> workerProps) {\n         URI advertisedUrl = rest.advertisedUrl();\n         String workerId = advertisedUrl.getHost() + \":\" + advertisedUrl.getPort();\n \n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(config);\n \n         ConnectorClientConfigOverridePolicy connectorClientConfigOverridePolicy = plugins.newPlugin(\n                 config.getString(WorkerConfig.CONNECTOR_CLIENT_POLICY_CLASS_CONFIG),\n                 config, ConnectorClientConfigOverridePolicy.class);\n \n-        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy);\n+        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy, kafkaClusterId);\n         WorkerConfigTransformer configTransformer = worker.configTransformer();\n \n         Converter internalValueConverter = worker.getInternalValueConverter();\n-        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter);\n+        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter, kafkaClusterId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwMzAwOQ==", "bodyText": "Removed clusterId from KafkaStatusBackingStore constructor.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428203009", "createdAt": "2020-05-20T17:58:01Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "diffHunk": "@@ -101,24 +101,25 @@ public Connect startConnect(Map<String, String> workerProps) {\n         URI advertisedUrl = rest.advertisedUrl();\n         String workerId = advertisedUrl.getHost() + \":\" + advertisedUrl.getPort();\n \n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(config);\n \n         ConnectorClientConfigOverridePolicy connectorClientConfigOverridePolicy = plugins.newPlugin(\n                 config.getString(WorkerConfig.CONNECTOR_CLIENT_POLICY_CLASS_CONFIG),\n                 config, ConnectorClientConfigOverridePolicy.class);\n \n-        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy);\n+        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy, kafkaClusterId);\n         WorkerConfigTransformer configTransformer = worker.configTransformer();\n \n         Converter internalValueConverter = worker.getInternalValueConverter();\n-        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter);\n+        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter, kafkaClusterId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzYwNQ=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTIxMjE2OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMTowOTozOFrOGXMZ9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1ODozMlrOGYXdaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzY4Ng==", "bodyText": "Same comment here as in MirrorMaker: the backing store's constructor could get the Kafka cluster ID directly from the worker config.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r426973686", "createdAt": "2020-05-19T01:09:38Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "diffHunk": "@@ -101,24 +101,25 @@ public Connect startConnect(Map<String, String> workerProps) {\n         URI advertisedUrl = rest.advertisedUrl();\n         String workerId = advertisedUrl.getHost() + \":\" + advertisedUrl.getPort();\n \n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(config);\n \n         ConnectorClientConfigOverridePolicy connectorClientConfigOverridePolicy = plugins.newPlugin(\n                 config.getString(WorkerConfig.CONNECTOR_CLIENT_POLICY_CLASS_CONFIG),\n                 config, ConnectorClientConfigOverridePolicy.class);\n \n-        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy);\n+        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy, kafkaClusterId);\n         WorkerConfigTransformer configTransformer = worker.configTransformer();\n \n         Converter internalValueConverter = worker.getInternalValueConverter();\n-        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter);\n+        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter, kafkaClusterId);\n         statusBackingStore.configure(config);\n \n         ConfigBackingStore configBackingStore = new KafkaConfigBackingStore(\n                 internalValueConverter,\n                 config,\n-                configTransformer);\n+                configTransformer,\n+                kafkaClusterId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwMzM2OQ==", "bodyText": "Removed clusterId from back store constructor.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428203369", "createdAt": "2020-05-20T17:58:32Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectDistributed.java", "diffHunk": "@@ -101,24 +101,25 @@ public Connect startConnect(Map<String, String> workerProps) {\n         URI advertisedUrl = rest.advertisedUrl();\n         String workerId = advertisedUrl.getHost() + \":\" + advertisedUrl.getPort();\n \n-        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore();\n+        KafkaOffsetBackingStore offsetBackingStore = new KafkaOffsetBackingStore(kafkaClusterId);\n         offsetBackingStore.configure(config);\n \n         ConnectorClientConfigOverridePolicy connectorClientConfigOverridePolicy = plugins.newPlugin(\n                 config.getString(WorkerConfig.CONNECTOR_CLIENT_POLICY_CLASS_CONFIG),\n                 config, ConnectorClientConfigOverridePolicy.class);\n \n-        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy);\n+        Worker worker = new Worker(workerId, time, plugins, config, offsetBackingStore, connectorClientConfigOverridePolicy, kafkaClusterId);\n         WorkerConfigTransformer configTransformer = worker.configTransformer();\n \n         Converter internalValueConverter = worker.getInternalValueConverter();\n-        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter);\n+        StatusBackingStore statusBackingStore = new KafkaStatusBackingStore(time, internalValueConverter, kafkaClusterId);\n         statusBackingStore.configure(config);\n \n         ConfigBackingStore configBackingStore = new KafkaConfigBackingStore(\n                 internalValueConverter,\n                 config,\n-                configTransformer);\n+                configTransformer,\n+                kafkaClusterId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzY4Ng=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTIxMjQ5OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectStandalone.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMTowOTo1NFrOGXMaKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo1ODo1NFrOGYXeUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzczOA==", "bodyText": "Same comment here as in MirrorMaker: the worker's constructor could get the Kafka cluster ID directly from the worker config.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r426973738", "createdAt": "2020-05-19T01:09:54Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectStandalone.java", "diffHunk": "@@ -93,7 +93,7 @@ public static void main(String[] args) {\n                 config.getString(WorkerConfig.CONNECTOR_CLIENT_POLICY_CLASS_CONFIG),\n                 config, ConnectorClientConfigOverridePolicy.class);\n             Worker worker = new Worker(workerId, time, plugins, config, new FileOffsetBackingStore(),\n-                                       connectorClientConfigOverridePolicy);\n+                                       connectorClientConfigOverridePolicy, kafkaClusterId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwMzYwMA==", "bodyText": "Removed clusterId from Worker constructor.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428203600", "createdAt": "2020-05-20T17:58:54Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/cli/ConnectStandalone.java", "diffHunk": "@@ -93,7 +93,7 @@ public static void main(String[] args) {\n                 config.getString(WorkerConfig.CONNECTOR_CLIENT_POLICY_CLASS_CONFIG),\n                 config, ConnectorClientConfigOverridePolicy.class);\n             Worker worker = new Worker(workerId, time, plugins, config, new FileOffsetBackingStore(),\n-                                       connectorClientConfigOverridePolicy);\n+                                       connectorClientConfigOverridePolicy, kafkaClusterId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3MzczOA=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1OTIxNzk5OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/Worker.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMToxMjo0NlrOGXMdZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDo1MjowNFrOGav5Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3NDU2NA==", "bodyText": "The Kafka cluster ID is passed into the constructor, but is this supposed to represent the Connect cluster ID or the Kafka cluster ID? Since this is in Connect code, without a context we'd assume it was the Connect cluster ID.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r426974564", "createdAt": "2020-05-19T01:12:46Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/Worker.java", "diffHunk": "@@ -92,6 +93,7 @@\n     private final ExecutorService executor;\n     private final Time time;\n     private final String workerId;\n+    private final String clusterId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwMzc4NA==", "bodyText": "Removed clusterId from Worker constructor.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428203784", "createdAt": "2020-05-20T17:59:14Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/Worker.java", "diffHunk": "@@ -92,6 +93,7 @@\n     private final ExecutorService executor;\n     private final Time time;\n     private final String workerId;\n+    private final String clusterId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3NDU2NA=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwNTIzOA==", "bodyText": "I'm still keeping clusterId as a class variable in Worker, since we are using clusterId in other method of this class. We are getting clusterId from ConnectUtils.lookupKafkaClusterId inside Worker constructor and keep it as a class variable value.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428205238", "createdAt": "2020-05-20T18:01:35Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/Worker.java", "diffHunk": "@@ -92,6 +93,7 @@\n     private final ExecutorService executor;\n     private final Time time;\n     private final String workerId;\n+    private final String clusterId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3NDU2NA=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY2ODIyNA==", "bodyText": "@xiaodongdu, I was not suggesting getting rid of the field. It's fine to have a new field, but we should call the field kafkaClusterId rather than clusterId since the latter could be misinterpreted to mean the Connect cluster ID.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430668224", "createdAt": "2020-05-26T19:49:41Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/Worker.java", "diffHunk": "@@ -92,6 +93,7 @@\n     private final ExecutorService executor;\n     private final Time time;\n     private final String workerId;\n+    private final String clusterId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3NDU2NA=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwMDgzMA==", "bodyText": "Changed name to kafkaClusterId", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430700830", "createdAt": "2020-05-26T20:52:04Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/Worker.java", "diffHunk": "@@ -92,6 +93,7 @@\n     private final ExecutorService executor;\n     private final Time time;\n     private final String workerId;\n+    private final String clusterId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3NDU2NA=="}, "originalCommit": {"oid": "386a5da2dad688648ec7843722e8cf683d01fee6"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MDMxMDIyOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetricsContext.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNjoxNjoyM1rOGY5d6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMDowNjoyM1rOGZigpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc2MDU1NQ==", "bodyText": "Use putIfAbsent to avoid silently overwriting over labels set upstream.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r428760555", "createdAt": "2020-05-21T16:16:23Z", "author": {"login": "rnpridgeon"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetricsContext.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * A implementation of MetricsContext, it encapsulates required metrics context properties for Kafka services and clients\n+ */\n+public class KafkaMetricsContext implements MetricsContext {\n+    /**\n+     * Client or Service's metadata map.\n+     */\n+    private Map<String, String> metadata = new HashMap<>();\n+\n+    /**\n+     * Create a MetricsContext with namespace, no service or client properties\n+     * @param namespace value for _namespace key\n+     */\n+    public KafkaMetricsContext(String namespace) {\n+        this(namespace, new HashMap<>());\n+    }\n+\n+    /**\n+     * Create a MetricsContext with namespace, service or client properties\n+     * @param namespace value for _namespace key\n+     * @param metadata  metadata additional entries to add to the context.\n+     *                  values will be converted to string using Object.toString()\n+     */\n+    public KafkaMetricsContext(String namespace, Map<String, ?> metadata) {\n+        this.metadata.put(MetricsContext.NAMESPACE, namespace);\n+        metadata.forEach((key, value) -> this.metadata.put(key, value.toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM2NjgzNg==", "bodyText": "I think we it's ok for the component that owns the reporter to take precedence over the labels passed from upstream. We did not specify the behavior in the KIP, so implementations should use namespacing of labels to avoid this. If in practice we find this behavior is less desirable, we can file a follow-on KIP, since the interface is till evolving.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429366836", "createdAt": "2020-05-22T17:21:35Z", "author": {"login": "xvrl"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetricsContext.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * A implementation of MetricsContext, it encapsulates required metrics context properties for Kafka services and clients\n+ */\n+public class KafkaMetricsContext implements MetricsContext {\n+    /**\n+     * Client or Service's metadata map.\n+     */\n+    private Map<String, String> metadata = new HashMap<>();\n+\n+    /**\n+     * Create a MetricsContext with namespace, no service or client properties\n+     * @param namespace value for _namespace key\n+     */\n+    public KafkaMetricsContext(String namespace) {\n+        this(namespace, new HashMap<>());\n+    }\n+\n+    /**\n+     * Create a MetricsContext with namespace, service or client properties\n+     * @param namespace value for _namespace key\n+     * @param metadata  metadata additional entries to add to the context.\n+     *                  values will be converted to string using Object.toString()\n+     */\n+    public KafkaMetricsContext(String namespace, Map<String, ?> metadata) {\n+        this.metadata.put(MetricsContext.NAMESPACE, namespace);\n+        metadata.forEach((key, value) -> this.metadata.put(key, value.toString()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc2MDU1NQ=="}, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3MDg4OQ==", "bodyText": "Mostly I'm concerned about the case where some composite may share similar labels to the underlying client it manages. If we allow the downstream client to overwrite such a label we will lose a portion of the upstream components context.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429370889", "createdAt": "2020-05-22T17:30:48Z", "author": {"login": "rnpridgeon"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetricsContext.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * A implementation of MetricsContext, it encapsulates required metrics context properties for Kafka services and clients\n+ */\n+public class KafkaMetricsContext implements MetricsContext {\n+    /**\n+     * Client or Service's metadata map.\n+     */\n+    private Map<String, String> metadata = new HashMap<>();\n+\n+    /**\n+     * Create a MetricsContext with namespace, no service or client properties\n+     * @param namespace value for _namespace key\n+     */\n+    public KafkaMetricsContext(String namespace) {\n+        this(namespace, new HashMap<>());\n+    }\n+\n+    /**\n+     * Create a MetricsContext with namespace, service or client properties\n+     * @param namespace value for _namespace key\n+     * @param metadata  metadata additional entries to add to the context.\n+     *                  values will be converted to string using Object.toString()\n+     */\n+    public KafkaMetricsContext(String namespace, Map<String, ?> metadata) {\n+        this.metadata.put(MetricsContext.NAMESPACE, namespace);\n+        metadata.forEach((key, value) -> this.metadata.put(key, value.toString()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc2MDU1NQ=="}, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQzMjk5Nw==", "bodyText": "the client currently only injects the labels passed in via client properties, so that wouldn't happen", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429432997", "createdAt": "2020-05-22T20:06:23Z", "author": {"login": "xvrl"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetricsContext.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * A implementation of MetricsContext, it encapsulates required metrics context properties for Kafka services and clients\n+ */\n+public class KafkaMetricsContext implements MetricsContext {\n+    /**\n+     * Client or Service's metadata map.\n+     */\n+    private Map<String, String> metadata = new HashMap<>();\n+\n+    /**\n+     * Create a MetricsContext with namespace, no service or client properties\n+     * @param namespace value for _namespace key\n+     */\n+    public KafkaMetricsContext(String namespace) {\n+        this(namespace, new HashMap<>());\n+    }\n+\n+    /**\n+     * Create a MetricsContext with namespace, service or client properties\n+     * @param namespace value for _namespace key\n+     * @param metadata  metadata additional entries to add to the context.\n+     *                  values will be converted to string using Object.toString()\n+     */\n+    public KafkaMetricsContext(String namespace, Map<String, ?> metadata) {\n+        this.metadata.put(MetricsContext.NAMESPACE, namespace);\n+        metadata.forEach((key, value) -> this.metadata.put(key, value.toString()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc2MDU1NQ=="}, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MzE1ODA2OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/util/ConnectUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxMjoyNzo1OVrOGZVULQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMjoxODo1NFrOGZlL1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNjgxMw==", "bodyText": "Maybe it would be helpful to add CONNECT_VERSION as well.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429216813", "createdAt": "2020-05-22T12:27:59Z", "author": {"login": "rnpridgeon"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/util/ConnectUtils.java", "diffHunk": "@@ -16,19 +16,24 @@\n  */\n package org.apache.kafka.connect.util;\n \n+import org.apache.kafka.clients.CommonClientConfigs;\n import org.apache.kafka.clients.admin.Admin;\n import org.apache.kafka.common.KafkaFuture;\n import org.apache.kafka.common.InvalidRecordException;\n import org.apache.kafka.common.record.RecordBatch;\n import org.apache.kafka.connect.errors.ConnectException;\n import org.apache.kafka.connect.runtime.WorkerConfig;\n+import org.apache.kafka.connect.runtime.distributed.DistributedConfig;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import java.util.Map;\n import java.util.concurrent.ExecutionException;\n \n public final class ConnectUtils {\n     private static final Logger log = LoggerFactory.getLogger(ConnectUtils.class);\n+    public static final String CONNECT_KAFKA_CLUSTER_ID = \"connect.kafka.cluster.id\";\n+    public static final String CONNECT_GROUP_ID = \"connect.group.id\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ3NjgyMA==", "bodyText": "Version is added in ce-kafka.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429476820", "createdAt": "2020-05-22T22:18:54Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/util/ConnectUtils.java", "diffHunk": "@@ -16,19 +16,24 @@\n  */\n package org.apache.kafka.connect.util;\n \n+import org.apache.kafka.clients.CommonClientConfigs;\n import org.apache.kafka.clients.admin.Admin;\n import org.apache.kafka.common.KafkaFuture;\n import org.apache.kafka.common.InvalidRecordException;\n import org.apache.kafka.common.record.RecordBatch;\n import org.apache.kafka.connect.errors.ConnectException;\n import org.apache.kafka.connect.runtime.WorkerConfig;\n+import org.apache.kafka.connect.runtime.distributed.DistributedConfig;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import java.util.Map;\n import java.util.concurrent.ExecutionException;\n \n public final class ConnectUtils {\n     private static final Logger log = LoggerFactory.getLogger(ConnectUtils.class);\n+    public static final String CONNECT_KAFKA_CLUSTER_ID = \"connect.kafka.cluster.id\";\n+    public static final String CONNECT_GROUP_ID = \"connect.group.id\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNjgxMw=="}, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDIwMTYxOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetricsContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxODowNTo1NVrOGZfqiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwMDoyMjozOVrOGZmV4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4NjM3Nw==", "bodyText": "Can be final", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429386377", "createdAt": "2020-05-22T18:05:55Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetricsContext.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * A implementation of MetricsContext, it encapsulates required metrics context properties for Kafka services and clients\n+ */\n+public class KafkaMetricsContext implements MetricsContext {\n+    /**\n+     * Client or Service's metadata map.\n+     */\n+    private Map<String, String> metadata = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ5NTc3OA==", "bodyText": "Thanks for the patch @xiaodongdu!\nI reviewed the client and broker sections of code as well as the new interface. Comments inline.\nI think the ability to include \"metrics.context.*\" values as config is generally useful. Is it worth doing this for the broker as well?\nAlso, in case you didn't know, you can use Markdown in the PR description to format it and make it a little more readable.\n\nMoved String constants into KafkaConfig. Also change this to be final.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429495778", "createdAt": "2020-05-23T00:22:39Z", "author": {"login": "xiaodongdu"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetricsContext.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * A implementation of MetricsContext, it encapsulates required metrics context properties for Kafka services and clients\n+ */\n+public class KafkaMetricsContext implements MetricsContext {\n+    /**\n+     * Client or Service's metadata map.\n+     */\n+    private Map<String, String> metadata = new HashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4NjM3Nw=="}, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDIwNzkxOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/JmxReporter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxODowODozMFrOGZfu6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwMDoyMzozOVrOGZmWZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4NzQ5OA==", "bodyText": "nit: just read the value from the Map once", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429387498", "createdAt": "2020-05-22T18:08:30Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/JmxReporter.java", "diffHunk": "@@ -318,4 +324,15 @@ public AttributeList setAttributes(AttributeList list) {\n                                       + \".(whitelist/blacklist) is not a valid regular expression\");\n         }\n     }\n+\n+    @Override\n+    public void contextChange(MetricsContext metricsContext) {\n+        Objects.requireNonNull(metricsContext.metadata().get(MetricsContext.NAMESPACE));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ5NTkxMA==", "bodyText": "Added a variable to save the value.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429495910", "createdAt": "2020-05-23T00:23:39Z", "author": {"login": "xiaodongdu"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/JmxReporter.java", "diffHunk": "@@ -318,4 +324,15 @@ public AttributeList setAttributes(AttributeList list) {\n                                       + \".(whitelist/blacklist) is not a valid regular expression\");\n         }\n     }\n+\n+    @Override\n+    public void contextChange(MetricsContext metricsContext) {\n+        Objects.requireNonNull(metricsContext.metadata().get(MetricsContext.NAMESPACE));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4NzQ5OA=="}, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDIwOTI4OnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/JmxReporter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxODowOToxMlrOGZfv_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwMDoyNDowMlrOGZmWhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4Nzc3Mg==", "bodyText": "Should we throw an exception here, or just replace the null value with an empty string?", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429387772", "createdAt": "2020-05-22T18:09:12Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/JmxReporter.java", "diffHunk": "@@ -71,8 +72,13 @@ public JmxReporter() {\n \n     /**\n      * Create a JMX reporter that prefixes all metrics with the given string.\n+     *  @deprecated Since 2.6.0. Use {@link JmxReporter#JmxReporter()}\n+     *  Initialize JmxReporter with {@link JmxReporter#contextChange(MetricsContext)}\n+     *  Populate prefix by adding _namespace/prefix key value pair to {@link MetricsContext}\n      */\n+    @Deprecated\n     public JmxReporter(String prefix) {\n+        Objects.requireNonNull(prefix);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ5NTk0MA==", "bodyText": "Change the logic here: if null, set it to empty string.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429495940", "createdAt": "2020-05-23T00:24:02Z", "author": {"login": "xiaodongdu"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/JmxReporter.java", "diffHunk": "@@ -71,8 +72,13 @@ public JmxReporter() {\n \n     /**\n      * Create a JMX reporter that prefixes all metrics with the given string.\n+     *  @deprecated Since 2.6.0. Use {@link JmxReporter#JmxReporter()}\n+     *  Initialize JmxReporter with {@link JmxReporter#contextChange(MetricsContext)}\n+     *  Populate prefix by adding _namespace/prefix key value pair to {@link MetricsContext}\n      */\n+    @Deprecated\n     public JmxReporter(String prefix) {\n+        Objects.requireNonNull(prefix);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4Nzc3Mg=="}, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDIzMTYwOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxODoxODo1OFrOGZf-2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDo1MjozNlrOGav6CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM5MTU3Nw==", "bodyText": "Metadata is very overloaded, can we think of a different name here?", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429391577", "createdAt": "2020-05-22T18:18:58Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {\n+    /* predefined fields */\n+    String NAMESPACE = \"_namespace\"; // metrics namespace, formerly jmx prefix\n+\n+    /**\n+     * Returns metadata fields\n+     */\n+    Map<String, String> metadata();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ0Mjc4Nw==", "bodyText": "any suggestions? maybe contextLabels?", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429442787", "createdAt": "2020-05-22T20:39:51Z", "author": {"login": "xvrl"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {\n+    /* predefined fields */\n+    String NAMESPACE = \"_namespace\"; // metrics namespace, formerly jmx prefix\n+\n+    /**\n+     * Returns metadata fields\n+     */\n+    Map<String, String> metadata();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM5MTU3Nw=="}, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ4MzY1Mg==", "bodyText": "That sounds good", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430483652", "createdAt": "2020-05-26T15:05:07Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {\n+    /* predefined fields */\n+    String NAMESPACE = \"_namespace\"; // metrics namespace, formerly jmx prefix\n+\n+    /**\n+     * Returns metadata fields\n+     */\n+    Map<String, String> metadata();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM5MTU3Nw=="}, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYwNjcwOA==", "bodyText": "ok, I updated the KIP to reflect this change.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430606708", "createdAt": "2020-05-26T18:04:27Z", "author": {"login": "xvrl"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {\n+    /* predefined fields */\n+    String NAMESPACE = \"_namespace\"; // metrics namespace, formerly jmx prefix\n+\n+    /**\n+     * Returns metadata fields\n+     */\n+    Map<String, String> metadata();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM5MTU3Nw=="}, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwMTA2NQ==", "bodyText": "Updated code to reflect KIP changes", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430701065", "createdAt": "2020-05-26T20:52:36Z", "author": {"login": "xiaodongdu"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {\n+    /* predefined fields */\n+    String NAMESPACE = \"_namespace\"; // metrics namespace, formerly jmx prefix\n+\n+    /**\n+     * Returns metadata fields\n+     */\n+    Map<String, String> metadata();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM5MTU3Nw=="}, "originalCommit": {"oid": "85f7421d9aad5f149e6b4833f87f0747f4ae7e4b"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDQyMjAzOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxOTozNDoyMFrOGZh4dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNjo0MzoxNVrOGanHwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyMjcwOQ==", "bodyText": "Looking through the PR, it seems that MetricsContext is a short lived object used to pass values to the MetricReporters as they are constructed. Since the usage appears to be write-once, it might be better to expose a subset of Map rather than the full thing. E.g., String get(String field) and Iterator<String> fields or something.\nIf we think this might evolve into a mutable long-lived object, then a Map is probably better. Just a thought.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429422709", "createdAt": "2020-05-22T19:34:20Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ0MDY1NQ==", "bodyText": "I think having an interface gives us more flexibility to evolve the API, without breaking backwards compatibility.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429440655", "createdAt": "2020-05-22T20:33:05Z", "author": {"login": "xvrl"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyMjcwOQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ4ODIyNA==", "bodyText": "I wasn't suggesting that we eliminate the interface, I definitely think having one is a good choice (for the reasons you mentioned). What I meant was in this interface, we expose a Map as the collection of metrics tags/labels. But since it appears that the usage is intended to be read-only, maybe a Map isn't the best choice. Here's what I was thinking:\ninterface MetricsContext {\n  String namespace();\n  String get(String field);\n  Collection<String> fields();\n}\n(included the namespace suggestion from my other comment as well).", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430488224", "createdAt": "2020-05-26T15:11:27Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyMjcwOQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU1NzEyMQ==", "bodyText": "I think keeping a Map interface makes it more convenient to work with. It gives you all the helper methods and streaming interfaces rather than having to hand-roll those things for someone consuming the api.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430557121", "createdAt": "2020-05-26T16:43:15Z", "author": {"login": "xvrl"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyMjcwOQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDQyMjgxOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxOTozNDo0MVrOGZh48g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNzowMjozNVrOGan3rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyMjgzNA==", "bodyText": "Should we define this as a field on the interface?", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429422834", "createdAt": "2020-05-22T19:34:41Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {\n+    /* predefined fields */\n+    String NAMESPACE = \"_namespace\"; // metrics namespace, formerly jmx prefix", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ0MjY3MQ==", "bodyText": "I think the interface is a natural way to expose predefined constants an API might need. I don't see a need to have a separate class for this yet.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429442671", "createdAt": "2020-05-22T20:39:27Z", "author": {"login": "xvrl"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {\n+    /* predefined fields */\n+    String NAMESPACE = \"_namespace\"; // metrics namespace, formerly jmx prefix", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyMjgzNA=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ4OTIyMA==", "bodyText": "Sorry, I shouldn't have said \"field\" since that implies a concrete class. See above comment above for an example of what I meant.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430489220", "createdAt": "2020-05-26T15:12:51Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {\n+    /* predefined fields */\n+    String NAMESPACE = \"_namespace\"; // metrics namespace, formerly jmx prefix", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyMjgzNA=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU2OTM5MQ==", "bodyText": "I'm not convinced we should give namespace a special status over other fields, it just happens to be the only one we currently define by default for backwards compatibility reasons. If we find ourselves adding more of those, I agreee it would be worth revisiting how we expose pre-defined fields.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430569391", "createdAt": "2020-05-26T17:02:35Z", "author": {"login": "xvrl"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional metadata about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The metadata map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {\n+    /* predefined fields */\n+    String NAMESPACE = \"_namespace\"; // metrics namespace, formerly jmx prefix", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyMjgzNA=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDQ0NTEzOnYy", "diffSide": "RIGHT", "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "isResolved": false, "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxOTo0NDozMFrOGZiG4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDo1NDozNFrOGav9-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyNjQwMQ==", "bodyText": "Should we rename jmxPrefix to metricsPrefix?", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429426401", "createdAt": "2020-05-22T19:44:30Z", "author": {"login": "mumrah"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -129,7 +129,10 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n \n   private var shutdownLatch = new CountDownLatch(1)\n \n+  //properties for MetricsContext", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ0NDQ1MQ==", "bodyText": "jmxPrefix is from existing codebase: \n  \n    \n      kafka/core/src/main/scala/kafka/server/KafkaServer.scala\n    \n    \n         Line 132\n      in\n      ec20517\n    \n    \n    \n    \n\n        \n          \n           private val jmxPrefix: String = \"kafka.server\" \n        \n    \n  \n\n\nWe can move the comments beneath it so it is not confusing", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429444451", "createdAt": "2020-05-22T20:44:55Z", "author": {"login": "xiaodongdu"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -129,7 +129,10 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n \n   private var shutdownLatch = new CountDownLatch(1)\n \n+  //properties for MetricsContext", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyNjQwMQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ5NTk5Mw==", "bodyText": "Moved these definition of kafka.cluster.id and kafka.broker.id to KafkaConfig", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429495993", "createdAt": "2020-05-23T00:24:34Z", "author": {"login": "xiaodongdu"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -129,7 +129,10 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n \n   private var shutdownLatch = new CountDownLatch(1)\n \n+  //properties for MetricsContext", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyNjQwMQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUwMzM0Mg==", "bodyText": "any reason you moved some but not jmxPrefix? I think it would make sense to keep all the metrics context constants in one place. I didn't see any comment from @mumrah suggesting to move them.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429503342", "createdAt": "2020-05-23T01:45:37Z", "author": {"login": "xvrl"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -129,7 +129,10 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n \n   private var shutdownLatch = new CountDownLatch(1)\n \n+  //properties for MetricsContext", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyNjQwMQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTUxMDkzMQ==", "bodyText": "From his comments: \"I think the ability to include \"metrics.context.*\" values as config is generally useful. Is it worth doing this for the broker as well?\"\nLooks like I misunderstood what he meant. Just talked to him on slack. I'll revert that change.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429510931", "createdAt": "2020-05-23T03:47:23Z", "author": {"login": "xiaodongdu"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -129,7 +129,10 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n \n   private var shutdownLatch = new CountDownLatch(1)\n \n+  //properties for MetricsContext", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyNjQwMQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ4Mjg3OQ==", "bodyText": "This comment was just about the jmxPrefix variable. I realize it's pre-existing code, but now that it's not specific to JMX, I suggested renaming it.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430482879", "createdAt": "2020-05-26T15:04:05Z", "author": {"login": "mumrah"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -129,7 +129,10 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n \n   private var shutdownLatch = new CountDownLatch(1)\n \n+  //properties for MetricsContext", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyNjQwMQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU4NTQ0Nw==", "bodyText": "@xiaodongdu what @mumrah was saying is that we could add the properties to the kafka broker configuration and pass those values into the context, similar to what we do for client. We can update the KIP and add that.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430585447", "createdAt": "2020-05-26T17:30:28Z", "author": {"login": "xvrl"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -129,7 +129,10 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n \n   private var shutdownLatch = new CountDownLatch(1)\n \n+  //properties for MetricsContext", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyNjQwMQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU5MDQ4OA==", "bodyText": "@xvrl  Do you mean add this logic back to KafkaServer.scala:\nmetadata.putAll(config.originalsWithPrefix(CommonClientConfigs.METRICS_CONTEXT_PREFIX, false));", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430590488", "createdAt": "2020-05-26T17:39:15Z", "author": {"login": "xiaodongdu"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -129,7 +129,10 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n \n   private var shutdownLatch = new CountDownLatch(1)\n \n+  //properties for MetricsContext", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyNjQwMQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU5MzY2OQ==", "bodyText": "yes, I believe that's what @mumrah meant. If we decide to do this, I'll update the KIP and send a follow-up email with some of the other tweaks we discussed in this PR.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430593669", "createdAt": "2020-05-26T17:44:43Z", "author": {"login": "xvrl"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -129,7 +129,10 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n \n   private var shutdownLatch = new CountDownLatch(1)\n \n+  //properties for MetricsContext", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyNjQwMQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwMjA3NA==", "bodyText": "renamed jmxPrefix to metricsPrefix and add broker MetricsContext properties", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430702074", "createdAt": "2020-05-26T20:54:34Z", "author": {"login": "xiaodongdu"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -129,7 +129,10 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n \n   private var shutdownLatch = new CountDownLatch(1)\n \n+  //properties for MetricsContext", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQyNjQwMQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDQ4MDEzOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsReporter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMDowMzo1MFrOGZidWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QwMDoyNDo1MVrOGZmW2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQzMjE1NA==", "bodyText": "Not really a \"callback\" in the conventional sense. Maybe just \"Provides context metadata for the ...\"", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429432154", "createdAt": "2020-05-22T20:03:50Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsReporter.java", "diffHunk": "@@ -65,4 +66,13 @@ default void validateReconfiguration(Map<String, ?> configs) throws ConfigExcept\n     default void reconfigure(Map<String, ?> configs) {\n     }\n \n+    /**\n+     * Callback method providing context metadata for the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQ5NjAyNw==", "bodyText": "Fixed java doc.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429496027", "createdAt": "2020-05-23T00:24:51Z", "author": {"login": "xiaodongdu"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsReporter.java", "diffHunk": "@@ -65,4 +66,13 @@ default void validateReconfiguration(Map<String, ?> configs) throws ConfigExcept\n     default void reconfigure(Map<String, ?> configs) {\n     }\n \n+    /**\n+     * Callback method providing context metadata for the", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQzMjE1NA=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDUwOTIzOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/JmxReporter.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQyMDoxNzo0NlrOGZivMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNToxMzoxOFrOGai_yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQzNjcyMQ==", "bodyText": "@xvrl can we remove the explicit construction of JmxReporter and rely on the plugin loading mechanism after we remove this non-zero-arg constructor? Maybe something for 3.0?", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429436721", "createdAt": "2020-05-22T20:17:46Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/JmxReporter.java", "diffHunk": "@@ -71,8 +72,13 @@ public JmxReporter() {\n \n     /**\n      * Create a JMX reporter that prefixes all metrics with the given string.\n+     *  @deprecated Since 2.6.0. Use {@link JmxReporter#JmxReporter()}\n+     *  Initialize JmxReporter with {@link JmxReporter#contextChange(MetricsContext)}\n+     *  Populate prefix by adding _namespace/prefix key value pair to {@link MetricsContext}\n      */\n+    @Deprecated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQzOTgxMw==", "bodyText": "yes, I agree. We'll have to decide whether to make the config include this reporter by default or so something else. There are some backwards compatibility implications, but probably better to have a separate discussion for this.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429439813", "createdAt": "2020-05-22T20:30:24Z", "author": {"login": "xvrl"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/JmxReporter.java", "diffHunk": "@@ -71,8 +72,13 @@ public JmxReporter() {\n \n     /**\n      * Create a JMX reporter that prefixes all metrics with the given string.\n+     *  @deprecated Since 2.6.0. Use {@link JmxReporter#JmxReporter()}\n+     *  Initialize JmxReporter with {@link JmxReporter#contextChange(MetricsContext)}\n+     *  Populate prefix by adding _namespace/prefix key value pair to {@link MetricsContext}\n      */\n+    @Deprecated", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQzNjcyMQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ4OTU0Nw==", "bodyText": "Sounds good, thanks \ud83d\udc4d", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430489547", "createdAt": "2020-05-26T15:13:18Z", "author": {"login": "mumrah"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/JmxReporter.java", "diffHunk": "@@ -71,8 +72,13 @@ public JmxReporter() {\n \n     /**\n      * Create a JMX reporter that prefixes all metrics with the given string.\n+     *  @deprecated Since 2.6.0. Use {@link JmxReporter#JmxReporter()}\n+     *  Initialize JmxReporter with {@link JmxReporter#contextChange(MetricsContext)}\n+     *  Populate prefix by adding _namespace/prefix key value pair to {@link MetricsContext}\n      */\n+    @Deprecated", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQzNjcyMQ=="}, "originalCommit": {"oid": "3e7cc54cbaab186e24f77d1d4f73b6cdc2e0910b"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NjAwOTA3OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/util/ConnectUtils.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNTowMjozMFrOGZvfSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNzo0MjozNlrOGapRwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NTY0MA==", "bodyText": "Standalone does not have a group.id property, since each standalone worker is its own single-node cluster. That means that this line can result in a null value for the metrics.context.connect.group.id entry in the props map.\nUnfortunately, there is no identifier for standalone workers. Is the metrics.context.connect.group.id property really required if the Standalone worker doesn't use any kind of coordination? It seems from other changes in ConnectMetrics that it is not required, in which case we should update the KIP to reflect that this property is only added in Connect distributed mode and we should correct the logic above to only add this property if it is non-null similar to the changes in ConnectMetrics.\nIf it is required, then we'll have to figure out something else.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429645640", "createdAt": "2020-05-24T15:02:30Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/util/ConnectUtils.java", "diffHunk": "@@ -65,4 +68,12 @@ static String lookupKafkaClusterId(Admin adminClient) {\n                                        + \"Check worker's broker connection and security properties.\", e);\n         }\n     }\n+\n+    public static void addMetricsContextProperties(Map<String, Object> prop, WorkerConfig config, String clusterId) {\n+        //add all properties predefined with \"metrics.context.\"\n+        prop.putAll(config.originalsWithPrefix(CommonClientConfigs.METRICS_CONTEXT_PREFIX, false));\n+        //add connect properties\n+        prop.put(CommonClientConfigs.METRICS_CONTEXT_PREFIX + WorkerConfig.CONNECT_KAFKA_CLUSTER_ID, clusterId);\n+        prop.put(CommonClientConfigs.METRICS_CONTEXT_PREFIX + WorkerConfig.CONNECT_GROUP_ID, config.originals().get(DistributedConfig.GROUP_ID_CONFIG));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NTc0NA==", "bodyText": "Speaking of this, it'd probably be worth adding unit tests for this method with both StandaloneConfig and DistributedConfig objects to verify this method adds the right properties to the supplied map.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429645744", "createdAt": "2020-05-24T15:03:41Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/util/ConnectUtils.java", "diffHunk": "@@ -65,4 +68,12 @@ static String lookupKafkaClusterId(Admin adminClient) {\n                                        + \"Check worker's broker connection and security properties.\", e);\n         }\n     }\n+\n+    public static void addMetricsContextProperties(Map<String, Object> prop, WorkerConfig config, String clusterId) {\n+        //add all properties predefined with \"metrics.context.\"\n+        prop.putAll(config.originalsWithPrefix(CommonClientConfigs.METRICS_CONTEXT_PREFIX, false));\n+        //add connect properties\n+        prop.put(CommonClientConfigs.METRICS_CONTEXT_PREFIX + WorkerConfig.CONNECT_KAFKA_CLUSTER_ID, clusterId);\n+        prop.put(CommonClientConfigs.METRICS_CONTEXT_PREFIX + WorkerConfig.CONNECT_GROUP_ID, config.originals().get(DistributedConfig.GROUP_ID_CONFIG));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NTY0MA=="}, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4MzQwOA==", "bodyText": "Added unit test in ConnectUtilsTest for StandAloneConfig and DistributedConfig.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429683408", "createdAt": "2020-05-24T22:59:32Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/util/ConnectUtils.java", "diffHunk": "@@ -65,4 +68,12 @@ static String lookupKafkaClusterId(Admin adminClient) {\n                                        + \"Check worker's broker connection and security properties.\", e);\n         }\n     }\n+\n+    public static void addMetricsContextProperties(Map<String, Object> prop, WorkerConfig config, String clusterId) {\n+        //add all properties predefined with \"metrics.context.\"\n+        prop.putAll(config.originalsWithPrefix(CommonClientConfigs.METRICS_CONTEXT_PREFIX, false));\n+        //add connect properties\n+        prop.put(CommonClientConfigs.METRICS_CONTEXT_PREFIX + WorkerConfig.CONNECT_KAFKA_CLUSTER_ID, clusterId);\n+        prop.put(CommonClientConfigs.METRICS_CONTEXT_PREFIX + WorkerConfig.CONNECT_GROUP_ID, config.originals().get(DistributedConfig.GROUP_ID_CONFIG));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NTY0MA=="}, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4MzQ3NQ==", "bodyText": "I'll leave KIP update to @xvrl", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429683475", "createdAt": "2020-05-24T23:00:25Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/util/ConnectUtils.java", "diffHunk": "@@ -65,4 +68,12 @@ static String lookupKafkaClusterId(Admin adminClient) {\n                                        + \"Check worker's broker connection and security properties.\", e);\n         }\n     }\n+\n+    public static void addMetricsContextProperties(Map<String, Object> prop, WorkerConfig config, String clusterId) {\n+        //add all properties predefined with \"metrics.context.\"\n+        prop.putAll(config.originalsWithPrefix(CommonClientConfigs.METRICS_CONTEXT_PREFIX, false));\n+        //add connect properties\n+        prop.put(CommonClientConfigs.METRICS_CONTEXT_PREFIX + WorkerConfig.CONNECT_KAFKA_CLUSTER_ID, clusterId);\n+        prop.put(CommonClientConfigs.METRICS_CONTEXT_PREFIX + WorkerConfig.CONNECT_GROUP_ID, config.originals().get(DistributedConfig.GROUP_ID_CONFIG));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NTY0MA=="}, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU5MjQ0OQ==", "bodyText": "@rhauch I've updated the KIP document, will send a follow-up email to announce the changes, once we finalize @mumrah 's feedback", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430592449", "createdAt": "2020-05-26T17:42:36Z", "author": {"login": "xvrl"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/util/ConnectUtils.java", "diffHunk": "@@ -65,4 +68,12 @@ static String lookupKafkaClusterId(Admin adminClient) {\n                                        + \"Check worker's broker connection and security properties.\", e);\n         }\n     }\n+\n+    public static void addMetricsContextProperties(Map<String, Object> prop, WorkerConfig config, String clusterId) {\n+        //add all properties predefined with \"metrics.context.\"\n+        prop.putAll(config.originalsWithPrefix(CommonClientConfigs.METRICS_CONTEXT_PREFIX, false));\n+        //add connect properties\n+        prop.put(CommonClientConfigs.METRICS_CONTEXT_PREFIX + WorkerConfig.CONNECT_KAFKA_CLUSTER_ID, clusterId);\n+        prop.put(CommonClientConfigs.METRICS_CONTEXT_PREFIX + WorkerConfig.CONNECT_GROUP_ID, config.originals().get(DistributedConfig.GROUP_ID_CONFIG));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NTY0MA=="}, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NjAxMTQ3OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/WorkerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNTowNjowOFrOGZvgiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQyMjo1ODo0OVrOGZxyqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NTk2Mw==", "bodyText": "This group.id property is not defined in StandaloneConfig. See my earlier comment.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429645963", "createdAt": "2020-05-24T15:06:08Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/WorkerTest.java", "diffHunk": "@@ -153,6 +164,7 @@ public void setup() {\n         workerProps.put(\"config.providers.file.class\", MockFileConfigProvider.class.getName());\n         mockFileProviderTestId = UUID.randomUUID().toString();\n         workerProps.put(\"config.providers.file.param.testId\", mockFileProviderTestId);\n+        workerProps.put(\"group.id\", GROUP_ID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4MzM3MA==", "bodyText": "Removed group.id and related check.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429683370", "createdAt": "2020-05-24T22:58:49Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/WorkerTest.java", "diffHunk": "@@ -153,6 +164,7 @@ public void setup() {\n         workerProps.put(\"config.providers.file.class\", MockFileConfigProvider.class.getName());\n         mockFileProviderTestId = UUID.randomUUID().toString();\n         workerProps.put(\"config.providers.file.param.testId\", mockFileProviderTestId);\n+        workerProps.put(\"group.id\", GROUP_ID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NTk2Mw=="}, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NjAxOTcyOnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/storage/KafkaStatusBackingStoreFormatTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNToxOToyMVrOGZvlMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQyMjo1ODoyOFrOGZxylA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NzE1NQ==", "bodyText": "This is unused.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429647155", "createdAt": "2020-05-24T15:19:21Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/storage/KafkaStatusBackingStoreFormatTest.java", "diffHunk": "@@ -59,6 +59,7 @@\n     private static final String FOO_TOPIC = \"foo-topic\";\n     private static final String FOO_CONNECTOR = \"foo-source\";\n     private static final String BAR_TOPIC = \"bar-topic\";\n+    private static final String CLUSTER_ID = \"cluster-1\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4MzM0OA==", "bodyText": "Removed.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429683348", "createdAt": "2020-05-24T22:58:28Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/storage/KafkaStatusBackingStoreFormatTest.java", "diffHunk": "@@ -59,6 +59,7 @@\n     private static final String FOO_TOPIC = \"foo-topic\";\n     private static final String FOO_CONNECTOR = \"foo-source\";\n     private static final String BAR_TOPIC = \"bar-topic\";\n+    private static final String CLUSTER_ID = \"cluster-1\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NzE1NQ=="}, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NjAxOTc3OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/storage/KafkaStatusBackingStoreTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNToxOTozMFrOGZvlOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQyMzowMDo1OVrOGZxzRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NzE2Mw==", "bodyText": "This is unused.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429647163", "createdAt": "2020-05-24T15:19:30Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/storage/KafkaStatusBackingStoreTest.java", "diffHunk": "@@ -63,6 +63,7 @@\n \n     private static final String STATUS_TOPIC = \"status-topic\";\n     private static final String WORKER_ID = \"localhost:8083\";\n+    private static final String CLUSTER_ID = \"cluster-1\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4MzUyNw==", "bodyText": "Removed", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429683527", "createdAt": "2020-05-24T23:00:59Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/storage/KafkaStatusBackingStoreTest.java", "diffHunk": "@@ -63,6 +63,7 @@\n \n     private static final String STATUS_TOPIC = \"status-topic\";\n     private static final String WORKER_ID = \"localhost:8083\";\n+    private static final String CLUSTER_ID = \"cluster-1\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NzE2Mw=="}, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NjAyMjkxOnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMember.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNToyNDozMFrOGZvnBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQyMjo1ODoxNVrOGZxyjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NzYyMg==", "bodyText": "Nit: this doesn't follow our conventions: we don't use the get* style getters, and if this is only used in unit tests we should make this package protected instead this should be:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                /**\n          \n          \n            \n                 * Method for unit tests\n          \n          \n            \n                 * @return\n          \n          \n            \n                 */\n          \n          \n            \n                public Metrics getMetrics() {\n          \n          \n            \n                    return this.metrics;\n          \n          \n            \n                }\n          \n          \n            \n                // Visible for testing\n          \n          \n            \n                Metrics metrics() {\n          \n          \n            \n                    return this.metrics;\n          \n          \n            \n                }\n          \n      \n    \n    \n  \n\nYou'll have to change the WorkerGroupMemberTest accordingly.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429647622", "createdAt": "2020-05-24T15:24:30Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMember.java", "diffHunk": "@@ -223,4 +235,12 @@ private void stop(boolean swallowException) {\n         else\n             log.debug(\"The Connect group member has stopped.\");\n     }\n+\n+    /**\n+     * Method for unit tests\n+     * @return\n+     */\n+    public Metrics getMetrics() {\n+        return this.metrics;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4MzM0MA==", "bodyText": "Renamed this method to metrics() and make it protected.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429683340", "createdAt": "2020-05-24T22:58:15Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMember.java", "diffHunk": "@@ -223,4 +235,12 @@ private void stop(boolean swallowException) {\n         else\n             log.debug(\"The Connect group member has stopped.\");\n     }\n+\n+    /**\n+     * Method for unit tests\n+     * @return\n+     */\n+    public Metrics getMetrics() {\n+        return this.metrics;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NzYyMg=="}, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NjAyMzM5OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNToyNToxMFrOGZvnQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNToyNToxMFrOGZvnQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NzY4MQ==", "bodyText": "Per a previous suggestion:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    MetricName name = member.getMetrics().metricName(\"test.avg\", \"grp1\");\n          \n          \n            \n                    MetricName name = member.metrics().metricName(\"test.avg\", \"grp1\");", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429647681", "createdAt": "2020-05-24T15:25:10Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.connect.runtime.distributed;\n+\n+import org.apache.kafka.clients.CommonClientConfigs;\n+import org.apache.kafka.common.MetricName;\n+import org.apache.kafka.common.metrics.MetricsReporter;\n+import org.apache.kafka.common.metrics.stats.Avg;\n+import org.apache.kafka.common.utils.LogContext;\n+import org.apache.kafka.common.utils.Time;\n+import org.apache.kafka.connect.runtime.MockConnectMetrics;\n+import org.apache.kafka.connect.runtime.WorkerConfig;\n+import org.apache.kafka.connect.storage.ConfigBackingStore;\n+import org.apache.kafka.connect.storage.StatusBackingStore;\n+import org.apache.kafka.connect.util.ConnectUtils;\n+import org.easymock.EasyMock;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.api.easymock.PowerMock;\n+import org.powermock.api.easymock.annotation.Mock;\n+import org.powermock.core.classloader.annotations.PowerMockIgnore;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import javax.management.MBeanServer;\n+import javax.management.ObjectName;\n+import java.lang.management.ManagementFactory;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({ConnectUtils.class})\n+@PowerMockIgnore({\"javax.management.*\", \"javax.crypto.*\"})\n+public class WorkerGroupMemberTest {\n+    @Mock\n+    private ConfigBackingStore configBackingStore;\n+    @Mock\n+    private StatusBackingStore statusBackingStore;\n+\n+    @Test\n+    public void testMetrics() throws Exception {\n+        WorkerGroupMember member;\n+        Map<String, String> workerProps = new HashMap<>();\n+        workerProps.put(\"key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"internal.value.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"offset.storage.file.filename\", \"/tmp/connect.offsets\");\n+        workerProps.put(\"group.id\", \"group-1\");\n+        workerProps.put(\"offset.storage.topic\", \"topic-1\");\n+        workerProps.put(\"config.storage.topic\", \"topic-1\");\n+        workerProps.put(\"status.storage.topic\", \"topic-1\");\n+        workerProps.put(CommonClientConfigs.METRIC_REPORTER_CLASSES_CONFIG, MockConnectMetrics.MockMetricsReporter.class.getName());\n+        DistributedConfig config = new DistributedConfig(workerProps);\n+\n+\n+        LogContext logContext = new LogContext(\"[Worker clientId=client-1 + groupId= group-1]\");\n+\n+        expectClusterId();\n+\n+        member = new WorkerGroupMember(config, \"\", configBackingStore,\n+        null, Time.SYSTEM, \"client-1\", logContext);\n+\n+        for (MetricsReporter reporter : member.getMetrics().reporters()) {\n+            if (reporter instanceof MockConnectMetrics.MockMetricsReporter) {\n+                MockConnectMetrics.MockMetricsReporter mockMetricsReporter = (MockConnectMetrics.MockMetricsReporter) reporter;\n+                assertEquals(\"cluster-1\", mockMetricsReporter.getMetricsContext().metadata().get(WorkerConfig.CONNECT_KAFKA_CLUSTER_ID));\n+                assertEquals(\"group-1\", mockMetricsReporter.getMetricsContext().metadata().get(WorkerConfig.CONNECT_GROUP_ID));\n+            }\n+        }\n+\n+        MetricName name = member.getMetrics().metricName(\"test.avg\", \"grp1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NjAyMzYxOnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNToyNToyOFrOGZvnYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNToyNToyOFrOGZvnYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NzcxMw==", "bodyText": "Per a previous suggestion:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for (MetricsReporter reporter : member.getMetrics().reporters()) {\n          \n          \n            \n                    for (MetricsReporter reporter : member.metrics().reporters()) {", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429647713", "createdAt": "2020-05-24T15:25:28Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.connect.runtime.distributed;\n+\n+import org.apache.kafka.clients.CommonClientConfigs;\n+import org.apache.kafka.common.MetricName;\n+import org.apache.kafka.common.metrics.MetricsReporter;\n+import org.apache.kafka.common.metrics.stats.Avg;\n+import org.apache.kafka.common.utils.LogContext;\n+import org.apache.kafka.common.utils.Time;\n+import org.apache.kafka.connect.runtime.MockConnectMetrics;\n+import org.apache.kafka.connect.runtime.WorkerConfig;\n+import org.apache.kafka.connect.storage.ConfigBackingStore;\n+import org.apache.kafka.connect.storage.StatusBackingStore;\n+import org.apache.kafka.connect.util.ConnectUtils;\n+import org.easymock.EasyMock;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.api.easymock.PowerMock;\n+import org.powermock.api.easymock.annotation.Mock;\n+import org.powermock.core.classloader.annotations.PowerMockIgnore;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import javax.management.MBeanServer;\n+import javax.management.ObjectName;\n+import java.lang.management.ManagementFactory;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({ConnectUtils.class})\n+@PowerMockIgnore({\"javax.management.*\", \"javax.crypto.*\"})\n+public class WorkerGroupMemberTest {\n+    @Mock\n+    private ConfigBackingStore configBackingStore;\n+    @Mock\n+    private StatusBackingStore statusBackingStore;\n+\n+    @Test\n+    public void testMetrics() throws Exception {\n+        WorkerGroupMember member;\n+        Map<String, String> workerProps = new HashMap<>();\n+        workerProps.put(\"key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"internal.value.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"offset.storage.file.filename\", \"/tmp/connect.offsets\");\n+        workerProps.put(\"group.id\", \"group-1\");\n+        workerProps.put(\"offset.storage.topic\", \"topic-1\");\n+        workerProps.put(\"config.storage.topic\", \"topic-1\");\n+        workerProps.put(\"status.storage.topic\", \"topic-1\");\n+        workerProps.put(CommonClientConfigs.METRIC_REPORTER_CLASSES_CONFIG, MockConnectMetrics.MockMetricsReporter.class.getName());\n+        DistributedConfig config = new DistributedConfig(workerProps);\n+\n+\n+        LogContext logContext = new LogContext(\"[Worker clientId=client-1 + groupId= group-1]\");\n+\n+        expectClusterId();\n+\n+        member = new WorkerGroupMember(config, \"\", configBackingStore,\n+        null, Time.SYSTEM, \"client-1\", logContext);\n+\n+        for (MetricsReporter reporter : member.getMetrics().reporters()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NjAyMzk2OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNToyNTo1M1rOGZvnjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxNToyNTo1M1rOGZvnjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0Nzc1OA==", "bodyText": "Per a previous suggestion:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    member.getMetrics().addMetric(name, new Avg());\n          \n          \n            \n                    member.metrics().addMetric(name, new Avg());", "url": "https://github.com/apache/kafka/pull/8691#discussion_r429647758", "createdAt": "2020-05-24T15:25:53Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.connect.runtime.distributed;\n+\n+import org.apache.kafka.clients.CommonClientConfigs;\n+import org.apache.kafka.common.MetricName;\n+import org.apache.kafka.common.metrics.MetricsReporter;\n+import org.apache.kafka.common.metrics.stats.Avg;\n+import org.apache.kafka.common.utils.LogContext;\n+import org.apache.kafka.common.utils.Time;\n+import org.apache.kafka.connect.runtime.MockConnectMetrics;\n+import org.apache.kafka.connect.runtime.WorkerConfig;\n+import org.apache.kafka.connect.storage.ConfigBackingStore;\n+import org.apache.kafka.connect.storage.StatusBackingStore;\n+import org.apache.kafka.connect.util.ConnectUtils;\n+import org.easymock.EasyMock;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.api.easymock.PowerMock;\n+import org.powermock.api.easymock.annotation.Mock;\n+import org.powermock.core.classloader.annotations.PowerMockIgnore;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import javax.management.MBeanServer;\n+import javax.management.ObjectName;\n+import java.lang.management.ManagementFactory;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({ConnectUtils.class})\n+@PowerMockIgnore({\"javax.management.*\", \"javax.crypto.*\"})\n+public class WorkerGroupMemberTest {\n+    @Mock\n+    private ConfigBackingStore configBackingStore;\n+    @Mock\n+    private StatusBackingStore statusBackingStore;\n+\n+    @Test\n+    public void testMetrics() throws Exception {\n+        WorkerGroupMember member;\n+        Map<String, String> workerProps = new HashMap<>();\n+        workerProps.put(\"key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"internal.value.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"offset.storage.file.filename\", \"/tmp/connect.offsets\");\n+        workerProps.put(\"group.id\", \"group-1\");\n+        workerProps.put(\"offset.storage.topic\", \"topic-1\");\n+        workerProps.put(\"config.storage.topic\", \"topic-1\");\n+        workerProps.put(\"status.storage.topic\", \"topic-1\");\n+        workerProps.put(CommonClientConfigs.METRIC_REPORTER_CLASSES_CONFIG, MockConnectMetrics.MockMetricsReporter.class.getName());\n+        DistributedConfig config = new DistributedConfig(workerProps);\n+\n+\n+        LogContext logContext = new LogContext(\"[Worker clientId=client-1 + groupId= group-1]\");\n+\n+        expectClusterId();\n+\n+        member = new WorkerGroupMember(config, \"\", configBackingStore,\n+        null, Time.SYSTEM, \"client-1\", logContext);\n+\n+        for (MetricsReporter reporter : member.getMetrics().reporters()) {\n+            if (reporter instanceof MockConnectMetrics.MockMetricsReporter) {\n+                MockConnectMetrics.MockMetricsReporter mockMetricsReporter = (MockConnectMetrics.MockMetricsReporter) reporter;\n+                assertEquals(\"cluster-1\", mockMetricsReporter.getMetricsContext().metadata().get(WorkerConfig.CONNECT_KAFKA_CLUSTER_ID));\n+                assertEquals(\"group-1\", mockMetricsReporter.getMetricsContext().metadata().get(WorkerConfig.CONNECT_GROUP_ID));\n+            }\n+        }\n+\n+        MetricName name = member.getMetrics().metricName(\"test.avg\", \"grp1\");\n+        member.getMetrics().addMetric(name, new Avg());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd58373bfadd9c0ad1adf1457d647edfcc8cd7d6"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MjUwNTQ2OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/ConnectMetrics.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOTo0Nzo0MVrOGat1VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDo1ODowNVrOGawFBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY2NzA5Mw==", "bodyText": "Need to add the parameter to the JavaDoc:\n@param clusterId  the Kafka cluster ID", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430667093", "createdAt": "2020-05-26T19:47:41Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/ConnectMetrics.java", "diffHunk": "@@ -63,7 +67,7 @@\n      * @param config   the worker configuration; may not be null\n      * @param time     the time; may not be null\n      */\n-    public ConnectMetrics(String workerId, WorkerConfig config, Time time) {\n+    public ConnectMetrics(String workerId, WorkerConfig config, Time time, String clusterId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8c5d2aee1d42260eb5f7567b6328ca475810124"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwMzg3OQ==", "bodyText": "Updated javadoc.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430703879", "createdAt": "2020-05-26T20:58:05Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/ConnectMetrics.java", "diffHunk": "@@ -63,7 +67,7 @@\n      * @param config   the worker configuration; may not be null\n      * @param time     the time; may not be null\n      */\n-    public ConnectMetrics(String workerId, WorkerConfig config, Time time) {\n+    public ConnectMetrics(String workerId, WorkerConfig config, Time time, String clusterId) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY2NzA5Mw=="}, "originalCommit": {"oid": "d8c5d2aee1d42260eb5f7567b6328ca475810124"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MjUzMTE1OnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/storage/KafkaOffsetBackingStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOTo1NTowNFrOGauF3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDo1NTo1NVrOGawAsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY3MTMyNA==", "bodyText": "Should we use ConnectUtils.addMetricsContextProperties(adminProps, config, clusterId) a few lines below this? (See the similar changes you made in KafkaStatusBackingStore and KafkaConfigBackingStore.)", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430671324", "createdAt": "2020-05-26T19:55:04Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/storage/KafkaOffsetBackingStore.java", "diffHunk": "@@ -66,20 +67,22 @@ public void configure(final WorkerConfig config) {\n         if (topic == null || topic.trim().length() == 0)\n             throw new ConfigException(\"Offset storage topic must be specified\");\n \n+        String clusterId = ConnectUtils.lookupKafkaClusterId(config);\n         data = new HashMap<>();\n \n         Map<String, Object> originals = config.originals();\n         Map<String, Object> producerProps = new HashMap<>(originals);\n         producerProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, ByteArraySerializer.class.getName());\n         producerProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, ByteArraySerializer.class.getName());\n         producerProps.put(ProducerConfig.DELIVERY_TIMEOUT_MS_CONFIG, Integer.MAX_VALUE);\n+        ConnectUtils.addMetricsContextProperties(producerProps, config, clusterId);\n \n         Map<String, Object> consumerProps = new HashMap<>(originals);\n         consumerProps.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, ByteArrayDeserializer.class.getName());\n         consumerProps.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, ByteArrayDeserializer.class.getName());\n+        ConnectUtils.addMetricsContextProperties(consumerProps, config, clusterId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8c5d2aee1d42260eb5f7567b6328ca475810124"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwMjc2OQ==", "bodyText": "Nice catch, fixed.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430702769", "createdAt": "2020-05-26T20:55:55Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/storage/KafkaOffsetBackingStore.java", "diffHunk": "@@ -66,20 +67,22 @@ public void configure(final WorkerConfig config) {\n         if (topic == null || topic.trim().length() == 0)\n             throw new ConfigException(\"Offset storage topic must be specified\");\n \n+        String clusterId = ConnectUtils.lookupKafkaClusterId(config);\n         data = new HashMap<>();\n \n         Map<String, Object> originals = config.originals();\n         Map<String, Object> producerProps = new HashMap<>(originals);\n         producerProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, ByteArraySerializer.class.getName());\n         producerProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, ByteArraySerializer.class.getName());\n         producerProps.put(ProducerConfig.DELIVERY_TIMEOUT_MS_CONFIG, Integer.MAX_VALUE);\n+        ConnectUtils.addMetricsContextProperties(producerProps, config, clusterId);\n \n         Map<String, Object> consumerProps = new HashMap<>(originals);\n         consumerProps.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, ByteArrayDeserializer.class.getName());\n         consumerProps.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, ByteArrayDeserializer.class.getName());\n+        ConnectUtils.addMetricsContextProperties(consumerProps, config, clusterId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY3MTMyNA=="}, "originalCommit": {"oid": "d8c5d2aee1d42260eb5f7567b6328ca475810124"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MjU0NTQyOnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOTo1OToxN1rOGauO9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDo1NjozMlrOGawB2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY3MzY1Mw==", "bodyText": "Let's remove these deprecated configs.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    workerProps.put(\"internal.key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n          \n          \n            \n                    workerProps.put(\"internal.value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n          \n          \n            \n                    workerProps.put(\"internal.key.converter.schemas.enable\", \"false\");\n          \n          \n            \n                    workerProps.put(\"internal.value.converter.schemas.enable\", \"false\");", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430673653", "createdAt": "2020-05-26T19:59:17Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.connect.runtime.distributed;\n+\n+import org.apache.kafka.clients.CommonClientConfigs;\n+import org.apache.kafka.common.MetricName;\n+import org.apache.kafka.common.metrics.MetricsReporter;\n+import org.apache.kafka.common.metrics.stats.Avg;\n+import org.apache.kafka.common.utils.LogContext;\n+import org.apache.kafka.common.utils.Time;\n+import org.apache.kafka.connect.runtime.MockConnectMetrics;\n+import org.apache.kafka.connect.runtime.WorkerConfig;\n+import org.apache.kafka.connect.storage.ConfigBackingStore;\n+import org.apache.kafka.connect.storage.StatusBackingStore;\n+import org.apache.kafka.connect.util.ConnectUtils;\n+import org.easymock.EasyMock;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.api.easymock.PowerMock;\n+import org.powermock.api.easymock.annotation.Mock;\n+import org.powermock.core.classloader.annotations.PowerMockIgnore;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import javax.management.MBeanServer;\n+import javax.management.ObjectName;\n+import java.lang.management.ManagementFactory;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({ConnectUtils.class})\n+@PowerMockIgnore({\"javax.management.*\", \"javax.crypto.*\"})\n+public class WorkerGroupMemberTest {\n+    @Mock\n+    private ConfigBackingStore configBackingStore;\n+    @Mock\n+    private StatusBackingStore statusBackingStore;\n+\n+    @Test\n+    public void testMetrics() throws Exception {\n+        WorkerGroupMember member;\n+        Map<String, String> workerProps = new HashMap<>();\n+        workerProps.put(\"key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"internal.value.converter.schemas.enable\", \"false\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8c5d2aee1d42260eb5f7567b6328ca475810124"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwMzA2Ng==", "bodyText": "Removed deprecated configs.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430703066", "createdAt": "2020-05-26T20:56:32Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.connect.runtime.distributed;\n+\n+import org.apache.kafka.clients.CommonClientConfigs;\n+import org.apache.kafka.common.MetricName;\n+import org.apache.kafka.common.metrics.MetricsReporter;\n+import org.apache.kafka.common.metrics.stats.Avg;\n+import org.apache.kafka.common.utils.LogContext;\n+import org.apache.kafka.common.utils.Time;\n+import org.apache.kafka.connect.runtime.MockConnectMetrics;\n+import org.apache.kafka.connect.runtime.WorkerConfig;\n+import org.apache.kafka.connect.storage.ConfigBackingStore;\n+import org.apache.kafka.connect.storage.StatusBackingStore;\n+import org.apache.kafka.connect.util.ConnectUtils;\n+import org.easymock.EasyMock;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.api.easymock.PowerMock;\n+import org.powermock.api.easymock.annotation.Mock;\n+import org.powermock.core.classloader.annotations.PowerMockIgnore;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import javax.management.MBeanServer;\n+import javax.management.ObjectName;\n+import java.lang.management.ManagementFactory;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({ConnectUtils.class})\n+@PowerMockIgnore({\"javax.management.*\", \"javax.crypto.*\"})\n+public class WorkerGroupMemberTest {\n+    @Mock\n+    private ConfigBackingStore configBackingStore;\n+    @Mock\n+    private StatusBackingStore statusBackingStore;\n+\n+    @Test\n+    public void testMetrics() throws Exception {\n+        WorkerGroupMember member;\n+        Map<String, String> workerProps = new HashMap<>();\n+        workerProps.put(\"key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"internal.value.converter.schemas.enable\", \"false\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY3MzY1Mw=="}, "originalCommit": {"oid": "d8c5d2aee1d42260eb5f7567b6328ca475810124"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MjU1MTUzOnYy", "diffSide": "RIGHT", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDowMToxOFrOGauTDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDo1NjoxMVrOGawBLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY3NDcwMw==", "bodyText": "It might be good to verify that we entered the if (reporter instance Mock...) block at least once. Otherwise, we might have a bug elsewhere that failed to instantiate the MockMetricsReporter class, and this portion of the test would still pass.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430674703", "createdAt": "2020-05-26T20:01:18Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.connect.runtime.distributed;\n+\n+import org.apache.kafka.clients.CommonClientConfigs;\n+import org.apache.kafka.common.MetricName;\n+import org.apache.kafka.common.metrics.MetricsReporter;\n+import org.apache.kafka.common.metrics.stats.Avg;\n+import org.apache.kafka.common.utils.LogContext;\n+import org.apache.kafka.common.utils.Time;\n+import org.apache.kafka.connect.runtime.MockConnectMetrics;\n+import org.apache.kafka.connect.runtime.WorkerConfig;\n+import org.apache.kafka.connect.storage.ConfigBackingStore;\n+import org.apache.kafka.connect.storage.StatusBackingStore;\n+import org.apache.kafka.connect.util.ConnectUtils;\n+import org.easymock.EasyMock;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.api.easymock.PowerMock;\n+import org.powermock.api.easymock.annotation.Mock;\n+import org.powermock.core.classloader.annotations.PowerMockIgnore;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import javax.management.MBeanServer;\n+import javax.management.ObjectName;\n+import java.lang.management.ManagementFactory;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({ConnectUtils.class})\n+@PowerMockIgnore({\"javax.management.*\", \"javax.crypto.*\"})\n+public class WorkerGroupMemberTest {\n+    @Mock\n+    private ConfigBackingStore configBackingStore;\n+    @Mock\n+    private StatusBackingStore statusBackingStore;\n+\n+    @Test\n+    public void testMetrics() throws Exception {\n+        WorkerGroupMember member;\n+        Map<String, String> workerProps = new HashMap<>();\n+        workerProps.put(\"key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"internal.value.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"offset.storage.file.filename\", \"/tmp/connect.offsets\");\n+        workerProps.put(\"group.id\", \"group-1\");\n+        workerProps.put(\"offset.storage.topic\", \"topic-1\");\n+        workerProps.put(\"config.storage.topic\", \"topic-1\");\n+        workerProps.put(\"status.storage.topic\", \"topic-1\");\n+        workerProps.put(CommonClientConfigs.METRIC_REPORTER_CLASSES_CONFIG, MockConnectMetrics.MockMetricsReporter.class.getName());\n+        DistributedConfig config = new DistributedConfig(workerProps);\n+\n+\n+        LogContext logContext = new LogContext(\"[Worker clientId=client-1 + groupId= group-1]\");\n+\n+        expectClusterId();\n+\n+        member = new WorkerGroupMember(config, \"\", configBackingStore,\n+        null, Time.SYSTEM, \"client-1\", logContext);\n+\n+        for (MetricsReporter reporter : member.metrics().reporters()) {\n+            if (reporter instanceof MockConnectMetrics.MockMetricsReporter) {\n+                MockConnectMetrics.MockMetricsReporter mockMetricsReporter = (MockConnectMetrics.MockMetricsReporter) reporter;\n+                assertEquals(\"cluster-1\", mockMetricsReporter.getMetricsContext().metadata().get(WorkerConfig.CONNECT_KAFKA_CLUSTER_ID));\n+                assertEquals(\"group-1\", mockMetricsReporter.getMetricsContext().metadata().get(WorkerConfig.CONNECT_GROUP_ID));\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8c5d2aee1d42260eb5f7567b6328ca475810124"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwMjg5NQ==", "bodyText": "Added verification.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430702895", "createdAt": "2020-05-26T20:56:11Z", "author": {"login": "xiaodongdu"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/distributed/WorkerGroupMemberTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.connect.runtime.distributed;\n+\n+import org.apache.kafka.clients.CommonClientConfigs;\n+import org.apache.kafka.common.MetricName;\n+import org.apache.kafka.common.metrics.MetricsReporter;\n+import org.apache.kafka.common.metrics.stats.Avg;\n+import org.apache.kafka.common.utils.LogContext;\n+import org.apache.kafka.common.utils.Time;\n+import org.apache.kafka.connect.runtime.MockConnectMetrics;\n+import org.apache.kafka.connect.runtime.WorkerConfig;\n+import org.apache.kafka.connect.storage.ConfigBackingStore;\n+import org.apache.kafka.connect.storage.StatusBackingStore;\n+import org.apache.kafka.connect.util.ConnectUtils;\n+import org.easymock.EasyMock;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.powermock.api.easymock.PowerMock;\n+import org.powermock.api.easymock.annotation.Mock;\n+import org.powermock.core.classloader.annotations.PowerMockIgnore;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import javax.management.MBeanServer;\n+import javax.management.ObjectName;\n+import java.lang.management.ManagementFactory;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({ConnectUtils.class})\n+@PowerMockIgnore({\"javax.management.*\", \"javax.crypto.*\"})\n+public class WorkerGroupMemberTest {\n+    @Mock\n+    private ConfigBackingStore configBackingStore;\n+    @Mock\n+    private StatusBackingStore statusBackingStore;\n+\n+    @Test\n+    public void testMetrics() throws Exception {\n+        WorkerGroupMember member;\n+        Map<String, String> workerProps = new HashMap<>();\n+        workerProps.put(\"key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.value.converter\", \"org.apache.kafka.connect.json.JsonConverter\");\n+        workerProps.put(\"internal.key.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"internal.value.converter.schemas.enable\", \"false\");\n+        workerProps.put(\"offset.storage.file.filename\", \"/tmp/connect.offsets\");\n+        workerProps.put(\"group.id\", \"group-1\");\n+        workerProps.put(\"offset.storage.topic\", \"topic-1\");\n+        workerProps.put(\"config.storage.topic\", \"topic-1\");\n+        workerProps.put(\"status.storage.topic\", \"topic-1\");\n+        workerProps.put(CommonClientConfigs.METRIC_REPORTER_CLASSES_CONFIG, MockConnectMetrics.MockMetricsReporter.class.getName());\n+        DistributedConfig config = new DistributedConfig(workerProps);\n+\n+\n+        LogContext logContext = new LogContext(\"[Worker clientId=client-1 + groupId= group-1]\");\n+\n+        expectClusterId();\n+\n+        member = new WorkerGroupMember(config, \"\", configBackingStore,\n+        null, Time.SYSTEM, \"client-1\", logContext);\n+\n+        for (MetricsReporter reporter : member.metrics().reporters()) {\n+            if (reporter instanceof MockConnectMetrics.MockMetricsReporter) {\n+                MockConnectMetrics.MockMetricsReporter mockMetricsReporter = (MockConnectMetrics.MockMetricsReporter) reporter;\n+                assertEquals(\"cluster-1\", mockMetricsReporter.getMetricsContext().metadata().get(WorkerConfig.CONNECT_KAFKA_CLUSTER_ID));\n+                assertEquals(\"group-1\", mockMetricsReporter.getMetricsContext().metadata().get(WorkerConfig.CONNECT_GROUP_ID));\n+            }\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY3NDcwMw=="}, "originalCommit": {"oid": "d8c5d2aee1d42260eb5f7567b6328ca475810124"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MjczOTM0OnYy", "diffSide": "RIGHT", "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMTowMToxMFrOGawLBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMToxNDowOVrOGawi0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwNTQxNQ==", "bodyText": "the prefix should be stripped before adding the fields to the context.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430705415", "createdAt": "2020-05-26T21:01:10Z", "author": {"login": "xvrl"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -384,6 +390,23 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n     clusterResourceListeners.onUpdate(new ClusterResource(clusterId))\n   }\n \n+  private[server] def notifyMetricsReporters(metricsReporters: Seq[AnyRef]): Unit = {\n+    val metricsContext = createKafkaMetricsContext()\n+    metricsReporters.foreach {\n+      case x: MetricsReporter => x.contextChange(metricsContext)\n+      case _ => //do nothing\n+    }\n+  }\n+\n+  private[server] def createKafkaMetricsContext() : KafkaMetricsContext = {\n+    val contextLabels = new util.HashMap[String, Object]\n+    contextLabels.put(KAFKA_CLUSTER_ID, clusterId)\n+    contextLabels.put(KAFKA_BROKER_ID, config.brokerId.toString)\n+    contextLabels.putAll(config.originalsWithPrefix(CommonClientConfigs.METRICS_CONTEXT_PREFIX, false))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a1cf89d14e7631467eae5bb88273653d27fbe9d"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcxMTUwNA==", "bodyText": "Fixed", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430711504", "createdAt": "2020-05-26T21:14:09Z", "author": {"login": "xiaodongdu"}, "path": "core/src/main/scala/kafka/server/KafkaServer.scala", "diffHunk": "@@ -384,6 +390,23 @@ class KafkaServer(val config: KafkaConfig, time: Time = Time.SYSTEM, threadNameP\n     clusterResourceListeners.onUpdate(new ClusterResource(clusterId))\n   }\n \n+  private[server] def notifyMetricsReporters(metricsReporters: Seq[AnyRef]): Unit = {\n+    val metricsContext = createKafkaMetricsContext()\n+    metricsReporters.foreach {\n+      case x: MetricsReporter => x.contextChange(metricsContext)\n+      case _ => //do nothing\n+    }\n+  }\n+\n+  private[server] def createKafkaMetricsContext() : KafkaMetricsContext = {\n+    val contextLabels = new util.HashMap[String, Object]\n+    contextLabels.put(KAFKA_CLUSTER_ID, clusterId)\n+    contextLabels.put(KAFKA_BROKER_ID, config.brokerId.toString)\n+    contextLabels.putAll(config.originalsWithPrefix(CommonClientConfigs.METRICS_CONTEXT_PREFIX, false))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwNTQxNQ=="}, "originalCommit": {"oid": "1a1cf89d14e7631467eae5bb88273653d27fbe9d"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Mjc3MDE3OnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsReporter.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMToxMTo1OFrOGaweyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNjoxMTo1MFrOGbSc5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcxMDQ3NA==", "bodyText": "someone on the ML commented that we might want to name this contextChanged (past tense). I don't have a strong feeling either way. Do you have any thoughts @mumrah @rhauch?", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430710474", "createdAt": "2020-05-26T21:11:58Z", "author": {"login": "xvrl"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsReporter.java", "diffHunk": "@@ -65,4 +66,12 @@ default void validateReconfiguration(Map<String, ?> configs) throws ConfigExcept\n     default void reconfigure(Map<String, ?> configs) {\n     }\n \n+    /**\n+     * Provides context labels for the service or library exposing metrics\n+     *\n+     * @param metricsContext the metric context\n+     */\n+    @InterfaceStability.Evolving\n+    default void contextChange(MetricsContext metricsContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a1cf89d14e7631467eae5bb88273653d27fbe9d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDczMTcxNg==", "bodyText": "I really don't have a strong preference. Past tense is a little odd, but I think changeContext(...) or setContext(...) are present-tense and more conventional.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430731716", "createdAt": "2020-05-26T22:00:09Z", "author": {"login": "rhauch"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsReporter.java", "diffHunk": "@@ -65,4 +66,12 @@ default void validateReconfiguration(Map<String, ?> configs) throws ConfigExcept\n     default void reconfigure(Map<String, ?> configs) {\n     }\n \n+    /**\n+     * Provides context labels for the service or library exposing metrics\n+     *\n+     * @param metricsContext the metric context\n+     */\n+    @InterfaceStability.Evolving\n+    default void contextChange(MetricsContext metricsContext) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcxMDQ3NA=="}, "originalCommit": {"oid": "1a1cf89d14e7631467eae5bb88273653d27fbe9d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NzMzMw==", "bodyText": "It would also be good to identify when this is called relative to other methods. For example, it is always called before init(...) is called. But can it be called again, or is that the only time this method is called?", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430767333", "createdAt": "2020-05-26T23:46:38Z", "author": {"login": "rhauch"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsReporter.java", "diffHunk": "@@ -65,4 +66,12 @@ default void validateReconfiguration(Map<String, ?> configs) throws ConfigExcept\n     default void reconfigure(Map<String, ?> configs) {\n     }\n \n+    /**\n+     * Provides context labels for the service or library exposing metrics\n+     *\n+     * @param metricsContext the metric context\n+     */\n+    @InterfaceStability.Evolving\n+    default void contextChange(MetricsContext metricsContext) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcxMDQ3NA=="}, "originalCommit": {"oid": "1a1cf89d14e7631467eae5bb88273653d27fbe9d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc3NDU0OA==", "bodyText": "due to the way jmxreporter is initialized in Kafka today, it already gets called both before and after init()", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430774548", "createdAt": "2020-05-27T00:11:32Z", "author": {"login": "xvrl"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsReporter.java", "diffHunk": "@@ -65,4 +66,12 @@ default void validateReconfiguration(Map<String, ?> configs) throws ConfigExcept\n     default void reconfigure(Map<String, ?> configs) {\n     }\n \n+    /**\n+     * Provides context labels for the service or library exposing metrics\n+     *\n+     * @param metricsContext the metric context\n+     */\n+    @InterfaceStability.Evolving\n+    default void contextChange(MetricsContext metricsContext) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcxMDQ3NA=="}, "originalCommit": {"oid": "1a1cf89d14e7631467eae5bb88273653d27fbe9d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg0MDU2OA==", "bodyText": "It can be called multiple times.  Not sure if we should mention that in Javadoc, other methods in this class we are not mention if it can be called multiple times even though they can be called multiple times.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430840568", "createdAt": "2020-05-27T03:43:34Z", "author": {"login": "xiaodongdu"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsReporter.java", "diffHunk": "@@ -65,4 +66,12 @@ default void validateReconfiguration(Map<String, ?> configs) throws ConfigExcept\n     default void reconfigure(Map<String, ?> configs) {\n     }\n \n+    /**\n+     * Provides context labels for the service or library exposing metrics\n+     *\n+     * @param metricsContext the metric context\n+     */\n+    @InterfaceStability.Evolving\n+    default void contextChange(MetricsContext metricsContext) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcxMDQ3NA=="}, "originalCommit": {"oid": "1a1cf89d14e7631467eae5bb88273653d27fbe9d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE5NDkxNQ==", "bodyText": "If there is no clear call pattern, then it's fine to not say anything. However, JmxReporter.contextChange(...) seems to assume that contextChange(...) will be called before any metrics are added via init(...).\nIf that call pattern is true, then I think we should document it. If it's also true it can be called later, then mention this as well. For example, the JavaDoc text on contextChange(...) could be something like:\n\nSets the context labels for the service or library that is exposing metrics.\nThis will be called before {@link #init(List)} and may be called anytime after that.\n\nWDYT?", "url": "https://github.com/apache/kafka/pull/8691#discussion_r431194915", "createdAt": "2020-05-27T14:47:14Z", "author": {"login": "rhauch"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsReporter.java", "diffHunk": "@@ -65,4 +66,12 @@ default void validateReconfiguration(Map<String, ?> configs) throws ConfigExcept\n     default void reconfigure(Map<String, ?> configs) {\n     }\n \n+    /**\n+     * Provides context labels for the service or library exposing metrics\n+     *\n+     * @param metricsContext the metric context\n+     */\n+    @InterfaceStability.Evolving\n+    default void contextChange(MetricsContext metricsContext) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcxMDQ3NA=="}, "originalCommit": {"oid": "1a1cf89d14e7631467eae5bb88273653d27fbe9d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI2NzA0NA==", "bodyText": "Sounds good. Updated javadoc.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r431267044", "createdAt": "2020-05-27T16:11:50Z", "author": {"login": "xiaodongdu"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsReporter.java", "diffHunk": "@@ -65,4 +66,12 @@ default void validateReconfiguration(Map<String, ?> configs) throws ConfigExcept\n     default void reconfigure(Map<String, ?> configs) {\n     }\n \n+    /**\n+     * Provides context labels for the service or library exposing metrics\n+     *\n+     * @param metricsContext the metric context\n+     */\n+    @InterfaceStability.Evolving\n+    default void contextChange(MetricsContext metricsContext) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcxMDQ3NA=="}, "originalCommit": {"oid": "1a1cf89d14e7631467eae5bb88273653d27fbe9d"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MzExNTY3OnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetricsContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzo0MTozOVrOGaz3Fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwMDo0MTo0OVrOGa06Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NTg0Ng==", "bodyText": "Need an override annotation here:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public Map<String, String> contextLabels() {\n          \n          \n            \n                @Override\n          \n          \n            \n                public Map<String, String> contextLabels() {", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430765846", "createdAt": "2020-05-26T23:41:39Z", "author": {"login": "rhauch"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetricsContext.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * A implementation of MetricsContext, it encapsulates required metrics context properties for Kafka services and clients\n+ */\n+public class KafkaMetricsContext implements MetricsContext {\n+    /**\n+     * Client or Service's contextLabels map.\n+     */\n+    private final Map<String, String> contextLabels = new HashMap<>();\n+\n+    /**\n+     * Create a MetricsContext with namespace, no service or client properties\n+     * @param namespace value for _namespace key\n+     */\n+    public KafkaMetricsContext(String namespace) {\n+        this(namespace, new HashMap<>());\n+    }\n+\n+    /**\n+     * Create a MetricsContext with namespace, service or client properties\n+     * @param namespace value for _namespace key\n+     * @param contextLabels  contextLabels additional entries to add to the context.\n+     *                  values will be converted to string using Object.toString()\n+     */\n+    public KafkaMetricsContext(String namespace, Map<String, ?> contextLabels) {\n+        this.contextLabels.put(MetricsContext.NAMESPACE, namespace);\n+        contextLabels.forEach((key, value) -> this.contextLabels.put(key, value.toString()));\n+    }\n+\n+    public Map<String, String> contextLabels() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f934729fe4db47f609e59d20399707c0a2d2190"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc4MzA1OA==", "bodyText": "Added annotation", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430783058", "createdAt": "2020-05-27T00:41:49Z", "author": {"login": "xiaodongdu"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetricsContext.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * A implementation of MetricsContext, it encapsulates required metrics context properties for Kafka services and clients\n+ */\n+public class KafkaMetricsContext implements MetricsContext {\n+    /**\n+     * Client or Service's contextLabels map.\n+     */\n+    private final Map<String, String> contextLabels = new HashMap<>();\n+\n+    /**\n+     * Create a MetricsContext with namespace, no service or client properties\n+     * @param namespace value for _namespace key\n+     */\n+    public KafkaMetricsContext(String namespace) {\n+        this(namespace, new HashMap<>());\n+    }\n+\n+    /**\n+     * Create a MetricsContext with namespace, service or client properties\n+     * @param namespace value for _namespace key\n+     * @param contextLabels  contextLabels additional entries to add to the context.\n+     *                  values will be converted to string using Object.toString()\n+     */\n+    public KafkaMetricsContext(String namespace, Map<String, ?> contextLabels) {\n+        this.contextLabels.put(MetricsContext.NAMESPACE, namespace);\n+        contextLabels.forEach((key, value) -> this.contextLabels.put(key, value.toString()));\n+    }\n+\n+    public Map<String, String> contextLabels() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NTg0Ng=="}, "originalCommit": {"oid": "6f934729fe4db47f609e59d20399707c0a2d2190"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MzExOTQzOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMzo0Mzo0MFrOGaz5Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwMDo0MTo1N1rOGa06dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NjQyNg==", "bodyText": "This JavaDoc is incomplete. Perhaps something like:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                 * Returns contextLabels fields\n          \n          \n            \n                 */\n          \n          \n            \n                Map<String, String> contextLabels();\n          \n          \n            \n                /**\n          \n          \n            \n                 * Returns the labels for this metrics context.\n          \n          \n            \n                 *\n          \n          \n            \n                 * @return the map of label keys and values; never null but possibly empty\n          \n          \n            \n                 */\n          \n          \n            \n                Map<String, String> contextLabels();", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430766426", "createdAt": "2020-05-26T23:43:40Z", "author": {"login": "rhauch"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional contextLabels about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The contextLabels map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {\n+    /* predefined fields */\n+    String NAMESPACE = \"_namespace\"; // metrics namespace, formerly jmx prefix\n+\n+    /**\n+     * Returns contextLabels fields\n+     */\n+    Map<String, String> contextLabels();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f934729fe4db47f609e59d20399707c0a2d2190"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc4MzA5NQ==", "bodyText": "Updated javadoc.", "url": "https://github.com/apache/kafka/pull/8691#discussion_r430783095", "createdAt": "2020-05-27T00:41:57Z", "author": {"login": "xiaodongdu"}, "path": "clients/src/main/java/org/apache/kafka/common/metrics/MetricsContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.metrics;\n+\n+import org.apache.kafka.common.annotation.InterfaceStability;\n+\n+import java.util.Map;\n+\n+/**\n+ * MetricsContext encapsulates additional contextLabels about metrics exposed via a\n+ * {@link org.apache.kafka.common.metrics.MetricsReporter}\n+ *\n+ * The contextLabels map provides following information:\n+ * - a <code>_namespace</node> field indicating the component exposing metrics\n+ *   e.g. kafka.server, kafka.consumer\n+ *   {@link JmxReporter} uses this as prefix for mbean names\n+ *\n+ * - for clients and streams libraries: any freeform fields passed in via\n+ *   client properties in the form of `metrics.context.<key>=<value>\n+ *\n+ * - for kafka brokers: kafka.broker.id, kafka.cluster.id\n+ * - for connect workers: connect.kafka.cluster.id, connect.group.id\n+ */\n+@InterfaceStability.Evolving\n+public interface MetricsContext {\n+    /* predefined fields */\n+    String NAMESPACE = \"_namespace\"; // metrics namespace, formerly jmx prefix\n+\n+    /**\n+     * Returns contextLabels fields\n+     */\n+    Map<String, String> contextLabels();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NjQyNg=="}, "originalCommit": {"oid": "6f934729fe4db47f609e59d20399707c0a2d2190"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2673, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}