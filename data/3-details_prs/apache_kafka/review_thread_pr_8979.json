{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MTM4NTI5", "number": 8979, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjoxODozNFrOEOBOdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMzozMToxNFrOEPiSvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMTM1NjA2OnYy", "diffSide": "RIGHT", "path": "core/src/main/scala/kafka/server/DelayedFetch.scala", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjoxODozNFrOGw8alw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxMjozMDozNlrOGxRhlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk3NDY3OQ==", "bodyText": "Can we remove this now?", "url": "https://github.com/apache/kafka/pull/8979#discussion_r453974679", "createdAt": "2020-07-13T22:18:34Z", "author": {"login": "ijuma"}, "path": "core/src/main/scala/kafka/server/DelayedFetch.scala", "diffHunk": "@@ -121,8 +120,8 @@ class DelayedFetch(delayMs: Long,\n             }\n           }\n         } catch {\n-          case _: NotLeaderForPartitionException =>  // Case A\n-            debug(s\"Broker is no longer the leader of $topicPartition, satisfy $fetchMetadata immediately\")\n+          case _: NotLeaderOrFollowerException =>  // Case A\n+            debug(s\"Broker is no longer the leader or follower of $topicPartition, satisfy $fetchMetadata immediately\")\n             return forceComplete()\n           case _: ReplicaNotAvailableException =>  // Case B", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDMyMDUzNQ==", "bodyText": "yes, done.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r454320535", "createdAt": "2020-07-14T12:30:36Z", "author": {"login": "rajinisivaram"}, "path": "core/src/main/scala/kafka/server/DelayedFetch.scala", "diffHunk": "@@ -121,8 +120,8 @@ class DelayedFetch(delayMs: Long,\n             }\n           }\n         } catch {\n-          case _: NotLeaderForPartitionException =>  // Case A\n-            debug(s\"Broker is no longer the leader of $topicPartition, satisfy $fetchMetadata immediately\")\n+          case _: NotLeaderOrFollowerException =>  // Case A\n+            debug(s\"Broker is no longer the leader or follower of $topicPartition, satisfy $fetchMetadata immediately\")\n             return forceComplete()\n           case _: ReplicaNotAvailableException =>  // Case B", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk3NDY3OQ=="}, "originalCommit": null, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMTM2MjQ1OnYy", "diffSide": "RIGHT", "path": "core/src/main/scala/kafka/server/ReplicaManager.scala", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjoxOTo1NVrOGw8duw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxMjozMToxNVrOGxRjVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk3NTQ4Mw==", "bodyText": "Would we want to change this for new IBPs?", "url": "https://github.com/apache/kafka/pull/8979#discussion_r453975483", "createdAt": "2020-07-13T22:19:55Z", "author": {"login": "ijuma"}, "path": "core/src/main/scala/kafka/server/ReplicaManager.scala", "diffHunk": "@@ -716,8 +712,12 @@ class ReplicaManager(val config: KafkaConfig,\n                   _: LogDirNotFoundException |\n                   _: ReplicaNotAvailableException |\n                   _: KafkaStorageException) =>\n-            warn(\"Unable to alter log dirs for %s\".format(topicPartition), e)\n+            warn(s\"Unable to alter log dirs for $topicPartition\", e)\n             (topicPartition, Errors.forException(e))\n+          case e: NotLeaderOrFollowerException =>\n+            // Retaining REPLICA_NOT_AVAILABLE exception for ALTER_REPLICA_LOG_DIRS for compatibility\n+            warn(s\"Unable to alter log dirs for $topicPartition\", e)\n+            (topicPartition, Errors.REPLICA_NOT_AVAILABLE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDMyMDk4Mw==", "bodyText": "Updated to change to NOT_LEADER_OR_FOLLOWER from 2.7 onwards. Also added note to upgrade docs.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r454320983", "createdAt": "2020-07-14T12:31:15Z", "author": {"login": "rajinisivaram"}, "path": "core/src/main/scala/kafka/server/ReplicaManager.scala", "diffHunk": "@@ -716,8 +712,12 @@ class ReplicaManager(val config: KafkaConfig,\n                   _: LogDirNotFoundException |\n                   _: ReplicaNotAvailableException |\n                   _: KafkaStorageException) =>\n-            warn(\"Unable to alter log dirs for %s\".format(topicPartition), e)\n+            warn(s\"Unable to alter log dirs for $topicPartition\", e)\n             (topicPartition, Errors.forException(e))\n+          case e: NotLeaderOrFollowerException =>\n+            // Retaining REPLICA_NOT_AVAILABLE exception for ALTER_REPLICA_LOG_DIRS for compatibility\n+            warn(s\"Unable to alter log dirs for $topicPartition\", e)\n+            (topicPartition, Errors.REPLICA_NOT_AVAILABLE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk3NTQ4Mw=="}, "originalCommit": null, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MDU5NjAzOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/errors/NotLeaderOrFollowerException.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMzowMjozMlrOGyUPFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOToxODoxMFrOGyiY2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQxMzUyNw==", "bodyText": "One nitpick on the naming. It seems a little strange that followers might return NOT_LEADER_OR_FOLLOWER for requests which are intended for the leader. I think my suggestion to frame the name around the broker not being the intended target of the request was a little more accurate, though I admit the name was clumsier. Perhaps this class would be a good place to document the semantics? Maybe worth mentioning the Produce/Fetch behavior explicitly.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r455413527", "createdAt": "2020-07-15T23:02:32Z", "author": {"login": "hachikuji"}, "path": "clients/src/main/java/org/apache/kafka/common/errors/NotLeaderOrFollowerException.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.errors;\n+\n+/**\n+ * This server is not the leader or follower for the given partition.\n+ * This could a transient exception during reassignments.\n+ */\n+@SuppressWarnings(\"deprecation\")\n+public class NotLeaderOrFollowerException extends NotLeaderForPartitionException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bcda5eb1adb331246de81fdb225540b990f557a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ4NjYxMg==", "bodyText": "Good point.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r455486612", "createdAt": "2020-07-16T03:23:10Z", "author": {"login": "ijuma"}, "path": "clients/src/main/java/org/apache/kafka/common/errors/NotLeaderOrFollowerException.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.errors;\n+\n+/**\n+ * This server is not the leader or follower for the given partition.\n+ * This could a transient exception during reassignments.\n+ */\n+@SuppressWarnings(\"deprecation\")\n+public class NotLeaderOrFollowerException extends NotLeaderForPartitionException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQxMzUyNw=="}, "originalCommit": {"oid": "8bcda5eb1adb331246de81fdb225540b990f557a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY0NTQwMg==", "bodyText": "Updated javadoc.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r455645402", "createdAt": "2020-07-16T09:18:10Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/main/java/org/apache/kafka/common/errors/NotLeaderOrFollowerException.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.errors;\n+\n+/**\n+ * This server is not the leader or follower for the given partition.\n+ * This could a transient exception during reassignments.\n+ */\n+@SuppressWarnings(\"deprecation\")\n+public class NotLeaderOrFollowerException extends NotLeaderForPartitionException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQxMzUyNw=="}, "originalCommit": {"oid": "8bcda5eb1adb331246de81fdb225540b990f557a"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MDYwMzEzOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/protocol/Errors.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMzowNToyNVrOGyUTIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMzowNToyNVrOGyUTIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQxNDU2Mg==", "bodyText": "This would also be a good place to be clearer about the interpretation of this error. Maybe something like this?\n\nFor requests intended only for the leader, this error indicates that the broker is not the current leader. For requests intended for any replica, this error indicates that the broker is not a replica of the topic partition.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r455414562", "createdAt": "2020-07-15T23:05:25Z", "author": {"login": "hachikuji"}, "path": "clients/src/main/java/org/apache/kafka/common/protocol/Errors.java", "diffHunk": "@@ -139,8 +139,8 @@\n             InvalidFetchSizeException::new),\n     LEADER_NOT_AVAILABLE(5, \"There is no leader for this topic-partition as we are in the middle of a leadership election.\",\n             LeaderNotAvailableException::new),\n-    NOT_LEADER_FOR_PARTITION(6, \"This server is not the leader for that topic-partition.\",\n-            NotLeaderForPartitionException::new),\n+    NOT_LEADER_OR_FOLLOWER(6, \"This server is not the leader or follower for that topic-partition.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bcda5eb1adb331246de81fdb225540b990f557a"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MDYxNjg0OnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/protocol/Errors.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMzoxMToxOVrOGyUa2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMzoxMToxOVrOGyUa2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQxNjUzNg==", "bodyText": "Is it worth adding a note about the use of REPLICA_NOT_AVAILABLE below? I think we are effectively deprecating its usage in this PR.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r455416536", "createdAt": "2020-07-15T23:11:19Z", "author": {"login": "hachikuji"}, "path": "clients/src/main/java/org/apache/kafka/common/protocol/Errors.java", "diffHunk": "@@ -139,8 +139,8 @@\n             InvalidFetchSizeException::new),\n     LEADER_NOT_AVAILABLE(5, \"There is no leader for this topic-partition as we are in the middle of a leadership election.\",\n             LeaderNotAvailableException::new),\n-    NOT_LEADER_FOR_PARTITION(6, \"This server is not the leader for that topic-partition.\",\n-            NotLeaderForPartitionException::new),\n+    NOT_LEADER_OR_FOLLOWER(6, \"This server is not the leader or follower for that topic-partition.\",\n+            NotLeaderOrFollowerException::new),\n     REQUEST_TIMED_OUT(7, \"The request timed out.\",\n             TimeoutException::new),\n     BROKER_NOT_AVAILABLE(8, \"The broker is not available.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bcda5eb1adb331246de81fdb225540b990f557a"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MDYzNjg2OnYy", "diffSide": "RIGHT", "path": "core/src/main/scala/kafka/server/ReplicaManager.scala", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMzoyMDoxOVrOGyUmZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOToxNzoyNVrOGyiXOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQxOTQ5NQ==", "bodyText": "Hmm.. Wouldn't it make more sense to tie this to a version bump to this protocol rather than the IBP?", "url": "https://github.com/apache/kafka/pull/8979#discussion_r455419495", "createdAt": "2020-07-15T23:20:19Z", "author": {"login": "hachikuji"}, "path": "core/src/main/scala/kafka/server/ReplicaManager.scala", "diffHunk": "@@ -712,10 +708,13 @@ class ReplicaManager(val config: KafkaConfig,\n         } catch {\n           case e@(_: InvalidTopicException |\n                   _: LogDirNotFoundException |\n-                  _: ReplicaNotAvailableException |\n                   _: KafkaStorageException) =>\n-            warn(\"Unable to alter log dirs for %s\".format(topicPartition), e)\n+            warn(s\"Unable to alter log dirs for $topicPartition\", e)\n             (topicPartition, Errors.forException(e))\n+          case e: NotLeaderOrFollowerException =>\n+            warn(s\"Unable to alter log dirs for $topicPartition\", e)\n+            // Retaining REPLICA_NOT_AVAILABLE exception for ALTER_REPLICA_LOG_DIRS for older versions for compatibility\n+            (topicPartition, if (config.interBrokerProtocolVersion >= KAFKA_2_7_IV0) Errors.NOT_LEADER_OR_FOLLOWER else Errors.REPLICA_NOT_AVAILABLE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8bcda5eb1adb331246de81fdb225540b990f557a"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ4NjMyOA==", "bodyText": "Yeah, this was a bad suggestion on my part as I didn't realize that we were using this from clients/tools versus for inter broker protocols. Maybe we should revert to using REPLICA_NOT_AVAILABLE here.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r455486328", "createdAt": "2020-07-16T03:21:52Z", "author": {"login": "ijuma"}, "path": "core/src/main/scala/kafka/server/ReplicaManager.scala", "diffHunk": "@@ -712,10 +708,13 @@ class ReplicaManager(val config: KafkaConfig,\n         } catch {\n           case e@(_: InvalidTopicException |\n                   _: LogDirNotFoundException |\n-                  _: ReplicaNotAvailableException |\n                   _: KafkaStorageException) =>\n-            warn(\"Unable to alter log dirs for %s\".format(topicPartition), e)\n+            warn(s\"Unable to alter log dirs for $topicPartition\", e)\n             (topicPartition, Errors.forException(e))\n+          case e: NotLeaderOrFollowerException =>\n+            warn(s\"Unable to alter log dirs for $topicPartition\", e)\n+            // Retaining REPLICA_NOT_AVAILABLE exception for ALTER_REPLICA_LOG_DIRS for older versions for compatibility\n+            (topicPartition, if (config.interBrokerProtocolVersion >= KAFKA_2_7_IV0) Errors.NOT_LEADER_OR_FOLLOWER else Errors.REPLICA_NOT_AVAILABLE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQxOTQ5NQ=="}, "originalCommit": {"oid": "8bcda5eb1adb331246de81fdb225540b990f557a"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY0NDk4Nw==", "bodyText": "Reverted.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r455644987", "createdAt": "2020-07-16T09:17:25Z", "author": {"login": "rajinisivaram"}, "path": "core/src/main/scala/kafka/server/ReplicaManager.scala", "diffHunk": "@@ -712,10 +708,13 @@ class ReplicaManager(val config: KafkaConfig,\n         } catch {\n           case e@(_: InvalidTopicException |\n                   _: LogDirNotFoundException |\n-                  _: ReplicaNotAvailableException |\n                   _: KafkaStorageException) =>\n-            warn(\"Unable to alter log dirs for %s\".format(topicPartition), e)\n+            warn(s\"Unable to alter log dirs for $topicPartition\", e)\n             (topicPartition, Errors.forException(e))\n+          case e: NotLeaderOrFollowerException =>\n+            warn(s\"Unable to alter log dirs for $topicPartition\", e)\n+            // Retaining REPLICA_NOT_AVAILABLE exception for ALTER_REPLICA_LOG_DIRS for older versions for compatibility\n+            (topicPartition, if (config.interBrokerProtocolVersion >= KAFKA_2_7_IV0) Errors.NOT_LEADER_OR_FOLLOWER else Errors.REPLICA_NOT_AVAILABLE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQxOTQ5NQ=="}, "originalCommit": {"oid": "8bcda5eb1adb331246de81fdb225540b990f557a"}, "originalPosition": 102}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NDQwMzcxOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/requests/FetchResponse.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxOTowNDoyMVrOGy4iog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMDozODoxMFrOGzOOtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAwODM1NA==", "bodyText": "Is the note about the range from 2.4 to 2.6 correct? I think this error has always been possible in the case of a reassignment.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r456008354", "createdAt": "2020-07-16T19:04:21Z", "author": {"login": "hachikuji"}, "path": "clients/src/main/java/org/apache/kafka/common/requests/FetchResponse.java", "diffHunk": "@@ -58,8 +58,8 @@\n  *\n  * - {@link Errors#OFFSET_OUT_OF_RANGE} If the fetch offset is out of range for a requested partition\n  * - {@link Errors#TOPIC_AUTHORIZATION_FAILED} If the user does not have READ access to a requested topic\n- * - {@link Errors#REPLICA_NOT_AVAILABLE} If the request is received by a broker which is not a replica\n- * - {@link Errors#NOT_LEADER_FOR_PARTITION} If the broker is not a leader and either the provided leader epoch\n+ * - {@link Errors#REPLICA_NOT_AVAILABLE} If the request is received by a broker with version 2.4 to 2.6 which is not a replica", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eedd6e2731946f414fb20c667733153849efa854"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM2MzcwMA==", "bodyText": "Updated to say < 2.6.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r456363700", "createdAt": "2020-07-17T10:38:10Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/main/java/org/apache/kafka/common/requests/FetchResponse.java", "diffHunk": "@@ -58,8 +58,8 @@\n  *\n  * - {@link Errors#OFFSET_OUT_OF_RANGE} If the fetch offset is out of range for a requested partition\n  * - {@link Errors#TOPIC_AUTHORIZATION_FAILED} If the user does not have READ access to a requested topic\n- * - {@link Errors#REPLICA_NOT_AVAILABLE} If the request is received by a broker which is not a replica\n- * - {@link Errors#NOT_LEADER_FOR_PARTITION} If the broker is not a leader and either the provided leader epoch\n+ * - {@link Errors#REPLICA_NOT_AVAILABLE} If the request is received by a broker with version 2.4 to 2.6 which is not a replica", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAwODM1NA=="}, "originalCommit": {"oid": "eedd6e2731946f414fb20c667733153849efa854"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NDgxOTMwOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/protocol/Errors.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDo1OToxM1rOGy8kcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMDozODo1NFrOGzOQDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA3NDM1NQ==", "bodyText": "@hachikuji @rajinisivaram Since this is still used outside of produce/fetch, maybe the backwards compatibility message needs to be qualified?", "url": "https://github.com/apache/kafka/pull/8979#discussion_r456074355", "createdAt": "2020-07-16T20:59:13Z", "author": {"login": "ijuma"}, "path": "clients/src/main/java/org/apache/kafka/common/protocol/Errors.java", "diffHunk": "@@ -139,13 +139,15 @@\n             InvalidFetchSizeException::new),\n     LEADER_NOT_AVAILABLE(5, \"There is no leader for this topic-partition as we are in the middle of a leadership election.\",\n             LeaderNotAvailableException::new),\n-    NOT_LEADER_FOR_PARTITION(6, \"This server is not the leader for that topic-partition.\",\n-            NotLeaderForPartitionException::new),\n+    NOT_LEADER_OR_FOLLOWER(6, \"For requests intended only for the leader, this error indicates that the broker is not the current leader. \" +\n+            \"For requests intended for any replica, this error indicates that the broker is not a replica of the topic partition.\",\n+            NotLeaderOrFollowerException::new),\n     REQUEST_TIMED_OUT(7, \"The request timed out.\",\n             TimeoutException::new),\n     BROKER_NOT_AVAILABLE(8, \"The broker is not available.\",\n             BrokerNotAvailableException::new),\n-    REPLICA_NOT_AVAILABLE(9, \"The replica is not available for the requested topic-partition.\",\n+    REPLICA_NOT_AVAILABLE(9, \"The replica is not available for the requested topic-partition. This is used for backward compatibility for \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eedd6e2731946f414fb20c667733153849efa854"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM2NDA0NQ==", "bodyText": "Updated the doc here and added javadoc for ReplicaNotAvailableException with more detail.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r456364045", "createdAt": "2020-07-17T10:38:54Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/main/java/org/apache/kafka/common/protocol/Errors.java", "diffHunk": "@@ -139,13 +139,15 @@\n             InvalidFetchSizeException::new),\n     LEADER_NOT_AVAILABLE(5, \"There is no leader for this topic-partition as we are in the middle of a leadership election.\",\n             LeaderNotAvailableException::new),\n-    NOT_LEADER_FOR_PARTITION(6, \"This server is not the leader for that topic-partition.\",\n-            NotLeaderForPartitionException::new),\n+    NOT_LEADER_OR_FOLLOWER(6, \"For requests intended only for the leader, this error indicates that the broker is not the current leader. \" +\n+            \"For requests intended for any replica, this error indicates that the broker is not a replica of the topic partition.\",\n+            NotLeaderOrFollowerException::new),\n     REQUEST_TIMED_OUT(7, \"The request timed out.\",\n             TimeoutException::new),\n     BROKER_NOT_AVAILABLE(8, \"The broker is not available.\",\n             BrokerNotAvailableException::new),\n-    REPLICA_NOT_AVAILABLE(9, \"The replica is not available for the requested topic-partition.\",\n+    REPLICA_NOT_AVAILABLE(9, \"The replica is not available for the requested topic-partition. This is used for backward compatibility for \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA3NDM1NQ=="}, "originalCommit": {"oid": "eedd6e2731946f414fb20c667733153849efa854"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NzI1OTQ4OnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/errors/ReplicaNotAvailableException.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMzozMToxNFrOGzTGZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNDoxNjoxNVrOGzUv7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ0MzQ5NQ==", "bodyText": "Should it be leader or follower her and in the ReplicaNotAvailable message?", "url": "https://github.com/apache/kafka/pull/8979#discussion_r456443495", "createdAt": "2020-07-17T13:31:14Z", "author": {"login": "ijuma"}, "path": "clients/src/main/java/org/apache/kafka/common/errors/ReplicaNotAvailableException.java", "diffHunk": "@@ -16,7 +16,13 @@\n  */\n package org.apache.kafka.common.errors;\n \n-public class ReplicaNotAvailableException extends ApiException {\n+/**\n+ * The replica is not available for the requested topic partition. This may be\n+ * a transient exception during reassignments. From version 2.6 onwards, Fetch requests\n+ * and other requests intended only for the leader of the topic partition return", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "991b61d764d3ea11feebe2977890fefed9bfa8b9"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ3MDUwOA==", "bodyText": "@ijuma Thanks for the review, updated.", "url": "https://github.com/apache/kafka/pull/8979#discussion_r456470508", "createdAt": "2020-07-17T14:16:15Z", "author": {"login": "rajinisivaram"}, "path": "clients/src/main/java/org/apache/kafka/common/errors/ReplicaNotAvailableException.java", "diffHunk": "@@ -16,7 +16,13 @@\n  */\n package org.apache.kafka.common.errors;\n \n-public class ReplicaNotAvailableException extends ApiException {\n+/**\n+ * The replica is not available for the requested topic partition. This may be\n+ * a transient exception during reassignments. From version 2.6 onwards, Fetch requests\n+ * and other requests intended only for the leader of the topic partition return", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ0MzQ5NQ=="}, "originalCommit": {"oid": "991b61d764d3ea11feebe2977890fefed9bfa8b9"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2169, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}