{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMDY0NzU3", "number": 8701, "title": "MINOR: Add reason to log message when incrementing the log start offset", "bodyText": "Sometimes logging leaves us guessing at the cause of an increment to the log start offset. Since this results in deletion of user data, I think the logging should be clear about the reason.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-05-20T23:11:54Z", "url": "https://github.com/apache/kafka/pull/8701", "merged": true, "mergeCommit": {"oid": "c95b45d04f504734224421ce59378c29137290dd"}, "closed": true, "closedAt": "2020-05-26T20:52:20Z", "author": {"login": "hachikuji"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjRZPLgH2gAyNDIxMDY0NzU3OmQ1MTYwY2IyM2JmZTZhZjMyMDI4MTFlMzAxOTFkYjEwODg2Nzk4YjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclIp0iAFqTQxODU1MDQ4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d5160cb23bfe6af3202811e30191db10886798b3", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/d5160cb23bfe6af3202811e30191db10886798b3", "committedDate": "2020-05-20T23:09:23Z", "message": "MINOR: Add reason to log message when incrementing the log start offset"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8a9021a3689f6b2fb1ae928640a633c899a7689", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/b8a9021a3689f6b2fb1ae928640a633c899a7689", "committedDate": "2020-05-21T00:02:15Z", "message": "Add enum and remove overload"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1OTQwNjM2", "url": "https://github.com/apache/kafka/pull/8701#pullrequestreview-415940636", "createdAt": "2020-05-21T07:38:56Z", "commit": {"oid": "b8a9021a3689f6b2fb1ae928640a633c899a7689"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzozODo1NlrOGYpRVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwNzozODo1NlrOGYpRVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5NTE5MA==", "bodyText": "How about LogStartOffsetIncrementCause ?", "url": "https://github.com/apache/kafka/pull/8701#discussion_r428495190", "createdAt": "2020-05-21T07:38:56Z", "author": {"login": "chia7712"}, "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -180,6 +180,17 @@ object RollParams {\n   }\n }\n \n+sealed trait LogStartIncrementCause", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8a9021a3689f6b2fb1ae928640a633c899a7689"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "788544da1e4dd5394d52428f28ffbda1f7c62732", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/788544da1e4dd5394d52428f28ffbda1f7c62732", "committedDate": "2020-05-21T19:17:55Z", "message": "LogStartIncrementCause -> LogStartOffsetIncrementCause"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NDIyODgw", "url": "https://github.com/apache/kafka/pull/8701#pullrequestreview-416422880", "createdAt": "2020-05-21T19:19:29Z", "commit": {"oid": "788544da1e4dd5394d52428f28ffbda1f7c62732"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjgzNzM5", "url": "https://github.com/apache/kafka/pull/8701#pullrequestreview-417283739", "createdAt": "2020-05-23T14:38:22Z", "commit": {"oid": "788544da1e4dd5394d52428f28ffbda1f7c62732"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNDozODoyMlrOGZpv_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNDo0NDoyMlrOGZpxkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MTYxMw==", "bodyText": "Nit: LogStartOffsetIncrementReason?", "url": "https://github.com/apache/kafka/pull/8701#discussion_r429551613", "createdAt": "2020-05-23T14:38:22Z", "author": {"login": "ijuma"}, "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -180,6 +180,17 @@ object RollParams {\n   }\n }\n \n+sealed trait LogStartOffsetIncrementCause", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "788544da1e4dd5394d52428f28ffbda1f7c62732"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MTc5OA==", "bodyText": "Maybe we should just say segment deletion? We can also delete segments during recovery and such. Could that not trigger this path?", "url": "https://github.com/apache/kafka/pull/8701#discussion_r429551798", "createdAt": "2020-05-23T14:41:08Z", "author": {"login": "ijuma"}, "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -180,6 +180,17 @@ object RollParams {\n   }\n }\n \n+sealed trait LogStartOffsetIncrementCause\n+case object ClientRecordDeletion extends LogStartOffsetIncrementCause {\n+  override def toString: String = \"client delete records request\"\n+}\n+case object LeaderOffsetIncremented extends LogStartOffsetIncrementCause {\n+  override def toString: String = \"leader offset increment\"\n+}\n+case object SegmentDeletion extends LogStartOffsetIncrementCause {\n+  override def toString: String = \"segment deletion to enforce retention\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "788544da1e4dd5394d52428f28ffbda1f7c62732"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MjAxOA==", "bodyText": "Nit: would due be better than after here?", "url": "https://github.com/apache/kafka/pull/8701#discussion_r429552018", "createdAt": "2020-05-23T14:44:22Z", "author": {"login": "ijuma"}, "path": "core/src/main/scala/kafka/log/Log.scala", "diffHunk": "@@ -1275,8 +1286,8 @@ class Log(@volatile private var _dir: File,\n       lock synchronized {\n         checkIfMemoryMappedBufferClosed()\n         if (newLogStartOffset > logStartOffset) {\n-          info(s\"Incrementing log start offset to $newLogStartOffset\")\n           updateLogStartOffset(newLogStartOffset)\n+          info(s\"Incremented log start offset to $newLogStartOffset after $cause\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "788544da1e4dd5394d52428f28ffbda1f7c62732"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "268296fdc14c18f931c8f1797898d76ec00e8527", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/268296fdc14c18f931c8f1797898d76ec00e8527", "committedDate": "2020-05-26T17:16:21Z", "message": "review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NTUwNDg4", "url": "https://github.com/apache/kafka/pull/8701#pullrequestreview-418550488", "createdAt": "2020-05-26T18:06:12Z", "commit": {"oid": "268296fdc14c18f931c8f1797898d76ec00e8527"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1117, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}