{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NTc4NTEz", "number": 8306, "title": "MINOR: clean up required setup for StreamsPartitionAssignorTest", "bodyText": "No logical or behavioral changes, just a bit of cleanup in this class before we have to write and fix a lot of these tests for KIP-441:\n\nMoved creation of streamsMetadata mock to setUp (in exactly one test it will be overwritten with a strict mock)\nTried to clean up the use of helper methods for configuring the assignor", "createdAt": "2020-03-17T01:56:36Z", "url": "https://github.com/apache/kafka/pull/8306", "merged": true, "mergeCommit": {"oid": "d38e97e319b1ca90ce951b8a153fa51953bba43e"}, "closed": true, "closedAt": "2020-03-18T05:14:01Z", "author": {"login": "ableegoldman"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOYexIgH2gAyMzg5NTc4NTEzOjk3ZDgxZTYzN2I5ODAzZmNlZmJhMWE2ZWU0ZWUyOGE5MGJmOGQ0YzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOrKN7AH2gAyMzg5NTc4NTEzOjI0ODVkMmY1NTNhOTUzZGZhZjQ4YTZkYTM5ZGY2M2RlMzI4ZWQzNmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "97d81e637b9803fcefba1a6ee4ee28a90bf8d4c2", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/97d81e637b9803fcefba1a6ee4ee28a90bf8d4c2", "committedDate": "2020-03-17T01:32:21Z", "message": "just some cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1a28304fe22605c68605c8e530f6983024c8229", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/a1a28304fe22605c68605c8e530f6983024c8229", "committedDate": "2020-03-17T01:50:16Z", "message": "just some cleanup here and there"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad5ae5590505776d515d3b7462cf7cbaa2bde9ec", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/ad5ae5590505776d515d3b7462cf7cbaa2bde9ec", "committedDate": "2020-03-17T01:54:58Z", "message": "move #getInfo methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjkwNzU2", "url": "https://github.com/apache/kafka/pull/8306#pullrequestreview-375690756", "createdAt": "2020-03-17T01:57:56Z", "commit": {"oid": "ad5ae5590505776d515d3b7462cf7cbaa2bde9ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMTo1Nzo1NlrOF3LcWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMTo1Nzo1NlrOF3LcWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQwMzQ4Mg==", "bodyText": "Just moved these (getInfo) down to the end", "url": "https://github.com/apache/kafka/pull/8306#discussion_r393403482", "createdAt": "2020-03-17T01:57:56Z", "author": {"login": "ableegoldman"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignorTest.java", "diffHunk": "@@ -211,45 +219,16 @@ private void createMockTaskManager(final Set<TaskId> prevTasks,\n         builder.buildTopology();\n     }\n \n-    private Map<String, Subscription> subscriptions;\n-\n     @Before\n     public void setUp() {\n-        if (subscriptions != null) {\n-            subscriptions.clear();\n-        } else {\n-            subscriptions = new HashMap<>();\n-        }\n-    }\n-\n-    private static SubscriptionInfo getInfo(final int version,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad5ae5590505776d515d3b7462cf7cbaa2bde9ec"}, "originalPosition": 90}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2Mzk1OTUx", "url": "https://github.com/apache/kafka/pull/8306#pullrequestreview-376395951", "createdAt": "2020-03-17T20:51:46Z", "commit": {"oid": "ad5ae5590505776d515d3b7462cf7cbaa2bde9ec"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDo1MTo0NlrOF3tkVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMTowMzo0MlrOF3t-aA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2MjU4Mg==", "bodyText": "Nice.", "url": "https://github.com/apache/kafka/pull/8306#discussion_r393962582", "createdAt": "2020-03-17T20:51:46Z", "author": {"login": "guozhangwang"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignorTest.java", "diffHunk": "@@ -440,18 +418,15 @@ public void testEagerSubscription() {\n         final UUID processId = UUID.randomUUID();\n         createMockTaskManager(prevTasks, standbyTasks, processId, builder);\n         EasyMock.replay(taskManager);\n-\n-        streamsMetadataState = EasyMock.createNiceMock(StreamsMetadataState.class);\n-        configurePartitionAssignor(emptyMap());\n-        partitionAssignor.setRebalanceProtocol(RebalanceProtocol.EAGER);\n+        configurePartitionAssignorWith(Collections.singletonMap(StreamsConfig.UPGRADE_FROM_CONFIG, StreamsConfig.UPGRADE_FROM_23));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad5ae5590505776d515d3b7462cf7cbaa2bde9ec"}, "originalPosition": 183}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2OTI1Ng==", "bodyText": "nit: the mocked task manager would just call getTaskOffsetSums(...) so maybe we can just call taskManager.getTaskOffsetSums() here? Ditto elsewhere.", "url": "https://github.com/apache/kafka/pull/8306#discussion_r393969256", "createdAt": "2020-03-17T21:03:42Z", "author": {"login": "guozhangwang"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignorTest.java", "diffHunk": "@@ -482,10 +455,7 @@ public void testCooperativeSubscription() {\n         Collections.sort(subscription.topics());\n         assertEquals(asList(\"topic1\", \"topic2\"), subscription.topics());\n \n-        final Set<TaskId> standbyTasks = new HashSet<>(cachedTasks);\n-        standbyTasks.removeAll(prevTasks);\n-\n-        final SubscriptionInfo info = getInfo(processId, getTaskOffsetSums(prevTasks, cachedTasks), null);\n+        final SubscriptionInfo info = getInfo(processId, getTaskOffsetSums(prevTasks, standbyTasks), null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad5ae5590505776d515d3b7462cf7cbaa2bde9ec"}, "originalPosition": 224}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51d8d986d62a2b05eb4e2f95f894db78a09a969d", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/51d8d986d62a2b05eb4e2f95f894db78a09a969d", "committedDate": "2020-03-17T22:23:53Z", "message": "more cleanup, pre move replay"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2485d2f553a953dfaf48a6da39df63de328ed36b", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/2485d2f553a953dfaf48a6da39df63de328ed36b", "committedDate": "2020-03-17T23:18:06Z", "message": "further cleanup"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 288, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}