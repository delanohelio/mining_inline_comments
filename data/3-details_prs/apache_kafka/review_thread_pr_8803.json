{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4MjA3NTQ1", "number": 8803, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNTowODo0MFrOEC_juA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMjoxNzoxMFrOEDHNOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNTczOTQ0OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/SourceNode.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNTowODo0MFrOGfyaIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNTowODo0MFrOGfyaIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk4NDkzMA==", "bodyText": "We do not need to pass in the topics here, just make the topic string creation logic inside ProcessorTopology since the data is stored there.", "url": "https://github.com/apache/kafka/pull/8803#discussion_r435984930", "createdAt": "2020-06-05T15:08:40Z", "author": {"login": "abbccdda"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/SourceNode.java", "diffHunk": "@@ -112,7 +106,7 @@ public String toString() {\n     /**\n      * @return a string representation of this node starting with the given indent, useful for debugging.\n      */\n-    public String toString(final String indent) {\n+    public String toString(final String indent, final List<String> topics) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNTc3NDE2OnYy", "diffSide": "RIGHT", "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/ProcessorTopologyTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNToxNzo0MlrOGfyv4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNToxNzo0MlrOGfyv4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk5MDQ5Ng==", "bodyText": "Why don't we just verify the name of processorTopology.source(\"topic-2\") to be source-1?", "url": "https://github.com/apache/kafka/pull/8803#discussion_r435990496", "createdAt": "2020-06-05T15:17:42Z", "author": {"login": "abbccdda"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/ProcessorTopologyTest.java", "diffHunk": "@@ -149,6 +150,29 @@ public void shouldGetTerminalNodes() {\n         assertThat(processorTopology.terminalNodes(), equalTo(mkSet(\"processor-2\", \"sink-1\")));\n     }\n \n+    @Test\n+    public void shouldUpdateSourceTopicsWithNewMatchingTopic() {\n+        topology.addSource(\"source-1\", \"topic-1\");\n+        final ProcessorTopology processorTopology = topology.getInternalBuilder(\"X\").buildTopology();\n+\n+        assertNull(processorTopology.source(\"topic-2\"));\n+        processorTopology.updateSourceTopics(Collections.singletonMap(\"source-1\", asList(\"topic-1\", \"topic-2\")));\n+\n+        assertThat(processorTopology.source(\"topic-2\"), instanceOf(SourceNode.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNTc5Mzg0OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNToyMjo0MVrOGfy8Pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxODoyNzoyN1rOGf5DEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk5MzY2Mw==", "bodyText": "For this update function, should we also look at the sourceNodesByName and make sure their keysets are matching, otherwise we would throw illegal state here? I think this is legitimate insurance before @cadonna starts the topology revolution work.", "url": "https://github.com/apache/kafka/pull/8803#discussion_r435993663", "createdAt": "2020-06-05T15:22:41Z", "author": {"login": "abbccdda"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "diffHunk": "@@ -131,6 +139,16 @@ public boolean hasPersistentGlobalStore() {\n         return false;\n     }\n \n+    public void updateSourceTopics(final Map<String, List<String>> nodeToSourceTopics) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA5MzcxNA==", "bodyText": "good call", "url": "https://github.com/apache/kafka/pull/8803#discussion_r436093714", "createdAt": "2020-06-05T18:27:27Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "diffHunk": "@@ -131,6 +139,16 @@ public boolean hasPersistentGlobalStore() {\n         return false;\n     }\n \n+    public void updateSourceTopics(final Map<String, List<String>> nodeToSourceTopics) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk5MzY2Mw=="}, "originalCommit": null, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNTgwNzM2OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/InternalTopologyBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNToyNjoxOFrOGfzE1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNToyNjoxOFrOGfzE1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk5NTg2Mg==", "bodyText": "Nice to simplify :)", "url": "https://github.com/apache/kafka/pull/8803#discussion_r435995862", "createdAt": "2020-06-05T15:26:18Z", "author": {"login": "abbccdda"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/InternalTopologyBuilder.java", "diffHunk": "@@ -270,16 +270,7 @@ private SourceNodeFactory(final String name,\n \n         @Override\n         public ProcessorNode<K, V> build() {\n-            final List<String> sourceTopics = nodeToSourceTopics.get(name);\n-\n-            // if it is subscribed via patterns, it is possible that the topic metadata has not been updated\n-            // yet and hence the map from source node to topics is stale, in this case we put the pattern as a place holder;\n-            // this should only happen for debugging since during runtime this function should always be called after the metadata has updated.\n-            if (sourceTopics == null) {\n-                return new SourceNode<>(name, Collections.singletonList(String.valueOf(pattern)), timestampExtractor, keyDeserializer, valDeserializer);\n-            } else {\n-                return new SourceNode<>(name, maybeDecorateInternalSourceTopics(sourceTopics), timestampExtractor, keyDeserializer, valDeserializer);\n-            }\n+            return new SourceNode<>(name, timestampExtractor, keyDeserializer, valDeserializer);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNTgxODU5OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNToyOToyNlrOGfzMPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNToyOToyNlrOGfzMPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk5Nzc1OA==", "bodyText": "nit: space", "url": "https://github.com/apache/kafka/pull/8803#discussion_r435997758", "createdAt": "2020-06-05T15:29:26Z", "author": {"login": "abbccdda"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "diffHunk": "@@ -167,11 +185,21 @@ public String toString() {\n      * @return A string representation of this instance.\n      */\n     public String toString(final String indent) {\n+        final Map<SourceNode<?, ?>, List<String>> sourceToTopics = new HashMap<>();\n+        for (final Map.Entry<String, SourceNode<?, ?>> sourceNodeEntry : sourcesByTopic.entrySet()) {\n+            final String topic = sourceNodeEntry.getKey();\n+            final SourceNode<?, ?> source = sourceNodeEntry.getValue();\n+            sourceToTopics.computeIfAbsent(source, s -> new ArrayList<>());\n+            sourceToTopics.get(source).add(topic);\n+        }\n+\n         final StringBuilder sb = new StringBuilder(indent + \"ProcessorTopology:\\n\");\n \n         // start from sources\n-        for (final SourceNode<?, ?> source : sourcesByTopic.values()) {\n-            sb.append(source.toString(indent + \"\\t\")).append(childrenToString(indent + \"\\t\", source.children()));\n+        for (final Map.Entry<SourceNode<?, ?>, List<String>> sourceNodeEntry : sourceToTopics.entrySet()) {\n+            final SourceNode<?, ?> source  = sourceNodeEntry.getKey();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNTgyNDA0OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNTozMDo1M1rOGfzPrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxOToxOTo1MlrOGf6hYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk5ODYzNw==", "bodyText": "Does the new map ensure a topological order?", "url": "https://github.com/apache/kafka/pull/8803#discussion_r435998637", "createdAt": "2020-06-05T15:30:53Z", "author": {"login": "abbccdda"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "diffHunk": "@@ -167,11 +185,21 @@ public String toString() {\n      * @return A string representation of this instance.\n      */\n     public String toString(final String indent) {\n+        final Map<SourceNode<?, ?>, List<String>> sourceToTopics = new HashMap<>();\n+        for (final Map.Entry<String, SourceNode<?, ?>> sourceNodeEntry : sourcesByTopic.entrySet()) {\n+            final String topic = sourceNodeEntry.getKey();\n+            final SourceNode<?, ?> source = sourceNodeEntry.getValue();\n+            sourceToTopics.computeIfAbsent(source, s -> new ArrayList<>());\n+            sourceToTopics.get(source).add(topic);\n+        }\n+\n         final StringBuilder sb = new StringBuilder(indent + \"ProcessorTopology:\\n\");\n \n         // start from sources\n-        for (final SourceNode<?, ?> source : sourcesByTopic.values()) {\n-            sb.append(source.toString(indent + \"\\t\")).append(childrenToString(indent + \"\\t\", source.children()));\n+        for (final Map.Entry<SourceNode<?, ?>, List<String>> sourceNodeEntry : sourceToTopics.entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA5NjY2NQ==", "bodyText": "Well, it's in topological order in that we start from source nodes and proceed through the children", "url": "https://github.com/apache/kafka/pull/8803#discussion_r436096665", "createdAt": "2020-06-05T18:33:16Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "diffHunk": "@@ -167,11 +185,21 @@ public String toString() {\n      * @return A string representation of this instance.\n      */\n     public String toString(final String indent) {\n+        final Map<SourceNode<?, ?>, List<String>> sourceToTopics = new HashMap<>();\n+        for (final Map.Entry<String, SourceNode<?, ?>> sourceNodeEntry : sourcesByTopic.entrySet()) {\n+            final String topic = sourceNodeEntry.getKey();\n+            final SourceNode<?, ?> source = sourceNodeEntry.getValue();\n+            sourceToTopics.computeIfAbsent(source, s -> new ArrayList<>());\n+            sourceToTopics.get(source).add(topic);\n+        }\n+\n         final StringBuilder sb = new StringBuilder(indent + \"ProcessorTopology:\\n\");\n \n         // start from sources\n-        for (final SourceNode<?, ?> source : sourcesByTopic.values()) {\n-            sb.append(source.toString(indent + \"\\t\")).append(childrenToString(indent + \"\\t\", source.children()));\n+        for (final Map.Entry<SourceNode<?, ?>, List<String>> sourceNodeEntry : sourceToTopics.entrySet()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk5ODYzNw=="}, "originalCommit": null, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjExNzg1OA==", "bodyText": "Oh I see", "url": "https://github.com/apache/kafka/pull/8803#discussion_r436117858", "createdAt": "2020-06-05T19:19:52Z", "author": {"login": "abbccdda"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "diffHunk": "@@ -167,11 +185,21 @@ public String toString() {\n      * @return A string representation of this instance.\n      */\n     public String toString(final String indent) {\n+        final Map<SourceNode<?, ?>, List<String>> sourceToTopics = new HashMap<>();\n+        for (final Map.Entry<String, SourceNode<?, ?>> sourceNodeEntry : sourcesByTopic.entrySet()) {\n+            final String topic = sourceNodeEntry.getKey();\n+            final SourceNode<?, ?> source = sourceNodeEntry.getValue();\n+            sourceToTopics.computeIfAbsent(source, s -> new ArrayList<>());\n+            sourceToTopics.get(source).add(topic);\n+        }\n+\n         final StringBuilder sb = new StringBuilder(indent + \"ProcessorTopology:\\n\");\n \n         // start from sources\n-        for (final SourceNode<?, ?> source : sourcesByTopic.values()) {\n-            sb.append(source.toString(indent + \"\\t\")).append(childrenToString(indent + \"\\t\", source.children()));\n+        for (final Map.Entry<SourceNode<?, ?>, List<String>> sourceNodeEntry : sourceToTopics.entrySet()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk5ODYzNw=="}, "originalCommit": null, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjU5OTEyOnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxOTozODo1MVrOGf7AYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMTo0MjozOVrOGf-Ijg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyNTc5Mw==", "bodyText": "I prefer we get a newbie ticket to test out this logic in a unit test case.", "url": "https://github.com/apache/kafka/pull/8803#discussion_r436125793", "createdAt": "2020-06-05T19:38:51Z", "author": {"login": "abbccdda"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "diffHunk": "@@ -167,12 +195,36 @@ public String toString() {\n      * @return A string representation of this instance.\n      */\n     public String toString(final String indent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE3NzAzOA==", "bodyText": "SG", "url": "https://github.com/apache/kafka/pull/8803#discussion_r436177038", "createdAt": "2020-06-05T21:42:39Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "diffHunk": "@@ -167,12 +195,36 @@ public String toString() {\n      * @return A string representation of this instance.\n      */\n     public String toString(final String indent) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyNTc5Mw=="}, "originalCommit": null, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjYwNzQyOnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxOTo0MjowNVrOGf7Fnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMjoxMzozOVrOGf-zFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyNzEzNQ==", "bodyText": "Could we add a unit test in StreamTaskTest?", "url": "https://github.com/apache/kafka/pull/8803#discussion_r436127135", "createdAt": "2020-06-05T19:42:05Z", "author": {"login": "abbccdda"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -495,12 +496,9 @@ public void closeDirty() {\n     }\n \n     @Override\n-    public void update(final Set<TopicPartition> topicPartitions, final ProcessorTopology processorTopology) {\n-        super.update(topicPartitions, processorTopology);\n+    public void update(final Set<TopicPartition> topicPartitions, final Map<String, List<String>> nodeToSourceTopics) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4NzkyNA==", "bodyText": "Ack, done", "url": "https://github.com/apache/kafka/pull/8803#discussion_r436187924", "createdAt": "2020-06-05T22:13:39Z", "author": {"login": "ableegoldman"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -495,12 +496,9 @@ public void closeDirty() {\n     }\n \n     @Override\n-    public void update(final Set<TopicPartition> topicPartitions, final ProcessorTopology processorTopology) {\n-        super.update(topicPartitions, processorTopology);\n+    public void update(final Set<TopicPartition> topicPartitions, final Map<String, List<String>> nodeToSourceTopics) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyNzEzNQ=="}, "originalCommit": null, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjk5MDk2OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMjoxNjoxM1rOGf-2Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMjoxNjoxM1rOGf-2Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4ODY5OQ==", "bodyText": "Should we have a sanity check, that no topic is added twice?", "url": "https://github.com/apache/kafka/pull/8803#discussion_r436188699", "createdAt": "2020-06-05T22:16:13Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorTopology.java", "diffHunk": "@@ -131,6 +142,23 @@ public boolean hasPersistentGlobalStore() {\n         return false;\n     }\n \n+    public void updateSourceTopics(final Map<String, List<String>> sourceTopicsByName) {\n+        if (!sourceTopicsByName.keySet().equals(sourceNodesByName.keySet())) {\n+            log.error(\"Set of source nodes do not match: \\n\" +\n+                \"sourceNodesByName = {}\\n\" +\n+                \"sourceTopicsByName = {}\",\n+                sourceNodesByName.keySet(), sourceTopicsByName.keySet());\n+            throw new IllegalStateException(\"Tried to update source topics but source nodes did not match\");\n+        }\n+        sourceNodesByTopic.clear();\n+        for (final Map.Entry<String, List<String>> sourceEntry : sourceTopicsByName.entrySet()) {\n+            final String nodeName = sourceEntry.getKey();\n+            for (final String topic : sourceEntry.getValue()) {\n+                sourceNodesByTopic.put(topic, sourceNodesByName.get(nodeName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNjk5MjU4OnYy", "diffSide": "RIGHT", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMjoxNzoxMFrOGf-3Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQyMjoxNzoxMFrOGf-3Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4ODk2Ng==", "bodyText": "Thanks for the cleanup!", "url": "https://github.com/apache/kafka/pull/8803#discussion_r436188966", "createdAt": "2020-06-05T22:17:10Z", "author": {"login": "mjsax"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -512,18 +510,16 @@ public void closeAndRecycleState() {\n         }\n         switch (state()) {\n             case CREATED:\n-            case RUNNING:\n             case RESTORING:\n+            case RUNNING:\n             case SUSPENDED:\n                 stateMgr.recycle();\n                 recordCollector.close();\n                 break;\n-\n             case CLOSED:\n-                throw new IllegalStateException(\"Illegal state \" + state() + \" while closing active task \" + id);\n-\n+                throw new IllegalStateException(\"Illegal state \" + state() + \" while recycling active task \" + id);\n             default:\n-                throw new IllegalStateException(\"Unknown state \" + state() + \" while closing active task \" + id);\n+                throw new IllegalStateException(\"Unknown state \" + state() + \" while recycling active task \" + id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2515, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}