{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4ODI1NDIw", "number": 7887, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNjowNDoxNVrODa7ooA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNjoxMjowN1rODa703w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTY2NjI0OnYy", "diffSide": "RIGHT", "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorHeartbeatConnector.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNjowNDoxNVrOFiIJ5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxOToxNjoyM1rOFiOUMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyOTUwOQ==", "bodyText": "Should we check for !config.enabled() here too?", "url": "https://github.com/apache/kafka/pull/7887#discussion_r371329509", "createdAt": "2020-01-27T16:04:15Z", "author": {"login": "mimaison"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorHeartbeatConnector.java", "diffHunk": "@@ -50,6 +50,10 @@ public void stop() {\n \n     @Override\n     public List<Map<String, String>> taskConfigs(int maxTasks) {\n+        // if emitting heartbeat is disabled\n+        if (config.emitHeartbeatsInterval().isNegative()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM0OTIwOA==", "bodyText": "No, we want to emit heartbeats even if A->B.enabled=false (see my earlier comment). Basically, we want heartbeats to be sent even if replication is disabled, unless heartbeats are explicitly disabled with emit.heartbeats.enabled = false.", "url": "https://github.com/apache/kafka/pull/7887#discussion_r371349208", "createdAt": "2020-01-27T16:36:45Z", "author": {"login": "ryannedolan"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorHeartbeatConnector.java", "diffHunk": "@@ -50,6 +50,10 @@ public void stop() {\n \n     @Override\n     public List<Map<String, String>> taskConfigs(int maxTasks) {\n+        // if emitting heartbeat is disabled\n+        if (config.emitHeartbeatsInterval().isNegative()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyOTUwOQ=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3MDA1NA==", "bodyText": "Gotcha, maybe worth adding that the explanation to the comment", "url": "https://github.com/apache/kafka/pull/7887#discussion_r371370054", "createdAt": "2020-01-27T17:13:05Z", "author": {"login": "mimaison"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorHeartbeatConnector.java", "diffHunk": "@@ -50,6 +50,10 @@ public void stop() {\n \n     @Override\n     public List<Map<String, String>> taskConfigs(int maxTasks) {\n+        // if emitting heartbeat is disabled\n+        if (config.emitHeartbeatsInterval().isNegative()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyOTUwOQ=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQxODU4Mw==", "bodyText": "Great, I will add the the explanation to the comment in the next update", "url": "https://github.com/apache/kafka/pull/7887#discussion_r371418583", "createdAt": "2020-01-27T18:52:23Z", "author": {"login": "ning2008wisc"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorHeartbeatConnector.java", "diffHunk": "@@ -50,6 +50,10 @@ public void stop() {\n \n     @Override\n     public List<Map<String, String>> taskConfigs(int maxTasks) {\n+        // if emitting heartbeat is disabled\n+        if (config.emitHeartbeatsInterval().isNegative()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyOTUwOQ=="}, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQzMDQ0OA==", "bodyText": "if isNegative() is not highly recommended, what about this change? Should we still check isNegative() or return the interval as Duration.ofMillis(Long.MAX_VALUE) ?", "url": "https://github.com/apache/kafka/pull/7887#discussion_r371430448", "createdAt": "2020-01-27T19:16:23Z", "author": {"login": "ning2008wisc"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorHeartbeatConnector.java", "diffHunk": "@@ -50,6 +50,10 @@ public void stop() {\n \n     @Override\n     public List<Map<String, String>> taskConfigs(int maxTasks) {\n+        // if emitting heartbeat is disabled\n+        if (config.emitHeartbeatsInterval().isNegative()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyOTUwOQ=="}, "originalCommit": null, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NTY5NzU5OnYy", "diffSide": "RIGHT", "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorCheckpointConnector.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNjoxMjowN1rOFiIc7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMTo1NTo0NlrOFiS1_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMzNDM4MA==", "bodyText": "It feels like allowing intervals to be negative interval to disable connectors is not a great pattern. Instead preventing the interval to be negative and relying solely on enabled() would have been a better alternative.", "url": "https://github.com/apache/kafka/pull/7887#discussion_r371334380", "createdAt": "2020-01-27T16:12:07Z", "author": {"login": "mimaison"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorCheckpointConnector.java", "diffHunk": "@@ -88,7 +88,8 @@ public void stop() {\n     // divide consumer groups among tasks\n     @Override\n     public List<Map<String, String>> taskConfigs(int maxTasks) {\n-        if (!config.enabled() || knownConsumerGroups.isEmpty()) {\n+        if (!config.enabled() || knownConsumerGroups.isEmpty()\n+                || config.emitCheckpointsInterval().isNegative()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQyODg2OQ==", "bodyText": "@ryannedolan , as @mimaison suggested, if emit.checkpoints.enabled = false, do you think if it is a better alternative to return Long.MAX_VALUE, rather than negative?\n    Duration emitCheckpointsInterval() {\n        if (getBoolean(EMIT_CHECKPOINTS_ENABLED)) {\n            return Duration.ofSeconds(getLong(EMIT_CHECKPOINTS_INTERVAL_SECONDS));\n        } else {\n            // negative interval to disable\n            return Duration.ofMillis(Long.MAX_VALUE);\n        }\n    }", "url": "https://github.com/apache/kafka/pull/7887#discussion_r371428869", "createdAt": "2020-01-27T19:13:18Z", "author": {"login": "ning2008wisc"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorCheckpointConnector.java", "diffHunk": "@@ -88,7 +88,8 @@ public void stop() {\n     // divide consumer groups among tasks\n     @Override\n     public List<Map<String, String>> taskConfigs(int maxTasks) {\n-        if (!config.enabled() || knownConsumerGroups.isEmpty()) {\n+        if (!config.enabled() || knownConsumerGroups.isEmpty()\n+                || config.emitCheckpointsInterval().isNegative()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMzNDM4MA=="}, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ0MTA2MA==", "bodyText": "All the interval configs (sync topics acls, sync topic configs, refresh topics, ...) use negative values to indicate that the Scheduler should not run the corresponding task. I suppose we could have used an Optional or something instead. If we drop the negatives here, we should do so with all the other tasks. Mox nix to me.", "url": "https://github.com/apache/kafka/pull/7887#discussion_r371441060", "createdAt": "2020-01-27T19:37:07Z", "author": {"login": "ryannedolan"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorCheckpointConnector.java", "diffHunk": "@@ -88,7 +88,8 @@ public void stop() {\n     // divide consumer groups among tasks\n     @Override\n     public List<Map<String, String>> taskConfigs(int maxTasks) {\n-        if (!config.enabled() || knownConsumerGroups.isEmpty()) {\n+        if (!config.enabled() || knownConsumerGroups.isEmpty()\n+                || config.emitCheckpointsInterval().isNegative()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMzNDM4MA=="}, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ0MzU0NQ==", "bodyText": "It's not ideal but yes we don't want to change the current behaviour here. Let's keep the negative values.", "url": "https://github.com/apache/kafka/pull/7887#discussion_r371443545", "createdAt": "2020-01-27T19:42:03Z", "author": {"login": "mimaison"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorCheckpointConnector.java", "diffHunk": "@@ -88,7 +88,8 @@ public void stop() {\n     // divide consumer groups among tasks\n     @Override\n     public List<Map<String, String>> taskConfigs(int maxTasks) {\n-        if (!config.enabled() || knownConsumerGroups.isEmpty()) {\n+        if (!config.enabled() || knownConsumerGroups.isEmpty()\n+                || config.emitCheckpointsInterval().isNegative()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMzNDM4MA=="}, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUwNDYzNg==", "bodyText": "great, thanks for all of your inputs. Then I suppose the only change in the next update is to adding the explanation to the comment on why we use isNegative()to disable theheartbeatandcheckpoint` emissions.", "url": "https://github.com/apache/kafka/pull/7887#discussion_r371504636", "createdAt": "2020-01-27T21:55:46Z", "author": {"login": "ning2008wisc"}, "path": "connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorCheckpointConnector.java", "diffHunk": "@@ -88,7 +88,8 @@ public void stop() {\n     // divide consumer groups among tasks\n     @Override\n     public List<Map<String, String>> taskConfigs(int maxTasks) {\n-        if (!config.enabled() || knownConsumerGroups.isEmpty()) {\n+        if (!config.enabled() || knownConsumerGroups.isEmpty()\n+                || config.emitCheckpointsInterval().isNegative()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMzNDM4MA=="}, "originalCommit": null, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4445, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}