{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0NTg4NTY1", "number": 9449, "title": "MINOR: simplify implementation of ConsumerGroupOperationContext.hasCo\u2026", "bodyText": "make it more readable :)\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-10-16T05:06:24Z", "url": "https://github.com/apache/kafka/pull/9449", "merged": true, "mergeCommit": {"oid": "c283886b8edf65d1bf9fb10b5288929152d82af6"}, "closed": true, "closedAt": "2020-10-22T09:02:14Z", "author": {"login": "chia7712"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdT_UT4ABqjM4OTE4NTg3MjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdU97TJAFqTUxNDQ5NDI2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNjEwMTYz", "url": "https://github.com/apache/kafka/pull/9449#pullrequestreview-511610163", "createdAt": "2020-10-19T10:12:03Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMDoxMjowM1rOHkHR7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMDoxMjowM1rOHkHR7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzYzMDA2Mg==", "bodyText": "While the code is cleaner, the error counts map (errorCounts) is re-computed 3 times now. Once in hasCoordinatorMoved and twice in shouldRefreshCoordinator. It would be better if we could get it once and reuse it.", "url": "https://github.com/apache/kafka/pull/9449#discussion_r507630062", "createdAt": "2020-10-19T10:12:03Z", "author": {"login": "dajac"}, "path": "clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java", "diffHunk": "@@ -3938,25 +3938,15 @@ private Call getAlterConsumerGroupOffsetsCall(ConsumerGroupOperationContext<Map<\n             void handleResponse(AbstractResponse abstractResponse) {\n                 final OffsetCommitResponse response = (OffsetCommitResponse) abstractResponse;\n \n-                // If coordinator changed since we fetched it, retry\n-                if (ConsumerGroupOperationContext.hasCoordinatorMoved(response)) {\n+                // 1) If coordinator changed since we fetched it, retry\n+                // 2) If there is a coordinator error, retry\n+                if (ConsumerGroupOperationContext.hasCoordinatorMoved(response) ||\n+                    ConsumerGroupOperationContext.shouldRefreshCoordinator(response)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba3b3e8856317c785956970056d07c2d7d37005d", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/ba3b3e8856317c785956970056d07c2d7d37005d", "committedDate": "2020-10-21T07:13:51Z", "message": "MINOR: simplify implementation of ConsumerGroupOperationContext.hasCoordinatorMoved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "784cc3283c1b6a435a170e8ae3e29d15f7cefcad", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/784cc3283c1b6a435a170e8ae3e29d15f7cefcad", "committedDate": "2020-10-21T07:13:51Z", "message": "reuse error counts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "784cc3283c1b6a435a170e8ae3e29d15f7cefcad", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/784cc3283c1b6a435a170e8ae3e29d15f7cefcad", "committedDate": "2020-10-21T07:13:51Z", "message": "reuse error counts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NDk0MjY5", "url": "https://github.com/apache/kafka/pull/9449#pullrequestreview-514494269", "createdAt": "2020-10-22T08:44:42Z", "commit": {"oid": "784cc3283c1b6a435a170e8ae3e29d15f7cefcad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 562, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}