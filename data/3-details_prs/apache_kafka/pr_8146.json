{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MDU2Mzc5", "number": 8146, "title": "MINOR: Standby task commit needed when offsets updated", "bodyText": "This is a minor fix of a regression introduced in the refactoring PR: in current trunk standbyTask#commitNeeded always return false, which would cause standby tasks to never be committed until closed. To go back to the old behavior we would return true when new data has been applied and offsets being updated.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-02-21T01:15:11Z", "url": "https://github.com/apache/kafka/pull/8146", "merged": true, "mergeCommit": {"oid": "003dce5d51c8b74040ac22f0697f25b581f920c9"}, "closed": true, "closedAt": "2020-02-21T20:08:01Z", "author": {"login": "guozhangwang"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGVOFUgH2gAyMzc4MDU2Mzc5OjE1ZmI5NTc5ZDM0ZDgxNWNjOGZhZGNhZDUyOGViYzNhMWM3MzBmYjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGlajTgH2gAyMzc4MDU2Mzc5OmFiYTJjZjBmMmNiOTRiOTcyOWFhNGJkYzI0NTAyMjFmM2ZkOTgwZjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15fb9579d34d815cc8fadcad528ebc3a1c730fb5", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/15fb9579d34d815cc8fadcad528ebc3a1c730fb5", "committedDate": "2020-02-21T01:13:01Z", "message": "standby task commit needed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODQwMDY1", "url": "https://github.com/apache/kafka/pull/8146#pullrequestreview-362840065", "createdAt": "2020-02-21T18:48:11Z", "commit": {"oid": "15fb9579d34d815cc8fadcad528ebc3a1c730fb5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxODo0ODoxMVrOFtA9Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxODo0ODoxMVrOFtA9Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc0NTk1NA==", "bodyText": "offsetSnapshotSinceLastCommit", "url": "https://github.com/apache/kafka/pull/8146#discussion_r382745954", "createdAt": "2020-02-21T18:48:11Z", "author": {"login": "abbccdda"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StandbyTask.java", "diffHunk": "@@ -42,6 +42,8 @@\n     private final Sensor closeTaskSensor;\n     private final InternalProcessorContext processorContext;\n \n+    private Map<TopicPartition, Long> changelogOffsetSnapshot;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15fb9579d34d815cc8fadcad528ebc3a1c730fb5"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODQwOTg3", "url": "https://github.com/apache/kafka/pull/8146#pullrequestreview-362840987", "createdAt": "2020-02-21T18:49:50Z", "commit": {"oid": "15fb9579d34d815cc8fadcad528ebc3a1c730fb5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODU0NTcz", "url": "https://github.com/apache/kafka/pull/8146#pullrequestreview-362854573", "createdAt": "2020-02-21T19:12:42Z", "commit": {"oid": "15fb9579d34d815cc8fadcad528ebc3a1c730fb5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOToxMjo0MlrOFtBpqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxOToxMjo0MlrOFtBpqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1NzI5MQ==", "bodyText": "Should we make a copy of the map, to guard against the state manager implementation?", "url": "https://github.com/apache/kafka/pull/8146#discussion_r382757291", "createdAt": "2020-02-21T19:12:42Z", "author": {"login": "vvcephei"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StandbyTask.java", "diffHunk": "@@ -125,6 +127,8 @@ public void commit() {\n                 // and the state current offset would be used to checkpoint\n                 stateMgr.checkpoint(Collections.emptyMap());\n \n+                changelogOffsetSnapshot = stateMgr.changelogOffsets();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15fb9579d34d815cc8fadcad528ebc3a1c730fb5"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e43aa9b7c255bef79a3409173327f8fde1bb35bf", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/e43aa9b7c255bef79a3409173327f8fde1bb35bf", "committedDate": "2020-02-21T19:27:40Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into KMinor-standby-task-commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "849d4e0abb262c0a78d7e82004e8b71694d025d6", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/849d4e0abb262c0a78d7e82004e8b71694d025d6", "committedDate": "2020-02-21T19:31:38Z", "message": "address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aba2cf0f2cb94b9729aa4bdc2450221f3fd980f4", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/aba2cf0f2cb94b9729aa4bdc2450221f3fd980f4", "committedDate": "2020-02-21T20:05:07Z", "message": "fix unit tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1516, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}