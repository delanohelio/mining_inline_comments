{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNDYyMjQ0", "number": 9617, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMzozNzowNlrOE6z64Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMzo1MToxMlrOE63Utg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTAzNTIxOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/requests/CorrelationIdMismatchException.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMzozNzowNlrOH2GpTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODoxODo1M1rOH2rsng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ5NDAyOA==", "bodyText": "nit: we could put this exception into common/internals to indicate that we don't plan to let external user catch it.", "url": "https://github.com/apache/kafka/pull/9617#discussion_r526494028", "createdAt": "2020-11-18T23:37:06Z", "author": {"login": "abbccdda"}, "path": "clients/src/main/java/org/apache/kafka/common/requests/CorrelationIdMismatchException.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.requests;\n+\n+/**\n+ * Raised if the correlationId in a response header does not match\n+ * the expected value from the request header.\n+ */\n+public class CorrelationIdMismatchException extends IllegalStateException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3fae878b46fe147ac33c5979a11b72df5b3013f"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzEwMTA4Ng==", "bodyText": "Yeah, I was debating the location. I decided to put it in common/requests since it is not a public package and the error is specific to the request protocol.", "url": "https://github.com/apache/kafka/pull/9617#discussion_r527101086", "createdAt": "2020-11-19T18:18:53Z", "author": {"login": "hachikuji"}, "path": "clients/src/main/java/org/apache/kafka/common/requests/CorrelationIdMismatchException.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.requests;\n+\n+/**\n+ * Raised if the correlationId in a response header does not match\n+ * the expected value from the request header.\n+ */\n+public class CorrelationIdMismatchException extends IllegalStateException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ5NDAyOA=="}, "originalCommit": {"oid": "d3fae878b46fe147ac33c5979a11b72df5b3013f"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTAzNjQ3OnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/common/requests/CorrelationIdMismatchException.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMzozNzozOVrOH2GqDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODoxMDoxM1rOH2rW8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ5NDIyMg==", "bodyText": "This field is not used.", "url": "https://github.com/apache/kafka/pull/9617#discussion_r526494222", "createdAt": "2020-11-18T23:37:39Z", "author": {"login": "abbccdda"}, "path": "clients/src/main/java/org/apache/kafka/common/requests/CorrelationIdMismatchException.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.requests;\n+\n+/**\n+ * Raised if the correlationId in a response header does not match\n+ * the expected value from the request header.\n+ */\n+public class CorrelationIdMismatchException extends IllegalStateException {\n+    private final int requestCorrelationId;\n+    private final int responseCorrelationId;\n+\n+    public CorrelationIdMismatchException(\n+        String message,\n+        int requestCorrelationId,\n+        int responseCorrelationId\n+    ) {\n+        super(message);\n+        this.requestCorrelationId = requestCorrelationId;\n+        this.responseCorrelationId = responseCorrelationId;\n+    }\n+\n+    public int requestCorrelationId() {\n+        return requestCorrelationId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3fae878b46fe147ac33c5979a11b72df5b3013f"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA5NTUzOQ==", "bodyText": "Yeah, I added it for completeness. It is a little odd if the mismatch exception only tells you what the response correlationId was.", "url": "https://github.com/apache/kafka/pull/9617#discussion_r527095539", "createdAt": "2020-11-19T18:10:13Z", "author": {"login": "hachikuji"}, "path": "clients/src/main/java/org/apache/kafka/common/requests/CorrelationIdMismatchException.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.common.requests;\n+\n+/**\n+ * Raised if the correlationId in a response header does not match\n+ * the expected value from the request header.\n+ */\n+public class CorrelationIdMismatchException extends IllegalStateException {\n+    private final int requestCorrelationId;\n+    private final int responseCorrelationId;\n+\n+    public CorrelationIdMismatchException(\n+        String message,\n+        int requestCorrelationId,\n+        int responseCorrelationId\n+    ) {\n+        super(message);\n+        this.requestCorrelationId = requestCorrelationId;\n+        this.responseCorrelationId = responseCorrelationId;\n+    }\n+\n+    public int requestCorrelationId() {\n+        return requestCorrelationId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ5NDIyMg=="}, "originalCommit": {"oid": "d3fae878b46fe147ac33c5979a11b72df5b3013f"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTA3MDUwOnYy", "diffSide": "LEFT", "path": "clients/src/main/java/org/apache/kafka/clients/NetworkClient.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMzo1MTozOFrOH2G-sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxODowOTozM1rOH2rVCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ5OTUwNQ==", "bodyText": "nit: I don't think we need to remove this helper", "url": "https://github.com/apache/kafka/pull/9617#discussion_r526499505", "createdAt": "2020-11-18T23:51:38Z", "author": {"login": "abbccdda"}, "path": "clients/src/main/java/org/apache/kafka/clients/NetworkClient.java", "diffHunk": "@@ -974,21 +969,6 @@ private void handleInitiateApiVersionRequests(long now) {\n         }\n     }\n \n-    /**\n-     * Validate that the response corresponds to the request we expect or else explode\n-     */\n-    private static void correlate(RequestHeader requestHeader, ResponseHeader responseHeader) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3fae878b46fe147ac33c5979a11b72df5b3013f"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA5NTA1MA==", "bodyText": "Why do you want to keep it if it is not used?", "url": "https://github.com/apache/kafka/pull/9617#discussion_r527095050", "createdAt": "2020-11-19T18:09:33Z", "author": {"login": "hachikuji"}, "path": "clients/src/main/java/org/apache/kafka/clients/NetworkClient.java", "diffHunk": "@@ -974,21 +969,6 @@ private void handleInitiateApiVersionRequests(long now) {\n         }\n     }\n \n-    /**\n-     * Validate that the response corresponds to the request we expect or else explode\n-     */\n-    private static void correlate(RequestHeader requestHeader, ResponseHeader responseHeader) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ5OTUwNQ=="}, "originalCommit": {"oid": "d3fae878b46fe147ac33c5979a11b72df5b3013f"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMTU5Mjg2OnYy", "diffSide": "RIGHT", "path": "core/src/main/scala/kafka/server/ForwardingManager.scala", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMzo1MToxMlrOH2Lt3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwMzo1MToxMlrOH2Lt3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU3NzExNg==", "bodyText": "As ForwardingManager does not extend BrokerToControllerChannelManagerImpl, the requestQueue can be declared as private now.\nhttps://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/server/BrokerToControllerChannelManagerImpl.scala#L58", "url": "https://github.com/apache/kafka/pull/9617#discussion_r526577116", "createdAt": "2020-11-19T03:51:12Z", "author": {"login": "chia7712"}, "path": "core/src/main/scala/kafka/server/ForwardingManager.scala", "diffHunk": "@@ -17,25 +17,17 @@\n \n package kafka.server\n \n-import kafka.metrics.KafkaMetricsGroup\n+import java.nio.ByteBuffer\n+\n import kafka.network.RequestChannel\n+import kafka.utils.Logging\n import org.apache.kafka.clients.ClientResponse\n-import org.apache.kafka.common.metrics.Metrics\n import org.apache.kafka.common.protocol.Errors\n-import org.apache.kafka.common.requests.{AbstractRequest, AbstractResponse, EnvelopeRequest, EnvelopeResponse}\n-import org.apache.kafka.common.utils.Time\n+import org.apache.kafka.common.requests.{AbstractRequest, AbstractResponse, EnvelopeRequest, EnvelopeResponse, RequestHeader}\n \n import scala.compat.java8.OptionConverters._\n \n-class ForwardingManager(metadataCache: kafka.server.MetadataCache,\n-                        time: Time,\n-                        metrics: Metrics,\n-                        config: KafkaConfig,\n-                        threadNamePrefix: Option[String] = None) extends\n-  BrokerToControllerChannelManagerImpl(metadataCache, time, metrics,\n-    config, \"forwardingChannel\", threadNamePrefix) with KafkaMetricsGroup {\n-\n-  private val forwardingMetricName = \"NumRequestsForwardingToControllerPerSec\"\n+class ForwardingManager(channelManager: BrokerToControllerChannelManager) extends Logging {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3fae878b46fe147ac33c5979a11b72df5b3013f"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3898, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}