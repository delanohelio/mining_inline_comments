{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5NzU0NjQ5", "number": 8565, "title": "KAFKA-9798: Send one round synchronously before starting the async producer", "bodyText": "Comparing all other test cases, the shouldAllowConcurrentAccesses starts an async producer sending records throughout the test other than just synchronously sent and acked a few records before we start the streams application. Right after the streams app is started, we check that at least one record is sent to the output topic (i.e. completed processing). However since only this test starts the producer async and did not wait for it to complete, it is possible that the async producer gets too longer to produce some records and causing it to fail.\nTo follow what other tests did, I let this test to first send one round of records synchronously before starting the async producing.\nAlso encountered some new scala warnings that I fixed along with this PR.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-04-27T21:22:31Z", "url": "https://github.com/apache/kafka/pull/8565", "merged": true, "mergeCommit": {"oid": "34824b7bff64ba387a04466d74ac6bbbd10bf37c"}, "closed": true, "closedAt": "2020-05-04T01:39:44Z", "author": {"login": "guozhangwang"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcb1dWkAH2gAyNDA5NzU0NjQ5OjZmMzRiYTg0ZTViNmM2YzU4NTVkZjI5Njk5OGI0YWM4ODA5YWYyNDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcdLUErAFqTQwNDQ4MzI3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6f34ba84e5b6c6c5855df296998b4ac8809af242", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/6f34ba84e5b6c6c5855df296998b4ac8809af242", "committedDate": "2020-04-27T20:39:04Z", "message": "first commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afb19b25767dfacf9708b6729bafa3928bab6ec1", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/afb19b25767dfacf9708b6729bafa3928bab6ec1", "committedDate": "2020-04-27T21:22:44Z", "message": "minor fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca635d2815ce25b439d57c1e526cc3c15df3d7e6", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/ca635d2815ce25b439d57c1e526cc3c15df3d7e6", "committedDate": "2020-04-28T00:05:05Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into K9798-pre-send-one-record"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f3aaa347de908446d2150606e64753b93be8883", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/3f3aaa347de908446d2150606e64753b93be8883", "committedDate": "2020-04-28T00:06:24Z", "message": "remove unused imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzI4MTAz", "url": "https://github.com/apache/kafka/pull/8565#pullrequestreview-404328103", "createdAt": "2020-05-01T18:39:14Z", "commit": {"oid": "3f3aaa347de908446d2150606e64753b93be8883"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODozOToxNFrOGPSHHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODozOToxNFrOGPSHHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3ODU1Ng==", "bodyText": "The producer is create using try-with-resource clause thus, the producer should be flushed on the implicit close() anyway? Thus, I don't think explicit flushing would help?", "url": "https://github.com/apache/kafka/pull/8565#discussion_r418678556", "createdAt": "2020-05-01T18:39:14Z", "author": {"login": "mjsax"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/QueryableStateIntegrationTest.java", "diffHunk": "@@ -1262,6 +1266,7 @@ public void run() {\n                     }\n                     incrementIteration();\n                 }\n+                producer.flush();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f3aaa347de908446d2150606e64753b93be8883"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzI4ODg1", "url": "https://github.com/apache/kafka/pull/8565#pullrequestreview-404328885", "createdAt": "2020-05-01T18:40:37Z", "commit": {"oid": "3f3aaa347de908446d2150606e64753b93be8883"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODo0MDozN1rOGPSJmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODo0MDozN1rOGPSJmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3OTE5NA==", "bodyText": "Should this be numIterations - 1", "url": "https://github.com/apache/kafka/pull/8565#discussion_r418679194", "createdAt": "2020-05-01T18:40:37Z", "author": {"login": "mjsax"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/QueryableStateIntegrationTest.java", "diffHunk": "@@ -631,7 +631,11 @@ public void shouldAllowConcurrentAccesses() throws Exception {\n         final String storeName = \"word-count-store\";\n         final String windowStoreName = \"windowed-word-count-store\";\n \n-        final ProducerRunnable producerRunnable = new ProducerRunnable(streamConcurrent, inputValues, numIterations);\n+        // send one round of records first to populate the stores\n+        ProducerRunnable producerRunnable = new ProducerRunnable(streamThree, inputValues, 1);\n+        producerRunnable.run();\n+\n+        producerRunnable = new ProducerRunnable(streamConcurrent, inputValues, numIterations);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f3aaa347de908446d2150606e64753b93be8883"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c20eed6fc0833a746417d059b62f572b57c51b6", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/5c20eed6fc0833a746417d059b62f572b57c51b6", "committedDate": "2020-05-01T22:49:22Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NDgzMjc0", "url": "https://github.com/apache/kafka/pull/8565#pullrequestreview-404483274", "createdAt": "2020-05-02T00:40:46Z", "commit": {"oid": "5c20eed6fc0833a746417d059b62f572b57c51b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1247, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}