{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU0ODQ1NTQw", "number": 9051, "title": "KAFKA-10268: dynamic config like \"--delete-config log.retention.ms\" doesn't work", "bodyText": "https://issues.apache.org/jira/browse/KAFKA-10268\nCurrently, ConfigCommand's --delete-config API does not restore the config to default value, no matter at broker-level or broker-default level. Besides, Admin.incrementalAlterConfigs API also runs into this problem. This patch fixes it by removing the corresponding config from the newConfig properties when reconfiguring dynamic broker config.\nMore detailed description of your change,\nif necessary. The PR title and PR message become\nthe squashed commit message, so use a separate\ncomment to ping reviewers.\nSummary of testing strategy (including rationale)\nfor the feature or bug fix. Unit and/or integration\ntests are expected for any behaviour change and\nsystem tests should be considered for larger changes.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-07-22T02:42:26Z", "url": "https://github.com/apache/kafka/pull/9051", "merged": true, "mergeCommit": {"oid": "1c439da590771c604ba25f4776ba9deb1670a891"}, "closed": true, "closedAt": "2020-07-24T01:33:23Z", "author": {"login": "huxihx"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3RcOeAH2gAyNDU0ODQ1NTQwOjg4MjI2YTRkMjk4OWM3ZTIzMjQzYTEyMGE5M2Q5ZjVmODBkMDk3NjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3r6WTAFqTQ1Mzk2NDAxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "88226a4d2989c7e23243a120a93d9f5f80d09760", "author": {"user": {"login": "huxihx", "name": "huxi"}}, "url": "https://github.com/apache/kafka/commit/88226a4d2989c7e23243a120a93d9f5f80d09760", "committedDate": "2020-07-22T02:31:08Z", "message": "KAFKA-10268: dynamic config like \"--delete-config log.retention.ms\" doesn't work\n\nhttps://issues.apache.org/jira/browse/KAFKA-10268\n\nCurrently, ConfigCommand --delete-config API does not restore the config to default value, no matter at broker-level or broker-default level. Besides, Admin.incrementalAlterConfigs API also runs into this problem. This patch fixes it by removing the corresponding config from the newConfig properties when reconfiguring dynamic broker config."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMDQ5NTQ5", "url": "https://github.com/apache/kafka/pull/9051#pullrequestreview-453049549", "createdAt": "2020-07-22T07:10:18Z", "commit": {"oid": "88226a4d2989c7e23243a120a93d9f5f80d09760"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNzoxMDoxOFrOG1VjuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNzoxMDoxOFrOG1VjuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4MDkyMQ==", "bodyText": "Shouldn't we also waitForConfigOnServer after the first alteration of the config?", "url": "https://github.com/apache/kafka/pull/9051#discussion_r458580921", "createdAt": "2020-07-22T07:10:18Z", "author": {"login": "dajac"}, "path": "core/src/test/scala/integration/kafka/server/DynamicBrokerReconfigurationTest.scala", "diffHunk": "@@ -775,6 +775,24 @@ class DynamicBrokerReconfigurationTest extends ZooKeeperTestHarness with SaslSet\n     verifyMarkPartitionsForTruncation()\n   }\n \n+  @Test\n+  def testDefaultValueRestoredAfterDeleteDynamicConfig(): Unit = {\n+    val newProps = new Properties\n+    newProps.put(KafkaConfig.LogRetentionTimeMillisProp, \"100000\")\n+    newProps.put(KafkaConfig.LogFlushIntervalMsProp, \"10000\")\n+    TestUtils.incrementalAlterConfigs(servers, adminClients.head, newProps, perBrokerConfig = false).all.get", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88226a4d2989c7e23243a120a93d9f5f80d09760"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMjAwNDEy", "url": "https://github.com/apache/kafka/pull/9051#pullrequestreview-453200412", "createdAt": "2020-07-22T10:42:48Z", "commit": {"oid": "88226a4d2989c7e23243a120a93d9f5f80d09760"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxMDo0Mjo0OFrOG1c6WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxMDo0Mjo0OFrOG1c6WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODcwMTQwMQ==", "bodyText": "Can we move this into DynamicBrokerReconfigurationTest.testDefaultTopicConfig() and also verify that configs of existing topics have been updated? Or add a topic in this test to verify.", "url": "https://github.com/apache/kafka/pull/9051#discussion_r458701401", "createdAt": "2020-07-22T10:42:48Z", "author": {"login": "rajinisivaram"}, "path": "core/src/test/scala/integration/kafka/server/DynamicBrokerReconfigurationTest.scala", "diffHunk": "@@ -775,6 +775,24 @@ class DynamicBrokerReconfigurationTest extends ZooKeeperTestHarness with SaslSet\n     verifyMarkPartitionsForTruncation()\n   }\n \n+  @Test\n+  def testDefaultValueRestoredAfterDeleteDynamicConfig(): Unit = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88226a4d2989c7e23243a120a93d9f5f80d09760"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d604a82ff5a73bdd44bd25e312d09fd5442fab63", "author": {"user": {"login": "huxihx", "name": "huxi"}}, "url": "https://github.com/apache/kafka/commit/d604a82ff5a73bdd44bd25e312d09fd5442fab63", "committedDate": "2020-07-23T03:10:40Z", "message": "addressed rajinisivaram's comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzOTY0MDE5", "url": "https://github.com/apache/kafka/pull/9051#pullrequestreview-453964019", "createdAt": "2020-07-23T09:21:34Z", "commit": {"oid": "d604a82ff5a73bdd44bd25e312d09fd5442fab63"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1350, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}