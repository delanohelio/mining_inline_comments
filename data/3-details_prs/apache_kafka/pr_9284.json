{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NjQ4MTE0", "number": 9284, "title": "KAFKA-10479 Throw exception if users try to update configs of existen\u2026", "bodyText": "def immutableListenerConfigs(kafkaConfig: KafkaConfig, prefix: String): Map[String, AnyRef] = {\n      newConfig.originals.asScala.filter { case (key, _) =>\n        key.startsWith(prefix) && !DynamicSecurityConfigs.contains(key)\n      }\n    }\nWe don't actually compare new configs to origin configs so the suitable exception is not thrown.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-09-14T14:10:10Z", "url": "https://github.com/apache/kafka/pull/9284", "merged": true, "mergeCommit": {"oid": "821c1ac6641845aeca96a43bc2b946ecec5cba4f"}, "closed": true, "closedAt": "2020-09-29T19:15:09Z", "author": {"login": "chia7712"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdI9l2jgBqjM3NjU5OTg5NTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNsmjXgH2gAyNDg2NjQ4MTE0OjlkN2IwODc1MmJmOGZmYzVhZDlkY2MwMTJmZjAwMWY1YzcxNjkxODk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwODUwMTMz", "url": "https://github.com/apache/kafka/pull/9284#pullrequestreview-490850133", "createdAt": "2020-09-17T17:54:09Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNzo1NDowOVrOHTusGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNzo1NDowOVrOHTusGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ0OTk0Nw==", "bodyText": "Right, this line does not work correctly as of present.", "url": "https://github.com/apache/kafka/pull/9284#discussion_r490449947", "createdAt": "2020-09-17T17:54:09Z", "author": {"login": "dongjinleekr"}, "path": "core/src/main/scala/kafka/server/DynamicBrokerConfig.scala", "diffHunk": "@@ -910,6 +903,11 @@ class DynamicListenerConfig(server: KafkaServer) extends BrokerReconfigurable wi\n     if (!newListeners.keySet.subsetOf(newConfig.listenerSecurityProtocolMap.keySet))\n       throw new ConfigException(s\"Listeners '$newListeners' must be subset of listener map '${newConfig.listenerSecurityProtocolMap}'\")\n     newListeners.keySet.intersect(oldListeners.keySet).foreach { listenerName =>\n+      def immutableListenerConfigs(kafkaConfig: KafkaConfig, prefix: String): Map[String, AnyRef] = {\n+        kafkaConfig.originals.asScala.filter { case (key, _) =>\n+          key.startsWith(prefix) && !DynamicSecurityConfigs.contains(key)\n+        }\n+      }\n       val prefix = listenerName.configPrefix\n       val newListenerProps = immutableListenerConfigs(newConfig, prefix)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwOTkyMjc5", "url": "https://github.com/apache/kafka/pull/9284#pullrequestreview-490992279", "createdAt": "2020-09-17T21:11:41Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyOTg5NjMw", "url": "https://github.com/apache/kafka/pull/9284#pullrequestreview-492989630", "createdAt": "2020-09-21T21:22:10Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0OTY4MDQ4", "url": "https://github.com/apache/kafka/pull/9284#pullrequestreview-494968048", "createdAt": "2020-09-23T19:08:21Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NTU3NzEy", "url": "https://github.com/apache/kafka/pull/9284#pullrequestreview-497557712", "createdAt": "2020-09-28T14:16:18Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNDoxNjoxOFrOHY_0Pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNDoxNjoxOFrOHY_0Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk3MzQzOA==", "bodyText": "Does it really break compatibility? It seems like the previous behavior wasn't working as intended anyway.", "url": "https://github.com/apache/kafka/pull/9284#discussion_r495973438", "createdAt": "2020-09-28T14:16:18Z", "author": {"login": "ijuma"}, "path": "docs/upgrade.html", "diffHunk": "@@ -27,6 +27,14 @@ <h5><a id=\"upgrade_270_notable\" href=\"#upgrade_270_notable\">Notable changes in 2\n         <code>default.api.timeout.ms</code>, and Kafka Streams' new <code>task.timeout.ms</code> parameters instead.\n         Note that parameter <code>retry.backoff.ms</code> is not impacted by this change.\n     </li>\n+    <li>Altering non-reconfigurable configs of existent listeners causes <code>InvalidRequestException</code>.\n+        By contrast, the previous behavior would have caused the updated configuration to be persisted, but it wouldn't\n+        take effect until the broker was restarted. This change breaks behavior compatibility but the old behavior is not\n+        worth keeping since that behavior is unintended. see\n+        <a href=\"https://github.com/apache/kafka/pull/9284\">KAFKA-10479</a> for more discussion.\n+        see <code>DynamicBrokerConfig.DynamicSecurityConfigs</code> and <code>SocketServer.ListenerReconfigurableConfigs</code>\n+        for reconfigurable configs of existent listeners.\n+    </li>", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NTU4Njg1", "url": "https://github.com/apache/kafka/pull/9284#pullrequestreview-497558685", "createdAt": "2020-09-28T14:17:18Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNDoxNzoxOFrOHY_20g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNDoxNzoxOFrOHY_20g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk3NDA5OA==", "bodyText": "It is possible to update configs of existing listeners if they are dynamic, right?", "url": "https://github.com/apache/kafka/pull/9284#discussion_r495974098", "createdAt": "2020-09-28T14:17:18Z", "author": {"login": "ijuma"}, "path": "core/src/test/scala/unit/kafka/server/DynamicBrokerConfigTest.scala", "diffHunk": "@@ -327,10 +327,12 @@ class DynamicBrokerConfigTest {\n     EasyMock.replay(kafkaServer)\n \n     props.put(KafkaConfig.ListenersProp, \"PLAINTEXT://hostname:9092,SASL_PLAINTEXT://hostname:9093\")\n-    val newConfig = KafkaConfig(props)\n+    new DynamicListenerConfig(kafkaServer).validateReconfiguration(KafkaConfig(props))\n \n+    // it is illegal to update configs of existent listeners\n+    props.put(\"listener.name.plaintext.you.should.not.pass\", \"failure\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d72c27970bbefd380ee18964948ee06b302a7ad8", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/d72c27970bbefd380ee18964948ee06b302a7ad8", "committedDate": "2020-09-28T15:26:43Z", "message": "KAFKA-10479 Throw exception if users try to update configs of existent listeners"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca3d11de2afcf498a8e815fece433762e7aaa057", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/ca3d11de2afcf498a8e815fece433762e7aaa057", "committedDate": "2020-09-28T15:26:43Z", "message": "exclude configurable configs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "877cbe5b3eb6dfc671c4bb7c13b445afb1e666de", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/877cbe5b3eb6dfc671c4bb7c13b445afb1e666de", "committedDate": "2020-09-28T15:26:43Z", "message": "mention this PR in docs/upgrade.html"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efb8f2883f15c27afe2f91b9b3496aeb8e9fb0c3", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/efb8f2883f15c27afe2f91b9b3496aeb8e9fb0c3", "committedDate": "2020-09-28T15:41:26Z", "message": "tweak comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "efb8f2883f15c27afe2f91b9b3496aeb8e9fb0c3", "author": {"user": {"login": "chia7712", "name": "Chia-Ping Tsai"}}, "url": "https://github.com/apache/kafka/commit/efb8f2883f15c27afe2f91b9b3496aeb8e9fb0c3", "committedDate": "2020-09-28T15:41:26Z", "message": "tweak comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTYxODcz", "url": "https://github.com/apache/kafka/pull/9284#pullrequestreview-497961873", "createdAt": "2020-09-28T23:19:38Z", "commit": {"oid": "877cbe5b3eb6dfc671c4bb7c13b445afb1e666de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMzoxOTozOVrOHZS-Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMzoxOTozOVrOHZS-Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI4NzI3NA==", "bodyText": "nit: can we take out the sentence about behavior compatibility. I think it is enough to say that the previous behavior was unintended.", "url": "https://github.com/apache/kafka/pull/9284#discussion_r496287274", "createdAt": "2020-09-28T23:19:39Z", "author": {"login": "hachikuji"}, "path": "docs/upgrade.html", "diffHunk": "@@ -27,6 +27,14 @@ <h5><a id=\"upgrade_270_notable\" href=\"#upgrade_270_notable\">Notable changes in 2\n         <code>default.api.timeout.ms</code>, and Kafka Streams' new <code>task.timeout.ms</code> parameters instead.\n         Note that parameter <code>retry.backoff.ms</code> is not impacted by this change.\n     </li>\n+    <li>Altering non-reconfigurable configs of existent listeners causes <code>InvalidRequestException</code>.\n+        By contrast, the previous behavior would have caused the updated configuration to be persisted, but it wouldn't\n+        take effect until the broker was restarted. This change breaks behavior compatibility but the old behavior is not", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "877cbe5b3eb6dfc671c4bb7c13b445afb1e666de"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NzQ1MzE0", "url": "https://github.com/apache/kafka/pull/9284#pullrequestreview-498745314", "createdAt": "2020-09-29T18:01:13Z", "commit": {"oid": "efb8f2883f15c27afe2f91b9b3496aeb8e9fb0c3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d7b08752bf8ffc5ad9dcc012ff001f5c7169189", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/9d7b08752bf8ffc5ad9dcc012ff001f5c7169189", "committedDate": "2020-09-29T18:36:11Z", "message": "Minor message tweak in upgrade notes\n\nRemoved the comment about the old behavior not being worth maintaining"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 618, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}