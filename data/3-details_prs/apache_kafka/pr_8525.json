{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NTQzMDA5", "number": 8525, "title": "KAFKA-9885; Evict last members of a group when the maximum allowed is reached", "bodyText": "This PR updates the algorithm which limits the number of members within a group (group.max.size) to fix the following two issues:\n\nAs described in KAFKA-9885, we found out that multiple members of a group can be evicted if the leader of the consumer offset partition changes before the group is persisted. This happens because the current evection logic always evict the first member rejoining the group.\nWe also found out that dynamic members, when required to have a known member id, are not always limited. The caveat is that the current logic only considers unknown members and uses the group size, which does not include the so called pending members, to accept or reject a member. In this case, when they rejoins, they are not unknown member anymore and thus could bypass the limit. See testDynamicMembersJoinGroupWithMaxSizeAndRequiredKnownMember for the whole scenario.\n\nThis PR changes the logic to address the above two issues and extends the tests coverage to cover all the member types.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-04-21T09:09:08Z", "url": "https://github.com/apache/kafka/pull/8525", "merged": true, "mergeCommit": {"oid": "c5d13dcb6ca2a7564cb5b707941b7c68d3de9289"}, "closed": true, "closedAt": "2020-04-27T21:43:30Z", "author": {"login": "dajac"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcawyGqgH2gAyNDA2NTQzMDA5OjJkOTVjNzRkNzlhZjMyZTBhYjE0OWM0N2ZiY2IzM2I4YTQ3M2YyMTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcb2WKTgH2gAyNDA2NTQzMDA5OjlmMzRkNjBhNWE3ZDkxNDFjNmIwYTgyMTllNTk5MjJlMzI3MDIxZTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2d95c74d79af32e0ab149c47fbcb33b8a473f215", "author": {"user": {"login": "dajac", "name": "David Jacot"}}, "url": "https://github.com/apache/kafka/commit/2d95c74d79af32e0ab149c47fbcb33b8a473f215", "committedDate": "2020-04-24T12:38:17Z", "message": "KAFKA-9885; Evict last members of a group when the maximum allowed is reached"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "2d95c74d79af32e0ab149c47fbcb33b8a473f215", "author": {"user": {"login": "dajac", "name": "David Jacot"}}, "url": "https://github.com/apache/kafka/commit/2d95c74d79af32e0ab149c47fbcb33b8a473f215", "committedDate": "2020-04-24T12:38:17Z", "message": "KAFKA-9885; Evict last members of a group when the maximum allowed is reached"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMTMyNjk4", "url": "https://github.com/apache/kafka/pull/8525#pullrequestreview-400132698", "createdAt": "2020-04-24T17:20:15Z", "commit": {"oid": "2d95c74d79af32e0ab149c47fbcb33b8a473f215"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzoyMDoxNVrOGLhkcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzoyMDoxNVrOGLhkcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDczNzUyMQ==", "bodyText": "typo: bellow", "url": "https://github.com/apache/kafka/pull/8525#discussion_r414737521", "createdAt": "2020-04-24T17:20:15Z", "author": {"login": "hachikuji"}, "path": "core/src/main/scala/kafka/coordinator/group/GroupCoordinator.scala", "diffHunk": "@@ -124,6 +124,35 @@ class GroupCoordinator(val brokerId: Int,\n     info(\"Shutdown complete.\")\n   }\n \n+  /**\n+   * Verify if the group has space to accept the joining member. The various\n+   * criteria are explained bellow.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d95c74d79af32e0ab149c47fbcb33b8a473f215"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f34d60a5a7d9141c6b0a8219e59922e327021e5", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/9f34d60a5a7d9141c6b0a8219e59922e327021e5", "committedDate": "2020-04-27T21:41:07Z", "message": "Fix a couple typos"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1613, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}