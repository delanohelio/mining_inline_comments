{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1ODk0NTg4", "number": 8260, "title": "KAFKA-9625: Fixing IncrementalAlterConfigs with respect to Broker Configs", "bodyText": "This PR introduces a bug fix for IncrementalAlterConfigs with respect to altering broker configs. Previously broker throttles were incorrectly marked as sensitive configurations. In addition, when trying to delete configs, DescribeConfigs would always return the initially deleted configs. This PR fixes both of those issues.\nMore detailed description of your change,\nif necessary. The PR title and PR message become\nthe squashed commit message, so use a separate\ncomment to ping reviewers.\nSummary of testing strategy (including rationale)\nfor the feature or bug fix. Unit and/or integration\ntests are expected for any behaviour change and\nsystem tests should be considered for larger changes.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-03-10T01:42:46Z", "url": "https://github.com/apache/kafka/pull/8260", "merged": true, "mergeCommit": {"oid": "5fc3cd61fcb73da8b52f34b72fe6bb7457f46ce2"}, "closed": true, "closedAt": "2020-03-18T06:02:33Z", "author": {"login": "skaundinya15"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMU3nGgFqTM3MjEwNDIxNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOm13ZgBqjMxMzg1MTM3NjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMTA0MjE2", "url": "https://github.com/apache/kafka/pull/8260#pullrequestreview-372104216", "createdAt": "2020-03-10T16:12:01Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNjoxMjowMVrOF0WM8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNjoxMjowMVrOF0WM8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQzNDAzNA==", "bodyText": "Hmm... we don't want to re-apply configurations that haven't changed between the new and the old set of configs.  We want to generate a map that includes only the changes (whether they are additions or removals.)", "url": "https://github.com/apache/kafka/pull/8260#discussion_r390434034", "createdAt": "2020-03-10T16:12:01Z", "author": {"login": "cmccabe"}, "path": "core/src/main/scala/kafka/server/DynamicBrokerConfig.scala", "diffHunk": "@@ -507,7 +507,7 @@ class DynamicBrokerConfig(private val kafkaConfig: KafkaConfig) extends Logging\n \n   private def processReconfiguration(newProps: Map[String, String], validateOnly: Boolean): (KafkaConfig, List[BrokerReconfigurable]) = {\n     val newConfig = new KafkaConfig(newProps.asJava, !validateOnly, None)\n-    val updatedMap = updatedConfigs(newConfig.originalsFromThisConfig, currentConfig.originals)\n+    val updatedMap = newConfig.originalsFromThisConfig.asScala", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTQ4NTg0", "url": "https://github.com/apache/kafka/pull/8260#pullrequestreview-373948584", "createdAt": "2020-03-12T22:45:04Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMjo0NTowNFrOF1yZtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMjo0NTowNFrOF1yZtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk0NDYyOA==", "bodyText": "This isn't quite deleted keys, right?  This is keys that are in the current map, but have a different value (or no value) in the new map.\nDeleted keys would be something like currentProps.asScala.filter(!newProps.contains(_))", "url": "https://github.com/apache/kafka/pull/8260#discussion_r391944628", "createdAt": "2020-03-12T22:45:04Z", "author": {"login": "cmccabe"}, "path": "core/src/main/scala/kafka/server/DynamicBrokerConfig.scala", "diffHunk": "@@ -465,10 +465,15 @@ class DynamicBrokerConfig(private val kafkaConfig: KafkaConfig) extends Logging\n       reconfigurable.reconfigure(newConfig)\n   }\n \n-  private def updatedConfigs(newProps: java.util.Map[String, _], currentProps: java.util.Map[_, _]): mutable.Map[String, _] = {\n-    newProps.asScala.filter {\n+  private def updatedConfigs(newProps: java.util.Map[String, _], currentProps: java.util.Map[String, _]):\n+  (mutable.Map[String, _], Set[String]) = {\n+    val deletedKeySet = currentProps.asScala.filter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 8}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzcyNTUx", "url": "https://github.com/apache/kafka/pull/8260#pullrequestreview-374772551", "createdAt": "2020-03-15T05:23:59Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQwNToyMzo1OVrOF2dAsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQwNToyMzo1OVrOF2dAsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY0MjczOQ==", "bodyText": "We should have JavaDoc for this function to identify what it returns.  Also, this is a nitpick, but considering that deletedKeySet is returned as the second part of the tuple, why not put the code for calculating it second in the function?", "url": "https://github.com/apache/kafka/pull/8260#discussion_r392642739", "createdAt": "2020-03-15T05:23:59Z", "author": {"login": "cmccabe"}, "path": "core/src/main/scala/kafka/server/DynamicBrokerConfig.scala", "diffHunk": "@@ -469,10 +469,15 @@ class DynamicBrokerConfig(private val kafkaConfig: KafkaConfig) extends Logging\n       reconfigurable.reconfigure(newConfig)\n   }\n \n-  private def updatedConfigs(newProps: java.util.Map[String, _], currentProps: java.util.Map[_, _]): mutable.Map[String, _] = {\n-    newProps.asScala.filter {\n+  private def updatedConfigs(newProps: java.util.Map[String, _], currentProps: java.util.Map[String, _]):", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzcyNjAz", "url": "https://github.com/apache/kafka/pull/8260#pullrequestreview-374772603", "createdAt": "2020-03-15T05:25:51Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQwNToyNTo1MVrOF2dA_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQwNToyNTo1MVrOF2dA_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY0MjgxNA==", "bodyText": "This works, but it looks a little nicer from a scala point of view to have val (changeMap, deletedKeySet) = updatedConfigs(...).  It's a bit of an adjustment coming from Java, I know.", "url": "https://github.com/apache/kafka/pull/8260#discussion_r392642814", "createdAt": "2020-03-15T05:25:51Z", "author": {"login": "cmccabe"}, "path": "core/src/main/scala/kafka/server/DynamicBrokerConfig.scala", "diffHunk": "@@ -511,23 +516,25 @@ class DynamicBrokerConfig(private val kafkaConfig: KafkaConfig) extends Logging\n \n   private def processReconfiguration(newProps: Map[String, String], validateOnly: Boolean): (KafkaConfig, List[BrokerReconfigurable]) = {\n     val newConfig = new KafkaConfig(newProps.asJava, !validateOnly, None)\n-    val updatedMap = updatedConfigs(newConfig.originalsFromThisConfig, currentConfig.originals)\n-    if (updatedMap.nonEmpty) {\n+    val updatedConfig = updatedConfigs(newConfig.originalsFromThisConfig, currentConfig.originals)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4a8d13917e93227e369b1961b8c24e4318c9957", "author": {"user": {"login": "cmccabe", "name": "Colin Patrick McCabe"}}, "url": "https://github.com/apache/kafka/commit/b4a8d13917e93227e369b1961b8c24e4318c9957", "committedDate": "2020-03-17T18:16:04Z", "message": "KAFKA-9625: Broker throttles are incorrectly marked as sensitive configurations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85f82a2c5b71054112ed95fa3652946bae742a9b", "author": {"user": {"login": "skaundinya15", "name": "Sanjana Kaundinya"}}, "url": "https://github.com/apache/kafka/commit/85f82a2c5b71054112ed95fa3652946bae742a9b", "committedDate": "2020-03-17T18:16:04Z", "message": "reverting log4j props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf44f4a39be41debf185b356a50a8fb5f53f4e95", "author": {"user": {"login": "skaundinya15", "name": "Sanjana Kaundinya"}}, "url": "https://github.com/apache/kafka/commit/cf44f4a39be41debf185b356a50a8fb5f53f4e95", "committedDate": "2020-03-17T18:16:05Z", "message": "fixing only deletion edge case bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c225d49beaa6fe461702e1ea719e5fc721f9f172", "author": {"user": {"login": "skaundinya15", "name": "Sanjana Kaundinya"}}, "url": "https://github.com/apache/kafka/commit/c225d49beaa6fe461702e1ea719e5fc721f9f172", "committedDate": "2020-03-17T18:16:05Z", "message": "modified test a bit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfdb74da1295cdaa0d6cb0a720750aecd3d3efac", "author": {"user": {"login": "skaundinya15", "name": "Sanjana Kaundinya"}}, "url": "https://github.com/apache/kafka/commit/cfdb74da1295cdaa0d6cb0a720750aecd3d3efac", "committedDate": "2020-03-17T18:16:05Z", "message": "removing unnecessary log"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd641cf86a67cec4cbaec91424185ddfdceb7b45", "author": {"user": {"login": "skaundinya15", "name": "Sanjana Kaundinya"}}, "url": "https://github.com/apache/kafka/commit/dd641cf86a67cec4cbaec91424185ddfdceb7b45", "committedDate": "2020-03-17T18:16:05Z", "message": "addressing PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdb06be5afd43c4addf3d238ee6a3fb80da5b65d", "author": {"user": {"login": "skaundinya15", "name": "Sanjana Kaundinya"}}, "url": "https://github.com/apache/kafka/commit/bdb06be5afd43c4addf3d238ee6a3fb80da5b65d", "committedDate": "2020-03-17T18:16:05Z", "message": "simplifying logic a bit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b74532d73612e793275709152413ff4abd21567", "author": {"user": {"login": "skaundinya15", "name": "Sanjana Kaundinya"}}, "url": "https://github.com/apache/kafka/commit/1b74532d73612e793275709152413ff4abd21567", "committedDate": "2020-03-17T18:16:05Z", "message": "addressing PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71f2c99ed8e8d09a70213ad60b77f69f0e5415ca", "author": {"user": {"login": "skaundinya15", "name": "Sanjana Kaundinya"}}, "url": "https://github.com/apache/kafka/commit/71f2c99ed8e8d09a70213ad60b77f69f0e5415ca", "committedDate": "2020-03-17T18:16:05Z", "message": "rebasing commits on trunk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53b78e4b409ed8d1daa62efd226f1f235fb4a81f", "author": {"user": {"login": "skaundinya15", "name": "Sanjana Kaundinya"}}, "url": "https://github.com/apache/kafka/commit/53b78e4b409ed8d1daa62efd226f1f235fb4a81f", "committedDate": "2020-03-17T18:16:05Z", "message": "addressing PR comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "53b78e4b409ed8d1daa62efd226f1f235fb4a81f", "author": {"user": {"login": "skaundinya15", "name": "Sanjana Kaundinya"}}, "url": "https://github.com/apache/kafka/commit/53b78e4b409ed8d1daa62efd226f1f235fb4a81f", "committedDate": "2020-03-17T18:16:05Z", "message": "addressing PR comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 193, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}