{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4MDcwNTQ2", "number": 9247, "title": "KAFKA-10362: When resuming Streams active task with EOS, the checkpoint file is deleted", "bodyText": "What was the issue?\nhttps://issues.apache.org/jira/browse/KAFKA-10362\nDeleted the checkpoint file before the transition from SUSPENDED state to RESTORING state\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-09-02T18:32:20Z", "url": "https://github.com/apache/kafka/pull/9247", "merged": true, "mergeCommit": {"oid": "a8b5f5a430412aa6536beb2a93237a1b768693c5"}, "closed": true, "closedAt": "2020-10-07T18:20:07Z", "author": {"login": "DOJI45"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFARnjAH2gAyNDc4MDcwNTQ2OjJiYTgxY2ExNGE3MzZkMjYwNmViNjFiYTcwMGFhMTAyODBmMzI4MTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJdVqsAH2gAyNDc4MDcwNTQ2OjQ4OWIwMzRhOGQzNDE0NmQ2ZjNkZTM0NzFmNDRiYWY4MTRjYmY5NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2ba81ca14a736d2606eb61ba700aa10280f32811", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/2ba81ca14a736d2606eb61ba700aa10280f32811", "committedDate": "2020-09-02T18:26:06Z", "message": "When resuming Streams active task with EOS, the checkpoint file is deleted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aae073ba496f1b00c586fe804688892129980199", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/aae073ba496f1b00c586fe804688892129980199", "committedDate": "2020-09-02T18:43:43Z", "message": "changed error message of IO exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDI4MDM2", "url": "https://github.com/apache/kafka/pull/9247#pullrequestreview-485428036", "createdAt": "2020-09-09T21:50:07Z", "commit": {"oid": "aae073ba496f1b00c586fe804688892129980199"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo1MDowN1rOHPbiRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMTo1MToyNVrOHPbkcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MTgyOA==", "bodyText": "nit: I'd suggest we just inline this function inside StreamTask since 1) this is only triggered with EOS enabled, and its name deleteCheckPointFile maybe a bit misleading, and 2) it is a very simply function anyways.", "url": "https://github.com/apache/kafka/pull/9247#discussion_r485941828", "createdAt": "2020-09-09T21:50:07Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorStateManager.java", "diffHunk": "@@ -662,4 +662,10 @@ public TopicPartition registeredChangelogPartitionFor(final String storeName) {\n     public String changelogFor(final String storeName) {\n         return storeToChangelogTopic.get(storeName);\n     }\n+\n+    public void deleteCheckPointFile() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae073ba496f1b00c586fe804688892129980199"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MjM4NA==", "bodyText": "nit: log.debug(\"Deleted check point file upon resuming with EOS enabled\");", "url": "https://github.com/apache/kafka/pull/9247#discussion_r485942384", "createdAt": "2020-09-09T21:51:25Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -332,6 +332,15 @@ public void resume() {\n             case SUSPENDED:\n                 // just transit the state without any logical changes: suspended and restoring states\n                 // are not actually any different for inner modules\n+\n+                // Deleting checkpoint file before transition to RESTORING state (KAFKA-10362)\n+                try {\n+                    stateMgr.deleteCheckPointFile();\n+                    log.debug(\"Deleted check point file\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae073ba496f1b00c586fe804688892129980199"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70a7b2c3cbb60e265d10fc28d8356e8ddf2a18c3", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/70a7b2c3cbb60e265d10fc28d8356e8ddf2a18c3", "committedDate": "2020-09-12T17:24:06Z", "message": "Merge branch 'trunk' into KAFKA-10362"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "489b034a8d34146d6f3de3471f44baf814cbf970", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/489b034a8d34146d6f3de3471f44baf814cbf970", "committedDate": "2020-09-16T14:33:28Z", "message": "unit test cases added"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 878, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}