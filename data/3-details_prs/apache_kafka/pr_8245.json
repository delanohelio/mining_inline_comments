{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDU1NTcz", "number": 8245, "title": "MINOR: break up StreamsPartitionAssignor's gargantuan #assign", "bodyText": "Just a minor refactoring of StreamsPartitionAssignor's endless assign method into logical chunks to hopefully improve readability. No logical changes, literally just moving code around and adding docs.\nThe hope is to make it easier to write and review KIP-441 PRs that dig into the assignment logic", "createdAt": "2020-03-06T22:51:32Z", "url": "https://github.com/apache/kafka/pull/8245", "merged": true, "mergeCommit": {"oid": "4b03d67e106c6d3b9dd465a308a62b400ead70a4"}, "closed": true, "closedAt": "2020-03-07T16:46:38Z", "author": {"login": "ableegoldman"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLIHZRAH2gAyMzg1MDU1NTczOjM1Y2E0ODdjYzA1YWVkMzE2MmMyZTY1MDQzMTQxY2Q1YTJmNTAyMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLXiNhAFqTM3MDc1MjY4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "35ca487cc05aed3162c2e65043141cd5a2f50209", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/35ca487cc05aed3162c2e65043141cd5a2f50209", "committedDate": "2020-03-06T22:46:34Z", "message": "break up #assign"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b0ee15f3dd8c268656d0b17d47beda0445d24dd", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/0b0ee15f3dd8c268656d0b17d47beda0445d24dd", "committedDate": "2020-03-06T22:53:07Z", "message": "checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0acd802317eb6dbc008a8959d82c4b64b715aff5", "author": {"user": {"login": "ableegoldman", "name": "A. Sophie Blee-Goldman"}}, "url": "https://github.com/apache/kafka/commit/0acd802317eb6dbc008a8959d82c4b64b715aff5", "committedDate": "2020-03-06T23:03:47Z", "message": "futureclientmetadata"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzUyNjgx", "url": "https://github.com/apache/kafka/pull/8245#pullrequestreview-370752681", "createdAt": "2020-03-07T16:31:18Z", "commit": {"oid": "0acd802317eb6dbc008a8959d82c4b64b715aff5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QxNjozMToxOFrOFzO69g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QxNjozMToxOFrOFzO69g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTI2NjE2Ng==", "bodyText": "nit: add an error log entry as well?", "url": "https://github.com/apache/kafka/pull/8245#discussion_r389266166", "createdAt": "2020-03-07T16:31:18Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignor.java", "diffHunk": "@@ -321,13 +320,107 @@ public GroupAssignment assign(final Cluster metadata, final GroupSubscription gr\n             clientMetadata.addPreviousTasks(info);\n         }\n \n+        final boolean versionProbing =\n+            checkMetadataVersions(minReceivedMetadataVersion, minSupportedMetadataVersion, futureMetadataVersion);\n+\n+        log.debug(\"Constructed client metadata {} from the member subscriptions.\", clientMetadataMap);\n+\n+        // ---------------- Step One ---------------- //\n+\n+        // parse the topology to determine the repartition source topics,\n+        // making sure they are created with the number of partitions as\n+        // the maximum of the depending sub-topologies source topics' number of partitions\n+        final Map<Integer, InternalTopologyBuilder.TopicsInfo> topicGroups = taskManager.builder().topicGroups();\n+\n+        final Map<TopicPartition, PartitionInfo> allRepartitionTopicPartitions;\n+        try {\n+            allRepartitionTopicPartitions = prepareRepartitionTopics(topicGroups, metadata);\n+        } catch (final TaskAssignmentException e) {\n+            return new GroupAssignment(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0acd802317eb6dbc008a8959d82c4b64b715aff5"}, "originalPosition": 72}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 138, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}