{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MzU4Nzg5", "number": 8420, "title": "KAFKA-9815; Ensure consumer always re-joins if JoinGroup fails", "bodyText": "On metadata change for assigned topics, we trigger rebalance, revoke partitions and send JoinGroup. If metadata reverts to the original value and JoinGroup fails, we don't resend JoinGroup because we don't set rejoinNeeded. This PR sets rejoinNeeded=true when rebalance is triggered due to metadata change to ensure that we retry on failure.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-04-03T19:57:37Z", "url": "https://github.com/apache/kafka/pull/8420", "merged": true, "mergeCommit": {"oid": "588e8a5be83037225716a78358d0203a9e070168"}, "closed": true, "closedAt": "2020-04-07T00:00:11Z", "author": {"login": "rajinisivaram"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUGYicAH2gAyMzk4MzU4Nzg5OjgxMWVkOTQzMjU2ZjBiNzYxYTAwODhjNWU3MzQwNTUyNmQ4YjY1OGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVHjoogFqTM4ODY5Mzg0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "811ed943256f0b761a0088c5e73405526d8b658f", "author": {"user": {"login": "rajinisivaram", "name": "Rajini Sivaram"}}, "url": "https://github.com/apache/kafka/commit/811ed943256f0b761a0088c5e73405526d8b658f", "committedDate": "2020-04-03T19:50:48Z", "message": "KAFKA-9815; Ensure consumer always re-joins if JoinGroup fails"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTU3MTU4", "url": "https://github.com/apache/kafka/pull/8420#pullrequestreview-387557158", "createdAt": "2020-04-03T20:24:11Z", "commit": {"oid": "811ed943256f0b761a0088c5e73405526d8b658f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODU5Mjg2", "url": "https://github.com/apache/kafka/pull/8420#pullrequestreview-387859286", "createdAt": "2020-04-05T20:46:54Z", "commit": {"oid": "811ed943256f0b761a0088c5e73405526d8b658f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMDo0Njo1NFrOGBDPcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMDo0Njo1NFrOGBDPcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc1NDg2NQ==", "bodyText": "Pardon me, I failed to catch the fixing/improvement about setting  flag rejoinNeeded to true.\nThe flag rejoinNeeded is read by AbstractCoordinator#rejoinNeededOrPending only and the return value is set to true in this overrided method (ConsumerCoordinator#rejoinNeededOrPending). Hence, setting flag rejoinNeeded to true seems to be a NOP?", "url": "https://github.com/apache/kafka/pull/8420#discussion_r403754865", "createdAt": "2020-04-05T20:46:54Z", "author": {"login": "chia7712"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/ConsumerCoordinator.java", "diffHunk": "@@ -747,11 +747,14 @@ public boolean rejoinNeededOrPending() {\n \n         // we need to rejoin if we performed the assignment and metadata has changed;\n         // also for those owned-but-no-longer-existed partitions we should drop them as lost\n-        if (assignmentSnapshot != null && !assignmentSnapshot.matches(metadataSnapshot))\n+        if (assignmentSnapshot != null && !assignmentSnapshot.matches(metadataSnapshot)) {\n+            requestRejoin();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "811ed943256f0b761a0088c5e73405526d8b658f"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NjkzODQ3", "url": "https://github.com/apache/kafka/pull/8420#pullrequestreview-388693847", "createdAt": "2020-04-06T23:46:45Z", "commit": {"oid": "811ed943256f0b761a0088c5e73405526d8b658f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 85, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}