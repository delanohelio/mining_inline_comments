{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NDg4OTYy", "number": 8370, "title": "KAFKA-9753: Add active tasks process ratio", "bodyText": "Measure the percentage ratio the stream thread spent on processing each task among all assigned active tasks (KIP-444).\nAlso add unit tests to cover the added metrics in this PR and the previous #8358\nAlso trying to fix the flaky test reported in KAFKA-5842\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-03-27T00:30:02Z", "url": "https://github.com/apache/kafka/pull/8370", "merged": true, "mergeCommit": {"oid": "353aa6206d43b4923d21510797709bbbb210f6b6"}, "closed": true, "closedAt": "2020-03-31T23:39:29Z", "author": {"login": "guozhangwang"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ8k_tgH2gAyMzk0NDg4OTYyOjcwY2E1NzRmZDhlM2YzYmMyY2E0MmIzYmI1NmRlOGY5MzZlNzdmMDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTL0dfAH2gAyMzk0NDg4OTYyOjMyZWYzOGM0MDcyODg0MWE3MjBhYTc1ZTdjMjFiMTkzMjE1ZWVhMWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "70ca574fd8e3f3bc2ca42b3bb56de8f936e77f07", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/70ca574fd8e3f3bc2ca42b3bb56de8f936e77f07", "committedDate": "2020-03-25T00:43:35Z", "message": "first pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b33c3e798f4f63964df1f961210d0ab0975dc52", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/8b33c3e798f4f63964df1f961210d0ab0975dc52", "committedDate": "2020-03-25T05:02:12Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into K9756-loop-tasks-order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77e475e5ca63a0d57070b49b8366d60857b7b7d2", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/77e475e5ca63a0d57070b49b8366d60857b7b7d2", "committedDate": "2020-03-25T23:15:08Z", "message": "fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5c743baa264f5cc9ea6c9f48aed24cb8ab72365", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/d5c743baa264f5cc9ea6c9f48aed24cb8ab72365", "committedDate": "2020-03-26T00:14:28Z", "message": "add unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e81f042e5b0da16c0f27a5c64a0bf6c64259613e", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/e81f042e5b0da16c0f27a5c64a0bf6c64259613e", "committedDate": "2020-03-26T03:51:22Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into K9753-active-process-ratio"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb82b253e3e2c46d55c705dfaf790e133a18dce", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/8eb82b253e3e2c46d55c705dfaf790e133a18dce", "committedDate": "2020-03-26T17:27:15Z", "message": "first pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2982363abcca81fbd64a0b9835ec28b619da1a9", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/b2982363abcca81fbd64a0b9835ec28b619da1a9", "committedDate": "2020-03-26T17:28:50Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into K9756-loop-tasks-order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "153b7417674c9bdc6d4b0aaf9f5684c1a646ff11", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/153b7417674c9bdc6d4b0aaf9f5684c1a646ff11", "committedDate": "2020-03-26T19:07:16Z", "message": "should be INFO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7d945ccf2b511398edd744221d84eb5f318d69c", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/a7d945ccf2b511398edd744221d84eb5f318d69c", "committedDate": "2020-03-26T23:12:48Z", "message": "fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7431c1ab6aa5182e734d70f51b38b53b469e3081", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/7431c1ab6aa5182e734d70f51b38b53b469e3081", "committedDate": "2020-03-26T23:12:59Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into K9756-loop-tasks-order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0286037701fdc8a2993a9953549974baa8f22b85", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/0286037701fdc8a2993a9953549974baa8f22b85", "committedDate": "2020-03-26T23:39:50Z", "message": "github comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc5010ef3fc6e61c375689b8c6ef16f8f81013ca", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/bc5010ef3fc6e61c375689b8c6ef16f8f81013ca", "committedDate": "2020-03-26T23:46:45Z", "message": "rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "decaa94dbbf1cc5b4370c196e8dc284fe9618381", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/decaa94dbbf1cc5b4370c196e8dc284fe9618381", "committedDate": "2020-03-27T00:06:54Z", "message": "unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTEwMjQy", "url": "https://github.com/apache/kafka/pull/8370#pullrequestreview-382510242", "createdAt": "2020-03-27T00:33:17Z", "commit": {"oid": "decaa94dbbf1cc5b4370c196e8dc284fe9618381"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDozMzoxN1rOF8fQ9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMDozMzoxN1rOF8fQ9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk3MTEyNw==", "bodyText": "This is a bit awkward.. if anyone have a more elegant solution I'm all ears.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r398971127", "createdAt": "2020-03-27T00:33:17Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/Task.java", "diffHunk": "@@ -192,6 +192,10 @@ public boolean isValidTransition(final State newState) {\n \n     void markChangelogAsCorrupted(final Collection<TopicPartition> partitions);\n \n+    void recordProcessLatency(final long elapsedLatencyMs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "decaa94dbbf1cc5b4370c196e8dc284fe9618381"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bbf703b430f96f15dd3e014ac9053d39d4369ae", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/5bbf703b430f96f15dd3e014ac9053d39d4369ae", "committedDate": "2020-03-27T05:59:35Z", "message": "rebase from trunk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8023e10418adfa6767f7fcba90951ee106300ac0", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/8023e10418adfa6767f7fcba90951ee106300ac0", "committedDate": "2020-03-27T19:03:19Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into K9753-active-process-ratio"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/f2768e9f1a9ee38b59b00621fcc316be00cb1b45", "committedDate": "2020-03-27T21:43:30Z", "message": "fix unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMjE4OTEx", "url": "https://github.com/apache/kafka/pull/8370#pullrequestreview-383218911", "createdAt": "2020-03-27T21:47:55Z", "commit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMTo0Nzo1NlrOF9C0MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMTo0ODo0OFrOF9C1WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1MzU4NA==", "bodyText": "This test becomes more flaky than before after the main loop refactoring, shown as the following:\njava.lang.AssertionError: Did not receive all 48 records from topic output-concurrent-2 within 120000 ms\nExpected: is a value equal to or greater than <48>\n     but: <38> was less than <48>\n\nEach iteration has 48 words, and 38 unique words, and when it fails it reported only 38 records ever consumed from the output topic. I suspect this is because of the caching effects, we processed all 500000 iterations without sending out any updates to the resulted count table output topic (seems we process too fast?).\nI piggy-backed a fix for this flakiness by reducing the requirement that we start the verification as long as we've seen one record in the output, similar as we do in other tests, and then in verifyGreaterOrEqual we do not require all keys been populated already.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r399553584", "createdAt": "2020-03-27T21:47:56Z", "author": {"login": "guozhangwang"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/QueryableStateIntegrationTest.java", "diffHunk": "@@ -646,8 +645,8 @@ public void concurrentAccesses() throws Exception {\n         producerThread.start();\n \n         try {\n-            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrent, numberOfWordsPerIteration);\n-            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrentWindowed, numberOfWordsPerIteration);\n+            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrent, 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1Mzg4MQ==", "bodyText": "Note we should only call this inside the if (state == State.RUNNING) condition otherwise we may get ConcurrentModification exception.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r399553881", "createdAt": "2020-03-27T21:48:48Z", "author": {"login": "guozhangwang"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -704,6 +707,10 @@ void runOnce() {\n                     numIterations++;\n                 }\n             } while (true);\n+\n+            // we record the ratio out of the while loop so that the accumulated latency spans over\n+            // multiple iterations with reasonably large max.num.records and hence is less vulnerable to outliers\n+            taskManager.recordTaskProcessRatio(totalProcessLatency);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0ODk0MjQ2", "url": "https://github.com/apache/kafka/pull/8370#pullrequestreview-384894246", "createdAt": "2020-03-31T16:16:38Z", "commit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoxNjozOFrOF-dpQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1MTowN1rOF-jkrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0MTczMA==", "bodyText": "req: Could you please add tests for this new sensor to TaskMetricsTest.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401041730", "createdAt": "2020-03-31T16:16:38Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/metrics/TaskMetrics.java", "diffHunk": "@@ -96,6 +103,22 @@ public static Sensor processLatencySensor(final String threadId,\n         return emptySensor(threadId, taskId, PROCESS_LATENCY, RecordingLevel.DEBUG, streamsMetrics);\n     }\n \n+    public static Sensor activeProcessRatioSensor(final String threadId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA1MTMyNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    sensor.add(\n          \n          \n            \n                        new MetricName(\n          \n          \n            \n                            name,\n          \n          \n            \n                            TASK_LEVEL_GROUP,\n          \n          \n            \n                            PROCESS_RATIO_DESCRIPTION,\n          \n          \n            \n                            streamsMetrics.taskLevelTagMap(threadId, taskId)),\n          \n          \n            \n                        new Value()\n          \n          \n            \n                    );\n          \n          \n            \n                    addValueMetricToSensor(\n          \n          \n            \n                        sensor,\n          \n          \n            \n                        TASK_LEVEL_GROUP,\n          \n          \n            \n                        streamsMetrics.taskLevelTagMap(threadId, taskId),\n          \n          \n            \n                        name,\n          \n          \n            \n                        PROCESS_RATIO_DESCRIPTION\n          \n          \n            \n                    );\n          \n      \n    \n    \n  \n\nreq: Please use StreamsMetricsImpl#addValueMetricToSensor()", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401051326", "createdAt": "2020-03-31T16:30:36Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/metrics/TaskMetrics.java", "diffHunk": "@@ -96,6 +103,22 @@ public static Sensor processLatencySensor(final String threadId,\n         return emptySensor(threadId, taskId, PROCESS_LATENCY, RecordingLevel.DEBUG, streamsMetrics);\n     }\n \n+    public static Sensor activeProcessRatioSensor(final String threadId,\n+                                                  final String taskId,\n+                                                  final StreamsMetricsImpl streamsMetrics) {\n+        final String name = ACTIVE_TASK_PREFIX + PROCESS + RATIO_SUFFIX;\n+        final Sensor sensor = streamsMetrics.taskLevelSensor(threadId, taskId, name, Sensor.RecordingLevel.INFO);\n+        sensor.add(\n+            new MetricName(\n+                name,\n+                TASK_LEVEL_GROUP,\n+                PROCESS_RATIO_DESCRIPTION,\n+                streamsMetrics.taskLevelTagMap(threadId, taskId)),\n+            new Value()\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExNzMyNg==", "bodyText": "prop: I find processLatency and totalLatency a bit misleading. What about processTime and totalProcessTime.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401117326", "createdAt": "2020-03-31T18:15:51Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/AbstractTask.java", "diffHunk": "@@ -68,6 +70,17 @@ public void markChangelogAsCorrupted(final Collection<TopicPartition> partitions\n         stateMgr.markChangelogAsCorrupted(partitions);\n     }\n \n+    @Override\n+    public void recordProcessLatency(final long elapsedLatencyMs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyMDQ4Mg==", "bodyText": "prop: Could you rename recordTotalLatency() to recordProcessRatioAndReset().", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401120482", "createdAt": "2020-03-31T18:21:20Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -616,6 +619,12 @@ public boolean process(final long wallClockTime) {\n         return true;\n     }\n \n+    @Override\n+    public void recordTotalLatency(final long elapsedLatencyMs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyMjI1Mg==", "bodyText": "Q: Could you elaborate on this?", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401122252", "createdAt": "2020-03-31T18:24:13Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -704,6 +707,10 @@ void runOnce() {\n                     numIterations++;\n                 }\n             } while (true);\n+\n+            // we record the ratio out of the while loop so that the accumulated latency spans over\n+            // multiple iterations with reasonably large max.num.records and hence is less vulnerable to outliers\n+            taskManager.recordTaskProcessRatio(totalProcessLatency);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1Mzg4MQ=="}, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyNTg1Ng==", "bodyText": "prop: I would prefer to have this fix in its own PR, because the commit would be easier to retrieve and to reference on failure tickets.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401125856", "createdAt": "2020-03-31T18:29:58Z", "author": {"login": "cadonna"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/QueryableStateIntegrationTest.java", "diffHunk": "@@ -646,8 +645,8 @@ public void concurrentAccesses() throws Exception {\n         producerThread.start();\n \n         try {\n-            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrent, numberOfWordsPerIteration);\n-            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrentWindowed, numberOfWordsPerIteration);\n+            waitUntilAtLeastNumRecordProcessed(outputTopicConcurrent, 1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU1MzU4NA=="}, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEzNTYzMw==", "bodyText": "prop: You could record the time spent in processing in Task#process() and just have a method Task#recordProcessRatio(final long totalProcessTime) in the interface.", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401135633", "createdAt": "2020-03-31T18:45:47Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/Task.java", "diffHunk": "@@ -192,6 +192,10 @@ public boolean isValidTransition(final State newState) {\n \n     void markChangelogAsCorrupted(final Collection<TopicPartition> partitions);\n \n+    void recordProcessLatency(final long elapsedLatencyMs);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk3MTEyNw=="}, "originalCommit": {"oid": "decaa94dbbf1cc5b4370c196e8dc284fe9618381"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEzODY5Mw==", "bodyText": "req: Could you please add a unit test for this method?", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401138693", "createdAt": "2020-03-31T18:50:51Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java", "diffHunk": "@@ -616,6 +619,12 @@ public boolean process(final long wallClockTime) {\n         return true;\n     }\n \n+    @Override\n+    public void recordTotalLatency(final long elapsedLatencyMs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEzODg2MA==", "bodyText": "req: Could you please add a unit test for this method?", "url": "https://github.com/apache/kafka/pull/8370#discussion_r401138860", "createdAt": "2020-03-31T18:51:07Z", "author": {"login": "cadonna"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/AbstractTask.java", "diffHunk": "@@ -68,6 +70,17 @@ public void markChangelogAsCorrupted(final Collection<TopicPartition> partitions\n         stateMgr.markChangelogAsCorrupted(partitions);\n     }\n \n+    @Override\n+    public void recordProcessLatency(final long elapsedLatencyMs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2768e9f1a9ee38b59b00621fcc316be00cb1b45"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fbe8e0a4944554d96a5e6e649736d0e1ccfa4ad", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/7fbe8e0a4944554d96a5e6e649736d0e1ccfa4ad", "committedDate": "2020-03-31T20:28:24Z", "message": "Some suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72c8bc29a346d1175e20681e31eabe1bbfbb5668", "author": {"user": null}, "url": "https://github.com/apache/kafka/commit/72c8bc29a346d1175e20681e31eabe1bbfbb5668", "committedDate": "2020-03-31T21:14:35Z", "message": "remove part of the suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fc5d22a31b1ee7ef52e1e7d065a1e61f85514ee", "author": {"user": {"login": "vvcephei", "name": "John Roesler"}}, "url": "https://github.com/apache/kafka/commit/3fc5d22a31b1ee7ef52e1e7d065a1e61f85514ee", "committedDate": "2020-03-31T21:20:03Z", "message": "Update streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e2557c11a7e22d9a339588e1c76d14a157e8028", "author": {"user": {"login": "vvcephei", "name": "John Roesler"}}, "url": "https://github.com/apache/kafka/commit/5e2557c11a7e22d9a339588e1c76d14a157e8028", "committedDate": "2020-03-31T21:20:32Z", "message": "Update streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamTask.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc224e9527a639f44bc292b23eba8356f2f53026", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/cc224e9527a639f44bc292b23eba8356f2f53026", "committedDate": "2020-03-31T21:47:12Z", "message": "Merge pull request #12 from vvcephei/john-8370-suggestion\n\nSome suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MTM3MjUy", "url": "https://github.com/apache/kafka/pull/8370#pullrequestreview-385137252", "createdAt": "2020-03-31T22:03:18Z", "commit": {"oid": "cc224e9527a639f44bc292b23eba8356f2f53026"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15a15cc1452a76cad471b60daa8b8a19238b5c2e", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/15a15cc1452a76cad471b60daa8b8a19238b5c2e", "committedDate": "2020-03-31T22:38:31Z", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into K9753-active-process-ratio"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "707ec0d5632bfea02ac73ac91319d54014e1828b", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/707ec0d5632bfea02ac73ac91319d54014e1828b", "committedDate": "2020-03-31T22:38:45Z", "message": "Merge branch 'K9753-active-process-ratio' of https://github.com/guozhangwang/kafka into K9753-active-process-ratio"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32ef38c40728841a720aa75e7c21b193215eea1e", "author": {"user": {"login": "guozhangwang", "name": "Guozhang Wang"}}, "url": "https://github.com/apache/kafka/commit/32ef38c40728841a720aa75e7c21b193215eea1e", "committedDate": "2020-03-31T23:36:54Z", "message": "github comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1706, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}