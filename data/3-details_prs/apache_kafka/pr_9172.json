{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2OTYyNjI5", "number": 9172, "title": "KAFKA-10387: Fix inclusion of transformation configs when topic creation is enabled in Connect", "bodyText": "Addition of configs for custom topic creation with KIP-158 created a regression when transformation configs are also included in the configuration of a source connector.\nTo experience the issue, just enabling topic creation at the worker is not sufficient. A user needs to supply a source connector configuration that contains both transformations and custom topic creation properties.\nThe issue is that the enrichment of configs in SourceConnectorConfig happens on top of an AbstractConfig rather than a ConnectorConfig. Inheriting from the latter allows enrichment to be composable for both topic creation and transformations.\nUnit tests and integration tests are written to test these combinations.\nCommitter Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-08-12T19:27:29Z", "url": "https://github.com/apache/kafka/pull/9172", "merged": true, "mergeCommit": {"oid": "e034fedbd369461c7a673fa877b67638c7b1d952"}, "closed": true, "closedAt": "2020-08-17T04:12:51Z", "author": {"login": "kkonstantine"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-QcmBAH2gAyNDY2OTYyNjI5OjU1NjBiZDRiYjA5MzQ0OWJiMTNiMzU0ZmIzNWUxOTJlZTJkMjVmN2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-nGsqAFqTQ2NzE1MTcxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5560bd4bb093449bb13b354fb35e192ee2d25f7e", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/apache/kafka/commit/5560bd4bb093449bb13b354fb35e192ee2d25f7e", "committedDate": "2020-08-12T19:19:06Z", "message": "KAFKA-10387: Fix inclusion of transformation configs when topic creation is enabled in Connect"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzA4ODMw", "url": "https://github.com/apache/kafka/pull/9172#pullrequestreview-466308830", "createdAt": "2020-08-12T22:04:20Z", "commit": {"oid": "5560bd4bb093449bb13b354fb35e192ee2d25f7e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMjowNDoyMFrOG_0cKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMjowODoxMFrOG_0h8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU3MjY1MQ==", "bodyText": "Super tiny nit: the wrapping even from the original was confusing, and maybe it's worth changing one more line and cleaning up the wrapping:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        enrichedSourceConfig = new EnrichedSourceConnectorConfig(plugins,\n          \n          \n            \n                                enrich(defaultConfigDef, props,\n          \n          \n            \n                                defaultGroup), propsWithoutRegexForDefaultGroup);\n          \n          \n            \n                        enrichedSourceConfig = new EnrichedSourceConnectorConfig(plugins,\n          \n          \n            \n                                enrich(defaultConfigDef, props, defaultGroup), \n          \n          \n            \n                                propsWithoutRegexForDefaultGroup);\n          \n      \n    \n    \n  \n\nWDYT?", "url": "https://github.com/apache/kafka/pull/9172#discussion_r469572651", "createdAt": "2020-08-12T22:04:20Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/SourceConnectorConfig.java", "diffHunk": "@@ -129,7 +129,8 @@ public SourceConnectorConfig(Plugins plugins, Map<String, String> props, boolean\n             propsWithoutRegexForDefaultGroup.entrySet()\n                     .removeIf(e -> e.getKey().equals(DEFAULT_TOPIC_CREATION_PREFIX + INCLUDE_REGEX_CONFIG)\n                             || e.getKey().equals(DEFAULT_TOPIC_CREATION_PREFIX + EXCLUDE_REGEX_CONFIG));\n-            enrichedSourceConfig = new EnrichedSourceConnectorConfig(enrich(defaultConfigDef, props,\n+            enrichedSourceConfig = new EnrichedSourceConnectorConfig(plugins,\n+                    enrich(defaultConfigDef, props,\n                     defaultGroup), propsWithoutRegexForDefaultGroup);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5560bd4bb093449bb13b354fb35e192ee2d25f7e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU3NDEzMA==", "bodyText": "Do we need another test here, or could we essentially replace the previous test with this one?\nEither way, the test that uses topic creation should probably have a comment (either in the method JavaDoc or in a line comment below) that explicitly mentions enabling topic creation. We don't want someone removing the topic creation configs at a later time.\nWDYT?", "url": "https://github.com/apache/kafka/pull/9172#discussion_r469574130", "createdAt": "2020-08-12T22:08:10Z", "author": {"login": "rhauch"}, "path": "connect/runtime/src/test/java/org/apache/kafka/connect/integration/TransformationIntegrationTest.java", "diffHunk": "@@ -318,4 +323,61 @@ public void testFilterOnHasHeaderKeyWithSourceConnector() throws Exception {\n         // delete connector\n         connect.deleteConnector(CONNECTOR_NAME);\n     }\n+\n+    /**\n+     * Test the {@link Filter} transformer with a\n+     * {@link HasHeaderKey} predicate on a source connector.\n+     */\n+    @Test\n+    public void testFilterOnHasHeaderKeyWithSourceConnectorAndTopicCreation() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5560bd4bb093449bb13b354fb35e192ee2d25f7e"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1261ce93fad2f5d834d423edc645579d2de75145", "author": {"user": {"login": "kkonstantine", "name": "Konstantine Karantasis"}}, "url": "https://github.com/apache/kafka/commit/1261ce93fad2f5d834d423edc645579d2de75145", "committedDate": "2020-08-13T19:01:22Z", "message": "KAFKA-10387: Adress comments and add another test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MTUxNzE0", "url": "https://github.com/apache/kafka/pull/9172#pullrequestreview-467151714", "createdAt": "2020-08-13T21:43:00Z", "commit": {"oid": "1261ce93fad2f5d834d423edc645579d2de75145"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 752, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}