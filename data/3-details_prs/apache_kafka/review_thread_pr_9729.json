{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MzM4Mjc0", "number": 9729, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMzozMzowNlrOFDvHag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMzo0ODoyNlrOFERxwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NDYxOTk0OnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMzozMzowNlrOIDiSzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMzo0Nzo1MFrOIEV85Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3ODUxMA==", "bodyText": "These messages feel a bit smelly", "url": "https://github.com/apache/kafka/pull/9729#discussion_r540578510", "createdAt": "2020-12-10T23:33:06Z", "author": {"login": "lbradstreet"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -1355,7 +1362,7 @@ public void run() {\n                         } else if (heartbeat.sessionTimeoutExpired(now)) {\n                             // the session timeout has expired without seeing a successful heartbeat, so we should\n                             // probably make sure the coordinator is still healthy.\n-                            markCoordinatorUnknown();\n+                            markCoordinatorUnknown(\"session timed out without heartbeat\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cbf6fcca5ccb4482611b187ab17f90e7d6bf1ee"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIxODAyNA==", "bodyText": "Seems ok. Maybe \"without receiving a successful heartbeat response\"?", "url": "https://github.com/apache/kafka/pull/9729#discussion_r541218024", "createdAt": "2020-12-11T19:51:21Z", "author": {"login": "hachikuji"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -1355,7 +1362,7 @@ public void run() {\n                         } else if (heartbeat.sessionTimeoutExpired(now)) {\n                             // the session timeout has expired without seeing a successful heartbeat, so we should\n                             // probably make sure the coordinator is still healthy.\n-                            markCoordinatorUnknown();\n+                            markCoordinatorUnknown(\"session timed out without heartbeat\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3ODUxMA=="}, "originalCommit": {"oid": "1cbf6fcca5ccb4482611b187ab17f90e7d6bf1ee"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQyNDg2OQ==", "bodyText": "Done", "url": "https://github.com/apache/kafka/pull/9729#discussion_r541424869", "createdAt": "2020-12-11T23:47:50Z", "author": {"login": "lbradstreet"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -1355,7 +1362,7 @@ public void run() {\n                         } else if (heartbeat.sessionTimeoutExpired(now)) {\n                             // the session timeout has expired without seeing a successful heartbeat, so we should\n                             // probably make sure the coordinator is still healthy.\n-                            markCoordinatorUnknown();\n+                            markCoordinatorUnknown(\"session timed out without heartbeat\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3ODUxMA=="}, "originalCommit": {"oid": "1cbf6fcca5ccb4482611b187ab17f90e7d6bf1ee"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NDYyMDQ5OnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQyMzozMzoyM1rOIDiTJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxOTo0NjoyM1rOIEJCHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3ODU5OA==", "bodyText": "Should this be extracted into a constant?", "url": "https://github.com/apache/kafka/pull/9729#discussion_r540578598", "createdAt": "2020-12-10T23:33:23Z", "author": {"login": "lbradstreet"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -257,7 +257,7 @@ protected synchronized boolean ensureCoordinatorReady(final Timer timer) {\n             } else if (coordinator != null && client.isUnavailable(coordinator)) {\n                 // we found the coordinator, but the connection has failed, so mark\n                 // it dead and backoff before retrying discovery\n-                markCoordinatorUnknown();\n+                markCoordinatorUnknown(\"coordinator unavailable\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cbf6fcca5ccb4482611b187ab17f90e7d6bf1ee"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIxMzIxNQ==", "bodyText": "I'm ok with it. This is just informational and the literal value is easier to read.", "url": "https://github.com/apache/kafka/pull/9729#discussion_r541213215", "createdAt": "2020-12-11T19:46:23Z", "author": {"login": "hachikuji"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -257,7 +257,7 @@ protected synchronized boolean ensureCoordinatorReady(final Timer timer) {\n             } else if (coordinator != null && client.isUnavailable(coordinator)) {\n                 // we found the coordinator, but the connection has failed, so mark\n                 // it dead and backoff before retrying discovery\n-                markCoordinatorUnknown();\n+                markCoordinatorUnknown(\"coordinator unavailable\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3ODU5OA=="}, "originalCommit": {"oid": "1cbf6fcca5ccb4482611b187ab17f90e7d6bf1ee"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5OTAwNTA1OnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxOTo1MDowOVrOIEJQeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMzo0Nzo1OFrOIEV9Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIxNjg4OA==", "bodyText": "Wonder if we can use the name of the error. Some of the messages will read awkwardly in the log message", "url": "https://github.com/apache/kafka/pull/9729#discussion_r541216888", "createdAt": "2020-12-11T19:50:09Z", "author": {"login": "hachikuji"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -890,13 +890,20 @@ private synchronized Node coordinator() {\n         return this.coordinator;\n     }\n \n-    protected synchronized void markCoordinatorUnknown() {\n-        markCoordinatorUnknown(false);\n+\n+    protected synchronized void markCoordinatorUnknown(Errors error) {\n+        markCoordinatorUnknown(false, \"error response {}\" + error.message());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cbf6fcca5ccb4482611b187ab17f90e7d6bf1ee"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQwMDk4NQ==", "bodyText": "Oops, that was what I was trying to do.", "url": "https://github.com/apache/kafka/pull/9729#discussion_r541400985", "createdAt": "2020-12-11T23:19:17Z", "author": {"login": "lbradstreet"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -890,13 +890,20 @@ private synchronized Node coordinator() {\n         return this.coordinator;\n     }\n \n-    protected synchronized void markCoordinatorUnknown() {\n-        markCoordinatorUnknown(false);\n+\n+    protected synchronized void markCoordinatorUnknown(Errors error) {\n+        markCoordinatorUnknown(false, \"error response {}\" + error.message());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIxNjg4OA=="}, "originalCommit": {"oid": "1cbf6fcca5ccb4482611b187ab17f90e7d6bf1ee"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQyNDk2Mg==", "bodyText": "Done", "url": "https://github.com/apache/kafka/pull/9729#discussion_r541424962", "createdAt": "2020-12-11T23:47:58Z", "author": {"login": "lbradstreet"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -890,13 +890,20 @@ private synchronized Node coordinator() {\n         return this.coordinator;\n     }\n \n-    protected synchronized void markCoordinatorUnknown() {\n-        markCoordinatorUnknown(false);\n+\n+    protected synchronized void markCoordinatorUnknown(Errors error) {\n+        markCoordinatorUnknown(false, \"error response {}\" + error.message());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIxNjg4OA=="}, "originalCommit": {"oid": "1cbf6fcca5ccb4482611b187ab17f90e7d6bf1ee"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5OTAwODIxOnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxOTo1MDo0NFrOIEJSeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMzo0ODowM1rOIEV9oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIxNzQwMQ==", "bodyText": "nit: \"Rediscovery will be attempted\"", "url": "https://github.com/apache/kafka/pull/9729#discussion_r541217401", "createdAt": "2020-12-11T19:50:44Z", "author": {"login": "hachikuji"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -890,13 +890,20 @@ private synchronized Node coordinator() {\n         return this.coordinator;\n     }\n \n-    protected synchronized void markCoordinatorUnknown() {\n-        markCoordinatorUnknown(false);\n+\n+    protected synchronized void markCoordinatorUnknown(Errors error) {\n+        markCoordinatorUnknown(false, \"error response {}\" + error.message());\n+    }\n+\n+    protected synchronized void markCoordinatorUnknown(String cause) {\n+        markCoordinatorUnknown(false, cause);\n     }\n \n-    protected synchronized void markCoordinatorUnknown(boolean isDisconnected) {\n+    protected synchronized void markCoordinatorUnknown(boolean isDisconnected, String cause) {\n         if (this.coordinator != null) {\n-            log.info(\"Group coordinator {} is unavailable or invalid, will attempt rediscovery\", this.coordinator);\n+            log.info(\"Group coordinator {} is unavailable or invalid due to cause: {}.\"\n+                    + \"isDisconnected: {}. Rediscovery will attempted.\", this.coordinator,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cbf6fcca5ccb4482611b187ab17f90e7d6bf1ee"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQyNTA1Ng==", "bodyText": "done", "url": "https://github.com/apache/kafka/pull/9729#discussion_r541425056", "createdAt": "2020-12-11T23:48:03Z", "author": {"login": "lbradstreet"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -890,13 +890,20 @@ private synchronized Node coordinator() {\n         return this.coordinator;\n     }\n \n-    protected synchronized void markCoordinatorUnknown() {\n-        markCoordinatorUnknown(false);\n+\n+    protected synchronized void markCoordinatorUnknown(Errors error) {\n+        markCoordinatorUnknown(false, \"error response {}\" + error.message());\n+    }\n+\n+    protected synchronized void markCoordinatorUnknown(String cause) {\n+        markCoordinatorUnknown(false, cause);\n     }\n \n-    protected synchronized void markCoordinatorUnknown(boolean isDisconnected) {\n+    protected synchronized void markCoordinatorUnknown(boolean isDisconnected, String cause) {\n         if (this.coordinator != null) {\n-            log.info(\"Group coordinator {} is unavailable or invalid, will attempt rediscovery\", this.coordinator);\n+            log.info(\"Group coordinator {} is unavailable or invalid due to cause: {}.\"\n+                    + \"isDisconnected: {}. Rediscovery will attempted.\", this.coordinator,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIxNzQwMQ=="}, "originalCommit": {"oid": "1cbf6fcca5ccb4482611b187ab17f90e7d6bf1ee"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwMDI5ODg4OnYy", "diffSide": "RIGHT", "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/ConsumerCoordinator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMzo0ODoyNlrOIEV-wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMzo0ODoyNlrOIEV-wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQyNTM0NA==", "bodyText": "Needs fixing", "url": "https://github.com/apache/kafka/pull/9729#discussion_r541425344", "createdAt": "2020-12-11T23:48:26Z", "author": {"login": "lbradstreet"}, "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/ConsumerCoordinator.java", "diffHunk": "@@ -1311,7 +1311,7 @@ public void handle(OffsetFetchResponse response, RequestFuture<Map<TopicPartitio\n                     future.raise(error);\n                 } else if (error == Errors.NOT_COORDINATOR) {\n                     // re-discover the coordinator and retry\n-                    markCoordinatorUnknown();\n+                    markCoordinatorUnknown(error.message());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a828d54bc1fde597e353afdf28a5b05985e1033"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3456, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}