{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1NjE0NDg2", "number": 8386, "title": "MINOR: Improve close tests of caching state store", "bodyText": "Committer Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-03-30T12:21:38Z", "url": "https://github.com/apache/kafka/pull/8386", "merged": true, "mergeCommit": {"oid": "e6a6b69acf009e0b58a5b54384814a17289f3c5e"}, "closed": true, "closedAt": "2020-04-01T17:42:17Z", "author": {"login": "cadonna"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcStjRBAH2gAyMzk1NjE0NDg2OjE1MTU3YzBjMDVmMGQ4ODNlNmRiMTc5MTkzNmQ4ZjBkYjE3ZmE3YTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTQJHigFqTM4NTI2MDY2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15157c0c05f0d883e6db1791936d8f0db17fa7a5", "author": {"user": {"login": "cadonna", "name": "Bruno Cadonna"}}, "url": "https://github.com/apache/kafka/commit/15157c0c05f0d883e6db1791936d8f0db17fa7a5", "committedDate": "2020-03-30T12:20:58Z", "message": "MINOR: Improve close tests of caching state store"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNzk4NDE5", "url": "https://github.com/apache/kafka/pull/8386#pullrequestreview-383798419", "createdAt": "2020-03-30T12:22:20Z", "commit": {"oid": "15157c0c05f0d883e6db1791936d8f0db17fa7a5"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMjoyMjoyMFrOF9nFwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMjoyMzoxN1rOF9nH8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0NzkwNg==", "bodyText": "I added the check for the exception.", "url": "https://github.com/apache/kafka/pull/8386#discussion_r400147906", "createdAt": "2020-03-30T12:22:20Z", "author": {"login": "cadonna"}, "path": "streams/src/test/java/org/apache/kafka/streams/state/internals/CachingKeyValueStoreTest.java", "diffHunk": "@@ -122,38 +123,34 @@ public void shouldAvoidFlushingDeletionsWithoutDirtyKeys() {\n     }\n \n     @Test\n-    public void shouldCloseWrappedStoreAfterErrorDuringCacheFlush() {\n+    public void shouldCloseWrappedStoreAndCacheAfterErrorDuringCacheFlush() {\n         setUpCloseTests();\n+        EasyMock.reset(cache);\n         cache.flush(CACHE_NAMESPACE);\n-        EasyMock.expectLastCall().andThrow(new NullPointerException(\"Simulating an error on flush\"));\n+        EasyMock.expectLastCall().andThrow(new RuntimeException(\"Simulating an error on flush\"));\n         EasyMock.replay(cache);\n         EasyMock.reset(underlyingStore);\n         underlyingStore.close();\n         EasyMock.replay(underlyingStore);\n \n-        try {\n-            store.close();\n-        } catch (final RuntimeException exception) {\n-            EasyMock.verify(underlyingStore);\n-        }\n+        assertThrows(RuntimeException.class, store::close);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15157c0c05f0d883e6db1791936d8f0db17fa7a5"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0ODQ2NQ==", "bodyText": "I added the verification for the call to close() of underlying store and cache.", "url": "https://github.com/apache/kafka/pull/8386#discussion_r400148465", "createdAt": "2020-03-30T12:23:17Z", "author": {"login": "cadonna"}, "path": "streams/src/test/java/org/apache/kafka/streams/state/internals/CachingKeyValueStoreTest.java", "diffHunk": "@@ -122,38 +123,34 @@ public void shouldAvoidFlushingDeletionsWithoutDirtyKeys() {\n     }\n \n     @Test\n-    public void shouldCloseWrappedStoreAfterErrorDuringCacheFlush() {\n+    public void shouldCloseWrappedStoreAndCacheAfterErrorDuringCacheFlush() {\n         setUpCloseTests();\n+        EasyMock.reset(cache);\n         cache.flush(CACHE_NAMESPACE);\n-        EasyMock.expectLastCall().andThrow(new NullPointerException(\"Simulating an error on flush\"));\n+        EasyMock.expectLastCall().andThrow(new RuntimeException(\"Simulating an error on flush\"));\n         EasyMock.replay(cache);\n         EasyMock.reset(underlyingStore);\n         underlyingStore.close();\n         EasyMock.replay(underlyingStore);\n \n-        try {\n-            store.close();\n-        } catch (final RuntimeException exception) {\n-            EasyMock.verify(underlyingStore);\n-        }\n+        assertThrows(RuntimeException.class, store::close);\n+        EasyMock.verify(cache, underlyingStore);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15157c0c05f0d883e6db1791936d8f0db17fa7a5"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MDc2MTY2", "url": "https://github.com/apache/kafka/pull/8386#pullrequestreview-384076166", "createdAt": "2020-03-30T17:29:18Z", "commit": {"oid": "15157c0c05f0d883e6db1791936d8f0db17fa7a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDE5OTI4", "url": "https://github.com/apache/kafka/pull/8386#pullrequestreview-385019928", "createdAt": "2020-03-31T19:00:41Z", "commit": {"oid": "15157c0c05f0d883e6db1791936d8f0db17fa7a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MjYwNjY4", "url": "https://github.com/apache/kafka/pull/8386#pullrequestreview-385260668", "createdAt": "2020-04-01T04:39:05Z", "commit": {"oid": "15157c0c05f0d883e6db1791936d8f0db17fa7a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1738, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}