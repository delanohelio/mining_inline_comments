{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNTgyODcx", "number": 9414, "title": "KAFKA-10585: Kafka Streams should clean up the state store directory from cleanup", "bodyText": "Committer Checklist (excluded from commit message)\n\n Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-10-12T13:36:07Z", "url": "https://github.com/apache/kafka/pull/9414", "merged": true, "mergeCommit": {"oid": "7cd09b6a14f51aeef9e701fe24adf9f4f07170b0"}, "closed": true, "closedAt": "2021-06-10T19:59:57Z", "author": {"login": "dongjinleekr"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSBf9SgBqjM4NjkzMDk3NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABefdqSygFqTY4MTE4MDQ1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NTY5NTY2", "url": "https://github.com/apache/kafka/pull/9414#pullrequestreview-507569566", "createdAt": "2020-10-13T15:33:35Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNTozMzozNVrOHgs4xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNTo0MDoyOVrOHgtNmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA1MTkxMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertTrue(!appDir.exists());\n          \n          \n            \n                    assertFalse(appDir.exists());\n          \n      \n    \n    \n  \n\n:)", "url": "https://github.com/apache/kafka/pull/9414#discussion_r504051911", "createdAt": "2020-10-13T15:33:35Z", "author": {"login": "vvcephei"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StateDirectoryTest.java", "diffHunk": "@@ -510,8 +511,8 @@ public void shouldCleanupAllTaskDirectoriesIncludingGlobalOne() {\n \n         directory.clean();\n \n-        assertEquals(Collections.emptySet(), Arrays.stream(\n-            Objects.requireNonNull(appDir.listFiles())).collect(Collectors.toSet()));\n+        // if appDir is empty, it is deleted in StateDirectory#clean process.\n+        assertTrue(!appDir.exists());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA1NDAyOA==", "bodyText": "We shouldn't add unrelated checks to tests in general, it just makes the tests more confusing. If you want to verify that the directory still exists after closing when we don't call clean(), we should just add a new test for it.", "url": "https://github.com/apache/kafka/pull/9414#discussion_r504054028", "createdAt": "2020-10-13T15:36:10Z", "author": {"login": "vvcephei"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StateDirectoryTest.java", "diffHunk": "@@ -602,6 +606,11 @@ public void shouldLogStateDirCleanerMessage() {\n             directory.cleanRemovedTasks(cleanupDelayMs);\n             assertThat(appender.getMessages(), hasItem(endsWith(\"ms has elapsed (cleanup delay is \" +  cleanupDelayMs + \"ms).\")));\n         }\n+\n+        // if appDir is empty, it is deleted in  process.\n+        // since we did not call StateDirectory#clean, the global state directory is not deleted and appDir also.\n+        assertTrue(appDir.exists());\n+        assertArrayEquals(appDir.list(), new String[]{\"0_0\"});", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA1NDg0Mg==", "bodyText": "Similar feedback here as below. This test is about logging, not cleanup. You've already added a check to the \"shouldCleanup\" test, so we don't need one here.", "url": "https://github.com/apache/kafka/pull/9414#discussion_r504054842", "createdAt": "2020-10-13T15:37:11Z", "author": {"login": "vvcephei"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StateDirectoryTest.java", "diffHunk": "@@ -586,6 +587,9 @@ public void shouldLogManualUserCallMessage() {\n                 hasItem(endsWith(\"as user calling cleanup.\"))\n             );\n         }\n+\n+        // if appDir is empty, it is deleted in StateDirectory#clean process.\n+        assertTrue(!appDir.exists());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA1NzI0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (hasPersistentStores && stateDir.exists() && !stateDir.delete()) {\n          \n          \n            \n                        if (stateDir.exists() && !stateDir.delete()) {\n          \n      \n    \n    \n  \n\nDo we need to check hasPersistentStores here? It seems sufficient just to check if the directory exists.", "url": "https://github.com/apache/kafka/pull/9414#discussion_r504057240", "createdAt": "2020-10-13T15:40:29Z", "author": {"login": "vvcephei"}, "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StateDirectory.java", "diffHunk": "@@ -301,6 +301,22 @@ public synchronized void clean() {\n             );\n             throw new StreamsException(exception);\n         }\n+\n+        try {\n+            if (hasPersistentStores && stateDir.exists() && !stateDir.delete()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDgyMDc1", "url": "https://github.com/apache/kafka/pull/9414#pullrequestreview-513082075", "createdAt": "2020-10-20T19:54:41Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTo1NDo0MVrOHlOnqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTo1NDo0MVrOHlOnqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc5ODg5MQ==", "bodyText": "I'd be tempted to give it more time. Experience says that Jenkins will take unreasonably long to perform these operations. How about using the default timeout in IntegrationTestUtils here and below?", "url": "https://github.com/apache/kafka/pull/9414#discussion_r508798891", "createdAt": "2020-10-20T19:54:41Z", "author": {"login": "vvcephei"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/StateDirectoryIntegrationTest.java", "diffHunk": "@@ -0,0 +1,255 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.kafka.streams.integration;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.Properties;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.apache.kafka.clients.producer.KafkaProducer;\n+import org.apache.kafka.clients.producer.ProducerConfig;\n+import org.apache.kafka.clients.producer.ProducerRecord;\n+import org.apache.kafka.common.serialization.Serdes;\n+import org.apache.kafka.common.serialization.StringSerializer;\n+import org.apache.kafka.common.utils.Bytes;\n+import org.apache.kafka.streams.KafkaStreams;\n+import org.apache.kafka.streams.StreamsBuilder;\n+import org.apache.kafka.streams.StreamsConfig;\n+import org.apache.kafka.streams.Topology;\n+import org.apache.kafka.streams.integration.utils.EmbeddedKafkaCluster;\n+import org.apache.kafka.streams.kstream.Materialized;\n+import org.apache.kafka.streams.state.KeyValueStore;\n+import org.apache.kafka.test.IntegrationTest;\n+import org.apache.kafka.test.TestUtils;\n+import org.junit.ClassRule;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.rules.TestName;\n+\n+import static org.apache.kafka.common.utils.Utils.mkEntry;\n+import static org.apache.kafka.common.utils.Utils.mkMap;\n+import static org.apache.kafka.common.utils.Utils.mkProperties;\n+import static org.apache.kafka.streams.integration.utils.IntegrationTestUtils.safeUniqueTestName;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+\n+@Category({IntegrationTest.class})\n+public class StateDirectoryIntegrationTest {\n+\n+    private static final int NUM_BROKERS = 1;\n+\n+    @ClassRule\n+    public static final EmbeddedKafkaCluster CLUSTER = new EmbeddedKafkaCluster(NUM_BROKERS);\n+\n+    @Rule\n+    public TestName testName = new TestName();\n+\n+    @Test\n+    public void testCleanUpStateDirIfEmpty() throws InterruptedException {\n+        final String uniqueTestName = safeUniqueTestName(getClass(), testName);\n+\n+        // Create Topic\n+        final String input = uniqueTestName + \"-input\";\n+        CLUSTER.createTopic(input);\n+\n+        final Properties producerConfig = mkProperties(mkMap(\n+            mkEntry(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, CLUSTER.bootstrapServers()),\n+            mkEntry(ProducerConfig.ACKS_CONFIG, \"all\"),\n+            mkEntry(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getCanonicalName()),\n+            mkEntry(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getCanonicalName())\n+        ));\n+\n+        try (final KafkaProducer<String, String> producer =\n+                 new KafkaProducer<>(producerConfig, Serdes.String().serializer(), Serdes.String().serializer())) {\n+            // Create Test Records\n+            producer.send(new ProducerRecord<>(input, \"a\"));\n+            producer.send(new ProducerRecord<>(input, \"b\"));\n+            producer.send(new ProducerRecord<>(input, \"c\"));\n+\n+            // Create Topology\n+            final String storeName = uniqueTestName + \"-input-table\";\n+\n+            final StreamsBuilder builder = new StreamsBuilder();\n+            builder.table(\n+                input,\n+                Materialized\n+                    .<String, String, KeyValueStore<Bytes, byte[]>>as(storeName)\n+                    .withKeySerde(Serdes.String())\n+                    .withValueSerde(Serdes.String())\n+            );\n+            final Topology topology = builder.build();\n+\n+            // State Store Directory\n+            final String stateDir = TestUtils.tempDirectory(uniqueTestName).getPath();\n+\n+            // Create KafkaStreams instance\n+            final String applicationId = uniqueTestName + \"-app\";\n+            final Properties streamsConfig = mkProperties(mkMap(\n+                mkEntry(StreamsConfig.APPLICATION_ID_CONFIG, applicationId),\n+                mkEntry(StreamsConfig.STATE_DIR_CONFIG, stateDir),\n+                mkEntry(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, CLUSTER.bootstrapServers())\n+            ));\n+\n+            final KafkaStreams streams = new KafkaStreams(topology, streamsConfig);\n+\n+            // Create StateListener\n+            final CountDownLatch runningLatch = new CountDownLatch(1);\n+            final CountDownLatch notRunningLatch = new CountDownLatch(1);\n+\n+            final KafkaStreams.StateListener stateListener = (newState, oldState) -> {\n+                if (newState == KafkaStreams.State.RUNNING) {\n+                    runningLatch.countDown();\n+                }\n+                if (newState == KafkaStreams.State.NOT_RUNNING) {\n+                    notRunningLatch.countDown();\n+                }\n+            };\n+            streams.setStateListener(stateListener);\n+\n+            // Application state directory\n+            final File appDir = new File(stateDir, applicationId);\n+\n+            // Validate application state directory is created.\n+            streams.start();\n+            try {\n+                runningLatch.await(10 * 1000L, TimeUnit.MILLISECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 132}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNzc0NTk4", "url": "https://github.com/apache/kafka/pull/9414#pullrequestreview-513774598", "createdAt": "2020-10-21T14:49:38Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNTIzNzE0", "url": "https://github.com/apache/kafka/pull/9414#pullrequestreview-531523714", "createdAt": "2020-11-16T17:04:12Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNzowNDoxMlrOH0IdFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNzoxNjoxNVrOH0JGgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQyNjUxNg==", "bodyText": "Can you explain why we need to remove this? It seems like the application must have created the state directory by this point, right?", "url": "https://github.com/apache/kafka/pull/9414#discussion_r524426516", "createdAt": "2020-11-16T17:04:12Z", "author": {"login": "vvcephei"}, "path": "streams/src/test/java/org/apache/kafka/streams/integration/EOSUncleanShutdownIntegrationTest.java", "diffHunk": "@@ -140,9 +140,6 @@ public void shouldWorkWithUncleanShutdownWipeOutStateStore() throws InterruptedE\n             IntegrationTestUtils.produceSynchronously(producerConfig, false, input, Optional.empty(),\n                 singletonList(new KeyValueTimestamp<>(\"k1\", \"v1\", 0L)));\n \n-            TestUtils.waitForCondition(stateDir::exists,\n-                \"Failed awaiting CreateTopics first request failure\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQzNzEyMQ==", "bodyText": "Since you have modified the purpose of this test, maybe we can go ahead and give the test a more specific name as well.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void shouldThrowProcessorStateException() throws IOException {\n          \n          \n            \n                public void shouldThrowProcessorStateExceptionIfTaskDirectoryIsOccupiedByFile() throws IOException {\n          \n      \n    \n    \n  \n\nAlso, I won't dispute the value of checking this condition, but would like to point out that this test was previously verifying a specific error on failure to create the task directory, and now we are no longer checking that failure. In other words, we were previously verifying \"task directory [%s] doesn't exist and couldn't be created\", but now we are only verifying the separate and specific failure reason \"task directory path [%s] is already occupied\".\nIt actually seems like maybe we don't need to check that specific !taskDir.isDirectory() case, since it seems like having this file sitting there should cause a failure to create the task directory, right?", "url": "https://github.com/apache/kafka/pull/9414#discussion_r524437121", "createdAt": "2020-11-16T17:16:15Z", "author": {"login": "vvcephei"}, "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StateDirectoryTest.java", "diffHunk": "@@ -186,19 +186,29 @@ public void shouldReportDirectoryEmpty() throws IOException {\n \n     @Test\n     public void shouldThrowProcessorStateException() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 3}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "4579b4cfcf666cf7420f57e3cd60737fb27b88f5", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/4579b4cfcf666cf7420f57e3cd60737fb27b88f5", "committedDate": "2020-12-01T06:16:14Z", "message": "Fix EOSUncleanShutdownIntegrationTest#shouldWorkWithUncleanShutdownWipeOutStateStore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4579b4cfcf666cf7420f57e3cd60737fb27b88f5", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/4579b4cfcf666cf7420f57e3cd60737fb27b88f5", "committedDate": "2020-12-01T06:16:14Z", "message": "Fix EOSUncleanShutdownIntegrationTest#shouldWorkWithUncleanShutdownWipeOutStateStore"}, "afterCommit": {"oid": "d3c63894fa73fb1fe0f021f14f715cd3944c9d77", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/d3c63894fa73fb1fe0f021f14f715cd3944c9d77", "committedDate": "2020-12-05T06:04:11Z", "message": "Fix EOSUncleanShutdownIntegrationTest#shouldWorkWithUncleanShutdownWipeOutStateStore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d3c63894fa73fb1fe0f021f14f715cd3944c9d77", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/d3c63894fa73fb1fe0f021f14f715cd3944c9d77", "committedDate": "2020-12-05T06:04:11Z", "message": "Fix EOSUncleanShutdownIntegrationTest#shouldWorkWithUncleanShutdownWipeOutStateStore"}, "afterCommit": {"oid": "39d582de2fead8483bb273397e3b8fffa290c8f0", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/39d582de2fead8483bb273397e3b8fffa290c8f0", "committedDate": "2021-01-18T07:17:26Z", "message": "Fix EOSUncleanShutdownIntegrationTest#shouldWorkWithUncleanShutdownWipeOutStateStore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39d582de2fead8483bb273397e3b8fffa290c8f0", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/39d582de2fead8483bb273397e3b8fffa290c8f0", "committedDate": "2021-01-18T07:17:26Z", "message": "Fix EOSUncleanShutdownIntegrationTest#shouldWorkWithUncleanShutdownWipeOutStateStore"}, "afterCommit": {"oid": "2462c990a093b60645fef321a23c3f7b5a2dec0b", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/2462c990a093b60645fef321a23c3f7b5a2dec0b", "committedDate": "2021-02-11T13:03:39Z", "message": "Fix EOSUncleanShutdownIntegrationTest#shouldWorkWithUncleanShutdownWipeOutStateStore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2462c990a093b60645fef321a23c3f7b5a2dec0b", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/2462c990a093b60645fef321a23c3f7b5a2dec0b", "committedDate": "2021-02-11T13:03:39Z", "message": "Fix EOSUncleanShutdownIntegrationTest#shouldWorkWithUncleanShutdownWipeOutStateStore"}, "afterCommit": {"oid": "277e434425bffe98a7e3870dc8556de199c37aa1", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/277e434425bffe98a7e3870dc8556de199c37aa1", "committedDate": "2021-03-23T08:54:36Z", "message": "Fix EOSUncleanShutdownIntegrationTest#shouldWorkWithUncleanShutdownWipeOutStateStore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "277e434425bffe98a7e3870dc8556de199c37aa1", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/277e434425bffe98a7e3870dc8556de199c37aa1", "committedDate": "2021-03-23T08:54:36Z", "message": "Fix EOSUncleanShutdownIntegrationTest#shouldWorkWithUncleanShutdownWipeOutStateStore"}, "afterCommit": {"oid": "00a622992ba308b4319fd6d61e0ed20df55b19f3", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/00a622992ba308b4319fd6d61e0ed20df55b19f3", "committedDate": "2021-03-25T13:19:27Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "00a622992ba308b4319fd6d61e0ed20df55b19f3", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/00a622992ba308b4319fd6d61e0ed20df55b19f3", "committedDate": "2021-03-25T13:19:27Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}, "afterCommit": {"oid": "396d1421effe0299a400489fd7168215e027ce91", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/396d1421effe0299a400489fd7168215e027ce91", "committedDate": "2021-04-11T11:19:51Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "396d1421effe0299a400489fd7168215e027ce91", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/396d1421effe0299a400489fd7168215e027ce91", "committedDate": "2021-04-11T11:19:51Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}, "afterCommit": {"oid": "6c13f1fa812a31eb47f0d62e84f601ae31f70a8e", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/6c13f1fa812a31eb47f0d62e84f601ae31f70a8e", "committedDate": "2021-04-12T11:57:59Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c13f1fa812a31eb47f0d62e84f601ae31f70a8e", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/6c13f1fa812a31eb47f0d62e84f601ae31f70a8e", "committedDate": "2021-04-12T11:57:59Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}, "afterCommit": {"oid": "b76b5350d87ea3ad56e225d2cccdedbdfe31f4fb", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/b76b5350d87ea3ad56e225d2cccdedbdfe31f4fb", "committedDate": "2021-04-20T05:36:00Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b76b5350d87ea3ad56e225d2cccdedbdfe31f4fb", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/b76b5350d87ea3ad56e225d2cccdedbdfe31f4fb", "committedDate": "2021-04-20T05:36:00Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}, "afterCommit": {"oid": "3bd9bc0b5d14a8b7f6b237726f936ea5566f12a5", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/3bd9bc0b5d14a8b7f6b237726f936ea5566f12a5", "committedDate": "2021-05-07T12:58:27Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjU3MzgxMjA0", "url": "https://github.com/apache/kafka/pull/9414#pullrequestreview-657381204", "createdAt": "2021-05-12T01:11:26Z", "commit": {"oid": "3bd9bc0b5d14a8b7f6b237726f936ea5566f12a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3bd9bc0b5d14a8b7f6b237726f936ea5566f12a5", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/3bd9bc0b5d14a8b7f6b237726f936ea5566f12a5", "committedDate": "2021-05-07T12:58:27Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}, "afterCommit": {"oid": "cc5fdc386ba3c7b7bb78e07de6b34bb673ae6c74", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/cc5fdc386ba3c7b7bb78e07de6b34bb673ae6c74", "committedDate": "2021-05-24T03:01:15Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1ea64f28eae01af6db6009f2634ca6946da4586", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/f1ea64f28eae01af6db6009f2634ca6946da4586", "committedDate": "2021-06-10T07:42:42Z", "message": "Make application's statestore directory is deleted in cleanup process if it is empty\n\n1. Update StateDirectory#clean\n\n  - Delete application's statestore directory in cleanup process if it is empty.\n\n2. Add Tests\n\n  - StateDirectoryTest#shouldDeleteAppDirWhenCleanUpIfEmpty: asserting the empty application directory is deleted with StateDirectory#clean.\n  - StateDirectoryTest#shouldNotDeleteAppDirWhenCleanUpIfNotEmpty: asserting the non-empty application directory is not deleted with StateDirectory#clean and appropriate log message is generated.\n  - Add Integration test: StateDirectoryIntegrationTest\n\n3. Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc5fdc386ba3c7b7bb78e07de6b34bb673ae6c74", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/cc5fdc386ba3c7b7bb78e07de6b34bb673ae6c74", "committedDate": "2021-05-24T03:01:15Z", "message": "Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}, "afterCommit": {"oid": "f1ea64f28eae01af6db6009f2634ca6946da4586", "author": {"user": {"login": "dongjinleekr", "name": "Lee Dongjin"}}, "url": "https://github.com/apache/kafka/commit/f1ea64f28eae01af6db6009f2634ca6946da4586", "committedDate": "2021-06-10T07:42:42Z", "message": "Make application's statestore directory is deleted in cleanup process if it is empty\n\n1. Update StateDirectory#clean\n\n  - Delete application's statestore directory in cleanup process if it is empty.\n\n2. Add Tests\n\n  - StateDirectoryTest#shouldDeleteAppDirWhenCleanUpIfEmpty: asserting the empty application directory is deleted with StateDirectory#clean.\n  - StateDirectoryTest#shouldNotDeleteAppDirWhenCleanUpIfNotEmpty: asserting the non-empty application directory is not deleted with StateDirectory#clean and appropriate log message is generated.\n  - Add Integration test: StateDirectoryIntegrationTest\n\n3. Improve EOSUncleanShutdownIntegrationTest: test all available cases regarding cleanup process on unclean shutdown."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjgxMTgwNDU1", "url": "https://github.com/apache/kafka/pull/9414#pullrequestreview-681180455", "createdAt": "2021-06-10T19:33:29Z", "commit": {"oid": "f1ea64f28eae01af6db6009f2634ca6946da4586"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 505, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}