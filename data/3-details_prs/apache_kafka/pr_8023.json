{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5Mzk3MTAw", "number": 8023, "title": "KAFKA-8507 kip 499 Unify connection name flag for command line tool", "bodyText": "This is a change updates ConsoleProducer, ConsumerPerformance, VerifiableProducer, and VerifiableConsumer classes to add and prefer the --bootstrap-server flag for defining the connection point of the Kafka cluster.\nCommitter Checklist (excluded from commit message)\n\n[x ] Verify design and implementation\n Verify test coverage and CI build status\n Verify documentation (including upgrade notes)", "createdAt": "2020-01-31T03:56:40Z", "url": "https://github.com/apache/kafka/pull/8023", "merged": true, "mergeCommit": {"oid": "96c69da8c164966c1281df7001d5d239053442fd"}, "closed": true, "closedAt": "2020-02-13T21:44:52Z", "author": {"login": "mitchell-h"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_OSWGAH2gAyMzY5Mzk3MTAwOmZlM2NkNzgxNjFkOWM4NGEzNjk1ZDM2MmVjYjU5MGI0ZjRkNTNkOWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcD-rEsgFqTM1ODQyNTIxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fe3cd78161d9c84a3695d362ecb590b4f4d53d9b", "author": {"user": {"login": "mitchell-h", "name": "Mitch"}}, "url": "https://github.com/apache/kafka/commit/fe3cd78161d9c84a3695d362ecb590b4f4d53d9b", "committedDate": "2020-01-29T23:10:52Z", "message": "update example reassign file to include log_dirs configuration in alignment with KIP-113"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a84cb1fdffa23ff06151923f65792c1060c8b5a", "author": {"user": {"login": "mitchell-h", "name": "Mitch"}}, "url": "https://github.com/apache/kafka/commit/9a84cb1fdffa23ff06151923f65792c1060c8b5a", "committedDate": "2020-01-31T03:24:32Z", "message": "KIP-499"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMjk2NDYx", "url": "https://github.com/apache/kafka/pull/8023#pullrequestreview-351296461", "createdAt": "2020-01-31T05:14:02Z", "commit": {"oid": "9a84cb1fdffa23ff06151923f65792c1060c8b5a"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwNToxNDowMlrOFkBknA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwNjoxMDozN1rOFkCLGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMxODgxMg==", "bodyText": "Add \"DEPRECATED, use --bootstrap-server instead; ignored if --bootstrap-server is specified\"", "url": "https://github.com/apache/kafka/pull/8023#discussion_r373318812", "createdAt": "2020-01-31T05:14:02Z", "author": {"login": "rondagostino"}, "path": "core/src/main/scala/kafka/tools/ConsoleProducer.scala", "diffHunk": "@@ -125,7 +129,11 @@ object ConsoleProducer {\n       .withRequiredArg\n       .describedAs(\"topic\")\n       .ofType(classOf[String])\n-    val brokerListOpt = parser.accepts(\"broker-list\", \"REQUIRED: The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")\n+    val bootstrapServerOpt = parser.accepts(\"bootstrap-server\", \"REQUIRED: The server(s) to connect to.\")\n+      .withRequiredArg\n+      .describedAs(\"server to connect to\")\n+      .ofType(classOf[String])\n+    val brokerListOpt = parser.accepts(\"broker-list\", \"The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a84cb1fdffa23ff06151923f65792c1060c8b5a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMyMDUzNg==", "bodyText": "You can define bootstrapServerOpt with .requiredUnless(\"broker-list\") as long as you define broker-list first; then the parser will check everything for you automatically.  Also technically not REQUIRED since --broker-list is only being deprecated and not removed.  So probably \"REQUIRED unless --broker-list is specified\" is more accurate.  Also, need to update ConsoleProducerTest to test valid and invalid option combinations.", "url": "https://github.com/apache/kafka/pull/8023#discussion_r373320536", "createdAt": "2020-01-31T05:24:34Z", "author": {"login": "rondagostino"}, "path": "core/src/main/scala/kafka/tools/ConsoleProducer.scala", "diffHunk": "@@ -125,7 +129,11 @@ object ConsoleProducer {\n       .withRequiredArg\n       .describedAs(\"topic\")\n       .ofType(classOf[String])\n-    val brokerListOpt = parser.accepts(\"broker-list\", \"REQUIRED: The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")\n+    val bootstrapServerOpt = parser.accepts(\"bootstrap-server\", \"REQUIRED: The server(s) to connect to.\")\n+      .withRequiredArg", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a84cb1fdffa23ff06151923f65792c1060c8b5a"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMyNzc0MA==", "bodyText": "No need to manually check these if you use .requiredUnless(\"broker-list\").", "url": "https://github.com/apache/kafka/pull/8023#discussion_r373327740", "createdAt": "2020-01-31T06:05:39Z", "author": {"login": "rondagostino"}, "path": "core/src/main/scala/kafka/tools/ConsoleProducer.scala", "diffHunk": "@@ -220,11 +228,28 @@ object ConsoleProducer {\n     options = tryParse(parser, args)\n \n     CommandLineUtils.printHelpAndExitIfNeeded(this, \"This tool helps to read data from standard input and publish it to Kafka.\")\n-    CommandLineUtils.checkRequiredArgs(parser, options, topicOpt, brokerListOpt)\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a84cb1fdffa23ff06151923f65792c1060c8b5a"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzMyODY2NQ==", "bodyText": "Probably want to do something like this:\nval brokerHostsAndPorts = options.valueOf(if (options.has(bootstrapServerOpt)) bootstrapServerOpt else brokerListOpt)\nToolsUtils.validatePortOrDie(parser, brokerHostsAndPorts)", "url": "https://github.com/apache/kafka/pull/8023#discussion_r373328665", "createdAt": "2020-01-31T06:10:37Z", "author": {"login": "rondagostino"}, "path": "core/src/main/scala/kafka/tools/ConsoleProducer.scala", "diffHunk": "@@ -220,11 +228,28 @@ object ConsoleProducer {\n     options = tryParse(parser, args)\n \n     CommandLineUtils.printHelpAndExitIfNeeded(this, \"This tool helps to read data from standard input and publish it to Kafka.\")\n-    CommandLineUtils.checkRequiredArgs(parser, options, topicOpt, brokerListOpt)\n+\n+    if (!options.has(bootstrapServerOpt) && !options.has(brokerListOpt))\n+      CommandLineUtils.checkRequiredArgs(parser, options, topicOpt, bootstrapServerOpt)\n+\n+    if (options.has(bootstrapServerOpt))\n+      CommandLineUtils.checkRequiredArgs(parser, options, topicOpt, bootstrapServerOpt)\n+\n+    if (options.has(brokerListOpt))\n+      CommandLineUtils.checkRequiredArgs(parser, options, topicOpt, brokerListOpt)\n+\n \n     val topic = options.valueOf(topicOpt)\n+\n+    val bootstrapServer = options.valueOf(bootstrapServerOpt)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a84cb1fdffa23ff06151923f65792c1060c8b5a"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxODYxODA0", "url": "https://github.com/apache/kafka/pull/8023#pullrequestreview-351861804", "createdAt": "2020-02-01T03:10:28Z", "commit": {"oid": "9a84cb1fdffa23ff06151923f65792c1060c8b5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwMzoxMDoyOFrOFkcHjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwMzoxMDoyOFrOFkcHjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc1Mzc0Mg==", "bodyText": "We also want to deprecate the old options. Typically we just prefix the description with DEPRECATED. See for example, the --zookeeper argument use in TopicCommand. We could also print a warning, but it may be overkill.", "url": "https://github.com/apache/kafka/pull/8023#discussion_r373753742", "createdAt": "2020-02-01T03:10:28Z", "author": {"login": "hachikuji"}, "path": "tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java", "diffHunk": "@@ -503,10 +503,17 @@ private static ArgumentParser argParser() {\n                 .newArgumentParser(\"verifiable-consumer\")\n                 .defaultHelp(true)\n                 .description(\"This tool consumes messages from a specific topic and emits consumer events (e.g. group rebalances, received messages, and offsets committed) as JSON objects to STDOUT.\");\n+        parser.addArgument(\"--bootstrap-server\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a84cb1fdffa23ff06151923f65792c1060c8b5a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e44ecdc07e086ac89897688bc524d6ee788d307", "author": {"user": {"login": "mitchell-h", "name": "Mitch"}}, "url": "https://github.com/apache/kafka/commit/7e44ecdc07e086ac89897688bc524d6ee788d307", "committedDate": "2020-02-04T23:59:02Z", "message": "KIP-499 - Updated inline with commit comments.  Added requiredUnless options.  simplified validateOrDie logic."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NDU1ODgz", "url": "https://github.com/apache/kafka/pull/8023#pullrequestreview-354455883", "createdAt": "2020-02-06T13:41:25Z", "commit": {"oid": "7e44ecdc07e086ac89897688bc524d6ee788d307"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMzo0MToyNVrOFmbYWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxMzo0MToyNVrOFmbYWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgzODgwOA==", "bodyText": "The document \"The broker list string in the form HOST1:PORT1,HOST2:PORT2.\" is useful to terminal user. Could we keep it?", "url": "https://github.com/apache/kafka/pull/8023#discussion_r375838808", "createdAt": "2020-02-06T13:41:25Z", "author": {"login": "chia7712"}, "path": "core/src/main/scala/kafka/tools/ConsoleProducer.scala", "diffHunk": "@@ -125,10 +129,15 @@ object ConsoleProducer {\n       .withRequiredArg\n       .describedAs(\"topic\")\n       .ofType(classOf[String])\n-    val brokerListOpt = parser.accepts(\"broker-list\", \"REQUIRED: The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")\n+    val brokerListOpt = parser.accepts(\"broker-list\", \"DEPRECATED, use --bootstrap-server instead; ignored if --bootstrap-server is specified.  The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")\n       .withRequiredArg\n       .describedAs(\"broker-list\")\n       .ofType(classOf[String])\n+    val bootstrapServerOpt = parser.accepts(\"bootstrap-server\", \"REQUIRED unless --broker-list(deprecated) is specified. The server(s) to connect to.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e44ecdc07e086ac89897688bc524d6ee788d307"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "359190fc37d337a37243657827b26b4000ea569d", "author": {"user": {"login": "mitchell-h", "name": "Mitch"}}, "url": "https://github.com/apache/kafka/commit/359190fc37d337a37243657827b26b4000ea569d", "committedDate": "2020-02-09T18:05:01Z", "message": "Updated /docs to use `kafka-console-producer --bootstrap-server` instead of --broker-list\n\nadded 'The broker list string in the form HOST1:PORT1,HOST2:PORT2' to command line usage for kafka-console-producer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NTUyNjEw", "url": "https://github.com/apache/kafka/pull/8023#pullrequestreview-357552610", "createdAt": "2020-02-12T15:35:34Z", "commit": {"oid": "359190fc37d337a37243657827b26b4000ea569d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNTozNTozNVrOFozX8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNTozNTozNVrOFozX8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMyOTA3Mg==", "bodyText": "Should we also add The broker list string in the form HOST1:PORT1,HOST2:PORT2. to this message?", "url": "https://github.com/apache/kafka/pull/8023#discussion_r378329072", "createdAt": "2020-02-12T15:35:35Z", "author": {"login": "stanislavkozlovski"}, "path": "core/src/main/scala/kafka/tools/ConsumerPerformance.scala", "diffHunk": "@@ -202,9 +203,14 @@ object ConsumerPerformance extends LazyLogging {\n   }\n \n   class ConsumerPerfConfig(args: Array[String]) extends PerfConfig(args) {\n-    val bootstrapServersOpt = parser.accepts(\"broker-list\", \"REQUIRED: The server(s) to connect to.\")\n-      .withRequiredArg()\n-      .describedAs(\"host\")\n+    val brokerListOpt = parser.accepts(\"broker-list\", \"DEPRECATED, use --bootstrap-server instead; ignored if --bootstrap-server is specified.  The broker list string in the form HOST1:PORT1,HOST2:PORT2.\")\n+      .withRequiredArg\n+      .describedAs(\"broker-list\")\n+      .ofType(classOf[String])\n+    val bootstrapServerOpt = parser.accepts(\"bootstrap-server\", \"REQUIRED unless --broker-list(deprecated) is specified. The server(s) to connect to.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "359190fc37d337a37243657827b26b4000ea569d"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NTUzMDkw", "url": "https://github.com/apache/kafka/pull/8023#pullrequestreview-357553090", "createdAt": "2020-02-12T15:36:07Z", "commit": {"oid": "359190fc37d337a37243657827b26b4000ea569d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNTozNjowN1rOFozZgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNTozNjowN1rOFozZgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMyOTQ3Mw==", "bodyText": "nit: camelCase naming would be bootstrapServerValidArgs", "url": "https://github.com/apache/kafka/pull/8023#discussion_r378329473", "createdAt": "2020-02-12T15:36:07Z", "author": {"login": "stanislavkozlovski"}, "path": "core/src/test/scala/unit/kafka/tools/ConsoleProducerTest.scala", "diffHunk": "@@ -37,20 +37,45 @@ class ConsoleProducerTest {\n     \"--property\",\n     \"key.separator=#\"\n   )\n-\n+  val bootStrapServerValidArgs: Array[String] = Array(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "359190fc37d337a37243657827b26b4000ea569d"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NTUzMzU1", "url": "https://github.com/apache/kafka/pull/8023#pullrequestreview-357553355", "createdAt": "2020-02-12T15:36:26Z", "commit": {"oid": "359190fc37d337a37243657827b26b4000ea569d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNTozNjoyN1rOFozaSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNTozNjoyN1rOFozaSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMyOTY3NQ==", "bodyText": "nit: ditto on the camel case", "url": "https://github.com/apache/kafka/pull/8023#discussion_r378329675", "createdAt": "2020-02-12T15:36:27Z", "author": {"login": "stanislavkozlovski"}, "path": "core/src/test/scala/unit/kafka/tools/ConsoleProducerTest.scala", "diffHunk": "@@ -37,20 +37,45 @@ class ConsoleProducerTest {\n     \"--property\",\n     \"key.separator=#\"\n   )\n-\n+  val bootStrapServerValidArgs: Array[String] = Array(\n+    \"--bootstrap-server\",\n+    \"localhost:1003,localhost:1004\",\n+    \"--topic\",\n+    \"t3\",\n+    \"--property\",\n+    \"parse.key=true\",\n+    \"--property\",\n+    \"key.separator=#\"\n+  )\n   val invalidArgs: Array[String] = Array(\n     \"--t\", // not a valid argument\n     \"t3\"\n   )\n+  val bootStrapserverOverride: Array[String] = Array(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "359190fc37d337a37243657827b26b4000ea569d"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b18d3c6b5be06d2bcd7eb262147cfa0ff17b881", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/6b18d3c6b5be06d2bcd7eb262147cfa0ff17b881", "committedDate": "2020-02-13T17:32:29Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11a49210eb9233fef111c9a5ddfefe3588a9addd", "author": {"user": {"login": "hachikuji", "name": "Jason Gustafson"}}, "url": "https://github.com/apache/kafka/commit/11a49210eb9233fef111c9a5ddfefe3588a9addd", "committedDate": "2020-02-13T17:39:16Z", "message": "Fix test cases in ConsoleProducerTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDI1MjE2", "url": "https://github.com/apache/kafka/pull/8023#pullrequestreview-358425216", "createdAt": "2020-02-13T17:49:01Z", "commit": {"oid": "11a49210eb9233fef111c9a5ddfefe3588a9addd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1678, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}