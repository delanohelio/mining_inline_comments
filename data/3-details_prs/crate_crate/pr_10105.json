{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MDc5OTg3", "number": 10105, "title": "Simplify/Optimize BlobStoreRepository and related classes", "bodyText": "Summary of the changes / Why this improves CrateDB\nThe purpose of this pr is to bring the BlobStoreRepository and related code forward for later optimisations.\nBased on elastic/elasticsearch#42578 and elastic/elasticsearch#42833.\nPrecursor for further backports.\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-06-19T12:41:44Z", "url": "https://github.com/crate/crate/pull/10105", "merged": true, "mergeCommit": {"oid": "4555ddb7ab106c0e02d8bfb2048ea1a8c4e9d271"}, "closed": true, "closedAt": "2020-06-19T17:02:06Z", "author": {"login": "mkleen"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsyaZRAH2gAyNDM3MDc5OTg3OmUzM2I1N2E3NjQwYTBlZDI2NTRiMTg1YTFmODc4YWUzNzBiMTYyZmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcs1qKJAH2gAyNDM3MDc5OTg3OmIwODZiZjgzMDk0MGI4NjExYWRjNzMzYjUxNTE5MzRhODg1YjNjYTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e33b57a7640a0ed2654b185a1f878ae370b162ff", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/e33b57a7640a0ed2654b185a1f878ae370b162ff", "committedDate": "2020-06-19T12:42:50Z", "message": "Optimize restore shard operation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2fd96ce742d1835ee73d3275d2078ca506e0c22", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/f2fd96ce742d1835ee73d3275d2078ca506e0c22", "committedDate": "2020-06-19T12:42:50Z", "message": "Remove unused code from BlobStoreRepository"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1e11b46dedab00f94f151cd2f8b1022be0abc86", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/e1e11b46dedab00f94f151cd2f8b1022be0abc86", "committedDate": "2020-06-19T12:40:20Z", "message": "Simplify BlobStoreRepository\n\nBased on https://github.com/elastic/elasticsearch/pull/42578\nand https://github.com/elastic/elasticsearch/pull/42833"}, "afterCommit": {"oid": "7b334f522181f0d6b0db74e0577f2540c11efc9d", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/7b334f522181f0d6b0db74e0577f2540c11efc9d", "committedDate": "2020-06-19T12:42:50Z", "message": "Simplify BlobStoreRepository\n\nBased on https://github.com/elastic/elasticsearch/pull/42578\nand https://github.com/elastic/elasticsearch/pull/42833"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f743c8758c1844e68823c0564d367934c0495ac4", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/f743c8758c1844e68823c0564d367934c0495ac4", "committedDate": "2020-06-19T13:22:37Z", "message": "Simplify BlobStoreRepository\n\nBased on https://github.com/elastic/elasticsearch/pull/42578\nand https://github.com/elastic/elasticsearch/pull/42833"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a6946c684bf6d5463f585a87298fc0ddfe2c607", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/0a6946c684bf6d5463f585a87298fc0ddfe2c607", "committedDate": "2020-06-19T13:22:37Z", "message": "Remove unused code in BlobStoreRepository"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e897d6fe7453e19a467950c6fc23786144a86f4", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/1e897d6fe7453e19a467950c6fc23786144a86f4", "committedDate": "2020-06-19T13:13:19Z", "message": "Cleaning up"}, "afterCommit": {"oid": "0a6946c684bf6d5463f585a87298fc0ddfe2c607", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/0a6946c684bf6d5463f585a87298fc0ddfe2c607", "committedDate": "2020-06-19T13:22:37Z", "message": "Remove unused code in BlobStoreRepository"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MDk4MTQx", "url": "https://github.com/crate/crate/pull/10105#pullrequestreview-434098141", "createdAt": "2020-06-19T13:57:15Z", "commit": {"oid": "0a6946c684bf6d5463f585a87298fc0ddfe2c607"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzo1NzoxNVrOGmVx7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzo1NzoxNVrOGmVx7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1NTkxOQ==", "bodyText": "Just as input for further backports. When adapting the style maybe stick to our usual formats. Either 1 line per argument or all arguments in one line.", "url": "https://github.com/crate/crate/pull/10105#discussion_r442855919", "createdAt": "2020-06-19T13:57:15Z", "author": {"login": "mfussenegger"}, "path": "server/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java", "diffHunk": "@@ -464,7 +464,8 @@ private void restore(final IndexShard indexShard, final Repository repository, f\n                 snapshotShardId = new ShardId(indexName, IndexMetaData.INDEX_UUID_NA_VALUE, shardId.id());\n             }\n             final IndexId indexId = repository.getRepositoryData().resolveIndexId(indexName);\n-            repository.restoreShard(indexShard, restoreSource.snapshot().getSnapshotId(), restoreSource.version(), indexId, snapshotShardId, indexShard.recoveryState());\n+            repository.restoreShard(indexShard.store(), restoreSource.snapshot().getSnapshotId(),\n+                                    restoreSource.version(), indexId, snapshotShardId, indexShard.recoveryState());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a6946c684bf6d5463f585a87298fc0ddfe2c607"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTY5MTI2", "url": "https://github.com/crate/crate/pull/10105#pullrequestreview-434169126", "createdAt": "2020-06-19T15:33:19Z", "commit": {"oid": "0a6946c684bf6d5463f585a87298fc0ddfe2c607"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b086bf830940b8611adc733b5151934a885b3ca6", "author": {"user": {"login": "mergify[bot]", "name": null}}, "url": "https://github.com/crate/crate/commit/b086bf830940b8611adc733b5151934a885b3ca6", "committedDate": "2020-06-19T16:29:46Z", "message": "Merge branch 'master' into mkleen/simplify_blobstore_repo"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3294, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}