{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5NzAzOTU0", "number": 10227, "title": "Extend REFRESH statement docs", "bodyText": "Summary of the changes / Why this improves CrateDB\nHighlights the performance impact a bit more and elaborates on how to\nwork around it with primary key lookups.\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-07-15T20:03:13Z", "url": "https://github.com/crate/crate/pull/10227", "merged": true, "mergeCommit": {"oid": "d019026be2524f5ea43eb9c84ab0b6e56fbc686c"}, "closed": true, "closedAt": "2020-07-17T15:17:20Z", "author": {"login": "mfussenegger"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1QTWUgBqjM1NTAxMzQ1MzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc104jPAH2gAyNDQ5NzAzOTU0OjYxZWVhMTAxMzFmNWUwZTNmMmFlZTVmNDM5YjI2YmRlMjYwNGRkYTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb977a3d644c886daedf1a8e2107a42749f78e40", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/bb977a3d644c886daedf1a8e2107a42749f78e40", "committedDate": "2020-07-15T20:00:38Z", "message": "Extend REFERSH statement docs\n\nHighlights the performance impact a bit more and elaborates on how to\nwork around it with primary key lookups."}, "afterCommit": {"oid": "728a2447bff4a8114ab6693f8d9883c268631721", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/728a2447bff4a8114ab6693f8d9883c268631721", "committedDate": "2020-07-15T20:03:21Z", "message": "Extend REFRESH statement docs\n\nHighlights the performance impact a bit more and elaborates on how to\nwork around it with primary key lookups."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNTAyMjg0", "url": "https://github.com/crate/crate/pull/10227#pullrequestreview-450502284", "createdAt": "2020-07-17T09:16:04Z", "commit": {"oid": "728a2447bff4a8114ab6693f8d9883c268631721"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNTkzNTYw", "url": "https://github.com/crate/crate/pull/10227#pullrequestreview-450593560", "createdAt": "2020-07-17T11:52:20Z", "commit": {"oid": "728a2447bff4a8114ab6693f8d9883c268631721"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMTo1MjoyMFrOGzQFhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMjoxMzoyM1rOGzQoiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM5NDExNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                WHERE pk = 'ID1' OR pk = 'ID2' OR PK = 'ID3'\n          \n          \n            \n                WHERE pk = 'ID1' OR pk = 'ID2' OR pk = 'ID3'\n          \n      \n    \n    \n  \n\nquestion: if pk consists of multiple values, could it also be something like the following?\n    WHERE pk1 = 'ID1' OR pk2 = 'ID2'\n\nthanks to this documentation btw. i was able to give an answer to this on my own: no", "url": "https://github.com/crate/crate/pull/10227#discussion_r456394116", "createdAt": "2020-07-17T11:52:20Z", "author": {"login": "turbo-ele"}, "path": "docs/sql/statements/refresh.rst", "diffHunk": "@@ -22,30 +22,80 @@ Synopsis\n Description\n ===========\n \n-The REFRESH TABLE command refreshes one or more tables and all its rows, making\n-all changes made to that table available to all further commands.\n+The REFRESH TABLE command refreshes one or more tables, making all changes made\n+to that table visible to subsequent commands.\n \n-The ``PARTITION`` clause can be used to only refresh specific partitions of a\n-partitioned table. All columns by which a table is partitioned are required.\n+The ``PARTITION`` clause can be used to refresh specific partitions of a\n+partitioned table instead of all partitions. The ``PARTITION`` clause requires\n+all partitioned columns with the values that identify the partition as\n+argument.\n \n In case the ``PARTITION`` clause is omitted all open partitions will be\n refreshed. Closed partitions are not refreshed.\n \n-For performance reasons refreshing all open partitions should be avoided if\n-possible.\n-\n See :ref:`partitioned_tables` for more information on partitioned tables.\n \n-Without issuing this statement there is no guarantee that a change (``UPDATE``,\n-``DELETE``, ``COPY`` or ``INSERT``) will be seen by an immediately following\n-``SELECT`` statement for the row(s) affected by this change. By default a\n-refresh is scheduled periodically.\n \n-Internally a refresh opens a new table reader, which is then used by all\n-subsequent searches on the affected table.\n+For performance reasons, refreshing tables or partitions should be avoided as\n+it is an expensive operation. By default CrateDB periodically refreshes the\n+tables anyway. See :ref:`refresh_data` and :ref:`sql_ref_refresh_interval` for\n+more information about the periodic refreshes.\n+\n+Without an explicit ``REFRESH``, other statements like ``UPDATE``, ``DELETE``\n+or ``SELECT`` won't see data until the periodic refresh happens.\n+\n+An exception to that are statements which can filter on a primary key with an\n+exact match on one or more values. For example, looking up a single document in\n+a table with a single primary key column::\n+\n+    WHERE pk = 'ID1'\n+\n+If the primary key consists of multiple columns it would look like this::\n+\n+    WHERE pk1 = 'ID_PART_1' AND pk2 = 'ID_PART_2'\n+\n+Or if you want to query multiple records::\n+\n+    WHERE pk = 'ID1' OR pk = 'ID2' OR PK = 'ID3'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "728a2447bff4a8114ab6693f8d9883c268631721"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQwMzA4MA==", "bodyText": "if i got this right all primary key values have to be addressed, right?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            exact match on one or more values. For example, looking up a single document in\n          \n          \n            \n            exact match on all primary key values. For example, looking up a single document in", "url": "https://github.com/crate/crate/pull/10227#discussion_r456403080", "createdAt": "2020-07-17T12:13:23Z", "author": {"login": "turbo-ele"}, "path": "docs/sql/statements/refresh.rst", "diffHunk": "@@ -22,30 +22,80 @@ Synopsis\n Description\n ===========\n \n-The REFRESH TABLE command refreshes one or more tables and all its rows, making\n-all changes made to that table available to all further commands.\n+The REFRESH TABLE command refreshes one or more tables, making all changes made\n+to that table visible to subsequent commands.\n \n-The ``PARTITION`` clause can be used to only refresh specific partitions of a\n-partitioned table. All columns by which a table is partitioned are required.\n+The ``PARTITION`` clause can be used to refresh specific partitions of a\n+partitioned table instead of all partitions. The ``PARTITION`` clause requires\n+all partitioned columns with the values that identify the partition as\n+argument.\n \n In case the ``PARTITION`` clause is omitted all open partitions will be\n refreshed. Closed partitions are not refreshed.\n \n-For performance reasons refreshing all open partitions should be avoided if\n-possible.\n-\n See :ref:`partitioned_tables` for more information on partitioned tables.\n \n-Without issuing this statement there is no guarantee that a change (``UPDATE``,\n-``DELETE``, ``COPY`` or ``INSERT``) will be seen by an immediately following\n-``SELECT`` statement for the row(s) affected by this change. By default a\n-refresh is scheduled periodically.\n \n-Internally a refresh opens a new table reader, which is then used by all\n-subsequent searches on the affected table.\n+For performance reasons, refreshing tables or partitions should be avoided as\n+it is an expensive operation. By default CrateDB periodically refreshes the\n+tables anyway. See :ref:`refresh_data` and :ref:`sql_ref_refresh_interval` for\n+more information about the periodic refreshes.\n+\n+Without an explicit ``REFRESH``, other statements like ``UPDATE``, ``DELETE``\n+or ``SELECT`` won't see data until the periodic refresh happens.\n+\n+An exception to that are statements which can filter on a primary key with an\n+exact match on one or more values. For example, looking up a single document in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "728a2447bff4a8114ab6693f8d9883c268631721"}, "originalPosition": 40}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2feead4a92f32e28b43d2952cb3669261306466", "author": {"user": {"login": "mergify[bot]", "name": null}}, "url": "https://github.com/crate/crate/commit/d2feead4a92f32e28b43d2952cb3669261306466", "committedDate": "2020-07-17T12:16:14Z", "message": "Merge branch 'master' into j/refresh-docs"}, "afterCommit": {"oid": "256b13893d7d5ea534006ee910f07f6dd535fac0", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/256b13893d7d5ea534006ee910f07f6dd535fac0", "committedDate": "2020-07-17T12:26:38Z", "message": "fixup!"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNjQ0NDgz", "url": "https://github.com/crate/crate/pull/10227#pullrequestreview-450644483", "createdAt": "2020-07-17T13:11:59Z", "commit": {"oid": "256b13893d7d5ea534006ee910f07f6dd535fac0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNjYyODQ3", "url": "https://github.com/crate/crate/pull/10227#pullrequestreview-450662847", "createdAt": "2020-07-17T13:36:17Z", "commit": {"oid": "256b13893d7d5ea534006ee910f07f6dd535fac0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cdccc8b118434c64afa56965647f94729fc4648", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/6cdccc8b118434c64afa56965647f94729fc4648", "committedDate": "2020-07-17T14:00:25Z", "message": "Extend REFRESH statement docs\n\nHighlights the performance impact a bit more and elaborates on how to\nwork around it with primary key lookups."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "256b13893d7d5ea534006ee910f07f6dd535fac0", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/256b13893d7d5ea534006ee910f07f6dd535fac0", "committedDate": "2020-07-17T12:26:38Z", "message": "fixup!"}, "afterCommit": {"oid": "6cdccc8b118434c64afa56965647f94729fc4648", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/6cdccc8b118434c64afa56965647f94729fc4648", "committedDate": "2020-07-17T14:00:25Z", "message": "Extend REFRESH statement docs\n\nHighlights the performance impact a bit more and elaborates on how to\nwork around it with primary key lookups."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61eea10131f5e0e3f2aee5f439b26bde2604dda4", "author": {"user": {"login": "mergify[bot]", "name": null}}, "url": "https://github.com/crate/crate/commit/61eea10131f5e0e3f2aee5f439b26bde2604dda4", "committedDate": "2020-07-17T14:40:54Z", "message": "Merge branch 'master' into j/refresh-docs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3200, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}