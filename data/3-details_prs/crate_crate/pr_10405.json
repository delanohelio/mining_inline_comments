{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMjM1NDc2", "number": 10405, "title": "Clarify documentation of `ignored` object types", "bodyText": "Highlight that values of defined subcolumns are indeed validate/index, only new/unknown subcolumns aren\u2019t.", "createdAt": "2020-08-19T15:16:51Z", "url": "https://github.com/crate/crate/pull/10405", "merged": true, "mergeCommit": {"oid": "f41d67a767b1a83e506fe5718263108689ad1bac"}, "closed": true, "closedAt": "2020-08-26T14:29:41Z", "author": {"login": "seut"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAesWpAFqTQ3MDY0MDExMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCsUXUgBqjM2OTQ5Nzg0NjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNjQwMTEx", "url": "https://github.com/crate/crate/pull/10405#pullrequestreview-470640111", "createdAt": "2020-08-19T16:32:14Z", "commit": {"oid": "018dc1883ede4ab37cf473d5b49c0a46365753e5"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNjozMjoxNFrOHDPtUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNzowMToyMlrOHDRAJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE2NTEzNg==", "bodyText": "The (if not disabled) part left me wondering a bit before I figured out what it means.\nMaybe something like the following would clarify it?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            every other object type, values are validated and indexed (if not disabled).\n          \n          \n            \n            every other object type, values are validated and indexed, unless an explicit ``INDEX OFF`` clause is used to disable indexing.", "url": "https://github.com/crate/crate/pull/10405#discussion_r473165136", "createdAt": "2020-08-19T16:32:14Z", "author": {"login": "mfussenegger"}, "path": "docs/general/ddl/data-types.rst", "diffHunk": "@@ -968,9 +968,11 @@ not mapped according to their type, which is therefor not guessed as well. You\n can in fact add any value to an added column of the same name. The first value\n added does not determine what you can add further, like with ``dynamic``\n objects.\n+Subcolumn definitions inside an ``ignored`` object will behave the same like on\n+every other object type, values are validated and indexed (if not disabled).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "018dc1883ede4ab37cf473d5b49c0a46365753e5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE3NjAzOQ==", "bodyText": "I wonder if we should actually re-phrase the full paragraph. Something like the following maybe?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            every other object type, values are validated and indexed (if not disabled).\n          \n          \n            \n            The third option is ``ignored``. Explicitly defined columns within an ``ignored`` object behave the same as those within object columns declared as ``dynamic`` or ``strict``. The columns are indexed unless indexing is explicitly turned off using ``INDEX OFF`` and values inserted are validated. The difference is that with ``ignored``, dynamically added columns do not result in a schema update, and the values won't be indexed. This allows to store values with a mixed type under the same key.\n          \n          \n            \n            \n          \n          \n            \n            An example::\n          \n          \n            \n            \n          \n          \n            \n              cr> CREATE TABLE metrics (\n          \n          \n            \n              ...   id TEXT PRIMARY KEY,\n          \n          \n            \n              ...   payload OBJECT (IGNORED) as (\n          \n          \n            \n              ...     tag TEXT\n          \n          \n            \n              ...   )\n          \n          \n            \n              ... );\n          \n          \n            \n            \n          \n          \n            \n              cr> INSERT INTO metrics (id, payload) values ('1', {\"tag\"='AT', \"value\"=30}');\n          \n          \n            \n              cr> INSERT INTO metrics (id, payload) values ('2', {\"tag\": 'AT', \"value\"='str'});\n          \n          \n            \n            \n          \n          \n            \n              cr> SELECT payload FROM metrics ORDER BY id;", "url": "https://github.com/crate/crate/pull/10405#discussion_r473176039", "createdAt": "2020-08-19T16:48:02Z", "author": {"login": "mfussenegger"}, "path": "docs/general/ddl/data-types.rst", "diffHunk": "@@ -968,9 +968,11 @@ not mapped according to their type, which is therefor not guessed as well. You\n can in fact add any value to an added column of the same name. The first value\n added does not determine what you can add further, like with ``dynamic``\n objects.\n+Subcolumn definitions inside an ``ignored`` object will behave the same like on\n+every other object type, values are validated and indexed (if not disabled).", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE2NTEzNg=="}, "originalCommit": {"oid": "018dc1883ede4ab37cf473d5b49c0a46365753e5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE4NjM0MQ==", "bodyText": "Also a suggestion here to elaborate a bit on why it is slower and to distinguish between the ordering and filtering case, because ordering is not that much more expensive compared to the difference when using these columns in the WHERE clause. I also noticed that the part about not being able to use aggregations is incorrect:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               Filtering by and ordering on any undefined subcolumn is possible but very\n          \n          \n            \n               performance intensive. Undefined subcolumns of ``ignored`` objects are a\n          \n          \n            \n               *black box* for the storage engine, so the filtering/ordering is done using\n          \n          \n            \n               an expensive table scan and a filter/order function outside of the storage\n          \n          \n            \n               engine. Using undefined subcolumns of ``ignored`` objects for grouping or\n          \n          \n            \n               aggregations is not possible and will result in an exception unless explicit\n          \n          \n            \n               casted.\n          \n          \n            \n               Given that dynamically added sub-columns of an ``ignored`` objects are not indexed, filter operations on these columns cannot utilize the index and instead a value lookup is performed for each matching row. This can be mitigated by combining a filter using the ``AND`` clause with other predicates on indexed columns.\n          \n          \n            \n            \n          \n          \n            \n               Futhermore, values for dynamically added sub-columns of an ``ignored`` objects aren't stored in a column store, which means that ordering on these columns or using them with aggregates is also slower than using the same operations on regular columns. For some operations it may also be necessary to add an explicit type cast because there is no type information available in the schema. An example::\n          \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n               cr> SELECT arbitrary(payload['value']::text) FROM metrics;\n          \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n            Given that it is possible have values of different types within the same sub-column of an ignored objects, aggregations may fail at runtime::\n          \n          \n            \n            \n          \n          \n            \n            \n          \n          \n            \n               cr> SELECT sum(payload['value']::bigint) FROM metrics;", "url": "https://github.com/crate/crate/pull/10405#discussion_r473186341", "createdAt": "2020-08-19T17:01:22Z", "author": {"login": "mfussenegger"}, "path": "docs/general/ddl/data-types.rst", "diffHunk": "@@ -991,12 +993,13 @@ inserted into it, but otherwise ignore them.\n .. NOTE::\n \n    ``Ignored`` objects should be mainly used for storing and fetching.\n-   Filtering by and ordering on them is possible but very performance\n-   intensive. ``Ignored`` objects are a *black box* for the storage engine, so\n-   the filtering/ordering is done using an expensive table scan and a\n-   filter/order function outside of the storage engine. Using ``ignored``\n-   objects for grouping or aggregations is not possible at all and will result\n-   in an exception or ``NULL`` value if used with excplicit casts.\n+   Filtering by and ordering on any undefined subcolumn is possible but very\n+   performance intensive. Undefined subcolumns of ``ignored`` objects are a\n+   *black box* for the storage engine, so the filtering/ordering is done using\n+   an expensive table scan and a filter/order function outside of the storage\n+   engine. Using undefined subcolumns of ``ignored`` objects for grouping or\n+   aggregations is not possible and will result in an exception unless explicit\n+   casted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "018dc1883ede4ab37cf473d5b49c0a46365753e5"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8777bfec3d23cbf366bd0c3469e2215fc30f2d40", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/8777bfec3d23cbf366bd0c3469e2215fc30f2d40", "committedDate": "2020-08-20T07:40:21Z", "message": "Update docs/general/ddl/data-types.rst\n\nCo-authored-by: Mathias Fu\u00dfenegger <mfussenegger@users.noreply.github.com>"}, "afterCommit": {"oid": "533039778d5778cb5689d9ca695d63ac833d3fb6", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/533039778d5778cb5689d9ca695d63ac833d3fb6", "committedDate": "2020-08-20T08:49:39Z", "message": "fixup! Clarify documentation of `ignored` object types"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "533039778d5778cb5689d9ca695d63ac833d3fb6", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/533039778d5778cb5689d9ca695d63ac833d3fb6", "committedDate": "2020-08-20T08:49:39Z", "message": "fixup! Clarify documentation of `ignored` object types"}, "afterCommit": {"oid": "727d4de6e0799258415efe1656f580e1e2e30cfb", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/727d4de6e0799258415efe1656f580e1e2e30cfb", "committedDate": "2020-08-20T08:51:26Z", "message": "fixup! Clarify documentation of `ignored` object types"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMzk3MDY2", "url": "https://github.com/crate/crate/pull/10405#pullrequestreview-471397066", "createdAt": "2020-08-20T08:57:43Z", "commit": {"oid": "727d4de6e0799258415efe1656f580e1e2e30cfb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "727d4de6e0799258415efe1656f580e1e2e30cfb", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/727d4de6e0799258415efe1656f580e1e2e30cfb", "committedDate": "2020-08-20T08:51:26Z", "message": "fixup! Clarify documentation of `ignored` object types"}, "afterCommit": {"oid": "c01b2381b013f6650a1a951beb46ef2ad4dfe12a", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/c01b2381b013f6650a1a951beb46ef2ad4dfe12a", "committedDate": "2020-08-20T09:13:44Z", "message": "Clarify documentation of `ignored` object types\n\nHighlight that values of defined subcolumns are indeed validate/index,\nonly new/unknown subcolumns aren\u2019t."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNDg3ODE4", "url": "https://github.com/crate/crate/pull/10405#pullrequestreview-471487818", "createdAt": "2020-08-20T11:04:31Z", "commit": {"oid": "c01b2381b013f6650a1a951beb46ef2ad4dfe12a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMTowNDozMVrOHD70ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMTowODo0OVrOHD79mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg4Nzg4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            update, and the values won't be indexed. This allows to store values with a\n          \n          \n            \n            update and the values won't be indexed. This allows you to store values with a", "url": "https://github.com/crate/crate/pull/10405#discussion_r473887882", "createdAt": "2020-08-20T11:04:31Z", "author": {"login": "norosa"}, "path": "docs/general/ddl/data-types.rst", "diffHunk": "@@ -962,41 +962,92 @@ subcolumns. One can retrieve them, sort by them and use them in where clauses.\n ``ignored``\n -----------\n \n-The third option is ``ignored`` which results in an object that allows\n-inserting new subcolumns but this adding will not affect the schema, they are\n-not mapped according to their type, which is therefor not guessed as well. You\n-can in fact add any value to an added column of the same name. The first value\n-added does not determine what you can add further, like with ``dynamic``\n-objects.\n-\n-An object configured like this will simply accept and return the columns\n-inserted into it, but otherwise ignore them.\n-\n+The third option is ``ignored``. Explicitly defined columns within an\n+``ignored`` object behave the same as those within object columns declared as\n+``dynamic`` or ``strict``. The columns are indexed unless indexing is explicitly\n+turned off using ``INDEX OFF`` and values inserted are validated. The difference\n+is that with ``ignored``, dynamically added columns do not result in a schema\n+update, and the values won't be indexed. This allows to store values with a", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c01b2381b013f6650a1a951beb46ef2ad4dfe12a"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg5MDIwMg==", "bodyText": "can you clarify what \"and values inserted are validated\" means? the passive voice makes it a little ambiguous. a switch to active voice would probably clear it up\nis the user expected to validate values when inserting, or does CrateDB validate values when the user tries to insert them? (another way of putting it: is the validation a part of a \"columns are indexed unless X and Y\" precondition or is validation dependant upon indexing?)", "url": "https://github.com/crate/crate/pull/10405#discussion_r473890202", "createdAt": "2020-08-20T11:08:49Z", "author": {"login": "norosa"}, "path": "docs/general/ddl/data-types.rst", "diffHunk": "@@ -962,41 +962,92 @@ subcolumns. One can retrieve them, sort by them and use them in where clauses.\n ``ignored``\n -----------\n \n-The third option is ``ignored`` which results in an object that allows\n-inserting new subcolumns but this adding will not affect the schema, they are\n-not mapped according to their type, which is therefor not guessed as well. You\n-can in fact add any value to an added column of the same name. The first value\n-added does not determine what you can add further, like with ``dynamic``\n-objects.\n-\n-An object configured like this will simply accept and return the columns\n-inserted into it, but otherwise ignore them.\n-\n+The third option is ``ignored``. Explicitly defined columns within an\n+``ignored`` object behave the same as those within object columns declared as\n+``dynamic`` or ``strict``. The columns are indexed unless indexing is explicitly\n+turned off using ``INDEX OFF`` and values inserted are validated. The difference", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c01b2381b013f6650a1a951beb46ef2ad4dfe12a"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "085722371a155b2645b049773384272bb76d3c72", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/085722371a155b2645b049773384272bb76d3c72", "committedDate": "2020-08-20T13:55:15Z", "message": "fixup! Clarify documentation of `ignored` object types"}, "afterCommit": {"oid": "f9608c3ec305a15da9c0044d1856a7ef70217db4", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/f9608c3ec305a15da9c0044d1856a7ef70217db4", "committedDate": "2020-08-20T13:56:55Z", "message": "fixup! Clarify documentation of `ignored` object types"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNDgwMzA1", "url": "https://github.com/crate/crate/pull/10405#pullrequestreview-472480305", "createdAt": "2020-08-21T13:19:27Z", "commit": {"oid": "f9608c3ec305a15da9c0044d1856a7ef70217db4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f9608c3ec305a15da9c0044d1856a7ef70217db4", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/f9608c3ec305a15da9c0044d1856a7ef70217db4", "committedDate": "2020-08-20T13:56:55Z", "message": "fixup! Clarify documentation of `ignored` object types"}, "afterCommit": {"oid": "110c73b97ebfbce6c899a3c5664badcc46c40ce8", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/110c73b97ebfbce6c899a3c5664badcc46c40ce8", "committedDate": "2020-08-24T11:49:55Z", "message": "Clarify documentation of `ignored` object types\n\nHighlight that values of defined subcolumns are indeed validate/index,\nonly new/unknown subcolumns aren\u2019t."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "110c73b97ebfbce6c899a3c5664badcc46c40ce8", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/110c73b97ebfbce6c899a3c5664badcc46c40ce8", "committedDate": "2020-08-24T11:49:55Z", "message": "Clarify documentation of `ignored` object types\n\nHighlight that values of defined subcolumns are indeed validate/index,\nonly new/unknown subcolumns aren\u2019t."}, "afterCommit": {"oid": "fd45bc5e212b8b19de2fb824f5614b33f655f921", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/fd45bc5e212b8b19de2fb824f5614b33f655f921", "committedDate": "2020-08-26T06:04:11Z", "message": "Clarify documentation of `ignored` object types\n\nHighlight that values of defined subcolumns are indeed validate/index,\nonly new/unknown subcolumns aren\u2019t."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56eda37eb2088c9cae2926d20a194a310297d19f", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/56eda37eb2088c9cae2926d20a194a310297d19f", "committedDate": "2020-08-26T14:03:01Z", "message": "Clarify documentation of `ignored` object types\n\nHighlight that values of defined subcolumns are indeed validate/index,\nonly new/unknown subcolumns aren\u2019t."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd45bc5e212b8b19de2fb824f5614b33f655f921", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/fd45bc5e212b8b19de2fb824f5614b33f655f921", "committedDate": "2020-08-26T06:04:11Z", "message": "Clarify documentation of `ignored` object types\n\nHighlight that values of defined subcolumns are indeed validate/index,\nonly new/unknown subcolumns aren\u2019t."}, "afterCommit": {"oid": "56eda37eb2088c9cae2926d20a194a310297d19f", "author": {"user": {"login": "seut", "name": "Sebastian Utz"}}, "url": "https://github.com/crate/crate/commit/56eda37eb2088c9cae2926d20a194a310297d19f", "committedDate": "2020-08-26T14:03:01Z", "message": "Clarify documentation of `ignored` object types\n\nHighlight that values of defined subcolumns are indeed validate/index,\nonly new/unknown subcolumns aren\u2019t."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3220, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}