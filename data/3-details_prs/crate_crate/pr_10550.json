{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4MDUwMjE3", "number": 10550, "title": "Add support for `SET AND RESET SESSION AUTHORIZATION` statements.", "bodyText": "Summary of the changes / Why this improves CrateDB\nAdds support for SET AND RESET SESSION AUTHORIZATION statements.\nSee commits.\nAn example of the statements usage:\n> psql -h localhost -U crate doc\npsql (12.3, server 10.5)\n\n=> create user test;\nCREATE 1\nkov=> set session authorization test;\nSET 0\n=> create user another_test;\nERROR:  Missing 'AL' privilege for user 'test'\n=> set session authorization unknown_user;\nERROR:  User \"test\" is not authorized to execute the statement. Superuser permissions are required or you can set the session authorization back to the authenticated user.\n=> set session authorization default;\nSET 0\n=> create user another_test;\nCREATE 1\n=> set session authorization another_test;\nSET 0\n=> create user another_test;\nERROR:  Missing 'AL' privilege for user 'another_test'\n=> reset session authorization;\nRESET 0\n\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-09-16T14:57:23Z", "url": "https://github.com/crate/crate/pull/10550", "merged": true, "mergeCommit": {"oid": "ba6ea46134a31ab7b13c63c35a9453d9d7e46f7f"}, "closed": true, "closedAt": "2020-09-17T10:29:05Z", "author": {"login": "kovrus"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJeCuegBqjM3NzM3NzQ0MzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJt63rgBqjM3NzcxMDc1MTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3461c208c1f72dae4adaf110b77b559e071e3aff", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/3461c208c1f72dae4adaf110b77b559e071e3aff", "committedDate": "2020-09-16T14:55:40Z", "message": "Add support for RESET SESSION AUTHORIZATION statement."}, "afterCommit": {"oid": "41410dfd159b298aef0ac4cc250106c824ef47ac", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/41410dfd159b298aef0ac4cc250106c824ef47ac", "committedDate": "2020-09-16T15:22:16Z", "message": "Add support for RESET SESSION AUTHORIZATION statement."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41410dfd159b298aef0ac4cc250106c824ef47ac", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/41410dfd159b298aef0ac4cc250106c824ef47ac", "committedDate": "2020-09-16T15:22:16Z", "message": "Add support for RESET SESSION AUTHORIZATION statement."}, "afterCommit": {"oid": "8d4a5d1d5d809ffc3ea154f8de2bbfe59e3769af", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/8d4a5d1d5d809ffc3ea154f8de2bbfe59e3769af", "committedDate": "2020-09-17T08:10:41Z", "message": "Add support for RESET SESSION AUTHORIZATION statement."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d4a5d1d5d809ffc3ea154f8de2bbfe59e3769af", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/8d4a5d1d5d809ffc3ea154f8de2bbfe59e3769af", "committedDate": "2020-09-17T08:10:41Z", "message": "Add support for RESET SESSION AUTHORIZATION statement."}, "afterCommit": {"oid": "9885f0589524abca7c8134940566cb69ef77f6f0", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/9885f0589524abca7c8134940566cb69ef77f6f0", "committedDate": "2020-09-17T08:43:20Z", "message": "Add support for RESET SESSION AUTHORIZATION statement."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzY4NDg2", "url": "https://github.com/crate/crate/pull/10550#pullrequestreview-490368486", "createdAt": "2020-09-17T08:38:16Z", "commit": {"oid": "8d4a5d1d5d809ffc3ea154f8de2bbfe59e3769af"}, "state": "COMMENTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODozODoxNlrOHTXjsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODo1Nzo0MVrOHTYVhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MDk2MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Set the session and the current user of the current session.\n          \n          \n            \n            Set the user of the current session.", "url": "https://github.com/crate/crate/pull/10550#discussion_r490070961", "createdAt": "2020-09-17T08:38:16Z", "author": {"login": "mfussenegger"}, "path": "docs/sql/statements/set-session-authorization.rst", "diffHunk": "@@ -0,0 +1,54 @@\n+.. highlight:: psql\n+.. _ref-set-session-authorization:\n+\n+=======================================\n+``SET AND RESET SESSION AUTHORIZATION``\n+=======================================\n+\n+Set the session and the current user of the current session.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d4a5d1d5d809ffc3ea154f8de2bbfe59e3769af"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MTM1MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            These statements set or reset the session and current user of the current\n          \n          \n            \n            These statements set or reset the user of the", "url": "https://github.com/crate/crate/pull/10550#discussion_r490071350", "createdAt": "2020-09-17T08:38:52Z", "author": {"login": "mfussenegger"}, "path": "docs/sql/statements/set-session-authorization.rst", "diffHunk": "@@ -0,0 +1,54 @@\n+.. highlight:: psql\n+.. _ref-set-session-authorization:\n+\n+=======================================\n+``SET AND RESET SESSION AUTHORIZATION``\n+=======================================\n+\n+Set the session and the current user of the current session.\n+\n+.. rubric:: Table of contents\n+\n+.. contents::\n+   :local:\n+\n+Synopsis\n+========\n+\n+::\n+\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION username\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION DEFAULT\n+    RESET SESSION AUTHORIZATION\n+\n+Description\n+===========\n+\n+These statements set or reset the session and current user of the current", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d4a5d1d5d809ffc3ea154f8de2bbfe59e3769af"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MTgxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            session to the given or the initial session / authenticated user.\n          \n          \n            \n            session to the given or revert the user back to the original authenticated user.", "url": "https://github.com/crate/crate/pull/10550#discussion_r490071810", "createdAt": "2020-09-17T08:39:31Z", "author": {"login": "mfussenegger"}, "path": "docs/sql/statements/set-session-authorization.rst", "diffHunk": "@@ -0,0 +1,54 @@\n+.. highlight:: psql\n+.. _ref-set-session-authorization:\n+\n+=======================================\n+``SET AND RESET SESSION AUTHORIZATION``\n+=======================================\n+\n+Set the session and the current user of the current session.\n+\n+.. rubric:: Table of contents\n+\n+.. contents::\n+   :local:\n+\n+Synopsis\n+========\n+\n+::\n+\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION username\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION DEFAULT\n+    RESET SESSION AUTHORIZATION\n+\n+Description\n+===========\n+\n+These statements set or reset the session and current user of the current\n+session to the given or the initial session / authenticated user.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d4a5d1d5d809ffc3ea154f8de2bbfe59e3769af"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MTk4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The session user can be changed only if the initial session / authenticated\n          \n          \n            \n            The session user can be changed only if the initial authenticated", "url": "https://github.com/crate/crate/pull/10550#discussion_r490071981", "createdAt": "2020-09-17T08:39:48Z", "author": {"login": "mfussenegger"}, "path": "docs/sql/statements/set-session-authorization.rst", "diffHunk": "@@ -0,0 +1,54 @@\n+.. highlight:: psql\n+.. _ref-set-session-authorization:\n+\n+=======================================\n+``SET AND RESET SESSION AUTHORIZATION``\n+=======================================\n+\n+Set the session and the current user of the current session.\n+\n+.. rubric:: Table of contents\n+\n+.. contents::\n+   :local:\n+\n+Synopsis\n+========\n+\n+::\n+\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION username\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION DEFAULT\n+    RESET SESSION AUTHORIZATION\n+\n+Description\n+===========\n+\n+These statements set or reset the session and current user of the current\n+session to the given or the initial session / authenticated user.\n+\n+The session user can be changed only if the initial session / authenticated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d4a5d1d5d809ffc3ea154f8de2bbfe59e3769af"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MjA3Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            user had the superuser privileges.  Otherwise, the statement is accepted only\n          \n          \n            \n            user had superuser privileges.  Otherwise, the statement is only accepted", "url": "https://github.com/crate/crate/pull/10550#discussion_r490072072", "createdAt": "2020-09-17T08:39:58Z", "author": {"login": "mfussenegger"}, "path": "docs/sql/statements/set-session-authorization.rst", "diffHunk": "@@ -0,0 +1,54 @@\n+.. highlight:: psql\n+.. _ref-set-session-authorization:\n+\n+=======================================\n+``SET AND RESET SESSION AUTHORIZATION``\n+=======================================\n+\n+Set the session and the current user of the current session.\n+\n+.. rubric:: Table of contents\n+\n+.. contents::\n+   :local:\n+\n+Synopsis\n+========\n+\n+::\n+\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION username\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION DEFAULT\n+    RESET SESSION AUTHORIZATION\n+\n+Description\n+===========\n+\n+These statements set or reset the session and current user of the current\n+session to the given or the initial session / authenticated user.\n+\n+The session user can be changed only if the initial session / authenticated\n+user had the superuser privileges.  Otherwise, the statement is accepted only", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d4a5d1d5d809ffc3ea154f8de2bbfe59e3769af"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MjU4NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            if it specifies the originally authenticated user.\n          \n          \n            \n            if the specified username matches the originally authenticated user.", "url": "https://github.com/crate/crate/pull/10550#discussion_r490072585", "createdAt": "2020-09-17T08:40:40Z", "author": {"login": "mfussenegger"}, "path": "docs/sql/statements/set-session-authorization.rst", "diffHunk": "@@ -0,0 +1,54 @@\n+.. highlight:: psql\n+.. _ref-set-session-authorization:\n+\n+=======================================\n+``SET AND RESET SESSION AUTHORIZATION``\n+=======================================\n+\n+Set the session and the current user of the current session.\n+\n+.. rubric:: Table of contents\n+\n+.. contents::\n+   :local:\n+\n+Synopsis\n+========\n+\n+::\n+\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION username\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION DEFAULT\n+    RESET SESSION AUTHORIZATION\n+\n+Description\n+===========\n+\n+These statements set or reset the session and current user of the current\n+session to the given or the initial session / authenticated user.\n+\n+The session user can be changed only if the initial session / authenticated\n+user had the superuser privileges.  Otherwise, the statement is accepted only\n+if it specifies the originally authenticated user.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d4a5d1d5d809ffc3ea154f8de2bbfe59e3769af"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3NDkwNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Using this statement, it is possible to temporarily become an unprivileged\n          \n          \n            \n            user and later switch back to a superuser. In this case, the superuser must\n          \n          \n            \n            be the initial session / authenticated user. It can be achieved by providing\n          \n          \n            \n            the originally authenticated user name or the ``DEFAULT`` identifier.\n          \n          \n            \n            Using this statement, a superuser can temporarily become an unprivileged\n          \n          \n            \n            user and later switch back to a superuser. The supseruser would switch using ``SET SESSION AUTHORIZATION '<impersonating_user>'`` to drop privileges and become `impersonating_user`. Later the original privileges can be restored using ``SET SESSION AUTHORIZATION <real_username>`` or ``SET SESSION AUTHORIZATION DEFAULT``.", "url": "https://github.com/crate/crate/pull/10550#discussion_r490074906", "createdAt": "2020-09-17T08:44:29Z", "author": {"login": "mfussenegger"}, "path": "docs/sql/statements/set-session-authorization.rst", "diffHunk": "@@ -0,0 +1,54 @@\n+.. highlight:: psql\n+.. _ref-set-session-authorization:\n+\n+=======================================\n+``SET AND RESET SESSION AUTHORIZATION``\n+=======================================\n+\n+Set the session and the current user of the current session.\n+\n+.. rubric:: Table of contents\n+\n+.. contents::\n+   :local:\n+\n+Synopsis\n+========\n+\n+::\n+\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION username\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION DEFAULT\n+    RESET SESSION AUTHORIZATION\n+\n+Description\n+===========\n+\n+These statements set or reset the session and current user of the current\n+session to the given or the initial session / authenticated user.\n+\n+The session user can be changed only if the initial session / authenticated\n+user had the superuser privileges.  Otherwise, the statement is accepted only\n+if it specifies the originally authenticated user.\n+\n+Using this statement, it is possible to temporarily become an unprivileged\n+user and later switch back to a superuser. In this case, the superuser must\n+be the initial session / authenticated user. It can be achieved by providing\n+the originally authenticated user name or the ``DEFAULT`` identifier.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9885f0589524abca7c8134940566cb69ef77f6f0"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3NjE5OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ``SET`` and ``SET SESSION`` may affect the current session.\n          \n      \n    \n    \n  \n\nI think this is already clear from the previous paragraphs.", "url": "https://github.com/crate/crate/pull/10550#discussion_r490076199", "createdAt": "2020-09-17T08:46:32Z", "author": {"login": "mfussenegger"}, "path": "docs/sql/statements/set-session-authorization.rst", "diffHunk": "@@ -0,0 +1,54 @@\n+.. highlight:: psql\n+.. _ref-set-session-authorization:\n+\n+=======================================\n+``SET AND RESET SESSION AUTHORIZATION``\n+=======================================\n+\n+Set the session and the current user of the current session.\n+\n+.. rubric:: Table of contents\n+\n+.. contents::\n+   :local:\n+\n+Synopsis\n+========\n+\n+::\n+\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION username\n+    SET [ SESSION | LOCAL ] SESSION AUTHORIZATION DEFAULT\n+    RESET SESSION AUTHORIZATION\n+\n+Description\n+===========\n+\n+These statements set or reset the session and current user of the current\n+session to the given or the initial session / authenticated user.\n+\n+The session user can be changed only if the initial session / authenticated\n+user had the superuser privileges.  Otherwise, the statement is accepted only\n+if it specifies the originally authenticated user.\n+\n+Using this statement, it is possible to temporarily become an unprivileged\n+user and later switch back to a superuser. In this case, the superuser must\n+be the initial session / authenticated user. It can be achieved by providing\n+the originally authenticated user name or the ``DEFAULT`` identifier.\n+\n+``SET LOCAL`` does not have any effect on session. All ``SET LOCAL`` statements\n+will be ignored by CrateDB and logged with the ``INFO`` logging level.\n+\n+``SET`` and ``SET SESSION`` may affect the current session.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9885f0589524abca7c8134940566cb69ef77f6f0"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4MTgzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        var userName = ((StringLiteral) visit(context.username)).getValue();\n          \n          \n            \n                        var userLiteral = visit(context.username);\n          \n          \n            \n                        assert userLiteral instanceof StringLiteral\n          \n          \n            \n                            : \"username must be a StringLiteral because the parser grammar is restricted to string literals\";\n          \n          \n            \n                        var userName = ((StringLiteral) userLiteral).getValue();\n          \n      \n    \n    \n  \n\nJust a suggestion to make the contract between AstBuilder and parser grammar more explicit.", "url": "https://github.com/crate/crate/pull/10550#discussion_r490081837", "createdAt": "2020-09-17T08:55:06Z", "author": {"login": "mfussenegger"}, "path": "libs/sql-parser/src/main/java/io/crate/sql/parser/AstBuilder.java", "diffHunk": "@@ -730,6 +730,28 @@ public Node visitResetGlobal(SqlBaseParser.ResetGlobalContext context) {\n         return new ResetStatement<>(visitCollection(context.primaryExpression(), Expression.class));\n     }\n \n+    @Override\n+    public Node visitSetSessionAuthorization(SqlBaseParser.SetSessionAuthorizationContext context) {\n+        SetSessionAuthorizationStatement.Scope scope;\n+        if (context.LOCAL() != null) {\n+            scope = SetSessionAuthorizationStatement.Scope.LOCAL;\n+        } else {\n+            scope = SetSessionAuthorizationStatement.Scope.SESSION;\n+        }\n+\n+        if (context.DEFAULT() != null) {\n+            return new SetSessionAuthorizationStatement(scope);\n+        } else {\n+            var userName = ((StringLiteral) visit(context.username)).getValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9885f0589524abca7c8134940566cb69ef77f6f0"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4MjQ2MQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/crate/crate/pull/10550#discussion_r490082461", "createdAt": "2020-09-17T08:55:56Z", "author": {"login": "mfussenegger"}, "path": "libs/sql-parser/src/main/java/io/crate/sql/tree/SetSessionAuthorizationStatement.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Licensed to CRATE Technology GmbH (\"Crate\") under one or more contributor\n+ * license agreements.  See the NOTICE file distributed with this work for\n+ * additional information regarding copyright ownership.  Crate licenses\n+ * this file to you under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial agreement.\n+ */\n+\n+package io.crate.sql.tree;\n+\n+import javax.annotation.Nullable;\n+import java.util.Objects;\n+\n+public class SetSessionAuthorizationStatement extends Statement {\n+\n+    public enum Scope {\n+        SESSION, LOCAL\n+    }\n+\n+    @Nullable\n+    private final String user;\n+    private final Scope scope;\n+\n+    public SetSessionAuthorizationStatement(Scope scope) {\n+        this(null, scope);\n+    }\n+\n+    public SetSessionAuthorizationStatement(@Nullable String user, Scope scope) {\n+        this.scope = scope;\n+        this.user = user;\n+    }\n+\n+    /**\n+     * user is null for the following statements::", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9885f0589524abca7c8134940566cb69ef77f6f0"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4MzE1Nw==", "bodyText": "Maybe add the same comment as in the statement class, or link to it?", "url": "https://github.com/crate/crate/pull/10550#discussion_r490083157", "createdAt": "2020-09-17T08:56:51Z", "author": {"login": "mfussenegger"}, "path": "server/src/main/java/io/crate/analyze/AnalyzedSetSessionAuthorizationStatement.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to CRATE Technology GmbH (\"Crate\") under one or more contributor\n+ * license agreements.  See the NOTICE file distributed with this work for\n+ * additional information regarding copyright ownership.  Crate licenses\n+ * this file to you under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial agreement.\n+ */\n+\n+package io.crate.analyze;\n+\n+import io.crate.sql.tree.SetSessionAuthorizationStatement;\n+\n+import javax.annotation.Nullable;\n+\n+public class AnalyzedSetSessionAuthorizationStatement implements AnalyzedStatement {\n+\n+    @Nullable\n+    private final String user;\n+    private final SetSessionAuthorizationStatement.Scope scope;\n+\n+    AnalyzedSetSessionAuthorizationStatement(@Nullable String user,\n+                                             SetSessionAuthorizationStatement.Scope scope) {\n+        this.user = user;\n+        this.scope = scope;\n+    }\n+\n+    @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9885f0589524abca7c8134940566cb69ef77f6f0"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4MzcxNw==", "bodyText": "Should we inline this into the Analyzer instead of creating a separate class? Seems overkill to extract this only for the call of a constructor", "url": "https://github.com/crate/crate/pull/10550#discussion_r490083717", "createdAt": "2020-09-17T08:57:41Z", "author": {"login": "mfussenegger"}, "path": "server/src/main/java/io/crate/analyze/SetSessionAuthorizationStatementAnalyzer.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Licensed to CRATE Technology GmbH (\"Crate\") under one or more contributor\n+ * license agreements.  See the NOTICE file distributed with this work for\n+ * additional information regarding copyright ownership.  Crate licenses\n+ * this file to you under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the\n+ * License for the specific language governing permissions and limitations\n+ * under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial agreement.\n+ */\n+\n+package io.crate.analyze;\n+\n+import io.crate.sql.tree.SetSessionAuthorizationStatement;\n+\n+class SetSessionAuthorizationStatementAnalyzer {\n+\n+    public static AnalyzedStatement analyze(SetSessionAuthorizationStatement statement) {\n+        return new AnalyzedSetSessionAuthorizationStatement(\n+            statement.user(),\n+            statement.scope()\n+        );\n+    }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9885f0589524abca7c8134940566cb69ef77f6f0"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9277a55aff178815f6c5bf6065b7300242cf8517", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/9277a55aff178815f6c5bf6065b7300242cf8517", "committedDate": "2020-09-17T09:13:34Z", "message": "fixup! Add support for SET SESSION AUTHORIZATION username statement."}, "afterCommit": {"oid": "4a04d31a6c34061370a1a61224a28f213ef70327", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/4a04d31a6c34061370a1a61224a28f213ef70327", "committedDate": "2020-09-17T09:25:42Z", "message": "fixup! Add support for SET SESSION AUTHORIZATION username statement."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNDIwMTI2", "url": "https://github.com/crate/crate/pull/10550#pullrequestreview-490420126", "createdAt": "2020-09-17T09:41:17Z", "commit": {"oid": "4a04d31a6c34061370a1a61224a28f213ef70327"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f3766ba7db73598ccbff2efd05ba0588c2fa582", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/1f3766ba7db73598ccbff2efd05ba0588c2fa582", "committedDate": "2020-09-17T09:50:56Z", "message": "Add support for SET SESSION AUTHORIZATION username statement."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85695a05efbcac6c15458af6c906087b5029c0da", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/85695a05efbcac6c15458af6c906087b5029c0da", "committedDate": "2020-09-17T09:50:58Z", "message": "Rename SessionContext#user to SessionContext#sessionUser.\n\nTo emphasize which user is used such as currently session context\ncontains authenticated and session users."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faeb620ab7875c0953361df421af80f419cdfb4a", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/faeb620ab7875c0953361df421af80f419cdfb4a", "committedDate": "2020-09-17T09:51:19Z", "message": "Add support for RESET SESSION AUTHORIZATION statement."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a04d31a6c34061370a1a61224a28f213ef70327", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/4a04d31a6c34061370a1a61224a28f213ef70327", "committedDate": "2020-09-17T09:25:42Z", "message": "fixup! Add support for SET SESSION AUTHORIZATION username statement."}, "afterCommit": {"oid": "faeb620ab7875c0953361df421af80f419cdfb4a", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/faeb620ab7875c0953361df421af80f419cdfb4a", "committedDate": "2020-09-17T09:51:19Z", "message": "Add support for RESET SESSION AUTHORIZATION statement."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3769, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}