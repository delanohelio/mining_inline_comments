{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0MjkwNjkw", "number": 9736, "title": "Make sure that aliased literals are not de-duplicated", "bodyText": "Summary of the changes / Why this improves CrateDB\nFixes #9732\nThis is already fixed in master by #9684\nChecklist\n\n User relevant changes are recorded in CHANGES.txt\n Touched code is covered by tests\n Documentation has been updated if necessary\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-03-05T13:57:43Z", "url": "https://github.com/crate/crate/pull/9736", "merged": true, "mergeCommit": {"oid": "c6d3d45900d23866bca693b7360c2d8747969d8a"}, "closed": true, "closedAt": "2020-03-05T14:55:13Z", "author": {"login": "mfussenegger"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKr-IBABqjMxMDEzMDc4ODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKsZeBAFqTM2OTYxMzAyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7353239e3091663e586e677ee50bdf5b7f9e74c", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/c7353239e3091663e586e677ee50bdf5b7f9e74c", "committedDate": "2020-03-05T13:53:05Z", "message": "Make sure that aliased literals are not de-duplicated\n\nFixes https://github.com/crate/crate/issues/9732\n\nThis is already fixed in master by https://github.com/crate/crate/pull/9684"}, "afterCommit": {"oid": "dcb57ce67abe2ee793d426664c0854f1acbcbad5", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/dcb57ce67abe2ee793d426664c0854f1acbcbad5", "committedDate": "2020-03-05T13:58:58Z", "message": "Make sure that aliased literals are not de-duplicated\n\nFixes https://github.com/crate/crate/issues/9732\n\nThis is already fixed in master by https://github.com/crate/crate/pull/9684"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NTg5MjU2", "url": "https://github.com/crate/crate/pull/9736#pullrequestreview-369589256", "createdAt": "2020-03-05T13:59:44Z", "commit": {"oid": "dcb57ce67abe2ee793d426664c0854f1acbcbad5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzo1OTo0NFrOFyUjYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMzo1OTo0NFrOFyUjYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMwOTg1OQ==", "bodyText": "Without the fix there was an eval on top that had mes, mes, mes", "url": "https://github.com/crate/crate/pull/9736#discussion_r388309859", "createdAt": "2020-03-05T13:59:44Z", "author": {"login": "mfussenegger"}, "path": "sql/src/test/java/io/crate/planner/operators/LogicalPlannerTest.java", "diffHunk": "@@ -338,6 +339,57 @@ public void testAliasedPrimaryKeyLookupHasGetPlan() {\n                                 \"Get[doc.users | name | DocKeys{1}\"));\n     }\n \n+    @Test\n+    public void test_literal_with_alias_are_not_de_duplicated() {\n+        LogicalPlan plan = plan(\n+            \"SELECT\\n\" +\n+            \"        id_asset,\\n\" +\n+            \"        sum(hora),\\n\" +\n+            \"        sum(dia),\\n\" +\n+            \"        SUM(mes)\\n\" +\n+            \"    FROM (\\n\" +\n+            \"        SELECT\\n\" +\n+            \"            id_asset,\\n\" +\n+            \"            sum(fields['contador_total:dx']) AS hora,\\n\" +\n+            \"            0 AS dia,\\n\" +\n+            \"            0 as mes\\n\" +\n+            \"        FROM\\n\" +\n+            \"            zmx.metrics\\n\" +\n+            \"        GROUP BY\\n\" +\n+            \"            id_asset\\n\" +\n+            \"        UNION ALL\\n\" +\n+            \"        SELECT\\n\" +\n+            \"            id_asset,\\n\" +\n+            \"            0 AS hora,\\n\" +\n+            \"            sum(fields['contador_total:dx']) AS dia,\\n\" +\n+            \"            0 as mes\\n\" +\n+            \"        FROM\\n\" +\n+            \"            zmx.metrics\\n\" +\n+            \"        GROUP BY\\n\" +\n+            \"            id_asset\\n\" +\n+            \"        ) AS subquery\\n\" +\n+            \"    GROUP BY\\n\" +\n+            \"        id_asset limit 100;\"\n+        );\n+        assertThat(\n+            plan,\n+            isPlan(\n+                \"Limit[100;0]\\n\" +\n+                \"GroupBy[id_asset | sum(hora), sum(dia), sum(mes)]\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcb57ce67abe2ee793d426664c0854f1acbcbad5"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bba0dda5b8b747c598d5721a84ed0283c48bb16", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/9bba0dda5b8b747c598d5721a84ed0283c48bb16", "committedDate": "2020-03-05T14:00:14Z", "message": "Make sure that aliased literals are not de-duplicated\n\nFixes https://github.com/crate/crate/issues/9732\n\nThis is already fixed in master by https://github.com/crate/crate/pull/9684"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dcb57ce67abe2ee793d426664c0854f1acbcbad5", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/dcb57ce67abe2ee793d426664c0854f1acbcbad5", "committedDate": "2020-03-05T13:58:58Z", "message": "Make sure that aliased literals are not de-duplicated\n\nFixes https://github.com/crate/crate/issues/9732\n\nThis is already fixed in master by https://github.com/crate/crate/pull/9684"}, "afterCommit": {"oid": "9bba0dda5b8b747c598d5721a84ed0283c48bb16", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/9bba0dda5b8b747c598d5721a84ed0283c48bb16", "committedDate": "2020-03-05T14:00:14Z", "message": "Make sure that aliased literals are not de-duplicated\n\nFixes https://github.com/crate/crate/issues/9732\n\nThis is already fixed in master by https://github.com/crate/crate/pull/9684"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NjEzMDIw", "url": "https://github.com/crate/crate/pull/9736#pullrequestreview-369613020", "createdAt": "2020-03-05T14:28:58Z", "commit": {"oid": "9bba0dda5b8b747c598d5721a84ed0283c48bb16"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3563, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}