{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MjU2MDAy", "number": 9944, "title": "Session based optimizer configuration", "bodyText": "Summary of the changes / Why this improves CrateDB\nThis adds session settings for rule optimisation adressing #9749\nDeactivate an optimizer rule:\nSET SESSION optimizer_merge_aggregate_and_collect_to_count = false;\n\nActivate it back:\nSET SESSION optimizer_merge_aggregate_and_collect_to_count = true;\n\nAll the optimizer rules will show up like any other session setting:\ncr> show all;\n+---------------------------------------------------------+-----------------+-------------------------------------------------------------------------------------+\n| name                                                    | setting         | description                                                                         |\n+---------------------------------------------------------+-----------------+-------------------------------------------------------------------------------------+\n| search_path                                             | pg_catalog, doc | Sets the schema search order.                                                       |\n| enable_hashjoin                                         | true            | Considers using the Hash Join instead of the Nested Loop Join implementation.       |\n| max_index_keys                                          | 32              | Shows the maximum number of index keys.                                             |\n| server_version_num                                      | 100500          | Reports the emulated PostgreSQL version number                                      |\n| server_version                                          | 10.5            | Reports the emulated PostgreSQL version number                                      |\n| optimizer_merge_aggregate_and_collect_to_count          | false           | Indicates if the optimizer rule MergeAggregateAndCollectToCount is activated.       |\n| optimizer_move_filter_beneath_order                     | true            | Indicates if the optimizer rule MoveFilterBeneathOrder is activated.                |\n| optimizer_remove_redundant_fetch_or_eval                | true            | Indicates if the optimizer rule RemoveRedundantFetchOrEval is activated.            |\n| optimizer_rewrite_collect_to_get                        | true            | Indicates if the optimizer rule RewriteCollectToGet is activated.                   |\n| optimizer_move_filter_beneath_project_set               | true            | Indicates if the optimizer rule MoveFilterBeneathProjectSet is activated.           |\n| optimizer_move_order_beneath_nested_loop                | true            | Indicates if the optimizer rule MoveOrderBeneathNestedLoop is activated.            |\n| optimizer_deduplicate_order                             | true            | Indicates if the optimizer rule DeduplicateOrder is activated.                      |\n| optimizer_move_filter_beneath_group_by                  | true            | Indicates if the optimizer rule MoveFilterBeneathGroupBy is activated.              |\n\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-05-13T10:03:59Z", "url": "https://github.com/crate/crate/pull/9944", "merged": true, "mergeCommit": {"oid": "3e85bde7e3b4ac48cb895f44026987832215b9c3"}, "closed": true, "closedAt": "2020-05-19T11:20:18Z", "author": {"login": "mkleen"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg4ZWhAFqTQxMDg4MDExNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABciyI7pgH2gAyNDE3MjU2MDAyOjE5YjdlYmJiZDk0Y2VjNTU0NTM0YmJkNGQ3ZmFiOGE1MDM4YWFmM2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwODgwMTE2", "url": "https://github.com/crate/crate/pull/9944#pullrequestreview-410880116", "createdAt": "2020-05-13T12:39:07Z", "commit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjozOTowOFrOGUviIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjo1MzozN1rOGUwGGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQwMzQ5MQ==", "bodyText": "A volatile would also work - no CAS operation are used.", "url": "https://github.com/crate/crate/pull/9944#discussion_r424403491", "createdAt": "2020-05-13T12:39:08Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/planner/operators/RewriteInsertFromSubQueryToInsertFromValues.java", "diffHunk": "@@ -23,22 +23,26 @@\n package io.crate.planner.operators;\n \n import io.crate.expression.tablefunctions.ValuesFunction;\n+import io.crate.metadata.Functions;\n import io.crate.metadata.TransactionContext;\n import io.crate.planner.optimizer.Rule;\n import io.crate.planner.optimizer.matcher.Capture;\n import io.crate.planner.optimizer.matcher.Captures;\n import io.crate.planner.optimizer.matcher.Pattern;\n import io.crate.statistics.TableStats;\n \n+import java.util.concurrent.atomic.AtomicBoolean;\n+\n import static io.crate.planner.optimizer.matcher.Pattern.typeOf;\n import static io.crate.planner.optimizer.matcher.Patterns.source;\n \n public class RewriteInsertFromSubQueryToInsertFromValues implements Rule<Insert> {\n \n     private final Capture<TableFunction> capture;\n     private final Pattern<Insert> pattern;\n+    private final AtomicBoolean enabled = new AtomicBoolean(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQwMzc4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static final String OPTIMIZER_RULE = \"optimizer_\";\n          \n          \n            \n                private static final String OPTIMIZER_SETTING_PREFIX = \"optimizer_\";", "url": "https://github.com/crate/crate/pull/9944#discussion_r424403781", "createdAt": "2020-05-13T12:39:38Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/planner/optimizer/LoadedRules.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ * Licensed to Crate under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.  Crate licenses this file\n+ * to you under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ * implied.  See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial\n+ * agreement.\n+ */\n+\n+package io.crate.planner.optimizer;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.CaseFormat;\n+import io.crate.common.collections.Lists2;\n+import io.crate.metadata.settings.session.SessionSetting;\n+import io.crate.metadata.settings.session.SessionSettingProvider;\n+import io.crate.planner.operators.RewriteInsertFromSubQueryToInsertFromValues;\n+import io.crate.planner.optimizer.rule.DeduplicateOrder;\n+import io.crate.planner.optimizer.rule.MergeAggregateAndCollectToCount;\n+import io.crate.planner.optimizer.rule.MergeFilterAndCollect;\n+import io.crate.planner.optimizer.rule.MergeFilters;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathFetchOrEval;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathGroupBy;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathHashJoin;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathNestedLoop;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathOrder;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathProjectSet;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathRename;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathUnion;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathWindowAgg;\n+import io.crate.planner.optimizer.rule.MoveOrderBeneathFetchOrEval;\n+import io.crate.planner.optimizer.rule.MoveOrderBeneathNestedLoop;\n+import io.crate.planner.optimizer.rule.MoveOrderBeneathRename;\n+import io.crate.planner.optimizer.rule.MoveOrderBeneathUnion;\n+import io.crate.planner.optimizer.rule.RemoveRedundantFetchOrEval;\n+import io.crate.planner.optimizer.rule.RewriteCollectToGet;\n+import io.crate.planner.optimizer.rule.RewriteFilterOnOuterJoinToInnerJoin;\n+import io.crate.planner.optimizer.rule.RewriteGroupByKeysLimitToTopNDistinct;\n+import io.crate.planner.optimizer.rule.RewriteToQueryThenFetch;\n+import io.crate.types.DataTypes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Set;\n+\n+public class LoadedRules implements SessionSettingProvider {\n+\n+    private static final String OPTIMIZER_RULE = \"optimizer_\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQwNDc3NQ==", "bodyText": "Maybe would be worth adding some docs to explain what this is for", "url": "https://github.com/crate/crate/pull/9944#discussion_r424404775", "createdAt": "2020-05-13T12:41:08Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/metadata/settings/session/SessionSettingProvider.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to Crate under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.  Crate licenses this file\n+ * to you under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ * implied.  See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial\n+ * agreement.\n+ */\n+\n+package io.crate.metadata.settings.session;\n+\n+import io.crate.planner.optimizer.Rule;\n+\n+import java.util.List;\n+\n+public interface SessionSettingProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQwNTI5OQ==", "bodyText": "Would a HashMap also do? Or where is the stable ordering requirement coming from?", "url": "https://github.com/crate/crate/pull/9944#discussion_r424405299", "createdAt": "2020-05-13T12:41:52Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/metadata/settings/session/SessionSettingRegistry.java", "diffHunk": "@@ -104,7 +111,18 @@\n                     DataTypes.STRING.getName()\n                 )\n             )\n-            .build();\n+        .putAll(getSessionSettings())\n+        .build();\n+\n+    private static Map<String, SessionSetting<?>> getSessionSettings() {\n+        var result = new LinkedHashMap<String, SessionSetting<?>>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQwNzgyOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    this.rules = loadRules(rulesToInclude);\n          \n          \n            \n                this.rules = new LoadedRules().getRules(rulesToInclude);\n          \n      \n    \n    \n  \n\nloadRules is a shallow method. I don't think there is a benefit in having a separate method?", "url": "https://github.com/crate/crate/pull/9944#discussion_r424407828", "createdAt": "2020-05-13T12:46:00Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/planner/optimizer/Optimizer.java", "diffHunk": "@@ -41,22 +42,25 @@\n \n     private final List<Rule<?>> rules;\n     private final Supplier<Version> minNodeVersionInCluster;\n+    private final Functions functions;\n \n-    public Optimizer(List<Rule<?>> rules, Supplier<Version> minNodeVersionInCluster) {\n-        this.rules = rules;\n+    public Optimizer(Functions functions, Supplier<Version> minNodeVersionInCluster, List<Class<? extends Rule<?>>> rulesToInclude) {\n+        this.rules = loadRules(rulesToInclude);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQwODUwMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LogicalPlan optimizedRoot = tryApplyRules(rules, plan, tableStats, txnCtx);\n          \n          \n            \n                    LogicalPlan optimizedRoot = tryApplyRules(plan, tableStats, txnCtx);\n          \n      \n    \n    \n  \n\nThere is still a rules attribute.", "url": "https://github.com/crate/crate/pull/9944#discussion_r424408500", "createdAt": "2020-05-13T12:47:08Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/planner/optimizer/Optimizer.java", "diffHunk": "@@ -41,22 +42,25 @@\n \n     private final List<Rule<?>> rules;\n     private final Supplier<Version> minNodeVersionInCluster;\n+    private final Functions functions;\n \n-    public Optimizer(List<Rule<?>> rules, Supplier<Version> minNodeVersionInCluster) {\n-        this.rules = rules;\n+    public Optimizer(Functions functions, Supplier<Version> minNodeVersionInCluster, List<Class<? extends Rule<?>>> rulesToInclude) {\n+        this.rules = loadRules(rulesToInclude);\n         this.minNodeVersionInCluster = minNodeVersionInCluster;\n+        this.functions = functions;\n     }\n \n     public LogicalPlan optimize(LogicalPlan plan, TableStats tableStats, TransactionContext txnCtx) {\n-        LogicalPlan optimizedRoot = tryApplyRules(plan, tableStats, txnCtx);\n+        LogicalPlan optimizedRoot = tryApplyRules(rules, plan, tableStats, txnCtx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQwODU4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        rules,", "url": "https://github.com/crate/crate/pull/9944#discussion_r424408588", "createdAt": "2020-05-13T12:47:16Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/planner/optimizer/Optimizer.java", "diffHunk": "@@ -41,22 +42,25 @@\n \n     private final List<Rule<?>> rules;\n     private final Supplier<Version> minNodeVersionInCluster;\n+    private final Functions functions;\n \n-    public Optimizer(List<Rule<?>> rules, Supplier<Version> minNodeVersionInCluster) {\n-        this.rules = rules;\n+    public Optimizer(Functions functions, Supplier<Version> minNodeVersionInCluster, List<Class<? extends Rule<?>>> rulesToInclude) {\n+        this.rules = loadRules(rulesToInclude);\n         this.minNodeVersionInCluster = minNodeVersionInCluster;\n+        this.functions = functions;\n     }\n \n     public LogicalPlan optimize(LogicalPlan plan, TableStats tableStats, TransactionContext txnCtx) {\n-        LogicalPlan optimizedRoot = tryApplyRules(plan, tableStats, txnCtx);\n+        LogicalPlan optimizedRoot = tryApplyRules(rules, plan, tableStats, txnCtx);\n         return tryApplyRules(\n+            rules,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQwODcwMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private LogicalPlan tryApplyRules(List<Rule<?>> rules, LogicalPlan plan, TableStats tableStats, TransactionContext txnCtx) {\n          \n          \n            \n                private LogicalPlan tryApplyRules(LogicalPlan plan, TableStats tableStats, TransactionContext txnCtx) {", "url": "https://github.com/crate/crate/pull/9944#discussion_r424408702", "createdAt": "2020-05-13T12:47:27Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/planner/optimizer/Optimizer.java", "diffHunk": "@@ -41,22 +42,25 @@\n \n     private final List<Rule<?>> rules;\n     private final Supplier<Version> minNodeVersionInCluster;\n+    private final Functions functions;\n \n-    public Optimizer(List<Rule<?>> rules, Supplier<Version> minNodeVersionInCluster) {\n-        this.rules = rules;\n+    public Optimizer(Functions functions, Supplier<Version> minNodeVersionInCluster, List<Class<? extends Rule<?>>> rulesToInclude) {\n+        this.rules = loadRules(rulesToInclude);\n         this.minNodeVersionInCluster = minNodeVersionInCluster;\n+        this.functions = functions;\n     }\n \n     public LogicalPlan optimize(LogicalPlan plan, TableStats tableStats, TransactionContext txnCtx) {\n-        LogicalPlan optimizedRoot = tryApplyRules(plan, tableStats, txnCtx);\n+        LogicalPlan optimizedRoot = tryApplyRules(rules, plan, tableStats, txnCtx);\n         return tryApplyRules(\n+            rules,\n             optimizedRoot.replaceSources(Lists2.map(optimizedRoot.sources(), x -> optimize(x, tableStats, txnCtx))),\n             tableStats,\n             txnCtx\n         );\n     }\n \n-    private LogicalPlan tryApplyRules(LogicalPlan plan, TableStats tableStats, TransactionContext txnCtx) {\n+    private LogicalPlan tryApplyRules(List<Rule<?>> rules, LogicalPlan plan, TableStats tableStats, TransactionContext txnCtx) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQwOTYzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                private List<Rule<?>> loadRules(List<Class<? extends Rule<?>>> rulesToInclude) {\n          \n          \n            \n                    return new LoadedRules().getRules(rulesToInclude);\n          \n          \n            \n                }", "url": "https://github.com/crate/crate/pull/9944#discussion_r424409637", "createdAt": "2020-05-13T12:48:54Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/planner/optimizer/Optimizer.java", "diffHunk": "@@ -92,4 +102,8 @@ private LogicalPlan tryApplyRules(LogicalPlan plan, TableStats tableStats, Trans\n             : \"Optimizer reached 10_000 iterations safety guard. This is an indication of a broken rule that matches again and again\";\n         return node;\n     }\n+\n+    private List<Rule<?>> loadRules(List<Class<? extends Rule<?>>> rulesToInclude) {\n+        return new LoadedRules().getRules(rulesToInclude);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQxMDU0NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private boolean couldMatchOnNull(@Nullable Symbol query, EvaluatingNormalizer normalizer) {\n          \n          \n            \n                private static boolean couldMatchOnNull(@Nullable Symbol query, EvaluatingNormalizer normalizer) {", "url": "https://github.com/crate/crate/pull/9944#discussion_r424410545", "createdAt": "2020-05-13T12:50:19Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/planner/optimizer/rule/RewriteFilterOnOuterJoinToInnerJoin.java", "diffHunk": "@@ -264,7 +276,7 @@ public LogicalPlan apply(Filter filter,\n         return splitQueries.isEmpty() ? newJoin : new Filter(newJoin, AndOperator.join(splitQueries.values()));\n     }\n \n-    private boolean couldMatchOnNull(@Nullable Symbol query) {\n+    private boolean couldMatchOnNull(@Nullable Symbol query, EvaluatingNormalizer normalizer) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQxMjY5OA==", "bodyText": "I wonder if these should actually be instance local, and if we should have the Optimizer and SessionRegistry use the same instance. Otherwise in our tests where we simulate multiple nodes  within the same JVM we will have session settings shared across nodes. So our tests won't reflect real-world scenarios.", "url": "https://github.com/crate/crate/pull/9944#discussion_r424412698", "createdAt": "2020-05-13T12:53:37Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/planner/optimizer/LoadedRules.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ * Licensed to Crate under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.  Crate licenses this file\n+ * to you under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ * implied.  See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial\n+ * agreement.\n+ */\n+\n+package io.crate.planner.optimizer;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.CaseFormat;\n+import io.crate.common.collections.Lists2;\n+import io.crate.metadata.settings.session.SessionSetting;\n+import io.crate.metadata.settings.session.SessionSettingProvider;\n+import io.crate.planner.operators.RewriteInsertFromSubQueryToInsertFromValues;\n+import io.crate.planner.optimizer.rule.DeduplicateOrder;\n+import io.crate.planner.optimizer.rule.MergeAggregateAndCollectToCount;\n+import io.crate.planner.optimizer.rule.MergeFilterAndCollect;\n+import io.crate.planner.optimizer.rule.MergeFilters;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathFetchOrEval;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathGroupBy;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathHashJoin;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathNestedLoop;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathOrder;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathProjectSet;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathRename;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathUnion;\n+import io.crate.planner.optimizer.rule.MoveFilterBeneathWindowAgg;\n+import io.crate.planner.optimizer.rule.MoveOrderBeneathFetchOrEval;\n+import io.crate.planner.optimizer.rule.MoveOrderBeneathNestedLoop;\n+import io.crate.planner.optimizer.rule.MoveOrderBeneathRename;\n+import io.crate.planner.optimizer.rule.MoveOrderBeneathUnion;\n+import io.crate.planner.optimizer.rule.RemoveRedundantFetchOrEval;\n+import io.crate.planner.optimizer.rule.RewriteCollectToGet;\n+import io.crate.planner.optimizer.rule.RewriteFilterOnOuterJoinToInnerJoin;\n+import io.crate.planner.optimizer.rule.RewriteGroupByKeysLimitToTopNDistinct;\n+import io.crate.planner.optimizer.rule.RewriteToQueryThenFetch;\n+import io.crate.types.DataTypes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Set;\n+\n+public class LoadedRules implements SessionSettingProvider {\n+\n+    private static final String OPTIMIZER_RULE = \"optimizer_\";\n+\n+    private static final List<Rule<?>> RULES = List.of(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121dd8cb86c8271a7c3e1a9521020a818b979164"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzUwMzc5", "url": "https://github.com/crate/crate/pull/9944#pullrequestreview-413350379", "createdAt": "2020-05-18T07:53:45Z", "commit": {"oid": "4937d31b34e5dd5572ed6f48302993cae7a4e27b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzo1Mzo0NVrOGWrZoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzo1Mzo0NVrOGWrZoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzMjkyOA==", "bodyText": "The idea behind this is, to add more providers for other session settings.", "url": "https://github.com/crate/crate/pull/9944#discussion_r426432928", "createdAt": "2020-05-18T07:53:45Z", "author": {"login": "mkleen"}, "path": "sql/src/main/java/io/crate/metadata/settings/session/SessionSettingModule.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Licensed to Crate under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.  Crate licenses this file\n+ * to you under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ * implied.  See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial\n+ * agreement.\n+ */\n+\n+package io.crate.metadata.settings.session;\n+\n+import io.crate.planner.optimizer.LoadedRules;\n+import org.elasticsearch.common.inject.AbstractModule;\n+import org.elasticsearch.common.inject.multibindings.Multibinder;\n+\n+public class SessionSettingModule extends AbstractModule {\n+\n+    @Override\n+    protected void configure() {\n+        bind(SessionSettingRegistry.class).asEagerSingleton();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4937d31b34e5dd5572ed6f48302993cae7a4e27b"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzczNTU2", "url": "https://github.com/crate/crate/pull/9944#pullrequestreview-413373556", "createdAt": "2020-05-18T08:25:23Z", "commit": {"oid": "4937d31b34e5dd5572ed6f48302993cae7a4e27b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwODoyNToyM1rOGWsiPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwODoyNToyM1rOGWsiPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ1MTUxNg==", "bodyText": "Could the loadedrules.rules(rulesToInclude) call be done on the call-site? The call-site already has both components available. It would have the advantage that the Optimizer could be more easily unit-tested as the dependencies stay smaller.", "url": "https://github.com/crate/crate/pull/9944#discussion_r426451516", "createdAt": "2020-05-18T08:25:23Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/planner/optimizer/Optimizer.java", "diffHunk": "@@ -41,10 +42,15 @@\n \n     private final List<Rule<?>> rules;\n     private final Supplier<Version> minNodeVersionInCluster;\n+    private final Functions functions;\n \n-    public Optimizer(List<Rule<?>> rules, Supplier<Version> minNodeVersionInCluster) {\n-        this.rules = rules;\n+    public Optimizer(Functions functions,\n+                     Supplier<Version> minNodeVersionInCluster,\n+                     LoadedRules loadedRules,\n+                     List<Class<? extends Rule<?>>> rulesToInclude) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4937d31b34e5dd5572ed6f48302993cae7a4e27b"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNDE0MTk3", "url": "https://github.com/crate/crate/pull/9944#pullrequestreview-413414197", "createdAt": "2020-05-18T09:17:38Z", "commit": {"oid": "5dbc0de5a1cb0526e93d7ef5984291a514141507"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwOToxNzozOFrOGWuh7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwOToxNzozOFrOGWuh7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ4NDIwNA==", "bodyText": "@Nomi @infoverload please have a look at this docs contribution.", "url": "https://github.com/crate/crate/pull/9944#discussion_r426484204", "createdAt": "2020-05-18T09:17:38Z", "author": {"login": "mkleen"}, "path": "docs/config/session.rst", "diffHunk": "@@ -105,12 +104,24 @@ Supported session settings\n .. _conf-session-server_version:\n \n **server_version**\n-\n   | *Default:* ``10.5``\n   | *Modifiable:* ``no``\n \n   Shows the emulated ``PostgreSQL`` server version.\n \n+**optimizer**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dbc0de5a1cb0526e93d7ef5984291a514141507"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNDczNTQ1", "url": "https://github.com/crate/crate/pull/9944#pullrequestreview-413473545", "createdAt": "2020-05-18T10:38:54Z", "commit": {"oid": "5dbc0de5a1cb0526e93d7ef5984291a514141507"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5dbc0de5a1cb0526e93d7ef5984291a514141507", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/5dbc0de5a1cb0526e93d7ef5984291a514141507", "committedDate": "2020-05-18T09:15:21Z", "message": "Add documentation for optimizer session setting"}, "afterCommit": {"oid": "d9ab82f3feb9b247387bb9868c84dfdfd2f0b5ac", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/d9ab82f3feb9b247387bb9868c84dfdfd2f0b5ac", "committedDate": "2020-05-18T12:48:09Z", "message": "Add documentation for optimizer session setting"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9ab82f3feb9b247387bb9868c84dfdfd2f0b5ac", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/d9ab82f3feb9b247387bb9868c84dfdfd2f0b5ac", "committedDate": "2020-05-18T12:48:09Z", "message": "Add documentation for optimizer session setting"}, "afterCommit": {"oid": "3b82acf290bb78f2f4cc39773a7006f75a1cb632", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/3b82acf290bb78f2f4cc39773a7006f75a1cb632", "committedDate": "2020-05-18T13:52:28Z", "message": "Add documentation for optimizer session setting"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b82acf290bb78f2f4cc39773a7006f75a1cb632", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/3b82acf290bb78f2f4cc39773a7006f75a1cb632", "committedDate": "2020-05-18T13:52:28Z", "message": "Add documentation for optimizer session setting"}, "afterCommit": {"oid": "effbe61dbe3eae6d7251b9aca17d62e010dc4261", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/effbe61dbe3eae6d7251b9aca17d62e010dc4261", "committedDate": "2020-05-18T14:18:44Z", "message": "Add session basesd optimizer configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "effbe61dbe3eae6d7251b9aca17d62e010dc4261", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/effbe61dbe3eae6d7251b9aca17d62e010dc4261", "committedDate": "2020-05-18T14:18:44Z", "message": "Add session basesd optimizer configuration"}, "afterCommit": {"oid": "d1bcead77a816697d24b31a8d2ba4f0e6a74c8c6", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/d1bcead77a816697d24b31a8d2ba4f0e6a74c8c6", "committedDate": "2020-05-18T14:46:17Z", "message": "Add session basesd optimizer configuration"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d1bcead77a816697d24b31a8d2ba4f0e6a74c8c6", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/d1bcead77a816697d24b31a8d2ba4f0e6a74c8c6", "committedDate": "2020-05-18T14:46:17Z", "message": "Add session basesd optimizer configuration"}, "afterCommit": {"oid": "3f8fddfed7ecbb586b5f16a1beb625b94c9977c2", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/3f8fddfed7ecbb586b5f16a1beb625b94c9977c2", "committedDate": "2020-05-18T14:47:56Z", "message": "Add session setting to configure optimizer rules."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f8fddfed7ecbb586b5f16a1beb625b94c9977c2", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/3f8fddfed7ecbb586b5f16a1beb625b94c9977c2", "committedDate": "2020-05-18T14:47:56Z", "message": "Add session setting to configure optimizer rules."}, "afterCommit": {"oid": "d90676b5fe341b05dce6592fff841101e6752cb5", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/d90676b5fe341b05dce6592fff841101e6752cb5", "committedDate": "2020-05-18T14:49:16Z", "message": "Add session setting to configure optimizer rules."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d90676b5fe341b05dce6592fff841101e6752cb5", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/d90676b5fe341b05dce6592fff841101e6752cb5", "committedDate": "2020-05-18T14:49:16Z", "message": "Add session setting to configure optimizer rules."}, "afterCommit": {"oid": "b7f55cc88f828c23097e4b63df7049a775c24227", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/b7f55cc88f828c23097e4b63df7049a775c24227", "committedDate": "2020-05-18T14:50:53Z", "message": "Add `optimizer` session setting to configure optimizer rules."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7f55cc88f828c23097e4b63df7049a775c24227", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/b7f55cc88f828c23097e4b63df7049a775c24227", "committedDate": "2020-05-18T14:50:53Z", "message": "Add `optimizer` session setting to configure optimizer rules."}, "afterCommit": {"oid": "c3ca28e5f3a9e99dbaf4324990f3a01039394f71", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/c3ca28e5f3a9e99dbaf4324990f3a01039394f71", "committedDate": "2020-05-18T14:55:40Z", "message": "Add `optimizer` session setting to configure query optimizer rules."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3ca28e5f3a9e99dbaf4324990f3a01039394f71", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/c3ca28e5f3a9e99dbaf4324990f3a01039394f71", "committedDate": "2020-05-18T14:55:40Z", "message": "Add `optimizer` session setting to configure query optimizer rules."}, "afterCommit": {"oid": "cd0446915a55f7b39df46ed5c163d42df3e13a21", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/cd0446915a55f7b39df46ed5c163d42df3e13a21", "committedDate": "2020-05-18T14:58:14Z", "message": "Add `optimizer` session setting to configure query optimizer rules."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd0446915a55f7b39df46ed5c163d42df3e13a21", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/cd0446915a55f7b39df46ed5c163d42df3e13a21", "committedDate": "2020-05-18T14:58:14Z", "message": "Add `optimizer` session setting to configure query optimizer rules."}, "afterCommit": {"oid": "fa2297c8c13625516287aa580930d3f3581dc54b", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/fa2297c8c13625516287aa580930d3f3581dc54b", "committedDate": "2020-05-18T17:48:40Z", "message": "Add `optimizer` session setting to configure query optimizer rules."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzODQ5NjA4", "url": "https://github.com/crate/crate/pull/9944#pullrequestreview-413849608", "createdAt": "2020-05-18T18:46:19Z", "commit": {"oid": "fa2297c8c13625516287aa580930d3f3581dc54b"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxODo0NjoxOVrOGXDXtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxODo1NTozNFrOGXDq0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgyNTY1Mw==", "bodyText": "user defined = user-defined", "url": "https://github.com/crate/crate/pull/9944#discussion_r426825653", "createdAt": "2020-05-18T18:46:19Z", "author": {"login": "infoverload"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -69,6 +69,9 @@ None\n Changes\n =======\n \n+- Added the :ref:`optimizer <conf-session-optimizer>` session setting\n+  to configure query optimizer rules.\n+\n - The JavaScript user defined function language is now enabled by default in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa2297c8c13625516287aa580930d3f3581dc54b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgyNTkzMA==", "bodyText": "enterprise edition = Enterprise Edition", "url": "https://github.com/crate/crate/pull/9944#discussion_r426825930", "createdAt": "2020-05-18T18:46:58Z", "author": {"login": "infoverload"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -69,6 +69,9 @@ None\n Changes\n =======\n \n+- Added the :ref:`optimizer <conf-session-optimizer>` session setting\n+  to configure query optimizer rules.\n+\n - The JavaScript user defined function language is now enabled by default in\n   the CrateDB enterprise edition.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa2297c8c13625516287aa580930d3f3581dc54b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgyNzM0NA==", "bodyText": "if = whether", "url": "https://github.com/crate/crate/pull/9944#discussion_r426827344", "createdAt": "2020-05-18T18:49:40Z", "author": {"login": "infoverload"}, "path": "docs/config/session.rst", "diffHunk": "@@ -105,12 +104,26 @@ Supported session settings\n .. _conf-session-server_version:\n \n **server_version**\n-\n   | *Default:* ``10.5``\n   | *Modifiable:* ``no``\n \n   Shows the emulated ``PostgreSQL`` server version.\n \n+.. _conf-session-optimizer:\n+\n+**optimizer**\n+  | *Default:* ``true``\n+  | *Modifiable:* ``yes``\n+\n+  This setting indicates if a query optimizer rule is activated. The name of", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa2297c8c13625516287aa580930d3f3581dc54b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgyNzY0Mg==", "bodyText": "as suffix = as a suffix", "url": "https://github.com/crate/crate/pull/9944#discussion_r426827642", "createdAt": "2020-05-18T18:50:12Z", "author": {"login": "infoverload"}, "path": "docs/config/session.rst", "diffHunk": "@@ -105,12 +104,26 @@ Supported session settings\n .. _conf-session-server_version:\n \n **server_version**\n-\n   | *Default:* ``10.5``\n   | *Modifiable:* ``no``\n \n   Shows the emulated ``PostgreSQL`` server version.\n \n+.. _conf-session-optimizer:\n+\n+**optimizer**\n+  | *Default:* ``true``\n+  | *Modifiable:* ``yes``\n+\n+  This setting indicates if a query optimizer rule is activated. The name of\n+  the query optimizer rule has to be provided as suffix as part of the setting", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa2297c8c13625516287aa580930d3f3581dc54b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgyOTkzMg==", "bodyText": "For consistency, could say:\n\"The :ref:optimizer <conf-session-optimizer> session setting to configure query optimizer rules has been added.", "url": "https://github.com/crate/crate/pull/9944#discussion_r426829932", "createdAt": "2020-05-18T18:54:27Z", "author": {"login": "infoverload"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -69,6 +69,9 @@ None\n Changes\n =======\n \n+- Added the :ref:`optimizer <conf-session-optimizer>` session setting\n+  to configure query optimizer rules.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa2297c8c13625516287aa580930d3f3581dc54b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzMDU0Nw==", "bodyText": "expert = advanced\nbehaviour = behavior", "url": "https://github.com/crate/crate/pull/9944#discussion_r426830547", "createdAt": "2020-05-18T18:55:34Z", "author": {"login": "infoverload"}, "path": "docs/config/session.rst", "diffHunk": "@@ -105,12 +104,26 @@ Supported session settings\n .. _conf-session-server_version:\n \n **server_version**\n-\n   | *Default:* ``10.5``\n   | *Modifiable:* ``no``\n \n   Shows the emulated ``PostgreSQL`` server version.\n \n+.. _conf-session-optimizer:\n+\n+**optimizer**\n+  | *Default:* ``true``\n+  | *Modifiable:* ``yes``\n+\n+  This setting indicates if a query optimizer rule is activated. The name of\n+  the query optimizer rule has to be provided as suffix as part of the setting\n+  e.g. ``SET optimizer_rewrite_collect_to_get = false``.\n+\n+  .. NOTE::\n+   The optimizer setting is for expert use only and can significantly impact\n+   the performance behaviour of the queries.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa2297c8c13625516287aa580930d3f3581dc54b"}, "originalPosition": 30}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa2297c8c13625516287aa580930d3f3581dc54b", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/fa2297c8c13625516287aa580930d3f3581dc54b", "committedDate": "2020-05-18T17:48:40Z", "message": "Add `optimizer` session setting to configure query optimizer rules."}, "afterCommit": {"oid": "532018f44973db74c06c4d297eaa297c02e0c161", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/532018f44973db74c06c4d297eaa297c02e0c161", "committedDate": "2020-05-19T09:29:16Z", "message": "Add `optimizer` session setting to configure query optimizer rules."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "878c458b66950beb8df690a9679d8f29db823758", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/878c458b66950beb8df690a9679d8f29db823758", "committedDate": "2020-05-19T09:36:45Z", "message": "Add `optimizer` session setting to configure query optimizer rules."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "532018f44973db74c06c4d297eaa297c02e0c161", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/532018f44973db74c06c4d297eaa297c02e0c161", "committedDate": "2020-05-19T09:29:16Z", "message": "Add `optimizer` session setting to configure query optimizer rules."}, "afterCommit": {"oid": "878c458b66950beb8df690a9679d8f29db823758", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/878c458b66950beb8df690a9679d8f29db823758", "committedDate": "2020-05-19T09:36:45Z", "message": "Add `optimizer` session setting to configure query optimizer rules."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60cde423517eecfd2a75c0e58c256b48372c3d33", "author": {"user": {"login": "mergify[bot]", "name": null}}, "url": "https://github.com/crate/crate/commit/60cde423517eecfd2a75c0e58c256b48372c3d33", "committedDate": "2020-05-19T10:10:45Z", "message": "Merge branch 'master' into mkleen/optimizer_rules_v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19b7ebbbd94cec554534bbd4d7fab8a5038aaf3c", "author": {"user": {"login": "mergify[bot]", "name": null}}, "url": "https://github.com/crate/crate/commit/19b7ebbbd94cec554534bbd4d7fab8a5038aaf3c", "committedDate": "2020-05-19T10:44:31Z", "message": "Merge branch 'master' into mkleen/optimizer_rules_v2"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3374, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}