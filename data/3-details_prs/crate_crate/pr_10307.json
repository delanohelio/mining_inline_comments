{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyNTU4Nzg4", "number": 10307, "title": "Fix _id value computation for  PK lookups", "bodyText": "Summary of the changes / Why this improves CrateDB\nThe RowShardResolver uses nullOrString to turn all values to a\nstring before computing the final _id value.\nDocKeys#getId insted used DataTypes.STRING.implicitCast.\nDue to this boolean values were treated differently. One used 'true'\nwhile the other used 't', leading to different _id value on primary\nlookups than what was inserted.\nWe cannot change the insert part, because the data has already been\npersisted in many installations, so this changed the lookup instead.\nCloses #10302\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-08-04T06:33:24Z", "url": "https://github.com/crate/crate/pull/10307", "merged": true, "mergeCommit": {"oid": "23dedb0e45f7726e3e23bf662bd17f8fc84fe843"}, "closed": true, "closedAt": "2020-08-04T07:53:33Z", "author": {"login": "mfussenegger"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7gp9AAH2gAyNDYyNTU4Nzg4OmYzYmY3ZTRjZjhhZTg4NmE0YjNlOWNkMWUzNDBkZGYzOTBhZGE2NWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7hqCkAFqTQ2MDU2OTMwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f3bf7e4cf8ae886a4b3e9cd1e340ddf390ada65d", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/f3bf7e4cf8ae886a4b3e9cd1e340ddf390ada65d", "committedDate": "2020-08-04T06:30:24Z", "message": "Fix _id value computation for  PK lookups\n\nThe `RowShardResolver` uses `nullOrString` to turn all values to a\nstring before computing the final `_id` value.\n\n`DocKeys#getId` insted used `DataTypes.STRING.implicitCast`.\n\nDue to this boolean values were treated differently. One used `'true'`\nwhile the other used `'t'`, leading to different `_id` value on primary\nlookups than what was inserted.\n\nWe cannot change the insert part, because the data has already been\npersisted in many installations, so this changed the lookup instead.\n\nCloses https://github.com/crate/crate/issues/10302"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNTMxMjU3", "url": "https://github.com/crate/crate/pull/10307#pullrequestreview-460531257", "createdAt": "2020-08-04T06:34:24Z", "commit": {"oid": "f3bf7e4cf8ae886a4b3e9cd1e340ddf390ada65d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwNjozNDoyNFrOG7S8Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQwNjozNDoyNFrOG7S8Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDgyOTUyNg==", "bodyText": "Lists2.map already includes this optimization", "url": "https://github.com/crate/crate/pull/10307#discussion_r464829526", "createdAt": "2020-08-04T06:34:24Z", "author": {"login": "mfussenegger"}, "path": "server/src/main/java/io/crate/execution/engine/collect/RowShardResolver.java", "diffHunk": "@@ -86,9 +86,6 @@ public void setNextRow(Row row) {\n     }\n \n     private static List<String> pkValues(List<Input<?>> primaryKeyInputs) {\n-        if (primaryKeyInputs.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3bf7e4cf8ae886a4b3e9cd1e340ddf390ada65d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNTY5MzAy", "url": "https://github.com/crate/crate/pull/10307#pullrequestreview-460569302", "createdAt": "2020-08-04T07:40:24Z", "commit": {"oid": "f3bf7e4cf8ae886a4b3e9cd1e340ddf390ada65d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3104, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}