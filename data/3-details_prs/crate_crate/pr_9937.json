{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1OTY3NDgy", "number": 9937, "title": "Integrate es-server into server module", "bodyText": "Summary of the changes / Why this improves CrateDB\nIntegrates es-server into server.\nContinuation of #9934, relates to #9888\nThis will be squashed to a single commit - I kept the individual commits for the review, as I think it's easier to read the changes that way.\nPotential Follow up\n\nChange compile directives in gradle to implementation where possible\nRemove CrateCommonPlugin and SQLPlugin stuff and integrate it into Node\nRemove getSettings from RepositoryPlugin - redundant with TypeSettings / settings on Repository.Factory\nMerge CrateUnitTest and ESTestCase\nRe-introduce a testing module that exposes all testing dependencies\nLots more\n\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-05-11T09:06:36Z", "url": "https://github.com/crate/crate/pull/9937", "merged": true, "mergeCommit": {"oid": "3e7490b0fef082ed3cb8213c7a441129c60fb1ff"}, "closed": true, "closedAt": "2020-05-12T08:53:56Z", "author": {"login": "mfussenegger"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgOncogBqjMzMjI2ODAzNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgf5CcgBqjMzMjYzMjk4MTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1bc5cd8d0c8b80877558c356fdbfa7d4a23de52e", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/1bc5cd8d0c8b80877558c356fdbfa7d4a23de52e", "committedDate": "2020-05-11T09:05:12Z", "message": "Fix SnapshotRestoreIntegrationTest"}, "afterCommit": {"oid": "3378856b59780ef3f25db634865a28f29d06fb2e", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/3378856b59780ef3f25db634865a28f29d06fb2e", "committedDate": "2020-05-11T12:13:14Z", "message": "Move azure related repository analyzer tests to plugin"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66c6a2617e49601ac957b517b011b79be1c7deb3", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/66c6a2617e49601ac957b517b011b79be1c7deb3", "committedDate": "2020-05-11T13:40:18Z", "message": "Fix app and enterprise functions test dependencies"}, "afterCommit": {"oid": "1e1e5421117ec192dc97476992dcafefba80dd55", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/1e1e5421117ec192dc97476992dcafefba80dd55", "committedDate": "2020-05-11T13:42:04Z", "message": "Fix app and enterprise functions test dependencies"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c25ed9a9b72c85cd6e71decde92d0461e6e51609", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/c25ed9a9b72c85cd6e71decde92d0461e6e51609", "committedDate": "2020-05-11T14:48:21Z", "message": "fixup! Fix app and enterprise functions test dependencies"}, "afterCommit": {"oid": "56feb84a548d0764f166fb0797ba419895684e1f", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/56feb84a548d0764f166fb0797ba419895684e1f", "committedDate": "2020-05-11T15:23:57Z", "message": "fixup! Fix app and enterprise functions test dependencies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Nzk2MDQ4", "url": "https://github.com/crate/crate/pull/9937#pullrequestreview-409796048", "createdAt": "2020-05-12T08:05:54Z", "commit": {"oid": "27e33aed126d2a55acb48c16b8d8ee592143d01e"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODowNTo1NFrOGT64Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwODoxMDoyM1rOGT7DAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MDc2Mw==", "bodyText": "Is this actually used?", "url": "https://github.com/crate/crate/pull/9937#discussion_r423540763", "createdAt": "2020-05-12T08:05:54Z", "author": {"login": "seut"}, "path": "server/src/test/java/Dummy.java", "diffHunk": "@@ -0,0 +1,21 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+class Dummy {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27e33aed126d2a55acb48c16b8d8ee592143d01e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MzU1NQ==", "bodyText": "Should this be removed or re-enabled?", "url": "https://github.com/crate/crate/pull/9937#discussion_r423543555", "createdAt": "2020-05-12T08:10:23Z", "author": {"login": "seut"}, "path": "server/src/test/java/io/crate/integrationtests/TransportSQLActionTest.java", "diffHunk": "@@ -1444,34 +1441,33 @@ public void testNumericScriptOnAllTypes() {\n \n     @Test\n     public void testWhereColumnEqColumnAndFunctionEqFunction() throws Exception {\n-        this.setup.setUpLocations();\n-        ensureYellow();\n-        refresh();\n+        execute(\"create table tbl (name text)\");\n+        execute(\"insert into tbl (name) values ('Arthur'), ('Trillian')\");\n+        execute(\"refresh table tbl\");\n \n-        execute(\"select name from locations where name = name\");\n-        assertThat(response.rowCount(), is(13L));\n+        execute(\"select name from tbl where name = name\");\n+        assertThat(response.rowCount(), is(2L));\n \n-        execute(\"select name from locations where substr(name, 1, 1) = substr(name, 1, 1)\");\n-        assertThat(response.rowCount(), is(13L));\n+        execute(\"select name from tbl where substr(name, 1, 1) = substr(name, 1, 1)\");\n+        assertThat(response.rowCount(), is(2L));\n     }\n \n     @Test\n     public void testNewColumn() throws Exception {\n         execute(\"create table t (name string) with (number_of_replicas=0, column_policy = 'dynamic')\");\n-        ensureYellow();\n         execute(\"insert into t (name, score) values ('Ford', 1.2)\");\n     }\n \n     @Test\n     public void testESGetSourceColumns() throws Exception {\n-        this.setup.setUpLocations();\n-        ensureYellow();\n+        execute(\"create table tbl (id int primary key, x int)\");\n+        execute(\"insert into tbl (id, x) values (1, 1), (2, 2), (3, 3)\");\n         refresh();\n \n-        execute(\"select _id, _version from locations where id=2\");\n-        assertNotNull(response.rows()[0][0]);\n-        assertNotNull(response.rows()[0][1]);\n+        execute(\"select _id, _version from tbl where id = 2\");\n+        assertThat(printedTable(response.rows()), is(\"2| 1\\n\"));\n \n+        /*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18162d2e31894c03ca2181e068cf0451fe8ee894"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5989e296b147ffb961f5e804502b12768a493100", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/5989e296b147ffb961f5e804502b12768a493100", "committedDate": "2020-05-12T08:20:49Z", "message": "Integrate es-server into server"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56feb84a548d0764f166fb0797ba419895684e1f", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/56feb84a548d0764f166fb0797ba419895684e1f", "committedDate": "2020-05-11T15:23:57Z", "message": "fixup! Fix app and enterprise functions test dependencies"}, "afterCommit": {"oid": "5989e296b147ffb961f5e804502b12768a493100", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/5989e296b147ffb961f5e804502b12768a493100", "committedDate": "2020-05-12T08:20:49Z", "message": "Integrate es-server into server"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3358, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}