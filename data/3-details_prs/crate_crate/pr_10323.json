{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0NTgwNTY4", "number": 10323, "title": "Expose retention leases in sys.shards ", "bodyText": "Summary of the changes / Why this improves CrateDB\nSee commits\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-08-07T12:35:42Z", "url": "https://github.com/crate/crate/pull/10323", "merged": true, "mergeCommit": {"oid": "85c58c8d840a449a418fd12eac9e973bc5521349"}, "closed": true, "closedAt": "2020-08-10T09:46:28Z", "author": {"login": "mfussenegger"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8jh95gH2gAyNDY0NTgwNTY4OmM4OGM0MGViNTM2ODA1NTM1MmQ0YmRlZTI3OWUyN2ZmMjBlMDI4MzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9e1mzAH2gAyNDY0NTgwNTY4OjYwZjk4NGZjMTAyZmY1ZDk4MDczZjQxZGE5NmUyNjZmNWYyOTgxZTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c88c40eb5368055352d4bdee279e27ff20e02834", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/c88c40eb5368055352d4bdee279e27ff20e02834", "committedDate": "2020-08-07T12:25:19Z", "message": "bp: Expose retention leases in shard stats\n\nhttps://github.com/elastic/elasticsearch/commit/6500b0cbd78a0e3968ecb54a33b59a2325059ff9"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cadbc7bc9ce3fa2b71f667d45d552f4ddb0106b5", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/cadbc7bc9ce3fa2b71f667d45d552f4ddb0106b5", "committedDate": "2020-08-07T12:35:02Z", "message": "WIP: bp: Introduce retention lease actions\n\nhttps://github.com/elastic/elasticsearch/commit/bbe990f86275ed6d696681afc636d940ddf49d26"}, "afterCommit": {"oid": "f57a5483aa9d70710883cca3b3f74114fd5f8578", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/f57a5483aa9d70710883cca3b3f74114fd5f8578", "committedDate": "2020-08-10T07:51:11Z", "message": "WIP: bp: Introduce retention lease actions\n\nhttps://github.com/elastic/elasticsearch/commit/bbe990f86275ed6d696681afc636d940ddf49d26"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f57a5483aa9d70710883cca3b3f74114fd5f8578", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/f57a5483aa9d70710883cca3b3f74114fd5f8578", "committedDate": "2020-08-10T07:51:11Z", "message": "WIP: bp: Introduce retention lease actions\n\nhttps://github.com/elastic/elasticsearch/commit/bbe990f86275ed6d696681afc636d940ddf49d26"}, "afterCommit": {"oid": "7456efd8b1c6d89ed35c36fedf26e2ff1dbf29a9", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/7456efd8b1c6d89ed35c36fedf26e2ff1dbf29a9", "committedDate": "2020-08-10T08:04:52Z", "message": "bp: Introduce retention lease actions\n\nhttps://github.com/elastic/elasticsearch/commit/bbe990f86275ed6d696681afc636d940ddf49d26\n\nThis only contains the `IndexShard` and `RecoverySourceHandler` changes,\nnot the actual actions because they're \"only\" used for CCR in ES."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69a0be7a02517107146b776518ff638c3052ce58", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/69a0be7a02517107146b776518ff638c3052ce58", "committedDate": "2020-08-10T08:26:00Z", "message": "Expose retention leases in sys.shards"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19877ee56f0706c013e8f9e37a8813ebcfb0d920", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/19877ee56f0706c013e8f9e37a8813ebcfb0d920", "committedDate": "2020-08-10T08:26:03Z", "message": "bp: Introduce retention lease actions\n\nhttps://github.com/elastic/elasticsearch/commit/bbe990f86275ed6d696681afc636d940ddf49d26\n\nThis only contains the `IndexShard` and `RecoverySourceHandler` changes,\nnot the actual actions because they're \"only\" used for CCR in ES."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7456efd8b1c6d89ed35c36fedf26e2ff1dbf29a9", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/7456efd8b1c6d89ed35c36fedf26e2ff1dbf29a9", "committedDate": "2020-08-10T08:04:52Z", "message": "bp: Introduce retention lease actions\n\nhttps://github.com/elastic/elasticsearch/commit/bbe990f86275ed6d696681afc636d940ddf49d26\n\nThis only contains the `IndexShard` and `RecoverySourceHandler` changes,\nnot the actual actions because they're \"only\" used for CCR in ES."}, "afterCommit": {"oid": "19877ee56f0706c013e8f9e37a8813ebcfb0d920", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/19877ee56f0706c013e8f9e37a8813ebcfb0d920", "committedDate": "2020-08-10T08:26:03Z", "message": "bp: Introduce retention lease actions\n\nhttps://github.com/elastic/elasticsearch/commit/bbe990f86275ed6d696681afc636d940ddf49d26\n\nThis only contains the `IndexShard` and `RecoverySourceHandler` changes,\nnot the actual actions because they're \"only\" used for CCR in ES."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDQ3MTU5", "url": "https://github.com/crate/crate/pull/10323#pullrequestreview-464047159", "createdAt": "2020-08-10T08:39:51Z", "commit": {"oid": "69a0be7a02517107146b776518ff638c3052ce58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwODozOTo1MVrOG-F5LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwODozOTo1MVrOG-F5LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc2MTQ1Mg==", "bodyText": "getRetentionLeaseStats can return null is it safe to use it like this?", "url": "https://github.com/crate/crate/pull/10323#discussion_r467761452", "createdAt": "2020-08-10T08:39:51Z", "author": {"login": "kovrus"}, "path": "server/src/main/java/io/crate/expression/reference/sys/shard/ShardRowContext.java", "diffHunk": "@@ -349,4 +353,28 @@ public Float recoveryFilesPercent() {\n             ? null\n             : recoveryState.getIndex().recoveredFilesPercent();\n     }\n+\n+    public Long retentionLeasesPrimaryTerm() {\n+        try {\n+            return indexShard.getRetentionLeaseStats().leases().primaryTerm();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69a0be7a02517107146b776518ff638c3052ce58"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDQ3OTQx", "url": "https://github.com/crate/crate/pull/10323#pullrequestreview-464047941", "createdAt": "2020-08-10T08:41:06Z", "commit": {"oid": "19877ee56f0706c013e8f9e37a8813ebcfb0d920"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDU0MDg1", "url": "https://github.com/crate/crate/pull/10323#pullrequestreview-464054085", "createdAt": "2020-08-10T08:50:35Z", "commit": {"oid": "19877ee56f0706c013e8f9e37a8813ebcfb0d920"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MDcxMjA2", "url": "https://github.com/crate/crate/pull/10323#pullrequestreview-464071206", "createdAt": "2020-08-10T09:17:09Z", "commit": {"oid": "19877ee56f0706c013e8f9e37a8813ebcfb0d920"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60f984fc102ff5d98073f41da96e266f5f2981e0", "author": {"user": {"login": "mergify[bot]", "name": null}}, "url": "https://github.com/crate/crate/commit/60f984fc102ff5d98073f41da96e266f5f2981e0", "committedDate": "2020-08-10T09:31:10Z", "message": "Merge branch 'master' into j/retention-lease-stats"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3112, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}