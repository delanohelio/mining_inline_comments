{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MzU4ODk1", "number": 10097, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTo1OTo0NlrOEGrv0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDozMjoxOFrOEGxzeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDQzNjY1OnYy", "diffSide": "RIGHT", "path": "docs/appendices/release-notes/unreleased.rst", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTo1OTo0NlrOGloYYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOTo1OTo0NlrOGloYYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjExMjA5OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              display up to 50 line_numbers, as a larger value is really unnecessary.\n          \n          \n            \n              display up to 50 ``line_numbers`` to avoid buffer pressure at clients and to improve readability.", "url": "https://github.com/crate/crate/pull/10097#discussion_r442112099", "createdAt": "2020-06-18T09:59:46Z", "author": {"login": "seut"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -225,6 +225,9 @@ Performance improvements\n Fixes\n =====\n \n+- Limit the output of COPY FROM RETURN SUMMARY in the presence of errors to\n+  display up to 50 line_numbers, as a larger value is really unnecessary.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7803befcbf32935c2ac53ad7e7db55a0ac7e9f4b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDQ0OTgyOnYy", "diffSide": "RIGHT", "path": "docs/sql/statements/copy-from.rst", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMDowMzo0OFrOGlog2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMDowMzo0OFrOGlog2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjExNDI2NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            |                                       | error occurred, limited to the first 50, for   |               |\n          \n          \n            \n            |                                       | readability.                                   |               |\n          \n          \n            \n            |                                       | error occurred. Limited to the first 50        |               |\n          \n          \n            \n            |                                       | errors, to avoid buffer pressure on clients.   |               |", "url": "https://github.com/crate/crate/pull/10097#discussion_r442114265", "createdAt": "2020-06-18T10:03:48Z", "author": {"login": "seut"}, "path": "docs/sql/statements/copy-from.rst", "diffHunk": "@@ -368,7 +368,8 @@ inserted records.\n | ``errors[ERROR_MSG]['count']``        | The number records failed with this error.     | ``BIGINT``    |\n +---------------------------------------+------------------------------------------------+---------------+\n | ``errors[ERROR_MSG]['line_numbers']`` | The line numbers of the source URI where the   | ``ARRAY``     |\n-|                                       | error occurred.                                |               |\n+|                                       | error occurred, limited to the first 50, for   |               |\n+|                                       | readability.                                   |               |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7803befcbf32935c2ac53ad7e7db55a0ac7e9f4b"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NTM5MzkwOnYy", "diffSide": "RIGHT", "path": "server/src/test/java/io/crate/integrationtests/CopyIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDoyNToxOVrOGlx1bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDoyNToxOVrOGlx1bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI2Njk5MQ==", "bodyText": "Using assertThat is prefered over assertEquals as it returns nicer errors messages. Also the API has clearer definitions of which argument is expected  and which given.\nLooks like using it would also highlight current test failure in a better way ;-)", "url": "https://github.com/crate/crate/pull/10097#discussion_r442266991", "createdAt": "2020-06-18T14:25:19Z", "author": {"login": "seut"}, "path": "server/src/test/java/io/crate/integrationtests/CopyIntegrationTest.java", "diffHunk": "@@ -705,6 +705,42 @@ public void testCopyWithGeneratedPartitionColumnThatIsPartOfPrimaryKey() throws\n         assertThat(response.rowCount(), is(2L));\n     }\n \n+    @Test\n+    public void test_copy_from_return_summary_with_failed_rows_line_numers_limitted_to_50() throws Exception {\n+\n+        execute(\"create table tmp_t1 (v integer)\");\n+        Path tmpDir = newTempDir(LifecycleScope.TEST);\n+        Path target = Files.createDirectories(tmpDir.resolve(\"target\"));\n+        String fileName = \"uzulo.json\";\n+\n+        // two correct inserts\n+        tmpFileWithLines(Arrays.asList(\n+            \"{\\\"v\\\": 100}\",\n+            \"{\\\"v\\\": 200}\"\n+        ), fileName, target);\n+\n+        int numBrokenInserts = 60;\n+        String [] brokenInserts = new String[numBrokenInserts];\n+        for (int i=0; i < numBrokenInserts; i++) {\n+            brokenInserts[i] = String.format(\"{ \\\"v\\\": %d, \\\"bob\\\": 42\", i); // bob is unexpected\n+        }\n+        tmpFileWithLines(Arrays.asList(brokenInserts), fileName, target);\n+\n+        execute(\"copy tmp_t1 from ? return summary\", new Object[]{target.toUri().toString() + \"*\"});\n+\n+        assertThat(printedTable(response.rows()),\n+                   containsString(\"mapping set to strict, dynamic introduction of [bob] within [default] is not allowed\"));\n+\n+        assertEquals(response.rows()[1].length, 5);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8adafd1268f734c2e76b596991ac923952d84f4"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NTQxMzQ0OnYy", "diffSide": "RIGHT", "path": "server/src/test/java/io/crate/integrationtests/CopyIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDoyOToyNFrOGlyBjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDoyOToyNFrOGlyBjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI3MDA5NQ==", "bodyText": "nitpick: the following assertion would already fail if it is missing.", "url": "https://github.com/crate/crate/pull/10097#discussion_r442270095", "createdAt": "2020-06-18T14:29:24Z", "author": {"login": "seut"}, "path": "server/src/test/java/io/crate/integrationtests/CopyIntegrationTest.java", "diffHunk": "@@ -705,6 +705,42 @@ public void testCopyWithGeneratedPartitionColumnThatIsPartOfPrimaryKey() throws\n         assertThat(response.rowCount(), is(2L));\n     }\n \n+    @Test\n+    public void test_copy_from_return_summary_with_failed_rows_line_numers_limitted_to_50() throws Exception {\n+\n+        execute(\"create table tmp_t1 (v integer)\");\n+        Path tmpDir = newTempDir(LifecycleScope.TEST);\n+        Path target = Files.createDirectories(tmpDir.resolve(\"target\"));\n+        String fileName = \"uzulo.json\";\n+\n+        // two correct inserts\n+        tmpFileWithLines(Arrays.asList(\n+            \"{\\\"v\\\": 100}\",\n+            \"{\\\"v\\\": 200}\"\n+        ), fileName, target);\n+\n+        int numBrokenInserts = 60;\n+        String [] brokenInserts = new String[numBrokenInserts];\n+        for (int i=0; i < numBrokenInserts; i++) {\n+            brokenInserts[i] = String.format(\"{ \\\"v\\\": %d, \\\"bob\\\": 42\", i); // bob is unexpected\n+        }\n+        tmpFileWithLines(Arrays.asList(brokenInserts), fileName, target);\n+\n+        execute(\"copy tmp_t1 from ? return summary\", new Object[]{target.toUri().toString() + \"*\"});\n+\n+        assertThat(printedTable(response.rows()),\n+                   containsString(\"mapping set to strict, dynamic introduction of [bob] within [default] is not allowed\"));\n+\n+        assertEquals(response.rows()[1].length, 5);\n+        for (Map<String, Object> mappingError: ((Map<String, Map<String, Object>>) response.rows()[1][4]).values()) {\n+            assertTrue(mappingError.containsKey(\"count\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8adafd1268f734c2e76b596991ac923952d84f4"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NTQyMTEzOnYy", "diffSide": "RIGHT", "path": "server/src/test/java/io/crate/integrationtests/CopyIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDozMDo0M1rOGlyF5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDozMDo0M1rOGlyF5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI3MTIwNw==", "bodyText": "Same nitpick here, I think this is unnecessary.", "url": "https://github.com/crate/crate/pull/10097#discussion_r442271207", "createdAt": "2020-06-18T14:30:43Z", "author": {"login": "seut"}, "path": "server/src/test/java/io/crate/integrationtests/CopyIntegrationTest.java", "diffHunk": "@@ -705,6 +705,42 @@ public void testCopyWithGeneratedPartitionColumnThatIsPartOfPrimaryKey() throws\n         assertThat(response.rowCount(), is(2L));\n     }\n \n+    @Test\n+    public void test_copy_from_return_summary_with_failed_rows_line_numers_limitted_to_50() throws Exception {\n+\n+        execute(\"create table tmp_t1 (v integer)\");\n+        Path tmpDir = newTempDir(LifecycleScope.TEST);\n+        Path target = Files.createDirectories(tmpDir.resolve(\"target\"));\n+        String fileName = \"uzulo.json\";\n+\n+        // two correct inserts\n+        tmpFileWithLines(Arrays.asList(\n+            \"{\\\"v\\\": 100}\",\n+            \"{\\\"v\\\": 200}\"\n+        ), fileName, target);\n+\n+        int numBrokenInserts = 60;\n+        String [] brokenInserts = new String[numBrokenInserts];\n+        for (int i=0; i < numBrokenInserts; i++) {\n+            brokenInserts[i] = String.format(\"{ \\\"v\\\": %d, \\\"bob\\\": 42\", i); // bob is unexpected\n+        }\n+        tmpFileWithLines(Arrays.asList(brokenInserts), fileName, target);\n+\n+        execute(\"copy tmp_t1 from ? return summary\", new Object[]{target.toUri().toString() + \"*\"});\n+\n+        assertThat(printedTable(response.rows()),\n+                   containsString(\"mapping set to strict, dynamic introduction of [bob] within [default] is not allowed\"));\n+\n+        assertEquals(response.rows()[1].length, 5);\n+        for (Map<String, Object> mappingError: ((Map<String, Map<String, Object>>) response.rows()[1][4]).values()) {\n+            assertTrue(mappingError.containsKey(\"count\"));\n+            assertEquals(mappingError.get(\"count\"), (long) numBrokenInserts);\n+            assertTrue(mappingError.containsKey(\"line_numbers\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8adafd1268f734c2e76b596991ac923952d84f4"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NTQyOTA2OnYy", "diffSide": "RIGHT", "path": "docs/appendices/release-notes/unreleased.rst", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDozMjoxOFrOGlyKtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNDo0MTowMlrOGlymjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI3MjQzNw==", "bodyText": "This is kind a breaking change and not a fix or do we plan to backport it?", "url": "https://github.com/crate/crate/pull/10097#discussion_r442272437", "createdAt": "2020-06-18T14:32:18Z", "author": {"login": "seut"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -225,6 +225,9 @@ Performance improvements\n Fixes\n =====\n \n+- Limit the output of COPY FROM RETURN SUMMARY in the presence of errors to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8adafd1268f734c2e76b596991ac923952d84f4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI3NzIxNA==", "bodyText": "I don't know, I suppose it fixes the crash/Admin UI issue, should it be backported?", "url": "https://github.com/crate/crate/pull/10097#discussion_r442277214", "createdAt": "2020-06-18T14:37:55Z", "author": {"login": "marregui"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -225,6 +225,9 @@ Performance improvements\n Fixes\n =====\n \n+- Limit the output of COPY FROM RETURN SUMMARY in the presence of errors to", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI3MjQzNw=="}, "originalCommit": {"oid": "a8adafd1268f734c2e76b596991ac923952d84f4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI3OTU2NA==", "bodyText": "I'd keep it for 4.2 only - no backport", "url": "https://github.com/crate/crate/pull/10097#discussion_r442279564", "createdAt": "2020-06-18T14:41:02Z", "author": {"login": "mfussenegger"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -225,6 +225,9 @@ Performance improvements\n Fixes\n =====\n \n+- Limit the output of COPY FROM RETURN SUMMARY in the presence of errors to", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI3MjQzNw=="}, "originalCommit": {"oid": "a8adafd1268f734c2e76b596991ac923952d84f4"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1417, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}