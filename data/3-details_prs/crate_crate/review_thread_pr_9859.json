{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNjUyMTU3", "number": 9859, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDozODoyM1rODyA5Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDozODoyM1rODyA5Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNzcwMDQzOnYy", "diffSide": "RIGHT", "path": "sql/src/main/java/io/crate/expression/reference/sys/cluster/ClusterLicenseExpression.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDozODoyM1rOGFz2wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMTozMDo1MlrOGF1flg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc0NTY2NQ==", "bodyText": "How does switching from forFunction to constant fix the issue? Is LicenseData mutated?", "url": "https://github.com/crate/crate/pull/9859#discussion_r408745665", "createdAt": "2020-04-15T10:38:23Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/expression/reference/sys/cluster/ClusterLicenseExpression.java", "diffHunk": "@@ -59,15 +57,12 @@ public NestableInput getChild(String name) {\n \n     private void fillChildImplementations(LicenseData licenseData) {\n         if (licenseData != null) {\n-            childImplementations.put(EXPIRY_DATE, forFunction(ignored -> {\n-                if (licenseData.expiryDateInMs() == Long.MAX_VALUE) {\n-                    return null;\n-                } else {\n-                    return licenseData.expiryDateInMs();\n-                }\n-            }));\n-            childImplementations.put(ISSUED_TO, forFunction(ignored -> licenseData.issuedTo()));\n-            childImplementations.put(MAX_NODES, forFunction(ignored -> licenseData.maxNumberOfNodes()));\n+            var expiryDateInMs = licenseData.expiryDateInMs() == Long.MAX_VALUE\n+                ? null\n+                : licenseData.expiryDateInMs();\n+            childImplementations.put(EXPIRY_DATE, constant(expiryDateInMs));\n+            childImplementations.put(ISSUED_TO, constant(licenseData.issuedTo()));\n+            childImplementations.put(MAX_NODES, constant(licenseData.maxNumberOfNodes()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34e14f4421039e290373f8f17cdf2ce038cfe079"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc3MjUwMg==", "bodyText": "The setNextRow is never called for FuncExpression so calling value on child expression will always result in null. I've checked other implementations of NestedObjectExpression they never use forFunction, so I decided to follow this approach.", "url": "https://github.com/crate/crate/pull/9859#discussion_r408772502", "createdAt": "2020-04-15T11:30:52Z", "author": {"login": "kovrus"}, "path": "sql/src/main/java/io/crate/expression/reference/sys/cluster/ClusterLicenseExpression.java", "diffHunk": "@@ -59,15 +57,12 @@ public NestableInput getChild(String name) {\n \n     private void fillChildImplementations(LicenseData licenseData) {\n         if (licenseData != null) {\n-            childImplementations.put(EXPIRY_DATE, forFunction(ignored -> {\n-                if (licenseData.expiryDateInMs() == Long.MAX_VALUE) {\n-                    return null;\n-                } else {\n-                    return licenseData.expiryDateInMs();\n-                }\n-            }));\n-            childImplementations.put(ISSUED_TO, forFunction(ignored -> licenseData.issuedTo()));\n-            childImplementations.put(MAX_NODES, forFunction(ignored -> licenseData.maxNumberOfNodes()));\n+            var expiryDateInMs = licenseData.expiryDateInMs() == Long.MAX_VALUE\n+                ? null\n+                : licenseData.expiryDateInMs();\n+            childImplementations.put(EXPIRY_DATE, constant(expiryDateInMs));\n+            childImplementations.put(ISSUED_TO, constant(licenseData.issuedTo()));\n+            childImplementations.put(MAX_NODES, constant(licenseData.maxNumberOfNodes()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc0NTY2NQ=="}, "originalCommit": {"oid": "34e14f4421039e290373f8f17cdf2ce038cfe079"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1602, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}