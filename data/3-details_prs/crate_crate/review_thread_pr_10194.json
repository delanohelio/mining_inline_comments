{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NzU5OTkw", "number": 10194, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMzoxMjo0OFrOEM43og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDowMDowMVrOEM6HRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxOTUwMTE0OnYy", "diffSide": "RIGHT", "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMzoxMjo0OFrOGvQfXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMzoxMjo0OFrOGvQfXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIwNjQzMA==", "bodyText": "This was the part which had to be adapted for correct deletions.", "url": "https://github.com/crate/crate/pull/10194#discussion_r452206430", "createdAt": "2020-07-09T13:12:48Z", "author": {"login": "mkleen"}, "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -927,24 +930,7 @@ long readSnapshotIndexLatestBlob() throws IOException {\n     }\n \n     private long listBlobsToGetLatestIndexId() throws IOException {\n-        Map<String, BlobMetadata> blobs = blobContainer().listBlobsByPrefix(INDEX_FILE_PREFIX);\n-        long latest = RepositoryData.EMPTY_REPO_GEN;\n-        if (blobs.isEmpty()) {\n-            // no snapshot index blobs have been written yet\n-            return latest;\n-        }\n-        for (final BlobMetadata blobMetadata : blobs.values()) {\n-            final String blobName = blobMetadata.name();\n-            try {\n-                final long curr = Long.parseLong(blobName.substring(INDEX_FILE_PREFIX.length()));\n-                latest = Math.max(latest, curr);\n-            } catch (NumberFormatException nfe) {\n-                // the index- blob wasn't of the format index-N where N is a number,\n-                // no idea what this blob is but it doesn't belong in the repository!\n-                LOGGER.debug(\"[{}] Unknown blob in the repository: {}\", metadata.name(), blobName);\n-            }\n-        }\n-        return latest;\n+        return latestGeneration(blobContainer().listBlobsByPrefix(INDEX_FILE_PREFIX).keySet());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "915fcc8434f21be9ffb1c3e9540ec7e294f7697a"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxOTU0NTAxOnYy", "diffSide": "RIGHT", "path": "blackbox/test_s3.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMzoyMzowMVrOGvQ6XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMzozMTowMFrOGvRPsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIxMzM0MQ==", "bodyText": "Should the client be closed eventually, or is that not necessary?", "url": "https://github.com/crate/crate/pull/10194#discussion_r452213341", "createdAt": "2020-07-09T13:23:01Z", "author": {"login": "mfussenegger"}, "path": "blackbox/test_s3.py", "diffHunk": "@@ -103,6 +107,11 @@ def tearDownClass(cls):\n         crate_node.stop()\n \n     def test_copy_to_s3_copy_from_s3_roundtrip(self):\n+        client = Minio('127.0.0.1:9000',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "542927a0036b0ef2d399abff3179634f7a150268"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIxODgwMA==", "bodyText": "It is not necessary according to https://github.com/minio/minio-py", "url": "https://github.com/crate/crate/pull/10194#discussion_r452218800", "createdAt": "2020-07-09T13:31:00Z", "author": {"login": "mkleen"}, "path": "blackbox/test_s3.py", "diffHunk": "@@ -103,6 +107,11 @@ def tearDownClass(cls):\n         crate_node.stop()\n \n     def test_copy_to_s3_copy_from_s3_roundtrip(self):\n+        client = Minio('127.0.0.1:9000',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIxMzM0MQ=="}, "originalCommit": {"oid": "542927a0036b0ef2d399abff3179634f7a150268"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxOTcwNTAxOnYy", "diffSide": "RIGHT", "path": "docs/appendices/release-notes/unreleased.rst", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDowMDowMVrOGvSftA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDowMDowMVrOGvSftA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIzOTI4NA==", "bodyText": "Maybe clarify that this affected Azure repositories? Or was it also the case for S3?", "url": "https://github.com/crate/crate/pull/10194#discussion_r452239284", "createdAt": "2020-07-09T14:00:01Z", "author": {"login": "mfussenegger"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -268,5 +268,8 @@ Performance improvements\n Fixes\n =====\n \n+- Fixed an issue where :ref:`drop snapshots <ref-drop-snapshot>` would not\n+  delete all the related data.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0826dd7249e9549a5208b1a77f4e6b7b6444f97a"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1327, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}