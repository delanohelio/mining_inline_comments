{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyNDkwMzMy", "number": 10778, "title": "Added dense_rank window function", "bodyText": "Summary of the changes / Why this improves CrateDB\nThis PR adds dense_rank to our supported enterprise window functions. It's similar in function to rank, but the rank is not calculated based on the proceeding peer ranks, so the ranks in dense_rank are sequential. This should address #10508\nI've based it against #10770 because it builds on that, for the sake of clarity. I'll rebase it against master when it is merged.\n@mfussenegger Maybe im being a bit finickity but switching the behaviour of the rank function based on the boolean argument dense strikes me as a little... inelegant? Would an enum be better here? If we wanted to bundle other rank functions like PERCENT_RANK and ROW_NUMBER into it, I suppose an enum would make more sense?\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-11-17T15:18:35Z", "url": "https://github.com/crate/crate/pull/10778", "merged": true, "mergeCommit": {"oid": "822ec0db51a27b252e6d63a558d6a8157f4d7867"}, "closed": true, "closedAt": "2020-11-18T08:36:47Z", "author": {"login": "autophagy"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddbScIgBqjQwMDYwNjI3MDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddpdf5ABqjQwMDkyODI4MjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e81dfee4fe930ceb9a0ad2d3bc50fb76c02df23e", "author": {"user": {"login": "autophagy", "name": "Mika"}}, "url": "https://github.com/crate/crate/commit/e81dfee4fe930ceb9a0ad2d3bc50fb76c02df23e", "committedDate": "2020-11-17T15:10:56Z", "message": "Added dense_rank window function"}, "afterCommit": {"oid": "c4146a199d0cbf4d3279986adba5ee9f9f8415f9", "author": {"user": {"login": "autophagy", "name": "Mika"}}, "url": "https://github.com/crate/crate/commit/c4146a199d0cbf4d3279986adba5ee9f9f8415f9", "committedDate": "2020-11-17T15:27:41Z", "message": "Added dense_rank window function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTI2MTkx", "url": "https://github.com/crate/crate/pull/10778#pullrequestreview-532526191", "createdAt": "2020-11-17T16:02:17Z", "commit": {"oid": "5a04c891d352ede5d225442ca0e3d0844ba46690"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjowMjoxN1rOH08iKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjowMjoxN1rOH08iKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI3OTc4Nw==", "bodyText": "Looks like this could be final ?", "url": "https://github.com/crate/crate/pull/10778#discussion_r525279787", "createdAt": "2020-11-17T16:02:17Z", "author": {"login": "mfussenegger"}, "path": "enterprise/functions/src/main/java/io/crate/window/RankFunctions.java", "diffHunk": "@@ -28,20 +28,28 @@\n import io.crate.types.DataTypes;\n \n import java.util.List;\n+import java.util.function.IntUnaryOperator;\n \n \n public class RankFunctions implements WindowFunction {\n \n     private static final String RANK_NAME = \"rank\";\n+    private static final String DENSE_RANK_NAME = \"dense_rank\";\n \n     private final Signature signature;\n     private final Signature boundSignature;\n-    private int seenLastUpperBound;\n+    private int seenLastUpperBound = -1;\n     private int rank;\n+    private IntUnaryOperator rankIncrementor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a04c891d352ede5d225442ca0e3d0844ba46690"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTc5MzM1", "url": "https://github.com/crate/crate/pull/10778#pullrequestreview-532579335", "createdAt": "2020-11-17T16:53:27Z", "commit": {"oid": "d7ecbed7f32f67b96165dc15a3d688b26b74aa07"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjE0MjU5", "url": "https://github.com/crate/crate/pull/10778#pullrequestreview-532614259", "createdAt": "2020-11-17T17:26:34Z", "commit": {"oid": "d7ecbed7f32f67b96165dc15a3d688b26b74aa07"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoyNjozNFrOH1AqNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNzoyNjozNFrOH1AqNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0NzM4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            .. note::\n          \n          \n            \n            .. NOTE::", "url": "https://github.com/crate/crate/pull/10778#discussion_r525347381", "createdAt": "2020-11-17T17:26:34Z", "author": {"login": "norosa"}, "path": "docs/general/builtins/window-functions.rst", "diffHunk": "@@ -658,6 +658,59 @@ Example::\n     +-----------------+---------------+--------+-------------+\n     SELECT 6 rows in set (... sec)\n \n+\n+.. _window-function-dense_rank:\n+\n+``dense_rank()``\n+----------------\n+\n+.. note::", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7ecbed7f32f67b96165dc15a3d688b26b74aa07"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7ecbed7f32f67b96165dc15a3d688b26b74aa07", "author": {"user": {"login": "autophagy", "name": "Mika"}}, "url": "https://github.com/crate/crate/commit/d7ecbed7f32f67b96165dc15a3d688b26b74aa07", "committedDate": "2020-11-17T16:20:14Z", "message": "fixup! fixup! Added dense_rank window function"}, "afterCommit": {"oid": "8d429a72b68bcc3e726e7e9c73dace1c8bef0186", "author": {"user": {"login": "autophagy", "name": "Mika"}}, "url": "https://github.com/crate/crate/commit/8d429a72b68bcc3e726e7e9c73dace1c8bef0186", "committedDate": "2020-11-17T22:25:35Z", "message": "Added dense_rank window function"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d429a72b68bcc3e726e7e9c73dace1c8bef0186", "author": {"user": {"login": "autophagy", "name": "Mika"}}, "url": "https://github.com/crate/crate/commit/8d429a72b68bcc3e726e7e9c73dace1c8bef0186", "committedDate": "2020-11-17T22:25:35Z", "message": "Added dense_rank window function"}, "afterCommit": {"oid": "2a9f07de63a88bab343838c74a1b7315beb55650", "author": {"user": {"login": "autophagy", "name": "Mika"}}, "url": "https://github.com/crate/crate/commit/2a9f07de63a88bab343838c74a1b7315beb55650", "committedDate": "2020-11-17T22:27:00Z", "message": "Added dense_rank window function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dc9826d2e1bff1e225bd5d4255d024cb16c2541", "author": {"user": {"login": "autophagy", "name": "Mika"}}, "url": "https://github.com/crate/crate/commit/2dc9826d2e1bff1e225bd5d4255d024cb16c2541", "committedDate": "2020-11-18T07:58:33Z", "message": "Added dense_rank window function"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a9f07de63a88bab343838c74a1b7315beb55650", "author": {"user": {"login": "autophagy", "name": "Mika"}}, "url": "https://github.com/crate/crate/commit/2a9f07de63a88bab343838c74a1b7315beb55650", "committedDate": "2020-11-17T22:27:00Z", "message": "Added dense_rank window function"}, "afterCommit": {"oid": "2dc9826d2e1bff1e225bd5d4255d024cb16c2541", "author": {"user": {"login": "autophagy", "name": "Mika"}}, "url": "https://github.com/crate/crate/commit/2dc9826d2e1bff1e225bd5d4255d024cb16c2541", "committedDate": "2020-11-18T07:58:33Z", "message": "Added dense_rank window function"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3641, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}