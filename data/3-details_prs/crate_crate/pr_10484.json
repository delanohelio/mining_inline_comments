{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NDI5NDM0", "number": 10484, "title": "Backport ES changes", "bodyText": "Summary of the changes / Why this improves CrateDB\nSee commits\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-09-03T07:43:27Z", "url": "https://github.com/crate/crate/pull/10484", "merged": true, "mergeCommit": {"oid": "a126c7a93118743aff4b45fd3d24a3d4d941f9c6"}, "closed": true, "closedAt": "2020-09-03T12:51:48Z", "author": {"login": "mfussenegger"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFNUiHgFqTQ4MTY2MjIwMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFPoc6gBqjM3MjQ0MjgzMTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNjYyMjAw", "url": "https://github.com/crate/crate/pull/10484#pullrequestreview-481662200", "createdAt": "2020-09-03T09:29:24Z", "commit": {"oid": "8e8d07c5d4101198845872e943ca8901f0b7696d"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwOToyOToyNVrOHMeOhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwOTozMDo0MFrOHMeRqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg0MDE5OA==", "bodyText": "Why don't we keep the note related to soft-deletes?", "url": "https://github.com/crate/crate/pull/10484#discussion_r482840198", "createdAt": "2020-09-03T09:29:25Z", "author": {"login": "seut"}, "path": "server/src/main/java/org/elasticsearch/index/IndexSettings.java", "diffHunk": "@@ -193,6 +176,24 @@\n     public static final Setting<Long> INDEX_SOFT_DELETES_RETENTION_OPERATIONS_SETTING =\n         Setting.longSetting(\"index.soft_deletes.retention.operations\", 0, 0, Property.IndexScope, Property.Dynamic);\n \n+    /**\n+     * Controls how long translog files that are no longer needed for persistence reasons\n+     * will be kept around before being deleted. A longer retention policy is useful to increase\n+     * the chance of ops based recoveries.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8d07c5d4101198845872e943ca8901f0b7696d"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjg0MTAwMA==", "bodyText": "Same here, afaik the note related to soft-deletes is worth mentioning even that we do not yet enable soft-deletes by default. Otherwise we may miss adding these notes later on.", "url": "https://github.com/crate/crate/pull/10484#discussion_r482841000", "createdAt": "2020-09-03T09:30:40Z", "author": {"login": "seut"}, "path": "server/src/main/java/org/elasticsearch/index/IndexSettings.java", "diffHunk": "@@ -193,6 +176,24 @@\n     public static final Setting<Long> INDEX_SOFT_DELETES_RETENTION_OPERATIONS_SETTING =\n         Setting.longSetting(\"index.soft_deletes.retention.operations\", 0, 0, Property.IndexScope, Property.Dynamic);\n \n+    /**\n+     * Controls how long translog files that are no longer needed for persistence reasons\n+     * will be kept around before being deleted. A longer retention policy is useful to increase\n+     * the chance of ops based recoveries.\n+     **/\n+    public static final Setting<TimeValue> INDEX_TRANSLOG_RETENTION_AGE_SETTING =\n+        Setting.timeSetting(\"index.translog.retention.age\", TimeValue.timeValueHours(12), TimeValue.timeValueMillis(-1), Property.Dynamic,\n+            Property.IndexScope);\n+\n+    /**\n+     * Controls how many translog files that are no longer needed for persistence reasons\n+     * will be kept around before being deleted. Keeping more files is useful to increase\n+     * the chance of ops based recoveries.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e8d07c5d4101198845872e943ca8901f0b7696d"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff96dbad7265a586c4bcf8f2abf105d832064411", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/ff96dbad7265a586c4bcf8f2abf105d832064411", "committedDate": "2020-09-03T11:49:40Z", "message": "bp: Remove fileBasedRecovery flag\n\nhttps://github.com/elastic/elasticsearch/commit/6215f98fa68aedbd8f0be10e0064afb45c970e90"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66962fc387de031ac701ecc69007852e3d62ef1c", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/66962fc387de031ac701ecc69007852e3d62ef1c", "committedDate": "2020-09-03T11:49:40Z", "message": "bp: Trim local translog in peer recovery\n\nhttps://github.com/elastic/elasticsearch/commit/302d29c87059658f776fb9c22bc76362bd46d0a0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7e380a348d168d69f59c0c08b3d202629b0f0ac", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/c7e380a348d168d69f59c0c08b3d202629b0f0ac", "committedDate": "2020-09-03T11:49:40Z", "message": "bp: Remove assertion after locally recover replica\n\nhttps://github.com/elastic/elasticsearch/commit/6bb6927151ca7627837e5978e63694507244f3ff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d538943572c1a73e2e6ede7ad8e5452ce15a4ca", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/7d538943572c1a73e2e6ede7ad8e5452ce15a4ca", "committedDate": "2020-09-03T11:49:40Z", "message": "bp: Call afterWriteOperation after trim translog in peer recovery\n\nhttps://github.com/elastic/elasticsearch/commit/c26f850c4434621fd385b55e90d57270df30e54b"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d88dd46421a729baa811732189aec4c9133004ba", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/d88dd46421a729baa811732189aec4c9133004ba", "committedDate": "2020-09-03T11:49:40Z", "message": "bp: Only retain reasonable history for peer recoveries\n\nhttps://github.com/elastic/elasticsearch/commit/fd4acb3e8b7cc88a10ae5c922a62cea719b1c701\n\nSome of the changes - especially in CombinedDeletionPolicy - were\nalready applied as part of https://github.com/crate/crate/commit/dfed1ca79cde0ecfb79e0aa16eca41bf597bfe19\n\nThere we also already pulled in pieces of\nhttps://github.com/elastic/elasticsearch/commit/71a6873e8928f882bd06122f421a586fa6b85f09\nwhich is why our CombinedDeletionPolicy differs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3952c47b97cdce74f7feb137dbe18f3f9656a698", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/3952c47b97cdce74f7feb137dbe18f3f9656a698", "committedDate": "2020-09-03T11:49:40Z", "message": "bp: Set start of the week to Monday for root locale\n\nhttps://github.com/elastic/elasticsearch/commit/8d1ea8651976c40100df65cd58f26cb00325de96"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e8d07c5d4101198845872e943ca8901f0b7696d", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/8e8d07c5d4101198845872e943ca8901f0b7696d", "committedDate": "2020-09-03T08:45:17Z", "message": "bp: Ignore translog retention policy if soft-deletes enabled\n\nhttps://github.com/elastic/elasticsearch/commit/b0d346fd7421bf9c470b8cda56f134b10e726d33"}, "afterCommit": {"oid": "f1ba34423e07b718cdff02e57dafac39f0c72562", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/f1ba34423e07b718cdff02e57dafac39f0c72562", "committedDate": "2020-09-03T11:49:40Z", "message": "bp: Ignore translog retention policy if soft-deletes enabled\n\nhttps://github.com/elastic/elasticsearch/commit/b0d346fd7421bf9c470b8cda56f134b10e726d33"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39ca1421687f36582529f8edae2fed3f3641cda2", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/39ca1421687f36582529f8edae2fed3f3641cda2", "committedDate": "2020-09-03T12:19:30Z", "message": "bp: Ignore translog retention policy if soft-deletes enabled\n\nhttps://github.com/elastic/elasticsearch/commit/b0d346fd7421bf9c470b8cda56f134b10e726d33"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1ba34423e07b718cdff02e57dafac39f0c72562", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/f1ba34423e07b718cdff02e57dafac39f0c72562", "committedDate": "2020-09-03T11:49:40Z", "message": "bp: Ignore translog retention policy if soft-deletes enabled\n\nhttps://github.com/elastic/elasticsearch/commit/b0d346fd7421bf9c470b8cda56f134b10e726d33"}, "afterCommit": {"oid": "39ca1421687f36582529f8edae2fed3f3641cda2", "author": {"user": {"login": "mfussenegger", "name": "Mathias Fu\u00dfenegger"}}, "url": "https://github.com/crate/crate/commit/39ca1421687f36582529f8edae2fed3f3641cda2", "committedDate": "2020-09-03T12:19:30Z", "message": "bp: Ignore translog retention policy if soft-deletes enabled\n\nhttps://github.com/elastic/elasticsearch/commit/b0d346fd7421bf9c470b8cda56f134b10e726d33"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3051, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}