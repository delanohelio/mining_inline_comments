{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5MDU4MjIz", "number": 9601, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwODozMjo1OFrODcKkxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMDo0NDowNFrODclstw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwODU5OTc1OnYy", "diffSide": "RIGHT", "path": "sql-parser/src/main/java/io/crate/sql/tree/Insert.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwODozMjo1OFrOFkEWlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQwODo1MjoxMVrOFkExaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM2NDM3Mw==", "bodyText": "Could Insert and InsertFromSubquery merged into one class ?  Looks like everywhere InsertFromSubquery is used.", "url": "https://github.com/crate/crate/pull/9601#discussion_r373364373", "createdAt": "2020-01-31T08:32:58Z", "author": {"login": "mkleen"}, "path": "sql-parser/src/main/java/io/crate/sql/tree/Insert.java", "diffHunk": "@@ -31,11 +31,16 @@\n     protected final Table<T> table;\n     private final DuplicateKeyContext<T> duplicateKeyContext;\n     protected final List<String> columns;\n+    protected final List<SelectItem> returning;\n \n-    Insert(Table<T> table, List<String> columns, DuplicateKeyContext<T> duplicateKeyContext) {\n+    Insert(Table<T> table,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "80c97d77ec14300b936d4c12c046a5da803eb84d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM3MTI0MQ==", "bodyText": "Yes we should do that. Could you follow up on that against master before continueing with this here?", "url": "https://github.com/crate/crate/pull/9601#discussion_r373371241", "createdAt": "2020-01-31T08:52:11Z", "author": {"login": "mfussenegger"}, "path": "sql-parser/src/main/java/io/crate/sql/tree/Insert.java", "diffHunk": "@@ -31,11 +31,16 @@\n     protected final Table<T> table;\n     private final DuplicateKeyContext<T> duplicateKeyContext;\n     protected final List<String> columns;\n+    protected final List<SelectItem> returning;\n \n-    Insert(Table<T> table, List<String> columns, DuplicateKeyContext<T> duplicateKeyContext) {\n+    Insert(Table<T> table,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM2NDM3Mw=="}, "originalCommit": {"oid": "80c97d77ec14300b936d4c12c046a5da803eb84d"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMjkwNzM3OnYy", "diffSide": "RIGHT", "path": "sql-parser/src/main/antlr/SqlBase.g4", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMDowMDoyN1rOFkr4Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMToyNzowMFrOFkuROQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxMTk5NQ==", "bodyText": "minor note: maybe instead of going with the returning rule, we can better introduce the selectItems rule that we can re-use in few places. Then we would avoid this special handling of the rule context, namely getReturningItems, and can reuse visitCollection without null checks, etc.  imho, going for the more common selectItems denominator gives a bit more beneficial.\notherwise, lgtm", "url": "https://github.com/crate/crate/pull/9601#discussion_r374011995", "createdAt": "2020-02-03T10:00:27Z", "author": {"login": "kovrus"}, "path": "sql-parser/src/main/antlr/SqlBase.g4", "diffHunk": "@@ -139,6 +140,10 @@ where\n     : WHERE condition=booleanExpression\n     ;\n \n+returning\n+    : RETURNING selectItem (',' selectItem)*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a29d155350f59b4f0fea0583167adef0a012a134"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNzg5Mw==", "bodyText": "Thanks for the feedback. Do you mean something like this:\nINSERT INTO table ('(' ident (',' ident)* ')')? insertSource\n        onConflict?\n        (RETURNING selectItems)?   \n\nselectItems\n    : selectItem (',' selectItem)*\n    ;", "url": "https://github.com/crate/crate/pull/9601#discussion_r374017893", "createdAt": "2020-02-03T10:12:49Z", "author": {"login": "mkleen"}, "path": "sql-parser/src/main/antlr/SqlBase.g4", "diffHunk": "@@ -139,6 +140,10 @@ where\n     : WHERE condition=booleanExpression\n     ;\n \n+returning\n+    : RETURNING selectItem (',' selectItem)*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxMTk5NQ=="}, "originalCommit": {"oid": "a29d155350f59b4f0fea0583167adef0a012a134"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxOTcwMg==", "bodyText": "yes, ah but actually it probably won't work as i thought coz of the optional (RETURNING selectItems)?, so just ignore the comment", "url": "https://github.com/crate/crate/pull/9601#discussion_r374019702", "createdAt": "2020-02-03T10:16:32Z", "author": {"login": "kovrus"}, "path": "sql-parser/src/main/antlr/SqlBase.g4", "diffHunk": "@@ -139,6 +140,10 @@ where\n     : WHERE condition=booleanExpression\n     ;\n \n+returning\n+    : RETURNING selectItem (',' selectItem)*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxMTk5NQ=="}, "originalCommit": {"oid": "a29d155350f59b4f0fea0583167adef0a012a134"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1MTEyOQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/crate/crate/pull/9601#discussion_r374051129", "createdAt": "2020-02-03T11:27:00Z", "author": {"login": "mkleen"}, "path": "sql-parser/src/main/antlr/SqlBase.g4", "diffHunk": "@@ -139,6 +140,10 @@ where\n     : WHERE condition=booleanExpression\n     ;\n \n+returning\n+    : RETURNING selectItem (',' selectItem)*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxMTk5NQ=="}, "originalCommit": {"oid": "a29d155350f59b4f0fea0583167adef0a012a134"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMzA0Mzc1OnYy", "diffSide": "RIGHT", "path": "sql-parser/src/main/antlr/SqlBase.g4", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMDo0NDowNFrOFktI_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxMTo0NjozNlrOFkuvtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAzMjYzOA==", "bodyText": "The indentation here looks way off?", "url": "https://github.com/crate/crate/pull/9601#discussion_r374032638", "createdAt": "2020-02-03T10:44:04Z", "author": {"login": "mfussenegger"}, "path": "sql-parser/src/main/antlr/SqlBase.g4", "diffHunk": "@@ -40,7 +40,7 @@ statement\n     | UPDATE aliasedRelation\n         SET assignment (',' assignment)*\n         where?\n-        (RETURNING selectItem (',' selectItem)*)?      \t\t\t\t\t\t\t\t\t\t\t\t\t \t   #update\n+        returning?      \t\t\t\t\t\t\t\t                             #update", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a29d155350f59b4f0fea0583167adef0a012a134"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1MDgwMA==", "bodyText": "Would\nUPDATE aliasedRelation SET assignment (',' assignment)* where? returning?\nthe way to go ?", "url": "https://github.com/crate/crate/pull/9601#discussion_r374050800", "createdAt": "2020-02-03T11:26:13Z", "author": {"login": "mkleen"}, "path": "sql-parser/src/main/antlr/SqlBase.g4", "diffHunk": "@@ -40,7 +40,7 @@ statement\n     | UPDATE aliasedRelation\n         SET assignment (',' assignment)*\n         where?\n-        (RETURNING selectItem (',' selectItem)*)?      \t\t\t\t\t\t\t\t\t\t\t\t\t \t   #update\n+        returning?      \t\t\t\t\t\t\t\t                             #update", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAzMjYzOA=="}, "originalCommit": {"oid": "a29d155350f59b4f0fea0583167adef0a012a134"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA1ODkzMw==", "bodyText": "Ah sorry should have been more specific. It was related to the extra whitespace before the #update (all the others were aligned)", "url": "https://github.com/crate/crate/pull/9601#discussion_r374058933", "createdAt": "2020-02-03T11:46:36Z", "author": {"login": "mfussenegger"}, "path": "sql-parser/src/main/antlr/SqlBase.g4", "diffHunk": "@@ -40,7 +40,7 @@ statement\n     | UPDATE aliasedRelation\n         SET assignment (',' assignment)*\n         where?\n-        (RETURNING selectItem (',' selectItem)*)?      \t\t\t\t\t\t\t\t\t\t\t\t\t \t   #update\n+        returning?      \t\t\t\t\t\t\t\t                             #update", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAzMjYzOA=="}, "originalCommit": {"oid": "a29d155350f59b4f0fea0583167adef0a012a134"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1162, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}