{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NDgyOTM1", "number": 10087, "title": "Re-enable IAM Roles for s3 repositories (bp #10071)", "bodyText": "This is an automated backport of pull request #10071 done by Mergify\nCherry-pick of 5a668e1 has failed:\nOn branch mergify/bp/4.1/pr-10071\nYour branch is up to date with 'origin/4.1'.\n\nYou are currently cherry-picking commit 5a668e15a3.\n  (fix conflicts and run \"git cherry-pick --continue\")\n  (use \"git cherry-pick --abort\" to cancel the cherry-pick operation)\n\nChanges to be committed:\n\n\tmodified:   docs/appendices/release-notes/unreleased.rst\n\tmodified:   es/es-repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java\n\tnew file:   server/src/main/java/io/crate/exceptions/InvalidArgumentException.java\n\nUnmerged paths:\n  (use \"git add/rm <file>...\" as appropriate to mark resolution)\n\n\tdeleted by us:   plugins/es-repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java\n\tdeleted by us:   plugins/es-repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java\n\tdeleted by us:   plugins/es-repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Service.java\n\tdeleted by us:   plugins/es-repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryPluginAnalyzerTest.java\n\n\nTo fixup this pull request, you can check out it locally. See documentation: https://help.github.com/articles/checking-out-pull-requests-locally/\n\nMergify commands and options\n\nMore conditions and actions can be found in the documentation.\nYou can also trigger Mergify actions by commenting on this pull request:\n\n@Mergifyio refresh will re-evaluate the rules\n@Mergifyio rebase will rebase this PR on its base branch\n@Mergifyio update will merge the base branch into this PR\n@Mergifyio backport <destination> will backport this PR on <destination> branch\n\nAdditionally, on Mergify dashboard you can:\n\nlook at your merge queues\ngenerate the Mergify configuration with the simulator.\n\nFinally, you can contact us on https://mergify.io/", "createdAt": "2020-06-16T21:45:13Z", "url": "https://github.com/crate/crate/pull/10087", "merged": true, "mergeCommit": {"oid": "12d7f66e6391e4985a1bee898b0ec505c143da56"}, "closed": true, "closedAt": "2020-06-17T14:54:36Z", "author": {"login": "mergify"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsGYFMgBqjM0NTI2ODAwMTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsKvj6gFqTQzMjQ2MjAwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f9e24ba43673bae241ccef879c250f4a1e153741", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/f9e24ba43673bae241ccef879c250f4a1e153741", "committedDate": "2020-06-17T09:19:07Z", "message": "Adapt iam roles fix to 4.1 structure"}, "afterCommit": {"oid": "f9bb70a1021eed6ae17c1ffcce0edaf343f07c48", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/f9bb70a1021eed6ae17c1ffcce0edaf343f07c48", "committedDate": "2020-06-17T09:24:20Z", "message": "Adapt iam roles fix to 4.1 structure"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f9bb70a1021eed6ae17c1ffcce0edaf343f07c48", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/f9bb70a1021eed6ae17c1ffcce0edaf343f07c48", "committedDate": "2020-06-17T09:24:20Z", "message": "Adapt iam roles fix to 4.1 structure"}, "afterCommit": {"oid": "b6d84f8ae0d72f1c24e1a54d9b1a4bbb1b5e8604", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/b6d84f8ae0d72f1c24e1a54d9b1a4bbb1b5e8604", "committedDate": "2020-06-17T09:32:24Z", "message": "Adapt iam roles fix to 4.1 structure"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6d84f8ae0d72f1c24e1a54d9b1a4bbb1b5e8604", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/b6d84f8ae0d72f1c24e1a54d9b1a4bbb1b5e8604", "committedDate": "2020-06-17T09:32:24Z", "message": "Adapt iam roles fix to 4.1 structure"}, "afterCommit": {"oid": "6388257c70be0d83a4963732a711579ede61c04c", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/6388257c70be0d83a4963732a711579ede61c04c", "committedDate": "2020-06-17T09:37:34Z", "message": "Adapt iam roles fix to 4.1 structure"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "44a34178825387a61730ccdbc2c810ac1bc7dcec", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/44a34178825387a61730ccdbc2c810ac1bc7dcec", "committedDate": "2020-06-17T12:38:11Z", "message": "Merge branch 'mergify/bp/4.1/pr-10071' of github.com:crate/crate into mergify/bp/4.1/pr-10071"}, "afterCommit": {"oid": "8e93c8a524055f4c9651bf3adc5d00a74bd43c05", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/8e93c8a524055f4c9651bf3adc5d00a74bd43c05", "committedDate": "2020-06-17T12:42:05Z", "message": "Fix exception handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMzc1NzI5", "url": "https://github.com/crate/crate/pull/10087#pullrequestreview-432375729", "createdAt": "2020-06-17T13:01:32Z", "commit": {"oid": "8e93c8a524055f4c9651bf3adc5d00a74bd43c05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzowMTozMlrOGlEn6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzowMTozMlrOGlEn6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUyNjI1MA==", "bodyText": "I use a ElasticsearchException instead of a CrateException, because in 4.1 the crate packages are not available.", "url": "https://github.com/crate/crate/pull/10087#discussion_r441526250", "createdAt": "2020-06-17T13:01:32Z", "author": {"login": "mkleen"}, "path": "es/es-server/src/main/java/org/elasticsearch/repositories/blobstore/InvalidArgumentException.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Licensed to Crate under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.  Crate licenses this file\n+ * to you under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ * implied.  See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial\n+ * agreement.\n+ */\n+\n+package org.elasticsearch.repositories.blobstore;\n+\n+import org.elasticsearch.ElasticsearchException;\n+\n+public class InvalidArgumentException extends ElasticsearchException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e93c8a524055f4c9651bf3adc5d00a74bd43c05"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMzc2Mjkx", "url": "https://github.com/crate/crate/pull/10087#pullrequestreview-432376291", "createdAt": "2020-06-17T13:02:06Z", "commit": {"oid": "8e93c8a524055f4c9651bf3adc5d00a74bd43c05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzowMjowN1rOGlEpbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxMzowMjowN1rOGlEpbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUyNjYzOQ==", "bodyText": "This will result correctly in a 4000 error as it does in master (now).", "url": "https://github.com/crate/crate/pull/10087#discussion_r441526639", "createdAt": "2020-06-17T13:02:07Z", "author": {"login": "mkleen"}, "path": "sql/src/main/java/io/crate/exceptions/SQLExceptions.java", "diffHunk": "@@ -225,6 +226,9 @@ private static Throwable esToCrateException(Throwable unwrappedError) {\n         } else if (unwrappedError instanceof SnapshotCreationException) {\n             SnapshotCreationException creationException = (SnapshotCreationException) unwrappedError;\n             return new SnapshotAlreadyExistsException(creationException.getRepositoryName(), creationException.getSnapshotName());\n+        } else if (unwrappedError instanceof InvalidArgumentException) {\n+            var invalidArgument = (InvalidArgumentException) unwrappedError;\n+            return new SQLParseException(invalidArgument.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e93c8a524055f4c9651bf3adc5d00a74bd43c05"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMzgzMzMz", "url": "https://github.com/crate/crate/pull/10087#pullrequestreview-432383333", "createdAt": "2020-06-17T13:10:16Z", "commit": {"oid": "8e93c8a524055f4c9651bf3adc5d00a74bd43c05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e93c8a524055f4c9651bf3adc5d00a74bd43c05", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/8e93c8a524055f4c9651bf3adc5d00a74bd43c05", "committedDate": "2020-06-17T12:42:05Z", "message": "Fix exception handling"}, "afterCommit": {"oid": "659d2c89fd06d5eefdaafa32f0320985d603cb55", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/659d2c89fd06d5eefdaafa32f0320985d603cb55", "committedDate": "2020-06-17T13:23:52Z", "message": "Add documentation for iam roles\n\n(cherry picked from commit 1a72fd9cc15a3279cbe45c1f992eeea57bc4b485)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64059bd8b68b98f2b44465081e70b586aa98a901", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/64059bd8b68b98f2b44465081e70b586aa98a901", "committedDate": "2020-06-17T14:16:56Z", "message": "Re-enable IAM Roles for s3 repositories\n\n(cherry picked from commit 5a668e15a34c5207d9dfa7a549ff38c32aa20511)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03100c7cc6cf0cf2239ab606e91c55fde0f576cf", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/03100c7cc6cf0cf2239ab606e91c55fde0f576cf", "committedDate": "2020-06-17T14:16:56Z", "message": "Add documentation for iam roles\n\n(cherry picked from commit 1a72fd9cc15a3279cbe45c1f992eeea57bc4b485)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e90d5c1417eafb6eb8e16044f22d033836b5aeb", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/1e90d5c1417eafb6eb8e16044f22d033836b5aeb", "committedDate": "2020-06-17T13:58:21Z", "message": "Remove invalid test"}, "afterCommit": {"oid": "03100c7cc6cf0cf2239ab606e91c55fde0f576cf", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/03100c7cc6cf0cf2239ab606e91c55fde0f576cf", "committedDate": "2020-06-17T14:16:56Z", "message": "Add documentation for iam roles\n\n(cherry picked from commit 1a72fd9cc15a3279cbe45c1f992eeea57bc4b485)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDYyMDA0", "url": "https://github.com/crate/crate/pull/10087#pullrequestreview-432462004", "createdAt": "2020-06-17T14:29:45Z", "commit": {"oid": "03100c7cc6cf0cf2239ab606e91c55fde0f576cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDoyOTo0NVrOGlIgxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDoyOTo0NVrOGlIgxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU4OTk1OQ==", "bodyText": "this can be wrapped on the previous line (you can break apart ref elements)", "url": "https://github.com/crate/crate/pull/10087#discussion_r441589959", "createdAt": "2020-06-17T14:29:45Z", "author": {"login": "norosa"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -57,6 +57,9 @@ None\n Fixes\n =====\n \n+- Re-enabled the IAM role authentication for\n+  :ref:`s3 repositories <ref-create-repository-types-s3>`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03100c7cc6cf0cf2239ab606e91c55fde0f576cf"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3274, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}