{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNjUyMTU3", "number": 9859, "title": "Fix bug in selecting license object column.", "bodyText": "Summary of the changes / Why this improves CrateDB\nSelecting the license object column from sys.cluster results\nin the row with the object that contains null values for its\nkeys even though the license is set and the access to each of\nthe license object key separately returns the correct result.\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-04-15T09:42:22Z", "url": "https://github.com/crate/crate/pull/9859", "merged": true, "mergeCommit": {"oid": "175ba1a64f23e9ffe43d32c63a44ae3afed95a57"}, "closed": true, "closedAt": "2020-04-15T13:53:41Z", "author": {"login": "kovrus"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcX1AW7ABqjMyMzQ3MzI1NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX4dXdAFqTM5Mzc5NDkwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ada47bd1d2f64dd28f08b8046ba64c799c099cd", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/1ada47bd1d2f64dd28f08b8046ba64c799c099cd", "committedDate": "2020-04-15T09:41:01Z", "message": "Fix bug in selecting license object column.\n\nSelecting the license object column from sys.cluster results\nin the row with the object that contains null values for its\nkeys even though the license is set and the access to each of\nthe license object key separately return the correct result."}, "afterCommit": {"oid": "33ff36632ae74fc2202d5e8d0bb46d8f06ab74f6", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/33ff36632ae74fc2202d5e8d0bb46d8f06ab74f6", "committedDate": "2020-04-15T09:51:32Z", "message": "Fix bug in selecting license object column.\n\nSelecting the license object column from sys.cluster results\nin the row with the object that contains null values for its\nkeys even though the license is set and the access to each of\nthe license object key separately return the correct result."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34e14f4421039e290373f8f17cdf2ce038cfe079", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/34e14f4421039e290373f8f17cdf2ce038cfe079", "committedDate": "2020-04-15T10:20:07Z", "message": "Fix bug in selecting license object column.\n\nSelecting the license object column from sys.cluster results\nin the row with the object that contains null values for its\nkeys even though the license is set and the access to each of\nthe license object key separately return the correct result."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33ff36632ae74fc2202d5e8d0bb46d8f06ab74f6", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/33ff36632ae74fc2202d5e8d0bb46d8f06ab74f6", "committedDate": "2020-04-15T09:51:32Z", "message": "Fix bug in selecting license object column.\n\nSelecting the license object column from sys.cluster results\nin the row with the object that contains null values for its\nkeys even though the license is set and the access to each of\nthe license object key separately return the correct result."}, "afterCommit": {"oid": "34e14f4421039e290373f8f17cdf2ce038cfe079", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/34e14f4421039e290373f8f17cdf2ce038cfe079", "committedDate": "2020-04-15T10:20:07Z", "message": "Fix bug in selecting license object column.\n\nSelecting the license object column from sys.cluster results\nin the row with the object that contains null values for its\nkeys even though the license is set and the access to each of\nthe license object key separately return the correct result."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjU0OTIz", "url": "https://github.com/crate/crate/pull/9859#pullrequestreview-393654923", "createdAt": "2020-04-15T10:38:23Z", "commit": {"oid": "34e14f4421039e290373f8f17cdf2ce038cfe079"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDozODoyM1rOGFz2wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDozODoyM1rOGFz2wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc0NTY2NQ==", "bodyText": "How does switching from forFunction to constant fix the issue? Is LicenseData mutated?", "url": "https://github.com/crate/crate/pull/9859#discussion_r408745665", "createdAt": "2020-04-15T10:38:23Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/expression/reference/sys/cluster/ClusterLicenseExpression.java", "diffHunk": "@@ -59,15 +57,12 @@ public NestableInput getChild(String name) {\n \n     private void fillChildImplementations(LicenseData licenseData) {\n         if (licenseData != null) {\n-            childImplementations.put(EXPIRY_DATE, forFunction(ignored -> {\n-                if (licenseData.expiryDateInMs() == Long.MAX_VALUE) {\n-                    return null;\n-                } else {\n-                    return licenseData.expiryDateInMs();\n-                }\n-            }));\n-            childImplementations.put(ISSUED_TO, forFunction(ignored -> licenseData.issuedTo()));\n-            childImplementations.put(MAX_NODES, forFunction(ignored -> licenseData.maxNumberOfNodes()));\n+            var expiryDateInMs = licenseData.expiryDateInMs() == Long.MAX_VALUE\n+                ? null\n+                : licenseData.expiryDateInMs();\n+            childImplementations.put(EXPIRY_DATE, constant(expiryDateInMs));\n+            childImplementations.put(ISSUED_TO, constant(licenseData.issuedTo()));\n+            childImplementations.put(MAX_NODES, constant(licenseData.maxNumberOfNodes()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34e14f4421039e290373f8f17cdf2ce038cfe079"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNzk0OTA3", "url": "https://github.com/crate/crate/pull/9859#pullrequestreview-393794907", "createdAt": "2020-04-15T13:53:06Z", "commit": {"oid": "34e14f4421039e290373f8f17cdf2ce038cfe079"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3527, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}