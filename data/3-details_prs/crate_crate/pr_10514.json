{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyODkxODkz", "number": 10514, "title": "Fix the join condition hash symbols ordering in the HashJoin.", "bodyText": "Summary of the changes / Why this improves CrateDB\nIt could have happened that joining more than 2 tables using hash join\nwon't return the joined tuples despite that the join condition is satisfied.\nThat could happen due to the non-deterministic ordering of the join condition\nsymbols (hash join symbols) which would lead to the wrong calculation of the\nhash code for the join condition values on either join side. This change fixes\nthe ordering of the join condition symbols.\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-09-09T14:37:15Z", "url": "https://github.com/crate/crate/pull/10514", "merged": true, "mergeCommit": {"oid": "5d283757c374f231e1c5fe9544a72747e75a37fd"}, "closed": true, "closedAt": "2020-09-09T16:15:08Z", "author": {"login": "kovrus"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHNfx7gFqTQ4NTA5ODg3Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHN5tHAFqTQ4NTEyODM2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MDk4ODc3", "url": "https://github.com/crate/crate/pull/10514#pullrequestreview-485098877", "createdAt": "2020-09-09T14:56:48Z", "commit": {"oid": "bfb3b4adde1510c296956fbec1632c4a45cf469b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDo1Njo0OFrOHPLhUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDo1Njo0OFrOHPLhUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY3OTQ0Mw==", "bodyText": "Is this change necessary? I don't understand how this helps, ArrayList also keeps the insertion order", "url": "https://github.com/crate/crate/pull/10514#discussion_r485679443", "createdAt": "2020-09-09T14:56:48Z", "author": {"login": "mfussenegger"}, "path": "server/src/main/java/io/crate/planner/operators/HashJoinConditionSymbolsExtractor.java", "diffHunk": "@@ -92,7 +92,7 @@ public Void visitFunction(Function function, Context context) {\n                     int duplicatePos = 0;\n                     for (Symbol arg : function.arguments()) {\n                         var relation = arg.accept(RELATION_EXTRACTOR, null);\n-                        List<Symbol> symbols = context.symbolsPerRelation.computeIfAbsent(relation, k -> new ArrayList<>());\n+                        List<Symbol> symbols = context.symbolsPerRelation.computeIfAbsent(relation, k -> new LinkedList<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfb3b4adde1510c296956fbec1632c4a45cf469b"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "393c9b06c6f9693184357894f9f6058d81a9b729", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/393c9b06c6f9693184357894f9f6058d81a9b729", "committedDate": "2020-09-09T15:00:48Z", "message": "Fix the join condition hash symbols ordering in the HashJoin.\n\nIt could have happened that joining more than 2 tables using hash join\nwon't return the joined tuples despite that the join condition is satisfied.\nThat could happen due to the non-deterministic ordering of the join condition\nsymbols (hash join symbols) which would lead to the wrong calculation of the\nhash code for the join condition values on either join side. This change fixes\nthe ordering of the join condition symbols."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bfb3b4adde1510c296956fbec1632c4a45cf469b", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/bfb3b4adde1510c296956fbec1632c4a45cf469b", "committedDate": "2020-09-09T14:36:23Z", "message": "Fix the join condition hash symbols ordering in the HashJoin.\n\nIt could have happened that joining more than 2 tables using hash join\nwon't return the joined tuples despite that the join condition is satisfied.\nThat could happen due to the non-deterministic ordering of the join condition\nsymbols (hash join symbols) which would lead to the wrong calculation of the\nhash code for the join condition values on either join side. This change fixes\nthe ordering of the join condition symbols."}, "afterCommit": {"oid": "393c9b06c6f9693184357894f9f6058d81a9b729", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/393c9b06c6f9693184357894f9f6058d81a9b729", "committedDate": "2020-09-09T15:00:48Z", "message": "Fix the join condition hash symbols ordering in the HashJoin.\n\nIt could have happened that joining more than 2 tables using hash join\nwon't return the joined tuples despite that the join condition is satisfied.\nThat could happen due to the non-deterministic ordering of the join condition\nsymbols (hash join symbols) which would lead to the wrong calculation of the\nhash code for the join condition values on either join side. This change fixes\nthe ordering of the join condition symbols."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MTI4MzY3", "url": "https://github.com/crate/crate/pull/10514#pullrequestreview-485128367", "createdAt": "2020-09-09T15:26:30Z", "commit": {"oid": "393c9b06c6f9693184357894f9f6058d81a9b729"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3074, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}