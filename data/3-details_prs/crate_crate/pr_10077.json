{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNTkwNjg0", "number": 10077, "title": "Fix NPE in createTableStats that occurred on primitive array types.", "bodyText": "Summary of the changes / Why this improves CrateDB\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-06-12T10:10:03Z", "url": "https://github.com/crate/crate/pull/10077", "merged": true, "mergeCommit": {"oid": "65b4965d35ff32897e61cd34009953ff8671f5b2"}, "closed": true, "closedAt": "2020-06-15T15:14:39Z", "author": {"login": "kovrus"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqgEw4AFqTQyOTYyMzg5Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrcusPAFqTQzMDQ0NTIzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NjIzODk2", "url": "https://github.com/crate/crate/pull/10077#pullrequestreview-429623896", "createdAt": "2020-06-12T10:13:03Z", "commit": {"oid": "4ba31a023fea76c8aa02a60e885f23d919c24c1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMDoxMzowM1rOGi-rLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMDoxMzowM1rOGi-rLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMzMTYzMQ==", "bodyText": "taking #9851 into consideration it should be fine probably to have a null-safe comparison here such as it the array type?", "url": "https://github.com/crate/crate/pull/10077#discussion_r439331631", "createdAt": "2020-06-12T10:13:03Z", "author": {"login": "kovrus"}, "path": "server/src/main/java/io/crate/types/ArrayType.java", "diffHunk": "@@ -173,7 +174,7 @@ public int compare(List<T> val1, List<T> val2) {\n             return -1;\n         }\n         for (int i = 0; i < val1.size(); i++) {\n-            int cmp = innerType.compare(val1.get(i), val2.get(i));\n+            int cmp = Comparator.nullsFirst(innerType).compare(val1.get(i), val2.get(i));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba31a023fea76c8aa02a60e885f23d919c24c1e"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNDAxMjcw", "url": "https://github.com/crate/crate/pull/10077#pullrequestreview-430401270", "createdAt": "2020-06-15T07:53:46Z", "commit": {"oid": "4ba31a023fea76c8aa02a60e885f23d919c24c1e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwNzo1Mzo0NlrOGjm-7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwNzo1NDozNlrOGjnAnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5MjA0NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <analyze>` statement was executed on tables with the text array type columns\n          \n          \n            \n              <analyze>` statement was executed on tables with text array type columns", "url": "https://github.com/crate/crate/pull/10077#discussion_r439992045", "createdAt": "2020-06-15T07:53:46Z", "author": {"login": "mfussenegger"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -221,5 +221,9 @@ Performance improvements\n Fixes\n =====\n \n+- Fixed an issue that caused a ``NullPointerException`` if the :ref:`ANALYZE\n+  <analyze>` statement was executed on tables with the text array type columns", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba31a023fea76c8aa02a60e885f23d919c24c1e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5MjI4NQ==", "bodyText": "Please keep those explicit generics, see the comment above it:\n\n// Explicit generic is required for eclipse JDT, otherwise it won't compile", "url": "https://github.com/crate/crate/pull/10077#discussion_r439992285", "createdAt": "2020-06-15T07:54:13Z", "author": {"login": "mfussenegger"}, "path": "server/src/main/java/io/crate/statistics/TransportAnalyzeAction.java", "diffHunk": "@@ -103,7 +101,7 @@ public TransportAnalyzeAction(TransportService transportService,\n             AnalyzeRequest::new,\n             ThreadPool.Names.SAME, // goes async right away\n             // Explicit generic is required for eclipse JDT, otherwise it won't compile\n-            new NodeActionRequestHandler<AnalyzeRequest, AcknowledgedResponse>(\n+            new NodeActionRequestHandler<>(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba31a023fea76c8aa02a60e885f23d919c24c1e"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5MjQ3OQ==", "bodyText": "Did this only apply to text ?", "url": "https://github.com/crate/crate/pull/10077#discussion_r439992479", "createdAt": "2020-06-15T07:54:36Z", "author": {"login": "mfussenegger"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -221,5 +221,9 @@ Performance improvements\n Fixes\n =====\n \n+- Fixed an issue that caused a ``NullPointerException`` if the :ref:`ANALYZE\n+  <analyze>` statement was executed on tables with the text array type columns", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk5MjA0NQ=="}, "originalCommit": {"oid": "4ba31a023fea76c8aa02a60e885f23d919c24c1e"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ba31a023fea76c8aa02a60e885f23d919c24c1e", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/4ba31a023fea76c8aa02a60e885f23d919c24c1e", "committedDate": "2020-06-12T10:08:41Z", "message": "Fix NPE in createTableStats that occured when array(text) types."}, "afterCommit": {"oid": "72beee17f33d29f7db05de92a6f553133b914ba8", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/72beee17f33d29f7db05de92a6f553133b914ba8", "committedDate": "2020-06-15T08:08:08Z", "message": "fixup! Fix NPE in createTableStats that occured when array(text) types."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72beee17f33d29f7db05de92a6f553133b914ba8", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/72beee17f33d29f7db05de92a6f553133b914ba8", "committedDate": "2020-06-15T08:08:08Z", "message": "fixup! Fix NPE in createTableStats that occured when array(text) types."}, "afterCommit": {"oid": "9d200e80b914b10f8eabe38056d2dfc851a0106e", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/9d200e80b914b10f8eabe38056d2dfc851a0106e", "committedDate": "2020-06-15T08:10:21Z", "message": "fixup! Fix NPE in createTableStats that occured when array(text) types."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNDE3ODU0", "url": "https://github.com/crate/crate/pull/10077#pullrequestreview-430417854", "createdAt": "2020-06-15T08:16:57Z", "commit": {"oid": "9d200e80b914b10f8eabe38056d2dfc851a0106e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d200e80b914b10f8eabe38056d2dfc851a0106e", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/9d200e80b914b10f8eabe38056d2dfc851a0106e", "committedDate": "2020-06-15T08:10:21Z", "message": "fixup! Fix NPE in createTableStats that occured when array(text) types."}, "afterCommit": {"oid": "dea438d40e93c6a22460aa993e254d6edf253c92", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/dea438d40e93c6a22460aa993e254d6edf253c92", "committedDate": "2020-06-15T08:17:34Z", "message": "Fix NPE in createTableStats that occured on primitive array types."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3241b047b4c0c7b22f5d37fc476c21ed27ba481", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/a3241b047b4c0c7b22f5d37fc476c21ed27ba481", "committedDate": "2020-06-15T08:52:04Z", "message": "Fix NPE in createTableStats that occured on primitive array types."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dea438d40e93c6a22460aa993e254d6edf253c92", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/dea438d40e93c6a22460aa993e254d6edf253c92", "committedDate": "2020-06-15T08:17:34Z", "message": "Fix NPE in createTableStats that occured on primitive array types."}, "afterCommit": {"oid": "a3241b047b4c0c7b22f5d37fc476c21ed27ba481", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/a3241b047b4c0c7b22f5d37fc476c21ed27ba481", "committedDate": "2020-06-15T08:52:04Z", "message": "Fix NPE in createTableStats that occured on primitive array types."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNDQ1MjM1", "url": "https://github.com/crate/crate/pull/10077#pullrequestreview-430445235", "createdAt": "2020-06-15T08:52:55Z", "commit": {"oid": "a3241b047b4c0c7b22f5d37fc476c21ed27ba481"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwODo1Mjo1NVrOGjpClg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwODo1Mjo1NVrOGjpClg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAyNTc1MA==", "bodyText": "@mfussenegger i pushed it after the approval. it seems to be flaky.", "url": "https://github.com/crate/crate/pull/10077#discussion_r440025750", "createdAt": "2020-06-15T08:52:55Z", "author": {"login": "kovrus"}, "path": "server/src/test/java/io/crate/integrationtests/InsertIntoIntegrationTest.java", "diffHunk": "@@ -1596,7 +1596,7 @@ public void test_insert_from_values_and_subquery_into_varchar_with_length_column\n         execute(\"REFRESH TABLE t1\");\n \n         assertThat(\n-            printedTable(execute(\"SELECT * FROM t1\").rows()),\n+            printedTable(execute(\"SELECT * FROM t1 ORDER BY str\").rows()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3241b047b4c0c7b22f5d37fc476c21ed27ba481"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3271, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}