{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NDM4ODI2", "number": 9894, "title": "Optimize return values in Upsert operation", "bodyText": "Summary of the changes / Why this improves CrateDB\nThis optimises the ShardUpsertRequest and the related ShardUpsertRequest.Item. Return values have been removed from the ShardUpsertRequest.Item, Streamers for insert values are generated on demand. Change is backward-compatible.\nChecklist\n\n Added an entry in CHANGES.txt for user facing changes\n Updated documentation & sql_features table for user facing changes\n Touched code is covered by tests\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-04-24T09:30:44Z", "url": "https://github.com/crate/crate/pull/9894", "merged": true, "mergeCommit": {"oid": "1d3ac733f9ac48ed8c29e02220ff3262f9e53d98"}, "closed": true, "closedAt": "2020-04-24T17:45:00Z", "author": {"login": "mkleen"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcawyOegBqjMyNjkyMjM5MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABca0nexAH2gAyNDA4NDM4ODI2OjE5YTJjOTBmYzljZDk0MDVmY2EyOGJjNjVhNDJlOTRmOWEyZjIwZWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d63e3722ec58f051a64544b69ab26cda4a78af50", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/d63e3722ec58f051a64544b69ab26cda4a78af50", "committedDate": "2020-04-24T09:18:17Z", "message": "WIP"}, "afterCommit": {"oid": "0e145c5851a767dbe51949b7bc644d1d2be3906f", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/0e145c5851a767dbe51949b7bc644d1d2be3906f", "committedDate": "2020-04-24T12:38:05Z", "message": "WIP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6dc9bde80e79fc4e75c29f46c96f82ab939158a", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/b6dc9bde80e79fc4e75c29f46c96f82ab939158a", "committedDate": "2020-04-24T14:17:43Z", "message": "Optimise return values in upsert request"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c8fb430c2eeb828ab3998a34c4ddab18460edbf", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/6c8fb430c2eeb828ab3998a34c4ddab18460edbf", "committedDate": "2020-04-24T13:58:31Z", "message": "Add more micro cleanups"}, "afterCommit": {"oid": "b6dc9bde80e79fc4e75c29f46c96f82ab939158a", "author": {"user": {"login": "mkleen", "name": "Michael Kleen"}}, "url": "https://github.com/crate/crate/commit/b6dc9bde80e79fc4e75c29f46c96f82ab939158a", "committedDate": "2020-04-24T14:17:43Z", "message": "Optimise return values in upsert request"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5OTkxNDE4", "url": "https://github.com/crate/crate/pull/9894#pullrequestreview-399991418", "createdAt": "2020-04-24T14:21:53Z", "commit": {"oid": "b6dc9bde80e79fc4e75c29f46c96f82ab939158a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNDoyMTo1M1rOGLaENw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNDoyMTo1M1rOGLaENw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYxNDU4Mw==", "bodyText": "ShardUpsertRequest.Item should have equals/hashcode because the superclass has it as well, so i regenerated it for ShardUpsertRequest to be consistent and get rid of import com.google.common.base.Objects.", "url": "https://github.com/crate/crate/pull/9894#discussion_r414614583", "createdAt": "2020-04-24T14:21:53Z", "author": {"login": "mkleen"}, "path": "sql/src/main/java/io/crate/execution/dml/upsert/ShardUpsertRequest.java", "diffHunk": "@@ -231,35 +181,76 @@ public void writeTo(StreamOutput out) throws IOException {\n         }\n     }\n \n-    @Override\n-    protected Item readItem(StreamInput input) throws IOException {\n-        return new Item(input, insertValuesStreamer);\n+    @Nullable\n+    public SessionSettings sessionSettings() {\n+        return sessionSettings;\n+    }\n+\n+    @Nullable\n+    public Symbol[] returnValues() {\n+        return returnValues;\n+    }\n+\n+    @Nullable\n+    public String[] updateColumns() {\n+        return updateColumns;\n+    }\n+\n+    @Nullable\n+    public Reference[] insertColumns() {\n+        return insertColumns;\n+    }\n+\n+    public boolean continueOnError() {\n+        return continueOnError;\n+    }\n+\n+    public boolean validateConstraints() {\n+        return validateConstraints;\n+    }\n+\n+    public DuplicateKeyAction duplicateKeyAction() {\n+        return duplicateKeyAction;\n     }\n \n     @Override\n     public boolean equals(Object o) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6dc9bde80e79fc4e75c29f46c96f82ab939158a"}, "originalPosition": 228}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMDQ3NzEx", "url": "https://github.com/crate/crate/pull/9894#pullrequestreview-400047711", "createdAt": "2020-04-24T15:26:10Z", "commit": {"oid": "b6dc9bde80e79fc4e75c29f46c96f82ab939158a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19a2c90fc9cd9405fca28bc65a42e94f9a2f20ec", "author": {"user": {"login": "mergify[bot]", "name": null}}, "url": "https://github.com/crate/crate/commit/19a2c90fc9cd9405fca28bc65a42e94f9a2f20ec", "committedDate": "2020-04-24T17:06:18Z", "message": "Merge branch 'master' into mkleen/upsert_optimized"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3303, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}