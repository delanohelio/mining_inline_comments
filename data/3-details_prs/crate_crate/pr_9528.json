{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0MDczODk5", "number": 9528, "title": "Allow more lenient column type validation in VALUES.", "bodyText": "Summary of the changes / Why this improves CrateDB\nCurrently, the column types in VALUES have to be an exact\nmatch which prevents using literals that can be implicitly\nand null literals.\nChecklist\n\n User relevant changes are recorded in CHANGES.txt\n Touched code is covered by tests\n Documentation has been updated if necessary\n CLA is signed\n This does not contain breaking changes, or if it does:\n\nIt is released within a major release\nIt is recorded in CHANGES.txt\nIt was marked as deprecated in an earlier release if possible\nYou've thought about the consequences and other components are adapted\n(E.g. AdminUI)", "createdAt": "2020-01-17T10:31:04Z", "url": "https://github.com/crate/crate/pull/9528", "merged": true, "mergeCommit": {"oid": "b992c4df50c02c16c7e7f1843fc639200145e816"}, "closed": true, "closedAt": "2020-01-20T09:43:48Z", "author": {"login": "kovrus"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7MYKlgBqjI5NTc2OTY3MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8JITaAFqTM0NTE3MzcxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7c2ebb442bf8588d7adea7b5c25e7fbab1fa059", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/b7c2ebb442bf8588d7adea7b5c25e7fbab1fa059", "committedDate": "2020-01-17T10:29:41Z", "message": "Allow more lenient column type validation in VALUES.\n\nCurrently, the column types in VALUES have to be an exact\nmatch which prevents using expressions that can be implicitly\ncasted and `null` literals."}, "afterCommit": {"oid": "48ee733cc38614e1707bdf371b642231f38ce5d5", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/48ee733cc38614e1707bdf371b642231f38ce5d5", "committedDate": "2020-01-17T10:41:34Z", "message": "Allow more lenient column type validation in VALUES.\n\nCurrently, the column types in VALUES have to be an exact\nmatch which prevents using expressions that can be implicitly\ncasted and `null` literals."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48ee733cc38614e1707bdf371b642231f38ce5d5", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/48ee733cc38614e1707bdf371b642231f38ce5d5", "committedDate": "2020-01-17T10:41:34Z", "message": "Allow more lenient column type validation in VALUES.\n\nCurrently, the column types in VALUES have to be an exact\nmatch which prevents using expressions that can be implicitly\ncasted and `null` literals."}, "afterCommit": {"oid": "c9727b9a2a1bc69b1fd426bd42b204bb8b535315", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/c9727b9a2a1bc69b1fd426bd42b204bb8b535315", "committedDate": "2020-01-17T11:10:29Z", "message": "Allow more lenient column type validation in VALUES.\n\nCurrently, the column types in VALUES have to be an exact\nmatch which prevents using expressions that can be implicitly\ncasted and `null` literals."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NTYyMjY0", "url": "https://github.com/crate/crate/pull/9528#pullrequestreview-344562264", "createdAt": "2020-01-17T13:01:32Z", "commit": {"oid": "c9727b9a2a1bc69b1fd426bd42b204bb8b535315"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMzowMTozMlrOFe4TNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMzowMTozMlrOFe4TNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkyNDAyMw==", "bodyText": "I was not sure whether expressions implicit cast are more of a new feature or a fix. I am more inclined to have it as a fix on the same line with null.", "url": "https://github.com/crate/crate/pull/9528#discussion_r367924023", "createdAt": "2020-01-17T13:01:32Z", "author": {"login": "kovrus"}, "path": "docs/appendices/release-notes/unreleased.rst", "diffHunk": "@@ -57,6 +57,9 @@ None\n Fixes\n =====\n \n+- Fixed an issue in :ref:`ref-values` that would not allow combining expressions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9727b9a2a1bc69b1fd426bd42b204bb8b535315"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NTc2NjMy", "url": "https://github.com/crate/crate/pull/9528#pullrequestreview-344576632", "createdAt": "2020-01-17T13:29:24Z", "commit": {"oid": "c9727b9a2a1bc69b1fd426bd42b204bb8b535315"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMzoyOToyNFrOFe49Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMzoyOToyNFrOFe49Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkzNDczMA==", "bodyText": "Which type will this end up using? Couldn't this lead to ClassCastExceptions due to a mixture of types?\nIn the other branch we've type precedence logic integrated. See https://github.com/crate/crate/pull/9465/files#diff-bf12c5e61f9b0fe950aa518b1ed601abR807", "url": "https://github.com/crate/crate/pull/9528#discussion_r367934730", "createdAt": "2020-01-17T13:29:24Z", "author": {"login": "mfussenegger"}, "path": "sql/src/main/java/io/crate/analyze/relations/RelationAnalyzer.java", "diffHunk": "@@ -750,7 +750,8 @@ public AnalyzedRelation visitValues(Values values, StatementAnalysisContext cont\n                 for (int i = 0; i < firstRow.size(); i++) {\n                     var typeOfFirstRowAtPos = firstRow.get(i).valueType();\n                     var typeOfCurrentRowAtPos = columns.get(i).valueType();\n-                    if (!typeOfCurrentRowAtPos.equals(typeOfFirstRowAtPos)) {\n+                    if (!typeOfFirstRowAtPos.isConvertableTo(typeOfCurrentRowAtPos)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9727b9a2a1bc69b1fd426bd42b204bb8b535315"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b62bcec01efe625172c0bf74570c1185cb471bd", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/4b62bcec01efe625172c0bf74570c1185cb471bd", "committedDate": "2020-01-20T08:41:41Z", "message": "fixup! Allow more lenient column type validation in VALUES."}, "afterCommit": {"oid": "a2081f3adc017284649c96693a648d048c50d089", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/a2081f3adc017284649c96693a648d048c50d089", "committedDate": "2020-01-20T08:44:25Z", "message": "fixup! Allow more lenient column type validation in VALUES."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MTY0OTAx", "url": "https://github.com/crate/crate/pull/9528#pullrequestreview-345164901", "createdAt": "2020-01-20T09:14:42Z", "commit": {"oid": "a2081f3adc017284649c96693a648d048c50d089"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78325ee267569db1369c501794588828b936876a", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/78325ee267569db1369c501794588828b936876a", "committedDate": "2020-01-20T09:15:13Z", "message": "Allow more lenient column type validation in VALUES.\n\nCurrently, the column types in VALUES have to be an exact\nmatch which prevents using expressions that can be implicitly\ncasted and `null` literals."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a2081f3adc017284649c96693a648d048c50d089", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/a2081f3adc017284649c96693a648d048c50d089", "committedDate": "2020-01-20T08:44:25Z", "message": "fixup! Allow more lenient column type validation in VALUES."}, "afterCommit": {"oid": "78325ee267569db1369c501794588828b936876a", "author": {"user": {"login": "kovrus", "name": "Ruslan Kovalov"}}, "url": "https://github.com/crate/crate/commit/78325ee267569db1369c501794588828b936876a", "committedDate": "2020-01-20T09:15:13Z", "message": "Allow more lenient column type validation in VALUES.\n\nCurrently, the column types in VALUES have to be an exact\nmatch which prevents using expressions that can be implicitly\ncasted and `null` literals."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MTczNzE2", "url": "https://github.com/crate/crate/pull/9528#pullrequestreview-345173716", "createdAt": "2020-01-20T09:28:36Z", "commit": {"oid": "78325ee267569db1369c501794588828b936876a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3920, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}