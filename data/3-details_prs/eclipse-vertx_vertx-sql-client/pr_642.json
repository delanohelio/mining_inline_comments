{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MzI3MDQ5", "number": 642, "title": "PgException getter and getMessage with all fields, PgErrorCodes", "bodyText": "Support debugging database errors by including all fields in PgException.\nFixes #274.\n\n\nCreate a getter method for each field returned by PostgreSQL.\n\n\nThe getMessage() method (overriding the RuntimeException method)\nhas been returning the message field only. Now it returns all\nfields for complete information in logs. It creates a serialized\nJsonObject to support parsing the String, for example in\nmicroservice integration tests where it is returned in the\nHTTP body.\n\n\nTo get only the message field use the new getErrorMessage()\nmethod.\n\n\nPgConnectionTest.java and PgPoolTestBase.java have been using\nPgException#getMessage() to assert that the query was cancelled.\nThis method is much more verbose now. Change these asserts to\ncheck the SQLSTATE error code returned by PgException#getCode().\n\"Applications that need to know which error condition has occurred\nshould usually test the error code, rather than looking at the\ntextual error message.\" (Quote from\nhttps://www.postgresql.org/docs/current/errcodes-appendix.html )\n\n\nThe https://github.com/vert-x3/vertx-mysql-postgresql-client\nclient returns all fields in GenericDatabaseException#getMessage(),\nPgException should provide the same amount of data.", "createdAt": "2020-05-18T08:03:15Z", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642", "merged": true, "mergeCommit": {"oid": "4e508a93b2d252767aacdf99117967d468d6c4a2"}, "closed": true, "closedAt": "2020-05-20T09:06:27Z", "author": {"login": "julianladisch"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcidYWWgFqTQxMzQ2NzMwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABci8MbPgH2gAyNDE5MzI3MDQ5OjlhOWQ0NDA4YTk2N2EwMTQ0MWYyNDMwNTU3N2U3NWJiZmJkYzI2MTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNDY3MzAy", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#pullrequestreview-413467302", "createdAt": "2020-05-18T10:29:22Z", "commit": {"oid": "3d7a87bb8574f9b68a53681eefa5670d80b1bc70"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxMDoyOToyM1rOGWxIug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxMDoyOToyM1rOGWxIug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUyNjkwNg==", "bodyText": "I think we don't actually need this API, we can put the fields in the PgException. In addition I'm not sure if all the fields are necessary to be exposed directly in the API.", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r426526906", "createdAt": "2020-05-18T10:29:23Z", "author": {"login": "BillyYccc"}, "path": "vertx-pg-client/src/main/java/io/vertx/pgclient/impl/codec/Response.java", "diffHunk": "@@ -1,209 +1,58 @@\n /*\n- * Copyright (C) 2017 Julien Viet\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n  *\n- * Licensed under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- *\n- * http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n  *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n  */\n \n package io.vertx.pgclient.impl.codec;\n \n+import io.vertx.codegen.annotations.VertxGen;\n+\n /**\n  *\n  * <p>\n  * A common response message for PostgreSQL\n  * <a href=\"https://www.postgresql.org/docs/9.5/static/protocol-error-fields.html\">Error and Notice Message Fields</a>\n- *\n- * @author <a href=\"mailto:emad.albloushi@gmail.com\">Emad Alblueshi</a>\n  */\n+@VertxGen\n+public interface Response {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d7a87bb8574f9b68a53681eefa5670d80b1bc70"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d61cc0639d6aa089c619ca9e62c101faa7df527", "author": {"user": {"login": "julianladisch", "name": null}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/9d61cc0639d6aa089c619ca9e62c101faa7df527", "committedDate": "2020-05-18T13:01:30Z", "message": "PgException getter and getMessage with all fields, PgErrorCodes\n\nSupport debugging database errors by including all fields in\nPgException.\n\nFixes #274.\n\n* Create a getter method for each field returned by PostgreSQL.\n\n* The getMessage() method (overriding the RuntimeException method)\n  has been returning the message field only. Now it returns all\n  fields for complete information in logs. It creates a serialized\n  JsonObject to support parsing the String, for example in\n  microservice integration tests where it is returned in the\n  HTTP body.\n\n* To get only the message field use the new getErrorMessage()\n  method.\n\n* Add PgErrorCodes with constants for all SQLSTATE error codes and a\n  hasCode(Throwable throwable, String code) method for comparison.\n  \"Applications that need to know which error condition has occurred\n  should usually test the error code, rather than looking at the\n  textual error message.\" (Quote from\n  https://www.postgresql.org/docs/current/errcodes-appendix.html )\n\nThe https://github.com/vert-x3/vertx-mysql-postgresql-client\nclient returns all fields in GenericDatabaseException#getMessage(),\nPgException should provide the same amount of data.\n\nTo change the visibility of the Response getter methods from\npackage-private to public the package-private Response has been\nrenamed to ResponseImpl and a public Response interface with public\ngetter methods has been created.\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d7a87bb8574f9b68a53681eefa5670d80b1bc70", "author": {"user": {"login": "julianladisch", "name": null}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/3d7a87bb8574f9b68a53681eefa5670d80b1bc70", "committedDate": "2020-05-18T07:57:07Z", "message": "PgException getter and getMessage with all fields, PgErrorCodes\n\nSupport debugging database errors by including all fields in\nPgException.\n\nFixes #274.\n\n* Create a getter method for each field returned by PostgreSQL.\n\n* The getMessage() method (overriding the RuntimeException method)\n  has been returning the message field only. Now it returns all\n  fields for complete information in logs. It creates a serialized\n  JsonObject to support parsing the String, for example in\n  microservice integration tests where it is returned in the\n  HTTP body.\n\n* To get only the message field use the new getErrorMessage()\n  method.\n\n* Add PgErrorCodes with constants for all SQLSTATE error codes and a\n  hasCode(Throwable throwable, String code) method for comparison.\n  \"Applications that need to know which error condition has occurred\n  should usually test the error code, rather than looking at the\n  textual error message.\" (Quote from\n  https://www.postgresql.org/docs/current/errcodes-appendix.html )\n\nThe https://github.com/vert-x3/vertx-mysql-postgresql-client\nclient returns all fields in GenericDatabaseException#getMessage(),\nPgException should provide the same amount of data.\n\nTo change the visibility of the Response getter methods from\npackage-private to public the package-private Response has been\nrenamed to ResponseImpl and a public Response interface with public\ngetter methods has been created.\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>"}, "afterCommit": {"oid": "9d61cc0639d6aa089c619ca9e62c101faa7df527", "author": {"user": {"login": "julianladisch", "name": null}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/9d61cc0639d6aa089c619ca9e62c101faa7df527", "committedDate": "2020-05-18T13:01:30Z", "message": "PgException getter and getMessage with all fields, PgErrorCodes\n\nSupport debugging database errors by including all fields in\nPgException.\n\nFixes #274.\n\n* Create a getter method for each field returned by PostgreSQL.\n\n* The getMessage() method (overriding the RuntimeException method)\n  has been returning the message field only. Now it returns all\n  fields for complete information in logs. It creates a serialized\n  JsonObject to support parsing the String, for example in\n  microservice integration tests where it is returned in the\n  HTTP body.\n\n* To get only the message field use the new getErrorMessage()\n  method.\n\n* Add PgErrorCodes with constants for all SQLSTATE error codes and a\n  hasCode(Throwable throwable, String code) method for comparison.\n  \"Applications that need to know which error condition has occurred\n  should usually test the error code, rather than looking at the\n  textual error message.\" (Quote from\n  https://www.postgresql.org/docs/current/errcodes-appendix.html )\n\nThe https://github.com/vert-x3/vertx-mysql-postgresql-client\nclient returns all fields in GenericDatabaseException#getMessage(),\nPgException should provide the same amount of data.\n\nTo change the visibility of the Response getter methods from\npackage-private to public the package-private Response has been\nrenamed to ResponseImpl and a public Response interface with public\ngetter methods has been created.\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9a9be663c9ed7ec6205ed64d6bd2e1f5510c698", "author": {"user": {"login": "julianladisch", "name": null}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/b9a9be663c9ed7ec6205ed64d6bd2e1f5510c698", "committedDate": "2020-05-18T14:43:12Z", "message": "Copy Response fields into PgException, revert Response/ResponseImpl\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzYyNTcx", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#pullrequestreview-413762571", "createdAt": "2020-05-18T16:38:22Z", "commit": {"oid": "ea0a6c7aede3b1f3224bcef87865653a1867c054"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNjozODoyMlrOGW_LdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNjozODoyMlrOGW_LdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc1Njk4MA==", "bodyText": "rather reuse the existing io.vertx.pgclient.impl.util.Util class that contains already similar static methods", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r426756980", "createdAt": "2020-05-18T16:38:22Z", "author": {"login": "vietj"}, "path": "vertx-pg-client/src/test/java/io/vertx/pgclient/impl/codec/ResponseHelper.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+\n+package io.vertx.pgclient.impl.codec;\n+\n+import io.vertx.pgclient.PgException;\n+\n+public final class ResponseHelper {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea0a6c7aede3b1f3224bcef87865653a1867c054"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81bc0f6f418aebd31b9f39f4207032ca5fda897b", "author": {"user": {"login": "julianladisch", "name": null}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/81bc0f6f418aebd31b9f39f4207032ca5fda897b", "committedDate": "2020-05-19T07:25:26Z", "message": "Add license header\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea0a6c7aede3b1f3224bcef87865653a1867c054", "author": {"user": {"login": "julianladisch", "name": null}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/ea0a6c7aede3b1f3224bcef87865653a1867c054", "committedDate": "2020-05-18T16:31:30Z", "message": "Add license header"}, "afterCommit": {"oid": "81bc0f6f418aebd31b9f39f4207032ca5fda897b", "author": {"user": {"login": "julianladisch", "name": null}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/81bc0f6f418aebd31b9f39f4207032ca5fda897b", "committedDate": "2020-05-19T07:25:26Z", "message": "Add license header\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MTc3ODcy", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#pullrequestreview-414177872", "createdAt": "2020-05-19T07:38:17Z", "commit": {"oid": "81bc0f6f418aebd31b9f39f4207032ca5fda897b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNzozODoxN1rOGXTmMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwNzozODoxN1rOGXTmMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA5MTUwNg==", "bodyText": "I think this should be instead an enum", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/642#discussion_r427091506", "createdAt": "2020-05-19T07:38:17Z", "author": {"login": "vietj"}, "path": "vertx-pg-client/src/main/java/io/vertx/pgclient/PgErrorCodes.java", "diffHunk": "@@ -0,0 +1,306 @@\n+/*\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+\n+package io.vertx.pgclient;\n+\n+/**\n+ * SQLSTATE codes used by PostgreSQL\n+ * (<a href=\"https://www.postgresql.org/docs/current/errcodes-appendix.html\">PostgreSQL Error Codes</a>,\n+ * <a href=\"https://git.postgresql.org/gitweb/?p=postgresql.git;a=blob;f=src/backend/utils/errcodes.txt;hb=HEAD\">\n+ * errcodes.txt</a>)\n+ */\n+public class PgErrorCodes {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81bc0f6f418aebd31b9f39f4207032ca5fda897b"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a9d4408a967a01441f24305577e75bbfbdc2610", "author": {"user": {"login": "julianladisch", "name": null}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/9a9d4408a967a01441f24305577e75bbfbdc2610", "committedDate": "2020-05-19T22:27:23Z", "message": "Remove PgErrorCodes.java\n\nSigned-off-by: Julian Ladisch <eclipse.org-rtn@ladisch.de>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1637, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}