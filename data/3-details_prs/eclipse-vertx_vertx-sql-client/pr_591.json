{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyODI4NDU3", "number": 591, "title": "Fixes for initial compatibility with Hibernate RX", "bodyText": "", "createdAt": "2020-04-13T20:35:36Z", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591", "merged": true, "mergeCommit": {"oid": "b2cac478865af90a814a0142236a3865d307e155"}, "closed": true, "closedAt": "2020-04-16T23:00:04Z", "author": {"login": "aguibert"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXU_l1AH2gAyNDAyODI4NDU3OjRkODkyYzQxYTUyYzM3ZjE4ZjkzZDYwMWQ5ZTNhNzQxYjFmZDUxYjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYBAp0gFqTM5NDIwNDQ3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4d892c41a52c37f18f93d601d9e3a741b1fd51b2", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/4d892c41a52c37f18f93d601d9e3a741b1fd51b2", "committedDate": "2020-04-13T20:33:54Z", "message": "Fix issue encoding null values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20376cc6be4d95bb82087a98c6a7fa8e2b66a08f", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/20376cc6be4d95bb82087a98c6a7fa8e2b66a08f", "committedDate": "2020-04-13T20:34:39Z", "message": "Handling for columns renamed in queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e9d39e55cbba400095715dde61545efd7b68c3f", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/6e9d39e55cbba400095715dde61545efd7b68c3f", "committedDate": "2020-04-13T21:26:29Z", "message": "Fix issue encoding a Java float into a DB2 FLOAT column type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c735c41d96bd61ac3c6c4b5de6358541a38b3780", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/c735c41d96bd61ac3c6c4b5de6358541a38b3780", "committedDate": "2020-04-14T20:30:19Z", "message": "Fixes for storing a Java byte into a SMALLINT column"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04105053de4b3e11927079fc9eddfed3482ce579", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/04105053de4b3e11927079fc9eddfed3482ce579", "committedDate": "2020-04-14T20:33:59Z", "message": "Fix for storing Buffer and ByteBuf into binary columns"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18cdb2d2cbce399abfe891c8d9928ecd34e0f1e5", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/18cdb2d2cbce399abfe891c8d9928ecd34e0f1e5", "committedDate": "2020-04-14T21:16:50Z", "message": "Remove NOT NULL contstraint on basicdatatype table"}, "afterCommit": {"oid": "1737c7d6a8bc6fa8fb2aecffcf7802c270b3f82c", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/1737c7d6a8bc6fa8fb2aecffcf7802c270b3f82c", "committedDate": "2020-04-14T21:18:23Z", "message": "Remove NOT NULL contstraint on basicdatatype table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77bd99dea649e70df0d8f4b04e2d43e6c1655390", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/77bd99dea649e70df0d8f4b04e2d43e6c1655390", "committedDate": "2020-04-14T21:50:10Z", "message": "Disable new TCK test for MSSQL as it requires further investigation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1737c7d6a8bc6fa8fb2aecffcf7802c270b3f82c", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/1737c7d6a8bc6fa8fb2aecffcf7802c270b3f82c", "committedDate": "2020-04-14T21:18:23Z", "message": "Remove NOT NULL contstraint on basicdatatype table"}, "afterCommit": {"oid": "77bd99dea649e70df0d8f4b04e2d43e6c1655390", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/77bd99dea649e70df0d8f4b04e2d43e6c1655390", "committedDate": "2020-04-14T21:50:10Z", "message": "Disable new TCK test for MSSQL as it requires further investigation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzI2Nzg4", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#pullrequestreview-393326788", "createdAt": "2020-04-14T22:00:52Z", "commit": {"oid": "77bd99dea649e70df0d8f4b04e2d43e6c1655390"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjowMDo1MlrOGFiiqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjowMDo1MlrOGFiiqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MTk5NA==", "bodyText": "CC @vietj for this change. Do you think this is OK? From experimenting with the API returning null in these getters causes very confusing behavior, so I think it's good to be as lenient as possible here.", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#discussion_r408461994", "createdAt": "2020-04-14T22:00:52Z", "author": {"login": "aguibert"}, "path": "vertx-sql-client/src/main/java/io/vertx/sqlclient/Tuple.java", "diffHunk": "@@ -468,6 +469,12 @@ default Buffer getBuffer(int pos) {\n     if (val instanceof Buffer) {\n       return (Buffer) val;\n     }\n+    if (val instanceof ByteBuf) {\n+      return Buffer.buffer((ByteBuf) val);\n+    }\n+    if (val instanceof byte[]) {\n+      return Buffer.buffer((byte[]) val);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77bd99dea649e70df0d8f4b04e2d43e6c1655390"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzI3NjQ1", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#pullrequestreview-393327645", "createdAt": "2020-04-14T22:02:35Z", "commit": {"oid": "77bd99dea649e70df0d8f4b04e2d43e6c1655390"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjowMjozNVrOGFilaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjowMjozNVrOGFilaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MjY5Ng==", "bodyText": "CC @BillyYccc for this change. I'm adding testNullValues to the common TCK in this PR, but it fails for MSSQL. Can you please investigate this when you have time?", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#discussion_r408462696", "createdAt": "2020-04-14T22:02:35Z", "author": {"login": "aguibert"}, "path": "vertx-mssql-client/src/test/java/io/vertx/mssqlclient/tck/MSSQLBinaryDataTypeEncodeTest.java", "diffHunk": "@@ -57,5 +57,13 @@ public void testDecimal(TestContext ctx) {\n     //TODO do we need wrapped type?\n     super.testDecimal(ctx);\n   }\n+  \n+  @Test\n+  @Ignore // TODO: Investigate this issue and enable the test \n+  // (unfortunately it wasn't as simple as removing the NOT NULL constraints in init.sql)\n+  @Override\n+  public void testNullValues(TestContext ctx) {\n+    super.testNullValues(ctx);\n+  }  ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77bd99dea649e70df0d8f4b04e2d43e6c1655390"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2639d7426277b4f91977e0e1907631419eec6eb0", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/2639d7426277b4f91977e0e1907631419eec6eb0", "committedDate": "2020-04-14T23:07:15Z", "message": "Disable sequence tests for DB2/z until implemented"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MjA0NDc1", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#pullrequestreview-394204475", "createdAt": "2020-04-15T23:34:31Z", "commit": {"oid": "2639d7426277b4f91977e0e1907631419eec6eb0"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMzozNDozMlrOGGPOog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMzozNDo0M1rOGGPO4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE5NDE0Ng==", "bodyText": "If inputRow[i] can be null, should that be checked before lines 1204-107 where it could cause a NPE?  Or is the case where it would be null mutually exclusive from when it would be cast as a byte[] or ByteBuf?", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#discussion_r409194146", "createdAt": "2020-04-15T23:34:32Z", "author": {"login": "gjwatts"}, "path": "vertx-db2-client/src/main/java/io/vertx/db2client/impl/drda/DRDAQueryRequest.java", "diffHunk": "@@ -1193,11 +1199,17 @@ private Hashtable computeProtocolTypesAndLengths(\n                     break;\n                 case Types.BINARY:\n                 case Types.VARBINARY:\n-                    byte[] ba = (byte[]) inputRow[i];\n-                    if (ba == null) {\n+//                    byte[] ba = (byte[]) inputRow[i];\n+                \tint length = -1;\n+                \tif (inputRow[i] instanceof byte[]) {\n+                \t\tlength = ((byte[]) inputRow[i]).length;\n+                \t} else if (inputRow[i] instanceof ByteBuf) {\n+                \t\tlength = ((ByteBuf) inputRow[i]).readableBytes();\n+                \t}\n+                    if (inputRow[i] == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2639d7426277b4f91977e0e1907631419eec6eb0"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE5NDIwOQ==", "bodyText": "Same as above", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#discussion_r409194209", "createdAt": "2020-04-15T23:34:43Z", "author": {"login": "gjwatts"}, "path": "vertx-db2-client/src/main/java/io/vertx/db2client/impl/drda/DRDAQueryRequest.java", "diffHunk": "@@ -1215,11 +1227,17 @@ private Hashtable computeProtocolTypesAndLengths(\n                     }\n                     break;\n                 case Types.LONGVARBINARY:\n-                    ba = (byte[]) inputRow[i];\n-                    if (ba == null) {\n+//                    ba = (byte[]) inputRow[i];\n+                \tlength = -1;\n+                \tif (inputRow[i] instanceof byte[]) {\n+                \t\tlength = ((byte[]) inputRow[i]).length;\n+                \t} else if (inputRow[i] instanceof ByteBuf) {\n+                \t\tlength = ((ByteBuf) inputRow[i]).readableBytes();\n+                \t}\n+                    if (inputRow[i] == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2639d7426277b4f91977e0e1907631419eec6eb0"}, "originalPosition": 74}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1608, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}