{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNzQ1Njcz", "number": 553, "title": "Add tests for table joins and subqueries", "bodyText": "This PR mainly just adds tests for various queries which happened to work already.\nAlso, it exposed an issue where the DB2Codec was reading ahead slightly in order to check a \"sequence ID\" which was a holdover from the copied MySQL code. The sequence ID only applies to MySQL codec and therefore can be removed from DB2\nFixes #551", "createdAt": "2020-03-20T21:20:17Z", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553", "merged": true, "mergeCommit": {"oid": "6067454484716613087cb960031f4fa533abd08f"}, "closed": true, "closedAt": "2020-03-23T16:37:53Z", "author": {"login": "aguibert"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPnNndgH2gAyMzkxNzQ1NjczOjY3ZmNkM2Y1YzY2YmJmNWZmZGViOWZhMTYxZmU4MzA2YzNlYjJlY2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPojnXgFqTM3ODg1MTUyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca", "author": {"user": {"login": "aguibert", "name": "Andrew Guibert"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca", "committedDate": "2020-03-20T21:16:07Z", "message": "Add tests for table joins and subqueries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODE4ODQw", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#pullrequestreview-378818840", "createdAt": "2020-03-20T21:20:52Z", "commit": {"oid": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMToyMDo1MlrOF5jhug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMToyMTowMFrOF5jh8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5NTIyNg==", "bodyText": "this change was requested from the previous PR", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#discussion_r395895226", "createdAt": "2020-03-20T21:20:52Z", "author": {"login": "aguibert"}, "path": "vertx-db2-client/src/main/java/io/vertx/db2client/impl/drda/ColumnMetaData.java", "diffHunk": "@@ -115,6 +115,8 @@ public void setColumnCount(final int numColumns) {\n     }\n     \n     public String getColumnName(int i) {\n+    \tif (i < 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5NTI4Mg==", "bodyText": "this change was requested from the previous PR", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#discussion_r395895282", "createdAt": "2020-03-20T21:21:00Z", "author": {"login": "aguibert"}, "path": "vertx-sql-client/src/main/java/io/vertx/sqlclient/impl/ListTuple.java", "diffHunk": "@@ -19,7 +19,6 @@\n \n import io.vertx.sqlclient.Tuple;\n \n-import java.util.Iterator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODMxODc2", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#pullrequestreview-378831876", "createdAt": "2020-03-20T21:51:34Z", "commit": {"oid": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMTo1MTozNVrOF5kKrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMTo1MTozNVrOF5kKrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNTcxMQ==", "bodyText": "tablesToClean() always returns an empty list each time, so won't that mean cleanTestTable() will never be run?", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#discussion_r395905711", "createdAt": "2020-03-20T21:51:35Z", "author": {"login": "gjwatts"}, "path": "vertx-db2-client/src/test/java/io/vertx/db2client/DB2TestBase.java", "diffHunk": "@@ -21,12 +26,17 @@\n \tprotected Vertx vertx;\n \tprotected Connector<SqlConnection> connector;\n \tprotected DB2ConnectOptions options;\n+\t\n+\t@Rule\n+\tpublic TestName testName = new TestName();\n \n \t@Before\n \tpublic void setUp(TestContext ctx) throws Exception {\n+\t\tSystem.out.println(\">>> BEGIN \" + testName.getMethodName());\n \t\tvertx = Vertx.vertx();\n \t\tinitConnector();\n-\t\tcleanTestTable(ctx);\n+\t\tfor (String table : tablesToClean())\n+\t\t\tcleanTestTable(ctx, table);\n \t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODUxNTI3", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#pullrequestreview-378851527", "createdAt": "2020-03-20T22:50:03Z", "commit": {"oid": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMjo1MDowM1rOF5lL3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMjo1MDowM1rOF5lL3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkyMjM5Nw==", "bodyText": "This is a nit and completely irrelevant to the test itself, but on line 25, I would suggest changing \"FORT ID\" to \"FORT MSG\" to remove confusion with the line above.", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#discussion_r395922397", "createdAt": "2020-03-20T22:50:03Z", "author": {"login": "gjwatts"}, "path": "vertx-db2-client/src/test/java/io/vertx/db2client/TableJoinTest.java", "diffHunk": "@@ -0,0 +1,100 @@\n+package io.vertx.db2client;\n+\n+import java.util.Arrays;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import io.vertx.ext.unit.TestContext;\n+import io.vertx.ext.unit.junit.VertxUnitRunner;\n+import io.vertx.sqlclient.Row;\n+\n+/**\n+ * Tests for table joins which are documented here:\n+ * https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/intro/src/tpc/db2z_joindatafromtables.html\n+ */\n+@RunWith(VertxUnitRunner.class)\n+public class TableJoinTest extends DB2TestBase {\n+\t\n+\t@Test\n+\tpublic void testColumnRename(TestContext ctx) {\n+\t\tconnect(ctx.asyncAssertSuccess(conn -> {\n+\t\t\tconn.query(\"SELECT immutable.id AS \\\"IMM ID\\\",\" +\n+\t\t                      \"immutable.message AS IMM_MSG,\" +\n+\t\t\t\t\t          \"Fortune.id AS FORT_ID,\" +\n+\t\t                      \"Fortune.message AS \\\"FORT ID\\\" FROM immutable \" + ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1577, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}