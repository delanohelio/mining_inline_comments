{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyODI4NDU3", "number": 591, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjowMDo1MlrODx1rdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMzozNDo0M1rODyR_Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTg2Mjk0OnYy", "diffSide": "RIGHT", "path": "vertx-sql-client/src/main/java/io/vertx/sqlclient/Tuple.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjowMDo1MlrOGFiiqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjowMDo1MlrOGFiiqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MTk5NA==", "bodyText": "CC @vietj for this change. Do you think this is OK? From experimenting with the API returning null in these getters causes very confusing behavior, so I think it's good to be as lenient as possible here.", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#discussion_r408461994", "createdAt": "2020-04-14T22:00:52Z", "author": {"login": "aguibert"}, "path": "vertx-sql-client/src/main/java/io/vertx/sqlclient/Tuple.java", "diffHunk": "@@ -468,6 +469,12 @@ default Buffer getBuffer(int pos) {\n     if (val instanceof Buffer) {\n       return (Buffer) val;\n     }\n+    if (val instanceof ByteBuf) {\n+      return Buffer.buffer((ByteBuf) val);\n+    }\n+    if (val instanceof byte[]) {\n+      return Buffer.buffer((byte[]) val);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77bd99dea649e70df0d8f4b04e2d43e6c1655390"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTg2NzI5OnYy", "diffSide": "RIGHT", "path": "vertx-mssql-client/src/test/java/io/vertx/mssqlclient/tck/MSSQLBinaryDataTypeEncodeTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjowMjozNVrOGFilaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwMDoyOTowN1rOGFlnnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MjY5Ng==", "bodyText": "CC @BillyYccc for this change. I'm adding testNullValues to the common TCK in this PR, but it fails for MSSQL. Can you please investigate this when you have time?", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#discussion_r408462696", "createdAt": "2020-04-14T22:02:35Z", "author": {"login": "aguibert"}, "path": "vertx-mssql-client/src/test/java/io/vertx/mssqlclient/tck/MSSQLBinaryDataTypeEncodeTest.java", "diffHunk": "@@ -57,5 +57,13 @@ public void testDecimal(TestContext ctx) {\n     //TODO do we need wrapped type?\n     super.testDecimal(ctx);\n   }\n+  \n+  @Test\n+  @Ignore // TODO: Investigate this issue and enable the test \n+  // (unfortunately it wasn't as simple as removing the NOT NULL constraints in init.sql)\n+  @Override\n+  public void testNullValues(TestContext ctx) {\n+    super.testNullValues(ctx);\n+  }  ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77bd99dea649e70df0d8f4b04e2d43e6c1655390"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUxMjQxMg==", "bodyText": "I think it's not supported in the client for now.", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#discussion_r408512412", "createdAt": "2020-04-15T00:29:07Z", "author": {"login": "BillyYccc"}, "path": "vertx-mssql-client/src/test/java/io/vertx/mssqlclient/tck/MSSQLBinaryDataTypeEncodeTest.java", "diffHunk": "@@ -57,5 +57,13 @@ public void testDecimal(TestContext ctx) {\n     //TODO do we need wrapped type?\n     super.testDecimal(ctx);\n   }\n+  \n+  @Test\n+  @Ignore // TODO: Investigate this issue and enable the test \n+  // (unfortunately it wasn't as simple as removing the NOT NULL constraints in init.sql)\n+  @Override\n+  public void testNullValues(TestContext ctx) {\n+    super.testNullValues(ctx);\n+  }  ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MjY5Ng=="}, "originalCommit": {"oid": "77bd99dea649e70df0d8f4b04e2d43e6c1655390"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MDUwMDYyOnYy", "diffSide": "RIGHT", "path": "vertx-db2-client/src/main/java/io/vertx/db2client/impl/drda/DRDAQueryRequest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMzozNDozMlrOGGPOog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMToyNTozNVrOGG3u6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE5NDE0Ng==", "bodyText": "If inputRow[i] can be null, should that be checked before lines 1204-107 where it could cause a NPE?  Or is the case where it would be null mutually exclusive from when it would be cast as a byte[] or ByteBuf?", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#discussion_r409194146", "createdAt": "2020-04-15T23:34:32Z", "author": {"login": "gjwatts"}, "path": "vertx-db2-client/src/main/java/io/vertx/db2client/impl/drda/DRDAQueryRequest.java", "diffHunk": "@@ -1193,11 +1199,17 @@ private Hashtable computeProtocolTypesAndLengths(\n                     break;\n                 case Types.BINARY:\n                 case Types.VARBINARY:\n-                    byte[] ba = (byte[]) inputRow[i];\n-                    if (ba == null) {\n+//                    byte[] ba = (byte[]) inputRow[i];\n+                \tint length = -1;\n+                \tif (inputRow[i] instanceof byte[]) {\n+                \t\tlength = ((byte[]) inputRow[i]).length;\n+                \t} else if (inputRow[i] instanceof ByteBuf) {\n+                \t\tlength = ((ByteBuf) inputRow[i]).readableBytes();\n+                \t}\n+                    if (inputRow[i] == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2639d7426277b4f91977e0e1907631419eec6eb0"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg1Nzc3MA==", "bodyText": "good question, I had to double check on this and the statement if (null instanceof byte[]) evaluates to false so we don't need the extra null check", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#discussion_r409857770", "createdAt": "2020-04-16T21:25:35Z", "author": {"login": "aguibert"}, "path": "vertx-db2-client/src/main/java/io/vertx/db2client/impl/drda/DRDAQueryRequest.java", "diffHunk": "@@ -1193,11 +1199,17 @@ private Hashtable computeProtocolTypesAndLengths(\n                     break;\n                 case Types.BINARY:\n                 case Types.VARBINARY:\n-                    byte[] ba = (byte[]) inputRow[i];\n-                    if (ba == null) {\n+//                    byte[] ba = (byte[]) inputRow[i];\n+                \tint length = -1;\n+                \tif (inputRow[i] instanceof byte[]) {\n+                \t\tlength = ((byte[]) inputRow[i]).length;\n+                \t} else if (inputRow[i] instanceof ByteBuf) {\n+                \t\tlength = ((ByteBuf) inputRow[i]).readableBytes();\n+                \t}\n+                    if (inputRow[i] == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE5NDE0Ng=="}, "originalCommit": {"oid": "2639d7426277b4f91977e0e1907631419eec6eb0"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MDUwMTA2OnYy", "diffSide": "RIGHT", "path": "vertx-db2-client/src/main/java/io/vertx/db2client/impl/drda/DRDAQueryRequest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMzozNDo0M1rOGGPO4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMzozNDo0M1rOGGPO4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE5NDIwOQ==", "bodyText": "Same as above", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/591#discussion_r409194209", "createdAt": "2020-04-15T23:34:43Z", "author": {"login": "gjwatts"}, "path": "vertx-db2-client/src/main/java/io/vertx/db2client/impl/drda/DRDAQueryRequest.java", "diffHunk": "@@ -1215,11 +1227,17 @@ private Hashtable computeProtocolTypesAndLengths(\n                     }\n                     break;\n                 case Types.LONGVARBINARY:\n-                    ba = (byte[]) inputRow[i];\n-                    if (ba == null) {\n+//                    ba = (byte[]) inputRow[i];\n+                \tlength = -1;\n+                \tif (inputRow[i] instanceof byte[]) {\n+                \t\tlength = ((byte[]) inputRow[i]).length;\n+                \t} else if (inputRow[i] instanceof ByteBuf) {\n+                \t\tlength = ((ByteBuf) inputRow[i]).readableBytes();\n+                \t}\n+                    if (inputRow[i] == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2639d7426277b4f91977e0e1907631419eec6eb0"}, "originalPosition": 74}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4477, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}