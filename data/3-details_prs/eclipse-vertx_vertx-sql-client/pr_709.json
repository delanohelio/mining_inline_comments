{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MDUzNjYz", "number": 709, "title": "MySQL Client: Unix Domain Socket support", "bodyText": "Resolves #521", "createdAt": "2020-07-03T13:16:58Z", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/709", "merged": true, "mergeCommit": {"oid": "daea3fa3ee65cd3b120161b724d6e5af36079766"}, "closed": true, "closedAt": "2020-07-08T10:15:54Z", "author": {"login": "tsegismont"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxctjQAFqTQ0MjU3NjM3OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcy3p4OgH2gAyNDQ0MDUzNjYzOjg5ZTRlYWIwM2EzMDYwNTNkODQ0MjRiMTQ5ZDI5MjY5ZDNjZjg1ODk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNTc2Mzc5", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/709#pullrequestreview-442576379", "createdAt": "2020-07-04T00:09:10Z", "commit": {"oid": "08081b7bdd77f2c0b14026b027b65ab033294e6c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwMDowOToxMFrOGs43WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwMDoxMDoxMFrOGs43tA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyMjIwMQ==", "bodyText": "Are we going this way which is different from the usage of postgres client(using host+port)?\nThe socket is MySQL specific property, how about keep representing the unix socket path with host field but add additional support for automatically converting socket to host in URL parser?", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/709#discussion_r449722201", "createdAt": "2020-07-04T00:09:10Z", "author": {"login": "BillyYccc"}, "path": "vertx-mysql-client/src/main/java/io/vertx/mysqlclient/MySQLConnectOptions.java", "diffHunk": "@@ -544,4 +547,16 @@ public JsonObject toJson() {\n     MySQLConnectOptionsConverter.toJson(this, json);\n     return json;\n   }\n+\n+  @GenIgnore\n+  @Override\n+  public SocketAddress getSocketAddress() {\n+    String path = getProperties().get(\"socket\");\n+    return path != null ? SocketAddress.domainSocketAddress(path) : super.getSocketAddress();\n+  }\n+\n+  @GenIgnore\n+  public boolean isUsingDomainSocket() {\n+    return this.getProperties().containsKey(\"socket\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08081b7bdd77f2c0b14026b027b65ab033294e6c"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyMjI5Mg==", "bodyText": "pgConnection should be renamed in this class", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/709#discussion_r449722292", "createdAt": "2020-07-04T00:10:10Z", "author": {"login": "BillyYccc"}, "path": "vertx-mysql-client/src/test/java/io/vertx/mysqlclient/MySQLUnixDomainSocketTest.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/*\n+ * Copyright (c) 2011-2020 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+package io.vertx.mysqlclient;\n+\n+import io.vertx.core.Vertx;\n+import io.vertx.core.VertxOptions;\n+import io.vertx.ext.unit.Async;\n+import io.vertx.ext.unit.TestContext;\n+import io.vertx.ext.unit.junit.VertxUnitRunner;\n+import io.vertx.sqlclient.PoolOptions;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.testcontainers.shaded.org.apache.commons.lang.SystemUtils;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLEncoder;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assume.assumeTrue;\n+\n+@RunWith(VertxUnitRunner.class)\n+public class MySQLUnixDomainSocketTest {\n+\n+  private static final String unixSocketDirectory = System.getProperty(\"unix.socket.directory\");\n+\n+  private MySQLPool client;\n+  private MySQLConnectOptions options;\n+\n+  @Before\n+  public void before() {\n+    assumeTrue(SystemUtils.IS_OS_UNIX);\n+    options = new MySQLConnectOptions()\n+      .setUser(\"root\")\n+      .setPassword(\"password\");\n+    if (unixSocketDirectory != null && !unixSocketDirectory.isEmpty()) {\n+      options.addProperty(\"socket\", unixSocketDirectory);\n+    }\n+    assumeTrue(options.isUsingDomainSocket());\n+  }\n+\n+  @After\n+  public void after() {\n+    if (client != null) {\n+      client.close();\n+    }\n+  }\n+\n+  @Test\n+  public void uriTest(TestContext context) throws UnsupportedEncodingException {\n+    String path = URLEncoder.encode(options.getProperties().get(\"socket\"), \"UTF-8\");\n+    String uri = \"mysql://root:password@localhost?socket=\" + path;\n+    client = MySQLPool.pool(uri);\n+    client.getConnection(context.asyncAssertSuccess(pgConnection -> pgConnection.close()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08081b7bdd77f2c0b14026b027b65ab033294e6c"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec1c9ec75630bd82f9bd3f76ce3673b3dbfc4fb2", "author": {"user": {"login": "tsegismont", "name": "Thomas Segismont"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/ec1c9ec75630bd82f9bd3f76ce3673b3dbfc4fb2", "committedDate": "2020-07-06T13:22:40Z", "message": "MySQL Client: Unix Domain Socket support\n\nResolves #521\n\nSigned-off-by: Thomas Segismont <tsegismont@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b8fc56056c90d3ac358c8000cfa6202cc73171e7", "author": {"user": {"login": "tsegismont", "name": "Thomas Segismont"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/b8fc56056c90d3ac358c8000cfa6202cc73171e7", "committedDate": "2020-07-06T09:44:10Z", "message": "Renaming variables in MySQLUnixDomainSocketTest\n\nSigned-off-by: Thomas Segismont <tsegismont@gmail.com>"}, "afterCommit": {"oid": "ec1c9ec75630bd82f9bd3f76ce3673b3dbfc4fb2", "author": {"user": {"login": "tsegismont", "name": "Thomas Segismont"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/ec1c9ec75630bd82f9bd3f76ce3673b3dbfc4fb2", "committedDate": "2020-07-06T13:22:40Z", "message": "MySQL Client: Unix Domain Socket support\n\nResolves #521\n\nSigned-off-by: Thomas Segismont <tsegismont@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4ef0b7e9b9ecfad6c4e39c99ce6436b37bfecd4", "author": {"user": {"login": "tsegismont", "name": "Thomas Segismont"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/c4ef0b7e9b9ecfad6c4e39c99ce6436b37bfecd4", "committedDate": "2020-07-06T14:27:59Z", "message": "Documentation for MySQL Unix Domain Socket support\n\nSigned-off-by: Thomas Segismont <tsegismont@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMTg2OTg0", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/709#pullrequestreview-443186984", "createdAt": "2020-07-06T15:34:26Z", "commit": {"oid": "c4ef0b7e9b9ecfad6c4e39c99ce6436b37bfecd4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNTozNDoyN1rOGtcf1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNTozODoyOVrOGtcqUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDMwNjAwNg==", "bodyText": "can we get rid of such shaded dependency of TestContainers?", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/709#discussion_r450306006", "createdAt": "2020-07-06T15:34:27Z", "author": {"login": "BillyYccc"}, "path": "vertx-mysql-client/src/test/java/io/vertx/mysqlclient/MySQLUnixDomainSocketTest.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Copyright (c) 2011-2020 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+package io.vertx.mysqlclient;\n+\n+import io.vertx.core.Vertx;\n+import io.vertx.core.VertxOptions;\n+import io.vertx.ext.unit.Async;\n+import io.vertx.ext.unit.TestContext;\n+import io.vertx.ext.unit.junit.VertxUnitRunner;\n+import io.vertx.sqlclient.PoolOptions;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.testcontainers.shaded.org.apache.commons.lang.SystemUtils;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4ef0b7e9b9ecfad6c4e39c99ce6436b37bfecd4"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDMwODY4OA==", "bodyText": "Unix is ambiguous here and we also haven't determined how we test in OS X environment with Docker.", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/709#discussion_r450308688", "createdAt": "2020-07-06T15:38:29Z", "author": {"login": "BillyYccc"}, "path": "vertx-mysql-client/src/test/java/io/vertx/mysqlclient/MySQLUnixDomainSocketTest.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Copyright (c) 2011-2020 Contributors to the Eclipse Foundation\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0, or the Apache License, Version 2.0\n+ * which is available at https://www.apache.org/licenses/LICENSE-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+ */\n+package io.vertx.mysqlclient;\n+\n+import io.vertx.core.Vertx;\n+import io.vertx.core.VertxOptions;\n+import io.vertx.ext.unit.Async;\n+import io.vertx.ext.unit.TestContext;\n+import io.vertx.ext.unit.junit.VertxUnitRunner;\n+import io.vertx.sqlclient.PoolOptions;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.testcontainers.shaded.org.apache.commons.lang.SystemUtils;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLEncoder;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assume.assumeTrue;\n+\n+@RunWith(VertxUnitRunner.class)\n+public class MySQLUnixDomainSocketTest {\n+\n+  private static final String unixSocketFile = System.getProperty(\"unix.socket.file\");\n+\n+  private MySQLPool client;\n+  private MySQLConnectOptions options;\n+\n+  @Before\n+  public void before() {\n+    assumeTrue(SystemUtils.IS_OS_UNIX);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4ef0b7e9b9ecfad6c4e39c99ce6436b37bfecd4"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e03f505b4d7772883d580002febe0d58dbae03d5", "author": {"user": {"login": "tsegismont", "name": "Thomas Segismont"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/e03f505b4d7772883d580002febe0d58dbae03d5", "committedDate": "2020-07-06T16:00:37Z", "message": "Automate MySQLUnixDomainSocketTest on Linux\n\nSigned-off-by: Thomas Segismont <tsegismont@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9df6e45a7506f82163aee90cedd8e96806408d1f", "author": {"user": {"login": "tsegismont", "name": "Thomas Segismont"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/9df6e45a7506f82163aee90cedd8e96806408d1f", "committedDate": "2020-07-06T16:06:24Z", "message": "Don't use SystemUtils shaded dependency\n\nSigned-off-by: Thomas Segismont <tsegismont@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjQ4MjM4", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/709#pullrequestreview-443248238", "createdAt": "2020-07-06T16:50:16Z", "commit": {"oid": "9df6e45a7506f82163aee90cedd8e96806408d1f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NTI0NTU0", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/709#pullrequestreview-444524554", "createdAt": "2020-07-08T08:30:29Z", "commit": {"oid": "9df6e45a7506f82163aee90cedd8e96806408d1f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwODozMDozMFrOGudqYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwODozMDozMFrOGudqYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM3MzY2Nw==", "bodyText": "can you add a link to how a section of MySQL doc about domain sockets ?", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/709#discussion_r451373667", "createdAt": "2020-07-08T08:30:30Z", "author": {"login": "vietj"}, "path": "vertx-mysql-client/src/main/asciidoc/index.adoc", "diffHunk": "@@ -91,6 +92,45 @@ You can easily get one from the pool:\n \n Once you are done with the connection you must close it to release it to the pool, so it can be reused.\n \n+=== Unix Domain Socket\n+\n+Sometimes for simplicity, security or performance reasons, it is required to connect via a Unix Domain Socket.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9df6e45a7506f82163aee90cedd8e96806408d1f"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NTI2MDU1", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/709#pullrequestreview-444526055", "createdAt": "2020-07-08T08:32:26Z", "commit": {"oid": "9df6e45a7506f82163aee90cedd8e96806408d1f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89e4eab03a306053d84424b149d29269d3cf8589", "author": {"user": {"login": "tsegismont", "name": "Thomas Segismont"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/89e4eab03a306053d84424b149d29269d3cf8589", "committedDate": "2020-07-08T10:12:49Z", "message": "Added link to MySQL server socket param documentation\n\nSigned-off-by: Thomas Segismont <tsegismont@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1506, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}