{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1MjgxNjA2", "number": 848, "title": "The close handler should be called when the sql connection is closed from a different context", "bodyText": "Signed-off-by: Billy Yuan billy112487983@gmail.com\nMotivation:\nfix #847\nConformance:\nYour commits should be signed and you should have signed the Eclipse Contributor Agreement as explained in https://github.com/eclipse/vert.x/blob/master/CONTRIBUTING.md\nPlease also make sure you adhere to the code style guidelines: https://github.com/vert-x3/wiki/wiki/Vert.x-code-style-guidelines", "createdAt": "2020-12-09T15:57:14Z", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/848", "merged": true, "mergeCommit": {"oid": "9f594c72ed76200cbd09464687658cf73286f0c9"}, "closed": true, "closedAt": "2020-12-10T07:58:59Z", "author": {"login": "BillyYccc"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkg2wogH2gAyNTM1MjgxNjA2OmQwODE3ODA2MTZjMzFiY2M5MjMxMjFlY2U4YjIwOTllYTk2YWI0NTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkn1vFAH2gAyNTM1MjgxNjA2OmNlNzNhYWU4OWY1YjUxMWUyMjJiY2ViMmM2ZDc2NTBmYTE2NGQ0NDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d081780616c31bcc923121ece8b2099ea96ab456", "author": {"user": {"login": "BillyYccc", "name": "Billy Yuan"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/d081780616c31bcc923121ece8b2099ea96ab456", "committedDate": "2020-12-09T15:55:17Z", "message": "the close handler should be called when the sql connection is closed\n\nSigned-off-by: Billy Yuan <billy112487983@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4Mzk4Mzk3", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/848#pullrequestreview-548398397", "createdAt": "2020-12-09T17:00:42Z", "commit": {"oid": "d081780616c31bcc923121ece8b2099ea96ab456"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzowMDo0M1rOICfVhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzowMDo0M1rOICfVhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ4MTQ3OA==", "bodyText": "await is not needed, vertx-unit will wait for you\nyou need to use await when there is an action to take after", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/848#discussion_r539481478", "createdAt": "2020-12-09T17:00:43Z", "author": {"login": "vietj"}, "path": "vertx-pg-client/src/test/java/io/vertx/pgclient/PgConnectionTestBase.java", "diffHunk": "@@ -462,4 +463,22 @@ public void testTransactionAbort(TestContext ctx) {\n       });\n     }));\n   }\n+\n+  @Test\n+  public void testCloseConnectionFromDifferentContext(TestContext ctx) {\n+    Async done = ctx.async(1);\n+    connector.accept(ctx.asyncAssertSuccess(conn -> {\n+      conn.query(\"SELECT 1\").execute(ctx.asyncAssertSuccess(res -> {\n+        ctx.assertEquals(1, res.size());\n+        // schedule from another context\n+        VertxInternal vertxInternal = (VertxInternal) vertx;\n+        vertxInternal.createEventLoopContext().runOnContext(v -> {\n+          conn.close(v2 -> {\n+            done.complete();\n+          });\n+        });\n+      }));\n+    }));\n+    done.await(2000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d081780616c31bcc923121ece8b2099ea96ab456"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4Mzk5MDkw", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/848#pullrequestreview-548399090", "createdAt": "2020-12-09T17:01:26Z", "commit": {"oid": "d081780616c31bcc923121ece8b2099ea96ab456"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzowMToyN1rOICfXvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNzowMToyN1rOICfXvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ4MjA0Nw==", "bodyText": "rather use a Java thread it will create another context/event loop\ni.e\nnew Thread(() -> ...) {\n}.start();", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/848#discussion_r539482047", "createdAt": "2020-12-09T17:01:27Z", "author": {"login": "vietj"}, "path": "vertx-pg-client/src/test/java/io/vertx/pgclient/PgConnectionTestBase.java", "diffHunk": "@@ -462,4 +463,22 @@ public void testTransactionAbort(TestContext ctx) {\n       });\n     }));\n   }\n+\n+  @Test\n+  public void testCloseConnectionFromDifferentContext(TestContext ctx) {\n+    Async done = ctx.async(1);\n+    connector.accept(ctx.asyncAssertSuccess(conn -> {\n+      conn.query(\"SELECT 1\").execute(ctx.asyncAssertSuccess(res -> {\n+        ctx.assertEquals(1, res.size());\n+        // schedule from another context", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d081780616c31bcc923121ece8b2099ea96ab456"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce73aae89f5b511e222bceb2c6d7650fa164d448", "author": {"user": {"login": "BillyYccc", "name": "Billy Yuan"}}, "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/ce73aae89f5b511e222bceb2c6d7650fa164d448", "committedDate": "2020-12-10T00:03:30Z", "message": "update according to reviews\n\nSigned-off-by: Billy Yuan <billy112487983@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1542, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}