{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NjI1MzQ4", "number": 366, "title": "Documentation for simple query", "bodyText": "Issue #, if available: #363\nDescription of changes: This is the 2nd phase of Automated Documentation work. In this PR, we add doc for simple SELECT query. And we introduce railroad diagram (RDD) to illustrate our syntax. The RDD used is generated by https://github.com/bkiers/rrd-antlr4.\nReviewer: To make CR easier, please have a look at the rendered docs on GitHub: https://github.com/dai-chen/sql/blob/documentation-for-simple-query/docs/user/dql/basics.rst\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-02-13T01:35:43Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/366", "merged": true, "mergeCommit": {"oid": "57b379c9e5f788716198a10bfbd1f611d60c6942"}, "closed": true, "closedAt": "2020-02-17T17:56:32Z", "author": {"login": "dai-chen"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_kdH2gH2gAyMzc0NjI1MzQ4OjUyMjkzNjcyYzBiZDEwMGYzZWNmZDMxYWM5OGQ4ZTQwOTgzYWE3NjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEHgcSgFqTM1ODcwMjEyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "52293672c0bd100f3ecfd31ac98d8e40983aa765", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/52293672c0bd100f3ecfd31ac98d8e40983aa765", "committedDate": "2020-01-31T01:00:33Z", "message": "Add doc test for simple query"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6aba9a61010a83131098d952d562210903071a8", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c6aba9a61010a83131098d952d562210903071a8", "committedDate": "2020-01-31T01:05:49Z", "message": "Add to index"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a66a46b7451a3b6553684996da4781be0e6c2197", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a66a46b7451a3b6553684996da4781be0e6c2197", "committedDate": "2020-01-31T01:14:13Z", "message": "Fix format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "021d0aa7a7feb31c060ac259cf72a06801e69f3c", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/021d0aa7a7feb31c060ac259cf72a06801e69f3c", "committedDate": "2020-02-05T00:26:14Z", "message": "Add documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef158120507343f92b85e397e17ead42fafa81cb", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ef158120507343f92b85e397e17ead42fafa81cb", "committedDate": "2020-02-05T00:45:27Z", "message": "Add documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cda2834e46fd12ec9d395bc22f72bc1cbc59803", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/4cda2834e46fd12ec9d395bc22f72bc1cbc59803", "committedDate": "2020-02-05T00:52:44Z", "message": "Add documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9ab6c8d1104121b282a5068ad68ef7fda6e0b6c", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b9ab6c8d1104121b282a5068ad68ef7fda6e0b6c", "committedDate": "2020-02-05T00:54:18Z", "message": "Add documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30476fd9fa4c2aa779efea5133042ec4b28a645c", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/30476fd9fa4c2aa779efea5133042ec4b28a645c", "committedDate": "2020-02-05T01:03:53Z", "message": "Add documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1275fa1541be3cabdcd30036cf418f6d6aaa5de9", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/1275fa1541be3cabdcd30036cf418f6d6aaa5de9", "committedDate": "2020-02-05T01:32:54Z", "message": "Add documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4345f6f7b87df5baae9446eb647c4d6299376bd1", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/4345f6f7b87df5baae9446eb647c4d6299376bd1", "committedDate": "2020-02-05T19:01:22Z", "message": "Add documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e49ffc489c9277b3d2e4398ffc2510ac2285cc5c", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e49ffc489c9277b3d2e4398ffc2510ac2285cc5c", "committedDate": "2020-02-05T19:14:56Z", "message": "Add documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85b96d90cb0feb88e43e3da3fd77907c78d78ce9", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/85b96d90cb0feb88e43e3da3fd77907c78d78ce9", "committedDate": "2020-02-05T19:47:06Z", "message": "Add documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "192ee559d0b16e2a53fa0f0ea2ae63544242b8a9", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/192ee559d0b16e2a53fa0f0ea2ae63544242b8a9", "committedDate": "2020-02-05T21:44:04Z", "message": "Add documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4778d8df2900490718b2ffd4d3ff8340bc674d7", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f4778d8df2900490718b2ffd4d3ff8340bc674d7", "committedDate": "2020-02-05T22:34:41Z", "message": "Add rdd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78a40fa4767370b18d5e8ae8abe430954f0ce999", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/78a40fa4767370b18d5e8ae8abe430954f0ce999", "committedDate": "2020-02-05T22:37:49Z", "message": "Add rdd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39117dd352cd5a48b43b578871df43b21835a188", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/39117dd352cd5a48b43b578871df43b21835a188", "committedDate": "2020-02-06T00:01:17Z", "message": "Add rdd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "223537daa2491eb153fe11210e74e269f603bc45", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/223537daa2491eb153fe11210e74e269f603bc45", "committedDate": "2020-02-06T00:20:15Z", "message": "Add rdd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "543df9372da2aa3b9dc326bb3dcc104fc936ff5c", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/543df9372da2aa3b9dc326bb3dcc104fc936ff5c", "committedDate": "2020-02-12T00:48:01Z", "message": "Fix order by example"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ecdafdd9bd9bac1852e654147b4735373c529de", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/0ecdafdd9bd9bac1852e654147b4735373c529de", "committedDate": "2020-02-12T23:36:13Z", "message": "Add more diagrams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b534386d29e5efe5808c1be42b4ad8b7493bec8", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2b534386d29e5efe5808c1be42b4ad8b7493bec8", "committedDate": "2020-02-13T01:14:37Z", "message": "Add more diagrams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a957a12431cdfbb71cf00469e97b848330d0956", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7a957a12431cdfbb71cf00469e97b848330d0956", "committedDate": "2020-02-13T18:04:00Z", "message": "Skip doctest in gradlew build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDg5NDgz", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/366#pullrequestreview-358489483", "createdAt": "2020-02-13T19:26:43Z", "commit": {"oid": "7a957a12431cdfbb71cf00469e97b848330d0956"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOToyNjo0M1rOFpgpig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOToyNjo0M1rOFpgpig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3MDg1OA==", "bodyText": "minor, Implement Ordering seems much readable.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/366#discussion_r379070858", "createdAt": "2020-02-13T19:26:43Z", "author": {"login": "penghuo"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/sql/doctest/core/response/SqlResponseFormat.java", "diffHunk": "@@ -84,4 +73,63 @@ public String format(SqlResponse sqlResponse) {\n      */\n     public abstract String format(SqlResponse sqlResponse);\n \n+    /**\n+     * Note that we put this format() here because it's shared by two format enums.\n+     * @param sqlResponse   original response from plugin\n+     * @param isSorted      true to sort the result or just leave it as is\n+     */\n+    protected String format(SqlResponse sqlResponse, boolean isSorted) {\n+        JSONObject body = new JSONObject(sqlResponse.body());\n+        if (body.isNull(\"schema\")) {\n+            throw new IllegalStateException(\n+                \"Only JDBC response can be formatted to table: \" + sqlResponse.body());\n+        }\n+\n+        Object[] header = parseHeader(body.getJSONArray(\"schema\"));\n+        List<Object[]> rows = parseDataRows(body.getJSONArray(\"datarows\"), isSorted);\n+\n+        DataTable table = new DataTable(header);\n+        for (Object[] row : rows) {\n+            table.addRow(row);\n+        }\n+        return table.toString();\n+    }\n+\n+    private Object[] parseHeader(JSONArray schema) {\n+        Object[] header = new Object[schema.length()];\n+        for (int i = 0; i < header.length; i++) {\n+            JSONObject nameType = schema.getJSONObject(i);\n+            header[i] = nameType.optString(\"alias\", nameType.getString(\"name\"));\n+        }\n+        return header;\n+    }\n+\n+    private List<Object[]> parseDataRows(JSONArray rows, boolean isSorted) {\n+        List<Object[]> rowsToSort = new ArrayList<>();\n+        for (Object row : rows) {\n+            rowsToSort.add(((JSONArray) row).toList().toArray());\n+        }\n+\n+        if (isSorted) {\n+            sort(rowsToSort);\n+        }\n+        return rowsToSort;\n+    }\n+\n+    @SuppressWarnings({\"rawtypes\", \"unchecked\"})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a957a12431cdfbb71cf00469e97b848330d0956"}, "originalPosition": 90}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDg5ODIy", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/366#pullrequestreview-358489822", "createdAt": "2020-02-13T19:27:11Z", "commit": {"oid": "7a957a12431cdfbb71cf00469e97b848330d0956"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTU4OTM5", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/366#pullrequestreview-358558939", "createdAt": "2020-02-13T21:20:21Z", "commit": {"oid": "7a957a12431cdfbb71cf00469e97b848330d0956"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NzAyMTI3", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/366#pullrequestreview-358702127", "createdAt": "2020-02-14T04:06:33Z", "commit": {"oid": "7a957a12431cdfbb71cf00469e97b848330d0956"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 748, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}