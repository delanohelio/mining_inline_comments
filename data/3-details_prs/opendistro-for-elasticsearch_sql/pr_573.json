{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NTM3NjU0", "number": 573, "title": "Support SELECT * and FROM clause in new SQL parser", "bodyText": "Issue #, if available: #575, #504, #322\nDescription of changes: Change SQL grammar to integrate with new engine and support SELECT * and FROM clause.\n\nChange SQL grammar: split identifier rule to an individual file so it can be overridden in fuzzy testing.\nBuild Relation node and QualifiedName expression in AST builder.\n\nTesting: Add new UT and IT for different types of identifier (index name). Because of problem with date, text and keyword in JDBC driver, select * is not added to comparison test.\nNote a major change on integration test: A new integTestWithNewEngine task is added to run PPL and new, legacy, comparison SQL ITs with new engine enabled. The integTest depends on it and only runs legacy SQL ITs with new engine disabled. Because more and more SQL queries will start being handled by new engine after FROM clause added, this makes sure that our legacy ITs can work with/without new engine enabled.\nDocumentation: Checked out MySQL, SQLServer and ANSI SQL and organize our doc in this way: https://github.com/dai-chen/sql/blob/support-select-all-from/docs/user/general/identifiers.rst\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-07-13T22:41:41Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/573", "merged": true, "mergeCommit": {"oid": "0a878aba438a0edeeb946f4c879d9bbd61b4a7da"}, "closed": true, "closedAt": "2020-07-21T17:55:43Z", "author": {"login": "dai-chen"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcypr8UAH2gAyNDQ4NTM3NjU0OmFlZjY4MWIwMWFkMWFjMGY3MDk5MjRiNWMzNDQ3ZDlhOGFmZDk4YWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3J418gH2gAyNDQ4NTM3NjU0OjZhMzNlNjljZTIzOWNkMTJkNmI2MWZiMTYxMWVmYWYzMTkxM2E4YTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aef681b01ad1ac0f709924b5c3447d9a8afd98ad", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/aef681b01ad1ac0f709924b5c3447d9a8afd98ad", "committedDate": "2020-07-07T17:56:24Z", "message": "Support from"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbb8caa8e674bb7794f6aff338364f117eb8434b", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/bbb8caa8e674bb7794f6aff338364f117eb8434b", "committedDate": "2020-07-07T18:40:57Z", "message": "Add more UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6848f9712bbc8dadaa2d42a006a1d7de6b1cdede", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6848f9712bbc8dadaa2d42a006a1d7de6b1cdede", "committedDate": "2020-07-08T21:59:29Z", "message": "Merge branch 'develop' into support-select-all-from"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d89a3553f4ef4333cda8973119c1846b0136790", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2d89a3553f4ef4333cda8973119c1846b0136790", "committedDate": "2020-07-08T22:11:12Z", "message": "Merge branch 'develop' into support-select-all-from"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bde1b51198388911e7f8a07a687f74bd711315ee", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/bde1b51198388911e7f8a07a687f74bd711315ee", "committedDate": "2020-07-10T20:57:57Z", "message": "Merge branch 'develop' into support-select-all-from"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92fe877d2e5244b29343468ac913a199d6b863e0", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/92fe877d2e5244b29343468ac913a199d6b863e0", "committedDate": "2020-07-13T16:14:12Z", "message": "Update doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dc8a0e8806299f635370b7bc6f8f8a214181032", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7dc8a0e8806299f635370b7bc6f8f8a214181032", "committedDate": "2020-07-13T16:17:59Z", "message": "Merge branch 'develop' into support-select-all-from"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "683d53bab9fee01afde16f18b1dc279a9869636e", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/683d53bab9fee01afde16f18b1dc279a9869636e", "committedDate": "2020-07-13T18:41:44Z", "message": "Update doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fffdd0599f163585fae2b6e02f41889cde312f4", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/9fffdd0599f163585fae2b6e02f41889cde312f4", "committedDate": "2020-07-13T18:49:30Z", "message": "Merge branch 'develop' into support-select-all-from"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae3d756b89c944a0b2a4a9e16d84ec83bccba812", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ae3d756b89c944a0b2a4a9e16d84ec83bccba812", "committedDate": "2020-07-13T20:23:40Z", "message": "Add doctest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a17651fcbd19b84e785c7b63e393356b24cb23bb", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a17651fcbd19b84e785c7b63e393356b24cb23bb", "committedDate": "2020-07-13T22:17:32Z", "message": "Add IT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af1422f9fa73e5ece00d9932e195b19991786a70", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/af1422f9fa73e5ece00d9932e195b19991786a70", "committedDate": "2020-07-15T00:43:55Z", "message": "Change doc and grammar for ANSI SQL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f32dcb9f4b483ed0b8772d0d9da6c3394454621d", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f32dcb9f4b483ed0b8772d0d9da6c3394454621d", "committedDate": "2020-07-15T18:43:03Z", "message": "Change doc and grammar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f98057f2266a5e0d52580c60d6f30f63e4e6314", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3f98057f2266a5e0d52580c60d6f30f63e4e6314", "committedDate": "2020-07-15T18:54:26Z", "message": "Split grammar file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54d772288d6c94f28358e8a2f727155966953db7", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/54d772288d6c94f28358e8a2f727155966953db7", "committedDate": "2020-07-15T22:52:03Z", "message": "Prepare PR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6bb2895520c35ad810bbbe6a4f39f6afdd68efa", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b6bb2895520c35ad810bbbe6a4f39f6afdd68efa", "committedDate": "2020-07-15T23:15:24Z", "message": "Prepare PR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b2d2129898464d567d55f84a8a85d1568d34f44", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/8b2d2129898464d567d55f84a8a85d1568d34f44", "committedDate": "2020-07-16T17:50:39Z", "message": "Run IT with/without new engine"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMjc2MDM1", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/573#pullrequestreview-450276035", "createdAt": "2020-07-16T23:12:23Z", "commit": {"oid": "b6bb2895520c35ad810bbbe6a4f39f6afdd68efa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzoxMjoyM1rOGy_3XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzoxMjoyM1rOGy_3XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyODM0OA==", "bodyText": "could you add test with single quota identifier, e.g. SELECT * FROM 'hello+world'", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/573#discussion_r456128348", "createdAt": "2020-07-16T23:12:23Z", "author": {"login": "penghuo"}, "path": "sql/src/test/java/com/amazon/opendistroforelasticsearch/sql/sql/antlr/SQLSyntaxParserTest.java", "diffHunk": "@@ -29,13 +28,36 @@\n \n   @Test\n   public void canParseSelectLiterals() {\n-    ParseTree parseTree = parser.parse(\"SELECT 123, 'hello'\");\n-    assertNotNull(parseTree);\n+    assertNotNull(parser.parse(\"SELECT 123, 'hello'\"));\n+  }\n+\n+  @Test\n+  public void canParseIndexNameWithDate() {\n+    assertNotNull(parser.parse(\"SELECT * FROM logs_2020_01\"));\n+    assertNotNull(parser.parse(\"SELECT * FROM logs-2020-01\"));\n+  }\n+\n+  @Test\n+  public void canParseHiddenIndexName() {\n+    assertNotNull(parser.parse(\"SELECT * FROM .kibana\"));\n+  }\n+\n+  @Test\n+  public void canNotParseIndexNameWithSpecialChar() {\n+    assertThrows(SyntaxCheckException.class,\n+        () -> parser.parse(\"SELECT * FROM hello+world\"));\n+  }\n+\n+  @Test\n+  public void canParseIndexNameWithSpecialCharQuoted() {\n+    assertNotNull(parser.parse(\"SELECT * FROM `hello+world`\"));\n+    assertNotNull(parser.parse(\"SELECT * FROM \\\"hello$world\\\"\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6bb2895520c35ad810bbbe6a4f39f6afdd68efa"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMjc2Mjg5", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/573#pullrequestreview-450276289", "createdAt": "2020-07-16T23:13:07Z", "commit": {"oid": "b6bb2895520c35ad810bbbe6a4f39f6afdd68efa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzoxMzowOFrOGy_4Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzoxMzowOFrOGy_4Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyODU3MQ==", "bodyText": "what is the difference between back ticks and double quotation?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/573#discussion_r456128571", "createdAt": "2020-07-16T23:13:08Z", "author": {"login": "penghuo"}, "path": "docs/user/general/identifiers.rst", "diffHunk": "@@ -0,0 +1,108 @@\n+===========\n+Identifiers\n+===========\n+\n+.. rubric:: Table of contents\n+\n+.. contents::\n+   :local:\n+   :depth: 2\n+\n+\n+Introduction\n+============\n+\n+Identifiers are used for naming your database objects, such as index name, field name etc. Basically there are two types of identifiers: regular identifiers and delimited identifiers.\n+\n+\n+Regular Identifiers\n+===================\n+\n+Description\n+-----------\n+\n+According to ANSI SQL standard, a regular identifier can start with ASCII letter (lower or upper case) or digit. The subsequent character can consist of letter, digit, underscore (``_``). It cannot be a reversed key word. And whitespace and other special characters are not allowed. In our SQL parser, we make extension to the rule for Elasticsearch storage as shown in next sub-section.\n+\n+Extensions\n+----------\n+\n+Additionally for Elasticsearch, the following identifiers are supported extensionally by our SQL parser for convenience (without the need of being delimited as shown in next section):\n+\n+1. Identifiers prefixed by dot ``.``: this is called hidden index in Elasticsearch, for example ``.kibana``.\n+2. Identifiers prefixed by at sign ``@``: this is common for meta fields generated in Logstash ingestion.\n+3. Identifiers with ``-`` in the middle: this is mostly the case for index name with date information.\n+4. Identifiers with star ``*`` present: this is mostly an index pattern for wildcard match.\n+\n+Examples\n+--------\n+\n+Here are examples for using index pattern directly without quotes::\n+\n+    od> SELECT * FROM *cc*nt*;\n+    fetched rows / total rows = 4/4\n+    +------------------+-------------+----------------------+-----------+----------+--------+------------+---------+-------+-----------------------+------------+\n+    | account_number   | firstname   | address              | balance   | gender   | city   | employer   | state   | age   | email                 | lastname   |\n+    |------------------+-------------+----------------------+-----------+----------+--------+------------+---------+-------+-----------------------+------------|\n+    | 1                | Amber       | 880 Holmes Lane      | 39225     | M        | Brogan | Pyrami     | IL      | 32    | amberduke@pyrami.com  | Duke       |\n+    | 6                | Hattie      | 671 Bristol Street   | 5686      | M        | Dante  | Netagy     | TN      | 36    | hattiebond@netagy.com | Bond       |\n+    | 13               | Nanette     | 789 Madison Street   | 32838     | F        | Nogal  | Quility    | VA      | 28    | null                  | Bates      |\n+    | 18               | Dale        | 467 Hutchinson Court | 4180      | M        | Orick  | null       | MD      | 33    | daleadams@boink.com   | Adams      |\n+    +------------------+-------------+----------------------+-----------+----------+--------+------------+---------+-------+-----------------------+------------+\n+\n+\n+Delimited Identifiers\n+=====================\n+\n+Description\n+-----------\n+\n+A delimited identifier is an identifier enclosed in back ticks ````` or double quotation marks ``\"``. In this case, the identifier enclosed is not necessarily a regular identifier. In other words, it can contain any special character not allowed by regular identifier.\n+\n+Please note the difference between single quote and double quotes in SQL syntax. The former is used to enclose a string literal while the latter is for escaping special characters in an identifier.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6bb2895520c35ad810bbbe6a4f39f6afdd68efa"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwOTExNjA3", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/573#pullrequestreview-450911607", "createdAt": "2020-07-17T19:37:36Z", "commit": {"oid": "8b2d2129898464d567d55f84a8a85d1568d34f44"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85c4b051b8751b62f6cda20e5fb021910cb2db55", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/85c4b051b8751b62f6cda20e5fb021910cb2db55", "committedDate": "2020-07-20T18:44:45Z", "message": "Address PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe867f42f291f818e0313c4b9e034c74bc044ea5", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/fe867f42f291f818e0313c4b9e034c74bc044ea5", "committedDate": "2020-07-20T19:07:06Z", "message": "Address PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e18ee9c91bce002b7139764ddbf12783dc9d7f94", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e18ee9c91bce002b7139764ddbf12783dc9d7f94", "committedDate": "2020-07-20T19:23:17Z", "message": "Merge branch 'develop' into support-select-all-from"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNjY3NTAz", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/573#pullrequestreview-452667503", "createdAt": "2020-07-21T17:14:37Z", "commit": {"oid": "e18ee9c91bce002b7139764ddbf12783dc9d7f94"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a33e69ce239cd12d6b61fb1611efaf31913a8a2", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6a33e69ce239cd12d6b61fb1611efaf31913a8a2", "committedDate": "2020-07-21T17:43:09Z", "message": "Merge branch 'develop' into support-select-all-from"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 718, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}