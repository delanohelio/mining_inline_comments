{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyOTY1ODIz", "number": 429, "title": "[PPL] Create ANTLR parser and implement basic syntax - Phase0", "bodyText": "Issue #, if available:\nDescription of changes:\n\nImplemeted AST builder for commands in phase0, with basic syntax.\nAdded unit tests\nTODO: investigate the feasibility to implement the rest part of syntax in these commands; enrich the AST draft with complete syntax that P0 should achieve\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-04-14T04:44:17Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429", "merged": true, "mergeCommit": {"oid": "ded0421c435977e2fc64ba5161bf007a6deca33b"}, "closed": true, "closedAt": "2020-04-23T20:40:52Z", "author": {"login": "chloe-zh"}, "timelineItems": {"totalCount": 38, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVC9RxAH2gAyNDAyOTY1ODIzOjhhNDRjZmMzZTEyNDZkM2YzOTAxMmFhNWU0NzZmNWU1NzE3YTAxYzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcai_F-AH2gAyNDAyOTY1ODIzOjBjNzhlZmE0YzY2MTdmNmY5NGJiNjJlZTNmOTgxNTI5ODliMzNmNDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8a44cfc3e1246d3f39012aa5e476f5e5717a01c4", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/8a44cfc3e1246d3f39012aa5e476f5e5717a01c4", "committedDate": "2020-04-06T18:25:14Z", "message": "m"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "204bb818b31ba0e2726f2cfc9c7b3a27e4994515", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/204bb818b31ba0e2726f2cfc9c7b3a27e4994515", "committedDate": "2020-04-09T04:45:46Z", "message": "Merge branch 'feature/ppl' of github.com:opendistro-for-elasticsearch/sql into ppl-parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bfdb2844147556cd37a51a325f1f599ec9b4ab5", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3bfdb2844147556cd37a51a325f1f599ec9b4ab5", "committedDate": "2020-04-09T17:10:56Z", "message": "Added antlr files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2f63c040031556f3ad154c09ae996c9b34b55ec", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c2f63c040031556f3ad154c09ae996c9b34b55ec", "committedDate": "2020-04-10T01:05:24Z", "message": "Merge remote-tracking branch 'upstream/feature/ppl' into ppl-parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "084f380ec79e76c8665e780f40e921564ba33b8d", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/084f380ec79e76c8665e780f40e921564ba33b8d", "committedDate": "2020-04-12T00:40:23Z", "message": "Added wildcard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c45b24b366fb80b3aa67e5dd68ede0f3d765d83", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/8c45b24b366fb80b3aa67e5dd68ede0f3d765d83", "committedDate": "2020-04-14T04:31:04Z", "message": "Implemented parser for commands of simple syntax"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMDAxMzA0", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-393001304", "createdAt": "2020-04-14T14:46:40Z", "commit": {"oid": "8c45b24b366fb80b3aa67e5dd68ede0f3d765d83"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDo0Njo0MFrOGFSQwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDo0Njo0MFrOGFSQwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE5NTI2NQ==", "bodyText": "why ppl need the org.elasticsearch as the dependency?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r408195265", "createdAt": "2020-04-14T14:46:40Z", "author": {"login": "penghuo"}, "path": "ppl/build.gradle", "diffHunk": "@@ -25,6 +25,9 @@ dependencies {\n     antlr \"org.antlr:antlr4:4.7.1\"\n \n     compile \"org.antlr:antlr4-runtime:4.7.1\"\n+    compile group: 'com.google.guava', name: 'guava', version:'15.0'\n+    compile group: 'org.elasticsearch', name: 'elasticsearch', version:\"${es_version}\"\n+    compile group: 'org.elasticsearch', name: 'elasticsearch-x-content', version:\"${es_version}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c45b24b366fb80b3aa67e5dd68ede0f3d765d83"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMDAyOTE4", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-393002918", "createdAt": "2020-04-14T14:48:19Z", "commit": {"oid": "8c45b24b366fb80b3aa67e5dd68ede0f3d765d83"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDo0ODoxOVrOGFSV2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDo0ODoxOVrOGFSV2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE5NjU2OQ==", "bodyText": "Remove unused imports", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r408196569", "createdAt": "2020-04-14T14:48:19Z", "author": {"login": "penghuo"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/node/NodeVisitor.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.node;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Literal;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c45b24b366fb80b3aa67e5dd68ede0f3d765d83"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6b542eb5496b0034f8506a8b15e53071d56686ad", "committedDate": "2020-04-14T16:39:34Z", "message": "addressed comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTY4MjIw", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-393168220", "createdAt": "2020-04-14T18:01:03Z", "commit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODowMTowM1rOGFaj0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxODoyODo0NlrOGFbjxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzMTIxOA==", "bodyText": "Just a reminder, we may want to avoid those issues regarding index name in SQL since the very beginning of this project, such as index name with dot or colon (some user reported CloudWatch generates such index).", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r408331218", "createdAt": "2020-04-14T18:01:03Z", "author": {"login": "dai-chen"}, "path": "ppl/src/main/antlr/OpenDistroPPLParser.g4", "diffHunk": "@@ -26,32 +26,31 @@ pplStatement\n     : searchCommand (PIPE commands)*\n     ;\n \n-\n /** commands */\n commands\n     : whereCommand | fieldsCommand | renameCommand | statsCommand | dedupCommand | sortCommand | evalCommand\n     ;\n \n searchCommand\n-    : (SEARCH)? fromClause                                          #searchWithoutFilter\n-    | (SEARCH)? fromClause logicalExpression                        #searchFromClauseLogicExpr\n-    | (SEARCH)? logicalExpression fromClause                        #searchLogicExprFromClause\n+    : (SEARCH)? fromClause                                          #searchFrom", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzMjY5MQ==", "bodyText": "Could you add JavaDoc for all public classes to document their abstractions and responsibilities?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r408332691", "createdAt": "2020-04-14T18:03:32Z", "author": {"login": "dai-chen"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/node/AbstractNodeVisitor.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.node;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.AggregateFunction;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.And;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.AttributeList;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.AttributeReference;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.EqualTo;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Function;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.In;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Literal;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Map;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Not;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Or;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.UnresolvedAttribute;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Aggregation;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Filter;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Project;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Relation;\n+\n+public class AbstractNodeVisitor<T> implements NodeVisitor<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzNzQ1Mg==", "bodyText": "Np: using static import can make this class cleaner.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r408337452", "createdAt": "2020-04-14T18:11:35Z", "author": {"login": "dai-chen"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/parser/AstBuilder.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.parser;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParserBaseVisitor;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Expression;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Map;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Aggregation;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Filter;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.LogicalPlan;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Project;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Relation;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.stream.Collectors;\n+import lombok.RequiredArgsConstructor;\n+import org.antlr.v4.runtime.tree.ParseTree;\n+\n+@RequiredArgsConstructor\n+public class AstBuilder extends OpenDistroPPLParserBaseVisitor<LogicalPlan> {\n+    private final AstExpressionBuilder expressionBuilder;\n+\n+    @Override\n+    public LogicalPlan visitPplStatement(OpenDistroPPLParser.PplStatementContext ctx) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMzOTk3Ng==", "bodyText": "Is this necessary? I assume parser has handled this?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r408339976", "createdAt": "2020-04-14T18:15:59Z", "author": {"login": "dai-chen"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/parser/AstExpressionBuilder.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.parser;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParserBaseVisitor;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.AggregateFunction;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.And;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.AttributeList;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.DataType;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.EqualTo;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Expression;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Function;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.In;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Literal;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Not;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Or;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.UnresolvedAttribute;\n+import java.util.stream.Collectors;\n+\n+public class AstExpressionBuilder extends OpenDistroPPLParserBaseVisitor<Expression> {\n+    /** Logical expression excluding boolean, eval, comparison */\n+    @Override\n+    public Expression visitLogicalNot(OpenDistroPPLParser.LogicalNotContext ctx) {\n+        return new Not(visit(ctx.logicalExpression()));\n+    }\n+\n+    @Override\n+    public Expression visitLogicalOr(OpenDistroPPLParser.LogicalOrContext ctx) {\n+        return new Or(visit(ctx.left), visit(ctx.right));\n+    }\n+\n+    @Override\n+    public Expression visitLogicalAnd(OpenDistroPPLParser.LogicalAndContext ctx) {\n+        return new And(visit(ctx.left), visit(ctx.right));\n+    }\n+\n+\n+    /** Eval expression */\n+    @Override\n+    public Expression visitEvalExpression(OpenDistroPPLParser.EvalExpressionContext ctx) {\n+        Expression field = visit(ctx.fieldExpression());\n+        Expression evalFunctionCall = visit(ctx.evalFunctionCall());\n+        return new EqualTo(field, evalFunctionCall);\n+    }\n+\n+    /** Comparison expression */\n+    @Override\n+    public Expression visitCompareExpr(OpenDistroPPLParser.CompareExprContext ctx) {\n+        Expression field = visit(ctx.left);\n+        Expression value = visit(ctx.right);\n+        String operator = ctx.comparisonOperator().getText();\n+        switch (operator.replaceAll(\"\\\\s\",\"\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM0MDMyMg==", "bodyText": "Why not just remove it from grammar?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r408340322", "createdAt": "2020-04-14T18:16:38Z", "author": {"login": "dai-chen"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/parser/AstExpressionBuilder.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.parser;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParserBaseVisitor;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.AggregateFunction;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.And;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.AttributeList;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.DataType;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.EqualTo;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Expression;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Function;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.In;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Literal;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Not;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Or;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.UnresolvedAttribute;\n+import java.util.stream.Collectors;\n+\n+public class AstExpressionBuilder extends OpenDistroPPLParserBaseVisitor<Expression> {\n+    /** Logical expression excluding boolean, eval, comparison */\n+    @Override\n+    public Expression visitLogicalNot(OpenDistroPPLParser.LogicalNotContext ctx) {\n+        return new Not(visit(ctx.logicalExpression()));\n+    }\n+\n+    @Override\n+    public Expression visitLogicalOr(OpenDistroPPLParser.LogicalOrContext ctx) {\n+        return new Or(visit(ctx.left), visit(ctx.right));\n+    }\n+\n+    @Override\n+    public Expression visitLogicalAnd(OpenDistroPPLParser.LogicalAndContext ctx) {\n+        return new And(visit(ctx.left), visit(ctx.right));\n+    }\n+\n+\n+    /** Eval expression */\n+    @Override\n+    public Expression visitEvalExpression(OpenDistroPPLParser.EvalExpressionContext ctx) {\n+        Expression field = visit(ctx.fieldExpression());\n+        Expression evalFunctionCall = visit(ctx.evalFunctionCall());\n+        return new EqualTo(field, evalFunctionCall);\n+    }\n+\n+    /** Comparison expression */\n+    @Override\n+    public Expression visitCompareExpr(OpenDistroPPLParser.CompareExprContext ctx) {\n+        Expression field = visit(ctx.left);\n+        Expression value = visit(ctx.right);\n+        String operator = ctx.comparisonOperator().getText();\n+        switch (operator.replaceAll(\"\\\\s\",\"\")) {\n+            case \"==\":\n+            case \"=\":\n+                return new EqualTo(field, value);\n+            default:\n+                throw new UnsupportedOperationException(String.format(\"unsupported operator [%s]\", operator));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM0MzE1OA==", "bodyText": "return left and right? And same for other getChild().", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r408343158", "createdAt": "2020-04-14T18:21:27Z", "author": {"login": "dai-chen"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/plans/expression/And.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.node.AbstractNodeVisitor;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.node.NodeVisitor;\n+import com.google.common.collect.ImmutableList;\n+import java.util.List;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.ToString;\n+\n+@Getter\n+@ToString\n+@EqualsAndHashCode\n+@RequiredArgsConstructor\n+public class And extends Expression {\n+    private final Expression left;\n+    private final Expression right;\n+\n+    @Override\n+    public List<Expression> getChild() {\n+        return ImmutableList.of();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM0NTA3OQ==", "bodyText": "I see a pattern for all accept methods. We can think about how to make it clean.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r408345079", "createdAt": "2020-04-14T18:24:32Z", "author": {"login": "dai-chen"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/plans/expression/AggregateFunction.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.node.AbstractNodeVisitor;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.node.NodeVisitor;\n+import com.google.common.collect.ImmutableList;\n+import java.util.List;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.ToString;\n+\n+@Getter\n+@ToString\n+@EqualsAndHashCode\n+@RequiredArgsConstructor\n+public class AggregateFunction extends Expression {\n+    private final Expression funcName;\n+    private final Expression field;\n+\n+    @Override\n+    public List<Expression> getChild() {\n+        return ImmutableList.of();\n+    }\n+\n+    @Override\n+    public <R> R accept(NodeVisitor<R> nodeVisitor) {\n+        if (nodeVisitor instanceof AbstractNodeVisitor) {\n+            return ((AbstractNodeVisitor<R>) nodeVisitor).visitAggregateFunction(this);\n+        } else {\n+            return nodeVisitor.visitChildren(this);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM0NjU5MA==", "bodyText": "The class is already annotated by @Getter?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r408346590", "createdAt": "2020-04-14T18:27:05Z", "author": {"login": "dai-chen"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/plans/logical/Aggregation.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.node.AbstractNodeVisitor;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.node.NodeVisitor;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Expression;\n+import com.google.common.collect.ImmutableList;\n+import java.util.List;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@ToString\n+@EqualsAndHashCode\n+public class Aggregation extends LogicalPlan {\n+    @Getter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM0NzU5MA==", "bodyText": "Please add JavaDoc for generic type too.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r408347590", "createdAt": "2020-04-14T18:28:46Z", "author": {"login": "dai-chen"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/plans/logical/HasInput.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical;\n+\n+public interface HasInput<T, R> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46bb1dc41b5154bd4274c2dc9b0c2b63b8582a24", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/46bb1dc41b5154bd4274c2dc9b0c2b63b8582a24", "committedDate": "2020-04-16T22:00:14Z", "message": "Enabled parsing nested fields and arrays in field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80b06294773f7013a2f51b72ebce3c71f54257f8", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/80b06294773f7013a2f51b72ebce3c71f54257f8", "committedDate": "2020-04-17T18:00:26Z", "message": "Added unit tests for nested fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzY2MjI0", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-395766224", "createdAt": "2020-04-17T20:54:19Z", "commit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMDo1NDoxOVrOGHcxyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMDo1NDoxOVrOGHcxyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ2NDcxMw==", "bodyText": "should it be \"Keyword\" instead of \"KeyWord\"", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r410464713", "createdAt": "2020-04-17T20:54:19Z", "author": {"login": "zhongnansu"}, "path": "ppl/src/test/java/com/amazon/opendistroforelasticsearch/sql/ppl/parser/AstExpressionBuilderTest.java", "diffHunk": "@@ -0,0 +1,190 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.parser;\n+\n+import java.util.Collections;\n+import org.junit.Test;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.agg;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.aggregate;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.and;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.doubleLiteral;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.equalTo;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.filter;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.function;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.in;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.intLiteral;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.not;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.or;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.project;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.relation;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.stringLiteral;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.unresolvedAttr;\n+\n+public class AstExpressionBuilderTest extends AstBuilderTest{\n+\n+    @Test\n+    public void testLogicalNotExpr() {\n+        assertEqual(\"source=t not a=1\",\n+                filter(\n+                        relation(\"t\"),\n+                        not(\n+                                equalTo(unresolvedAttr(\"a\"), intLiteral(1))\n+                        )\n+                ));\n+    }\n+\n+    @Test\n+    public void testLogicalOrExpr() {\n+        assertEqual(\"source=t a=1 or b=2\",\n+                filter(\n+                        relation(\"t\"),\n+                        or(\n+                                equalTo(unresolvedAttr(\"a\"), intLiteral(1)),\n+                                equalTo(unresolvedAttr(\"b\"), intLiteral(2))\n+                        )\n+                ));\n+    }\n+\n+    @Test\n+    public void testLogicalAndExpr() {\n+        assertEqual(\"source=t a=1 and b=2\",\n+                filter(\n+                        relation(\"t\"),\n+                        and(\n+                                equalTo(unresolvedAttr(\"a\"), intLiteral(1)),\n+                                equalTo(unresolvedAttr(\"b\"), intLiteral(2))\n+                        )\n+                ));\n+    }\n+\n+    @Test\n+    public void testLogicalAndExprWithoutKeyWordAnd() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b542eb5496b0034f8506a8b15e53071d56686ad"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddf9c5a0dd4fc45dab4737cbd122396ddce87b6f", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ddf9c5a0dd4fc45dab4737cbd122396ddce87b6f", "committedDate": "2020-04-17T21:30:08Z", "message": "Added Java doc for classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17a8503378d37e5ba5d76ef0a888aedd909d3ea4", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/17a8503378d37e5ba5d76ef0a888aedd909d3ea4", "committedDate": "2020-04-17T21:49:03Z", "message": "Replaced the imported parser with static methods in the parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "784df880868ef82a3062bbded3b28a5a3d8412f0", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/784df880868ef82a3062bbded3b28a5a3d8412f0", "committedDate": "2020-04-17T22:01:36Z", "message": "Addressed comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c251f030006ab69ee24a1aa8c7b1d905d2701703", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c251f030006ab69ee24a1aa8c7b1d905d2701703", "committedDate": "2020-04-17T22:22:36Z", "message": "Addressed comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a92f1169381a911bde9adb31a9e0aa28700be24", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3a92f1169381a911bde9adb31a9e0aa28700be24", "committedDate": "2020-04-18T01:58:44Z", "message": "Addressed comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTUwNjU4", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-396550658", "createdAt": "2020-04-20T15:14:33Z", "commit": {"oid": "c251f030006ab69ee24a1aa8c7b1d905d2701703"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToxNDozNFrOGIZlLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToxNDozNFrOGIZlLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ2MDkxMA==", "bodyText": "change LogicalPlan to UnresolvedPlan. In case all the object is from literal query string which is not resolved with env yet.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r411460910", "createdAt": "2020-04-20T15:14:34Z", "author": {"login": "penghuo"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/plans/logical/LogicalPlan.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.node.Node;\n+\n+public abstract class LogicalPlan implements Node<LogicalPlan>, HasInput<LogicalPlan, LogicalPlan> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c251f030006ab69ee24a1aa8c7b1d905d2701703"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTYyNTM1", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-396562535", "createdAt": "2020-04-20T15:27:21Z", "commit": {"oid": "c251f030006ab69ee24a1aa8c7b1d905d2701703"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyNzoyMlrOGIaNOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyNzoyMlrOGIaNOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ3MTE2MA==", "bodyText": "Why we want to different SearchFromFilter and SearchFilterFrom?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r411471160", "createdAt": "2020-04-20T15:27:22Z", "author": {"login": "penghuo"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/parser/AstBuilder.java", "diffHunk": "@@ -0,0 +1,194 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.parser;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParserBaseVisitor;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Expression;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Map;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Aggregation;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Filter;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.LogicalPlan;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Project;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.Relation;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import lombok.RequiredArgsConstructor;\n+import org.antlr.v4.runtime.tree.ParseTree;\n+\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.DedupCommandContext;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.EvalCommandContext;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.FieldsCommandContext;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.FromClauseContext;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.PplStatementContext;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.RenameCommandContext;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.SearchFilterFromContext;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.SearchFromContext;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.SearchFromFilterContext;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.SortCommandContext;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.StatsCommandContext;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.antlr.parser.OpenDistroPPLParser.WhereCommandContext;\n+\n+/**\n+ * Class of walking the AST\n+ * Refines the visit path and build the LogicalPlan and Expression nodes interface\n+ */\n+@RequiredArgsConstructor\n+public class AstBuilder extends OpenDistroPPLParserBaseVisitor<LogicalPlan> {\n+    private final AstExpressionBuilder expressionBuilder;\n+\n+    @Override\n+    public LogicalPlan visitPplStatement(PplStatementContext ctx) {\n+        LogicalPlan search = visit(ctx.searchCommand());\n+        LogicalPlan reduce = ctx.commands().stream().map(this::visit).reduce(search, (r, e) -> e.withInput(r));\n+        return reduce;\n+    }\n+\n+    /** Search command */\n+    @Override\n+    public LogicalPlan visitSearchFrom(SearchFromContext ctx) {\n+        return visitFromClause(ctx.fromClause());\n+    }\n+\n+    @Override\n+    public LogicalPlan visitSearchFromFilter(SearchFromFilterContext ctx) {\n+        return new Filter(visitExpression(ctx.logicalExpression())).withInput(visit(ctx.fromClause()));\n+    }\n+\n+    @Override\n+    public LogicalPlan visitSearchFilterFrom(SearchFilterFromContext ctx) {\n+        return new Filter(visitExpression(ctx.logicalExpression())).withInput(visit(ctx.fromClause()));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c251f030006ab69ee24a1aa8c7b1d905d2701703"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTYzODg0", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-396563884", "createdAt": "2020-04-20T15:28:43Z", "commit": {"oid": "c251f030006ab69ee24a1aa8c7b1d905d2701703"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyODo0M1rOGIaRlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNToyODo0M1rOGIaRlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ3MjI3OQ==", "bodyText": "what is the difference between constant and literal", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r411472279", "createdAt": "2020-04-20T15:28:43Z", "author": {"login": "penghuo"}, "path": "ppl/src/main/antlr/OpenDistroPPLParser.g4", "diffHunk": "@@ -283,32 +300,16 @@ valueList\n     : LT_PRTHS literalValue (COMMA literalValue)* RT_PRTHS\n     ;\n \n-fullColumnName\n-    : simpleId DOT_ID*\n-    ;\n-\n constant", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c251f030006ab69ee24a1aa8c7b1d905d2701703"}, "originalPosition": 222}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTcxMDM5", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-396571039", "createdAt": "2020-04-20T15:36:18Z", "commit": {"oid": "c251f030006ab69ee24a1aa8c7b1d905d2701703"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNTozNjoxOFrOGIapbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNTozNjoxOFrOGIapbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ3ODM4Mg==", "bodyText": "I think funcName is just Name instead of Expression.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r411478382", "createdAt": "2020-04-20T15:36:18Z", "author": {"login": "penghuo"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/plans/expression/Function.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.node.AbstractNodeVisitor;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.node.NodeVisitor;\n+import java.util.Arrays;\n+import java.util.List;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.ToString;\n+\n+/**\n+ * Expression node of scalar function\n+ * Params include function name (@funcName) and function arguments (@funcArgs)\n+ */\n+@Getter\n+@ToString\n+@EqualsAndHashCode\n+@RequiredArgsConstructor\n+public class Function extends Expression {\n+    private final Expression funcName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c251f030006ab69ee24a1aa8c7b1d905d2701703"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTczODAx", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-396573801", "createdAt": "2020-04-20T15:39:22Z", "commit": {"oid": "c251f030006ab69ee24a1aa8c7b1d905d2701703"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNTozOToyMlrOGIay1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNTozOToyMlrOGIay1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ4MDc5MQ==", "bodyText": "could u add test case for qualified index name, \"log.2020.04.20.\"", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r411480791", "createdAt": "2020-04-20T15:39:22Z", "author": {"login": "penghuo"}, "path": "ppl/src/test/java/com/amazon/opendistroforelasticsearch/sql/ppl/parser/AstBuilderTest.java", "diffHunk": "@@ -0,0 +1,155 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.parser;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.antlr.PPLSyntaxParser;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.node.Node;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import org.junit.Test;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.agg;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.aggregate;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.equalTo;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.filter;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.function;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.intLiteral;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.map;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.project;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.relation;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.stringLiteral;\n+import static com.amazon.opendistroforelasticsearch.sql.ppl.plans.dsl.DSL.unresolvedAttr;\n+import static org.junit.Assert.assertEquals;\n+\n+public class AstBuilderTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c251f030006ab69ee24a1aa8c7b1d905d2701703"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "412f6f05349a36433d8f9697b21591295de0a3ac", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/412f6f05349a36433d8f9697b21591295de0a3ac", "committedDate": "2020-04-20T18:03:35Z", "message": "changed LogicalPlan to UnresolvedPlan; added test for index name with dots; changed the funcName to String in Function expression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5430902214ce490e7f4b21371ed9dd5ca903af05", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5430902214ce490e7f4b21371ed9dd5ca903af05", "committedDate": "2020-04-20T20:01:15Z", "message": "Merge branch 'feature/ppl' of github.com:opendistro-for-elasticsearch/sql into ppl-parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd56129da5bede67cdaca9ee743c57e4304481bb", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/bd56129da5bede67cdaca9ee743c57e4304481bb", "committedDate": "2020-04-21T19:33:53Z", "message": "Reverted nest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9489e4166b66a0ce8f3682bc195b314477a5d8a5", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/9489e4166b66a0ce8f3682bc195b314477a5d8a5", "committedDate": "2020-04-21T19:45:13Z", "message": "Removed constant and replaced it with literalValue in antlr parser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a898546c411297b33e149ce4249ae7376a1db5ac", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a898546c411297b33e149ce4249ae7376a1db5ac", "committedDate": "2020-04-22T06:22:37Z", "message": "Simplified the accept methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daf4767ec7586c8892dd54580f3658058ff268ed", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/daf4767ec7586c8892dd54580f3658058ff268ed", "committedDate": "2020-04-22T19:14:05Z", "message": "Update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acb157508ae78ee1fa08975d7bbbbfc36aa45576", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/acb157508ae78ee1fa08975d7bbbbfc36aa45576", "committedDate": "2020-04-23T08:44:41Z", "message": "Added builder pattern"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MjU1MzQz", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-399255343", "createdAt": "2020-04-23T16:09:23Z", "commit": {"oid": "acb157508ae78ee1fa08975d7bbbbfc36aa45576"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNjowOToyM1rOGKwPWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNjowOToyM1rOGKwPWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkyOTMwNg==", "bodyText": "lombok has Buiilder annotation, could you use it?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#discussion_r413929306", "createdAt": "2020-04-23T16:09:23Z", "author": {"login": "penghuo"}, "path": "ppl/src/main/java/com/amazon/opendistroforelasticsearch/sql/ppl/plans/logical/Aggregation.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical;\n+\n+import com.amazon.opendistroforelasticsearch.sql.ppl.node.AbstractNodeVisitor;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.expression.Expression;\n+import com.amazon.opendistroforelasticsearch.sql.ppl.plans.logical.builder.UnresolvedPlanBuilder;\n+import com.google.common.collect.ImmutableList;\n+import java.util.List;\n+import lombok.AllArgsConstructor;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+/**\n+ * Logical plan node of Aggregation, the interface for building aggregation actions in queries\n+ */\n+@Getter\n+@Setter\n+@ToString\n+@EqualsAndHashCode(callSuper = false)\n+@AllArgsConstructor\n+public class Aggregation extends UnresolvedPlan {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb157508ae78ee1fa08975d7bbbbfc36aa45576"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MzE3NTYy", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-399317562", "createdAt": "2020-04-23T17:24:11Z", "commit": {"oid": "acb157508ae78ee1fa08975d7bbbbfc36aa45576"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cc689bbf0177d0cea7e6a90a9b45302e5edfdd5", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2cc689bbf0177d0cea7e6a90a9b45302e5edfdd5", "committedDate": "2020-04-23T18:06:10Z", "message": "Rolled back to remove builder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MzU0MDk1", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/429#pullrequestreview-399354095", "createdAt": "2020-04-23T18:11:20Z", "commit": {"oid": "2cc689bbf0177d0cea7e6a90a9b45302e5edfdd5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42609bcc4ac80ae121a22115702e5622a823fe0a", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/42609bcc4ac80ae121a22115702e5622a823fe0a", "committedDate": "2020-04-23T19:31:49Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "092adbfbb4b647dffddacca21efa39d8ec601c33", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/092adbfbb4b647dffddacca21efa39d8ec601c33", "committedDate": "2020-04-23T19:33:08Z", "message": "Revert \"Added builder pattern\"\n\nThis reverts commit acb15750"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8c2eff609a8f831ccc215bccd6271aecd059cd8", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e8c2eff609a8f831ccc215bccd6271aecd059cd8", "committedDate": "2020-04-23T19:58:36Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c78efa4c6617f6f94bb62ee3f98152989b33f41", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/0c78efa4c6617f6f94bb62ee3f98152989b33f41", "committedDate": "2020-04-23T20:33:48Z", "message": "Merge remote-tracking branch 'upstream/feature/ppl' into ppl-parser"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 656, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}