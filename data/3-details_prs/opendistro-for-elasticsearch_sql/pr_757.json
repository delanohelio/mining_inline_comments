{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzMzMyMTcx", "number": 757, "title": "Support date and time function: week", "bodyText": "Issue  #709\nDescription of changes:\nAdded implementation, unit test, manual IT, and doc updates for function week()\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-09-25T19:38:40Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757", "merged": true, "mergeCommit": {"oid": "d75b7f111bae63e7892dba37e650549ca5f9c9df"}, "closed": true, "closedAt": "2020-09-30T22:39:40Z", "author": {"login": "rupal-bq"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKPA_QAH2gAyNDkzMzMyMTcxOmE0MWFhYWQ3MTFkMTAxMTJmMmRmZjgwNDhkM2Y4ZjNjMzdhNGU3Y2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOEnDTgFqTQ5OTg1ODQ0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a41aaad711d10112f2dff8048d3f8f3c37a4e7cc", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a41aaad711d10112f2dff8048d3f8f3c37a4e7cc", "committedDate": "2020-09-19T00:26:08Z", "message": "add week"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f571585ad13ef6bd3323b7e4b15da0cfeded263", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7f571585ad13ef6bd3323b7e4b15da0cfeded263", "committedDate": "2020-09-24T19:05:38Z", "message": "Merge branch 'develop' of https://github.com/rupal-bq/sql into date-time-function-week\n\n# Conflicts:\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/DSL.java\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/function/BuiltinFunctionName.java\n#\tcore/src/test/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunctionTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "498bdf02f7a3d7f19ead93befb3cdf5362a26f20", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/498bdf02f7a3d7f19ead93befb3cdf5362a26f20", "committedDate": "2020-09-24T20:32:36Z", "message": "edge case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "365b0002b7a650105ffd100bf0b4b15790e2a50a", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/365b0002b7a650105ffd100bf0b4b15790e2a50a", "committedDate": "2020-09-24T23:48:27Z", "message": "fix case 5 & 7"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7840b12a2a270000e38c6b16a1b9d2ed1ff32c4e", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7840b12a2a270000e38c6b16a1b9d2ed1ff32c4e", "committedDate": "2020-09-24T23:49:42Z", "message": "Merge branch 'develop' of https://github.com/rupal-bq/sql into date-time-function-week"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "081400436bed733e567d55bb7ad9a371f9569eea", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/081400436bed733e567d55bb7ad9a371f9569eea", "committedDate": "2020-09-25T17:39:27Z", "message": "add IT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8567662fdd89ff44c376503685fbf4ffd6b368b6", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/8567662fdd89ff44c376503685fbf4ffd6b368b6", "committedDate": "2020-09-25T18:23:05Z", "message": "update doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d51b9c5ebc7461aea3358d04d4417a12b469d37", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/9d51b9c5ebc7461aea3358d04d4417a12b469d37", "committedDate": "2020-09-25T18:25:16Z", "message": "fix table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c869ff0e392bedea510c1a38d6d044fe727902f8", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c869ff0e392bedea510c1a38d6d044fe727902f8", "committedDate": "2020-09-25T18:28:45Z", "message": "rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d19513d22c3fd35840e4f20c73707b6f2c40b95", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6d19513d22c3fd35840e4f20c73707b6f2c40b95", "committedDate": "2020-09-25T19:26:10Z", "message": "add string type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2ODAzMDY3", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#pullrequestreview-496803067", "createdAt": "2020-09-25T20:20:42Z", "commit": {"oid": "6d19513d22c3fd35840e4f20c73707b6f2c40b95"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMDoyMDo0MlrOHYRXPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMDoyMDo0MlrOHYRXPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTIxMjM1MA==", "bodyText": "Nit: Add newline", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#discussion_r495212350", "createdAt": "2020-09-25T20:20:42Z", "author": {"login": "lyndonb-bq"}, "path": "integ-test/src/test/java/com/amazon/opendistroforelasticsearch/sql/ppl/DateTimeFunctionIT.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ *   Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl;\n+\n+import static com.amazon.opendistroforelasticsearch.sql.legacy.TestsConstants.TEST_INDEX_DATE;\n+import static com.amazon.opendistroforelasticsearch.sql.util.MatcherUtils.rows;\n+import static com.amazon.opendistroforelasticsearch.sql.util.MatcherUtils.schema;\n+import static com.amazon.opendistroforelasticsearch.sql.util.MatcherUtils.verifySchema;\n+import static com.amazon.opendistroforelasticsearch.sql.util.MatcherUtils.verifySome;\n+\n+import java.io.IOException;\n+import org.json.JSONObject;\n+import org.junit.jupiter.api.Test;\n+\n+public class DateTimeFunctionIT extends PPLIntegTestCase {\n+\n+  @Override\n+  public void init() throws IOException {\n+    loadIndex(Index.DATE);\n+  }\n+\n+  private void week(String date, int mode, int expectedResult) throws IOException {\n+    JSONObject result = executeQuery(String.format(\n+        \"source=%s | eval f = week(date('%s'), %d) | fields f\", TEST_INDEX_DATE, date, mode));\n+    verifySchema(result, schema(\"f\", null, \"integer\"));\n+    verifySome(result.getJSONArray(\"datarows\"), rows(expectedResult));\n+  }\n+\n+  @Test\n+  public void testWeek() throws IOException {\n+    JSONObject result = executeQuery(String.format(\n+        \"source=%s | eval f = week(date('2008-02-20')) | fields f\", TEST_INDEX_DATE));\n+    verifySchema(result, schema(\"f\", null, \"integer\"));\n+    verifySome(result.getJSONArray(\"datarows\"), rows(7));\n+\n+    week(\"2008-02-20\", 0, 7);\n+    week(\"2008-02-20\", 1, 8);\n+    week(\"2008-12-31\", 1, 53);\n+    week(\"2000-01-01\", 0, 0);\n+    week(\"2000-01-01\", 2, 52);\n+  }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d19513d22c3fd35840e4f20c73707b6f2c40b95"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2ODAzMTMz", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#pullrequestreview-496803133", "createdAt": "2020-09-25T20:20:45Z", "commit": {"oid": "6d19513d22c3fd35840e4f20c73707b6f2c40b95"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMDoyMDo0NVrOHYRXVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQyMDoyMDo0NVrOHYRXVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTIxMjM3NQ==", "bodyText": "Nit: Add newline", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#discussion_r495212375", "createdAt": "2020-09-25T20:20:45Z", "author": {"login": "lyndonb-bq"}, "path": "integ-test/src/test/java/com/amazon/opendistroforelasticsearch/sql/sql/DateTimeFunctionIT.java", "diffHunk": "@@ -64,4 +84,4 @@ protected JSONObject executeQuery(String query) throws IOException {\n     Response response = client().performRequest(request);\n     return new JSONObject(getResponseBody(response));\n   }\n-}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d19513d22c3fd35840e4f20c73707b6f2c40b95"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2ODA0NTQx", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#pullrequestreview-496804541", "createdAt": "2020-09-25T20:22:13Z", "commit": {"oid": "6d19513d22c3fd35840e4f20c73707b6f2c40b95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ab8631a8721bc9d5ef6922319ce220ce14a90f6", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5ab8631a8721bc9d5ef6922319ce220ce14a90f6", "committedDate": "2020-09-25T20:25:57Z", "message": "nit: add newline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce4473b47fc28e7a17de4aeb0f041b1c4751f4cf", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ce4473b47fc28e7a17de4aeb0f041b1c4751f4cf", "committedDate": "2020-09-25T20:28:11Z", "message": "fix type in comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NzAxODg1", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#pullrequestreview-497701885", "createdAt": "2020-09-28T16:30:22Z", "commit": {"oid": "ce4473b47fc28e7a17de4aeb0f041b1c4751f4cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjozMDoyMlrOHZGc7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjozMDoyMlrOHZGc7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA4MjE1OA==", "bodyText": "Sorry for the late nit comment, but this should be CalendarLookup", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#discussion_r496082158", "createdAt": "2020-09-28T16:30:22Z", "author": {"login": "lyndonb-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/CalenderLookup.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ *   Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.expression.datetime;\n+\n+import com.amazon.opendistroforelasticsearch.sql.data.model.ExprValue;\n+import com.amazon.opendistroforelasticsearch.sql.exception.SemanticCheckException;\n+import java.util.Arrays;\n+import java.util.Calendar;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class CalenderLookup {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce4473b47fc28e7a17de4aeb0f041b1c4751f4cf"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dc155c2a54fc681ee317fc02a245f5bca79c2aa", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6dc155c2a54fc681ee317fc02a245f5bca79c2aa", "committedDate": "2020-09-28T16:58:16Z", "message": "nit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "126890ba4ed2519cc5062849dee76cb3c87f5bb7", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/126890ba4ed2519cc5062849dee76cb3c87f5bb7", "committedDate": "2020-09-29T18:36:19Z", "message": "Merge branch 'develop' of https://github.com/rupal-bq/sql into date-time-function-week\n\n# Conflicts:\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprStringValue.java\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/DSL.java\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/function/BuiltinFunctionName.java\n#\tdocs/user/dql/functions.rst\n#\tinteg-test/src/test/java/com/amazon/opendistroforelasticsearch/sql/ppl/DateTimeFunctionIT.java\n#\tppl/src/main/antlr/OpenDistroPPLParser.g4\n#\tsql/src/main/antlr/OpenDistroSQLParser.g4"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4ODE0MDA1", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#pullrequestreview-498814005", "createdAt": "2020-09-29T19:30:44Z", "commit": {"oid": "126890ba4ed2519cc5062849dee76cb3c87f5bb7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTozMDo0NVrOHZ9_vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOTozMDo0NVrOHZ9_vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk5MjE5MQ==", "bodyText": "could you also add the cases with null and missing values of datetime, timestamp, string; and the case where the integer arg of the double arguments is null or missing", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#discussion_r496992191", "createdAt": "2020-09-29T19:30:45Z", "author": {"login": "chloe-zh"}, "path": "core/src/test/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunctionTest.java", "diffHunk": "@@ -726,6 +728,83 @@ public void timestamp() {\n     assertEquals(\"timestamp(TIMESTAMP '2020-08-17 01:01:01')\", expr.toString());\n   }\n \n+  private void testWeek(String date, int mode, int expectedResult) {\n+    FunctionExpression expression = dsl\n+        .week(DSL.literal(new ExprDateValue(date)), DSL.literal(mode));\n+    assertEquals(INTEGER, expression.type());\n+    assertEquals(String.format(\"week(DATE '%s', %d)\", date, mode), expression.toString());\n+    assertEquals(integerValue(expectedResult), eval(expression));\n+  }\n+\n+  @Test\n+  public void week() {\n+    when(nullRef.type()).thenReturn(DATE);\n+    when(missingRef.type()).thenReturn(DATE);\n+    assertEquals(nullValue(), eval(dsl.week(nullRef)));\n+    assertEquals(missingValue(), eval(dsl.week(missingRef)));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "126890ba4ed2519cc5062849dee76cb3c87f5bb7"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c73e4309ee0594006dea8d1b865a6326cf3d7a96", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c73e4309ee0594006dea8d1b865a6326cf3d7a96", "committedDate": "2020-09-29T20:19:40Z", "message": "add unit tests for null, missing values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d3eff0bbd256e808be93fecbcf867d19e889944", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/4d3eff0bbd256e808be93fecbcf867d19e889944", "committedDate": "2020-09-29T20:33:12Z", "message": "nit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjQxNTU0", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#pullrequestreview-499641554", "createdAt": "2020-09-30T17:06:26Z", "commit": {"oid": "4d3eff0bbd256e808be93fecbcf867d19e889944"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5Nzk3ODYw", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#pullrequestreview-499797860", "createdAt": "2020-09-30T20:45:41Z", "commit": {"oid": "4d3eff0bbd256e808be93fecbcf867d19e889944"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo0NTo0MVrOHauqYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo0NTo0MVrOHauqYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc4OTUzOQ==", "bodyText": "could this function be static to avoid consturct CalendarLookup every time?\ne.g. getWeekNumber(ExprValue date, ExprValue mode)\nthen define getCalendar(int firstDayOfWeek, int minimalDaysInWeek, Supplier dateProvider)", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#discussion_r497789539", "createdAt": "2020-09-30T20:45:41Z", "author": {"login": "penghuo"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/CalendarLookup.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ *   Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.expression.datetime;\n+\n+import com.amazon.opendistroforelasticsearch.sql.data.model.ExprValue;\n+import com.amazon.opendistroforelasticsearch.sql.exception.SemanticCheckException;\n+import java.util.Arrays;\n+import java.util.Calendar;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class CalendarLookup {\n+\n+  private Map<Integer, Calendar> map = new HashMap<>();\n+\n+  /**\n+   * Set Calendar in map for all modes.\n+   * @param date ExprValue of Date/Datetime/Timestamp/String type.\n+   */\n+  public CalendarLookup(ExprValue date) {\n+    map.put(0, getCalendar(Calendar.SUNDAY, 7, date));\n+    map.put(1, getCalendar(Calendar.MONDAY, 5, date));\n+    map.put(2, getCalendar(Calendar.SUNDAY, 7, date));\n+    map.put(3, getCalendar(Calendar.MONDAY, 5, date));\n+    map.put(4, getCalendar(Calendar.SUNDAY, 4, date));\n+    map.put(5, getCalendar(Calendar.MONDAY, 7, date));\n+    map.put(6, getCalendar(Calendar.SUNDAY, 4, date));\n+    map.put(7, getCalendar(Calendar.MONDAY, 7, date));\n+  }\n+\n+  /**\n+   * Set first day of week, minimal days in first week and date in calendar.\n+   * @param firstDayOfWeek the given first day of the week.\n+   * @param minimalDaysInWeek the given minimal days required in the first week of the year.\n+   * @param date the ExprValue of Date/Datetime/Timestamp/String type.\n+   */\n+  private Calendar getCalendar(int firstDayOfWeek, int minimalDaysInWeek, ExprValue date) {\n+    Calendar calendar = Calendar.getInstance();\n+    calendar.setFirstDayOfWeek(firstDayOfWeek);\n+    calendar.setMinimalDaysInFirstWeek(minimalDaysInWeek);\n+    calendar.set(date.dateValue().getYear(), date.dateValue().getMonthValue() - 1,\n+        date.dateValue().getDayOfMonth());\n+    return calendar;\n+  }\n+\n+  /**\n+   * Returns week number for date according to mode.\n+   * @param mode Integer for mode. Valid mode values are 0 to 7.\n+   */\n+  public int getWeekNumber(int mode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d3eff0bbd256e808be93fecbcf867d19e889944"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76cd45b3066dddc4bc294dbebc235bdaa865fc8e", "author": {"user": null}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/76cd45b3066dddc4bc294dbebc235bdaa865fc8e", "committedDate": "2020-09-30T21:32:15Z", "message": "address PR comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODU4NDQ2", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/757#pullrequestreview-499858446", "createdAt": "2020-09-30T22:34:27Z", "commit": {"oid": "76cd45b3066dddc4bc294dbebc235bdaa865fc8e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 535, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}