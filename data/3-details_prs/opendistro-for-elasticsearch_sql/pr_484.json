{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMTU2NzU2", "number": 484, "title": "[PPL] Add ES rest client to support standalone mode", "bodyText": "Issue #, if available: #360\nDescription of changes: In this PR, a new implementation of our ElasticsearchClient is added to support running query engine outside Elasticsearch cluster. Meanwhile, a cleanup method is added to client so we can make sure resources related to a search, for example scroll context, is released if any exception.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-05-22T22:10:18Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/484", "merged": true, "mergeCommit": {"oid": "3a740adf576f7312b89a2e1458555744af32b207"}, "closed": true, "closedAt": "2020-05-26T21:34:29Z", "author": {"login": "dai-chen"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcj5XsZAH2gAyNDIyMTU2NzU2OjBjMzZkNTkwYmNiOTNmZDAxZGE2YmZjZDQ0NjJjNzFmN2NlZTdkOWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclLjYggFqTQxODY5MjY5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0c36d590bcb93fd01da6bfcd4462c71f7cee7d9a", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/0c36d590bcb93fd01da6bfcd4462c71f7cee7d9a", "committedDate": "2020-05-22T21:43:54Z", "message": "Add standalone IT and rest client impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc9353330c0024d6668af8bb79152379464a15ea", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/dc9353330c0024d6668af8bb79152379464a15ea", "committedDate": "2020-05-22T21:43:54Z", "message": "Add standalone IT and rest client impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "013b96cc36dcca90f5e129fdcf5aecc361e773ca", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/013b96cc36dcca90f5e129fdcf5aecc361e773ca", "committedDate": "2020-05-22T21:43:54Z", "message": "Add rest client UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5aae697198d52ff40a24034d57a4e9a22d7d1399", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5aae697198d52ff40a24034d57a4e9a22d7d1399", "committedDate": "2020-05-22T21:43:54Z", "message": "Add more UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dd37a56c715a0a90c09ad01329d1ce4a6bbc754", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5dd37a56c715a0a90c09ad01329d1ce4a6bbc754", "committedDate": "2020-05-22T21:43:54Z", "message": "Add cleanup method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae35d01289e91f95aa8a9ee460cba175e2cf8832", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ae35d01289e91f95aa8a9ee460cba175e2cf8832", "committedDate": "2020-05-22T21:43:55Z", "message": "Add assertion for cleanup method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93d15efc7d8cb90eb69dc839abe8d1771c58cd9f", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/93d15efc7d8cb90eb69dc839abe8d1771c58cd9f", "committedDate": "2020-05-22T21:43:55Z", "message": "Avoid cleanup multiple times"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91591bed5494d4f43334aee56e9eefa370ee6a98", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/91591bed5494d4f43334aee56e9eefa370ee6a98", "committedDate": "2020-05-22T21:58:09Z", "message": "Don't cleanup at last page automatically"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa2bffb18ee80aa637067c8ec537fc29a9367c4d", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/fa2bffb18ee80aa637067c8ec537fc29a9367c4d", "committedDate": "2020-05-22T22:00:41Z", "message": "Merge branch 'feature/ppl' into add-es-rest-client-merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6d8deacc1085a7b86e49fd94f0113e87cf22232", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/d6d8deacc1085a7b86e49fd94f0113e87cf22232", "committedDate": "2020-05-22T22:06:29Z", "message": "More comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1a2ce6aa9a358ce322f7ba926c3d9f73e64c518", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e1a2ce6aa9a358ce322f7ba926c3d9f73e64c518", "committedDate": "2020-05-22T23:22:26Z", "message": "UT covers all branches"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NDkzNzM0", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/484#pullrequestreview-418493734", "createdAt": "2020-05-26T16:53:05Z", "commit": {"oid": "e1a2ce6aa9a358ce322f7ba926c3d9f73e64c518"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd58ffef478dda0302c5cb403461de0ba2ce8e33", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/dd58ffef478dda0302c5cb403461de0ba2ce8e33", "committedDate": "2020-05-26T17:29:55Z", "message": "Merge branch 'feature/ppl' into add-es-rest-client-merge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NTk3OTk5", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/484#pullrequestreview-418597999", "createdAt": "2020-05-26T19:12:49Z", "commit": {"oid": "dd58ffef478dda0302c5cb403461de0ba2ce8e33"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOToxMjo0OVrOGashgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOToxMjo0OVrOGashgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY0NTYzNQ==", "bodyText": "Not a problem of this pr, but sometimes the result of method getSourceAsMap() is not what we expected, e.g. the source would be all fields when the designated field(s) is an evaluation function (like abs(balance)). Here is a similar issue: #461. Are we likely running into the same problem here?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/484#discussion_r430645635", "createdAt": "2020-05-26T19:12:49Z", "author": {"login": "chloe-zh"}, "path": "elasticsearch/src/main/java/com/amazon/opendistroforelasticsearch/sql/elasticsearch/storage/ElasticsearchIndexScan.java", "diffHunk": "@@ -83,4 +85,11 @@ public ExprValue next() {\n         return ExprValueUtils.fromObjectValue(hits.next().getSourceAsMap());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd58ffef478dda0302c5cb403461de0ba2ce8e33"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NjkyNjkx", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/484#pullrequestreview-418692691", "createdAt": "2020-05-26T21:28:53Z", "commit": {"oid": "dd58ffef478dda0302c5cb403461de0ba2ce8e33"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 681, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}