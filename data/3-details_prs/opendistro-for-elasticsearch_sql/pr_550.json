{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1ODMwMDYw", "number": 550, "title": "Redefine the Expression interface and Type", "bodyText": "Issue #, if available:\nDescription of changes:\n1.Expression\nIn current design, the Expression has two observers, valueOf and type.\npublic interface Expression {\n\n  /**\n   * Evaluate the value of expression in the value environment.\n   */\n  ExprValue valueOf(Environment<Expression, ExprValue> valueEnv);\n\n  /**\n   * Evaluate the type of expression in the type environment.\n   */\n  ExprType type(Environment<Expression, ExprType> typeEnv);\n}\n\nThe Expression is construct during the analyzer stage with the type environment provided by the storage engine. so the type observer should not rely on the type environment during the execution stage.\nThe interface of Expression should be changed as follows\npublic interface Expression {\n\n  /**\n   * Evaluate the value of expression in the value environment.\n   */\n  ExprValue valueOf(Environment<Expression, ExprValue> valueEnv);\n\n  /**\n   * Retrieve the type of expression.\n   */\n  ExprType type();\n}\n\n2.Expression Type (ExprType)\nThe ExprType define the Type of expression in the QueryEngine. In current design, ExprType is enum which can't been extended.\nIn this PR, we define the ExprType as the interface and define the ExprCoreType which extends the ExprType.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-07-08T01:29:20Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/550", "merged": true, "mergeCommit": {"oid": "8df9a88a4f56a1a0fd7641f22b6413a32ae8797c"}, "closed": true, "closedAt": "2020-07-08T22:04:39Z", "author": {"login": "penghuo"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcywB12gH2gAyNDQ1ODMwMDYwOmQyMTc4ODE0NDBjNWI0MjU3MDgzZTVlOWMxNGZkZjk5YjA0MjU3M2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczBzuEgFqTQ0NTE1OTYxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d217881440c5b4257083e5e9c14fdf99b042573b", "author": {"user": {"login": "penghuo", "name": "Peng Huo"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/d217881440c5b4257083e5e9c14fdf99b042573b", "committedDate": "2020-07-08T01:19:45Z", "message": "Redefine the Expression interface and Type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MDk4MDU5", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/550#pullrequestreview-445098059", "createdAt": "2020-07-08T20:17:46Z", "commit": {"oid": "d217881440c5b4257083e5e9c14fdf99b042573b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDoxNzo0NlrOGu3wbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQyMDoxNzo0NlrOGu3wbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgwMTE5Nw==", "bodyText": "Unfinished comment \"distance(FLOAT, INTEGER) =\" ?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/550#discussion_r451801197", "createdAt": "2020-07-08T20:17:46Z", "author": {"login": "dai-chen"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/type/WideningTypeRule.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ *\n+ *    Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *    Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *    You may not use this file except in compliance with the License.\n+ *    A copy of the License is located at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *    or in the \"license\" file accompanying this file. This file is distributed\n+ *    on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *    express or implied. See the License for the specific language governing\n+ *    permissions and limitations under the License.\n+ *\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.data.type;\n+\n+import static com.amazon.opendistroforelasticsearch.sql.data.type.ExprCoreType.UNKNOWN;\n+\n+import com.amazon.opendistroforelasticsearch.sql.exception.ExpressionEvaluationException;\n+import lombok.experimental.UtilityClass;\n+\n+/**\n+ * The definition of widening type rule for expression value.\n+ * ExprType     Widens to data types\n+ * INTEGER      LONG, FLOAT, DOUBLE\n+ * LONG         FLOAT, DOUBLE\n+ * FLOAT        DOUBLE\n+ * DOUBLE       DOUBLE\n+ * STRING       STRING\n+ * BOOLEAN      BOOLEAN\n+ * ARRAY        ARRAY\n+ * STRUCT       STRUCT\n+ */\n+@UtilityClass\n+public class WideningTypeRule {\n+  public static final int IMPOSSIBLE_WIDENING = Integer.MAX_VALUE;\n+  public static final int TYPE_EQUAL = 0;\n+\n+  /**\n+   * The widening distance is calculated from the leaf to root.\n+   * e.g. distance(INTEGER, FLOAT) = 2, but distance(FLOAT, INTEGER) =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d217881440c5b4257083e5e9c14fdf99b042573b"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a57aac71c0cd9a33973c374b66b45cd8d535c93e", "author": {"user": {"login": "penghuo", "name": "Peng Huo"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a57aac71c0cd9a33973c374b66b45cd8d535c93e", "committedDate": "2020-07-08T21:15:29Z", "message": "merge develop branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0b96ef21c66c95e6da8253f689cdd56033721ab", "author": {"user": {"login": "penghuo", "name": "Peng Huo"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f0b96ef21c66c95e6da8253f689cdd56033721ab", "committedDate": "2020-07-08T21:42:54Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MTU5NjE5", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/550#pullrequestreview-445159619", "createdAt": "2020-07-08T22:02:37Z", "commit": {"oid": "f0b96ef21c66c95e6da8253f689cdd56033721ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 712, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}