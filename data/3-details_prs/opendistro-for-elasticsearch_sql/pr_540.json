{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNjk0NTkw", "number": 540, "title": "Support mathematical functions ceil/ceiling, exp, floor, ln, log", "bodyText": "Issue #, if available:\nDescription of changes:\nImplementation of function expressions is referred to MySQL mathematical functions as the requirement and standard.\nMathematical functions in core will be separated in a couple of pull requests. Functions in this pull request include:\n\n\nceil/ceiling\nusage: maps a number to the least integer greater than or equal to itself\nargument type: integer/long/float/double\nreturn type: integer\n\n\nexp\nusage: maps a number to its natural exponential function\nargument type: integer/long/float/double\nreturn type: double\n\n\nfloor\nusage: maps a number to the greatest integer less than or equal to itself\nargument type: integer/long/float/double\nreturn type: integer\n\n\nln\nusage: maps a number to its natural logarithm\nargument type: integer/long/float/double\nreturn type: double\n\n\nlog\nusage: log(b, x) maps numbers b, x to their logarithm where b is the base, log(x) maps x to the natural logarithm, which is equivalent to ln(x)\nargument type: integer/long/float/double\nreturn type: double\n\n\nlog10\nusage: maps a number to its 10-base logarithm\nargument type: integer/long/float/double\nreturn type: double\n\n\nlog2\nusage: maps a number to its 2-base logarithm\nargument type: integer/long/float/double\nreturn type: double\n\n\nReference\n\nMySQL Reference Munual\nArterixDB Numeric Functions\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-06-29T23:11:37Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/540", "merged": true, "mergeCommit": {"oid": "13afbe5b5c5cfb4de9fed1cd61befdb4a8d30c4f"}, "closed": true, "closedAt": "2020-07-12T01:51:55Z", "author": {"login": "chloe-zh"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwG0NLAH2gAyNDQxNjk0NTkwOmMzMTZkZmNjMTgzMjU1YmE5NGEzMGRkNTUxZmE4MTgxNDNlYzRhM2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcztRbXgFqTQ0Njc2MTE4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c316dfcc183255ba94a30dd551fa818143ec4a3a", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c316dfcc183255ba94a30dd551fa818143ec4a3a", "committedDate": "2020-06-29T20:10:54Z", "message": "Support ceil/ceiling, exact, exp, floor, ln, log functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69ed20c556d36e9f874bd1b290465895d9486fec", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/69ed20c556d36e9f874bd1b290465895d9486fec", "committedDate": "2020-06-29T22:56:32Z", "message": "Added integ test cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTY3NDQ5", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/540#pullrequestreview-439567449", "createdAt": "2020-06-29T23:24:48Z", "commit": {"oid": "69ed20c556d36e9f874bd1b290465895d9486fec"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMzoyNDo0OFrOGql7bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxNjo1NDo0OFrOGrFv3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMxNDc5OA==", "bodyText": "np: can all these methods reuse a method like FunctionExpression  compile(BuiltinFunctionName name, Expression...exprs)", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/540#discussion_r447314798", "createdAt": "2020-06-29T23:24:48Z", "author": {"login": "dai-chen"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/DSL.java", "diffHunk": "@@ -58,6 +58,38 @@ public FunctionExpression abs(Environment<Expression, ExprType> env, Expression.\n         repository.compile(BuiltinFunctionName.ABS.getName(), Arrays.asList(expressions), env);\n   }\n \n+  public FunctionExpression ceil(Environment<Expression, ExprType> env, Expression... expressions) {\n+    return (FunctionExpression)\n+        repository.compile(BuiltinFunctionName.CEIL.getName(), Arrays.asList(expressions), env);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69ed20c556d36e9f874bd1b290465895d9486fec"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzMDg5Nw==", "bodyText": "What's the difference between this new method and binaryOperator() above?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/540#discussion_r447830897", "createdAt": "2020-06-30T16:46:38Z", "author": {"login": "dai-chen"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/operator/OperatorUtils.java", "diffHunk": "@@ -104,6 +104,57 @@ public String toString() {\n         };\n   }\n \n+  /**\n+   * Construct {@link FunctionBuilder} which call function with arguments produced by observer1 and\n+   * observer2 In general, if any operand evaluates to a MISSING value, the enclosing operator will\n+   * return MISSING; if none of operands evaluates to a MISSING value but there is an operand\n+   * evaluates to a NULL value, the enclosing operator will return NULL.\n+   *\n+   * @param functionName function name\n+   * @param function     {@link BiFunction}\n+   * @param observer1    extract the value of type T from the first argument\n+   * @param observer2    extract the value of type U from the second argument\n+   * @param returnType   return type\n+   * @param <T>          the type of the first argument to the function\n+   * @param <U>          the type of the second argument to the function\n+   * @param <R>          the type of the result of the function\n+   * @return {@link FunctionBuilder}\n+   */\n+  public static <T, U, R> FunctionBuilder doubleArgFunc(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69ed20c556d36e9f874bd1b290465895d9486fec"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzMjI2MA==", "bodyText": "Exact same as ceil()?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/540#discussion_r447832260", "createdAt": "2020-06-30T16:48:49Z", "author": {"login": "dai-chen"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/operator/arthmetic/MathematicalFunction.java", "diffHunk": "@@ -0,0 +1,214 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.expression.operator.arthmetic;\n+\n+import static com.amazon.opendistroforelasticsearch.sql.expression.operator.OperatorUtils.doubleArgFunc;\n+import static com.amazon.opendistroforelasticsearch.sql.expression.operator.OperatorUtils.unaryOperator;\n+\n+import com.amazon.opendistroforelasticsearch.sql.data.model.ExprType;\n+import com.amazon.opendistroforelasticsearch.sql.data.model.ExprValueUtils;\n+import com.amazon.opendistroforelasticsearch.sql.expression.function.BuiltinFunctionName;\n+import com.amazon.opendistroforelasticsearch.sql.expression.function.BuiltinFunctionRepository;\n+import com.amazon.opendistroforelasticsearch.sql.expression.function.FunctionBuilder;\n+import com.amazon.opendistroforelasticsearch.sql.expression.function.FunctionName;\n+import com.amazon.opendistroforelasticsearch.sql.expression.function.FunctionResolver;\n+import com.amazon.opendistroforelasticsearch.sql.expression.function.FunctionSignature;\n+import com.google.common.collect.ImmutableMap;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.function.BiFunction;\n+import java.util.function.Function;\n+import lombok.experimental.UtilityClass;\n+\n+@UtilityClass\n+public class MathematicalFunction {\n+  /**\n+   * Register Mathematical Functions.\n+   *\n+   * @param repository {@link BuiltinFunctionRepository}.\n+   */\n+  public static void register(BuiltinFunctionRepository repository) {\n+    repository.register(abs());\n+    repository.register(ceil());\n+    repository.register(ceiling());\n+    repository.register(exp());\n+    repository.register(floor());\n+    repository.register(ln());\n+    repository.register(log());\n+  }\n+\n+  /**\n+   * Definition of abs() function.\n+   * The supported signature of abs() function are\n+   * INT -> INT\n+   * LONG -> LONG\n+   * FLOAT -> FLOAT\n+   * DOUBLE -> DOUBLE\n+   */\n+  private static FunctionResolver abs() {\n+    return new FunctionResolver(\n+        BuiltinFunctionName.ABS.getName(),\n+        singleArgumentFunction(\n+            BuiltinFunctionName.ABS.getName(), Math::abs, Math::abs, Math::abs, Math::abs));\n+  }\n+\n+  /**\n+   * Definition of ceil(x)/ceiling(x) function.\n+   * Calculate the next highest integer that x rounds up to\n+   * The supported signature of ceil/ceiling function is\n+   * DOUBLE -> LONG\n+   */\n+  private static FunctionResolver ceil() {\n+    FunctionName functionName = BuiltinFunctionName.CEIL.getName();\n+    return new FunctionResolver(\n+        BuiltinFunctionName.CEIL.getName(),\n+        new ImmutableMap.Builder<FunctionSignature, FunctionBuilder>()\n+            .put(\n+                new FunctionSignature(functionName, Arrays.asList(ExprType.DOUBLE)),\n+                unaryOperator(\n+                    functionName, v -> ((long) Math.ceil(v)), ExprValueUtils::getDoubleValue,\n+                    ExprType.LONG))\n+            .build());\n+  }\n+\n+  private static FunctionResolver ceiling() {\n+    FunctionName functionName = BuiltinFunctionName.CEILING.getName();\n+    return new FunctionResolver(\n+        BuiltinFunctionName.CEILING.getName(),\n+        new ImmutableMap.Builder<FunctionSignature, FunctionBuilder>()\n+            .put(\n+                new FunctionSignature(functionName, Arrays.asList(ExprType.DOUBLE)),\n+                unaryOperator(\n+                    functionName, v -> ((long) Math.ceil(v)), ExprValueUtils::getDoubleValue,\n+                    ExprType.LONG))\n+            .build());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69ed20c556d36e9f874bd1b290465895d9486fec"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzgzNjEyNg==", "bodyText": "For assertion on floating-point number, please check if we're using matcher like isCloseTo() to avoid precision problem.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/540#discussion_r447836126", "createdAt": "2020-06-30T16:54:48Z", "author": {"login": "dai-chen"}, "path": "integ-test/src/test/java/com/amazon/opendistroforelasticsearch/sql/ppl/MathematicalFunctionIT.java", "diffHunk": "@@ -0,0 +1,109 @@\n+/*\n+ *   Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.ppl;\n+\n+import static com.amazon.opendistroforelasticsearch.sql.legacy.TestsConstants.TEST_INDEX_BANK;\n+import static com.amazon.opendistroforelasticsearch.sql.util.MatcherUtils.rows;\n+import static com.amazon.opendistroforelasticsearch.sql.util.MatcherUtils.schema;\n+import static com.amazon.opendistroforelasticsearch.sql.util.MatcherUtils.verifyDataRows;\n+import static com.amazon.opendistroforelasticsearch.sql.util.MatcherUtils.verifySchema;\n+\n+import java.io.IOException;\n+import org.json.JSONObject;\n+import org.junit.jupiter.api.Test;\n+\n+public class MathematicalFunctionIT extends PPLIntegTestCase {\n+\n+  @Override\n+  public void init() throws IOException {\n+    loadIndex(Index.BANK);\n+    loadIndex(Index.BANK_WITH_NULL_VALUES);\n+  }\n+\n+  @Test\n+  public void testAbs() throws IOException {\n+    JSONObject result =\n+        executeQuery(\n+            String.format(\n+                \"source=%s | eval f = abs(age) | fields f\", TEST_INDEX_BANK));\n+    verifySchema(result, schema(\"f\", null, \"integer\"));\n+    verifyDataRows(\n+        result,\n+        rows(32), rows(36), rows(28), rows(33), rows(36), rows(39), rows(34));\n+  }\n+\n+  @Test\n+  public void testCeil() throws IOException {\n+    JSONObject result =\n+        executeQuery(\n+            String.format(\n+                \"source=%s | eval f = ceil(age) | fields f\", TEST_INDEX_BANK));\n+    verifySchema(result, schema(\"f\", null, \"long\"));\n+    verifyDataRows(\n+        result,\n+        rows(32), rows(36), rows(28), rows(33), rows(36), rows(39), rows(34));\n+  }\n+\n+  @Test\n+  public void testExp() throws IOException {\n+    JSONObject result =\n+        executeQuery(\n+            String.format(\n+                \"source=%s | eval f = exp(age) | fields f\", TEST_INDEX_BANK));\n+    verifySchema(result, schema(\"f\", null, \"double\"));\n+    verifyDataRows(\n+        result, rows(Math.exp(32)), rows(Math.exp(36)), rows(Math.exp(28)), rows(Math.exp(33)),\n+        rows(Math.exp(36)), rows(Math.exp(39)), rows(Math.exp(34)));\n+  }\n+\n+  @Test\n+  public void testFloor() throws IOException {\n+    JSONObject result =\n+        executeQuery(\n+            String.format(\n+                \"source=%s | eval f = floor(age) | fields f\", TEST_INDEX_BANK));\n+    verifySchema(result, schema(\"f\", null, \"long\"));\n+    verifyDataRows(\n+        result,\n+        rows(32), rows(36), rows(28), rows(33), rows(36), rows(39), rows(34));\n+  }\n+\n+  @Test\n+  public void testLn() throws IOException {\n+    JSONObject result =\n+        executeQuery(\n+            String.format(\n+                \"source=%s | eval f = ln(age) | fields f\", TEST_INDEX_BANK));\n+    verifySchema(result, schema(\"f\", null, \"double\"));\n+    verifyDataRows(\n+        result, rows(Math.log(32)), rows(Math.log(36)), rows(Math.log(28)), rows(Math.log(33)),\n+        rows(Math.log(36)), rows(Math.log(39)), rows(Math.log(34)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69ed20c556d36e9f874bd1b290465895d9486fec"}, "originalPosition": 93}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cda07d883b20180de706c1c39cf6b7cb64014684", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/cda07d883b20180de706c1c39cf6b7cb64014684", "committedDate": "2020-07-08T19:41:02Z", "message": "Merge remote-tracking branch 'upstream/develop' into func-math\n\n# Conflicts:\n#\tcore/src/test/java/com/amazon/opendistroforelasticsearch/sql/expression/ExpressionTestBase.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03d932da33dc7879edd49ff2bb7d903939908176", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/03d932da33dc7879edd49ff2bb7d903939908176", "committedDate": "2020-07-08T19:57:28Z", "message": "Set the registration of function name to be case insensitive"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "417bbee25364c81d98339316d50c8c93304e7dab", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/417bbee25364c81d98339316d50c8c93304e7dab", "committedDate": "2020-07-08T22:54:41Z", "message": "Merge remote-tracking branch 'upstream/develop' into func-math\n\n# Conflicts:\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/DSL.java\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/operator/arthmetic/UnaryFunction.java\n#\tcore/src/test/java/com/amazon/opendistroforelasticsearch/sql/config/TestConfig.java\n#\tcore/src/test/java/com/amazon/opendistroforelasticsearch/sql/expression/operator/arthmetic/UnaryFunctionTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ebd3608758b27c8cdc1f934a11d67b9fa5fa394", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/4ebd3608758b27c8cdc1f934a11d67b9fa5fa394", "committedDate": "2020-07-09T04:28:35Z", "message": "Function signature changed consistent with mysql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0c3a53a786e15dcff1a0e499b78810742eeef2d", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a0c3a53a786e15dcff1a0e499b78810742eeef2d", "committedDate": "2020-07-09T04:41:52Z", "message": "Function signature changed consistent with mysql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7449a07cfb162e61cbee40ae493e7bbdc5d13a9b", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7449a07cfb162e61cbee40ae493e7bbdc5d13a9b", "committedDate": "2020-07-09T18:00:33Z", "message": "Merge remote-tracking branch 'upstream/develop' into func-math"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f54cc6a19783508c866fdf678e6a8757996683f", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5f54cc6a19783508c866fdf678e6a8757996683f", "committedDate": "2020-07-09T19:30:39Z", "message": "Merge remote-tracking branch 'upstream/develop' into func-math"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff1d3a9e72713cd104edb448da927c4cc8b20bb5", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ff1d3a9e72713cd104edb448da927c4cc8b20bb5", "committedDate": "2020-07-10T17:07:25Z", "message": "Function signature changed consistent with mysql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b67245b384cf633ef5ebe52a149881d71be845cb", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b67245b384cf633ef5ebe52a149881d71be845cb", "committedDate": "2020-07-10T17:12:27Z", "message": "Merge remote-tracking branch 'upstream/develop' into func-math"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01d6f964c0128c56b99e8fd3591affe80c63e67e", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/01d6f964c0128c56b99e8fd3591affe80c63e67e", "committedDate": "2020-07-10T18:42:09Z", "message": "Added comparison test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "520cc968559971cde44fc7c7a6286b6b43a7f643", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/520cc968559971cde44fc7c7a6286b6b43a7f643", "committedDate": "2020-07-10T19:18:09Z", "message": "changed matcher to closeto"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "529df83c3b0e59fd22b7d37459834df478466f5e", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/529df83c3b0e59fd22b7d37459834df478466f5e", "committedDate": "2020-07-10T21:19:51Z", "message": "added closeTo matcher"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef44d0bad611273f85882da34f4e9d7fa1b5bc9b", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ef44d0bad611273f85882da34f4e9d7fa1b5bc9b", "committedDate": "2020-07-10T21:41:47Z", "message": "Extracted method to compile functions in DSL"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzIwMDg0", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/540#pullrequestreview-446720084", "createdAt": "2020-07-10T21:52:23Z", "commit": {"oid": "ef44d0bad611273f85882da34f4e9d7fa1b5bc9b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMTo1MjoyM1rOGwGnzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMTo1MjoyM1rOGwGnzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5MzMyNQ==", "bodyText": "np: allMatch(v -> valuesAreClose...) ?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/540#discussion_r453093325", "createdAt": "2020-07-10T21:52:23Z", "author": {"login": "dai-chen"}, "path": "integ-test/src/test/java/com/amazon/opendistroforelasticsearch/sql/util/MatcherUtils.java", "diffHunk": "@@ -239,8 +233,29 @@ protected boolean matchesSafely(JSONArray array) {\n     };\n   }\n \n-  public static IsCloseTo closeTo(Number value) {\n-    return new IsCloseTo(value.doubleValue(), 1e-10);\n+  public static TypeSafeMatcher<JSONArray> closeTo(Number... values) {\n+    final double error = 1e-10;\n+    return new TypeSafeMatcher<JSONArray>() {\n+      @Override\n+      protected boolean matchesSafely(JSONArray item) {\n+        List<Number> expectedValues = new ArrayList<>(Arrays.asList(values));\n+        List<Number> actualValues = new ArrayList<>();\n+        item.iterator().forEachRemaining(v -> actualValues.add((Number) v));\n+        return actualValues.stream()\n+            .map(v -> (valuesAreClose(v, expectedValues.get(actualValues.indexOf(v)))))\n+            .reduce((a, b) -> a && b)\n+            .get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef44d0bad611273f85882da34f4e9d7fa1b5bc9b"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af58dbe04c3120ad0795e8b9bdc2afb7498f0fd7", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/af58dbe04c3120ad0795e8b9bdc2afb7498f0fd7", "committedDate": "2020-07-10T22:54:55Z", "message": "update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzYxMTg1", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/540#pullrequestreview-446761185", "createdAt": "2020-07-11T00:40:59Z", "commit": {"oid": "af58dbe04c3120ad0795e8b9bdc2afb7498f0fd7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 708, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}