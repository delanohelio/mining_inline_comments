{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MDk3MTk4", "number": 334, "title": "Change the default response format to JDBC.", "bodyText": "Issue #, if available:\n#159\nDescription of changes:\nProblem Statement\nCurrently, By default the plugin returns original response from Elasticsearch in JSON. There are two major problmes with this format. (1) Not all the SQL query can translated to Elasticsearch DSL directly, so, the post processing logic is required. e.g.,SELECT LOG(MAX(FlightDelayMin)) FROM kibana_sample_data_flights. In this case, the log should be applied on the aggregation result from DSL. (2) For customer, comparing with JDBC format, the original response from Elasticsearch is not easy to understand.\nPR includes the following changes\n\nChange the default response format from original Elasticsearch response to JDBC.\nAdd the setting of the default format if not format params provided. https://github.com/penghuo/sql/blob/jdbc-format/docs/user/admin/settings.rst#opendistro-sql-query-response-format.\nChange the Integration Test to used json format which could comptatible with original test cases expection.\nChange the document accordingly.\n4.1. https://github.com/penghuo/sql/blob/jdbc-format/docs/user/interfaces/protocol.rst#elasticsearch-dsl\n4.2. https://github.com/penghuo/sql/blob/jdbc-format/docs/user/admin/settings.rst#opendistro-sql-query-response-format\nadd lombok library.\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-01-03T19:30:47Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/334", "merged": true, "mergeCommit": {"oid": "f67d7016128dcf50c7a4f63f8a7426784b9b02c3"}, "closed": true, "closedAt": "2020-01-06T17:01:34Z", "author": {"login": "penghuo"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2xkvTgH2gAyMzU5MDk3MTk4Ojc3MGJmYjdkOTNlMTVkNTEyZWQ1ZWU4Y2E5Zjg1ZWIzYWUzNGQ4MDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb3ur04AH2gAyMzU5MDk3MTk4OmIxM2NhMTlhNGJmM2YyNDQ4OWMxYTNkODgzZDMwMTdjY2FiMDIzMDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "770bfb7d93e15d512ed5ee8ca9f85eb3ae34d808", "author": {"user": {"login": "penghuo", "name": "Peng Huo"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/770bfb7d93e15d512ed5ee8ca9f85eb3ae34d808", "committedDate": "2020-01-03T17:12:19Z", "message": "change the default response fromat to jdbc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "067f510fa1be72591934e7c86d3b4a1af9a0c292", "author": {"user": {"login": "penghuo", "name": "Peng Huo"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/067f510fa1be72591934e7c86d3b4a1af9a0c292", "committedDate": "2020-01-03T19:10:29Z", "message": "update doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MjQ3OTAw", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/334#pullrequestreview-338247900", "createdAt": "2020-01-03T19:55:10Z", "commit": {"oid": "067f510fa1be72591934e7c86d3b4a1af9a0c292"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QxOTo1NToxMFrOFaIHsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QyMDowODoxMFrOFaIW2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk0MDMzOA==", "bodyText": "np: wildcard import", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/334#discussion_r362940338", "createdAt": "2020-01-03T19:55:10Z", "author": {"login": "dai-chen"}, "path": "src/test/java/com/amazon/opendistroforelasticsearch/sql/unittest/FormatTest.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.unittest;\n+\n+import com.amazon.opendistroforelasticsearch.sql.executor.Format;\n+import org.junit.Test;\n+\n+import java.util.Optional;\n+\n+import static org.junit.Assert.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "067f510fa1be72591934e7c86d3b4a1af9a0c292"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk0NDIxNw==", "bodyText": "boolean?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/334#discussion_r362944217", "createdAt": "2020-01-03T20:08:10Z", "author": {"login": "dai-chen"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/sql/request/SqlRequestParam.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.request;\n+\n+import com.amazon.opendistroforelasticsearch.sql.esdomain.LocalClusterState;\n+import com.amazon.opendistroforelasticsearch.sql.executor.Format;\n+\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.amazon.opendistroforelasticsearch.sql.plugin.SqlSettings.QUERY_RESPONSE_FORMAT;\n+\n+/**\n+ * Utils class for parse the request params.\n+ */\n+public class SqlRequestParam {\n+    public static final String QUERY_PARAMS_FORMAT = \"format\";\n+    public static final String QUERY_PARAMS_PRETTY = \"pretty\";\n+\n+    /**\n+     * Parse the pretty params to decide whether the response should be pretty formatted.\n+     * @param requestParams request params.\n+     * @return return true if the response required pretty format, otherwise return false.\n+     */\n+    public static Boolean isPrettyFormat(Map<String, String> requestParams) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "067f510fa1be72591934e7c86d3b4a1af9a0c292"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mjc3Njk0", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/334#pullrequestreview-338277694", "createdAt": "2020-01-03T21:13:52Z", "commit": {"oid": "067f510fa1be72591934e7c86d3b4a1af9a0c292"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzE0Njkz", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/334#pullrequestreview-338314693", "createdAt": "2020-01-03T23:26:23Z", "commit": {"oid": "067f510fa1be72591934e7c86d3b4a1af9a0c292"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b13ca19a4bf3f24489c1a3d883d3017ccab02307", "author": {"user": {"login": "penghuo", "name": "Peng Huo"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b13ca19a4bf3f24489c1a3d883d3017ccab02307", "committedDate": "2020-01-06T16:24:16Z", "message": "address comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 722, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}