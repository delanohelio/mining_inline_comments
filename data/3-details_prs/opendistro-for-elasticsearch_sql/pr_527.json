{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NjY0OTA2", "number": 527, "title": "Add new sql module", "bodyText": "Issue #, if available: #264, #256\nDescription of changes: Add new SQL module to integrate with new query engine. As our start point, SELECT literal support is added.\nHere are the major changes:\n\nAdd a new sql Gradle module.\nSupport SELECT literal by:\n2.1 Relaxing existing Project operator to accept Expression instead of ReferenceExpression.\n2.2 Adding a new Values operator for literal values which is correspondent with ANSI VALUES clause. Reference: https://modern-sql.com/feature/values, https://crate.io/docs/crate/reference/en/latest/sql/statements/values.html.\nIntegrate with legacy REST handler to route request to new SQL frontend.\n\nThe legacy module with all old code will co-exist with new sql module during code migration.\n\nAt runtime, request will send to new SQL parser first and fall back to old code if not supported yet.\n\nDocumentation: https://github.com/dai-chen/sql/blob/add-new-sql-module/docs/user/dql/expressions.rst\nTesting: Passed old and new UT, IT and doctest.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-06-18T17:35:01Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/527", "merged": true, "mergeCommit": {"oid": "087da8871ff9e8f6e00228fc45b5576b17f6bab7"}, "closed": true, "closedAt": "2020-06-26T22:40:13Z", "author": {"login": "dai-chen"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsOtWGgH2gAyNDM2NjY0OTA2OjQ0YzA1MDQyNTJjMjViN2E4ODdhZTM2YmIwMDBlNWRjMDhlYzI2ZjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvLCsKgH2gAyNDM2NjY0OTA2Ojk4ZGFmYTc3YmEyMDU4MmNjM2YwNjU5NDEzMzhkMDdlODRmNGZiYWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "44c0504252c25b7a887ae36bb000e5dc08ec26f4", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/44c0504252c25b7a887ae36bb000e5dc08ec26f4", "committedDate": "2020-06-17T19:06:57Z", "message": "Add new SQL module with support for SELECT literal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6a4b88a9f5c8b9fffa4c80651f065602c834e60", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e6a4b88a9f5c8b9fffa4c80651f065602c834e60", "committedDate": "2020-06-17T22:44:16Z", "message": "Add support for more data types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "364024cc9b717f1681450d90bc4bcc37467dcbaf", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/364024cc9b717f1681450d90bc4bcc37467dcbaf", "committedDate": "2020-06-18T03:25:32Z", "message": "Route request to new frontend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89a73a64fd191210adf4b30f341342e78a685da4", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/89a73a64fd191210adf4b30f341342e78a685da4", "committedDate": "2020-06-18T04:35:40Z", "message": "Add more UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "607f2ca85c318c926e6666cc3a298dd32c87bf5e", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/607f2ca85c318c926e6666cc3a298dd32c87bf5e", "committedDate": "2020-06-18T04:49:08Z", "message": "Fix doctest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b0197cf36c2ac4a6d48b51a3c62b08c0381f6d1", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6b0197cf36c2ac4a6d48b51a3c62b08c0381f6d1", "committedDate": "2020-06-18T05:04:34Z", "message": "Add more UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e977e3ad9696b863bb0038c6dbbb3f39002050b", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5e977e3ad9696b863bb0038c6dbbb3f39002050b", "committedDate": "2020-06-18T16:16:59Z", "message": "Add more UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "616d34bad0673368a4a97c31b4b55efc6cd3431f", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/616d34bad0673368a4a97c31b4b55efc6cd3431f", "committedDate": "2020-06-18T17:18:38Z", "message": "Fix checkstyle and jacoco"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84f4da778df1c0c374fda3555c7dcd907ac56000", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/84f4da778df1c0c374fda3555c7dcd907ac56000", "committedDate": "2020-06-18T18:25:41Z", "message": "Address PR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66133355b9cff464c9f23d202e3ec2113a249c7d", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/66133355b9cff464c9f23d202e3ec2113a249c7d", "committedDate": "2020-06-18T18:50:04Z", "message": "Add more docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27e832d654ac6e6aaf30529b97027b7b85c2e80c", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/27e832d654ac6e6aaf30529b97027b7b85c2e80c", "committedDate": "2020-06-18T18:50:57Z", "message": "Merge branch 'develop' into add-new-sql-module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8f922e85c3f80ff842345c6c9f71a8e83b20fe2", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f8f922e85c3f80ff842345c6c9f71a8e83b20fe2", "committedDate": "2020-06-18T18:59:46Z", "message": "Use new syntax check exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dceff7332b77f3120ef86368448c8cdd2479e66a", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/dceff7332b77f3120ef86368448c8cdd2479e66a", "committedDate": "2020-06-19T15:47:45Z", "message": "Unregister new handler and add UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efb49a8da78286014272ca4f6eddae0ac59c40fa", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/efb49a8da78286014272ca4f6eddae0ac59c40fa", "committedDate": "2020-06-25T16:48:17Z", "message": "Support fetch size 0 which is default request by JDBC driver"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79233cfaecb0eb9630084fce87294534f98efa1d", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/79233cfaecb0eb9630084fce87294534f98efa1d", "committedDate": "2020-06-25T16:49:04Z", "message": "Merge branch 'develop' into add-new-sql-module"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NTgxMzM2", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/527#pullrequestreview-438581336", "createdAt": "2020-06-26T20:39:19Z", "commit": {"oid": "79233cfaecb0eb9630084fce87294534f98efa1d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDozOToxOVrOGpuDMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDozOToxOVrOGpuDMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5OTI4Mw==", "bodyText": "add some log to tracking the fallback behaviour for debug", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/527#discussion_r446399283", "createdAt": "2020-06-26T20:39:19Z", "author": {"login": "penghuo"}, "path": "legacy/src/main/java/com/amazon/opendistroforelasticsearch/sql/legacy/plugin/RestSqlAction.java", "diffHunk": "@@ -135,8 +142,19 @@ protected RestChannelConsumer prepareRequest(RestRequest request, NodeClient cli\n             LOG.info(\"[{}] Incoming request {}: {}\", LogUtils.getRequestId(), request.uri(),\n                     QueryDataAnonymizer.anonymizeData(sqlRequest.getSql()));\n \n-            final QueryAction queryAction =\n-                    explainRequest(client, sqlRequest, SqlRequestParam.getFormat(request.params()));\n+            Format format = SqlRequestParam.getFormat(request.params());\n+\n+            // Route request to new query engine if it's supported already\n+            SQLQueryRequest newSqlRequest = new SQLQueryRequest(sqlRequest.getJsonContent(),\n+                                                                sqlRequest.getSql(),\n+                                                                request.path(),\n+                                                                format.getFormatName());\n+            RestChannelConsumer result = newSqlQueryHandler.prepareRequest(newSqlRequest, client);\n+            if (result != RestSQLQueryAction.NOT_SUPPORTED_YET) {\n+                return result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79233cfaecb0eb9630084fce87294534f98efa1d"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NTg2Mzg1", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/527#pullrequestreview-438586385", "createdAt": "2020-06-26T20:48:50Z", "commit": {"oid": "79233cfaecb0eb9630084fce87294534f98efa1d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDo0ODo1MVrOGpuSQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQyMDo0ODo1MVrOGpuSQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQwMzEzNw==", "bodyText": "Add some SQL VALUES related doc if possible.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/527#discussion_r446403137", "createdAt": "2020-06-26T20:48:51Z", "author": {"login": "penghuo"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/planner/logical/LogicalValues.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ *    Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *    Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *    You may not use this file except in compliance with the License.\n+ *    A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *    or in the \"license\" file accompanying this file. This file is distributed\n+ *    on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *    express or implied. See the License for the specific language governing\n+ *    permissions and limitations under the License.\n+ *\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.planner.logical;\n+\n+import com.amazon.opendistroforelasticsearch.sql.expression.LiteralExpression;\n+import com.google.common.collect.ImmutableList;\n+import java.util.List;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.ToString;\n+\n+/**\n+ * Logical operator which is a sequence of literal list.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79233cfaecb0eb9630084fce87294534f98efa1d"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjEyMjgw", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/527#pullrequestreview-438612280", "createdAt": "2020-06-26T21:43:12Z", "commit": {"oid": "79233cfaecb0eb9630084fce87294534f98efa1d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NjE5NzQ5", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/527#pullrequestreview-438619749", "createdAt": "2020-06-26T22:02:04Z", "commit": {"oid": "79233cfaecb0eb9630084fce87294534f98efa1d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a062ce62470ae1ae4f0515d8d58d09ce909aeb9", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5a062ce62470ae1ae4f0515d8d58d09ce909aeb9", "committedDate": "2020-06-26T22:25:40Z", "message": "Address PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98dafa77ba20582cc3f065941338d07e84f4fbab", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/98dafa77ba20582cc3f065941338d07e84f4fbab", "committedDate": "2020-06-26T22:32:25Z", "message": "Merge branch 'develop' into add-new-sql-module"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 699, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}