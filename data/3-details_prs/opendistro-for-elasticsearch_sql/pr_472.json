{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwMjI2Nzc3", "number": 472, "title": "[PPL] Add support for fields command", "bodyText": "Issue #, if available:\nDescription of changes:\nPPL\n\nadd UT to fields command in AST builder.\nchange the Fields arguments from UnresolvedExpression to Argument.\n\nCore\n\nadd logical and physical operator for project and remove.\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-05-19T16:23:20Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/472", "merged": true, "mergeCommit": {"oid": "8e4453f70ef15789ae61d71eac1e21c30fe12a23"}, "closed": true, "closedAt": "2020-05-20T21:13:13Z", "author": {"login": "penghuo"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcisthRgH2gAyNDIwMjI2Nzc3OjA2Yzc2MWM0YTNlNmI1MDZmZTc2NTNlNGU5MThlN2U4ODE4YWRhNGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjPeNKAFqTQxNTcwNjgxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "06c761c4a3e6b506fe7653e4e918e7e8818ada4e", "author": {"user": {"login": "penghuo", "name": "Peng Huo"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/06c761c4a3e6b506fe7653e4e918e7e8818ada4e", "committedDate": "2020-05-19T04:25:03Z", "message": "add LogicalProject and LogicalRemove"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49da37f2e3f5de486ca8b83118e3283bacf99bfb", "author": {"user": {"login": "penghuo", "name": "Peng Huo"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/49da37f2e3f5de486ca8b83118e3283bacf99bfb", "committedDate": "2020-05-19T04:32:07Z", "message": "add todo comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc02bb923318eb04f6d8661050b52ab4455bfd5e", "author": {"user": {"login": "penghuo", "name": "Peng Huo"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/dc02bb923318eb04f6d8661050b52ab4455bfd5e", "committedDate": "2020-05-19T16:16:13Z", "message": "add physical project and remove operator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjA0ODIy", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/472#pullrequestreview-415604822", "createdAt": "2020-05-20T18:27:43Z", "commit": {"oid": "dc02bb923318eb04f6d8661050b52ab4455bfd5e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxODoyNzo0NFrOGYYe6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxODo1MDo1MVrOGYZfKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIyMDEzNw==", "bodyText": "The indent is changed to 2 spaces in this file and some other files?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/472#discussion_r428220137", "createdAt": "2020-05-20T18:27:44Z", "author": {"login": "dai-chen"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/planner/logical/LogicalPlanDSL.java", "diffHunk": "@@ -18,30 +18,39 @@\n import com.amazon.opendistroforelasticsearch.sql.expression.Expression;\n import com.amazon.opendistroforelasticsearch.sql.expression.ReferenceExpression;\n import com.amazon.opendistroforelasticsearch.sql.expression.aggregation.Aggregator;\n+import com.google.common.collect.ImmutableSet;\n+import java.util.Arrays;\n import lombok.experimental.UtilityClass;\n \n import java.util.List;\n import java.util.Map;\n \n-/**\n- * Logical Plan DSL.\n- */\n+/** Logical Plan DSL. */\n @UtilityClass\n public class LogicalPlanDSL {\n-    public static LogicalPlan aggregation(LogicalPlan input, List<Aggregator> aggregatorList,\n-                                          List<Expression> groupByList) {\n-        return new LogicalAggregation(input, aggregatorList, groupByList);\n-    }\n-\n-    public static LogicalPlan filter(LogicalPlan input, Expression expression) {\n-        return new LogicalFilter(input, expression);\n-    }\n-\n-    public static LogicalPlan relation(String tableName) {\n-        return new LogicalRelation(tableName);\n-    }\n-\n-    public static LogicalPlan rename(LogicalPlan input, Map<ReferenceExpression, ReferenceExpression> renameMap) {\n-        return new LogicalRename(input, renameMap);\n-    }\n+  public static LogicalPlan aggregation(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc02bb923318eb04f6d8661050b52ab4455bfd5e"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIzNjU4NA==", "bodyText": "Use exprValue directly?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/472#discussion_r428236584", "createdAt": "2020-05-20T18:50:51Z", "author": {"login": "dai-chen"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/planner/physical/ProjectOperator.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ *   Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.planner.physical;\n+\n+import com.amazon.opendistroforelasticsearch.sql.data.model.ExprTupleValue;\n+import com.amazon.opendistroforelasticsearch.sql.data.model.ExprValue;\n+import com.amazon.opendistroforelasticsearch.sql.expression.ReferenceExpression;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.ImmutableMap.Builder;\n+import java.util.Collections;\n+import java.util.List;\n+import lombok.EqualsAndHashCode;\n+import lombok.RequiredArgsConstructor;\n+import lombok.ToString;\n+\n+/** Project the fields specified in {@link ProjectOperator#projectList} from input. */\n+@ToString\n+@EqualsAndHashCode\n+@RequiredArgsConstructor\n+public class ProjectOperator extends PhysicalPlan {\n+  private final PhysicalPlan input;\n+  private final List<ReferenceExpression> projectList;\n+\n+  @Override\n+  public <R, C> R accept(PhysicalPlanNodeVisitor<R, C> visitor, C context) {\n+    return visitor.visitProject(this, context);\n+  }\n+\n+  @Override\n+  public List<PhysicalPlan> getChild() {\n+    return Collections.singletonList(input);\n+  }\n+\n+  @Override\n+  public boolean hasNext() {\n+    return input.hasNext();\n+  }\n+\n+  @Override\n+  public ExprValue next() {\n+    ExprValue inputValue = input.next();\n+    ImmutableMap.Builder<String, ExprValue> mapBuilder = new Builder<>();\n+    for (ReferenceExpression ref : projectList) {\n+      ExprValue exprValue = ref.valueOf(inputValue.bindingTuples());\n+      // missing value is ignored.\n+      if (!exprValue.isMissing()) {\n+        mapBuilder.put(ref.toString(), ref.valueOf(inputValue.bindingTuples()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc02bb923318eb04f6d8661050b52ab4455bfd5e"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7acf764d82eac3941b985766e272e0a50cd6b82f", "author": {"user": {"login": "penghuo", "name": "Peng Huo"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7acf764d82eac3941b985766e272e0a50cd6b82f", "committedDate": "2020-05-20T20:18:38Z", "message": "update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjkwNDA4", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/472#pullrequestreview-415690408", "createdAt": "2020-05-20T20:29:31Z", "commit": {"oid": "7acf764d82eac3941b985766e272e0a50cd6b82f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NzA2ODEx", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/472#pullrequestreview-415706811", "createdAt": "2020-05-20T20:55:00Z", "commit": {"oid": "7acf764d82eac3941b985766e272e0a50cd6b82f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 675, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}