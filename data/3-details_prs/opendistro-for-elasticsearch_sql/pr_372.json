{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNDIyMTAy", "number": 372, "title": "Modified the wording of exception messages and created the troubleshooting page", "bodyText": "Issue #, if available:\n\nIssue #320 Exception handling\n\nDescription of changes:\n\nEdited some implicit wording of the error messages in our code base\nAdded the troubleshooting page in documentation: https://github.com/chloe-zh/sql/blob/existed-exceptions/docs/user/dql/troubleshooting.rst\nTODO: add reference links (reference manual, troubleshooting etc.) to the error messages (would set about this part when the documentation is completed)\n\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-02-26T17:52:22Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/372", "merged": true, "mergeCommit": {"oid": "a4afc757fb9f813464eb31d28d3a1ce6999759bf"}, "closed": true, "closedAt": "2020-03-17T21:32:10Z", "author": {"login": "chloe-zh"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcH8D6oAH2gAyMzgwNDIyMTAyOmY5YTY0ZjkxMzhkMDg0Y2ViNTU2Njc2NTdhMGQ1MjMzOGRhNTk1Zjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOpPpMgH2gAyMzgwNDIyMTAyOjE2NWViYjVkMzU5OGIxOTYwOTRhNTRjNmEzNDhhN2I2YjkyZDFiMzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f9a64f9138d084ceb55667657a0d52338da595f8", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f9a64f9138d084ceb55667657a0d52338da595f8", "committedDate": "2020-02-26T01:02:08Z", "message": "Edit the wording of exception messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "add28207dd90d326a8acaf6d25fc5343ce5af8cb", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/add28207dd90d326a8acaf6d25fc5343ce5af8cb", "committedDate": "2020-02-26T01:09:30Z", "message": "Merge branch 'master' into existed-exceptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6e8f6dc4f446b1fb14baa4ecce54bbfea24bdd5", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/d6e8f6dc4f446b1fb14baa4ecce54bbfea24bdd5", "committedDate": "2020-02-26T01:41:45Z", "message": "Created troubleshooting page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14cccfc82cde036f5de4572c128af0d69341e5db", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/14cccfc82cde036f5de4572c128af0d69341e5db", "committedDate": "2020-02-26T01:44:19Z", "message": "Revised troubleshooting page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f98df42a0e74df5d4ee5969a4c026076798a665f", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f98df42a0e74df5d4ee5969a4c026076798a665f", "committedDate": "2020-02-26T01:45:22Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca13dd4deb8f6387a01c0fa82b0a5cb76d586d6f", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ca13dd4deb8f6387a01c0fa82b0a5cb76d586d6f", "committedDate": "2020-02-26T01:53:08Z", "message": "update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MDc2NjM5", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/372#pullrequestreview-366076639", "createdAt": "2020-02-27T23:42:11Z", "commit": {"oid": "ca13dd4deb8f6387a01c0fa82b0a5cb76d586d6f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMzo0MjoxMVrOFvlBGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMDowMDozMlrOFvlXjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzMzg4MA==", "bodyText": "Are these 2 steps also meant to be labelled 1.?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/372#discussion_r385433880", "createdAt": "2020-02-27T23:42:11Z", "author": {"login": "davidcui1225"}, "path": "docs/user/dql/troubleshooting.rst", "diffHunk": "@@ -0,0 +1,89 @@\n+\n+===============\n+Troubleshooting\n+===============\n+\n+.. contents::\n+   :local:\n+   :depth: 2\n+\n+\n+Narrative\n+=========\n+\n+SQL plugin is stateless for now so mostly the troubleshooting is mainly focused on why a single query fails.\n+\n+\n+Syntax Analysis / Semantic Analysis Exceptions\n+----------------------------------------------\n+\n+**Symptoms**\n+\n+When you end up with exceptions similar to as follows:\n+\n+Query:\n+\n+.. code-block:: JSON\n+\n+\tPOST /_opendistro/_sql\n+\t{\n+\t  \"query\" : \"SELECT * FROM sample:data\"\n+\t}\n+\n+Result:\n+\n+.. code-block:: JSON\n+\n+    {\n+      \"reason\": \"Invalid SQL query\",\n+      \"details\": \"Failed to parse query due to offending symbol [:] at: 'SELECT * FROM xxx WHERE xxx:' <--- HERE...\n+        More details: Expecting tokens in {<EOF>, 'AND', 'BETWEEN', 'GROUP', 'HAVING', 'IN', 'IS', 'LIKE', 'LIMIT',\n+        'NOT', 'OR', 'ORDER', 'REGEXP', '*', '/', '%', '+', '-', 'DIV', 'MOD', '=', '>', '<', '!',\n+        '|', '&', '^', '.', DOT_ID}\",\n+      \"type\": \"SyntaxAnalysisException\"\n+    }\n+\n+**Workaround**\n+\n+You need to confirm if the syntax is not supported and disable query analysis if that's the case by the following steps:\n+\n+1. Identify syntax error in failed query, and correct the syntax if the query does not follow MySQL grammar. Go to step 2 if your query is correct in syntax but it still ends up syntax exception.\n+\n+1. Disable strict query analysis in new ANTLR parser with the following code block.\n+\n+1. Verify if the query can pass now. If the query fails as well, please create an issue in our `GitHub Issues <https://github.com/opendistro-for-elasticsearch/sql/issues>`_ section to report bugs fixing or request new features.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca13dd4deb8f6387a01c0fa82b0a5cb76d586d6f"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzODc1Mg==", "bodyText": "well-known-text?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/372#discussion_r385438752", "createdAt": "2020-02-27T23:57:42Z", "author": {"login": "davidcui1225"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/sql/spatial/WktToGeoJsonConverter.java", "diffHunk": "@@ -29,7 +30,8 @@ public static String toGeoJson(String wkt) {\n         wkt = wkt.toLowerCase();\n         int startOfCoordinates = wkt.indexOf(\"(\");\n         if (startOfCoordinates == -1) {\n-            throw new IllegalArgumentException(\"not valid wkt\");\n+            throw new IllegalArgumentException(\n+                    StringUtils.format(\"Failed to convert well-know-text [%s] to geometry type\", wkt));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca13dd4deb8f6387a01c0fa82b0a5cb76d586d6f"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQzOTYzMQ==", "bodyText": "no need for mostly and mainly to both be in the sentence, it's redundant.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/372#discussion_r385439631", "createdAt": "2020-02-28T00:00:32Z", "author": {"login": "davidcui1225"}, "path": "docs/user/dql/troubleshooting.rst", "diffHunk": "@@ -0,0 +1,89 @@\n+\n+===============\n+Troubleshooting\n+===============\n+\n+.. contents::\n+   :local:\n+   :depth: 2\n+\n+\n+Narrative\n+=========\n+\n+SQL plugin is stateless for now so mostly the troubleshooting is mainly focused on why a single query fails.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca13dd4deb8f6387a01c0fa82b0a5cb76d586d6f"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b98cf1a696e6fb63c93854064dfa0e0cd9a0d9c", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/8b98cf1a696e6fb63c93854064dfa0e0cd9a0d9c", "committedDate": "2020-03-02T17:55:38Z", "message": "addressed comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NDE1NTE3", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/372#pullrequestreview-367415517", "createdAt": "2020-03-02T18:13:05Z", "commit": {"oid": "8b98cf1a696e6fb63c93854064dfa0e0cd9a0d9c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1651d56b58c1b415aea586700321d19fb00038b8", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/1651d56b58c1b415aea586700321d19fb00038b8", "committedDate": "2020-03-02T18:59:59Z", "message": "Merge branch 'master' into existed-exceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NTM3NjUy", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/372#pullrequestreview-367537652", "createdAt": "2020-03-02T21:23:25Z", "commit": {"oid": "1651d56b58c1b415aea586700321d19fb00038b8"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMToyMzoyNVrOFwvwZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMTozMzozNVrOFwwECQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1ODQwNA==", "bodyText": "Maybe better to use SemanticAnalysisException for consistency here and elsewhere.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/372#discussion_r386658404", "createdAt": "2020-03-02T21:23:25Z", "author": {"login": "dai-chen"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/sql/domain/Condition.java", "diffHunk": "@@ -242,7 +243,7 @@ public Condition(CONN conn, String name, SQLExpr nameExpr, String oper,\n         if (OPEAR.operStringToOpear.containsKey(oper)) {\n             this.opear = OPEAR.operStringToOpear.get(oper);\n         } else {\n-            throw new SqlParseException(oper + \" is not a supported operation\");\n+            throw new SqlParseException(\"Unsupported operation: \" + oper);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1651d56b58c1b415aea586700321d19fb00038b8"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY2MjAwNw==", "bodyText": "value.getClass() may need to be replaced by value.getClass().getSimpleName() for example.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/372#discussion_r386662007", "createdAt": "2020-03-02T21:30:49Z", "author": {"login": "dai-chen"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/sql/domain/SearchResult.java", "diffHunk": "@@ -135,7 +135,7 @@ private Object covenValue(Aggregation value) throws SqlParseException {\n         } else if (value instanceof LongTerms) {\n             return value;\n         } else {\n-            throw new SqlParseException(\"unknow this agg type \" + value.getClass());\n+            throw new SqlParseException(\"Unknown aggregation value type: \" + value.getClass());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1651d56b58c1b415aea586700321d19fb00038b8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY2MzQzMw==", "bodyText": "Same here to throw SyntaxAnalysisException for consistency.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/372#discussion_r386663433", "createdAt": "2020-03-02T21:33:35Z", "author": {"login": "dai-chen"}, "path": "src/main/java/com/amazon/opendistroforelasticsearch/sql/parser/ElasticSqlExprParser.java", "diffHunk": "@@ -120,7 +120,7 @@ protected SQLExpr methodRest(SQLExpr expr, boolean acceptLPAREN) {\n             return primaryRest(methodInvokeExpr);\n         }\n \n-        throw new ParserException(\"not support token:\" + lexer.token());\n+        throw new ParserException(\"Syntax error:\" + lexer.token());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1651d56b58c1b415aea586700321d19fb00038b8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95b99a8b830bf6d9921897cadbb69e8fb7eb20fb", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/95b99a8b830bf6d9921897cadbb69e8fb7eb20fb", "committedDate": "2020-03-06T03:56:09Z", "message": "Merge branch 'master' into existed-exceptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6024b679c618f156b6611e7cddf0c98949206dca", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6024b679c618f156b6611e7cddf0c98949206dca", "committedDate": "2020-03-16T03:37:31Z", "message": "addressed comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9ce9f88d04e782730485cd8a9df1087efb6f68a", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e9ce9f88d04e782730485cd8a9df1087efb6f68a", "committedDate": "2020-03-16T03:41:29Z", "message": "Merge branch 'master' into existed-exceptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa229dc88e33455002648449090a9b631c5de338", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/fa229dc88e33455002648449090a9b631c5de338", "committedDate": "2020-03-16T03:43:39Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77a685095116cf3d5becefb1551c2df6584e507d", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/77a685095116cf3d5becefb1551c2df6584e507d", "committedDate": "2020-03-16T23:09:54Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c32511705e71a0e1c51765b0cc34482deec0bc70", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c32511705e71a0e1c51765b0cc34482deec0bc70", "committedDate": "2020-03-17T20:23:07Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b37ab253fb0a152ab40277fba65ce89f6497adf", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2b37ab253fb0a152ab40277fba65ce89f6497adf", "committedDate": "2020-03-17T20:30:44Z", "message": "update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NDAyMzI3", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/372#pullrequestreview-376402327", "createdAt": "2020-03-17T21:01:29Z", "commit": {"oid": "2b37ab253fb0a152ab40277fba65ce89f6497adf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "165ebb5d3598b196094a54c6a348a7b6b92d1b38", "author": {"user": {"login": "chloe-zh", "name": "Chloe"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/165ebb5d3598b196094a54c6a348a7b6b92d1b38", "committedDate": "2020-03-17T21:04:13Z", "message": "Merge remote-tracking branch 'origin' into existed-exceptions"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 752, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}