{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MzM0NTQ0", "number": 913, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxODoxNToyNVrOFEG0Qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxODoyMzoyNVrOFEG_pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODUwMzA3OnYy", "diffSide": "RIGHT", "path": "sql/src/main/java/com/amazon/opendistroforelasticsearch/sql/sql/parser/AstAggregationBuilder.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxODoxNToyNVrOIEEWrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMlQwMjowOTo0MFrOIEZGUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEzNjU1Ng==", "bodyText": "I think we need to check this recursively, ex. ABS(ABS(age)). Could we merge isNonLiteral() to this method as base case for recursion?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/913#discussion_r541136556", "createdAt": "2020-12-11T18:15:25Z", "author": {"login": "dai-chen"}, "path": "sql/src/main/java/com/amazon/opendistroforelasticsearch/sql/sql/parser/AstAggregationBuilder.java", "diffHunk": "@@ -137,6 +139,15 @@ private boolean isNonLiteral(UnresolvedExpression expr) {\n     return !(expr instanceof Literal);\n   }\n \n+  private boolean isNonLiteralFunction(UnresolvedExpression expr) {\n+    if (expr instanceof Function) {\n+      List<? extends Node> children = expr.getChild();\n+      return children.stream()\n+              .allMatch(child -> isNonLiteral((UnresolvedExpression) child));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0260ffa4b77389e0fc165a06242a7c7aadb1c41e"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE1OTI4NQ==", "bodyText": "right, I will add.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/913#discussion_r541159285", "createdAt": "2020-12-11T18:55:47Z", "author": {"login": "rupal-bq"}, "path": "sql/src/main/java/com/amazon/opendistroforelasticsearch/sql/sql/parser/AstAggregationBuilder.java", "diffHunk": "@@ -137,6 +139,15 @@ private boolean isNonLiteral(UnresolvedExpression expr) {\n     return !(expr instanceof Literal);\n   }\n \n+  private boolean isNonLiteralFunction(UnresolvedExpression expr) {\n+    if (expr instanceof Function) {\n+      List<? extends Node> children = expr.getChild();\n+      return children.stream()\n+              .allMatch(child -> isNonLiteral((UnresolvedExpression) child));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEzNjU1Ng=="}, "originalCommit": {"oid": "0260ffa4b77389e0fc165a06242a7c7aadb1c41e"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQ3NjQzNQ==", "bodyText": "added this change.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/913#discussion_r541476435", "createdAt": "2020-12-12T02:09:40Z", "author": {"login": "rupal-bq"}, "path": "sql/src/main/java/com/amazon/opendistroforelasticsearch/sql/sql/parser/AstAggregationBuilder.java", "diffHunk": "@@ -137,6 +139,15 @@ private boolean isNonLiteral(UnresolvedExpression expr) {\n     return !(expr instanceof Literal);\n   }\n \n+  private boolean isNonLiteralFunction(UnresolvedExpression expr) {\n+    if (expr instanceof Function) {\n+      List<? extends Node> children = expr.getChild();\n+      return children.stream()\n+              .allMatch(child -> isNonLiteral((UnresolvedExpression) child));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEzNjU1Ng=="}, "originalCommit": {"oid": "0260ffa4b77389e0fc165a06242a7c7aadb1c41e"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODUzMjIwOnYy", "diffSide": "RIGHT", "path": "integ-test/src/test/java/com/amazon/opendistroforelasticsearch/sql/sql/DateTimeFunctionIT.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxODoyMzoyNVrOIEEn9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMlQwMjoxMjoxNFrOIEZILQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE0MDk4MA==", "bodyText": "Could you add some more test queries as comparison test for this issue in https://github.com/opendistro-for-elasticsearch/sql/tree/develop/integ-test/src/test/resources/correctness/bugfixes", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/913#discussion_r541140980", "createdAt": "2020-12-11T18:23:25Z", "author": {"login": "dai-chen"}, "path": "integ-test/src/test/java/com/amazon/opendistroforelasticsearch/sql/sql/DateTimeFunctionIT.java", "diffHunk": "@@ -60,6 +60,15 @@ public void testDateInGroupBy() throws IOException{\n             rows(\"2018-08-11\"));\n   }\n \n+  @Test\n+  public void testDateWithHavingClauseOnly() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0260ffa4b77389e0fc165a06242a7c7aadb1c41e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE1ODg0MQ==", "bodyText": "Sure, I will add queries without the date function.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/913#discussion_r541158841", "createdAt": "2020-12-11T18:54:56Z", "author": {"login": "rupal-bq"}, "path": "integ-test/src/test/java/com/amazon/opendistroforelasticsearch/sql/sql/DateTimeFunctionIT.java", "diffHunk": "@@ -60,6 +60,15 @@ public void testDateInGroupBy() throws IOException{\n             rows(\"2018-08-11\"));\n   }\n \n+  @Test\n+  public void testDateWithHavingClauseOnly() throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE0MDk4MA=="}, "originalCommit": {"oid": "0260ffa4b77389e0fc165a06242a7c7aadb1c41e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQ3NjkwOQ==", "bodyText": "I added a few tests in comparison but while testing function without input PI() the results returned but another database was different (3.15 instead of 3.141592653589793) so I added manual IT for this.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/913#discussion_r541476909", "createdAt": "2020-12-12T02:12:14Z", "author": {"login": "rupal-bq"}, "path": "integ-test/src/test/java/com/amazon/opendistroforelasticsearch/sql/sql/DateTimeFunctionIT.java", "diffHunk": "@@ -60,6 +60,15 @@ public void testDateInGroupBy() throws IOException{\n             rows(\"2018-08-11\"));\n   }\n \n+  @Test\n+  public void testDateWithHavingClauseOnly() throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE0MDk4MA=="}, "originalCommit": {"oid": "0260ffa4b77389e0fc165a06242a7c7aadb1c41e"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1952, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}