{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NDkxNjU0", "number": 746, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMzozNjo1NVrOElJTDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjo1MToyMlrOEoLMVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3Mzg1MTAyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprDatetimeValue.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMzozNjo1NVrOHUep1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwMDo1NzoyNVrOHUfXpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzNTc5OQ==", "bodyText": "Can simplify amount of code in ternary:\nreturn String.format(\"%s %s\", DateTimeFormatter.ISO_DATE.format(datetime),\n        DateTimeFormatter.ISO_TIME.format((datetime.getNano() == 0) ? \n                datetime.truncatedTo(ChronoUnit.SECONDS) : datetime))", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r491235799", "createdAt": "2020-09-18T23:36:55Z", "author": {"login": "lyndonb-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprDatetimeValue.java", "diffHunk": "@@ -79,8 +80,11 @@ public boolean equal(ExprValue other) {\n \n   @Override\n   public String value() {\n-    return String.format(\"%s %s\", DateTimeFormatter.ISO_DATE.format(datetime),\n-        DateTimeFormatter.ISO_TIME.format(datetime));\n+    return datetime.getNano() == 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b757335ed319003d6b76c23f81f24176c7c48781"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI0NzUyNQ==", "bodyText": "added", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r491247525", "createdAt": "2020-09-19T00:57:25Z", "author": {"login": "rupal-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprDatetimeValue.java", "diffHunk": "@@ -79,8 +80,11 @@ public boolean equal(ExprValue other) {\n \n   @Override\n   public String value() {\n-    return String.format(\"%s %s\", DateTimeFormatter.ISO_DATE.format(datetime),\n-        DateTimeFormatter.ISO_TIME.format(datetime));\n+    return datetime.getNano() == 0", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzNTc5OQ=="}, "originalCommit": {"oid": "b757335ed319003d6b76c23f81f24176c7c48781"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3Mzg1NzA3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMzo0MTo0OVrOHUetFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwMDo1Nzo0NVrOHUfXxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzNjYzMQ==", "bodyText": "I think you can do without ternary.\nreturn new ExprIntegerValue((date.dateValue().getDayOfWeek().getValue() % 7) + 1)", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r491236631", "createdAt": "2020-09-18T23:41:49Z", "author": {"login": "lyndonb-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -123,19 +392,167 @@ private ExprValue exprDate(ExprValue exprValue) {\n     }\n   }\n \n+  /**\n+   * Name of the Weekday implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayName(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprStringValue(\n+        date.dateValue().getDayOfWeek().getDisplayName(TextStyle.FULL, Locale.getDefault()));\n+  }\n+\n   /**\n    * Day of Month implementation for ExprValue.\n    * @param date ExprValue of Date type.\n    * @return ExprValue.\n    */\n   private ExprValue exprDayOfMonth(ExprValue date) {\n     if (date instanceof ExprStringValue) {\n-      return new ExprIntegerValue(\n-          new ExprDateValue(date.stringValue()).dateValue().getDayOfMonth());\n+      date = new ExprDateValue(date.stringValue());\n     }\n     return new ExprIntegerValue(date.dateValue().getDayOfMonth());\n   }\n \n+  /**\n+   * Day of Week implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayOfWeek(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprIntegerValue(date.dateValue().getDayOfWeek().getValue() == 7 ? 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b757335ed319003d6b76c23f81f24176c7c48781"}, "originalPosition": 391}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI0NzU1OA==", "bodyText": "done", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r491247558", "createdAt": "2020-09-19T00:57:45Z", "author": {"login": "rupal-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -123,19 +392,167 @@ private ExprValue exprDate(ExprValue exprValue) {\n     }\n   }\n \n+  /**\n+   * Name of the Weekday implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayName(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprStringValue(\n+        date.dateValue().getDayOfWeek().getDisplayName(TextStyle.FULL, Locale.getDefault()));\n+  }\n+\n   /**\n    * Day of Month implementation for ExprValue.\n    * @param date ExprValue of Date type.\n    * @return ExprValue.\n    */\n   private ExprValue exprDayOfMonth(ExprValue date) {\n     if (date instanceof ExprStringValue) {\n-      return new ExprIntegerValue(\n-          new ExprDateValue(date.stringValue()).dateValue().getDayOfMonth());\n+      date = new ExprDateValue(date.stringValue());\n     }\n     return new ExprIntegerValue(date.dateValue().getDayOfMonth());\n   }\n \n+  /**\n+   * Day of Week implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayOfWeek(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprIntegerValue(date.dateValue().getDayOfWeek().getValue() == 7 ? 1", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzNjYzMQ=="}, "originalCommit": {"oid": "b757335ed319003d6b76c23f81f24176c7c48781"}, "originalPosition": 391}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3Mzg2MDY0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMzo0NDo0MlrOHUevFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOVQwMDo1ODozMlrOHUfYEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzNzE0MQ==", "bodyText": "Should latch variable and reuse since it's a lot of function calls.\nint month = date.dateValue().getMonthValue();\nreturn new ExprIntegerValue((month / 3) + ((month % 3) == 0 ? 0 : 1));", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r491237141", "createdAt": "2020-09-18T23:44:42Z", "author": {"login": "lyndonb-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -123,19 +392,167 @@ private ExprValue exprDate(ExprValue exprValue) {\n     }\n   }\n \n+  /**\n+   * Name of the Weekday implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayName(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprStringValue(\n+        date.dateValue().getDayOfWeek().getDisplayName(TextStyle.FULL, Locale.getDefault()));\n+  }\n+\n   /**\n    * Day of Month implementation for ExprValue.\n    * @param date ExprValue of Date type.\n    * @return ExprValue.\n    */\n   private ExprValue exprDayOfMonth(ExprValue date) {\n     if (date instanceof ExprStringValue) {\n-      return new ExprIntegerValue(\n-          new ExprDateValue(date.stringValue()).dateValue().getDayOfMonth());\n+      date = new ExprDateValue(date.stringValue());\n     }\n     return new ExprIntegerValue(date.dateValue().getDayOfMonth());\n   }\n \n+  /**\n+   * Day of Week implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayOfWeek(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprIntegerValue(date.dateValue().getDayOfWeek().getValue() == 7 ? 1\n+        : date.dateValue().getDayOfWeek().getValue() + 1);\n+  }\n+\n+  /**\n+   * Day of Year implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayOfYear(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprIntegerValue(date.dateValue().getDayOfYear());\n+  }\n+\n+  /** From_days implementation for ExprValue.\n+   * @param exprValue Day number N.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprFromDays(ExprValue exprValue) {\n+    return new ExprDateValue(LocalDate.ofEpochDay(exprValue.longValue() - DAYS_0000_TO_1970));\n+  }\n+\n+  /**\n+   * Hour implementation for ExprValue.\n+   * @param exprValue ExprValue of Time type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprHour(ExprValue exprValue) {\n+    return new ExprIntegerValue(exprValue.timeValue().getHour());\n+  }\n+\n+  /**\n+   * Microsecond implementation for ExprValue.\n+   * @param exprValue ExprValue of Time type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprMicrosecond(ExprValue exprValue) {\n+    return new ExprIntegerValue(\n+        TimeUnit.MICROSECONDS.convert(exprValue.timeValue().getNano(), TimeUnit.NANOSECONDS));\n+  }\n+\n+  /**\n+   * Minute implementation for ExprValue.\n+   * @param exprValue ExprValue of Time type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprMinute(ExprValue exprValue) {\n+    return new ExprIntegerValue(exprValue.timeValue().getMinute());\n+  }\n+\n+  /**\n+   * Month for date implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprMonth(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprIntegerValue(date.dateValue().getMonthValue());\n+  }\n+\n+  /**\n+   * Name of the Month implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprMonthName(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprStringValue(\n+        date.dateValue().getMonth().getDisplayName(TextStyle.FULL, Locale.getDefault()));\n+  }\n+\n+  /**\n+   * Quarter for date implementation for ExprValue.\n+   *\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprQuarter(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprIntegerValue((date.dateValue().getMonthValue() % 3) == 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b757335ed319003d6b76c23f81f24176c7c48781"}, "originalPosition": 478}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI0NzYzMw==", "bodyText": "Thanks, I added a variable.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r491247633", "createdAt": "2020-09-19T00:58:32Z", "author": {"login": "rupal-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -123,19 +392,167 @@ private ExprValue exprDate(ExprValue exprValue) {\n     }\n   }\n \n+  /**\n+   * Name of the Weekday implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayName(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprStringValue(\n+        date.dateValue().getDayOfWeek().getDisplayName(TextStyle.FULL, Locale.getDefault()));\n+  }\n+\n   /**\n    * Day of Month implementation for ExprValue.\n    * @param date ExprValue of Date type.\n    * @return ExprValue.\n    */\n   private ExprValue exprDayOfMonth(ExprValue date) {\n     if (date instanceof ExprStringValue) {\n-      return new ExprIntegerValue(\n-          new ExprDateValue(date.stringValue()).dateValue().getDayOfMonth());\n+      date = new ExprDateValue(date.stringValue());\n     }\n     return new ExprIntegerValue(date.dateValue().getDayOfMonth());\n   }\n \n+  /**\n+   * Day of Week implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayOfWeek(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprIntegerValue(date.dateValue().getDayOfWeek().getValue() == 7 ? 1\n+        : date.dateValue().getDayOfWeek().getValue() + 1);\n+  }\n+\n+  /**\n+   * Day of Year implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayOfYear(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprIntegerValue(date.dateValue().getDayOfYear());\n+  }\n+\n+  /** From_days implementation for ExprValue.\n+   * @param exprValue Day number N.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprFromDays(ExprValue exprValue) {\n+    return new ExprDateValue(LocalDate.ofEpochDay(exprValue.longValue() - DAYS_0000_TO_1970));\n+  }\n+\n+  /**\n+   * Hour implementation for ExprValue.\n+   * @param exprValue ExprValue of Time type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprHour(ExprValue exprValue) {\n+    return new ExprIntegerValue(exprValue.timeValue().getHour());\n+  }\n+\n+  /**\n+   * Microsecond implementation for ExprValue.\n+   * @param exprValue ExprValue of Time type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprMicrosecond(ExprValue exprValue) {\n+    return new ExprIntegerValue(\n+        TimeUnit.MICROSECONDS.convert(exprValue.timeValue().getNano(), TimeUnit.NANOSECONDS));\n+  }\n+\n+  /**\n+   * Minute implementation for ExprValue.\n+   * @param exprValue ExprValue of Time type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprMinute(ExprValue exprValue) {\n+    return new ExprIntegerValue(exprValue.timeValue().getMinute());\n+  }\n+\n+  /**\n+   * Month for date implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprMonth(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprIntegerValue(date.dateValue().getMonthValue());\n+  }\n+\n+  /**\n+   * Name of the Month implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprMonthName(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprStringValue(\n+        date.dateValue().getMonth().getDisplayName(TextStyle.FULL, Locale.getDefault()));\n+  }\n+\n+  /**\n+   * Quarter for date implementation for ExprValue.\n+   *\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprQuarter(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprIntegerValue((date.dateValue().getMonthValue() % 3) == 0", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIzNzE0MQ=="}, "originalCommit": {"oid": "b757335ed319003d6b76c23f81f24176c7c48781"}, "originalPosition": 478}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDA1NDQ3OnYy", "diffSide": "RIGHT", "path": "docs/user/dql/functions.rst", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjowNDowN1rOHVYGdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODoxMzozNFrOHXm2WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3NzAxNQ==", "bodyText": "The format is the doc is not correct.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r492177015", "createdAt": "2020-09-21T16:04:07Z", "author": {"login": "penghuo"}, "path": "docs/user/dql/functions.rst", "diffHunk": "@@ -323,16 +323,178 @@ Specifications:\n 1. DATE_FORMAT(DATE, STRING) -> STRING\n 2. DATE_FORMAT(DATE, STRING, STRING) -> STRING\n \n+DATE_ADD\n+=====\n+\n+Description\n+-----------\n+\n+Usage: date_add(date, INTERVAL expr unit) adds the time interval expr to date\n+\n+Argument type: DATE/DATETIME/TIMESTAMP, INTERVAL\n+\n+Return type:\n+\n+(DATE, DATE INTERVAL) -> DATE\n+(DATE, TIME INTERVAL) -> DATETIME\n+(DATETIME/TIMESTAMP, INTERVAL) -> DATETIME", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3ODM1Ng==", "bodyText": "could you add example for each case?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r492178356", "createdAt": "2020-09-21T16:06:06Z", "author": {"login": "penghuo"}, "path": "docs/user/dql/functions.rst", "diffHunk": "@@ -323,16 +323,178 @@ Specifications:\n 1. DATE_FORMAT(DATE, STRING) -> STRING\n 2. DATE_FORMAT(DATE, STRING, STRING) -> STRING\n \n+DATE_ADD\n+=====\n+\n+Description\n+-----------\n+\n+Usage: date_add(date, INTERVAL expr unit) adds the time interval expr to date\n+\n+Argument type: DATE/DATETIME/TIMESTAMP, INTERVAL\n+\n+Return type:\n+\n+(DATE, DATE INTERVAL) -> DATE\n+(DATE, TIME INTERVAL) -> DATETIME\n+(DATETIME/TIMESTAMP, INTERVAL) -> DATETIME", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3NzAxNQ=="}, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUxNTgwMQ==", "bodyText": "fixed format & added example for each case.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r494515801", "createdAt": "2020-09-24T18:13:34Z", "author": {"login": "rupal-bq"}, "path": "docs/user/dql/functions.rst", "diffHunk": "@@ -323,16 +323,178 @@ Specifications:\n 1. DATE_FORMAT(DATE, STRING) -> STRING\n 2. DATE_FORMAT(DATE, STRING, STRING) -> STRING\n \n+DATE_ADD\n+=====\n+\n+Description\n+-----------\n+\n+Usage: date_add(date, INTERVAL expr unit) adds the time interval expr to date\n+\n+Argument type: DATE/DATETIME/TIMESTAMP, INTERVAL\n+\n+Return type:\n+\n+(DATE, DATE INTERVAL) -> DATE\n+(DATE, TIME INTERVAL) -> DATETIME\n+(DATETIME/TIMESTAMP, INTERVAL) -> DATETIME", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3NzAxNQ=="}, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDA1NzkwOnYy", "diffSide": "RIGHT", "path": "docs/user/dql/functions.rst", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjowNDo1NlrOHVYIgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODoxNDoxMVrOHXm3ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3NzUzOA==", "bodyText": "please add other signature, e.g. data_add(date, expression) also", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r492177538", "createdAt": "2020-09-21T16:04:56Z", "author": {"login": "penghuo"}, "path": "docs/user/dql/functions.rst", "diffHunk": "@@ -323,16 +323,178 @@ Specifications:\n 1. DATE_FORMAT(DATE, STRING) -> STRING\n 2. DATE_FORMAT(DATE, STRING, STRING) -> STRING\n \n+DATE_ADD\n+=====\n+\n+Description\n+-----------\n+\n+Usage: date_add(date, INTERVAL expr unit) adds the time interval expr to date", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUxNjE1NA==", "bodyText": "done", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r494516154", "createdAt": "2020-09-24T18:14:11Z", "author": {"login": "rupal-bq"}, "path": "docs/user/dql/functions.rst", "diffHunk": "@@ -323,16 +323,178 @@ Specifications:\n 1. DATE_FORMAT(DATE, STRING) -> STRING\n 2. DATE_FORMAT(DATE, STRING, STRING) -> STRING\n \n+DATE_ADD\n+=====\n+\n+Description\n+-----------\n+\n+Usage: date_add(date, INTERVAL expr unit) adds the time interval expr to date", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3NzUzOA=="}, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDA2MTE4OnYy", "diffSide": "RIGHT", "path": "docs/user/dql/functions.rst", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjowNTozOFrOHVYKjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODoxNDozNFrOHXm4fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3ODA2MA==", "bodyText": "do we support ADDDATE? if not, remove this.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r492178060", "createdAt": "2020-09-21T16:05:38Z", "author": {"login": "penghuo"}, "path": "docs/user/dql/functions.rst", "diffHunk": "@@ -323,16 +323,178 @@ Specifications:\n 1. DATE_FORMAT(DATE, STRING) -> STRING\n 2. DATE_FORMAT(DATE, STRING, STRING) -> STRING\n \n+DATE_ADD\n+=====\n+\n+Description\n+-----------\n+\n+Usage: date_add(date, INTERVAL expr unit) adds the time interval expr to date\n+\n+Argument type: DATE/DATETIME/TIMESTAMP, INTERVAL\n+\n+Return type:\n+\n+(DATE, DATE INTERVAL) -> DATE\n+(DATE, TIME INTERVAL) -> DATETIME\n+(DATETIME/TIMESTAMP, INTERVAL) -> DATETIME\n+\n+Synonyms: ADDDATE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUxNjM1MQ==", "bodyText": "we support ADDDATE", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r494516351", "createdAt": "2020-09-24T18:14:34Z", "author": {"login": "rupal-bq"}, "path": "docs/user/dql/functions.rst", "diffHunk": "@@ -323,16 +323,178 @@ Specifications:\n 1. DATE_FORMAT(DATE, STRING) -> STRING\n 2. DATE_FORMAT(DATE, STRING, STRING) -> STRING\n \n+DATE_ADD\n+=====\n+\n+Description\n+-----------\n+\n+Usage: date_add(date, INTERVAL expr unit) adds the time interval expr to date\n+\n+Argument type: DATE/DATETIME/TIMESTAMP, INTERVAL\n+\n+Return type:\n+\n+(DATE, DATE INTERVAL) -> DATE\n+(DATE, TIME INTERVAL) -> DATETIME\n+(DATETIME/TIMESTAMP, INTERVAL) -> DATETIME\n+\n+Synonyms: ADDDATE", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE3ODA2MA=="}, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDEwOTU2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjoxNzo0NVrOHVYpGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODoyMTowM1rOHXnGSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE4NTg4MQ==", "bodyText": "why the function has same input signature but has different output signature?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r492185881", "createdAt": "2020-09-21T16:17:45Z", "author": {"login": "penghuo"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -72,17 +100,202 @@ private FunctionResolver date() {\n         impl(nullMissingHandling(DateTimeFunction::exprDate), DATE, TIMESTAMP));\n   }\n \n+  /**\n+   * Specify a start date and add a temporal amount to the date.\n+   * The return type depends on the date type and the interval unit. Detailed supported signatures:\n+   * (DATE, DATETIME/TIMESTAMP, INTERVAL) -> DATETIME\n+   * (DATE, LONG) -> DATE\n+   * (DATETIME/TIMESTAMP, LONG) -> DATETIME\n+   */\n+  private FunctionResolver date_add() {\n+    return define(BuiltinFunctionName.DATE_ADD.getName(),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval), DATE, DATE, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval), DATETIME, DATE, INTERVAL),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUxOTg4MA==", "bodyText": "some use cases required different return type. E.g select date_add(date('2020-09-16'), interval 1 hour) should return 2020-09-16 01:00:00 but select date_add(date('2020-09-16'), interval 1 day) should return 2020-09-17.  But this was always returning datetime in schema  anyway so removed it.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r494519880", "createdAt": "2020-09-24T18:21:03Z", "author": {"login": "rupal-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -72,17 +100,202 @@ private FunctionResolver date() {\n         impl(nullMissingHandling(DateTimeFunction::exprDate), DATE, TIMESTAMP));\n   }\n \n+  /**\n+   * Specify a start date and add a temporal amount to the date.\n+   * The return type depends on the date type and the interval unit. Detailed supported signatures:\n+   * (DATE, DATETIME/TIMESTAMP, INTERVAL) -> DATETIME\n+   * (DATE, LONG) -> DATE\n+   * (DATETIME/TIMESTAMP, LONG) -> DATETIME\n+   */\n+  private FunctionResolver date_add() {\n+    return define(BuiltinFunctionName.DATE_ADD.getName(),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval), DATE, DATE, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval), DATETIME, DATE, INTERVAL),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE4NTg4MQ=="}, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDExMzA2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjoxODozNlrOHVYrKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODoyMToyNlrOHXnHWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE4NjQxMQ==", "bodyText": "do you mean (DATE/DATETIME/TIMESTAMP, INTERVAL) -> DATETIME", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r492186411", "createdAt": "2020-09-21T16:18:36Z", "author": {"login": "penghuo"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -72,17 +100,202 @@ private FunctionResolver date() {\n         impl(nullMissingHandling(DateTimeFunction::exprDate), DATE, TIMESTAMP));\n   }\n \n+  /**\n+   * Specify a start date and add a temporal amount to the date.\n+   * The return type depends on the date type and the interval unit. Detailed supported signatures:\n+   * (DATE, DATETIME/TIMESTAMP, INTERVAL) -> DATETIME", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUyMDE1NQ==", "bodyText": "yes, fixed it.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r494520155", "createdAt": "2020-09-24T18:21:26Z", "author": {"login": "rupal-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -72,17 +100,202 @@ private FunctionResolver date() {\n         impl(nullMissingHandling(DateTimeFunction::exprDate), DATE, TIMESTAMP));\n   }\n \n+  /**\n+   * Specify a start date and add a temporal amount to the date.\n+   * The return type depends on the date type and the interval unit. Detailed supported signatures:\n+   * (DATE, DATETIME/TIMESTAMP, INTERVAL) -> DATETIME", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE4NjQxMQ=="}, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDEyNzU3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjoyMjowNVrOHVYz4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjoyMjowNVrOHVYz4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE4ODY0MA==", "bodyText": "The ExprDatetimeValue only has type DATETIME.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r492188640", "createdAt": "2020-09-21T16:22:05Z", "author": {"login": "penghuo"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -110,6 +334,51 @@ private FunctionResolver timestamp() {\n         impl(nullMissingHandling(DateTimeFunction::exprTimestamp), TIMESTAMP, TIMESTAMP));\n   }\n \n+  /**\n+   * TO_DAYS(DATE). return the day number of the given date.\n+   */\n+  private FunctionResolver to_days() {\n+    return define(BuiltinFunctionName.TO_DAYS.getName(),\n+        impl(nullMissingHandling(DateTimeFunction::exprToDays), LONG, STRING),\n+        impl(nullMissingHandling(DateTimeFunction::exprToDays), LONG, DATE),\n+        impl(nullMissingHandling(DateTimeFunction::exprToDays), LONG, DATETIME));\n+  }\n+\n+  /**\n+   * YEAR(DATE). return the year for date (1000-9999).\n+   */\n+  private FunctionResolver year() {\n+    return define(BuiltinFunctionName.YEAR.getName(),\n+        impl(nullMissingHandling(DateTimeFunction::exprYear), INTEGER, DATE),\n+        impl(nullMissingHandling(DateTimeFunction::exprYear), INTEGER, STRING)\n+    );\n+  }\n+\n+  /**\n+   * ADDDATE function implementation for ExprValue.\n+   *\n+   * @param date ExprValue of Date/Datetime/Timestamp type.\n+   * @param expr ExprValue of Interval type, the temporal amount to add.\n+   * @return Date/Datetime resulted from expr added to date.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 328}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDE2NzY3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjozMTo1NVrOHVZMug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjozMTo1NVrOHVZMug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE5NTAwMg==", "bodyText": "The input value should be final", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r492195002", "createdAt": "2020-09-21T16:31:55Z", "author": {"login": "penghuo"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -123,19 +392,165 @@ private ExprValue exprDate(ExprValue exprValue) {\n     }\n   }\n \n+  /**\n+   * Name of the Weekday implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayName(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());\n+    }\n+    return new ExprStringValue(\n+        date.dateValue().getDayOfWeek().getDisplayName(TextStyle.FULL, Locale.getDefault()));\n+  }\n+\n   /**\n    * Day of Month implementation for ExprValue.\n    * @param date ExprValue of Date type.\n    * @return ExprValue.\n    */\n   private ExprValue exprDayOfMonth(ExprValue date) {\n     if (date instanceof ExprStringValue) {\n-      return new ExprIntegerValue(\n-          new ExprDateValue(date.stringValue()).dateValue().getDayOfMonth());\n+      date = new ExprDateValue(date.stringValue());\n     }\n     return new ExprIntegerValue(date.dateValue().getDayOfMonth());\n   }\n \n+  /**\n+   * Day of Week implementation for ExprValue.\n+   * @param date ExprValue of Date type.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprDayOfWeek(ExprValue date) {\n+    if (date instanceof ExprStringValue) {\n+      date = new ExprDateValue(date.stringValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 389}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDI4ODM1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzowNDoyMlrOHVaXqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODoyMjoyN1rOHXnKew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxNDE4Nw==", "bodyText": "e.g. day(date_add(\"2020-09-21\", 1))\nthis will throw exception because day function can't accept datetime as paramater?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r492214187", "createdAt": "2020-09-21T17:04:22Z", "author": {"login": "penghuo"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -72,17 +100,202 @@ private FunctionResolver date() {\n         impl(nullMissingHandling(DateTimeFunction::exprDate), DATE, TIMESTAMP));\n   }\n \n+  /**\n+   * Specify a start date and add a temporal amount to the date.\n+   * The return type depends on the date type and the interval unit. Detailed supported signatures:\n+   * (DATE, DATETIME/TIMESTAMP, INTERVAL) -> DATETIME\n+   * (DATE, LONG) -> DATE\n+   * (DATETIME/TIMESTAMP, LONG) -> DATETIME\n+   */\n+  private FunctionResolver date_add() {\n+    return define(BuiltinFunctionName.DATE_ADD.getName(),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval), DATE, DATE, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval), DATETIME, DATE, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval),\n+            DATETIME, DATETIME, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval),\n+            DATETIME, TIMESTAMP, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateDays), DATE, DATE, LONG),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateDays), DATETIME, DATETIME, LONG),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateDays), DATETIME, TIMESTAMP, LONG)\n+    );\n+  }\n+\n+  /**\n+   * Specify a start date and subtract a temporal amount to the date.\n+   * The return type depends on the date type and the interval unit. Detailed supported signatures:\n+   * (DATE, DATETIME/TIMESTAMP, INTERVAL) -> DATETIME\n+   * (DATE, LONG) -> DATE\n+   * (DATETIME/TIMESTAMP, LONG) -> DATETIME\n+   */\n+  private FunctionResolver date_sub() {\n+    return define(BuiltinFunctionName.DATE_SUB.getName(),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateInterval), DATE, DATE, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateInterval), DATETIME, DATE, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateInterval),\n+            DATETIME, DATETIME, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateInterval),\n+            DATETIME, TIMESTAMP, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateDays), DATE, DATE, LONG),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateDays), DATETIME, DATETIME, LONG),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateDays), DATETIME, TIMESTAMP, LONG)\n+    );\n+  }\n+\n+  /**\n+   * DAY(DATE). return the day of the month (1-31).\n+   */\n+  private FunctionResolver day() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUyMDk1NQ==", "bodyText": "added datetime & timestamp for all functions", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r494520955", "createdAt": "2020-09-24T18:22:27Z", "author": {"login": "rupal-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -72,17 +100,202 @@ private FunctionResolver date() {\n         impl(nullMissingHandling(DateTimeFunction::exprDate), DATE, TIMESTAMP));\n   }\n \n+  /**\n+   * Specify a start date and add a temporal amount to the date.\n+   * The return type depends on the date type and the interval unit. Detailed supported signatures:\n+   * (DATE, DATETIME/TIMESTAMP, INTERVAL) -> DATETIME\n+   * (DATE, LONG) -> DATE\n+   * (DATETIME/TIMESTAMP, LONG) -> DATETIME\n+   */\n+  private FunctionResolver date_add() {\n+    return define(BuiltinFunctionName.DATE_ADD.getName(),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval), DATE, DATE, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval), DATETIME, DATE, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval),\n+            DATETIME, DATETIME, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval),\n+            DATETIME, TIMESTAMP, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateDays), DATE, DATE, LONG),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateDays), DATETIME, DATETIME, LONG),\n+        impl(nullMissingHandling(DateTimeFunction::exprAddDateDays), DATETIME, TIMESTAMP, LONG)\n+    );\n+  }\n+\n+  /**\n+   * Specify a start date and subtract a temporal amount to the date.\n+   * The return type depends on the date type and the interval unit. Detailed supported signatures:\n+   * (DATE, DATETIME/TIMESTAMP, INTERVAL) -> DATETIME\n+   * (DATE, LONG) -> DATE\n+   * (DATETIME/TIMESTAMP, LONG) -> DATETIME\n+   */\n+  private FunctionResolver date_sub() {\n+    return define(BuiltinFunctionName.DATE_SUB.getName(),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateInterval), DATE, DATE, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateInterval), DATETIME, DATE, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateInterval),\n+            DATETIME, DATETIME, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateInterval),\n+            DATETIME, TIMESTAMP, INTERVAL),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateDays), DATE, DATE, LONG),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateDays), DATETIME, DATETIME, LONG),\n+        impl(nullMissingHandling(DateTimeFunction::exprSubDateDays), DATETIME, TIMESTAMP, LONG)\n+    );\n+  }\n+\n+  /**\n+   * DAY(DATE). return the day of the month (1-31).\n+   */\n+  private FunctionResolver day() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxNDE4Nw=="}, "originalCommit": {"oid": "1a44c36c211c4e15caf6917cac7f6dc3791129ea"}, "originalPosition": 124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NTE0NzczOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODo1MDoxNVrOHXoU5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODo1MDoxNVrOHXoU5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU0MDAwNg==", "bodyText": "adddate, date_add, date_sub & subdate need to return date/datetime according to calculated result. Here, I have returned date if time is zero for these functions to get correct result. But the return type will be still be datetime in schema because multiple return type can't be added in define function for the same input parameters.", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r494540006", "createdAt": "2020-09-24T18:50:15Z", "author": {"login": "rupal-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -114,28 +361,57 @@ private FunctionResolver timestamp() {\n   }\n \n   /**\n-   * Specify a start date and add a temporal amount to the date.\n-   * The return type depends on the date type and the interval unit. Detailed supported signatures:\n-   * (DATE, DATETIME/TIMESTAMP, INTERVAL) -> DATETIME\n-   * (DATE, LONG) -> DATE\n-   * (DATETIME/TIMESTAMP, LONG) -> DATETIME\n+   * TO_DAYS(STRING/DATE/DATETIME/TIMESTAMP). return the day number of the given date.\n    */\n-  private FunctionResolver adddate() {\n-    return define(BuiltinFunctionName.ADDDATE.getName(),\n-        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval), DATE, DATE, INTERVAL),\n-        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval), DATETIME, DATE, INTERVAL),\n-        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval),\n-            DATETIME, DATETIME, INTERVAL),\n-        impl(nullMissingHandling(DateTimeFunction::exprAddDateInterval),\n-            DATETIME, TIMESTAMP, INTERVAL),\n-        impl(nullMissingHandling(DateTimeFunction::exprAddDateDays), DATE, DATE, LONG),\n-        impl(nullMissingHandling(DateTimeFunction::exprAddDateDays), DATETIME, DATETIME, LONG),\n-        impl(nullMissingHandling(DateTimeFunction::exprAddDateDays), DATETIME, TIMESTAMP, LONG)\n+  private FunctionResolver to_days() {\n+    return define(BuiltinFunctionName.TO_DAYS.getName(),\n+        impl(nullMissingHandling(DateTimeFunction::exprToDays), LONG, STRING),\n+        impl(nullMissingHandling(DateTimeFunction::exprToDays), LONG, TIMESTAMP),\n+        impl(nullMissingHandling(DateTimeFunction::exprToDays), LONG, DATE),\n+        impl(nullMissingHandling(DateTimeFunction::exprToDays), LONG, DATETIME));\n+  }\n+\n+  /**\n+   * YEAR(STRING/DATE/DATETIME/TIMESTAMP). return the year for date (1000-9999).\n+   */\n+  private FunctionResolver year() {\n+    return define(BuiltinFunctionName.YEAR.getName(),\n+        impl(nullMissingHandling(DateTimeFunction::exprYear), INTEGER, DATE),\n+        impl(nullMissingHandling(DateTimeFunction::exprYear), INTEGER, DATETIME),\n+        impl(nullMissingHandling(DateTimeFunction::exprYear), INTEGER, TIMESTAMP),\n+        impl(nullMissingHandling(DateTimeFunction::exprYear), INTEGER, STRING)\n     );\n   }\n \n+  /**\n+   * ADDDATE function implementation for ExprValue.\n+   *\n+   * @param date ExprValue of String/Date/Datetime/Timestamp type.\n+   * @param expr ExprValue of Interval type, the temporal amount to add.\n+   * @return Datetime resulted from expr added to date.\n+   */\n+  private ExprValue exprAddDateInterval(ExprValue date, ExprValue expr) {\n+    ExprValue exprValue = new ExprDatetimeValue(date.datetimeValue().plus(expr.intervalValue()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea9b19088bdad36d4f8d6f7c71a1171bf202cafa"}, "originalPosition": 368}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwNTYxODc5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprStringValue.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNjo1MToyMlrOHZHNtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxODozMDowN1rOHZKsNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA5NDY0NA==", "bodyText": "could you add the test cases for these functions?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r496094644", "createdAt": "2020-09-28T16:51:22Z", "author": {"login": "penghuo"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprStringValue.java", "diffHunk": "@@ -43,6 +48,40 @@ public String stringValue() {\n     return value;\n   }\n \n+  @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61ac4e51112c91a47cc5875baedc83fcab86ec33"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE1MTYwNg==", "bodyText": "added test cases for date-time functions in ExprStringValue", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/746#discussion_r496151606", "createdAt": "2020-09-28T18:30:07Z", "author": {"login": "rupal-bq"}, "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprStringValue.java", "diffHunk": "@@ -43,6 +48,40 @@ public String stringValue() {\n     return value;\n   }\n \n+  @Override", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA5NDY0NA=="}, "originalCommit": {"oid": "61ac4e51112c91a47cc5875baedc83fcab86ec33"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2033, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}