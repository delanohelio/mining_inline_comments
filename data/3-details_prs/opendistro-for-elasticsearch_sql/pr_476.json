{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwOTA5MzA1", "number": 476, "title": "[PPL] Add simple json formatter", "bodyText": "Issue #, if available:\nDescription of changes: Add a new protocol module for query request parsing and response formatting. Note that the reason of not use existing common module is due to dependency cycle between core and common module.\nBy submitting this pull request, I confirm that my contribution is made under the terms of the Apache 2.0 license.", "createdAt": "2020-05-20T17:30:53Z", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/476", "merged": true, "mergeCommit": {"oid": "5ce4b569c544fd5c3d9806e0c203e06a397c0ea3"}, "closed": true, "closedAt": "2020-05-20T20:41:20Z", "author": {"login": "dai-chen"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcikJMgAH2gAyNDIwOTA5MzA1OjU4ODI4ZjIyMjNkNzc5ZjI4ZDFhMjdjYjFlODczNjc3MDljM2YzMmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjPKvEAH2gAyNDIwOTA5MzA1OmY1NjM5OTA0ZGFkOGVlNjM4NDNhNmQ2MjBiOWI5MjA1NDFmNTE1ODU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "58828f2223d779f28d1a27cb1e87367709c3f32d", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/58828f2223d779f28d1a27cb1e87367709c3f32d", "committedDate": "2020-05-18T18:26:08Z", "message": "Move response listener interface to common module and add java doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "633730a72cb101f8ef5ee7331d56cb82ac83f904", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/633730a72cb101f8ef5ee7331d56cb82ac83f904", "committedDate": "2020-05-18T21:14:21Z", "message": "Add json response formatter and UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dcbfbb274052b5cc84a5ba5e58c4e3fb29a86c4", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7dcbfbb274052b5cc84a5ba5e58c4e3fb29a86c4", "committedDate": "2020-05-18T23:21:44Z", "message": "Add json response formatter and UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc8335d90e7578677a9ed7bee4be384f7e3f0b6d", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/dc8335d90e7578677a9ed7bee4be384f7e3f0b6d", "committedDate": "2020-05-18T23:44:42Z", "message": "Add json response formatter and UT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c5ce828bcbba56de20f0c14c0508dbe8c0e82ed", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7c5ce828bcbba56de20f0c14c0508dbe8c0e82ed", "committedDate": "2020-05-18T23:51:28Z", "message": "Add enum for pretty format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65a3391f7061a98fae04f900f0e4df21c392b2c2", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/65a3391f7061a98fae04f900f0e4df21c392b2c2", "committedDate": "2020-05-18T23:52:47Z", "message": "Merge branch 'feature/ppl' into add-table-formatter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be481d73e58119b2767ab2ecc0c7414998e0a4ca", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/be481d73e58119b2767ab2ecc0c7414998e0a4ca", "committedDate": "2020-05-19T23:45:01Z", "message": "Move to protocol module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e3019ee2e2a08bcd7fa7174f7b849a00edebb4b", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3e3019ee2e2a08bcd7fa7174f7b849a00edebb4b", "committedDate": "2020-05-19T23:49:40Z", "message": "Move to protocol module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d37b8b527d99dbf5bc74d97eb9be93ced59702d", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6d37b8b527d99dbf5bc74d97eb9be93ced59702d", "committedDate": "2020-05-20T00:35:33Z", "message": "Implement json formatter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c00be111e989c6433e9b96210eb1af64b431c8c", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7c00be111e989c6433e9b96210eb1af64b431c8c", "committedDate": "2020-05-20T03:32:42Z", "message": "Add more UTs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10a76c685c81725ca74f6150aa595a7e5022671a", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/10a76c685c81725ca74f6150aa595a7e5022671a", "committedDate": "2020-05-20T03:38:25Z", "message": "Refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaaec3f62c8290ef58f60a48fea5628f254d13ea", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/aaaec3f62c8290ef58f60a48fea5628f254d13ea", "committedDate": "2020-05-20T03:46:28Z", "message": "Fix error in ppl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f638a6d7f9d10616936d663974f8416828046abd", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f638a6d7f9d10616936d663974f8416828046abd", "committedDate": "2020-05-20T16:18:44Z", "message": "Add total and size field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "764262a2a4fad9e410bd48868d9d1e28655dd63a", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/764262a2a4fad9e410bd48868d9d1e28655dd63a", "committedDate": "2020-05-20T17:03:22Z", "message": "Refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0791ff48bc1adba5ba8e2a463506a342a0b08fb1", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/0791ff48bc1adba5ba8e2a463506a342a0b08fb1", "committedDate": "2020-05-20T17:12:14Z", "message": "Refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "881bc889acda8f2e8c91c82dd6d693967ddaaff1", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/881bc889acda8f2e8c91c82dd6d693967ddaaff1", "committedDate": "2020-05-20T17:12:54Z", "message": "Refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ac3019bdc3c49f270b13921ae2e7d9e19546868", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2ac3019bdc3c49f270b13921ae2e7d9e19546868", "committedDate": "2020-05-20T17:15:57Z", "message": "Refactor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f48a8f28ad50dbdcfd4bf2ca3c4cb46b6a06ec1a", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f48a8f28ad50dbdcfd4bf2ca3c4cb46b6a06ec1a", "committedDate": "2020-05-20T17:19:54Z", "message": "Add JavaDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33df6f72e5332f59681a744b6d9c8ccbb6dfff60", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/33df6f72e5332f59681a744b6d9c8ccbb6dfff60", "committedDate": "2020-05-20T17:27:23Z", "message": "Add JavaDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e457537f0845baefc6c20428cbeec149de91d1a", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3e457537f0845baefc6c20428cbeec149de91d1a", "committedDate": "2020-05-20T17:41:50Z", "message": "Merge branch 'feature/ppl' into add-table-formatter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NTk2Nzc4", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/476#pullrequestreview-415596778", "createdAt": "2020-05-20T18:18:09Z", "commit": {"oid": "3e457537f0845baefc6c20428cbeec149de91d1a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxODoxODoxMFrOGYYJXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxODoxODoxMFrOGYYJXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIxNDYyMA==", "bodyText": "it is possible the ExprValue has missing value, in this case, the type value may missing.\ne.g. [{\"name\": \"susan\"}, {\"name\": \"bob\", \"age\":30}].\nit may required the type info from the planner?", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/476#discussion_r428214620", "createdAt": "2020-05-20T18:18:10Z", "author": {"login": "penghuo"}, "path": "protocol/src/main/java/com/amazon/opendistroforelasticsearch/sql/protocol/response/QueryResponse.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ *    Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *    Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *    You may not use this file except in compliance with the License.\n+ *    A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *    or in the \"license\" file accompanying this file. This file is distributed\n+ *    on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *    express or implied. See the License for the specific language governing\n+ *    permissions and limitations under the License.\n+ *\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.protocol.response;\n+\n+import com.amazon.opendistroforelasticsearch.sql.data.model.ExprValue;\n+import com.amazon.opendistroforelasticsearch.sql.data.model.ExprValueUtils;\n+import lombok.RequiredArgsConstructor;\n+\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.Iterator;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+\n+/**\n+ * Query response that encapsulates query results and isolate {@link ExprValue} related from formatter implementation.\n+ */\n+@RequiredArgsConstructor\n+public class QueryResponse implements Iterable<Object[]> {\n+\n+    /**\n+     * Results which are collection of expression\n+     */\n+    private final Collection<ExprValue> exprValues;\n+\n+\n+    /**\n+     * @return  size of results\n+     */\n+    public int size() {\n+        return exprValues.size();\n+    }\n+\n+    /**\n+     * Parse column name from results\n+     * @return  mapping from column names to its expression type\n+     */\n+    public Map<String, String> columnNameTypes() {\n+        if (exprValues.isEmpty()) {\n+            return Collections.emptyMap();\n+        }\n+\n+        Map<String, ExprValue> tupleValue = getFirstTupleValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e457537f0845baefc6c20428cbeec149de91d1a"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1Njg1MDc2", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/476#pullrequestreview-415685076", "createdAt": "2020-05-20T20:21:17Z", "commit": {"oid": "3e457537f0845baefc6c20428cbeec149de91d1a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjkyNTkz", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/476#pullrequestreview-415692593", "createdAt": "2020-05-20T20:32:53Z", "commit": {"oid": "3e457537f0845baefc6c20428cbeec149de91d1a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5639904dad8ee63843a6d620b9b920541f51585", "author": {"user": {"login": "dai-chen", "name": "Chen Dai"}}, "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f5639904dad8ee63843a6d620b9b920541f51585", "committedDate": "2020-05-20T20:33:44Z", "message": "Add to-do and UT for missing values"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 676, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}