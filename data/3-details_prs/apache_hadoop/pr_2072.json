{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNzk5NzI3", "number": 2072, "title": "HADOOP-17058. ABFS: Support for AppendBlob in Hadoop ABFS Driver", "bodyText": "The PR provides support for AppendBlob in the Hadoop ABFS Driver. The change also adds changes in the existing test case for appendblob based files. The change has been tested against the HBASE runs. Along with the integration and the unit tests.\nHere are the test results for the integration tests:\nfs.azure.appendblob.key=abfs://abfs-testcontainer  (this leads to all the files created via tests to be based on appendblob)\nnamespace enabled, current rest version(2019-12-12), private endpoint\nTests run: 83, Failures: 0, Errors: 0, Skipped: 0\nTests run: 440, Failures: 0, Errors: 0, Skipped: 41\nTests run: 207, Failures: 0, Errors: 0, Skipped: 24\nnamespace enabled, current rest version(2019-12-12), private endpoint\nTests run: 83, Failures: 0, Errors: 0, Skipped: 0\nTests run: 440, Failures: 0, Errors: 0, Skipped: 41\nTests run: 207, Failures: 0, Errors: 0, Skipped: 24\nnamespace enabled, current rest version(2018-11-09), public endpoint\nTests run: 83, Failures: 0, Errors: 0, Skipped: 0\nTests run: 440, Failures: 0, Errors: 0, Skipped: 41\nTests run: 207, Failures: 0, Errors: 0, Skipped: 24\nnamespace disabled, current rest version( 2018-11-09), public endpoint\nTests run: 83, Failures: 0, Errors: 0, Skipped: 0\nTests run: 440, Failures: 0, Errors: 0, Skipped: 244\nTests run: 207, Failures: 0, Errors: 0, Skipped: 24", "createdAt": "2020-06-12T17:19:16Z", "url": "https://github.com/apache/hadoop/pull/2072", "merged": true, "mergeCommit": {"oid": "d20109c171460f3312a760c1309f95b2bf61e0d3"}, "closed": true, "closedAt": "2020-07-04T20:25:15Z", "author": {"login": "ishaniahuja"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrOn65AFqTQzMDIzMzI4NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwB7qPgFqTQzOTIwMjExNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjMzMjg0", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-430233284", "createdAt": "2020-06-14T16:27:05Z", "commit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjoyNzowNlrOGjeFCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjoyNzowNlrOGjeFCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg0NjE1Mw==", "bodyText": "nit: the 2 if here can be combined with &&", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r439846153", "createdAt": "2020-06-14T16:27:06Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java", "diffHunk": "@@ -1314,7 +1352,30 @@ private String convertXmsPropertiesToCommaSeparatedString(final Hashtable<String\n     return properties;\n   }\n \n+  private boolean isKeyForPrefixSet(String key, Set<String> dirSet) {\n+\n+    for (String dir : dirSet) {\n+      if (dir.isEmpty() || key.startsWith(dir)) {\n+        return true;\n+      }\n+\n+      try {\n+        URI uri = new URI(dir);\n+        if (null == uri.getAuthority()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "originalPosition": 127}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjMzMzMy", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-430233332", "createdAt": "2020-06-14T16:27:43Z", "commit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjoyNzo0M1rOGjeFRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjoyNzo0M1rOGjeFRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg0NjIxMw==", "bodyText": "nit: Use the constant for forward slash", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r439846213", "createdAt": "2020-06-14T16:27:43Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java", "diffHunk": "@@ -1314,7 +1352,30 @@ private String convertXmsPropertiesToCommaSeparatedString(final Hashtable<String\n     return properties;\n   }\n \n+  private boolean isKeyForPrefixSet(String key, Set<String> dirSet) {\n+\n+    for (String dir : dirSet) {\n+      if (dir.isEmpty() || key.startsWith(dir)) {\n+        return true;\n+      }\n+\n+      try {\n+        URI uri = new URI(dir);\n+        if (null == uri.getAuthority()) {\n+          if (key.startsWith(dir + \"/\")){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "originalPosition": 128}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjM0Mzk2", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-430234396", "createdAt": "2020-06-14T16:44:08Z", "commit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjo0NDowOFrOGjeKWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjo0NDowOFrOGjeKWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg0NzUxNQ==", "bodyText": "How about throwing an AzureBlobFileSystemException from here. So that the customer will get to know that the config is not correct.", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r439847515", "createdAt": "2020-06-14T16:44:08Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java", "diffHunk": "@@ -1314,7 +1352,30 @@ private String convertXmsPropertiesToCommaSeparatedString(final Hashtable<String\n     return properties;\n   }\n \n+  private boolean isKeyForPrefixSet(String key, Set<String> dirSet) {\n+\n+    for (String dir : dirSet) {\n+      if (dir.isEmpty() || key.startsWith(dir)) {\n+        return true;\n+      }\n+\n+      try {\n+        URI uri = new URI(dir);\n+        if (null == uri.getAuthority()) {\n+          if (key.startsWith(dir + \"/\")){\n+            return true;\n+          }\n+        }\n+      } catch (URISyntaxException e) {\n+        LOG.info(\"URI syntax error creating URI for {}\", dir);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "originalPosition": 133}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjM0NTAy", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-430234502", "createdAt": "2020-06-14T16:45:51Z", "commit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjo0NTo1MVrOGjeK3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjo0NTo1MVrOGjeK3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg0NzY0NQ==", "bodyText": "fs.azure.appendblob.key config name doesn't look good. Wouldsomething like fs.azure.appendblob.directories convey the meaning better? (The way it is named in the FileSystemConfiguarations)", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r439847645", "createdAt": "2020-06-14T16:45:51Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/constants/ConfigurationKeys.java", "diffHunk": "@@ -59,6 +59,9 @@\n   public static final String FS_AZURE_ENABLE_AUTOTHROTTLING = \"fs.azure.enable.autothrottling\";\n   public static final String FS_AZURE_ALWAYS_USE_HTTPS = \"fs.azure.always.use.https\";\n   public static final String FS_AZURE_ATOMIC_RENAME_KEY = \"fs.azure.atomic.rename.key\";\n+  /** Provides a config to provide comma separated path prefixes on which Appendblob based files are created\n+   *  Default is empty. **/\n+  public static final String FS_AZURE_APPEND_BLOB_KEY = \"fs.azure.appendblob.key\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjM0ODQ5", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-430234849", "createdAt": "2020-06-14T16:51:02Z", "commit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjo1MTowMlrOGjeMqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjo1MTowMlrOGjeMqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg0ODEwNQ==", "bodyText": "Could you move this append blob handling to a separate method and call the same from here.", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r439848105", "createdAt": "2020-06-14T16:51:02Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsOutputStream.java", "diffHunk": "@@ -323,6 +328,35 @@ private synchronized void writeCurrentBufferToService() throws IOException {\n     final long offset = position;\n     position += bytesLength;\n \n+    if (this.isAppendBlob) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjM0OTYw", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-430234960", "createdAt": "2020-06-14T16:52:43Z", "commit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjo1Mjo0M1rOGjeNQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNjo1Mjo0M1rOGjeNQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg0ODI1Nw==", "bodyText": "nit: Should we have a debug log here?", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r439848257", "createdAt": "2020-06-14T16:52:43Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsOutputStream.java", "diffHunk": "@@ -389,6 +423,12 @@ private synchronized void flushWrittenBytesToServiceAsync() throws IOException {\n \n   private synchronized void flushWrittenBytesToServiceInternal(final long offset,\n       final boolean retainUncommitedData, final boolean isClose) throws IOException {\n+\n+    // flush is not called for appendblob as is not needed\n+    if (this.isAppendBlob) {\n+      return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "originalPosition": 98}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjM1MTUw", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-430235150", "createdAt": "2020-06-14T16:55:22Z", "commit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2cc892b96466f5923cf43fef94fd4a60d60c41c", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/d2cc892b96466f5923cf43fef94fd4a60d60c41c", "committedDate": "2020-06-20T13:42:54Z", "message": "Merge branch 'personal/isahuja/appendblob_changes' of github.com:ishaniahuja/hadoop into personal/isahuja/appendblob_changes"}, "afterCommit": {"oid": "d1f1fbf0ef8588d0aebc8441e2a4784508042f12", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/d1f1fbf0ef8588d0aebc8441e2a4784508042f12", "committedDate": "2020-06-13T03:11:28Z", "message": "checkstyle fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2efbe0d0b93255e7cc9e8af771609d99dff8caed", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/2efbe0d0b93255e7cc9e8af771609d99dff8caed", "committedDate": "2020-06-20T18:31:04Z", "message": "changes for appendblo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cda6d67702d59acff8bca4aa062be108f2f33967", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/cda6d67702d59acff8bca4aa062be108f2f33967", "committedDate": "2020-06-20T18:31:05Z", "message": "yetus fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89d836deab495b4be559402003c49e795b888e32", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/89d836deab495b4be559402003c49e795b888e32", "committedDate": "2020-06-20T18:31:05Z", "message": "checkstyle fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99f75d8c1dbef131d23eec7bba59dd5dc07c9e5b", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/99f75d8c1dbef131d23eec7bba59dd5dc07c9e5b", "committedDate": "2020-06-20T18:31:05Z", "message": "incorporated feedbacks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/b11ea2d7754561bc5ffa635a3a00284cad58e13c", "committedDate": "2020-06-21T05:42:55Z", "message": "AbfsNetworkStats failures fixes for appendblob"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d18d191b1e69de0a0ee1779485b522fb52e1983b", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/d18d191b1e69de0a0ee1779485b522fb52e1983b", "committedDate": "2020-06-20T17:52:53Z", "message": "AbfsNetworkStats failures fixes for appendblob"}, "afterCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/b11ea2d7754561bc5ffa635a3a00284cad58e13c", "committedDate": "2020-06-21T05:42:55Z", "message": "AbfsNetworkStats failures fixes for appendblob"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ad967da1047d55acb324572d99d516498bcfcba", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/5ad967da1047d55acb324572d99d516498bcfcba", "committedDate": "2020-06-23T19:02:46Z", "message": "added creation time to ListResultEntrySchema (being sent in stg75)"}, "afterCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/b11ea2d7754561bc5ffa635a3a00284cad58e13c", "committedDate": "2020-06-21T05:42:55Z", "message": "AbfsNetworkStats failures fixes for appendblob"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MjI2NDc0", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-437226474", "createdAt": "2020-06-25T07:16:57Z", "commit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNzoxNjo1OFrOGouOsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNzoyNDoxN1rOGoud7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM1MzY0OQ==", "bodyText": "Minor. Fix comment.", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r445353649", "createdAt": "2020-06-25T07:16:58Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/constants/FileSystemConfigurations.java", "diffHunk": "@@ -47,6 +47,7 @@\n \n   // Default upload and download buffer size\n   public static final int DEFAULT_WRITE_BUFFER_SIZE = 8 * ONE_MB;  // 8 MB\n+  public static final int APPENDBLOB_MAX_WRITE_BUFFER_SIZE = 4 * ONE_MB;  // 8 MB", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM1NDEyMw==", "bodyText": "Minor. boolean flag better named as isAppendBlob", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r445354123", "createdAt": "2020-06-25T07:17:49Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsClient.java", "diffHunk": "@@ -272,7 +272,8 @@ public AbfsRestOperation deleteFilesystem() throws AzureBlobFileSystemException\n   }\n \n   public AbfsRestOperation createPath(final String path, final boolean isFile, final boolean overwrite,\n-                                      final String permission, final String umask) throws AzureBlobFileSystemException {\n+                                      final String permission, final String umask,\n+                                      final boolean appendBlob) throws AzureBlobFileSystemException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM1NDY0NA==", "bodyText": "Undo. newline needed after a block.", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r445354644", "createdAt": "2020-06-25T07:18:50Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsHttpOperation.java", "diffHunk": "@@ -337,7 +344,6 @@ public void processResponse(final byte[] buffer, final int offset, final int len\n     if (this.isTraceEnabled) {\n       startTime = System.nanoTime();\n     }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM1NTA0NQ==", "bodyText": "Undo. new line needed.", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r445355045", "createdAt": "2020-06-25T07:19:34Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsOutputStream.java", "diffHunk": "@@ -367,7 +418,6 @@ private synchronized void flushWrittenBytesToService(boolean isClose) throws IOE\n             throw new FileNotFoundException(ex.getMessage());\n           }\n         }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM1NTIyNQ==", "bodyText": "unnecessary additional new line.", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r445355225", "createdAt": "2020-06-25T07:19:57Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsOutputStream.java", "diffHunk": "@@ -378,6 +428,7 @@ private synchronized void flushWrittenBytesToService(boolean isClose) throws IOE\n     flushWrittenBytesToServiceInternal(position, false, isClose);\n   }\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM1NTcwNg==", "bodyText": "remove newline", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r445355706", "createdAt": "2020-06-25T07:20:46Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsOutputStream.java", "diffHunk": "@@ -389,6 +440,12 @@ private synchronized void flushWrittenBytesToServiceAsync() throws IOException {\n \n   private synchronized void flushWrittenBytesToServiceInternal(final long offset,\n       final boolean retainUncommitedData, final boolean isClose) throws IOException {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM1NTgxMQ==", "bodyText": "remove newline", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r445355811", "createdAt": "2020-06-25T07:21:00Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsOutputStream.java", "diffHunk": "@@ -430,10 +487,15 @@ private synchronized void shrinkWriteOperationQueue() throws IOException {\n   }\n \n   private void waitForTaskToComplete() throws IOException {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM1NjQxMw==", "bodyText": "remove newline", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r445356413", "createdAt": "2020-06-25T07:22:07Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsRestOperation.java", "diffHunk": "@@ -185,13 +189,18 @@ void execute() throws AzureBlobFileSystemException {\n       try {\n         LOG.debug(\"Retrying REST operation {}. RetryCount = {}\",\n             operationType, retryCount);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM1NzU1MA==", "bodyText": "Why is it that for Http Status code 400 and above, exception is suppressed ? Can you please add code comments for the reason.", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r445357550", "createdAt": "2020-06-25T07:24:17Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsRestOperation.java", "diffHunk": "@@ -185,13 +189,18 @@ void execute() throws AzureBlobFileSystemException {\n       try {\n         LOG.debug(\"Retrying REST operation {}. RetryCount = {}\",\n             operationType, retryCount);\n+\n         Thread.sleep(client.getRetryPolicy().getRetryInterval(retryCount));\n       } catch (InterruptedException ex) {\n         Thread.currentThread().interrupt();\n       }\n     }\n \n     if (result.getStatusCode() >= HttpURLConnection.HTTP_BAD_REQUEST) {\n+      if (this.isAppendBlobAppend && retryCount > 0 && result.getStorageErrorCode().equals(\"InvalidQueryParameterValue\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MjQwNDA5", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-437240409", "createdAt": "2020-06-25T07:37:57Z", "commit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNzozNzo1N1rOGou5eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNzozNzo1N1rOGou5eA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTM2NDYwMA==", "bodyText": "Would be better to add a new line since the next line is a constructor.", "url": "https://github.com/apache/hadoop/pull/2072#discussion_r445364600", "createdAt": "2020-06-25T07:37:57Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java", "diffHunk": "@@ -144,6 +145,10 @@\n   private final IdentityTransformerInterface identityTransformer;\n   private final AbfsPerfTracker abfsPerfTracker;\n \n+  /**\n+   * The set of directories where we should store files as append blobs.\n+   */\n+  private Set<String> appendBlobDirSet;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MjQ1MDMz", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-437245033", "createdAt": "2020-06-25T07:44:46Z", "commit": {"oid": "b11ea2d7754561bc5ffa635a3a00284cad58e13c"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b7a65bf066fe41f5a1674584ce3665532fe96ed", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/3b7a65bf066fe41f5a1674584ce3665532fe96ed", "committedDate": "2020-06-25T18:42:45Z", "message": "incorporated feedbacks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e089333aa058a09bfcfb402293523057edf013b", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/8e089333aa058a09bfcfb402293523057edf013b", "committedDate": "2020-06-29T08:47:19Z", "message": "support for idempotency check on appendblob append"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "309d7fd189628af323c2e52f4490b05bf72fc869", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/309d7fd189628af323c2e52f4490b05bf72fc869", "committedDate": "2020-06-29T06:58:13Z", "message": "support for idempotency check on appendblob append"}, "afterCommit": {"oid": "8e089333aa058a09bfcfb402293523057edf013b", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/8e089333aa058a09bfcfb402293523057edf013b", "committedDate": "2020-06-29T08:47:19Z", "message": "support for idempotency check on appendblob append"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MDQ4NTUx", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-439048551", "createdAt": "2020-06-29T11:33:14Z", "commit": {"oid": "8e089333aa058a09bfcfb402293523057edf013b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26c91b3e97ed1b003b405b70653f66796daedb8a", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/26c91b3e97ed1b003b405b70653f66796daedb8a", "committedDate": "2020-06-29T11:55:34Z", "message": "incorporated feedbacks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MjAyMTE0", "url": "https://github.com/apache/hadoop/pull/2072#pullrequestreview-439202114", "createdAt": "2020-06-29T14:29:31Z", "commit": {"oid": "26c91b3e97ed1b003b405b70653f66796daedb8a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4015, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}