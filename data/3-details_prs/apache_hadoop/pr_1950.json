{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxOTQwMjE1", "number": 1950, "title": "HADOOP-16586. ITestS3GuardFsck, others fails when run using a local m\u2026", "bodyText": "", "createdAt": "2020-04-10T14:53:09Z", "url": "https://github.com/apache/hadoop/pull/1950", "merged": true, "mergeCommit": {"oid": "0b7799bf6ed8e44a64aac87631069f2354e7c58d"}, "closed": true, "closedAt": "2020-05-19T23:47:05Z", "author": {"login": "iwasakims"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWSSaSgH2gAyNDAxOTQwMjE1Ojg2N2Q5ZWQwNjgyYjI2YWIzYzUxOGY1ZDcxODU1ZTUwZGMwNTRkNWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcexrljAH2gAyNDAxOTQwMjE1OjNkNTc2NTNhMTM5YTMxM2JiMjBlZWU4OGE1MmM0Y2RjY2M1Y2ExYjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "867d9ed0682b26ab3c518f5d71855e50dc054d5c", "author": {"user": {"login": "iwasakims", "name": "Masatake Iwasaki"}}, "url": "https://github.com/apache/hadoop/commit/867d9ed0682b26ab3c518f5d71855e50dc054d5c", "committedDate": "2020-04-10T14:50:49Z", "message": "HADOOP-16586. ITestS3GuardFsck, others fails when run using a local metastore."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18131caecc24a79c047ba0fd55395f054466ee90", "author": {"user": {"login": "iwasakims", "name": "Masatake Iwasaki"}}, "url": "https://github.com/apache/hadoop/commit/18131caecc24a79c047ba0fd55395f054466ee90", "committedDate": "2020-04-10T22:32:35Z", "message": "addressed checkstyle warnings."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NDIwODk4", "url": "https://github.com/apache/hadoop/pull/1950#pullrequestreview-396420898", "createdAt": "2020-04-20T12:49:21Z", "commit": {"oid": "18131caecc24a79c047ba0fd55395f054466ee90"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxMjo0OToyM1rOGISzCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxMjo1NTowOVrOGITB4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM0OTc3MA==", "bodyText": "not sure the expansion here is needed..,you know how imports are such a backporting troublespot.\nin fact, given there's no other diff to this class, I'm not sure this file needs changing at all", "url": "https://github.com/apache/hadoop/pull/1950#discussion_r411349770", "createdAt": "2020-04-20T12:49:23Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/impl/ITestPartialRenamesDeletes.java", "diffHunk": "@@ -54,7 +54,12 @@\n import static org.apache.hadoop.fs.contract.ContractTestUtils.*;\n import static org.apache.hadoop.fs.s3a.Constants.*;\n import static org.apache.hadoop.fs.s3a.S3ATestUtils.MetricDiff;\n-import static org.apache.hadoop.fs.s3a.S3ATestUtils.*;\n+import static org.apache.hadoop.fs.s3a.S3ATestUtils.assume;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18131caecc24a79c047ba0fd55395f054466ee90"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM1MDk2Nw==", "bodyText": "why did you cut this assertion?", "url": "https://github.com/apache/hadoop/pull/1950#discussion_r411350967", "createdAt": "2020-04-20T12:51:12Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardToolLocal.java", "diffHunk": "@@ -97,7 +98,6 @@ public void testImportCommand() throws Exception {\n         .getListing().size());\n     assertEquals(\"Expected 2 items: empty directory and a parent directory\", 2,\n         ms.listChildren(parent).getListing().size());\n-    assertTrue(children.isAuthoritative());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18131caecc24a79c047ba0fd55395f054466ee90"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM1MjYzMg==", "bodyText": "if this is triggering failures, I'm not seeing them -but then I do have fs.s3a.bucket.probe == 0....it's probably not triggering any bucket probe at all. For consistent failures here, the config we run with should have that option set to 2, \"use v2 probe on instantiation\".", "url": "https://github.com/apache/hadoop/pull/1950#discussion_r411352632", "createdAt": "2020-04-20T12:53:45Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardToolLocal.java", "diffHunk": "@@ -165,18 +165,19 @@ public void testImportNoFilesystem() throws Throwable {\n \n   @Test\n   public void testInfoBucketAndRegionNoFS() throws Throwable {\n-    intercept(FileNotFoundException.class,\n+    intercept(UnknownStoreException.class,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18131caecc24a79c047ba0fd55395f054466ee90"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM1MzU3MA==", "bodyText": "if this is triggering bucket probe failures, it's not doing the -ve arg check. So here we should either switch to a probe option of 0, or just cut the test entirely. I'm almost going for the latter given the way people should be creating tables is with read = write =0 for on-demand use", "url": "https://github.com/apache/hadoop/pull/1950#discussion_r411353570", "createdAt": "2020-04-20T12:55:09Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardToolLocal.java", "diffHunk": "@@ -165,18 +165,19 @@ public void testImportNoFilesystem() throws Throwable {\n \n   @Test\n   public void testInfoBucketAndRegionNoFS() throws Throwable {\n-    intercept(FileNotFoundException.class,\n+    intercept(UnknownStoreException.class,\n         () -> run(BucketInfo.NAME, \"-meta\",\n             LOCAL_METADATA, \"-region\",\n             \"any-region\", S3A_THIS_BUCKET_DOES_NOT_EXIST));\n   }\n \n   @Test\n   public void testInitNegativeRead() throws Throwable {\n-    runToFailure(INVALID_ARGUMENT,\n-        Init.NAME, \"-meta\", LOCAL_METADATA, \"-region\",\n-        \"eu-west-1\",\n-        READ_FLAG, \"-10\");\n+    intercept(CommandFormat.UnknownOptionException.class,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18131caecc24a79c047ba0fd55395f054466ee90"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fd5ae9a96299870899611c734b139f5a085f1bd", "author": {"user": {"login": "iwasakims", "name": "Masatake Iwasaki"}}, "url": "https://github.com/apache/hadoop/commit/2fd5ae9a96299870899611c734b139f5a085f1bd", "committedDate": "2020-04-28T06:16:34Z", "message": "removed unnecessary imports and test based on the review comment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cded221938e0d4c20f0d3db11770191ccc29ef47", "author": {"user": {"login": "iwasakims", "name": "Masatake Iwasaki"}}, "url": "https://github.com/apache/hadoop/commit/cded221938e0d4c20f0d3db11770191ccc29ef47", "committedDate": "2020-04-28T07:59:31Z", "message": "addressing checkstyle warning: Unused import."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04479c24cc27ec543dfe48a4406d19f7c3643b8c", "author": {"user": {"login": "iwasakims", "name": "Masatake Iwasaki"}}, "url": "https://github.com/apache/hadoop/commit/04479c24cc27ec543dfe48a4406d19f7c3643b8c", "committedDate": "2020-04-28T12:49:42Z", "message": "ITestS3GuardToolLocal should always use LocalMetadataStore rather than skipping the tests based on fs.s3a.metadatastore.impl."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MDkzNDAw", "url": "https://github.com/apache/hadoop/pull/1950#pullrequestreview-404093400", "createdAt": "2020-05-01T09:52:49Z", "commit": {"oid": "04479c24cc27ec543dfe48a4406d19f7c3643b8c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwOTo1Mjo1MFrOGPGM4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwOTo1NDozMFrOGPGO4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4MzQyNg==", "bodyText": "need to use the removeBaseAndBucketOverrides() code in S3ATestUtils to make sure that any per-bucket setting has turned it on. Look for other uses to see what to do", "url": "https://github.com/apache/hadoop/pull/1950#discussion_r418483426", "createdAt": "2020-05-01T09:52:50Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardToolLocal.java", "diffHunk": "@@ -57,13 +59,18 @@\n   private static final String[] ABORT_FORCE_OPTIONS = new String[] {\"-abort\",\n       \"-force\", \"-verbose\"};\n \n+  @Override\n+  protected Configuration createConfiguration() {\n+    Configuration conf = super.createConfiguration();\n+    conf.set(S3_METADATA_STORE_IMPL, S3GUARD_METASTORE_LOCAL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04479c24cc27ec543dfe48a4406d19f7c3643b8c"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4MzU5Mw==", "bodyText": "probably is wrong then :)", "url": "https://github.com/apache/hadoop/pull/1950#discussion_r418483593", "createdAt": "2020-05-01T09:53:28Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardToolLocal.java", "diffHunk": "@@ -97,7 +98,6 @@ public void testImportCommand() throws Exception {\n         .getListing().size());\n     assertEquals(\"Expected 2 items: empty directory and a parent directory\", 2,\n         ms.listChildren(parent).getListing().size());\n-    assertTrue(children.isAuthoritative());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM1MDk2Nw=="}, "originalCommit": {"oid": "18131caecc24a79c047ba0fd55395f054466ee90"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4MzkzNg==", "bodyText": "we should probably unset bucket probe options too & switch to the default (2) value; avoid differences in init behaviour", "url": "https://github.com/apache/hadoop/pull/1950#discussion_r418483936", "createdAt": "2020-05-01T09:54:30Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/s3guard/ITestS3GuardToolLocal.java", "diffHunk": "@@ -165,18 +165,19 @@ public void testImportNoFilesystem() throws Throwable {\n \n   @Test\n   public void testInfoBucketAndRegionNoFS() throws Throwable {\n-    intercept(FileNotFoundException.class,\n+    intercept(UnknownStoreException.class,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM1MjYzMg=="}, "originalCommit": {"oid": "18131caecc24a79c047ba0fd55395f054466ee90"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c646e9ada49a2674f12c94b15f77098d3266dcf", "author": {"user": {"login": "iwasakims", "name": "Masatake Iwasaki"}}, "url": "https://github.com/apache/hadoop/commit/5c646e9ada49a2674f12c94b15f77098d3266dcf", "committedDate": "2020-05-01T23:40:35Z", "message": "leveraging S3ATestUtils.removeBaseAndBucketOverrides to clear per bucket config."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d57653a139a313bb20eee88a52c4cdccc5ca1b1", "author": {"user": {"login": "iwasakims", "name": "Masatake Iwasaki"}}, "url": "https://github.com/apache/hadoop/commit/3d57653a139a313bb20eee88a52c4cdccc5ca1b1", "committedDate": "2020-05-06T23:56:46Z", "message": "removed duplicate call for clearing the configuration."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4581, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}