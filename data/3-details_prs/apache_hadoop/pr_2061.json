{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI5NzY1OTgw", "number": 2061, "title": "HADOOP-17060. listStatus and getFileStatus behave inconsistent in the case of ViewFs implementation for isDirectory", "bodyText": "https://issues.apache.org/jira/browse/HADOOP-17060", "createdAt": "2020-06-07T05:59:02Z", "url": "https://github.com/apache/hadoop/pull/2061", "merged": true, "mergeCommit": {"oid": "93b121a9717bb4ef5240fda877ebb5275f6446b4"}, "closed": true, "closedAt": "2020-06-10T22:00:03Z", "author": {"login": "umamaheswararao"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpDP5DgH2gAyNDI5NzY1OTgwOjY2MDM2ZDYxZDdhM2YwYWYyZWQ0ZTU1MGI2MjZlMGY0YTU2ODlhY2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp374rAFqTQyNzk1OTYxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "66036d61d7a3f0af2ed4e550b626e0f4a5689acf", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/hadoop/commit/66036d61d7a3f0af2ed4e550b626e0f4a5689acf", "committedDate": "2020-06-07T22:04:03Z", "message": "HADOOP-17060. listStatus and getFileStatus behave inconsistent in the case of ViewFs implementation for isDirectory"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ede439c5d1aef856c1e31fe89e606cac9eadae60", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/hadoop/commit/ede439c5d1aef856c1e31fe89e606cac9eadae60", "committedDate": "2020-06-07T05:48:25Z", "message": "HADOOP-17060. listStatus and getFileStatus behave inconsistent in the case of ViewFs implementation for isDirectory"}, "afterCommit": {"oid": "66036d61d7a3f0af2ed4e550b626e0f4a5689acf", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/hadoop/commit/66036d61d7a3f0af2ed4e550b626e0f4a5689acf", "committedDate": "2020-06-07T22:04:03Z", "message": "HADOOP-17060. listStatus and getFileStatus behave inconsistent in the case of ViewFs implementation for isDirectory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32f0c7fe440d44364299bfe012c8c332c2726ca7", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/hadoop/commit/32f0c7fe440d44364299bfe012c8c332c2726ca7", "committedDate": "2020-06-07T22:25:03Z", "message": "Checkstyle fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1OTI2Nzky", "url": "https://github.com/apache/hadoop/pull/2061#pullrequestreview-425926792", "createdAt": "2020-06-08T05:40:55Z", "commit": {"oid": "32f0c7fe440d44364299bfe012c8c332c2726ca7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNTo0MDo1NVrOGgPz8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNTo0MDo1NVrOGgPz8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ2NjY3Mw==", "bodyText": "Here in the FileStatus we have resolved the mount and giving details of the destination. Any idea where the link.getTargetLink() in the FileStatus can be or is used?\nIf we are resolving the mount entry, This is actually the FileStatus of the destination, if the destination itself is a symlink, in that case instead of link.getTargetLink() shouldn't status.getSymlink() be done?\nSince all the other details like permissions and stuff we are having of the destination, the intent seems to resolve it as the destination directory rather than projecting this as a symlink to the end user. else if we see in linux the symlink doesn't shows the destination permission or other details it shows it's own details while listing :\nlrwxrwxrwx  1 ayush ayush    3 Jun  8 04:52 sym_f -> txt\n-rw-rw-r--  1 ayush ayush    0 Jun  8 11:05 txt\n\nIn RBF also for listing on mount points, we don't denote them as symlinks, instead just pass the destination FileStatus with name resolved...\nIs it possible we keep the assertions as it is and change link.getTargetLink() and specify that as per the destination?", "url": "https://github.com/apache/hadoop/pull/2061#discussion_r436466673", "createdAt": "2020-06-08T05:40:55Z", "author": {"login": "ayushtkn"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java", "diffHunk": "@@ -1202,19 +1202,18 @@ public FileStatus getFileStatus(Path f) throws IOException {\n           INodeLink<FileSystem> link = (INodeLink<FileSystem>) inode;\n           try {\n             String linkedPath = link.getTargetFileSystem().getUri().getPath();\n-            if(\"\".equals(linkedPath)) {\n+            if (\"\".equals(linkedPath)) {\n               linkedPath = \"/\";\n             }\n             FileStatus status =\n-                ((ChRootedFileSystem)link.getTargetFileSystem())\n-                .getMyFs().getFileStatus(new Path(linkedPath));\n-            result[i++] = new FileStatus(status.getLen(), false,\n-              status.getReplication(), status.getBlockSize(),\n-              status.getModificationTime(), status.getAccessTime(),\n-              status.getPermission(), status.getOwner(), status.getGroup(),\n-              link.getTargetLink(),\n-              new Path(inode.fullPath).makeQualified(\n-                  myUri, null));\n+                ((ChRootedFileSystem) link.getTargetFileSystem()).getMyFs()\n+                    .getFileStatus(new Path(linkedPath));\n+            result[i++] = new FileStatus(status.getLen(), status.isDirectory(),\n+                status.getReplication(), status.getBlockSize(),\n+                status.getModificationTime(), status.getAccessTime(),\n+                status.getPermission(), status.getOwner(), status.getGroup(),\n+                link.getTargetLink(),\n+                new Path(inode.fullPath).makeQualified(myUri, null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32f0c7fe440d44364299bfe012c8c332c2726ca7"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bc0eb4f672ef65036af34f95466d16145c95709", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/hadoop/commit/2bc0eb4f672ef65036af34f95466d16145c95709", "committedDate": "2020-06-10T06:31:42Z", "message": "Revert \"Checkstyle fixes\"\n\nThis reverts commit 32f0c7fe440d44364299bfe012c8c332c2726ca7."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d4e1d1986487b26587b3b49a7d08b1f6a3a2a2f", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/hadoop/commit/6d4e1d1986487b26587b3b49a7d08b1f6a3a2a2f", "committedDate": "2020-06-10T06:35:43Z", "message": "Revert \"HADOOP-17060. listStatus and getFileStatus behave inconsistent in the case of ViewFs implementation for isDirectory\"\n\nThis reverts commit 66036d61d7a3f0af2ed4e550b626e0f4a5689acf."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6960825f72b63ec8fb4982293650826a2fe9fdf7", "author": {"user": {"login": "umamaheswararao", "name": "Uma Maheswara Rao G"}}, "url": "https://github.com/apache/hadoop/commit/6960825f72b63ec8fb4982293650826a2fe9fdf7", "committedDate": "2020-06-10T08:20:43Z", "message": "HADOOP-17060. listStatus and getFileStatus behave inconsistent in the case of ViewFs implementation for isDirectory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTU5NjE2", "url": "https://github.com/apache/hadoop/pull/2061#pullrequestreview-427959616", "createdAt": "2020-06-10T11:27:10Z", "commit": {"oid": "6960825f72b63ec8fb4982293650826a2fe9fdf7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3990, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}