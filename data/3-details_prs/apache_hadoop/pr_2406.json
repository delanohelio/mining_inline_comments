{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4OTg4MDcw", "number": 2406, "title": "HDFS-15460. TestFileCreation#testServerDefaultsWithMinimalCaching fails intermittently.", "bodyText": "NOTICE\nPlease create an issue in ASF JIRA before opening a pull request,\nand you need to set the title of the pull request which starts with\nthe corresponding JIRA issue number. (e.g. HADOOP-XXXXX. Fix a typo in YYY.)\nFor more details, please see https://cwiki.apache.org/confluence/display/HADOOP/How+To+Contribute", "createdAt": "2020-10-23T14:02:22Z", "url": "https://github.com/apache/hadoop/pull/2406", "merged": true, "mergeCommit": {"oid": "d0c786db4de99a72802e844a3a2a717a64845cda"}, "closed": true, "closedAt": "2020-10-28T01:56:41Z", "author": {"login": "amahussein"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVZjLrAFqTUxNTg0NDAyNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWudIIgBqjM5Mjc4NTI3OTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1ODQ0MDI0", "url": "https://github.com/apache/hadoop/pull/2406#pullrequestreview-515844024", "createdAt": "2020-10-23T16:55:22Z", "commit": {"oid": "8d54e819bccd13905ca277ba0556cb898b1807ac"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjo1NToyMlrOHnV7Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjo1NToyMlrOHnV7Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxNTY5MA==", "bodyText": "Should we wait a little longer than 100ms?", "url": "https://github.com/apache/hadoop/pull/2406#discussion_r511015690", "createdAt": "2020-10-23T16:55:22Z", "author": {"login": "goiri"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestFileCreation.java", "diffHunk": "@@ -273,10 +272,17 @@ public void testServerDefaultsWithMinimalCaching()\n               defaults.getDefaultStoragePolicyId());\n       doReturn(newDefaults).when(spyNamesystem).getServerDefaults();\n \n-      Thread.sleep(1);\n-      defaults = dfsClient.getServerDefaults();\n-      // Value is updated correctly\n-      assertEquals(updatedDefaultBlockSize, defaults.getBlockSize());\n+      // Verify that the value is updated correctly\n+      GenericTestUtils.waitFor(()->{\n+        try {\n+          FsServerDefaults currDef = dfsClient.getServerDefaults();\n+          return (currDef.getBlockSize() == updatedDefaultBlockSize);\n+        } catch (IOException e) {\n+          // do nothing;\n+          return false;\n+        }\n+      }, 1, 100);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d54e819bccd13905ca277ba0556cb898b1807ac"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d54e819bccd13905ca277ba0556cb898b1807ac", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/8d54e819bccd13905ca277ba0556cb898b1807ac", "committedDate": "2020-10-23T02:34:30Z", "message": "HDFS-15461. fix testServerDefaultsWithMinimalCaching."}, "afterCommit": {"oid": "f074489de93c34b279472c586d815b8bbfa5704c", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/f074489de93c34b279472c586d815b8bbfa5704c", "committedDate": "2020-10-26T13:53:21Z", "message": "HDFS-15460. increase wait time to 1 seconds"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f074489de93c34b279472c586d815b8bbfa5704c", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/f074489de93c34b279472c586d815b8bbfa5704c", "committedDate": "2020-10-26T13:53:21Z", "message": "HDFS-15460. increase wait time to 1 seconds"}, "afterCommit": {"oid": "61af10856763fcde7a7e99ad5fdc6f2bddff08eb", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/61af10856763fcde7a7e99ad5fdc6f2bddff08eb", "committedDate": "2020-10-26T13:55:05Z", "message": "HDFS-15460. increase wait time to 1 seconds"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NTQ1NjU5", "url": "https://github.com/apache/hadoop/pull/2406#pullrequestreview-517545659", "createdAt": "2020-10-27T10:23:17Z", "commit": {"oid": "61af10856763fcde7a7e99ad5fdc6f2bddff08eb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMDoyMzoxOFrOHo00uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMDoyMzoxOFrOHo00uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU3MDU1Mg==", "bodyText": "Thank you @amahussein. How about increasing the timeout to 2 or 3 seconds?", "url": "https://github.com/apache/hadoop/pull/2406#discussion_r512570552", "createdAt": "2020-10-27T10:23:18Z", "author": {"login": "aajisaka"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestFileCreation.java", "diffHunk": "@@ -273,10 +272,17 @@ public void testServerDefaultsWithMinimalCaching()\n               defaults.getDefaultStoragePolicyId());\n       doReturn(newDefaults).when(spyNamesystem).getServerDefaults();\n \n-      Thread.sleep(1);\n-      defaults = dfsClient.getServerDefaults();\n-      // Value is updated correctly\n-      assertEquals(updatedDefaultBlockSize, defaults.getBlockSize());\n+      // Verify that the value is updated correctly\n+      GenericTestUtils.waitFor(()->{\n+        try {\n+          FsServerDefaults currDef = dfsClient.getServerDefaults();\n+          return (currDef.getBlockSize() == updatedDefaultBlockSize);\n+        } catch (IOException e) {\n+          // do nothing;\n+          return false;\n+        }\n+      }, 1, 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61af10856763fcde7a7e99ad5fdc6f2bddff08eb"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c122f1eab0e71eb3fb64484555642ad764fa8b1", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/5c122f1eab0e71eb3fb64484555642ad764fa8b1", "committedDate": "2020-10-27T19:20:03Z", "message": "HDFS-15461. fix testServerDefaultsWithMinimalCaching."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8b180874b930c2b87de4ca08410cfcbb5abf250", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/f8b180874b930c2b87de4ca08410cfcbb5abf250", "committedDate": "2020-10-27T19:20:03Z", "message": "HDFS-15460. increase wait time to 1 seconds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b69b035f3330fb9bbed19c26a2559871a0020874", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/b69b035f3330fb9bbed19c26a2559871a0020874", "committedDate": "2020-10-27T19:50:32Z", "message": "HDFS-15460. Increase waitTime to 3 seconds."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "61af10856763fcde7a7e99ad5fdc6f2bddff08eb", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/61af10856763fcde7a7e99ad5fdc6f2bddff08eb", "committedDate": "2020-10-26T13:55:05Z", "message": "HDFS-15460. increase wait time to 1 seconds"}, "afterCommit": {"oid": "b69b035f3330fb9bbed19c26a2559871a0020874", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/b69b035f3330fb9bbed19c26a2559871a0020874", "committedDate": "2020-10-27T19:50:32Z", "message": "HDFS-15460. Increase waitTime to 3 seconds."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3495, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}