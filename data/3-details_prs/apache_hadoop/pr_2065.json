{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNTA5Njcy", "number": 2065, "title": "MAPREDUCE-7280. MiniMRYarnCluster has hard-coded timeout waiting to start history server, with no way to disable.", "bodyText": "make JHS optional (mapreduce.jobhistory.minicluster.enabled(true by default))\nset timeout duration to launch JHS (mapreduce.jobhistory.minicluster.launch.timeout.ms(60_000 by default))", "createdAt": "2020-06-10T14:50:13Z", "url": "https://github.com/apache/hadoop/pull/2065", "merged": true, "mergeCommit": {"oid": "7e73cad97419671b1020906bef36ad60aaa70ab9"}, "closed": true, "closedAt": "2020-06-30T01:52:26Z", "author": {"login": "iwasakims"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp6z7-AH2gAyNDMyNTA5NjcyOjk0ZmVjY2Y2ZjFlZjdkYmQwM2VjOTljY2M5NzJmMzg5YTAwY2ExYmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsm499AH2gAyNDMyNTA5NjcyOjkxNWM0ZDMzNWUyMjEwNGY0MzUwY2UwYWNhOTliMjFiYTJhMWM3NzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "94feccf6f1ef7dbd03ec99ccc972f389a00ca1bb", "author": {"user": {"login": "iwasakims", "name": "Masatake Iwasaki"}}, "url": "https://github.com/apache/hadoop/commit/94feccf6f1ef7dbd03ec99ccc972f389a00ca1bb", "committedDate": "2020-06-10T14:48:12Z", "message": "MAPREDUCE-7280. MiniMRYarnCluster has hard-coded timeout waiting to start history server, with no way to disable."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MzEyMjIw", "url": "https://github.com/apache/hadoop/pull/2065#pullrequestreview-428312220", "createdAt": "2020-06-10T18:14:27Z", "commit": {"oid": "94feccf6f1ef7dbd03ec99ccc972f389a00ca1bb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxODoxNDoyN1rOGiA44w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxODoxNDoyN1rOGiA44w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMxOTMzMQ==", "bodyText": "These are test-time configs. Is it common practice adding them to the default xml? Just wondering.", "url": "https://github.com/apache/hadoop/pull/2065#discussion_r438319331", "createdAt": "2020-06-10T18:14:27Z", "author": {"login": "saintstack"}, "path": "hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/resources/mapred-default.xml", "diffHunk": "@@ -1945,6 +1945,18 @@\n   <description>The HistoryStorage class to use to cache history data.</description>\n </property>\n \n+<property>\n+  <name>mapreduce.jobhistory.minicluster.enabled</name>\n+  <value>true</value>\n+  <description>Whether to launch jobhistory server inminicluster.</description>\n+</property>\n+\n+<property>\n+  <name>mapreduce.jobhistory.minicluster.launch.timeout.ms</name>\n+  <value>60000</value>\n+  <description>Timeout to launch jobhistory server inminicluster.</description>\n+</property>\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94feccf6f1ef7dbd03ec99ccc972f389a00ca1bb"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MzEzOTA2", "url": "https://github.com/apache/hadoop/pull/2065#pullrequestreview-428313906", "createdAt": "2020-06-10T18:16:54Z", "commit": {"oid": "94feccf6f1ef7dbd03ec99ccc972f389a00ca1bb"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxODoxNjo1NVrOGiA9_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxODoxODowOVrOGiBAvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMDYzNw==", "bodyText": "Should this historyServer and thread only be initialized when the new configuration is enabled? Would be nice to avoid allocating the resources if we don't need them.", "url": "https://github.com/apache/hadoop/pull/2065#discussion_r438320637", "createdAt": "2020-06-10T18:16:55Z", "author": {"login": "ndimiduk"}, "path": "hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/MiniMRYarnCluster.java", "diffHunk": "@@ -259,7 +267,10 @@ public void run() {\n           };\n         }.start();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94feccf6f1ef7dbd03ec99ccc972f389a00ca1bb"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMTM0Mg==", "bodyText": "nit: this code would be simpler using a CountDownLatch.", "url": "https://github.com/apache/hadoop/pull/2065#discussion_r438321342", "createdAt": "2020-06-10T18:18:09Z", "author": {"login": "ndimiduk"}, "path": "hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/MiniMRYarnCluster.java", "diffHunk": "@@ -259,7 +267,10 @@ public void run() {\n           };\n         }.start();\n \n-        GenericTestUtils.waitFor(() -> jhsStarted, 1500, 60_000);\n+        final int launchTimeout = getConfig().getInt(\n+            JHAdminConfig.MR_HISTORY_MINICLUSTER_LAUNCH_TIMEOUT_MS,\n+            JHAdminConfig.DEFAULT_MR_HISTORY_MINICLUSTER_LAUNCH_TIMEOUT_MS);\n+        GenericTestUtils.waitFor(() -> jhsStarted, 1500, launchTimeout);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94feccf6f1ef7dbd03ec99ccc972f389a00ca1bb"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01e77a720738ee6211bddaabeb9a4ea9ed777efe", "author": {"user": {"login": "iwasakims", "name": "Masatake Iwasaki"}}, "url": "https://github.com/apache/hadoop/commit/01e77a720738ee6211bddaabeb9a4ea9ed777efe", "committedDate": "2020-06-11T03:28:05Z", "message": "addressed checkstyle warnings. avoiding to expose test only configurations via mapred-default.xml. Simplified waiting logic for JHS startup."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNTE2NTQ2", "url": "https://github.com/apache/hadoop/pull/2065#pullrequestreview-433516546", "createdAt": "2020-06-18T17:52:19Z", "commit": {"oid": "01e77a720738ee6211bddaabeb9a4ea9ed777efe"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNzo1MjoxOVrOGl6Eng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNzo1Mzo0N1rOGl6H2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQwMTk1MA==", "bodyText": "should this assert happen after the call to start()?", "url": "https://github.com/apache/hadoop/pull/2065#discussion_r442401950", "createdAt": "2020-06-18T17:52:19Z", "author": {"login": "ndimiduk"}, "path": "hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapred/TestMiniMRBringup.java", "diffHunk": "@@ -36,5 +40,21 @@ public void testBringUp() throws IOException {\n       if (mr != null) { mr.shutdown(); }\n     }\n   }\n-  \n+\n+  @Test\n+  public void testMiniMRYarnClusterWithoutJHS() throws IOException {\n+    MiniMRYarnCluster mr = null;\n+    try {\n+      final Configuration conf = new Configuration();\n+      conf.setBoolean(MiniMRYarnCluster.MR_HISTORY_MINICLUSTER_ENABLED, false);\n+      mr = new MiniMRYarnCluster(\"testMiniMRYarnClusterWithoutJHS\");\n+      mr.init(conf);\n+      Assert.assertEquals(null, mr.getHistoryServer());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01e77a720738ee6211bddaabeb9a4ea9ed777efe"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQwMjc3OA==", "bodyText": "Yes, preserving the default value makes sense. I'm just wondering if the resource allocation can be skipped entirely when the jhs is disabled.", "url": "https://github.com/apache/hadoop/pull/2065#discussion_r442402778", "createdAt": "2020-06-18T17:53:47Z", "author": {"login": "ndimiduk"}, "path": "hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/MiniMRYarnCluster.java", "diffHunk": "@@ -259,7 +267,10 @@ public void run() {\n           };\n         }.start();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMDYzNw=="}, "originalCommit": {"oid": "94feccf6f1ef7dbd03ec99ccc972f389a00ca1bb"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "915c4d335e22104f4350ce0aca99b21ba2a1c773", "author": {"user": {"login": "iwasakims", "name": "Masatake Iwasaki"}}, "url": "https://github.com/apache/hadoop/commit/915c4d335e22104f4350ce0aca99b21ba2a1c773", "committedDate": "2020-06-18T23:17:22Z", "message": "assertion after starting minicluster should be more stable for future refactoring."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3999, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}