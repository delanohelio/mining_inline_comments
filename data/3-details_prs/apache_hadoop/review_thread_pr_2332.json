{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMDE0NjE3", "number": 2332, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNjo0MjozOVrOEnIU3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNjo0MjozOVrOEnIU3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NDY2MzMzOnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManagerSafeMode.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNjo0MjozOVrOHXjkmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMTozNjoyM1rOHXtgOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ2MjEwNA==", "bodyText": "As we are at it, does it make sense to use StringBuilder?", "url": "https://github.com/apache/hadoop/pull/2332#discussion_r494462104", "createdAt": "2020-09-24T16:42:39Z", "author": {"login": "goiri"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManagerSafeMode.java", "diffHunk": "@@ -309,16 +311,21 @@ String getSafeModeTip() {\n     }\n \n     if (datanodeThreshold > 0) {\n-      int numLive = blockManager.getDatanodeManager().getNumLiveDataNodes();\n-      if (numLive < datanodeThreshold) {\n-        msg += String.format(\n-            \"The number of live datanodes %d needs an additional %d live \"\n-                + \"datanodes to reach the minimum number %d.%n\",\n-            numLive, (datanodeThreshold - numLive), datanodeThreshold);\n+      if (isBlockThresholdMet) {\n+        int numLive = blockManager.getDatanodeManager().getNumLiveDataNodes();\n+        if (numLive < datanodeThreshold) {\n+          msg += String.format(\n+              \"The number of live datanodes %d needs an additional %d live \"\n+                  + \"datanodes to reach the minimum number %d.%n\",\n+              numLive, (datanodeThreshold - numLive), datanodeThreshold);\n+        } else {\n+          msg += String.format(\"The number of live datanodes %d has reached \"\n+                  + \"the minimum number %d. \",\n+              numLive, datanodeThreshold);\n+        }\n       } else {\n-        msg += String.format(\"The number of live datanodes %d has reached \"\n-                + \"the minimum number %d. \",\n-            numLive, datanodeThreshold);\n+        msg += \"The number of live datanodes is not calculated \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "010ad6f6b023d0e6a312cf94b9021992a43d5c4e"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYyNDgyNg==", "bodyText": "fixed.", "url": "https://github.com/apache/hadoop/pull/2332#discussion_r494624826", "createdAt": "2020-09-24T21:36:23Z", "author": {"login": "NickyYe"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManagerSafeMode.java", "diffHunk": "@@ -309,16 +311,21 @@ String getSafeModeTip() {\n     }\n \n     if (datanodeThreshold > 0) {\n-      int numLive = blockManager.getDatanodeManager().getNumLiveDataNodes();\n-      if (numLive < datanodeThreshold) {\n-        msg += String.format(\n-            \"The number of live datanodes %d needs an additional %d live \"\n-                + \"datanodes to reach the minimum number %d.%n\",\n-            numLive, (datanodeThreshold - numLive), datanodeThreshold);\n+      if (isBlockThresholdMet) {\n+        int numLive = blockManager.getDatanodeManager().getNumLiveDataNodes();\n+        if (numLive < datanodeThreshold) {\n+          msg += String.format(\n+              \"The number of live datanodes %d needs an additional %d live \"\n+                  + \"datanodes to reach the minimum number %d.%n\",\n+              numLive, (datanodeThreshold - numLive), datanodeThreshold);\n+        } else {\n+          msg += String.format(\"The number of live datanodes %d has reached \"\n+                  + \"the minimum number %d. \",\n+              numLive, datanodeThreshold);\n+        }\n       } else {\n-        msg += String.format(\"The number of live datanodes %d has reached \"\n-                + \"the minimum number %d. \",\n-            numLive, datanodeThreshold);\n+        msg += \"The number of live datanodes is not calculated \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ2MjEwNA=="}, "originalCommit": {"oid": "010ad6f6b023d0e6a312cf94b9021992a43d5c4e"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3309, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}