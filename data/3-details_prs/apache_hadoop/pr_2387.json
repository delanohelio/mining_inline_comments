{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzODcxNDM5", "number": 2387, "title": "HADOOP-17306. RawLocalFileSystem's lastModifiedTime() looses milli seconds in JDK < 10.b09", "bodyText": "", "createdAt": "2020-10-15T06:47:36Z", "url": "https://github.com/apache/hadoop/pull/2387", "merged": true, "mergeCommit": {"oid": "d259928035fa6de20986a5afaf5d2569650ef6a8"}, "closed": true, "closedAt": "2020-10-23T06:00:03Z", "author": {"login": "vinayakumarb"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSsArRAH2gAyNTAzODcxNDM5OjUwOGE2MDQxNDRhYzJiNTUxMWRmYjgyNzk1NTY3NjU2YzM4ODQ2Yzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdT9gSGAH2gAyNTAzODcxNDM5OjRlNTU4MTE1ZmUwYTRkYTU2ZjliYjEwNWViNzhmYzczYmFmNjQ0ZDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "508a604144ac2b5511dfb82795567656c38846c7", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/508a604144ac2b5511dfb82795567656c38846c7", "committedDate": "2020-10-15T06:44:26Z", "message": "HADOOP-17306. RawLocalFileSystem's lastModifiedTime() looses milli seconds in JDK < 10.b09"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af1d2cc5ff8c7c0d7171d40016df19d325f3cc1c", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/af1d2cc5ff8c7c0d7171d40016df19d325f3cc1c", "committedDate": "2020-10-15T12:24:54Z", "message": "Exclude assertion for MAC"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTE5MTky", "url": "https://github.com/apache/hadoop/pull/2387#pullrequestreview-509519192", "createdAt": "2020-10-15T15:42:25Z", "commit": {"oid": "af1d2cc5ff8c7c0d7171d40016df19d325f3cc1c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExNDE5NDUw", "url": "https://github.com/apache/hadoop/pull/2387#pullrequestreview-511419450", "createdAt": "2020-10-19T05:25:19Z", "commit": {"oid": "af1d2cc5ff8c7c0d7171d40016df19d325f3cc1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNToyNToxOVrOHj9uKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQwNToyNToxOVrOHj9uKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQ3MzQ1MA==", "bodyText": "HFS+ does not support milliseconds for mtime, so I agreed to skip this in MacOS. In contrast, APFS supports nanoseconds and JDK-8177809 is fixed if the filesystem is APFS.\n\u279c  hadoop git:(trunk) uname -a\nDarwin <snip> 19.6.0 Darwin Kernel Version 19.6.0: Mon Aug 31 22:12:52 PDT 2020; root:xnu-6153.141.2~1/RELEASE_X86_64 x86_64\n\u279c  hadoop git:(trunk) jshell                                          \n|  Welcome to JShell -- Version 11.0.8\n|  For an introduction type: /help intro\n\njshell> Files.getLastModifiedTime(Paths.get(\"./pom.xml\"))\n$1 ==> 2020-10-19T04:51:58.69531Z\n\njshell> new File(\"./pom.xml\").lastModified()\n$1 ==> 1603083118695\n\nWould you update the comment like \"Skip MacOS because HFS+ does not support milliseconds for mtime.\" ?", "url": "https://github.com/apache/hadoop/pull/2387#discussion_r507473450", "createdAt": "2020-10-19T05:25:19Z", "author": {"login": "aajisaka"}, "path": "hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestRawLocalFileSystemContract.java", "diffHunk": "@@ -203,4 +203,27 @@ public void testPermission() throws Exception {\n     }\n   }\n \n+  @Test\n+  public void testMTimeAtime() throws IOException {\n+    RawLocalFileSystem.setUseDeprecatedFileStatus(true);\n+    try {\n+      Path testDir = getTestBaseDir();\n+      String testFilename = \"testmtime\";\n+      Path path = new Path(testDir, testFilename);\n+      Path file = new Path(path, \"file\");\n+      fs.create(file);\n+      long now = System.currentTimeMillis();\n+      long mtime = (now % 1000 == 0) ? now + 1 : now;\n+      long atime = (now % 1000 == 0) ? now + 2 : now;\n+      fs.setTimes(file, mtime, atime);\n+      FileStatus fileStatus = fs.getFileStatus(file);\n+      if (!Shell.MAC) {\n+        //HADOOP-17306 ; JDK-8177809 not fixed in MacOs\n+        assertEquals(mtime, fileStatus.getModificationTime());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af1d2cc5ff8c7c0d7171d40016df19d325f3cc1c"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d8c456f294edc5d6b22f05ad77f6f31215b9da8", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/5d8c456f294edc5d6b22f05ad77f6f31215b9da8", "committedDate": "2020-10-19T05:34:44Z", "message": "Updated skip comment for MacOs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e558115fe0a4da56f9bb105eb78fc73baf644d2", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/4e558115fe0a4da56f9bb105eb78fc73baf644d2", "committedDate": "2020-10-19T05:41:16Z", "message": "Checkstyle fix."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3457, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}