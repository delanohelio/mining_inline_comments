{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MDU0Njc5", "number": 2089, "title": "HADOOP-17081. MetricsSystem doesn't start the sink adapters on restart", "bodyText": "What changed\n\nThe sink registration starts the adapter if it doesn't exists.", "createdAt": "2020-06-22T16:32:35Z", "url": "https://github.com/apache/hadoop/pull/2089", "merged": true, "mergeCommit": {"oid": "2f500e4635ea4347a55693b1a10a4a4465fe5fac"}, "closed": true, "closedAt": "2020-07-06T15:25:42Z", "author": {"login": "mmpataki"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABct65FPgBqjM0NzA3MDQxMTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxi-XmAH2gAyNDM4MDU0Njc5OjZkYzc5ZGYwZjZlYjlkYjFhYTM4ZjRlNDk3MGM5MTI5MjFjMWUzNWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48e2ffbe4bd06556336b297010e90d067240eec2", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/48e2ffbe4bd06556336b297010e90d067240eec2", "committedDate": "2020-06-22T16:32:06Z", "message": "HADOOP-17081 : MetricsSystem doesn't start the sink adapters on restart\n\nWhat changed\n- The sink registration starts the adapter if it doesn't exists."}, "afterCommit": {"oid": "d75902111a3ae078ecb9ca4353cc35fd9d58bfee", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/d75902111a3ae078ecb9ca4353cc35fd9d58bfee", "committedDate": "2020-06-23T01:09:05Z", "message": "HADOOP-17081 : MetricsSystem doesn't start the sink adapters on restart\n\nWhat changed\n- The sink registration starts the adapter if it doesn't exists."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d75902111a3ae078ecb9ca4353cc35fd9d58bfee", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/d75902111a3ae078ecb9ca4353cc35fd9d58bfee", "committedDate": "2020-06-23T01:09:05Z", "message": "HADOOP-17081 : MetricsSystem doesn't start the sink adapters on restart\n\nWhat changed\n- The sink registration starts the adapter if it doesn't exists."}, "afterCommit": {"oid": "eeed85b765173cc463ae050c1668d5fbe1a5fb7f", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/eeed85b765173cc463ae050c1668d5fbe1a5fb7f", "committedDate": "2020-06-23T01:10:18Z", "message": "HADOOP-17081 : MetricsSystem doesn't start the sink adapters on restart\n\nWhat changed\n- The sink registration starts the adapter if it doesn't exists."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e670b347f39d395b8b8c5bc056a8e6dfe358803a", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/e670b347f39d395b8b8c5bc056a8e6dfe358803a", "committedDate": "2020-06-23T01:12:27Z", "message": "HADOOP-17081 : MetricsSystem doesn't start the sink adapters on restart\n\nWhat changed\n- The sink registration starts the adapter if it doesn't exists."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eeed85b765173cc463ae050c1668d5fbe1a5fb7f", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/eeed85b765173cc463ae050c1668d5fbe1a5fb7f", "committedDate": "2020-06-23T01:10:18Z", "message": "HADOOP-17081 : MetricsSystem doesn't start the sink adapters on restart\n\nWhat changed\n- The sink registration starts the adapter if it doesn't exists."}, "afterCommit": {"oid": "e670b347f39d395b8b8c5bc056a8e6dfe358803a", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/e670b347f39d395b8b8c5bc056a8e6dfe358803a", "committedDate": "2020-06-23T01:12:27Z", "message": "HADOOP-17081 : MetricsSystem doesn't start the sink adapters on restart\n\nWhat changed\n- The sink registration starts the adapter if it doesn't exists."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "572df34eccb834daf8acd71fb352df9289380392", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/572df34eccb834daf8acd71fb352df9289380392", "committedDate": "2020-06-23T01:14:37Z", "message": "Stop the metric system post testing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNTI2MDg1", "url": "https://github.com/apache/hadoop/pull/2089#pullrequestreview-442526085", "createdAt": "2020-07-03T18:07:34Z", "commit": {"oid": "572df34eccb834daf8acd71fb352df9289380392"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxODowNzozNVrOGs17Qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxODowNzozNVrOGs17Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY3NDA1MQ==", "bodyText": "we're generally still 80 chars wide, I'm afraid...put the actual probe on a new line.\nnice to see some text for the assertion tnough -appreciated", "url": "https://github.com/apache/hadoop/pull/2089#discussion_r449674051", "createdAt": "2020-07-03T18:07:35Z", "author": {"login": "steveloughran"}, "path": "hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestMetricsSystemImpl.java", "diffHunk": "@@ -639,4 +639,23 @@ public Boolean get() {\n   private static String getPluginUrlsAsString() {\n     return \"file:metrics2-test-plugin.jar\";\n   }\n+\n+  @Test\n+  public void testMetricSystemRestart() {\n+    MetricsSystemImpl ms = new MetricsSystemImpl(\"msRestartTestSystem\");\n+    TestSink ts = new TestSink();\n+    String sinkName = \"restartTestSink\";\n+\n+    try {\n+      ms.start();\n+      ms.register(sinkName, \"\", ts);\n+      assertNotNull(\"an adapter should exist for each sink\", ms.getSinkAdapter(sinkName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "572df34eccb834daf8acd71fb352df9289380392"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNTI2MzU1", "url": "https://github.com/apache/hadoop/pull/2089#pullrequestreview-442526355", "createdAt": "2020-07-03T18:08:52Z", "commit": {"oid": "572df34eccb834daf8acd71fb352df9289380392"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dc79df0f6eb9db1aa38f4e4970c912921c1e35a", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/6dc79df0f6eb9db1aa38f4e4970c912921c1e35a", "committedDate": "2020-07-04T07:33:16Z", "message": "Fixed the 80char checkstyle error"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4066, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}