{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMDcxMjY0", "number": 2425, "title": "HADOOP-17332. S3A MarkerTool -min and -max are inverted.", "bodyText": "This patch\n\nfixes the inversion\nadds a precondition check\nif the commands are supplied inverted, swaps them with a warning.\nThis is to stop breaking any tests written to cope with the existing\nbehavior.\nadds tests for all this\n\nTested (IMarkerTool tests): S3 london", "createdAt": "2020-10-30T15:06:52Z", "url": "https://github.com/apache/hadoop/pull/2425", "merged": true, "mergeCommit": {"oid": "9b4faf2b51a0148c85ec6bb0b983daf0b8be52ff"}, "closed": true, "closedAt": "2020-11-23T20:49:43Z", "author": {"login": "steveloughran"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXoKDygH2gAyNTEzMDcxMjY0OjAwM2RmOGUxMzBiNTQxYjRiNmNlOWVlNzQ1MGIyYjA5ZDhhNWIzODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfY5B3AFqTUzNjcxMDMyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "003df8e130b541b4b6ce9ee7450b2b09d8a5b383", "author": {"user": {"login": "steveloughran", "name": "Steve Loughran"}}, "url": "https://github.com/apache/hadoop/commit/003df8e130b541b4b6ce9ee7450b2b09d8a5b383", "committedDate": "2020-10-30T15:04:41Z", "message": "HADOOP-17332 s3a MarkerTool -min and -max are inverted.\n\nThis patch\n* fixes the inversion\n* adds a precondition check\n* if the commands are supplied inverted, swaps them with a warning.\n  This is to stop breaking any tests written to cope with the existing\n  behavior.\n* adds tests for all this\n\nChange-Id: Ibff4201abb0c26332c96c9c701901e0611b43ab8"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NjU1MDM5", "url": "https://github.com/apache/hadoop/pull/2425#pullrequestreview-529655039", "createdAt": "2020-11-13T02:15:33Z", "commit": {"oid": "003df8e130b541b4b6ce9ee7450b2b09d8a5b383"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwMjoxNTozM1rOHyXB1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwMjoxNTozM1rOHyXB1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjU2ODE1MA==", "bodyText": "nit: typo in \"greater\".", "url": "https://github.com/apache/hadoop/pull/2425#discussion_r522568150", "createdAt": "2020-11-13T02:15:33Z", "author": {"login": "mehakmeet"}, "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/tools/MarkerTool.java", "diffHunk": "@@ -513,6 +526,11 @@ private ScanResult scan(\n       final DirectoryPolicy filterPolicy)\n       throws IOException, ExitUtil.ExitException {\n \n+    // safety check: min and max are correctly ordered at this point.\n+    Preconditions.checkArgument(minMarkerCount <= maxMarkerCount,\n+        \"Min marker count of %d is greather than the max value of %d\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "003df8e130b541b4b6ce9ee7450b2b09d8a5b383"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NzM4NDU1", "url": "https://github.com/apache/hadoop/pull/2425#pullrequestreview-529738455", "createdAt": "2020-11-13T04:57:54Z", "commit": {"oid": "003df8e130b541b4b6ce9ee7450b2b09d8a5b383"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwNDo1Nzo1NVrOHybhDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwNDo1Nzo1NVrOHybhDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY0MTY3OA==", "bodyText": "nit: Is this check required again since we have already swapped above?", "url": "https://github.com/apache/hadoop/pull/2425#discussion_r522641678", "createdAt": "2020-11-13T04:57:55Z", "author": {"login": "mukund-thakur"}, "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/tools/MarkerTool.java", "diffHunk": "@@ -513,6 +526,11 @@ private ScanResult scan(\n       final DirectoryPolicy filterPolicy)\n       throws IOException, ExitUtil.ExitException {\n \n+    // safety check: min and max are correctly ordered at this point.\n+    Preconditions.checkArgument(minMarkerCount <= maxMarkerCount,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "003df8e130b541b4b6ce9ee7450b2b09d8a5b383"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NzM4NzE3", "url": "https://github.com/apache/hadoop/pull/2425#pullrequestreview-529738717", "createdAt": "2020-11-13T04:58:55Z", "commit": {"oid": "003df8e130b541b4b6ce9ee7450b2b09d8a5b383"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c32dae755bfd1953ef241b69421d158cc267b0d5", "author": {"user": {"login": "steveloughran", "name": "Steve Loughran"}}, "url": "https://github.com/apache/hadoop/commit/c32dae755bfd1953ef241b69421d158cc267b0d5", "committedDate": "2020-11-17T15:08:52Z", "message": "HADOOP-17332. Fix typo in precondition\n\nChange-Id: I75916829a95605869fa7088d28ed63e95854f11b"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NzEwMzIz", "url": "https://github.com/apache/hadoop/pull/2425#pullrequestreview-536710323", "createdAt": "2020-11-23T17:47:26Z", "commit": {"oid": "c32dae755bfd1953ef241b69421d158cc267b0d5"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNzo0NzoyNlrOH4YvqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxNzo0ODowMlrOH4Yw8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODg4NzcyMQ==", "bodyText": "it will harm nobody, we can leave this check here.", "url": "https://github.com/apache/hadoop/pull/2425#discussion_r528887721", "createdAt": "2020-11-23T17:47:26Z", "author": {"login": "bgaborg"}, "path": "hadoop-tools/hadoop-aws/src/main/java/org/apache/hadoop/fs/s3a/tools/MarkerTool.java", "diffHunk": "@@ -513,6 +526,11 @@ private ScanResult scan(\n       final DirectoryPolicy filterPolicy)\n       throws IOException, ExitUtil.ExitException {\n \n+    // safety check: min and max are correctly ordered at this point.\n+    Preconditions.checkArgument(minMarkerCount <= maxMarkerCount,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjY0MTY3OA=="}, "originalCommit": {"oid": "003df8e130b541b4b6ce9ee7450b2b09d8a5b383"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODg4ODA1MQ==", "bodyText": "I wanted to ask for a test like this, but it's already here so LGTM.", "url": "https://github.com/apache/hadoop/pull/2425#discussion_r528888051", "createdAt": "2020-11-23T17:48:02Z", "author": {"login": "bgaborg"}, "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/tools/ITestMarkerTool.java", "diffHunk": "@@ -259,8 +259,25 @@ public void testRunAuditWithExpectedMarkers() throws Throwable {\n         AUDIT,\n         m(OPT_LIMIT), 0,\n         m(OPT_OUT), audit,\n-        m(OPT_MIN), expectedMarkersWithBaseDir,\n-        m(OPT_MAX), expectedMarkersWithBaseDir,\n+        m(OPT_MIN), expectedMarkersWithBaseDir - 1,\n+        m(OPT_MAX), expectedMarkersWithBaseDir + 1,\n+        createdPaths.base);\n+    expectMarkersInOutput(audit, expectedMarkersWithBaseDir);\n+  }\n+\n+  @Test\n+  public void testRunAuditWithExpectedMarkersSwappedMinMax() throws Throwable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c32dae755bfd1953ef241b69421d158cc267b0d5"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3526, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}