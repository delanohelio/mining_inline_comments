{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwOTMwMjE2", "number": 2377, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNjoyNTo1NVrOExEYcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwNjo1MTozOVrOEzKS7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5ODg3NDczOnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeLayoutVersion.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNjoyNTo1NVrOHnARSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNjoyNTo1NVrOHnARSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2MDkzNg==", "bodyText": "Since there is no release after this feature is committed, No need to increase layout version twice for same feature.\nUsually one version increase is sufficient per release. But for clarity separate feature can be added.\nIn this case feature is only one. NVDIMM SUPPORT.", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r510660936", "createdAt": "2020-10-23T06:25:55Z", "author": {"login": "vinayakumarb"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeLayoutVersion.java", "diffHunk": "@@ -89,7 +89,11 @@ public static boolean supports(final LayoutFeature f, final int lv) {\n     APPEND_NEW_BLOCK(-62, -61, \"Support appending to new block\"),\n     QUOTA_BY_STORAGE_TYPE(-63, -61, \"Support quota for specific storage types\"),\n     ERASURE_CODING(-64, -61, \"Support erasure coding\"),\n-    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\");\n+    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\"),\n+    BLOCK_STORAGE_POLICY_INCLUDING_ALL_NVDIMM(-66, -66, \"Support block \" +\n+        \"Storage policy including ALL_NVDIMM\"),\n+    QUOTA_BY_STORAGE_TYPE_INCLUDING_NVDIMM(-67, -66, \"Support quota for \" +\n+        \"specific storage types including NVDIMM\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb3bac5f4be587ed44588df0f8c4d7af65935dc1"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5ODg4MzE2OnYy", "diffSide": "RIGHT", "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/StorageType.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNjoyOToyOFrOHnAWVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMTo0MzowM1rOHq1i_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2MjIyOQ==", "bodyText": "Because of addition of new STORAGE TYPE,\nduring upgrade\ncalls from old clients, who doesnt have this storagetype, will experience failure.\nEspecially getQuotaUsage() call will experience failure. May be need to analyze more to avoid failures during upgrade.\nEven though upgrade is finalized, old clients should continue to work.", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r510662229", "createdAt": "2020-10-23T06:29:28Z", "author": {"login": "vinayakumarb"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/StorageType.java", "diffHunk": "@@ -33,13 +33,12 @@\n @InterfaceAudience.Public\n @InterfaceStability.Unstable\n public enum StorageType {\n-  // sorted by the speed of the storage types, from fast to slow\n   RAM_DISK(true, true),\n-  NVDIMM(false, true),\n   SSD(false, false),\n   DISK(false, false),\n   ARCHIVE(false, false),\n-  PROVIDED(false, false);\n+  PROVIDED(false, false),\n+  NVDIMM(false, true);\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb3bac5f4be587ed44588df0f8c4d7af65935dc1"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzIxMDU1Nw==", "bodyText": "We add check for setQuota() in FSNamesystem.java, I think it's ok, right?", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r513210557", "createdAt": "2020-10-28T06:40:41Z", "author": {"login": "huangtianhua"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/StorageType.java", "diffHunk": "@@ -33,13 +33,12 @@\n @InterfaceAudience.Public\n @InterfaceStability.Unstable\n public enum StorageType {\n-  // sorted by the speed of the storage types, from fast to slow\n   RAM_DISK(true, true),\n-  NVDIMM(false, true),\n   SSD(false, false),\n   DISK(false, false),\n   ARCHIVE(false, false),\n-  PROVIDED(false, false);\n+  PROVIDED(false, false),\n+  NVDIMM(false, true);\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2MjIyOQ=="}, "originalCommit": {"oid": "cb3bac5f4be587ed44588df0f8c4d7af65935dc1"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI1NTIzNg==", "bodyText": "setQuota() check will only block during rollingupgrade. But once its finalized, still old clients experience failure.\nAnyway thats the current problem, even before this feature. Can be handled in a separate Jira.\nMore details about failure: 2.10.1 client asking quota usage from 3.3.0 namenode.\n$ bin/hdfs dfs -fs hdfs://namenode:8020/ -count -q -t -h /\ncount: Message missing required fields: usage.typeQuotaInfos.typeQuotaInfo[3].type\n\nAbove issue is coming, because 2.10.1 client doent know about PROVIDED StorageType.\nSimilar problem will occur for NVDIMM also from previous version clients.", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r513255236", "createdAt": "2020-10-28T08:23:40Z", "author": {"login": "vinayakumarb"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/StorageType.java", "diffHunk": "@@ -33,13 +33,12 @@\n @InterfaceAudience.Public\n @InterfaceStability.Unstable\n public enum StorageType {\n-  // sorted by the speed of the storage types, from fast to slow\n   RAM_DISK(true, true),\n-  NVDIMM(false, true),\n   SSD(false, false),\n   DISK(false, false),\n   ARCHIVE(false, false),\n-  PROVIDED(false, false);\n+  PROVIDED(false, false),\n+  NVDIMM(false, true);\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2MjIyOQ=="}, "originalCommit": {"oid": "cb3bac5f4be587ed44588df0f8c4d7af65935dc1"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDAzNjk2Nw==", "bodyText": "I am not sure but will getStoragePolicies also land up in something similar issue? Due to unavailability of storage type? The quota stuff shall be there for PROVIDED also but in case this backward incompatibility is there with Storage Policy too, Then we need to find out some way.\n@vinayakumarb do you have pointers or suggestions on this, how to tackle this?", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r514036967", "createdAt": "2020-10-29T07:00:01Z", "author": {"login": "ayushtkn"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/StorageType.java", "diffHunk": "@@ -33,13 +33,12 @@\n @InterfaceAudience.Public\n @InterfaceStability.Unstable\n public enum StorageType {\n-  // sorted by the speed of the storage types, from fast to slow\n   RAM_DISK(true, true),\n-  NVDIMM(false, true),\n   SSD(false, false),\n   DISK(false, false),\n   ARCHIVE(false, false),\n-  PROVIDED(false, false);\n+  PROVIDED(false, false),\n+  NVDIMM(false, true);\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2MjIyOQ=="}, "originalCommit": {"oid": "cb3bac5f4be587ed44588df0f8c4d7af65935dc1"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQwMTk4Nw==", "bodyText": "I have verified the getStoragePolicies() with older clients.\nOlder clients will get the storage policy but, unknown storage types will be ignored.\nSo in this case, ALLNVDIMM storage policy shows empty StorageTypes for older clients.\nMay be need to show DEFAULT StorageType instead of ignoring the unknown StorageTypes. This also can be fixed in a separate Jira. Right now, existing clients wont be broken on getStoragePolicies() call with this change.\nSo nothing special required for that in this PR.", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r514401987", "createdAt": "2020-10-29T16:35:30Z", "author": {"login": "vinayakumarb"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/StorageType.java", "diffHunk": "@@ -33,13 +33,12 @@\n @InterfaceAudience.Public\n @InterfaceStability.Unstable\n public enum StorageType {\n-  // sorted by the speed of the storage types, from fast to slow\n   RAM_DISK(true, true),\n-  NVDIMM(false, true),\n   SSD(false, false),\n   DISK(false, false),\n   ARCHIVE(false, false),\n-  PROVIDED(false, false);\n+  PROVIDED(false, false),\n+  NVDIMM(false, true);\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2MjIyOQ=="}, "originalCommit": {"oid": "cb3bac5f4be587ed44588df0f8c4d7af65935dc1"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY3OTU1MQ==", "bodyText": "Thanks for clarification and testing.", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r514679551", "createdAt": "2020-10-30T01:43:03Z", "author": {"login": "huangtianhua"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/StorageType.java", "diffHunk": "@@ -33,13 +33,12 @@\n @InterfaceAudience.Public\n @InterfaceStability.Unstable\n public enum StorageType {\n-  // sorted by the speed of the storage types, from fast to slow\n   RAM_DISK(true, true),\n-  NVDIMM(false, true),\n   SSD(false, false),\n   DISK(false, false),\n   ARCHIVE(false, false),\n-  PROVIDED(false, false);\n+  PROVIDED(false, false),\n+  NVDIMM(false, true);\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2MjIyOQ=="}, "originalCommit": {"oid": "cb3bac5f4be587ed44588df0f8c4d7af65935dc1"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNTE5ODE2OnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeLayoutVersion.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMjozMTo1NFrOHpXxWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwMTo0NDoxNVrOHq1ntw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE0MzEzMA==", "bodyText": "Is there any reason to change the minCompatLV  to -66?", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r513143130", "createdAt": "2020-10-28T02:31:54Z", "author": {"login": "vinayakumarb"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeLayoutVersion.java", "diffHunk": "@@ -89,7 +89,8 @@ public static boolean supports(final LayoutFeature f, final int lv) {\n     APPEND_NEW_BLOCK(-62, -61, \"Support appending to new block\"),\n     QUOTA_BY_STORAGE_TYPE(-63, -61, \"Support quota for specific storage types\"),\n     ERASURE_CODING(-64, -61, \"Support erasure coding\"),\n-    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\");\n+    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\"),\n+    NVDIMM_SUPPORT(-66, -66, \"Support NVDIMM storage type\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5b5d0b1905ad9a1eb13d2fddf4b1657e3f9500e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzIwOTg5OA==", "bodyText": "As the comment above said:\nIf the feature cannot satisfy compatibility with any prior version, then set its minimum compatible lqyout version to itself to indicate that downgrade is impossible.\nOr maybe we missed something?", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r513209898", "createdAt": "2020-10-28T06:38:37Z", "author": {"login": "huangtianhua"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeLayoutVersion.java", "diffHunk": "@@ -89,7 +89,8 @@ public static boolean supports(final LayoutFeature f, final int lv) {\n     APPEND_NEW_BLOCK(-62, -61, \"Support appending to new block\"),\n     QUOTA_BY_STORAGE_TYPE(-63, -61, \"Support quota for specific storage types\"),\n     ERASURE_CODING(-64, -61, \"Support erasure coding\"),\n-    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\");\n+    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\"),\n+    NVDIMM_SUPPORT(-66, -66, \"Support NVDIMM storage type\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE0MzEzMA=="}, "originalCommit": {"oid": "d5b5d0b1905ad9a1eb13d2fddf4b1657e3f9500e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDAzMzM2NA==", "bodyText": "Not very aware, but yes, if I am decoding the comment correct, This should be 66 both.", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r514033364", "createdAt": "2020-10-29T06:53:34Z", "author": {"login": "ayushtkn"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeLayoutVersion.java", "diffHunk": "@@ -89,7 +89,8 @@ public static boolean supports(final LayoutFeature f, final int lv) {\n     APPEND_NEW_BLOCK(-62, -61, \"Support appending to new block\"),\n     QUOTA_BY_STORAGE_TYPE(-63, -61, \"Support quota for specific storage types\"),\n     ERASURE_CODING(-64, -61, \"Support erasure coding\"),\n-    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\");\n+    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\"),\n+    NVDIMM_SUPPORT(-66, -66, \"Support NVDIMM storage type\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE0MzEzMA=="}, "originalCommit": {"oid": "d5b5d0b1905ad9a1eb13d2fddf4b1657e3f9500e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQwMzU1OA==", "bodyText": "keep it -61 for minCompatLV itself.\nMore details here", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r514403558", "createdAt": "2020-10-29T16:37:52Z", "author": {"login": "vinayakumarb"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeLayoutVersion.java", "diffHunk": "@@ -89,7 +89,8 @@ public static boolean supports(final LayoutFeature f, final int lv) {\n     APPEND_NEW_BLOCK(-62, -61, \"Support appending to new block\"),\n     QUOTA_BY_STORAGE_TYPE(-63, -61, \"Support quota for specific storage types\"),\n     ERASURE_CODING(-64, -61, \"Support erasure coding\"),\n-    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\");\n+    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\"),\n+    NVDIMM_SUPPORT(-66, -66, \"Support NVDIMM storage type\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE0MzEzMA=="}, "originalCommit": {"oid": "d5b5d0b1905ad9a1eb13d2fddf4b1657e3f9500e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDY4MDc1OQ==", "bodyText": "I will change the miniCompatLV to -61, thanks for your clarification.", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r514680759", "createdAt": "2020-10-30T01:44:15Z", "author": {"login": "huangtianhua"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/NameNodeLayoutVersion.java", "diffHunk": "@@ -89,7 +89,8 @@ public static boolean supports(final LayoutFeature f, final int lv) {\n     APPEND_NEW_BLOCK(-62, -61, \"Support appending to new block\"),\n     QUOTA_BY_STORAGE_TYPE(-63, -61, \"Support quota for specific storage types\"),\n     ERASURE_CODING(-64, -61, \"Support erasure coding\"),\n-    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\");\n+    EXPANDED_STRING_TABLE(-65, -61, \"Support expanded string table in fsimage\"),\n+    NVDIMM_SUPPORT(-66, -66, \"Support NVDIMM storage type\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE0MzEzMA=="}, "originalCommit": {"oid": "d5b5d0b1905ad9a1eb13d2fddf4b1657e3f9500e"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNTE5OTkxOnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwMjozMjo1NVrOHpXyVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMjo1MzozMlrOH8WKeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE0MzM4Mw==", "bodyText": "Similar check you need to add when user tries to use NVDIMM based storage policy..", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r513143383", "createdAt": "2020-10-28T02:32:55Z", "author": {"login": "vinayakumarb"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java", "diffHunk": "@@ -3569,6 +3569,9 @@ void setQuota(String src, long nsQuota, long ssQuota, StorageType type)\n     if (type != null) {\n       requireEffectiveLayoutVersionForFeature(Feature.QUOTA_BY_STORAGE_TYPE);\n     }\n+    if (type == StorageType.NVDIMM) {\n+      requireEffectiveLayoutVersionForFeature(Feature.NVDIMM_SUPPORT);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5b5d0b1905ad9a1eb13d2fddf4b1657e3f9500e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAzOTczOA==", "bodyText": "Done. Please see code above. Thanks.", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r533039738", "createdAt": "2020-12-01T02:53:32Z", "author": {"login": "huangtianhua"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java", "diffHunk": "@@ -3569,6 +3569,9 @@ void setQuota(String src, long nsQuota, long ssQuota, StorageType type)\n     if (type != null) {\n       requireEffectiveLayoutVersionForFeature(Feature.QUOTA_BY_STORAGE_TYPE);\n     }\n+    if (type == StorageType.NVDIMM) {\n+      requireEffectiveLayoutVersionForFeature(Feature.NVDIMM_SUPPORT);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzE0MzM4Mw=="}, "originalCommit": {"oid": "d5b5d0b1905ad9a1eb13d2fddf4b1657e3f9500e"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMDgxNTE4OnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwNjo1MTozOVrOHqODFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMjo1NTozNlrOH8WNAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDAzMjQwNg==", "bodyText": "This check should be done in case of setStoragePolicy also, if the storage policy is ALLNVDIMM", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r514032406", "createdAt": "2020-10-29T06:51:39Z", "author": {"login": "ayushtkn"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java", "diffHunk": "@@ -3569,6 +3569,9 @@ void setQuota(String src, long nsQuota, long ssQuota, StorageType type)\n     if (type != null) {\n       requireEffectiveLayoutVersionForFeature(Feature.QUOTA_BY_STORAGE_TYPE);\n     }\n+    if (type == StorageType.NVDIMM) {\n+      requireEffectiveLayoutVersionForFeature(Feature.NVDIMM_SUPPORT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5b5d0b1905ad9a1eb13d2fddf4b1657e3f9500e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAzOTcxMw==", "bodyText": "Done. Please see code above. Thanks.", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r533039713", "createdAt": "2020-12-01T02:53:22Z", "author": {"login": "huangtianhua"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java", "diffHunk": "@@ -3569,6 +3569,9 @@ void setQuota(String src, long nsQuota, long ssQuota, StorageType type)\n     if (type != null) {\n       requireEffectiveLayoutVersionForFeature(Feature.QUOTA_BY_STORAGE_TYPE);\n     }\n+    if (type == StorageType.NVDIMM) {\n+      requireEffectiveLayoutVersionForFeature(Feature.NVDIMM_SUPPORT);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDAzMjQwNg=="}, "originalCommit": {"oid": "d5b5d0b1905ad9a1eb13d2fddf4b1657e3f9500e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA0MDM4NQ==", "bodyText": "Done", "url": "https://github.com/apache/hadoop/pull/2377#discussion_r533040385", "createdAt": "2020-12-01T02:55:36Z", "author": {"login": "huangtianhua"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java", "diffHunk": "@@ -3569,6 +3569,9 @@ void setQuota(String src, long nsQuota, long ssQuota, StorageType type)\n     if (type != null) {\n       requireEffectiveLayoutVersionForFeature(Feature.QUOTA_BY_STORAGE_TYPE);\n     }\n+    if (type == StorageType.NVDIMM) {\n+      requireEffectiveLayoutVersionForFeature(Feature.NVDIMM_SUPPORT);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDAzMjQwNg=="}, "originalCommit": {"oid": "d5b5d0b1905ad9a1eb13d2fddf4b1657e3f9500e"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3209, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}