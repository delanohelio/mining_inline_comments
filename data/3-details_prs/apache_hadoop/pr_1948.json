{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxNDQ0MDI3", "number": 1948, "title": "HADOOP-16986. S3A to not need wildfly on the classpath.", "bodyText": "Contributed by Steve Loughran\nSuccessor to HADOOP-16346.\n\ncompletely remove wildfly jar as a dependency of hadoop-aws\nsocket factory to catch and swallow all\nand verify that in tests\ntests which also verify that in the default factory mode,\nclassloader errors are caught and downgrade to jvm\nand in openssl mode, the s3a binding explicitly catches\nthese failures and handles too\n\nThis means\ns3a:\nwhen widlfy doesn't load for classpath or wildfly/openssl issues, S3A will\ndowngrade to jvm, irrespective of SSL mode option.\nabfs:\nwhen widlfy doesn't load for classpath or wildfly/openssl issues,\ndefault: swallow and downgrade to jvm\nopenssl: exception thrown; you can't talk to azure.\nYes, these are different behaviours. But abfs has always mandated the wildfly\nlibrary S3A has never done this and starting now will only surprise people. If\npeople/project downstream want to use it -fine. If they are running on the\nmachines where open SSL is found and is compatible -they will actually see a\nspeed up. Without that, it is utterly superfluous and simply any other source\nof class path dependency and stack trace issues.\nChange-Id: I74c4b8a1876b5c28d7d96fe3a6dc8e22ffbdc1f7", "createdAt": "2020-04-09T14:05:24Z", "url": "https://github.com/apache/hadoop/pull/1948", "merged": true, "mergeCommit": {"oid": "42711081e3cba5835493b5cbedc23d16dfea7667"}, "closed": true, "closedAt": "2020-04-20T13:32:14Z", "author": {"login": "steveloughran"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXTnRfAFqTM5MjM1NzI2MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYmH0kAFqTM5NTcwNDIzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMzU3MjYx", "url": "https://github.com/apache/hadoop/pull/1948#pullrequestreview-392357261", "createdAt": "2020-04-13T18:57:25Z", "commit": {"oid": "55a2a77672762440c21e3013b7d72de599b1c190"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxODo1NzoyNVrOGExLCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxODo1NzoyNVrOGExLCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzY1MzEyOA==", "bodyText": "Wouldn't it be better to move the code within try-catch into a new method so that the same can be resued for the case openSSL as well.", "url": "https://github.com/apache/hadoop/pull/1948#discussion_r407653128", "createdAt": "2020-04-13T18:57:25Z", "author": {"login": "bilaharith"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/ssl/DelegatingSSLSocketFactory.java", "diffHunk": "@@ -149,11 +149,11 @@ private void initializeSSLContext(SSLChannelMode preferredChannelMode)\n       throws NoSuchAlgorithmException, KeyManagementException {\n     switch (preferredChannelMode) {\n     case Default:\n-      if (!openSSLProviderRegistered) {\n-        OpenSSLProvider.register();\n-        openSSLProviderRegistered = true;\n-      }\n       try {\n+        if (!openSSLProviderRegistered) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55a2a77672762440c21e3013b7d72de599b1c190"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a0307e8e7b4c77515e52e6e181625606051961f", "author": {"user": {"login": "steveloughran", "name": "Steve Loughran"}}, "url": "https://github.com/apache/hadoop/commit/4a0307e8e7b4c77515e52e6e181625606051961f", "committedDate": "2020-04-14T18:25:33Z", "message": "HADOOP-16986. s3a to not need wildfly on the classpath\n\n* completely remove wildfly jar as a dependency of hadoop-aws\n* socket factory to catch and swallow all\n* and verify that in tests\n* tests which also verify that in the default factory mode,\n  classloader errors are caught and downgrade to jvm\n* and in openssl mode, the s3a binding explicitly catches\n  these failures and handles too\n\nThis means\n\ns3a:\n\nwhen widlfy doesn't load for classpath or wildfly/openssl issues, S3A will\ndowngrade to jvm, irrespective of SSL mode option.\n\nabfs:\n\nwhen widlfy doesn't load for classpath or wildfly/openssl issues,\n\ndefault: swallow and downgrade to jvm\nopenssl: exception thrown; you can't talk to azure.\n\nYes, these are different behaviours. But abfs has always mandated the wildfly\nlibrary S3A has never done this and I do not want to start now. If\npeople/project downstream want to use it -fine. If they are running on the\nmachines where open SSL is found and is compatible -they will actually see a\nspeed up. Without that, it is utterly superfluous and simply any other source\nof class path dependency and stack trace issues.\n\nSorry, I hadn't realised the previous patch was going to require wildfly\neverywhere; I wouldn't make sure that was an otherwise.\n\nI intend to get this patch into branch 3.3 as well, so only 3.3.0 has the\nextra dependency.\n\nChange-Id: I74c4b8a1876b5c28d7d96fe3a6dc8e22ffbdc1f7"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "55a2a77672762440c21e3013b7d72de599b1c190", "author": {"user": {"login": "steveloughran", "name": "Steve Loughran"}}, "url": "https://github.com/apache/hadoop/commit/55a2a77672762440c21e3013b7d72de599b1c190", "committedDate": "2020-04-09T14:02:15Z", "message": "HADOOP-16855. wildfly classpath/loading issues\n* completely remove wildfly jar as a dependency of hadoop-aws\n* socket factory to catch and swallow all\n* and verify that in tests\n* tests which also verify that in the default factory mode,\n  classloader errors are caught and downgrade to jvm\n* and in openssl mode, the s3a binding explicitly catches\n  these failures and handles too\n\nThis means\n\ns3a:\n\nwhen widlfy doesn't load for classpath or wildfly/openssl issues, S3A will\ndowngrade to jvm, irrespective of SSL mode option.\n\nabfs:\n\nwhen widlfy doesn't load for classpath or wildfly/openssl issues,\n\ndefault: swallow and downgrade to jvm\nopenssl: exception thrown; you can't talk to azure.\n\nYes, these are different behaviours. But abfs has always mandated the wildfly\nlibrary S3A has never done this and I do not want to start now. If\npeople/project downstream want to use it -fine. If they are running on the\nmachines where open SSL is found and is compatible -they will actually see a\nspeed up. Without that, it is utterly superfluous and simply any other source\nof class path dependency and stack trace issues.\n\nSorry, I hadn't realised the previous patch was going to require wildfly\neverywhere; I wouldn't make sure that was an otherwise.\n\nI intend to get this patch into branch 3.3 as well, so only 3.3.0 has the\nextra dependency.\n\nChange-Id: I74c4b8a1876b5c28d7d96fe3a6dc8e22ffbdc1f7"}, "afterCommit": {"oid": "4a0307e8e7b4c77515e52e6e181625606051961f", "author": {"user": {"login": "steveloughran", "name": "Steve Loughran"}}, "url": "https://github.com/apache/hadoop/commit/4a0307e8e7b4c77515e52e6e181625606051961f", "committedDate": "2020-04-14T18:25:33Z", "message": "HADOOP-16986. s3a to not need wildfly on the classpath\n\n* completely remove wildfly jar as a dependency of hadoop-aws\n* socket factory to catch and swallow all\n* and verify that in tests\n* tests which also verify that in the default factory mode,\n  classloader errors are caught and downgrade to jvm\n* and in openssl mode, the s3a binding explicitly catches\n  these failures and handles too\n\nThis means\n\ns3a:\n\nwhen widlfy doesn't load for classpath or wildfly/openssl issues, S3A will\ndowngrade to jvm, irrespective of SSL mode option.\n\nabfs:\n\nwhen widlfy doesn't load for classpath or wildfly/openssl issues,\n\ndefault: swallow and downgrade to jvm\nopenssl: exception thrown; you can't talk to azure.\n\nYes, these are different behaviours. But abfs has always mandated the wildfly\nlibrary S3A has never done this and I do not want to start now. If\npeople/project downstream want to use it -fine. If they are running on the\nmachines where open SSL is found and is compatible -they will actually see a\nspeed up. Without that, it is utterly superfluous and simply any other source\nof class path dependency and stack trace issues.\n\nSorry, I hadn't realised the previous patch was going to require wildfly\neverywhere; I wouldn't make sure that was an otherwise.\n\nI intend to get this patch into branch 3.3 as well, so only 3.3.0 has the\nextra dependency.\n\nChange-Id: I74c4b8a1876b5c28d7d96fe3a6dc8e22ffbdc1f7"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91d88c31463b1f1a514859f5df07eb5f5f882503", "author": {"user": {"login": "steveloughran", "name": "Steve Loughran"}}, "url": "https://github.com/apache/hadoop/commit/91d88c31463b1f1a514859f5df07eb5f5f882503", "committedDate": "2020-04-14T20:40:25Z", "message": "HADOOP-16855. S3A resilience to wildfly classes missing.\n\nopenssl will not downgrade in AWS client setup\n\n* cover in docs, including troubleshooting\n* cleanup of duplicate code in DelegatingSSLSocketFactory\n* tests cover failure modes\n* add a way to reset the static DelegatingSSLSocketFactory so\n  that the tests can actually force a reload.\n\nChange-Id: I25d09d42cd87fe7e9909cff1e80141bfea69724a"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNDUzNjE2", "url": "https://github.com/apache/hadoop/pull/1948#pullrequestreview-393453616", "createdAt": "2020-04-15T04:49:42Z", "commit": {"oid": "91d88c31463b1f1a514859f5df07eb5f5f882503"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNDo0OTo0MlrOGFprTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNDo0OTo0MlrOGFprTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU3ODg5Mw==", "bodyText": "mvn site fails due to invalid tag </>. should be </a>", "url": "https://github.com/apache/hadoop/pull/1948#discussion_r408578893", "createdAt": "2020-04-15T04:49:42Z", "author": {"login": "iwasakims"}, "path": "hadoop-tools/hadoop-aws/src/site/markdown/tools/hadoop-aws/performance.md", "diffHunk": "@@ -539,7 +539,7 @@ in Java 9, so if `default_jsse` is specified and applications run on Java\n includes GCM in the list of cipher suites on Java 8, so it is equivalent to\n running with the vanilla JSSE.\n \n-### OpenSSL Acceleration\n+### <a name=\"openssl\"></> OpenSSL Acceleration", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91d88c31463b1f1a514859f5df07eb5f5f882503"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6acc273328e8960edecdde41cf9b6f4a22eb1a5c", "author": {"user": {"login": "steveloughran", "name": "Steve Loughran"}}, "url": "https://github.com/apache/hadoop/commit/6acc273328e8960edecdde41cf9b6f4a22eb1a5c", "committedDate": "2020-04-15T09:09:57Z", "message": "HADOOP-16855. Wildfly class binding\n\nfix checkstyle and site\n\nChange-Id: I06a7fca5ec38aacdd53cbc9edd6c7794ca73adba"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff698c852284e2cb20d5b9b5907d875ff18b0540", "author": {"user": {"login": "steveloughran", "name": "Steve Loughran"}}, "url": "https://github.com/apache/hadoop/commit/ff698c852284e2cb20d5b9b5907d875ff18b0540", "committedDate": "2020-04-15T16:48:17Z", "message": "HADOOP-16855. reinstate wildfly as a dependency,\nbut we are resilient to its absence.\n\nChange-Id: I369489ce11f18624e13bc3e4319a7bd4d8ce1389"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzA0MjM3", "url": "https://github.com/apache/hadoop/pull/1948#pullrequestreview-395704237", "createdAt": "2020-04-17T19:05:12Z", "commit": {"oid": "ff698c852284e2cb20d5b9b5907d875ff18b0540"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4576, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}