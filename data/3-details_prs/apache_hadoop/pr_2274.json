{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4ODQzOTg5", "number": 2274, "title": "HDFS-15557. Log the reason why a storage log file can't be deleted", "bodyText": "https://issues.apache.org/jira/browse/HDFS-15557\nNOTICE\nPlease create an issue in ASF JIRA before opening a pull request,\nand you need to set the title of the pull request which starts with\nthe corresponding JIRA issue number. (e.g. HADOOP-XXXXX. Fix a typo in YYY.)\nFor more details, please see https://cwiki.apache.org/confluence/display/HADOOP/How+To+Contribute", "createdAt": "2020-09-03T19:12:25Z", "url": "https://github.com/apache/hadoop/pull/2274", "merged": true, "mergeCommit": {"oid": "ae089f2db7244c192135d500240ecdb95c7eb005"}, "closed": true, "closedAt": "2020-09-22T20:23:20Z", "author": {"login": "NickyYe"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFVhmnAH2gAyNDc4ODQzOTg5OjRmNDllODIyNjdmYTJmMDg5ZTBlYWNlYmI5NmEyYTI0ZWQ1MTJhODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLd77BAFqTQ5MzgxNzIwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4f49e82267fa2f089e0eacebb96a2a24ed512a80", "author": {"user": {"login": "NickyYe", "name": "Ye Ni"}}, "url": "https://github.com/apache/hadoop/commit/4f49e82267fa2f089e0eacebb96a2a24ed512a80", "committedDate": "2020-09-03T19:11:34Z", "message": "Update AtomicFileOutputStream.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7acb01abcdc80bdd1caf3a8e8abe0501d11b3a5c", "author": {"user": {"login": "NickyYe", "name": "Ye Ni"}}, "url": "https://github.com/apache/hadoop/commit/7acb01abcdc80bdd1caf3a8e8abe0501d11b3a5c", "committedDate": "2020-09-03T22:23:04Z", "message": "Update AtomicFileOutputStream.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb74537da26389bcb3a3f1dc74d50c4be378c6b3", "author": {"user": {"login": "NickyYe", "name": "Ye Ni"}}, "url": "https://github.com/apache/hadoop/commit/fb74537da26389bcb3a3f1dc74d50c4be378c6b3", "committedDate": "2020-09-04T00:31:50Z", "message": "Update AtomicFileOutputStream.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMzQ2NjQ1", "url": "https://github.com/apache/hadoop/pull/2274#pullrequestreview-482346645", "createdAt": "2020-09-04T04:20:55Z", "commit": {"oid": "fb74537da26389bcb3a3f1dc74d50c4be378c6b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNDoyMDo1NlrOHM-_0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNDoyMDo1NlrOHM-_0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM3NzEwNQ==", "bodyText": "Is it simpler\nthrow new IOException(\"Could not delete original file \" + origFile, e);\n\nOther than that, +1", "url": "https://github.com/apache/hadoop/pull/2274#discussion_r483377105", "createdAt": "2020-09-04T04:20:56Z", "author": {"login": "liuml07"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/util/AtomicFileOutputStream.java", "diffHunk": "@@ -75,8 +76,13 @@ public void close() throws IOException {\n         boolean renamed = tmpFile.renameTo(origFile);\n         if (!renamed) {\n           // On windows, renameTo does not replace.\n-          if (origFile.exists() && !origFile.delete()) {\n-            throw new IOException(\"Could not delete original file \" + origFile);\n+          if (origFile.exists()) {\n+            try {\n+              Files.delete(origFile.toPath());\n+            } catch (IOException e) {\n+              throw new IOException(\"Could not delete original file \" + origFile", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb74537da26389bcb3a3f1dc74d50c4be378c6b3"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a247b7435d2c5c108e86c6369d9a94be17cd0df", "author": {"user": {"login": "NickyYe", "name": "Ye Ni"}}, "url": "https://github.com/apache/hadoop/commit/2a247b7435d2c5c108e86c6369d9a94be17cd0df", "committedDate": "2020-09-21T05:15:42Z", "message": "Update AtomicFileOutputStream.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODQwOTAy", "url": "https://github.com/apache/hadoop/pull/2274#pullrequestreview-492840902", "createdAt": "2020-09-21T17:40:13Z", "commit": {"oid": "2a247b7435d2c5c108e86c6369d9a94be17cd0df"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzODE3MjAx", "url": "https://github.com/apache/hadoop/pull/2274#pullrequestreview-493817201", "createdAt": "2020-09-22T20:23:06Z", "commit": {"oid": "2a247b7435d2c5c108e86c6369d9a94be17cd0df"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3604, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}