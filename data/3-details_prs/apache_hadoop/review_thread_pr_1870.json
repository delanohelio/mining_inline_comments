{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNTYzNzQ2", "number": 1870, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMDoxNzozM1rODkaLAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMjozNDoyMVrODkfvFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTA0MTMxOnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMDoxNzozNFrOFwtznQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMjowMToyOVrOFww6PA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNjQ2MQ==", "bodyText": "I believe @szetszwo recommended setting this to 28 bits for now (something less than 31).", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r386626461", "createdAt": "2020-03-02T20:17:34Z", "author": {"login": "arp7"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -96,7 +96,7 @@\n   private final boolean snapshotDiffAllowSnapRootDescendant;\n \n   private final AtomicInteger numSnapshots = new AtomicInteger();\n-  private static final int SNAPSHOT_ID_BIT_WIDTH = 24;\n+  private static final int SNAPSHOT_ID_BIT_WIDTH = 31;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15929f6f6c5761088bc00fb18b7b384b75e35da9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY3NzMwOA==", "bodyText": "Sure @arp7  I will set to 28 then.", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r386677308", "createdAt": "2020-03-02T22:01:29Z", "author": {"login": "karthikhw"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -96,7 +96,7 @@\n   private final boolean snapshotDiffAllowSnapRootDescendant;\n \n   private final AtomicInteger numSnapshots = new AtomicInteger();\n-  private static final int SNAPSHOT_ID_BIT_WIDTH = 24;\n+  private static final int SNAPSHOT_ID_BIT_WIDTH = 31;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNjQ2MQ=="}, "originalCommit": {"oid": "15929f6f6c5761088bc00fb18b7b384b75e35da9"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTgzNTY3OnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/snapshot/TestSnapshotManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMToyNzoxNVrOFw1XIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMTo0NzoyNlrOFx-0sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc1MDI0Mg==", "bodyText": "can you add a description/comment to explain this assertion.", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r386750242", "createdAt": "2020-03-03T01:27:15Z", "author": {"login": "jojochuang"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/snapshot/TestSnapshotManager.java", "diffHunk": "@@ -92,4 +92,15 @@ public void testSnapshotLimits() throws Exception {\n           StringUtils.toLowerCase(se.getMessage()).contains(\"rollover\"));\n     }\n   }\n+\n+\n+  @Test\n+  public void testValidateSnapshotIDWidth() {\n+    FSDirectory fsdir = mock(FSDirectory.class);\n+    SnapshotManager snapshotManager = new SnapshotManager(new Configuration(),\n+        fsdir);\n+    Assert.assertTrue(snapshotManager.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "558f9547389f6df26f110afa359d6ec496a50d8e"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk1Mzg0Mg==", "bodyText": "Added!", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r387953842", "createdAt": "2020-03-04T21:47:26Z", "author": {"login": "karthikhw"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/server/namenode/snapshot/TestSnapshotManager.java", "diffHunk": "@@ -92,4 +92,15 @@ public void testSnapshotLimits() throws Exception {\n           StringUtils.toLowerCase(se.getMessage()).contains(\"rollover\"));\n     }\n   }\n+\n+\n+  @Test\n+  public void testValidateSnapshotIDWidth() {\n+    FSDirectory fsdir = mock(FSDirectory.class);\n+    SnapshotManager snapshotManager = new SnapshotManager(new Configuration(),\n+        fsdir);\n+    Assert.assertTrue(snapshotManager.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc1MDI0Mg=="}, "originalCommit": {"oid": "558f9547389f6df26f110afa359d6ec496a50d8e"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NTk1Mjg0OnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwMjozNDoyMVrOFw2c6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQyMDowNzo1NlrOFx76rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc2ODEwNg==", "bodyText": "I think we can still leave this as max index -1, as we would only have one snapshot id here.", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r386768106", "createdAt": "2020-03-03T02:34:21Z", "author": {"login": "mukul1987"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -541,8 +541,8 @@ public void clearSnapshottableDirs() {\n    *\n    * @return maximum allowable snapshot ID.\n    */\n-   public int getMaxSnapshotID() {\n-    return ((1 << SNAPSHOT_ID_BIT_WIDTH) - 1);\n+  public int getMaxSnapshotID() {\n+    return (1 << SNAPSHOT_ID_BIT_WIDTH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "558f9547389f6df26f110afa359d6ec496a50d8e"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwNjIyMQ==", "bodyText": "Thank you @mukul1987. I didn't understand this \"as we would only have one snapshot id here\".\nSNAPSHOT_ID_BIT_WIDTH  has no relation with anyone. Not sure why would we need index -1.", "url": "https://github.com/apache/hadoop/pull/1870#discussion_r387906221", "createdAt": "2020-03-04T20:07:56Z", "author": {"login": "karthikhw"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -541,8 +541,8 @@ public void clearSnapshottableDirs() {\n    *\n    * @return maximum allowable snapshot ID.\n    */\n-   public int getMaxSnapshotID() {\n-    return ((1 << SNAPSHOT_ID_BIT_WIDTH) - 1);\n+  public int getMaxSnapshotID() {\n+    return (1 << SNAPSHOT_ID_BIT_WIDTH);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc2ODEwNg=="}, "originalCommit": {"oid": "558f9547389f6df26f110afa359d6ec496a50d8e"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3599, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}