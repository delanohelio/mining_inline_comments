{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NTg5ODQ3", "number": 1880, "title": "HADOOP-16661. Support TLS 1.3", "bodyText": "TLS 1.3 is supported in Hadoop 3.3.0 with the update of Jetty 9.4 and Java 11 Runtime.\nThis patch doesn't add any new capability. It simply adds a new test case to verify TLSv1.3 is enabled on Java 11.\nVerified manually by:\nJAVA_HOME=`/usr/libexec/java_home -v 11` mvn test -Dtest=TestSSLHttpServer#testIncludedProtocols\nJAVA_HOME=`/usr/libexec/java_home -v 1.8` mvn test -Dtest=TestSSLHttpServer#testIncludedProtocols", "createdAt": "2020-03-06T01:35:38Z", "url": "https://github.com/apache/hadoop/pull/1880", "merged": true, "mergeCommit": {"oid": "f197f05cff17a3ae8c4f2d377a0375b38c404879"}, "closed": true, "closedAt": "2020-03-16T17:56:31Z", "author": {"login": "jojochuang"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKiuzSgH2gAyMzg0NTg5ODQ3OmQ5ZTJkZDc0Yjc1YmViYTgwZTZkOWY4NDUyODVmYzgyY2ZiYjdkNjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOEpV-AFqTM3NDg4MDYzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d9e2dd74b75beba80e6d9f845285fc82cfbb7d68", "author": {"user": {"login": "jojochuang", "name": "Wei-Chiu Chuang"}}, "url": "https://github.com/apache/hadoop/commit/d9e2dd74b75beba80e6d9f845285fc82cfbb7d68", "committedDate": "2020-03-05T03:13:13Z", "message": "tls1.3\n\nChange-Id: I0b4d8ac730fa52267ee0413ec98d6711fa3ca7f0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2670160d36809ddea601d51a0017052f6d866994", "author": {"user": {"login": "jojochuang", "name": "Wei-Chiu Chuang"}}, "url": "https://github.com/apache/hadoop/commit/2670160d36809ddea601d51a0017052f6d866994", "committedDate": "2020-03-06T01:32:11Z", "message": "Added test to verify TLSv1.3 support. Updated core-default.xml to add description for TLSv1.3\n\nChange-Id: Id8fdfd132ded25d3f9a05710f83f5f2c38b3ad8c"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMTM2NzM3", "url": "https://github.com/apache/hadoop/pull/1880#pullrequestreview-370136737", "createdAt": "2020-03-06T07:56:51Z", "commit": {"oid": "2670160d36809ddea601d51a0017052f6d866994"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNzo1Njo1MVrOFyv3tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNzo1Njo1MVrOFyv3tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc1NzQyOQ==", "bodyText": "We can use the utility method and don't have to parse the java.version string. This change can avoid test failure in Java 9 and 10 (corner case).\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String version = System.getProperty(\"java.version\");\n          \n          \n            \n                if (version.startsWith(\"1.\")) { // JDK 8\n          \n          \n            \n                  includedProtocols = INCLUDED_PROTOCOLS;\n          \n          \n            \n                } else { // JDK 11 and above\n          \n          \n            \n                  includedProtocols = INCLUDED_PROTOCOLS_JDK11;\n          \n          \n            \n                }\n          \n          \n            \n                if (Shell.isJavaVersionAtLeast(11) {\n          \n          \n            \n                  includedProtocols = INCLUDED_PROTOCOLS_JDK11;\n          \n          \n            \n                } else {\n          \n          \n            \n                  includedProtocols = INCLUDED_PROTOCOLS;\n          \n          \n            \n                }", "url": "https://github.com/apache/hadoop/pull/1880#discussion_r388757429", "createdAt": "2020-03-06T07:56:51Z", "author": {"login": "aajisaka"}, "path": "hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/http/TestSSLHttpServer.java", "diffHunk": "@@ -291,13 +294,30 @@ public void testExcludedCiphers() throws Exception {\n   @Test\n   public void testIncludedProtocols() throws Exception {\n     URL url = new URL(baseUrl, SERVLET_PATH_ECHO + \"?a=b&c=d\");\n+\n+    String includedProtocols;\n+    String version = System.getProperty(\"java.version\");\n+    if (version.startsWith(\"1.\")) { // JDK 8\n+      includedProtocols = INCLUDED_PROTOCOLS;\n+    } else { // JDK 11 and above\n+      includedProtocols = INCLUDED_PROTOCOLS_JDK11;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2670160d36809ddea601d51a0017052f6d866994"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMTM3NDkw", "url": "https://github.com/apache/hadoop/pull/1880#pullrequestreview-370137490", "createdAt": "2020-03-06T07:58:31Z", "commit": {"oid": "2670160d36809ddea601d51a0017052f6d866994"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNzo1ODozMVrOFyv6GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNzo1ODozMVrOFyv6GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc1ODA0MQ==", "bodyText": "This lines can be fixed as well.", "url": "https://github.com/apache/hadoop/pull/1880#discussion_r388758041", "createdAt": "2020-03-06T07:58:31Z", "author": {"login": "aajisaka"}, "path": "hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/http/TestSSLHttpServer.java", "diffHunk": "@@ -291,13 +294,30 @@ public void testExcludedCiphers() throws Exception {\n   @Test\n   public void testIncludedProtocols() throws Exception {\n     URL url = new URL(baseUrl, SERVLET_PATH_ECHO + \"?a=b&c=d\");\n+\n+    String includedProtocols;\n+    String version = System.getProperty(\"java.version\");\n+    if (version.startsWith(\"1.\")) { // JDK 8\n+      includedProtocols = INCLUDED_PROTOCOLS;\n+    } else { // JDK 11 and above\n+      includedProtocols = INCLUDED_PROTOCOLS_JDK11;\n+    }\n     HttpsURLConnection conn =\n         getConnectionWithPreferredProtocolSSLSocketFactory(url,\n-        INCLUDED_PROTOCOLS);\n+            includedProtocols);\n     assertFalse(\"included protocol list is empty\",\n-        INCLUDED_PROTOCOLS.isEmpty());\n+        includedProtocols.isEmpty());\n \n     readFromConnection(conn);\n+\n+    PreferredProtocolSSLSocketFactory factory =\n+        (PreferredProtocolSSLSocketFactory)conn.getSSLSocketFactory();\n+\n+    if (version.startsWith(\"1.\")) {\n+      assertEquals(\"TLSv1.2\", factory.getSocket().getSession().getProtocol());\n+    } else {\n+      assertEquals(\"TLSv1.3\", factory.getSocket().getSession().getProtocol());\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2670160d36809ddea601d51a0017052f6d866994"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dda227280d3325016aba932bf194730f2cf87b70", "author": {"user": {"login": "jojochuang", "name": "Wei-Chiu Chuang"}}, "url": "https://github.com/apache/hadoop/commit/dda227280d3325016aba932bf194730f2cf87b70", "committedDate": "2020-03-07T01:18:46Z", "message": "Update code per Akira's review comments.\n\nChange-Id: I14ce47919badf93b309c1855a888349f2e58d2ae"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODgwNjMz", "url": "https://github.com/apache/hadoop/pull/1880#pullrequestreview-374880633", "createdAt": "2020-03-16T02:25:48Z", "commit": {"oid": "dda227280d3325016aba932bf194730f2cf87b70"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4439, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}