{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MzI4MjY2", "number": 2175, "title": "HDFS-15497. Make snapshot limit on global as well per snapshot root directory configurable", "bodyText": "please see https://issues.apache.org/jira/browse/HDFS-15497.", "createdAt": "2020-07-29T09:57:56Z", "url": "https://github.com/apache/hadoop/pull/2175", "merged": true, "mergeCommit": {"oid": "e072d33327b8f5d38b74a15e279d492ad379a47c"}, "closed": true, "closedAt": "2020-08-04T08:40:30Z", "author": {"login": "bshashikant"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5oAC2gH2gAyNDU4MzI4MjY2OmRiZGE2YTVjZjg4NWI5NTY4ZjczZDk1NmI1YmZiZTY5ZTRjODkzZDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7gBvwgFqTQ2MDUxMTQ5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dbda6a5cf885b9568f73d956b5bfbe69e4c893d3", "author": {"user": {"login": "bshashikant", "name": null}}, "url": "https://github.com/apache/hadoop/commit/dbda6a5cf885b9568f73d956b5bfbe69e4c893d3", "committedDate": "2020-07-29T09:56:01Z", "message": "HDFS-15497. Make snapshot limit on global as well per snapshot root directory configurable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2", "author": {"user": {"login": "bshashikant", "name": null}}, "url": "https://github.com/apache/hadoop/commit/a2e52ff263fc1f1e3fefd42093cae29c87a458b2", "committedDate": "2020-07-30T06:04:59Z", "message": "Undo Config name changes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NDA0MjIx", "url": "https://github.com/apache/hadoop/pull/2175#pullrequestreview-459404221", "createdAt": "2020-07-31T19:17:38Z", "commit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxOToxNzozOFrOG6TTxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxOToxODozM1rOG6TVPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4Njk1MQ==", "bodyText": "Lets change DFS_NAMENODE_SNAPSHOT_MAX_LIMIT to DFS_NAMENODE_SNAPSHOT_MAX_DIRECTORY_LIMIT. and lets use the same reference of the variable internally;", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r463786951", "createdAt": "2020-07-31T19:17:38Z", "author": {"login": "mukul1987"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "diffHunk": "@@ -498,9 +498,14 @@\n   public static final int\n       DFS_NAMENODE_SNAPSHOT_DIFF_LISTING_LIMIT_DEFAULT = 1000;\n \n-  public static final String DFS_NAMENODE_SNAPSHOT_MAX_LIMIT =\n-      \"dfs.namenode.snapshot.max.limit\";\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_MAX_LIMIT = \"dfs.namenode.snapshot.max.limit\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4NzMyNA==", "bodyText": "maxSnapshotLimit -> maxSnapshotDirectroyLimit", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r463787324", "createdAt": "2020-07-31T19:18:33Z", "author": {"login": "mukul1987"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -117,23 +119,37 @@ public SnapshotManager(final Configuration conf, final FSDirectory fsdir) {\n         DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_DIFF_ALLOW_SNAP_ROOT_DESCENDANT,\n         DFSConfigKeys.\n             DFS_NAMENODE_SNAPSHOT_DIFF_ALLOW_SNAP_ROOT_DESCENDANT_DEFAULT);\n+    this.maxSnapshotLimitPerDirectory = conf.getInt(\n+        DFSConfigKeys.\n+            DFS_NAMENODE_SNAPSHOT_MAX_LIMIT,\n+        DFSConfigKeys.\n+            DFS_NAMENODE_SNAPSHOT_MAX_LIMIT_DEFAULT);\n     this.maxSnapshotLimit = conf.getInt(\n-        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_MAX_LIMIT,\n-        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_MAX_LIMIT_DEFAULT);\n+        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_GLOBAL_LIMIT,\n+        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_GLOBAL_LIMIT_DEFAULT);\n     LOG.info(\"Loaded config captureOpenFiles: \" + captureOpenFiles\n         + \", skipCaptureAccessTimeOnlyChange: \"\n         + skipCaptureAccessTimeOnlyChange\n         + \", snapshotDiffAllowSnapRootDescendant: \"\n         + snapshotDiffAllowSnapRootDescendant\n         + \", maxSnapshotLimit: \"\n-        + maxSnapshotLimit);\n+        + maxSnapshotLimit", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjA0ODE2", "url": "https://github.com/apache/hadoop/pull/2175#pullrequestreview-460204816", "createdAt": "2020-08-03T17:23:24Z", "commit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzoyMzoyNFrOG7CEag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzo1MzoyOFrOG7DMBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU1MzA2Ng==", "bodyText": "Yes, we cannot change config names.\nBTW, please revert the white space change so that it will be easier to back port.", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r464553066", "createdAt": "2020-08-03T17:23:24Z", "author": {"login": "szetszwo"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "diffHunk": "@@ -498,9 +498,14 @@\n   public static final int\n       DFS_NAMENODE_SNAPSHOT_DIFF_LISTING_LIMIT_DEFAULT = 1000;\n \n-  public static final String DFS_NAMENODE_SNAPSHOT_MAX_LIMIT =\n-      \"dfs.namenode.snapshot.max.limit\";\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_MAX_LIMIT = \"dfs.namenode.snapshot.max.limit\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4Njk1MQ=="}, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU1Njc2NA==", "bodyText": "Let's call this filesystem.limit?  Since there are multiple datacenter settings, \"global\" may be confusing.", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r464556764", "createdAt": "2020-08-03T17:30:16Z", "author": {"login": "szetszwo"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "diffHunk": "@@ -498,9 +498,14 @@\n   public static final int\n       DFS_NAMENODE_SNAPSHOT_DIFF_LISTING_LIMIT_DEFAULT = 1000;\n \n-  public static final String DFS_NAMENODE_SNAPSHOT_MAX_LIMIT =\n-      \"dfs.namenode.snapshot.max.limit\";\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_MAX_LIMIT = \"dfs.namenode.snapshot.max.limit\";\n   public static final int DFS_NAMENODE_SNAPSHOT_MAX_LIMIT_DEFAULT = 65536;\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_GLOBAL_LIMIT = \"dfs.namenode.snapshot.global.limit\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU3MTM5Ng==", "bodyText": "Let's keep using maxSnapshotLimit for per directory limit and add a new variable for the new filesystem limit so that it is consistent with the conf.", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r464571396", "createdAt": "2020-08-03T17:53:28Z", "author": {"login": "szetszwo"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -99,13 +99,15 @@\n \n   private boolean allowNestedSnapshots = false;\n   private int snapshotCounter = 0;\n+  private final int maxSnapshotLimitPerDirectory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4ded1251aee0dfeaf442b36d05ad8412532e96a", "author": {"user": {"login": "bshashikant", "name": null}}, "url": "https://github.com/apache/hadoop/commit/c4ded1251aee0dfeaf442b36d05ad8412532e96a", "committedDate": "2020-08-03T18:24:23Z", "message": "Addressed review comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjYyMjQ2", "url": "https://github.com/apache/hadoop/pull/2175#pullrequestreview-460262246", "createdAt": "2020-08-03T18:49:27Z", "commit": {"oid": "c4ded1251aee0dfeaf442b36d05ad8412532e96a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNTExNDkz", "url": "https://github.com/apache/hadoop/pull/2175#pullrequestreview-460511493", "createdAt": "2020-08-04T05:46:29Z", "commit": {"oid": "c4ded1251aee0dfeaf442b36d05ad8412532e96a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3802, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}