{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxNTc2NjE3", "number": 2554, "title": "YARN-10536. Client in distributedShell swallows interrupt exceptions", "bodyText": "While investigating YARN-10334 I found that in\napplications.distributedshell.Client , the method monitorApplication loops waiting for the following conditions:\n\nApplication fails: reaches YarnApplicationState.KILLED, or YarnApplicationState.FAILED\nApplication succeeds: FinalApplicationStatus.SUCCEEDED or YarnApplicationState.FINISHED\nthe time spent waiting is longer than clientTimeout (if it exists in the parameters).\n\nWhen the Client thread is interrupted, it ignores the exception:\n      // Check app status every 1 second.\n      try {\n        Thread.sleep(1000);\n      } catch (InterruptedException e) {\n        LOG.debug(\"Thread sleep in monitoring loop interrupted\");\n      }\nAlso, the timeout will be measured against the object creation timestamp which is incorrect.", "createdAt": "2020-12-17T03:30:54Z", "url": "https://github.com/apache/hadoop/pull/2554", "merged": true, "mergeCommit": {"oid": "7a88f45366722932211514a9ce0c13492a0bd576"}, "closed": true, "closedAt": "2020-12-17T23:13:29Z", "author": {"login": "amahussein"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnEXlqAH2gAyNTQxNTc2NjE3OmMwYzdiMzk0YzlmY2JiZTJlMGRmZjYxZDgyMzFmOTBkYWI1NDA0MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnJa8-AFqTU1NDk1NjE2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c0c7b394c9fcbbe2e0dff61d8231f90dab540407", "author": {"user": {"login": "amahussein", "name": "Ahmed Hussein"}}, "url": "https://github.com/apache/hadoop/commit/c0c7b394c9fcbbe2e0dff61d8231f90dab540407", "committedDate": "2020-12-17T14:25:40Z", "message": "YARN-10536. distributedshell client handles interrupt"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4704192c91757c29618f2dde5183a870420ebf6f", "author": {"user": {"login": "amahussein", "name": "Ahmed Hussein"}}, "url": "https://github.com/apache/hadoop/commit/4704192c91757c29618f2dde5183a870420ebf6f", "committedDate": "2020-12-17T03:23:36Z", "message": "YARN-10536. distributedshell client handles interrupt"}, "afterCommit": {"oid": "c0c7b394c9fcbbe2e0dff61d8231f90dab540407", "author": {"user": {"login": "amahussein", "name": "Ahmed Hussein"}}, "url": "https://github.com/apache/hadoop/commit/c0c7b394c9fcbbe2e0dff61d8231f90dab540407", "committedDate": "2020-12-17T14:25:40Z", "message": "YARN-10536. distributedshell client handles interrupt"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0ODIxNzYx", "url": "https://github.com/apache/hadoop/pull/2554#pullrequestreview-554821761", "createdAt": "2020-12-17T17:23:39Z", "commit": {"oid": "c0c7b394c9fcbbe2e0dff61d8231f90dab540407"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNzoyMzozOVrOIIAWNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNzoyMzozOVrOIIAWNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI2NTIwNQ==", "bodyText": "No need for toString()", "url": "https://github.com/apache/hadoop/pull/2554#discussion_r545265205", "createdAt": "2020-12-17T17:23:39Z", "author": {"login": "goiri"}, "path": "hadoop-yarn-project/hadoop-yarn/hadoop-yarn-applications/hadoop-yarn-applications-distributedshell/src/main/java/org/apache/hadoop/yarn/applications/distributedshell/Client.java", "diffHunk": "@@ -1139,34 +1147,38 @@ private boolean monitorApplication(ApplicationId appId)\n       FinalApplicationStatus dsStatus = report.getFinalApplicationStatus();\n       if (YarnApplicationState.FINISHED == state) {\n         if (FinalApplicationStatus.SUCCEEDED == dsStatus) {\n-          LOG.info(\"Application has completed successfully. Breaking monitoring loop\");\n-          return true;        \n-        }\n-        else {\n-          LOG.info(\"Application did finished unsuccessfully.\"\n-              + \" YarnState=\" + state.toString() + \", DSFinalStatus=\" + dsStatus.toString()\n-              + \". Breaking monitoring loop\");\n-          return false;\n+          LOG.info(\"Application has completed successfully. \"\n+                  + \"Breaking monitoring loop\");\n+          res = true;\n+        } else {\n+          LOG.info(\"Application did finished unsuccessfully. \"\n+                  + \"YarnState={}, DSFinalStatus={}. Breaking monitoring loop\",\n+              state.toString(), dsStatus.toString());\n         }\n-      }\n-      else if (YarnApplicationState.KILLED == state\n+        break;\n+      } else if (YarnApplicationState.KILLED == state\n           || YarnApplicationState.FAILED == state) {\n-        LOG.info(\"Application did not finish.\"\n-            + \" YarnState=\" + state.toString() + \", DSFinalStatus=\" + dsStatus.toString()\n-            + \". Breaking monitoring loop\");\n-        return false;\n+        LOG.info(\"Application did not finish. YarnState={}, DSFinalStatus={}. \"\n+                + \"Breaking monitoring loop\",\n+            state.toString(), dsStatus.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0c7b394c9fcbbe2e0dff61d8231f90dab540407"}, "originalPosition": 88}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9853426c9cb491d352ed4ecbc3f31656e6acce9", "author": {"user": {"login": "amahussein", "name": "Ahmed Hussein"}}, "url": "https://github.com/apache/hadoop/commit/c9853426c9cb491d352ed4ecbc3f31656e6acce9", "committedDate": "2020-12-17T18:35:10Z", "message": "YARN-10536. address code reviews."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0OTU2MTY5", "url": "https://github.com/apache/hadoop/pull/2554#pullrequestreview-554956169", "createdAt": "2020-12-17T20:18:52Z", "commit": {"oid": "c9853426c9cb491d352ed4ecbc3f31656e6acce9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3226, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}