{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NjE4NTU3", "number": 2100, "title": "HDFS-15436. Default mount table name used by ViewFileSystem should be configurable", "bodyText": "", "createdAt": "2020-06-25T02:33:30Z", "url": "https://github.com/apache/hadoop/pull/2100", "merged": true, "mergeCommit": {"oid": "bed0a3a37404e9defda13a5bffe5609e72466e46"}, "closed": true, "closedAt": "2020-06-26T20:19:17Z", "author": {"login": "virajith"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuxxvygFqTQzNzY3NzUxNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvDneGgBqjM0ODY3MDUwNDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3Njc3NTE0", "url": "https://github.com/apache/hadoop/pull/2100#pullrequestreview-437677514", "createdAt": "2020-06-25T16:47:44Z", "commit": {"oid": "495798bcd46130c371763810d12de8e3eb5c829d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjo0Nzo0NFrOGpDPGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNzowNTo1NFrOGpD5iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY5NzgxNg==", "bodyText": "Please format this line\n'when then default mount' --> when the default mount  ?", "url": "https://github.com/apache/hadoop/pull/2100#discussion_r445697816", "createdAt": "2020-06-25T16:47:44Z", "author": {"login": "umamaheswararao"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemOverloadSchemeWithHdfsScheme.java", "diffHunk": "@@ -235,6 +237,57 @@ public void testListStatusOnNonMountedPath() throws Exception {\n       Assert.fail(\"It should fail as no mount link with /nonMount\");\n     }\n   }\n+  /**\n+   * Create mount links as follows\n+   * hdfs://localhost:xxx/HDFSUser --> hdfs://localhost:xxx/HDFSUser/\n+   * hdfs://localhost:xxx/local --> file://TEST_ROOT_DIR/root/\n+   * and check that \"viewfs:/\" paths work without specifying authority when then default mount table name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "495798bcd46130c371763810d12de8e3eb5c829d"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY5ODAzNg==", "bodyText": "Nit: Need formatting of these lines", "url": "https://github.com/apache/hadoop/pull/2100#discussion_r445698036", "createdAt": "2020-06-25T16:48:06Z", "author": {"login": "umamaheswararao"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemOverloadSchemeWithHdfsScheme.java", "diffHunk": "@@ -235,6 +237,57 @@ public void testListStatusOnNonMountedPath() throws Exception {\n       Assert.fail(\"It should fail as no mount link with /nonMount\");\n     }\n   }\n+  /**\n+   * Create mount links as follows\n+   * hdfs://localhost:xxx/HDFSUser --> hdfs://localhost:xxx/HDFSUser/\n+   * hdfs://localhost:xxx/local --> file://TEST_ROOT_DIR/root/\n+   * and check that \"viewfs:/\" paths work without specifying authority when then default mount table name\n+   * is set correctly.\n+   */\n+  @Test\n+  public void testAccessViewFsPathWithoutAuthority() throws Exception {\n+    final Path hdfsTargetPath = new Path(defaultFSURI + HDFS_USER_FOLDER);\n+    addMountLinks(defaultFSURI.getAuthority(),\n+        new String[] {HDFS_USER_FOLDER, LOCAL_FOLDER },\n+        new String[] {hdfsTargetPath.toUri().toString(),\n+            localTargetDir.toURI().toString() },\n+        conf);\n+\n+    // /HDFSUser/test\n+    Path hdfsDir = new Path(HDFS_USER_FOLDER + \"/test\");\n+    // /local/test\n+    Path localDir = new Path(LOCAL_FOLDER + \"/test\");\n+\n+    try (ViewFileSystemOverloadScheme fs = (ViewFileSystemOverloadScheme) FileSystem.get(conf)) {\n+      fs.mkdirs(hdfsDir); // /HDFSUser/testfile\n+      fs.mkdirs(localDir); // /local/test\n+    }\n+\n+    FileStatus[] expectedStatus;\n+    try (FileSystem fs = FileSystem.get(conf)) {\n+      expectedStatus = fs.listStatus(new Path(\"/\"));\n+    }\n+\n+    // check for viewfs path without authority\n+    Path viewFsRootPath = new Path(\"viewfs:/\");\n+    try {\n+      viewFsRootPath.getFileSystem(conf);\n+      Assert.fail(\"Mount table with authority default should not be initialized\");\n+    } catch (IOException e) {\n+      assertTrue(e.getMessage().contains(\"Empty Mount table in config for viewfs://default/\"));\n+    }\n+\n+    // set the name of the default mount table here and subsequent calls should succeed.\n+    conf.set(Constants.CONFIG_VIEWFS_DEFAULT_MOUNT_TABLE_NAME_KEY, defaultFSURI.getAuthority());\n+\n+    try (FileSystem fs = viewFsRootPath.getFileSystem(conf)) {\n+      FileStatus[] status = fs.listStatus(viewFsRootPath);\n+      // compare only the final components of the paths as full paths have different schemes (hdfs:/ vs. viewfs:/).\n+      List<String> expectedPaths = Arrays.stream(expectedStatus).map(s -> s.getPath().getName()).collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "495798bcd46130c371763810d12de8e3eb5c829d"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwNjAwMQ==", "bodyText": "Nit: you may create path object as new Path(Path, child). so we can avoid str concat. I know lot of existing tests have the same concat. Recently Started using this way :-)", "url": "https://github.com/apache/hadoop/pull/2100#discussion_r445706001", "createdAt": "2020-06-25T17:01:11Z", "author": {"login": "umamaheswararao"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemOverloadSchemeWithHdfsScheme.java", "diffHunk": "@@ -235,6 +237,57 @@ public void testListStatusOnNonMountedPath() throws Exception {\n       Assert.fail(\"It should fail as no mount link with /nonMount\");\n     }\n   }\n+  /**\n+   * Create mount links as follows\n+   * hdfs://localhost:xxx/HDFSUser --> hdfs://localhost:xxx/HDFSUser/\n+   * hdfs://localhost:xxx/local --> file://TEST_ROOT_DIR/root/\n+   * and check that \"viewfs:/\" paths work without specifying authority when then default mount table name\n+   * is set correctly.\n+   */\n+  @Test\n+  public void testAccessViewFsPathWithoutAuthority() throws Exception {\n+    final Path hdfsTargetPath = new Path(defaultFSURI + HDFS_USER_FOLDER);\n+    addMountLinks(defaultFSURI.getAuthority(),\n+        new String[] {HDFS_USER_FOLDER, LOCAL_FOLDER },\n+        new String[] {hdfsTargetPath.toUri().toString(),\n+            localTargetDir.toURI().toString() },\n+        conf);\n+\n+    // /HDFSUser/test\n+    Path hdfsDir = new Path(HDFS_USER_FOLDER + \"/test\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "495798bcd46130c371763810d12de8e3eb5c829d"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwODY4MA==", "bodyText": "You may want to add some documentation in ViewFSOverloadScheme.md docs?", "url": "https://github.com/apache/hadoop/pull/2100#discussion_r445708680", "createdAt": "2020-06-25T17:05:54Z", "author": {"login": "umamaheswararao"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/Constants.java", "diffHunk": "@@ -41,12 +41,17 @@\n    * then the hadoop default value (/user) is used.\n    */\n   public static final String CONFIG_VIEWFS_HOMEDIR = \"homedir\";\n-  \n+\n+  /**\n+   * Config key to specify the name of the default mount table.\n+   */\n+  public static final String CONFIG_VIEWFS_DEFAULT_MOUNT_TABLE_NAME_KEY = \"fs.viewfs.mounttable.default.name.key\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "495798bcd46130c371763810d12de8e3eb5c829d"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "495798bcd46130c371763810d12de8e3eb5c829d", "author": {"user": {"login": "virajith", "name": "Virajith Jalaparti"}}, "url": "https://github.com/apache/hadoop/commit/495798bcd46130c371763810d12de8e3eb5c829d", "committedDate": "2020-06-25T03:39:01Z", "message": "Replace Constants.CONFIG_VIEWFS_DEFAULT_MOUNT_TABLE use in tests"}, "afterCommit": {"oid": "cf651c02c3ce5ef7c774632f126488be35832f4c", "author": {"user": {"login": "virajith", "name": "Virajith Jalaparti"}}, "url": "https://github.com/apache/hadoop/commit/cf651c02c3ce5ef7c774632f126488be35832f4c", "committedDate": "2020-06-25T19:56:15Z", "message": "Address Uma's comments on PR#2100"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTY2MTAy", "url": "https://github.com/apache/hadoop/pull/2100#pullrequestreview-437966102", "createdAt": "2020-06-26T01:50:57Z", "commit": {"oid": "67b87487b785052cdf8bc6d58c57797d99158702"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMTo1MDo1N1rOGpRPDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMjowMjoxN1rOGpRZug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkyNzE4Mw==", "bodyText": "Probably you can removed additional '_'  chars after heading above.", "url": "https://github.com/apache/hadoop/pull/2100#discussion_r445927183", "createdAt": "2020-06-26T01:50:57Z", "author": {"login": "umamaheswararao"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/site/markdown/ViewFsOverloadScheme.md", "diffHunk": "@@ -150,6 +150,39 @@ DFSAdmin commands with View File System Overload Scheme\n \n Please refer to the [HDFSCommands Guide](./HDFSCommands.html#dfsadmin_with_ViewFsOverloadScheme)\n \n+Accessing paths without authority\n+-------------------------------------------------------", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67b87487b785052cdf8bc6d58c57797d99158702"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkyODgzNw==", "bodyText": "Thank you for adding doc. It looks good to me.\nYou may want to remove \"public static final\" in above constant as they are implicitly same in interface. checkstyle would be happy with that. :-)", "url": "https://github.com/apache/hadoop/pull/2100#discussion_r445928837", "createdAt": "2020-06-26T01:57:45Z", "author": {"login": "umamaheswararao"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/Constants.java", "diffHunk": "@@ -41,12 +41,17 @@\n    * then the hadoop default value (/user) is used.\n    */\n   public static final String CONFIG_VIEWFS_HOMEDIR = \"homedir\";\n-  \n+\n+  /**\n+   * Config key to specify the name of the default mount table.\n+   */\n+  public static final String CONFIG_VIEWFS_DEFAULT_MOUNT_TABLE_NAME_KEY = \"fs.viewfs.mounttable.default.name.key\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67b87487b785052cdf8bc6d58c57797d99158702"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkyOTkxNA==", "bodyText": "Tiny nit: in the comment: // /HDFSUser/testfile --> // /HDFSUser/test ?", "url": "https://github.com/apache/hadoop/pull/2100#discussion_r445929914", "createdAt": "2020-06-26T02:02:17Z", "author": {"login": "umamaheswararao"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemOverloadSchemeWithHdfsScheme.java", "diffHunk": "@@ -236,6 +238,61 @@ public void testListStatusOnNonMountedPath() throws Exception {\n     }\n   }\n \n+  /**\n+   * Create mount links as follows\n+   * hdfs://localhost:xxx/HDFSUser --> hdfs://localhost:xxx/HDFSUser/\n+   * hdfs://localhost:xxx/local --> file://TEST_ROOT_DIR/root/\n+   * Check that \"viewfs:/\" paths without authority can work when the\n+   * default mount table name is set correctly.\n+   */\n+  @Test\n+  public void testAccessViewFsPathWithoutAuthority() throws Exception {\n+    final Path hdfsTargetPath = new Path(defaultFSURI + HDFS_USER_FOLDER);\n+    addMountLinks(defaultFSURI.getAuthority(),\n+        new String[] {HDFS_USER_FOLDER, LOCAL_FOLDER },\n+        new String[] {hdfsTargetPath.toUri().toString(),\n+            localTargetDir.toURI().toString() },\n+        conf);\n+\n+    // /HDFSUser/test\n+    Path hdfsDir = new Path(HDFS_USER_FOLDER, \"test\");\n+    // /local/test\n+    Path localDir = new Path(LOCAL_FOLDER, \"test\");\n+    FileStatus[] expectedStatus;\n+\n+    try (FileSystem fs = FileSystem.get(conf)) {\n+      fs.mkdirs(hdfsDir); // /HDFSUser/testfile", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67b87487b785052cdf8bc6d58c57797d99158702"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7c443d655a3177918ebd1b13a609fe882f7f6f5", "author": {"user": {"login": "virajith", "name": "Virajith Jalaparti"}}, "url": "https://github.com/apache/hadoop/commit/d7c443d655a3177918ebd1b13a609fe882f7f6f5", "committedDate": "2020-06-26T13:42:50Z", "message": "HDFS-15436. Default mount table name used by ViewFileSystem should be configurable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e4c5c277f75c88d431b3ff5e2d38a6d91c98472", "author": {"user": {"login": "virajith", "name": "Virajith Jalaparti"}}, "url": "https://github.com/apache/hadoop/commit/8e4c5c277f75c88d431b3ff5e2d38a6d91c98472", "committedDate": "2020-06-26T13:42:50Z", "message": "Replace Constants.CONFIG_VIEWFS_DEFAULT_MOUNT_TABLE use in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb2a1e5e8356edae4d4025b0030ba39510217dcf", "author": {"user": {"login": "virajith", "name": "Virajith Jalaparti"}}, "url": "https://github.com/apache/hadoop/commit/cb2a1e5e8356edae4d4025b0030ba39510217dcf", "committedDate": "2020-06-26T13:42:50Z", "message": "Address Uma's comments on PR#2100"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "429daa01576040e9f57f79165dc781cff1a99363", "author": {"user": {"login": "virajith", "name": "Virajith Jalaparti"}}, "url": "https://github.com/apache/hadoop/commit/429daa01576040e9f57f79165dc781cff1a99363", "committedDate": "2020-06-26T13:42:50Z", "message": "Sort lists in test to match without concern to order"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a18177170c28884736cdf42f7aeb1e9fb71ff3ae", "author": {"user": {"login": "virajith", "name": "Virajith Jalaparti"}}, "url": "https://github.com/apache/hadoop/commit/a18177170c28884736cdf42f7aeb1e9fb71ff3ae", "committedDate": "2020-06-26T13:42:50Z", "message": "Address comments, fix checkstyle and fix failing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1935fd40e98c83b615efdaa8a0358de3de3f2b9", "author": {"user": {"login": "virajith", "name": "Virajith Jalaparti"}}, "url": "https://github.com/apache/hadoop/commit/f1935fd40e98c83b615efdaa8a0358de3de3f2b9", "committedDate": "2020-06-26T13:42:50Z", "message": "Fix checkstyle"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e70f0e5d4da3eea0ec55724379df0718c034f7bd", "author": {"user": {"login": "virajith", "name": "Virajith Jalaparti"}}, "url": "https://github.com/apache/hadoop/commit/e70f0e5d4da3eea0ec55724379df0718c034f7bd", "committedDate": "2020-06-26T03:18:08Z", "message": "Address comments, fix checkstyle and fix failing tests"}, "afterCommit": {"oid": "f1935fd40e98c83b615efdaa8a0358de3de3f2b9", "author": {"user": {"login": "virajith", "name": "Virajith Jalaparti"}}, "url": "https://github.com/apache/hadoop/commit/f1935fd40e98c83b615efdaa8a0358de3de3f2b9", "committedDate": "2020-06-26T13:42:50Z", "message": "Fix checkstyle"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4086, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}