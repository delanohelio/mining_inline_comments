{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MjkxNTE2", "number": 2026, "title": "HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes", "bodyText": "After upgrade/shade of protobuf to 3.7 version, existing Hadoop-Rpc client-server implementations using ProtobufRpcEngine will not work.\nSo, this Jira proposes to keep existing ProtobuRpcEngine as-is (without shading and with protobuf-2.5.0 implementation) to support downstream implementations.\nUse new ProtobufRpcEngine2 to use shaded protobuf classes within Hadoop and later projects who wish to upgrade their protobufs to 3.x.", "createdAt": "2020-05-18T06:40:33Z", "url": "https://github.com/apache/hadoop/pull/2026", "merged": true, "mergeCommit": {"oid": "e15408477017753ea1a0896c8f54daeadee40d10"}, "closed": true, "closedAt": "2020-06-12T17:46:34Z", "author": {"login": "vinayakumarb"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcitAcNgBqjMzNTAwNDc5NTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqmjWFABqjM0MzkzODM1ODM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bd8509eae3755b88559b0cdae5c09594d5469e3f", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/bd8509eae3755b88559b0cdae5c09594d5469e3f", "committedDate": "2020-05-18T06:26:01Z", "message": "HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes."}, "afterCommit": {"oid": "397300ee2e91ff020bb908258f1cd52f84943c76", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/397300ee2e91ff020bb908258f1cd52f84943c76", "committedDate": "2020-05-19T04:45:06Z", "message": "HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMDMxOTkx", "url": "https://github.com/apache/hadoop/pull/2026#pullrequestreview-420031991", "createdAt": "2020-05-28T11:53:23Z", "commit": {"oid": "397300ee2e91ff020bb908258f1cd52f84943c76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMTo1MzoyM1rOGbxr5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMTo1MzoyM1rOGbxr5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc3ODc4OA==", "bodyText": "Should we mark ProtobufRpcEngine class as deprecated?", "url": "https://github.com/apache/hadoop/pull/2026#discussion_r431778788", "createdAt": "2020-05-28T11:53:23Z", "author": {"login": "aajisaka"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/ProtobufRpcEngine.java", "diffHunk": "@@ -433,7 +438,15 @@ public Server(Class<?> protocolClass, Object protocolImpl,\n       registerProtocolAndImpl(RPC.RpcKind.RPC_PROTOCOL_BUFFER, protocolClass,\n           protocolImpl);\n     }\n-    \n+\n+    @Override\n+    protected RpcInvoker getServerRpcInvoker(RpcKind rpcKind) {\n+      if (rpcKind == RpcKind.RPC_PROTOCOL_BUFFER) {\n+        return RPC_INVOKER;\n+      }\n+      return super.getServerRpcInvoker(rpcKind);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "397300ee2e91ff020bb908258f1cd52f84943c76"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMDMyNTQ2", "url": "https://github.com/apache/hadoop/pull/2026#pullrequestreview-420032546", "createdAt": "2020-05-28T11:54:15Z", "commit": {"oid": "397300ee2e91ff020bb908258f1cd52f84943c76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMTo1NDoxNVrOGbxthg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMTo1NDoxNVrOGbxthg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc3OTIwNg==", "bodyText": "Should we mark this class as deprecated?", "url": "https://github.com/apache/hadoop/pull/2026#discussion_r431779206", "createdAt": "2020-05-28T11:54:15Z", "author": {"login": "aajisaka"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/ProtobufRpcEngineCallback.java", "diffHunk": "@@ -18,7 +18,7 @@\n \n package org.apache.hadoop.ipc;\n \n-import org.apache.hadoop.thirdparty.protobuf.Message;\n+import com.google.protobuf.Message;\n \n public interface ProtobufRpcEngineCallback {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "397300ee2e91ff020bb908258f1cd52f84943c76"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMDM5MDcw", "url": "https://github.com/apache/hadoop/pull/2026#pullrequestreview-420039070", "createdAt": "2020-05-28T12:03:44Z", "commit": {"oid": "397300ee2e91ff020bb908258f1cd52f84943c76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMjowMzo0NVrOGbyAaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxMjowMzo0NVrOGbyAaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc4NDA0Mw==", "bodyText": "Memo: The method is used from ozone.\n\u279c  hadoop-ozone git:(master) find . -name \"*.java\" | xargs grep \"addPBProtocol\"\n./hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/server/StorageContainerManager.java:    DFSUtil.addPBProtocol(conf, protocol, instance, rpcServer);\n./hadoop-hdds/container-service/src/test/java/org/apache/hadoop/ozone/container/common/SCMTestUtils.java:    DFSUtil.addPBProtocol(conf, protocol, instance, rpcServer);\n./hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/OzoneManager.java:    DFSUtil.addPBProtocol(conf, protocol, instance, rpcServer);", "url": "https://github.com/apache/hadoop/pull/2026#discussion_r431784043", "createdAt": "2020-05-28T12:03:45Z", "author": {"login": "aajisaka"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSUtil.java", "diffHunk": "@@ -1295,6 +1296,22 @@ static URI trimUri(URI uri) {\n    */\n   public static void addPBProtocol(Configuration conf, Class<?> protocol,\n       BlockingService service, RPC.Server server) throws IOException {\n+    RPC.setProtocolEngine(conf, protocol, ProtobufRpcEngine2.class);\n+    server.addProtocol(RPC.RpcKind.RPC_PROTOCOL_BUFFER, protocol, service);\n+  }\n+\n+  /**\n+   * Add protobuf based protocol to the {@link org.apache.hadoop.ipc.RPC.Server}\n+   * @param conf configuration\n+   * @param protocol Protocol interface\n+   * @param service service that implements the protocol\n+   * @param server RPC server to which the protocol &amp; implementation is\n+   *               added to\n+   * @throws IOException\n+   */\n+  @Deprecated\n+  public static void addPBProtocol(Configuration conf, Class<?> protocol,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "397300ee2e91ff020bb908258f1cd52f84943c76"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "397300ee2e91ff020bb908258f1cd52f84943c76", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/397300ee2e91ff020bb908258f1cd52f84943c76", "committedDate": "2020-05-19T04:45:06Z", "message": "HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes."}, "afterCommit": {"oid": "23384ecdae47195b58f2b15523ef72b323bb63ee", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/23384ecdae47195b58f2b15523ef72b323bb63ee", "committedDate": "2020-06-03T08:50:14Z", "message": "HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MzA2MjIz", "url": "https://github.com/apache/hadoop/pull/2026#pullrequestreview-424306223", "createdAt": "2020-06-04T10:24:00Z", "commit": {"oid": "23384ecdae47195b58f2b15523ef72b323bb63ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMDoyNDowMFrOGe_eBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMDoyNDowMFrOGe_eBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE1MDM0MQ==", "bodyText": "The profile is not activated on Mac and compile fails.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      <family>linux</family>\n          \n          \n            \n                      <arch>amd64</arch>\n          \n          \n            \n                      <arch>!aarch64</arch>", "url": "https://github.com/apache/hadoop/pull/2026#discussion_r435150341", "createdAt": "2020-06-04T10:24:00Z", "author": {"login": "aajisaka"}, "path": "hadoop-common-project/hadoop-common/pom.xml", "diffHunk": "@@ -1015,7 +1031,81 @@\n         </plugins>\n       </build>\n     </profile>\n-\n+    <!-- profile to use already generated protobuf code using 2.5.0 for aarch64-->\n+    <profile>\n+      <id>aarch64</id>\n+      <activation>\n+        <activeByDefault>false</activeByDefault>\n+        <os>\n+          <family>linux</family>\n+          <arch>aarch64</arch>\n+        </os>\n+      </activation>\n+      <build>\n+        <plugins>\n+          <plugin>\n+            <groupId>org.codehaus.mojo</groupId>\n+            <artifactId>build-helper-maven-plugin</artifactId>\n+            <executions>\n+              <execution>\n+                <id>add-source-legacy-protobuf</id>\n+                <phase>generate-sources</phase>\n+                <goals>\n+                  <goal>add-source</goal>\n+                </goals>\n+                <configuration>\n+                  <sources>\n+                    <source>${basedir}/src/main/arm-java</source>\n+                  </sources>\n+                </configuration>\n+              </execution>\n+            </executions>\n+          </plugin>\n+        </plugins>\n+      </build>\n+    </profile>\n+    <!-- profile to generate protobuf code using 2.5.0-->\n+    <profile>\n+      <id>x86_64</id>\n+      <activation>\n+        <activeByDefault>false</activeByDefault>\n+        <os>\n+          <family>linux</family>\n+          <arch>amd64</arch>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23384ecdae47195b58f2b15523ef72b323bb63ee"}, "originalPosition": 84}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MzA2NTQy", "url": "https://github.com/apache/hadoop/pull/2026#pullrequestreview-424306542", "createdAt": "2020-06-04T10:24:28Z", "commit": {"oid": "23384ecdae47195b58f2b15523ef72b323bb63ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMDoyNDoyOFrOGe_e-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMDoyNDoyOFrOGe_e-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE1MDU4Nw==", "bodyText": "<family>linux</family> can be removed.", "url": "https://github.com/apache/hadoop/pull/2026#discussion_r435150587", "createdAt": "2020-06-04T10:24:28Z", "author": {"login": "aajisaka"}, "path": "hadoop-common-project/hadoop-common/pom.xml", "diffHunk": "@@ -1015,7 +1031,81 @@\n         </plugins>\n       </build>\n     </profile>\n-\n+    <!-- profile to use already generated protobuf code using 2.5.0 for aarch64-->\n+    <profile>\n+      <id>aarch64</id>\n+      <activation>\n+        <activeByDefault>false</activeByDefault>\n+        <os>\n+          <family>linux</family>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23384ecdae47195b58f2b15523ef72b323bb63ee"}, "originalPosition": 50}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23384ecdae47195b58f2b15523ef72b323bb63ee", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/23384ecdae47195b58f2b15523ef72b323bb63ee", "committedDate": "2020-06-03T08:50:14Z", "message": "HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes."}, "afterCommit": {"oid": "75f47ac94e161ac491579e104be3850fc4e3c428", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/75f47ac94e161ac491579e104be3850fc4e3c428", "committedDate": "2020-06-08T04:25:44Z", "message": "HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2OTIyMzEw", "url": "https://github.com/apache/hadoop/pull/2026#pullrequestreview-426922310", "createdAt": "2020-06-09T08:50:29Z", "commit": {"oid": "75f47ac94e161ac491579e104be3850fc4e3c428"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwODo1MDoyOVrOGg_KFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwODo1MDoyOVrOGg_KFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI0MjM4OA==", "bodyText": "Big +1 for this change, but I think this issue can be fixed in a separate jira.", "url": "https://github.com/apache/hadoop/pull/2026#discussion_r437242388", "createdAt": "2020-06-09T08:50:29Z", "author": {"login": "aajisaka"}, "path": "hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapred/pipes/TestPipeApplication.java", "diffHunk": "@@ -74,6 +75,11 @@\n \n   private static String taskName = \"attempt_001_02_r03_04_05\";\n \n+  @After\n+  public void after() throws Exception {\n+    cleanTokenPasswordFile();\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75f47ac94e161ac491579e104be3850fc4e3c428"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75f47ac94e161ac491579e104be3850fc4e3c428", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/75f47ac94e161ac491579e104be3850fc4e3c428", "committedDate": "2020-06-08T04:25:44Z", "message": "HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes."}, "afterCommit": {"oid": "56247db3022705635580c4d2f8b0abde109f954f", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/56247db3022705635580c4d2f8b0abde109f954f", "committedDate": "2020-06-09T18:43:16Z", "message": "YARN-10300: appMasterHost not set in RM ApplicationSummary when AM fails before first heartbeat. Contributed by Eric Badger (ebadger)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDA5NzQy", "url": "https://github.com/apache/hadoop/pull/2026#pullrequestreview-428409742", "createdAt": "2020-06-10T20:38:09Z", "commit": {"oid": "f4f0051b266a050b0ff086d3bdfd7b6bb89513af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NTAxOTE3", "url": "https://github.com/apache/hadoop/pull/2026#pullrequestreview-429501917", "createdAt": "2020-06-12T06:52:34Z", "commit": {"oid": "f4f0051b266a050b0ff086d3bdfd7b6bb89513af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ff3758828770b9c82237d7f5e5480381c872abf", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/8ff3758828770b9c82237d7f5e5480381c872abf", "committedDate": "2020-06-12T17:44:53Z", "message": "HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes (#2026)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4f0051b266a050b0ff086d3bdfd7b6bb89513af", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/f4f0051b266a050b0ff086d3bdfd7b6bb89513af", "committedDate": "2020-06-10T04:41:26Z", "message": "HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes"}, "afterCommit": {"oid": "8ff3758828770b9c82237d7f5e5480381c872abf", "author": {"user": {"login": "vinayakumarb", "name": "Vinayakumar B"}}, "url": "https://github.com/apache/hadoop/commit/8ff3758828770b9c82237d7f5e5480381c872abf", "committedDate": "2020-06-12T17:44:53Z", "message": "HADOOP-17046. Support downstreams' existing Hadoop-rpc implementations using non-shaded protobuf classes (#2026)"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4324, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}