{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMDE0NjE3", "number": 2332, "title": "HDFS-15594. Lazy calculate live datanodes in safe mode tip", "bodyText": "https://issues.apache.org/jira/browse/HDFS-15594\nNOTICE\nPlease create an issue in ASF JIRA before opening a pull request,\nand you need to set the title of the pull request which starts with\nthe corresponding JIRA issue number. (e.g. HADOOP-XXXXX. Fix a typo in YYY.)\nFor more details, please see https://cwiki.apache.org/confluence/display/HADOOP/How+To+Contribute", "createdAt": "2020-09-23T20:12:04Z", "url": "https://github.com/apache/hadoop/pull/2332", "merged": true, "mergeCommit": {"oid": "00c4de63cf5cacec3463eafe5c8d654318461ca2"}, "closed": true, "closedAt": "2020-09-25T16:47:55Z", "author": {"login": "NickyYe"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLyWDygH2gAyNDkyMDE0NjE3OmE2MzQxNDNkYjE4NGNlNWE4YTBkMjEyMTZkMjdkOGMxZmM0MTI4NGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMM1JJAFqTQ5NjA3OTgwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a634143db184ce5a8a0d21216d27d8c1fc41284f", "author": {"user": {"login": "NickyYe", "name": "Ye Ni"}}, "url": "https://github.com/apache/hadoop/commit/a634143db184ce5a8a0d21216d27d8c1fc41284f", "committedDate": "2020-09-23T20:09:45Z", "message": "Update BlockManagerSafeMode.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08f505eb5c0fe38cc9f4efc5951485224082e2de", "author": {"user": {"login": "NickyYe", "name": "Ye Ni"}}, "url": "https://github.com/apache/hadoop/commit/08f505eb5c0fe38cc9f4efc5951485224082e2de", "committedDate": "2020-09-23T20:11:09Z", "message": "Update TestBlockManagerSafeMode.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "299299aae47049a421970841ff92e2a6ae4a7bd3", "author": {"user": {"login": "NickyYe", "name": "Ye Ni"}}, "url": "https://github.com/apache/hadoop/commit/299299aae47049a421970841ff92e2a6ae4a7bd3", "committedDate": "2020-09-23T21:41:05Z", "message": "Update BlockManagerSafeMode.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "010ad6f6b023d0e6a312cf94b9021992a43d5c4e", "author": {"user": {"login": "NickyYe", "name": "Ye Ni"}}, "url": "https://github.com/apache/hadoop/commit/010ad6f6b023d0e6a312cf94b9021992a43d5c4e", "committedDate": "2020-09-23T21:41:48Z", "message": "Update TestBlockManagerSafeMode.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MjE3MzMz", "url": "https://github.com/apache/hadoop/pull/2332#pullrequestreview-495217333", "createdAt": "2020-09-24T04:50:34Z", "commit": {"oid": "010ad6f6b023d0e6a312cf94b9021992a43d5c4e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NzU3OTc4", "url": "https://github.com/apache/hadoop/pull/2332#pullrequestreview-495757978", "createdAt": "2020-09-24T16:39:49Z", "commit": {"oid": "010ad6f6b023d0e6a312cf94b9021992a43d5c4e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NzYwMTU5", "url": "https://github.com/apache/hadoop/pull/2332#pullrequestreview-495760159", "createdAt": "2020-09-24T16:42:39Z", "commit": {"oid": "010ad6f6b023d0e6a312cf94b9021992a43d5c4e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNjo0MjozOVrOHXjkmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNjo0MjozOVrOHXjkmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ2MjEwNA==", "bodyText": "As we are at it, does it make sense to use StringBuilder?", "url": "https://github.com/apache/hadoop/pull/2332#discussion_r494462104", "createdAt": "2020-09-24T16:42:39Z", "author": {"login": "goiri"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/blockmanagement/BlockManagerSafeMode.java", "diffHunk": "@@ -309,16 +311,21 @@ String getSafeModeTip() {\n     }\n \n     if (datanodeThreshold > 0) {\n-      int numLive = blockManager.getDatanodeManager().getNumLiveDataNodes();\n-      if (numLive < datanodeThreshold) {\n-        msg += String.format(\n-            \"The number of live datanodes %d needs an additional %d live \"\n-                + \"datanodes to reach the minimum number %d.%n\",\n-            numLive, (datanodeThreshold - numLive), datanodeThreshold);\n+      if (isBlockThresholdMet) {\n+        int numLive = blockManager.getDatanodeManager().getNumLiveDataNodes();\n+        if (numLive < datanodeThreshold) {\n+          msg += String.format(\n+              \"The number of live datanodes %d needs an additional %d live \"\n+                  + \"datanodes to reach the minimum number %d.%n\",\n+              numLive, (datanodeThreshold - numLive), datanodeThreshold);\n+        } else {\n+          msg += String.format(\"The number of live datanodes %d has reached \"\n+                  + \"the minimum number %d. \",\n+              numLive, datanodeThreshold);\n+        }\n       } else {\n-        msg += String.format(\"The number of live datanodes %d has reached \"\n-                + \"the minimum number %d. \",\n-            numLive, datanodeThreshold);\n+        msg += \"The number of live datanodes is not calculated \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "010ad6f6b023d0e6a312cf94b9021992a43d5c4e"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68219d8c6678b230cde4b711690205e39d8ea132", "author": {"user": {"login": "NickyYe", "name": "Ye Ni"}}, "url": "https://github.com/apache/hadoop/commit/68219d8c6678b230cde4b711690205e39d8ea132", "committedDate": "2020-09-24T21:35:32Z", "message": "Update BlockManagerSafeMode.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MDc5ODA2", "url": "https://github.com/apache/hadoop/pull/2332#pullrequestreview-496079806", "createdAt": "2020-09-25T03:01:14Z", "commit": {"oid": "68219d8c6678b230cde4b711690205e39d8ea132"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3698, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}