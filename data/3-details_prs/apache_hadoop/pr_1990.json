{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExNDUzODMw", "number": 1990, "title": "HADOOP-17018. Intermittent failing of ITestAbfsStreamStatistics in ABFS", "bodyText": "In some cases, ABFS-prefetch thread runs in the background which returns some bytes from the buffer and gives an extra readOp. Thus, making readOps values arbitrary and giving intermittent failures in some cases. Hence, readOps values of 2 or 3 are seen in different setups.\ntest runs:\n\nmvn -T 1C -Dparallel-tests=abfs clean verify\nmvn -T 1C -Dparallel-tests=abfs clean verify -Dtest=none -Dit.test=ITestAbfsStreamStatistics\n\nRegion: East US, West US\n[INFO] -------------------------------------------------------\n[INFO]  T E S T S\n[INFO] -------------------------------------------------------\n[INFO] Running org.apache.hadoop.fs.azurebfs.ITestAbfsStreamStatistics\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 165.964 s - in org.apache.hadoop.fs.azurebfs.ITestAbfsStreamStatistics\n[INFO]\n[INFO] Results:\n[INFO]\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0\n[INFO]\n[INFO]\n[INFO] --- maven-failsafe-plugin:3.0.0-M1:integration-test (integration-test-abfs-parallel-classes) @ hadoop-azure ---\n[INFO]\n[INFO] -------------------------------------------------------\n[INFO]  T E S T S\n[INFO] -------------------------------------------------------\n[INFO] Running org.apache.hadoop.fs.azurebfs.ITestAbfsStreamStatistics\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 256.797 s - in org.apache.hadoop.fs.azurebfs.ITestAbfsStreamStatistics\n[INFO]\n[INFO] Results:\n[INFO]\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0\n[INFO]\n[INFO]\n[INFO] --- maven-enforcer-plugin:3.0.0-M1:enforce (depcheck) @ hadoop-azure ---\n[INFO]\n[INFO] --- maven-failsafe-plugin:3.0.0-M1:verify (integration-test-abfs-parallel-classesAndMethods) @ hadoop-azure ---\n[INFO]\n[INFO] --- maven-failsafe-plugin:3.0.0-M1:verify (integration-test-abfs-parallel-classes) @ hadoop-azure ---\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time:  07:14 min (Wall Clock)\n[INFO] Finished at: 2020-04-30T18:01:26+05:30", "createdAt": "2020-04-30T12:52:57Z", "url": "https://github.com/apache/hadoop/pull/1990", "merged": true, "mergeCommit": {"oid": "192cad9ee24779cbd7735fdf9da0fba90255d546"}, "closed": true, "closedAt": "2020-05-07T11:15:29Z", "author": {"login": "mehakmeet"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccsbcxAH2gAyNDExNDUzODMwOmUyZTI5YmU5NzM2MzM0MzVhZWExYWVmMGQ4NDc4NDgyZWY0YTQ5Yjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABce6rh5gH2gAyNDExNDUzODMwOjE5YTMxNGFhOWRlMDEzZjBkYWNiNTg3NDFkY2Q3Nzg4ZWRjN2U2YTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e2e29be973633435aea1aef0d8478482ef4a49b9", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/e2e29be973633435aea1aef0d8478482ef4a49b9", "committedDate": "2020-04-30T12:41:46Z", "message": "HADOOP-17018. Intermittent failing of ITestAbfsStreamStatistics in ABFS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NDcwNjc4", "url": "https://github.com/apache/hadoop/pull/1990#pullrequestreview-406470678", "createdAt": "2020-05-06T10:06:50Z", "commit": {"oid": "e2e29be973633435aea1aef0d8478482ef4a49b9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMDowNjo1MVrOGRML5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMDowNjo1MVrOGRML5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY3ODYzMQ==", "bodyText": "Error text needs to include actual values", "url": "https://github.com/apache/hadoop/pull/1990#discussion_r420678631", "createdAt": "2020-05-06T10:06:51Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAbfsStreamStatistics.java", "diffHunk": "@@ -84,12 +84,20 @@ public void testAbfsStreamOps() throws Exception {\n \n       LOG.info(\"Result of Read operation : {}\", result);\n       /*\n-      Testing if 2 read_ops value is coming after reading full content from a\n-      file (3 if anything to read from Buffer too).\n-      Reason: read() call gives read_ops=1,\n-      reading from AbfsClient(http GET) gives read_ops=2.\n+       * Testing if 2 read_ops value is coming after reading full content\n+       * from a file (3 if anything to read from Buffer too). Reason: read()\n+       * call gives read_ops=1, reading from AbfsClient(http GET) gives\n+       * read_ops=2.\n+       *\n+       * In some cases ABFS-prefetch thread runs in the background which\n+       * returns some bytes from buffer and gives an extra readOp.\n+       * Thus, making readOps values arbitrary and giving intermittent\n+       * failures in some cases. Hence, readOps values of 2 or 3 is seen in\n+       * different setups.\n+       *\n        */\n-      assertReadWriteOps(\"read\", 2, statistics.getReadOps());\n+      assertTrue(\"Mismatch in read operations\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2e29be973633435aea1aef0d8478482ef4a49b9"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19a314aa9de013f0dacb58741dcd7788edc7e6a6", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/19a314aa9de013f0dacb58741dcd7788edc7e6a6", "committedDate": "2020-05-07T10:25:51Z", "message": "HADOOP-17018. Actual value in error message"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4257, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}