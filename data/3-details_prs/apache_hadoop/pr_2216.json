{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MDc5NzM4", "number": 2216, "title": "HADOOP-17194. Adding Context class for AbfsClient in ABFS", "bodyText": "Tested on: mvn -T 1C -Dparallel-tests=abfs clean verify\nRegion: East US\n[INFO] Results:\n[INFO]\n[INFO] Tests run: 87, Failures: 0, Errors: 0, Skipped: 0\n\n[INFO] Results:\n[INFO]\n[ERROR] Errors:\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[ERROR]   ITestAzureBlobFileSystemCheckAccess.<init>:82->setTestUserFs:104 \u00bb IllegalArgument\n[INFO]\n[ERROR] Tests run: 451, Failures: 0, Errors: 12, Skipped: 61\n\n[INFO] Results:\n[INFO]\n[WARNING] Tests run: 206, Failures: 0, Errors: 0, Skipped: 29\n\nThe errors are being discussed in HADOOP-17203(https://issues.apache.org/jira/browse/HADOOP-17203).", "createdAt": "2020-08-11T12:42:10Z", "url": "https://github.com/apache/hadoop/pull/2216", "merged": true, "mergeCommit": {"oid": "d1c60a53f60a77c9004332d270955c41f85fe792"}, "closed": true, "closedAt": "2020-08-27T10:27:01Z", "author": {"login": "mehakmeet"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc92GZBgH2gAyNDY2MDc5NzM4OjRiYWZiNmFmNTkzNjgzNDc2YmJmZGZkYWJmNTAzY2FhNWQzNTgzOGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC2ZWngH2gAyNDY2MDc5NzM4OjA3YmYwOTJhMDcyYmRiOGMzMjcxNzNkNTRiOTgzNzI3YWRiYTM2MWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4bafb6af593683476bbfdfdabf503caa5d35838e", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/4bafb6af593683476bbfdfdabf503caa5d35838e", "committedDate": "2020-08-11T12:37:19Z", "message": "HADOOP-17194. Adding Context class for AbfsClient to pass AbfsConfigurations to limit number of parameters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyOTE5MzQ1", "url": "https://github.com/apache/hadoop/pull/2216#pullrequestreview-472919345", "createdAt": "2020-08-22T11:11:43Z", "commit": {"oid": "4bafb6af593683476bbfdfdabf503caa5d35838e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxMToxMTo0M1rOHFEkHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxMToxNzowN1rOHFElsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA3OTcxMQ==", "bodyText": "Mixiing the builder with the implementation is a bit, well, cheating, isn't it? More importantly -it stops the context being immutable. Could you split into a builder and acutal context?", "url": "https://github.com/apache/hadoop/pull/2216#discussion_r475079711", "createdAt": "2020-08-22T11:11:43Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsClientContext.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.fs.azurebfs.services;\n+\n+/**\n+ * Class to hold extra configurations for AbfsClient and further classes\n+ * inside AbfsClient.\n+ */\n+public class AbfsClientContext {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bafb6af593683476bbfdfdabf503caa5d35838e"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA3OTc4Mw==", "bodyText": "this (once moved to the separate builder) could be a place to validate things for not being null", "url": "https://github.com/apache/hadoop/pull/2216#discussion_r475079783", "createdAt": "2020-08-22T11:12:43Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsClientContext.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.fs.azurebfs.services;\n+\n+/**\n+ * Class to hold extra configurations for AbfsClient and further classes\n+ * inside AbfsClient.\n+ */\n+public class AbfsClientContext {\n+\n+  private ExponentialRetryPolicy exponentialRetryPolicy;\n+  private AbfsPerfTracker abfsPerfTracker;\n+  private AbfsCounters abfsCounters;\n+\n+  public AbfsClientContext withExponentialRetryPolicy(\n+      final ExponentialRetryPolicy exponentialRetryPolicy) {\n+    this.exponentialRetryPolicy = exponentialRetryPolicy;\n+    return this;\n+  }\n+\n+  public AbfsClientContext withAbfsPerfTracker(\n+      final AbfsPerfTracker abfsPerfTracker) {\n+    this.abfsPerfTracker = abfsPerfTracker;\n+    return this;\n+  }\n+\n+  public AbfsClientContext withAbfsCounters(final AbfsCounters abfsCounters) {\n+    this.abfsCounters = abfsCounters;\n+    return this;\n+  }\n+\n+  /**\n+   * Build the context and get the instance with the properties selected.\n+   *\n+   * @return an instance of AbfsClientContext.\n+   */\n+  public AbfsClientContext build() {\n+    return this;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bafb6af593683476bbfdfdabf503caa5d35838e"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA3OTk4NA==", "bodyText": "I was going to suggest making this a generai RetryPolicy rather than the explicit exponential one -but I see this isn't the normal hadoop-common retry policy, just one unique to abfs. So moot. If we find that retry policy is too inflexible, then it would be time to revisit that decision.", "url": "https://github.com/apache/hadoop/pull/2216#discussion_r475079984", "createdAt": "2020-08-22T11:15:16Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsClientContext.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.fs.azurebfs.services;\n+\n+/**\n+ * Class to hold extra configurations for AbfsClient and further classes\n+ * inside AbfsClient.\n+ */\n+public class AbfsClientContext {\n+\n+  private ExponentialRetryPolicy exponentialRetryPolicy;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bafb6af593683476bbfdfdabf503caa5d35838e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA4MDExMg==", "bodyText": "let's add some javadocs. In particularly highlighting this is is a one-off operation", "url": "https://github.com/apache/hadoop/pull/2216#discussion_r475080112", "createdAt": "2020-08-22T11:17:07Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java", "diffHunk": "@@ -1214,7 +1217,7 @@ public boolean isAtomicRenameKey(String key) {\n   }\n \n   private void initializeClient(URI uri, String fileSystemName,\n-      String accountName, boolean isSecure, AbfsCounters abfsCounters)\n+      String accountName, boolean isSecure)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bafb6af593683476bbfdfdabf503caa5d35838e"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13f9ceebb40c63fb98fd988a9c3263bdc45b0863", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/13f9ceebb40c63fb98fd988a9c3263bdc45b0863", "committedDate": "2020-08-24T12:01:42Z", "message": "HADOOP-17194. Splitting the builder and context class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NjU0MzYx", "url": "https://github.com/apache/hadoop/pull/2216#pullrequestreview-475654361", "createdAt": "2020-08-26T16:22:46Z", "commit": {"oid": "13f9ceebb40c63fb98fd988a9c3263bdc45b0863"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjoyMjo0N1rOHHT36A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjoyMzo1MVrOHHT6qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQyNzY4OA==", "bodyText": "you can make this package private now, as nobody should be creating directly", "url": "https://github.com/apache/hadoop/pull/2216#discussion_r477427688", "createdAt": "2020-08-26T16:22:47Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsClientContext.java", "diffHunk": "@@ -24,34 +24,17 @@\n  */\n public class AbfsClientContext {\n \n-  private ExponentialRetryPolicy exponentialRetryPolicy;\n-  private AbfsPerfTracker abfsPerfTracker;\n-  private AbfsCounters abfsCounters;\n-\n-  public AbfsClientContext withExponentialRetryPolicy(\n-      final ExponentialRetryPolicy exponentialRetryPolicy) {\n+  private final ExponentialRetryPolicy exponentialRetryPolicy;\n+  private final AbfsPerfTracker abfsPerfTracker;\n+  private final AbfsCounters abfsCounters;\n+\n+  public AbfsClientContext(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13f9ceebb40c63fb98fd988a9c3263bdc45b0863"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQyODM5NQ==", "bodyText": "ok, don't worry about validation. What you have done is great -all that is left is to make the AbfsClientContext package private so forcing everything to go through the builder", "url": "https://github.com/apache/hadoop/pull/2216#discussion_r477428395", "createdAt": "2020-08-26T16:23:51Z", "author": {"login": "steveloughran"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsClientContext.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.fs.azurebfs.services;\n+\n+/**\n+ * Class to hold extra configurations for AbfsClient and further classes\n+ * inside AbfsClient.\n+ */\n+public class AbfsClientContext {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA3OTcxMQ=="}, "originalCommit": {"oid": "4bafb6af593683476bbfdfdabf503caa5d35838e"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07bf092a072bdb8c327173d54b983727adba361e", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/07bf092a072bdb8c327173d54b983727adba361e", "committedDate": "2020-08-27T01:47:39Z", "message": "HADOOP-17194. making AbfsClientContext constructor package private"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3888, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}