{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MDQ0NTc5", "number": 2265, "title": "HDFS-15551. Tiny Improve for DeadNode detector", "bodyText": "JIRA URL\n\nadd or improve some logs for adding local & global deadnodes\nlogic improve\nfix typo", "createdAt": "2020-09-01T12:25:36Z", "url": "https://github.com/apache/hadoop/pull/2265", "merged": true, "mergeCommit": {"oid": "89428f142fe7cee17bd1a0f5f207b6952ec79d32"}, "closed": true, "closedAt": "2020-09-11T07:44:04Z", "author": {"login": "imbajin"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEj70igH2gAyNDc3MDQ0NTc5OmVjMTMwZTlhZTA5NzUwMTAwNDk2OTU4OTJhZGRhZTAyZjI2YjM2ZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHEIL6AFqTQ4NDY0NTQxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec130e9ae0975010049695892addae02f26b36f0", "author": {"user": {"login": "imbajin", "name": null}}, "url": "https://github.com/apache/hadoop/commit/ec130e9ae0975010049695892addae02f26b36f0", "committedDate": "2020-09-01T09:24:57Z", "message": "DeadNode detector's tiny improve\n\n1. add or improve some logs for adding local & global deadnodes\n2. logic improve\n3. fix typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5ODY2NDY1", "url": "https://github.com/apache/hadoop/pull/2265#pullrequestreview-479866465", "createdAt": "2020-09-01T15:32:18Z", "commit": {"oid": "ec130e9ae0975010049695892addae02f26b36f0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNTozMjoxOVrOHK8MuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNTozMjoxOVrOHK8MuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIzNDEwNA==", "bodyText": "1\u3001Is it necessary to add log in Local dead nodes?\n2\u3001if add debug log in DFSInputStream#addToLocalDeadNodes, do you need add log in DFSInputStream#removeFromLocalDeadNodes?", "url": "https://github.com/apache/hadoop/pull/2265#discussion_r481234104", "createdAt": "2020-09-01T15:32:19Z", "author": {"login": "leosunli"}, "path": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DFSInputStream.java", "diffHunk": "@@ -181,6 +181,8 @@ private boolean isPeriodicRefreshEnabled() {\n   private byte[] oneByteBuf; // used for 'int read()'\n \n   protected void addToLocalDeadNodes(DatanodeInfo dnInfo) {\n+    DFSClient.LOG.debug(\"Add {} to local dead nodes, previously was {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec130e9ae0975010049695892addae02f26b36f0"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMzUzODcx", "url": "https://github.com/apache/hadoop/pull/2265#pullrequestreview-482353871", "createdAt": "2020-09-04T04:43:10Z", "commit": {"oid": "ec130e9ae0975010049695892addae02f26b36f0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNDo0MzoxMFrOHM_V3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNDo0ODo0NlrOHM_a7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM4Mjc1MQ==", "bodyText": "One case: when a lot of stale relicas, will the log flood?", "url": "https://github.com/apache/hadoop/pull/2265#discussion_r483382751", "createdAt": "2020-09-04T04:43:10Z", "author": {"login": "leosunli"}, "path": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DeadNodeDetector.java", "diffHunk": "@@ -475,6 +475,7 @@ public synchronized void addNodeToDetect(DFSInputStream dfsInputStream,\n       datanodeInfos.add(datanodeInfo);\n     }\n \n+    LOG.warn(\"Add datanode {} to suspectAndDeadNodes\", datanodeInfo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec130e9ae0975010049695892addae02f26b36f0"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzM4NDA0Nw==", "bodyText": "when a lot of stale relicas,  it should have many supsect nodes  but not dead nodes.\nThese nodes all will print this log.\nWhat is the purpose of printing this log?\nThe client can access normally the suspect node.", "url": "https://github.com/apache/hadoop/pull/2265#discussion_r483384047", "createdAt": "2020-09-04T04:48:46Z", "author": {"login": "leosunli"}, "path": "hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DeadNodeDetector.java", "diffHunk": "@@ -396,13 +395,13 @@ private void probeCallBack(Probe probe, boolean success) {\n             probe.getDatanodeInfo());\n         removeDeadNode(probe.getDatanodeInfo());\n       } else if (probe.getType() == ProbeType.CHECK_SUSPECT) {\n-        LOG.debug(\"Remove the node out from suspect node list: {}.\",\n+        LOG.info(\"Remove the node out from suspect node list: {}.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec130e9ae0975010049695892addae02f26b36f0"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d3aa75b7b7856b43f76f81d04d8cb09b83ce1f5", "author": {"user": {"login": "imbajin", "name": null}}, "url": "https://github.com/apache/hadoop/commit/1d3aa75b7b7856b43f76f81d04d8cb09b83ce1f5", "committedDate": "2020-09-04T10:25:32Z", "message": "adjust LOG level"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NjQ1NDE4", "url": "https://github.com/apache/hadoop/pull/2265#pullrequestreview-484645418", "createdAt": "2020-09-09T04:03:16Z", "commit": {"oid": "1d3aa75b7b7856b43f76f81d04d8cb09b83ce1f5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3583, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}