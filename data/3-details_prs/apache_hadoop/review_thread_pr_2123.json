{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NzE4Mzg2", "number": 2123, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMTozMToxNlrOENxywA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxOTo0MjoyN1rOEPRynQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyODgyNzUyOnYy", "diffSide": "RIGHT", "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/AzureADAuthenticator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMTozMToxNlrOGwkmww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNjowNjoxNlrOGxapWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU4NDU3OQ==", "bodyText": "Indentation.", "url": "https://github.com/apache/hadoop/pull/2123#discussion_r453584579", "createdAt": "2020-07-13T11:31:16Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/AzureADAuthenticator.java", "diffHunk": "@@ -77,11 +77,14 @@ private AzureADAuthenticator() {\n    * @param clientId     the client ID (GUID) of the client web app\n    *                     btained from Azure Active Directory configuration\n    * @param clientSecret the secret key of the client web app\n+   * @param tokenFetchRetryPolicy retry policy to be used for token fetch AAD\n+   *                             calls.\n    * @return {@link AzureADToken} obtained using the creds\n    * @throws IOException throws IOException if there is a failure in connecting to Azure AD\n    */\n   public static AzureADToken getTokenUsingClientCreds(String authEndpoint,\n-                                                      String clientId, String clientSecret)\n+                                                      String clientId,\n+      String clientSecret, ExponentialRetryPolicy tokenFetchRetryPolicy)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62d1f90399a7e1aae11db2a743697c3b317e4a1c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ2OTk3OQ==", "bodyText": "Done", "url": "https://github.com/apache/hadoop/pull/2123#discussion_r454469979", "createdAt": "2020-07-14T16:06:16Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/AzureADAuthenticator.java", "diffHunk": "@@ -77,11 +77,14 @@ private AzureADAuthenticator() {\n    * @param clientId     the client ID (GUID) of the client web app\n    *                     btained from Azure Active Directory configuration\n    * @param clientSecret the secret key of the client web app\n+   * @param tokenFetchRetryPolicy retry policy to be used for token fetch AAD\n+   *                             calls.\n    * @return {@link AzureADToken} obtained using the creds\n    * @throws IOException throws IOException if there is a failure in connecting to Azure AD\n    */\n   public static AzureADToken getTokenUsingClientCreds(String authEndpoint,\n-                                                      String clientId, String clientSecret)\n+                                                      String clientId,\n+      String clientSecret, ExponentialRetryPolicy tokenFetchRetryPolicy)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU4NDU3OQ=="}, "originalCommit": {"oid": "62d1f90399a7e1aae11db2a743697c3b317e4a1c"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyODgzMTkzOnYy", "diffSide": "RIGHT", "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/AzureADAuthenticator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMTozMjozN1rOGwkpcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNjowNjoyM1rOGxapmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU4NTI2NQ==", "bodyText": "Make this a trace level log.", "url": "https://github.com/apache/hadoop/pull/2123#discussion_r453585265", "createdAt": "2020-07-13T11:32:37Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/AzureADAuthenticator.java", "diffHunk": "@@ -275,21 +287,24 @@ public UnexpectedResponseException(final int httpErrorCode,\n   }\n \n   private static AzureADToken getTokenCall(String authEndpoint, String body,\n-      Hashtable<String, String> headers, String httpMethod) throws IOException {\n-    return getTokenCall(authEndpoint, body, headers, httpMethod, false);\n+      Hashtable<String, String> headers, String httpMethod,\n+      ExponentialRetryPolicy tokenFetchRetryPolicy) throws IOException {\n+    return getTokenCall(authEndpoint, body, headers, httpMethod, false,\n+        tokenFetchRetryPolicy);\n   }\n \n   private static AzureADToken getTokenCall(String authEndpoint, String body,\n-      Hashtable<String, String> headers, String httpMethod, boolean isMsi)\n+      Hashtable<String, String> headers, String httpMethod, boolean isMsi,\n+      ExponentialRetryPolicy tokenFetchRetryPolicy)\n       throws IOException {\n     AzureADToken token = null;\n-    ExponentialRetryPolicy retryPolicy\n-            = new ExponentialRetryPolicy(3, 0, 1000, 2);\n \n     int httperror = 0;\n     IOException ex = null;\n     boolean succeeded = false;\n     int retryCount = 0;\n+    boolean shouldRetry;\n+    LOG.debug(\"First execution of REST operation getTokenSingleCall\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62d1f90399a7e1aae11db2a743697c3b317e4a1c"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3MDA0MQ==", "bodyText": "Done", "url": "https://github.com/apache/hadoop/pull/2123#discussion_r454470041", "createdAt": "2020-07-14T16:06:23Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/AzureADAuthenticator.java", "diffHunk": "@@ -275,21 +287,24 @@ public UnexpectedResponseException(final int httpErrorCode,\n   }\n \n   private static AzureADToken getTokenCall(String authEndpoint, String body,\n-      Hashtable<String, String> headers, String httpMethod) throws IOException {\n-    return getTokenCall(authEndpoint, body, headers, httpMethod, false);\n+      Hashtable<String, String> headers, String httpMethod,\n+      ExponentialRetryPolicy tokenFetchRetryPolicy) throws IOException {\n+    return getTokenCall(authEndpoint, body, headers, httpMethod, false,\n+        tokenFetchRetryPolicy);\n   }\n \n   private static AzureADToken getTokenCall(String authEndpoint, String body,\n-      Hashtable<String, String> headers, String httpMethod, boolean isMsi)\n+      Hashtable<String, String> headers, String httpMethod, boolean isMsi,\n+      ExponentialRetryPolicy tokenFetchRetryPolicy)\n       throws IOException {\n     AzureADToken token = null;\n-    ExponentialRetryPolicy retryPolicy\n-            = new ExponentialRetryPolicy(3, 0, 1000, 2);\n \n     int httperror = 0;\n     IOException ex = null;\n     boolean succeeded = false;\n     int retryCount = 0;\n+    boolean shouldRetry;\n+    LOG.debug(\"First execution of REST operation getTokenSingleCall\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU4NTI2NQ=="}, "originalCommit": {"oid": "62d1f90399a7e1aae11db2a743697c3b317e4a1c"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyODg3MDkwOnYy", "diffSide": "LEFT", "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/AzureADAuthenticator.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMTo0NDo0MVrOGwlBRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNjowNjozM1rOGxaqEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5MTM2Ng==", "bodyText": "As every OAuth token provider eventually calls this method to get token, you will just need to create an instance of exponential retry right here with the configured values ?\nIs there any benefit creating and passing down exponential retry instance from each of the token provider ?", "url": "https://github.com/apache/hadoop/pull/2123#discussion_r453591366", "createdAt": "2020-07-13T11:44:41Z", "author": {"login": "snvijaya"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/AzureADAuthenticator.java", "diffHunk": "@@ -275,21 +287,24 @@ public UnexpectedResponseException(final int httpErrorCode,\n   }\n \n   private static AzureADToken getTokenCall(String authEndpoint, String body,\n-      Hashtable<String, String> headers, String httpMethod) throws IOException {\n-    return getTokenCall(authEndpoint, body, headers, httpMethod, false);\n+      Hashtable<String, String> headers, String httpMethod,\n+      ExponentialRetryPolicy tokenFetchRetryPolicy) throws IOException {\n+    return getTokenCall(authEndpoint, body, headers, httpMethod, false,\n+        tokenFetchRetryPolicy);\n   }\n \n   private static AzureADToken getTokenCall(String authEndpoint, String body,\n-      Hashtable<String, String> headers, String httpMethod, boolean isMsi)\n+      Hashtable<String, String> headers, String httpMethod, boolean isMsi,\n+      ExponentialRetryPolicy tokenFetchRetryPolicy)\n       throws IOException {\n     AzureADToken token = null;\n-    ExponentialRetryPolicy retryPolicy", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62d1f90399a7e1aae11db2a743697c3b317e4a1c"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ2OTI0OQ==", "bodyText": "Done", "url": "https://github.com/apache/hadoop/pull/2123#discussion_r454469249", "createdAt": "2020-07-14T16:05:12Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/AzureADAuthenticator.java", "diffHunk": "@@ -275,21 +287,24 @@ public UnexpectedResponseException(final int httpErrorCode,\n   }\n \n   private static AzureADToken getTokenCall(String authEndpoint, String body,\n-      Hashtable<String, String> headers, String httpMethod) throws IOException {\n-    return getTokenCall(authEndpoint, body, headers, httpMethod, false);\n+      Hashtable<String, String> headers, String httpMethod,\n+      ExponentialRetryPolicy tokenFetchRetryPolicy) throws IOException {\n+    return getTokenCall(authEndpoint, body, headers, httpMethod, false,\n+        tokenFetchRetryPolicy);\n   }\n \n   private static AzureADToken getTokenCall(String authEndpoint, String body,\n-      Hashtable<String, String> headers, String httpMethod, boolean isMsi)\n+      Hashtable<String, String> headers, String httpMethod, boolean isMsi,\n+      ExponentialRetryPolicy tokenFetchRetryPolicy)\n       throws IOException {\n     AzureADToken token = null;\n-    ExponentialRetryPolicy retryPolicy", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5MTM2Ng=="}, "originalCommit": {"oid": "62d1f90399a7e1aae11db2a743697c3b317e4a1c"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3MDE2MQ==", "bodyText": "Done", "url": "https://github.com/apache/hadoop/pull/2123#discussion_r454470161", "createdAt": "2020-07-14T16:06:33Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/oauth2/AzureADAuthenticator.java", "diffHunk": "@@ -275,21 +287,24 @@ public UnexpectedResponseException(final int httpErrorCode,\n   }\n \n   private static AzureADToken getTokenCall(String authEndpoint, String body,\n-      Hashtable<String, String> headers, String httpMethod) throws IOException {\n-    return getTokenCall(authEndpoint, body, headers, httpMethod, false);\n+      Hashtable<String, String> headers, String httpMethod,\n+      ExponentialRetryPolicy tokenFetchRetryPolicy) throws IOException {\n+    return getTokenCall(authEndpoint, body, headers, httpMethod, false,\n+        tokenFetchRetryPolicy);\n   }\n \n   private static AzureADToken getTokenCall(String authEndpoint, String body,\n-      Hashtable<String, String> headers, String httpMethod, boolean isMsi)\n+      Hashtable<String, String> headers, String httpMethod, boolean isMsi,\n+      ExponentialRetryPolicy tokenFetchRetryPolicy)\n       throws IOException {\n     AzureADToken token = null;\n-    ExponentialRetryPolicy retryPolicy", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5MTM2Ng=="}, "originalCommit": {"oid": "62d1f90399a7e1aae11db2a743697c3b317e4a1c"}, "originalPosition": 98}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NDU1NTgxOnYy", "diffSide": "RIGHT", "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxOTo0MjoyN1rOGy6CLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNTo0MjoyOFrOGzX8Ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAzMjgxMw==", "bodyText": "order", "url": "https://github.com/apache/hadoop/pull/2123#discussion_r456032813", "createdAt": "2020-07-16T19:42:27Z", "author": {"login": "DadanielZ"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java", "diffHunk": "@@ -50,6 +50,7 @@\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.base.Preconditions;\n import com.google.common.base.Strings;\n+import org.apache.hadoop.fs.azurebfs.oauth2.AzureADAuthenticator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f59493770ac3d748dd099e382e24b0cc7a44d4a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUyMjc3MQ==", "bodyText": "done", "url": "https://github.com/apache/hadoop/pull/2123#discussion_r456522771", "createdAt": "2020-07-17T15:42:28Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java", "diffHunk": "@@ -50,6 +50,7 @@\n import com.google.common.annotations.VisibleForTesting;\n import com.google.common.base.Preconditions;\n import com.google.common.base.Strings;\n+import org.apache.hadoop.fs.azurebfs.oauth2.AzureADAuthenticator;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAzMjgxMw=="}, "originalCommit": {"oid": "5f59493770ac3d748dd099e382e24b0cc7a44d4a"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3487, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}