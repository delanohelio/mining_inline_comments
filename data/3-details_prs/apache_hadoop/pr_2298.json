{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NTc2Mjgx", "number": 2298, "title": "HDFS-15532: listFiles on root/InternalDir will fail if fallback root has file.", "bodyText": "https://issues.apache.org/jira/browse/HDFS-15532", "createdAt": "2020-09-11T03:00:40Z", "url": "https://github.com/apache/hadoop/pull/2298", "merged": true, "mergeCommit": {"oid": "d2779de3f525f58790cbd6c9e3c265a9767d1d0c"}, "closed": true, "closedAt": "2020-09-13T00:06:40Z", "author": {"login": "umamaheswararao"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHsZxugH2gAyNDg0NTc2MjgxOmFmMGIyNjFmZWUyZDYxNDhjMjNkYThmNGUxYjAyYjMzOTA3NzliM2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIOUJDAFqTQ4NzI0NzY4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "af0b261fee2d6148c23da8f4e1b02b3390779b3b", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/af0b261fee2d6148c23da8f4e1b02b3390779b3b", "committedDate": "2020-09-11T02:58:41Z", "message": "HDFS-15532: listFiles on root/InternalDir will fail if fallback root has file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdd0932e33244d928c5e5682addc5146c064d6e7", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/cdd0932e33244d928c5e5682addc5146c064d6e7", "committedDate": "2020-09-11T17:48:09Z", "message": "Fixed a checkstyle warning."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjAzNzU4", "url": "https://github.com/apache/hadoop/pull/2298#pullrequestreview-487203758", "createdAt": "2020-09-12T04:58:38Z", "commit": {"oid": "cdd0932e33244d928c5e5682addc5146c064d6e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwNDo1ODozOFrOHQynSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwNDo1ODozOFrOHQynSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM2ODUyMA==", "bodyText": "(InodeTree.SlashPath.equals(fs.getPath()))\nIn which case this would be true? Provided there is a check in the if condition", "url": "https://github.com/apache/hadoop/pull/2298#discussion_r487368520", "createdAt": "2020-09-12T04:58:38Z", "author": {"login": "ayushtkn"}, "path": "hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java", "diffHunk": "@@ -1263,6 +1263,26 @@ public boolean delete(final Path f)\n     public BlockLocation[] getFileBlockLocations(final FileStatus fs,\n         final long start, final long len) throws\n         FileNotFoundException, IOException {\n+\n+      // When application calls listFiles on internalDir, it would return\n+      // RemoteIterator from InternalDirOfViewFs. If there is a fallBack, there\n+      // is a chance of files exists under that internalDir in fallback.\n+      // Iterator#next will call getFileBlockLocations with that files. So, we\n+      // should return getFileBlockLocations on fallback. See HDFS-15532.\n+      if (fs.getPath() != InodeTree.SlashPath && this.fsState\n+          .getRootFallbackLink() != null) {\n+        FileSystem linkedFallbackFs =\n+            this.fsState.getRootFallbackLink().getTargetFileSystem();\n+        Path parent = Path.getPathWithoutSchemeAndAuthority(\n+            new Path(theInternalDir.fullPath));\n+        String leafChild = (InodeTree.SlashPath.equals(fs.getPath())) ?\n+            InodeTree.SlashPath.toString() :\n+            fs.getPath().getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdd0932e33244d928c5e5682addc5146c064d6e7"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "271b8b5efbe8a959d26129fd295d618909048fa0", "author": {"user": null}, "url": "https://github.com/apache/hadoop/commit/271b8b5efbe8a959d26129fd295d618909048fa0", "committedDate": "2020-09-12T06:24:45Z", "message": "Fixed a review comment and also fixed the issue for ViewFs flow as well"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjQ3Njgw", "url": "https://github.com/apache/hadoop/pull/2298#pullrequestreview-487247680", "createdAt": "2020-09-12T18:29:18Z", "commit": {"oid": "271b8b5efbe8a959d26129fd295d618909048fa0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3648, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}