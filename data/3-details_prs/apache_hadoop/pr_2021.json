{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NTA5Nzk3", "number": 2021, "title": "Hadoop-17015. ABFS: Handling Rename and Delete idempotency", "bodyText": "Requests failing due to server timeouts and network failures are retried. At times the request might have succeeded at the server end when client received a timeout. In such case, a retry done for Rename or Delete operation will end in an user error for HTTP 404 (Not Found). In case of Rename, user error is NOT_FOUND as the source file is already renamed and is no longer available.\nWhen the user error is thrown back to the calling application it mostly leads to job failure and is hard to debug from client side on how rename or delete ended up with an user error of file/folder not being present.\nRest of the PUT/POST operations get executed again at server end and maintains the idempotency state and needs no handling in ABFS Driver.\nIn this PR:\n\nRename: If a rename request was retried and has failed with HTTP 404 status, LMT on the destination path is checked. If LMT is post the start time of the first rename request or is within a bracket of 5 mins previous (to absorb clock skew on server side), it is assumed that the earlier rename operation was successful at backend and hence success is returned.\nDelete: Delete is considered idempotent by default. Hence if a delete request had to be retried and has failed with HTTP 404 status, a success response is returned.\n\nMock tests to mimic a retried rename/delete request are added.", "createdAt": "2020-05-13T17:34:01Z", "url": "https://github.com/apache/hadoop/pull/2021", "merged": true, "mergeCommit": {"oid": "8f78aeb2500011e568929b585ed5b0987355f88d"}, "closed": true, "closedAt": "2020-05-19T19:30:07Z", "author": {"login": "snvijaya"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccbKzgAH2gAyNDE3NTA5Nzk3OjVhMTFkNGQ1YzhlZGQxZmViOTI2MGFmZGRkOGVkODMxOWYwMzQ3ZGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci4mFDgH2gAyNDE3NTA5Nzk3OjY1ODAxMDkwZWRmZTBiMGQ2ZmJmZWE0NTQ1ZDQ3N2I3NmIwMDlkOTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5a11d4d5c8edd1feb9260afddd8ed8319f0347de", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/5a11d4d5c8edd1feb9260afddd8ed8319f0347de", "committedDate": "2020-04-29T16:35:12Z", "message": "rename changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6471661ab59e297c8f476bf6ece229b8cc5a4bcf", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/6471661ab59e297c8f476bf6ece229b8cc5a4bcf", "committedDate": "2020-05-13T03:39:44Z", "message": "Some refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16f0b7bf826691e02ca7bafd79c3b1f4651197c1", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/16f0b7bf826691e02ca7bafd79c3b1f4651197c1", "committedDate": "2020-05-13T04:31:13Z", "message": "Merge from master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c158597fa2efc7e75cbfd09ea3ff48b0e0b8904a", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/c158597fa2efc7e75cbfd09ea3ff48b0e0b8904a", "committedDate": "2020-05-13T16:23:47Z", "message": "Checkstyle and findbugs fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/77f54cb8323ef8137df430aff3e16caf6ab3497f", "committedDate": "2020-05-13T16:32:58Z", "message": "Removing redundant new lines"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTgzMzM5", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411183339", "createdAt": "2020-05-13T18:18:49Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoxODo0OVrOGU98og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoxODo0OVrOGU98og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzOTY1MA==", "bodyText": "I think private is enough here.", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424639650", "createdAt": "2020-05-13T18:18:49Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/utils/DateTimeUtils.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.fs.azurebfs.utils;\n+\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.Date;\n+import java.util.Locale;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DateTimeUtils {\n+  public static final Logger LOG = LoggerFactory.getLogger(DateTimeUtils.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTg1OTI2", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411185926", "createdAt": "2020-05-13T18:22:13Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoyMjoxM1rOGU-Elg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoyMjoxM1rOGU-Elg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0MTY4Ng==", "bodyText": "This line exceeds checkstyle limit of 80 chars", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424641686", "createdAt": "2020-05-13T18:22:13Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/utils/DateTimeUtils.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.fs.azurebfs.utils;\n+\n+import java.text.ParseException;\n+import java.text.SimpleDateFormat;\n+import java.util.Date;\n+import java.util.Locale;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DateTimeUtils {\n+  public static final Logger LOG = LoggerFactory.getLogger(DateTimeUtils.class);\n+  private static final String DATE_TIME_PATTERN = \"E, dd MMM yyyy HH:mm:ss z\";\n+\n+  public static long parseLastModifiedTime(final String lastModifiedTime) {\n+    long parsedTime = 0;\n+    try {\n+      Date utcDate = new SimpleDateFormat(DATE_TIME_PATTERN, Locale.US).parse(lastModifiedTime);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTg4MzEz", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411188313", "createdAt": "2020-05-13T18:25:20Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoyNToyMVrOGU-MOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoyNToyMVrOGU-MOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0MzY0MA==", "bodyText": "Import order", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424643640", "createdAt": "2020-05-13T18:25:21Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAzureBlobFileSystemDelete.java", "diffHunk": "@@ -28,20 +28,36 @@\n \n import org.junit.Test;\n \n+import org.apache.hadoop.fs.azurebfs.services.AbfsClient;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsHttpOperation;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsPerfTracker;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsRestOperation;\n+import org.apache.hadoop.fs.azurebfs.services.ExponentialRetryPolicy;\n+import org.apache.hadoop.fs.azurebfs.services.SharedKeyCredentials;\n import org.apache.hadoop.fs.FileAlreadyExistsException;\n import org.apache.hadoop.fs.FileStatus;\n import org.apache.hadoop.fs.Path;\n \n+import static java.net.HttpURLConnection.HTTP_NOT_FOUND;\n+import static java.net.HttpURLConnection.HTTP_OK;\n+\n+import static org.apache.hadoop.fs.azurebfs.constants.AbfsHttpConstants.DOT;\n+import static org.apache.hadoop.fs.azurebfs.constants.FileSystemConfigurations.DEFAULT_DELETE_CONSIDERED_IDEMPOTENT;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertDeleted;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertPathDoesNotExist;\n import static org.apache.hadoop.test.LambdaTestUtils.intercept;\n+import static org.mockito.Mockito.mock;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTg5NjIy", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411189622", "createdAt": "2020-05-13T18:27:06Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoyNzowNlrOGU-QYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODoyNzowNlrOGU-QYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0NDcwNQ==", "bodyText": "CheckStyle: I think this line exceeds 80 chars limit", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424644705", "createdAt": "2020-05-13T18:27:06Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AzureBlobFileSystemStore.java", "diffHunk": "@@ -748,7 +747,7 @@ public FileStatus getFileStatus(final Path path) throws IOException {\n           long contentLength = entry.contentLength() == null ? 0 : entry.contentLength();\n           boolean isDirectory = entry.isDirectory() == null ? false : entry.isDirectory();\n           if (entry.lastModified() != null && !entry.lastModified().isEmpty()) {\n-            lastModifiedMillis = parseLastModifiedTime(entry.lastModified());\n+            lastModifiedMillis = DateTimeUtils.parseLastModifiedTime(entry.lastModified());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjA1MzQ3", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411205347", "createdAt": "2020-05-13T18:48:38Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo0ODozOFrOGU_CBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo0ODozOFrOGU_CBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1NzQxNQ==", "bodyText": "Would it be better to move the idempotency related methods to a separate Utility/Helper class?", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424657415", "createdAt": "2020-05-13T18:48:38Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsClient.java", "diffHunk": "@@ -321,9 +324,81 @@ public AbfsRestOperation renamePath(String source, final String destination, fin\n             url,\n             requestHeaders);\n     op.execute();\n+\n+    if (op.getResult().getStatusCode() != HttpURLConnection.HTTP_OK) {\n+      return renameIdempotencyCheckOp(op, destination);\n+    }\n+\n     return op;\n   }\n \n+  /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjA3NDM0", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411207434", "createdAt": "2020-05-13T18:51:26Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo1MToyNlrOGU_Itw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo1MToyNlrOGU_Itw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1OTEyNw==", "bodyText": "Does it convey the right meaning by keeping DEFAULT prefix(as the same is not a configurable flag)?", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424659127", "createdAt": "2020-05-13T18:51:26Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/constants/FileSystemConfigurations.java", "diffHunk": "@@ -81,5 +81,7 @@\n   public static final String DEFAULT_FS_AZURE_USER_AGENT_PREFIX = EMPTY_STRING;\n   public static final String DEFAULT_VALUE_UNKNOWN = \"UNKNOWN\";\n \n+  public static final boolean DEFAULT_DELETE_CONSIDERED_IDEMPOTENT = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjExNTQ2", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411211546", "createdAt": "2020-05-13T18:56:56Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo1Njo1NlrOGU_VoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo1Njo1NlrOGU_VoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY2MjQzMg==", "bodyText": "Better to declare constant as static", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424662432", "createdAt": "2020-05-13T18:56:56Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAzureBlobFileSystemDelete.java", "diffHunk": "@@ -28,20 +28,36 @@\n \n import org.junit.Test;\n \n+import org.apache.hadoop.fs.azurebfs.services.AbfsClient;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsHttpOperation;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsPerfTracker;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsRestOperation;\n+import org.apache.hadoop.fs.azurebfs.services.ExponentialRetryPolicy;\n+import org.apache.hadoop.fs.azurebfs.services.SharedKeyCredentials;\n import org.apache.hadoop.fs.FileAlreadyExistsException;\n import org.apache.hadoop.fs.FileStatus;\n import org.apache.hadoop.fs.Path;\n \n+import static java.net.HttpURLConnection.HTTP_NOT_FOUND;\n+import static java.net.HttpURLConnection.HTTP_OK;\n+\n+import static org.apache.hadoop.fs.azurebfs.constants.AbfsHttpConstants.DOT;\n+import static org.apache.hadoop.fs.azurebfs.constants.FileSystemConfigurations.DEFAULT_DELETE_CONSIDERED_IDEMPOTENT;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertDeleted;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertPathDoesNotExist;\n import static org.apache.hadoop.test.LambdaTestUtils.intercept;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n \n /**\n  * Test delete operation.\n  */\n public class ITestAzureBlobFileSystemDelete extends\n     AbstractAbfsIntegrationTest {\n \n+  private final int reducedRetryCount = 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjE0MDc4", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411214078", "createdAt": "2020-05-13T19:00:31Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOTowMDozMVrOGU_ddg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOTowMDozMVrOGU_ddg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY2NDQzOA==", "bodyText": "Try to use the better alternative assertJ.", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424664438", "createdAt": "2020-05-13T19:00:31Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAzureBlobFileSystemDelete.java", "diffHunk": "@@ -130,4 +146,49 @@ public Void call() throws Exception {\n     assertPathDoesNotExist(fs, \"deleted\", dir);\n \n   }\n+\n+  @Test\n+  public void testDeleteIdempotency() throws Exception {\n+    org.junit.Assume.assumeTrue(DEFAULT_DELETE_CONSIDERED_IDEMPOTENT);\n+    // Config to reduce the retry and maxBackoff time for test run\n+    AbfsConfiguration abfsConfig = getConfiguration();\n+    abfsConfig.setMaxIoRetries(reducedRetryCount);\n+    abfsConfig.setMaxBackoffIntervalMilliseconds(reducedMaxBackoffIntervalMs);\n+\n+    final AzureBlobFileSystem fs = getFileSystem();\n+    AbfsClient abfsClient = fs.getAbfsStore().getClient();\n+    AbfsPerfTracker tracker = new AbfsPerfTracker(\"test\",\n+        this.getAccountName(),\n+        abfsConfig);\n+\n+    // Create test AbfsClient\n+    AbfsClient testClient = new AbfsClient(\n+        abfsClient.getBaseUrl(),\n+        new SharedKeyCredentials(abfsConfig.getAccountName().substring(0,\n+            abfsConfig.getAccountName().indexOf(DOT)),\n+            abfsConfig.getStorageAccountKey()),\n+        abfsConfig,\n+        new ExponentialRetryPolicy(reducedRetryCount),\n+        abfsConfig.getTokenProvider(),\n+        tracker);\n+\n+    // Mock instance of AbfsRestOperation\n+    AbfsRestOperation op = mock(AbfsRestOperation.class);\n+    // Set retryCount to non-zero\n+    when(op.getRetryCount()).thenReturn(reducedRetryCount);\n+\n+    // Mock instance of Http Operation response. This will return HTTP:Not Found\n+    AbfsHttpOperation http404Op = mock(AbfsHttpOperation.class);\n+    when(http404Op.getStatusCode()).thenReturn(HTTP_NOT_FOUND);\n+\n+    // Mock delete response to 404\n+    when(op.getResult()).thenReturn(http404Op);\n+\n+    assertTrue(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 79}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjE0NTAw", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411214500", "createdAt": "2020-05-13T19:01:07Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOTowMTowN1rOGU_e0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOTowMTowN1rOGU_e0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY2NDc4NQ==", "bodyText": "Import order", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424664785", "createdAt": "2020-05-13T19:01:07Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAzureBlobFileSystemRename.java", "diffHunk": "@@ -28,20 +28,37 @@\n import org.junit.Assert;\n import org.junit.Test;\n \n+import org.apache.hadoop.fs.azurebfs.services.AbfsClient;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsHttpOperation;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsPerfTracker;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsRestOperation;\n+import org.apache.hadoop.fs.azurebfs.services.ExponentialRetryPolicy;\n+import org.apache.hadoop.fs.azurebfs.services.SharedKeyCredentials;\n import org.apache.hadoop.fs.FileStatus;\n import org.apache.hadoop.fs.Path;\n \n+import static java.util.UUID.randomUUID;\n+import static java.net.HttpURLConnection.HTTP_BAD_REQUEST;\n+import static java.net.HttpURLConnection.HTTP_NOT_FOUND;\n+import static java.net.HttpURLConnection.HTTP_OK;\n+\n+import static org.apache.hadoop.fs.azurebfs.constants.AbfsHttpConstants.DOT;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertMkdirs;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertPathDoesNotExist;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertRenameOutcome;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertIsFile;\n+import static org.mockito.Mockito.mock;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjE0ODAy", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411214802", "createdAt": "2020-05-13T19:01:30Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOTowMTozMFrOGU_foA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOTowMTozMFrOGU_foA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY2NDk5Mg==", "bodyText": "Better to keep constants as static", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424664992", "createdAt": "2020-05-13T19:01:30Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAzureBlobFileSystemRename.java", "diffHunk": "@@ -28,20 +28,37 @@\n import org.junit.Assert;\n import org.junit.Test;\n \n+import org.apache.hadoop.fs.azurebfs.services.AbfsClient;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsHttpOperation;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsPerfTracker;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsRestOperation;\n+import org.apache.hadoop.fs.azurebfs.services.ExponentialRetryPolicy;\n+import org.apache.hadoop.fs.azurebfs.services.SharedKeyCredentials;\n import org.apache.hadoop.fs.FileStatus;\n import org.apache.hadoop.fs.Path;\n \n+import static java.util.UUID.randomUUID;\n+import static java.net.HttpURLConnection.HTTP_BAD_REQUEST;\n+import static java.net.HttpURLConnection.HTTP_NOT_FOUND;\n+import static java.net.HttpURLConnection.HTTP_OK;\n+\n+import static org.apache.hadoop.fs.azurebfs.constants.AbfsHttpConstants.DOT;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertMkdirs;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertPathDoesNotExist;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertRenameOutcome;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertIsFile;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n \n /**\n  * Test rename operation.\n  */\n public class ITestAzureBlobFileSystemRename extends\n     AbstractAbfsIntegrationTest {\n \n+  private final int reducedRetryCount = 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjI0MDIw", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411224020", "createdAt": "2020-05-13T19:14:35Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOToxNDozNVrOGU_7kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOToxNDozNVrOGU_7kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY3MjE0NA==", "bodyText": "Couldn't find it reasonable to keep all the cases into the same method with if-else. I think separating the same could improve readability of the test cases.", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424672144", "createdAt": "2020-05-13T19:14:35Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAzureBlobFileSystemRename.java", "diffHunk": "@@ -149,4 +166,135 @@ public void testPosixRenameDirectory() throws Exception {\n     assertTrue(fs.exists(new Path(\"testDir2/test4/test3\")));\n     assertFalse(fs.exists(new Path(\"testDir2/test1/test2/test3\")));\n   }\n+\n+  @Test\n+  public void testRenameRetryFailureAsHTTP400() throws Exception {\n+    // Rename failed as Bad Request\n+    // RenameIdempotencyCheck should throw back the rename failure Op\n+    testRenameTimeout(HTTP_BAD_REQUEST, HTTP_BAD_REQUEST, false);\n+  }\n+\n+  @Test\n+  public void testRenameRetryFailureAsHTTP404() throws Exception {\n+    // Rename failed as FileNotFound and the destination LMT is\n+    // within TimespanForIdentifyingRecentOperationThroughLMT\n+    testRenameTimeout(HTTP_NOT_FOUND, HTTP_OK, false);\n+  }\n+\n+  @Test\n+  public void testRenameRetryFailureWithDestOldLMT() throws Exception {\n+    // Rename failed as FileNotFound and the destination LMT is\n+    // older than TimespanForIdentifyingRecentOperationThroughLMT\n+    testRenameTimeout(HTTP_NOT_FOUND, HTTP_NOT_FOUND, true);\n+  }\n+\n+  private void testRenameTimeout(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjI0OTU1", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411224955", "createdAt": "2020-05-13T19:15:53Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOToxNTo1NFrOGU_-hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxOToxNTo1NFrOGU_-hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY3MjkwMA==", "bodyText": "this. prefix?", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r424672900", "createdAt": "2020-05-13T19:15:54Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsRestOperation.java", "diffHunk": "@@ -157,7 +175,7 @@ void execute() throws AzureBlobFileSystemException {\n       requestHeaders.add(httpHeader);\n     }\n \n-    int retryCount = 0;\n+    retryCount = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjI2MTE5", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411226119", "createdAt": "2020-05-13T19:17:32Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjI5NzEw", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-411229710", "createdAt": "2020-05-13T19:22:40Z", "commit": {"oid": "77f54cb8323ef8137df430aff3e16caf6ab3497f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be7c0240a9507f4eb80f52f5a3f2c3f7899f249b", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/be7c0240a9507f4eb80f52f5a3f2c3f7899f249b", "committedDate": "2020-05-14T07:24:59Z", "message": "Review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c9cdbcaa9e7c9530ce986523776d52ec1484684", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/4c9cdbcaa9e7c9530ce986523776d52ec1484684", "committedDate": "2020-05-14T08:21:57Z", "message": "checkstyle fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/db5c57826fd39894ad88a2ea0628ebbe84b48091", "committedDate": "2020-05-14T17:11:30Z", "message": "Change LMT recent detection logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDQ4Mjg3", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412048287", "createdAt": "2020-05-14T17:50:12Z", "commit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNzo1MDoxMlrOGVnvVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNzo1MDoxMlrOGVnvVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTMyNDM3Mw==", "bodyText": "Widening the method accessibility by making it public solely for testing is not a good practice. See if at least the acces can be restricted to package level and use @VisibleForTesting annotation.", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r425324373", "createdAt": "2020-05-14T17:50:12Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsClient.java", "diffHunk": "@@ -131,7 +135,7 @@ public String getFileSystem() {\n     return filesystem;\n   }\n \n-  protected AbfsPerfTracker getAbfsPerfTracker() {\n+  public AbfsPerfTracker getAbfsPerfTracker() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDU2OTM3", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412056937", "createdAt": "2020-05-14T18:01:28Z", "commit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDc0ODIy", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412074822", "createdAt": "2020-05-14T18:26:01Z", "commit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDgwMDI1", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412080025", "createdAt": "2020-05-14T18:33:09Z", "commit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODozMzoxMFrOGVpPzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODozMzoxMFrOGVpPzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM0OTA3MQ==", "bodyText": "These are not asserJ assertions.\nThat is better alternative, defenitly improved readability. Steve also reccomands the same.\nthe format is assertThat()\n.describedAs(\"describe what assertion is going tobe made and the same is going to be printed in logs\").<assertion method ex: isEqualTo()>", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r425349071", "createdAt": "2020-05-14T18:33:10Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAzureBlobFileSystemDelete.java", "diffHunk": "@@ -130,4 +148,50 @@ public Void call() throws Exception {\n     assertPathDoesNotExist(fs, \"deleted\", dir);\n \n   }\n+\n+  @Test\n+  public void testDeleteIdempotency() throws Exception {\n+    org.junit.Assume.assumeTrue(DEFAULT_DELETE_CONSIDERED_IDEMPOTENT);\n+    // Config to reduce the retry and maxBackoff time for test run\n+    AbfsConfiguration abfsConfig = getConfiguration();\n+    abfsConfig.setMaxIoRetries(REDUCED_RETRY_COUNT);\n+    abfsConfig.setMaxBackoffIntervalMilliseconds(REDUCED_MAX_BACKOFF_INTERVALS_MS);\n+\n+    final AzureBlobFileSystem fs = getFileSystem();\n+    AbfsClient abfsClient = fs.getAbfsStore().getClient();\n+    AbfsPerfTracker tracker = new AbfsPerfTracker(\"test\",\n+        this.getAccountName(),\n+        abfsConfig);\n+\n+    // Create test AbfsClient\n+    AbfsClient testClient = new AbfsClient(\n+        abfsClient.getBaseUrl(),\n+        new SharedKeyCredentials(abfsConfig.getAccountName().substring(0,\n+            abfsConfig.getAccountName().indexOf(DOT)),\n+            abfsConfig.getStorageAccountKey()),\n+        abfsConfig,\n+        new ExponentialRetryPolicy(REDUCED_RETRY_COUNT),\n+        abfsConfig.getTokenProvider(),\n+        tracker);\n+\n+    // Mock instance of AbfsRestOperation\n+    AbfsRestOperation op = mock(AbfsRestOperation.class);\n+    // Set retryCount to non-zero\n+    when(op.isARetriedRequest()).thenReturn(true);\n+\n+    // Mock instance of Http Operation response. This will return HTTP:Not Found\n+    AbfsHttpOperation http404Op = mock(AbfsHttpOperation.class);\n+    when(http404Op.getStatusCode()).thenReturn(HTTP_NOT_FOUND);\n+\n+    // Mock delete response to 404\n+    when(op.getResult()).thenReturn(http404Op);\n+\n+    assertEquals(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "originalPosition": 81}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDgwMTU5", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412080159", "createdAt": "2020-05-14T18:33:20Z", "commit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDgyMjE5", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412082219", "createdAt": "2020-05-14T18:36:13Z", "commit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODozNjoxM1rOGVpWag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODozNjoxM1rOGVpWag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM1MDc2Mg==", "bodyText": "I am not sure if this annotation is reccommanded as the method is anyway public. I personaly find it ok as it adds to readability.", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r425350762", "createdAt": "2020-05-14T18:36:13Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/AbfsConfiguration.java", "diffHunk": "@@ -764,6 +764,11 @@ public void setMaxIoRetries(int maxIoRetries) {\n     this.maxIoRetries = maxIoRetries;\n   }\n \n+  @VisibleForTesting", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDg3NDIz", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412087423", "createdAt": "2020-05-14T18:43:18Z", "commit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODo0MzoxOFrOGVpmTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODo0MzoxOFrOGVpmTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM1NDgyOQ==", "bodyText": "Make changes if required as per the similar conversation we are having in the same PR. I mean mentioning it as the \"default\".", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r425354829", "createdAt": "2020-05-14T18:43:18Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/site/markdown/abfs.md", "diffHunk": "@@ -691,6 +691,18 @@ Config `fs.azure.account.hns.enabled` provides an option to specify whether\n Config `fs.azure.enable.check.access` needs to be set true to enable\n  the AzureBlobFileSystem.access().\n \n+### <a name=\"idempotency\"></a> Operation Idempotency\n+\n+Requests failing due to server timeouts and network failures will be retried.\n+PUT/POST operations are idempotent and need no specific handling\n+except for Rename and Delete operations.\n+\n+Rename idempotency checks are made by ensuring the LastModifiedTime on destination\n+is recent if source path is found to be non-existent on retry.\n+\n+Delete is considered to be idempotent by default if the target does not exist on", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDg4MjI3", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412088227", "createdAt": "2020-05-14T18:44:28Z", "commit": {"oid": "db5c57826fd39894ad88a2ea0628ebbe84b48091"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14be440a53dfcd63a6a89548ab8bdc2ca48d2ea1", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/14be440a53dfcd63a6a89548ab8bdc2ca48d2ea1", "committedDate": "2020-05-15T07:34:48Z", "message": "test code refactored"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDI5NjE4", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412429618", "createdAt": "2020-05-15T08:01:22Z", "commit": {"oid": "14be440a53dfcd63a6a89548ab8bdc2ca48d2ea1"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDM0OTg2", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412434986", "createdAt": "2020-05-15T08:09:39Z", "commit": {"oid": "14be440a53dfcd63a6a89548ab8bdc2ca48d2ea1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODowOTozOVrOGV6zNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODowOTozOVrOGV6zNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTYzNjY2MQ==", "bodyText": "Not sure if this class is the right place for this method.", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r425636661", "createdAt": "2020-05-15T08:09:39Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/TestAbfsConfigurationFieldsValidation.java", "diffHunk": "@@ -182,4 +182,11 @@ public void testSSLSocketFactoryConfiguration()\n     assertEquals(DelegatingSSLSocketFactory.SSLChannelMode.OpenSSL, localAbfsConfiguration.getPreferredSSLFactoryOption());\n   }\n \n+  public static AbfsConfiguration updateRetryConfigs(AbfsConfiguration abfsConfig,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14be440a53dfcd63a6a89548ab8bdc2ca48d2ea1"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDM3MTg0", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412437184", "createdAt": "2020-05-15T08:13:03Z", "commit": {"oid": "14be440a53dfcd63a6a89548ab8bdc2ca48d2ea1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODoxMzowM1rOGV65qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODoxMzowM1rOGV65qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTYzODMxMg==", "bodyText": "Same doubt as the above comment.\nTestAbfsClient should have test methods the AbfsClient and supporting methods.\nThis method looks more like a Utility.", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r425638312", "createdAt": "2020-05-15T08:13:03Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/services/TestAbfsClient.java", "diffHunk": "@@ -240,4 +242,25 @@ public void verifyUserAgentClusterType() throws Exception {\n       .contains(DEFAULT_VALUE_UNKNOWN);\n   }\n \n+  public static AbfsClient createTestClientFromCurrentContext(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14be440a53dfcd63a6a89548ab8bdc2ca48d2ea1"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDM4MjY5", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412438269", "createdAt": "2020-05-15T08:14:45Z", "commit": {"oid": "14be440a53dfcd63a6a89548ab8bdc2ca48d2ea1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODoxNDo0NVrOGV69Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwODoxNDo0NVrOGV69Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTYzOTE3NQ==", "bodyText": "This new line can be removed", "url": "https://github.com/apache/hadoop/pull/2021#discussion_r425639175", "createdAt": "2020-05-15T08:14:45Z", "author": {"login": "bilaharith"}, "path": "hadoop-tools/hadoop-azure/src/test/java/org/apache/hadoop/fs/azurebfs/ITestAzureBlobFileSystemDelete.java", "diffHunk": "@@ -26,22 +26,40 @@\n import java.util.concurrent.Executors;\n import java.util.concurrent.Future;\n \n+import org.assertj.core.api.Assertions;\n+import org.junit.Assume;\n import org.junit.Test;\n \n+import org.apache.hadoop.fs.azurebfs.services.AbfsClient;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsHttpOperation;\n+import org.apache.hadoop.fs.azurebfs.services.AbfsRestOperation;\n+import org.apache.hadoop.fs.azurebfs.services.TestAbfsClient;\n import org.apache.hadoop.fs.FileAlreadyExistsException;\n import org.apache.hadoop.fs.FileStatus;\n import org.apache.hadoop.fs.Path;\n \n+import static java.net.HttpURLConnection.HTTP_NOT_FOUND;\n+import static java.net.HttpURLConnection.HTTP_OK;\n+\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+import static org.apache.hadoop.fs.azurebfs.constants.FileSystemConfigurations.DEFAULT_DELETE_CONSIDERED_IDEMPOTENT;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertDeleted;\n import static org.apache.hadoop.fs.contract.ContractTestUtils.assertPathDoesNotExist;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14be440a53dfcd63a6a89548ab8bdc2ca48d2ea1"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDQwMzY2", "url": "https://github.com/apache/hadoop/pull/2021#pullrequestreview-412440366", "createdAt": "2020-05-15T08:17:54Z", "commit": {"oid": "14be440a53dfcd63a6a89548ab8bdc2ca48d2ea1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6e090806bab4cd07928ed895721b32c2633b54e", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/a6e090806bab4cd07928ed895721b32c2633b54e", "committedDate": "2020-05-15T08:54:32Z", "message": "Remove redundant new line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "738af3a2bebe4e515ea23616647e57e453a38761", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/738af3a2bebe4e515ea23616647e57e453a38761", "committedDate": "2020-05-19T15:30:19Z", "message": "Merge to trunk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "639205dbd2d348ca22be9606a632de37af2931ab", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/639205dbd2d348ca22be9606a632de37af2931ab", "committedDate": "2020-05-19T17:57:27Z", "message": "Dummy checkin to Trigger Yetus"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65801090edfe0b0d6fbfea4545d477b76b009d96", "author": {"user": {"login": "snvijaya", "name": "Sneha Vijayarajan"}}, "url": "https://github.com/apache/hadoop/commit/65801090edfe0b0d6fbfea4545d477b76b009d96", "committedDate": "2020-05-19T18:15:47Z", "message": "Undo earlier dummy checkin to Trigger Yetus"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4318, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}