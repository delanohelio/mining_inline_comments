{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MzI4MjY2", "number": 2175, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxOToxNzozOFrOEUKgJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzo1MzoyOFrOEUs8UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTc5MDQ2OnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxOToxNzozOFrOG6TTxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODoxMzo1NlrOG7D0PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4Njk1MQ==", "bodyText": "Lets change DFS_NAMENODE_SNAPSHOT_MAX_LIMIT to DFS_NAMENODE_SNAPSHOT_MAX_DIRECTORY_LIMIT. and lets use the same reference of the variable internally;", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r463786951", "createdAt": "2020-07-31T19:17:38Z", "author": {"login": "mukul1987"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "diffHunk": "@@ -498,9 +498,14 @@\n   public static final int\n       DFS_NAMENODE_SNAPSHOT_DIFF_LISTING_LIMIT_DEFAULT = 1000;\n \n-  public static final String DFS_NAMENODE_SNAPSHOT_MAX_LIMIT =\n-      \"dfs.namenode.snapshot.max.limit\";\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_MAX_LIMIT = \"dfs.namenode.snapshot.max.limit\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzgxOTkyOQ==", "bodyText": "It was suggested that the config name should not be changed as it will be an incomatible change. The constant name followes default convention of defining the configs.", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r463819929", "createdAt": "2020-07-31T20:27:55Z", "author": {"login": "bshashikant"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "diffHunk": "@@ -498,9 +498,14 @@\n   public static final int\n       DFS_NAMENODE_SNAPSHOT_DIFF_LISTING_LIMIT_DEFAULT = 1000;\n \n-  public static final String DFS_NAMENODE_SNAPSHOT_MAX_LIMIT =\n-      \"dfs.namenode.snapshot.max.limit\";\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_MAX_LIMIT = \"dfs.namenode.snapshot.max.limit\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4Njk1MQ=="}, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzgyMDIyMw==", "bodyText": "It was changed back to the original name as per Nicholas suggestion.", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r463820223", "createdAt": "2020-07-31T20:28:44Z", "author": {"login": "bshashikant"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "diffHunk": "@@ -498,9 +498,14 @@\n   public static final int\n       DFS_NAMENODE_SNAPSHOT_DIFF_LISTING_LIMIT_DEFAULT = 1000;\n \n-  public static final String DFS_NAMENODE_SNAPSHOT_MAX_LIMIT =\n-      \"dfs.namenode.snapshot.max.limit\";\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_MAX_LIMIT = \"dfs.namenode.snapshot.max.limit\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4Njk1MQ=="}, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU1MzA2Ng==", "bodyText": "Yes, we cannot change config names.\nBTW, please revert the white space change so that it will be easier to back port.", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r464553066", "createdAt": "2020-08-03T17:23:24Z", "author": {"login": "szetszwo"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "diffHunk": "@@ -498,9 +498,14 @@\n   public static final int\n       DFS_NAMENODE_SNAPSHOT_DIFF_LISTING_LIMIT_DEFAULT = 1000;\n \n-  public static final String DFS_NAMENODE_SNAPSHOT_MAX_LIMIT =\n-      \"dfs.namenode.snapshot.max.limit\";\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_MAX_LIMIT = \"dfs.namenode.snapshot.max.limit\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4Njk1MQ=="}, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU4MTY5Mw==", "bodyText": "sure", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r464581693", "createdAt": "2020-08-03T18:13:56Z", "author": {"login": "bshashikant"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "diffHunk": "@@ -498,9 +498,14 @@\n   public static final int\n       DFS_NAMENODE_SNAPSHOT_DIFF_LISTING_LIMIT_DEFAULT = 1000;\n \n-  public static final String DFS_NAMENODE_SNAPSHOT_MAX_LIMIT =\n-      \"dfs.namenode.snapshot.max.limit\";\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_MAX_LIMIT = \"dfs.namenode.snapshot.max.limit\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4Njk1MQ=="}, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NTc5Mjk3OnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxOToxODozM1rOG6TVPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMzo0MToyOVrOG65-dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4NzMyNA==", "bodyText": "maxSnapshotLimit -> maxSnapshotDirectroyLimit", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r463787324", "createdAt": "2020-07-31T19:18:33Z", "author": {"login": "mukul1987"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -117,23 +119,37 @@ public SnapshotManager(final Configuration conf, final FSDirectory fsdir) {\n         DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_DIFF_ALLOW_SNAP_ROOT_DESCENDANT,\n         DFSConfigKeys.\n             DFS_NAMENODE_SNAPSHOT_DIFF_ALLOW_SNAP_ROOT_DESCENDANT_DEFAULT);\n+    this.maxSnapshotLimitPerDirectory = conf.getInt(\n+        DFSConfigKeys.\n+            DFS_NAMENODE_SNAPSHOT_MAX_LIMIT,\n+        DFSConfigKeys.\n+            DFS_NAMENODE_SNAPSHOT_MAX_LIMIT_DEFAULT);\n     this.maxSnapshotLimit = conf.getInt(\n-        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_MAX_LIMIT,\n-        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_MAX_LIMIT_DEFAULT);\n+        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_GLOBAL_LIMIT,\n+        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_GLOBAL_LIMIT_DEFAULT);\n     LOG.info(\"Loaded config captureOpenFiles: \" + captureOpenFiles\n         + \", skipCaptureAccessTimeOnlyChange: \"\n         + skipCaptureAccessTimeOnlyChange\n         + \", snapshotDiffAllowSnapRootDescendant: \"\n         + snapshotDiffAllowSnapRootDescendant\n         + \", maxSnapshotLimit: \"\n-        + maxSnapshotLimit);\n+        + maxSnapshotLimit", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQyMDQ2OQ==", "bodyText": "maxSnapshotLimitPerDirectory is already printed in the line below. I hope this works", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r464420469", "createdAt": "2020-08-03T13:41:29Z", "author": {"login": "bshashikant"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -117,23 +119,37 @@ public SnapshotManager(final Configuration conf, final FSDirectory fsdir) {\n         DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_DIFF_ALLOW_SNAP_ROOT_DESCENDANT,\n         DFSConfigKeys.\n             DFS_NAMENODE_SNAPSHOT_DIFF_ALLOW_SNAP_ROOT_DESCENDANT_DEFAULT);\n+    this.maxSnapshotLimitPerDirectory = conf.getInt(\n+        DFSConfigKeys.\n+            DFS_NAMENODE_SNAPSHOT_MAX_LIMIT,\n+        DFSConfigKeys.\n+            DFS_NAMENODE_SNAPSHOT_MAX_LIMIT_DEFAULT);\n     this.maxSnapshotLimit = conf.getInt(\n-        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_MAX_LIMIT,\n-        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_MAX_LIMIT_DEFAULT);\n+        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_GLOBAL_LIMIT,\n+        DFSConfigKeys.DFS_NAMENODE_SNAPSHOT_GLOBAL_LIMIT_DEFAULT);\n     LOG.info(\"Loaded config captureOpenFiles: \" + captureOpenFiles\n         + \", skipCaptureAccessTimeOnlyChange: \"\n         + skipCaptureAccessTimeOnlyChange\n         + \", snapshotDiffAllowSnapRootDescendant: \"\n         + snapshotDiffAllowSnapRootDescendant\n         + \", maxSnapshotLimit: \"\n-        + maxSnapshotLimit);\n+        + maxSnapshotLimit", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4NzMyNA=="}, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwMTM0MTQyOnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzozMDoxNlrOG7CS3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODoyNjowNFrOG7EMBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU1Njc2NA==", "bodyText": "Let's call this filesystem.limit?  Since there are multiple datacenter settings, \"global\" may be confusing.", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r464556764", "createdAt": "2020-08-03T17:30:16Z", "author": {"login": "szetszwo"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "diffHunk": "@@ -498,9 +498,14 @@\n   public static final int\n       DFS_NAMENODE_SNAPSHOT_DIFF_LISTING_LIMIT_DEFAULT = 1000;\n \n-  public static final String DFS_NAMENODE_SNAPSHOT_MAX_LIMIT =\n-      \"dfs.namenode.snapshot.max.limit\";\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_MAX_LIMIT = \"dfs.namenode.snapshot.max.limit\";\n   public static final int DFS_NAMENODE_SNAPSHOT_MAX_LIMIT_DEFAULT = 65536;\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_GLOBAL_LIMIT = \"dfs.namenode.snapshot.global.limit\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU4Nzc4Mw==", "bodyText": "done", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r464587783", "createdAt": "2020-08-03T18:26:04Z", "author": {"login": "bshashikant"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSConfigKeys.java", "diffHunk": "@@ -498,9 +498,14 @@\n   public static final int\n       DFS_NAMENODE_SNAPSHOT_DIFF_LISTING_LIMIT_DEFAULT = 1000;\n \n-  public static final String DFS_NAMENODE_SNAPSHOT_MAX_LIMIT =\n-      \"dfs.namenode.snapshot.max.limit\";\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_MAX_LIMIT = \"dfs.namenode.snapshot.max.limit\";\n   public static final int DFS_NAMENODE_SNAPSHOT_MAX_LIMIT_DEFAULT = 65536;\n+  public static final String\n+      DFS_NAMENODE_SNAPSHOT_GLOBAL_LIMIT = \"dfs.namenode.snapshot.global.limit\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU1Njc2NA=="}, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwMTQzMzEzOnYy", "diffSide": "RIGHT", "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzo1MzoyOFrOG7DMBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxODoyNTo1NlrOG7ELyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU3MTM5Ng==", "bodyText": "Let's keep using maxSnapshotLimit for per directory limit and add a new variable for the new filesystem limit so that it is consistent with the conf.", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r464571396", "createdAt": "2020-08-03T17:53:28Z", "author": {"login": "szetszwo"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -99,13 +99,15 @@\n \n   private boolean allowNestedSnapshots = false;\n   private int snapshotCounter = 0;\n+  private final int maxSnapshotLimitPerDirectory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU4MTc4Mw==", "bodyText": "sure", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r464581783", "createdAt": "2020-08-03T18:14:06Z", "author": {"login": "bshashikant"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -99,13 +99,15 @@\n \n   private boolean allowNestedSnapshots = false;\n   private int snapshotCounter = 0;\n+  private final int maxSnapshotLimitPerDirectory;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU3MTM5Ng=="}, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU4NzcyMA==", "bodyText": "sure", "url": "https://github.com/apache/hadoop/pull/2175#discussion_r464587720", "createdAt": "2020-08-03T18:25:56Z", "author": {"login": "bshashikant"}, "path": "hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/snapshot/SnapshotManager.java", "diffHunk": "@@ -99,13 +99,15 @@\n \n   private boolean allowNestedSnapshots = false;\n   private int snapshotCounter = 0;\n+  private final int maxSnapshotLimitPerDirectory;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU3MTM5Ng=="}, "originalCommit": {"oid": "a2e52ff263fc1f1e3fefd42093cae29c87a458b2"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3341, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}