{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMjk3ODg2", "number": 2113, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjo1MjoxNFrOELj4EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjo1MjoxNFrOELj4EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTU3NTg0OnYy", "diffSide": "RIGHT", "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/ITestS3AFileOperationCost.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjo1MjoxNFrOGtK2Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwODo0NTozMlrOGt05wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxNjc4Nw==", "bodyText": "Both these tests look almost the same in terms operation counts and also the symlink resolution is always disabled.\nCan you please tell me why do we need two tests here? Thanks.", "url": "https://github.com/apache/hadoop/pull/2113#discussion_r450016787", "createdAt": "2020-07-06T06:52:14Z", "author": {"login": "mukund-thakur"}, "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/ITestS3AFileOperationCost.java", "diffHunk": "@@ -574,4 +574,48 @@ public void testCreateCost() throws Throwable {\n     }\n \n   }\n+\n+  @Test\n+  public void testCostOfGlobStatus() throws Throwable {\n+    describe(\"Test globStatus has expected cost\");\n+    S3AFileSystem fs = getFileSystem();\n+    assume(\"Unguarded FS only\", !fs.hasMetadataStore());\n+\n+    Path basePath = path(\"testCostOfGlobStatus/nextFolder/\");\n+\n+    // create a bunch of files\n+    int filesToCreate = 10;\n+    for (int i = 0; i < filesToCreate; i++) {\n+      try (FSDataOutputStream out = fs.create(basePath.suffix(\"/\" + i))) {\n+        verifyOperationCount(1, 1);\n+      }\n+    }\n+\n+    fs.globStatus(basePath.suffix(\"/*\"));\n+    // 2 head + 1 list from getFileStatus on path,\n+    // plus 1 list to match the glob pattern\n+    verifyOperationCount(2, 2);\n+  }\n+\n+  @Test\n+  public void testCostOfGlobStatusNoSymlinkResolution() throws Throwable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9ec88847f441e51ae06d4de9bbbf0feaa706a1b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM2MDg1Nw==", "bodyText": "So these tests two different things, a directory with multiple objects and a directory with one object. The directory with a single object is the special case that triggers attempted symlink resolution, so I wanted to carve out that special case in its own test.\nThe multiple-objects-in-a-directory test is a general test that it felt like globStatus should have, whereas the second one was specifically made to catch the regression.\nIf you don't think that the multiple objects test is justified, I can remove it. Thoughts?", "url": "https://github.com/apache/hadoop/pull/2113#discussion_r450360857", "createdAt": "2020-07-06T17:03:15Z", "author": {"login": "jimmy-zuber-amzn"}, "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/ITestS3AFileOperationCost.java", "diffHunk": "@@ -574,4 +574,48 @@ public void testCreateCost() throws Throwable {\n     }\n \n   }\n+\n+  @Test\n+  public void testCostOfGlobStatus() throws Throwable {\n+    describe(\"Test globStatus has expected cost\");\n+    S3AFileSystem fs = getFileSystem();\n+    assume(\"Unguarded FS only\", !fs.hasMetadataStore());\n+\n+    Path basePath = path(\"testCostOfGlobStatus/nextFolder/\");\n+\n+    // create a bunch of files\n+    int filesToCreate = 10;\n+    for (int i = 0; i < filesToCreate; i++) {\n+      try (FSDataOutputStream out = fs.create(basePath.suffix(\"/\" + i))) {\n+        verifyOperationCount(1, 1);\n+      }\n+    }\n+\n+    fs.globStatus(basePath.suffix(\"/*\"));\n+    // 2 head + 1 list from getFileStatus on path,\n+    // plus 1 list to match the glob pattern\n+    verifyOperationCount(2, 2);\n+  }\n+\n+  @Test\n+  public void testCostOfGlobStatusNoSymlinkResolution() throws Throwable {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxNjc4Nw=="}, "originalCommit": {"oid": "a9ec88847f441e51ae06d4de9bbbf0feaa706a1b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNTg1Ng==", "bodyText": "I got it it. \n  \n    \n      hadoop/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/Globber.java\n    \n    \n         Line 292\n      in\n      f77bbc2\n    \n    \n    \n    \n\n        \n          \n           if (children.length == 1) { \n        \n    \n  \n\n\nThanks.", "url": "https://github.com/apache/hadoop/pull/2113#discussion_r450705856", "createdAt": "2020-07-07T08:45:32Z", "author": {"login": "mukund-thakur"}, "path": "hadoop-tools/hadoop-aws/src/test/java/org/apache/hadoop/fs/s3a/ITestS3AFileOperationCost.java", "diffHunk": "@@ -574,4 +574,48 @@ public void testCreateCost() throws Throwable {\n     }\n \n   }\n+\n+  @Test\n+  public void testCostOfGlobStatus() throws Throwable {\n+    describe(\"Test globStatus has expected cost\");\n+    S3AFileSystem fs = getFileSystem();\n+    assume(\"Unguarded FS only\", !fs.hasMetadataStore());\n+\n+    Path basePath = path(\"testCostOfGlobStatus/nextFolder/\");\n+\n+    // create a bunch of files\n+    int filesToCreate = 10;\n+    for (int i = 0; i < filesToCreate; i++) {\n+      try (FSDataOutputStream out = fs.create(basePath.suffix(\"/\" + i))) {\n+        verifyOperationCount(1, 1);\n+      }\n+    }\n+\n+    fs.globStatus(basePath.suffix(\"/*\"));\n+    // 2 head + 1 list from getFileStatus on path,\n+    // plus 1 list to match the glob pattern\n+    verifyOperationCount(2, 2);\n+  }\n+\n+  @Test\n+  public void testCostOfGlobStatusNoSymlinkResolution() throws Throwable {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxNjc4Nw=="}, "originalCommit": {"oid": "a9ec88847f441e51ae06d4de9bbbf0feaa706a1b"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3482, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}