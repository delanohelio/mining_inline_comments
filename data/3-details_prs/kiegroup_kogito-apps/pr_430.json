{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MjQ0MTM0", "number": 430, "title": "KOGITO-3229 Update TrustyUI Explanation section following API changes", "bodyText": "Link to jira ticket\nFollowing changes to the APIs regarding decisions explanation, this PR updates trusty UI to reflect them.\nExplanation data is no more provided at execution level. The /saliencies endpoint replaces the old /featureImportance and it now provides a different set of features scores for each execution outcome.", "createdAt": "2020-09-01T18:01:34Z", "url": "https://github.com/kiegroup/kogito-apps/pull/430", "merged": true, "mergeCommit": {"oid": "67625b9699cc580a44bd9e01b55a076214bba1f7"}, "closed": true, "closedAt": "2020-09-04T14:41:05Z", "author": {"login": "kelvah"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdErMJVgH2gAyNDc3MjQ0MTM0OjhjYmVjMWZhNDUzYjczM2M3Yjc1YWI0ODYwNTJkODA1NmIzMzc0YTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFlZOnAFqTQ4MjY2MTAyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8cbec1fa453b733c7b75ab486052d8056b3374a2", "author": {"user": {"login": "kelvah", "name": "roberto emanuel"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/8cbec1fa453b733c7b75ab486052d8056b3374a2", "committedDate": "2020-09-01T17:52:07Z", "message": "KOGITO-3229 Updating Explanation section following API changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNjgzMzky", "url": "https://github.com/kiegroup/kogito-apps/pull/430#pullrequestreview-480683392", "createdAt": "2020-09-02T10:23:36Z", "commit": {"oid": "8cbec1fa453b733c7b75ab486052d8056b3374a2"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMDoyMzozNlrOHLosZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMDozMDozMVrOHLo7KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk2MzEwOA==", "bodyText": "There's talk on zulip of using executions/decisions/{exId}/explain/saliencies.\n@r00ta @kostola What was finally agreed?", "url": "https://github.com/kiegroup/kogito-apps/pull/430#discussion_r481963108", "createdAt": "2020-09-02T10:23:36Z", "author": {"login": "manstis"}, "path": "ui-packages/packages/trusty/api-mock/routes.json", "diffHunk": "@@ -4,5 +4,5 @@\n   \"/executions/:executionType/:executionId/structuredInputs\": \"/inputs?executionId=:executionId\",\n   \"/executions/:executionType/:executionId/outcomes\": \"/outcomes?header.executionId=:executionId&singular=1\",\n   \"/executions/:executionType/:executionId/outcomes/:outcomeId\": \"/outcomeDetail?outcomeId=:outcomeId&singular=1\",\n-  \"/executions/:executionType/:executionId/featureImportance\": \"/featureImportance?executionId=:executionId\"\n+  \"/executions/:executionType/:executionId/saliencies\": \"/saliencies\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cbec1fa453b733c7b75ab486052d8056b3374a2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk2Njc5NQ==", "bodyText": "Is this still the correct name for this hook?", "url": "https://github.com/kiegroup/kogito-apps/pull/430#discussion_r481966795", "createdAt": "2020-09-02T10:30:21Z", "author": {"login": "manstis"}, "path": "ui-packages/packages/trusty/src/components/Templates/Explanation/useFeaturesScores.tsx", "diffHunk": "@@ -1,57 +1,42 @@\n import { useEffect, useState } from 'react';\n-import { RemoteData, FeatureScores } from '../../../types';\n-import { AxiosRequestConfig } from 'axios';\n-import { EXECUTIONS_PATH, httpClient } from '../../../utils/api/httpClient';\n-import { orderBy } from 'lodash';\n+import { FeatureScores, RemoteData, Saliencies } from '../../../types';\n+import { orderBy, find } from 'lodash';\n \n-const useFeaturesScores = (executionId: string) => {\n-  const [featuresScores, setFeaturesScores] = useState<\n-    RemoteData<Error, FeatureScores[]>\n-  >({\n-    status: 'NOT_ASKED'\n-  });\n+const useFeaturesScores = (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cbec1fa453b733c7b75ab486052d8056b3374a2"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk2Njg4OQ==", "bodyText": "(And file name)", "url": "https://github.com/kiegroup/kogito-apps/pull/430#discussion_r481966889", "createdAt": "2020-09-02T10:30:31Z", "author": {"login": "manstis"}, "path": "ui-packages/packages/trusty/src/components/Templates/Explanation/useFeaturesScores.tsx", "diffHunk": "@@ -1,57 +1,42 @@\n import { useEffect, useState } from 'react';\n-import { RemoteData, FeatureScores } from '../../../types';\n-import { AxiosRequestConfig } from 'axios';\n-import { EXECUTIONS_PATH, httpClient } from '../../../utils/api/httpClient';\n-import { orderBy } from 'lodash';\n+import { FeatureScores, RemoteData, Saliencies } from '../../../types';\n+import { orderBy, find } from 'lodash';\n \n-const useFeaturesScores = (executionId: string) => {\n-  const [featuresScores, setFeaturesScores] = useState<\n-    RemoteData<Error, FeatureScores[]>\n-  >({\n-    status: 'NOT_ASKED'\n-  });\n+const useFeaturesScores = (", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk2Njc5NQ=="}, "originalCommit": {"oid": "8cbec1fa453b733c7b75ab486052d8056b3374a2"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb9100576c79dcb49c1ccb3990fe3ea679c695d0", "author": {"user": {"login": "kelvah", "name": "roberto emanuel"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/fb9100576c79dcb49c1ccb3990fe3ea679c695d0", "committedDate": "2020-09-02T11:25:56Z", "message": "KOGITO-3229 Fixed full explanation chart not closing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7ed79a1d3ea629a681f446495e13954a8599ac3", "author": {"user": {"login": "kelvah", "name": "roberto emanuel"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/e7ed79a1d3ea629a681f446495e13954a8599ac3", "committedDate": "2020-09-02T13:36:27Z", "message": "KOGITO-3229 Fixed saliencies endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTQ0NTA4", "url": "https://github.com/kiegroup/kogito-apps/pull/430#pullrequestreview-480944508", "createdAt": "2020-09-02T15:31:10Z", "commit": {"oid": "e7ed79a1d3ea629a681f446495e13954a8599ac3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a970d59db8ace526e773640cb5c03ef905b0ef14", "author": {"user": {"login": "kelvah", "name": "roberto emanuel"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/a970d59db8ace526e773640cb5c03ef905b0ef14", "committedDate": "2020-09-03T14:56:42Z", "message": "KOGITO-3229 Removed links to other dashboards"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNTE1NzA4", "url": "https://github.com/kiegroup/kogito-apps/pull/430#pullrequestreview-482515708", "createdAt": "2020-09-04T09:47:57Z", "commit": {"oid": "a970d59db8ace526e773640cb5c03ef905b0ef14"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwOTo0Nzo1N1rOHNHPAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwOTo1NDozOVrOHNHcbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzUxMjA2Ng==", "bodyText": "I would consider putting all the status values into an enum and replace the occurrences of string literals, but not introduced in this PR.", "url": "https://github.com/kiegroup/kogito-apps/pull/430#discussion_r483512066", "createdAt": "2020-09-04T09:47:57Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/trusty/src/components/Templates/Explanation/Explanation.tsx", "diffHunk": "@@ -162,9 +177,9 @@ const Explanation = ({ outcomes }: ExplanationProps) => {\n               </Title>\n             </StackItem>\n             <StackItem>\n-              {(featuresScores.status === 'LOADING' ||\n-                (featuresScores.status === 'SUCCESS' &&\n-                  featuresScores.data.length > 0)) && (\n+              {(saliencies.status === 'LOADING' ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a970d59db8ace526e773640cb5c03ef905b0ef14"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzUxMzYxOA==", "bodyText": "especially here would the enums be useful - I have troubles identifying what the applicable values are in which property.", "url": "https://github.com/kiegroup/kogito-apps/pull/430#discussion_r483513618", "createdAt": "2020-09-04T09:50:59Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/trusty/src/components/Templates/Explanation/tests/useFeaturesScores.test.tsx", "diffHunk": "@@ -1,21 +1,37 @@\n import { renderHook } from '@testing-library/react-hooks';\n import useFeaturesScores from '../useFeaturesScores';\n-import * as api from '../../../../utils/api/httpClient';\n-import { FeatureScores } from '../../../../types';\n-import { act } from 'react-test-renderer';\n+import { RemoteData, Saliencies } from '../../../../types';\n import { orderBy } from 'lodash';\n \n-const flushPromises = () => new Promise(setImmediate);\n-const apiMock = jest.spyOn(api, 'httpClient');\n-\n-beforeEach(() => {\n-  apiMock.mockClear();\n-});\n-\n describe('useFeaturesScores', () => {\n   test('retrieves feature scores of an execution', async () => {\n-    const scores = {\n-      data: {\n+    const { result } = renderHook(() => {\n+      // tslint:disable-next-line:react-hooks-nesting\n+      return useFeaturesScores(\n+        saliencies,\n+        'b2b0ed8d-c1e2-46b5-3ac54ff4beae-1000'\n+      );\n+    });\n+    let sortedFeatures;\n+    if (saliencies.status === 'SUCCESS') {\n+      sortedFeatures = orderBy(\n+        saliencies.data.saliencies[0].featureImportance,\n+        item => Math.abs(item.featureScore),\n+        'asc'\n+      );\n+    }\n+\n+    expect(result.current.featuresScores).toStrictEqual(sortedFeatures);\n+  });\n+});\n+\n+const saliencies = {\n+  status: 'SUCCESS',\n+  data: {\n+    status: 'SUCCEEDED',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a970d59db8ace526e773640cb5c03ef905b0ef14"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzUxNTUwMQ==", "bodyText": "I would suggest rely here on an enum that'd be exported and used globally.", "url": "https://github.com/kiegroup/kogito-apps/pull/430#discussion_r483515501", "createdAt": "2020-09-04T09:54:39Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/trusty/src/types.ts", "diffHunk": "@@ -70,9 +70,20 @@ export interface Outcome {\n \n export interface FeatureScores {\n   featureName: string;\n+  featureId: string;\n   featureScore: number;\n }\n \n+export interface Saliency {\n+  outcomeId: string;\n+  featureImportance: FeatureScores[];\n+}\n+export interface Saliencies {\n+  status: 'SUCCEEDED' | 'FAILED';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a970d59db8ace526e773640cb5c03ef905b0ef14"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNjE2MTU5", "url": "https://github.com/kiegroup/kogito-apps/pull/430#pullrequestreview-482616159", "createdAt": "2020-09-04T12:38:24Z", "commit": {"oid": "a970d59db8ace526e773640cb5c03ef905b0ef14"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNjYxMDI5", "url": "https://github.com/kiegroup/kogito-apps/pull/430#pullrequestreview-482661029", "createdAt": "2020-09-04T13:40:54Z", "commit": {"oid": "a970d59db8ace526e773640cb5c03ef905b0ef14"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4745, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}