{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1Nzk0NjI3", "number": 273, "reviewThreads": {"totalCount": 31, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOToxODozM1rOEGq3eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMzoxNzo0NlrOEHkSAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDI5MjQyOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/main/resources/META-INF/kogito-cache-default.xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwOToxODozM1rOGlm7GA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNjozODoxOFrOGnIoGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA4ODIxNg==", "bodyText": "Is this file needed?", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r442088216", "createdAt": "2020-06-18T09:18:33Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-service/src/main/resources/META-INF/kogito-cache-default.xml", "diffHunk": "@@ -0,0 +1,14 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "597ff4b3f25ed7616047c6c12acae409d22f7500"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYwNjQxMQ==", "bodyText": "Yes, it is needed by \n  \n    \n      kogito-apps/persistence-commons/persistence-commons-infinispan/src/main/java/org/kie/kogito/persistence/infinispan/cache/InfinispanCacheManager.java\n    \n    \n         Line 97\n      in\n      a57350f\n    \n    \n    \n    \n\n        \n          \n           RemoteCache<K, V> cache = manager.administration().getOrCreateCache(name, new KogitoCacheDefaultConfiguration(name)); \n        \n    \n  \n\n . But actually it would make sense to move it to trusty-persistence-infinispan, wdyt?", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443606411", "createdAt": "2020-06-22T14:36:59Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/src/main/resources/META-INF/kogito-cache-default.xml", "diffHunk": "@@ -0,0 +1,14 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA4ODIxNg=="}, "originalCommit": {"oid": "597ff4b3f25ed7616047c6c12acae409d22f7500"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY4ODk4Nw==", "bodyText": "Yes it should be better \ud83d\udc4d", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443688987", "createdAt": "2020-06-22T16:38:18Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-service/src/main/resources/META-INF/kogito-cache-default.xml", "diffHunk": "@@ -0,0 +1,14 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA4ODIxNg=="}, "originalCommit": {"oid": "597ff4b3f25ed7616047c6c12acae409d22f7500"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA2ODY2OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "isResolved": false, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDoyNToyNVrOGmoMFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwOTo1NDozN1rOGoLQew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NzUyNA==", "bodyText": "Is there any reason to use context classloader \"Thread.currentThread().getContextClassLoader()\" instead of \"this.getClass().getResourceAsStream()\".", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443157524", "createdAt": "2020-06-20T20:25:25Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Inject;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.FileDescriptorSource;\n+import org.infinispan.protostream.MessageMarshaller;\n+\n+@ApplicationScoped\n+public class ProtostreamProducer {\n+\n+    @Inject\n+    ObjectMapper mapper;\n+\n+    @Produces\n+    FileDescriptorSource kogitoTypesDescriptor() throws IOException {\n+        FileDescriptorSource source = new FileDescriptorSource();\n+        source.addProtoFile(\"decision.proto\", Thread.currentThread().getContextClassLoader().getResourceAsStream(\"META-INF/decision.proto\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5NDIwMw==", "bodyText": "Hi, the equivalent code would be this.getClass().getClassLoader().getResourceAsStream(\"META-INF/decision.proto\")). TCCL is in general preferred, but in this case it's not a big deal (https://access.redhat.com/solutions/3097731). lmkwyt", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443394203", "createdAt": "2020-06-22T08:24:47Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Inject;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.FileDescriptorSource;\n+import org.infinispan.protostream.MessageMarshaller;\n+\n+@ApplicationScoped\n+public class ProtostreamProducer {\n+\n+    @Inject\n+    ObjectMapper mapper;\n+\n+    @Produces\n+    FileDescriptorSource kogitoTypesDescriptor() throws IOException {\n+        FileDescriptorSource source = new FileDescriptorSource();\n+        source.addProtoFile(\"decision.proto\", Thread.currentThread().getContextClassLoader().getResourceAsStream(\"META-INF/decision.proto\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NzUyNA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQzMTQ2OQ==", "bodyText": "@r00ta\nI agree that this is a detail. But if I understand correctly the code we want to load \"META-INF/decision.proto\" is in the same jar as class and we do not expect that user will change this file in his deployment. Therefore I expect we want to use the same classloader as our class do.\nHowever, I understand that this is only a detail and we will probably never do Wildfly module or something from this code. So, I have no strong opinion on this.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443431469", "createdAt": "2020-06-22T09:28:49Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Inject;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.FileDescriptorSource;\n+import org.infinispan.protostream.MessageMarshaller;\n+\n+@ApplicationScoped\n+public class ProtostreamProducer {\n+\n+    @Inject\n+    ObjectMapper mapper;\n+\n+    @Produces\n+    FileDescriptorSource kogitoTypesDescriptor() throws IOException {\n+        FileDescriptorSource source = new FileDescriptorSource();\n+        source.addProtoFile(\"decision.proto\", Thread.currentThread().getContextClassLoader().getResourceAsStream(\"META-INF/decision.proto\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NzUyNA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU1MjkxOQ==", "bodyText": "For the record, fine for me to review this usage but if we decide to change, please update this too \n  \n    \n      kogito-apps/data-index/data-index-storage/data-index-storage-protobuf/src/main/java/org/kie/kogito/index/protobuf/ProtostreamProducer.java\n    \n    \n        Lines 35 to 36\n      in\n      3604788\n    \n    \n    \n    \n\n        \n          \n           source.addProtoFile(KOGITO_INDEX_PROTO, Thread.currentThread().getContextClassLoader().getResourceAsStream(\"META-INF/kogito-index.proto\")); \n        \n\n        \n          \n           source.addProtoFile(KOGITO_TYPES_PROTO, Thread.currentThread().getContextClassLoader().getResourceAsStream(\"kogito-types.proto\"));", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443552919", "createdAt": "2020-06-22T13:21:34Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Inject;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.FileDescriptorSource;\n+import org.infinispan.protostream.MessageMarshaller;\n+\n+@ApplicationScoped\n+public class ProtostreamProducer {\n+\n+    @Inject\n+    ObjectMapper mapper;\n+\n+    @Produces\n+    FileDescriptorSource kogitoTypesDescriptor() throws IOException {\n+        FileDescriptorSource source = new FileDescriptorSource();\n+        source.addProtoFile(\"decision.proto\", Thread.currentThread().getContextClassLoader().getResourceAsStream(\"META-INF/decision.proto\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NzUyNA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA2NDMxNg==", "bodyText": "ok, If you agree I would change it for trusty in the current PR, and then in another one I'll change it for the data-index", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444064316", "createdAt": "2020-06-23T08:48:22Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Inject;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.FileDescriptorSource;\n+import org.infinispan.protostream.MessageMarshaller;\n+\n+@ApplicationScoped\n+public class ProtostreamProducer {\n+\n+    @Inject\n+    ObjectMapper mapper;\n+\n+    @Produces\n+    FileDescriptorSource kogitoTypesDescriptor() throws IOException {\n+        FileDescriptorSource source = new FileDescriptorSource();\n+        source.addProtoFile(\"decision.proto\", Thread.currentThread().getContextClassLoader().getResourceAsStream(\"META-INF/decision.proto\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NzUyNA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA2NTI0NA==", "bodyText": "To be honest it is fine for me to stay with the current code, I just mentioned that the same strategy is used in data-index so if we will change, we should update that code too. :)", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444065244", "createdAt": "2020-06-23T08:49:50Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Inject;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.FileDescriptorSource;\n+import org.infinispan.protostream.MessageMarshaller;\n+\n+@ApplicationScoped\n+public class ProtostreamProducer {\n+\n+    @Inject\n+    ObjectMapper mapper;\n+\n+    @Produces\n+    FileDescriptorSource kogitoTypesDescriptor() throws IOException {\n+        FileDescriptorSource source = new FileDescriptorSource();\n+        source.addProtoFile(\"decision.proto\", Thread.currentThread().getContextClassLoader().getResourceAsStream(\"META-INF/decision.proto\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NzUyNA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE2NTgzMA==", "bodyText": "Also from my side I think we can stay with the current implementation.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444165830", "createdAt": "2020-06-23T11:54:19Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Inject;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.FileDescriptorSource;\n+import org.infinispan.protostream.MessageMarshaller;\n+\n+@ApplicationScoped\n+public class ProtostreamProducer {\n+\n+    @Inject\n+    ObjectMapper mapper;\n+\n+    @Produces\n+    FileDescriptorSource kogitoTypesDescriptor() throws IOException {\n+        FileDescriptorSource source = new FileDescriptorSource();\n+        source.addProtoFile(\"decision.proto\", Thread.currentThread().getContextClassLoader().getResourceAsStream(\"META-INF/decision.proto\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NzUyNA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc4MDY2Nw==", "bodyText": "Ok, I have no problem with it.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444780667", "createdAt": "2020-06-24T09:54:37Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Inject;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.FileDescriptorSource;\n+import org.infinispan.protostream.MessageMarshaller;\n+\n+@ApplicationScoped\n+public class ProtostreamProducer {\n+\n+    @Inject\n+    ObjectMapper mapper;\n+\n+    @Produces\n+    FileDescriptorSource kogitoTypesDescriptor() throws IOException {\n+        FileDescriptorSource source = new FileDescriptorSource();\n+        source.addProtoFile(\"decision.proto\", Thread.currentThread().getContextClassLoader().getResourceAsStream(\"META-INF/decision.proto\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NzUyNA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3MDM5OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-storage/trusty-storage-mongo/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDoyODo0NlrOGmoM7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwNzoxNzowOFrOGm0ikw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1Nzc0Mw==", "bodyText": "There is only a pom in this module. I would suggest to create Mongo implementation in a separate PR. By creating an empty Mongo module we probably make a false assumption that we implement it.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443157743", "createdAt": "2020-06-20T20:28:46Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-storage/trusty-storage-mongo/pom.xml", "diffHunk": "@@ -0,0 +1,16 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM1OTg5MQ==", "bodyText": "Done", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443359891", "createdAt": "2020-06-22T07:17:08Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-mongo/pom.xml", "diffHunk": "@@ -0,0 +1,16 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1Nzc0Mw=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3MTQ4OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/mocks/StorageImplMock.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozMTowMlrOGmoNgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozMTowMlrOGmoNgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1Nzg4OA==", "bodyText": "Please add missing license header.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443157888", "createdAt": "2020-06-20T20:31:02Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/mocks/StorageImplMock.java", "diffHunk": "@@ -0,0 +1,92 @@\n+package org.kie.kogito.trusty.service.mocks;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3MTkzOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozMTo1OFrOGmoNuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozMTo1OFrOGmoNuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1Nzk0NQ==", "bodyText": "Please add missing license header.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443157945", "createdAt": "2020-06-20T20:31:58Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.kie.kogito.trusty.storage.infinispan;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3MjY3OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-storage/trusty-storage-api/src/main/java/org/kie/kogito/trusty/storage/api/TrustyStorageServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozMzo1MlrOGmoOIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozMzo1MlrOGmoOIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODA0OQ==", "bodyText": "Missing license header.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158049", "createdAt": "2020-06-20T20:33:52Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-storage/trusty-storage-api/src/main/java/org/kie/kogito/trusty/storage/api/TrustyStorageServiceImpl.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package org.kie.kogito.trusty.storage.api;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3Mjg5OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/api/DecisionApiV1.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozNDoyMVrOGmoOOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozNDoyMVrOGmoOOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODA3NQ==", "bodyText": "Missing license header.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158075", "createdAt": "2020-06-20T20:34:21Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/api/DecisionApiV1.java", "diffHunk": "@@ -0,0 +1,40 @@\n+package org.kie.kogito.trusty.service.api;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3NDYxOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozNzo1MFrOGmoPHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozNzo1MFrOGmoPHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODMwMA==", "bodyText": "I would suggest to not use a capital letter as the first letter of the method.  Also do not use underline.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158300", "createdAt": "2020-06-20T20:37:50Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "diffHunk": "@@ -16,6 +16,92 @@\n \n package org.kie.kogito.trusty.service;\n \n+import java.time.OffsetDateTime;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.quarkus.test.junit.mockito.InjectMock;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.Query;\n+import org.kie.kogito.persistence.infinispan.cache.StorageImpl;\n+import org.kie.kogito.trusty.service.mocks.StorageImplMock;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+import org.mockito.invocation.InvocationOnMock;\n+import org.mockito.stubbing.Answer;\n+\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.doAnswer;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+@QuarkusTest\n public class TrustyServiceTest {\n \n+    @Inject\n+    TrustyService trustyService;\n+\n+    @InjectMock\n+    TrustyStorageService storageService;\n+\n+    @Test\n+    void GivenADecision_WhenStoreDecisionIsCalled_ThenNoExceptionsAreThrown() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3NDY0OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozNzo1NlrOGmoPIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozNzo1NlrOGmoPIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODMwNA==", "bodyText": "I would suggest to not use a capital letter as the first letter of the method. Also do not use underline.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158304", "createdAt": "2020-06-20T20:37:56Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "diffHunk": "@@ -16,6 +16,92 @@\n \n package org.kie.kogito.trusty.service;\n \n+import java.time.OffsetDateTime;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.quarkus.test.junit.mockito.InjectMock;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.Query;\n+import org.kie.kogito.persistence.infinispan.cache.StorageImpl;\n+import org.kie.kogito.trusty.service.mocks.StorageImplMock;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+import org.mockito.invocation.InvocationOnMock;\n+import org.mockito.stubbing.Answer;\n+\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.doAnswer;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+@QuarkusTest\n public class TrustyServiceTest {\n \n+    @Inject\n+    TrustyService trustyService;\n+\n+    @InjectMock\n+    TrustyStorageService storageService;\n+\n+    @Test\n+    void GivenADecision_WhenStoreDecisionIsCalled_ThenNoExceptionsAreThrown() {\n+        Decision decision = new Decision();\n+        Storage storageMock = mock(Storage.class);\n+        when(storageMock.put(any(Object.class), any(Object.class))).thenReturn(decision);\n+\n+        when(storageService.getDecisionsStorage()).thenReturn(storageMock);\n+        Assertions.assertDoesNotThrow(() -> trustyService.storeDecision(\"test\", decision));\n+    }\n+\n+    @Test\n+    void GivenADecision_WhenADecisionIsStoredAndRetrieved_ThenTheOriginalObjectIsReturned() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3NDY1OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozODowM1rOGmoPJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDozODowM1rOGmoPJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODMxMA==", "bodyText": "I would suggest to not use a capital letter as the first letter of the method.  Also do not use underline.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158310", "createdAt": "2020-06-20T20:38:03Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "diffHunk": "@@ -16,6 +16,92 @@\n \n package org.kie.kogito.trusty.service;\n \n+import java.time.OffsetDateTime;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.quarkus.test.junit.mockito.InjectMock;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.Query;\n+import org.kie.kogito.persistence.infinispan.cache.StorageImpl;\n+import org.kie.kogito.trusty.service.mocks.StorageImplMock;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+import org.mockito.invocation.InvocationOnMock;\n+import org.mockito.stubbing.Answer;\n+\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.doAnswer;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+@QuarkusTest\n public class TrustyServiceTest {\n \n+    @Inject\n+    TrustyService trustyService;\n+\n+    @InjectMock\n+    TrustyStorageService storageService;\n+\n+    @Test\n+    void GivenADecision_WhenStoreDecisionIsCalled_ThenNoExceptionsAreThrown() {\n+        Decision decision = new Decision();\n+        Storage storageMock = mock(Storage.class);\n+        when(storageMock.put(any(Object.class), any(Object.class))).thenReturn(decision);\n+\n+        when(storageService.getDecisionsStorage()).thenReturn(storageMock);\n+        Assertions.assertDoesNotThrow(() -> trustyService.storeDecision(\"test\", decision));\n+    }\n+\n+    @Test\n+    void GivenADecision_WhenADecisionIsStoredAndRetrieved_ThenTheOriginalObjectIsReturned() {\n+        String executionId = \"executionId\";\n+        Decision decision = new Decision();\n+        decision.setExecutionId(executionId);\n+\n+        Query queryMock = mock(Query.class);\n+        when(queryMock.filter(any(List.class))).thenReturn(queryMock);\n+        when(queryMock.limit(any(Integer.class))).thenReturn(queryMock);\n+        when(queryMock.offset(any(Integer.class))).thenReturn(queryMock);\n+        when(queryMock.execute()).thenReturn(List.of(decision));\n+\n+        Storage storageMock = mock(Storage.class);\n+        when(storageMock.put(eq(executionId), any(Object.class))).thenReturn(decision);\n+        when(storageMock.containsKey(eq(executionId))).thenReturn(false);\n+        when(storageMock.query()).thenReturn(queryMock);\n+\n+        when(storageService.getDecisionsStorage()).thenReturn(storageMock);\n+\n+        trustyService.storeDecision(\"executionId\", decision);\n+\n+        List<Execution> result = trustyService.getExecutionHeaders(OffsetDateTime.now().minusDays(1), OffsetDateTime.now(), 100, 0, \"\");\n+\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(decision.getExecutionId(), result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    void GivenADecision_WhenADecisionIsStoredAndRetrievedById_ThenTheOriginalObjectIsReturned() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3NTUyOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MDowOVrOGmoPlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MDowOVrOGmoPlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODQyMA==", "bodyText": "I would suggest to not use a capital letter as the first letter of the method. Also do not use underline.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158420", "createdAt": "2020-06-20T20:40:09Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "diffHunk": "@@ -0,0 +1,98 @@\n+package org.kie.kogito.trusty.service;\n+\n+import java.time.Instant;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.common.QuarkusTestResource;\n+import io.quarkus.test.junit.QuarkusTest;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+\n+@QuarkusTest\n+@QuarkusTestResource(TrustyInfinispanServerTestResource.class)\n+public class TrustyServiceIT {\n+\n+    @Inject\n+    TrustyService trustyService;\n+\n+    @Inject\n+    TrustyStorageService trustyStorageService;\n+\n+    @BeforeEach\n+    public void setup() {\n+        trustyStorageService.getDecisionsStorage().clear();\n+    }\n+\n+    @Test\n+    public void testStoreAndRetrieveExecution() {\n+        storeExecution(\"myExecution\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692957000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692959000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenTwoExecutions_WhenTheQueryExcludesOneExecution_ThenOnlyOneExecutionIsReturned() {\n+        storeExecution(\"myExecution\", 1591692950000L);\n+        storeExecution(\"executionId2\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692940000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692955000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenTwoExecutions_WhenThePrefixIsUsed_ThenOnlyOneExecutionIsReturned() {\n+        storeExecution(\"myExecution\", 1591692950000L);\n+        storeExecution(\"executionId2\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692940000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692959000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"my\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenAnExecution_WhenGetDecisionByIdIsCalled_ThenTheExecutionIsReturned() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3NTU0OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MDoxNFrOGmoPmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MDoxNFrOGmoPmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODQyNg==", "bodyText": "I would suggest to not use a capital letter as the first letter of the method. Also do not use underline.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158426", "createdAt": "2020-06-20T20:40:14Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "diffHunk": "@@ -0,0 +1,98 @@\n+package org.kie.kogito.trusty.service;\n+\n+import java.time.Instant;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.common.QuarkusTestResource;\n+import io.quarkus.test.junit.QuarkusTest;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+\n+@QuarkusTest\n+@QuarkusTestResource(TrustyInfinispanServerTestResource.class)\n+public class TrustyServiceIT {\n+\n+    @Inject\n+    TrustyService trustyService;\n+\n+    @Inject\n+    TrustyStorageService trustyStorageService;\n+\n+    @BeforeEach\n+    public void setup() {\n+        trustyStorageService.getDecisionsStorage().clear();\n+    }\n+\n+    @Test\n+    public void testStoreAndRetrieveExecution() {\n+        storeExecution(\"myExecution\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692957000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692959000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenTwoExecutions_WhenTheQueryExcludesOneExecution_ThenOnlyOneExecutionIsReturned() {\n+        storeExecution(\"myExecution\", 1591692950000L);\n+        storeExecution(\"executionId2\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692940000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692955000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenTwoExecutions_WhenThePrefixIsUsed_ThenOnlyOneExecutionIsReturned() {\n+        storeExecution(\"myExecution\", 1591692950000L);\n+        storeExecution(\"executionId2\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692940000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692959000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"my\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenAnExecution_WhenGetDecisionByIdIsCalled_ThenTheExecutionIsReturned() {\n+        String executionId = \"myExecution\";\n+        storeExecution(executionId, 1591692950000L);\n+\n+        Decision result = trustyService.getDecisionById(executionId);\n+        Assertions.assertEquals(executionId, result.getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenADuplicatedDecision_WhenTheDecisionIsStored_ThenAnExceptionIsRaised() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3NTU5OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MDoyMVrOGmoPnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MDoyMVrOGmoPnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODQzMQ==", "bodyText": "I would suggest to not use a capital letter as the first letter of the method. Also do not use underline.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158431", "createdAt": "2020-06-20T20:40:21Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "diffHunk": "@@ -0,0 +1,98 @@\n+package org.kie.kogito.trusty.service;\n+\n+import java.time.Instant;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.common.QuarkusTestResource;\n+import io.quarkus.test.junit.QuarkusTest;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+\n+@QuarkusTest\n+@QuarkusTestResource(TrustyInfinispanServerTestResource.class)\n+public class TrustyServiceIT {\n+\n+    @Inject\n+    TrustyService trustyService;\n+\n+    @Inject\n+    TrustyStorageService trustyStorageService;\n+\n+    @BeforeEach\n+    public void setup() {\n+        trustyStorageService.getDecisionsStorage().clear();\n+    }\n+\n+    @Test\n+    public void testStoreAndRetrieveExecution() {\n+        storeExecution(\"myExecution\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692957000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692959000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenTwoExecutions_WhenTheQueryExcludesOneExecution_ThenOnlyOneExecutionIsReturned() {\n+        storeExecution(\"myExecution\", 1591692950000L);\n+        storeExecution(\"executionId2\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692940000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692955000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenTwoExecutions_WhenThePrefixIsUsed_ThenOnlyOneExecutionIsReturned() {\n+        storeExecution(\"myExecution\", 1591692950000L);\n+        storeExecution(\"executionId2\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692940000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692959000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"my\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenAnExecution_WhenGetDecisionByIdIsCalled_ThenTheExecutionIsReturned() {\n+        String executionId = \"myExecution\";\n+        storeExecution(executionId, 1591692950000L);\n+\n+        Decision result = trustyService.getDecisionById(executionId);\n+        Assertions.assertEquals(executionId, result.getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenADuplicatedDecision_WhenTheDecisionIsStored_ThenAnExceptionIsRaised() {\n+        String executionId = \"myExecution\";\n+        storeExecution(executionId, 1591692950000L);\n+        Assertions.assertThrows(IllegalArgumentException.class, () -> storeExecution(executionId, 1591692950000L));\n+    }\n+\n+    @Test\n+    public void GivenNoExecutions_WhenADecisionIsRetrieved_ThenAnExceptionIsRaised() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3NTc2OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MDozNVrOGmoPsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MDozNVrOGmoPsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODQ1MQ==", "bodyText": "I would suggest to not use a capital letter as the first letter of the method. Also do not use underline.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158451", "createdAt": "2020-06-20T20:40:35Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "diffHunk": "@@ -0,0 +1,98 @@\n+package org.kie.kogito.trusty.service;\n+\n+import java.time.Instant;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.common.QuarkusTestResource;\n+import io.quarkus.test.junit.QuarkusTest;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+\n+@QuarkusTest\n+@QuarkusTestResource(TrustyInfinispanServerTestResource.class)\n+public class TrustyServiceIT {\n+\n+    @Inject\n+    TrustyService trustyService;\n+\n+    @Inject\n+    TrustyStorageService trustyStorageService;\n+\n+    @BeforeEach\n+    public void setup() {\n+        trustyStorageService.getDecisionsStorage().clear();\n+    }\n+\n+    @Test\n+    public void testStoreAndRetrieveExecution() {\n+        storeExecution(\"myExecution\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692957000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692959000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenTwoExecutions_WhenTheQueryExcludesOneExecution_ThenOnlyOneExecutionIsReturned() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3NTkwOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MDo0MlrOGmoPxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MDo0MlrOGmoPxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODQ2OA==", "bodyText": "I would suggest to not use a capital letter as the first letter of the method. Also do not use underline.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158468", "createdAt": "2020-06-20T20:40:42Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "diffHunk": "@@ -0,0 +1,98 @@\n+package org.kie.kogito.trusty.service;\n+\n+import java.time.Instant;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.common.QuarkusTestResource;\n+import io.quarkus.test.junit.QuarkusTest;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+\n+@QuarkusTest\n+@QuarkusTestResource(TrustyInfinispanServerTestResource.class)\n+public class TrustyServiceIT {\n+\n+    @Inject\n+    TrustyService trustyService;\n+\n+    @Inject\n+    TrustyStorageService trustyStorageService;\n+\n+    @BeforeEach\n+    public void setup() {\n+        trustyStorageService.getDecisionsStorage().clear();\n+    }\n+\n+    @Test\n+    public void testStoreAndRetrieveExecution() {\n+        storeExecution(\"myExecution\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692957000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692959000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenTwoExecutions_WhenTheQueryExcludesOneExecution_ThenOnlyOneExecutionIsReturned() {\n+        storeExecution(\"myExecution\", 1591692950000L);\n+        storeExecution(\"executionId2\", 1591692958000L);\n+\n+        OffsetDateTime from = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692940000L), ZoneOffset.UTC);\n+        OffsetDateTime to = OffsetDateTime.ofInstant(Instant.ofEpochMilli(1591692955000L), ZoneOffset.UTC);\n+        List<Execution> result = trustyService.getExecutionHeaders(from, to, 100, 0, \"\");\n+        Assertions.assertEquals(1, result.size());\n+        Assertions.assertEquals(\"myExecution\", result.get(0).getExecutionId());\n+    }\n+\n+    @Test\n+    public void GivenTwoExecutions_WhenThePrefixIsUsed_ThenOnlyOneExecutionIsReturned() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3NzE3OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MzozMVrOGmoQbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0MzozMVrOGmoQbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODYzNg==", "bodyText": "License header is missing.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158636", "createdAt": "2020-06-20T20:43:31Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceIT.java", "diffHunk": "@@ -0,0 +1,98 @@\n+package org.kie.kogito.trusty.service;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3NzI3OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyInfinispanServerTestResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0Mzo0NVrOGmoQfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0Mzo0NVrOGmoQfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODY1Mg==", "bodyText": "License header is missing.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158652", "createdAt": "2020-06-20T20:43:45Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyInfinispanServerTestResource.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package org.kie.kogito.trusty.service;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA3NzQ1OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/api/DecisionsApiV1.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0NDowM1rOGmoQkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo0NDowM1rOGmoQkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1ODY3NA==", "bodyText": "License header is missing.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443158674", "createdAt": "2020-06-20T20:44:03Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/api/DecisionsApiV1.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package org.kie.kogito.trusty.service.api;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA4MDQ1OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/api/DecisionsApiV1.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo1MDo1NFrOGmoSFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo1MDo1NFrOGmoSFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1OTA2Mg==", "bodyText": "It seems that this logger is not used.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443159062", "createdAt": "2020-06-20T20:50:54Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/api/DecisionsApiV1.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package org.kie.kogito.trusty.service.api;\n+\n+import javax.inject.Inject;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+\n+import org.eclipse.microprofile.openapi.annotations.Operation;\n+import org.eclipse.microprofile.openapi.annotations.enums.SchemaType;\n+import org.eclipse.microprofile.openapi.annotations.media.Content;\n+import org.eclipse.microprofile.openapi.annotations.media.Schema;\n+import org.eclipse.microprofile.openapi.annotations.parameters.Parameter;\n+import org.eclipse.microprofile.openapi.annotations.responses.APIResponse;\n+import org.eclipse.microprofile.openapi.annotations.responses.APIResponses;\n+import org.jboss.resteasy.annotations.jaxrs.PathParam;\n+import org.kie.kogito.trusty.service.ITrustyService;\n+import org.kie.kogito.trusty.service.responses.ExecutionHeaderResponse;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+@Path(\"v1/executions/decisions\")\n+public class DecisionsApiV1 {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DecisionsApiV1.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA4MTU0OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo1MzoxMVrOGmoSmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwODo0MDo1MVrOGnfQWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1OTE5NA==", "bodyText": "MessageMarshaller is deprecated according to Sonar cloud.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443159194", "createdAt": "2020-06-20T20:53:11Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5NzIzMw==", "bodyText": "Yeah, I know. Currently the documentation of infinispan still uses it (https://infinispan.org/docs/dev/titles/developing/developing.html), and this is currently what we do in the data-index (https://github.com/kiegroup/kogito-apps/search?q=MessageMarshaller&unscoped_q=MessageMarshaller). I'll look for an alternative", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443397233", "createdAt": "2020-06-22T08:29:40Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1OTE5NA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQwODI3Mw==", "bodyText": "Apparently this is the only method to create a custom marshaller when it is not possible to annotate the class that has to be stored (in this case Decision). As a matter of facts, the idea is that Decision is in the api module and it is not infinispan specific. I'll ping the infinispan team to understand if there is an alternative", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443408273", "createdAt": "2020-06-22T08:48:57Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1OTE5NA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQxNzAwOQ==", "bodyText": "Unfortunately, this feature still has to be implemented https://issues.redhat.com/browse/IPROTO-137 . lmkwyt @jiripetrlik", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443417009", "createdAt": "2020-06-22T09:03:34Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1OTE5NA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQyNDU1OA==", "bodyText": "@r00ta\nHello, thank you for quick reply! I think we can keep deprecated interface for now and comment it with TODO and link to the https://issues.redhat.com/browse/IPROTO-137. Once IPROTO-137 is finished we can decide what to do about it.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443424558", "createdAt": "2020-06-22T09:16:56Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1OTE5NA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU1MzUzOA==", "bodyText": "@r00ta\nCan you please create a KOGITO ticket (unassigned is fine) to remove the usages of this method so we can track?", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443553538", "createdAt": "2020-06-22T13:22:32Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1OTE5NA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA1OTczNg==", "bodyText": "@danielezonca @jiripetrlik here it is https://issues.redhat.com/browse/KOGITO-2517", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444059736", "createdAt": "2020-06-23T08:40:51Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1OTE5NA=="}, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA4MTY5OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo1MzoyOVrOGmoSsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo1MzoyOVrOGmoSsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1OTIxNg==", "bodyText": "Missing license header.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443159216", "createdAt": "2020-06-20T20:53:29Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package org.kie.kogito.trusty.storage.infinispan;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MTA4MjE3OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo1NDozM1rOGmoS7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQyMDo1NDozM1rOGmoS7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1OTI3Ng==", "bodyText": "MessageMarshaller is deprecated according to Sonar cloud.", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443159276", "createdAt": "2020-06-20T20:54:33Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/ProtostreamProducer.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.enterprise.inject.Produces;\n+import javax.inject.Inject;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.FileDescriptorSource;\n+import org.infinispan.protostream.MessageMarshaller;\n+\n+@ApplicationScoped\n+public class ProtostreamProducer {\n+\n+    @Inject\n+    ObjectMapper mapper;\n+\n+    @Produces\n+    FileDescriptorSource kogitoTypesDescriptor() throws IOException {\n+        FileDescriptorSource source = new FileDescriptorSource();\n+        source.addProtoFile(\"decision.proto\", Thread.currentThread().getContextClassLoader().getResourceAsStream(\"META-INF/decision.proto\"));\n+        return source;\n+    }\n+\n+    @Produces\n+    MessageMarshaller decisionMarshaller() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97a619f94282ce22a979cbb1c4811bb3c8e84d44"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzAyNDkzOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/TrustyService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwOTo0ODo0M1rOGm5lvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwODoyOToxOVrOGnez6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ0MjYyMQ==", "bodyText": "Can you move strings to a constant class?", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443442621", "createdAt": "2020-06-22T09:48:43Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/TrustyService.java", "diffHunk": "@@ -17,25 +17,50 @@\n package org.kie.kogito.trusty.service;\n \n import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n import java.util.List;\n \n import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n \n-import org.jboss.resteasy.spi.NotImplementedYetException;\n-import org.kie.kogito.trusty.service.models.Execution;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.AttributeFilter;\n+import org.kie.kogito.persistence.api.query.QueryFilterFactory;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n \n @ApplicationScoped\n public class TrustyService implements ITrustyService {\n \n+    @Inject\n+    TrustyStorageService storageService;\n+\n     @Override\n     public List<Execution> getExecutionHeaders(OffsetDateTime from, OffsetDateTime to, int limit, int offset, String prefix) {\n-        throw new NotImplementedYetException(\"Not implemented yet.\");\n+        Storage<String, Decision> storage = storageService.getDecisionsStorage();\n+        List<AttributeFilter<?>> filters = new ArrayList<>();\n+        filters.add(QueryFilterFactory.like(\"executionId\", prefix + \"*\"));\n+        filters.add(QueryFilterFactory.greaterThanEqual(\"executionTimestamp\", from.toInstant().toEpochMilli()));\n+        filters.add(QueryFilterFactory.lessThanEqual(\"executionTimestamp\", to.toInstant().toEpochMilli()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA1MjQ1OQ==", "bodyText": "Done", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444052459", "createdAt": "2020-06-23T08:29:19Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/TrustyService.java", "diffHunk": "@@ -17,25 +17,50 @@\n package org.kie.kogito.trusty.service;\n \n import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n import java.util.List;\n \n import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n \n-import org.jboss.resteasy.spi.NotImplementedYetException;\n-import org.kie.kogito.trusty.service.models.Execution;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.AttributeFilter;\n+import org.kie.kogito.persistence.api.query.QueryFilterFactory;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n \n @ApplicationScoped\n public class TrustyService implements ITrustyService {\n \n+    @Inject\n+    TrustyStorageService storageService;\n+\n     @Override\n     public List<Execution> getExecutionHeaders(OffsetDateTime from, OffsetDateTime to, int limit, int offset, String prefix) {\n-        throw new NotImplementedYetException(\"Not implemented yet.\");\n+        Storage<String, Decision> storage = storageService.getDecisionsStorage();\n+        List<AttributeFilter<?>> filters = new ArrayList<>();\n+        filters.add(QueryFilterFactory.like(\"executionId\", prefix + \"*\"));\n+        filters.add(QueryFilterFactory.greaterThanEqual(\"executionTimestamp\", from.toInstant().toEpochMilli()));\n+        filters.add(QueryFilterFactory.lessThanEqual(\"executionTimestamp\", to.toInstant().toEpochMilli()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ0MjYyMQ=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzAyODMxOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/TrustyService.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwOTo0OTo0M1rOGm5n3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMTo0MTo1NFrOGnlVRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ0MzE2NQ==", "bodyText": "Are you sure of this behavior? Don't we want to support update?", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443443165", "createdAt": "2020-06-22T09:49:43Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/TrustyService.java", "diffHunk": "@@ -17,25 +17,50 @@\n package org.kie.kogito.trusty.service;\n \n import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n import java.util.List;\n \n import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n \n-import org.jboss.resteasy.spi.NotImplementedYetException;\n-import org.kie.kogito.trusty.service.models.Execution;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.AttributeFilter;\n+import org.kie.kogito.persistence.api.query.QueryFilterFactory;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n \n @ApplicationScoped\n public class TrustyService implements ITrustyService {\n \n+    @Inject\n+    TrustyStorageService storageService;\n+\n     @Override\n     public List<Execution> getExecutionHeaders(OffsetDateTime from, OffsetDateTime to, int limit, int offset, String prefix) {\n-        throw new NotImplementedYetException(\"Not implemented yet.\");\n+        Storage<String, Decision> storage = storageService.getDecisionsStorage();\n+        List<AttributeFilter<?>> filters = new ArrayList<>();\n+        filters.add(QueryFilterFactory.like(\"executionId\", prefix + \"*\"));\n+        filters.add(QueryFilterFactory.greaterThanEqual(\"executionTimestamp\", from.toInstant().toEpochMilli()));\n+        filters.add(QueryFilterFactory.lessThanEqual(\"executionTimestamp\", to.toInstant().toEpochMilli()));\n+        return new ArrayList<>(storage.query().limit(limit).offset(offset).filter(filters).execute());\n+    }\n+\n+    @Override\n+    public Decision getDecisionById(String executionId) {\n+        Storage<String, Decision> storage = storageService.getDecisionsStorage();\n+        if (!storage.containsKey(executionId)) {\n+            throw new IllegalArgumentException(String.format(\"A decision with ID %s does not exist in the storage.\", executionId));\n+        }\n+        return storage.get(executionId);\n     }\n \n     @Override\n-    public void storeExecution(String executionId, Execution execution) {\n-        throw new NotImplementedYetException(\"Not implemented yet.\");\n+    public void storeDecision(String executionId, Decision decision) {\n+        Storage<String, Decision> storage = storageService.getDecisionsStorage();\n+        if (storage.containsKey(executionId)) {\n+            throw new IllegalArgumentException(String.format(\"A decision with ID %s is already present in the storage.\", executionId));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU2MzAxMQ==", "bodyText": "@danielezonca Personally, for the update operation I would create another method (when it will be needed). I think we should not overwrite items in the storage by default, lmkwyt", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443563011", "createdAt": "2020-06-22T13:36:59Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/TrustyService.java", "diffHunk": "@@ -17,25 +17,50 @@\n package org.kie.kogito.trusty.service;\n \n import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n import java.util.List;\n \n import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n \n-import org.jboss.resteasy.spi.NotImplementedYetException;\n-import org.kie.kogito.trusty.service.models.Execution;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.AttributeFilter;\n+import org.kie.kogito.persistence.api.query.QueryFilterFactory;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n \n @ApplicationScoped\n public class TrustyService implements ITrustyService {\n \n+    @Inject\n+    TrustyStorageService storageService;\n+\n     @Override\n     public List<Execution> getExecutionHeaders(OffsetDateTime from, OffsetDateTime to, int limit, int offset, String prefix) {\n-        throw new NotImplementedYetException(\"Not implemented yet.\");\n+        Storage<String, Decision> storage = storageService.getDecisionsStorage();\n+        List<AttributeFilter<?>> filters = new ArrayList<>();\n+        filters.add(QueryFilterFactory.like(\"executionId\", prefix + \"*\"));\n+        filters.add(QueryFilterFactory.greaterThanEqual(\"executionTimestamp\", from.toInstant().toEpochMilli()));\n+        filters.add(QueryFilterFactory.lessThanEqual(\"executionTimestamp\", to.toInstant().toEpochMilli()));\n+        return new ArrayList<>(storage.query().limit(limit).offset(offset).filter(filters).execute());\n+    }\n+\n+    @Override\n+    public Decision getDecisionById(String executionId) {\n+        Storage<String, Decision> storage = storageService.getDecisionsStorage();\n+        if (!storage.containsKey(executionId)) {\n+            throw new IllegalArgumentException(String.format(\"A decision with ID %s does not exist in the storage.\", executionId));\n+        }\n+        return storage.get(executionId);\n     }\n \n     @Override\n-    public void storeExecution(String executionId, Execution execution) {\n-        throw new NotImplementedYetException(\"Not implemented yet.\");\n+    public void storeDecision(String executionId, Decision decision) {\n+        Storage<String, Decision> storage = storageService.getDecisionsStorage();\n+        if (storage.containsKey(executionId)) {\n+            throw new IllegalArgumentException(String.format(\"A decision with ID %s is already present in the storage.\", executionId));\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ0MzE2NQ=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE1OTMwMw==", "bodyText": "I've implemented the updateDecision method as agreeded by phone call", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444159303", "createdAt": "2020-06-23T11:41:54Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/TrustyService.java", "diffHunk": "@@ -17,25 +17,50 @@\n package org.kie.kogito.trusty.service;\n \n import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n import java.util.List;\n \n import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n \n-import org.jboss.resteasy.spi.NotImplementedYetException;\n-import org.kie.kogito.trusty.service.models.Execution;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.AttributeFilter;\n+import org.kie.kogito.persistence.api.query.QueryFilterFactory;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n \n @ApplicationScoped\n public class TrustyService implements ITrustyService {\n \n+    @Inject\n+    TrustyStorageService storageService;\n+\n     @Override\n     public List<Execution> getExecutionHeaders(OffsetDateTime from, OffsetDateTime to, int limit, int offset, String prefix) {\n-        throw new NotImplementedYetException(\"Not implemented yet.\");\n+        Storage<String, Decision> storage = storageService.getDecisionsStorage();\n+        List<AttributeFilter<?>> filters = new ArrayList<>();\n+        filters.add(QueryFilterFactory.like(\"executionId\", prefix + \"*\"));\n+        filters.add(QueryFilterFactory.greaterThanEqual(\"executionTimestamp\", from.toInstant().toEpochMilli()));\n+        filters.add(QueryFilterFactory.lessThanEqual(\"executionTimestamp\", to.toInstant().toEpochMilli()));\n+        return new ArrayList<>(storage.query().limit(limit).offset(offset).filter(filters).execute());\n+    }\n+\n+    @Override\n+    public Decision getDecisionById(String executionId) {\n+        Storage<String, Decision> storage = storageService.getDecisionsStorage();\n+        if (!storage.containsKey(executionId)) {\n+            throw new IllegalArgumentException(String.format(\"A decision with ID %s does not exist in the storage.\", executionId));\n+        }\n+        return storage.get(executionId);\n     }\n \n     @Override\n-    public void storeExecution(String executionId, Execution execution) {\n-        throw new NotImplementedYetException(\"Not implemented yet.\");\n+    public void storeDecision(String executionId, Decision decision) {\n+        Storage<String, Decision> storage = storageService.getDecisionsStorage();\n+        if (storage.containsKey(executionId)) {\n+            throw new IllegalArgumentException(String.format(\"A decision with ID %s is already present in the storage.\", executionId));\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ0MzE2NQ=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzA0MTU1OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/api/DecisionsApiV1.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwOTo1MzoxMVrOGm5v4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwODoyOTowOFrOGnezfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ0NTIxNw==", "bodyText": "I would prefer to get error message from ex.getMessage() otherwise it is possible to \"hide\" the real error message with this new string", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443445217", "createdAt": "2020-06-22T09:53:11Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/api/DecisionsApiV1.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.trusty.service.api;\n+\n+import javax.inject.Inject;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+\n+import org.eclipse.microprofile.openapi.annotations.Operation;\n+import org.eclipse.microprofile.openapi.annotations.enums.SchemaType;\n+import org.eclipse.microprofile.openapi.annotations.media.Content;\n+import org.eclipse.microprofile.openapi.annotations.media.Schema;\n+import org.eclipse.microprofile.openapi.annotations.parameters.Parameter;\n+import org.eclipse.microprofile.openapi.annotations.responses.APIResponse;\n+import org.eclipse.microprofile.openapi.annotations.responses.APIResponses;\n+import org.jboss.resteasy.annotations.jaxrs.PathParam;\n+import org.kie.kogito.trusty.service.ITrustyService;\n+import org.kie.kogito.trusty.service.responses.ExecutionHeaderResponse;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+\n+@Path(\"v1/executions/decisions\")\n+public class DecisionsApiV1 {\n+\n+    @Inject\n+    ITrustyService trustyService;\n+\n+    @GET\n+    @Path(\"/{key}\")\n+    @APIResponses(value = {\n+            @APIResponse(description = \"Gets the decision detail header.\", responseCode = \"200\", content = @Content(mediaType = MediaType.APPLICATION_JSON, schema = @Schema(type = SchemaType.OBJECT, implementation = ExecutionHeaderResponse.class))),\n+            @APIResponse(description = \"Bad Request\", responseCode = \"400\", content = @Content(mediaType = MediaType.TEXT_PLAIN))\n+    }\n+    )\n+    @Operation(summary = \"Gets The decision header with details.\", description = \"Gets the decision detail header.\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    public Response getExecutionById(\n+            @Parameter(\n+                    name = \"executionId\",\n+                    description = \"The execution ID.\",\n+                    required = true,\n+                    schema = @Schema(implementation = String.class)\n+            ) @PathParam(\"executionId\") String executionId) {\n+\n+        Decision decision;\n+        try {\n+            decision = trustyService.getDecisionById(executionId);\n+        } catch (IllegalArgumentException ex) {\n+            return Response.status(Response.Status.BAD_REQUEST.getStatusCode(), String.format(\"Execution with ID %s does not exist in the storage.\", executionId)).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA1MjM1MA==", "bodyText": "Done", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444052350", "createdAt": "2020-06-23T08:29:08Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/api/DecisionsApiV1.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.trusty.service.api;\n+\n+import javax.inject.Inject;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+\n+import org.eclipse.microprofile.openapi.annotations.Operation;\n+import org.eclipse.microprofile.openapi.annotations.enums.SchemaType;\n+import org.eclipse.microprofile.openapi.annotations.media.Content;\n+import org.eclipse.microprofile.openapi.annotations.media.Schema;\n+import org.eclipse.microprofile.openapi.annotations.parameters.Parameter;\n+import org.eclipse.microprofile.openapi.annotations.responses.APIResponse;\n+import org.eclipse.microprofile.openapi.annotations.responses.APIResponses;\n+import org.jboss.resteasy.annotations.jaxrs.PathParam;\n+import org.kie.kogito.trusty.service.ITrustyService;\n+import org.kie.kogito.trusty.service.responses.ExecutionHeaderResponse;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+\n+@Path(\"v1/executions/decisions\")\n+public class DecisionsApiV1 {\n+\n+    @Inject\n+    ITrustyService trustyService;\n+\n+    @GET\n+    @Path(\"/{key}\")\n+    @APIResponses(value = {\n+            @APIResponse(description = \"Gets the decision detail header.\", responseCode = \"200\", content = @Content(mediaType = MediaType.APPLICATION_JSON, schema = @Schema(type = SchemaType.OBJECT, implementation = ExecutionHeaderResponse.class))),\n+            @APIResponse(description = \"Bad Request\", responseCode = \"400\", content = @Content(mediaType = MediaType.TEXT_PLAIN))\n+    }\n+    )\n+    @Operation(summary = \"Gets The decision header with details.\", description = \"Gets the decision detail header.\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    public Response getExecutionById(\n+            @Parameter(\n+                    name = \"executionId\",\n+                    description = \"The execution ID.\",\n+                    required = true,\n+                    schema = @Schema(implementation = String.class)\n+            ) @PathParam(\"executionId\") String executionId) {\n+\n+        Decision decision;\n+        try {\n+            decision = trustyService.getDecisionById(executionId);\n+        } catch (IllegalArgumentException ex) {\n+            return Response.status(Response.Status.BAD_REQUEST.getStatusCode(), String.format(\"Execution with ID %s does not exist in the storage.\", executionId)).build();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ0NTIxNw=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzQyNTc4OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTo1ODoxMVrOGm9gzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMTo0MjowOFrOGnlVvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzUwNjg5NQ==", "bodyText": "If you are not using REST api nor using many injections, you can probably use a plain unit test without QuarkusTest.\nI would suggest you to create a constructor in TrustyService that accept TrustyStorageService and move @Inject annotation directly on the constructor.\nIn this way you can easily instantiate the service in a @Before method using a mock, a mocked implementation or the real instance with better control.\nWdyt?", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443506895", "createdAt": "2020-06-22T11:58:11Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "diffHunk": "@@ -16,6 +16,87 @@\n \n package org.kie.kogito.trusty.service;\n \n+import java.time.OffsetDateTime;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.quarkus.test.junit.mockito.InjectMock;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.Query;\n+import org.kie.kogito.trusty.service.mocks.StorageImplMock;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+@QuarkusTest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA1NDY1Nw==", "bodyText": "I've avoided QuarkusTest now, let me know if it looks good to you", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444054657", "createdAt": "2020-06-23T08:32:40Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "diffHunk": "@@ -16,6 +16,87 @@\n \n package org.kie.kogito.trusty.service;\n \n+import java.time.OffsetDateTime;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.quarkus.test.junit.mockito.InjectMock;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.Query;\n+import org.kie.kogito.trusty.service.mocks.StorageImplMock;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+@QuarkusTest", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzUwNjg5NQ=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE1OTQyMg==", "bodyText": "Implemented as agreeded by phone call", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444159422", "createdAt": "2020-06-23T11:42:08Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "diffHunk": "@@ -16,6 +16,87 @@\n \n package org.kie.kogito.trusty.service;\n \n+import java.time.OffsetDateTime;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.quarkus.test.junit.mockito.InjectMock;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.Query;\n+import org.kie.kogito.trusty.service.mocks.StorageImplMock;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+@QuarkusTest", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzUwNjg5NQ=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzY2NTM3OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMzowODo0NVrOGm_2Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNTo0NTozOFrOGnGkaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0NTE3OQ==", "bodyText": "Side note related to this class: if you really want to test TrustyStorageService and TrustyService in two different classes you should try to properly split test logic: most (all?) the logic is inside TrustyStorageService so here you should probably just verify (using Mockito) that method A is invoking method B etc.\nThe risk is to test the implementation and/or test the mock logic you just defined.\nI think it could be better to have a single test class to cover the logic of both. Wdyt?", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443545179", "createdAt": "2020-06-22T13:08:45Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "diffHunk": "@@ -16,6 +16,87 @@\n \n package org.kie.kogito.trusty.service;\n \n+import java.time.OffsetDateTime;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.quarkus.test.junit.mockito.InjectMock;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.Query;\n+import org.kie.kogito.trusty.service.mocks.StorageImplMock;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+@QuarkusTest\n public class TrustyServiceTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY1NTI3Mg==", "bodyText": "Currently TrustyStorageService is not really tested anywhere, since it is only exposing the \"cache\" of the decisions. I think the TrustyStorageService should be mocked anyway in the tests of the TrustyService. I know there is not much to test, as a matter of facts I've implemented just 3 unit tests and some integration tests for the TrustyService. Let's have a call to better clarify your points", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443655272", "createdAt": "2020-06-22T15:45:38Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTest.java", "diffHunk": "@@ -16,6 +16,87 @@\n \n package org.kie.kogito.trusty.service;\n \n+import java.time.OffsetDateTime;\n+import java.util.List;\n+\n+import javax.inject.Inject;\n+\n+import io.quarkus.test.junit.QuarkusTest;\n+import io.quarkus.test.junit.mockito.InjectMock;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.Query;\n+import org.kie.kogito.trusty.service.mocks.StorageImplMock;\n+import org.kie.kogito.trusty.storage.api.TrustyStorageService;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.Execution;\n+\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.ArgumentMatchers.eq;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+@QuarkusTest\n public class TrustyServiceTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0NTE3OQ=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzY3MTE5OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/src/test/resources/application.properties", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMzoxMDoxOVrOGm_5_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNDo1MTozOFrOGnEQ-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0NjExMA==", "bodyText": "Is this needed? Are we using infinispan in any test?", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443546110", "createdAt": "2020-06-22T13:10:19Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-service/src/test/resources/application.properties", "diffHunk": "@@ -0,0 +1,10 @@\n+# Infinispan", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYxNzUzMQ==", "bodyText": "@danielezonca yes, in order to select which storage layer is to be used, we have to set the properties here. For me the question is how do we write integration tests for mongo for example. I think that at one point we will have to move (some) integration tests out of this module to a separated module (or put them in kogito-examples?)", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443617531", "createdAt": "2020-06-22T14:51:38Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/src/test/resources/application.properties", "diffHunk": "@@ -0,0 +1,10 @@\n+# Infinispan", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0NjExMA=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzY3NDM4OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-storage/trusty-storage-api/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMzoxMToxMFrOGm_74A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxNTo0NTo1MlrOGnGk-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0NjU5Mg==", "bodyText": "Are them used?", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443546592", "createdAt": "2020-06-22T13:11:10Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-storage/trusty-storage-api/pom.xml", "diffHunk": "@@ -0,0 +1,30 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>trusty-storage</artifactId>\n+    <groupId>org.kie.kogito</groupId>\n+    <version>8.0.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>trusty-storage-api</artifactId>\n+  <name>Kogito :: Trusty Storage API</name>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.kie.kogito</groupId>\n+      <artifactId>persistence-commons-api</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.fasterxml.jackson.core</groupId>\n+      <artifactId>jackson-databind</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.fasterxml.jackson.core</groupId>\n+      <artifactId>jackson-annotations</artifactId>\n+    </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY1NTQxOA==", "bodyText": "Nope, I'll remove them", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443655418", "createdAt": "2020-06-22T15:45:52Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-api/pom.xml", "diffHunk": "@@ -0,0 +1,30 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>trusty-storage</artifactId>\n+    <groupId>org.kie.kogito</groupId>\n+    <version>8.0.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>trusty-storage-api</artifactId>\n+  <name>Kogito :: Trusty Storage API</name>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.kie.kogito</groupId>\n+      <artifactId>persistence-commons-api</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.fasterxml.jackson.core</groupId>\n+      <artifactId>jackson-databind</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.fasterxml.jackson.core</groupId>\n+      <artifactId>jackson-annotations</artifactId>\n+    </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0NjU5Mg=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzY5ODYwOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMzoxNzozOFrOGnAK2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMTo0MzoyN1rOGnlYfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU1MDQyNA==", "bodyText": "Can you please add a test to verify that all fields of Decision are covered (if possible use a mechanism that dynamically takes methods from Decision so that if we add a field the test fails", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443550424", "createdAt": "2020-06-22T13:17:38Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {\n+\n+    private static final ObjectMapper myMapper = new ObjectMapper();\n+\n+    public DecisionMarshaller(ObjectMapper mapper) {\n+        super(mapper);\n+    }\n+\n+    @Override\n+    public Decision readFrom(ProtoStreamReader reader) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA1NTA5Mw==", "bodyText": "Done, lmkwyt", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444055093", "createdAt": "2020-06-23T08:33:22Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {\n+\n+    private static final ObjectMapper myMapper = new ObjectMapper();\n+\n+    public DecisionMarshaller(ObjectMapper mapper) {\n+        super(mapper);\n+    }\n+\n+    @Override\n+    public Decision readFrom(ProtoStreamReader reader) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU1MDQyNA=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE2MDEyNw==", "bodyText": "The check on the mapping has been implemented using reflection, I'll resolve the conversation", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444160127", "createdAt": "2020-06-23T11:43:27Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {\n+\n+    private static final ObjectMapper myMapper = new ObjectMapper();\n+\n+    public DecisionMarshaller(ObjectMapper mapper) {\n+        super(mapper);\n+    }\n+\n+    @Override\n+    public Decision readFrom(ProtoStreamReader reader) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU1MDQyNA=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzY5OTIyOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMzoxNzo0NlrOGnALLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMTo0Mzo0NlrOGnlZPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU1MDUxMA==", "bodyText": "Same as above", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r443550510", "createdAt": "2020-06-22T13:17:46Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {\n+\n+    private static final ObjectMapper myMapper = new ObjectMapper();\n+\n+    public DecisionMarshaller(ObjectMapper mapper) {\n+        super(mapper);\n+    }\n+\n+    @Override\n+    public Decision readFrom(ProtoStreamReader reader) throws IOException {\n+        Decision result = new Decision();\n+\n+        result.setExecutionId(reader.readString(\"executionId\"));\n+        result.setExecutionTimestamp(reader.readLong(\"executionTimestamp\"));\n+        result.setSuccess(reader.readBoolean(\"hasSucceeded\"));\n+        result.setExecutorName(reader.readString(\"executorName\"));\n+        result.setExecutedModelName(reader.readString(\"executedModelName\"));\n+        result.setExecutionType(myMapper.readValue(reader.readString(\"executionType\"), ExecutionTypeEnum.class));\n+\n+        return result;\n+    }\n+\n+    @Override\n+    public void writeTo(ProtoStreamWriter writer, Decision result) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA1NTEyMg==", "bodyText": "Done, lmkwyt", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444055122", "createdAt": "2020-06-23T08:33:25Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {\n+\n+    private static final ObjectMapper myMapper = new ObjectMapper();\n+\n+    public DecisionMarshaller(ObjectMapper mapper) {\n+        super(mapper);\n+    }\n+\n+    @Override\n+    public Decision readFrom(ProtoStreamReader reader) throws IOException {\n+        Decision result = new Decision();\n+\n+        result.setExecutionId(reader.readString(\"executionId\"));\n+        result.setExecutionTimestamp(reader.readLong(\"executionTimestamp\"));\n+        result.setSuccess(reader.readBoolean(\"hasSucceeded\"));\n+        result.setExecutorName(reader.readString(\"executorName\"));\n+        result.setExecutedModelName(reader.readString(\"executedModelName\"));\n+        result.setExecutionType(myMapper.readValue(reader.readString(\"executionType\"), ExecutionTypeEnum.class));\n+\n+        return result;\n+    }\n+\n+    @Override\n+    public void writeTo(ProtoStreamWriter writer, Decision result) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU1MDUxMA=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE2MDMxNw==", "bodyText": "Implemented as agreeded by phone call", "url": "https://github.com/kiegroup/kogito-apps/pull/273#discussion_r444160317", "createdAt": "2020-06-23T11:43:46Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-storage/trusty-storage-infinispan/src/main/java/org/kie/kogito/trusty/storage/infinispan/DecisionMarshaller.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.trusty.storage.infinispan;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.infinispan.protostream.MessageMarshaller;\n+import org.kie.kogito.persistence.infinispan.protostream.AbstractMarshaller;\n+import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.kie.kogito.trusty.storage.api.model.ExecutionTypeEnum;\n+\n+public class DecisionMarshaller extends AbstractMarshaller implements MessageMarshaller<Decision> {\n+\n+    private static final ObjectMapper myMapper = new ObjectMapper();\n+\n+    public DecisionMarshaller(ObjectMapper mapper) {\n+        super(mapper);\n+    }\n+\n+    @Override\n+    public Decision readFrom(ProtoStreamReader reader) throws IOException {\n+        Decision result = new Decision();\n+\n+        result.setExecutionId(reader.readString(\"executionId\"));\n+        result.setExecutionTimestamp(reader.readLong(\"executionTimestamp\"));\n+        result.setSuccess(reader.readBoolean(\"hasSucceeded\"));\n+        result.setExecutorName(reader.readString(\"executorName\"));\n+        result.setExecutedModelName(reader.readString(\"executedModelName\"));\n+        result.setExecutionType(myMapper.readValue(reader.readString(\"executionType\"), ExecutionTypeEnum.class));\n+\n+        return result;\n+    }\n+\n+    @Override\n+    public void writeTo(ProtoStreamWriter writer, Decision result) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU1MDUxMA=="}, "originalCommit": {"oid": "0d10a2a8e7375518f6c3699b66107fc820616953"}, "originalPosition": 50}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 995, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}