{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NDMwNTQx", "number": 464, "title": "KOGITO-2691: Task Console Keycloak authentiation", "bodyText": "Added Keycloak authentication to Task Console quarkus app.\nAdded a basic Users API in common to be used in KogitoApps. It provides the concept of the user that is logged into the app to be used in our components. When running in keycloak it gets the user & roles info from KeycloakClient.ts, in dev mode (without auth) the users are stored in memory.\nApps that want to use the user system should be wrapped with a KogitoAppContextProvider. It initializes the AppContext with the usersystem and the user logged into the app. Is possible get the context from a component by calling the useKogitoAppContext function.\n\n@nmirasch @jstastny-cz @AjayJagan would you mind take a look?\nMany thanks for submitting your Pull Request \u2764\ufe0f!\nPlease make sure that your PR meets the following requirements:\n\n You have read the contributors guide\n Pull Request title is properly formatted: KOGITO-XYZ Subject\n Pull Request title contains the target branch if not targeting master: [0.9.x] KOGITO-XYZ Subject\n Pull Request contains link to the JIRA issue\n Pull Request contains link to any dependent or related Pull Request\n Pull Request contains description of the issue\n Pull Request does not include fixes for issues other than the main ticket", "createdAt": "2020-09-18T16:50:44Z", "url": "https://github.com/kiegroup/kogito-apps/pull/464", "merged": true, "mergeCommit": {"oid": "9345e9790bc8965d4353d03ca5c5301b03243553"}, "closed": true, "closedAt": "2020-10-06T14:05:26Z", "author": {"login": "pefernan"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKIiBogFqTQ5MTYzMDU2Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdP64xOAFqTUwMzE0NDYxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjMwNTYy", "url": "https://github.com/kiegroup/kogito-apps/pull/464#pullrequestreview-491630562", "createdAt": "2020-09-18T16:52:52Z", "commit": {"oid": "761cbd18af32af49bf50010b5fc4f39e09d0b7ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjo1Mjo1MlrOHUUyqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjo1Mjo1MlrOHUUyqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA3NDIxOA==", "bodyText": "@jstastny-cz I made this class as a helper to simplify the tests that require the KogitoAppContext. I added it inside of the 'mocks' folder because I knew it was making sonarcloud to skip it...", "url": "https://github.com/kiegroup/kogito-apps/pull/464#discussion_r491074218", "createdAt": "2020-09-18T16:52:52Z", "author": {"login": "pefernan"}, "path": "ui-packages/packages/common/src/environment/auth/tests/mocks/KogitoAppContextTestingUtils.ts", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import * as Keycloak from '../../../../utils/KeycloakClient';\n+import * as KogitoAppContext from '../../../context/KogitoAppContext';\n+import { TestUserSystemImpl } from '../../TestUserSystem';\n+\n+export const testIsAuthEnabledMock = jest.spyOn(Keycloak, 'isAuthEnabled');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "761cbd18af32af49bf50010b5fc4f39e09d0b7ea"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "761cbd18af32af49bf50010b5fc4f39e09d0b7ea", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/761cbd18af32af49bf50010b5fc4f39e09d0b7ea", "committedDate": "2020-09-18T16:42:19Z", "message": "KOGITO-2691: Task Console Keycloak authentiation"}, "afterCommit": {"oid": "991d519f4ebfe200265fe71674e13f1af1db0b19", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/991d519f4ebfe200265fe71674e13f1af1db0b19", "committedDate": "2020-09-21T07:30:42Z", "message": "KOGITO-2691: Task Console Keycloak authentiation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df72abc2ed461ea8b804417b0eda17ad2e177c2f", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/df72abc2ed461ea8b804417b0eda17ad2e177c2f", "committedDate": "2020-09-21T12:31:54Z", "message": "- Unused pages cleanup"}, "afterCommit": {"oid": "430cb92f46087c654727ff6bcd2917b9b6b3a616", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/430cb92f46087c654727ff6bcd2917b9b6b3a616", "committedDate": "2020-09-21T14:38:32Z", "message": "- Unused pages cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NDkyNzU3", "url": "https://github.com/kiegroup/kogito-apps/pull/464#pullrequestreview-495492757", "createdAt": "2020-09-24T11:57:19Z", "commit": {"oid": "430cb92f46087c654727ff6bcd2917b9b6b3a616"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMTo1NzoxOVrOHXW9LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjoxMTowOFrOHXXbsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI1NTQwNQ==", "bodyText": "These attributes need to be set at top-level element in the custom component. Here it is the Modal, so please move it there and adapt the type attribute to reflect that.", "url": "https://github.com/kiegroup/kogito-apps/pull/464#discussion_r494255405", "createdAt": "2020-09-24T11:57:19Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/common/src/components/Atoms/AddTestUser/AddTestUser.tsx", "diffHunk": "@@ -0,0 +1,242 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import React, { useState } from 'react';\n+import { componentOuiaProps, OUIAProps } from '../../../utils/OuiaUtils';\n+import {\n+  ActionGroup,\n+  Alert,\n+  Button,\n+  Checkbox,\n+  Form,\n+  FormGroup,\n+  Modal,\n+  ModalVariant,\n+  Stack,\n+  StackItem,\n+  Text,\n+  TextContent,\n+  TextInput,\n+  TextVariants\n+} from '@patternfly/react-core';\n+import {\n+  AppContext,\n+  EnvironmentMode,\n+  useKogitoAppContext\n+} from '../../../environment/context/KogitoAppContext';\n+import {\n+  TestUserManager,\n+  TestUserSystem\n+} from '../../../environment/auth/Auth';\n+\n+interface IOwnProps {\n+  isOpen: boolean;\n+  toggleModal: () => void;\n+}\n+\n+const AddTestUser: React.FC<IOwnProps & OUIAProps> = ({\n+  isOpen,\n+  toggleModal,\n+  ouiaId,\n+  ouiaSafe\n+}) => {\n+  const context: AppContext = useKogitoAppContext();\n+\n+  const [userIdValidated, setUserIdValidated] = useState<any>('default');\n+  const [userIdError, setUserIdError] = useState<string>();\n+\n+  const [userId, setUserId] = useState<string>();\n+\n+  const [groupsValidated, setGroupsValidated] = useState<any>('default');\n+  const [groupsError, setGroupsError] = useState<string>();\n+  const [groups, setGroups] = useState<string>();\n+  const [login, setLogin] = useState<boolean>(true);\n+\n+  const validateUserId = (newUserId: string): boolean => {\n+    setUserId(newUserId);\n+\n+    if (!newUserId || !newUserId.trim()) {\n+      setUserIdValidated('error');\n+      setUserIdError('User Id cannot be empty.');\n+      return false;\n+    }\n+\n+    const testUserSystem: TestUserSystem = context.userSystem as TestUserSystem;\n+    const userManager: TestUserManager = testUserSystem.getUserManager();\n+    const user = userManager.getUser(newUserId);\n+\n+    if (user) {\n+      if (userManager.systemUsers().includes(newUserId)) {\n+        setUserIdValidated('error');\n+        setUserIdError(\n+          `Already exists a system user identified by '${newUserId}'. Please choose another user id.`\n+        );\n+        return false;\n+      }\n+      setUserIdValidated('warning');\n+      setUserIdError(\n+        `Already exists a user identified by '${newUserId}'. Press 'Add' to replace it.`\n+      );\n+      return true;\n+    }\n+\n+    setUserIdValidated('success');\n+    setUserIdError(null);\n+    return true;\n+  };\n+\n+  const checkEmptyArray = (newGroups: string): boolean => {\n+    return (\n+      newGroups.split(',').filter(group => group && group.trim().length > 0)\n+        .length > 0\n+    );\n+  };\n+\n+  const validateGroups = (newGroups: string): boolean => {\n+    setGroups(newGroups);\n+\n+    if (!newGroups || !newGroups.trim() || !checkEmptyArray(newGroups)) {\n+      setGroupsValidated('error');\n+      setGroupsError('User groups cannot be empty.');\n+      return false;\n+    }\n+    setGroupsValidated('success');\n+    setGroupsError(null);\n+    return true;\n+  };\n+\n+  const addUser = () => {\n+    const isUserIdValidated = validateUserId(userId);\n+    const areGroupsValidated = validateGroups(groups);\n+    if (isUserIdValidated && areGroupsValidated) {\n+      const testUserSystem: TestUserSystem = context.userSystem as TestUserSystem;\n+\n+      const userGroups = groups\n+        .split(',')\n+        .map(group => group.trim())\n+        .filter(group => group.length > 0);\n+\n+      testUserSystem.getUserManager().addUser(userId, userGroups);\n+\n+      close();\n+\n+      if (login) {\n+        testUserSystem.su(userId);\n+      }\n+    }\n+  };\n+\n+  const close = () => {\n+    toggleModal();\n+    setUserId(null);\n+    setUserIdValidated('default');\n+    setUserIdError(null);\n+    setGroups(null);\n+    setGroupsValidated('default');\n+    setGroupsError(null);\n+    setLogin(true);\n+  };\n+\n+  if (context.environment.mode !== EnvironmentMode.TEST || !isOpen) {\n+    return null;\n+  }\n+\n+  return (\n+    <Modal\n+      aria-label=\"add-test-user-modal\"\n+      title=\"Add new test user\"\n+      variant={ModalVariant.small}\n+      onClose={close}\n+      isOpen={isOpen}\n+    >\n+      <Stack hasGutter>\n+        <StackItem>\n+          <Alert\n+            title=\"Adds a new user to the user system\"\n+            variant=\"info\"\n+            isInline\n+          >\n+            <TextContent>\n+              <Text component={TextVariants.p}>\n+                Temporarily adds a new user to the user system (only for testing\n+                purposes). Newly added users will be stored in-memory.\n+              </Text>\n+              <Text component={TextVariants.p}>\n+                Refresh the app to clear the test users and leave the user\n+                system in his original state.\n+              </Text>\n+            </TextContent>\n+          </Alert>\n+        </StackItem>\n+        <StackItem isFilled>\n+          <Form {...componentOuiaProps(ouiaId, 'add-test-user-form', ouiaSafe)}>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "430cb92f46087c654727ff6bcd2917b9b6b3a616"}, "originalPosition": 185}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI1NzMzNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              const handleaddUserModalToggle = () => {\n          \n          \n            \n              const handleAddUserModalToggle = () => {", "url": "https://github.com/kiegroup/kogito-apps/pull/464#discussion_r494257335", "createdAt": "2020-09-24T12:00:52Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/common/src/components/Molecules/PageToolbar/PageToolbar.tsx", "diffHunk": "@@ -1,32 +1,61 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n import React, { useState } from 'react';\n import {\n+  Avatar,\n   Dropdown,\n+  DropdownItem,\n+  DropdownSeparator,\n   DropdownToggle,\n   Toolbar,\n   ToolbarGroup,\n-  ToolbarItem,\n-  DropdownItem,\n-  DropdownSeparator\n+  ToolbarItem\n } from '@patternfly/react-core';\n import accessibleStyles from '@patternfly/react-styles/css/utilities/Accessibility/accessibility';\n import { css } from '@patternfly/react-styles';\n import AboutModalBox from '../AboutModalBox/AboutModalBox';\n-import {\n-  getUserName,\n-  handleLogout,\n-  isAuthEnabled\n-} from '../../../utils/KeycloakClient';\n import { componentOuiaProps, OUIAProps } from '../../../utils/OuiaUtils';\n+import userImage from '../../../static/avatar.svg';\n+import {\n+  AppContext,\n+  isContextInTestMode,\n+  useKogitoAppContext\n+} from '../../../environment/context/KogitoAppContext';\n+import PageToolbarUsersDropdownGroup from '../PageToolbarUsersDropdownGroup/PageToolbarUsersDropdownGroup';\n+import AddTestUser from '../../Atoms/AddTestUser/AddTestUser';\n \n const PageToolbar: React.FunctionComponent<OUIAProps> = ({\n   ouiaId,\n   ouiaSafe\n }) => {\n-  const [isDropdownOpen, setDropdownOpen] = useState(false);\n-  const [modalToggle, setmodalToggle] = useState(false);\n+  const [isDropdownOpen, setDropdownOpen] = useState<boolean>(false);\n+  const [modalToggle, setmodalToggle] = useState<boolean>(false);\n+  const [addUserToggle, setAddUserToggle] = useState<boolean>(false);\n+\n+  const context: AppContext = useKogitoAppContext();\n \n-  const handleModalToggle = () => {\n-    setmodalToggle(modalToggle ? false : true);\n+  const testMode = isContextInTestMode(context);\n+\n+  const handleAboutModalToggle = () => {\n+    setmodalToggle(!modalToggle);\n+  };\n+\n+  const handleaddUserModalToggle = () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "430cb92f46087c654727ff6bcd2917b9b6b3a616"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI1Nzg0Ng==", "bodyText": "I don't think I get the purpose - why is this called this way?", "url": "https://github.com/kiegroup/kogito-apps/pull/464#discussion_r494257846", "createdAt": "2020-09-24T12:01:48Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/common/src/components/Molecules/PageToolbar/PageToolbar.tsx", "diffHunk": "@@ -36,26 +65,55 @@ const PageToolbar: React.FunctionComponent<OUIAProps> = ({\n   const onDropdownSelect = () => {\n     setDropdownOpen(!isDropdownOpen);\n   };\n-  const userDropdownItems = [\n-    <DropdownItem key={1} onClick={handleModalToggle}>\n+\n+  const getUserName = () => {\n+    return context && context.getCurrentUser()\n+      ? context.getCurrentUser().id\n+      : 'Anonymous';\n+  };\n+\n+  const handleLogout = () => {\n+    if (context.userSystem) {\n+      context.userSystem.logout();\n+    }\n+  };\n+\n+  const userDropdownItems: React.ReactElement[] = [];\n+\n+  userDropdownItems.push(\n+    <DropdownItem\n+      key={userDropdownItems.length}\n+      onClick={handleAboutModalToggle}\n+    >\n       About\n     </DropdownItem>\n-  ];\n+  );\n \n-  if (isAuthEnabled()) {\n+  if (testMode) {\n     userDropdownItems.push(\n-      <DropdownSeparator key={2} />,\n-      <DropdownItem component=\"button\" key={3} onClick={handleLogout}>\n-        Log out\n-      </DropdownItem>\n+      <PageToolbarUsersDropdownGroup\n+        key={userDropdownItems.length}\n+        toggleAddUsersModal={() => setAddUserToggle(true)}\n+      />\n     );\n   }\n \n+  userDropdownItems.push(<DropdownSeparator key={userDropdownItems.length} />);\n+  userDropdownItems.push(\n+    <DropdownItem key={userDropdownItems.length} onClick={handleLogout}>\n+      Log out\n+    </DropdownItem>\n+  );\n+\n   return (\n     <React.Fragment>\n       <AboutModalBox\n         isOpenProp={modalToggle}\n-        handleModalToggleProp={handleModalToggle}\n+        handleModalToggleProp={handleAboutModalToggle}\n+      />\n+      <AddTestUser", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "430cb92f46087c654727ff6bcd2917b9b6b3a616"}, "originalPosition": 133}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI2MDY3Ng==", "bodyText": "I would prefer for the PageToolbarUsersDropdownGroup to render just as the DropdownGroup  and add the separator to the userDropdownItems here dynamically (not as part of the component render).", "url": "https://github.com/kiegroup/kogito-apps/pull/464#discussion_r494260676", "createdAt": "2020-09-24T12:06:36Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/common/src/components/Molecules/PageToolbar/PageToolbar.tsx", "diffHunk": "@@ -36,26 +65,55 @@ const PageToolbar: React.FunctionComponent<OUIAProps> = ({\n   const onDropdownSelect = () => {\n     setDropdownOpen(!isDropdownOpen);\n   };\n-  const userDropdownItems = [\n-    <DropdownItem key={1} onClick={handleModalToggle}>\n+\n+  const getUserName = () => {\n+    return context && context.getCurrentUser()\n+      ? context.getCurrentUser().id\n+      : 'Anonymous';\n+  };\n+\n+  const handleLogout = () => {\n+    if (context.userSystem) {\n+      context.userSystem.logout();\n+    }\n+  };\n+\n+  const userDropdownItems: React.ReactElement[] = [];\n+\n+  userDropdownItems.push(\n+    <DropdownItem\n+      key={userDropdownItems.length}\n+      onClick={handleAboutModalToggle}\n+    >\n       About\n     </DropdownItem>\n-  ];\n+  );\n \n-  if (isAuthEnabled()) {\n+  if (testMode) {\n     userDropdownItems.push(\n-      <DropdownSeparator key={2} />,\n-      <DropdownItem component=\"button\" key={3} onClick={handleLogout}>\n-        Log out\n-      </DropdownItem>\n+      <PageToolbarUsersDropdownGroup", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "430cb92f46087c654727ff6bcd2917b9b6b3a616"}, "originalPosition": 112}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI2MTEzNg==", "bodyText": "OUIA compliance - I'd suggest to remove the fragment and move DropdownSeparator to higher level so that this component renders just as DropdownGroup", "url": "https://github.com/kiegroup/kogito-apps/pull/464#discussion_r494261136", "createdAt": "2020-09-24T12:07:23Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/common/src/components/Molecules/PageToolbarUsersDropdownGroup/PageToolbarUsersDropdownGroup.tsx", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import React from 'react';\n+import {\n+  AppContext,\n+  isContextInTestMode,\n+  useKogitoAppContext\n+} from '../../../environment/context/KogitoAppContext';\n+import { TestUserSystem } from '../../../environment/auth/Auth';\n+import {\n+  DropdownGroup,\n+  DropdownItem,\n+  DropdownSeparator,\n+  Tooltip\n+} from '@patternfly/react-core';\n+\n+interface IOwnProps {\n+  toggleAddUsersModal: () => void;\n+}\n+\n+const PageToolbarUsersDropdownGroup: React.FC<IOwnProps> = ({\n+  toggleAddUsersModal\n+}) => {\n+  const context: AppContext = useKogitoAppContext();\n+\n+  if (!isContextInTestMode(context)) {\n+    return null;\n+  }\n+  const testUserSystem: TestUserSystem = context.userSystem as TestUserSystem;\n+\n+  const users = testUserSystem.getUserManager().listAllUsers();\n+\n+  return (\n+    <>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "430cb92f46087c654727ff6bcd2917b9b6b3a616"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI2MzIxNg==", "bodyText": "imo the cleaner solution would be to new folder like utils and exclude it from the sonar reporting too.", "url": "https://github.com/kiegroup/kogito-apps/pull/464#discussion_r494263216", "createdAt": "2020-09-24T12:11:08Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/common/src/environment/auth/tests/mocks/KogitoAppContextTestingUtils.ts", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import * as Keycloak from '../../../../utils/KeycloakClient';\n+import * as KogitoAppContext from '../../../context/KogitoAppContext';\n+import { TestUserSystemImpl } from '../../TestUserSystem';\n+\n+export const testIsAuthEnabledMock = jest.spyOn(Keycloak, 'isAuthEnabled');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA3NDIxOA=="}, "originalCommit": {"oid": "761cbd18af32af49bf50010b5fc4f39e09d0b7ea"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "430cb92f46087c654727ff6bcd2917b9b6b3a616", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/430cb92f46087c654727ff6bcd2917b9b6b3a616", "committedDate": "2020-09-21T14:38:32Z", "message": "- Unused pages cleanup"}, "afterCommit": {"oid": "82b57b79cbb163a19c0e63bb6ffa6e0b0dc9db03", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/82b57b79cbb163a19c0e63bb6ffa6e0b0dc9db03", "committedDate": "2020-10-02T15:02:02Z", "message": "- Fetched last changes\n- Code review changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "82b57b79cbb163a19c0e63bb6ffa6e0b0dc9db03", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/82b57b79cbb163a19c0e63bb6ffa6e0b0dc9db03", "committedDate": "2020-10-02T15:02:02Z", "message": "- Fetched last changes\n- Code review changes"}, "afterCommit": {"oid": "79db601857a8b8c4630778f6074be398cf9acc8f", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/79db601857a8b8c4630778f6074be398cf9acc8f", "committedDate": "2020-10-02T15:03:59Z", "message": "- Fetched last changes\n- Code review changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79db601857a8b8c4630778f6074be398cf9acc8f", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/79db601857a8b8c4630778f6074be398cf9acc8f", "committedDate": "2020-10-02T15:03:59Z", "message": "- Fetched last changes\n- Code review changes"}, "afterCommit": {"oid": "e2b11e77a30598dfe505868a500c3e7f05e4227b", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/e2b11e77a30598dfe505868a500c3e7f05e4227b", "committedDate": "2020-10-04T19:43:47Z", "message": "- Fetched last changes\n- Code review changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e2b11e77a30598dfe505868a500c3e7f05e4227b", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/e2b11e77a30598dfe505868a500c3e7f05e4227b", "committedDate": "2020-10-04T19:43:47Z", "message": "- Fetched last changes\n- Code review changes"}, "afterCommit": {"oid": "957e84fdbe0c244d80e9d149cfe68a43a6295669", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/957e84fdbe0c244d80e9d149cfe68a43a6295669", "committedDate": "2020-10-04T19:45:07Z", "message": "- Fetched last changes\n- Code review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxOTU1Njkw", "url": "https://github.com/kiegroup/kogito-apps/pull/464#pullrequestreview-501955690", "createdAt": "2020-10-05T11:20:54Z", "commit": {"oid": "957e84fdbe0c244d80e9d149cfe68a43a6295669"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMToyMDo1NVrOHcYkXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMToyMDo1NVrOHcYkXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUyNDcwMA==", "bodyText": "@pefernan My mistake, The property we should use to enable disable security must be \"quarkus.oidc.tenant-enabled\" instead of \"quarkus.oidc.enabled\". Regarding is the used to enable/disable security at runtime. This change have to be applied to management console too.", "url": "https://github.com/kiegroup/kogito-apps/pull/464#discussion_r499524700", "createdAt": "2020-10-05T11:20:55Z", "author": {"login": "nmirasch"}, "path": "task-console/src/main/java/org/kie/kogito/task/console/VertxRouter.java", "diffHunk": "@@ -41,6 +41,10 @@\n     @ConfigProperty(name = \"kogito.dataindex.http.url\", defaultValue = \"http://localhost:8180\")\n     String dataIndexHttpURL;\n \n+    @Inject\n+    @ConfigProperty(name = \"quarkus.oidc.enabled\", defaultValue = \"false\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "957e84fdbe0c244d80e9d149cfe68a43a6295669"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2c4821c1779bdb4284c096bab0a3906ee2357d5", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/d2c4821c1779bdb4284c096bab0a3906ee2357d5", "committedDate": "2020-10-05T13:42:02Z", "message": "KOGITO-2691: Task Console Keycloak authentiation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e71cd132821e72fca49664eb287f3ee24a1f2b42", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/e71cd132821e72fca49664eb287f3ee24a1f2b42", "committedDate": "2020-10-05T13:42:02Z", "message": "- added mock data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73e76a020c55398b7e44528773a2dd8e31d6f598", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/73e76a020c55398b7e44528773a2dd8e31d6f598", "committedDate": "2020-10-05T13:42:03Z", "message": "- Unused pages cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91d33fdf30bb0562bc4c3ff82a575cc2af63a689", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/91d33fdf30bb0562bc4c3ff82a575cc2af63a689", "committedDate": "2020-10-05T13:42:45Z", "message": "- Fetched last changes\n- Code review changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "957e84fdbe0c244d80e9d149cfe68a43a6295669", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/957e84fdbe0c244d80e9d149cfe68a43a6295669", "committedDate": "2020-10-04T19:45:07Z", "message": "- Fetched last changes\n- Code review changes"}, "afterCommit": {"oid": "df34237b25942768d4fe14eef5cdddff4ff4e26a", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/df34237b25942768d4fe14eef5cdddff4ff4e26a", "committedDate": "2020-10-05T14:26:02Z", "message": "- Code changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df34237b25942768d4fe14eef5cdddff4ff4e26a", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/df34237b25942768d4fe14eef5cdddff4ff4e26a", "committedDate": "2020-10-05T14:26:02Z", "message": "- Code changes"}, "afterCommit": {"oid": "5ec8b2627ac1c4ea98dcf7bd1fe13a5dfd3855fb", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/5ec8b2627ac1c4ea98dcf7bd1fe13a5dfd3855fb", "committedDate": "2020-10-05T14:30:12Z", "message": "- Code changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMjU3NTg3", "url": "https://github.com/kiegroup/kogito-apps/pull/464#pullrequestreview-502257587", "createdAt": "2020-10-05T17:10:38Z", "commit": {"oid": "5ec8b2627ac1c4ea98dcf7bd1fe13a5dfd3855fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d180bee244001be4e3c849c55337badd41717803", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/d180bee244001be4e3c849c55337badd41717803", "committedDate": "2020-10-05T18:39:16Z", "message": "- Code changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ec8b2627ac1c4ea98dcf7bd1fe13a5dfd3855fb", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/5ec8b2627ac1c4ea98dcf7bd1fe13a5dfd3855fb", "committedDate": "2020-10-05T14:30:12Z", "message": "- Code changes"}, "afterCommit": {"oid": "d180bee244001be4e3c849c55337badd41717803", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/d180bee244001be4e3c849c55337badd41717803", "committedDate": "2020-10-05T18:39:16Z", "message": "- Code changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNjkxMzI3", "url": "https://github.com/kiegroup/kogito-apps/pull/464#pullrequestreview-502691327", "createdAt": "2020-10-06T08:17:20Z", "commit": {"oid": "d180bee244001be4e3c849c55337badd41717803"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODoxNzoyMFrOHc7B-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwODoxNzoyMFrOHc7B-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA4OTMzOA==", "bodyText": "This would exclude all the utils, which is not desirable imo (as there are ), I think **/tests/utils/** could be better fitting our needs.", "url": "https://github.com/kiegroup/kogito-apps/pull/464#discussion_r500089338", "createdAt": "2020-10-06T08:17:20Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/pom.xml", "diffHunk": "@@ -22,7 +22,7 @@\n       ${path.to.packages}/task-console/src,\n       ${path.to.packages}/trusty/src\n     </sonar.sources>\n-    <sonar.exclusions>**/__mocks__/**,**/mocks/**,**/*.stories.tsx</sonar.exclusions>\n+    <sonar.exclusions>**/__mocks__/**,**/mocks/**,**/utils/**,**/*.stories.tsx</sonar.exclusions>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d180bee244001be4e3c849c55337badd41717803"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b62e2acc2d29b0fed29b29036de38085bf956a9", "author": {"user": {"login": "pefernan", "name": "Pere Fern\u00e1ndez"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/8b62e2acc2d29b0fed29b29036de38085bf956a9", "committedDate": "2020-10-06T08:23:50Z", "message": "- Improved sonar exclusions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNzEyMzgz", "url": "https://github.com/kiegroup/kogito-apps/pull/464#pullrequestreview-502712383", "createdAt": "2020-10-06T08:42:05Z", "commit": {"oid": "8b62e2acc2d29b0fed29b29036de38085bf956a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTQ0NjEx", "url": "https://github.com/kiegroup/kogito-apps/pull/464#pullrequestreview-503144611", "createdAt": "2020-10-06T16:22:36Z", "commit": {"oid": "8b62e2acc2d29b0fed29b29036de38085bf956a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4794, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}