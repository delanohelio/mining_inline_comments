{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3NjA0MjU0", "number": 529, "title": "KOGITO-3769 - Make LimeExplainer optionally generate more diverse samples", "bodyText": "See https://issues.redhat.com/browse/KOGITO-3769\nMany thanks for submitting your Pull Request \u2764\ufe0f!\nPlease make sure that your PR meets the following requirements:\n\n You have read the contributors guide\n Pull Request title is properly formatted: KOGITO-XYZ Subject\n Pull Request title contains the target branch if not targeting master: [0.9.x] KOGITO-XYZ Subject\n Pull Request contains link to the JIRA issue\n Pull Request contains link to any dependent or related Pull Request\n Pull Request contains description of the issue\n Pull Request does not include fixes for issues other than the main ticket", "createdAt": "2020-11-09T09:04:37Z", "url": "https://github.com/kiegroup/kogito-apps/pull/529", "merged": true, "mergeCommit": {"oid": "f30e10482c63ec0e028d6d7b3167cddcc1059535"}, "closed": true, "closedAt": "2020-11-27T14:36:13Z", "author": {"login": "tteofili"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdaw78XgH2gAyNTE3NjA0MjU0OjI1YjZhYjAxZDllZjBmMTk4NjlhNWYwODkwMjUyY2JhOGM4NTJkODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgP2l4gFqTUzOTE1NDgxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "25b6ab01d9ef0f19869a5f0890252cba8c852d84", "author": {"user": {"login": "tteofili", "name": "Tommaso Teofili"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/25b6ab01d9ef0f19869a5f0890252cba8c852d84", "committedDate": "2020-11-09T09:00:11Z", "message": "KOGITO-3769 - Make LimeExplainer optionally generate more diverse samples"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NDk3Njg3", "url": "https://github.com/kiegroup/kogito-apps/pull/529#pullrequestreview-526497687", "createdAt": "2020-11-09T17:40:23Z", "commit": {"oid": "25b6ab01d9ef0f19869a5f0890252cba8c852d84"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNzo0MDoyM1rOHv6JHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNzo0ODo0OFrOHv6dtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk5NzcyNw==", "bodyText": "Now we have a single param but this might change in the future so what about create a generic ExplainerParams/ExplainerContext/ExplainerDescr (and use it in the constructor of course)?\nIf you think this parameter is Lime-specific fine for me to have a LimeExplainer*, up to you :)\nPlease create also a public static final DEFAULT field in this class with default values like this example", "url": "https://github.com/kiegroup/kogito-apps/pull/529#discussion_r519997727", "createdAt": "2020-11-09T17:40:23Z", "author": {"login": "danielezonca"}, "path": "explainability/explainability-core/src/main/java/org/kie/kogito/explainability/local/lime/LimeExplainer.java", "diffHunk": "@@ -77,6 +77,11 @@\n      */\n     private final PerturbationContext perturbationContext;\n \n+    /**\n+     * Whether the explainer should adapt the variance in the generated (perturbed) data when it's not separable.\n+     */\n+    private final boolean adaptDatasetVariance;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25b6ab01d9ef0f19869a5f0890252cba8c852d84"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwMTg5Mw==", "bodyText": "Are you sure of this code? As far as I can see this code will double the size of samples as soon as a DatasetNotSeparableException is thrown (regardless if it is the first attempt or similar) and again and again until the generated dataset is separable or that noOfRetries will be 0.\nIs it the logic you want? Do you expect it is never (or almost never) possible that a new sample of the same size will produce a separated dataset?", "url": "https://github.com/kiegroup/kogito-apps/pull/529#discussion_r520001893", "createdAt": "2020-11-09T17:46:56Z", "author": {"login": "danielezonca"}, "path": "explainability/explainability-core/src/main/java/org/kie/kogito/explainability/local/lime/LimeExplainer.java", "diffHunk": "@@ -154,7 +157,19 @@ public int getNoOfRetries() {\n                         return completedFuture(getSaliencies(targetInput, linearizedTargetInputFeatures, actualOutputs, limeInputsList));\n                     } catch (DatasetNotSeparableException e) {\n                         if (noOfRetries > 0) {\n-                            return explainRetryCycle(model, originalInput, targetInput, linearizedTargetInputFeatures, actualOutputs, noOfRetries - 1);\n+                            PerturbationContext newPerturbationContext;\n+                            int newNoOfSamples;\n+                            if (adaptDatasetVariance) {\n+                                newPerturbationContext = new PerturbationContext(perturbationContext.getRandom(),\n+                                                                                 perturbationContext.getNoOfPerturbations() + 1);\n+                                newNoOfSamples = noOfSamples * 2;\n+                            } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25b6ab01d9ef0f19869a5f0890252cba8c852d84"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwMjk5Nw==", "bodyText": "Does it make sense to check also if all positive features are stable?", "url": "https://github.com/kiegroup/kogito-apps/pull/529#discussion_r520002997", "createdAt": "2020-11-09T17:48:48Z", "author": {"login": "danielezonca"}, "path": "explainability/explainability-core/src/test/java/org/kie/kogito/explainability/local/lime/LimeStabilityTest.java", "diffHunk": "@@ -42,70 +44,97 @@\n \n     @Test\n     void testStabilityWithNumericData() throws Exception {\n-        PredictionProvider sumSkipModel = TestUtils.getSumSkipModel(0);\n-        List<Feature> featureList = new LinkedList<>();\n-        for (int i = 0; i < 5; i++) {\n-            featureList.add(TestUtils.getMockedNumericFeature(i));\n+        Random random = new Random();\n+        for (int seed = 0; seed < 5; seed++) {\n+            random.setSeed(seed);\n+            PredictionProvider sumSkipModel = TestUtils.getSumSkipModel(0);\n+            List<Feature> featureList = new LinkedList<>();\n+            for (int i = 0; i < 5; i++) {\n+                featureList.add(TestUtils.getMockedNumericFeature(i));\n+            }\n+            LimeExplainer limeExplainer = new LimeExplainer(10, 1, random);\n+            assertStable(limeExplainer, sumSkipModel, featureList);\n         }\n-        assertStable(sumSkipModel, featureList);\n     }\n \n     @Test\n     void testStabilityWithTextData() throws Exception {\n-        PredictionProvider sumSkipModel = TestUtils.getDummyTextClassifier();\n-        List<Feature> featureList = new LinkedList<>();\n-        for (int i = 0; i < 4; i++) {\n-            featureList.add(TestUtils.getMockedTextFeature(\"foo \" + i));\n+        Random random = new Random();\n+        for (int seed = 0; seed < 5; seed++) {\n+            random.setSeed(seed);\n+            PredictionProvider sumSkipModel = TestUtils.getDummyTextClassifier();\n+            List<Feature> featureList = new LinkedList<>();\n+            for (int i = 0; i < 4; i++) {\n+                featureList.add(TestUtils.getMockedTextFeature(\"foo \" + i));\n+            }\n+            featureList.add(TestUtils.getMockedTextFeature(\"money\"));\n+            LimeExplainer limeExplainer = new LimeExplainer(10, 1, random);\n+            assertStable(limeExplainer, sumSkipModel, featureList);\n         }\n-        featureList.add(TestUtils.getMockedTextFeature(\"money\"));\n-        assertStable(sumSkipModel, featureList);\n     }\n \n-    private void assertStable(PredictionProvider model, List<Feature> featureList) throws Exception {\n+    @Test\n+    void testAdaptiveVariance() throws Exception {\n         Random random = new Random();\n         for (int seed = 0; seed < 5; seed++) {\n             random.setSeed(seed);\n-            LimeExplainer limeExplainer = new LimeExplainer(10, 1, random);\n-            PredictionInput input = new PredictionInput(featureList);\n-            List<PredictionOutput> predictionOutputs = model.predictAsync(List.of(input))\n-                    .get(Config.INSTANCE.getAsyncTimeout(), Config.INSTANCE.getAsyncTimeUnit());\n-            for (PredictionOutput predictionOutput : predictionOutputs) {\n-                Prediction prediction = new Prediction(input, predictionOutput);\n-                List<Saliency> saliencies = new LinkedList<>();\n-                for (int i = 0; i < 100; i++) {\n-                    Map<String, Saliency> saliencyMap = limeExplainer.explainAsync(prediction, model)\n-                            .get(Config.INSTANCE.getAsyncTimeout(), Config.INSTANCE.getAsyncTimeUnit());\n-                    saliencies.addAll(saliencyMap.values());\n-                }\n-                // check that the topmost important feature is stable\n-                List<String> names = new LinkedList<>();\n-                saliencies.stream().map(s -> s.getPositiveFeatures(1)).forEach(f -> names.add(f.get(0).getFeature().getName()));\n-                Map<String, Long> frequencyMap = names.stream().collect(Collectors.groupingBy(Function.identity(), Collectors.counting()));\n-                boolean topFeature = false;\n-                for (Map.Entry<String, Long> entry : frequencyMap.entrySet()) {\n-                    if (entry.getValue() >= TOP_FEATURE_THRESHOLD) {\n-                        topFeature = true;\n-                        break;\n-                    }\n-                }\n-                assertTrue(topFeature);\n+            PerturbationContext perturbationContext = new PerturbationContext(random, 1);\n \n-                // check that the impact is stable\n-                List<Double> impacts = new ArrayList<>(saliencies.size());\n-                for (Saliency saliency : saliencies) {\n-                    double v = ExplainabilityMetrics.impactScore(model, prediction, saliency.getTopFeatures(2));\n-                    impacts.add(v);\n+            int samples = 1;\n+            int retries = 4;\n+\n+            LimeExplainer adaptiveVarianceLE = new LimeExplainer(samples, perturbationContext,\n+                                                            retries, true);\n+\n+            List<Feature> features = new LinkedList<>();\n+            for (int i = 0; i < 4; i++) {\n+                features.add(FeatureFactory.newNumericalFeature(\"f-\"+i,2));\n+            }\n+            PredictionProvider model = TestUtils.getEvenSumModel(0);\n+            assertStable(adaptiveVarianceLE, model, features);\n+        }\n+    }\n+\n+    private void assertStable(LimeExplainer limeExplainer, PredictionProvider model, List<Feature> featureList) throws Exception {\n+        PredictionInput input = new PredictionInput(featureList);\n+        List<PredictionOutput> predictionOutputs = model.predictAsync(List.of(input))\n+                .get(Config.INSTANCE.getAsyncTimeout(), Config.INSTANCE.getAsyncTimeUnit());\n+        for (PredictionOutput predictionOutput : predictionOutputs) {\n+            Prediction prediction = new Prediction(input, predictionOutput);\n+            List<Saliency> saliencies = new LinkedList<>();\n+            for (int i = 0; i < 100; i++) {\n+                Map<String, Saliency> saliencyMap = limeExplainer.explainAsync(prediction, model)\n+                        .get(Config.INSTANCE.getAsyncTimeout(), Config.INSTANCE.getAsyncTimeUnit());\n+                saliencies.addAll(saliencyMap.values());\n+            }\n+            // check that the topmost important feature is stable\n+            List<String> names = new LinkedList<>();\n+            saliencies.stream().map(s -> s.getPositiveFeatures(1)).filter(f -> !f.isEmpty()).forEach(f -> names.add(f.get(0).getFeature().getName()));\n+            Map<String, Long> frequencyMap = names.stream().collect(Collectors.groupingBy(Function.identity(), Collectors.counting()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25b6ab01d9ef0f19869a5f0890252cba8c852d84"}, "originalPosition": 147}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MTQ5MTcy", "url": "https://github.com/kiegroup/kogito-apps/pull/529#pullrequestreview-527149172", "createdAt": "2020-11-10T12:25:24Z", "commit": {"oid": "25b6ab01d9ef0f19869a5f0890252cba8c852d84"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b361a169918cd35c57bdda2a71f316db1de4b74f", "author": {"user": {"login": "tteofili", "name": "Tommaso Teofili"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/b361a169918cd35c57bdda2a71f316db1de4b74f", "committedDate": "2020-11-12T10:20:59Z", "message": "KOGITO-3769 - refactored LIME configuration into a LimeConfig object"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b05000d6ff94287638475d8698eadb2cb249dab8", "author": {"user": {"login": "tteofili", "name": "Tommaso Teofili"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/b05000d6ff94287638475d8698eadb2cb249dab8", "committedDate": "2020-11-12T13:26:48Z", "message": "KOGITO-3769 - make adaptive sampling generate at most 2*no. of initial samples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cab8f5ebbb3bb79b71549bb13864ddd6fdb29ff7", "author": {"user": {"login": "tteofili", "name": "Tommaso Teofili"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/cab8f5ebbb3bb79b71549bb13864ddd6fdb29ff7", "committedDate": "2020-11-12T13:42:01Z", "message": "KOGITO-3769 - better perturbation size increase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5515b8fb3af4256fe5a4ac651a879c92a2e63b6c", "author": {"user": {"login": "tteofili", "name": "Tommaso Teofili"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/5515b8fb3af4256fe5a4ac651a879c92a2e63b6c", "committedDate": "2020-11-12T15:47:26Z", "message": "KOGITO-3769 - reducing complexity, javadoc fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5MTc0Nzg2", "url": "https://github.com/kiegroup/kogito-apps/pull/529#pullrequestreview-529174786", "createdAt": "2020-11-12T15:01:54Z", "commit": {"oid": "cab8f5ebbb3bb79b71549bb13864ddd6fdb29ff7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTowMTo1NFrOHx-5HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTowMjo1OVrOHx-8PA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3MjcwMA==", "bodyText": "Do we really want to have a default static instance of PerturbationContext? I think this could be better to do the new directly on perturbationContext field at instance level (so two different LimeConfig instances will not share it)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static final PerturbationContext DEFAULT_PERTURBATION_CONTEXT = new PerturbationContext(new SecureRandom(), 1);\n          \n          \n            \n            \n          \n          \n            \n                /**\n          \n          \n            \n                 * No. of samples to be generated for the local linear model training\n          \n          \n            \n                 */\n          \n          \n            \n                private int noOfSamples = DEFAULT_NO_OF_SAMPLES;\n          \n          \n            \n            \n          \n          \n            \n                /**\n          \n          \n            \n                 * No. of retries while trying to find a (linearly) separable dataset\n          \n          \n            \n                 */\n          \n          \n            \n                private int noOfRetries = DEFAULT_NO_OF_RETRIES;\n          \n          \n            \n            \n          \n          \n            \n                /**\n          \n          \n            \n                 * Context object for perturbing features\n          \n          \n            \n                 */\n          \n          \n            \n                private PerturbationContext perturbationContext = DEFAULT_PERTURBATION_CONTEXT;\n          \n          \n            \n            \n          \n          \n            \n                /**\n          \n          \n            \n                 * No. of samples to be generated for the local linear model training\n          \n          \n            \n                 */\n          \n          \n            \n                private int noOfSamples = DEFAULT_NO_OF_SAMPLES;\n          \n          \n            \n            \n          \n          \n            \n                /**\n          \n          \n            \n                 * No. of retries while trying to find a (linearly) separable dataset\n          \n          \n            \n                 */\n          \n          \n            \n                private int noOfRetries = DEFAULT_NO_OF_RETRIES;\n          \n          \n            \n            \n          \n          \n            \n                /**\n          \n          \n            \n                 * Context object for perturbing features\n          \n          \n            \n                 */\n          \n          \n            \n                private PerturbationContext perturbationContext = new PerturbationContext(new SecureRandom(), 1);", "url": "https://github.com/kiegroup/kogito-apps/pull/529#discussion_r522172700", "createdAt": "2020-11-12T15:01:54Z", "author": {"login": "danielezonca"}, "path": "explainability/explainability-core/src/main/java/org/kie/kogito/explainability/local/lime/LimeConfig.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.explainability.local.lime;\n+\n+import java.security.SecureRandom;\n+\n+import org.kie.kogito.explainability.model.PerturbationContext;\n+\n+/**\n+ * Lime explainer configuration parameters.\n+ */\n+public class LimeConfig {\n+\n+    private static final int DEFAULT_NO_OF_SAMPLES = 300;\n+    public static final int DEFAULT_NO_OF_RETRIES = 3;\n+    private static final boolean DEFAULT_ADAPT_DATASET_VARIANCE = false;\n+    private static final PerturbationContext DEFAULT_PERTURBATION_CONTEXT = new PerturbationContext(new SecureRandom(), 1);\n+\n+    /**\n+     * No. of samples to be generated for the local linear model training\n+     */\n+    private int noOfSamples = DEFAULT_NO_OF_SAMPLES;\n+\n+    /**\n+     * No. of retries while trying to find a (linearly) separable dataset\n+     */\n+    private int noOfRetries = DEFAULT_NO_OF_RETRIES;\n+\n+    /**\n+     * Context object for perturbing features\n+     */\n+    private PerturbationContext perturbationContext = DEFAULT_PERTURBATION_CONTEXT;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cab8f5ebbb3bb79b71549bb13864ddd6fdb29ff7"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3MzUwMA==", "bodyText": "Please fix formatting", "url": "https://github.com/kiegroup/kogito-apps/pull/529#discussion_r522173500", "createdAt": "2020-11-12T15:02:59Z", "author": {"login": "danielezonca"}, "path": "explainability/explainability-core/src/main/java/org/kie/kogito/explainability/local/lime/LimeExplainer.java", "diffHunk": "@@ -142,9 +106,9 @@ public int getNoOfRetries() {\n             PredictionInput targetInput,\n             List<Feature> linearizedTargetInputFeatures,\n             List<Output> actualOutputs,\n-            int noOfRetries) {\n+            int noOfRetries, int noOfSamples, PerturbationContext perturbationContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cab8f5ebbb3bb79b71549bb13864ddd6fdb29ff7"}, "originalPosition": 83}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e315a461165a1fde2ca275c735264a837453c353", "author": {"user": {"login": "tteofili", "name": "Tommaso Teofili"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/e315a461165a1fde2ca275c735264a837453c353", "committedDate": "2020-11-13T07:14:42Z", "message": "Update explainability/explainability-core/src/main/java/org/kie/kogito/explainability/local/lime/LimeConfig.java\n\nCo-authored-by: Daniele Zonca <dzonca@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adf6fe6cb4848329f3fafb85717fda61495cef73", "author": {"user": {"login": "tteofili", "name": "Tommaso Teofili"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/adf6fe6cb4848329f3fafb85717fda61495cef73", "committedDate": "2020-11-13T07:46:37Z", "message": "KOGITO-3769 - fixed formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NjY2NTQ2", "url": "https://github.com/kiegroup/kogito-apps/pull/529#pullrequestreview-534666546", "createdAt": "2020-11-19T17:09:22Z", "commit": {"oid": "adf6fe6cb4848329f3fafb85717fda61495cef73"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzowOToyMlrOH2o5TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzowOToyMlrOH2o5TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1NTE4MQ==", "bodyText": "What about move this to LimeConfig too? Or do you prefer to have this hardcoded?", "url": "https://github.com/kiegroup/kogito-apps/pull/529#discussion_r527055181", "createdAt": "2020-11-19T17:09:22Z", "author": {"login": "danielezonca"}, "path": "explainability/explainability-core/src/main/java/org/kie/kogito/explainability/local/lime/LimeExplainer.java", "diffHunk": "@@ -58,59 +56,21 @@\n  */\n public class LimeExplainer implements LocalExplainer<Map<String, Saliency>> {\n \n-    public static final int DEFAULT_NO_OF_RETRIES = 3;\n     public static final double SEPARABLE_DATASET_RATIO = 0.99;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adf6fe6cb4848329f3fafb85717fda61495cef73"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddfc44fec8084566ed19a8f37bc019d1e8dca071", "author": {"user": {"login": "tteofili", "name": "Tommaso Teofili"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/ddfc44fec8084566ed19a8f37bc019d1e8dca071", "committedDate": "2020-11-19T17:38:46Z", "message": "KOGITO-3769 - separable dataset ratio in LimeConfig"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MTUxMjUw", "url": "https://github.com/kiegroup/kogito-apps/pull/529#pullrequestreview-537151250", "createdAt": "2020-11-24T07:47:26Z", "commit": {"oid": "ddfc44fec8084566ed19a8f37bc019d1e8dca071"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwNzo0NzoyNlrOH4vsPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwNzo0ODowMFrOH4vtPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI2MzY3Ng==", "bodyText": "Is SecureRandom() going to make this test non deterministic?", "url": "https://github.com/kiegroup/kogito-apps/pull/529#discussion_r529263676", "createdAt": "2020-11-24T07:47:26Z", "author": {"login": "r00ta"}, "path": "explainability/explainability-integrationtests/explainability-integrationtests-pmml/src/test/java/org/kie/kogito/explainability/explainability/integrationtests/pmml/PmmlLimeExplainerTest.java", "diffHunk": "@@ -107,7 +113,10 @@ void testPMMLRegressionCategorical() throws Exception {\n         features.add(FeatureFactory.newCategoricalFeature(\"mapY\", \"classB\"));\n         PredictionInput input = new PredictionInput(features);\n \n-        LimeExplainer limeExplainer = new LimeExplainer(10, 1);\n+        LimeConfig limeConfig = new LimeConfig()\n+                .withSamples(10)\n+                .withPerturbationContext(new PerturbationContext(new SecureRandom(), 1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfc44fec8084566ed19a8f37bc019d1e8dca071"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI2MzczNw==", "bodyText": "Is SecureRandom() going to make this test non deterministic?", "url": "https://github.com/kiegroup/kogito-apps/pull/529#discussion_r529263737", "createdAt": "2020-11-24T07:47:32Z", "author": {"login": "r00ta"}, "path": "explainability/explainability-integrationtests/explainability-integrationtests-pmml/src/test/java/org/kie/kogito/explainability/explainability/integrationtests/pmml/PmmlLimeExplainerTest.java", "diffHunk": "@@ -141,7 +150,10 @@ void testPMMLScorecardCategorical() throws Exception {\n         features.add(FeatureFactory.newCategoricalFeature(\"input2\", \"classB\"));\n         PredictionInput input = new PredictionInput(features);\n \n-        LimeExplainer limeExplainer = new LimeExplainer(10, 1);\n+        LimeConfig limeConfig = new LimeConfig()\n+                .withSamples(10)\n+                .withPerturbationContext(new PerturbationContext(new SecureRandom(), 1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfc44fec8084566ed19a8f37bc019d1e8dca071"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI2MzkzNA==", "bodyText": "Is SecureRandom() going to make this test non deterministic?", "url": "https://github.com/kiegroup/kogito-apps/pull/529#discussion_r529263934", "createdAt": "2020-11-24T07:48:00Z", "author": {"login": "r00ta"}, "path": "explainability/explainability-integrationtests/explainability-integrationtests-dmn/src/test/java/org/kie/kogito/explainability/explainability/integrationtests/dmn/FraudScoringDmnLimeExplainerTest.java", "diffHunk": "@@ -77,7 +80,10 @@ void testFraudScoringDMNExplanation() throws ExecutionException, InterruptedExce\n         List<PredictionOutput> predictionOutputs = model.predictAsync(List.of(predictionInput))\n                 .get(Config.INSTANCE.getAsyncTimeout(), Config.INSTANCE.getAsyncTimeUnit());\n         Prediction prediction = new Prediction(predictionInput, predictionOutputs.get(0));\n-        LimeExplainer limeExplainer = new LimeExplainer(100, 5);\n+        LimeConfig limeConfig = new LimeConfig()\n+                .withSamples(100)\n+                .withPerturbationContext(new PerturbationContext(new SecureRandom(), 5));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddfc44fec8084566ed19a8f37bc019d1e8dca071"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64dae1d2d1b850ac8e2c434d74375dcb90467e24", "author": {"user": {"login": "tteofili", "name": "Tommaso Teofili"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/64dae1d2d1b850ac8e2c434d74375dcb90467e24", "committedDate": "2020-11-26T08:43:46Z", "message": "KOGITO-3769 - made PmmlLimeExplainerTest deterministic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aee676741b1c0775435d558507246080ddf4ab20", "author": {"user": {"login": "tteofili", "name": "Tommaso Teofili"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/aee676741b1c0775435d558507246080ddf4ab20", "committedDate": "2020-11-26T08:45:30Z", "message": "KOGITO-3769 - made FraudScoringDmnLimeExplainerTest deterministic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MTU0ODE0", "url": "https://github.com/kiegroup/kogito-apps/pull/529#pullrequestreview-539154814", "createdAt": "2020-11-26T09:51:01Z", "commit": {"oid": "aee676741b1c0775435d558507246080ddf4ab20"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4679, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}