{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NDM2NDMy", "number": 475, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NjoxOFrOEs9Q6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMDowODo1M1rOEs9yjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTc2NTUyOnYy", "diffSide": "RIGHT", "path": "ui-packages/packages/task-console/server/server.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NjoxOFrOHgefTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMTo0MzoyN1rOHgijwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxNjAxNA==", "bodyText": "white space formatting (missing space after if).", "url": "https://github.com/kiegroup/kogito-apps/pull/475#discussion_r503816014", "createdAt": "2020-10-13T09:46:18Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/task-console/server/server.js", "diffHunk": "@@ -59,37 +59,82 @@ function timeout(ms) {\n   return new Promise(resolve => setTimeout(resolve, ms));\n }\n \n+const checkStatesFilters = (userTaskInstance, states) => {\n+  return states.includes(userTaskInstance.state)\n+}\n+\n+const checkTaskNameFilters = (userTaskInstance, names) => {\n+  for (let i = 0; i < names.length; i++) {\n+    if (\n+      userTaskInstance.referenceName &&\n+      userTaskInstance.referenceName\n+        .toLowerCase()\n+        .indexOf(\n+          names[i].referenceName.like.toLowerCase()\n+        ) > -1\n+    ) {\n+      return true\n+    }\n+  }\n+}\n+\n+const checkTaskAssignment = (userTaskInstance, assignments) => {\n+  const actualOwnerClause = assignments.or[0];\n+  if (actualOwnerClause.actualOwner.equal === userTaskInstance.actualOwner) {\n+    return true;\n+  }\n+\n+  const potentialUsersClause = assignments.or[1];\n+\n+  if (userTaskInstance.potentialUsers.includes(potentialUsersClause.potentialUsers.contains)) {\n+    return true;\n+  }\n+\n+  const potentialGroupsClause = assignments.or[2];\n+  return potentialGroupsClause.potentialGroups.containsAny\n+    .some(clauseGroup => userTaskInstance.potentialGroups.includes(clauseGroup));\n+}\n+\n // Provide resolver functions for your schema fields\n const resolvers = {\n   Query: {\n     UserTaskInstances: async (parent, args) => {\n       let result = data.UserTaskInstances.filter(datum => {\n-\n-        if (args['where'].state && args['where'].state.in) {\n-          return args['where'].state.in.includes(datum.state);\n-        } else if (args['where'].id && args['where'].id.equal) {\n-          // mock to return single id\n-          return datum.id === args['where'].id.equal\n-        } else {\n-          // querying tasks assigned to current user\n-          const actualOwnerClause = args['where'].or[0];\n-          if(actualOwnerClause.actualOwner.equal === datum.actualOwner) {\n-            return true;\n+        console.log('args', args)\n+        \n+        if (args['where'].and) {\n+          // if filter available\n+          if(!checkTaskAssignment(datum,args['where'].and[0])){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56745627360328b538208722a654c022f8ee034f"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4MjY4OQ==", "bodyText": "done :)", "url": "https://github.com/kiegroup/kogito-apps/pull/475#discussion_r503882689", "createdAt": "2020-10-13T11:43:27Z", "author": {"login": "AjayJagan"}, "path": "ui-packages/packages/task-console/server/server.js", "diffHunk": "@@ -59,37 +59,82 @@ function timeout(ms) {\n   return new Promise(resolve => setTimeout(resolve, ms));\n }\n \n+const checkStatesFilters = (userTaskInstance, states) => {\n+  return states.includes(userTaskInstance.state)\n+}\n+\n+const checkTaskNameFilters = (userTaskInstance, names) => {\n+  for (let i = 0; i < names.length; i++) {\n+    if (\n+      userTaskInstance.referenceName &&\n+      userTaskInstance.referenceName\n+        .toLowerCase()\n+        .indexOf(\n+          names[i].referenceName.like.toLowerCase()\n+        ) > -1\n+    ) {\n+      return true\n+    }\n+  }\n+}\n+\n+const checkTaskAssignment = (userTaskInstance, assignments) => {\n+  const actualOwnerClause = assignments.or[0];\n+  if (actualOwnerClause.actualOwner.equal === userTaskInstance.actualOwner) {\n+    return true;\n+  }\n+\n+  const potentialUsersClause = assignments.or[1];\n+\n+  if (userTaskInstance.potentialUsers.includes(potentialUsersClause.potentialUsers.contains)) {\n+    return true;\n+  }\n+\n+  const potentialGroupsClause = assignments.or[2];\n+  return potentialGroupsClause.potentialGroups.containsAny\n+    .some(clauseGroup => userTaskInstance.potentialGroups.includes(clauseGroup));\n+}\n+\n // Provide resolver functions for your schema fields\n const resolvers = {\n   Query: {\n     UserTaskInstances: async (parent, args) => {\n       let result = data.UserTaskInstances.filter(datum => {\n-\n-        if (args['where'].state && args['where'].state.in) {\n-          return args['where'].state.in.includes(datum.state);\n-        } else if (args['where'].id && args['where'].id.equal) {\n-          // mock to return single id\n-          return datum.id === args['where'].id.equal\n-        } else {\n-          // querying tasks assigned to current user\n-          const actualOwnerClause = args['where'].or[0];\n-          if(actualOwnerClause.actualOwner.equal === datum.actualOwner) {\n-            return true;\n+        console.log('args', args)\n+        \n+        if (args['where'].and) {\n+          // if filter available\n+          if(!checkTaskAssignment(datum,args['where'].and[0])){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxNjAxNA=="}, "originalCommit": {"oid": "56745627360328b538208722a654c022f8ee034f"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTc5OTQ1OnYy", "diffSide": "RIGHT", "path": "ui-packages/packages/task-console/src/components/Molecules/TaskInboxToolbar/TaskInboxToolbar.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo1NTowM1rOHge04Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMTo0MzozM1rOHgij-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgyMTUzNw==", "bodyText": "I would rename the id argument into something more general, as in both cases below, the value is not an id really, it's either state or taskName ... so I would rename id->value or similar.\nThat might also apply to the type argument ... it's rather a categoryName passed to the ToolbarFilter component, right? Also in case of this attribute and checking strings below, I'd like to see a more tighter relation, not just string comparison - can we have an enum Category with values Status and TaskName for example? those values would be passed as categoryName to ToolbarFilter and then matched here below (possibly by a switch instead of two independent ifs).", "url": "https://github.com/kiegroup/kogito-apps/pull/475#discussion_r503821537", "createdAt": "2020-10-13T09:55:03Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/task-console/src/components/Molecules/TaskInboxToolbar/TaskInboxToolbar.tsx", "diffHunk": "@@ -0,0 +1,209 @@\n+import React, { useState, useContext, useReducer, useEffect } from 'react';\n+import {\n+  Button,\n+  Select,\n+  SelectOption,\n+  SelectVariant,\n+  ToolbarFilter,\n+  ToolbarGroup,\n+  ToolbarItem,\n+  ToolbarToggleGroup,\n+  Toolbar,\n+  ToolbarContent,\n+  TextInput,\n+  InputGroup\n+} from '@patternfly/react-core';\n+import { FilterIcon, SyncIcon } from '@patternfly/react-icons';\n+import _ from 'lodash';\n+import TaskConsoleContext, {\n+  IContext\n+} from '../../../context/TaskConsoleContext/TaskConsoleContext';\n+import { GraphQL, componentOuiaProps, OUIAProps } from '@kogito-apps/common';\n+import { getAllTaskStates } from '../../../util/Utils';\n+\n+interface ITaskInboxFilterProps {\n+  applyFilter: () => void;\n+  resetFilter: () => void;\n+}\n+const TaskInboxToolbar: React.FC<ITaskInboxFilterProps & OUIAProps> = ({\n+  applyFilter,\n+  resetFilter,\n+  ouiaSafe,\n+  ouiaId\n+}) => {\n+  const context: IContext<GraphQL.UserTaskInstance> = useContext(\n+    TaskConsoleContext\n+  );\n+  const [, forceUpdate] = useReducer(x => x + 1, 0);\n+  const [isExpanded, setIsExpanded] = useState(false);\n+  const [searchText, setSearchText] = useState<string>('');\n+\n+  useEffect(() => {\n+    context.getActiveFilters().selectedStatus = [\n+      ...context.getActiveFilters().filters.status\n+    ];\n+    forceUpdate();\n+  }, []);\n+\n+  const onFilterClick = () => {\n+    context.getActiveFilters().filters.status = [\n+      ...context.getActiveFilters().selectedStatus\n+    ];\n+    if (\n+      !context.getActiveFilters().filters.taskNames.includes(searchText) &&\n+      searchText.length > 0\n+    ) {\n+      context.getActiveFilters().filters.taskNames = [\n+        ...context.getActiveFilters().filters.taskNames,\n+        searchText\n+      ];\n+    }\n+    setSearchText('');\n+    applyFilter();\n+  };\n+\n+  const onSelect = (event: React.MouseEvent, selection: string): void => {\n+    const selectedStatus = context.getActiveFilters().selectedStatus;\n+    if (!selectedStatus.includes(selection)) {\n+      selectedStatus.push(selection);\n+    } else {\n+      _.remove(selectedStatus, (status: string) => {\n+        return status === selection;\n+      });\n+    }\n+\n+    forceUpdate();\n+  };\n+\n+  const onDelete = (type: string = '', id: string = ''): void => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56745627360328b538208722a654c022f8ee034f"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4Mjc0NA==", "bodyText": "done :)", "url": "https://github.com/kiegroup/kogito-apps/pull/475#discussion_r503882744", "createdAt": "2020-10-13T11:43:33Z", "author": {"login": "AjayJagan"}, "path": "ui-packages/packages/task-console/src/components/Molecules/TaskInboxToolbar/TaskInboxToolbar.tsx", "diffHunk": "@@ -0,0 +1,209 @@\n+import React, { useState, useContext, useReducer, useEffect } from 'react';\n+import {\n+  Button,\n+  Select,\n+  SelectOption,\n+  SelectVariant,\n+  ToolbarFilter,\n+  ToolbarGroup,\n+  ToolbarItem,\n+  ToolbarToggleGroup,\n+  Toolbar,\n+  ToolbarContent,\n+  TextInput,\n+  InputGroup\n+} from '@patternfly/react-core';\n+import { FilterIcon, SyncIcon } from '@patternfly/react-icons';\n+import _ from 'lodash';\n+import TaskConsoleContext, {\n+  IContext\n+} from '../../../context/TaskConsoleContext/TaskConsoleContext';\n+import { GraphQL, componentOuiaProps, OUIAProps } from '@kogito-apps/common';\n+import { getAllTaskStates } from '../../../util/Utils';\n+\n+interface ITaskInboxFilterProps {\n+  applyFilter: () => void;\n+  resetFilter: () => void;\n+}\n+const TaskInboxToolbar: React.FC<ITaskInboxFilterProps & OUIAProps> = ({\n+  applyFilter,\n+  resetFilter,\n+  ouiaSafe,\n+  ouiaId\n+}) => {\n+  const context: IContext<GraphQL.UserTaskInstance> = useContext(\n+    TaskConsoleContext\n+  );\n+  const [, forceUpdate] = useReducer(x => x + 1, 0);\n+  const [isExpanded, setIsExpanded] = useState(false);\n+  const [searchText, setSearchText] = useState<string>('');\n+\n+  useEffect(() => {\n+    context.getActiveFilters().selectedStatus = [\n+      ...context.getActiveFilters().filters.status\n+    ];\n+    forceUpdate();\n+  }, []);\n+\n+  const onFilterClick = () => {\n+    context.getActiveFilters().filters.status = [\n+      ...context.getActiveFilters().selectedStatus\n+    ];\n+    if (\n+      !context.getActiveFilters().filters.taskNames.includes(searchText) &&\n+      searchText.length > 0\n+    ) {\n+      context.getActiveFilters().filters.taskNames = [\n+        ...context.getActiveFilters().filters.taskNames,\n+        searchText\n+      ];\n+    }\n+    setSearchText('');\n+    applyFilter();\n+  };\n+\n+  const onSelect = (event: React.MouseEvent, selection: string): void => {\n+    const selectedStatus = context.getActiveFilters().selectedStatus;\n+    if (!selectedStatus.includes(selection)) {\n+      selectedStatus.push(selection);\n+    } else {\n+      _.remove(selectedStatus, (status: string) => {\n+        return status === selection;\n+      });\n+    }\n+\n+    forceUpdate();\n+  };\n+\n+  const onDelete = (type: string = '', id: string = ''): void => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgyMTUzNw=="}, "originalCommit": {"oid": "56745627360328b538208722a654c022f8ee034f"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTgxOTcyOnYy", "diffSide": "RIGHT", "path": "ui-packages/packages/task-console/src/components/Molecules/TaskInboxToolbar/tests/TaskInboxToolbar.test.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMDowMDoxMVrOHgfBcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMTo0MzozOVrOHgikPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgyNDc1Mg==", "bodyText": "can't we filter the options based on the status string rather than relying on fixed offset?", "url": "https://github.com/kiegroup/kogito-apps/pull/475#discussion_r503824752", "createdAt": "2020-10-13T10:00:11Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/task-console/src/components/Molecules/TaskInboxToolbar/tests/TaskInboxToolbar.test.tsx", "diffHunk": "@@ -0,0 +1,165 @@\n+import React, { FormEvent } from 'react';\n+import TaskInboxToolbar from '../TaskInboxToolbar';\n+import { getWrapper, GraphQL, DefaultUser, User } from '@kogito-apps/common';\n+import TaskConsoleContext, {\n+  DefaultContext\n+} from '../../../../context/TaskConsoleContext/TaskConsoleContext';\n+import {\n+  Select,\n+  SelectOption,\n+  Chip,\n+  TextInputBase\n+} from '@patternfly/react-core';\n+import { act } from 'react-dom/test-utils';\n+import wait from 'waait';\n+/* tslint:disable */\n+const testUser: User = new DefaultUser('test', ['group1', 'group2']);\n+const applyFilter = jest.fn();\n+const resetFilter = jest.fn();\n+\n+const getTaskInboxWrapper = context => {\n+  return getWrapper(\n+    <TaskConsoleContext.Provider value={context}>\n+      <TaskInboxToolbar applyFilter={applyFilter} resetFilter={resetFilter} />\n+    </TaskConsoleContext.Provider>,\n+    'TaskInboxToolbar'\n+  );\n+};\n+\n+describe('TaskInbox toolbar tests', () => {\n+  it('toolbar initial snapshot', () => {\n+    const context = new DefaultContext<GraphQL.UserTaskInstance>(testUser);\n+    expect(getTaskInboxWrapper(context)).toMatchSnapshot();\n+  });\n+  it('select status from dropdown', () => {\n+    const context = new DefaultContext<GraphQL.UserTaskInstance>(testUser);\n+    let wrapper = getTaskInboxWrapper(context);\n+    wrapper\n+      .find(Select)\n+      .find('button')\n+      .simulate('click');\n+    wrapper = wrapper.update();\n+    // check length to be 5\n+    expect(wrapper.find(Select).find(SelectOption).length).toBe(5);\n+    wrapper\n+      .find(Select)\n+      .find(SelectOption)\n+      .at(2)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56745627360328b538208722a654c022f8ee034f"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4MjgxMg==", "bodyText": "done :)", "url": "https://github.com/kiegroup/kogito-apps/pull/475#discussion_r503882812", "createdAt": "2020-10-13T11:43:39Z", "author": {"login": "AjayJagan"}, "path": "ui-packages/packages/task-console/src/components/Molecules/TaskInboxToolbar/tests/TaskInboxToolbar.test.tsx", "diffHunk": "@@ -0,0 +1,165 @@\n+import React, { FormEvent } from 'react';\n+import TaskInboxToolbar from '../TaskInboxToolbar';\n+import { getWrapper, GraphQL, DefaultUser, User } from '@kogito-apps/common';\n+import TaskConsoleContext, {\n+  DefaultContext\n+} from '../../../../context/TaskConsoleContext/TaskConsoleContext';\n+import {\n+  Select,\n+  SelectOption,\n+  Chip,\n+  TextInputBase\n+} from '@patternfly/react-core';\n+import { act } from 'react-dom/test-utils';\n+import wait from 'waait';\n+/* tslint:disable */\n+const testUser: User = new DefaultUser('test', ['group1', 'group2']);\n+const applyFilter = jest.fn();\n+const resetFilter = jest.fn();\n+\n+const getTaskInboxWrapper = context => {\n+  return getWrapper(\n+    <TaskConsoleContext.Provider value={context}>\n+      <TaskInboxToolbar applyFilter={applyFilter} resetFilter={resetFilter} />\n+    </TaskConsoleContext.Provider>,\n+    'TaskInboxToolbar'\n+  );\n+};\n+\n+describe('TaskInbox toolbar tests', () => {\n+  it('toolbar initial snapshot', () => {\n+    const context = new DefaultContext<GraphQL.UserTaskInstance>(testUser);\n+    expect(getTaskInboxWrapper(context)).toMatchSnapshot();\n+  });\n+  it('select status from dropdown', () => {\n+    const context = new DefaultContext<GraphQL.UserTaskInstance>(testUser);\n+    let wrapper = getTaskInboxWrapper(context);\n+    wrapper\n+      .find(Select)\n+      .find('button')\n+      .simulate('click');\n+    wrapper = wrapper.update();\n+    // check length to be 5\n+    expect(wrapper.find(Select).find(SelectOption).length).toBe(5);\n+    wrapper\n+      .find(Select)\n+      .find(SelectOption)\n+      .at(2)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgyNDc1Mg=="}, "originalCommit": {"oid": "56745627360328b538208722a654c022f8ee034f"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTg1MTY3OnYy", "diffSide": "RIGHT", "path": "ui-packages/packages/task-console/src/components/Organisms/TaskInbox/tests/TaskInbox.test.tsx", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMDowODo1M1rOHgfVjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMTo0Mzo1NFrOHgikwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgyOTkwMg==", "bodyText": "We need to mock the TaskInboxToolbar in all but this test to prevent the huge snapshot file.\nEasiest way might be:\n\nmove this test to a separate file.\nin TaskInbox.test.tsx mock the TaskInboxToolbar component.\nin the new file don't mock it (for exactly this test).", "url": "https://github.com/kiegroup/kogito-apps/pull/475#discussion_r503829902", "createdAt": "2020-10-13T10:08:53Z", "author": {"login": "jstastny-cz"}, "path": "ui-packages/packages/task-console/src/components/Organisms/TaskInbox/tests/TaskInbox.test.tsx", "diffHunk": "@@ -324,4 +469,188 @@ describe('TaskInbox tests', () => {\n       direction: 'asc'\n     });\n   });\n+\n+  it('show no filters selected state and select reset', async () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56745627360328b538208722a654c022f8ee034f"}, "originalPosition": 345}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4Mjk0Ng==", "bodyText": "@jstastny-cz , please tell me if the file name looks ok", "url": "https://github.com/kiegroup/kogito-apps/pull/475#discussion_r503882946", "createdAt": "2020-10-13T11:43:54Z", "author": {"login": "AjayJagan"}, "path": "ui-packages/packages/task-console/src/components/Organisms/TaskInbox/tests/TaskInbox.test.tsx", "diffHunk": "@@ -324,4 +469,188 @@ describe('TaskInbox tests', () => {\n       direction: 'asc'\n     });\n   });\n+\n+  it('show no filters selected state and select reset', async () => {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgyOTkwMg=="}, "originalCommit": {"oid": "56745627360328b538208722a654c022f8ee034f"}, "originalPosition": 345}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 747, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}