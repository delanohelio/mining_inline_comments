{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNzk2MzQ1", "number": 174, "title": "KOGITO-1378 Periodic job already running is not canceled", "bodyText": "A periodic job already running can be canceled properly.", "createdAt": "2020-04-13T19:21:03Z", "url": "https://github.com/kiegroup/kogito-apps/pull/174", "merged": true, "mergeCommit": {"oid": "c59870d34e7ecb42075266f90dea3208cb46de9c"}, "closed": true, "closedAt": "2020-04-20T20:58:43Z", "author": {"login": "tiagodolphine"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXT5ibgH2gAyNDAyNzk2MzQ1OjdhMzBmYmMwODM4ZjYzODRiMjUxYzYxNzQ3MmJiMWZlMTg5YzFhZWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYcZvFgFqTM5NTIzMTkwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7a30fbc0838f6384b251c617472bb1fe189c1aec", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/7a30fbc0838f6384b251c617472bb1fe189c1aec", "committedDate": "2020-04-13T19:17:23Z", "message": "KOGITO-1378 Periodic job already running is not canceled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNTUzOTg3", "url": "https://github.com/kiegroup/kogito-apps/pull/174#pullrequestreview-392553987", "createdAt": "2020-04-14T02:02:51Z", "commit": {"oid": "7a30fbc0838f6384b251c617472bb1fe189c1aec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjU2NDM5", "url": "https://github.com/kiegroup/kogito-apps/pull/174#pullrequestreview-393656439", "createdAt": "2020-04-15T10:40:25Z", "commit": {"oid": "7a30fbc0838f6384b251c617472bb1fe189c1aec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDo0MDoyNVrOGFz7rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMDo0MDoyNVrOGFz7rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc0NjkyNg==", "bodyText": "Value of this captor is never retrieved.", "url": "https://github.com/kiegroup/kogito-apps/pull/174#discussion_r408746926", "createdAt": "2020-04-15T10:40:25Z", "author": {"login": "MarianMacik"}, "path": "jobs-service/src/test/java/org/kie/kogito/jobs/service/scheduler/BaseTimerJobSchedulerTest.java", "diffHunk": "@@ -165,6 +165,11 @@ private void testExistingJob(boolean expired, JobStatus jobStatus) {\n         verify(tested(), expired ? never() : times(1)).doSchedule(delayCaptor.capture(), eq(job));\n         verify(jobRepository, expired ? never() : times(1)).save(scheduleCaptor.capture());\n \n+        //assert always a scheduled job is canceled (periodic or not)\n+        Optional.ofNullable(jobStatus)\n+                .filter(SCHEDULED::equals)\n+                .ifPresent(s -> verify(tested()).cancel(scheduleCaptorFuture.capture()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a30fbc0838f6384b251c617472bb1fe189c1aec"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a23589d1a3a940f8e9a8b566865fd4396faf699", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/9a23589d1a3a940f8e9a8b566865fd4396faf699", "committedDate": "2020-04-15T14:53:17Z", "message": "Iserting integration test to cancel a periodic running job"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96ed05878bb2088d93845cbbd424c53dabd3d2bc", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/96ed05878bb2088d93845cbbd424c53dabd3d2bc", "committedDate": "2020-04-15T15:28:33Z", "message": "Inserting missing assertions on BaseTimerJobSchedulerTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e11bdcc768acd1a62044486a5039533cc77a7a0", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/0e11bdcc768acd1a62044486a5039533cc77a7a0", "committedDate": "2020-04-16T14:28:15Z", "message": "Adding tests to JobResourceTest.java to test cancel running non-periodic jobs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MjMwMjg0", "url": "https://github.com/kiegroup/kogito-apps/pull/174#pullrequestreview-395230284", "createdAt": "2020-04-17T07:43:10Z", "commit": {"oid": "0e11bdcc768acd1a62044486a5039533cc77a7a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzo0MzoxMFrOGHDXnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwNzo0MzoxMFrOGHDXnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA0ODQxMg==", "bodyText": "This test seems to be same as getAfterCreate(), it just contains additional assertions, can they be merged together?", "url": "https://github.com/kiegroup/kogito-apps/pull/174#discussion_r410048412", "createdAt": "2020-04-17T07:43:10Z", "author": {"login": "sutaakar"}, "path": "jobs-service/src/test/java/org/kie/kogito/jobs/service/resource/JobResourceTest.java", "diffHunk": "@@ -100,25 +107,115 @@ void getAfterCreate() throws Exception {\n         final String id = \"3\";\n         final Job job = getJob(id);\n         create(jobToJson(job));\n-        final ScheduledJob scheduledJob = given()\n+        assertGetScheduledJob(id);\n+    }\n+\n+    @Test\n+    void executeTest() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e11bdcc768acd1a62044486a5039533cc77a7a0"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MjMxOTAz", "url": "https://github.com/kiegroup/kogito-apps/pull/174#pullrequestreview-395231903", "createdAt": "2020-04-17T07:45:43Z", "commit": {"oid": "0e11bdcc768acd1a62044486a5039533cc77a7a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 224, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}