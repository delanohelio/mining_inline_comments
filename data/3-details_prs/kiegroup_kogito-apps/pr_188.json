{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0Njk5MTc2", "number": 188, "title": "KOGITO-1108 [Jobs Service] API to allow updating the callback for a Job", "bodyText": "", "createdAt": "2020-04-16T20:27:04Z", "url": "https://github.com/kiegroup/kogito-apps/pull/188", "merged": true, "mergeCommit": {"oid": "fc4e775b2e9c70972cbe5e8c9675d1fd82ff09d6"}, "closed": true, "closedAt": "2020-05-12T07:11:29Z", "author": {"login": "tiagodolphine"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZdxEfAFqTM5NjM4NDA1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgPuP4gFqTQwOTE3Mjk2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2Mzg0MDU0", "url": "https://github.com/kiegroup/kogito-apps/pull/188#pullrequestreview-396384054", "createdAt": "2020-04-20T11:55:02Z", "commit": {"oid": "03a97a1ea13248a4b03913135f07aa4cf615f915"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NjU0NDQ1", "url": "https://github.com/kiegroup/kogito-apps/pull/188#pullrequestreview-396654445", "createdAt": "2020-04-20T17:16:14Z", "commit": {"oid": "03a97a1ea13248a4b03913135f07aa4cf615f915"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNzoxNjoxNFrOGIfGPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNzoxNjoxNFrOGIfGPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU1MTI5NQ==", "bodyText": "PATCH (like PUT) should target a specific ID, present as a path param.http://restcookbook.com/HTTP%20Methods/patch/", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r411551295", "createdAt": "2020-04-20T17:16:14Z", "author": {"login": "radtriste"}, "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java", "diffHunk": "@@ -64,6 +65,17 @@\n                 .thenApply(j -> j.orElseThrow(() -> new RuntimeException(\"Failed to schedule job \" + job)));\n     }\n \n+    @PATCH\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    public CompletionStage<ScheduledJob> patch(Job job) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03a97a1ea13248a4b03913135f07aa4cf615f915"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MTA1OTk1", "url": "https://github.com/kiegroup/kogito-apps/pull/188#pullrequestreview-397105995", "createdAt": "2020-04-21T08:31:48Z", "commit": {"oid": "ebbf90fa5feb6b688f7444098dd199ef1df6a2af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwODozMTo0OFrOGI5gFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwODozMTo0OFrOGI5gFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk4Mzg5Mw==", "bodyText": "This should not be needed on a patch.\nthe job structure contains only the fields which need to be updated\nso id is not present in it", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r411983893", "createdAt": "2020-04-21T08:31:48Z", "author": {"login": "radtriste"}, "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java", "diffHunk": "@@ -64,6 +66,25 @@\n                 .thenApply(j -> j.orElseThrow(() -> new RuntimeException(\"Failed to schedule job \" + job)));\n     }\n \n+    @PATCH\n+    @Path(\"/{id}\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n+        LOGGER.debug(\"REST patch update {}\", job);\n+\n+        //validate parameters for job and id\n+        Optional.ofNullable(job)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebbf90fa5feb6b688f7444098dd199ef1df6a2af"}, "originalPosition": 27}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ebbf90fa5feb6b688f7444098dd199ef1df6a2af", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/ebbf90fa5feb6b688f7444098dd199ef1df6a2af", "committedDate": "2020-04-20T18:11:55Z", "message": "Inserting id on the patch path"}, "afterCommit": {"oid": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "committedDate": "2020-05-05T20:32:33Z", "message": "Use job id on path to apply the patch method and rebase with master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NDA2MzA0", "url": "https://github.com/kiegroup/kogito-apps/pull/188#pullrequestreview-406406304", "createdAt": "2020-05-06T08:36:42Z", "commit": {"oid": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwODozNjo0MlrOGRJKDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQwODo0MDo0N1rOGRJS-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYyOTAwNQ==", "bodyText": "ScheduledJob.builder().job(job).build()\ncould we have something like ScheduledJob.from(job) instead that is hiding this implementation ?", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r420629005", "createdAt": "2020-05-06T08:36:42Z", "author": {"login": "radtriste"}, "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java", "diffHunk": "@@ -64,6 +66,18 @@\n                 .thenApply(j -> j.orElseThrow(() -> new RuntimeException(\"Failed to schedule job \" + job)));\n     }\n \n+    @PATCH\n+    @Path(\"/{id}\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n+        LOGGER.debug(\"REST patch update {}\", job);\n+        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYzMTI5MA==", "bodyText": "could we have that on one line ?\nmake it in fact hard to read like that whereas it is a simple thing...", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r420631290", "createdAt": "2020-05-06T08:40:47Z", "author": {"login": "radtriste"}, "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java", "diffHunk": "@@ -66,4 +69,23 @@ public BaseReactiveJobRepository(Vertx vertx, JobStreams jobStreams) {\n         return delete(job.getId())\n                 .thenApply(j -> jobStreams.publishJobStatusChange(job));\n     }\n+\n+    @Override\n+    public CompletionStage<ScheduledJob> merge(String id, ScheduledJob job) {\n+        return Optional.ofNullable(id)\n+                .filter(StringUtils::isNotBlank)\n+                .filter(s -> StringUtils.isBlank(job.getId()) || s.equals(job.getId()))\n+                .map(s -> get(s)\n+                        .thenApply(Optional::ofNullable)\n+                        .thenApply(current -> current\n+                                .map(j -> ScheduledJob", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "602130b5faf42dbb43b534ba0171288bb7785709", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/602130b5faf42dbb43b534ba0171288bb7785709", "committedDate": "2020-05-11T12:53:13Z", "message": "KOGITO-1108 [Jobs Service] API to allow updating the callback for a Job"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2a4d5321fde4dc716d2b06c55a195d644b391a6", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/d2a4d5321fde4dc716d2b06c55a195d644b391a6", "committedDate": "2020-05-11T12:53:13Z", "message": "Handle job not found on merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0afd13229052f4c1584e68078268f05f13aa69e", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/d0afd13229052f4c1584e68078268f05f13aa69e", "committedDate": "2020-05-11T12:53:13Z", "message": "Inserting id on the patch path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad7ffdbadf168286d543119dcea34d0a0df30ba1", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/ad7ffdbadf168286d543119dcea34d0a0df30ba1", "committedDate": "2020-05-11T12:53:13Z", "message": "Use job id on path to apply the patch method and rebase with master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd2640abd6b5bdf2b51432ee0531c0dd7d557cb9", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/dd2640abd6b5bdf2b51432ee0531c0dd7d557cb9", "committedDate": "2020-05-11T12:53:13Z", "message": "Reformatting merge method on BaseReactiveJobRepository"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTQ2NDA5", "url": "https://github.com/kiegroup/kogito-apps/pull/188#pullrequestreview-409146409", "createdAt": "2020-05-11T12:58:27Z", "commit": {"oid": "fcb9293a1bb59f6b7bb2057e2157bd06e6ef008d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03e959bdf786efc2da5160adf761f0bbfa1edbaf", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/03e959bdf786efc2da5160adf761f0bbfa1edbaf", "committedDate": "2020-05-11T13:12:42Z", "message": "Adding a helper method to create a ScheduledJob based on Job"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fcb9293a1bb59f6b7bb2057e2157bd06e6ef008d", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/fcb9293a1bb59f6b7bb2057e2157bd06e6ef008d", "committedDate": "2020-05-06T12:32:33Z", "message": "Reformatting merge method on BaseReactiveJobRepository"}, "afterCommit": {"oid": "03e959bdf786efc2da5160adf761f0bbfa1edbaf", "author": {"user": {"login": "tiagodolphine", "name": "Tiago Dolphine"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/03e959bdf786efc2da5160adf761f0bbfa1edbaf", "committedDate": "2020-05-11T13:12:42Z", "message": "Adding a helper method to create a ScheduledJob based on Job"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MTcyOTYw", "url": "https://github.com/kiegroup/kogito-apps/pull/188#pullrequestreview-409172960", "createdAt": "2020-05-11T13:30:45Z", "commit": {"oid": "03e959bdf786efc2da5160adf761f0bbfa1edbaf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4987, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}