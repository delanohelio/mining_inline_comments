{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2Mjg4OTI5", "number": 345, "title": "KOGITO-2741 Enrich TrustyService with data types information from TraceEvents", "bodyText": "Related JIRA ticket\nRelated PR in kogito-runtimes", "createdAt": "2020-07-24T13:31:11Z", "url": "https://github.com/kiegroup/kogito-apps/pull/345", "merged": true, "mergeCommit": {"oid": "51e21fd2ecf2230bd608381d425c8a6d902edd8a"}, "closed": true, "closedAt": "2020-08-19T16:36:07Z", "author": {"login": "kostola"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4FoVEgFqTQ1NDk3NDY0Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAeTiwAFqTQ3MDY0Mjk3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0OTc0NjQ2", "url": "https://github.com/kiegroup/kogito-apps/pull/345#pullrequestreview-454974646", "createdAt": "2020-07-24T15:19:25Z", "commit": {"oid": "300f0454960ec11647872de77bff09207b2b5d6f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NTg2ODkx", "url": "https://github.com/kiegroup/kogito-apps/pull/345#pullrequestreview-456586891", "createdAt": "2020-07-28T12:37:31Z", "commit": {"oid": "c00361c416a0a60906f8c9957eace8678a96a9cb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMjozNzozMVrOG4Kg4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMjozNzozMVrOG4Kg4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU0NTY5OQ==", "bodyText": "Would it be possible split these long lines to make code more readable?", "url": "https://github.com/kiegroup/kogito-apps/pull/345#discussion_r461545699", "createdAt": "2020-07-28T12:37:31Z", "author": {"login": "jiripetrlik"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/TrustyServiceTestUtils.java", "diffHunk": "@@ -363,19 +397,19 @@ private static TraceHeader buildHeader(String executionId, Long startTs, Long en\n     }\n \n     private static TraceInputValue buildInputDriver(String value, List<Message> messages) {\n-        return new TraceInputValue(INPUT_DRIVER_NODE_ID, INPUT_DRIVER_NODE_NAME, tDriverType, toJsonNode(value), messages);\n+        return new TraceInputValue(INPUT_DRIVER_NODE_ID, INPUT_DRIVER_NODE_NAME, value == null ? vEventDriverNull : vEventDriver, messages);\n     }\n \n     private static TraceInputValue buildInputViolation(String value, List<Message> messages) {\n-        return new TraceInputValue(INPUT_VIOLATION_NODE_ID, INPUT_VIOLATION_NODE_NAME, tViolationType, toJsonNode(value), messages);\n+        return new TraceInputValue(INPUT_VIOLATION_NODE_ID, INPUT_VIOLATION_NODE_NAME, vEventViolation, messages);\n     }\n \n     private static TraceOutputValue buildOutputFine(String value, List<Message> messages) {\n-        return new TraceOutputValue(OUTPUT_FINE_NODE_ID, OUTPUT_FINE_NODE_NAME, EVALUATION_STATUS_SUCCEEDED, tFineType, toJsonNode(value), messages);\n+        return new TraceOutputValue(OUTPUT_FINE_NODE_ID, OUTPUT_FINE_NODE_NAME, EVALUATION_STATUS_SUCCEEDED, vEventFine, Map.of(INPUT_VIOLATION_NODE_NAME, vEventViolation), messages);\n     }\n \n     private static TraceOutputValue buildOutputShouldTheDriverBeSuspended(String status, String value, List<Message> messages) {\n-        return new TraceOutputValue(OUTPUT_SHOULD_THE_DRIVER_BE_SUSPENDED_NODE_ID, OUTPUT_SHOULD_THE_DRIVER_BE_SUSPENDED_NODE_NAME, status, stringType, toJsonNode(value), messages);\n+        return new TraceOutputValue(OUTPUT_SHOULD_THE_DRIVER_BE_SUSPENDED_NODE_ID, OUTPUT_SHOULD_THE_DRIVER_BE_SUSPENDED_NODE_NAME, status, value == null ? null : vEventSuspended, value == null ? Map.of(\"Fine\", vEventFine) : Map.of(\"Driver\", vEventDriver, \"Fine\", vEventFine), messages);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c00361c416a0a60906f8c9957eace8678a96a9cb"}, "originalPosition": 143}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3ODIxODMw", "url": "https://github.com/kiegroup/kogito-apps/pull/345#pullrequestreview-457821830", "createdAt": "2020-07-29T19:25:48Z", "commit": {"oid": "7b68a0f6f29b150e0e75b7e3b6de1d8411d6e5ad"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToyNTo0OFrOG5G3Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOToyNTo0OFrOG5G3Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUzNDQwMw==", "bodyText": "It's quite hard to understand what are the created objects and what it's really tested. Isnt't better to create a resource file and deserialize it?\nIf this is not a stable implementation and you prefer to create the things programmatically, do you mind to create a ticket so that we keep track that we have to change it in the future?", "url": "https://github.com/kiegroup/kogito-apps/pull/345#discussion_r462534403", "createdAt": "2020-07-29T19:25:48Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/src/test/java/org/kie/kogito/trusty/service/responses/TypedVariableResponseTest.java", "diffHunk": "@@ -0,0 +1,204 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+\n+package org.kie.kogito.trusty.service.responses;\n+\n+import java.util.List;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import io.cloudevents.json.Json;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.kie.kogito.trusty.storage.api.model.TypedVariable;\n+\n+class TypedVariableResponseTest {\n+\n+    private static final String FIELD_COMPONENTS = \"components\";\n+    private static final String FIELD_NAME = \"name\";\n+    private static final String FIELD_TYPE_REF = \"typeRef\";\n+    private static final String FIELD_VALUE = \"value\";\n+    private static final String TYPE_REF_NUMBER = \"number\";\n+    private static final String TYPE_REF_STRING = \"string\";\n+    private static final String TYPE_REF_STRUCT = \"StructType\";\n+    private static final String VAR_NAME_COLLECTION = \"tstCollection\";\n+    private static final String VAR_NAME_STRUCT = \"tstStruct\";\n+    private static final String VAR_NAME_UNIT = \"tstUnit\";\n+    private static final String VALUE_AGE = \"age\";\n+    private static final String VALUE_COUNT_ONE = \"One\";\n+    private static final String VALUE_COUNT_TWO = \"Two\";\n+    private static final String VALUE_COUNT_THREE = \"Three\";\n+    private static final String VALUE_HELLO_THIS_IS_A_TEST = \"hello this is a test\";\n+    private static final String VALUE_MILANO = \"Milano\";\n+    private static final String VALUE_MONZA = \"Monza\";\n+    private static final String VALUE_TAVULLIA = \"Tavullia\";\n+    private static final String VALUE_TOWN = \"town\";\n+    private static final int VALUE_34 = 34;\n+    private static final int VALUE_41 = 41;\n+    private static final int VALUE_50 = 50;\n+\n+    @Test\n+    void testCollection() throws JsonProcessingException {\n+        TypedVariableResponse response = TypedVariableResponse.from(buildTestCollection());\n+\n+        Assertions.assertEquals(VAR_NAME_COLLECTION, response.getName());\n+        Assertions.assertEquals(TYPE_REF_STRING, response.getTypeRef());\n+        Assertions.assertNotNull(response.getValue());\n+        Assertions.assertNull(response.getComponents());\n+\n+        Assertions.assertTrue(response.getValue().isArray());\n+        Assertions.assertSame(3, response.getValue().size());\n+        Assertions.assertTrue(response.getValue().get(0).isTextual());\n+        Assertions.assertEquals(VALUE_COUNT_ONE, response.getValue().get(0).textValue());\n+        Assertions.assertTrue(response.getValue().get(1).isTextual());\n+        Assertions.assertEquals(VALUE_COUNT_TWO, response.getValue().get(1).textValue());\n+        Assertions.assertTrue(response.getValue().get(2).isTextual());\n+        Assertions.assertEquals(VALUE_COUNT_THREE, response.getValue().get(2).textValue());\n+    }\n+\n+    @Test\n+    void testCollectionOfStructures() throws JsonProcessingException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b68a0f6f29b150e0e75b7e3b6de1d8411d6e5ad"}, "originalPosition": 73}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b68a0f6f29b150e0e75b7e3b6de1d8411d6e5ad", "author": {"user": {"login": "danielezonca", "name": "Daniele Zonca"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/7b68a0f6f29b150e0e75b7e3b6de1d8411d6e5ad", "committedDate": "2020-07-29T07:19:53Z", "message": "Update TrustyServiceTestUtils.java"}, "afterCommit": {"oid": "63791dfa4dbae03ffc20972333080479cd73902b", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/63791dfa4dbae03ffc20972333080479cd73902b", "committedDate": "2020-08-11T08:16:58Z", "message": "[KOGITO-2741] Fix TypedVariableResponse and add TypedVariableResponseTest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63791dfa4dbae03ffc20972333080479cd73902b", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/63791dfa4dbae03ffc20972333080479cd73902b", "committedDate": "2020-08-11T08:16:58Z", "message": "[KOGITO-2741] Fix TypedVariableResponse and add TypedVariableResponseTest"}, "afterCommit": {"oid": "0d7f369485d4cdbb4e93e8ea6b05ef8faa30cbf6", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/0d7f369485d4cdbb4e93e8ea6b05ef8faa30cbf6", "committedDate": "2020-08-13T14:48:30Z", "message": "[KOGITO-2741] Minor fixes to make trusty-service work with Audit UI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d7f369485d4cdbb4e93e8ea6b05ef8faa30cbf6", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/0d7f369485d4cdbb4e93e8ea6b05ef8faa30cbf6", "committedDate": "2020-08-13T14:48:30Z", "message": "[KOGITO-2741] Minor fixes to make trusty-service work with Audit UI"}, "afterCommit": {"oid": "3b757f57a3b1e7c4ee43f2314fd6fab8a2d3bb21", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/3b757f57a3b1e7c4ee43f2314fd6fab8a2d3bb21", "committedDate": "2020-08-17T13:28:27Z", "message": "[KOGITO-2741] Minor fixes to make trusty-service work with Audit UI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb38eab3ec458b124015bb997f726c409d8a1144", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/cb38eab3ec458b124015bb997f726c409d8a1144", "committedDate": "2020-08-17T13:39:08Z", "message": "[KOGITO-2741] Small code polish"}, "afterCommit": {"oid": "fd93a73c0d94ea69e867ace1dd9dc1adc4e79b07", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/fd93a73c0d94ea69e867ace1dd9dc1adc4e79b07", "committedDate": "2020-08-17T16:20:57Z", "message": "[KOGITO-2741] Fix ExecutionHeaderResponse hasSucceeded property name to align with Audit UI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8849e5cbc8306a299909484cd820ed50d2683c59", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/8849e5cbc8306a299909484cd820ed50d2683c59", "committedDate": "2020-08-18T07:37:01Z", "message": "[KOGITO-2741] Enhance TypedVariable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a822450ff2ac0bfbf1c6a0553e0dbe1745ade33", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/5a822450ff2ac0bfbf1c6a0553e0dbe1745ade33", "committedDate": "2020-08-18T07:37:01Z", "message": "[KOGITO-2741] Improve tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae91b35faac7ecca484b2e52b3e33b651bc2321f", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/ae91b35faac7ecca484b2e52b3e33b651bc2321f", "committedDate": "2020-08-18T07:37:01Z", "message": "[KOGITO-2741] Fix TypedVariableResponse and add TypedVariableResponseTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d5b37680ac4a876977340cf42234402d23f7c7e", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/7d5b37680ac4a876977340cf42234402d23f7c7e", "committedDate": "2020-08-18T07:37:01Z", "message": "[KOGITO-2741] Minor fixes to make trusty-service work with Audit UI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22203cfeab6ae19c91dcb8f541a743b37c2da9f3", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/22203cfeab6ae19c91dcb8f541a743b37c2da9f3", "committedDate": "2020-08-18T07:37:01Z", "message": "[KOGITO-2741] Small code polish"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea450b675fb096f9073c2a1ec10247b57ef6a64e", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/ea450b675fb096f9073c2a1ec10247b57ef6a64e", "committedDate": "2020-08-18T07:37:01Z", "message": "[KOGITO-2741] Fix ExecutionHeaderResponse hasSucceeded property name to align with Audit UI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc01ca04c51da77646d80f56b4c6ddcedf90a29d", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/dc01ca04c51da77646d80f56b4c6ddcedf90a29d", "committedDate": "2020-08-18T11:37:41Z", "message": "[KOGITO-2741] Test hasSucceeded field"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd93a73c0d94ea69e867ace1dd9dc1adc4e79b07", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/fd93a73c0d94ea69e867ace1dd9dc1adc4e79b07", "committedDate": "2020-08-17T16:20:57Z", "message": "[KOGITO-2741] Fix ExecutionHeaderResponse hasSucceeded property name to align with Audit UI"}, "afterCommit": {"oid": "dc01ca04c51da77646d80f56b4c6ddcedf90a29d", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/dc01ca04c51da77646d80f56b4c6ddcedf90a29d", "committedDate": "2020-08-18T11:37:41Z", "message": "[KOGITO-2741] Test hasSucceeded field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6db551fc24d342e326bb351d428d706d29b0c177", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/6db551fc24d342e326bb351d428d706d29b0c177", "committedDate": "2020-08-18T16:53:23Z", "message": "[KOGITO-2741] Persist execution source URL and return it via API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5ODE4NTU5", "url": "https://github.com/kiegroup/kogito-apps/pull/345#pullrequestreview-469818559", "createdAt": "2020-08-18T20:46:54Z", "commit": {"oid": "6db551fc24d342e326bb351d428d706d29b0c177"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMDo0Njo1NFrOHCmFdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQyMDo0Njo1NFrOHCmFdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjQ4MzE5MQ==", "bodyText": "Is this the rest response object?\nDo we need this information in UI side?", "url": "https://github.com/kiegroup/kogito-apps/pull/345#discussion_r472483191", "createdAt": "2020-08-18T20:46:54Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-service/src/main/java/org/kie/kogito/trusty/service/responses/ExecutionHeaderResponse.java", "diffHunk": "@@ -33,11 +33,14 @@\n     @JsonProperty(\"executionId\")\n     private String executionId;\n \n+    @JsonProperty(\"sourceUrl\")\n+    private String sourceUrl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6db551fc24d342e326bb351d428d706d29b0c177"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22972f343818d1f7c89cc0d3cbef3d781f8c348c", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/22972f343818d1f7c89cc0d3cbef3d781f8c348c", "committedDate": "2020-08-19T10:22:00Z", "message": "[KOGITO-2741] Increase coverage of trusty-service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b8251f47787096e9489ad1cb85b39e57f0c8d8b", "author": {"user": {"login": "kostola", "name": "Alessandro Costa"}}, "url": "https://github.com/kiegroup/kogito-apps/commit/5b8251f47787096e9489ad1cb85b39e57f0c8d8b", "committedDate": "2020-08-19T10:33:12Z", "message": "[KOGITO-2741] Remove sourceUrl from ExecutionHeaderResponse"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNjQyOTcy", "url": "https://github.com/kiegroup/kogito-apps/pull/345#pullrequestreview-470642972", "createdAt": "2020-08-19T16:35:44Z", "commit": {"oid": "5b8251f47787096e9489ad1cb85b39e57f0c8d8b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4946, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}