{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MTUwNTc0", "number": 574, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNDozMjoxMFrOFILawQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOVQyMTowNTo1OFrOFYmNNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTIwMDAxOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/messaging/incoming/AbstractTraceEventConsumerIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNDozMjoxMFrOIJ9JtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNDozMjoxMFrOIJ9JtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMxMDAwNQ==", "bodyText": "Removed TraceEventTestUtils and used JSONAssert to check that the two (very nested/complex) objects are equals.", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r547310005", "createdAt": "2020-12-22T14:32:10Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/messaging/incoming/AbstractTraceEventConsumerIT.java", "diffHunk": "@@ -65,30 +59,30 @@ public void setup() {\n     }\n \n     @Test\n-    void testCorrectCloudEvent() {\n-        kafkaClient.produce(buildCloudEventJsonString(buildCorrectTraceEvent(CORRECT_CLOUDEVENT_ID)),\n+    void testCorrectCloudEvent() throws JsonProcessingException, JSONException {\n+        kafkaClient.produce(TrustyServiceTestUtils.buildCloudEventJsonString(TrustyServiceTestUtils.buildCorrectTraceEvent(TrustyServiceTestUtils.CORRECT_CLOUDEVENT_ID)),\n                             KafkaConstants.KOGITO_TRACING_TOPIC);\n \n         await()\n                 .atMost(5, SECONDS)\n-                .untilAsserted(() -> assertDoesNotThrow(() -> trustyService.getDecisionById(CORRECT_CLOUDEVENT_ID)));\n+                .untilAsserted(() -> assertDoesNotThrow(() -> trustyService.getDecisionById(TrustyServiceTestUtils.CORRECT_CLOUDEVENT_ID)));\n \n-        Decision storedDecision = trustyService.getDecisionById(CORRECT_CLOUDEVENT_ID);\n+        Decision storedDecision = trustyService.getDecisionById(TrustyServiceTestUtils.CORRECT_CLOUDEVENT_ID);\n         assertNotNull(storedDecision);\n-        TraceEventTestUtils.assertDecision(buildCorrectDecision(CORRECT_CLOUDEVENT_ID), storedDecision);\n+        JSONAssert.assertEquals(MAPPER.writeValueAsString(TrustyServiceTestUtils.buildCorrectDecision(TrustyServiceTestUtils.CORRECT_CLOUDEVENT_ID)), MAPPER.writeValueAsString(storedDecision), true);\n     }\n \n     @Test\n-    void testCloudEventWithErrors() {\n-        kafkaClient.produce(buildCloudEventJsonString(buildTraceEventWithErrors()),\n+    void testCloudEventWithErrors() throws JsonProcessingException, JSONException {\n+        kafkaClient.produce(TrustyServiceTestUtils.buildCloudEventJsonString(TrustyServiceTestUtils.buildTraceEventWithErrors()),\n                             KafkaConstants.KOGITO_TRACING_TOPIC);\n \n         await()\n                 .atMost(5, SECONDS)\n-                .untilAsserted(() -> assertDoesNotThrow(() -> trustyService.getDecisionById(CLOUDEVENT_WITH_ERRORS_ID)));\n+                .untilAsserted(() -> assertDoesNotThrow(() -> trustyService.getDecisionById(TrustyServiceTestUtils.CLOUDEVENT_WITH_ERRORS_ID)));\n \n-        Decision storedDecision = trustyService.getDecisionById(CLOUDEVENT_WITH_ERRORS_ID);\n+        Decision storedDecision = trustyService.getDecisionById(TrustyServiceTestUtils.CLOUDEVENT_WITH_ERRORS_ID);\n         assertNotNull(storedDecision);\n-        TraceEventTestUtils.assertDecision(buildDecisionWithErrors(), storedDecision);\n+        JSONAssert.assertEquals(MAPPER.writeValueAsString(TrustyServiceTestUtils.buildDecisionWithErrors()), MAPPER.writeValueAsString(storedDecision), true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "083d634fde32bb47f24c855d386f0fa43508b741"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTMzMjcwOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/messaging/incoming/TraceEventConverterTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTowODo0MVrOIJ-YuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQxNDoxMDoxNFrOIZoliA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzMDIzMw==", "bodyText": "The current implementation of TraceEventTestUtils was not checking a particular field, with the new assertion method this test is failing. Disabling for the time being", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r547330233", "createdAt": "2020-12-22T15:08:41Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/messaging/incoming/TraceEventConverterTest.java", "diffHunk": "@@ -14,52 +14,62 @@\n  *  limitations under the License.\n  */\n \n-package org.kie.kogito.trusty.service.messaging.incoming;\n+package org.kie.kogito.trusty.service.common.messaging.incoming;\n \n import java.util.Collections;\n import java.util.List;\n import java.util.UUID;\n \n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import io.restassured.internal.path.json.JSONAssertion;\n+import org.json.JSONException;\n+import org.junit.jupiter.api.Disabled;\n import org.junit.jupiter.api.Test;\n import org.kie.dmn.api.core.DMNDecisionResult.DecisionEvaluationStatus;\n import org.kie.kogito.tracing.decision.event.message.Message;\n import org.kie.kogito.tracing.decision.event.message.MessageCategory;\n import org.kie.kogito.tracing.decision.event.message.MessageLevel;\n import org.kie.kogito.tracing.decision.event.trace.TraceEvent;\n import org.kie.kogito.tracing.decision.event.trace.TraceOutputValue;\n+import org.kie.kogito.trusty.service.common.TrustyServiceTestUtils;\n import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.skyscreamer.jsonassert.JSONAssert;\n \n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.CLOUDEVENT_SOURCE;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.CORRECT_CLOUDEVENT_ID;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildCorrectDecision;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildCorrectTraceEvent;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildDecisionWithErrors;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildDecisionWithNullFields;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildTraceEventWithErrors;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildTraceEventWithNullFields;\n \n class TraceEventConverterTest {\n \n-    private static void doTest(TraceEvent traceEvent, Decision expectedDecision) {\n-        Decision actualDecision = TraceEventConverter.toDecision(traceEvent, CLOUDEVENT_SOURCE);\n-        TraceEventTestUtils.assertDecision(expectedDecision, actualDecision);\n+    private static final ObjectMapper MAPPER = new ObjectMapper();\n+\n+    private static void doTest(TraceEvent traceEvent, Decision expectedDecision) throws JsonProcessingException, JSONException {\n+        Decision actualDecision = TraceEventConverter.toDecision(traceEvent, TrustyServiceTestUtils.CLOUDEVENT_SOURCE);\n+        JSONAssert.assertEquals(MAPPER.writeValueAsString(expectedDecision), MAPPER.writeValueAsString(actualDecision), false);\n+    }\n+\n+    private static TraceOutputValue buildTraceOutputValue(DecisionEvaluationStatus status, boolean withErrorMessage) {\n+        String id = UUID.randomUUID().toString();\n+        List<Message> messages = withErrorMessage\n+                ? List.of(new Message(MessageLevel.ERROR, MessageCategory.INTERNAL, \"TEST\", id, \"Error message\", null, null))\n+                : Collections.emptyList();\n+        return new TraceOutputValue(id, \"Output\", status.name(), null, null, messages);\n     }\n \n     @Test\n-    void testCorrectTraceEvent() {\n-        doTest(buildCorrectTraceEvent(CORRECT_CLOUDEVENT_ID), buildCorrectDecision(CORRECT_CLOUDEVENT_ID));\n+    void testCorrectTraceEvent() throws JsonProcessingException, JSONException {\n+        doTest(TrustyServiceTestUtils.buildCorrectTraceEvent(TrustyServiceTestUtils.CORRECT_CLOUDEVENT_ID), TrustyServiceTestUtils.buildCorrectDecision(TrustyServiceTestUtils.CORRECT_CLOUDEVENT_ID));\n     }\n \n     @Test\n-    void testTraceEventWithError() {\n-        doTest(buildTraceEventWithErrors(), buildDecisionWithErrors());\n+    @Disabled(\"This test is broken by design, should be changed.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d6e009aed284dce9345920ea5ccfa8d5a8ff764"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mzc1MDI4MA==", "bodyText": "Please create a ticket and link it in the disabled message", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r563750280", "createdAt": "2021-01-25T14:10:14Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/messaging/incoming/TraceEventConverterTest.java", "diffHunk": "@@ -14,52 +14,62 @@\n  *  limitations under the License.\n  */\n \n-package org.kie.kogito.trusty.service.messaging.incoming;\n+package org.kie.kogito.trusty.service.common.messaging.incoming;\n \n import java.util.Collections;\n import java.util.List;\n import java.util.UUID;\n \n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import io.restassured.internal.path.json.JSONAssertion;\n+import org.json.JSONException;\n+import org.junit.jupiter.api.Disabled;\n import org.junit.jupiter.api.Test;\n import org.kie.dmn.api.core.DMNDecisionResult.DecisionEvaluationStatus;\n import org.kie.kogito.tracing.decision.event.message.Message;\n import org.kie.kogito.tracing.decision.event.message.MessageCategory;\n import org.kie.kogito.tracing.decision.event.message.MessageLevel;\n import org.kie.kogito.tracing.decision.event.trace.TraceEvent;\n import org.kie.kogito.tracing.decision.event.trace.TraceOutputValue;\n+import org.kie.kogito.trusty.service.common.TrustyServiceTestUtils;\n import org.kie.kogito.trusty.storage.api.model.Decision;\n+import org.skyscreamer.jsonassert.JSONAssert;\n \n import static org.junit.jupiter.api.Assertions.assertFalse;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.CLOUDEVENT_SOURCE;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.CORRECT_CLOUDEVENT_ID;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildCorrectDecision;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildCorrectTraceEvent;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildDecisionWithErrors;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildDecisionWithNullFields;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildTraceEventWithErrors;\n-import static org.kie.kogito.trusty.service.TrustyServiceTestUtils.buildTraceEventWithNullFields;\n \n class TraceEventConverterTest {\n \n-    private static void doTest(TraceEvent traceEvent, Decision expectedDecision) {\n-        Decision actualDecision = TraceEventConverter.toDecision(traceEvent, CLOUDEVENT_SOURCE);\n-        TraceEventTestUtils.assertDecision(expectedDecision, actualDecision);\n+    private static final ObjectMapper MAPPER = new ObjectMapper();\n+\n+    private static void doTest(TraceEvent traceEvent, Decision expectedDecision) throws JsonProcessingException, JSONException {\n+        Decision actualDecision = TraceEventConverter.toDecision(traceEvent, TrustyServiceTestUtils.CLOUDEVENT_SOURCE);\n+        JSONAssert.assertEquals(MAPPER.writeValueAsString(expectedDecision), MAPPER.writeValueAsString(actualDecision), false);\n+    }\n+\n+    private static TraceOutputValue buildTraceOutputValue(DecisionEvaluationStatus status, boolean withErrorMessage) {\n+        String id = UUID.randomUUID().toString();\n+        List<Message> messages = withErrorMessage\n+                ? List.of(new Message(MessageLevel.ERROR, MessageCategory.INTERNAL, \"TEST\", id, \"Error message\", null, null))\n+                : Collections.emptyList();\n+        return new TraceOutputValue(id, \"Output\", status.name(), null, null, messages);\n     }\n \n     @Test\n-    void testCorrectTraceEvent() {\n-        doTest(buildCorrectTraceEvent(CORRECT_CLOUDEVENT_ID), buildCorrectDecision(CORRECT_CLOUDEVENT_ID));\n+    void testCorrectTraceEvent() throws JsonProcessingException, JSONException {\n+        doTest(TrustyServiceTestUtils.buildCorrectTraceEvent(TrustyServiceTestUtils.CORRECT_CLOUDEVENT_ID), TrustyServiceTestUtils.buildCorrectDecision(TrustyServiceTestUtils.CORRECT_CLOUDEVENT_ID));\n     }\n \n     @Test\n-    void testTraceEventWithError() {\n-        doTest(buildTraceEventWithErrors(), buildDecisionWithErrors());\n+    @Disabled(\"This test is broken by design, should be changed.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzMDIzMw=="}, "originalCommit": {"oid": "7d6e009aed284dce9345920ea5ccfa8d5a8ff764"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2OTUxMjIxOnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/KeycloakTrustyServiceIT.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMjozOTo0OVrOINwStw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNDoyNDoxM1rOINze7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI5MzYyMw==", "bodyText": "mocking in integration tests seems suspicious. Together with removal of %keycloak.quarkus.oidc props above I am afraid if we're testing the actual integration with keycloak now.", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551293623", "createdAt": "2021-01-04T12:39:49Z", "author": {"login": "jstastny-cz"}, "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/KeycloakTrustyServiceIT.java", "diffHunk": "@@ -25,26 +32,30 @@\n     @ConfigProperty(name = KeycloakQuarkusTestResource.KOGITO_KEYCLOAK_PROPERTY)\n     String keycloakURL;\n \n+    @InjectMock\n+    TrustyService trustyService;\n+\n     @Test\n     void shouldReturnUnauthorized() {\n         given().get(TRUSTY_ENDPOINT)\n-               .then().statusCode(HttpStatus.SC_UNAUTHORIZED);\n+                .then().statusCode(HttpStatus.SC_UNAUTHORIZED);\n     }\n \n     @Test\n     void shouldReturnOkWhenValidUser() {\n+        when(trustyService.getExecutionHeaders(any(OffsetDateTime.class), any(OffsetDateTime.class), anyInt(), anyInt(), anyString())).thenReturn(new MatchedExecutionHeaders(new ArrayList<>(), 0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI5NTgxMQ==", "bodyText": "ah, didn't notice the rename to microprofile-config.properties while below there's application.properties with retained keycloak config. So just this mocking line is interesting.", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551295811", "createdAt": "2021-01-04T12:44:24Z", "author": {"login": "jstastny-cz"}, "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/KeycloakTrustyServiceIT.java", "diffHunk": "@@ -25,26 +32,30 @@\n     @ConfigProperty(name = KeycloakQuarkusTestResource.KOGITO_KEYCLOAK_PROPERTY)\n     String keycloakURL;\n \n+    @InjectMock\n+    TrustyService trustyService;\n+\n     @Test\n     void shouldReturnUnauthorized() {\n         given().get(TRUSTY_ENDPOINT)\n-               .then().statusCode(HttpStatus.SC_UNAUTHORIZED);\n+                .then().statusCode(HttpStatus.SC_UNAUTHORIZED);\n     }\n \n     @Test\n     void shouldReturnOkWhenValidUser() {\n+        when(trustyService.getExecutionHeaders(any(OffsetDateTime.class), any(OffsetDateTime.class), anyInt(), anyInt(), anyString())).thenReturn(new MatchedExecutionHeaders(new ArrayList<>(), 0));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI5MzYyMw=="}, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMyNzgxOA==", "bodyText": "Hi @jstastny-cz , this is needed since I created a new trusty-service-common module, and then trusty-service-infinispan/ trusty-service-redis modules that will provide the selected persistence layer.\nSince QuarkusTest will look for a StorageService bean, I created a new basic mock for that, but it's not enough for  trustyService.getExecutionHeaders since it requires some more complex mocking. That's why I mocked the call directly to return an empty list. The test is about the integration between the trusty application and keyclock. Being a common module, the persistence layer has to be mocked.  From my perspective, this is fair..\nThe alternative would be to make this test abstract and execute it for the infinispan and redis module, but these two modules are not adding any logic to the integration between the application and keycloak, it would be just the same test executed twice.", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551327818", "createdAt": "2021-01-04T13:51:07Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/KeycloakTrustyServiceIT.java", "diffHunk": "@@ -25,26 +32,30 @@\n     @ConfigProperty(name = KeycloakQuarkusTestResource.KOGITO_KEYCLOAK_PROPERTY)\n     String keycloakURL;\n \n+    @InjectMock\n+    TrustyService trustyService;\n+\n     @Test\n     void shouldReturnUnauthorized() {\n         given().get(TRUSTY_ENDPOINT)\n-               .then().statusCode(HttpStatus.SC_UNAUTHORIZED);\n+                .then().statusCode(HttpStatus.SC_UNAUTHORIZED);\n     }\n \n     @Test\n     void shouldReturnOkWhenValidUser() {\n+        when(trustyService.getExecutionHeaders(any(OffsetDateTime.class), any(OffsetDateTime.class), anyInt(), anyInt(), anyString())).thenReturn(new MatchedExecutionHeaders(new ArrayList<>(), 0));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI5MzYyMw=="}, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTM0NTkwMQ==", "bodyText": "I was not sure what behavior is actually being mocked. If it's unrelated to keycloak integration, it should be fine. Thanks.", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551345901", "createdAt": "2021-01-04T14:24:13Z", "author": {"login": "jstastny-cz"}, "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/KeycloakTrustyServiceIT.java", "diffHunk": "@@ -25,26 +32,30 @@\n     @ConfigProperty(name = KeycloakQuarkusTestResource.KOGITO_KEYCLOAK_PROPERTY)\n     String keycloakURL;\n \n+    @InjectMock\n+    TrustyService trustyService;\n+\n     @Test\n     void shouldReturnUnauthorized() {\n         given().get(TRUSTY_ENDPOINT)\n-               .then().statusCode(HttpStatus.SC_UNAUTHORIZED);\n+                .then().statusCode(HttpStatus.SC_UNAUTHORIZED);\n     }\n \n     @Test\n     void shouldReturnOkWhenValidUser() {\n+        when(trustyService.getExecutionHeaders(any(OffsetDateTime.class), any(OffsetDateTime.class), anyInt(), anyInt(), anyString())).thenReturn(new MatchedExecutionHeaders(new ArrayList<>(), 0));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI5MzYyMw=="}, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2OTU2OTA2OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/trusty-service-infinispan/src/test/resources/application.properties", "isResolved": false, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMjo1ODoyMFrOINw0KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQwOToyNDozOVrOIOP2Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMwMjE4NQ==", "bodyText": "what happens by this change?", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551302185", "createdAt": "2021-01-04T12:58:20Z", "author": {"login": "jstastny-cz"}, "path": "trusty/trusty-service/trusty-service-infinispan/src/test/resources/application.properties", "diffHunk": "@@ -3,9 +3,7 @@ quarkus.http.cors=true\n #oidc\n quarkus.oidc.enabled=true\n quarkus.oidc.tenant-enabled=false\n-%keycloak.quarkus.oidc.tenant-enabled=true\n-%keycloak.quarkus.oidc.client-id=kogito-app\n-%keycloak.quarkus.oidc.credentials.secret=secret\n+quarkus.oidc.auth-server-url=none", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMzNDc3Nw==", "bodyText": "The test project needs the quarkus.oidc.auth-server-url to be set, otherwise it fails with\nCaused by: javax.enterprise.inject.spi.DeploymentException: No config value of type [java.lang.String] exists for: quarkus.oidc.auth-server-url\n\nThe deletions are just an artifact of the renaming of the files, since the infinispan tests are not using keycloak I set the property to none. wdyt about that?", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551334777", "createdAt": "2021-01-04T14:04:27Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/trusty-service-infinispan/src/test/resources/application.properties", "diffHunk": "@@ -3,9 +3,7 @@ quarkus.http.cors=true\n #oidc\n quarkus.oidc.enabled=true\n quarkus.oidc.tenant-enabled=false\n-%keycloak.quarkus.oidc.tenant-enabled=true\n-%keycloak.quarkus.oidc.client-id=kogito-app\n-%keycloak.quarkus.oidc.credentials.secret=secret\n+quarkus.oidc.auth-server-url=none", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMwMjE4NQ=="}, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTM1MDkyOA==", "bodyText": "Could we actually disable the oidc extension by setting quarkus.oidc.enabled=false ? I think (and you indicated it above) there are no tests actually testing the integration with keycloak.", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551350928", "createdAt": "2021-01-04T14:32:40Z", "author": {"login": "jstastny-cz"}, "path": "trusty/trusty-service/trusty-service-infinispan/src/test/resources/application.properties", "diffHunk": "@@ -3,9 +3,7 @@ quarkus.http.cors=true\n #oidc\n quarkus.oidc.enabled=true\n quarkus.oidc.tenant-enabled=false\n-%keycloak.quarkus.oidc.tenant-enabled=true\n-%keycloak.quarkus.oidc.client-id=kogito-app\n-%keycloak.quarkus.oidc.credentials.secret=secret\n+quarkus.oidc.auth-server-url=none", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMwMjE4NQ=="}, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQzMjMyNw==", "bodyText": "Hi @jstastny-cz , I've refactored the keycloak configuration (now it's the same of the data-index).\nThe only difference is that in the submodules redis and infinispan (where we don't have any keycloak specific tests) we still have to specify a quarkus.oidc.auth-server-url=none even if quarkus.oidc.enabled=false.\nSince we have a dependency to the common test package, the KeycloakTrustyServiceIT is annotated with QuarkusTestResource and it requires that property.", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551432327", "createdAt": "2021-01-04T16:42:33Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/trusty-service-infinispan/src/test/resources/application.properties", "diffHunk": "@@ -3,9 +3,7 @@ quarkus.http.cors=true\n #oidc\n quarkus.oidc.enabled=true\n quarkus.oidc.tenant-enabled=false\n-%keycloak.quarkus.oidc.tenant-enabled=true\n-%keycloak.quarkus.oidc.client-id=kogito-app\n-%keycloak.quarkus.oidc.credentials.secret=secret\n+quarkus.oidc.auth-server-url=none", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMwMjE4NQ=="}, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTc4ODgzMA==", "bodyText": "Ah, just wondering if conditional test resource could help here - first in common, the keycloak test would be annotated with @QuarkusTestResource(value=KeycloakQuarkusTestResource.Conditional.class) requiring the following system property to be set for the test resource to start enable.resource.keycloak=true ... if the property is not set, the container would not start at all.\nSo the solution might be (haven't checked) set in common the keycloak test resource as conditional, invoke Keycloak related tests in a separate failsafe execution (setting the property and filtering using exclude, include). Then in infinispan and redis modules, when not setting this prop, it could resolve the issue. WDYT?", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551788830", "createdAt": "2021-01-05T08:42:13Z", "author": {"login": "jstastny-cz"}, "path": "trusty/trusty-service/trusty-service-infinispan/src/test/resources/application.properties", "diffHunk": "@@ -3,9 +3,7 @@ quarkus.http.cors=true\n #oidc\n quarkus.oidc.enabled=true\n quarkus.oidc.tenant-enabled=false\n-%keycloak.quarkus.oidc.tenant-enabled=true\n-%keycloak.quarkus.oidc.client-id=kogito-app\n-%keycloak.quarkus.oidc.credentials.secret=secret\n+quarkus.oidc.auth-server-url=none", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMwMjE4NQ=="}, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTc5MDQ1Mg==", "bodyText": "IMO it's actually the config property in test\nclass KeycloakTrustyServiceIT {\n\n    private static final String VALID_USER = \"jdoe\";\n    private static final String TRUSTY_ENDPOINT = \"/executions\";\n\n    @ConfigProperty(name = KeycloakQuarkusTestResource.KOGITO_KEYCLOAK_PROPERTY)\n    String keycloakURL;\n\nenforcing the existence of that prop.\nEDITED: so the conditional resource won't help IMO. I don't completely understand how test-jar works, but it seems that it bundles all tests from common module and runs it as part of redis/infinispan module build? If that's so, we're running the Keycloak IT test too? Meaning in redis/infinispan we actually run the Keycloak test even if we don't want to?\nSolution could be to replicate the config from common also in redis and infinispan (since we would inherit all the test from there).", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551790452", "createdAt": "2021-01-05T08:45:28Z", "author": {"login": "jstastny-cz"}, "path": "trusty/trusty-service/trusty-service-infinispan/src/test/resources/application.properties", "diffHunk": "@@ -3,9 +3,7 @@ quarkus.http.cors=true\n #oidc\n quarkus.oidc.enabled=true\n quarkus.oidc.tenant-enabled=false\n-%keycloak.quarkus.oidc.tenant-enabled=true\n-%keycloak.quarkus.oidc.client-id=kogito-app\n-%keycloak.quarkus.oidc.credentials.secret=secret\n+quarkus.oidc.auth-server-url=none", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMwMjE4NQ=="}, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgxMDQxMg==", "bodyText": "Hi @jstastny-cz , the KeycloakTrustyServiceIT is not run for the infinispan and redis modules. I think that when the infinispan and redis test suite is run quarkus fetches the quarkus test resource KeycloakQuarkusTestResource and tries to inject the required property. In short.. KeycloakTrustyServiceIT is annotated with QuarkusTestResource and by consequence quarkus tries to resolve its dependency even if it is not run for that module. wdyt?", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551810412", "createdAt": "2021-01-05T09:24:15Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/trusty-service-infinispan/src/test/resources/application.properties", "diffHunk": "@@ -3,9 +3,7 @@ quarkus.http.cors=true\n #oidc\n quarkus.oidc.enabled=true\n quarkus.oidc.tenant-enabled=false\n-%keycloak.quarkus.oidc.tenant-enabled=true\n-%keycloak.quarkus.oidc.client-id=kogito-app\n-%keycloak.quarkus.oidc.credentials.secret=secret\n+quarkus.oidc.auth-server-url=none", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMwMjE4NQ=="}, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTgxMDYwMw==", "bodyText": "btw the Conditional test resource doesn't help in this case as you pointed out", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r551810603", "createdAt": "2021-01-05T09:24:39Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/trusty-service-infinispan/src/test/resources/application.properties", "diffHunk": "@@ -3,9 +3,7 @@ quarkus.http.cors=true\n #oidc\n quarkus.oidc.enabled=true\n quarkus.oidc.tenant-enabled=false\n-%keycloak.quarkus.oidc.tenant-enabled=true\n-%keycloak.quarkus.oidc.client-id=kogito-app\n-%keycloak.quarkus.oidc.credentials.secret=secret\n+quarkus.oidc.auth-server-url=none", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMwMjE4NQ=="}, "originalCommit": {"oid": "2077a2fdbe592707faf1e56e7ba9f1aaab85e3db"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUwMDM0MTI2OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/CacheManagerServiceMock.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxODo0NToxM1rOISPRyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQwOTozMToxOVrOIcb_Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTk5NTU5NA==", "bodyText": "Do we expect method of this interface to return null?\nIf not please make all of them return mock(...)", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r555995594", "createdAt": "2021-01-12T18:45:13Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/CacheManagerServiceMock.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.trusty.service.common;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+\n+import io.quarkus.test.Mock;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.StorageService;\n+import org.kie.kogito.persistence.api.factory.StorageQualifier;\n+\n+@Mock\n+@ApplicationScoped\n+@StorageQualifier(\"mock\")\n+public class CacheManagerServiceMock implements StorageService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjY4OTU3NA==", "bodyText": "We need this mock just to make Quarkus test suite happy with a StorageService bean to be injected in the application when the KeycloakTrustyServiceIT starts. This is why this class is not doing anything. Added the mock anyway.", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r566689574", "createdAt": "2021-01-29T09:31:19Z", "author": {"login": "r00ta"}, "path": "trusty/trusty-service/trusty-service-common/src/test/java/org/kie/kogito/trusty/service/common/CacheManagerServiceMock.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.trusty.service.common;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+\n+import io.quarkus.test.Mock;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.StorageService;\n+import org.kie.kogito.persistence.api.factory.StorageQualifier;\n+\n+@Mock\n+@ApplicationScoped\n+@StorageQualifier(\"mock\")\n+public class CacheManagerServiceMock implements StorageService {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTk5NTU5NA=="}, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMjYxNDA2OnYy", "diffSide": "RIGHT", "path": "persistence-commons/persistence-commons-redis/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwNjo1NTo0OFrOIUEkqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQwOToyOToyNlrOIcb6ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzkxNzM1NQ==", "bodyText": "Use dependencManagement", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r557917355", "createdAt": "2021-01-15T06:55:48Z", "author": {"login": "danielezonca"}, "path": "persistence-commons/persistence-commons-redis/pom.xml", "diffHunk": "@@ -0,0 +1,46 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>persistence-commons</artifactId>\n+    <groupId>org.kie.kogito</groupId>\n+    <version>2.0.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>persistence-commons-redis</artifactId>\n+  <name>Kogito :: Persistence Commons Redis</name>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.kie.kogito</groupId>\n+      <artifactId>persistence-commons-api</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.redislabs</groupId>\n+      <artifactId>jredisearch</artifactId>\n+      <version>2.0.0</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjY4ODQ1MQ==", "bodyText": "Moved to kogito-apps pom \ud83d\udc4d", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r566688451", "createdAt": "2021-01-29T09:29:26Z", "author": {"login": "r00ta"}, "path": "persistence-commons/persistence-commons-redis/pom.xml", "diffHunk": "@@ -0,0 +1,46 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <parent>\n+    <artifactId>persistence-commons</artifactId>\n+    <groupId>org.kie.kogito</groupId>\n+    <version>2.0.0-SNAPSHOT</version>\n+  </parent>\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <artifactId>persistence-commons-redis</artifactId>\n+  <name>Kogito :: Persistence Commons Redis</name>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.kie.kogito</groupId>\n+      <artifactId>persistence-commons-api</artifactId>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.redislabs</groupId>\n+      <artifactId>jredisearch</artifactId>\n+      <version>2.0.0</version>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzkxNzM1NQ=="}, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMzIyMzc0OnYy", "diffSide": "RIGHT", "path": "persistence-commons/persistence-commons-redis/src/main/java/org/kie/kogito/persistence/redis/RedisStorage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwODoyMzo0N1rOIULAbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQxMzo0NDoyMVrOIZnhCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODAyMjc2NQ==", "bodyText": "Are you sure Redis doesn't support a similar listener? Btw you can manually implement them with 3 Collection of Consumer manually invoked inside put / remove. Wdyt?", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r558022765", "createdAt": "2021-01-15T08:23:47Z", "author": {"login": "danielezonca"}, "path": "persistence-commons/persistence-commons-redis/src/main/java/org/kie/kogito/persistence/redis/RedisStorage.java", "diffHunk": "@@ -0,0 +1,137 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.persistence.redis;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Consumer;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import io.redisearch.Client;\n+import io.redisearch.Document;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.Query;\n+import org.kie.kogito.persistence.redis.index.RedisIndexManager;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.kie.kogito.persistence.redis.Constants.INDEX_NAME_FIELD;\n+import static org.kie.kogito.persistence.redis.Constants.RAW_OBJECT_FIELD;\n+\n+public class RedisStorage<V> implements Storage<String, V> {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(RedisStorage.class);\n+\n+    private final Client redisClient;\n+    private final RedisIndexManager redisIndexManager;\n+    private final String indexName;\n+    private final Class<V> type;\n+\n+    public RedisStorage(Client redisClient, RedisIndexManager redisIndexManager, String indexName, Class<V> type) {\n+        this.redisClient = redisClient;\n+        this.redisIndexManager = redisIndexManager;\n+        this.indexName = indexName;\n+        this.type = type;\n+    }\n+\n+    @Override\n+    public void addObjectCreatedListener(Consumer<V> consumer) {\n+        throw new UnsupportedOperationException(\"addObjectCreatedListener operation not supported for Redis.\");\n+    }\n+\n+    @Override\n+    public void addObjectUpdatedListener(Consumer<V> consumer) {\n+        throw new UnsupportedOperationException(\"addObjectUpdatedListener operation not supported for Redis.\");\n+    }\n+\n+    @Override\n+    public void addObjectRemovedListener(Consumer<String> consumer) {\n+        throw new UnsupportedOperationException(\"addObjectRemovedListener operation not supported for Redis.\");\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzczMjc0NA==", "bodyText": "Hi @danielezonca , I did not investigate much on these three operations. I had a quick look now and yes, this seems to be  be possible. We need to address this in another ticket in case we want to invest on such operations for some apps that need them https://issues.redhat.com/browse/KOGITO-4258", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r563732744", "createdAt": "2021-01-25T13:44:21Z", "author": {"login": "r00ta"}, "path": "persistence-commons/persistence-commons-redis/src/main/java/org/kie/kogito/persistence/redis/RedisStorage.java", "diffHunk": "@@ -0,0 +1,137 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.persistence.redis;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Consumer;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import io.redisearch.Client;\n+import io.redisearch.Document;\n+import org.kie.kogito.persistence.api.Storage;\n+import org.kie.kogito.persistence.api.query.Query;\n+import org.kie.kogito.persistence.redis.index.RedisIndexManager;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.kie.kogito.persistence.redis.Constants.INDEX_NAME_FIELD;\n+import static org.kie.kogito.persistence.redis.Constants.RAW_OBJECT_FIELD;\n+\n+public class RedisStorage<V> implements Storage<String, V> {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(RedisStorage.class);\n+\n+    private final Client redisClient;\n+    private final RedisIndexManager redisIndexManager;\n+    private final String indexName;\n+    private final Class<V> type;\n+\n+    public RedisStorage(Client redisClient, RedisIndexManager redisIndexManager, String indexName, Class<V> type) {\n+        this.redisClient = redisClient;\n+        this.redisIndexManager = redisIndexManager;\n+        this.indexName = indexName;\n+        this.type = type;\n+    }\n+\n+    @Override\n+    public void addObjectCreatedListener(Consumer<V> consumer) {\n+        throw new UnsupportedOperationException(\"addObjectCreatedListener operation not supported for Redis.\");\n+    }\n+\n+    @Override\n+    public void addObjectUpdatedListener(Consumer<V> consumer) {\n+        throw new UnsupportedOperationException(\"addObjectUpdatedListener operation not supported for Redis.\");\n+    }\n+\n+    @Override\n+    public void addObjectRemovedListener(Consumer<String> consumer) {\n+        throw new UnsupportedOperationException(\"addObjectRemovedListener operation not supported for Redis.\");\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODAyMjc2NQ=="}, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMzU0MjcyOnYy", "diffSide": "RIGHT", "path": "pom.xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwODo1OTozM1rOIUOVJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQwODo0NTozMVrOIYapWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA3NzIyMw==", "bodyText": "@cristianonicolai\nIs the internal docker image proxy automatic or should we manually configure all the proxed images?", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r558077223", "createdAt": "2021-01-15T08:59:33Z", "author": {"login": "danielezonca"}, "path": "pom.xml", "diffHunk": "@@ -26,10 +26,11 @@\n \n     <!-- external containers used for testing -->\n     <container.image.infinispan>quay.io/infinispan/server:${version.org.infinispan}</container.image.infinispan>\n+    <container.image.redis>redislabs/redisearch:${version.org.redis}</container.image.redis>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQ2OTA5Mw==", "bodyText": "I think the docker hub proxy works like the following:\n\nan image is requested\nIf the image is in the local registry, send it back. If not, fetch it from docker-hub, store it and then return it\n\nNo need to do anything manual afaik", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r562469093", "createdAt": "2021-01-22T08:38:03Z", "author": {"login": "r00ta"}, "path": "pom.xml", "diffHunk": "@@ -26,10 +26,11 @@\n \n     <!-- external containers used for testing -->\n     <container.image.infinispan>quay.io/infinispan/server:${version.org.infinispan}</container.image.infinispan>\n+    <container.image.redis>redislabs/redisearch:${version.org.redis}</container.image.redis>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA3NzIyMw=="}, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MjQ3MzMwNA==", "bodyText": "yep, it should just pull and cache for further requests", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r562473304", "createdAt": "2021-01-22T08:45:31Z", "author": {"login": "cristianonicolai"}, "path": "pom.xml", "diffHunk": "@@ -26,10 +26,11 @@\n \n     <!-- external containers used for testing -->\n     <container.image.infinispan>quay.io/infinispan/server:${version.org.infinispan}</container.image.infinispan>\n+    <container.image.redis>redislabs/redisearch:${version.org.redis}</container.image.redis>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA3NzIyMw=="}, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxNDQ2Nzg1OnYy", "diffSide": "RIGHT", "path": "persistence-commons/persistence-commons-redis/src/main/java/org/kie/kogito/persistence/redis/index/RedisIndexManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQxMTowNTozOVrOIUX_Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQxMzoyOToxOVrOIZm50w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzNTQ4Mg==", "bodyText": "Is this used? I don't fine any usage (same for firing ReditCreateIndexEvent event)", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r558235482", "createdAt": "2021-01-15T11:05:39Z", "author": {"login": "danielezonca"}, "path": "persistence-commons/persistence-commons-redis/src/main/java/org/kie/kogito/persistence/redis/index/RedisIndexManager.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.persistence.redis.index;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+\n+import io.redisearch.Client;\n+import io.redisearch.Schema;\n+import org.kie.kogito.persistence.redis.RedisClientManager;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import redis.clients.jedis.exceptions.JedisDataException;\n+\n+import static org.kie.kogito.persistence.redis.Constants.INDEX_NAME_FIELD;\n+\n+@ApplicationScoped\n+public class RedisIndexManager {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(RedisIndexManager.class);\n+\n+    private final RedisClientManager redisClientManager;\n+    private Map<String, List<String>> indexes = new HashMap<>();\n+\n+    @Inject\n+    public RedisIndexManager(RedisClientManager redisClientManager) {\n+        this.redisClientManager = redisClientManager;\n+    }\n+\n+    public void createIndex(RedisCreateIndexEvent event) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzcyMjcwNw==", "bodyText": "Hi @danielezonca , yes this is the bean that the consumers should use to create an index when the application starts up. For example, in trusty we use it in trusty-storage-redis https://github.com/kiegroup/kogito-apps/blob/6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06/trusty/trusty-storage/trusty-storage-redis/src/main/java/org/kie/kogito/trusty/storage/redis/IndexProvider.java", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r563722707", "createdAt": "2021-01-25T13:29:19Z", "author": {"login": "r00ta"}, "path": "persistence-commons/persistence-commons-redis/src/main/java/org/kie/kogito/persistence/redis/index/RedisIndexManager.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.persistence.redis.index;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Inject;\n+\n+import io.redisearch.Client;\n+import io.redisearch.Schema;\n+import org.kie.kogito.persistence.redis.RedisClientManager;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import redis.clients.jedis.exceptions.JedisDataException;\n+\n+import static org.kie.kogito.persistence.redis.Constants.INDEX_NAME_FIELD;\n+\n+@ApplicationScoped\n+public class RedisIndexManager {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(RedisIndexManager.class);\n+\n+    private final RedisClientManager redisClientManager;\n+    private Map<String, List<String>> indexes = new HashMap<>();\n+\n+    @Inject\n+    public RedisIndexManager(RedisClientManager redisClientManager) {\n+        this.redisClientManager = redisClientManager;\n+    }\n+\n+    public void createIndex(RedisCreateIndexEvent event) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIzNTQ4Mg=="}, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUzMTEyODkyOnYy", "diffSide": "RIGHT", "path": "persistence-commons/persistence-commons-redis/src/main/java/org/kie/kogito/persistence/redis/RedisQuery.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQwODoyMDo0M1rOIWx50Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQwODoyMDo0M1rOIWx50Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDc1NzIwMQ==", "bodyText": "Can you please add a README.md file in the root of this module to list the features that are not supported yet?", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r560757201", "createdAt": "2021-01-20T08:20:43Z", "author": {"login": "danielezonca"}, "path": "persistence-commons/persistence-commons-redis/src/main/java/org/kie/kogito/persistence/redis/RedisQuery.java", "diffHunk": "@@ -0,0 +1,118 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.kogito.persistence.redis;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import io.redisearch.Client;\n+import io.redisearch.SearchResult;\n+import org.kie.kogito.persistence.api.query.AttributeFilter;\n+import org.kie.kogito.persistence.api.query.AttributeSort;\n+import org.kie.kogito.persistence.api.query.Query;\n+import org.kie.kogito.persistence.api.query.SortDirection;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.kie.kogito.persistence.redis.Constants.RAW_OBJECT_FIELD;\n+\n+public class RedisQuery<V> implements Query<V> {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(RedisQuery.class);\n+\n+    Integer limit;\n+    Integer offset;\n+    List<AttributeFilter<?>> filters;\n+    AttributeSort sortBy;\n+    String indexName;\n+\n+    private Class<V> type;\n+\n+    private Client redisClient;\n+\n+    public RedisQuery(Client redisClient, String indexName, Class<V> type) {\n+        this.redisClient = redisClient;\n+        this.indexName = indexName;\n+        this.type = type;\n+    }\n+\n+    @Override\n+    public Query<V> limit(Integer limit) {\n+        this.limit = limit;\n+        return this;\n+    }\n+\n+    @Override\n+    public Query<V> offset(Integer offset) {\n+        this.offset = offset;\n+        return this;\n+    }\n+\n+    @Override\n+    public Query<V> filter(List<AttributeFilter<?>> filters) {\n+        this.filters = filters;\n+        return this;\n+    }\n+\n+    @Override\n+    public Query<V> sort(List<AttributeSort> sortBy) {\n+        if (!sortBy.isEmpty()) {\n+            if (sortBy.size() > 1) { // TODO: implement backend side sorting on multiple attributes https://issues.redhat.com/browse/KOGITO-4072\n+                throw new UnsupportedOperationException(\"Multiple sorting attributes not implemented yet.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cc510181b1c4bb0d6fe1befd30ac9d937aa3d06"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU2OTc4MTc2OnYy", "diffSide": "RIGHT", "path": "trusty/trusty-storage/trusty-storage-api/src/main/java/org/kie/kogito/trusty/storage/api/TrustyStorageServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQxMDowNDoyMFrOIcdMNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQxMDowNDoyMFrOIcdMNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjcwOTMwMA==", "bodyText": "Why don't move these constants to TrustyStorageService so that IndexProvider can avoid to depends on this Impl class? (or another class of constants)", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r566709300", "createdAt": "2021-01-29T10:04:20Z", "author": {"login": "danielezonca"}, "path": "trusty/trusty-storage/trusty-storage-api/src/main/java/org/kie/kogito/trusty/storage/api/TrustyStorageServiceImpl.java", "diffHunk": "@@ -27,9 +27,9 @@\n @ApplicationScoped\n public class TrustyStorageServiceImpl implements TrustyStorageService {\n \n-    private static final String DECISIONS_STORAGE = \"decisions\";\n-    private static final String EXPLAINABILITY_RESULTS_STORAGE = \"explainability-results\";\n-    private static final String MODELS_STORAGE = \"models\";\n+    public static final String DECISIONS_STORAGE = \"decisions\";\n+    public static final String EXPLAINABILITY_RESULTS_STORAGE = \"explainability-results\";\n+    public static final String MODELS_STORAGE = \"models\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7be82e3e28e55b5fbcbd23dce75b266ca53255da"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzYxMzM2MTE2OnYy", "diffSide": "RIGHT", "path": "jitexecutor/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOVQyMTowNTo1OFrOIirxLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOVQyMTowNTo1OFrOIirxLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzIzOTU5OQ==", "bodyText": "To be removed?", "url": "https://github.com/kiegroup/kogito-apps/pull/574#discussion_r573239599", "createdAt": "2021-02-09T21:05:58Z", "author": {"login": "danielezonca"}, "path": "jitexecutor/README.md", "diffHunk": "@@ -60,7 +60,7 @@ If you are interested in the full DMN result, you can use the endpoint `/jitdmn/\n   ]\n }\n ```\n-\n+.git.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b7ec473a3611815f06fbba524aae03b60883d62"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1127, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}