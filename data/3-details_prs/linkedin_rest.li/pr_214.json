{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDgwMzYw", "number": 214, "title": "Fix Classpath resource schema resolver to handle pdl resources.", "bodyText": "", "createdAt": "2020-03-07T00:57:14Z", "url": "https://github.com/linkedin/rest.li/pull/214", "merged": true, "mergeCommit": {"oid": "4800194bb28c15b074f86cb37f4b59521c94937d"}, "closed": true, "closedAt": "2020-03-07T15:33:06Z", "author": {"login": "karthikbalasub"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLJ9MVAH2gAyMzg1MDgwMzYwOmNiZDMzMWE0MDJlMGUzYWU2YzZlMzVlMTExZDA2OTNmNDgxMmE1N2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLWc5-AH2gAyMzg1MDgwMzYwOmRhMWJkNDc0MDhkMWMwOGU0YTMwZGJiMjJiOTA1NDAwM2EzYWZjZDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cbd331a402e0e3ae6c6e35e111d0693f4812a57e", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/cbd331a402e0e3ae6c6e35e111d0693f4812a57e", "committedDate": "2020-03-07T00:55:14Z", "message": "Fix ClassPath resource schema resolver to handle pdl resources."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzA2OTg4", "url": "https://github.com/linkedin/rest.li/pull/214#pullrequestreview-370706988", "createdAt": "2020-03-07T01:09:28Z", "commit": {"oid": "cbd331a402e0e3ae6c6e35e111d0693f4812a57e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMTowOToyOFrOFzLjTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMToxNToyNVrOFzLmaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxMDk1OA==", "bodyText": "I suggest you move this field and its corresponding setter near the top of the inner class. It would be easier to read.", "url": "https://github.com/linkedin/rest.li/pull/214#discussion_r389210958", "createdAt": "2020-03-07T01:09:28Z", "author": {"login": "evanw555"}, "path": "data/src/main/java/com/linkedin/data/schema/resolver/ClasspathResourceDataSchemaResolver.java", "diffHunk": "@@ -33,61 +34,106 @@\n  *\n  * @author Min Chen\n  */\n-public class ClasspathResourceDataSchemaResolver extends DefaultDataSchemaResolver\n+public class ClasspathResourceDataSchemaResolver extends AbstractMultiFormatDataSchemaResolver\n {\n   /**\n    * The default file name extension is \".pdsc\".\n+   * @deprecated Do not use.\n    */\n+  @Deprecated\n   public static final String DEFAULT_EXTENSION = SchemaParser.FILE_EXTENSION;\n \n+  private final ClassLoader _classLoader;\n+\n+\n   /**\n    * Construct a new instance that uses the {@link Thread#getContextClassLoader()} for the current thread.\n    */\n+  public ClasspathResourceDataSchemaResolver()\n+  {\n+    this(null, Thread.currentThread().getContextClassLoader());\n+  }\n+\n+  /**\n+   * Construct a new instance that uses the {@link Thread#getContextClassLoader()} for the current thread.\n+   *\n+   * @deprecated The parserFactory is not needed as this class now uses builtin parsers. Use\n+   * {@link #ClasspathResourceDataSchemaResolver()} instead\n+   */\n+  @Deprecated\n   public ClasspathResourceDataSchemaResolver(SchemaParserFactory parserFactory)\n   {\n-    super(parserFactory);\n-    _classLoader = Thread.currentThread().getContextClassLoader();\n+    this(Thread.currentThread().getContextClassLoader());\n   }\n \n   /**\n    * Construct a new instance that uses the specified {@link ClassLoader}.\n    *\n    * @param classLoader provides the {@link ClassLoader}.\n    */\n-  public ClasspathResourceDataSchemaResolver(SchemaParserFactory parserFactory, ClassLoader classLoader)\n+  public ClasspathResourceDataSchemaResolver(ClassLoader classLoader)\n   {\n-    super(parserFactory);\n+    for (DataSchemaParserFactory parserForFormat: BUILTIN_FORMAT_PARSER_FACTORIES)\n+    {\n+      SingleFormatClasspathSchemaResolver resolver = new SingleFormatClasspathSchemaResolver(parserForFormat);\n+      resolver.setExtension(\".\" + parserForFormat.getLanguageExtension());\n+      addResolver(resolver);\n+    }\n     _classLoader = classLoader;\n   }\n-\n-  private String getDataSchemaResourcePath(String schemaName)\n+  /**\n+   * Construct a new instance that uses the specified {@link ClassLoader}.\n+   *\n+   * @deprecated The parserFactory is not needed as this class now uses builtin parsers. Use\n+   * {@link #ClasspathResourceDataSchemaResolver(ClassLoader)} instead\n+   * @param classLoader provides the {@link ClassLoader}.\n+   */\n+  @Deprecated\n+  public ClasspathResourceDataSchemaResolver(SchemaParserFactory parserFactory, ClassLoader classLoader)\n   {\n-    return InternalConstants.PEGASUS_DIR_IN_JAR + \"/\" + schemaName.replace('.', '/') + DEFAULT_EXTENSION;\n+    this(classLoader);\n   }\n \n-  @Override\n-  protected NamedDataSchema locateDataSchema(String schemaName, StringBuilder errorMessageBuilder)\n+  private class SingleFormatClasspathSchemaResolver extends DefaultDataSchemaResolver\n   {\n-    NamedDataSchema schema = null;\n-    final String schemaResourcePath = getDataSchemaResourcePath(schemaName);\n-    try (InputStream stream = _classLoader.getResourceAsStream(schemaResourcePath))\n+    /**\n+     * Construct a new instance that uses the {@link Thread#getContextClassLoader()} for the current thread.\n+     */\n+    public SingleFormatClasspathSchemaResolver(DataSchemaParserFactory parserFactory)\n+    {\n+      super(parserFactory);\n+    }\n+\n+    private String getDataSchemaResourcePath(String schemaName)\n     {\n-      if (stream == null)\n+      return InternalConstants.PEGASUS_DIR_IN_JAR + \"/\" + schemaName.replace('.', '/') + _extension;\n+    }\n+\n+    @Override\n+    protected NamedDataSchema locateDataSchema(String schemaName, StringBuilder errorMessageBuilder)\n+    {\n+      NamedDataSchema schema = null;\n+      final String schemaResourcePath = getDataSchemaResourcePath(schemaName);\n+      try (InputStream stream = _classLoader.getResourceAsStream(schemaResourcePath))\n       {\n-        errorMessageBuilder.append(String.format(\"Unable to find data schema file \\\"%s\\\" in classpath.\", schemaResourcePath));\n+        if (stream != null)\n+        {\n+          DataSchemaLocation location = new FileDataSchemaLocation(new File(schemaResourcePath));\n+          schema = parse(stream, location, schemaName, errorMessageBuilder);\n+        }\n       }\n-      else\n+      catch (IOException e)\n       {\n-        DataSchemaLocation location = new FileDataSchemaLocation(new File(schemaResourcePath));\n-        schema = parse(stream, location, schemaName, errorMessageBuilder);\n+        errorMessageBuilder.append(String.format(\"Failed to read/close data schema file \\\"%s\\\" in classpath: \\\"%s\\\"\", schemaResourcePath, e.getMessage()));\n       }\n+      return schema;\n     }\n-    catch (IOException e)\n+\n+    void setExtension(String extension)\n     {\n-      errorMessageBuilder.append(String.format(\"Failed to read/close data schema file \\\"%s\\\" in classpath: \\\"%s\\\"\", schemaResourcePath, e.getMessage()));\n+      this._extension = extension;\n     }\n-    return schema;\n-  }\n \n-  private final ClassLoader _classLoader;\n+    private String _extension = SchemaParser.FILE_EXTENSION;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd331a402e0e3ae6c6e35e111d0693f4812a57e"}, "originalPosition": 135}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxMTc1NQ==", "bodyText": "This class no longer extends DefaultDataSchemaResolver. Are you sure you're not removing any default functionality it had before?", "url": "https://github.com/linkedin/rest.li/pull/214#discussion_r389211755", "createdAt": "2020-03-07T01:15:25Z", "author": {"login": "evanw555"}, "path": "data/src/main/java/com/linkedin/data/schema/resolver/ClasspathResourceDataSchemaResolver.java", "diffHunk": "@@ -33,61 +34,106 @@\n  *\n  * @author Min Chen\n  */\n-public class ClasspathResourceDataSchemaResolver extends DefaultDataSchemaResolver", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd331a402e0e3ae6c6e35e111d0693f4812a57e"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzA4MTQ1", "url": "https://github.com/linkedin/rest.li/pull/214#pullrequestreview-370708145", "createdAt": "2020-03-07T01:17:35Z", "commit": {"oid": "cbd331a402e0e3ae6c6e35e111d0693f4812a57e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMToxNzozNVrOFzLnug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMToxNzozNVrOFzLnug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxMjA5MA==", "bodyText": "How is this different from current MultiFormatDataSchemaResolver (https://github.com/linkedin/rest.li/blob/master/data/src/main/java/com/linkedin/data/schema/resolver/MultiFormatDataSchemaResolver.java)?", "url": "https://github.com/linkedin/rest.li/pull/214#discussion_r389212090", "createdAt": "2020-03-07T01:17:35Z", "author": {"login": "mchen07"}, "path": "data/src/main/java/com/linkedin/data/schema/resolver/AbstractMultiFormatDataSchemaResolver.java", "diffHunk": "@@ -0,0 +1,179 @@\n+/*\n+ * Copyright 2015 Coursera Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.linkedin.data.schema.resolver;\n+\n+import com.linkedin.data.schema.DataSchemaLocation;\n+import com.linkedin.data.schema.DataSchemaParserFactory;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.Name;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.SchemaParser;\n+import com.linkedin.data.schema.SchemaParserFactory;\n+import com.linkedin.data.schema.grammar.PdlSchemaParser;\n+import com.linkedin.data.schema.grammar.PdlSchemaParserFactory;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.LinkedHashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+\n+/**\n+ * Combines multiple file format specific resolvers (and respective file format specific parsers)\n+ * into a single resolver.\n+ *\n+ * E.g. a resolver for the \".pdsc\" file format and the \".pdl\" file format, each with their\n+ * own file format specific parsers, can be combined into a single resolver able to look up\n+ * schemas of either file format.\n+ */\n+public class AbstractMultiFormatDataSchemaResolver implements DataSchemaResolver", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd331a402e0e3ae6c6e35e111d0693f4812a57e"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a730cdce2622d766abf054e92542c6c0d02c2669", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/a730cdce2622d766abf054e92542c6c0d02c2669", "committedDate": "2020-03-07T01:37:12Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzEyMjQ1", "url": "https://github.com/linkedin/rest.li/pull/214#pullrequestreview-370712245", "createdAt": "2020-03-07T01:52:05Z", "commit": {"oid": "cbd331a402e0e3ae6c6e35e111d0693f4812a57e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMTo1MjowNVrOFzL3ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMTo1Mjo1OVrOFzL36g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxNjE2Mw==", "bodyText": "why do we need this setter exposed? Should constructor handle this automatically?", "url": "https://github.com/linkedin/rest.li/pull/214#discussion_r389216163", "createdAt": "2020-03-07T01:52:05Z", "author": {"login": "mchen07"}, "path": "data/src/main/java/com/linkedin/data/schema/resolver/ClasspathResourceDataSchemaResolver.java", "diffHunk": "@@ -33,61 +34,106 @@\n  *\n  * @author Min Chen\n  */\n-public class ClasspathResourceDataSchemaResolver extends DefaultDataSchemaResolver\n+public class ClasspathResourceDataSchemaResolver extends AbstractMultiFormatDataSchemaResolver\n {\n   /**\n    * The default file name extension is \".pdsc\".\n+   * @deprecated Do not use.\n    */\n+  @Deprecated\n   public static final String DEFAULT_EXTENSION = SchemaParser.FILE_EXTENSION;\n \n+  private final ClassLoader _classLoader;\n+\n+\n   /**\n    * Construct a new instance that uses the {@link Thread#getContextClassLoader()} for the current thread.\n    */\n+  public ClasspathResourceDataSchemaResolver()\n+  {\n+    this(null, Thread.currentThread().getContextClassLoader());\n+  }\n+\n+  /**\n+   * Construct a new instance that uses the {@link Thread#getContextClassLoader()} for the current thread.\n+   *\n+   * @deprecated The parserFactory is not needed as this class now uses builtin parsers. Use\n+   * {@link #ClasspathResourceDataSchemaResolver()} instead\n+   */\n+  @Deprecated\n   public ClasspathResourceDataSchemaResolver(SchemaParserFactory parserFactory)\n   {\n-    super(parserFactory);\n-    _classLoader = Thread.currentThread().getContextClassLoader();\n+    this(Thread.currentThread().getContextClassLoader());\n   }\n \n   /**\n    * Construct a new instance that uses the specified {@link ClassLoader}.\n    *\n    * @param classLoader provides the {@link ClassLoader}.\n    */\n-  public ClasspathResourceDataSchemaResolver(SchemaParserFactory parserFactory, ClassLoader classLoader)\n+  public ClasspathResourceDataSchemaResolver(ClassLoader classLoader)\n   {\n-    super(parserFactory);\n+    for (DataSchemaParserFactory parserForFormat: BUILTIN_FORMAT_PARSER_FACTORIES)\n+    {\n+      SingleFormatClasspathSchemaResolver resolver = new SingleFormatClasspathSchemaResolver(parserForFormat);\n+      resolver.setExtension(\".\" + parserForFormat.getLanguageExtension());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd331a402e0e3ae6c6e35e111d0693f4812a57e"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxNjIzNA==", "bodyText": "I may prefer that we make this final, and initialized in constructor and hide setter for this.", "url": "https://github.com/linkedin/rest.li/pull/214#discussion_r389216234", "createdAt": "2020-03-07T01:52:59Z", "author": {"login": "mchen07"}, "path": "data/src/main/java/com/linkedin/data/schema/resolver/ClasspathResourceDataSchemaResolver.java", "diffHunk": "@@ -33,61 +34,106 @@\n  *\n  * @author Min Chen\n  */\n-public class ClasspathResourceDataSchemaResolver extends DefaultDataSchemaResolver\n+public class ClasspathResourceDataSchemaResolver extends AbstractMultiFormatDataSchemaResolver\n {\n   /**\n    * The default file name extension is \".pdsc\".\n+   * @deprecated Do not use.\n    */\n+  @Deprecated\n   public static final String DEFAULT_EXTENSION = SchemaParser.FILE_EXTENSION;\n \n+  private final ClassLoader _classLoader;\n+\n+\n   /**\n    * Construct a new instance that uses the {@link Thread#getContextClassLoader()} for the current thread.\n    */\n+  public ClasspathResourceDataSchemaResolver()\n+  {\n+    this(null, Thread.currentThread().getContextClassLoader());\n+  }\n+\n+  /**\n+   * Construct a new instance that uses the {@link Thread#getContextClassLoader()} for the current thread.\n+   *\n+   * @deprecated The parserFactory is not needed as this class now uses builtin parsers. Use\n+   * {@link #ClasspathResourceDataSchemaResolver()} instead\n+   */\n+  @Deprecated\n   public ClasspathResourceDataSchemaResolver(SchemaParserFactory parserFactory)\n   {\n-    super(parserFactory);\n-    _classLoader = Thread.currentThread().getContextClassLoader();\n+    this(Thread.currentThread().getContextClassLoader());\n   }\n \n   /**\n    * Construct a new instance that uses the specified {@link ClassLoader}.\n    *\n    * @param classLoader provides the {@link ClassLoader}.\n    */\n-  public ClasspathResourceDataSchemaResolver(SchemaParserFactory parserFactory, ClassLoader classLoader)\n+  public ClasspathResourceDataSchemaResolver(ClassLoader classLoader)\n   {\n-    super(parserFactory);\n+    for (DataSchemaParserFactory parserForFormat: BUILTIN_FORMAT_PARSER_FACTORIES)\n+    {\n+      SingleFormatClasspathSchemaResolver resolver = new SingleFormatClasspathSchemaResolver(parserForFormat);\n+      resolver.setExtension(\".\" + parserForFormat.getLanguageExtension());\n+      addResolver(resolver);\n+    }\n     _classLoader = classLoader;\n   }\n-\n-  private String getDataSchemaResourcePath(String schemaName)\n+  /**\n+   * Construct a new instance that uses the specified {@link ClassLoader}.\n+   *\n+   * @deprecated The parserFactory is not needed as this class now uses builtin parsers. Use\n+   * {@link #ClasspathResourceDataSchemaResolver(ClassLoader)} instead\n+   * @param classLoader provides the {@link ClassLoader}.\n+   */\n+  @Deprecated\n+  public ClasspathResourceDataSchemaResolver(SchemaParserFactory parserFactory, ClassLoader classLoader)\n   {\n-    return InternalConstants.PEGASUS_DIR_IN_JAR + \"/\" + schemaName.replace('.', '/') + DEFAULT_EXTENSION;\n+    this(classLoader);\n   }\n \n-  @Override\n-  protected NamedDataSchema locateDataSchema(String schemaName, StringBuilder errorMessageBuilder)\n+  private class SingleFormatClasspathSchemaResolver extends DefaultDataSchemaResolver\n   {\n-    NamedDataSchema schema = null;\n-    final String schemaResourcePath = getDataSchemaResourcePath(schemaName);\n-    try (InputStream stream = _classLoader.getResourceAsStream(schemaResourcePath))\n+    /**\n+     * Construct a new instance that uses the {@link Thread#getContextClassLoader()} for the current thread.\n+     */\n+    public SingleFormatClasspathSchemaResolver(DataSchemaParserFactory parserFactory)\n+    {\n+      super(parserFactory);\n+    }\n+\n+    private String getDataSchemaResourcePath(String schemaName)\n     {\n-      if (stream == null)\n+      return InternalConstants.PEGASUS_DIR_IN_JAR + \"/\" + schemaName.replace('.', '/') + _extension;\n+    }\n+\n+    @Override\n+    protected NamedDataSchema locateDataSchema(String schemaName, StringBuilder errorMessageBuilder)\n+    {\n+      NamedDataSchema schema = null;\n+      final String schemaResourcePath = getDataSchemaResourcePath(schemaName);\n+      try (InputStream stream = _classLoader.getResourceAsStream(schemaResourcePath))\n       {\n-        errorMessageBuilder.append(String.format(\"Unable to find data schema file \\\"%s\\\" in classpath.\", schemaResourcePath));\n+        if (stream != null)\n+        {\n+          DataSchemaLocation location = new FileDataSchemaLocation(new File(schemaResourcePath));\n+          schema = parse(stream, location, schemaName, errorMessageBuilder);\n+        }\n       }\n-      else\n+      catch (IOException e)\n       {\n-        DataSchemaLocation location = new FileDataSchemaLocation(new File(schemaResourcePath));\n-        schema = parse(stream, location, schemaName, errorMessageBuilder);\n+        errorMessageBuilder.append(String.format(\"Failed to read/close data schema file \\\"%s\\\" in classpath: \\\"%s\\\"\", schemaResourcePath, e.getMessage()));\n       }\n+      return schema;\n     }\n-    catch (IOException e)\n+\n+    void setExtension(String extension)\n     {\n-      errorMessageBuilder.append(String.format(\"Failed to read/close data schema file \\\"%s\\\" in classpath: \\\"%s\\\"\", schemaResourcePath, e.getMessage()));\n+      this._extension = extension;\n     }\n-    return schema;\n-  }\n \n-  private final ClassLoader _classLoader;\n+    private String _extension = SchemaParser.FILE_EXTENSION;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbd331a402e0e3ae6c6e35e111d0693f4812a57e"}, "originalPosition": 135}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzEyNjA3", "url": "https://github.com/linkedin/rest.li/pull/214#pullrequestreview-370712607", "createdAt": "2020-03-07T01:56:05Z", "commit": {"oid": "a730cdce2622d766abf054e92542c6c0d02c2669"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMTo1NjowNVrOFzL5KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMTo1NjowNVrOFzL5KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIxNjU1Mw==", "bodyText": "one last nit: move to below constructor (Edit: just remove, as per Min's suggestion)", "url": "https://github.com/linkedin/rest.li/pull/214#discussion_r389216553", "createdAt": "2020-03-07T01:56:05Z", "author": {"login": "evanw555"}, "path": "data/src/main/java/com/linkedin/data/schema/resolver/ClasspathResourceDataSchemaResolver.java", "diffHunk": "@@ -33,61 +34,107 @@\n  *\n  * @author Min Chen\n  */\n-public class ClasspathResourceDataSchemaResolver extends DefaultDataSchemaResolver\n+public class ClasspathResourceDataSchemaResolver extends AbstractMultiFormatDataSchemaResolver\n {\n   /**\n    * The default file name extension is \".pdsc\".\n+   * @deprecated Do not use.\n    */\n+  @Deprecated\n   public static final String DEFAULT_EXTENSION = SchemaParser.FILE_EXTENSION;\n \n+  private final ClassLoader _classLoader;\n+\n+\n   /**\n    * Construct a new instance that uses the {@link Thread#getContextClassLoader()} for the current thread.\n    */\n+  public ClasspathResourceDataSchemaResolver()\n+  {\n+    this(Thread.currentThread().getContextClassLoader());\n+  }\n+\n+  /**\n+   * Construct a new instance that uses the {@link Thread#getContextClassLoader()} for the current thread.\n+   *\n+   * @deprecated The parserFactory is not needed as this class now uses builtin parsers. Use\n+   * {@link #ClasspathResourceDataSchemaResolver()} instead\n+   */\n+  @Deprecated\n   public ClasspathResourceDataSchemaResolver(SchemaParserFactory parserFactory)\n   {\n-    super(parserFactory);\n-    _classLoader = Thread.currentThread().getContextClassLoader();\n+    this(Thread.currentThread().getContextClassLoader());\n   }\n \n   /**\n    * Construct a new instance that uses the specified {@link ClassLoader}.\n    *\n    * @param classLoader provides the {@link ClassLoader}.\n    */\n-  public ClasspathResourceDataSchemaResolver(SchemaParserFactory parserFactory, ClassLoader classLoader)\n+  public ClasspathResourceDataSchemaResolver(ClassLoader classLoader)\n   {\n-    super(parserFactory);\n+    for (DataSchemaParserFactory parserForFormat: BUILTIN_FORMAT_PARSER_FACTORIES)\n+    {\n+      SingleFormatClasspathSchemaResolver resolver = new SingleFormatClasspathSchemaResolver(parserForFormat);\n+      resolver.setExtension(\".\" + parserForFormat.getLanguageExtension());\n+      addResolver(resolver);\n+    }\n     _classLoader = classLoader;\n   }\n \n-  private String getDataSchemaResourcePath(String schemaName)\n+  /**\n+   * Construct a new instance that uses the specified {@link ClassLoader}.\n+   *\n+   * @deprecated The parserFactory is not needed as this class now uses builtin parsers. Use\n+   * {@link #ClasspathResourceDataSchemaResolver(ClassLoader)} instead\n+   * @param classLoader provides the {@link ClassLoader}.\n+   */\n+  @Deprecated\n+  public ClasspathResourceDataSchemaResolver(SchemaParserFactory parserFactory, ClassLoader classLoader)\n   {\n-    return InternalConstants.PEGASUS_DIR_IN_JAR + \"/\" + schemaName.replace('.', '/') + DEFAULT_EXTENSION;\n+    this(classLoader);\n   }\n \n-  @Override\n-  protected NamedDataSchema locateDataSchema(String schemaName, StringBuilder errorMessageBuilder)\n+  private class SingleFormatClasspathSchemaResolver extends DefaultDataSchemaResolver\n   {\n-    NamedDataSchema schema = null;\n-    final String schemaResourcePath = getDataSchemaResourcePath(schemaName);\n-    try (InputStream stream = _classLoader.getResourceAsStream(schemaResourcePath))\n+    private String _extension = SchemaParser.FILE_EXTENSION;\n+\n+    void setExtension(String extension)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a730cdce2622d766abf054e92542c6c0d02c2669"}, "originalPosition": 89}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80b4dfefd02489c580e3c265a7656c28a2741f9f", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/80b4dfefd02489c580e3c265a7656c28a2741f9f", "committedDate": "2020-03-07T04:15:51Z", "message": "Remove the setter for extension."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "161d8c998282107ce0e6b1c5d84804e84dc95f99", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/161d8c998282107ce0e6b1c5d84804e84dc95f99", "committedDate": "2020-03-07T04:17:03Z", "message": "Release version 28.1.27"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzMwMTY0", "url": "https://github.com/linkedin/rest.li/pull/214#pullrequestreview-370730164", "createdAt": "2020-03-07T07:50:23Z", "commit": {"oid": "161d8c998282107ce0e6b1c5d84804e84dc95f99"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da1bd47408d1c08e4a30dbb22b9054003a3afcd0", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/da1bd47408d1c08e4a30dbb22b9054003a3afcd0", "committedDate": "2020-03-07T15:28:44Z", "message": "Merge branch 'master' into bug/pdl_classpath_resolver"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4982, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}