{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTc2ODQ5", "number": 285, "title": "Initial pdl schemas for relative load balancing.", "bodyText": "Created initial schemas for relative load balancing. This is a new set of configs with some copied over from LoadBalancer/DegraderStrategyProperties.\nD2QuarantineProperties - contains quarantine related properties.\nD2RingProperties - for ring properties.\nRelativeStrategyProperties - for relative strategy specific properties.", "createdAt": "2020-05-04T20:48:20Z", "url": "https://github.com/linkedin/rest.li/pull/285", "merged": true, "mergeCommit": {"oid": "b8596c9ab9f37ea85fa55d1786e504940684302d"}, "closed": true, "closedAt": "2020-05-19T23:04:59Z", "author": {"login": "zhang-chris"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceG6--AFqTQwNTM3MzExMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABci7xtSAH2gAyNDEzMTc2ODQ5OmE4MzNiZDZjOWU2Y2I5Y2UyNTQ0YTE5NjU1MGRkY2U1MGI3YWVhYTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzczMTEz", "url": "https://github.com/linkedin/rest.li/pull/285#pullrequestreview-405373113", "createdAt": "2020-05-04T21:49:14Z", "commit": {"oid": "57c8ae9ffd1f234e122046eb61b0e038b515071a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMTo0OToxNFrOGQTfmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjowMzozM1rOGQT43w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0OTc4NQ==", "bodyText": "Since this is an optional field, we can also explicitly mention not setting it means disabled.", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r419749785", "createdAt": "2020-05-04T21:49:14Z", "author": {"login": "rachelhanhan"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2QuarantineProperties.pdl", "diffHunk": "@@ -0,0 +1,27 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * Properties for D2 quarantine.\n+ *\n+ * Uhealthy hosts can be placed in quarantine, in which a predefined method is used\n+ * to check endpoint health without routing real request traffic to them.\n+ */\n+record D2QuarantineProperties {\n+\n+  /**\n+   * The max percentage of hosts in the cluster that can be quarantined at the same time.\n+   * Values are from 0.0 - 1.0. A value of 0.0 means quarantine is disabled.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c8ae9ffd1f234e122046eb61b0e038b515071a"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1MzMxMA==", "bodyText": "For optional fields, some old doc did not mention the default value, let's mention the default value and range? The default value for this field is 0.2?", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r419753310", "createdAt": "2020-05-04T21:56:47Z", "author": {"login": "rachelhanhan"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2RingProperties.pdl", "diffHunk": "@@ -0,0 +1,92 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * D2 hash ring properties used for load balancing.\n+ */\n+record D2RingProperties {\n+\n+  /**\n+   * How fast should load balancer ramp up node that has been 100% degraded and is being recovered. Defaults to 1.0.\n+   */\n+  ringRampFactor: optional double\n+\n+  /**\n+   * The number of points per weight given for a particular node in a hash ring. Defaults to 100.\n+   */\n+  pointsPerWeight: optional int\n+\n+  /**\n+   * What hashing method used to hash incoming request. Used to determine which node should serve the request. Choices are Random, UriRegex\n+   */\n+  @symbolDocs = {\n+    \"URI_REGEX\" : \"Extract a key from URI and use it to hash\",\n+    \"RANDOM\" : \"The default fall back value\"\n+  }\n+  hashMethod: optional enum hashMethodEnum {\n+    RANDOM\n+    URI_REGEX\n+  }\n+\n+  /**\n+   * Configuration used to supplement the hash method.\n+   */\n+  hashConfig: optional record hashConfigType {\n+\n+    /**\n+     * List of Regex to match against the URI of incoming request and compute hash value. The hash value is computed based on the contents of the first capture group of the first expression that matches the request URI\n+     */\n+    uriRegexes: optional array[string]\n+\n+    /**\n+     * Optional config value. if true, fail if no regex matches, otherwise fall back to random.\n+     */\n+    failOnNoMatch: boolean = false\n+\n+    /**\n+     *  Optional config value. if false, don't warn on falling back to random if the uri doesn't match the regex\n+     */\n+    warnOnNoMatch: boolean = true\n+  }\n+\n+  /**\n+   * The highest ratio of unused entries over the total entries of the Ring points that d2 maintains.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c8ae9ffd1f234e122046eb61b0e038b515071a"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1Mzk0Mg==", "bodyText": "Let's mention the default is 0.2", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r419753942", "createdAt": "2020-05-04T21:58:15Z", "author": {"login": "rachelhanhan"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2RelativeStrategyProperties.pdl", "diffHunk": "@@ -0,0 +1,125 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * Relative load balancer strategy properties for a particular D2 service.\n+ *\n+ * Balances traffic to hosts within a service by dynamically adjusting a server's health score\n+ * based on call statitics compared relatively to the performance of the entire cluster.\n+ *\n+ * Health score is rated on a scale from 0.0 - 1.0, with 0.0 meaning most unhealthy (all traffic\n+ * routed away) and 1.0 meaning most healthy (no traffic routed away). Note that this behavior is\n+ * inverse of dropRate in the degrader strategy.\n+ */\n+record D2RelativeStrategyProperties {\n+\n+  /**\n+   * Step function delta size for increasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  upStep: optional double\n+\n+  /**\n+   * Step function delta size for decreasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  downStep: optional double", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c8ae9ffd1f234e122046eb61b0e038b515071a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1NDc5MA==", "bodyText": "Since this is optional, we should come up with a default factor in case client does not set it. We can discuss about the default value and mention it in the doc", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r419754790", "createdAt": "2020-05-04T21:59:59Z", "author": {"login": "rachelhanhan"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2RelativeStrategyProperties.pdl", "diffHunk": "@@ -0,0 +1,125 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * Relative load balancer strategy properties for a particular D2 service.\n+ *\n+ * Balances traffic to hosts within a service by dynamically adjusting a server's health score\n+ * based on call statitics compared relatively to the performance of the entire cluster.\n+ *\n+ * Health score is rated on a scale from 0.0 - 1.0, with 0.0 meaning most unhealthy (all traffic\n+ * routed away) and 1.0 meaning most healthy (no traffic routed away). Note that this behavior is\n+ * inverse of dropRate in the degrader strategy.\n+ */\n+record D2RelativeStrategyProperties {\n+\n+  /**\n+   * Step function delta size for increasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  upStep: optional double\n+\n+  /**\n+   * Step function delta size for decreasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  downStep: optional double\n+\n+  /**\n+   * A server whose latency is above this specified factor of the cluster average is considered unhealthy,\n+   * and its health score will be decreased by downStep.\n+   * Values must be greater than both 1.0 and relativeLatencyLowThresholdFactor.\n+   */\n+  relativeLatencyHighThresholdFactor: optional double", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c8ae9ffd1f234e122046eb61b0e038b515071a"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1NTA2Ng==", "bodyText": "What's the default value here?", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r419755066", "createdAt": "2020-05-04T22:00:43Z", "author": {"login": "rachelhanhan"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2RelativeStrategyProperties.pdl", "diffHunk": "@@ -0,0 +1,125 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * Relative load balancer strategy properties for a particular D2 service.\n+ *\n+ * Balances traffic to hosts within a service by dynamically adjusting a server's health score\n+ * based on call statitics compared relatively to the performance of the entire cluster.\n+ *\n+ * Health score is rated on a scale from 0.0 - 1.0, with 0.0 meaning most unhealthy (all traffic\n+ * routed away) and 1.0 meaning most healthy (no traffic routed away). Note that this behavior is\n+ * inverse of dropRate in the degrader strategy.\n+ */\n+record D2RelativeStrategyProperties {\n+\n+  /**\n+   * Step function delta size for increasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  upStep: optional double\n+\n+  /**\n+   * Step function delta size for decreasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  downStep: optional double\n+\n+  /**\n+   * A server whose latency is above this specified factor of the cluster average is considered unhealthy,\n+   * and its health score will be decreased by downStep.\n+   * Values must be greater than both 1.0 and relativeLatencyLowThresholdFactor.\n+   */\n+  relativeLatencyHighThresholdFactor: optional double\n+\n+  /**\n+   * A server whose latency is below this specified factor of the cluster average is considered healthy,\n+   * and its health score will be increased by upStep.\n+   * Values must be greater than 1.0 and below relativeLatencyHighThresholdFactor.\n+   */\n+  relativeLatencyLowThresholdFactor: optional double\n+\n+  /**\n+   * If the error rate during the interval exceeds this value, then we will decrease the health score by downStep.\n+   * Values are from 0.0 - 1.0.\n+   */\n+  highErrorRate: optional double\n+\n+  /**\n+   * If the error rate during the interval is under this value, then we will increase the health score by upStep.\n+   * Values are from 0.0 - 1.0.\n+   */\n+  lowErrorRate: optional double", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c8ae9ffd1f234e122046eb61b0e038b515071a"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1NTMzOA==", "bodyText": "Same applied to all other optional fields", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r419755338", "createdAt": "2020-05-04T22:01:21Z", "author": {"login": "rachelhanhan"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2RelativeStrategyProperties.pdl", "diffHunk": "@@ -0,0 +1,125 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * Relative load balancer strategy properties for a particular D2 service.\n+ *\n+ * Balances traffic to hosts within a service by dynamically adjusting a server's health score\n+ * based on call statitics compared relatively to the performance of the entire cluster.\n+ *\n+ * Health score is rated on a scale from 0.0 - 1.0, with 0.0 meaning most unhealthy (all traffic\n+ * routed away) and 1.0 meaning most healthy (no traffic routed away). Note that this behavior is\n+ * inverse of dropRate in the degrader strategy.\n+ */\n+record D2RelativeStrategyProperties {\n+\n+  /**\n+   * Step function delta size for increasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  upStep: optional double\n+\n+  /**\n+   * Step function delta size for decreasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  downStep: optional double\n+\n+  /**\n+   * A server whose latency is above this specified factor of the cluster average is considered unhealthy,\n+   * and its health score will be decreased by downStep.\n+   * Values must be greater than both 1.0 and relativeLatencyLowThresholdFactor.\n+   */\n+  relativeLatencyHighThresholdFactor: optional double\n+\n+  /**\n+   * A server whose latency is below this specified factor of the cluster average is considered healthy,\n+   * and its health score will be increased by upStep.\n+   * Values must be greater than 1.0 and below relativeLatencyHighThresholdFactor.\n+   */\n+  relativeLatencyLowThresholdFactor: optional double\n+\n+  /**\n+   * If the error rate during the interval exceeds this value, then we will decrease the health score by downStep.\n+   * Values are from 0.0 - 1.0.\n+   */\n+  highErrorRate: optional double\n+\n+  /**\n+   * If the error rate during the interval is under this value, then we will increase the health score by upStep.\n+   * Values are from 0.0 - 1.0.\n+   */\n+  lowErrorRate: optional double", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1NTA2Ng=="}, "originalCommit": {"oid": "57c8ae9ffd1f234e122046eb61b0e038b515071a"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1NjI1NQ==", "bodyText": "The term \"degrader strategy\" can be changed to \"load balancer strategy\"?", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r419756255", "createdAt": "2020-05-04T22:03:33Z", "author": {"login": "rachelhanhan"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2RelativeStrategyProperties.pdl", "diffHunk": "@@ -0,0 +1,125 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * Relative load balancer strategy properties for a particular D2 service.\n+ *\n+ * Balances traffic to hosts within a service by dynamically adjusting a server's health score\n+ * based on call statitics compared relatively to the performance of the entire cluster.\n+ *\n+ * Health score is rated on a scale from 0.0 - 1.0, with 0.0 meaning most unhealthy (all traffic\n+ * routed away) and 1.0 meaning most healthy (no traffic routed away). Note that this behavior is\n+ * inverse of dropRate in the degrader strategy.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c8ae9ffd1f234e122046eb61b0e038b515071a"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDEwMTgw", "url": "https://github.com/linkedin/rest.li/pull/285#pullrequestreview-406010180", "createdAt": "2020-05-05T17:36:24Z", "commit": {"oid": "4d3fec05d7e44fbbb93f13612c8c250094d3aa68"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNzozNjoyNFrOGQ0VCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNzo0MDo1NFrOGQ0fPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4Nzc1Mg==", "bodyText": "Do we need to mark these 2 old fields as optional since when client migrates, they can only set relativeStrategyProperties and get rid of these 2 old property fields", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r420287752", "createdAt": "2020-05-05T17:36:24Z", "author": {"login": "rachelhanhan"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2Service.pdl", "diffHunk": "@@ -63,15 +69,24 @@ record D2Service includes D2ChangeTimeStamps {\n   cluster: string\n \n   /**\n-   * The load balancer strategy properties for this service\n+   * The load balancer strategy properties for this service.\n+   *\n+   * Required along with D2DegraderProperties for the degrader strategy.\n    */\n   loadBalancerStrategyProperties: D2LoadBalancerStrategyProperties\n \n   /**\n-   * The degrader properties for this service\n+   * The degrader properties for this service.\n+   *\n+   * Required along with D2DegraderProperties for the degrader strategy.\n    */\n   degraderProperties: D2DegraderProperties", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d3fec05d7e44fbbb93f13612c8c250094d3aa68"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI5MDM2NA==", "bodyText": "Wondering why this not optional even today, if user specify RANDOM, then these properties are not used either. Is it not optional for a purpose?", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r420290364", "createdAt": "2020-05-05T17:40:54Z", "author": {"login": "rachelhanhan"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2Service.pdl", "diffHunk": "@@ -63,15 +69,24 @@ record D2Service includes D2ChangeTimeStamps {\n   cluster: string\n \n   /**\n-   * The load balancer strategy properties for this service\n+   * The load balancer strategy properties for this service.\n+   *\n+   * Required along with D2DegraderProperties for the degrader strategy.\n    */\n   loadBalancerStrategyProperties: D2LoadBalancerStrategyProperties\n \n   /**\n-   * The degrader properties for this service\n+   * The degrader properties for this service.\n+   *\n+   * Required along with D2DegraderProperties for the degrader strategy.\n    */\n   degraderProperties: D2DegraderProperties", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4Nzc1Mg=="}, "originalCommit": {"oid": "4d3fec05d7e44fbbb93f13612c8c250094d3aa68"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2ODQxNzU0", "url": "https://github.com/linkedin/rest.li/pull/285#pullrequestreview-406841754", "createdAt": "2020-05-06T17:40:12Z", "commit": {"oid": "ee3a2e0b87edb71335063334d58054a4fc5b7b11"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzMyNzI5", "url": "https://github.com/linkedin/rest.li/pull/285#pullrequestreview-410332729", "createdAt": "2020-05-12T18:55:52Z", "commit": {"oid": "ee3a2e0b87edb71335063334d58054a4fc5b7b11"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzQyNzA2", "url": "https://github.com/linkedin/rest.li/pull/285#pullrequestreview-410342706", "createdAt": "2020-05-12T19:09:50Z", "commit": {"oid": "ee3a2e0b87edb71335063334d58054a4fc5b7b11"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOTowOTo1MFrOGUVEAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxOToyMDoyNFrOGUVasg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk2OTc5Mw==", "bodyText": "This field is not used anymore -- instead we use lowLatency as the threshold. For relative LB will this become required? If yes it should not be optional.", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r423969793", "createdAt": "2020-05-12T19:09:50Z", "author": {"login": "cx-super"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2QuarantineProperties.pdl", "diffHunk": "@@ -0,0 +1,27 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * Properties for D2 quarantine.\n+ *\n+ * Uhealthy hosts can be placed in quarantine, in which a predefined method is used\n+ * to check endpoint health without routing real request traffic to them.\n+ */\n+record D2QuarantineProperties {\n+\n+  /**\n+   * The max percentage of hosts in the cluster that can be quarantined at the same time.\n+   * Values are from 0.0 - 1.0. A value of 0.0 means quarantine is disabled.\n+   */\n+  quarantineMaxPercent: optional double\n+\n+  /**\n+   * Specifies the method used for health checking. Format: <METHOD>:<FULL_PATH>. Defaults to OPTIONS method.\n+   */\n+  quarantineMethod: optional string\n+\n+  /**\n+   * The latency threshold (in milliseconds) for health check requests. Response times longer\n+   * than this threshold are considered as unhealthy.\n+   */\n+  quarantineLatency: optional long", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee3a2e0b87edb71335063334d58054a4fc5b7b11"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk3MzY0MA==", "bodyText": "Does this field still make sense for relative LB?", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r423973640", "createdAt": "2020-05-12T19:16:51Z", "author": {"login": "cx-super"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2RingProperties.pdl", "diffHunk": "@@ -0,0 +1,92 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * D2 hash ring properties used for load balancing.\n+ */\n+record D2RingProperties {\n+\n+  /**\n+   * How fast should load balancer ramp up node that has been 100% degraded and is being recovered. Defaults to 1.0.\n+   */\n+  ringRampFactor: optional double\n+\n+  /**\n+   * The number of points per weight given for a particular node in a hash ring. Defaults to 100.\n+   */\n+  pointsPerWeight: optional int", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee3a2e0b87edb71335063334d58054a4fc5b7b11"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk3NDkwNw==", "bodyText": "I thought relative LB does not support affinity routing? If that's the case you do not need these fields.", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r423974907", "createdAt": "2020-05-12T19:19:10Z", "author": {"login": "cx-super"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2RingProperties.pdl", "diffHunk": "@@ -0,0 +1,92 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * D2 hash ring properties used for load balancing.\n+ */\n+record D2RingProperties {\n+\n+  /**\n+   * How fast should load balancer ramp up node that has been 100% degraded and is being recovered. Defaults to 1.0.\n+   */\n+  ringRampFactor: optional double\n+\n+  /**\n+   * The number of points per weight given for a particular node in a hash ring. Defaults to 100.\n+   */\n+  pointsPerWeight: optional int\n+\n+  /**\n+   * What hashing method used to hash incoming request. Used to determine which node should serve the request. Choices are Random, UriRegex\n+   */\n+  @symbolDocs = {\n+    \"URI_REGEX\" : \"Extract a key from URI and use it to hash\",\n+    \"RANDOM\" : \"The default fall back value\"\n+  }\n+  hashMethod: optional enum HashMethod {\n+    RANDOM\n+    URI_REGEX\n+  }\n+\n+  /**\n+   * Configuration used to supplement the hash method.\n+   */\n+  hashConfig: optional record HashConfig {\n+\n+    /**\n+     * List of Regex to match against the URI of incoming request and compute hash value. The hash value is computed based on the contents of the first capture group of the first expression that matches the request URI\n+     */\n+    uriRegexes: optional array[string]\n+\n+    /**\n+     * Optional config value. if true, fail if no regex matches, otherwise fall back to random.\n+     */\n+    failOnNoMatch: boolean = false\n+\n+    /**\n+     *  Optional config value. if false, don't warn on falling back to random if the uri doesn't match the regex\n+     */\n+    warnOnNoMatch: boolean = true\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee3a2e0b87edb71335063334d58054a4fc5b7b11"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk3NTYwMg==", "bodyText": "Ditto", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r423975602", "createdAt": "2020-05-12T19:20:24Z", "author": {"login": "cx-super"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2RingProperties.pdl", "diffHunk": "@@ -0,0 +1,92 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * D2 hash ring properties used for load balancing.\n+ */\n+record D2RingProperties {\n+\n+  /**\n+   * How fast should load balancer ramp up node that has been 100% degraded and is being recovered. Defaults to 1.0.\n+   */\n+  ringRampFactor: optional double\n+\n+  /**\n+   * The number of points per weight given for a particular node in a hash ring. Defaults to 100.\n+   */\n+  pointsPerWeight: optional int\n+\n+  /**\n+   * What hashing method used to hash incoming request. Used to determine which node should serve the request. Choices are Random, UriRegex\n+   */\n+  @symbolDocs = {\n+    \"URI_REGEX\" : \"Extract a key from URI and use it to hash\",\n+    \"RANDOM\" : \"The default fall back value\"\n+  }\n+  hashMethod: optional enum HashMethod {\n+    RANDOM\n+    URI_REGEX\n+  }\n+\n+  /**\n+   * Configuration used to supplement the hash method.\n+   */\n+  hashConfig: optional record HashConfig {\n+\n+    /**\n+     * List of Regex to match against the URI of incoming request and compute hash value. The hash value is computed based on the contents of the first capture group of the first expression that matches the request URI\n+     */\n+    uriRegexes: optional array[string]\n+\n+    /**\n+     * Optional config value. if true, fail if no regex matches, otherwise fall back to random.\n+     */\n+    failOnNoMatch: boolean = false\n+\n+    /**\n+     *  Optional config value. if false, don't warn on falling back to random if the uri doesn't match the regex\n+     */\n+    warnOnNoMatch: boolean = true\n+  }\n+\n+  /**\n+   * The highest ratio of unused entries over the total entries of the Ring points that d2 maintains.\n+   */\n+  hashRingPointCleanupRate: optional double\n+\n+  /**\n+   * Consistent hash algorithm the d2 load balancer should use. Defaults to POINT_BASED.\n+   */\n+  consistentHashAlgorithm: optional enum ConsistentHashAlgorithm {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee3a2e0b87edb71335063334d58054a4fc5b7b11"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDUwNDE0", "url": "https://github.com/linkedin/rest.li/pull/285#pullrequestreview-410450414", "createdAt": "2020-05-12T21:54:10Z", "commit": {"oid": "ee3a2e0b87edb71335063334d58054a4fc5b7b11"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTk5ODg3", "url": "https://github.com/linkedin/rest.li/pull/285#pullrequestreview-411199887", "createdAt": "2020-05-13T18:41:18Z", "commit": {"oid": "3a1e7d7319719beceedb4763c4d09d89676e05de"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo0MToxOFrOGU-xIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxODo0Mjo1MFrOGU-0xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1MzA4OQ==", "bodyText": "Have you thought about using an array of tuples to describe a list of ranges, rather than using a regex?", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r424653089", "createdAt": "2020-05-13T18:41:18Z", "author": {"login": "asakusuma"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2RelativeStrategyProperties.pdl", "diffHunk": "@@ -0,0 +1,125 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * Relative load balancer strategy properties for a particular D2 service.\n+ *\n+ * Balances traffic to hosts within a service by dynamically adjusting a server's health score\n+ * based on call statitics compared relatively to the performance of the entire cluster.\n+ *\n+ * Health score is rated on a scale from 0.0 - 1.0, with 0.0 meaning most unhealthy (all traffic\n+ * routed away) and 1.0 meaning most healthy (no traffic routed away). Note that this behavior is\n+ * inverse of dropRate in the degrader strategy.\n+ */\n+record D2RelativeStrategyProperties {\n+\n+  /**\n+   * Step function delta size for increasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  upStep: optional double\n+\n+  /**\n+   * Step function delta size for decreasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  downStep: optional double\n+\n+  /**\n+   * A server whose latency is above this specified factor of the cluster average is considered unhealthy,\n+   * and its health score will be decreased by downStep.\n+   * Values must be greater than both 1.0 and relativeLatencyLowThresholdFactor.\n+   */\n+  relativeLatencyHighThresholdFactor: optional double\n+\n+  /**\n+   * A server whose latency is below this specified factor of the cluster average is considered healthy,\n+   * and its health score will be increased by upStep.\n+   * Values must be greater than 1.0 and below relativeLatencyHighThresholdFactor.\n+   */\n+  relativeLatencyLowThresholdFactor: optional double\n+\n+  /**\n+   * If the error rate during the interval exceeds this value, then we will decrease the health score by downStep.\n+   * Values are from 0.0 - 1.0.\n+   */\n+  highErrorRate: optional double\n+\n+  /**\n+   * If the error rate during the interval is under this value, then we will increase the health score by upStep.\n+   * Values are from 0.0 - 1.0.\n+   */\n+  lowErrorRate: optional double\n+\n+  /**\n+   * The health score for a server will not be calculated unless the number of calls to it in the interval\n+   * meets or exceeds the minimum call count.\n+   */\n+  minCallCount: optional int\n+\n+  /**\n+   * The interval (in milliseconds) between each round of health score calculations.\n+   */\n+  updateIntervalMs: optional long\n+\n+  /**\n+   * The latency metric type used to calculate the health score.\n+   */\n+  latencyMetricType: optional enum LatencyMetricType {\n+\n+    /**\n+     * Average latency.\n+     */\n+    AVERAGE\n+\n+    /**\n+     * 50th percentile latency.\n+     */\n+    PCT50\n+\n+    /**\n+     * 90th percentile latency.\n+     */\n+    PCT90\n+\n+    /**\n+     * 95th percentile latency.\n+     */\n+    PCT95\n+\n+    /**\n+     * 99th percentile latency.\n+     */\n+    PCT99\n+  }\n+\n+  /**\n+   * The initial health score that a server starts with.\n+   * Values are from 0.0 - 1.0.\n+   */\n+  initialHealthScore: optional double\n+\n+  /**\n+   * The health score threshold that determines whether D2 should perform slow start\n+   * (by doubling the health score) or the normal stepUp/Down operation.\n+   * Values are from 0.0 - 1.0. A value of 0.0 means slow start is disabled.\n+   */\n+  slowStartThreshold: optional double\n+\n+  /**\n+   * Regular expression used to match a request status code and indicate a server-side error.\n+   */\n+  errorStatusRegex: optional string", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a1e7d7319719beceedb4763c4d09d89676e05de"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1NDAyMg==", "bodyText": "Could this possibly be an enum for the method, combined with another field for the path? Rather than just a string.", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r424654022", "createdAt": "2020-05-13T18:42:50Z", "author": {"login": "asakusuma"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2QuarantineProperties.pdl", "diffHunk": "@@ -0,0 +1,21 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * Properties for D2 quarantine.\n+ *\n+ * Uhealthy hosts can be placed in quarantine, in which a predefined method is used\n+ * to check endpoint health without routing real request traffic to them.\n+ */\n+record D2QuarantineProperties {\n+\n+  /**\n+   * The max percentage of hosts in the cluster that can be quarantined at the same time.\n+   * Values are from 0.0 - 1.0. A value of 0.0 means quarantine is disabled.\n+   */\n+  quarantineMaxPercent: optional double\n+\n+  /**\n+   * Specifies the method used for health checking. Format: <METHOD>:<FULL_PATH>. Defaults to OPTIONS method.\n+   */\n+  quarantineMethod: optional string", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a1e7d7319719beceedb4763c4d09d89676e05de"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMTg1OTc4", "url": "https://github.com/linkedin/rest.li/pull/285#pullrequestreview-412185978", "createdAt": "2020-05-14T21:08:32Z", "commit": {"oid": "273aeba73497d99e2a0fdcd582e8b32fa12b088f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQyMTowODozM1rOGVuSWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQyMTowODozM1rOGVuSWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQzMTY0MQ==", "bodyText": "Just to be extra explicit and avoid confusion, can you change \"falls within the provided ranges\" to \"falls within any of the provided ranges\"\nBasically saying that this is OR, not AND logic. Seems obvious but this sort of thing can trip up external readers.", "url": "https://github.com/linkedin/rest.li/pull/285#discussion_r425431641", "createdAt": "2020-05-14T21:08:33Z", "author": {"login": "asakusuma"}, "path": "d2-schemas/src/main/pegasus/com/linkedin/d2/D2RelativeStrategyProperties.pdl", "diffHunk": "@@ -0,0 +1,136 @@\n+namespace com.linkedin.d2\n+\n+/**\n+ * Relative load balancer strategy properties for a particular D2 service.\n+ *\n+ * Balances traffic to hosts within a service by dynamically adjusting a server's health score\n+ * based on call statitics compared relatively to the performance of the entire cluster.\n+ *\n+ * Health score is rated on a scale from 0.0 - 1.0, with 0.0 meaning most unhealthy (all traffic\n+ * routed away) and 1.0 meaning most healthy (no traffic routed away). Note that this behavior is\n+ * inverse of dropRate in the degrader strategy.\n+ */\n+record D2RelativeStrategyProperties {\n+\n+  /**\n+   * Step function delta size for increasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  upStep: optional double\n+\n+  /**\n+   * Step function delta size for decreasing a server's health score. Values are from 0.0 - 1.0.\n+   */\n+  downStep: optional double\n+\n+  /**\n+   * A server whose latency is above this specified factor of the cluster average is considered unhealthy,\n+   * and its health score will be decreased by downStep.\n+   * Values must be greater than both 1.0 and relativeLatencyLowThresholdFactor.\n+   */\n+  relativeLatencyHighThresholdFactor: optional double\n+\n+  /**\n+   * A server whose latency is below this specified factor of the cluster average is considered healthy,\n+   * and its health score will be increased by upStep.\n+   * Values must be greater than 1.0 and below relativeLatencyHighThresholdFactor.\n+   */\n+  relativeLatencyLowThresholdFactor: optional double\n+\n+  /**\n+   * If the error rate during the interval exceeds this value, then we will decrease the health score by downStep.\n+   * Values are from 0.0 - 1.0.\n+   */\n+  highErrorRate: optional double\n+\n+  /**\n+   * If the error rate during the interval is under this value, then we will increase the health score by upStep.\n+   * Values are from 0.0 - 1.0.\n+   */\n+  lowErrorRate: optional double\n+\n+  /**\n+   * The health score for a server will not be calculated unless the number of calls to it in the interval\n+   * meets or exceeds the minimum call count.\n+   */\n+  minCallCount: optional int\n+\n+  /**\n+   * The interval (in milliseconds) between each round of health score calculations.\n+   */\n+  updateIntervalMs: optional long\n+\n+\n+  /**\n+   * The latency metric type used to calculate the health score.\n+   */\n+  latencyMetricType: optional enum LatencyMetricType {\n+\n+    /**\n+     * Average latency.\n+     */\n+    AVERAGE\n+\n+    /**\n+     * 50th percentile latency.\n+     */\n+    PCT50\n+\n+    /**\n+     * 90th percentile latency.\n+     */\n+    PCT90\n+\n+    /**\n+     * 95th percentile latency.\n+     */\n+    PCT95\n+\n+    /**\n+     * 99th percentile latency.\n+     */\n+    PCT99\n+  }\n+\n+  /**\n+   * The initial health score that a server starts with.\n+   * Values are from 0.0 - 1.0.\n+   */\n+  initialHealthScore: optional double\n+\n+  /**\n+   * The health score threshold that determines whether D2 should perform slow start\n+   * (by doubling the health score) or the normal stepUp/Down operation.\n+   * Values are from 0.0 - 1.0. A value of 0.0 means slow start is disabled.\n+   */\n+  slowStartThreshold: optional double\n+\n+  /**\n+   * A request status code that falls within the provided ranges will be considered as a server-side error.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "273aeba73497d99e2a0fdcd582e8b32fa12b088f"}, "originalPosition": 108}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMTg5Mzg0", "url": "https://github.com/linkedin/rest.li/pull/285#pullrequestreview-412189384", "createdAt": "2020-05-14T21:14:00Z", "commit": {"oid": "238a28c3649ccdb0a3fd3d0753c5decac82637f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a90d513b10aab48b303f044122beb125b337e686", "author": {"user": {"login": "zhang-chris", "name": "Christopher Zhang"}}, "url": "https://github.com/linkedin/rest.li/commit/a90d513b10aab48b303f044122beb125b337e686", "committedDate": "2020-05-19T21:56:45Z", "message": "Add schemas for relative load balancing."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3a32369b91425920a683439d4ac859c0194e29e", "author": {"user": {"login": "zhang-chris", "name": "Christopher Zhang"}}, "url": "https://github.com/linkedin/rest.li/commit/f3a32369b91425920a683439d4ac859c0194e29e", "committedDate": "2020-05-19T01:26:56Z", "message": "removed a field; no need for dmrc re-review"}, "afterCommit": {"oid": "a90d513b10aab48b303f044122beb125b337e686", "author": {"user": {"login": "zhang-chris", "name": "Christopher Zhang"}}, "url": "https://github.com/linkedin/rest.li/commit/a90d513b10aab48b303f044122beb125b337e686", "committedDate": "2020-05-19T21:56:45Z", "message": "Add schemas for relative load balancing."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a833bd6c9e6cb9ce2544a196550ddce50b7aeaa9", "author": {"user": {"login": "zhang-chris", "name": "Christopher Zhang"}}, "url": "https://github.com/linkedin/rest.li/commit/a833bd6c9e6cb9ce2544a196550ddce50b7aeaa9", "committedDate": "2020-05-19T21:58:12Z", "message": "Merge branch 'master' into feature/d2_relative_schema"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4772, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}