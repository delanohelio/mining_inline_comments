{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyOTgwMTQz", "number": 414, "title": "Add generatePegasusSchemeSnapshot task", "bodyText": "Add generatePegasusSchemaSnapshot task\nThe task will read pegasus schema files from input directory and generate snapshots of pegasus schemas.\nIt will be triggered if extension schema exist or if \"enablePegasusSchemaCompatibilityCheck\" configuration is provided.\nTest: Unit test and manual test in other repos.", "createdAt": "2020-09-09T16:43:14Z", "url": "https://github.com/linkedin/rest.li/pull/414", "merged": true, "mergeCommit": {"oid": "7de8038abd98703f135fc571c59c1dd31e2f17c5"}, "closed": true, "closedAt": "2020-09-14T20:26:50Z", "author": {"login": "nickibi"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHVqpzAFqTQ4NTQ4Nzg3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIRJtKgBqjM3NTk4MDI5NzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDg3ODc2", "url": "https://github.com/linkedin/rest.li/pull/414#pullrequestreview-485487876", "createdAt": "2020-09-10T00:29:18Z", "commit": {"oid": "a1e22a5bd6445d1a228bed59322c03ce5c3198c1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMDoyOToxOFrOHPernQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMDoyOToxOFrOHPernQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk5MzM3Mw==", "bodyText": "I feel this task function and the other function below configurePegasusExtensionSchemaSnapshotGeneration\nshare some common logic, would it be better to factor some common logic together to behave the DRY (Dont repeat yourself) pattern?", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r485993373", "createdAt": "2020-09-10T00:29:18Z", "author": {"login": "BrianPin"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -1390,6 +1435,87 @@ protected void configureRestModelGeneration(Project project, SourceSet sourceSet\n     });\n   }\n \n+  protected void configurePegasusSchemaSnapshotGeneration(Project project, SourceSet sourceSet)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1e22a5bd6445d1a228bed59322c03ce5c3198c1"}, "originalPosition": 81}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDkzOTE2", "url": "https://github.com/linkedin/rest.li/pull/414#pullrequestreview-485493916", "createdAt": "2020-09-10T00:49:47Z", "commit": {"oid": "a1e22a5bd6445d1a228bed59322c03ce5c3198c1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMDo0OTo0N1rOHPfBWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMDo0OTo0N1rOHPfBWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk5ODkzNg==", "bodyText": "style", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r485998936", "createdAt": "2020-09-10T00:49:47Z", "author": {"login": "BrianPin"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,159 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.grammar.PdlSchemaParser;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import com.linkedin.pegasus.generator.GeneratorResult;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public GeneratorResult export(String resolverPath, String inputPath, File outputDir) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1e22a5bd6445d1a228bed59322c03ce5c3198c1"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDk2NTI3", "url": "https://github.com/linkedin/rest.li/pull/414#pullrequestreview-485496527", "createdAt": "2020-09-10T00:58:50Z", "commit": {"oid": "a1e22a5bd6445d1a228bed59322c03ce5c3198c1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMDo1ODo1MFrOHPfKzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMDo1ODo1MFrOHPfKzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAwMTM1Nw==", "bodyText": "Is get(0) meant to get top level schema only?\nIf say sub-level schema changed, and we just get(0), that means we dont treat sub-level schema change as change? Since the snapshot didn't change.\nBy sub-level I mean some recursive entity in the top level record's field", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486001357", "createdAt": "2020-09-10T00:58:50Z", "author": {"login": "BrianPin"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,159 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.grammar.PdlSchemaParser;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import com.linkedin.pegasus.generator.GeneratorResult;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public GeneratorResult export(String resolverPath, String inputPath, File outputDir) throws IOException {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    pegasusSchemaSnapshotResult result = new pegasusSchemaSnapshotResult();\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+     File file = writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+     result.addModifiedFile(file);\n+     result.addTargetFile(file);\n+    }\n+    return result;\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL}, true);\n+    DataSchemaResolver resolver = MultiFormatDataSchemaResolver.withBuiltinFormats(resolverPath);\n+    List<DataSchema> schemas = new ArrayList<>();\n+    while (iterator.hasNext())\n+    {\n+      File inputFile = iterator.next();\n+      PdlSchemaParser parser = new PdlSchemaParser(resolver);\n+      parser.parse(new FileInputStream(inputFile));\n+      if (parser.hasError())\n+      {\n+        throw new RuntimeException(parser.errorMessage());\n+      }\n+\n+      List<DataSchema> topLevelDataSchemas = parser.topLevelDataSchemas();\n+      if (topLevelDataSchemas == null || topLevelDataSchemas.isEmpty() || topLevelDataSchemas.size() > 1)\n+      {\n+        throw new RuntimeException(\"Could not parse extension schema : \" + inputFile.getAbsolutePath());\n+      }\n+      DataSchema topLevelDataSchema = topLevelDataSchemas.get(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1e22a5bd6445d1a228bed59322c03ce5c3198c1"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDk5Mzcw", "url": "https://github.com/linkedin/rest.li/pull/414#pullrequestreview-485499370", "createdAt": "2020-09-10T01:08:37Z", "commit": {"oid": "a1e22a5bd6445d1a228bed59322c03ce5c3198c1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1e22a5bd6445d1a228bed59322c03ce5c3198c1", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/a1e22a5bd6445d1a228bed59322c03ce5c3198c1", "committedDate": "2020-09-09T16:41:04Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "26865d7cf0830e4f5128aabac38be728bf4bec19", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/26865d7cf0830e4f5128aabac38be728bf4bec19", "committedDate": "2020-09-10T02:21:38Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26865d7cf0830e4f5128aabac38be728bf4bec19", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/26865d7cf0830e4f5128aabac38be728bf4bec19", "committedDate": "2020-09-10T02:21:38Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "731b1373a6d1012e1936daa121cd8206c58afd59", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/731b1373a6d1012e1936daa121cd8206c58afd59", "committedDate": "2020-09-10T02:23:31Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "731b1373a6d1012e1936daa121cd8206c58afd59", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/731b1373a6d1012e1936daa121cd8206c58afd59", "committedDate": "2020-09-10T02:23:31Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "7097fdb9915541dd4dca49d97e121a1325b4d064", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/7097fdb9915541dd4dca49d97e121a1325b4d064", "committedDate": "2020-09-10T02:48:42Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7097fdb9915541dd4dca49d97e121a1325b4d064", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/7097fdb9915541dd4dca49d97e121a1325b4d064", "committedDate": "2020-09-10T02:48:42Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "4fc4d7d18c9a84e49b64fc3ae74438753ec3257a", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/4fc4d7d18c9a84e49b64fc3ae74438753ec3257a", "committedDate": "2020-09-10T05:49:11Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fc4d7d18c9a84e49b64fc3ae74438753ec3257a", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/4fc4d7d18c9a84e49b64fc3ae74438753ec3257a", "committedDate": "2020-09-10T05:49:11Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "b0a4c6fb591065c399e157c910ba287fdd04d0f9", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/b0a4c6fb591065c399e157c910ba287fdd04d0f9", "committedDate": "2020-09-10T06:10:22Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b0a4c6fb591065c399e157c910ba287fdd04d0f9", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/b0a4c6fb591065c399e157c910ba287fdd04d0f9", "committedDate": "2020-09-10T06:10:22Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "74fe54efc2bd8f9085b283a892fc40d46502fca6", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/74fe54efc2bd8f9085b283a892fc40d46502fca6", "committedDate": "2020-09-10T06:29:27Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NzYxNjQ5", "url": "https://github.com/linkedin/rest.li/pull/414#pullrequestreview-485761649", "createdAt": "2020-09-10T09:42:23Z", "commit": {"oid": "74fe54efc2bd8f9085b283a892fc40d46502fca6"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwOTo0MjoyM1rOHPrpbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxMDo0OTo0OFrOHPt9CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIwNTgwNw==", "bodyText": "PEGASUS_PLUGIN_CONFIGURATION can be instead of pegasusPlugin here.\nalso, Pegasus may be removed from enablePegasusSchemaCompatibilityCheck, same for other constants", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486205807", "createdAt": "2020-09-10T09:42:23Z", "author": {"login": "aman1309"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -571,6 +573,16 @@\n \n   private static final String PEGASUS_PLUGIN_CONFIGURATION = \"pegasusPlugin\";\n \n+  // Enable the use of generic pegasus schema compatibility checker\n+  private static final String ENABLE_PEGASUS_SCHEMA_COMPATIBILITY_CHECK = \"pegasusPlugin.enablePegasusSchemaCompatibilityCheck\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74fe54efc2bd8f9085b283a892fc40d46502fca6"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIwNzc0NQ==", "bodyText": "in order to distinguish, recommend replacing pegsus with ENTITY/Data SchemaSnapshot here and same for other places", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486207745", "createdAt": "2020-09-10T09:45:29Z", "author": {"login": "aman1309"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -571,6 +573,16 @@\n \n   private static final String PEGASUS_PLUGIN_CONFIGURATION = \"pegasusPlugin\";\n \n+  // Enable the use of generic pegasus schema compatibility checker\n+  private static final String ENABLE_PEGASUS_SCHEMA_COMPATIBILITY_CHECK = \"pegasusPlugin.enablePegasusSchemaCompatibilityCheck\";\n+\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT = \"PegasusSchemaSnapshot\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74fe54efc2bd8f9085b283a892fc40d46502fca6"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIwODU2Nw==", "bodyText": "move \"src\" to constant", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486208567", "createdAt": "2020-09-10T09:46:49Z", "author": {"login": "aman1309"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -1070,6 +1089,32 @@ private static String getIdlPath(Project project, SourceSet sourceSet)\n     }\n   }\n \n+  private static String getPegasusSchemaSnapshotPath(Project project, SourceSet sourceSet)\n+  {\n+    String override = getOverridePath(project, sourceSet, \"overridePegasusSchemaSnapshotDir\");\n+    if (override == null)\n+    {\n+      return \"src\" + File.separatorChar + sourceSet.getName() + File.separatorChar + \"pegasusSchemaSnapshot\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74fe54efc2bd8f9085b283a892fc40d46502fca6"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIxODg1MQ==", "bodyText": "move \"assemble\" to constant", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486218851", "createdAt": "2020-09-10T10:04:06Z", "author": {"login": "aman1309"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -1390,6 +1435,64 @@ protected void configureRestModelGeneration(Project project, SourceSet sourceSet\n     });\n   }\n \n+  protected void configurePegasusSchemaSnapshotGeneration(Project project, SourceSet sourceSet)\n+  {\n+    File pegasusSchemaDir = project.file(getDataSchemaPath(project, sourceSet));\n+    File publishablePegasusSchemaSnapshotDir = project.file(project.getBuildDir().getAbsolutePath()\n+        + File.separatorChar + sourceSet.getName() + PEGASUS_SCHEMA_SNAPSHOT);\n+\n+    Task generatePegasusSchemaSnapshot = generatePegasusSchemaSnapshot(project, sourceSet,\n+        PEGASUS_SCHEMA_SNAPSHOT, pegasusSchemaDir, publishablePegasusSchemaSnapshotDir);\n+\n+    Task checkSchemaSnapshot = project.getTasks().create(sourceSet.getTaskName(\"check\", PEGASUS_SCHEMA_SNAPSHOT),\n+        CheckPegasusSnapshotTask.class, task ->\n+        {\n+          task.dependsOn(generatePegasusSchemaSnapshot);\n+          // TODO: update CheckPegasusSnapshotTask\n+        });\n+\n+    File pegasusSchemaSnapshotDir = new File(getPegasusSchemaSnapshotPath(project, sourceSet));\n+    pegasusSchemaSnapshotDir.mkdirs();\n+\n+    Task publishPegasusSchemaSnapshot = publishPegasusSchemaSnapshot(project, sourceSet,\n+        PEGASUS_SCHEMA_SNAPSHOT, checkSchemaSnapshot, publishablePegasusSchemaSnapshotDir,pegasusSchemaSnapshotDir);\n+\n+    project.getTasks().getByName(\"assemble\").dependsOn(publishPegasusSchemaSnapshot);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74fe54efc2bd8f9085b283a892fc40d46502fca6"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIyNDc5MQ==", "bodyText": "is log level info required? this can be debug", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486224791", "createdAt": "2020-09-10T10:14:49Z", "author": {"login": "aman1309"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -1390,6 +1435,64 @@ protected void configureRestModelGeneration(Project project, SourceSet sourceSet\n     });\n   }\n \n+  protected void configurePegasusSchemaSnapshotGeneration(Project project, SourceSet sourceSet)\n+  {\n+    File pegasusSchemaDir = project.file(getDataSchemaPath(project, sourceSet));\n+    File publishablePegasusSchemaSnapshotDir = project.file(project.getBuildDir().getAbsolutePath()\n+        + File.separatorChar + sourceSet.getName() + PEGASUS_SCHEMA_SNAPSHOT);\n+\n+    Task generatePegasusSchemaSnapshot = generatePegasusSchemaSnapshot(project, sourceSet,\n+        PEGASUS_SCHEMA_SNAPSHOT, pegasusSchemaDir, publishablePegasusSchemaSnapshotDir);\n+\n+    Task checkSchemaSnapshot = project.getTasks().create(sourceSet.getTaskName(\"check\", PEGASUS_SCHEMA_SNAPSHOT),\n+        CheckPegasusSnapshotTask.class, task ->\n+        {\n+          task.dependsOn(generatePegasusSchemaSnapshot);\n+          // TODO: update CheckPegasusSnapshotTask\n+        });\n+\n+    File pegasusSchemaSnapshotDir = new File(getPegasusSchemaSnapshotPath(project, sourceSet));\n+    pegasusSchemaSnapshotDir.mkdirs();\n+\n+    Task publishPegasusSchemaSnapshot = publishPegasusSchemaSnapshot(project, sourceSet,\n+        PEGASUS_SCHEMA_SNAPSHOT, checkSchemaSnapshot, publishablePegasusSchemaSnapshotDir,pegasusSchemaSnapshotDir);\n+\n+    project.getTasks().getByName(\"assemble\").dependsOn(publishPegasusSchemaSnapshot);\n+  }\n+\n+  protected void configurePegasusExtensionSchemaSnapshotGeneration(Project project, SourceSet sourceSet)\n+  {\n+    File publishablePegasusExtensionSchemaSnapshotDir = project.file(project.getBuildDir().getAbsolutePath()\n+        + File.separatorChar + sourceSet.getName() + PEGASUS_EXTENSION_SCHEMA_SNAPSHOT);\n+    File extensionSchemaDir = project.file(getExtensionSchemaPath(project, sourceSet));\n+\n+    if (!SharedFileUtils.getSuffixedFiles(project, extensionSchemaDir, PDL_FILE_SUFFIX).isEmpty())\n+    {\n+      Task generatePegasusExtensionSchemaSnapshot = generatePegasusSchemaSnapshot(project, sourceSet,\n+          PEGASUS_EXTENSION_SCHEMA_SNAPSHOT, extensionSchemaDir, publishablePegasusExtensionSchemaSnapshotDir);\n+\n+      File pegasusExtensionSchemaSnapshotDir = new File(getPegasusExtensionSchemaSnapshotPath(project, sourceSet));\n+      pegasusExtensionSchemaSnapshotDir.mkdirs();\n+\n+      Task checkPegasusExtensionSchemaSnapshotTask = project.getTasks().create(sourceSet.getTaskName(\"check\", PEGASUS_EXTENSION_SCHEMA_SNAPSHOT),\n+          CheckPegasusSnapshotTask.class, task ->\n+          {\n+            task.dependsOn(generatePegasusExtensionSchemaSnapshot);\n+            // TODO: update CheckPegasusSnapshotTask\n+          });\n+\n+      Task publishPegasusExtensionSchemaSnapshot = publishPegasusSchemaSnapshot(project, sourceSet, PEGASUS_EXTENSION_SCHEMA_SNAPSHOT,\n+          checkPegasusExtensionSchemaSnapshotTask, publishablePegasusExtensionSchemaSnapshotDir, pegasusExtensionSchemaSnapshotDir);\n+\n+      project.getTasks().getByName(\"assemble\").dependsOn(publishPegasusExtensionSchemaSnapshot);\n+    }\n+    else\n+    {\n+      project.getLogger().info(\"No extension schemas, skip generatePegasusExtensionSchemaSnapshot task\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74fe54efc2bd8f9085b283a892fc40d46502fca6"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIyOTk4NA==", "bodyText": "remove this", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486229984", "createdAt": "2020-09-10T10:23:57Z", "author": {"login": "aman1309"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/tasks/GeneratePegasusSnapshotTask.java", "diffHunk": "@@ -0,0 +1,168 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.pegasus.gradle.tasks;\n+\n+import com.linkedin.pegasus.gradle.PathingJarUtil;\n+import com.linkedin.pegasus.gradle.PegasusPlugin;\n+import com.linkedin.pegasus.gradle.internal.ArgumentFileGenerator;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.file.FileCollection;\n+import org.gradle.api.file.FileTree;\n+import org.gradle.api.tasks.CacheableTask;\n+import org.gradle.api.tasks.Classpath;\n+import org.gradle.api.tasks.Input;\n+import org.gradle.api.tasks.InputDirectory;\n+import org.gradle.api.tasks.OutputDirectory;\n+import org.gradle.api.tasks.PathSensitive;\n+import org.gradle.api.tasks.PathSensitivity;\n+import org.gradle.api.tasks.SkipWhenEmpty;\n+import org.gradle.api.tasks.TaskAction;\n+\n+import static com.linkedin.pegasus.gradle.SharedFileUtils.*;\n+\n+\n+/**\n+ * Generate pegasus schema's snapshot, which will be used for pegasus schema compatibility check\n+ *\n+ * To use this plugin, add these three lines to your build.gradle:\n+ * <pre>\n+ * apply plugin: 'li-pegasus'\n+ * </pre>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74fe54efc2bd8f9085b283a892fc40d46502fca6"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI0MzU5Mw==", "bodyText": "since we are supporting pdsc for extensions, would be good to add support here also.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486243593", "createdAt": "2020-09-10T10:49:48Z", "author": {"login": "aman1309"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.grammar.PdlSchemaParser;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import com.linkedin.pegasus.generator.GeneratorResult;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public GeneratorResult export(String resolverPath, String inputPath, File outputDir) throws IOException\n+  {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    pegasusSchemaSnapshotResult result = new pegasusSchemaSnapshotResult();\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+     File file = writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+     result.addModifiedFile(file);\n+     result.addTargetFile(file);\n+    }\n+    return result;\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL}, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74fe54efc2bd8f9085b283a892fc40d46502fca6"}, "originalPosition": 76}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74fe54efc2bd8f9085b283a892fc40d46502fca6", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/74fe54efc2bd8f9085b283a892fc40d46502fca6", "committedDate": "2020-09-10T06:29:27Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "08f607c88fad47affc5a21f243e7c1c60e853295", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/08f607c88fad47affc5a21f243e7c1c60e853295", "committedDate": "2020-09-10T18:53:35Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08f607c88fad47affc5a21f243e7c1c60e853295", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/08f607c88fad47affc5a21f243e7c1c60e853295", "committedDate": "2020-09-10T18:53:35Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "c2c1f5221b654597245b101851d2ff65c8ff50c5", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/c2c1f5221b654597245b101851d2ff65c8ff50c5", "committedDate": "2020-09-10T19:51:34Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c2c1f5221b654597245b101851d2ff65c8ff50c5", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/c2c1f5221b654597245b101851d2ff65c8ff50c5", "committedDate": "2020-09-10T19:51:34Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "3971dd49c2a9977f968223930b130e5df911dc66", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/3971dd49c2a9977f968223930b130e5df911dc66", "committedDate": "2020-09-10T23:03:10Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3971dd49c2a9977f968223930b130e5df911dc66", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/3971dd49c2a9977f968223930b130e5df911dc66", "committedDate": "2020-09-10T23:03:10Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/aab19c3e906c7216daf5c1aa5d51b3b049fee105", "committedDate": "2020-09-11T01:52:44Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NjAzNDQz", "url": "https://github.com/linkedin/rest.li/pull/414#pullrequestreview-486603443", "createdAt": "2020-09-11T08:40:16Z", "commit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "state": "COMMENTED", "comments": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwODo0MDoxNlrOHQT0zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwOToxNDoxNFrOHQVlYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg2NDA3OQ==", "bodyText": "Why do you need separate snapshot directories? Can't we have just one snapshot dir that contains both regular and extension schemas?", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486864079", "createdAt": "2020-09-11T08:40:16Z", "author": {"login": "karthikbalasub"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -571,6 +573,28 @@\n \n   private static final String PEGASUS_PLUGIN_CONFIGURATION = \"pegasusPlugin\";\n \n+  // Enable the use of generic pegasus schema compatibility checker\n+  private static final String ENABLE_PEGASUS_SCHEMA_COMPATIBILITY_CHECK = \"pegasusPlugin.enablePegasusSchemaCompatibilityCheck\";\n+\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT = \"PegasusSchemaSnapshot\";\n+\n+  private static final String PEGASUS_EXTENSION_SCHEMA_SNAPSHOT = \"PegasusExtensionSchemaSnapshot\";\n+\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_DIR = \"pegasusSchemaSnapshot\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg2NDM4MQ==", "bodyText": "Remove unnecessary linespacing.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486864381", "createdAt": "2020-09-11T08:40:43Z", "author": {"login": "karthikbalasub"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -571,6 +573,28 @@\n \n   private static final String PEGASUS_PLUGIN_CONFIGURATION = \"pegasusPlugin\";\n \n+  // Enable the use of generic pegasus schema compatibility checker\n+  private static final String ENABLE_PEGASUS_SCHEMA_COMPATIBILITY_CHECK = \"pegasusPlugin.enablePegasusSchemaCompatibilityCheck\";\n+\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT = \"PegasusSchemaSnapshot\";\n+\n+  private static final String PEGASUS_EXTENSION_SCHEMA_SNAPSHOT = \"PegasusExtensionSchemaSnapshot\";\n+\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_DIR = \"pegasusSchemaSnapshot\";\n+\n+  private static final String PEGASUS_EXTENSION_SCHEMA_SNAPSHOT_DIR = \"pegasusExtensionSchemaSnapshot\";\n+\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_DIR_OVERRIDE = \"overridePegasusSchemaSnapshotDir\";\n+\n+  private static final String PEGASUS_EXTENSION_SCHEMA_SNAPSHOT_DIR_OVERRIDE = \"overridePegasusExtensionSchemaSnapshotDir\";\n+\n+  private static final String ASSEMBLE = \"assemble\";\n+\n+  private static final String SRC = \"src\";\n+\n+\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg2NTgwNQ==", "bodyText": "Add a comment to explain why this is conditional on a config", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486865805", "createdAt": "2020-09-11T08:43:05Z", "author": {"login": "karthikbalasub"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -810,6 +834,13 @@ public void apply(Project project)\n       // if it can fail, fail it early\n       configureRestModelGeneration(project, sourceSet);\n \n+      if (isPropertyTrue(project, ENABLE_PEGASUS_SCHEMA_COMPATIBILITY_CHECK))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg2ODA3Ng==", "bodyText": "nit: space after ,", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486868076", "createdAt": "2020-09-11T08:46:58Z", "author": {"login": "karthikbalasub"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -1390,6 +1447,64 @@ protected void configureRestModelGeneration(Project project, SourceSet sourceSet\n     });\n   }\n \n+  protected void configurePegasusSchemaSnapshotGeneration(Project project, SourceSet sourceSet)\n+  {\n+    File pegasusSchemaDir = project.file(getDataSchemaPath(project, sourceSet));\n+    File publishablePegasusSchemaSnapshotDir = project.file(project.getBuildDir().getAbsolutePath()\n+        + File.separatorChar + sourceSet.getName() + PEGASUS_SCHEMA_SNAPSHOT);\n+\n+    Task generatePegasusSchemaSnapshot = generatePegasusSchemaSnapshot(project, sourceSet,\n+        PEGASUS_SCHEMA_SNAPSHOT, pegasusSchemaDir, publishablePegasusSchemaSnapshotDir);\n+\n+    Task checkSchemaSnapshot = project.getTasks().create(sourceSet.getTaskName(\"check\", PEGASUS_SCHEMA_SNAPSHOT),\n+        CheckPegasusSnapshotTask.class, task ->\n+        {\n+          task.dependsOn(generatePegasusSchemaSnapshot);\n+          // TODO: update CheckPegasusSnapshotTask\n+        });\n+\n+    File pegasusSchemaSnapshotDir = new File(getPegasusSchemaSnapshotPath(project, sourceSet));\n+    pegasusSchemaSnapshotDir.mkdirs();\n+\n+    Task publishPegasusSchemaSnapshot = publishPegasusSchemaSnapshot(project, sourceSet,\n+        PEGASUS_SCHEMA_SNAPSHOT, checkSchemaSnapshot, publishablePegasusSchemaSnapshotDir,pegasusSchemaSnapshotDir);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg2ODg2MA==", "bodyText": "This and the previous method seem identical except for the input/output directories. Can we de-duplicate the logic?", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486868860", "createdAt": "2020-09-11T08:48:26Z", "author": {"login": "karthikbalasub"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -1390,6 +1447,64 @@ protected void configureRestModelGeneration(Project project, SourceSet sourceSet\n     });\n   }\n \n+  protected void configurePegasusSchemaSnapshotGeneration(Project project, SourceSet sourceSet)\n+  {\n+    File pegasusSchemaDir = project.file(getDataSchemaPath(project, sourceSet));\n+    File publishablePegasusSchemaSnapshotDir = project.file(project.getBuildDir().getAbsolutePath()\n+        + File.separatorChar + sourceSet.getName() + PEGASUS_SCHEMA_SNAPSHOT);\n+\n+    Task generatePegasusSchemaSnapshot = generatePegasusSchemaSnapshot(project, sourceSet,\n+        PEGASUS_SCHEMA_SNAPSHOT, pegasusSchemaDir, publishablePegasusSchemaSnapshotDir);\n+\n+    Task checkSchemaSnapshot = project.getTasks().create(sourceSet.getTaskName(\"check\", PEGASUS_SCHEMA_SNAPSHOT),\n+        CheckPegasusSnapshotTask.class, task ->\n+        {\n+          task.dependsOn(generatePegasusSchemaSnapshot);\n+          // TODO: update CheckPegasusSnapshotTask\n+        });\n+\n+    File pegasusSchemaSnapshotDir = new File(getPegasusSchemaSnapshotPath(project, sourceSet));\n+    pegasusSchemaSnapshotDir.mkdirs();\n+\n+    Task publishPegasusSchemaSnapshot = publishPegasusSchemaSnapshot(project, sourceSet,\n+        PEGASUS_SCHEMA_SNAPSHOT, checkSchemaSnapshot, publishablePegasusSchemaSnapshotDir,pegasusSchemaSnapshotDir);\n+\n+    project.getTasks().getByName(ASSEMBLE).dependsOn(publishPegasusSchemaSnapshot);\n+  }\n+\n+  protected void configurePegasusExtensionSchemaSnapshotGeneration(Project project, SourceSet sourceSet)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg2OTU4NA==", "bodyText": "DependentTask -> dependentTask\nor call it generateSnapshotTask?", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486869584", "createdAt": "2020-09-11T08:49:45Z", "author": {"login": "karthikbalasub"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -2095,4 +2210,32 @@ private static void configureDataSchemaResourcesRoot(Project project, SourceSet\n       });\n     });\n   }\n+\n+  private Task generatePegasusSchemaSnapshot(Project project, SourceSet sourceSet, String taskName, File inputDir, File outputDir)\n+  {\n+    return project.getTasks().create(sourceSet.getTaskName(\"generate\", taskName),\n+        GeneratePegasusSnapshotTask.class, task ->\n+        {\n+          task.setInputDir(inputDir);\n+          task.setResolverPath(getDataModelConfig(project, sourceSet).plus(project.files(getDataSchemaPath(project, sourceSet))));\n+          task.setClassPath(project.getConfigurations().getByName(PEGASUS_PLUGIN_CONFIGURATION));\n+          task.setPegasusSchemaSnapshotDestinationDir(outputDir);\n+          if (isPropertyTrue(project, ENABLE_ARG_FILE))\n+          {\n+            task.setEnableArgFile(true);\n+          }\n+        });\n+  }\n+\n+  private Task publishPegasusSchemaSnapshot(Project project, SourceSet sourceSet, String taskName, Task DependentTask,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 175}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg3MDQxMw==", "bodyText": "not relevant, so remove this?", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486870413", "createdAt": "2020-09-11T08:51:15Z", "author": {"login": "karthikbalasub"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/tasks/GeneratePegasusSnapshotTask.java", "diffHunk": "@@ -0,0 +1,168 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.pegasus.gradle.tasks;\n+\n+import com.linkedin.pegasus.gradle.PathingJarUtil;\n+import com.linkedin.pegasus.gradle.PegasusPlugin;\n+import com.linkedin.pegasus.gradle.internal.ArgumentFileGenerator;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.file.FileCollection;\n+import org.gradle.api.file.FileTree;\n+import org.gradle.api.tasks.CacheableTask;\n+import org.gradle.api.tasks.Classpath;\n+import org.gradle.api.tasks.Input;\n+import org.gradle.api.tasks.InputDirectory;\n+import org.gradle.api.tasks.OutputDirectory;\n+import org.gradle.api.tasks.PathSensitive;\n+import org.gradle.api.tasks.PathSensitivity;\n+import org.gradle.api.tasks.SkipWhenEmpty;\n+import org.gradle.api.tasks.TaskAction;\n+\n+import static com.linkedin.pegasus.gradle.SharedFileUtils.*;\n+\n+\n+/**\n+ * Generate pegasus schema's snapshot, which will be used for pegasus schema compatibility check\n+ *\n+ * To use this plugin, add these three lines to your build.gradle:\n+ * <pre>\n+ * apply plugin: 'pegasus'\n+ * </pre>\n+ *", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg3MTM4NA==", "bodyText": "nit: braces on new line", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486871384", "createdAt": "2020-09-11T08:52:55Z", "author": {"login": "karthikbalasub"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/tasks/GeneratePegasusSnapshotTask.java", "diffHunk": "@@ -0,0 +1,168 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.pegasus.gradle.tasks;\n+\n+import com.linkedin.pegasus.gradle.PathingJarUtil;\n+import com.linkedin.pegasus.gradle.PegasusPlugin;\n+import com.linkedin.pegasus.gradle.internal.ArgumentFileGenerator;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.file.FileCollection;\n+import org.gradle.api.file.FileTree;\n+import org.gradle.api.tasks.CacheableTask;\n+import org.gradle.api.tasks.Classpath;\n+import org.gradle.api.tasks.Input;\n+import org.gradle.api.tasks.InputDirectory;\n+import org.gradle.api.tasks.OutputDirectory;\n+import org.gradle.api.tasks.PathSensitive;\n+import org.gradle.api.tasks.PathSensitivity;\n+import org.gradle.api.tasks.SkipWhenEmpty;\n+import org.gradle.api.tasks.TaskAction;\n+\n+import static com.linkedin.pegasus.gradle.SharedFileUtils.*;\n+\n+\n+/**\n+ * Generate pegasus schema's snapshot, which will be used for pegasus schema compatibility check\n+ *\n+ * To use this plugin, add these three lines to your build.gradle:\n+ * <pre>\n+ * apply plugin: 'pegasus'\n+ * </pre>\n+ *\n+ */\n+@CacheableTask\n+public class GeneratePegasusSnapshotTask extends DefaultTask\n+{\n+  private File _inputDir;\n+  private FileCollection _resolverPath;\n+  private File _pegasusSchemaSnapshotDestinationDir;\n+  private FileCollection _classPath;\n+  private boolean _enableArgFile;\n+\n+  @TaskAction\n+  public void generatePegasusSnapshot() throws IOException\n+  {\n+    FileTree inputDataSchemaFiles = getSuffixedFiles(getProject(), _inputDir,\n+        PegasusPlugin.DATA_TEMPLATE_FILE_SUFFIXES);\n+\n+    List<String> inputDataSchemaFilenames = StreamSupport.stream(inputDataSchemaFiles.spliterator(), false)\n+        .map(File::getPath)\n+        .collect(Collectors.toList());\n+\n+    if (inputDataSchemaFilenames.isEmpty())\n+    {\n+      getLogger().lifecycle(\"There are no Pegasus schema input files. Skip generating Pegasus schema snapshots.\");\n+      return;\n+    }\n+    getProject().getLogger().info(\"Generating Pegasus schema snapshot...\");\n+\n+    String resolverPathStr = _resolverPath.plus(getProject().files(_inputDir)).getAsPath();\n+\n+    FileCollection _pathedClasspath;\n+    try {\n+      _pathedClasspath = PathingJarUtil.generatePathingJar(getProject(), getName(),\n+          _classPath, false);\n+    }\n+    catch (IOException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg3MTUzMw==", "bodyText": "{ on next line", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486871533", "createdAt": "2020-09-11T08:53:09Z", "author": {"login": "karthikbalasub"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/tasks/GeneratePegasusSnapshotTask.java", "diffHunk": "@@ -0,0 +1,168 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.pegasus.gradle.tasks;\n+\n+import com.linkedin.pegasus.gradle.PathingJarUtil;\n+import com.linkedin.pegasus.gradle.PegasusPlugin;\n+import com.linkedin.pegasus.gradle.internal.ArgumentFileGenerator;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.file.FileCollection;\n+import org.gradle.api.file.FileTree;\n+import org.gradle.api.tasks.CacheableTask;\n+import org.gradle.api.tasks.Classpath;\n+import org.gradle.api.tasks.Input;\n+import org.gradle.api.tasks.InputDirectory;\n+import org.gradle.api.tasks.OutputDirectory;\n+import org.gradle.api.tasks.PathSensitive;\n+import org.gradle.api.tasks.PathSensitivity;\n+import org.gradle.api.tasks.SkipWhenEmpty;\n+import org.gradle.api.tasks.TaskAction;\n+\n+import static com.linkedin.pegasus.gradle.SharedFileUtils.*;\n+\n+\n+/**\n+ * Generate pegasus schema's snapshot, which will be used for pegasus schema compatibility check\n+ *\n+ * To use this plugin, add these three lines to your build.gradle:\n+ * <pre>\n+ * apply plugin: 'pegasus'\n+ * </pre>\n+ *\n+ */\n+@CacheableTask\n+public class GeneratePegasusSnapshotTask extends DefaultTask\n+{\n+  private File _inputDir;\n+  private FileCollection _resolverPath;\n+  private File _pegasusSchemaSnapshotDestinationDir;\n+  private FileCollection _classPath;\n+  private boolean _enableArgFile;\n+\n+  @TaskAction\n+  public void generatePegasusSnapshot() throws IOException\n+  {\n+    FileTree inputDataSchemaFiles = getSuffixedFiles(getProject(), _inputDir,\n+        PegasusPlugin.DATA_TEMPLATE_FILE_SUFFIXES);\n+\n+    List<String> inputDataSchemaFilenames = StreamSupport.stream(inputDataSchemaFiles.spliterator(), false)\n+        .map(File::getPath)\n+        .collect(Collectors.toList());\n+\n+    if (inputDataSchemaFilenames.isEmpty())\n+    {\n+      getLogger().lifecycle(\"There are no Pegasus schema input files. Skip generating Pegasus schema snapshots.\");\n+      return;\n+    }\n+    getProject().getLogger().info(\"Generating Pegasus schema snapshot...\");\n+\n+    String resolverPathStr = _resolverPath.plus(getProject().files(_inputDir)).getAsPath();\n+\n+    FileCollection _pathedClasspath;\n+    try {\n+      _pathedClasspath = PathingJarUtil.generatePathingJar(getProject(), getName(),\n+          _classPath, false);\n+    }\n+    catch (IOException e) {\n+      throw new GradleException(\"Error occurred generating pathing JAR.\", e);\n+    }\n+\n+    getProject().javaexec(javaExecSpec -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg3Mzk2Mw==", "bodyText": "delete extra newlines", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486873963", "createdAt": "2020-09-11T08:55:30Z", "author": {"login": "karthikbalasub"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotGenerationCmdLineApp.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.restli.internal.tools.RestLiToolsUtils;\n+import java.io.File;\n+import org.apache.commons.cli.CommandLine;\n+import org.apache.commons.cli.CommandLineParser;\n+import org.apache.commons.cli.GnuParser;\n+import org.apache.commons.cli.HelpFormatter;\n+import org.apache.commons.cli.OptionBuilder;\n+import org.apache.commons.cli.Options;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+/**\n+ * Tool that encodes pegasus schemas to pegasusSchemaSnapshot files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotGenerationCmdLineApp\n+{\n+  private static final Logger _logger = LoggerFactory.getLogger(\n+      PegasusSchemaSnapshotGenerationCmdLineApp.class);\n+\n+  private static final Options _options = new Options();\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg4MzgyNw==", "bodyText": "This task is also used for base schema snapshot and we. still support PDSC in oss. So I suggest adding PDSC support. You can keep the snapshot file format as PDL.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486883827", "createdAt": "2020-09-11T09:05:16Z", "author": {"login": "karthikbalasub"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.grammar.PdlSchemaParser;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import com.linkedin.pegasus.generator.GeneratorResult;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public GeneratorResult export(String resolverPath, String inputPath, File outputDir) throws IOException\n+  {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    pegasusSchemaSnapshotResult result = new pegasusSchemaSnapshotResult();\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+     File file = writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+     result.addModifiedFile(file);\n+     result.addTargetFile(file);\n+    }\n+    return result;\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL}, true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI0MzU5Mw=="}, "originalCommit": {"oid": "74fe54efc2bd8f9085b283a892fc40d46502fca6"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg4NTg1NQ==", "bodyText": "You can move this resolver outside the loop.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486885855", "createdAt": "2020-09-11T09:07:16Z", "author": {"login": "karthikbalasub"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.grammar.PdlSchemaParser;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import com.linkedin.pegasus.generator.GeneratorResult;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public GeneratorResult export(String resolverPath, String inputPath, File outputDir) throws IOException\n+  {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    pegasusSchemaSnapshotResult result = new pegasusSchemaSnapshotResult();\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+     File file = writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+     result.addModifiedFile(file);\n+     result.addTargetFile(file);\n+    }\n+    return result;\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL}, true);\n+    List<DataSchema> schemas = new ArrayList<>();\n+    while (iterator.hasNext())\n+    {\n+      DataSchemaResolver resolver = MultiFormatDataSchemaResolver.withBuiltinFormats(resolverPath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg4Nzk2NQ==", "bodyText": "What is the purpose of this result? Please add documentation", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486887965", "createdAt": "2020-09-11T09:09:24Z", "author": {"login": "karthikbalasub"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.grammar.PdlSchemaParser;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import com.linkedin.pegasus.generator.GeneratorResult;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public GeneratorResult export(String resolverPath, String inputPath, File outputDir) throws IOException\n+  {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    pegasusSchemaSnapshotResult result = new pegasusSchemaSnapshotResult();\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+     File file = writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+     result.addModifiedFile(file);\n+     result.addTargetFile(file);\n+    }\n+    return result;\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL}, true);\n+    List<DataSchema> schemas = new ArrayList<>();\n+    while (iterator.hasNext())\n+    {\n+      DataSchemaResolver resolver = MultiFormatDataSchemaResolver.withBuiltinFormats(resolverPath);\n+      File inputFile = iterator.next();\n+      PdlSchemaParser parser = new PdlSchemaParser(resolver);\n+      parser.parse(new FileInputStream(inputFile));\n+\n+      if (parser.hasError())\n+      {\n+        throw new RuntimeException(parser.errorMessage());\n+      }\n+\n+      List<DataSchema> topLevelDataSchemas = parser.topLevelDataSchemas();\n+      if (topLevelDataSchemas == null || topLevelDataSchemas.isEmpty() || topLevelDataSchemas.size() > 1)\n+      {\n+        throw new RuntimeException(\"Could not parse schema : \" + inputFile.getAbsolutePath());\n+      }\n+      DataSchema topLevelDataSchema = topLevelDataSchemas.get(0);\n+      if (!(topLevelDataSchema instanceof NamedDataSchema))\n+      {\n+        throw new RuntimeException(\"Invalid schema : \" + inputFile.getAbsolutePath() + \", the schema is not a named schema.\");\n+      }\n+      schemas.add(topLevelDataSchema);\n+    }\n+    return schemas;\n+  }\n+\n+  private static File writeSnapshotFile(File outputDir, String fileName, DataSchema dataSchema) throws IOException\n+  {\n+    StringWriter stringWriter = new StringWriter();\n+    SchemaToPdlEncoder schemaToPdlEncoder = new SchemaToPdlEncoder(stringWriter);\n+    schemaToPdlEncoder.setTypeReferenceFormat(AbstractSchemaEncoder.TypeReferenceFormat.DENORMALIZE);\n+    schemaToPdlEncoder.encode(dataSchema);\n+\n+    File generatedSnapshotFile = new File(outputDir, fileName + PEGASUS_SCHEMA_SNAPSHOT_SUFFIX);\n+\n+    if (generatedSnapshotFile.exists())\n+    {\n+      if (!generatedSnapshotFile.delete())\n+      {\n+        throw new IOException(generatedSnapshotFile + \": Can't delete previous version\");\n+      }\n+    }\n+\n+    try (FileOutputStream out = new FileOutputStream(generatedSnapshotFile))\n+    {\n+      out.write(stringWriter.toString().getBytes());\n+    }\n+    return generatedSnapshotFile;\n+  }\n+\n+  private static class pegasusSchemaSnapshotResult implements GeneratorResult", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 129}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5MjcyOA==", "bodyText": "nit: delete empty line", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486892728", "createdAt": "2020-09-11T09:14:04Z", "author": {"login": "karthikbalasub"}, "path": "restli-tools/src/test/java/com/linkedin/restli/tools/ExporterTestUtils.java", "diffHunk": "@@ -85,6 +85,14 @@ public static void compareFiles(String actualFileName, String expectedFileName)\n     }\n   }\n \n+  public static void comparePegasusSchemaSnapshotFiles(String actualFileName, String expectedFileName)\n+      throws IOException {\n+    String actualContent = ExporterTestUtils.readFile(actualFileName);\n+    String expectedContent = ExporterTestUtils.readFile(expectedFileName);\n+    Assert.assertEquals(actualContent, expectedContent);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5Mjg5OA==", "bodyText": "nit: brace to next line", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r486892898", "createdAt": "2020-09-11T09:14:14Z", "author": {"login": "karthikbalasub"}, "path": "restli-tools/src/test/java/com/linkedin/restli/tools/ExporterTestUtils.java", "diffHunk": "@@ -85,6 +85,14 @@ public static void compareFiles(String actualFileName, String expectedFileName)\n     }\n   }\n \n+  public static void comparePegasusSchemaSnapshotFiles(String actualFileName, String expectedFileName)\n+      throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aab19c3e906c7216daf5c1aa5d51b3b049fee105", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/aab19c3e906c7216daf5c1aa5d51b3b049fee105", "committedDate": "2020-09-11T01:52:44Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "6854dc2c7ab2aa84d52e9c79c03912cb58a3b076", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/6854dc2c7ab2aa84d52e9c79c03912cb58a3b076", "committedDate": "2020-09-11T19:12:35Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6854dc2c7ab2aa84d52e9c79c03912cb58a3b076", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/6854dc2c7ab2aa84d52e9c79c03912cb58a3b076", "committedDate": "2020-09-11T19:12:35Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/e63ac7a9091c67407ffbf4b6e91e43f01774f51f", "committedDate": "2020-09-11T19:17:26Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjE0NjQz", "url": "https://github.com/linkedin/rest.li/pull/414#pullrequestreview-487214643", "createdAt": "2020-09-12T08:25:50Z", "commit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "state": "COMMENTED", "comments": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwODoyNTo1MFrOHQzoNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwODoyNzo0MFrOHQzozg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTE0MA==", "bodyText": "This is honestly just an OCD nitpick, but lastIndexOf('.') seems like it should be a little more efficient than lastIndexOf(\".\").", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385140", "createdAt": "2020-09-12T08:25:50Z", "author": {"login": "tjni"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.AbstractSchemaParser;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.PegasusSchemaParser;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  private static final String PDSC = \"pdsc\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public void export(String resolverPath, String inputPath, File outputDir) throws IOException\n+  {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+      writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+    }\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL, PDSC}, true);\n+    List<DataSchema> schemas = new ArrayList<>();\n+    while (iterator.hasNext())\n+    {\n+      DataSchemaResolver resolver = MultiFormatDataSchemaResolver.withBuiltinFormats(resolverPath);\n+      File inputFile = iterator.next();\n+      String fileExtension = getFileExtension(inputFile.getName());\n+      PegasusSchemaParser parser = AbstractSchemaParser.parserForFileExtension(fileExtension, resolver);\n+      parser.parse(new FileInputStream(inputFile));\n+\n+      if (parser.hasError())\n+      {\n+        throw new RuntimeException(parser.errorMessage());\n+      }\n+\n+      List<DataSchema> topLevelDataSchemas = parser.topLevelDataSchemas();\n+      if (topLevelDataSchemas == null || topLevelDataSchemas.isEmpty() || topLevelDataSchemas.size() > 1)\n+      {\n+        throw new RuntimeException(\"Could not parse schema : \" + inputFile.getAbsolutePath());\n+      }\n+      DataSchema topLevelDataSchema = topLevelDataSchemas.get(0);\n+      if (!(topLevelDataSchema instanceof NamedDataSchema))\n+      {\n+        throw new RuntimeException(\"Invalid schema : \" + inputFile.getAbsolutePath() + \", the schema is not a named schema.\");\n+      }\n+      schemas.add(topLevelDataSchema);\n+    }\n+    return schemas;\n+  }\n+\n+  private static void writeSnapshotFile(File outputDir, String fileName, DataSchema dataSchema) throws IOException\n+  {\n+    StringWriter stringWriter = new StringWriter();\n+    SchemaToPdlEncoder schemaToPdlEncoder = new SchemaToPdlEncoder(stringWriter);\n+    schemaToPdlEncoder.setTypeReferenceFormat(AbstractSchemaEncoder.TypeReferenceFormat.DENORMALIZE);\n+    schemaToPdlEncoder.encode(dataSchema);\n+\n+    File generatedSnapshotFile = new File(outputDir, fileName + PEGASUS_SCHEMA_SNAPSHOT_SUFFIX);\n+\n+    if (generatedSnapshotFile.exists())\n+    {\n+      if (!generatedSnapshotFile.delete())\n+      {\n+        throw new IOException(generatedSnapshotFile + \": Can't delete previous version\");\n+      }\n+    }\n+\n+    try (FileOutputStream out = new FileOutputStream(generatedSnapshotFile))\n+    {\n+      out.write(stringWriter.toString().getBytes());\n+    }\n+  }\n+\n+  private static String getFileExtension(String fileName)\n+  {\n+    return fileName.substring(fileName.lastIndexOf(\".\") + 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTE1Mw==", "bodyText": "This can be replaced by\nFiles.write(generatedSnapshotFile.toPath(), stringWriter.toString().getBytes())\n\nAs a nitpick, call getBytes(StandardCharsets.UTF_8) so as to not rely on the default character encoding of the system.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385153", "createdAt": "2020-09-12T08:25:57Z", "author": {"login": "tjni"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.AbstractSchemaParser;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.PegasusSchemaParser;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  private static final String PDSC = \"pdsc\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public void export(String resolverPath, String inputPath, File outputDir) throws IOException\n+  {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+      writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+    }\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL, PDSC}, true);\n+    List<DataSchema> schemas = new ArrayList<>();\n+    while (iterator.hasNext())\n+    {\n+      DataSchemaResolver resolver = MultiFormatDataSchemaResolver.withBuiltinFormats(resolverPath);\n+      File inputFile = iterator.next();\n+      String fileExtension = getFileExtension(inputFile.getName());\n+      PegasusSchemaParser parser = AbstractSchemaParser.parserForFileExtension(fileExtension, resolver);\n+      parser.parse(new FileInputStream(inputFile));\n+\n+      if (parser.hasError())\n+      {\n+        throw new RuntimeException(parser.errorMessage());\n+      }\n+\n+      List<DataSchema> topLevelDataSchemas = parser.topLevelDataSchemas();\n+      if (topLevelDataSchemas == null || topLevelDataSchemas.isEmpty() || topLevelDataSchemas.size() > 1)\n+      {\n+        throw new RuntimeException(\"Could not parse schema : \" + inputFile.getAbsolutePath());\n+      }\n+      DataSchema topLevelDataSchema = topLevelDataSchemas.get(0);\n+      if (!(topLevelDataSchema instanceof NamedDataSchema))\n+      {\n+        throw new RuntimeException(\"Invalid schema : \" + inputFile.getAbsolutePath() + \", the schema is not a named schema.\");\n+      }\n+      schemas.add(topLevelDataSchema);\n+    }\n+    return schemas;\n+  }\n+\n+  private static void writeSnapshotFile(File outputDir, String fileName, DataSchema dataSchema) throws IOException\n+  {\n+    StringWriter stringWriter = new StringWriter();\n+    SchemaToPdlEncoder schemaToPdlEncoder = new SchemaToPdlEncoder(stringWriter);\n+    schemaToPdlEncoder.setTypeReferenceFormat(AbstractSchemaEncoder.TypeReferenceFormat.DENORMALIZE);\n+    schemaToPdlEncoder.encode(dataSchema);\n+\n+    File generatedSnapshotFile = new File(outputDir, fileName + PEGASUS_SCHEMA_SNAPSHOT_SUFFIX);\n+\n+    if (generatedSnapshotFile.exists())\n+    {\n+      if (!generatedSnapshotFile.delete())\n+      {\n+        throw new IOException(generatedSnapshotFile + \": Can't delete previous version\");\n+      }\n+    }\n+\n+    try (FileOutputStream out = new FileOutputStream(generatedSnapshotFile))\n+    {\n+      out.write(stringWriter.toString().getBytes());\n+    }\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTE1Nw==", "bodyText": "Nit: Must be readable and writeable.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385157", "createdAt": "2020-09-12T08:26:03Z", "author": {"login": "tjni"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotGenerationCmdLineApp.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.restli.internal.tools.RestLiToolsUtils;\n+import java.io.File;\n+import org.apache.commons.cli.CommandLine;\n+import org.apache.commons.cli.CommandLineParser;\n+import org.apache.commons.cli.GnuParser;\n+import org.apache.commons.cli.HelpFormatter;\n+import org.apache.commons.cli.OptionBuilder;\n+import org.apache.commons.cli.Options;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+/**\n+ * Tool that encodes pegasus schemas to pegasusSchemaSnapshot files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotGenerationCmdLineApp\n+{\n+  private static final Logger _logger = LoggerFactory.getLogger(\n+      PegasusSchemaSnapshotGenerationCmdLineApp.class);\n+\n+  private static final Options _options = new Options();\n+\n+  static\n+  {\n+    _options.addOption(OptionBuilder.withLongOpt(\"help\")\n+        .withDescription(\"Print help\")\n+        .create('h'));\n+  }\n+\n+  public static void main(String[] args) throws Exception\n+  {\n+    final CommandLineParser parser = new GnuParser();\n+    CommandLine cl = parser.parse(_options, args);\n+\n+    if (cl.hasOption('h'))\n+    {\n+      help();\n+      System.exit(0);\n+    }\n+\n+    String[] cliArgs = cl.getArgs();\n+    if (cliArgs.length != 3)\n+    {\n+      _logger.error(\"Invalid arguments\");\n+      help();\n+      System.exit(1);\n+    }\n+    int i = 0;\n+    String resolverPath = RestLiToolsUtils.readArgFromFileIfNeeded(cliArgs[i++]);\n+    String inputPath = cliArgs[i++];\n+    String outputPath = cliArgs[i];\n+\n+    try\n+    {\n+      File outputDir = new File(outputPath);\n+      if (!outputDir.exists())\n+      {\n+        if (!outputDir.mkdirs())\n+        {\n+          throw new RuntimeException(\"Output directory '\" + outputDir + \"' could not be created!\");\n+        }\n+      }\n+      if (!outputDir.isDirectory())\n+      {\n+        throw new RuntimeException(\"Output directory '\" + outputDir + \"' is not a directory\");\n+      }\n+      if (!outputDir.canRead() || !outputDir.canWrite())\n+      {\n+        throw new RuntimeException(\"Output directory '\" + outputDir + \"' must be writeable\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTIwMA==", "bodyText": "For clarity, consider just using 0, 1, and 2 directly instead of incrementing i.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385200", "createdAt": "2020-09-12T08:26:32Z", "author": {"login": "tjni"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotGenerationCmdLineApp.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.restli.internal.tools.RestLiToolsUtils;\n+import java.io.File;\n+import org.apache.commons.cli.CommandLine;\n+import org.apache.commons.cli.CommandLineParser;\n+import org.apache.commons.cli.GnuParser;\n+import org.apache.commons.cli.HelpFormatter;\n+import org.apache.commons.cli.OptionBuilder;\n+import org.apache.commons.cli.Options;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+/**\n+ * Tool that encodes pegasus schemas to pegasusSchemaSnapshot files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotGenerationCmdLineApp\n+{\n+  private static final Logger _logger = LoggerFactory.getLogger(\n+      PegasusSchemaSnapshotGenerationCmdLineApp.class);\n+\n+  private static final Options _options = new Options();\n+\n+  static\n+  {\n+    _options.addOption(OptionBuilder.withLongOpt(\"help\")\n+        .withDescription(\"Print help\")\n+        .create('h'));\n+  }\n+\n+  public static void main(String[] args) throws Exception\n+  {\n+    final CommandLineParser parser = new GnuParser();\n+    CommandLine cl = parser.parse(_options, args);\n+\n+    if (cl.hasOption('h'))\n+    {\n+      help();\n+      System.exit(0);\n+    }\n+\n+    String[] cliArgs = cl.getArgs();\n+    if (cliArgs.length != 3)\n+    {\n+      _logger.error(\"Invalid arguments\");\n+      help();\n+      System.exit(1);\n+    }\n+    int i = 0;\n+    String resolverPath = RestLiToolsUtils.readArgFromFileIfNeeded(cliArgs[i++]);\n+    String inputPath = cliArgs[i++];\n+    String outputPath = cliArgs[i];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTIyMg==", "bodyText": "Is this necessary, given that the way FileOutputStream is constructed later is to overwrite any existing files?", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385222", "createdAt": "2020-09-12T08:26:44Z", "author": {"login": "tjni"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.AbstractSchemaParser;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.PegasusSchemaParser;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  private static final String PDSC = \"pdsc\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public void export(String resolverPath, String inputPath, File outputDir) throws IOException\n+  {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+      writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+    }\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL, PDSC}, true);\n+    List<DataSchema> schemas = new ArrayList<>();\n+    while (iterator.hasNext())\n+    {\n+      DataSchemaResolver resolver = MultiFormatDataSchemaResolver.withBuiltinFormats(resolverPath);\n+      File inputFile = iterator.next();\n+      String fileExtension = getFileExtension(inputFile.getName());\n+      PegasusSchemaParser parser = AbstractSchemaParser.parserForFileExtension(fileExtension, resolver);\n+      parser.parse(new FileInputStream(inputFile));\n+\n+      if (parser.hasError())\n+      {\n+        throw new RuntimeException(parser.errorMessage());\n+      }\n+\n+      List<DataSchema> topLevelDataSchemas = parser.topLevelDataSchemas();\n+      if (topLevelDataSchemas == null || topLevelDataSchemas.isEmpty() || topLevelDataSchemas.size() > 1)\n+      {\n+        throw new RuntimeException(\"Could not parse schema : \" + inputFile.getAbsolutePath());\n+      }\n+      DataSchema topLevelDataSchema = topLevelDataSchemas.get(0);\n+      if (!(topLevelDataSchema instanceof NamedDataSchema))\n+      {\n+        throw new RuntimeException(\"Invalid schema : \" + inputFile.getAbsolutePath() + \", the schema is not a named schema.\");\n+      }\n+      schemas.add(topLevelDataSchema);\n+    }\n+    return schemas;\n+  }\n+\n+  private static void writeSnapshotFile(File outputDir, String fileName, DataSchema dataSchema) throws IOException\n+  {\n+    StringWriter stringWriter = new StringWriter();\n+    SchemaToPdlEncoder schemaToPdlEncoder = new SchemaToPdlEncoder(stringWriter);\n+    schemaToPdlEncoder.setTypeReferenceFormat(AbstractSchemaEncoder.TypeReferenceFormat.DENORMALIZE);\n+    schemaToPdlEncoder.encode(dataSchema);\n+\n+    File generatedSnapshotFile = new File(outputDir, fileName + PEGASUS_SCHEMA_SNAPSHOT_SUFFIX);\n+\n+    if (generatedSnapshotFile.exists())\n+    {\n+      if (!generatedSnapshotFile.delete())\n+      {\n+        throw new IOException(generatedSnapshotFile + \": Can't delete previous version\");\n+      }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTIzNQ==", "bodyText": "This can probably be a more informative error message.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385235", "createdAt": "2020-09-12T08:26:51Z", "author": {"login": "tjni"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.AbstractSchemaParser;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.PegasusSchemaParser;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  private static final String PDSC = \"pdsc\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public void export(String resolverPath, String inputPath, File outputDir) throws IOException\n+  {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+      writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+    }\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL, PDSC}, true);\n+    List<DataSchema> schemas = new ArrayList<>();\n+    while (iterator.hasNext())\n+    {\n+      DataSchemaResolver resolver = MultiFormatDataSchemaResolver.withBuiltinFormats(resolverPath);\n+      File inputFile = iterator.next();\n+      String fileExtension = getFileExtension(inputFile.getName());\n+      PegasusSchemaParser parser = AbstractSchemaParser.parserForFileExtension(fileExtension, resolver);\n+      parser.parse(new FileInputStream(inputFile));\n+\n+      if (parser.hasError())\n+      {\n+        throw new RuntimeException(parser.errorMessage());\n+      }\n+\n+      List<DataSchema> topLevelDataSchemas = parser.topLevelDataSchemas();\n+      if (topLevelDataSchemas == null || topLevelDataSchemas.isEmpty() || topLevelDataSchemas.size() > 1)\n+      {\n+        throw new RuntimeException(\"Could not parse schema : \" + inputFile.getAbsolutePath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTIzNg==", "bodyText": "Nit: It looks like topLevelDataSchemas() never returns null, so the condition can be simplified to topLevelDataSchemas.size() != 1.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385236", "createdAt": "2020-09-12T08:26:53Z", "author": {"login": "tjni"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.AbstractSchemaParser;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.PegasusSchemaParser;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  private static final String PDSC = \"pdsc\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public void export(String resolverPath, String inputPath, File outputDir) throws IOException\n+  {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+      writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+    }\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL, PDSC}, true);\n+    List<DataSchema> schemas = new ArrayList<>();\n+    while (iterator.hasNext())\n+    {\n+      DataSchemaResolver resolver = MultiFormatDataSchemaResolver.withBuiltinFormats(resolverPath);\n+      File inputFile = iterator.next();\n+      String fileExtension = getFileExtension(inputFile.getName());\n+      PegasusSchemaParser parser = AbstractSchemaParser.parserForFileExtension(fileExtension, resolver);\n+      parser.parse(new FileInputStream(inputFile));\n+\n+      if (parser.hasError())\n+      {\n+        throw new RuntimeException(parser.errorMessage());\n+      }\n+\n+      List<DataSchema> topLevelDataSchemas = parser.topLevelDataSchemas();\n+      if (topLevelDataSchemas == null || topLevelDataSchemas.isEmpty() || topLevelDataSchemas.size() > 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTIzOA==", "bodyText": "Can you double check if the parser's error message includes the name of the file? (If it does not, let's either update the parser to include it or include it here.)", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385238", "createdAt": "2020-09-12T08:26:57Z", "author": {"login": "tjni"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.AbstractSchemaParser;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.PegasusSchemaParser;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  private static final String PDSC = \"pdsc\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public void export(String resolverPath, String inputPath, File outputDir) throws IOException\n+  {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+      writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+    }\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL, PDSC}, true);\n+    List<DataSchema> schemas = new ArrayList<>();\n+    while (iterator.hasNext())\n+    {\n+      DataSchemaResolver resolver = MultiFormatDataSchemaResolver.withBuiltinFormats(resolverPath);\n+      File inputFile = iterator.next();\n+      String fileExtension = getFileExtension(inputFile.getName());\n+      PegasusSchemaParser parser = AbstractSchemaParser.parserForFileExtension(fileExtension, resolver);\n+      parser.parse(new FileInputStream(inputFile));\n+\n+      if (parser.hasError())\n+      {\n+        throw new RuntimeException(parser.errorMessage());\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTI0Mg==", "bodyText": "Consider implementing this using streams natively, something like:\ntry (Stream<Path> paths = Files.walk(...))\n{\n  return paths\n      .filter(/* files that end in PDL or PDSC */)\n      .map(/* convert to DataSchema */)\n      .collect(Collectors.toList());\n}", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385242", "createdAt": "2020-09-12T08:27:02Z", "author": {"login": "tjni"}, "path": "restli-tools/src/main/java/com/linkedin/restli/tools/snapshot/gen/PegasusSchemaSnapshotExporter.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.restli.tools.snapshot.gen;\n+\n+import com.linkedin.data.schema.AbstractSchemaEncoder;\n+import com.linkedin.data.schema.AbstractSchemaParser;\n+import com.linkedin.data.schema.DataSchema;\n+import com.linkedin.data.schema.DataSchemaResolver;\n+import com.linkedin.data.schema.NamedDataSchema;\n+import com.linkedin.data.schema.PegasusSchemaParser;\n+import com.linkedin.data.schema.SchemaToPdlEncoder;\n+import com.linkedin.data.schema.resolver.MultiFormatDataSchemaResolver;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.StringWriter;\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import org.apache.commons.io.FileUtils;\n+\n+\n+/**\n+ * PegasusSchemaSnapshotExporter, generating pegasus schema snapshot(.pdl) files\n+ *\n+ * @author Yingjie Bi\n+ */\n+public class PegasusSchemaSnapshotExporter\n+{\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_SUFFIX = \".pdl\";\n+\n+  private static final String PDL = \"pdl\";\n+\n+  private static final String PDSC = \"pdsc\";\n+\n+  /**\n+   * Generate pegasus schema snapshot(pegasusSchemaSnapshot.pdl) files to the provided output directory\n+   * based on the given input pegasus schemas.\n+   *\n+   * @param resolverPath schema resolver path\n+   * @param inputPath input files directory\n+   * @param outputDir output files directory\n+   * @return GeneratorResult\n+   * @throws IOException\n+   */\n+  public void export(String resolverPath, String inputPath, File outputDir) throws IOException\n+  {\n+    List<DataSchema> dataSchemas = parseDataSchema(resolverPath, inputPath);\n+    for (DataSchema dataSchema : dataSchemas)\n+    {\n+      writeSnapshotFile(outputDir, ((NamedDataSchema) dataSchema).getFullName(), dataSchema);\n+    }\n+  }\n+\n+  private static List<DataSchema> parseDataSchema(String resolverPath, String inputPath)\n+      throws RuntimeException, FileNotFoundException\n+  {\n+    Iterator<File> iterator = FileUtils.iterateFiles(new File(inputPath), new String[]{PDL, PDSC}, true);\n+    List<DataSchema> schemas = new ArrayList<>();\n+    while (iterator.hasNext())\n+    {\n+      DataSchemaResolver resolver = MultiFormatDataSchemaResolver.withBuiltinFormats(resolverPath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTI1OA==", "bodyText": "Instead of using the project's logger, we can use the task's logger as you do above.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385258", "createdAt": "2020-09-12T08:27:10Z", "author": {"login": "tjni"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/tasks/GeneratePegasusSnapshotTask.java", "diffHunk": "@@ -0,0 +1,167 @@\n+/*\n+   Copyright (c) 2020 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package com.linkedin.pegasus.gradle.tasks;\n+\n+import com.linkedin.pegasus.gradle.PathingJarUtil;\n+import com.linkedin.pegasus.gradle.PegasusPlugin;\n+import com.linkedin.pegasus.gradle.internal.ArgumentFileGenerator;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import java.util.stream.StreamSupport;\n+import org.gradle.api.DefaultTask;\n+import org.gradle.api.GradleException;\n+import org.gradle.api.file.FileCollection;\n+import org.gradle.api.file.FileTree;\n+import org.gradle.api.tasks.CacheableTask;\n+import org.gradle.api.tasks.Classpath;\n+import org.gradle.api.tasks.Input;\n+import org.gradle.api.tasks.InputDirectory;\n+import org.gradle.api.tasks.OutputDirectory;\n+import org.gradle.api.tasks.PathSensitive;\n+import org.gradle.api.tasks.PathSensitivity;\n+import org.gradle.api.tasks.SkipWhenEmpty;\n+import org.gradle.api.tasks.TaskAction;\n+\n+import static com.linkedin.pegasus.gradle.SharedFileUtils.*;\n+\n+\n+/**\n+ * Generate pegasus schema's snapshot, which will be used for pegasus schema compatibility check\n+ *\n+ * @author Yingjie Bi\n+ */\n+@CacheableTask\n+public class GeneratePegasusSnapshotTask extends DefaultTask\n+{\n+  private File _inputDir;\n+  private FileCollection _resolverPath;\n+  private File _pegasusSchemaSnapshotDestinationDir;\n+  private FileCollection _classPath;\n+  private boolean _enableArgFile;\n+\n+  @TaskAction\n+  public void generatePegasusSnapshot() throws IOException\n+  {\n+    FileTree inputDataSchemaFiles = getSuffixedFiles(getProject(), _inputDir,\n+        PegasusPlugin.DATA_TEMPLATE_FILE_SUFFIXES);\n+\n+    List<String> inputDataSchemaFilenames = StreamSupport.stream(inputDataSchemaFiles.spliterator(), false)\n+        .map(File::getPath)\n+        .collect(Collectors.toList());\n+\n+    if (inputDataSchemaFilenames.isEmpty())\n+    {\n+      getLogger().lifecycle(\"There are no Pegasus schema input files. Skip generating Pegasus schema snapshots.\");\n+      return;\n+    }\n+    getProject().getLogger().info(\"Generating Pegasus schema snapshot...\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTI2MA==", "bodyText": "Consider whether the Sync task is better, since it also deletes anything that has been removed.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385260", "createdAt": "2020-09-12T08:27:17Z", "author": {"login": "tjni"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -2095,4 +2184,32 @@ private static void configureDataSchemaResourcesRoot(Project project, SourceSet\n       });\n     });\n   }\n+\n+  private Task generatePegasusSchemaSnapshot(Project project, SourceSet sourceSet, String taskName, File inputDir, File outputDir)\n+  {\n+    return project.getTasks().create(sourceSet.getTaskName(\"generate\", taskName),\n+        GeneratePegasusSnapshotTask.class, task ->\n+        {\n+          task.setInputDir(inputDir);\n+          task.setResolverPath(getDataModelConfig(project, sourceSet).plus(project.files(getDataSchemaPath(project, sourceSet))));\n+          task.setClassPath(project.getConfigurations().getByName(PEGASUS_PLUGIN_CONFIGURATION));\n+          task.setPegasusSchemaSnapshotDestinationDir(outputDir);\n+          if (isPropertyTrue(project, ENABLE_ARG_FILE))\n+          {\n+            task.setEnableArgFile(true);\n+          }\n+        });\n+  }\n+\n+  private Task publishPegasusSchemaSnapshot(Project project, SourceSet sourceSet, String taskName, Task checkPegasusSnapshotTast,\n+      File inputDir, File outputDir)\n+  {\n+    return project.getTasks().create(sourceSet.getTaskName(\"publish\", taskName),\n+        Copy.class, task ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 153}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTI2Mw==", "bodyText": "checkPegasusSnapshotTast => checkPegasusSnapshotTask", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385263", "createdAt": "2020-09-12T08:27:18Z", "author": {"login": "tjni"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -2095,4 +2184,32 @@ private static void configureDataSchemaResourcesRoot(Project project, SourceSet\n       });\n     });\n   }\n+\n+  private Task generatePegasusSchemaSnapshot(Project project, SourceSet sourceSet, String taskName, File inputDir, File outputDir)\n+  {\n+    return project.getTasks().create(sourceSet.getTaskName(\"generate\", taskName),\n+        GeneratePegasusSnapshotTask.class, task ->\n+        {\n+          task.setInputDir(inputDir);\n+          task.setResolverPath(getDataModelConfig(project, sourceSet).plus(project.files(getDataSchemaPath(project, sourceSet))));\n+          task.setClassPath(project.getConfigurations().getByName(PEGASUS_PLUGIN_CONFIGURATION));\n+          task.setPegasusSchemaSnapshotDestinationDir(outputDir);\n+          if (isPropertyTrue(project, ENABLE_ARG_FILE))\n+          {\n+            task.setEnableArgFile(true);\n+          }\n+        });\n+  }\n+\n+  private Task publishPegasusSchemaSnapshot(Project project, SourceSet sourceSet, String taskName, Task checkPegasusSnapshotTast,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTI3Mg==", "bodyText": "In general, if support for Gradle 4 can be dropped, consider starting to use task configuration avoidance. This involves using TaskContainer#register instead of TaskContainer#create, for example, and this line would become:\nproject.getTasks().named(ASSEMBLE,\n    assembleTask -> assembleTask.dependsOn(publishPegasusSchemaSnapshot));\n\nFeel free also to postpone that until a later time too, as it's not a completely trivial change.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385272", "createdAt": "2020-09-12T08:27:22Z", "author": {"login": "tjni"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -1390,6 +1445,40 @@ protected void configureRestModelGeneration(Project project, SourceSet sourceSet\n     });\n   }\n \n+  protected void configurePegasusSchemaSnapshotGeneration(Project project, SourceSet sourceSet, boolean isExtensionSchema)\n+  {\n+    File schemaDir = isExtensionSchema? project.file(getExtensionSchemaPath(project, sourceSet))\n+        : project.file(getDataSchemaPath(project, sourceSet));\n+    if (isExtensionSchema && !SharedFileUtils.getSuffixedFiles(project, schemaDir, PDL_FILE_SUFFIX).isEmpty())\n+    {\n+      project.getLogger().debug(\"No extension schemas, skip generatePegasusExtensionSchemaSnapshot task\");\n+      return;\n+    }\n+    File publishablePegasusSchemaSnapshotDir = project.file(project.getBuildDir().getAbsolutePath()\n+        + File.separatorChar + sourceSet.getName() + (isExtensionSchema ? PEGASUS_EXTENSION_SCHEMA_SNAPSHOT: PEGASUS_SCHEMA_SNAPSHOT));\n+\n+    Task generatePegasusSchemaSnapshot = generatePegasusSchemaSnapshot(project, sourceSet,\n+        isExtensionSchema ? PEGASUS_EXTENSION_SCHEMA_SNAPSHOT: PEGASUS_SCHEMA_SNAPSHOT, schemaDir, publishablePegasusSchemaSnapshotDir);\n+\n+    Task checkSchemaSnapshot = project.getTasks().create(sourceSet.getTaskName(\"check\",\n+        isExtensionSchema ? PEGASUS_EXTENSION_SCHEMA_SNAPSHOT: PEGASUS_SCHEMA_SNAPSHOT),\n+        CheckPegasusSnapshotTask.class, task ->\n+        {\n+          task.dependsOn(generatePegasusSchemaSnapshot);\n+          // TODO: update CheckPegasusSnapshotTask\n+        });\n+\n+    File pegasusSchemaSnapshotDir = new File(isExtensionSchema ? getPegasusExtensionSchemaSnapshotPath(project, sourceSet)\n+        : getPegasusSchemaSnapshotPath(project, sourceSet));\n+    pegasusSchemaSnapshotDir.mkdirs();\n+\n+    Task publishPegasusSchemaSnapshot = publishPegasusSchemaSnapshot(project, sourceSet,\n+        isExtensionSchema ? PEGASUS_EXTENSION_SCHEMA_SNAPSHOT: PEGASUS_SCHEMA_SNAPSHOT, checkSchemaSnapshot,\n+        publishablePegasusSchemaSnapshotDir, pegasusSchemaSnapshotDir);\n+\n+    project.getTasks().getByName(ASSEMBLE).dependsOn(publishPegasusSchemaSnapshot);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTI3NQ==", "bodyText": "The into method on the Copy task (and the Sync task) configures the destination directory property of the task, which is annotated with @OutputDirectory. This means that Gradle will create the directory for us if it is missing, and this call to mkdirs() can be removed.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385275", "createdAt": "2020-09-12T08:27:27Z", "author": {"login": "tjni"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -1390,6 +1445,40 @@ protected void configureRestModelGeneration(Project project, SourceSet sourceSet\n     });\n   }\n \n+  protected void configurePegasusSchemaSnapshotGeneration(Project project, SourceSet sourceSet, boolean isExtensionSchema)\n+  {\n+    File schemaDir = isExtensionSchema? project.file(getExtensionSchemaPath(project, sourceSet))\n+        : project.file(getDataSchemaPath(project, sourceSet));\n+    if (isExtensionSchema && !SharedFileUtils.getSuffixedFiles(project, schemaDir, PDL_FILE_SUFFIX).isEmpty())\n+    {\n+      project.getLogger().debug(\"No extension schemas, skip generatePegasusExtensionSchemaSnapshot task\");\n+      return;\n+    }\n+    File publishablePegasusSchemaSnapshotDir = project.file(project.getBuildDir().getAbsolutePath()\n+        + File.separatorChar + sourceSet.getName() + (isExtensionSchema ? PEGASUS_EXTENSION_SCHEMA_SNAPSHOT: PEGASUS_SCHEMA_SNAPSHOT));\n+\n+    Task generatePegasusSchemaSnapshot = generatePegasusSchemaSnapshot(project, sourceSet,\n+        isExtensionSchema ? PEGASUS_EXTENSION_SCHEMA_SNAPSHOT: PEGASUS_SCHEMA_SNAPSHOT, schemaDir, publishablePegasusSchemaSnapshotDir);\n+\n+    Task checkSchemaSnapshot = project.getTasks().create(sourceSet.getTaskName(\"check\",\n+        isExtensionSchema ? PEGASUS_EXTENSION_SCHEMA_SNAPSHOT: PEGASUS_SCHEMA_SNAPSHOT),\n+        CheckPegasusSnapshotTask.class, task ->\n+        {\n+          task.dependsOn(generatePegasusSchemaSnapshot);\n+          // TODO: update CheckPegasusSnapshotTask\n+        });\n+\n+    File pegasusSchemaSnapshotDir = new File(isExtensionSchema ? getPegasusExtensionSchemaSnapshotPath(project, sourceSet)\n+        : getPegasusSchemaSnapshotPath(project, sourceSet));\n+    pegasusSchemaSnapshotDir.mkdirs();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTI3OQ==", "bodyText": "It shouldn't be necessary to build a String and pass it through Project#file. I would recommend using java.nio.file.Path whenever possible, since it allows you to write:\nproject.getBuildDir().toPath().resolve(sourceSet.getName() + ...)\n\nGradle task properties can be Path instead of File as well, and it is also possible to convert from a Path to a File using Path#toFile.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385279", "createdAt": "2020-09-12T08:27:31Z", "author": {"login": "tjni"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -1390,6 +1445,40 @@ protected void configureRestModelGeneration(Project project, SourceSet sourceSet\n     });\n   }\n \n+  protected void configurePegasusSchemaSnapshotGeneration(Project project, SourceSet sourceSet, boolean isExtensionSchema)\n+  {\n+    File schemaDir = isExtensionSchema? project.file(getExtensionSchemaPath(project, sourceSet))\n+        : project.file(getDataSchemaPath(project, sourceSet));\n+    if (isExtensionSchema && !SharedFileUtils.getSuffixedFiles(project, schemaDir, PDL_FILE_SUFFIX).isEmpty())\n+    {\n+      project.getLogger().debug(\"No extension schemas, skip generatePegasusExtensionSchemaSnapshot task\");\n+      return;\n+    }\n+    File publishablePegasusSchemaSnapshotDir = project.file(project.getBuildDir().getAbsolutePath()\n+        + File.separatorChar + sourceSet.getName() + (isExtensionSchema ? PEGASUS_EXTENSION_SCHEMA_SNAPSHOT: PEGASUS_SCHEMA_SNAPSHOT));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTI4Mg==", "bodyText": "At first glance, it's not obvious to me why this check only applies to the extension task.\nSeparately, there is a way to describe this behavior more declaratively that you can consider. Your implementation is pretty close to it already.\nIf you create a FileTree that includes only PDL files, it can be passed to tasks that require them through a task property of type Iterable<File> (or a subclass, such as FileTree itself) and annotated with @InputFiles. Furthermore, the property can be annotated with @SkipWhenEmpty, which will cause Gradle to skip the task if no input files were found.\nThe benefit of this approach is that the task will always exist, so a script that runs, for instance, ./gradlew generatePegasusExtensionSchemaSnapshot won't fail when no PDL files are found.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385282", "createdAt": "2020-09-12T08:27:35Z", "author": {"login": "tjni"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -1390,6 +1445,40 @@ protected void configureRestModelGeneration(Project project, SourceSet sourceSet\n     });\n   }\n \n+  protected void configurePegasusSchemaSnapshotGeneration(Project project, SourceSet sourceSet, boolean isExtensionSchema)\n+  {\n+    File schemaDir = isExtensionSchema? project.file(getExtensionSchemaPath(project, sourceSet))\n+        : project.file(getDataSchemaPath(project, sourceSet));\n+    if (isExtensionSchema && !SharedFileUtils.getSuffixedFiles(project, schemaDir, PDL_FILE_SUFFIX).isEmpty())\n+    {\n+      project.getLogger().debug(\"No extension schemas, skip generatePegasusExtensionSchemaSnapshot task\");\n+      return;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM4NTI5NA==", "bodyText": "Consider using LifecycleBasePlugin.ASSEMBLE_TASK_NAME constant.", "url": "https://github.com/linkedin/rest.li/pull/414#discussion_r487385294", "createdAt": "2020-09-12T08:27:40Z", "author": {"login": "tjni"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/PegasusPlugin.java", "diffHunk": "@@ -571,6 +573,25 @@\n \n   private static final String PEGASUS_PLUGIN_CONFIGURATION = \"pegasusPlugin\";\n \n+  // Enable the use of generic pegasus schema compatibility checker\n+  private static final String ENABLE_PEGASUS_SCHEMA_COMPATIBILITY_CHECK = \"pegasusPlugin.enablePegasusSchemaCompatibilityCheck\";\n+\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT = \"PegasusSchemaSnapshot\";\n+\n+  private static final String PEGASUS_EXTENSION_SCHEMA_SNAPSHOT = \"PegasusExtensionSchemaSnapshot\";\n+\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_DIR = \"pegasusSchemaSnapshot\";\n+\n+  private static final String PEGASUS_EXTENSION_SCHEMA_SNAPSHOT_DIR = \"pegasusExtensionSchemaSnapshot\";\n+\n+  private static final String PEGASUS_SCHEMA_SNAPSHOT_DIR_OVERRIDE = \"overridePegasusSchemaSnapshotDir\";\n+\n+  private static final String PEGASUS_EXTENSION_SCHEMA_SNAPSHOT_DIR_OVERRIDE = \"overridePegasusExtensionSchemaSnapshotDir\";\n+\n+  private static final String ASSEMBLE = \"assemble\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f907dfbb0192c514f6c294d215a36fe7d1b8b91a", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/f907dfbb0192c514f6c294d215a36fe7d1b8b91a", "committedDate": "2020-09-12T21:46:34Z", "message": "Add generatePegasusSchemeSnapshot task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e63ac7a9091c67407ffbf4b6e91e43f01774f51f", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/e63ac7a9091c67407ffbf4b6e91e43f01774f51f", "committedDate": "2020-09-11T19:17:26Z", "message": "Add generatePegasusSchemeSnapshot task"}, "afterCommit": {"oid": "f907dfbb0192c514f6c294d215a36fe7d1b8b91a", "author": {"user": {"login": "nickibi", "name": "Yingjie Bi"}}, "url": "https://github.com/linkedin/rest.li/commit/f907dfbb0192c514f6c294d215a36fe7d1b8b91a", "committedDate": "2020-09-12T21:46:34Z", "message": "Add generatePegasusSchemeSnapshot task"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4662, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}