{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NTY4NjQ3", "number": 293, "title": "Creating a light-weight representation of InJarFileDataSchemaLocation", "bodyText": "When parsing schemas, the AbstractDataSchemaResolver stores bad schema locations in an instance variable. If the DataSchemaLocation is a InJarFileDataSchemaLocation, that means we are storing the entire jar in the _badLocations set, and not allowing it to be garbage collected.\nWe have seen this cause undue memory pressure / OOMs when resolving Schemas.\nThis introduces a light-weight representation of InJarFileDataSchemaLocation, by just storing the path to the jar and the path once inside the jar. This fulfills the equals and hashCode requirements of DataSchemaLocation without the overhead of the entire jar.\nDiscovered by analyzing a heap dump using jxray:", "createdAt": "2020-05-13T19:34:10Z", "url": "https://github.com/linkedin/rest.li/pull/293", "merged": true, "mergeCommit": {"oid": "9ecc77d7ddbfe93625a0d715a397439c0b76d0ca"}, "closed": true, "closedAt": "2020-05-19T00:27:46Z", "author": {"login": "logancarmody"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg_i6sgFqTQxMTMwMTkxNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcio__IABqjMzNDk1NDEyNTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMzAxOTE2", "url": "https://github.com/linkedin/rest.li/pull/293#pullrequestreview-411301916", "createdAt": "2020-05-13T21:10:33Z", "commit": {"oid": "b4e6aad81e8104463ba836273b371de5500a32e7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMToxMDozM1rOGVDpRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMToxMDozM1rOGVDpRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczMjk5OQ==", "bodyText": "This would break the functionality when a location is checked agains known bad locations.\nIn that case InJarFileDataSchemaLocation will be checked and it would not match JarFileDataSchemaLocation", "url": "https://github.com/linkedin/rest.li/pull/293#discussion_r424732999", "createdAt": "2020-05-13T21:10:33Z", "author": {"login": "karthikbalasub"}, "path": "data/src/main/java/com/linkedin/data/schema/resolver/JarFileDataSchemaLocation.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+   Copyright (c) 2012 LinkedIn Corp.\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+\n+package com.linkedin.data.schema.resolver;\n+\n+import com.linkedin.data.schema.DataSchemaLocation;\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.zip.ZipEntry;\n+\n+\n+/**\n+ * Represents the location of a DataSchema file in a Jar.\n+ * Similar to {@link InJarFileDataSchemaLocation}, but it does not contain the jar file itself\n+ */\n+public class JarFileDataSchemaLocation implements DataSchemaLocation {\n+  private final String _jarFileName;\n+  private final String _pathInJar;\n+\n+  public JarFileDataSchemaLocation(String jarFileName, String pathInJar)\n+  {\n+    _jarFileName = jarFileName;\n+    _pathInJar = pathInJar;\n+  }\n+\n+  @Override\n+  public boolean equals(Object o)\n+  {\n+    if (this == o)\n+      return true;\n+    if (o instanceof JarFileDataSchemaLocation == false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4e6aad81e8104463ba836273b371de5500a32e7"}, "originalPosition": 45}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b4e6aad81e8104463ba836273b371de5500a32e7", "author": {"user": {"login": "logancarmody", "name": "Logan Carmody"}}, "url": "https://github.com/linkedin/rest.li/commit/b4e6aad81e8104463ba836273b371de5500a32e7", "committedDate": "2020-05-13T19:26:55Z", "message": "Creating a light-weight representation of InJarFileDataSchemaLocation for storing in _badLocations"}, "afterCommit": {"oid": "912579c3e1f1d06616cd20be73081c5935451ac3", "author": {"user": {"login": "logancarmody", "name": "Logan Carmody"}}, "url": "https://github.com/linkedin/rest.li/commit/912579c3e1f1d06616cd20be73081c5935451ac3", "committedDate": "2020-05-13T23:20:36Z", "message": "Creating a light-weight representation of InJarFileDataSchemaLocation for storing in _badLocations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNDgyMDUy", "url": "https://github.com/linkedin/rest.li/pull/293#pullrequestreview-411482052", "createdAt": "2020-05-14T05:51:01Z", "commit": {"oid": "912579c3e1f1d06616cd20be73081c5935451ac3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "912579c3e1f1d06616cd20be73081c5935451ac3", "author": {"user": {"login": "logancarmody", "name": "Logan Carmody"}}, "url": "https://github.com/linkedin/rest.li/commit/912579c3e1f1d06616cd20be73081c5935451ac3", "committedDate": "2020-05-13T23:20:36Z", "message": "Creating a light-weight representation of InJarFileDataSchemaLocation for storing in _badLocations"}, "afterCommit": {"oid": "b490bf5ff96d1bde0291939901d65d956819b9ef", "author": {"user": {"login": "logancarmody", "name": "Logan Carmody"}}, "url": "https://github.com/linkedin/rest.li/commit/b490bf5ff96d1bde0291939901d65d956819b9ef", "committedDate": "2020-05-18T17:20:58Z", "message": "Creating a light-weight representation of InJarFileDataSchemaLocation for storing in _badLocations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b490bf5ff96d1bde0291939901d65d956819b9ef", "author": {"user": {"login": "logancarmody", "name": "Logan Carmody"}}, "url": "https://github.com/linkedin/rest.li/commit/b490bf5ff96d1bde0291939901d65d956819b9ef", "committedDate": "2020-05-18T17:20:58Z", "message": "Creating a light-weight representation of InJarFileDataSchemaLocation for storing in _badLocations"}, "afterCommit": {"oid": "4bbb997259d345d1c55d394f748f547ea1158789", "author": {"user": {"login": "logancarmody", "name": "Logan Carmody"}}, "url": "https://github.com/linkedin/rest.li/commit/4bbb997259d345d1c55d394f748f547ea1158789", "committedDate": "2020-05-18T18:32:10Z", "message": "Creating a light-weight representation of InJarFileDataSchemaLocation for storing in _badLocations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4bbb997259d345d1c55d394f748f547ea1158789", "author": {"user": {"login": "logancarmody", "name": "Logan Carmody"}}, "url": "https://github.com/linkedin/rest.li/commit/4bbb997259d345d1c55d394f748f547ea1158789", "committedDate": "2020-05-18T18:32:10Z", "message": "Creating a light-weight representation of InJarFileDataSchemaLocation for storing in _badLocations"}, "afterCommit": {"oid": "fbbb8d13e93055c5537bc6e851a8568a8a486c1e", "author": {"user": {"login": "logancarmody", "name": "Logan Carmody"}}, "url": "https://github.com/linkedin/rest.li/commit/fbbb8d13e93055c5537bc6e851a8568a8a486c1e", "committedDate": "2020-05-18T19:06:42Z", "message": "Creating a light-weight representation of InJarFileDataSchemaLocation for storing in _badLocations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzODczOTgy", "url": "https://github.com/linkedin/rest.li/pull/293#pullrequestreview-413873982", "createdAt": "2020-05-18T19:20:11Z", "commit": {"oid": "fbbb8d13e93055c5537bc6e851a8568a8a486c1e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTA4MzA1", "url": "https://github.com/linkedin/rest.li/pull/293#pullrequestreview-413908305", "createdAt": "2020-05-18T20:15:00Z", "commit": {"oid": "fbbb8d13e93055c5537bc6e851a8568a8a486c1e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37c812e4e777d9cf95c9c08e8127f83b47adbe77", "author": {"user": {"login": "logancarmody", "name": "Logan Carmody"}}, "url": "https://github.com/linkedin/rest.li/commit/37c812e4e777d9cf95c9c08e8127f83b47adbe77", "committedDate": "2020-05-19T00:05:26Z", "message": "Creating a light-weight representation of InJarFileDataSchemaLocation for storing in _badLocations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fbbb8d13e93055c5537bc6e851a8568a8a486c1e", "author": {"user": {"login": "logancarmody", "name": "Logan Carmody"}}, "url": "https://github.com/linkedin/rest.li/commit/fbbb8d13e93055c5537bc6e851a8568a8a486c1e", "committedDate": "2020-05-18T19:06:42Z", "message": "Creating a light-weight representation of InJarFileDataSchemaLocation for storing in _badLocations"}, "afterCommit": {"oid": "37c812e4e777d9cf95c9c08e8127f83b47adbe77", "author": {"user": {"login": "logancarmody", "name": "Logan Carmody"}}, "url": "https://github.com/linkedin/rest.li/commit/37c812e4e777d9cf95c9c08e8127f83b47adbe77", "committedDate": "2020-05-19T00:05:26Z", "message": "Creating a light-weight representation of InJarFileDataSchemaLocation for storing in _badLocations"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4784, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}