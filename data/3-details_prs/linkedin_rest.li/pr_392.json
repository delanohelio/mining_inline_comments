{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMjAyMjI5", "number": 392, "title": "Adding ability to let users determine if a request should be dispatched to dark clusters", "bodyText": "@davidhoa PR for adding a DarkDispatcherVerifier", "createdAt": "2020-08-20T19:39:28Z", "url": "https://github.com/linkedin/rest.li/pull/392", "merged": true, "mergeCommit": {"oid": "c0dae93f90d8d4b0188d88a202623ee0e9fe0b43"}, "closed": true, "closedAt": "2020-08-20T20:46:37Z", "author": {"login": "srikrish-19"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6GX_8AH2gAyNDcxMjAyMjI5OjFlZjQxMmYzYzExNDAwYzM1MjlkNzQ0YTI4OWVhZjQ1MGEyZGE1MTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdA141egFqTQ3MTk0NjUyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1ef412f3c11400c3529d744a289eaf450a2da519", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/1ef412f3c11400c3529d744a289eaf450a2da519", "committedDate": "2020-07-30T21:19:20Z", "message": "[darkcluster] Adding identical traffic multiplier strategy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee09c898fb75b9cfb3e7e2a0e061b69fc222465c", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/ee09c898fb75b9cfb3e7e2a0e061b69fc222465c", "committedDate": "2020-07-31T01:32:25Z", "message": "[darkcluster] Adding identical traffic multiplier strategy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fe84dba85315eebaa989fd306766499e86911d1", "author": {"user": {"login": "junchuanwang", "name": "Junchuan Wang"}}, "url": "https://github.com/linkedin/rest.li/commit/0fe84dba85315eebaa989fd306766499e86911d1", "committedDate": "2020-08-04T17:21:10Z", "message": "Add gradle property to skip generateRestModel task (#362)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9916eab00528bf26af5e84c660b59c69eca91c97", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/9916eab00528bf26af5e84c660b59c69eca91c97", "committedDate": "2020-08-04T17:23:08Z", "message": "Implement support for always projecting fields by name. (#358)\n\n* Release 29.4.7"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f3559a3f61d657a5e0c43e9b16d92f8729a1816", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/3f3559a3f61d657a5e0c43e9b16d92f8729a1816", "committedDate": "2020-08-04T17:24:19Z", "message": "[darkcluster] Adding identical traffic multiplier strategy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "090f1a9d810a3830c080454a3e0679aafa9618a6", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/090f1a9d810a3830c080454a3e0679aafa9618a6", "committedDate": "2020-08-04T17:24:20Z", "message": "[darkcluster] Adding identical traffic multiplier strategy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "901639b8d7689081f4b846fad4cca3b1169b49aa", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/901639b8d7689081f4b846fad4cca3b1169b49aa", "committedDate": "2020-08-04T17:30:13Z", "message": "Merge remote-tracking branch 'upstream/master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac220fac4a770d80a82262d068694eb9de03ea0e", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/ac220fac4a770d80a82262d068694eb9de03ea0e", "committedDate": "2020-08-04T17:38:42Z", "message": "Merge remote-tracking branch 'upstream/master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40b11c3f232affd887d9a0d569d0b8c7f776703b", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/40b11c3f232affd887d9a0d569d0b8c7f776703b", "committedDate": "2020-08-04T17:44:04Z", "message": "Merge branch 'master' of github.com:srikrish-19/rest.li into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e48e44c9f91bad387d4015710168692110fd25b", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/4e48e44c9f91bad387d4015710168692110fd25b", "committedDate": "2020-08-04T18:17:29Z", "message": "Merge branch 'master' of github.com:srikrish-19/rest.li into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cc3957d0d6d8100cdb4c57d9a3a4c5ea8fe8e79", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/9cc3957d0d6d8100cdb4c57d9a3a4c5ea8fe8e79", "committedDate": "2020-08-04T18:17:39Z", "message": "darkcluster - identical traffic multiplier: Adding the formula for avg # of dark requests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "478fa28e9a7acdc45c314e26fd751d614aad0eab", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/478fa28e9a7acdc45c314e26fd751d614aad0eab", "committedDate": "2020-08-04T18:18:37Z", "message": "Merge branch 'master' of github.com:srikrish-19/rest.li into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d60568b5a6d391cdf1fcec170de90951e8eaf263", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/d60568b5a6d391cdf1fcec170de90951e8eaf263", "committedDate": "2020-08-04T21:30:20Z", "message": "updating changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96a843e233e6479da2b7d9ac3d5ee628f7027b9a", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/96a843e233e6479da2b7d9ac3d5ee628f7027b9a", "committedDate": "2020-08-07T18:41:09Z", "message": "Merge remote-tracking branch 'upstream/master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23ab8d1e639966f926fc42ec138c872a4590ba44", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/23ab8d1e639966f926fc42ec138c872a4590ba44", "committedDate": "2020-08-20T17:59:59Z", "message": "Merge remote-tracking branch 'upstream/master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe25d7edd334e783f377a260353c9fd8884dc05c", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/fe25d7edd334e783f377a260353c9fd8884dc05c", "committedDate": "2020-08-20T19:20:01Z", "message": "Adding ability to let users determine if a request should be dispatched to dark clusters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e8a0fb518c32a56354ff100cf9e01345ceb64ae", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/7e8a0fb518c32a56354ff100cf9e01345ceb64ae", "committedDate": "2020-08-20T19:29:36Z", "message": "adding some documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d9d91cc81cfba7ade08afa8d42ad2992abde6ca", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/3d9d91cc81cfba7ade08afa8d42ad2992abde6ca", "committedDate": "2020-08-20T19:34:29Z", "message": "Updating changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b862a5d635bf16266893973d68cdfa4fb8308960", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/b862a5d635bf16266893973d68cdfa4fb8308960", "committedDate": "2020-08-20T19:36:32Z", "message": "moving interface to api package"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTMxNjY1", "url": "https://github.com/linkedin/rest.li/pull/392#pullrequestreview-471931665", "createdAt": "2020-08-20T19:41:38Z", "commit": {"oid": "b862a5d635bf16266893973d68cdfa4fb8308960"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxOTo0MTozOFrOHEQuVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxOTo0NTozOFrOHEQ2pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIzMDM1Nw==", "bodyText": "this name can be confused with the other Verifier ... and you can't tell what's what when configuring config properties. What about DarkCustomGatekeeper? DarkGatekeeper?", "url": "https://github.com/linkedin/rest.li/pull/392#discussion_r474230357", "createdAt": "2020-08-20T19:41:38Z", "author": {"login": "davidhoa"}, "path": "darkcluster/src/main/java/com/linkedin/darkcluster/api/DarkDispatcherVerifier.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package com.linkedin.darkcluster.api;\n+\n+import com.linkedin.r2.message.RequestContext;\n+import com.linkedin.r2.message.rest.RestRequest;\n+\n+\n+/**\n+ * Interface that lets users define custom logic to determine if a given request is to be dispatched to dark cluster or not.\n+ */\n+@FunctionalInterface\n+public interface DarkDispatcherVerifier", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b862a5d635bf16266893973d68cdfa4fb8308960"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIzMjQ4Ng==", "bodyText": "lets  create a no op implementation and do the null check here, instead of on every request.", "url": "https://github.com/linkedin/rest.li/pull/392#discussion_r474232486", "createdAt": "2020-08-20T19:45:38Z", "author": {"login": "davidhoa"}, "path": "darkcluster/src/main/java/com/linkedin/darkcluster/impl/DarkClusterManagerImpl.java", "diffHunk": "@@ -54,19 +54,27 @@\n   private final Facilities _facilities;\n   private final String _sourceClusterName;\n   private final DarkClusterStrategyFactory _darkClusterStrategyFactory;\n+  private final DarkDispatcherVerifier _darkDispatcherVerifier;\n   private Map<String, AtomicReference<URIRewriter>> _uriRewriterMap;\n \n   public DarkClusterManagerImpl(@Nonnull String sourceClusterName, @Nonnull Facilities facilities,\n                                 @Nonnull DarkClusterStrategyFactory strategyFactory, String whiteListRegEx,\n                                 String blackListRegEx, @Nonnull Notifier notifier)\n   {\n+    this(sourceClusterName, facilities, strategyFactory, whiteListRegEx, blackListRegEx, notifier, null);\n+  }\n+\n+  public DarkClusterManagerImpl(@Nonnull String sourceClusterName, @Nonnull Facilities facilities,\n+      @Nonnull DarkClusterStrategyFactory strategyFactory, String whiteListRegEx,\n+      String blackListRegEx, @Nonnull Notifier notifier, DarkDispatcherVerifier darkDispatcherVerifier) {\n     _whiteListRegEx = whiteListRegEx == null ? null : Pattern.compile(whiteListRegEx);\n     _blackListRegEx = blackListRegEx == null ? null : Pattern.compile(blackListRegEx);\n     _notifier = notifier;\n     _facilities = facilities;\n     _sourceClusterName = sourceClusterName;\n     _darkClusterStrategyFactory = strategyFactory;\n     _uriRewriterMap = new HashMap<>();\n+    _darkDispatcherVerifier = darkDispatcherVerifier;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b862a5d635bf16266893973d68cdfa4fb8308960"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2979ef6238f5884a2054c272984b79687aba790", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/e2979ef6238f5884a2054c272984b79687aba790", "committedDate": "2020-08-20T19:53:10Z", "message": "Fixing dhoa's comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTQwNDY5", "url": "https://github.com/linkedin/rest.li/pull/392#pullrequestreview-471940469", "createdAt": "2020-08-20T19:55:20Z", "commit": {"oid": "e2979ef6238f5884a2054c272984b79687aba790"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4957ee5bd9d84c12557f6f4dffa42c9541efca3e", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/4957ee5bd9d84c12557f6f4dffa42c9541efca3e", "committedDate": "2020-08-20T20:01:31Z", "message": "Fixing changelog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTQ1NzE0", "url": "https://github.com/linkedin/rest.li/pull/392#pullrequestreview-471945714", "createdAt": "2020-08-20T20:03:03Z", "commit": {"oid": "4957ee5bd9d84c12557f6f4dffa42c9541efca3e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTQ2NTIy", "url": "https://github.com/linkedin/rest.li/pull/392#pullrequestreview-471946522", "createdAt": "2020-08-20T20:04:17Z", "commit": {"oid": "4957ee5bd9d84c12557f6f4dffa42c9541efca3e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4632, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}