{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyMDcyMjgy", "number": 465, "title": "Support symbolTable requests with suffixes", "bodyText": "We have a client who adds suffix to the request path.\nGiven an application named foo and a resource with bar\n@RestLiCollection(name = \"bar\", namespace = \"com.foo\")\n\nthey want to support a d2 URL such as\nd2://foo?action=...\n\nthe resolved url becomes\nsome-host.com/foo/bar?action=...\n\nWhen we enable protobuf for them, the RestLiSymbolTableRequestHandler sees\nsome-host.com/foo/bar/symbolTable\nsome-host.com/foo/bar/symbolTable/<tableName>\n\nIn this PR, we are adding support to check the last 2 arguments given a path.\nTo prevent naming collision and backwards compatibility, we are guarding the\nlogic behind a header", "createdAt": "2020-10-29T07:16:50Z", "url": "https://github.com/linkedin/rest.li/pull/465", "merged": true, "mergeCommit": {"oid": "9a51aa02a9280b92eff3f7e95231a3c8558244fd"}, "closed": true, "closedAt": "2020-11-09T23:21:48Z", "author": {"login": "sangm"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXM4nyABqjM5MzQ4MTI3NzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABda7IJlABqjM5NzU3NTI2OTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2ff1ad80921d027d606ed0383b31f0fded5f02b0", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/2ff1ad80921d027d606ed0383b31f0fded5f02b0", "committedDate": "2020-10-29T06:58:11Z", "message": "Support symbolTable requests with suffixes\n\nWe have a client who adds suffix to the request path.\n\nGiven an applicaiton named `foo` and a resource with `bar`\n\n```\n@RestLiCollection(name = \"bar\", namespace = \"com.foo\")\n```\n\nthey want to support a d2 URL such as\n\n```\nd2://bar?action=...\n```\n\nthe resolved url becomes\n\n```\nsome-host.com/foo/bar?action=...\n```\n\nWhen we enable protobuf for them, the `RestLiSymbolTableRequestHandler` sees\n\n```\nsome-host.com/foo/bar/symbolTable\nsome-host.com/foo/bar/symbolTable/<tableName>\n```\n\nIn this PR, we are adding support to check the last 2 arguments given a path so\nwe can support the above case.\n\nTo prevent naming collision and backwards compatibility, we are guarding the\nlogic behind a header"}, "afterCommit": {"oid": "cc262b6977a6699d30e8e001b2352faf0f54a45a", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/cc262b6977a6699d30e8e001b2352faf0f54a45a", "committedDate": "2020-10-29T07:18:02Z", "message": "Support symbolTable requests with suffixes\n\nWe have a client who adds suffix to the request path.\n\nGiven an applicaiton named `foo` and a resource with `bar`\n\n```\n@RestLiCollection(name = \"bar\", namespace = \"com.foo\")\n```\n\nthey want to support a d2 URL such as\n\n```\nd2://bar?action=...\n```\n\nthe resolved url becomes\n\n```\nsome-host.com/foo/bar?action=...\n```\n\nWhen we enable protobuf for them, the `RestLiSymbolTableRequestHandler` sees\n\n```\nsome-host.com/foo/bar/symbolTable\nsome-host.com/foo/bar/symbolTable/<tableName>\n```\n\nIn this PR, we are adding support to check the last 2 arguments given a path so\nwe can support the above case.\n\nTo prevent naming collision and backwards compatibility, we are guarding the\nlogic behind a header"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5OTE1MTE3", "url": "https://github.com/linkedin/rest.li/pull/465#pullrequestreview-519915117", "createdAt": "2020-10-29T17:35:13Z", "commit": {"oid": "ebc7525107c7b916f10b827dcf0195ec3c5f8726"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzozNToxNFrOHqnJWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNzozNToxNFrOHqnJWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ0MzYxMA==", "bodyText": "I don't like the idea of adding another header for this. It will complicate the exchange protocol further. Is there some other way we can do this? Like say check routing to see if a resource with that name exists or not?\nOr even better add a rule to disallow a rest.li resource from being named symbolTable.\n@kbalasub wdyt?", "url": "https://github.com/linkedin/rest.li/pull/465#discussion_r514443610", "createdAt": "2020-10-29T17:35:14Z", "author": {"login": "karthikrg"}, "path": "restli-server/src/main/java/com/linkedin/restli/server/symbol/RestLiSymbolTableRequestHandler.java", "diffHunk": "@@ -95,13 +97,22 @@ public boolean shouldHandle(Request request)\n     // is in the form of /symbolTable or /symbolTable/<TABLENAME>\n     //\n     boolean isServiceScopedPath = request.getHeaders().containsKey(RestConstants.HEADER_SERVICE_SCOPED_PATH);\n+    boolean isSymbolTableHeaderPresent = request.getHeaders().containsKey(SYMBOL_TABLE_REQUEST_HEADER);\n+    int pathSize = pathSegments.size();\n     if (isServiceScopedPath)\n     {\n-      return (pathSegments.size() == 3 && pathSegments.get(2).getPath().equals(SYMBOL_TABLE_URI_PATH));\n+      return (pathSize == 3 && pathSegments.get(2).getPath().equals(SYMBOL_TABLE_URI_PATH));\n+    }\n+    else if (isSymbolTableHeaderPresent)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebc7525107c7b916f10b827dcf0195ec3c5f8726"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzODg3ODU2", "url": "https://github.com/linkedin/rest.li/pull/465#pullrequestreview-523887856", "createdAt": "2020-11-05T02:45:56Z", "commit": {"oid": "8dff5d07225021e827d2dc7abf5672f5eb543a08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8dff5d07225021e827d2dc7abf5672f5eb543a08", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/8dff5d07225021e827d2dc7abf5672f5eb543a08", "committedDate": "2020-11-04T00:14:01Z", "message": "cleaning up spaces"}, "afterCommit": {"oid": "28fbbefccfd0480d7c5707d3ff7984601261cfe1", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/28fbbefccfd0480d7c5707d3ff7984601261cfe1", "committedDate": "2020-11-05T06:00:05Z", "message": "Support symbolTable requests with suffixes (#465)\n\nRefactor `RestLiSymbolTableRequestHandler`/`RestLiSymbolTableProvider` to handle\nURLs with additional suffixes. Before this change we expected the string\n`symbolTable` to be present in a specific location in the URL. After this\nchange, we check the last 2 paths."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28fbbefccfd0480d7c5707d3ff7984601261cfe1", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/28fbbefccfd0480d7c5707d3ff7984601261cfe1", "committedDate": "2020-11-05T06:00:05Z", "message": "Support symbolTable requests with suffixes (#465)\n\nRefactor `RestLiSymbolTableRequestHandler`/`RestLiSymbolTableProvider` to handle\nURLs with additional suffixes. Before this change we expected the string\n`symbolTable` to be present in a specific location in the URL. After this\nchange, we check the last 2 paths."}, "afterCommit": {"oid": "4344c1131dae6e2a32249593c64153a4450182a5", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/4344c1131dae6e2a32249593c64153a4450182a5", "committedDate": "2020-11-05T06:06:02Z", "message": "Support symbolTable requests with suffixes (#465)\n\nRefactor `RestLiSymbolTableRequestHandler`/`RestLiSymbolTableProvider` to handle\nURLs with additional suffixes. Before this change we expected the string\n`symbolTable` to be present in a specific location in the URL. After this\nchange, we check the last 2 paths."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4344c1131dae6e2a32249593c64153a4450182a5", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/4344c1131dae6e2a32249593c64153a4450182a5", "committedDate": "2020-11-05T06:06:02Z", "message": "Support symbolTable requests with suffixes (#465)\n\nRefactor `RestLiSymbolTableRequestHandler`/`RestLiSymbolTableProvider` to handle\nURLs with additional suffixes. Before this change we expected the string\n`symbolTable` to be present in a specific location in the URL. After this\nchange, we check the last 2 paths."}, "afterCommit": {"oid": "7c4e6a171e7dc3bccf5e5201cae5f5e90b8ba2da", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/7c4e6a171e7dc3bccf5e5201cae5f5e90b8ba2da", "committedDate": "2020-11-05T06:06:38Z", "message": "Support symbolTable requests with suffixes (#465)\n\nRefactor `RestLiSymbolTableRequestHandler`/`RestLiSymbolTableProvider` to handle\nURLs with additional suffixes. Before this change we expected the string\n`symbolTable` to be present in a specific location in the URL. After this\nchange, we check the last 2 paths."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2b59e19d7e845f0047c7640344be97960bcd6bf", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/e2b59e19d7e845f0047c7640344be97960bcd6bf", "committedDate": "2020-11-09T20:52:20Z", "message": "Support symbolTable requests with suffixes (#465)\n\nRefactor `RestLiSymbolTableRequestHandler`/`RestLiSymbolTableProvider` to handle\nURLs with additional suffixes. Before this change we expected the string\n`symbolTable` to be present in a specific location in the URL. After this\nchange, we check the last 2 paths."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c4e6a171e7dc3bccf5e5201cae5f5e90b8ba2da", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/7c4e6a171e7dc3bccf5e5201cae5f5e90b8ba2da", "committedDate": "2020-11-05T06:06:38Z", "message": "Support symbolTable requests with suffixes (#465)\n\nRefactor `RestLiSymbolTableRequestHandler`/`RestLiSymbolTableProvider` to handle\nURLs with additional suffixes. Before this change we expected the string\n`symbolTable` to be present in a specific location in the URL. After this\nchange, we check the last 2 paths."}, "afterCommit": {"oid": "e2b59e19d7e845f0047c7640344be97960bcd6bf", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/e2b59e19d7e845f0047c7640344be97960bcd6bf", "committedDate": "2020-11-09T20:52:20Z", "message": "Support symbolTable requests with suffixes (#465)\n\nRefactor `RestLiSymbolTableRequestHandler`/`RestLiSymbolTableProvider` to handle\nURLs with additional suffixes. Before this change we expected the string\n`symbolTable` to be present in a specific location in the URL. After this\nchange, we check the last 2 paths."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4730, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}