{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MjE0Njc2", "number": 395, "title": "Fix an issue where NullPointerException is raised when excluded hosts hint is not set at retry", "bodyText": "", "createdAt": "2020-08-26T22:01:31Z", "url": "https://github.com/linkedin/rest.li/pull/395", "merged": true, "mergeCommit": {"oid": "dd5e4c464ffbf755cc5a9df70363265df6af11e2"}, "closed": true, "closedAt": "2020-08-28T20:53:18Z", "author": {"login": "rickzx"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCzE1DgH2gAyNDc0MjE0Njc2OjFiMzFkOGFiZmUzODQ1NGZjYmVhODgzNWM3YTIxNjIyMTViNWYwYjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDaA2UAH2gAyNDc0MjE0Njc2OmU4M2IzMTNlZWYyZmVkYTUxZjVkOGI4YzZkMjg0NjU4YjU2NDkyZWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1b31d8abfe38454fcbea8835c7a2162215b5f0b9", "author": {"user": {"login": "rickzx", "name": "Rick Zhou"}}, "url": "https://github.com/linkedin/rest.li/commit/1b31d8abfe38454fcbea8835c7a2162215b5f0b9", "committedDate": "2020-08-26T21:55:31Z", "message": "NullPointerException is thrown when excluded hosts hint is not set at retry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MTM3NDY1", "url": "https://github.com/linkedin/rest.li/pull/395#pullrequestreview-476137465", "createdAt": "2020-08-26T23:45:18Z", "commit": {"oid": "1b31d8abfe38454fcbea8835c7a2162215b5f0b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMzo0NToxOFrOHHkTkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQyMzo0NToxOFrOHHkTkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzY5NjkxNQ==", "bodyText": "How about \"Excluded hosts hint for retry is not set or is empty. This failed request will not be retried.\" ?", "url": "https://github.com/linkedin/rest.li/pull/395#discussion_r477696915", "createdAt": "2020-08-26T23:45:18Z", "author": {"login": "nizarm"}, "path": "d2/src/main/java/com/linkedin/d2/balancer/clients/RetryClient.java", "diffHunk": "@@ -225,16 +225,23 @@ public void onError(Throwable e)\n         if (targetHostUri == null)\n         {\n           Set<URI> exclusionSet = ExcludedHostHints.getRequestContextExcludedHosts(_context);\n-          int attempts = exclusionSet.size();\n-          if (attempts <= _limit)\n+          if (exclusionSet == null || exclusionSet.isEmpty())\n           {\n-            LOG.warn(\"A retriable exception happens. Going to retry. This is attempt {}. Current exclusion set: \",\n-                attempts, \". Current exclusion set: \" + exclusionSet);\n-            retry = doRetryRequest(_request, _context);\n+            LOG.warn(\"Excluded hosts hint for retry is not set or is empty. This request will fail.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b31d8abfe38454fcbea8835c7a2162215b5f0b9"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4f05b92c6edc42ae0ac55c50e8c1fb2ecb5c0be", "author": {"user": {"login": "rickzx", "name": "Rick Zhou"}}, "url": "https://github.com/linkedin/rest.li/commit/b4f05b92c6edc42ae0ac55c50e8c1fb2ecb5c0be", "committedDate": "2020-08-27T00:34:42Z", "message": "Change the log warning message when exclude host hints is not set"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MjQwMTQ3", "url": "https://github.com/linkedin/rest.li/pull/395#pullrequestreview-476240147", "createdAt": "2020-08-27T00:44:46Z", "commit": {"oid": "b4f05b92c6edc42ae0ac55c50e8c1fb2ecb5c0be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "479f73cc86c1ca846ee991b66617a96613685454", "author": {"user": {"login": "rickzx", "name": "Rick Zhou"}}, "url": "https://github.com/linkedin/rest.li/commit/479f73cc86c1ca846ee991b66617a96613685454", "committedDate": "2020-08-27T18:55:07Z", "message": "Merge branch 'master' into bugfix/retry_client_NPE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21590e54e1c1cff5c15e0c9041c2ba7670e66241", "author": {"user": {"login": "rickzx", "name": "Rick Zhou"}}, "url": "https://github.com/linkedin/rest.li/commit/21590e54e1c1cff5c15e0c9041c2ba7670e66241", "committedDate": "2020-08-28T17:54:16Z", "message": "Merge branch 'master' into bugfix/retry_client_NPE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e83b313eef2feda51f5d8b8c6d284658b56492ec", "author": {"user": {"login": "rickzx", "name": "Rick Zhou"}}, "url": "https://github.com/linkedin/rest.li/commit/e83b313eef2feda51f5d8b8c6d284658b56492ec", "committedDate": "2020-08-28T19:17:28Z", "message": "Update changelog"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4634, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}