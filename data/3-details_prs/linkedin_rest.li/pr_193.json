{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNTI0MzMx", "number": 193, "title": "Use pathspec object as hash map key in ResolvedPropertiesReaderVisitor", "bodyText": "Currently ResolvedPropertiesReaderVisitor Use PathSpec-generated string as key in hash map, it uses up a lot of memory.\nThis change is an optimization to use the PathSpec object in the hasp so it will reduce memory footprint.", "createdAt": "2020-02-26T21:48:55Z", "url": "https://github.com/linkedin/rest.li/pull/193", "merged": true, "mergeCommit": {"oid": "2b1ed43296b8d755fab15d934e3350be1c4e6869"}, "closed": true, "closedAt": "2020-02-28T01:45:42Z", "author": {"login": "junchuanwang"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcINswuAH2gAyMzgwNTI0MzMxOjE5MWU4MzRjYTQ4MWU1NGIzYWYxZmM0OGRjODEzMjAxYWRlYzIxNGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIltbZgH2gAyMzgwNTI0MzMxOmNmZWVhZDMxM2JiZWNmMzUwMzIzM2YxYWY2YTQyMzg4NzAzNGE1ODk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "191e834ca481e54b3af1fc48dc813201adec214e", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/191e834ca481e54b3af1fc48dc813201adec214e", "committedDate": "2020-02-26T21:35:08Z", "message": "For annotation processor's ResolvedPropertiesReaderVisitor, use pathSpect object as key of hashmap, instead of using string as key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53b5ba4b920b412e7cc0656f49dffc8b2a76b517", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/53b5ba4b920b412e7cc0656f49dffc8b2a76b517", "committedDate": "2020-02-26T21:36:00Z", "message": "fake commit 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MjgxNTg1", "url": "https://github.com/linkedin/rest.li/pull/193#pullrequestreview-365281585", "createdAt": "2020-02-26T22:11:04Z", "commit": {"oid": "53b5ba4b920b412e7cc0656f49dffc8b2a76b517"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoxMTowNFrOFu-OnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoxNTowOFrOFu-WEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5ODM2NQ==", "bodyText": "Just use Collection", "url": "https://github.com/linkedin/rest.li/pull/193#discussion_r384798365", "createdAt": "2020-02-26T22:11:04Z", "author": {"login": "karthikbalasub"}, "path": "data/src/main/java/com/linkedin/data/schema/PathSpec.java", "diffHunk": "@@ -84,6 +86,17 @@ public PathSpec(String... segments)\n     _path = new ArrayList<String>(Arrays.asList(segments));\n   }\n \n+  /**\n+   * Construct a new {@link PathSpec} from {@link AbstractCollection} type\n+   *\n+   * @param pathSpecCollection the collection that contains path segments.\n+   */\n+  public PathSpec(AbstractCollection<String> pathSpecCollection)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53b5ba4b920b412e7cc0656f49dffc8b2a76b517"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5OTA3MQ==", "bodyText": "initialize size using Collection::size()", "url": "https://github.com/linkedin/rest.li/pull/193#discussion_r384799071", "createdAt": "2020-02-26T22:12:32Z", "author": {"login": "karthikbalasub"}, "path": "data/src/main/java/com/linkedin/data/schema/PathSpec.java", "diffHunk": "@@ -84,6 +86,17 @@ public PathSpec(String... segments)\n     _path = new ArrayList<String>(Arrays.asList(segments));\n   }\n \n+  /**\n+   * Construct a new {@link PathSpec} from {@link AbstractCollection} type\n+   *\n+   * @param pathSpecCollection the collection that contains path segments.\n+   */\n+  public PathSpec(AbstractCollection<String> pathSpecCollection)\n+  {\n+    _path = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53b5ba4b920b412e7cc0656f49dffc8b2a76b517"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwMDI3Mw==", "bodyText": "Why is it okay to skip?", "url": "https://github.com/linkedin/rest.li/pull/193#discussion_r384800273", "createdAt": "2020-02-26T22:15:08Z", "author": {"login": "karthikbalasub"}, "path": "gradle-plugins/src/main/java/com/linkedin/pegasus/gradle/tasks/ValidateSchemaAnnotationTask.java", "diffHunk": "@@ -198,10 +198,16 @@ private void checkHandlerAnnotation(String name, List<String> foundClasses) thro\n             return;\n           }\n         }\n-      } catch (ClassNotFoundException e)\n+      }\n+      catch (ClassNotFoundException e)\n       {\n         throw new IOException(\"Failed to load class while scanning classes\", e);\n       }\n+      catch (Exception | Error e)\n+      {\n+        getProject().getLogger()\n+                    .info(\"Unexpected exceptions or errors found during scanning class, ok to skip\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53b5ba4b920b412e7cc0656f49dffc8b2a76b517"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "138c0bc457a4c4f4c96a0bea738d19a61a2fffb8", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/138c0bc457a4c4f4c96a0bea738d19a61a2fffb8", "committedDate": "2020-02-26T22:19:21Z", "message": "Revert \"fake commit 2\"\n\nThis reverts commit 53b5ba4b920b412e7cc0656f49dffc8b2a76b517."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0e6f33edd1742ddcc2a3c6bfd46803ef646dd2e", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/a0e6f33edd1742ddcc2a3c6bfd46803ef646dd2e", "committedDate": "2020-02-26T22:20:50Z", "message": "address Karthik's comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1Mjg4ODI4", "url": "https://github.com/linkedin/rest.li/pull/193#pullrequestreview-365288828", "createdAt": "2020-02-26T22:23:44Z", "commit": {"oid": "138c0bc457a4c4f4c96a0bea738d19a61a2fffb8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyMzo0NFrOFu-l0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMjoyMzo0NFrOFu-l0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgwNDMwNg==", "bodyText": "Only change in test?", "url": "https://github.com/linkedin/rest.li/pull/193#discussion_r384804306", "createdAt": "2020-02-26T22:23:44Z", "author": {"login": "mchen07"}, "path": "data/src/test/java/com/linkedin/data/schema/annotation/TestSchemaAnnotationProcessor.java", "diffHunk": "@@ -344,7 +345,7 @@ public void testDenormalizedSchemaProcessing(String filePath, List<List<String>>\n     ResolvedPropertiesReaderVisitor resolvedPropertiesReaderVisitor = new ResolvedPropertiesReaderVisitor();\n     DataSchemaRichContextTraverser traverser = new DataSchemaRichContextTraverser(resolvedPropertiesReaderVisitor);\n     traverser.traverse(result.getResultSchema());\n-    Map<String, Map<String, Object>> pathSpecToResolvedPropertiesMap = resolvedPropertiesReaderVisitor.getLeafFieldsPathSpecToResolvedPropertiesMap();\n+    Map<PathSpec, Map<String, Object>> pathSpecToResolvedPropertiesMap = resolvedPropertiesReaderVisitor.getLeafFieldsPathSpecToResolvedPropertiesMap();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "138c0bc457a4c4f4c96a0bea738d19a61a2fffb8"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eb74670319ea49c3071e73f0371168f7adc7693", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/3eb74670319ea49c3071e73f0371168f7adc7693", "committedDate": "2020-02-27T00:38:11Z", "message": "add ResolvedPropertiesReaderVisitor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MzYzODA0", "url": "https://github.com/linkedin/rest.li/pull/193#pullrequestreview-365363804", "createdAt": "2020-02-27T01:39:28Z", "commit": {"oid": "3eb74670319ea49c3071e73f0371168f7adc7693"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3371afcbc35cdd85e376ac0e583c035b023a3df7", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/3371afcbc35cdd85e376ac0e583c035b023a3df7", "committedDate": "2020-02-28T01:22:41Z", "message": "change to avoid major version bump"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MTExMzEz", "url": "https://github.com/linkedin/rest.li/pull/193#pullrequestreview-366111313", "createdAt": "2020-02-28T01:29:31Z", "commit": {"oid": "3371afcbc35cdd85e376ac0e583c035b023a3df7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMToyOTozMVrOFvm33A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwMToyOTozMVrOFvm33A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQ2NDI4NA==", "bodyText": "I understand that you need to rename the method to avoid conflicts, but this is very wordy. I'd suggest cutting it down. How about getLeafFieldToResolvedPropertiesMap? You don't need to say \"pathSpec\" because it's implied based on the return type.", "url": "https://github.com/linkedin/rest.li/pull/193#discussion_r385464284", "createdAt": "2020-02-28T01:29:31Z", "author": {"login": "evanw555"}, "path": "data/src/main/java/com/linkedin/data/schema/annotation/ResolvedPropertiesReaderVisitor.java", "diffHunk": "@@ -122,8 +122,26 @@ public void callbackOnContext(DataSchemaRichContextTraverser.TraverserContext co\n     return null;\n   }\n \n-  public Map<PathSpec, Map<String, Object>> getLeafFieldsPathSpecToResolvedPropertiesMap()\n+  /**\n+   * This method is deprecated and should not be used due to performance consideration, because this method will generate string and use that as map keys,\n+   * and it is not necessarily memory-efficient.\n+   *\n+   * User should use {@link #getLeafFieldsPathSpecObjToResolvedPropertiesMap}, which use PathSpec object as map key.\n+   * @return a map with {@link PathSpec} string points to leaf field as map key and the resolved properties as its value\n+   *\n+   */\n+  @Deprecated\n+  public Map<String, Map<String, Object>> getLeafFieldsPathSpecToResolvedPropertiesMap()\n   {\n-    return _leafFieldsPathSpecToResolvedPropertiesMap;\n+    return _leafFieldsPathSpecObjToResolvedPropertiesMap.entrySet()\n+                                                        .stream()\n+                                                        .collect(Collectors.toMap(e -> e.getKey().toString(),\n+                                                                                  Map.Entry::getValue));\n+\n+  }\n+\n+  public Map<PathSpec, Map<String, Object>> getLeafFieldsPathSpecObjToResolvedPropertiesMap()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3371afcbc35cdd85e376ac0e583c035b023a3df7"}, "originalPosition": 69}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35f59b19c823c8d02cb8f384b3b57d0d78f2571f", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/35f59b19c823c8d02cb8f384b3b57d0d78f2571f", "committedDate": "2020-02-28T01:32:44Z", "message": "address one more comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfeead313bbecf3503233f1af6a423887034a589", "author": {"user": {"login": "junchuanwang", "name": "Junchuan Wang"}}, "url": "https://github.com/linkedin/rest.li/commit/cfeead313bbecf3503233f1af6a423887034a589", "committedDate": "2020-02-28T01:33:35Z", "message": "Merge branch 'master' into junchuan_use_pathSpec_in_hashmap"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4955, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}