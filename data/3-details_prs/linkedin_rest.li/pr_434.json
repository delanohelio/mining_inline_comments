{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MDU2ODk4", "number": 434, "title": "Add method in ParseResult class to get base schema", "bodyText": "This is for parsing result easy to get base schema. when both extension and base schemas are in the resolver path.", "createdAt": "2020-10-02T18:04:27Z", "url": "https://github.com/linkedin/rest.li/pull/434", "merged": true, "mergeCommit": {"oid": "c92d198c3235e2d15a3415d027df7e1417d533d7"}, "closed": true, "closedAt": "2020-10-02T20:14:48Z", "author": {"login": "BrianPin"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOqM2AgFqTUwMTM1MjIwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOq7v9gFqTUwMTM4NTU0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMzUyMjA4", "url": "https://github.com/linkedin/rest.li/pull/434#pullrequestreview-501352208", "createdAt": "2020-10-02T18:19:16Z", "commit": {"oid": "2588a9447ac0fdb8503d8e9e51e4deca9d5688f3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxODoxOToxNlrOHb3USg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxODoyMTo1NFrOHb3Y2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk3OTkxNA==", "bodyText": "Please add java doc on both these methods and also for getSchemaAndLocations. Given we have mutliple methods, it would be helpful to document their behavior.", "url": "https://github.com/linkedin/rest.li/pull/434#discussion_r498979914", "createdAt": "2020-10-02T18:19:16Z", "author": {"login": "karthikbalasub"}, "path": "generator/src/main/java/com/linkedin/pegasus/generator/DataSchemaParser.java", "diffHunk": "@@ -211,24 +209,33 @@ private void init(AbstractMultiFormatDataSchemaResolver resolver,\n       return _schemaAndLocations;\n     }\n \n+    public Map<DataSchema, DataSchemaLocation> getBaseDataSchemaAndLocations()\n+    {\n+      return _schemaAndLocations.entrySet().stream().filter(entry -> !isExtensionSchemaLocation(entry))\n+          .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue));\n+    }\n+\n     public Map<DataSchema, DataSchemaLocation> getExtensionDataSchemaAndLocations()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2588a9447ac0fdb8503d8e9e51e4deca9d5688f3"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk4MTA4Mw==", "bodyText": "Not needed as the test will fail for any uncaught exception.", "url": "https://github.com/linkedin/rest.li/pull/434#discussion_r498981083", "createdAt": "2020-10-02T18:21:54Z", "author": {"login": "karthikbalasub"}, "path": "generator/src/test/java/com/linkedin/pegasus/generator/TestDataSchemaParser.java", "diffHunk": "@@ -212,6 +212,59 @@ public void testSchemaFilesInExtensionPathInFolder(String[] files, String[] expe\n   }\n \n \n+  @DataProvider(name = \"ERFilesForBaseSchema\")\n+  private Object[][] dataSchemaFiles()\n+  {\n+    return new Object[][]\n+        {\n+            {\n+                new String[]{\n+                    \"extensions/BarExtensions.pdl\",\n+                    \"extensions/FooExtensions.pdl\",\n+                    \"extensions/FuzzExtensions.pdl\",\n+                    \"pegasus/Foo.pdl\",\n+                    \"pegasus/Bar.pdl\",\n+                    \"pegasus/Fuzz.pdsc\"\n+                },\n+                new String[]{\n+                    \"Foo\",\n+                    \"Bar\",\n+                    \"Fuzz\",\n+                    \"InlineRecord\"\n+                }\n+            }\n+        };\n+  }\n+\n+  @Test(dataProvider = \"ERFilesForBaseSchema\")\n+  public void testParseResultToGetBaseSchemas(String[] files, String[] expectedExtensions) throws Exception\n+  {\n+    String pegasusWithFS = pegasusDir + FS;\n+    String resolverPath = pegasusWithFS + \"extensionSchemas/extensions:\"\n+        + pegasusWithFS + \"extensionSchemas/others:\"\n+        + pegasusWithFS + \"extensionSchemas/pegasus\";\n+    try\n+    {\n+      DataSchemaParser parser = new DataSchemaParser(resolverPath);\n+      String[] schemaFiles = Arrays.stream(files).map(casename -> pegasusDir + FS + \"extensionSchemas\" + FS + casename).toArray(String[]::new);\n+      DataSchemaParser.ParseResult parseResult = parser.parseSources(schemaFiles);\n+      Map<DataSchema, DataSchemaLocation> bases = parseResult.getBaseDataSchemaAndLocations();\n+      assertEquals(bases.size(), expectedExtensions.length);\n+      Set<String> actualNames = bases\n+          .keySet()\n+          .stream()\n+          .map(dataSchema -> (NamedDataSchema) dataSchema)\n+          .map(NamedDataSchema::getName)\n+          .collect(Collectors.toSet());\n+      assertEquals(actualNames, Arrays.stream(expectedExtensions).collect(Collectors.toSet()));\n+    }\n+    catch (Exception e)\n+    {\n+      Assert.fail(\"Test failed\");\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2588a9447ac0fdb8503d8e9e51e4deca9d5688f3"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81195434f0762f83fa9fb23943dbee18e110c2d2", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/81195434f0762f83fa9fb23943dbee18e110c2d2", "committedDate": "2020-10-02T18:22:25Z", "message": "Add method in ParseResult class to get base schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2588a9447ac0fdb8503d8e9e51e4deca9d5688f3", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/2588a9447ac0fdb8503d8e9e51e4deca9d5688f3", "committedDate": "2020-10-02T18:03:15Z", "message": "Add method in ParseResult class to get base schema"}, "afterCommit": {"oid": "81195434f0762f83fa9fb23943dbee18e110c2d2", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/81195434f0762f83fa9fb23943dbee18e110c2d2", "committedDate": "2020-10-02T18:22:25Z", "message": "Add method in ParseResult class to get base schema"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2253b518abc4c5b4a187b60accfa8b59eb57518d", "author": {"user": null}, "url": "https://github.com/linkedin/rest.li/commit/2253b518abc4c5b4a187b60accfa8b59eb57518d", "committedDate": "2020-10-02T18:56:03Z", "message": "address karthik comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMzc4MjAy", "url": "https://github.com/linkedin/rest.li/pull/434#pullrequestreview-501378202", "createdAt": "2020-10-02T19:01:19Z", "commit": {"oid": "2253b518abc4c5b4a187b60accfa8b59eb57518d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMzg1NTQx", "url": "https://github.com/linkedin/rest.li/pull/434#pullrequestreview-501385541", "createdAt": "2020-10-02T19:13:27Z", "commit": {"oid": "2253b518abc4c5b4a187b60accfa8b59eb57518d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4687, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}