{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5OTA5NzUy", "number": 1773, "reviewThreads": {"totalCount": 65, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMToyNjowMVrOEyxCLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoyMDowN1rOE0ULpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjY3NjMwOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMToyNjowMVrOHplewA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo1NjowNFrOHr5aqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM2Nzc0NA==", "bodyText": "Empy doc description for the class", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513367744", "createdAt": "2020-10-28T11:26:01Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc5MTUzMA==", "bodyText": "removed", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515791530", "createdAt": "2020-11-02T07:56:04Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM2Nzc0NA=="}, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjY4MjM3OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMToyNzozNFrOHpliZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo1NjoyNVrOHr5bUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM2ODY3OA==", "bodyText": "small typo\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n          \n          \n            \n                private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513368678", "createdAt": "2020-10-28T11:27:34Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc5MTY5OQ==", "bodyText": "done", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515791699", "createdAt": "2020-11-02T07:56:25Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM2ODY3OA=="}, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjY5NjU3OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTozMTozMlrOHplrDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo1NjozNlrOHr5bqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM3MDg5NA==", "bodyText": "These properties are not used in the test - I think they should be removed", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513370894", "createdAt": "2020-10-28T11:31:32Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc5MTc4NQ==", "bodyText": "removed. don't needed anymore", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515791785", "createdAt": "2020-11-02T07:56:36Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM3MDg5NA=="}, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjcwMDYzOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTozMjozOVrOHpltfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo1Njo1MVrOHr5cEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM3MTUxNg==", "bodyText": "This private method is not used anywhere in the code - please remove\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n          \n          \n            \n                    assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n          \n          \n            \n                    long workItemId = humanTaskMockHandler.workItem.getId();\n          \n          \n            \n                    assertTrue(\"work item id not saved\", workItemId > 0);\n          \n          \n            \n                    \n          \n          \n            \n                    // The Human Task is completed\n          \n          \n            \n                    Map<String, Object> results = new HashMap<String, Object>();\n          \n          \n            \n                    try {\n          \n          \n            \n                        ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n          \n          \n            \n                    } catch (Exception e) {\n          \n          \n            \n                        logger.warn(\"Work item could not be completed!\");\n          \n          \n            \n                        e.printStackTrace();\n          \n          \n            \n                        fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n          \n          \n            \n                    }\n          \n          \n            \n                }", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513371516", "createdAt": "2020-10-28T11:32:39Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());\n+    \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+\n+    private ProcessInstance registerHTHandlerAndStartProcess(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) { \n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+    \n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+        \n+        return process;\n+    \n+    }\n+\n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc5MTg5MQ==", "bodyText": "corrected. IT is used.", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515791891", "createdAt": "2020-11-02T07:56:51Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());\n+    \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+\n+    private ProcessInstance registerHTHandlerAndStartProcess(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) { \n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+    \n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+        \n+        return process;\n+    \n+    }\n+\n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM3MTUxNg=="}, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 121}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjcxOTIyOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTozNzo0N1rOHpl4sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo1OToyNlrOHr5gvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM3NDM4Ng==", "bodyText": "We should try to use static import as it's already imported\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Assert.assertEquals(3, logs.size());\n          \n          \n            \n                    assertEquals(3, logs.size());", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513374386", "createdAt": "2020-10-28T11:37:47Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc5MzA4Nw==", "bodyText": "removed", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515793087", "createdAt": "2020-11-02T07:59:26Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM3NDM4Ng=="}, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjc0NzQyOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTo0NTozN1rOHpmJlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTo0NTozN1rOHpmJlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM3ODcxMA==", "bodyText": "Maybe it's a little clearer if we use TimeUnit class instead.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        int sleep = 2000;\n          \n          \n            \n                        logger.debug(\"Sleeping {} seconds\", sleep / 1000);\n          \n          \n            \n                        Thread.sleep(sleep);\n          \n          \n            \n                        logger.debug(\"Sleeping {} seconds\", 2);\n          \n          \n            \n                        TimeUnit.SECONDS.sleep(2);", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513378710", "createdAt": "2020-10-28T11:45:37Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());\n+    \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+\n+    private ProcessInstance registerHTHandlerAndStartProcess(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) { \n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+    \n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+        \n+        return process;\n+    \n+    }\n+\n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns(int processState) throws InterruptedException { \n+        // wait 3 seconds to see if the boss is notified\n+        if (processState == ProcessInstance.STATE_ACTIVE) {\n+            int sleep = 2000;\n+            logger.debug(\"Sleeping {} seconds\", sleep / 1000);\n+            Thread.sleep(sleep);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 128}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjc1MzMzOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTo0NzoyMFrOHpmNRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMTo0NzoyMFrOHpmNRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM3OTY1Mg==", "bodyText": "Maybe it's worth adding and assertEquals instead?", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513379652", "createdAt": "2020-10-28T11:47:20Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());\n+    \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+\n+    private ProcessInstance registerHTHandlerAndStartProcess(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) { \n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+    \n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+        \n+        return process;\n+    \n+    }\n+\n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns(int processState) throws InterruptedException { \n+        // wait 3 seconds to see if the boss is notified\n+        if (processState == ProcessInstance.STATE_ACTIVE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 125}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjg0NDYxOnYy", "diffSide": "RIGHT", "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/BoundaryEventHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMjoxMjozNVrOHpnEUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMjoxMjozNVrOHpnEUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM5Mzc0Ng==", "bodyText": "I'm missing similar logic or behavior for compensation events at \n  \n    \n      jbpm/jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/BoundaryEventHandler.java\n    \n    \n         Line 294\n      in\n      583afd7\n    \n    \n    \n    \n\n        \n          \n           protected void handleCompensationNode(final Node node, final Element element, final String uri, \n        \n    \n  \n\n\nShouldn't we add the same logic as we agreed in BAPL?", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513393746", "createdAt": "2020-10-28T12:12:35Z", "author": {"login": "afalhambra"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/BoundaryEventHandler.java", "diffHunk": "@@ -277,6 +280,12 @@ protected void handleTimerNode(final Node node, final Element element, final Str\n                     eventNode.setMetaData(\"TimeDate\", timeDate);\n                 }\n \n+            } else if (\"dataOutput\".equals(nodeName)) {\n+                String id = ((Element) xmlNode).getAttribute(\"id\");\n+                String outputName = ((Element) xmlNode).getAttribute(\"name\");\n+                dataOutputs.put(id, outputName);\n+            } else if (\"dataOutputAssociation\".equals(nodeName)) {\n+                readDataOutputAssociation(xmlNode, eventNode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNjg2NzEwOnYy", "diffSide": "RIGHT", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/core/node/BoundaryEventNode.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMjoxODo1NVrOHpnR5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMjoxODo1NVrOHpnR5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM5NzIyMA==", "bodyText": "Maybe you can use something like\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    while (it.hasNext()) {\n          \n          \n            \n                        DataAssociation association = it.next();\n          \n          \n            \n                        if (forEachOutVariable.equals(association.getTarget())) {\n          \n          \n            \n                            it.remove();\n          \n          \n            \n                        }\n          \n          \n            \n                    }\n          \n          \n            \n                    outMapping.removeIf(association -> forEachOutVariable.equals(association.getTarget()));", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513397220", "createdAt": "2020-10-28T12:18:55Z", "author": {"login": "afalhambra"}, "path": "jbpm-flow/src/main/java/org/jbpm/workflow/core/node/BoundaryEventNode.java", "diffHunk": "@@ -32,6 +41,50 @@ public void setAttachedToNodeId(String attachedToNodeId) {\n         this.attachedToNodeId = attachedToNodeId;\n     }\n \n+    \n+    public void addOutMapping(String parameterName, String variableName) {\n+        outMapping.add(new DataAssociation(parameterName, variableName, null, null));\n+    }\n+    \n+    public void adjustOutMapping(String forEachOutVariable) {\n+        Iterator<DataAssociation> it = outMapping.iterator();\n+        while (it.hasNext()) {\n+            DataAssociation association = it.next();\n+            if (forEachOutVariable.equals(association.getTarget())) {\n+                it.remove();\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzA1Mjg3OnYy", "diffSide": "RIGHT", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/BoundaryEventNodeInstance.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzowNzoyNFrOHppETQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzowNzoyNFrOHppETQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQyNjUwOQ==", "bodyText": "NodeInstanceContainer cast is redundant\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Collection<NodeInstance> nodeInstances = ((NodeInstanceContainer) getNodeInstanceContainer()).getNodeInstances();\n          \n          \n            \n                    Collection<NodeInstance> nodeInstances = getNodeInstanceContainer().getNodeInstances();", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513426509", "createdAt": "2020-10-28T13:07:24Z", "author": {"login": "afalhambra"}, "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/BoundaryEventNodeInstance.java", "diffHunk": "@@ -48,8 +49,30 @@ public void signalEvent(String type, Object event) {\n             }\n         }\n     }\n+    \n+    @Override\n+    public BoundaryEventNode getEventNode() {\n+        return (BoundaryEventNode) super.getEventNode();\n+    }\n+    \n+    @Override\n+    public void triggerCompleted(String type, Object event) {\n+        Collection<NodeInstance> nodeInstances = ((NodeInstanceContainer) getNodeInstanceContainer()).getNodeInstances();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzI1ODA5OnYy", "diffSide": "RIGHT", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/impl/ExtendedNodeInstanceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzo1MTowNVrOHprC3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzo1MTowNVrOHprC3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ1ODkwOQ==", "bodyText": "typo\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                protected void mapOutputSetVariables(NodeInstance nodeInstance, List<DataAssociation> dataOututAssoctiation, Map<String, Object> ouputData) {\n          \n          \n            \n                protected void mapOutputSetVariables(NodeInstance nodeInstance, List<DataAssociation> dataOutputAssociation, Map<String, Object> outputData) {", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513458909", "createdAt": "2020-10-28T13:51:05Z", "author": {"login": "afalhambra"}, "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/impl/ExtendedNodeInstanceImpl.java", "diffHunk": "@@ -57,7 +72,80 @@ protected void triggerEvent(String type) {\n \t\t\t}\n \t\t}\n \t}\n+    protected void mapOutputSetVariables(NodeInstance nodeInstance, List<DataAssociation> dataOututAssoctiation, Map<String, Object> ouputData) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzI1OTc4OnYy", "diffSide": "RIGHT", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/impl/ExtendedNodeInstanceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzo1MToxOVrOHprDyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzo1MToxOVrOHprDyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ1OTE0Nw==", "bodyText": "same as above", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513459147", "createdAt": "2020-10-28T13:51:19Z", "author": {"login": "afalhambra"}, "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/impl/ExtendedNodeInstanceImpl.java", "diffHunk": "@@ -57,7 +72,80 @@ protected void triggerEvent(String type) {\n \t\t\t}\n \t\t}\n \t}\n+    protected void mapOutputSetVariables(NodeInstance nodeInstance, List<DataAssociation> dataOututAssoctiation, Map<String, Object> ouputData) {\n+        this.mapOutputSetVariables(nodeInstance, dataOututAssoctiation, ouputData, (target, value) -> {});\n+    }\n+    protected void mapOutputSetVariables(NodeInstance nodeInstance, List<DataAssociation> dataOututAssoctiation, Map<String, Object> ouputData, BiConsumer<String, Object> parameterSet) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzI4MDc5OnYy", "diffSide": "RIGHT", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/WorkItemNodeInstance.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzo1NTozNVrOHprQgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMzo1NTozNVrOHprQgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MjQwMg==", "bodyText": "please remove unused imports.", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513462402", "createdAt": "2020-10-28T13:55:35Z", "author": {"login": "afalhambra"}, "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/WorkItemNodeInstance.java", "diffHunk": "@@ -55,7 +55,7 @@\n import org.jbpm.workflow.instance.WorkflowProcessInstance;\n import org.jbpm.workflow.instance.WorkflowRuntimeException;\n import org.jbpm.workflow.instance.impl.NodeInstanceResolverFactory;\n-import org.jbpm.workflow.instance.impl.WorkItemResolverFactory;\n+import org.jbpm.workflow.instance.impl.MapResolverFactory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzMyNDUxOnYy", "diffSide": "RIGHT", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/impl/MapResolverFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDowNDozOFrOHprsUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDowNDozOFrOHprsUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2OTUyMg==", "bodyText": "Shouldn't be better to create a new internal HashMap for instance? wdyt?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tthis.data = data;\n          \n          \n            \n            \t\tthis.data = new HashMap<>(data);", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513469522", "createdAt": "2020-10-28T14:04:38Z", "author": {"login": "afalhambra"}, "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/impl/MapResolverFactory.java", "diffHunk": "@@ -16,27 +16,28 @@\n \n package org.jbpm.workflow.instance.impl;\n \n-import org.kie.api.runtime.process.WorkItem;\n+import java.util.Map;\n+\n import org.mvel2.integration.VariableResolver;\n import org.mvel2.integration.impl.ImmutableDefaultFactory;\n import org.mvel2.integration.impl.SimpleValueResolver;\n \n-public class WorkItemResolverFactory extends ImmutableDefaultFactory {\n+public class MapResolverFactory extends ImmutableDefaultFactory {\n \n \tprivate static final long serialVersionUID = 510l;\n \t\n-\tprivate WorkItem workItem;\n+\tprivate Map<String, Object> data;\n \t\n-\tpublic WorkItemResolverFactory(WorkItem workItem) {\n-\t\tthis.workItem = workItem;\n+\tpublic MapResolverFactory(Map<String, Object> data) {\n+\t\tthis.data = data;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzMzNjk0OnYy", "diffSide": "RIGHT", "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xpath/XPATHAssignmentAction.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDowNzowNVrOHprz3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNDowNzowNVrOHprz3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ3MTQ1Mw==", "bodyText": "unused imports", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513471453", "createdAt": "2020-10-28T14:07:05Z", "author": {"login": "afalhambra"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xpath/XPATHAssignmentAction.java", "diffHunk": "@@ -16,16 +16,21 @@\n \n package org.jbpm.bpmn2.xpath;\n \n+import java.util.function.BiFunction;\n+import java.util.function.Function;\n+import java.util.function.Supplier;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzY0MDU1OnYy", "diffSide": "RIGHT", "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xpath/XPATHAssignmentBuilder.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNTowNjoxNVrOHpu0Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNTowNjoxNVrOHpu0Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyMDczOA==", "bodyText": "ContextResolver is no longer needed", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513520738", "createdAt": "2020-10-28T15:06:15Z", "author": {"login": "afalhambra"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xpath/XPATHAssignmentBuilder.java", "diffHunk": "@@ -16,16 +16,30 @@\n \n package org.jbpm.bpmn2.xpath;\n \n+import java.util.function.BiFunction;\n+\n import org.drools.compiler.rule.builder.PackageBuildContext;\n import org.jbpm.process.builder.AssignmentBuilder;\n import org.jbpm.process.core.ContextResolver;\n+import org.jbpm.process.instance.impl.AssignmentProducer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzY0NzQxOnYy", "diffSide": "RIGHT", "path": "jbpm-flow-builder/src/main/java/org/jbpm/process/builder/WorkItemNodeBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNTowNzozMFrOHpu4hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNTowNzozMFrOHpu4hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyMTc5OQ==", "bodyText": "Not used", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513521799", "createdAt": "2020-10-28T15:07:30Z", "author": {"login": "afalhambra"}, "path": "jbpm-flow-builder/src/main/java/org/jbpm/process/builder/WorkItemNodeBuilder.java", "diffHunk": "@@ -19,19 +19,26 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.function.BiConsumer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxNzY0ODEwOnYy", "diffSide": "RIGHT", "path": "jbpm-flow-builder/src/main/java/org/jbpm/process/builder/WorkItemNodeBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNTowNzozOFrOHpu49A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo1NzoyMlrOHr5dCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyMTkwOA==", "bodyText": "same as above", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513521908", "createdAt": "2020-10-28T15:07:38Z", "author": {"login": "afalhambra"}, "path": "jbpm-flow-builder/src/main/java/org/jbpm/process/builder/WorkItemNodeBuilder.java", "diffHunk": "@@ -19,19 +19,26 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.function.BiConsumer;\n+import java.util.function.BiFunction;\n+import java.util.function.Supplier;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc5MjEzNg==", "bodyText": "removed", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515792136", "createdAt": "2020-11-02T07:57:22Z", "author": {"login": "elguardian"}, "path": "jbpm-flow-builder/src/main/java/org/jbpm/process/builder/WorkItemNodeBuilder.java", "diffHunk": "@@ -19,19 +19,26 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.function.BiConsumer;\n+import java.util.function.BiFunction;\n+import java.util.function.Supplier;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUyMTkwOA=="}, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxODAxNDE2OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNjoyMTowM1rOHpygPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo1ODoyNFrOHr5ezg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU4MTExNg==", "bodyText": "we're actually waiting for 2 seconds", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513581116", "createdAt": "2020-10-28T16:21:03Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());\n+    \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+\n+    private ProcessInstance registerHTHandlerAndStartProcess(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) { \n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+    \n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+        \n+        return process;\n+    \n+    }\n+\n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns(int processState) throws InterruptedException { \n+        // wait 3 seconds to see if the boss is notified", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc5MjU5MA==", "bodyText": "removed", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515792590", "createdAt": "2020-11-02T07:58:24Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());\n+    \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+\n+    private ProcessInstance registerHTHandlerAndStartProcess(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) { \n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+    \n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+        \n+        return process;\n+    \n+    }\n+\n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns(int processState) throws InterruptedException { \n+        // wait 3 seconds to see if the boss is notified", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU4MTExNg=="}, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxODAyMDg5OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNjoyMjoyN1rOHpykZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo1ODoxM1rOHr5eiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU4MjE4Mw==", "bodyText": "as per interval in timer is set to 500ms###1s and we wait for 2 seconds, expected is 4 instead of 3.\nThough I would try to increase interval period, to avoid having any potential flaky test based on timing, just in case, wdyt?", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513582183", "createdAt": "2020-10-28T16:22:27Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc5MjUyMA==", "bodyText": "it does not start in 0. but 500. anyway iwe are not testing that anymore. removed.", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515792520", "createdAt": "2020-11-02T07:58:13Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU4MjE4Mw=="}, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxODA0NDc2OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNjoyNzoxOVrOHpyzLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo1ODo0NFrOHr5faQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU4NTk2NA==", "bodyText": "This class is registered as a work item handler, but never used afterwards in the test. Shouldn't we try to recover HumanTaskNodeInstance object from here as per requirements in BAPL? wdyt?", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r513585964", "createdAt": "2020-10-28T16:27:19Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());\n+    \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+\n+    private ProcessInstance registerHTHandlerAndStartProcess(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) { \n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+    \n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+        \n+        return process;\n+    \n+    }\n+\n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns(int processState) throws InterruptedException { \n+        // wait 3 seconds to see if the boss is notified\n+        if (processState == ProcessInstance.STATE_ACTIVE) {\n+            int sleep = 2000;\n+            logger.debug(\"Sleeping {} seconds\", sleep / 1000);\n+            Thread.sleep(sleep);\n+            logger.debug(\"Awake!\");\n+        }\n+       \n+    }\n+\n+    \n+\n+    private static class HumanTaskMockHandler implements WorkItemHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 136}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc5Mjc0NQ==", "bodyText": "it is used now", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515792745", "createdAt": "2020-11-02T07:58:44Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/timer/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,153 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.timer;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+/**\n+ */\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_FILE_NAME = \"org/jbpm/test/functional/timer/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+    private final static String TIMER_FIRED_PROP = \"timerFired\";\n+    private final static String TIMER_FIRED_TIME_PROP = \"afterTimerTime\";\n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+    \n+    @Before\n+    public void setup() { \n+        System.clearProperty(TIMER_FIRED_PROP);\n+        System.clearProperty(TIMER_FIRED_TIME_PROP);\n+    }\n+    \n+    @Test\n+    public void boundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        /**\n+         * First we set up everything and start the process\n+         */\n+        createRuntimeManager(PROCESS_FILE_NAME);\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        ProcessInstance process = registerHTHandlerAndStartProcess(ksession, humanTaskMockHandler);\n+        \n+        sleepAndVerifyTimerRuns(process.getState());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(3, logs.size());\n+    \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+\n+    private ProcessInstance registerHTHandlerAndStartProcess(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) { \n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+    \n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+        \n+        return process;\n+    \n+    }\n+\n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns(int processState) throws InterruptedException { \n+        // wait 3 seconds to see if the boss is notified\n+        if (processState == ProcessInstance.STATE_ACTIVE) {\n+            int sleep = 2000;\n+            logger.debug(\"Sleeping {} seconds\", sleep / 1000);\n+            Thread.sleep(sleep);\n+            logger.debug(\"Awake!\");\n+        }\n+       \n+    }\n+\n+    \n+\n+    private static class HumanTaskMockHandler implements WorkItemHandler {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU4NTk2NA=="}, "originalCommit": {"oid": "583afd715f43efec0b8a9a164be9b4bac76924ad"}, "originalPosition": 136}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzMwODA3OnYy", "diffSide": "RIGHT", "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo1Mzo1OVrOHrNuxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDoxNDo0MlrOHsGFTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3NTc4MA==", "bodyText": "IMHO though class is declared as final it should be good to keep this consistent\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);\n          \n          \n            \n                private static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515075780", "createdAt": "2020-10-30T12:53:59Z", "author": {"login": "afalhambra"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.bpmn2.xml.elements;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jbpm.workflow.core.node.Assignment;\n+import org.jbpm.workflow.core.node.DataAssociation;\n+import org.jbpm.workflow.core.node.Transformation;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DataAssociationFactory {\n+    \n+    protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk5OTA1Mw==", "bodyText": "done", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515999053", "createdAt": "2020-11-02T14:14:42Z", "author": {"login": "elguardian"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.bpmn2.xml.elements;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jbpm.workflow.core.node.Assignment;\n+import org.jbpm.workflow.core.node.DataAssociation;\n+import org.jbpm.workflow.core.node.Transformation;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DataAssociationFactory {\n+    \n+    protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3NTc4MA=="}, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzMxMTAzOnYy", "diffSide": "RIGHT", "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo1NDo1N1rOHrNwog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDoxNjoxMFrOHsGI_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3NjI1OA==", "bodyText": "Why not declared them as import instead of using fully qualifier name?", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515076258", "createdAt": "2020-10-30T12:54:57Z", "author": {"login": "afalhambra"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.bpmn2.xml.elements;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jbpm.workflow.core.node.Assignment;\n+import org.jbpm.workflow.core.node.DataAssociation;\n+import org.jbpm.workflow.core.node.Transformation;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DataAssociationFactory {\n+    \n+    protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);\n+    \n+    private DataAssociationFactory() {\n+        // do nothing\n+    }\n+\n+    public static DataAssociation readDataOutputAssociation(org.w3c.dom.Node xmlNode, Map<String, String> dataOutputs) {\n+\n+        org.w3c.dom.NodeList nodeList = xmlNode.getChildNodes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk5OTk5Ng==", "bodyText": "removed.", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515999996", "createdAt": "2020-11-02T14:16:10Z", "author": {"login": "elguardian"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.bpmn2.xml.elements;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jbpm.workflow.core.node.Assignment;\n+import org.jbpm.workflow.core.node.DataAssociation;\n+import org.jbpm.workflow.core.node.Transformation;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DataAssociationFactory {\n+    \n+    protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);\n+    \n+    private DataAssociationFactory() {\n+        // do nothing\n+    }\n+\n+    public static DataAssociation readDataOutputAssociation(org.w3c.dom.Node xmlNode, Map<String, String> dataOutputs) {\n+\n+        org.w3c.dom.NodeList nodeList = xmlNode.getChildNodes();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3NjI1OA=="}, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzMxODM5OnYy", "diffSide": "RIGHT", "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMjo1Njo1OVrOHrN1Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDoxNjowNFrOHsGIpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3NzM5NQ==", "bodyText": "might be worth checking xmlNode and dataOutputs are not null", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515077395", "createdAt": "2020-10-30T12:56:59Z", "author": {"login": "afalhambra"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.bpmn2.xml.elements;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jbpm.workflow.core.node.Assignment;\n+import org.jbpm.workflow.core.node.DataAssociation;\n+import org.jbpm.workflow.core.node.Transformation;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DataAssociationFactory {\n+    \n+    protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);\n+    \n+    private DataAssociationFactory() {\n+        // do nothing\n+    }\n+\n+    public static DataAssociation readDataOutputAssociation(org.w3c.dom.Node xmlNode, Map<String, String> dataOutputs) {\n+\n+        org.w3c.dom.NodeList nodeList = xmlNode.getChildNodes();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk5OTkxMA==", "bodyText": "none of them can be null as per design of node handler", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515999910", "createdAt": "2020-11-02T14:16:04Z", "author": {"login": "elguardian"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.bpmn2.xml.elements;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jbpm.workflow.core.node.Assignment;\n+import org.jbpm.workflow.core.node.DataAssociation;\n+import org.jbpm.workflow.core.node.Transformation;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DataAssociationFactory {\n+    \n+    protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);\n+    \n+    private DataAssociationFactory() {\n+        // do nothing\n+    }\n+\n+    public static DataAssociation readDataOutputAssociation(org.w3c.dom.Node xmlNode, Map<String, String> dataOutputs) {\n+\n+        org.w3c.dom.NodeList nodeList = xmlNode.getChildNodes();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA3NzM5NQ=="}, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzMzOTUxOnYy", "diffSide": "RIGHT", "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzowMzozNVrOHrOCnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDoxNzoxNVrOHsGLyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4MDg2Mw==", "bodyText": "IMO this should be declared as private as it would be odd to have a DataAssociationFactory class returning an assignment object.", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515080863", "createdAt": "2020-10-30T13:03:35Z", "author": {"login": "afalhambra"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.bpmn2.xml.elements;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jbpm.workflow.core.node.Assignment;\n+import org.jbpm.workflow.core.node.DataAssociation;\n+import org.jbpm.workflow.core.node.Transformation;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DataAssociationFactory {\n+    \n+    protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);\n+    \n+    private DataAssociationFactory() {\n+        // do nothing\n+    }\n+\n+    public static DataAssociation readDataOutputAssociation(org.w3c.dom.Node xmlNode, Map<String, String> dataOutputs) {\n+\n+        org.w3c.dom.NodeList nodeList = xmlNode.getChildNodes();\n+        String source = null;\n+        String target = null;\n+        Transformation transformation = null;\n+        List<Assignment> assignment = new ArrayList<>();\n+        for(int i = 0; i < nodeList.getLength(); i++) {\n+            org.w3c.dom.Node subNode = nodeList.item(i);\n+            switch(subNode.getNodeName()) {\n+                case \"sourceRef\":\n+                {\n+                    source = subNode.getTextContent();\n+                    if(!dataOutputs.containsKey(source)) {\n+                        logger.warn(\"Data outputs in this node {} does not contain source {}\", xmlNode.getAttributes().getNamedItem(\"id\"), source);\n+                    }\n+                    // indirection\n+                    source = dataOutputs.get(source);\n+                    break;\n+                }\n+                case \"targetRef\":\n+                {\n+                    target = subNode.getTextContent();\n+                    break;\n+                }\n+                case \"transformation\":\n+                {\n+                    String lang = subNode.getAttributes().getNamedItem(\"language\").getNodeValue();\n+                    String expression = subNode.getTextContent();\n+                    transformation = new Transformation(lang, expression, source);\n+                    break;\n+                }\n+                case \"assignment\":\n+                {\n+                    assignment.add(readAssignment(subNode));\n+                    break;\n+                }\n+            }\n+\n+        }\n+        return new DataAssociation(source, target, assignment, transformation);\n+    }\n+    \n+    public static Assignment readAssignment(org.w3c.dom.Node xmlNode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAwMDcxMw==", "bodyText": "it is ok. as assignment can only be within data associations.", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r516000713", "createdAt": "2020-11-02T14:17:15Z", "author": {"login": "elguardian"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.bpmn2.xml.elements;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jbpm.workflow.core.node.Assignment;\n+import org.jbpm.workflow.core.node.DataAssociation;\n+import org.jbpm.workflow.core.node.Transformation;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DataAssociationFactory {\n+    \n+    protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);\n+    \n+    private DataAssociationFactory() {\n+        // do nothing\n+    }\n+\n+    public static DataAssociation readDataOutputAssociation(org.w3c.dom.Node xmlNode, Map<String, String> dataOutputs) {\n+\n+        org.w3c.dom.NodeList nodeList = xmlNode.getChildNodes();\n+        String source = null;\n+        String target = null;\n+        Transformation transformation = null;\n+        List<Assignment> assignment = new ArrayList<>();\n+        for(int i = 0; i < nodeList.getLength(); i++) {\n+            org.w3c.dom.Node subNode = nodeList.item(i);\n+            switch(subNode.getNodeName()) {\n+                case \"sourceRef\":\n+                {\n+                    source = subNode.getTextContent();\n+                    if(!dataOutputs.containsKey(source)) {\n+                        logger.warn(\"Data outputs in this node {} does not contain source {}\", xmlNode.getAttributes().getNamedItem(\"id\"), source);\n+                    }\n+                    // indirection\n+                    source = dataOutputs.get(source);\n+                    break;\n+                }\n+                case \"targetRef\":\n+                {\n+                    target = subNode.getTextContent();\n+                    break;\n+                }\n+                case \"transformation\":\n+                {\n+                    String lang = subNode.getAttributes().getNamedItem(\"language\").getNodeValue();\n+                    String expression = subNode.getTextContent();\n+                    transformation = new Transformation(lang, expression, source);\n+                    break;\n+                }\n+                case \"assignment\":\n+                {\n+                    assignment.add(readAssignment(subNode));\n+                    break;\n+                }\n+            }\n+\n+        }\n+        return new DataAssociation(source, target, assignment, transformation);\n+    }\n+    \n+    public static Assignment readAssignment(org.w3c.dom.Node xmlNode) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4MDg2Mw=="}, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzM1MTc3OnYy", "diffSide": "RIGHT", "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzowNjo1NVrOHrOJ3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDoxODowMFrOHsGNyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4MjcxOA==", "bodyText": "Maybe it's worth adding a default branch statement for the switch and log a warning message", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515082718", "createdAt": "2020-10-30T13:06:55Z", "author": {"login": "afalhambra"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.bpmn2.xml.elements;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jbpm.workflow.core.node.Assignment;\n+import org.jbpm.workflow.core.node.DataAssociation;\n+import org.jbpm.workflow.core.node.Transformation;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DataAssociationFactory {\n+    \n+    protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);\n+    \n+    private DataAssociationFactory() {\n+        // do nothing\n+    }\n+\n+    public static DataAssociation readDataOutputAssociation(org.w3c.dom.Node xmlNode, Map<String, String> dataOutputs) {\n+\n+        org.w3c.dom.NodeList nodeList = xmlNode.getChildNodes();\n+        String source = null;\n+        String target = null;\n+        Transformation transformation = null;\n+        List<Assignment> assignment = new ArrayList<>();\n+        for(int i = 0; i < nodeList.getLength(); i++) {\n+            org.w3c.dom.Node subNode = nodeList.item(i);\n+            switch(subNode.getNodeName()) {\n+                case \"sourceRef\":\n+                {\n+                    source = subNode.getTextContent();\n+                    if(!dataOutputs.containsKey(source)) {\n+                        logger.warn(\"Data outputs in this node {} does not contain source {}\", xmlNode.getAttributes().getNamedItem(\"id\"), source);\n+                    }\n+                    // indirection\n+                    source = dataOutputs.get(source);\n+                    break;\n+                }\n+                case \"targetRef\":\n+                {\n+                    target = subNode.getTextContent();\n+                    break;\n+                }\n+                case \"transformation\":\n+                {\n+                    String lang = subNode.getAttributes().getNamedItem(\"language\").getNodeValue();\n+                    String expression = subNode.getTextContent();\n+                    transformation = new Transformation(lang, expression, source);\n+                    break;\n+                }\n+                case \"assignment\":\n+                {\n+                    assignment.add(readAssignment(subNode));\n+                    break;\n+                }\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAwMTIyNw==", "bodyText": "it is not possible to reach another state as it only can be from or to. Parser is throwing already a warning or error depending of the situation.", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r516001227", "createdAt": "2020-11-02T14:18:00Z", "author": {"login": "elguardian"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.bpmn2.xml.elements;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jbpm.workflow.core.node.Assignment;\n+import org.jbpm.workflow.core.node.DataAssociation;\n+import org.jbpm.workflow.core.node.Transformation;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DataAssociationFactory {\n+    \n+    protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);\n+    \n+    private DataAssociationFactory() {\n+        // do nothing\n+    }\n+\n+    public static DataAssociation readDataOutputAssociation(org.w3c.dom.Node xmlNode, Map<String, String> dataOutputs) {\n+\n+        org.w3c.dom.NodeList nodeList = xmlNode.getChildNodes();\n+        String source = null;\n+        String target = null;\n+        Transformation transformation = null;\n+        List<Assignment> assignment = new ArrayList<>();\n+        for(int i = 0; i < nodeList.getLength(); i++) {\n+            org.w3c.dom.Node subNode = nodeList.item(i);\n+            switch(subNode.getNodeName()) {\n+                case \"sourceRef\":\n+                {\n+                    source = subNode.getTextContent();\n+                    if(!dataOutputs.containsKey(source)) {\n+                        logger.warn(\"Data outputs in this node {} does not contain source {}\", xmlNode.getAttributes().getNamedItem(\"id\"), source);\n+                    }\n+                    // indirection\n+                    source = dataOutputs.get(source);\n+                    break;\n+                }\n+                case \"targetRef\":\n+                {\n+                    target = subNode.getTextContent();\n+                    break;\n+                }\n+                case \"transformation\":\n+                {\n+                    String lang = subNode.getAttributes().getNamedItem(\"language\").getNodeValue();\n+                    String expression = subNode.getTextContent();\n+                    transformation = new Transformation(lang, expression, source);\n+                    break;\n+                }\n+                case \"assignment\":\n+                {\n+                    assignment.add(readAssignment(subNode));\n+                    break;\n+                }\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4MjcxOA=="}, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzM1MjIyOnYy", "diffSide": "RIGHT", "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzowNzowM1rOHrOKJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxMzowNzowM1rOHrOKJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA4Mjc4OA==", "bodyText": "Maybe it's worth adding a default branch statement for the switch and log a warning message", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515082788", "createdAt": "2020-10-30T13:07:03Z", "author": {"login": "afalhambra"}, "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/elements/DataAssociationFactory.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.bpmn2.xml.elements;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.jbpm.workflow.core.node.Assignment;\n+import org.jbpm.workflow.core.node.DataAssociation;\n+import org.jbpm.workflow.core.node.Transformation;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public final class DataAssociationFactory {\n+    \n+    protected static final Logger logger = LoggerFactory.getLogger(DataAssociationFactory.class);\n+    \n+    private DataAssociationFactory() {\n+        // do nothing\n+    }\n+\n+    public static DataAssociation readDataOutputAssociation(org.w3c.dom.Node xmlNode, Map<String, String> dataOutputs) {\n+\n+        org.w3c.dom.NodeList nodeList = xmlNode.getChildNodes();\n+        String source = null;\n+        String target = null;\n+        Transformation transformation = null;\n+        List<Assignment> assignment = new ArrayList<>();\n+        for(int i = 0; i < nodeList.getLength(); i++) {\n+            org.w3c.dom.Node subNode = nodeList.item(i);\n+            switch(subNode.getNodeName()) {\n+                case \"sourceRef\":\n+                {\n+                    source = subNode.getTextContent();\n+                    if(!dataOutputs.containsKey(source)) {\n+                        logger.warn(\"Data outputs in this node {} does not contain source {}\", xmlNode.getAttributes().getNamedItem(\"id\"), source);\n+                    }\n+                    // indirection\n+                    source = dataOutputs.get(source);\n+                    break;\n+                }\n+                case \"targetRef\":\n+                {\n+                    target = subNode.getTextContent();\n+                    break;\n+                }\n+                case \"transformation\":\n+                {\n+                    String lang = subNode.getAttributes().getNamedItem(\"language\").getNodeValue();\n+                    String expression = subNode.getTextContent();\n+                    transformation = new Transformation(lang, expression, source);\n+                    break;\n+                }\n+                case \"assignment\":\n+                {\n+                    assignment.add(readAssignment(subNode));\n+                    break;\n+                }\n+            }\n+\n+        }\n+        return new DataAssociation(source, target, assignment, transformation);\n+    }\n+    \n+    public static Assignment readAssignment(org.w3c.dom.Node xmlNode) {\n+        org.w3c.dom.NodeList nodeList = xmlNode.getChildNodes();\n+        String from = null;\n+        String to = null;\n+        for(int i = 0; i < nodeList.getLength(); i++) {\n+            org.w3c.dom.Node subNode = nodeList.item(i);\n+            switch (subNode.getNodeName()) {\n+                case \"from\":\n+                    from = subNode.getTextContent();\n+                    break;\n+                case \"to\":\n+                    to = subNode.getTextContent();\n+                    break;\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzc1NzM2OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDo0MjoyOVrOHrSGtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDo0MjoyOVrOHrSGtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE0NzQ0NA==", "bodyText": "typo\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n          \n          \n            \n                private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515147444", "createdAt": "2020-10-30T14:42:29Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,378 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzgzNTAxOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDo1NzoyMlrOHrS5Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDo1NzoyMlrOHrS5Ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2MDQxMQ==", "bodyText": "There is no timer in this bpm process", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515160411", "createdAt": "2020-10-30T14:57:22Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,91 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryCompensationEventProcess\" \n+           name=\"Boundary Timer Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+      <userTask id=\"_2\" name=\"Human Task\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+  \n+      <userTask id=\"_3\" name=\"Human Task 2\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+          \n+  \n+    <endEvent id=\"_4\" name=\"End Main Process\">\n+      <terminateEventDefinition/>\n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Timer Event\" attachedToRef=\"_2\">\n+      <compensateEventDefinition />\n+  \t  <dataOutput id=\"nodeInstanceRef\" name=\"nodeInstance\" />\n+  \t  <dataOutput id=\"signalRef\" name=\"signal\" />\n+  \t  <dataOutput id=\"eventRef\" name=\"event\" />\n+      <outputSet>\n+        <dataOutputRefs>nodeInstanceRef</dataOutputRefs>\n+        <dataOutputRefs>signalRef</dataOutputRefs>\n+        <dataOutputRefs>eventRef</dataOutputRefs>\n+      </outputSet>\n+      <dataOutputAssociation>\n+        <sourceRef>nodeInstanceRef</sourceRef>\n+        <targetRef>nodeInstanceProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>signalRef</sourceRef>\n+        <targetRef>signalProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>eventRef</sourceRef>\n+        <targetRef>eventProcess</targetRef>\n+      </dataOutputAssociation>\n+    </boundaryEvent>\n+  \n+    <scriptTask id=\"_7\" name=\"Timer Caused Script Event\" scriptFormat=\"http://www.java.com/java\" isForCompensation=\"true\">\n+       <script>\n+       \t\tSystem.out.println(\"Timer fired, node instance is: \" + kcontext.getVariable(\"nodeInstanceProcess\"));\n+       \t\tSystem.out.println(\"Timer fired, signal is: \" + kcontext.getVariable(\"signalProcess\"));\n+       \t\tSystem.out.println(\"Timer fired, event is: \" + kcontext.getVariable(\"eventProcess\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzgzNzM5OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDo1Nzo1OVrOHrS6_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDo1Nzo1OVrOHrS6_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2MDgzMQ==", "bodyText": "Should be changed to something like\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       name=\"Boundary Timer Event Example\" \n          \n          \n            \n                       name=\"Boundary Compensation Event Example\"", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515160831", "createdAt": "2020-10-30T14:57:59Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,91 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryCompensationEventProcess\" \n+           name=\"Boundary Timer Event Example\" ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzgzODMzOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDo1ODoxNlrOHrS7nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNDo1ODoxNlrOHrS7nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2MDk4OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <boundaryEvent id=\"_6\" name=\"Timer Event\" attachedToRef=\"_2\">\n          \n          \n            \n                <boundaryEvent id=\"_6\" name=\"Compensation Event\" attachedToRef=\"_2\">", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515160989", "createdAt": "2020-10-30T14:58:16Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,91 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryCompensationEventProcess\" \n+           name=\"Boundary Timer Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+      <userTask id=\"_2\" name=\"Human Task\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+  \n+      <userTask id=\"_3\" name=\"Human Task 2\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+          \n+  \n+    <endEvent id=\"_4\" name=\"End Main Process\">\n+      <terminateEventDefinition/>\n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Timer Event\" attachedToRef=\"_2\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNzg2Mzc2OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNTowNDoyNFrOHrTLoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNTowNDoyNFrOHrTLoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2NTA4OQ==", "bodyText": "This id is already duplicated in the bpmn2.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t<association id=\"_4\" associationDirection=\"One\" sourceRef=\"_6\" targetRef=\"_7\"/>\n          \n          \n            \n            \t<association id=\"_8\" associationDirection=\"One\" sourceRef=\"_6\" targetRef=\"_7\"/>", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515165089", "createdAt": "2020-10-30T15:04:24Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,91 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryCompensationEventProcess\" \n+           name=\"Boundary Timer Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+      <userTask id=\"_2\" name=\"Human Task\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+  \n+      <userTask id=\"_3\" name=\"Human Task 2\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+          \n+  \n+    <endEvent id=\"_4\" name=\"End Main Process\">\n+      <terminateEventDefinition/>\n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Timer Event\" attachedToRef=\"_2\">\n+      <compensateEventDefinition />\n+  \t  <dataOutput id=\"nodeInstanceRef\" name=\"nodeInstance\" />\n+  \t  <dataOutput id=\"signalRef\" name=\"signal\" />\n+  \t  <dataOutput id=\"eventRef\" name=\"event\" />\n+      <outputSet>\n+        <dataOutputRefs>nodeInstanceRef</dataOutputRefs>\n+        <dataOutputRefs>signalRef</dataOutputRefs>\n+        <dataOutputRefs>eventRef</dataOutputRefs>\n+      </outputSet>\n+      <dataOutputAssociation>\n+        <sourceRef>nodeInstanceRef</sourceRef>\n+        <targetRef>nodeInstanceProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>signalRef</sourceRef>\n+        <targetRef>signalProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>eventRef</sourceRef>\n+        <targetRef>eventProcess</targetRef>\n+      </dataOutputAssociation>\n+    </boundaryEvent>\n+  \n+    <scriptTask id=\"_7\" name=\"Timer Caused Script Event\" scriptFormat=\"http://www.java.com/java\" isForCompensation=\"true\">\n+       <script>\n+       \t\tSystem.out.println(\"Timer fired, node instance is: \" + kcontext.getVariable(\"nodeInstanceProcess\"));\n+       \t\tSystem.out.println(\"Timer fired, signal is: \" + kcontext.getVariable(\"signalProcess\"));\n+       \t\tSystem.out.println(\"Timer fired, event is: \" + kcontext.getVariable(\"eventProcess\"));\n+       </script>\n+    </scriptTask>\n+        \n+\n+    <!-- connections -->\n+    <sequenceFlow sourceRef=\"_1\" targetRef=\"_2\" />\n+    <sequenceFlow sourceRef=\"_2\" targetRef=\"_3\" />\n+    <sequenceFlow sourceRef=\"_3\" targetRef=\"_4\" />\n+\n+\t<association id=\"_4\" associationDirection=\"One\" sourceRef=\"_6\" targetRef=\"_7\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyODA2Nzk5OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNTo0OTo0MlrOHrVNsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNTo0OTo0MlrOHrVNsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE5ODM4NQ==", "bodyText": "You could take advantage of an existing and already registered workItem handler already defined in the parent classes and since some of the functionality is pretty much the same, maybe it's worth reusing it instead.", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515198385", "createdAt": "2020-10-30T15:49:42Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,378 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(12, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(5, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(2, logs.size());\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryCompensationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_COMPENSATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_COMPENSATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        completeWork(ksession, humanTaskMockHandler);\n+        ksession.signalEvent(\"Compensation\", \"_2\");\n+        \n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryConditionalSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_CONDITIONAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_CONDITIONAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        ksession.signalEvent(\"RuleFlowStateEvent-\" + PROCESS_CONDITIONAL_NAME + \"-4-_2\" , new org.jbpm.test.entity.Person(1L, \"john\"));\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+\n+       \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns()  { \n+        try {\n+            int sleep = 3000;\n+            logger.debug(\"Sleeping {} seconds\", sleep / 1000);\n+            Thread.sleep(sleep);\n+            logger.debug(\"Awake!\");\n+        } catch(InterruptedException e) {\n+            logger.error(\"System was interrupted\");\n+            fail(\"Junit was interrupted\");\n+        }\n+\n+    }\n+\n+\n+\n+    private static class HumanTaskMockHandler implements WorkItemHandler {\n+\n+        private org.kie.api.runtime.process.WorkItemManager workItemManager;\n+        private org.kie.api.runtime.process.WorkItem workItem;\n+\n+        private boolean error;\n+        \n+        public HumanTaskMockHandler() {\n+            this(false);\n+        }\n+        \n+        public HumanTaskMockHandler(boolean error) {\n+            this.error = error;\n+        }\n+        \n+        public void executeWorkItem(org.kie.api.runtime.process.WorkItem workItem, org.kie.api.runtime.process.WorkItemManager manager) {\n+            this.workItem = workItem;\n+            this.workItemManager = manager;\n+\n+            if(error) {\n+                throw new RuntimeException(\"this is an error\");\n+            }\n+            logger.debug(\"Work completed!\");\n+        }\n+\n+        public void abortWorkItem(org.kie.api.runtime.process.WorkItem workItem, org.kie.api.runtime.process.WorkItemManager manager) {\n+            this.workItemManager.abortWorkItem(workItem.getId());\n+            logger.debug(\"Work aborted.\");\n+        }\n+        \n+\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 377}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjM1MjMyOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo0MDoyNlrOHr5BUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo0MDoyNlrOHr5BUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc4NTA0MA==", "bodyText": "I would set them to log info level so it's easy to know what's going on in the test by just looking at the output", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515785040", "createdAt": "2020-11-02T07:40:26Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,378 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(12, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(5, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(2, logs.size());\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryCompensationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_COMPENSATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_COMPENSATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        completeWork(ksession, humanTaskMockHandler);\n+        ksession.signalEvent(\"Compensation\", \"_2\");\n+        \n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryConditionalSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_CONDITIONAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_CONDITIONAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        ksession.signalEvent(\"RuleFlowStateEvent-\" + PROCESS_CONDITIONAL_NAME + \"-4-_2\" , new org.jbpm.test.entity.Person(1L, \"john\"));\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+\n+       \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns()  { \n+        try {\n+            int sleep = 3000;\n+            logger.debug(\"Sleeping {} seconds\", sleep / 1000);\n+            Thread.sleep(sleep);\n+            logger.debug(\"Awake!\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 336}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjM1NTI2OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo0MTozMFrOHr5DDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwNzo0MTozMFrOHr5DDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc4NTQ4Ng==", "bodyText": "Maybe it's worth passing the exception object to be output in the error log", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515785486", "createdAt": "2020-11-02T07:41:30Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,378 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.manager.audit.VariableInstanceLog;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import junit.framework.Assert;\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANLDER_TASK = \"Human Task\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(12, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(5, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(2, logs.size());\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryCompensationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_COMPENSATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_COMPENSATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        completeWork(ksession, humanTaskMockHandler);\n+        ksession.signalEvent(\"Compensation\", \"_2\");\n+        \n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    @Test\n+    public void testBoundaryConditionalSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_CONDITIONAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANLDER_TASK, humanTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_CONDITIONAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        ksession.signalEvent(\"RuleFlowStateEvent-\" + PROCESS_CONDITIONAL_NAME + \"-4-_2\" , new org.jbpm.test.entity.Person(1L, \"john\"));\n+        List<? extends VariableInstanceLog> logs = getLogService().findVariableInstances(process.getId());\n+        Assert.assertEquals(4, logs.size());\n+\n+       \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+    }\n+    \n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns()  { \n+        try {\n+            int sleep = 3000;\n+            logger.debug(\"Sleeping {} seconds\", sleep / 1000);\n+            Thread.sleep(sleep);\n+            logger.debug(\"Awake!\");\n+        } catch(InterruptedException e) {\n+            logger.error(\"System was interrupted\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4251784fdc2fb51b882cba5ec2e2566e2dca7880"}, "originalPosition": 338}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjU3MjIwOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODo1MDoxNFrOHr7Cmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODo1MDoxNFrOHr7Cmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxODEzOA==", "bodyText": "Not thrown within this method\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n          \n          \n            \n                public void testBoundaryEventTimerAndCompleteHumanTask() {", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515818138", "createdAt": "2020-11-02T08:50:14Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjYzMzAyOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOTowNzowOVrOHr7muA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOTowNzowOVrOHr7muA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgyNzM4NA==", "bodyText": "same as above", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515827384", "createdAt": "2020-11-02T09:07:09Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjY1MTQ0OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxMjoyMVrOHr7xnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxMjoyMVrOHr7xnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzMDE3Mw==", "bodyText": "workItemProcess is not defined in this process", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515830173", "createdAt": "2020-11-02T09:12:21Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,114 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xmlns:drools=\"http://www.jboss.org/drools\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <message id=\"messageRef\" name=\"MyMessage\" itemRef=\"item_message_ref\"/>\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryMessageEventProcess\" \n+           name=\"Boundary Message Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+      <userTask id=\"_2\" name=\"Human Task\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+      \n+  \n+    <endEvent id=\"_3\" name=\"End Main Process\">\n+      <terminateEventDefinition/>\n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Message Event\" attachedToRef=\"_2\" cancelActivity=\"false\">\n+      <messageEventDefinition messageRef=\"messageRef\"/>\n+  \t  <dataOutput id=\"nodeInstanceRef\" name=\"nodeInstance\" />\n+  \t  <dataOutput id=\"signalRef\" name=\"signal\" />\n+  \t  <dataOutput id=\"eventRef\" name=\"event\" />\n+      <outputSet>\n+        <dataOutputRefs>nodeInstanceRef</dataOutputRefs>\n+        <dataOutputRefs>signalRef</dataOutputRefs>\n+        <dataOutputRefs>eventRef</dataOutputRefs>\n+      </outputSet>\n+      <dataOutputAssociation>\n+        <sourceRef>nodeInstanceRef</sourceRef>\n+        <targetRef>nodeInstanceProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>signalRef</sourceRef>\n+        <targetRef>signalProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>eventRef</sourceRef>\n+        <targetRef>eventProcess</targetRef>\n+      </dataOutputAssociation>\n+    </boundaryEvent>\n+  \n+  \t<task id=\"_7\" drools:taskName=\"DataCaptureTask\">\n+  \t\t<ioSpecification>\n+\t\t\t<dataInput id=\"nodeInstanceRef\" name=\"nodeInstance\"/>\n+\t\t\t<dataInput id=\"signalRef\" name=\"signal\"/>\n+\t\t\t<dataInput id=\"eventRef\" name=\"event\"/>\n+\t\t\t<dataInput id=\"workItemRef\" name=\"workItem\"/>\n+\t\t\t<inputSet>\n+\t\t  \t\t<dataInputRefs>nodeInstanceRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>signalRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>eventRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>workItemRef</dataInputRefs>\n+\t\t\t</inputSet>\n+\t\t\t<outputSet>\n+\t\t\t</outputSet>\n+\t    </ioSpecification>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>nodeInstanceProcess</sourceRef>\n+\t\t\t<targetRef>nodeInstanceRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>signalProcess</sourceRef>\n+\t\t\t<targetRef>signalRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t    <dataInputAssociation>\n+\t\t\t<sourceRef>eventProcess</sourceRef>\n+\t\t\t<targetRef>eventRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>workItemProcess</sourceRef>\n+\t\t\t<targetRef>workItemRef</targetRef>\n+\t\t</dataInputAssociation>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjY1Mzc0OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxMzowOVrOHr7zDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxMzowOVrOHr7zDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzMDU0Mg==", "bodyText": "would rename to some other package name more related to this messaging process.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.timer\" >\n          \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.message\" >", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515830542", "createdAt": "2020-11-02T09:13:09Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,114 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xmlns:drools=\"http://www.jboss.org/drools\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <message id=\"messageRef\" name=\"MyMessage\" itemRef=\"item_message_ref\"/>\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryMessageEventProcess\" \n+           name=\"Boundary Message Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjY2MjIzOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxNToxMVrOHr73yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxNToxMVrOHr73yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzMTc1NA==", "bodyText": "Shouldn't we add a check for workItem param here as well?", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515831754", "createdAt": "2020-11-02T09:15:11Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 150}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjY2MzUzOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxNTozMFrOHr74kA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxNTozMFrOHr74kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzMTk1Mg==", "bodyText": "same as above", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515831952", "createdAt": "2020-11-02T09:15:30Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 154}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjY3MzUxOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxODoxMFrOHr7-hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxODoxMFrOHr7-hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzMzQ3Nw==", "bodyText": "Shouldn't we add a check for workItem param here as well?", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515833477", "createdAt": "2020-11-02T09:18:10Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 188}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjY3NDcxOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxODozMlrOHr7_Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxODozMlrOHr7_Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzMzY4Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.timer\" >\n          \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.signals\" >", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515833682", "createdAt": "2020-11-02T09:18:32Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,113 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <signal id=\"signalRef\" name=\"MySignal\" structureRef=\"Object\"/>\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundarySignalEventProcess\" \n+           name=\"Boundary Signal Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjY3NzcwOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxOToyMVrOHr8BHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToxOToyMVrOHr8BHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzNDE0MQ==", "bodyText": "workItemProcess is not defined in this process", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515834141", "createdAt": "2020-11-02T09:19:21Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,113 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <signal id=\"signalRef\" name=\"MySignal\" structureRef=\"Object\"/>\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundarySignalEventProcess\" \n+           name=\"Boundary Signal Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+      <userTask id=\"_2\" name=\"Human Task\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+      \n+  \n+    <endEvent id=\"_3\" name=\"End Main Process\">\n+      <terminateEventDefinition/>\n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Signal Event\" attachedToRef=\"_2\" cancelActivity=\"false\">\n+      <signalEventDefinition id=\"_EERwABnzEeu2L4IddwlS5w\" signalRef=\"signalRef\"/>\n+  \t  <dataOutput id=\"nodeInstanceRef\" name=\"nodeInstance\" />\n+  \t  <dataOutput id=\"signalRef\" name=\"signal\" />\n+  \t  <dataOutput id=\"eventRef\" name=\"event\" />\n+      <outputSet>\n+        <dataOutputRefs>nodeInstanceRef</dataOutputRefs>\n+        <dataOutputRefs>signalRef</dataOutputRefs>\n+        <dataOutputRefs>eventRef</dataOutputRefs>\n+      </outputSet>\n+      <dataOutputAssociation>\n+        <sourceRef>nodeInstanceRef</sourceRef>\n+        <targetRef>nodeInstanceProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>signalRef</sourceRef>\n+        <targetRef>signalProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>eventRef</sourceRef>\n+        <targetRef>eventProcess</targetRef>\n+      </dataOutputAssociation>\n+    </boundaryEvent>\n+  \n+  \t<task id=\"_7\" drools:taskName=\"DataCaptureTask\">\n+  \t\t<ioSpecification>\n+\t\t\t<dataInput id=\"nodeInstanceRef\" name=\"nodeInstance\"/>\n+\t\t\t<dataInput id=\"signalRef\" name=\"signal\"/>\n+\t\t\t<dataInput id=\"eventRef\" name=\"event\"/>\n+\t\t\t<dataInput id=\"workItemRef\" name=\"workItem\"/>\n+\t\t\t<inputSet>\n+\t\t  \t\t<dataInputRefs>nodeInstanceRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>signalRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>eventRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>workItemRef</dataInputRefs>\n+\t\t\t</inputSet>\n+\t\t\t<outputSet>\n+\t\t\t</outputSet>\n+\t    </ioSpecification>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>nodeInstanceProcess</sourceRef>\n+\t\t\t<targetRef>nodeInstanceRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>signalProcess</sourceRef>\n+\t\t\t<targetRef>signalRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t    <dataInputAssociation>\n+\t\t\t<sourceRef>eventProcess</sourceRef>\n+\t\t\t<targetRef>eventRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>workItemProcess</sourceRef>\n+\t\t\t<targetRef>workItemRef</targetRef>\n+\t\t</dataInputAssociation>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjY5MDY2OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToyMjozNlrOHr8Ipw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToyMjozNlrOHr8Ipw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzNjA3MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.timer\" >\n          \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.error\" >", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515836071", "createdAt": "2020-11-02T09:22:36Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,114 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <error id=\"errorRef\" errorCode=\"401\" structureRef=\"java.lang.RuntimeException\" />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryErrorEventProcess\" \n+           name=\"Boundary Error Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjY5MzI4OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToyMzoxN1rOHr8KOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToyMzoxN1rOHr8KOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzNjQ3NQ==", "bodyText": "workItemProcess is not defined in this process", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515836475", "createdAt": "2020-11-02T09:23:17Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,114 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <error id=\"errorRef\" errorCode=\"401\" structureRef=\"java.lang.RuntimeException\" />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryErrorEventProcess\" \n+           name=\"Boundary Error Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+      <userTask id=\"_2\" name=\"Human Task\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+      \n+  \n+    <endEvent id=\"_3\" name=\"End Main Process\">\n+ \n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Timer Event\" attachedToRef=\"_2\" cancelActivity=\"false\">\n+      <errorEventDefinition errorRef=\"errorRef\"/>\n+  \t  <dataOutput id=\"nodeInstanceRef\" name=\"nodeInstance\" />\n+  \t  <dataOutput id=\"signalRef\" name=\"signal\" />\n+  \t  <dataOutput id=\"eventRef\" name=\"event\" />\n+      <outputSet>\n+        <dataOutputRefs>nodeInstanceRef</dataOutputRefs>\n+        <dataOutputRefs>signalRef</dataOutputRefs>\n+        <dataOutputRefs>eventRef</dataOutputRefs>\n+      </outputSet>\n+      <dataOutputAssociation>\n+        <sourceRef>nodeInstanceRef</sourceRef>\n+        <targetRef>nodeInstanceProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>signalRef</sourceRef>\n+        <targetRef>signalProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>eventRef</sourceRef>\n+        <targetRef>eventProcess</targetRef>\n+      </dataOutputAssociation>\n+    </boundaryEvent>\n+  \n+  \t<task id=\"_7\" drools:taskName=\"DataCaptureTask\">\n+  \t\t<ioSpecification>\n+\t\t\t<dataInput id=\"nodeInstanceRef\" name=\"nodeInstance\"/>\n+\t\t\t<dataInput id=\"signalRef\" name=\"signal\"/>\n+\t\t\t<dataInput id=\"eventRef\" name=\"event\"/>\n+\t\t\t<dataInput id=\"workItemRef\" name=\"workItem\"/>\n+\t\t\t<inputSet>\n+\t\t  \t\t<dataInputRefs>nodeInstanceRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>signalRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>eventRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>workItemRef</dataInputRefs>\n+\t\t\t</inputSet>\n+\t\t\t<outputSet>\n+\t\t\t</outputSet>\n+\t    </ioSpecification>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>nodeInstanceProcess</sourceRef>\n+\t\t\t<targetRef>nodeInstanceRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>signalProcess</sourceRef>\n+\t\t\t<targetRef>signalRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t    <dataInputAssociation>\n+\t\t\t<sourceRef>eventProcess</sourceRef>\n+\t\t\t<targetRef>eventRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>workItemProcess</sourceRef>\n+\t\t\t<targetRef>workItemRef</targetRef>\n+\t\t</dataInputAssociation>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjcxNjMyOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToyODo0MFrOHr8XgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOToyODo0MFrOHr8XgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzOTg3Mg==", "bodyText": "TimeUnit.SECONDS.sleep(3); is recommended, but up to you, not an issue", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515839872", "createdAt": "2020-11-02T09:28:40Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof CompositeContextNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Escalation-_2-201\");\n+        assertNull(dataTaskMockHandler.getInputParameter(\"event\"));\n+    }\n+    \n+    @Test\n+    public void testBoundaryCompensationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_COMPENSATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_COMPENSATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        completeWork(ksession, humanTaskMockHandler);\n+        ksession.signalEvent(\"Compensation\", \"_2\");\n+        \n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertNull(dataTaskMockHandler.getInputParameter(\"nodeInstance\"));\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), \"_2\");\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Compensation\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryConditionalSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_CONDITIONAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_CONDITIONAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        ksession.signalEvent(\"RuleFlowStateEvent-\" + PROCESS_CONDITIONAL_NAME + \"-4-_2\" , new org.jbpm.test.entity.Person(1L, \"john\"));\n+       \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"RuleFlowStateEvent-BoundaryConditionalEventProcess-4-_2\");\n+    }\n+    \n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns()  { \n+        try {\n+            int sleep = 3000;\n+            logger.debug(\"Sleeping {} seconds\", sleep / 1000);\n+            Thread.sleep(sleep);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 350}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjgzODM4OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOTo1OToyNlrOHr9gTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOTo1OToyNlrOHr9gTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg1ODUwOA==", "bodyText": "same as above", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515858508", "createdAt": "2020-11-02T09:59:26Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 192}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjg0MTAzOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowMDowM1rOHr9h3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowMDowM1rOHr9h3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg1ODkxMQ==", "bodyText": "Shouldn't we check for workItem as well?", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515858911", "createdAt": "2020-11-02T10:00:03Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 217}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjg0MTcwOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowMDoxNVrOHr9iWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowMDoxNVrOHr9iWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg1OTAzMw==", "bodyText": "same as above", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515859033", "createdAt": "2020-11-02T10:00:15Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 222}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjg0NzM0OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowMTo0N1rOHr9l0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowMTo0N1rOHr9l0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg1OTkyMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.timer\" >\n          \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.escalation\" >", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515859922", "createdAt": "2020-11-02T10:01:47Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,121 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <escalation id=\"escalationRef\" escalationCode=\"201\" />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryEscalationEventProcess\" \n+           name=\"Boundary Escalation Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjg1MDE5OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowMjoyOVrOHr9njQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowMjoyOVrOHr9njQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2MDM2NQ==", "bodyText": "workItemProcess is not defined in this process", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515860365", "createdAt": "2020-11-02T10:02:29Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,121 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <escalation id=\"escalationRef\" escalationCode=\"201\" />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryEscalationEventProcess\" \n+           name=\"Boundary Escalation Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+\t<subProcess id=\"_2\" name=\"service-subprocess\">\n+      <startEvent id=\"_2-1\" name=\"StartSubProcess\" />\n+\n+      <intermediateThrowEvent id=\"_2-4\" name=\"ErrorEvent\">\n+        <escalationEventDefinition escalationRef=\"escalationRef\" />\n+      </intermediateThrowEvent>\n+\n+      <endEvent id=\"_2-11\" />\n+\n+\t  <sequenceFlow id=\"_2-1-_2-2\" sourceRef=\"_2-1\" targetRef=\"_2-4\" />\n+      <sequenceFlow id=\"_2-5-_2-11\" sourceRef=\"_2-4\" targetRef=\"_2-11\" />\n+\n+    </subProcess>\n+      \n+  \n+    <endEvent id=\"_3\" name=\"End Main Process\">\n+      <terminateEventDefinition/>\n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Escalation Event\" attachedToRef=\"_2\" cancelActivity=\"false\">\n+      <escalationEventDefinition escalationRef=\"escalationRef\"/>\n+  \t  <dataOutput id=\"nodeInstanceRef\" name=\"nodeInstance\" />\n+  \t  <dataOutput id=\"signalRef\" name=\"signal\" />\n+  \t  <dataOutput id=\"eventRef\" name=\"event\" />\n+      <outputSet>\n+        <dataOutputRefs>nodeInstanceRef</dataOutputRefs>\n+        <dataOutputRefs>signalRef</dataOutputRefs>\n+        <dataOutputRefs>eventRef</dataOutputRefs>\n+      </outputSet>\n+      <dataOutputAssociation>\n+        <sourceRef>nodeInstanceRef</sourceRef>\n+        <targetRef>nodeInstanceProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>signalRef</sourceRef>\n+        <targetRef>signalProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>eventRef</sourceRef>\n+        <targetRef>eventProcess</targetRef>\n+      </dataOutputAssociation>\n+    </boundaryEvent>\n+  \n+  \t<task id=\"_7\" drools:taskName=\"DataCaptureTask\">\n+  \t\t<ioSpecification>\n+\t\t\t<dataInput id=\"nodeInstanceRef\" name=\"nodeInstance\"/>\n+\t\t\t<dataInput id=\"signalRef\" name=\"signal\"/>\n+\t\t\t<dataInput id=\"eventRef\" name=\"event\"/>\n+\t\t\t<dataInput id=\"workItemRef\" name=\"workItem\"/>\n+\t\t\t<inputSet>\n+\t\t  \t\t<dataInputRefs>nodeInstanceRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>signalRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>eventRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>workItemRef</dataInputRefs>\n+\t\t\t</inputSet>\n+\t\t\t<outputSet>\n+\t\t\t</outputSet>\n+\t    </ioSpecification>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>nodeInstanceProcess</sourceRef>\n+\t\t\t<targetRef>nodeInstanceRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>signalProcess</sourceRef>\n+\t\t\t<targetRef>signalRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t    <dataInputAssociation>\n+\t\t\t<sourceRef>eventProcess</sourceRef>\n+\t\t\t<targetRef>eventRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>workItemProcess</sourceRef>\n+\t\t\t<targetRef>workItemRef</targetRef>\n+\t\t</dataInputAssociation>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjg1OTM0OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowNTowNlrOHr9tRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowNTowNlrOHr9tRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2MTgyOA==", "bodyText": "This is not needed for this test", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515861828", "createdAt": "2020-11-02T10:05:06Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 231}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjg2MTEwOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowNTozNFrOHr9uUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowNTozNFrOHr9uUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2MjA5Ng==", "bodyText": "Shouldn't we check workItem as well?", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515862096", "createdAt": "2020-11-02T10:05:34Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof CompositeContextNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Escalation-_2-201\");\n+        assertNull(dataTaskMockHandler.getInputParameter(\"event\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 252}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjg2Mzc4OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowNjoxOFrOHr9v8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowNjoxOFrOHr9v8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2MjUxNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.timer\" >\n          \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.compensation\" >", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515862515", "createdAt": "2020-11-02T10:06:18Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,117 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryCompensationEventProcess\" \n+           name=\"Boundary Compensation Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjg3NTEwOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowOToxNlrOHr93Cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDowOToxNlrOHr93Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2NDMzMQ==", "bodyText": "workItemProcess is not defined in this process", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515864331", "createdAt": "2020-11-02T10:09:16Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,117 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryCompensationEventProcess\" \n+           name=\"Boundary Compensation Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+      <userTask id=\"_2\" name=\"Human Task\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+  \n+      <userTask id=\"_3\" name=\"Human Task 2\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+          \n+  \n+    <endEvent id=\"_4\" name=\"End Main Process\">\n+      <terminateEventDefinition/>\n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Timer Event\" attachedToRef=\"_2\">\n+      <compensateEventDefinition />\n+  \t  <dataOutput id=\"nodeInstanceRef\" name=\"nodeInstance\" />\n+  \t  <dataOutput id=\"signalRef\" name=\"signal\" />\n+  \t  <dataOutput id=\"eventRef\" name=\"event\" />\n+      <outputSet>\n+        <dataOutputRefs>nodeInstanceRef</dataOutputRefs>\n+        <dataOutputRefs>signalRef</dataOutputRefs>\n+        <dataOutputRefs>eventRef</dataOutputRefs>\n+      </outputSet>\n+      <dataOutputAssociation>\n+        <sourceRef>nodeInstanceRef</sourceRef>\n+        <targetRef>nodeInstanceProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>signalRef</sourceRef>\n+        <targetRef>signalProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>eventRef</sourceRef>\n+        <targetRef>eventProcess</targetRef>\n+      </dataOutputAssociation>\n+    </boundaryEvent>\n+  \n+  \t<task id=\"_7\" drools:taskName=\"DataCaptureTask\">\n+  \t\t<ioSpecification>\n+\t\t\t<dataInput id=\"nodeInstanceRef\" name=\"nodeInstance\"/>\n+\t\t\t<dataInput id=\"signalRef\" name=\"signal\"/>\n+\t\t\t<dataInput id=\"eventRef\" name=\"event\"/>\n+\t\t\t<dataInput id=\"workItemRef\" name=\"workItem\"/>\n+\t\t\t<inputSet>\n+\t\t  \t\t<dataInputRefs>nodeInstanceRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>signalRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>eventRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>workItemRef</dataInputRefs>\n+\t\t\t</inputSet>\n+\t\t\t<outputSet>\n+\t\t\t</outputSet>\n+\t    </ioSpecification>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>nodeInstanceProcess</sourceRef>\n+\t\t\t<targetRef>nodeInstanceRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>signalProcess</sourceRef>\n+\t\t\t<targetRef>signalRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t    <dataInputAssociation>\n+\t\t\t<sourceRef>eventProcess</sourceRef>\n+\t\t\t<targetRef>eventRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>workItemProcess</sourceRef>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjkwMTY4OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxNTozM1rOHr-GeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxNTozM1rOHr-GeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2ODI4MA==", "bodyText": "same as above", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515868280", "createdAt": "2020-11-02T10:15:33Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof CompositeContextNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Escalation-_2-201\");\n+        assertNull(dataTaskMockHandler.getInputParameter(\"event\"));\n+    }\n+    \n+    @Test\n+    public void testBoundaryCompensationSignalAndCompleteHumanTask() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 256}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjkwMjY0OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxNTo0OFrOHr-HBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxNTo0OFrOHr-HBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2ODQyMA==", "bodyText": "shouldn't we check workItem as well?", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515868420", "createdAt": "2020-11-02T10:15:48Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof CompositeContextNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Escalation-_2-201\");\n+        assertNull(dataTaskMockHandler.getInputParameter(\"event\"));\n+    }\n+    \n+    @Test\n+    public void testBoundaryCompensationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_COMPENSATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_COMPENSATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        completeWork(ksession, humanTaskMockHandler);\n+        ksession.signalEvent(\"Compensation\", \"_2\");\n+        \n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertNull(dataTaskMockHandler.getInputParameter(\"nodeInstance\"));\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), \"_2\");\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Compensation\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 290}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjkwMzYyOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxNTo1OFrOHr-Hiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxNTo1OFrOHr-Hiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2ODU1NQ==", "bodyText": "same as above", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515868555", "createdAt": "2020-11-02T10:15:58Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof CompositeContextNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Escalation-_2-201\");\n+        assertNull(dataTaskMockHandler.getInputParameter(\"event\"));\n+    }\n+    \n+    @Test\n+    public void testBoundaryCompensationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_COMPENSATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_COMPENSATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        completeWork(ksession, humanTaskMockHandler);\n+        ksession.signalEvent(\"Compensation\", \"_2\");\n+        \n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertNull(dataTaskMockHandler.getInputParameter(\"nodeInstance\"));\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), \"_2\");\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Compensation\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryConditionalSignalAndCompleteHumanTask() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 294}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjkwNDY5OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxNjoxNFrOHr-IKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxNjoxNFrOHr-IKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2ODcxNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.timer\" >\n          \n          \n            \n                       tns:packageName=\"org.jbpm.persistence.conditional\" >", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515868715", "createdAt": "2020-11-02T10:16:14Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,116 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+            xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <escalation id=\"escalationRef\" escalationCode=\"201\" />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryConditionalEventProcess\" \n+           name=\"Boundary Conditional Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjkwNzUwOnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxNjo1NlrOHr-J0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDoyNjowOFrOHsGjog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2OTEzOQ==", "bodyText": "Not needed", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515869139", "createdAt": "2020-11-02T10:16:56Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,116 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+            xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <escalation id=\"escalationRef\" escalationCode=\"201\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAwNjgxOA==", "bodyText": "removed", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r516006818", "createdAt": "2020-11-02T14:26:08Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,116 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+            xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <escalation id=\"escalationRef\" escalationCode=\"201\" />", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2OTEzOQ=="}, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjkwODk0OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxNzoxOFrOHr-KrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDoxODo1N1rOHsGQTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2OTM1Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <boundaryEvent id=\"_6\" name=\"Timer Event\" attachedToRef=\"_2\" cancelActivity=\"false\">\n          \n          \n            \n                <boundaryEvent id=\"_6\" name=\"Conditional Event\" attachedToRef=\"_2\" cancelActivity=\"false\">", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515869357", "createdAt": "2020-11-02T10:17:18Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,116 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+            xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <escalation id=\"escalationRef\" escalationCode=\"201\" />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryConditionalEventProcess\" \n+           name=\"Boundary Conditional Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+      <userTask id=\"_2\" name=\"Human Task\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+      \n+  \n+    <endEvent id=\"_3\" name=\"End Main Process\">\n+      <terminateEventDefinition/>\n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Timer Event\" attachedToRef=\"_2\" cancelActivity=\"false\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAwMTg3MQ==", "bodyText": "done", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r516001871", "createdAt": "2020-11-02T14:18:57Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,116 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+            xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <escalation id=\"escalationRef\" escalationCode=\"201\" />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryConditionalEventProcess\" \n+           name=\"Boundary Conditional Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+      <userTask id=\"_2\" name=\"Human Task\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+      \n+  \n+    <endEvent id=\"_3\" name=\"End Main Process\">\n+      <terminateEventDefinition/>\n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Timer Event\" attachedToRef=\"_2\" cancelActivity=\"false\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2OTM1Nw=="}, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjkxMDQ2OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxNzo0MlrOHr-Lhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDoyMDoxOFrOHsGT-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2OTU3NA==", "bodyText": "workItemProcess is not defined in this process", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515869574", "createdAt": "2020-11-02T10:17:42Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,116 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+            xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <escalation id=\"escalationRef\" escalationCode=\"201\" />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryConditionalEventProcess\" \n+           name=\"Boundary Conditional Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+      <userTask id=\"_2\" name=\"Human Task\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+      \n+  \n+    <endEvent id=\"_3\" name=\"End Main Process\">\n+      <terminateEventDefinition/>\n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Timer Event\" attachedToRef=\"_2\" cancelActivity=\"false\">\n+      <conditionalEventDefinition id=\"_AzlHbBoLEeu2L4IddwlS5w\">\n+        <condition xsi:type=\"tFormalExpression\" id=\"FormalExpression_1\" language=\"http://www.jboss.org/drools/rule\">org.jbpm.test.entity.Person(fullName == &quot;john&quot;)</condition>\n+      </conditionalEventDefinition>\n+  \t  <dataOutput id=\"nodeInstanceRef\" name=\"nodeInstance\" />\n+  \t  <dataOutput id=\"signalRef\" name=\"signal\" />\n+  \t  <dataOutput id=\"eventRef\" name=\"event\" />\n+      <outputSet>\n+        <dataOutputRefs>nodeInstanceRef</dataOutputRefs>\n+        <dataOutputRefs>signalRef</dataOutputRefs>\n+        <dataOutputRefs>eventRef</dataOutputRefs>\n+      </outputSet>\n+      <dataOutputAssociation>\n+        <sourceRef>nodeInstanceRef</sourceRef>\n+        <targetRef>nodeInstanceProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>signalRef</sourceRef>\n+        <targetRef>signalProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>eventRef</sourceRef>\n+        <targetRef>eventProcess</targetRef>\n+      </dataOutputAssociation>\n+    </boundaryEvent>\n+  \n+  \t<task id=\"_7\" drools:taskName=\"DataCaptureTask\">\n+  \t\t<ioSpecification>\n+\t\t\t<dataInput id=\"nodeInstanceRef\" name=\"nodeInstance\"/>\n+\t\t\t<dataInput id=\"signalRef\" name=\"signal\"/>\n+\t\t\t<dataInput id=\"eventRef\" name=\"event\"/>\n+\t\t\t<dataInput id=\"workItemRef\" name=\"workItem\"/>\n+\t\t\t<inputSet>\n+\t\t  \t\t<dataInputRefs>nodeInstanceRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>signalRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>eventRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>workItemRef</dataInputRefs>\n+\t\t\t</inputSet>\n+\t\t\t<outputSet>\n+\t\t\t</outputSet>\n+\t    </ioSpecification>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>nodeInstanceProcess</sourceRef>\n+\t\t\t<targetRef>nodeInstanceRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>signalProcess</sourceRef>\n+\t\t\t<targetRef>signalRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t    <dataInputAssociation>\n+\t\t\t<sourceRef>eventProcess</sourceRef>\n+\t\t\t<targetRef>eventRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>workItemProcess</sourceRef>\n+\t\t\t<targetRef>workItemRef</targetRef>\n+\t\t</dataInputAssociation>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAwMjgxMQ==", "bodyText": "added.", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r516002811", "createdAt": "2020-11-02T14:20:18Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/resources/org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2", "diffHunk": "@@ -0,0 +1,116 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?> \n+<definitions id=\"Definition\"\n+             typeLanguage=\"http://www.java.com/javaTypes\"\n+             expressionLanguage=\"http://www.mvel.org/2.0\"\n+             xmlns=\"http://www.omg.org/spec/BPMN/20100524/MODEL\"\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+             xsi:schemaLocation=\"http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd\"\n+            xmlns:drools=\"http://www.jboss.org/drools\"\n+             xmlns:g=\"http://www.jboss.org/drools/flow/gpd\"\n+             xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\"\n+             xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\"\n+             xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\"\n+             xmlns:tns=\"http://www.jboss.org/drools\">\n+             \n+  <itemDefinition id=\"item_nodeInstance_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_signal_ref_process\" structureRef=\"String\"  />\n+  <itemDefinition id=\"item_event_ref_process\" structureRef=\"Object\"  />\n+  <itemDefinition id=\"item_message_ref\" structureRef=\"Object\"  />\n+  <escalation id=\"escalationRef\" escalationCode=\"201\" />\n+\t\n+  <process processType=\"Private\" \n+           isExecutable=\"true\"\n+           id=\"BoundaryConditionalEventProcess\" \n+           name=\"Boundary Conditional Event Example\" \n+           tns:packageName=\"org.jbpm.persistence.timer\" >\n+\n+\t<property id=\"nodeInstanceProcess\" itemSubjectRef=\"item_nodeInstance_ref_process\"/>\n+\t<property id=\"signalProcess\" itemSubjectRef=\"item_signal_ref_process\"/>\n+\t<property id=\"eventProcess\" itemSubjectRef=\"item_event_ref_process\"/>\n+\t\n+    <!-- nodes -->\n+    <startEvent id=\"_1\" name=\"StartProcess\" />\n+\n+      <userTask id=\"_2\" name=\"Human Task\" tns:taskName=\"Human Task\" >\n+        <ioSpecification>\n+          <inputSet></inputSet>\n+          <outputSet></outputSet>\n+        </ioSpecification>\n+      </userTask>\n+      \n+  \n+    <endEvent id=\"_3\" name=\"End Main Process\">\n+      <terminateEventDefinition/>\n+    </endEvent>\n+  \n+    <boundaryEvent id=\"_6\" name=\"Timer Event\" attachedToRef=\"_2\" cancelActivity=\"false\">\n+      <conditionalEventDefinition id=\"_AzlHbBoLEeu2L4IddwlS5w\">\n+        <condition xsi:type=\"tFormalExpression\" id=\"FormalExpression_1\" language=\"http://www.jboss.org/drools/rule\">org.jbpm.test.entity.Person(fullName == &quot;john&quot;)</condition>\n+      </conditionalEventDefinition>\n+  \t  <dataOutput id=\"nodeInstanceRef\" name=\"nodeInstance\" />\n+  \t  <dataOutput id=\"signalRef\" name=\"signal\" />\n+  \t  <dataOutput id=\"eventRef\" name=\"event\" />\n+      <outputSet>\n+        <dataOutputRefs>nodeInstanceRef</dataOutputRefs>\n+        <dataOutputRefs>signalRef</dataOutputRefs>\n+        <dataOutputRefs>eventRef</dataOutputRefs>\n+      </outputSet>\n+      <dataOutputAssociation>\n+        <sourceRef>nodeInstanceRef</sourceRef>\n+        <targetRef>nodeInstanceProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>signalRef</sourceRef>\n+        <targetRef>signalProcess</targetRef>\n+      </dataOutputAssociation>\n+      <dataOutputAssociation>\n+        <sourceRef>eventRef</sourceRef>\n+        <targetRef>eventProcess</targetRef>\n+      </dataOutputAssociation>\n+    </boundaryEvent>\n+  \n+  \t<task id=\"_7\" drools:taskName=\"DataCaptureTask\">\n+  \t\t<ioSpecification>\n+\t\t\t<dataInput id=\"nodeInstanceRef\" name=\"nodeInstance\"/>\n+\t\t\t<dataInput id=\"signalRef\" name=\"signal\"/>\n+\t\t\t<dataInput id=\"eventRef\" name=\"event\"/>\n+\t\t\t<dataInput id=\"workItemRef\" name=\"workItem\"/>\n+\t\t\t<inputSet>\n+\t\t  \t\t<dataInputRefs>nodeInstanceRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>signalRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>eventRef</dataInputRefs>\n+\t\t  \t\t<dataInputRefs>workItemRef</dataInputRefs>\n+\t\t\t</inputSet>\n+\t\t\t<outputSet>\n+\t\t\t</outputSet>\n+\t    </ioSpecification>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>nodeInstanceProcess</sourceRef>\n+\t\t\t<targetRef>nodeInstanceRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>signalProcess</sourceRef>\n+\t\t\t<targetRef>signalRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t    <dataInputAssociation>\n+\t\t\t<sourceRef>eventProcess</sourceRef>\n+\t\t\t<targetRef>eventRef</targetRef>\n+\t\t</dataInputAssociation>\n+\t\t<dataInputAssociation>\n+\t\t\t<sourceRef>workItemProcess</sourceRef>\n+\t\t\t<targetRef>workItemRef</targetRef>\n+\t\t</dataInputAssociation>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg2OTU3NA=="}, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 102}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjkxNTc1OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoxOTowNFrOHr-OrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDoyMjozMVrOHsGZ3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg3MDM4MA==", "bodyText": "Shouldn't we check workItem here as well?", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515870380", "createdAt": "2020-11-02T10:19:04Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof CompositeContextNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Escalation-_2-201\");\n+        assertNull(dataTaskMockHandler.getInputParameter(\"event\"));\n+    }\n+    \n+    @Test\n+    public void testBoundaryCompensationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_COMPENSATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_COMPENSATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        completeWork(ksession, humanTaskMockHandler);\n+        ksession.signalEvent(\"Compensation\", \"_2\");\n+        \n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertNull(dataTaskMockHandler.getInputParameter(\"nodeInstance\"));\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), \"_2\");\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Compensation\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryConditionalSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_CONDITIONAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_CONDITIONAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        ksession.signalEvent(\"RuleFlowStateEvent-\" + PROCESS_CONDITIONAL_NAME + \"-4-_2\" , new org.jbpm.test.entity.Person(1L, \"john\"));\n+       \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"RuleFlowStateEvent-BoundaryConditionalEventProcess-4-_2\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 327}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAwNDMxNg==", "bodyText": "done", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r516004316", "createdAt": "2020-11-02T14:22:31Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof CompositeContextNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Escalation-_2-201\");\n+        assertNull(dataTaskMockHandler.getInputParameter(\"event\"));\n+    }\n+    \n+    @Test\n+    public void testBoundaryCompensationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_COMPENSATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_COMPENSATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        completeWork(ksession, humanTaskMockHandler);\n+        ksession.signalEvent(\"Compensation\", \"_2\");\n+        \n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertNull(dataTaskMockHandler.getInputParameter(\"nodeInstance\"));\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), \"_2\");\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Compensation\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryConditionalSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_CONDITIONAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_CONDITIONAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        ksession.signalEvent(\"RuleFlowStateEvent-\" + PROCESS_CONDITIONAL_NAME + \"-4-_2\" , new org.jbpm.test.entity.Person(1L, \"john\"));\n+       \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"RuleFlowStateEvent-BoundaryConditionalEventProcess-4-_2\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg3MDM4MA=="}, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 327}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjkyMDY5OnYy", "diffSide": "RIGHT", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMDoyMDowN1rOHr-Rgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDoyMTo0MFrOHsGXpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg3MTEwNg==", "bodyText": "we don't need to use fully qualified class name for them", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r515871106", "createdAt": "2020-11-02T10:20:07Z", "author": {"login": "afalhambra"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof CompositeContextNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Escalation-_2-201\");\n+        assertNull(dataTaskMockHandler.getInputParameter(\"event\"));\n+    }\n+    \n+    @Test\n+    public void testBoundaryCompensationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_COMPENSATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_COMPENSATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        completeWork(ksession, humanTaskMockHandler);\n+        ksession.signalEvent(\"Compensation\", \"_2\");\n+        \n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertNull(dataTaskMockHandler.getInputParameter(\"nodeInstance\"));\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), \"_2\");\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Compensation\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryConditionalSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_CONDITIONAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_CONDITIONAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        ksession.signalEvent(\"RuleFlowStateEvent-\" + PROCESS_CONDITIONAL_NAME + \"-4-_2\" , new org.jbpm.test.entity.Person(1L, \"john\"));\n+       \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"RuleFlowStateEvent-BoundaryConditionalEventProcess-4-_2\");\n+    }\n+    \n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns()  { \n+        try {\n+            int sleep = 3000;\n+            logger.debug(\"Sleeping {} seconds\", sleep / 1000);\n+            Thread.sleep(sleep);\n+            logger.debug(\"Awake!\");\n+        } catch(InterruptedException e) {\n+            logger.error(\"System was interrupted\");\n+            fail(\"Junit was interrupted\");\n+        }\n+\n+    }\n+\n+\n+\n+    private static class HumanTaskMockHandler implements WorkItemHandler {\n+\n+        private org.kie.api.runtime.process.WorkItemManager workItemManager;\n+        private org.kie.api.runtime.process.WorkItem workItem;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 364}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAwMzc1MQ==", "bodyText": "removed", "url": "https://github.com/kiegroup/jbpm/pull/1773#discussion_r516003751", "createdAt": "2020-11-02T14:21:40Z", "author": {"login": "elguardian"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/event/BoundaryEventWithOutputSetPersistenceTest.java", "diffHunk": "@@ -0,0 +1,415 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.functional.event;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.drools.core.process.instance.WorkItemHandler;\n+import org.jbpm.test.JbpmTestCase;\n+import org.jbpm.test.entity.Person;\n+import org.jbpm.workflow.instance.node.CompositeContextNodeInstance;\n+import org.jbpm.workflow.instance.node.HumanTaskNodeInstance;\n+import org.junit.Test;\n+import org.kie.api.runtime.KieSession;\n+import org.kie.api.runtime.manager.RuntimeEngine;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.process.WorkItem;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+\n+\n+public class BoundaryEventWithOutputSetPersistenceTest extends JbpmTestCase {\n+\n+    // General setup\n+    private static final Logger logger = LoggerFactory.getLogger(BoundaryEventWithOutputSetPersistenceTest.class);\n+\n+    \n+    private final static String PROCESS_TIMER_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryTimerProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_NAME = \"BoundaryTimerEventProcess\";\n+    \n+    private final static String PROCESS_MESSAGE_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryMessageProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_MESSAGE_NAME = \"BoundaryMessageEventProcess\";\n+    \n+    private final static String PROCESS_SIGNAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundarySignalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_SIGNAL_NAME = \"BoundarySignalEventProcess\";\n+    \n+    private final static String PROCESS_ERROR_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryErrorProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ERROR_NAME = \"BoundaryErrorEventProcess\";\n+    \n+    private final static String PROCESS_ESCALATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryEscalationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_ESCALATION_NAME = \"BoundaryEscalationEventProcess\";\n+    \n+    private final static String PROCESS_COMPENSATION_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryCompensationProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_COMPENSATION_NAME = \"BoundaryCompensationEventProcess\";\n+    \n+    private final static String PROCESS_CONDITIONAL_FILE_NAME = \"org/jbpm/test/functional/event/BoundaryConditionalProcessWithOutputSet.bpmn2\";\n+    private final static String PROCESS_CONDITIONAL_NAME = \"BoundaryConditionalEventProcess\";\n+    \n+    private final static String WORK_ITEM_HANDLER_TASK = \"Human Task\";\n+    private final static String WORK_ITEM_HANDLER_DATA = \"DataCaptureTask\";\n+    \n+\n+    public BoundaryEventWithOutputSetPersistenceTest() { \n+        super(true, true);\n+    }\n+        \n+    @Test\n+    public void testBoundaryEventTimerAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_TIMER_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        sleepAndVerifyTimerRuns();\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), 1L);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Timer-_2-500ms###1s-4\");\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"workItem\") instanceof WorkItem);\n+    }\n+\n+    @Test\n+    public void testBoundaryEventMessageAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_MESSAGE_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_MESSAGE_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"Message-MyMessage\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Message-MyMessage\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryEventSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_SIGNAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_SIGNAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        // we signal a boundary event\n+        ksession.signalEvent(\"MySignal\",  new Person());\n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"MySignal\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryErrorSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ERROR_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ERROR_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+\n+        ksession.abortProcessInstance(processId);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof java.lang.RuntimeException);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Error-_2-401\");\n+    }\n+    \n+    \n+    @Test\n+    public void testBoundaryEscalationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_ESCALATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler(true);\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_ESCALATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_COMPLETED] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_COMPLETED, processState);\n+\n+        \n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof CompositeContextNodeInstance);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Escalation-_2-201\");\n+        assertNull(dataTaskMockHandler.getInputParameter(\"event\"));\n+    }\n+    \n+    @Test\n+    public void testBoundaryCompensationSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_COMPENSATION_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_COMPENSATION_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        completeWork(ksession, humanTaskMockHandler);\n+        ksession.signalEvent(\"Compensation\", \"_2\");\n+        \n+        \n+        completeWork(ksession, humanTaskMockHandler);\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertNull(dataTaskMockHandler.getInputParameter(\"nodeInstance\"));\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"event\"), \"_2\");\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"Compensation\");\n+    }\n+    \n+    @Test\n+    public void testBoundaryConditionalSignalAndCompleteHumanTask() throws InterruptedException {\n+        \n+        createRuntimeManager(PROCESS_CONDITIONAL_FILE_NAME);\n+\n+        RuntimeEngine runtimeEngine = getRuntimeEngine();\n+        KieSession ksession = runtimeEngine.getKieSession();\n+        long ksessionId = ksession.getIdentifier();\n+        assertTrue(\"session id not saved.\", ksessionId > 0);\n+        \n+        HumanTaskMockHandler humanTaskMockHandler = new HumanTaskMockHandler();\n+        DataTaskMockHandler dataTaskMockHandler = new DataTaskMockHandler();\n+        // Register Human Task Handler\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_TASK, humanTaskMockHandler);\n+        ksession.getWorkItemManager().registerWorkItemHandler(WORK_ITEM_HANDLER_DATA, dataTaskMockHandler);\n+        // Start the process \n+        ProcessInstance process = ksession.startProcess(PROCESS_CONDITIONAL_NAME);\n+        long processId = process.getId();\n+        assertTrue(\"process id not saved\", processId > 0);\n+        \n+        // The process is in the Human Task waiting for its completion\n+        int processState = process.getState();\n+        assertEquals(\"Expected process state to be \" + processStateName[ProcessInstance.STATE_ACTIVE] + \" not \"\n+                + processStateName[processState], ProcessInstance.STATE_ACTIVE, processState);\n+\n+        ksession.signalEvent(\"RuleFlowStateEvent-\" + PROCESS_CONDITIONAL_NAME + \"-4-_2\" , new org.jbpm.test.entity.Person(1L, \"john\"));\n+       \n+        completeWork(ksession, humanTaskMockHandler);\n+\n+        // The process completes\n+        process = ksession.getProcessInstance(process.getId());\n+        assertNull(\"Expected process to have been completed and removed\", process);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"nodeInstance\") instanceof HumanTaskNodeInstance);\n+        assertTrue(dataTaskMockHandler.getInputParameter(\"event\") instanceof Person);\n+        assertEquals(dataTaskMockHandler.getInputParameter(\"signal\"), \"RuleFlowStateEvent-BoundaryConditionalEventProcess-4-_2\");\n+    }\n+    \n+    private void completeWork(KieSession ksession, HumanTaskMockHandler humanTaskMockHandler) {\n+        assertTrue(\"The work item task handler does not have a work item!\", humanTaskMockHandler.workItem != null);\n+        long workItemId = humanTaskMockHandler.workItem.getId();\n+        assertTrue(\"work item id not saved\", workItemId > 0);\n+        \n+        // The Human Task is completed\n+        Map<String, Object> results = new HashMap<String, Object>();\n+        try {\n+            ksession.getWorkItemManager().completeWorkItem(workItemId, results);\n+        } catch (Exception e) {\n+            logger.warn(\"Work item could not be completed!\");\n+            e.printStackTrace();\n+            fail(e.getClass().getSimpleName() + \" thrown when completing work item: \" + e.getMessage());\n+        }\n+    }\n+\n+    private void sleepAndVerifyTimerRuns()  { \n+        try {\n+            int sleep = 3000;\n+            logger.debug(\"Sleeping {} seconds\", sleep / 1000);\n+            Thread.sleep(sleep);\n+            logger.debug(\"Awake!\");\n+        } catch(InterruptedException e) {\n+            logger.error(\"System was interrupted\");\n+            fail(\"Junit was interrupted\");\n+        }\n+\n+    }\n+\n+\n+\n+    private static class HumanTaskMockHandler implements WorkItemHandler {\n+\n+        private org.kie.api.runtime.process.WorkItemManager workItemManager;\n+        private org.kie.api.runtime.process.WorkItem workItem;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg3MTEwNg=="}, "originalCommit": {"oid": "8abe5301c328c3f6cc637a761ef7085b74be35e1"}, "originalPosition": 364}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1598, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}