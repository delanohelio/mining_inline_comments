{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMzQwOTMz", "number": 1578, "title": "[JBPM-8896] NPE during Process Migration when Boundary Timer is fired but UserTask not completed", "bodyText": "self remove timer if there is no next boundary event in human task", "createdAt": "2020-01-08T08:37:19Z", "url": "https://github.com/kiegroup/jbpm/pull/1578", "merged": true, "mergeCommit": {"oid": "2a6b1bd5b670055f60631f5a6460b24dd0798b47"}, "closed": true, "closedAt": "2020-01-17T08:19:20Z", "author": {"login": "elguardian"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4UOvAgFqTMzOTgyMjQ0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb63RcTABqjI5NTM5MTY5OTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5ODIyNDQ3", "url": "https://github.com/kiegroup/jbpm/pull/1578#pullrequestreview-339822447", "createdAt": "2020-01-08T12:08:54Z", "commit": {"oid": "9c9dd23f87fce6382073b7c8564a46b2345e94b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c9dd23f87fce6382073b7c8564a46b2345e94b9", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/9c9dd23f87fce6382073b7c8564a46b2345e94b9", "committedDate": "2020-01-08T08:36:04Z", "message": "[JBPM-8896] NPE during Process Migration when Boundary Timer is fired but UserTask not completed"}, "afterCommit": {"oid": "4e3295bd1e814894cc3f8ca73b0320c5629ec29d", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/4e3295bd1e814894cc3f8ca73b0320c5629ec29d", "committedDate": "2020-01-09T08:52:40Z", "message": "[JBPM-8896] NPE during Process Migration when Boundary Timer is fired but UserTask not completed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjcwMjI4", "url": "https://github.com/kiegroup/jbpm/pull/1578#pullrequestreview-340670228", "createdAt": "2020-01-09T16:55:08Z", "commit": {"oid": "4e3295bd1e814894cc3f8ca73b0320c5629ec29d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjo1NTowOVrOFb8zlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjo1NTowOVrOFb8zlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg1MjExNw==", "bodyText": "Is the casting to DefaultTimerJobInstance needed? For example, replacing defaultTimerInstance in the next line by\n((DefaultJobHandle) timerInstance.getJobHandle()).getTimerJobInstance()\nyou wouldn't need this variable.", "url": "https://github.com/kiegroup/jbpm/pull/1578#discussion_r364852117", "createdAt": "2020-01-09T16:55:09Z", "author": {"login": "gmunozfe"}, "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/StateBasedNodeInstance.java", "diffHunk": "@@ -345,9 +347,20 @@ private void triggerTimer(TimerInstance timerInstance) {\n         for (Map.Entry<Timer, DroolsAction> entry : getEventBasedNode().getTimers().entrySet()) {\n             if (entry.getKey().getId() == timerInstance.getTimerId()) {\n                 executeAction((Action) entry.getValue().getMetaData(\"Action\"));\n+\n+                // self remove timer instance from this node as it will remove itself \n+                // from timer service once is triggered and there is no next\n+                if (!(timerInstance.getJobHandle() instanceof DefaultJobHandle)) {\n+                    return;\n+                }\n+                DefaultTimerJobInstance defaultTimerInstance = (DefaultTimerJobInstance) ((DefaultJobHandle) timerInstance.getJobHandle()).getTimerJobInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e3295bd1e814894cc3f8ca73b0320c5629ec29d"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e3295bd1e814894cc3f8ca73b0320c5629ec29d", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/4e3295bd1e814894cc3f8ca73b0320c5629ec29d", "committedDate": "2020-01-09T08:52:40Z", "message": "[JBPM-8896] NPE during Process Migration when Boundary Timer is fired but UserTask not completed"}, "afterCommit": {"oid": "72cd10d3f40e1b9a7bf3fac49a7a806afdd222c6", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/72cd10d3f40e1b9a7bf3fac49a7a806afdd222c6", "committedDate": "2020-01-13T13:16:43Z", "message": "[JBPM-8896] NPE during Process Migration when Boundary Timer is fired but UserTask not completed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dd4b6dcee241060cc737c83a3fd753ce3ce9cbc", "author": {"user": {"login": "gmunozfe", "name": "Gonzalo Mu\u00f1oz"}}, "url": "https://github.com/kiegroup/jbpm/commit/2dd4b6dcee241060cc737c83a3fd753ce3ce9cbc", "committedDate": "2020-01-16T07:21:52Z", "message": "[JBPM-8896] Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e197eab83e3c586b0e1a05fcfa0dcf7a4103ca4", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/5e197eab83e3c586b0e1a05fcfa0dcf7a4103ca4", "committedDate": "2020-01-16T07:21:53Z", "message": "[JBPM-8896] NPE during Process Migration when Boundary Timer is fired but UserTask not completed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db77d475bff152cce6e6ce7fb9427d3ea20d5525", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/db77d475bff152cce6e6ce7fb9427d3ea20d5525", "committedDate": "2020-01-16T10:06:05Z", "message": "[JBPM-8896] fixing quartz job handle not being registered when scheduled"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72cd10d3f40e1b9a7bf3fac49a7a806afdd222c6", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/72cd10d3f40e1b9a7bf3fac49a7a806afdd222c6", "committedDate": "2020-01-13T13:16:43Z", "message": "[JBPM-8896] NPE during Process Migration when Boundary Timer is fired but UserTask not completed"}, "afterCommit": {"oid": "db77d475bff152cce6e6ce7fb9427d3ea20d5525", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/db77d475bff152cce6e6ce7fb9427d3ea20d5525", "committedDate": "2020-01-16T10:06:05Z", "message": "[JBPM-8896] fixing quartz job handle not being registered when scheduled"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1010, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}