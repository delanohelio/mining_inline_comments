{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NTQ2MjQ2", "number": 1596, "title": "Fixed issue when having same dates - deleteLogsByDate method", "bodyText": "deleteLogsByDate method fixed by adding a delay of 1sec when starting up BPM processes in order to avoid issue with equal dates.\nPrevious fix didn't work completely as there were cases where some of the dates were equals between them and some of them not. For instance, out of 4 dates, 2 were equals between them and the other 2 were equals between them but different than the first two. So it is difficult to manage this scenario.\nOne option would've been to use same data structure, either a hashset or a list for both, startDates and resultList but I think the easiest solution is to add a small delay of 1 second when starting up the processes.\nBy doing this, we make sure the start dates are completely different one each other.", "createdAt": "2020-02-18T10:49:33Z", "url": "https://github.com/kiegroup/jbpm/pull/1596", "merged": true, "mergeCommit": {"oid": "471d9e2ae257d3945d3221cf1c55ea1fac81b6ea"}, "closed": true, "closedAt": "2020-02-26T11:39:27Z", "author": {"login": "afalhambra"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFjOYEgFqTM2MDQwNTk4Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIFLQnAFqTM2NDgyOTE5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNDA1OTg2", "url": "https://github.com/kiegroup/jbpm/pull/1596#pullrequestreview-360405986", "createdAt": "2020-02-18T14:57:46Z", "commit": {"oid": "4720665ad9bd7b548f171a77a58390ebc91b6618"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNDo1Nzo0NlrOFrFklw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNDo1Nzo0NlrOFrFklw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDcyNDM3NQ==", "bodyText": "If only this test is problematic, I would add a delay just here, otherwise we will be prolonging all tests in the class.", "url": "https://github.com/kiegroup/jbpm/pull/1596#discussion_r380724375", "createdAt": "2020-02-18T14:57:46Z", "author": {"login": "MarianMacik"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/log/ProcessInstanceLogCleanTest.java", "diffHunk": "@@ -223,7 +224,7 @@ public void deleteLogsWithStatusActive() {\n \n     @Test\n     @BZ(\"1188702\")\n-    public void deleteLogsByDate() {\n+    public void deleteLogsByDate() throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4720665ad9bd7b548f171a77a58390ebc91b6618"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNzEyMDQy", "url": "https://github.com/kiegroup/jbpm/pull/1596#pullrequestreview-360712042", "createdAt": "2020-02-18T22:12:24Z", "commit": {"oid": "4720665ad9bd7b548f171a77a58390ebc91b6618"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMjoxMjoyNVrOFrUXSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMjoxMjoyNVrOFrUXSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk2NjcyOQ==", "bodyText": "Reduce sleep time (probably a few milliseconds is enough)", "url": "https://github.com/kiegroup/jbpm/pull/1596#discussion_r380966729", "createdAt": "2020-02-18T22:12:25Z", "author": {"login": "gmunozfe"}, "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/log/ProcessInstanceLogCleanTest.java", "diffHunk": "@@ -385,9 +380,10 @@ private void abortProcess(KieSession kieSession, long pid) {\n         }\n     }\n \n-    private List<ProcessInstance> startProcess(KieSession kieSession, String processId, int count) {\n+    private List<ProcessInstance> startProcess(KieSession kieSession, String processId, int count) throws InterruptedException {\n         List<ProcessInstance> piList = new ArrayList<ProcessInstance>();\n         for (int i = 0; i < count; i++) {\n+            TimeUnit.MILLISECONDS.sleep(1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4720665ad9bd7b548f171a77a58390ebc91b6618"}, "originalPosition": 141}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8c4562c3415e088cc96a0900dfa13f6dcfcd68e", "author": {"user": {"login": "afalhambra", "name": "afalhambra"}}, "url": "https://github.com/kiegroup/jbpm/commit/c8c4562c3415e088cc96a0900dfa13f6dcfcd68e", "committedDate": "2020-02-19T08:16:50Z", "message": "# deleteLogsByDate method fixed by adding a delay of 1sec when starting up BPM processes in order to avoid issue with equal dates"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4720665ad9bd7b548f171a77a58390ebc91b6618", "author": {"user": {"login": "afalhambra", "name": "afalhambra"}}, "url": "https://github.com/kiegroup/jbpm/commit/4720665ad9bd7b548f171a77a58390ebc91b6618", "committedDate": "2020-02-18T10:39:21Z", "message": "# deleteLogsByDate method fixed by adding a delay of 1sec when starting up BPM processes in order to avoid issue with equal dates"}, "afterCommit": {"oid": "c8c4562c3415e088cc96a0900dfa13f6dcfcd68e", "author": {"user": {"login": "afalhambra", "name": "afalhambra"}}, "url": "https://github.com/kiegroup/jbpm/commit/c8c4562c3415e088cc96a0900dfa13f6dcfcd68e", "committedDate": "2020-02-19T08:16:50Z", "message": "# deleteLogsByDate method fixed by adding a delay of 1sec when starting up BPM processes in order to avoid issue with equal dates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNTEwMzI4", "url": "https://github.com/kiegroup/jbpm/pull/1596#pullrequestreview-362510328", "createdAt": "2020-02-21T09:48:44Z", "commit": {"oid": "c8c4562c3415e088cc96a0900dfa13f6dcfcd68e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0ODI5MTk3", "url": "https://github.com/kiegroup/jbpm/pull/1596#pullrequestreview-364829197", "createdAt": "2020-02-26T11:39:18Z", "commit": {"oid": "c8c4562c3415e088cc96a0900dfa13f6dcfcd68e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1042, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}