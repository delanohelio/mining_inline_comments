{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1ODIwNzcw", "number": 1680, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwOToyOTozMVrOEH47fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTo1NjoxMFrOEN4esQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NzA4MjIwOnYy", "diffSide": "RIGHT", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwOToyOTozMVrOGnhGMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwOToyOTozMVrOGnhGMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4OTkwNQ==", "bodyText": "Not enought check also the value of correlation key. as a rule of thumb the correlation key by default is the process instance id to string but you can start a process with a custom correlation key. (do that)", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r444089905", "createdAt": "2020-06-23T09:29:31Z", "author": {"login": "elguardian"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1039,19 +1040,23 @@ public void testGetTaskById() {\n     \tassertEquals(\"Write a Document\", userTask.getName());\n \n     \tNodeInstanceDesc nodeInstanceDesc = runtimeDataService.getNodeInstanceForWorkItem(userTask.getWorkItemId());\n-\t\tassertNull(userTask.getSlaCompliance());\n-\t\tassertNull(userTask.getSlaDueDate());\n+    \tassertNull(userTask.getSlaCompliance());\n+    \tassertNull(userTask.getSlaDueDate());\n \n-\t\tuserTask = runtimeDataService.getTaskById(taskId,true);\n-\t\tassertNotNull(userTask);\n-\n-\t\tassertEquals(nodeInstanceDesc.getSlaCompliance(), userTask.getSlaCompliance());\n-\t\tassertEquals(nodeInstanceDesc.getSlaDueDate(), userTask.getSlaDueDate());\n+    \tuserTask = runtimeDataService.getTaskById(taskId, true);\n+    \tassertNotNull(userTask);\n+    \tassertEquals(nodeInstanceDesc.getSlaCompliance(), userTask.getSlaCompliance());\n+    \tassertEquals(nodeInstanceDesc.getSlaDueDate(), userTask.getSlaDueDate());\n+    \t\n+    \tassertNotNull(userTask.getCorrelationKey());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c45f901acef5d0646d9ccaf5a527ff342f544297"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2NzEyMzU3OnYy", "diffSide": "RIGHT", "path": "jbpm-services/jbpm-services-cdi/src/test/java/org/jbpm/services/cdi/test/RuntimeDataServiceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwOTo0MDo1OFrOGnhgWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QwOTo0MDo1OFrOGnhgWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5NjYwMA==", "bodyText": "what about the correlation key ?", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r444096600", "createdAt": "2020-06-23T09:40:58Z", "author": {"login": "elguardian"}, "path": "jbpm-services/jbpm-services-cdi/src/test/java/org/jbpm/services/cdi/test/RuntimeDataServiceTest.java", "diffHunk": "@@ -266,7 +267,7 @@ public void testGetTasksAssignedAsPotentialOwnerGroupFromCallback() {\n         List<TaskSummary> tasks = runtimeDataService.getTasksAssignedAsPotentialOwnerByStatus(\"katy\", statuses, new QueryFilter());\n         assertNotNull(tasks);\n         assertEquals(1, tasks.size());\n-        \n+        assertEquals(WorkflowProcess.PROCESS_TYPE, tasks.get(0).getProcessType().intValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c45f901acef5d0646d9ccaf5a527ff342f544297"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyODc1OTgyOnYy", "diffSide": "RIGHT", "path": "jbpm-services/jbpm-kie-services/src/main/java/org/jbpm/kie/services/impl/RuntimeDataServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMToxMDoyM1rOGwj97w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoyMToxM1rOGwqw6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NDEyNw==", "bodyText": "This check can now be made in the beginning of the method as it would eliminate possibly unnecessary querying of all task events in case the task doesn't even exist.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453574127", "createdAt": "2020-07-13T11:10:23Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/main/java/org/jbpm/kie/services/impl/RuntimeDataServiceImpl.java", "diffHunk": "@@ -1131,11 +1131,15 @@ private void addVariableNameAndVariableValueParameters(TaskSummaryQueryBuilder q\n         List<TaskEvent> taskEvents = commandService.execute(\n     \t\t\t\tnew QueryNameCommand<List<TaskEvent>>(\"getAllTasksEvents\", params));\n \n-        if(taskEvents == null || taskEvents.isEmpty()) {\n-            \n-            UserTaskInstanceDesc task = getTaskById(taskId);\n-            if (task == null) {\n-                throw new TaskNotFoundException( MessageFormat.format(TASK_NOT_FOUND, taskId) );\n+        \n+        UserTaskInstanceDesc task = getTaskById(taskId);\n+        if (task == null) {\n+            throw new TaskNotFoundException( MessageFormat.format(TASK_NOT_FOUND, taskId) );\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NTQ4Mw==", "bodyText": "yes, good point", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453685483", "createdAt": "2020-07-13T14:21:13Z", "author": {"login": "fjtirado"}, "path": "jbpm-services/jbpm-kie-services/src/main/java/org/jbpm/kie/services/impl/RuntimeDataServiceImpl.java", "diffHunk": "@@ -1131,11 +1131,15 @@ private void addVariableNameAndVariableValueParameters(TaskSummaryQueryBuilder q\n         List<TaskEvent> taskEvents = commandService.execute(\n     \t\t\t\tnew QueryNameCommand<List<TaskEvent>>(\"getAllTasksEvents\", params));\n \n-        if(taskEvents == null || taskEvents.isEmpty()) {\n-            \n-            UserTaskInstanceDesc task = getTaskById(taskId);\n-            if (task == null) {\n-                throw new TaskNotFoundException( MessageFormat.format(TASK_NOT_FOUND, taskId) );\n+        \n+        UserTaskInstanceDesc task = getTaskById(taskId);\n+        if (task == null) {\n+            throw new TaskNotFoundException( MessageFormat.format(TASK_NOT_FOUND, taskId) );\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NDEyNw=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyODc2ODQ3OnYy", "diffSide": "RIGHT", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMToxMzowOFrOGwkDSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToxNTozNlrOGwtLaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NTQ5Nw==", "bodyText": "Can you create a new test for this as this is modifying the old one? It uses a different startProcess method.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453575497", "createdAt": "2020-07-13T11:13:08Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1016,12 +1017,15 @@ public void testGetTaskByWorkItemId() {\n     \tassertNotNull(userTask);\n     \tassertEquals(processInstanceId, userTask.getProcessInstanceId());\n     \tassertEquals(\"Write a Document\", userTask.getName());\n+        assertTask(userTask, processInstanceId);\n \n     }\n \n     @Test\n     public void testGetTaskById() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNjk3Nw==", "bodyText": "I think once the name of asserTask method has been changed to assertCorrelationAndProcess, it is now clear the pupose of adding this line here. To test that for getTaskByWorkItemId, processType and correlationKey are included in the response", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453706977", "createdAt": "2020-07-13T14:50:47Z", "author": {"login": "fjtirado"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1016,12 +1017,15 @@ public void testGetTaskByWorkItemId() {\n     \tassertNotNull(userTask);\n     \tassertEquals(processInstanceId, userTask.getProcessInstanceId());\n     \tassertEquals(\"Write a Document\", userTask.getName());\n+        assertTask(userTask, processInstanceId);\n \n     }\n \n     @Test\n     public void testGetTaskById() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NTQ5Nw=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcxNDIwOQ==", "bodyText": "I mean the test which I commented testGetTaskById() :) As you changed the behaviour of the test - not that good for regression testing. (For example you use now a different startProcess method) So I would say that a separate test would be better.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453714209", "createdAt": "2020-07-13T15:00:36Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1016,12 +1017,15 @@ public void testGetTaskByWorkItemId() {\n     \tassertNotNull(userTask);\n     \tassertEquals(processInstanceId, userTask.getProcessInstanceId());\n     \tassertEquals(\"Write a Document\", userTask.getName());\n+        assertTask(userTask, processInstanceId);\n \n     }\n \n     @Test\n     public void testGetTaskById() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NTQ5Nw=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyNTAzMg==", "bodyText": "Ok, understood ;)\nNew test added.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453725032", "createdAt": "2020-07-13T15:15:36Z", "author": {"login": "fjtirado"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1016,12 +1017,15 @@ public void testGetTaskByWorkItemId() {\n     \tassertNotNull(userTask);\n     \tassertEquals(processInstanceId, userTask.getProcessInstanceId());\n     \tassertEquals(\"Write a Document\", userTask.getName());\n+        assertTask(userTask, processInstanceId);\n \n     }\n \n     @Test\n     public void testGetTaskById() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NTQ5Nw=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyODc3MjAxOnYy", "diffSide": "LEFT", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMToxNDoyMVrOGwkFgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDozNjo0N1rOGwrcZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NjA2Nw==", "bodyText": "Why was this removed? It should still hold I think.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453576067", "createdAt": "2020-07-13T11:14:21Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1118,26 +1127,20 @@ public void testGetTaskAssignedAsBusinessAdminPaging() {\n     \n     @Test\n     public void testGetTaskAssignedAsBusinessAdminByStatus() {\n-\n-        for (int i = 0; i < 10; i++) {\n-\n-            processService.startProcess(deploymentUnit.getIdentifier(), \"org.jbpm.writedocument\");\n-        }\n+        startProcesses(10, \"org.jbpm.writedocument\");\n         \n         List<Status> statuses = new ArrayList<Status>();\n         statuses.add(Status.Ready);\n         statuses.add(Status.Reserved);\n \n         List<TaskSummary> tasks = runtimeDataService.getTasksAssignedAsBusinessAdministratorByStatus(\"Administrator\", statuses, new QueryFilter(0, 5));\n-        assertNotNull(tasks);\n-        assertEquals(5, tasks.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5NjYxMw==", "bodyText": "There was an already existing issue with this test.\nBasically Task table is not removed between test, which leads to inconsistencies.\nSince it is apparently not related with these changes, Gonzalo will investigate this as a separate task.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453696613", "createdAt": "2020-07-13T14:36:47Z", "author": {"login": "fjtirado"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1118,26 +1127,20 @@ public void testGetTaskAssignedAsBusinessAdminPaging() {\n     \n     @Test\n     public void testGetTaskAssignedAsBusinessAdminByStatus() {\n-\n-        for (int i = 0; i < 10; i++) {\n-\n-            processService.startProcess(deploymentUnit.getIdentifier(), \"org.jbpm.writedocument\");\n-        }\n+        startProcesses(10, \"org.jbpm.writedocument\");\n         \n         List<Status> statuses = new ArrayList<Status>();\n         statuses.add(Status.Ready);\n         statuses.add(Status.Reserved);\n \n         List<TaskSummary> tasks = runtimeDataService.getTasksAssignedAsBusinessAdministratorByStatus(\"Administrator\", statuses, new QueryFilter(0, 5));\n-        assertNotNull(tasks);\n-        assertEquals(5, tasks.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NjA2Nw=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyODc3NjE3OnYy", "diffSide": "LEFT", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMToxNToyMlrOGwkH1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDozNjo1NlrOGwrc5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NjY2Mg==", "bodyText": "Same here.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453576662", "createdAt": "2020-07-13T11:15:22Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1210,22 +1213,15 @@ public void testGetTasksAssignedAsPotentialOwnerByStatusPagingAndFiltering() {\n     \n     @Test\n     public void testGetTasksAssignedAsPotentialOwnerSortedByAlias() {\n-        List<Long> processInstanceIds = new ArrayList<Long>();\n-        for (int i = 0; i < 10; i++) {\n-\n-            processInstanceIds.add(processService.startProcess(deploymentUnit.getIdentifier(), \"org.jbpm.writedocument\"));\n-        }\n-\n+        startProcesses(10, \"org.jbpm.writedocument\");\n+        \n         List<Status> statuses = new ArrayList<Status>();\n         statuses.add(Status.Ready);\n         statuses.add(Status.Reserved);\n \n         QueryFilter ctx = new QueryFilter(0, 5, \"Status\", true);\n         \n         List<TaskSummary> tasks = runtimeDataService.getTasksAssignedAsPotentialOwnerByStatus(\"salaboy\", statuses, ctx);\n-        assertNotNull(tasks);\n-        assertEquals(5, tasks.size());\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 173}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5Njc0Mg==", "bodyText": "There was an already existing issue with this test.\nBasically Task table is not removed between test, which leads to inconsistencies.\nSince it is apparently not related with these changes, Gonzalo will investigate this as a separate task.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453696742", "createdAt": "2020-07-13T14:36:56Z", "author": {"login": "fjtirado"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1210,22 +1213,15 @@ public void testGetTasksAssignedAsPotentialOwnerByStatusPagingAndFiltering() {\n     \n     @Test\n     public void testGetTasksAssignedAsPotentialOwnerSortedByAlias() {\n-        List<Long> processInstanceIds = new ArrayList<Long>();\n-        for (int i = 0; i < 10; i++) {\n-\n-            processInstanceIds.add(processService.startProcess(deploymentUnit.getIdentifier(), \"org.jbpm.writedocument\"));\n-        }\n-\n+        startProcesses(10, \"org.jbpm.writedocument\");\n+        \n         List<Status> statuses = new ArrayList<Status>();\n         statuses.add(Status.Ready);\n         statuses.add(Status.Reserved);\n \n         QueryFilter ctx = new QueryFilter(0, 5, \"Status\", true);\n         \n         List<TaskSummary> tasks = runtimeDataService.getTasksAssignedAsPotentialOwnerByStatus(\"salaboy\", statuses, ctx);\n-        assertNotNull(tasks);\n-        assertEquals(5, tasks.size());\n-", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NjY2Mg=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 173}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyODc4MTIwOnYy", "diffSide": "RIGHT", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMToxNjo1NVrOGwkK8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNToxNzozMVrOGwtRCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NzQ1Ng==", "bodyText": "Maybe assert the process type as well.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453577456", "createdAt": "2020-07-13T11:16:55Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1329,12 +1325,15 @@ public void testGetTaskEvents() {\n     \tassertNotNull(workItemId);\n \n     \tUserTaskInstanceDesc userTask = runtimeDataService.getTaskByWorkItemId(workItemId);\n-    \tassertNotNull(userTask);\n+        assertTask(userTask, processInstanceId);\n \n     \tList<TaskEvent> auditTasks = runtimeDataService.getTaskEvents(userTask.getTaskId(), new QueryFilter());\n     \tassertNotNull(auditTasks);\n-        assertEquals(2, auditTasks.size());\n-    \tassertEquals(TaskEvent.TaskEventType.ADDED, auditTasks.get(0).getType());\n+    \tassertEquals(2, auditTasks.size());\n+    \tTaskEvent taskEvent = auditTasks.get(0);\n+    \tassertEquals(TaskEvent.TaskEventType.ADDED, taskEvent.getType());\n+    \tassertNotNull(taskEvent.getCorrelationKey());\n+    \tassertNotNull(taskEvent.getProcessType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 223}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwMDcxOA==", "bodyText": "processType here can be either PROCESS or CASE, so what is tested is that TaskEvent is filled as expected with a not null value", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453700718", "createdAt": "2020-07-13T14:42:21Z", "author": {"login": "fjtirado"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1329,12 +1325,15 @@ public void testGetTaskEvents() {\n     \tassertNotNull(workItemId);\n \n     \tUserTaskInstanceDesc userTask = runtimeDataService.getTaskByWorkItemId(workItemId);\n-    \tassertNotNull(userTask);\n+        assertTask(userTask, processInstanceId);\n \n     \tList<TaskEvent> auditTasks = runtimeDataService.getTaskEvents(userTask.getTaskId(), new QueryFilter());\n     \tassertNotNull(auditTasks);\n-        assertEquals(2, auditTasks.size());\n-    \tassertEquals(TaskEvent.TaskEventType.ADDED, auditTasks.get(0).getType());\n+    \tassertEquals(2, auditTasks.size());\n+    \tTaskEvent taskEvent = auditTasks.get(0);\n+    \tassertEquals(TaskEvent.TaskEventType.ADDED, taskEvent.getType());\n+    \tassertNotNull(taskEvent.getCorrelationKey());\n+    \tassertNotNull(taskEvent.getProcessType());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NzQ1Ng=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 223}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcxNjcwOA==", "bodyText": "But since you started process in this test you can expect PROCESS here, so the test would have even better coverage.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453716708", "createdAt": "2020-07-13T15:04:04Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1329,12 +1325,15 @@ public void testGetTaskEvents() {\n     \tassertNotNull(workItemId);\n \n     \tUserTaskInstanceDesc userTask = runtimeDataService.getTaskByWorkItemId(workItemId);\n-    \tassertNotNull(userTask);\n+        assertTask(userTask, processInstanceId);\n \n     \tList<TaskEvent> auditTasks = runtimeDataService.getTaskEvents(userTask.getTaskId(), new QueryFilter());\n     \tassertNotNull(auditTasks);\n-        assertEquals(2, auditTasks.size());\n-    \tassertEquals(TaskEvent.TaskEventType.ADDED, auditTasks.get(0).getType());\n+    \tassertEquals(2, auditTasks.size());\n+    \tTaskEvent taskEvent = auditTasks.get(0);\n+    \tassertEquals(TaskEvent.TaskEventType.ADDED, taskEvent.getType());\n+    \tassertNotNull(taskEvent.getCorrelationKey());\n+    \tassertNotNull(taskEvent.getProcessType());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NzQ1Ng=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 223}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyNjQ3Mw==", "bodyText": "you are right, changed", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453726473", "createdAt": "2020-07-13T15:17:31Z", "author": {"login": "fjtirado"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1329,12 +1325,15 @@ public void testGetTaskEvents() {\n     \tassertNotNull(workItemId);\n \n     \tUserTaskInstanceDesc userTask = runtimeDataService.getTaskByWorkItemId(workItemId);\n-    \tassertNotNull(userTask);\n+        assertTask(userTask, processInstanceId);\n \n     \tList<TaskEvent> auditTasks = runtimeDataService.getTaskEvents(userTask.getTaskId(), new QueryFilter());\n     \tassertNotNull(auditTasks);\n-        assertEquals(2, auditTasks.size());\n-    \tassertEquals(TaskEvent.TaskEventType.ADDED, auditTasks.get(0).getType());\n+    \tassertEquals(2, auditTasks.size());\n+    \tTaskEvent taskEvent = auditTasks.get(0);\n+    \tassertEquals(TaskEvent.TaskEventType.ADDED, taskEvent.getType());\n+    \tassertNotNull(taskEvent.getCorrelationKey());\n+    \tassertNotNull(taskEvent.getProcessType());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3NzQ1Ng=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 223}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyODc5MDkyOnYy", "diffSide": "RIGHT", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/test/util/AbstractKieServicesBaseTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMToxOTo0OVrOGwkQuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDo0NDo0NVrOGwrzCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3ODkzNw==", "bodyText": "Maybe make the name more descriptive - e.g. what it's asserting on.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453578937", "createdAt": "2020-07-13T11:19:49Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/test/util/AbstractKieServicesBaseTest.java", "diffHunk": "@@ -110,4 +115,33 @@ protected KieFileSystem createKieFileSystemWithKProject(KieServices ks) {\n         return kfs;\n     }\n \n+    protected void assertTask(UserTaskInstanceDesc userTask, long processInstanceId) {\n+        assertTask(userTask, Long.toString(processInstanceId));\n+    }\n+\n+    protected void assertTask(UserTaskInstanceDesc userTask, String correlationKey) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwMjQwOQ==", "bodyText": "Done", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453702409", "createdAt": "2020-07-13T14:44:45Z", "author": {"login": "fjtirado"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/test/util/AbstractKieServicesBaseTest.java", "diffHunk": "@@ -110,4 +115,33 @@ protected KieFileSystem createKieFileSystemWithKProject(KieServices ks) {\n         return kfs;\n     }\n \n+    protected void assertTask(UserTaskInstanceDesc userTask, long processInstanceId) {\n+        assertTask(userTask, Long.toString(processInstanceId));\n+    }\n+\n+    protected void assertTask(UserTaskInstanceDesc userTask, String correlationKey) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU3ODkzNw=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyODc5OTY3OnYy", "diffSide": "RIGHT", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMToyMjozMVrOGwkV6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTowOTo0OVrOGws6-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU4MDI2Ng==", "bodyText": "I would rather use a variable which belongs to the test itself as it's less error-prone to tests influencing each other.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453580266", "createdAt": "2020-07-13T11:22:31Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1239,7 +1235,7 @@ public void testGetTasksAssignedAsPotentialOwnerSortedByAlias() {\n     @Test\n     public void testTasksByStatusByProcessInstanceIdPagingAndFiltering() {\n \n-    \tLong pid = processService.startProcess(deploymentUnit.getIdentifier(), \"org.jbpm.writedocument\");\n+    \tprocessInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"org.jbpm.writedocument\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 182}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNDI1Mw==", "bodyText": "I agree with the principle, but in practise global variable approach is used for all other test and allow defining commom method in parent class (changing that at this stage is not providig any benefit). This line was modified  to align this test with the other ones.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453704253", "createdAt": "2020-07-13T14:47:11Z", "author": {"login": "fjtirado"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1239,7 +1235,7 @@ public void testGetTasksAssignedAsPotentialOwnerSortedByAlias() {\n     @Test\n     public void testTasksByStatusByProcessInstanceIdPagingAndFiltering() {\n \n-    \tLong pid = processService.startProcess(deploymentUnit.getIdentifier(), \"org.jbpm.writedocument\");\n+    \tprocessInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"org.jbpm.writedocument\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU4MDI2Ng=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 182}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyMDgyNw==", "bodyText": "OK, makes sense.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453720827", "createdAt": "2020-07-13T15:09:49Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1239,7 +1235,7 @@ public void testGetTasksAssignedAsPotentialOwnerSortedByAlias() {\n     @Test\n     public void testTasksByStatusByProcessInstanceIdPagingAndFiltering() {\n \n-    \tLong pid = processService.startProcess(deploymentUnit.getIdentifier(), \"org.jbpm.writedocument\");\n+    \tprocessInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"org.jbpm.writedocument\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU4MDI2Ng=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 182}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyODgwMjYwOnYy", "diffSide": "RIGHT", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/test/util/AbstractKieServicesBaseTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMToyMzozM1rOGwkXuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTowODoxMFrOGws2gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU4MDcyOA==", "bodyText": "Why do we need this intermediate step and not do the conversion inside the assert method below? As this method doesn't do anything more.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453580728", "createdAt": "2020-07-13T11:23:33Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/test/util/AbstractKieServicesBaseTest.java", "diffHunk": "@@ -110,4 +115,33 @@ protected KieFileSystem createKieFileSystemWithKProject(KieServices ks) {\n         return kfs;\n     }\n \n+    protected void assertTask(UserTaskInstanceDesc userTask, long processInstanceId) {\n+        assertTask(userTask, Long.toString(processInstanceId));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNTI5NQ==", "bodyText": "This method is a bridge between processInstanceId and correlationKey. In most test, correlationKey is equal to processInstanceId. This is doing the briding. If this method is removed Long.toString will have to be invoked in a lot of test.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453705295", "createdAt": "2020-07-13T14:48:36Z", "author": {"login": "fjtirado"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/test/util/AbstractKieServicesBaseTest.java", "diffHunk": "@@ -110,4 +115,33 @@ protected KieFileSystem createKieFileSystemWithKProject(KieServices ks) {\n         return kfs;\n     }\n \n+    protected void assertTask(UserTaskInstanceDesc userTask, long processInstanceId) {\n+        assertTask(userTask, Long.toString(processInstanceId));\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU4MDcyOA=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcxOTY4MA==", "bodyText": "I see now, thanks.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453719680", "createdAt": "2020-07-13T15:08:10Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/test/util/AbstractKieServicesBaseTest.java", "diffHunk": "@@ -110,4 +115,33 @@ protected KieFileSystem createKieFileSystemWithKProject(KieServices ks) {\n         return kfs;\n     }\n \n+    protected void assertTask(UserTaskInstanceDesc userTask, long processInstanceId) {\n+        assertTask(userTask, Long.toString(processInstanceId));\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU4MDcyOA=="}, "originalCommit": {"oid": "c42c86c20ae599745d96a56aa7a9c802a8ee4b55"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTkyMzA1OnYy", "diffSide": "RIGHT", "path": "jbpm-services/jbpm-kie-services/src/main/java/org/jbpm/kie/services/impl/query/mapper/UserTaskInstanceQueryMapper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNTo1NjoxMFrOGwvAKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzowOToyM1rOGwxx4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc1NDkyMg==", "bodyText": "SLA-related columns are used for node(task)-related SLA (from NodeInstanceLog), not for process SLA (from ProcessInstanceLog). These fields are used for the RuntimeDataServiceImpl#getTaskById(Long taskId, boolean withSLA) method where you can specify if you want just the task or also its SLA data. So by default it's fine that the mapper doesn't have this data.\nAt first, the join with NodeInstanceLog was implemented in 3c46765 but then we found that it negatively impacts performance so we decided to create a separate method for that and reuse the same UserTaskInstanceDesc object for that (1ed84fe). That's why SLA information is not in the mapper by default.", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453754922", "createdAt": "2020-07-13T15:56:10Z", "author": {"login": "MarianMacik"}, "path": "jbpm-services/jbpm-kie-services/src/main/java/org/jbpm/kie/services/impl/query/mapper/UserTaskInstanceQueryMapper.java", "diffHunk": "@@ -80,7 +80,11 @@ protected UserTaskInstanceDesc buildInstance(DataSet dataSetResult, int index) {\n                 getColumnDateValue(dataSetResult, COLUMN_DUEDATE, index),//dueDate\n                 getColumnLongValue(dataSetResult, COLUMN_WORKITEMID, index), //workItemId\n                 getColumnStringValue(dataSetResult, COLUMN_FORM_NAME, index),\n-                getColumnStringValue(dataSetResult, COLUMN_SUBJECT, index)\n+                getColumnStringValue(dataSetResult, COLUMN_SUBJECT, index),\n+                getColumnStringValue(dataSetResult, COLUMN_CORRELATIONKEY, index), \n+                getColumnIntValue(dataSetResult, COLUMN_PROCESSTYPE, index),\n+                getColumnDateValue(dataSetResult, COLUMN_SLA_DUE_DATE, index), \n+                getColumnIntValue(dataSetResult, COLUMN_SLA_COMPLIANCE, index)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65a55341259365b7676db2dd0774ee60129cb17c"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgwMDQxNg==", "bodyText": "Ok, adding two separate set of contanst for these two columns on task table, in case they are retrieved in future", "url": "https://github.com/kiegroup/jbpm/pull/1680#discussion_r453800416", "createdAt": "2020-07-13T17:09:23Z", "author": {"login": "fjtirado"}, "path": "jbpm-services/jbpm-kie-services/src/main/java/org/jbpm/kie/services/impl/query/mapper/UserTaskInstanceQueryMapper.java", "diffHunk": "@@ -80,7 +80,11 @@ protected UserTaskInstanceDesc buildInstance(DataSet dataSetResult, int index) {\n                 getColumnDateValue(dataSetResult, COLUMN_DUEDATE, index),//dueDate\n                 getColumnLongValue(dataSetResult, COLUMN_WORKITEMID, index), //workItemId\n                 getColumnStringValue(dataSetResult, COLUMN_FORM_NAME, index),\n-                getColumnStringValue(dataSetResult, COLUMN_SUBJECT, index)\n+                getColumnStringValue(dataSetResult, COLUMN_SUBJECT, index),\n+                getColumnStringValue(dataSetResult, COLUMN_CORRELATIONKEY, index), \n+                getColumnIntValue(dataSetResult, COLUMN_PROCESSTYPE, index),\n+                getColumnDateValue(dataSetResult, COLUMN_SLA_DUE_DATE, index), \n+                getColumnIntValue(dataSetResult, COLUMN_SLA_COMPLIANCE, index)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc1NDkyMg=="}, "originalCommit": {"oid": "65a55341259365b7676db2dd0774ee60129cb17c"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1729, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}