{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNzcwMTI2", "number": 1581, "title": "RHPAM-2556 - Case reopen capability", "bodyText": "", "createdAt": "2020-01-16T17:48:50Z", "url": "https://github.com/kiegroup/jbpm/pull/1581", "merged": true, "mergeCommit": {"oid": "2ae6e9d22bdc5a78e06ece91cbdcad0ce49ba21c"}, "closed": true, "closedAt": "2020-01-31T08:49:21Z", "author": {"login": "mswiderski"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7LCbSAFqTM0NDQ0MjEwOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_dMO7AFqTM1MDk2NTc1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NDQyMTA4", "url": "https://github.com/kiegroup/jbpm/pull/1581#pullrequestreview-344442108", "createdAt": "2020-01-17T09:06:54Z", "commit": {"oid": "4b7010f0b15373799bb59970b8fcf3faec54902b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwOTowNjo1NVrOFeyorw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QwOTowNjo1NVrOFeyorw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgzMTIxNQ==", "bodyText": "Hi @mswiderski\nThere are 3 tests failing in CaseServiceImplTest class:\ntestStartThenReopenEmptyCase\ntestStartThenReopenEmptyCaseUpdateData\ntestStartThenReopenEmptyCaseUpdateDescription\nexpected:<[my first case]> but was:<[#{name}]>\nIt seems like when starting the process, {name} variable has no value", "url": "https://github.com/kiegroup/jbpm/pull/1581#discussion_r367831215", "createdAt": "2020-01-17T09:06:55Z", "author": {"login": "gmunozfe"}, "path": "jbpm-case-mgmt/jbpm-case-mgmt-impl/src/main/java/org/jbpm/casemgmt/impl/command/ReopenCaseCommand.java", "diffHunk": "@@ -79,20 +79,22 @@ public Void execute(Context context) {\n         \n         caseEventSupport.fireBeforeCaseReopened(caseId, caseFile, deploymentId, caseDefinitionId, data);\n         \n-        logger.debug(\"Updating case file in working memory\");\n+        logger.debug(\"Removing case file from working memory to allow refiring of rules\");\n         FactHandle factHandle = ksession.getFactHandle(caseFile);\n+        ksession.delete(factHandle);\n         ((CaseFileInstanceImpl)caseFile).setCaseReopenDate(new Date());\n         if (data != null && !data.isEmpty()) {\n             caseFile.addAll(data);\n         }\n-        ksession.update(factHandle, caseFile);\n+        \n         \n         logger.debug(\"Starting process instance for case {} and case definition {}\", caseId, caseDefinitionId);\n         CorrelationKey correlationKey = correlationKeyFactory.newCorrelationKey(caseId);\n         Map<String, Object> params = new HashMap<>();\n         // set case id to allow it to use CaseContext when creating runtime engine\n         params.put(EnvironmentName.CASE_ID, caseId);\n         long processInstanceId = processService.startProcess(deploymentId, caseDefinitionId, correlationKey, params);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7010f0b15373799bb59970b8fcf3faec54902b"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NDk3NjY4", "url": "https://github.com/kiegroup/jbpm/pull/1581#pullrequestreview-344497668", "createdAt": "2020-01-17T10:46:13Z", "commit": {"oid": "4b7010f0b15373799bb59970b8fcf3faec54902b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMDo0NjoxNFrOFe1Q9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QxMDo0NjoxNFrOFe1Q9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg3NDI5Mw==", "bodyText": "Shouldn't caseFile be inserted  before starting the process?", "url": "https://github.com/kiegroup/jbpm/pull/1581#discussion_r367874293", "createdAt": "2020-01-17T10:46:14Z", "author": {"login": "gmunozfe"}, "path": "jbpm-case-mgmt/jbpm-case-mgmt-impl/src/main/java/org/jbpm/casemgmt/impl/command/ReopenCaseCommand.java", "diffHunk": "@@ -79,20 +79,22 @@ public Void execute(Context context) {\n         \n         caseEventSupport.fireBeforeCaseReopened(caseId, caseFile, deploymentId, caseDefinitionId, data);\n         \n-        logger.debug(\"Updating case file in working memory\");\n+        logger.debug(\"Removing case file from working memory to allow refiring of rules\");\n         FactHandle factHandle = ksession.getFactHandle(caseFile);\n+        ksession.delete(factHandle);\n         ((CaseFileInstanceImpl)caseFile).setCaseReopenDate(new Date());\n         if (data != null && !data.isEmpty()) {\n             caseFile.addAll(data);\n         }\n-        ksession.update(factHandle, caseFile);\n+        \n         \n         logger.debug(\"Starting process instance for case {} and case definition {}\", caseId, caseDefinitionId);\n         CorrelationKey correlationKey = correlationKeyFactory.newCorrelationKey(caseId);\n         Map<String, Object> params = new HashMap<>();\n         // set case id to allow it to use CaseContext when creating runtime engine\n         params.put(EnvironmentName.CASE_ID, caseId);\n         long processInstanceId = processService.startProcess(deploymentId, caseDefinitionId, correlationKey, params);\n+        ksession.insert(caseFile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7010f0b15373799bb59970b8fcf3faec54902b"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b7010f0b15373799bb59970b8fcf3faec54902b", "author": {"user": {"login": "mswiderski", "name": "Maciej Swiderski"}}, "url": "https://github.com/kiegroup/jbpm/commit/4b7010f0b15373799bb59970b8fcf3faec54902b", "committedDate": "2020-01-16T17:47:38Z", "message": "RHPAM-2556 - Case reopen capability"}, "afterCommit": {"oid": "96a6b0a275e5a655e3c88bc4521708ef0d660170", "author": {"user": {"login": "mswiderski", "name": "Maciej Swiderski"}}, "url": "https://github.com/kiegroup/jbpm/commit/96a6b0a275e5a655e3c88bc4521708ef0d660170", "committedDate": "2020-01-17T10:53:55Z", "message": "RHPAM-2556 - Case reopen capability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "087b5e97cf3a761ae143e3a2fa62f6657bd756b2", "author": {"user": {"login": "mswiderski", "name": "Maciej Swiderski"}}, "url": "https://github.com/kiegroup/jbpm/commit/087b5e97cf3a761ae143e3a2fa62f6657bd756b2", "committedDate": "2020-01-17T13:17:00Z", "message": "RHPAM-2556 - Case reopen capability"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "96a6b0a275e5a655e3c88bc4521708ef0d660170", "author": {"user": {"login": "mswiderski", "name": "Maciej Swiderski"}}, "url": "https://github.com/kiegroup/jbpm/commit/96a6b0a275e5a655e3c88bc4521708ef0d660170", "committedDate": "2020-01-17T10:53:55Z", "message": "RHPAM-2556 - Case reopen capability"}, "afterCommit": {"oid": "087b5e97cf3a761ae143e3a2fa62f6657bd756b2", "author": {"user": {"login": "mswiderski", "name": "Maciej Swiderski"}}, "url": "https://github.com/kiegroup/jbpm/commit/087b5e97cf3a761ae143e3a2fa62f6657bd756b2", "committedDate": "2020-01-17T13:17:00Z", "message": "RHPAM-2556 - Case reopen capability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29f8a318128099c6a5f62c0addd4eab9d903f1a9", "author": {"user": {"login": "gmunozfe", "name": "Gonzalo Mu\u00f1oz"}}, "url": "https://github.com/kiegroup/jbpm/commit/29f8a318128099c6a5f62c0addd4eab9d903f1a9", "committedDate": "2020-01-22T11:49:55Z", "message": "Added more tests for RHPAM-2556 (#12)\n\n* Test case reopening reevaluating after boundary timer fired\r\n\r\n* Add test for human task reopen with previous data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43d9c5f5f9914fa0ac66da49afcbdb2c7d57e863", "author": {"user": {"login": "gmunozfe", "name": "Gonzalo Mu\u00f1oz"}}, "url": "https://github.com/kiegroup/jbpm/commit/43d9c5f5f9914fa0ac66da49afcbdb2c7d57e863", "committedDate": "2020-01-24T11:52:59Z", "message": "RHPAM-2556: Test coverage: reopen after dynamic subprocess (#13)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf6477f7ef55094451285406e930ffd0b4fc329d", "author": {"user": {"login": "gmunozfe", "name": "Gonzalo Mu\u00f1oz"}}, "url": "https://github.com/kiegroup/jbpm/commit/cf6477f7ef55094451285406e930ffd0b4fc329d", "committedDate": "2020-01-25T00:32:27Z", "message": "RHPAM-2566: fix test - clashing same completion condition (#14)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwOTY1NzU3", "url": "https://github.com/kiegroup/jbpm/pull/1581#pullrequestreview-350965757", "createdAt": "2020-01-30T16:32:46Z", "commit": {"oid": "cf6477f7ef55094451285406e930ffd0b4fc329d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1013, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}