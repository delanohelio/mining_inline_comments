{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzOTk5MzE5", "number": 1618, "title": "[JBPM-9073] Unique index error when correlationKey name is set to null", "bodyText": "name in correlation key does not reflect the external form. Change to switch factory\nimplementation", "createdAt": "2020-03-26T07:22:54Z", "url": "https://github.com/kiegroup/jbpm/pull/1618", "merged": true, "mergeCommit": {"oid": "9d4b068912574bb9c100140acb9b7c903bcc365c"}, "closed": true, "closedAt": "2020-03-31T13:00:05Z", "author": {"login": "elguardian"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRvFgkgFqTM4MTc4Mjc2OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSwSGeABqjMxNzkyMTg1NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNzgyNzY5", "url": "https://github.com/kiegroup/jbpm/pull/1618#pullrequestreview-381782769", "createdAt": "2020-03-26T08:21:18Z", "commit": {"oid": "3fe1fe951fc75a2b089ec4eaa219c4368885badb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwODoyMToxOFrOF77pNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNDozNjo0NFrOF8J_yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4NzUxMA==", "bodyText": "Quick question, there is no need to add any CorrelationPropertyInfo object to the correlactionKey object? Just asking as I see we were doing that before.\nOtherwise, looks great to me. I will wait for the CI to complete and then check it on the db certification matrix.\nNice one @elguardian", "url": "https://github.com/kiegroup/jbpm/pull/1618#discussion_r398387510", "createdAt": "2020-03-26T08:21:18Z", "author": {"login": "afalhambra"}, "path": "jbpm-persistence/jbpm-persistence-jpa/src/main/java/org/jbpm/persistence/processinstance/JPAProcessInstanceManager.java", "diffHunk": "@@ -87,8 +90,7 @@ public void addProcessInstance(ProcessInstance processInstance, CorrelationKey c\n         processInstanceInfo.updateLastReadDate();\n         // generate correlation key if not given which is same as process instance id to keep uniqueness \n         if (correlationKey == null) {\n-            correlationKey = new CorrelationKeyInfo();\n-            ((CorrelationKeyInfo)correlationKey).addProperty(new CorrelationPropertyInfo(null, processInstanceInfo.getId().toString()));\n+            correlationKey = (CorrelationKeyInfo) correlationKeyFactory.newCorrelationKey(processInstanceInfo.getId().toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fe1fe951fc75a2b089ec4eaa219c4368885badb"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyMjY2NA==", "bodyText": "Cast to CorrelationKeyInfo is not needed", "url": "https://github.com/kiegroup/jbpm/pull/1618#discussion_r398622664", "createdAt": "2020-03-26T14:36:44Z", "author": {"login": "afalhambra"}, "path": "jbpm-persistence/jbpm-persistence-jpa/src/main/java/org/jbpm/persistence/processinstance/JPAProcessInstanceManager.java", "diffHunk": "@@ -87,8 +90,7 @@ public void addProcessInstance(ProcessInstance processInstance, CorrelationKey c\n         processInstanceInfo.updateLastReadDate();\n         // generate correlation key if not given which is same as process instance id to keep uniqueness \n         if (correlationKey == null) {\n-            correlationKey = new CorrelationKeyInfo();\n-            ((CorrelationKeyInfo)correlationKey).addProperty(new CorrelationPropertyInfo(null, processInstanceInfo.getId().toString()));\n+            correlationKey = (CorrelationKeyInfo) correlationKeyFactory.newCorrelationKey(processInstanceInfo.getId().toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fe1fe951fc75a2b089ec4eaa219c4368885badb"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3fe1fe951fc75a2b089ec4eaa219c4368885badb", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/3fe1fe951fc75a2b089ec4eaa219c4368885badb", "committedDate": "2020-03-26T07:21:08Z", "message": "[JBPM-9073] Unique index error when correlationKey name is set to null\n\nname in correlation key does not reflect the external form. Change to switch factory\nimplementation"}, "afterCommit": {"oid": "a02496afc3f7e7023142cd83c38caa484f95ef2b", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/a02496afc3f7e7023142cd83c38caa484f95ef2b", "committedDate": "2020-03-27T11:37:36Z", "message": "[JBPM-9073] Unique index error when correlationKey name is set to null\n\nname in correlation key does not reflect the external form. Change to switch factory\nimplementation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyODU1NDk3", "url": "https://github.com/kiegroup/jbpm/pull/1618#pullrequestreview-382855497", "createdAt": "2020-03-27T13:28:54Z", "commit": {"oid": "a02496afc3f7e7023142cd83c38caa484f95ef2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00a425db74e629528a3627347dea39e9387652c1", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/00a425db74e629528a3627347dea39e9387652c1", "committedDate": "2020-03-30T15:31:38Z", "message": "[JBPM-9073] Unique index error when correlationKey name is set to null\n\nname in correlation key does not reflect the external form. Change to switch factory\nimplementation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a02496afc3f7e7023142cd83c38caa484f95ef2b", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/a02496afc3f7e7023142cd83c38caa484f95ef2b", "committedDate": "2020-03-27T11:37:36Z", "message": "[JBPM-9073] Unique index error when correlationKey name is set to null\n\nname in correlation key does not reflect the external form. Change to switch factory\nimplementation"}, "afterCommit": {"oid": "00a425db74e629528a3627347dea39e9387652c1", "author": {"user": null}, "url": "https://github.com/kiegroup/jbpm/commit/00a425db74e629528a3627347dea39e9387652c1", "committedDate": "2020-03-30T15:31:38Z", "message": "[JBPM-9073] Unique index error when correlationKey name is set to null\n\nname in correlation key does not reflect the external form. Change to switch factory\nimplementation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1066, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}