{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NDk2MzY4", "number": 1794, "title": "[JBPM-9457] Kafka Event Emitter should reuse the same Producer", "bodyText": "JIRA\nJBPM-9457\nUsing one producer to publish all kafka events.\nSince the events are published at the end of transaction there is no chance for the appearance of \"ghost events\"\nThe main caveat againts the previous implementation is that there exist a minimal chance (if Kafka broker goes down or out of reach during publishing of events) that not all events associate to the transaction are published if Kafka is avaialble (normally there is only one event associated to the transaction, so 99% of the cases this error scenario is equivalent to the transacted one, where the options were none vs all published).", "createdAt": "2020-11-04T16:25:35Z", "url": "https://github.com/kiegroup/jbpm/pull/1794", "merged": true, "mergeCommit": {"oid": "021ef3bff3d6da7e9581bc6fc2b894cd3d84e999"}, "closed": true, "closedAt": "2020-11-09T14:03:40Z", "author": {"login": "fjtirado"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZQzQ4gBqjM5NTg1Njk2MzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABda1RfEAFqTUyNjI4NTc0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f261c87c720658c80dd8651147d6ec794b600b21", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/f261c87c720658c80dd8651147d6ec794b600b21", "committedDate": "2020-11-04T16:21:17Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}, "afterCommit": {"oid": "94aaf3b8b2ed4b126b48937957d96607751b48cf", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/94aaf3b8b2ed4b126b48937957d96607751b48cf", "committedDate": "2020-11-04T16:59:40Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94aaf3b8b2ed4b126b48937957d96607751b48cf", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/94aaf3b8b2ed4b126b48937957d96607751b48cf", "committedDate": "2020-11-04T16:59:40Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}, "afterCommit": {"oid": "039afc9ac7f8386e1bcdd846e3986e61c1bde2f1", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/039afc9ac7f8386e1bcdd846e3986e61c1bde2f1", "committedDate": "2020-11-04T17:02:24Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "039afc9ac7f8386e1bcdd846e3986e61c1bde2f1", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/039afc9ac7f8386e1bcdd846e3986e61c1bde2f1", "committedDate": "2020-11-04T17:02:24Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}, "afterCommit": {"oid": "da3c114cf7b0c39d788a6678b674b356c11f8d55", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/da3c114cf7b0c39d788a6678b674b356c11f8d55", "committedDate": "2020-11-04T17:08:52Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da3c114cf7b0c39d788a6678b674b356c11f8d55", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/da3c114cf7b0c39d788a6678b674b356c11f8d55", "committedDate": "2020-11-04T17:08:52Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}, "afterCommit": {"oid": "8d2b386d72823d5a94fd84ea1ffe6ea9c83dc478", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/8d2b386d72823d5a94fd84ea1ffe6ea9c83dc478", "committedDate": "2020-11-04T18:44:44Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d2b386d72823d5a94fd84ea1ffe6ea9c83dc478", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/8d2b386d72823d5a94fd84ea1ffe6ea9c83dc478", "committedDate": "2020-11-04T18:44:44Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}, "afterCommit": {"oid": "d30376732e44b7aae138e3c0e0435ed0344de5bc", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/d30376732e44b7aae138e3c0e0435ed0344de5bc", "committedDate": "2020-11-04T18:50:14Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNjY5MDc4", "url": "https://github.com/kiegroup/jbpm/pull/1794#pullrequestreview-523669078", "createdAt": "2020-11-04T19:25:58Z", "commit": {"oid": "d30376732e44b7aae138e3c0e0435ed0344de5bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MjgzMTE1", "url": "https://github.com/kiegroup/jbpm/pull/1794#pullrequestreview-524283115", "createdAt": "2020-11-05T13:56:10Z", "commit": {"oid": "d30376732e44b7aae138e3c0e0435ed0344de5bc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMzo1NjoxMVrOHuEYpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMzo1NjoxMVrOHuEYpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA2ODM4OQ==", "bodyText": "you need to add a callback here to know if the message was delivered or not.\nhttps://kafka.apache.org/10/javadoc/org/apache/kafka/clients/producer/KafkaProducer.html#send-org.apache.kafka.clients.producer.ProducerRecord-org.apache.kafka.clients.producer.Callback-\nin case the callback is a exception the data needs to be logged entirely", "url": "https://github.com/kiegroup/jbpm/pull/1794#discussion_r518068389", "createdAt": "2020-11-05T13:56:11Z", "author": {"login": "elguardian"}, "path": "jbpm-event-emitters/jbpm-event-emitters-kafka/src/main/java/org/jbpm/event/emitters/kafka/KafkaEventEmitter.java", "diffHunk": "@@ -110,55 +112,40 @@ public void deliver(Collection<InstanceView<?>> data) {\n                 producer.send(new ProducerRecord<>(getTopic(topic), mapper.writeValueAsBytes(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d30376732e44b7aae138e3c0e0435ed0344de5bc"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d30376732e44b7aae138e3c0e0435ed0344de5bc", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/d30376732e44b7aae138e3c0e0435ed0344de5bc", "committedDate": "2020-11-04T18:50:14Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}, "afterCommit": {"oid": "04dcd382ad6e77ac4344bb6b44990134166f7968", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/04dcd382ad6e77ac4344bb6b44990134166f7968", "committedDate": "2020-11-05T14:44:21Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04dcd382ad6e77ac4344bb6b44990134166f7968", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/04dcd382ad6e77ac4344bb6b44990134166f7968", "committedDate": "2020-11-05T14:44:21Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}, "afterCommit": {"oid": "68d8593ae37c4b9743a41fb29d0b32098f3b27b9", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/68d8593ae37c4b9743a41fb29d0b32098f3b27b9", "committedDate": "2020-11-06T08:06:13Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68d8593ae37c4b9743a41fb29d0b32098f3b27b9", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/68d8593ae37c4b9743a41fb29d0b32098f3b27b9", "committedDate": "2020-11-06T08:06:13Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}, "afterCommit": {"oid": "446b7624c6e9ae639b7ff6eca067716b656e9d60", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/446b7624c6e9ae639b7ff6eca067716b656e9d60", "committedDate": "2020-11-06T08:54:13Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "446b7624c6e9ae639b7ff6eca067716b656e9d60", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/446b7624c6e9ae639b7ff6eca067716b656e9d60", "committedDate": "2020-11-06T08:54:13Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}, "afterCommit": {"oid": "ac27914cdf5e8e9e84094c5d60140dcccce5791b", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/ac27914cdf5e8e9e84094c5d60140dcccce5791b", "committedDate": "2020-11-06T18:31:55Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87733c4596b6c4978d62f07500f7efb8d1d67345", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/87733c4596b6c4978d62f07500f7efb8d1d67345", "committedDate": "2020-11-06T18:34:35Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac27914cdf5e8e9e84094c5d60140dcccce5791b", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/ac27914cdf5e8e9e84094c5d60140dcccce5791b", "committedDate": "2020-11-06T18:31:55Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}, "afterCommit": {"oid": "87733c4596b6c4978d62f07500f7efb8d1d67345", "author": {"user": {"login": "fjtirado", "name": "Francisco Javier Tirado Sarti"}}, "url": "https://github.com/kiegroup/jbpm/commit/87733c4596b6c4978d62f07500f7efb8d1d67345", "committedDate": "2020-11-06T18:34:35Z", "message": "[JBPM-4957] Kafka Event Emitter should reuse the same Producer\n\nUsing one consumer to rule them all"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2Mjg1NzQz", "url": "https://github.com/kiegroup/jbpm/pull/1794#pullrequestreview-526285743", "createdAt": "2020-11-09T14:03:20Z", "commit": {"oid": "87733c4596b6c4978d62f07500f7efb8d1d67345"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 822, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}