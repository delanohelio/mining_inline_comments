{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3Njk1MzI5", "number": 1539, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNTowNjozMVrOE9rB1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNFQxNjoxMjoxOFrOF6LDlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMTAzNTc0OnYy", "diffSide": "RIGHT", "path": "docs/metrics.asciidoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNTowNjozMVrOH6fF8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QxNDowMToyM1rOJUJffA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA4ODg4Mw==", "bodyText": "I didn't see the Spring Boot section when I used these docs to setup my micrometer integration.\nDid we consider solutions to make it easy for developers using Spring Boot to find our dedicated doc. As Spring Boot is very popular, we may even consider moving this section before the \"Do It Yourself\" section.", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r531088883", "createdAt": "2020-11-26T15:06:31Z", "author": {"login": "cyrille-leclerc"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -397,16 +440,16 @@ MeterRegistry registry = new SimpleMeterRegistry(new SimpleConfig() {\n             return null;\n         }\n     }, Clock.SYSTEM);\n-\n-```\n+----\n \n When using Spring Boot, you can use the `management.metrics.export.simple` prefix to configure via `application.properties`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e04c426a261935a2bf397d7a342a66d9d91dfed"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTEwNjgxMg==", "bodyText": "Let's add a separate section for Spring Boot and add a table of contents to the top of the page.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            When using Spring Boot, you can use the `management.metrics.export.simple` prefix to configure via `application.properties`\n          \n          \n            \n            ==== Get started with Spring Boot\n          \n          \n            \n            \n          \n          \n            \n            The easiest way to get started with Spring Boot is to add a dependency to [Spring Boot Actuator](https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html) if you haven't already. Spring Boot Actuator provides dependency management and auto-configuration for Micrometer.\n          \n          \n            \n            \n          \n          \n            \n            Use the `management.metrics.export.simple` prefix to configure via `application.properties`", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625106812", "createdAt": "2021-05-03T14:01:23Z", "author": {"login": "felixbarny"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -397,16 +440,16 @@ MeterRegistry registry = new SimpleMeterRegistry(new SimpleConfig() {\n             return null;\n         }\n     }, Clock.SYSTEM);\n-\n-```\n+----\n \n When using Spring Boot, you can use the `management.metrics.export.simple` prefix to configure via `application.properties`", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA4ODg4Mw=="}, "originalCommit": {"oid": "9e04c426a261935a2bf397d7a342a66d9d91dfed"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMTA0OTI2OnYy", "diffSide": "RIGHT", "path": "docs/metrics.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNToxMDowMVrOH6fOMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNToxMDowMVrOH6fOMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA5MDk5Mw==", "bodyText": "It's not completely accurate that Histograms are not supported. Histograms are partially supported creating two counters that already enable insightful information: a sum counter (xxx.sum) and a count counter (xxx.count).\nInstead of the explanation \"Histograms aren\u2019t supported yet\", an explanation that would look like\n\nHistograms (DistributionSummary, Timerand LongTaskTimer) are partially supported converting the histogram metric into two derived metric: a counter of the values and the sum of the values.\nFor example, DistributionSummary.builder(\"order\").register(...).record(orderPrice) will create two metrics: order.sumand order.count.\n\nTODO: we should verify that Timer and LongTaskTimer behave the same way as DistributionSummary creating these two derived metrics.\nSee #1515", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r531090993", "createdAt": "2020-11-26T15:10:01Z", "author": {"login": "cyrille-leclerc"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -333,12 +334,13 @@ The reason for that is that if you set your sampling rate to 10%, for example,\n you'll only be storing one out of 10 requests.\n The labels you set on non-sampled transactions will be lost.\n \n-\n [float]\n [[metrics-micrometer-beta-caveats]]\n-==== Beta caveats\n-* To fix some of the caveats listed here, we may have to introduce breaking changes.\n-  So please watch release notes Micrometer-related changes before updating.\n+==== Caveats\n+\n+To fix some of the caveats listed here, we may have to introduce breaking changes.\n+Please look for Micrometer-related release notes before updating.\n+\n * Metrics with dots in their name can result in mapping conflicts.\n See https://github.com/elastic/apm/issues/347[elastic/apm#347]\n * Histograms aren't supported yet", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e04c426a261935a2bf397d7a342a66d9d91dfed"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzk1OTA3NjM3OnYy", "diffSide": "RIGHT", "path": "docs/metrics.asciidoc", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QwODoyNzoyNVrOJT_s7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNFQxNjoxMDoyM1rOJU601w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDk0NjQxMg==", "bodyText": "Is this a placeholder for something? (preview is not accessible)", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r624946412", "createdAt": "2021-05-03T08:27:25Z", "author": {"login": "eyalkoren"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -313,9 +313,10 @@ You can filter and group by these dimensions:\n --\n \n \n-[float]\n [[metrics-micrometer]]\n-=== Custom metrics using Micrometer (beta)\n+=== Micrometer metrics\n+\n+beta::[]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ce4e790b587b06e6c74bc7274a59c13c42c377"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTg5NjQ0Ng==", "bodyText": "The beta::[] tag builds a beta admonition paragraph:", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625896446", "createdAt": "2021-05-04T15:46:30Z", "author": {"login": "bmorelli25"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -313,9 +313,10 @@ You can filter and group by these dimensions:\n --\n \n \n-[float]\n [[metrics-micrometer]]\n-=== Custom metrics using Micrometer (beta)\n+=== Micrometer metrics\n+\n+beta::[]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDk0NjQxMg=="}, "originalCommit": {"oid": "48ce4e790b587b06e6c74bc7274a59c13c42c377"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTkxNTA5NQ==", "bodyText": "Should be available now: https://apm-agent-java_1539.docs-preview.app.elstc.co/guide/en/apm/agent/java/master/metrics-micrometer.html", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625915095", "createdAt": "2021-05-04T16:10:23Z", "author": {"login": "bmorelli25"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -313,9 +313,10 @@ You can filter and group by these dimensions:\n --\n \n \n-[float]\n [[metrics-micrometer]]\n-=== Custom metrics using Micrometer (beta)\n+=== Micrometer metrics\n+\n+beta::[]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDk0NjQxMg=="}, "originalCommit": {"oid": "48ce4e790b587b06e6c74bc7274a59c13c42c377"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzk1OTA3OTYyOnYy", "diffSide": "RIGHT", "path": "docs/metrics.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QwODoyODoyMFrOJT_uxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QwODoyODoyMFrOJT_uxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDk0Njg4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For example, `DistributionSummary.builder(\"order\").register(...).record(orderPrice)`` will create two metrics: `order.sum` and `order.count`.\n          \n          \n            \n            For example, `DistributionSummary.builder(\"order\").register(...).record(orderPrice)` will create two metrics: `order.sum` and `order.count`.", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r624946884", "createdAt": "2021-05-03T08:28:20Z", "author": {"login": "eyalkoren"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -334,15 +335,20 @@ The reason for that is that if you set your sampling rate to 10%, for example,\n you'll only be storing one out of 10 requests.\n The labels you set on non-sampled transactions will be lost.\n \n-\n [float]\n [[metrics-micrometer-beta-caveats]]\n-==== Beta caveats\n-* To fix some of the caveats listed here, we may have to introduce breaking changes.\n-  So please watch release notes Micrometer-related changes before updating.\n+==== Caveats\n+\n+To fix some of the caveats listed here, we may have to introduce breaking changes.\n+Please look for Micrometer-related release notes before updating.\n+\n * Metrics with dots in their name can result in mapping conflicts.\n See https://github.com/elastic/apm/issues/347[elastic/apm#347]\n-* Histograms aren't supported yet\n+* Histograms(https://www.javadoc.io/doc/io.micrometer/micrometer-core/latest/io/micrometer/core/instrument/DistributionSummary.html[DistributionSummary],\n+https://www.javadoc.io/doc/io.micrometer/micrometer-core/latest/io/micrometer/core/instrument/Timer.html[Timer],\n+and https://www.javadoc.io/doc/io.micrometer/micrometer-core/latest/io/micrometer/core/instrument/LongTaskTimer.html[LongTaskTimer])\n+are partially supported converting the histogram metric into two derived metric: a counter of the values and the sum of the values.\n+For example, `DistributionSummary.builder(\"order\").register(...).record(orderPrice)`` will create two metrics: `order.sum` and `order.count`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ce4e790b587b06e6c74bc7274a59c13c42c377"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzk1OTA4MjE4OnYy", "diffSide": "RIGHT", "path": "docs/metrics.asciidoc", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QwODoyOToxM1rOJT_wVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QxNDoxNjowNlrOJUKHNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDk0NzI4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Metrics with dots in their name can result in mapping conflicts.\n          \n          \n            \n            See https://github.com/elastic/apm/issues/347[elastic/apm#347]\n          \n          \n            \n            * Metrics with dots in their name will be renamed with underscores instead of dots", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r624947284", "createdAt": "2021-05-03T08:29:13Z", "author": {"login": "eyalkoren"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -334,15 +335,20 @@ The reason for that is that if you set your sampling rate to 10%, for example,\n you'll only be storing one out of 10 requests.\n The labels you set on non-sampled transactions will be lost.\n \n-\n [float]\n [[metrics-micrometer-beta-caveats]]\n-==== Beta caveats\n-* To fix some of the caveats listed here, we may have to introduce breaking changes.\n-  So please watch release notes Micrometer-related changes before updating.\n+==== Caveats\n+\n+To fix some of the caveats listed here, we may have to introduce breaking changes.\n+Please look for Micrometer-related release notes before updating.\n+\n * Metrics with dots in their name can result in mapping conflicts.\n See https://github.com/elastic/apm/issues/347[elastic/apm#347]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ce4e790b587b06e6c74bc7274a59c13c42c377"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTA5MDE5NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Metrics with dots in their name can result in mapping conflicts.\n          \n          \n            \n            See https://github.com/elastic/apm/issues/347[elastic/apm#347]\n          \n          \n            \n            * Dots in metric names of Micrometer metrics get replaced with underscores to avoid mapping conflicts.\n          \n          \n            \n            De-dotting can be disabled via <<config-dedot-custom-metrics, `dedot_custom_metrics`>>.", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625090195", "createdAt": "2021-05-03T13:36:17Z", "author": {"login": "felixbarny"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -334,15 +335,20 @@ The reason for that is that if you set your sampling rate to 10%, for example,\n you'll only be storing one out of 10 requests.\n The labels you set on non-sampled transactions will be lost.\n \n-\n [float]\n [[metrics-micrometer-beta-caveats]]\n-==== Beta caveats\n-* To fix some of the caveats listed here, we may have to introduce breaking changes.\n-  So please watch release notes Micrometer-related changes before updating.\n+==== Caveats\n+\n+To fix some of the caveats listed here, we may have to introduce breaking changes.\n+Please look for Micrometer-related release notes before updating.\n+\n * Metrics with dots in their name can result in mapping conflicts.\n See https://github.com/elastic/apm/issues/347[elastic/apm#347]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDk0NzI4NA=="}, "originalCommit": {"oid": "48ce4e790b587b06e6c74bc7274a59c13c42c377"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTExNjk4MA==", "bodyText": "Much better \ud83d\ude42", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625116980", "createdAt": "2021-05-03T14:16:06Z", "author": {"login": "eyalkoren"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -334,15 +335,20 @@ The reason for that is that if you set your sampling rate to 10%, for example,\n you'll only be storing one out of 10 requests.\n The labels you set on non-sampled transactions will be lost.\n \n-\n [float]\n [[metrics-micrometer-beta-caveats]]\n-==== Beta caveats\n-* To fix some of the caveats listed here, we may have to introduce breaking changes.\n-  So please watch release notes Micrometer-related changes before updating.\n+==== Caveats\n+\n+To fix some of the caveats listed here, we may have to introduce breaking changes.\n+Please look for Micrometer-related release notes before updating.\n+\n * Metrics with dots in their name can result in mapping conflicts.\n See https://github.com/elastic/apm/issues/347[elastic/apm#347]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDk0NzI4NA=="}, "originalCommit": {"oid": "48ce4e790b587b06e6c74bc7274a59c13c42c377"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzk1OTMxNjMzOnYy", "diffSide": "RIGHT", "path": "docs/metrics.asciidoc", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QwOTo0Mzo1N1rOJUB4ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNFQxNjoxMDozOVrOJU61qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDk4MjE1NA==", "bodyText": "Looks like a duplication, however the \"Get started with existing Micrometer setup\" title is better, so you can use if for the section you leave in.", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r624982154", "createdAt": "2021-05-03T09:43:57Z", "author": {"login": "eyalkoren"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -352,6 +358,47 @@ See https://github.com/elastic/apm-agent-java/issues/1476[#1476]\n   But you have to remember to group by a combination of dimensions that uniquely identify the time series.\n   This may be a combination of `host.name` and `service.name`, or the `kubernetes.pod.id`.\n \n+[float]\n+[[micrometer-get-started]]\n+==== Get started with Micrometer\n+\n+Attach the agent and you\u2019re done!\n+The agent automatically detects all `MeterRegistry` instances and reports all metrics to APM Server (in addition to where they originally report).\n+When attaching the agent after the application has already started, the agent detects a `MeterRegistry` when calling any public method on it.\n+If you are using multiple registries within a `CompoundMeterRegistry`, the agent only reports the metrics once.\n+\n+[float]\n+[[verify-micrometer-data]]\n+==== Verify micrometer data\n+\n+Use Discover to validate that metrics are successfully reported to Kibana.\n+\n+. Launch {kib}.\n+. Open the main menu, then click *Discover*.\n+. Select `apm-*` as your index pattern.\n+. Filter the data to only show documents with metrics: `processor.name :\"metric\"`\n+. Optionally, apply additional filters by service or host names if micrometer was only instrumented on a subset of your environment.\n+\n+You should now see documents containing both metrics collected by the APM agent and custom metrics from micrometer.\n+Narrow your search with a known micrometer metric field.\n+For example, if you know `cache.puts` is a micrometer field, add `cache.puts: *` to your search to return only micrometer metrics documents:\n+\n+[float]\n+[[visualize-micrometer-data]]\n+==== Visualize micrometer data\n+\n+NOTE: Monotonically increased counters and Positive rate aggregations are not fully supported in the current version.\n+\n+{kib-ref}/tsvb.html[TSVB] is the recommended visualization for micrometer metrics.\n+First, make sure to select right aggregation. The most common options are:\n+\n+* Sum: Useful for business metrics\n+* Average: Usually used for performance related metrics\n+\n+It's a common task to group metrics by attributes, including micrometer labels or attributes already collected by APM agents. This could be service versions, runtime versions, or even cloud metadata.\n+\n+TIP: See the https://www.elastic.co/blog/visualizing-observability-with-kibana-event-rates-and-rate-of-change-in-tsvb[Event rates and rate of change in TSVB] blog post for more information.\n+\n [float]\n [[metrics-micrometer-get-started-existing]]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48ce4e790b587b06e6c74bc7274a59c13c42c377"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTkxMjQzMw==", "bodyText": "Done \u2705", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625912433", "createdAt": "2021-05-04T16:06:50Z", "author": {"login": "bmorelli25"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -352,6 +358,47 @@ See https://github.com/elastic/apm-agent-java/issues/1476[#1476]\n   But you have to remember to group by a combination of dimensions that uniquely identify the time series.\n   This may be a combination of `host.name` and `service.name`, or the `kubernetes.pod.id`.\n \n+[float]\n+[[micrometer-get-started]]\n+==== Get started with Micrometer\n+\n+Attach the agent and you\u2019re done!\n+The agent automatically detects all `MeterRegistry` instances and reports all metrics to APM Server (in addition to where they originally report).\n+When attaching the agent after the application has already started, the agent detects a `MeterRegistry` when calling any public method on it.\n+If you are using multiple registries within a `CompoundMeterRegistry`, the agent only reports the metrics once.\n+\n+[float]\n+[[verify-micrometer-data]]\n+==== Verify micrometer data\n+\n+Use Discover to validate that metrics are successfully reported to Kibana.\n+\n+. Launch {kib}.\n+. Open the main menu, then click *Discover*.\n+. Select `apm-*` as your index pattern.\n+. Filter the data to only show documents with metrics: `processor.name :\"metric\"`\n+. Optionally, apply additional filters by service or host names if micrometer was only instrumented on a subset of your environment.\n+\n+You should now see documents containing both metrics collected by the APM agent and custom metrics from micrometer.\n+Narrow your search with a known micrometer metric field.\n+For example, if you know `cache.puts` is a micrometer field, add `cache.puts: *` to your search to return only micrometer metrics documents:\n+\n+[float]\n+[[visualize-micrometer-data]]\n+==== Visualize micrometer data\n+\n+NOTE: Monotonically increased counters and Positive rate aggregations are not fully supported in the current version.\n+\n+{kib-ref}/tsvb.html[TSVB] is the recommended visualization for micrometer metrics.\n+First, make sure to select right aggregation. The most common options are:\n+\n+* Sum: Useful for business metrics\n+* Average: Usually used for performance related metrics\n+\n+It's a common task to group metrics by attributes, including micrometer labels or attributes already collected by APM agents. This could be service versions, runtime versions, or even cloud metadata.\n+\n+TIP: See the https://www.elastic.co/blog/visualizing-observability-with-kibana-event-rates-and-rate-of-change-in-tsvb[Event rates and rate of change in TSVB] blog post for more information.\n+\n [float]\n [[metrics-micrometer-get-started-existing]]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDk4MjE1NA=="}, "originalCommit": {"oid": "48ce4e790b587b06e6c74bc7274a59c13c42c377"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTkxNTMwNg==", "bodyText": "\u2705", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625915306", "createdAt": "2021-05-04T16:10:39Z", "author": {"login": "bmorelli25"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -352,6 +358,47 @@ See https://github.com/elastic/apm-agent-java/issues/1476[#1476]\n   But you have to remember to group by a combination of dimensions that uniquely identify the time series.\n   This may be a combination of `host.name` and `service.name`, or the `kubernetes.pod.id`.\n \n+[float]\n+[[micrometer-get-started]]\n+==== Get started with Micrometer\n+\n+Attach the agent and you\u2019re done!\n+The agent automatically detects all `MeterRegistry` instances and reports all metrics to APM Server (in addition to where they originally report).\n+When attaching the agent after the application has already started, the agent detects a `MeterRegistry` when calling any public method on it.\n+If you are using multiple registries within a `CompoundMeterRegistry`, the agent only reports the metrics once.\n+\n+[float]\n+[[verify-micrometer-data]]\n+==== Verify micrometer data\n+\n+Use Discover to validate that metrics are successfully reported to Kibana.\n+\n+. Launch {kib}.\n+. Open the main menu, then click *Discover*.\n+. Select `apm-*` as your index pattern.\n+. Filter the data to only show documents with metrics: `processor.name :\"metric\"`\n+. Optionally, apply additional filters by service or host names if micrometer was only instrumented on a subset of your environment.\n+\n+You should now see documents containing both metrics collected by the APM agent and custom metrics from micrometer.\n+Narrow your search with a known micrometer metric field.\n+For example, if you know `cache.puts` is a micrometer field, add `cache.puts: *` to your search to return only micrometer metrics documents:\n+\n+[float]\n+[[visualize-micrometer-data]]\n+==== Visualize micrometer data\n+\n+NOTE: Monotonically increased counters and Positive rate aggregations are not fully supported in the current version.\n+\n+{kib-ref}/tsvb.html[TSVB] is the recommended visualization for micrometer metrics.\n+First, make sure to select right aggregation. The most common options are:\n+\n+* Sum: Useful for business metrics\n+* Average: Usually used for performance related metrics\n+\n+It's a common task to group metrics by attributes, including micrometer labels or attributes already collected by APM agents. This could be service versions, runtime versions, or even cloud metadata.\n+\n+TIP: See the https://www.elastic.co/blog/visualizing-observability-with-kibana-event-rates-and-rate-of-change-in-tsvb[Event rates and rate of change in TSVB] blog post for more information.\n+\n [float]\n [[metrics-micrometer-get-started-existing]]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNDk4MjE1NA=="}, "originalCommit": {"oid": "48ce4e790b587b06e6c74bc7274a59c13c42c377"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzk2MDA0Nzc2OnYy", "diffSide": "RIGHT", "path": "docs/metrics.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QxMzozOTo1MVrOJUInYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QxMzozOTo1MVrOJUInYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTA5MjQ1MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            For example, if you know `cache.puts` is a micrometer field, add `cache.puts: *` to your search to return only micrometer metrics documents:\n          \n          \n            \n            For example, if you know you have registered the metric name `cache.puts` in the micrometer `MeterRegistry`, add `cache_puts: *` (dots are replaced with underscores) to your search to return only micrometer metrics documents:", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625092451", "createdAt": "2021-05-03T13:39:51Z", "author": {"login": "felixbarny"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -352,6 +358,47 @@ See https://github.com/elastic/apm-agent-java/issues/1476[#1476]\n   But you have to remember to group by a combination of dimensions that uniquely identify the time series.\n   This may be a combination of `host.name` and `service.name`, or the `kubernetes.pod.id`.\n \n+[float]\n+[[micrometer-get-started]]\n+==== Get started with Micrometer\n+\n+Attach the agent and you\u2019re done!\n+The agent automatically detects all `MeterRegistry` instances and reports all metrics to APM Server (in addition to where they originally report).\n+When attaching the agent after the application has already started, the agent detects a `MeterRegistry` when calling any public method on it.\n+If you are using multiple registries within a `CompoundMeterRegistry`, the agent only reports the metrics once.\n+\n+[float]\n+[[verify-micrometer-data]]\n+==== Verify micrometer data\n+\n+Use Discover to validate that metrics are successfully reported to Kibana.\n+\n+. Launch {kib}.\n+. Open the main menu, then click *Discover*.\n+. Select `apm-*` as your index pattern.\n+. Filter the data to only show documents with metrics: `processor.name :\"metric\"`\n+. Optionally, apply additional filters by service or host names if micrometer was only instrumented on a subset of your environment.\n+\n+You should now see documents containing both metrics collected by the APM agent and custom metrics from micrometer.\n+Narrow your search with a known micrometer metric field.\n+For example, if you know `cache.puts` is a micrometer field, add `cache.puts: *` to your search to return only micrometer metrics documents:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c508e18632e9973acc939aaebc07cbb7171fbf5"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzk2MDA1ODc5OnYy", "diffSide": "RIGHT", "path": "docs/metrics.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QxMzo0MjoxOFrOJUIt5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QxMzo0MjoxOFrOJUIt5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTA5NDExNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            It's a common task to group metrics by attributes, including micrometer labels or attributes already collected by APM agents. This could be service versions, runtime versions, or even cloud metadata.\n          \n          \n            \n            It's common to group metrics by attributes, including micrometer labels or attributes already collected by APM agents. This could be service versions, runtime versions, or even cloud metadata.", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625094116", "createdAt": "2021-05-03T13:42:18Z", "author": {"login": "felixbarny"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -352,6 +358,47 @@ See https://github.com/elastic/apm-agent-java/issues/1476[#1476]\n   But you have to remember to group by a combination of dimensions that uniquely identify the time series.\n   This may be a combination of `host.name` and `service.name`, or the `kubernetes.pod.id`.\n \n+[float]\n+[[micrometer-get-started]]\n+==== Get started with Micrometer\n+\n+Attach the agent and you\u2019re done!\n+The agent automatically detects all `MeterRegistry` instances and reports all metrics to APM Server (in addition to where they originally report).\n+When attaching the agent after the application has already started, the agent detects a `MeterRegistry` when calling any public method on it.\n+If you are using multiple registries within a `CompoundMeterRegistry`, the agent only reports the metrics once.\n+\n+[float]\n+[[verify-micrometer-data]]\n+==== Verify micrometer data\n+\n+Use Discover to validate that metrics are successfully reported to Kibana.\n+\n+. Launch {kib}.\n+. Open the main menu, then click *Discover*.\n+. Select `apm-*` as your index pattern.\n+. Filter the data to only show documents with metrics: `processor.name :\"metric\"`\n+. Optionally, apply additional filters by service or host names if micrometer was only instrumented on a subset of your environment.\n+\n+You should now see documents containing both metrics collected by the APM agent and custom metrics from micrometer.\n+Narrow your search with a known micrometer metric field.\n+For example, if you know `cache.puts` is a micrometer field, add `cache.puts: *` to your search to return only micrometer metrics documents:\n+\n+[float]\n+[[visualize-micrometer-data]]\n+==== Visualize micrometer data\n+\n+NOTE: Monotonically increased counters and Positive rate aggregations are not fully supported in the current version.\n+\n+{kib-ref}/tsvb.html[TSVB] is the recommended visualization for micrometer metrics.\n+First, make sure to select right aggregation. The most common options are:\n+\n+* Sum: Useful for business metrics\n+* Average: Usually used for performance related metrics\n+\n+It's a common task to group metrics by attributes, including micrometer labels or attributes already collected by APM agents. This could be service versions, runtime versions, or even cloud metadata.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c508e18632e9973acc939aaebc07cbb7171fbf5"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzk2MDI0NTUwOnYy", "diffSide": "RIGHT", "path": "docs/metrics.asciidoc", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QxNDoyNDoxMlrOJUKdWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wM1QxNDoyNDozNVrOJUKeWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTEyMjY1MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [[micrometer-get-started]]\n          \n          \n            \n            ==== Get started with Micrometer\n          \n          \n            \n            [[metrics-micrometer-get-started-existing]]\n          \n          \n            \n            ==== Get started with existing Micrometer setup", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625122651", "createdAt": "2021-05-03T14:24:12Z", "author": {"login": "eyalkoren"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -352,6 +358,47 @@ See https://github.com/elastic/apm-agent-java/issues/1476[#1476]\n   But you have to remember to group by a combination of dimensions that uniquely identify the time series.\n   This may be a combination of `host.name` and `service.name`, or the `kubernetes.pod.id`.\n \n+[float]\n+[[micrometer-get-started]]\n+==== Get started with Micrometer", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c508e18632e9973acc939aaebc07cbb7171fbf5"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTEyMjkwNw==", "bodyText": "Assuming that the duplicated one is removed from below", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625122907", "createdAt": "2021-05-03T14:24:35Z", "author": {"login": "eyalkoren"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -352,6 +358,47 @@ See https://github.com/elastic/apm-agent-java/issues/1476[#1476]\n   But you have to remember to group by a combination of dimensions that uniquely identify the time series.\n   This may be a combination of `host.name` and `service.name`, or the `kubernetes.pod.id`.\n \n+[float]\n+[[micrometer-get-started]]\n+==== Get started with Micrometer", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTEyMjY1MQ=="}, "originalCommit": {"oid": "6c508e18632e9973acc939aaebc07cbb7171fbf5"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzk2NTQyODcwOnYy", "diffSide": "RIGHT", "path": "docs/metrics.asciidoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNFQxNjoxMjoxOFrOJU66lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNFQxNjoxMjoxOFrOJU66lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNTkxNjU2NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            {kib-ref}/tsvb.html[TSVB] is the recommended visualization for Micrometer metrics.\n          \n          \n            \n            {kibana-ref}/tsvb.html[TSVB] is the recommended visualization for Micrometer metrics.", "url": "https://github.com/elastic/apm-agent-java/pull/1539#discussion_r625916564", "createdAt": "2021-05-04T16:12:18Z", "author": {"login": "bmorelli25"}, "path": "docs/metrics.asciidoc", "diffHunk": "@@ -356,28 +375,60 @@ See https://github.com/elastic/apm-agent-java/issues/1476[#1476]\n [[metrics-micrometer-get-started-existing]]\n ==== Get started with existing Micrometer setup\n \n-You only have to attach the agent, and you're done.\n-The agent automatically detects all `MeterRegistry` instances and reports all metrics to APM Server in addition to where they originally report.\n-When attaching the agent after the application has already started,\n-the agent detects a `MeterRegistry` when calling any public method on it.\n-If you are using multiple registries within a `CompoundMeterRegistry`,\n-the agent makes sure to only report the metrics once.\n+Attach the agent, and you\u2019re done!\n+The agent automatically detects all `MeterRegistry` instances and reports all metrics to APM Server (in addition to where they originally report).\n+When attaching the agent after the application has already started, the agent detects a `MeterRegistry` when calling any public method on it.\n+If you are using multiple registries within a `CompoundMeterRegistry`, the agent only reports the metrics once.\n+\n+[float]\n+[[verify-micrometer-data]]\n+==== Verify Micrometer data\n+\n+Use Discover to validate that metrics are successfully reported to Kibana.\n+\n+. Launch {kib}.\n+. Open the main menu, then click *Discover*.\n+. Select `apm-*` as your index pattern.\n+. Filter the data to only show documents with metrics: `processor.name :\"metric\"`\n+. Optionally, apply additional filters by service or host names if Micrometer was only instrumented on a subset of your environment.\n+\n+You should now see documents containing both metrics collected by the APM agent and custom metrics from Micrometer.\n+Narrow your search with a known Micrometer metric field.\n+For example, if you know you have registered the metric name `cache.puts` in the Micrometer `MeterRegistry`, add `cache_puts: *` (dots are replaced with underscores) to your search to return only Micrometer metrics documents:\n+\n+[float]\n+[[visualize-micrometer-data]]\n+==== Visualize Micrometer data\n+\n+NOTE: Monotonically increased counters and Positive rate aggregations are not fully supported in the current version.\n+\n+{kib-ref}/tsvb.html[TSVB] is the recommended visualization for Micrometer metrics.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dc2044ef8493733a75b5f5656b9fba8e03f7221"}, "originalPosition": 113}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4991, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}