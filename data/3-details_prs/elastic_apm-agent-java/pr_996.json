{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNjE2NDQy", "number": 996, "title": "deleted deprecated classes from intake v1 protocol", "bodyText": "Checklist\n\ncloses #881\n\n Implement code\n Update documentation", "createdAt": "2020-01-16T12:19:11Z", "url": "https://github.com/elastic/apm-agent-java/pull/996", "merged": true, "mergeCommit": {"oid": "18f38c2090760bdbecd25581705e14b557fabd00"}, "closed": true, "closedAt": "2020-01-17T09:47:05Z", "author": {"login": "kananindzya"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb65JbAgH2gAyMzYzNjE2NDQyOjI3ODViYzU4ODllNDhiNjZjZGQwYTAzOGNjNjQ4NDZhZGU5YjM5OTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7K-u9AFqTM0NDQ0MDYzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2785bc5889e48b66cdd0a038cc64846ade9b3993", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/2785bc5889e48b66cdd0a038cc64846ade9b3993", "committedDate": "2020-01-16T12:17:25Z", "message": "deleted deprecated classes from intake v1 protocol"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzOTQ5OTA1", "url": "https://github.com/elastic/apm-agent-java/pull/996#pullrequestreview-343949905", "createdAt": "2020-01-16T14:26:56Z", "commit": {"oid": "2785bc5889e48b66cdd0a038cc64846ade9b3993"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDoyNjo1NlrOFebIOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQxNDoyNzowMlrOFebIaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ0NjA3NA==", "bodyText": "Please also create a new test for this", "url": "https://github.com/elastic/apm-agent-java/pull/996#discussion_r367446074", "createdAt": "2020-01-16T14:26:56Z", "author": {"login": "felixbarny"}, "path": "apm-agent-core/src/test/java/co/elastic/apm/agent/impl/payload/TransactionPayloadJsonSchemaTest.java", "diffHunk": "@@ -1,293 +0,0 @@\n-/*-\n- * #%L\n- * Elastic APM Java agent\n- * %%\n- * Copyright (C) 2018 - 2019 Elastic and contributors\n- * %%\n- * Licensed to Elasticsearch B.V. under one or more contributor\n- * license agreements. See the NOTICE file distributed with\n- * this work for additional information regarding copyright\n- * ownership. Elasticsearch B.V. licenses this file to you under\n- * the Apache License, Version 2.0 (the \"License\"); you may\n- * not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- * \n- *   http://www.apache.org/licenses/LICENSE-2.0\n- * \n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- * #L%\n- */\n-package co.elastic.apm.agent.impl.payload;\n-\n-import co.elastic.apm.agent.MockTracer;\n-import co.elastic.apm.agent.TransactionUtils;\n-import co.elastic.apm.agent.impl.sampling.ConstantSampler;\n-import co.elastic.apm.agent.impl.stacktrace.StacktraceConfiguration;\n-import co.elastic.apm.agent.impl.transaction.Span;\n-import co.elastic.apm.agent.impl.transaction.TraceContext;\n-import co.elastic.apm.agent.impl.transaction.Transaction;\n-import co.elastic.apm.agent.report.ApmServerClient;\n-import co.elastic.apm.agent.report.serialize.DslJsonSerializer;\n-import co.elastic.apm.agent.util.IOUtils;\n-import com.fasterxml.jackson.databind.JsonNode;\n-import com.fasterxml.jackson.databind.ObjectMapper;\n-import com.networknt.schema.JsonSchema;\n-import com.networknt.schema.JsonSchemaFactory;\n-import com.networknt.schema.ValidationMessage;\n-import org.apache.commons.lang3.RandomStringUtils;\n-import org.junit.jupiter.api.BeforeEach;\n-import org.junit.jupiter.api.Test;\n-\n-import java.io.IOException;\n-import java.nio.CharBuffer;\n-import java.nio.charset.StandardCharsets;\n-import java.util.Set;\n-\n-import static org.assertj.core.api.Assertions.assertThat;\n-import static org.mockito.Mockito.mock;\n-\n-class TransactionPayloadJsonSchemaTest {\n-\n-    private JsonSchema schema;\n-    private ObjectMapper objectMapper;\n-    private DslJsonSerializer serializer;\n-\n-    @BeforeEach\n-    void setUp() {\n-        schema = JsonSchemaFactory.getInstance().getSchema(getClass().getResourceAsStream(\"/schema/transactions/payload.json\"));\n-        objectMapper = new ObjectMapper();\n-        serializer = new DslJsonSerializer(mock(StacktraceConfiguration.class), mock(ApmServerClient.class));\n-    }\n-\n-    private TransactionPayload createPayloadWithRequiredValues() {\n-        final TransactionPayload payload = createPayload();\n-        final Transaction transaction = createTransactionWithRequiredValues();\n-        payload.getTransactions().add(transaction);\n-        Span span = new Span(MockTracer.create());\n-        span.start(TraceContext.fromParent(), transaction, -1, false)\n-            .withType(\"type\")\n-            .withSubtype(\"subtype\")\n-            .withAction(\"action\")\n-            .withName(\"name\");\n-        payload.getSpans().add(span);\n-        return payload;\n-    }\n-\n-    private Transaction createTransactionWithRequiredValues() {\n-        Transaction t = new Transaction(MockTracer.create());\n-        t.start(TraceContext.asRoot(), null, (long) 0, ConstantSampler.of(true), getClass().getClassLoader());\n-        t.withType(\"type\");\n-        t.getContext().getRequest().withMethod(\"GET\");\n-        t.getContext().getRequest().getUrl().appendToFull(\"http://localhost:8080/foo/bar\");\n-        return t;\n-    }\n-\n-    private TransactionPayload createPayloadWithAllValues() {\n-        final Transaction transaction = new Transaction(MockTracer.create());\n-        TransactionUtils.fillTransaction(transaction);\n-        final TransactionPayload payload = createPayload();\n-        payload.getTransactions().add(transaction);\n-        payload.getSpans().addAll(TransactionUtils.getSpans(transaction));\n-        return payload;\n-    }\n-\n-    private TransactionPayload createPayload() {\n-        return createPayload(SystemInfo.create());\n-    }\n-\n-    private TransactionPayload createPayload(SystemInfo system) {\n-        Service service = new Service().withAgent(new Agent(\"name\", \"version\")).withName(\"name\");\n-        final ProcessInfo processInfo = new ProcessInfo(\"title\");\n-        processInfo.getArgv().add(\"test\");\n-        return new TransactionPayload(processInfo, service, system);\n-    }\n-\n-    @Test\n-    void testJsonSchemaDslJsonEmptyValues() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2785bc5889e48b66cdd0a038cc64846ade9b3993"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ0NjEyMA==", "bodyText": "Please also create a replacement for this", "url": "https://github.com/elastic/apm-agent-java/pull/996#discussion_r367446120", "createdAt": "2020-01-16T14:27:02Z", "author": {"login": "felixbarny"}, "path": "apm-agent-core/src/test/java/co/elastic/apm/agent/impl/payload/TransactionPayloadJsonSchemaTest.java", "diffHunk": "@@ -1,293 +0,0 @@\n-/*-\n- * #%L\n- * Elastic APM Java agent\n- * %%\n- * Copyright (C) 2018 - 2019 Elastic and contributors\n- * %%\n- * Licensed to Elasticsearch B.V. under one or more contributor\n- * license agreements. See the NOTICE file distributed with\n- * this work for additional information regarding copyright\n- * ownership. Elasticsearch B.V. licenses this file to you under\n- * the Apache License, Version 2.0 (the \"License\"); you may\n- * not use this file except in compliance with the License.\n- * You may obtain a copy of the License at\n- * \n- *   http://www.apache.org/licenses/LICENSE-2.0\n- * \n- * Unless required by applicable law or agreed to in writing,\n- * software distributed under the License is distributed on an\n- * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n- * KIND, either express or implied.  See the License for the\n- * specific language governing permissions and limitations\n- * under the License.\n- * #L%\n- */\n-package co.elastic.apm.agent.impl.payload;\n-\n-import co.elastic.apm.agent.MockTracer;\n-import co.elastic.apm.agent.TransactionUtils;\n-import co.elastic.apm.agent.impl.sampling.ConstantSampler;\n-import co.elastic.apm.agent.impl.stacktrace.StacktraceConfiguration;\n-import co.elastic.apm.agent.impl.transaction.Span;\n-import co.elastic.apm.agent.impl.transaction.TraceContext;\n-import co.elastic.apm.agent.impl.transaction.Transaction;\n-import co.elastic.apm.agent.report.ApmServerClient;\n-import co.elastic.apm.agent.report.serialize.DslJsonSerializer;\n-import co.elastic.apm.agent.util.IOUtils;\n-import com.fasterxml.jackson.databind.JsonNode;\n-import com.fasterxml.jackson.databind.ObjectMapper;\n-import com.networknt.schema.JsonSchema;\n-import com.networknt.schema.JsonSchemaFactory;\n-import com.networknt.schema.ValidationMessage;\n-import org.apache.commons.lang3.RandomStringUtils;\n-import org.junit.jupiter.api.BeforeEach;\n-import org.junit.jupiter.api.Test;\n-\n-import java.io.IOException;\n-import java.nio.CharBuffer;\n-import java.nio.charset.StandardCharsets;\n-import java.util.Set;\n-\n-import static org.assertj.core.api.Assertions.assertThat;\n-import static org.mockito.Mockito.mock;\n-\n-class TransactionPayloadJsonSchemaTest {\n-\n-    private JsonSchema schema;\n-    private ObjectMapper objectMapper;\n-    private DslJsonSerializer serializer;\n-\n-    @BeforeEach\n-    void setUp() {\n-        schema = JsonSchemaFactory.getInstance().getSchema(getClass().getResourceAsStream(\"/schema/transactions/payload.json\"));\n-        objectMapper = new ObjectMapper();\n-        serializer = new DslJsonSerializer(mock(StacktraceConfiguration.class), mock(ApmServerClient.class));\n-    }\n-\n-    private TransactionPayload createPayloadWithRequiredValues() {\n-        final TransactionPayload payload = createPayload();\n-        final Transaction transaction = createTransactionWithRequiredValues();\n-        payload.getTransactions().add(transaction);\n-        Span span = new Span(MockTracer.create());\n-        span.start(TraceContext.fromParent(), transaction, -1, false)\n-            .withType(\"type\")\n-            .withSubtype(\"subtype\")\n-            .withAction(\"action\")\n-            .withName(\"name\");\n-        payload.getSpans().add(span);\n-        return payload;\n-    }\n-\n-    private Transaction createTransactionWithRequiredValues() {\n-        Transaction t = new Transaction(MockTracer.create());\n-        t.start(TraceContext.asRoot(), null, (long) 0, ConstantSampler.of(true), getClass().getClassLoader());\n-        t.withType(\"type\");\n-        t.getContext().getRequest().withMethod(\"GET\");\n-        t.getContext().getRequest().getUrl().appendToFull(\"http://localhost:8080/foo/bar\");\n-        return t;\n-    }\n-\n-    private TransactionPayload createPayloadWithAllValues() {\n-        final Transaction transaction = new Transaction(MockTracer.create());\n-        TransactionUtils.fillTransaction(transaction);\n-        final TransactionPayload payload = createPayload();\n-        payload.getTransactions().add(transaction);\n-        payload.getSpans().addAll(TransactionUtils.getSpans(transaction));\n-        return payload;\n-    }\n-\n-    private TransactionPayload createPayload() {\n-        return createPayload(SystemInfo.create());\n-    }\n-\n-    private TransactionPayload createPayload(SystemInfo system) {\n-        Service service = new Service().withAgent(new Agent(\"name\", \"version\")).withName(\"name\");\n-        final ProcessInfo processInfo = new ProcessInfo(\"title\");\n-        processInfo.getArgv().add(\"test\");\n-        return new TransactionPayload(processInfo, service, system);\n-    }\n-\n-    @Test\n-    void testJsonSchemaDslJsonEmptyValues() throws IOException {\n-        final TransactionPayload payload = createPayload();\n-        payload.getTransactions().add(new Transaction(MockTracer.create()));\n-        final String content = new DslJsonSerializer(mock(StacktraceConfiguration.class), mock(ApmServerClient.class)).toJsonString(payload);\n-        System.out.println(content);\n-        objectMapper.readTree(content);\n-    }\n-\n-    @Test\n-    void testSystemInfo() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2785bc5889e48b66cdd0a038cc64846ade9b3993"}, "originalPosition": 120}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3360c3a4101b6c467fedd9b088fa860d3bd69132", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/3360c3a4101b6c467fedd9b088fa860d3bd69132", "committedDate": "2020-01-16T18:44:33Z", "message": "fixed according to comments. moved test from deleted test class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0NDQwNjM3", "url": "https://github.com/elastic/apm-agent-java/pull/996#pullrequestreview-344440637", "createdAt": "2020-01-17T09:04:02Z", "commit": {"oid": "3360c3a4101b6c467fedd9b088fa860d3bd69132"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4044, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}