{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MTc2OTk5", "number": 1289, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMjo0MzozNFrOENzO8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoyNDoxNlrOEN13aA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTA2MzUyOnYy", "diffSide": "RIGHT", "path": ".ci/release/Jenkinsfile", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMjo0MzozNFrOGwm2Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNjo1ODowOVrOGz7z2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMTI3NA==", "bodyText": "I don't see any deleteDir step and the BASE_DIR should already contain the source code, What's the reason for cloning the repo again?", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r453621274", "createdAt": "2020-07-13T12:43:34Z", "author": {"login": "v1v"}, "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -68,27 +69,30 @@ pipeline {\n             }\n           }\n         }\n-        //stage('Check master build status') {\n-        //  steps {\n-        //    script {\n-        //      // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n-        //      if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n-        //        input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n-        //      }\n-        //    }\n-        //  }\n-        //}\n+        stage('Check master build status') {\n+        when { expression { params.ignore_branch_ci_status } }\n+         steps {\n+           script {\n+             // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n+             if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n+               input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n+             }\n+           }\n+         }\n+        }\n         stage('Require confirmation that CHANGELOG.asciidoc has been updated') {\n           steps {\n             input(message: \"\"\"\n             Update CHANGELOG.asciidoc to reflect the new version release:\n             Go over PRs or git log and add bug fixes and features.\n             Move release notes from the Unreleased sub-heading to the correct [[release-notes-{major}.x]] sub-heading (Example PR for 1.13.0 release).\n \n-            Click 'Proceed' to confirm that this step has been completed or Abort to stop the build in order to complete this step.\n+            Click 'Proceed' to confirm that this step has been completed and changes have been pushed or Abort to stop the build.\n             \"\"\"\n             )\n-            sh(script: \"git pull\")\n+            dir(\"${BASE_DIR}\") {\n+              git credentialsId: 'f6c7695a-671e-4f4f-a331-acdce44ff9ba', url: 'git@github.com:elastic/apm-agent-java.git'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyNTQ4MQ==", "bodyText": "Because we want to pull in any additional changes to the changelog that might be made as a result of the reminder and prompt just above this.", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r453625481", "createdAt": "2020-07-13T12:50:24Z", "author": {"login": "cachedout"}, "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -68,27 +69,30 @@ pipeline {\n             }\n           }\n         }\n-        //stage('Check master build status') {\n-        //  steps {\n-        //    script {\n-        //      // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n-        //      if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n-        //        input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n-        //      }\n-        //    }\n-        //  }\n-        //}\n+        stage('Check master build status') {\n+        when { expression { params.ignore_branch_ci_status } }\n+         steps {\n+           script {\n+             // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n+             if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n+               input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n+             }\n+           }\n+         }\n+        }\n         stage('Require confirmation that CHANGELOG.asciidoc has been updated') {\n           steps {\n             input(message: \"\"\"\n             Update CHANGELOG.asciidoc to reflect the new version release:\n             Go over PRs or git log and add bug fixes and features.\n             Move release notes from the Unreleased sub-heading to the correct [[release-notes-{major}.x]] sub-heading (Example PR for 1.13.0 release).\n \n-            Click 'Proceed' to confirm that this step has been completed or Abort to stop the build in order to complete this step.\n+            Click 'Proceed' to confirm that this step has been completed and changes have been pushed or Abort to stop the build.\n             \"\"\"\n             )\n-            sh(script: \"git pull\")\n+            dir(\"${BASE_DIR}\") {\n+              git credentialsId: 'f6c7695a-671e-4f4f-a331-acdce44ff9ba', url: 'git@github.com:elastic/apm-agent-java.git'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMTI3NA=="}, "originalCommit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIwMDk4MA==", "bodyText": "In branch_creation.sh, we just do a plain git pull instead. Is that intentional?", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r454200980", "createdAt": "2020-07-14T08:45:30Z", "author": {"login": "felixbarny"}, "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -68,27 +69,30 @@ pipeline {\n             }\n           }\n         }\n-        //stage('Check master build status') {\n-        //  steps {\n-        //    script {\n-        //      // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n-        //      if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n-        //        input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n-        //      }\n-        //    }\n-        //  }\n-        //}\n+        stage('Check master build status') {\n+        when { expression { params.ignore_branch_ci_status } }\n+         steps {\n+           script {\n+             // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n+             if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n+               input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n+             }\n+           }\n+         }\n+        }\n         stage('Require confirmation that CHANGELOG.asciidoc has been updated') {\n           steps {\n             input(message: \"\"\"\n             Update CHANGELOG.asciidoc to reflect the new version release:\n             Go over PRs or git log and add bug fixes and features.\n             Move release notes from the Unreleased sub-heading to the correct [[release-notes-{major}.x]] sub-heading (Example PR for 1.13.0 release).\n \n-            Click 'Proceed' to confirm that this step has been completed or Abort to stop the build in order to complete this step.\n+            Click 'Proceed' to confirm that this step has been completed and changes have been pushed or Abort to stop the build.\n             \"\"\"\n             )\n-            sh(script: \"git pull\")\n+            dir(\"${BASE_DIR}\") {\n+              git credentialsId: 'f6c7695a-671e-4f4f-a331-acdce44ff9ba', url: 'git@github.com:elastic/apm-agent-java.git'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMTI3NA=="}, "originalCommit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExMDQ5MA==", "bodyText": "Good catch. I agree that we should be consistent here and I have replaced that shell call with the approach we are using in this step.", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r457110490", "createdAt": "2020-07-20T06:58:09Z", "author": {"login": "cachedout"}, "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -68,27 +69,30 @@ pipeline {\n             }\n           }\n         }\n-        //stage('Check master build status') {\n-        //  steps {\n-        //    script {\n-        //      // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n-        //      if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n-        //        input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n-        //      }\n-        //    }\n-        //  }\n-        //}\n+        stage('Check master build status') {\n+        when { expression { params.ignore_branch_ci_status } }\n+         steps {\n+           script {\n+             // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n+             if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n+               input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n+             }\n+           }\n+         }\n+        }\n         stage('Require confirmation that CHANGELOG.asciidoc has been updated') {\n           steps {\n             input(message: \"\"\"\n             Update CHANGELOG.asciidoc to reflect the new version release:\n             Go over PRs or git log and add bug fixes and features.\n             Move release notes from the Unreleased sub-heading to the correct [[release-notes-{major}.x]] sub-heading (Example PR for 1.13.0 release).\n \n-            Click 'Proceed' to confirm that this step has been completed or Abort to stop the build in order to complete this step.\n+            Click 'Proceed' to confirm that this step has been completed and changes have been pushed or Abort to stop the build.\n             \"\"\"\n             )\n-            sh(script: \"git pull\")\n+            dir(\"${BASE_DIR}\") {\n+              git credentialsId: 'f6c7695a-671e-4f4f-a331-acdce44ff9ba', url: 'git@github.com:elastic/apm-agent-java.git'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMTI3NA=="}, "originalCommit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTQ5NDgwOnYy", "diffSide": "RIGHT", "path": ".ci/release/Jenkinsfile", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoyNDoxN1rOGwq5Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoyNDoxN1rOGwq5Gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NzU3OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       script {\n          \n          \n            \n                         // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n          \n          \n            \n                         if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n          \n          \n            \n                           input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n          \n          \n            \n                         }\n          \n          \n            \n                       }\n          \n          \n            \n                         // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n          \n          \n            \n                         whenTrue(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n          \n          \n            \n                           input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n          \n          \n            \n                         }", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r453687578", "createdAt": "2020-07-13T14:24:17Z", "author": {"login": "kuisathaverat"}, "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -68,27 +69,30 @@ pipeline {\n             }\n           }\n         }\n-        //stage('Check master build status') {\n-        //  steps {\n-        //    script {\n-        //      // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n-        //      if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n-        //        input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n-        //      }\n-        //    }\n-        //  }\n-        //}\n+        stage('Check master build status') {\n+        when { expression { params.ignore_branch_ci_status } }\n+         steps {\n+           script {\n+             // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n+             if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n+               input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n+             }\n+           }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 156, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}