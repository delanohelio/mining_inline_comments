{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMTM1MTA1", "number": 1464, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjo1NToxMFrOEz4JOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjo1NToxMFrOEz4JOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyODMyNjk4OnYy", "diffSide": "RIGHT", "path": "apm-agent-plugins/apm-spring-webmvc-plugin/src/main/java/co/elastic/apm/agent/springwebmvc/SpringServiceNameInstrumentation.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjo1NToxMFrOHrXuJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjo1Njo0N1rOHrXyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzOTQ2Mg==", "bodyText": "Better guard against null. I've seen servletContext.getContextPath() return null on some application servers.", "url": "https://github.com/elastic/apm-agent-java/pull/1464#discussion_r515239462", "createdAt": "2020-10-30T16:55:10Z", "author": {"login": "felixbarny"}, "path": "apm-agent-plugins/apm-spring-webmvc-plugin/src/main/java/co/elastic/apm/agent/springwebmvc/SpringServiceNameInstrumentation.java", "diffHunk": "@@ -71,9 +71,19 @@\n \n         @Advice.OnMethodExit(suppress = Throwable.class, inline = false)\n         public static void afterInitPropertySources(@Advice.This WebApplicationContext applicationContext) {\n-            if (applicationContext.getServletContext() != null) {\n-                tracer.overrideServiceNameForClassLoader(applicationContext.getServletContext().getClassLoader(), applicationContext.getEnvironment().getProperty(\"spring.application.name\"));\n+\n+            String appName = applicationContext.getEnvironment().getProperty(\"spring.application.name\", \"\");\n+\n+            // fallback when application name isn't set through an environment property\n+            if (appName.isEmpty()) {\n+                appName = applicationContext.getApplicationName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3187fb0ca4364a1b79ff34cd89ebb71e400f4942"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTI0MDQ5OA==", "bodyText": "I was also wondering should we make this work for older versions of Spring framework < 3.x", "url": "https://github.com/elastic/apm-agent-java/pull/1464#discussion_r515240498", "createdAt": "2020-10-30T16:56:47Z", "author": {"login": "SylvainJuge"}, "path": "apm-agent-plugins/apm-spring-webmvc-plugin/src/main/java/co/elastic/apm/agent/springwebmvc/SpringServiceNameInstrumentation.java", "diffHunk": "@@ -71,9 +71,19 @@\n \n         @Advice.OnMethodExit(suppress = Throwable.class, inline = false)\n         public static void afterInitPropertySources(@Advice.This WebApplicationContext applicationContext) {\n-            if (applicationContext.getServletContext() != null) {\n-                tracer.overrideServiceNameForClassLoader(applicationContext.getServletContext().getClassLoader(), applicationContext.getEnvironment().getProperty(\"spring.application.name\"));\n+\n+            String appName = applicationContext.getEnvironment().getProperty(\"spring.application.name\", \"\");\n+\n+            // fallback when application name isn't set through an environment property\n+            if (appName.isEmpty()) {\n+                appName = applicationContext.getApplicationName();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzOTQ2Mg=="}, "originalCommit": {"oid": "3187fb0ca4364a1b79ff34cd89ebb71e400f4942"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 66, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}