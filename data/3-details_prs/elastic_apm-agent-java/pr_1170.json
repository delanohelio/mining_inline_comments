{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMTU1NTQ4", "number": 1170, "title": "Automatic tracing for Jobs defined in quartz-jobs dependency", "bodyText": "What does this PR do?\n\nWhile going through our traced Quartz schedules I noticed that the directory scanning schedules are missing which we implement via quartz-jobs artifact of the quartz project.\nIn this use case we do not implement a quartz job but only a callback interface the job will call. As described in the documentation I would have to add the org.quartz.jobs package currently to the application_packages to make this work.\nIn my opinion it would be more user friendly when the jobs provided by the quartz project would work without extra configuration.\nThis PR add's the instrumentation of the job from the quartz-jobs dependency. I decided to not add the package name to the applicationPackages collection because the collection we get is immutable.\nChecklist\n\n\n My code follows the style guidelines of this project\n I have rebased my changes on top of the latest master branch\n\n\n\n I have added tests that prove my fix is effective or that my feature works\n New and existing unit tests pass locally with my changes\n\n\n\n I have updated CHANGELOG.asciidoc\n I have updated supported-technologies.asciidoc\n\nAuthor's Checklist\n\nRelated issues\n\nUse cases\n\nThe quartz-jobs dependency provides ready to use jobs for the following use-cases\n\nScanning directories for changed files via lastModified date\nScanning files for changes via lastModified date\nExecuting native executables\nSending mails\nInvoke JMX\nSending messages to JMS\nInvoke EJB\n\nScreenshots", "createdAt": "2020-05-01T14:37:21Z", "url": "https://github.com/elastic/apm-agent-java/pull/1170", "merged": true, "mergeCommit": {"oid": "73962e6789ac459f15564712ebb5399b3757d7c3"}, "closed": true, "closedAt": "2020-05-07T09:04:57Z", "author": {"login": "theobisproject"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceruQRgH2gAyNDEyMTU1NTQ4OmU2N2NhZTE3ZjcyNTVmNTFmZjk3OWIwMjYyMjQ1YjQ5ZjIwNzJjNmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABce3kOCgFqTQwNzE4OTkyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e67cae17f7255f51ff979b0262245b49f2072c6d", "author": {"user": {"login": "theobisproject", "name": "Robin Schimpf"}}, "url": "https://github.com/elastic/apm-agent-java/commit/e67cae17f7255f51ff979b0262245b49f2072c6d", "committedDate": "2020-05-06T17:00:15Z", "message": "Automatic tracing for Jobs defined in quartz-jobs dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "683bde1cc7b1ee1bec2765a64c1381ae8b72e888", "author": {"user": {"login": "theobisproject", "name": "Robin Schimpf"}}, "url": "https://github.com/elastic/apm-agent-java/commit/683bde1cc7b1ee1bec2765a64c1381ae8b72e888", "committedDate": "2020-05-06T17:01:01Z", "message": "Add changelog entry and change documentation for quartz"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "965f78a5fb8addb06ec0b79ad03ed34defa28182", "author": {"user": {"login": "theobisproject", "name": "Robin Schimpf"}}, "url": "https://github.com/elastic/apm-agent-java/commit/965f78a5fb8addb06ec0b79ad03ed34defa28182", "committedDate": "2020-05-06T16:58:35Z", "message": "Add changelog entry and change documentation for quartz"}, "afterCommit": {"oid": "683bde1cc7b1ee1bec2765a64c1381ae8b72e888", "author": {"user": {"login": "theobisproject", "name": "Robin Schimpf"}}, "url": "https://github.com/elastic/apm-agent-java/commit/683bde1cc7b1ee1bec2765a64c1381ae8b72e888", "committedDate": "2020-05-06T17:01:01Z", "message": "Add changelog entry and change documentation for quartz"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MTU1OTIz", "url": "https://github.com/elastic/apm-agent-java/pull/1170#pullrequestreview-407155923", "createdAt": "2020-05-07T05:21:57Z", "commit": {"oid": "683bde1cc7b1ee1bec2765a64c1381ae8b72e888"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNToyMTo1N1rOGRuz3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwNToyMTo1N1rOGRuz3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI0NTkxOA==", "bodyText": "This works, but I prefer the boolean expression more explicit and clearer for reading:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return isInAnyPackage(applicationPackages, ElementMatchers.<NamedElement>none())\n          \n          \n            \n                        .or(nameStartsWith(\"org.quartz.job\"))\n          \n          \n            \n                    (isInAnyPackage(applicationPackages, ElementMatchers.<NamedElement>none()).or(nameStartsWith(\"org.quartz.job\")))\n          \n      \n    \n    \n  \n\nNot insisting on it though.", "url": "https://github.com/elastic/apm-agent-java/pull/1170#discussion_r421245918", "createdAt": "2020-05-07T05:21:57Z", "author": {"login": "eyalkoren"}, "path": "apm-agent-plugins/apm-quartz-job-plugin/src/main/java/co/elastic/apm/agent/quartz/job/JobTransactionNameInstrumentation.java", "diffHunk": "@@ -56,6 +57,7 @@ public JobTransactionNameInstrumentation(ElasticApmTracer tracer) {\n     @Override\n     public ElementMatcher<? super TypeDescription> getTypeMatcher() {\n         return isInAnyPackage(applicationPackages, ElementMatchers.<NamedElement>none())\n+            .or(nameStartsWith(\"org.quartz.job\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "683bde1cc7b1ee1bec2765a64c1381ae8b72e888"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MTg5OTI4", "url": "https://github.com/elastic/apm-agent-java/pull/1170#pullrequestreview-407189928", "createdAt": "2020-05-07T06:48:09Z", "commit": {"oid": "683bde1cc7b1ee1bec2765a64c1381ae8b72e888"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3965, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}