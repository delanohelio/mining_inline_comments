{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2MzYyNDcz", "number": 1397, "title": "Eliminate Java-11 HttpClient plugin class version errors", "bodyText": "Eliminating errors such as:\nco.elastic.apm.agent.util.DependencyInjectingServiceLoader - unable to instantiate 'co.elastic.apm.agent.httpclient.HttpClientInstrumentation', unsupported class version error: co/elastic/apm/agent/httpclient/HttpClientInstrumentation has been compiled by a more recent version of the Java Runtime (class file version 55.0), this version of the Java Runtime only recognizes class file versions up to 52.0\n\nfrom agent logs.\nThese are not real errors, they only indicate that the Java 11 HttpClient plugin cannot be loaded in pre-Java-11 JVMs.", "createdAt": "2020-09-14T06:22:00Z", "url": "https://github.com/elastic/apm-agent-java/pull/1397", "merged": true, "mergeCommit": {"oid": "f50df66082a7b4905b864ecaee34c576e014a62d"}, "closed": true, "closedAt": "2020-09-16T07:29:18Z", "author": {"login": "eyalkoren"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdItES9gH2gAyNDg2MzYyNDczOjhhNTNhNTk5OWM1Y2VhYTU2NGI1NzVmNTUzNGM2Nzk5MzBhOTNjMjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJXRFjAFqTQ4OTM0NjgzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8a53a5999c5ceaa564b575f5534c679930a93c21", "author": {"user": {"login": "eyalkoren", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/8a53a5999c5ceaa564b575f5534c679930a93c21", "committedDate": "2020-09-14T06:19:03Z", "message": "Eliminate Java-11 HttpClient plugin class version errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3OTIyMTQ5", "url": "https://github.com/elastic/apm-agent-java/pull/1397#pullrequestreview-487922149", "createdAt": "2020-09-14T16:00:09Z", "commit": {"oid": "8a53a5999c5ceaa564b575f5534c679930a93c21"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNjowMDowOVrOHRcBGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNjowMDowOVrOHRcBGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA0Njg3Mg==", "bodyText": "I'm not really a fan of having something specific to the httpclient, as adding other similar plugins for java11 will need to modify this file again.\nThus keeping only the log as debug would probably be better for now, as we don't have any reliable way to tell if a plugin/instrumentation is expected to be compatible with a given version, the only thing that we can detect is which version it has been compiled as target (we could read this from bytecode).", "url": "https://github.com/elastic/apm-agent-java/pull/1397#discussion_r488046872", "createdAt": "2020-09-14T16:00:09Z", "author": {"login": "SylvainJuge"}, "path": "apm-agent-core/src/main/java/co/elastic/apm/agent/util/DependencyInjectingServiceLoader.java", "diffHunk": "@@ -138,7 +138,12 @@ private T instantiate(ClassLoader classLoader, String implementation) {\n             String msg = String.format(\"unable to instantiate '%s', please check descriptor in META-INF\", implementation);\n             throw new ServiceConfigurationError(msg, e);\n         } catch(UnsupportedClassVersionError e) {\n-            logger.error(String.format(\"unable to instantiate '%s', unsupported class version error: %s\", implementation, e.getMessage()));\n+            // The Java 11 HttpClient plugin is compiled with Java 11, so this is expected\n+            if (!implementation.startsWith(\"co.elastic.apm.agent.httpclient\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a53a5999c5ceaa564b575f5534c679930a93c21"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70386318896d016b3e2353f91e4942798289f97d", "author": {"user": {"login": "eyalkoren", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/70386318896d016b3e2353f91e4942798289f97d", "committedDate": "2020-09-16T05:03:19Z", "message": "Always log unsupported class file version errors at debug level"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c831ec9e14adc3197b45b68376899e03ec71cae1", "author": {"user": {"login": "SylvainJuge", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/c831ec9e14adc3197b45b68376899e03ec71cae1", "committedDate": "2020-09-16T07:28:01Z", "message": "Merge branch 'master' into java11-httpclient-plugin-compilation-fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MzQ2ODMw", "url": "https://github.com/elastic/apm-agent-java/pull/1397#pullrequestreview-489346830", "createdAt": "2020-09-16T07:29:02Z", "commit": {"oid": "c831ec9e14adc3197b45b68376899e03ec71cae1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3666, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}