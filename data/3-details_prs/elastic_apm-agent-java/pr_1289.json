{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MTc2OTk5", "number": 1289, "title": "Minor changes to release process pipeline", "bodyText": "What does this PR do?\n\nIntroduces a new parameter for the release build which allows the check for failures in the branch build to be skipped.\nAllows the CHANGELOG to be updated during the build process instead of requiring a restart.\n\nOnce this PR is merged, it should be safe to re-try to release process. The previous problems with the job failing to start have been resolved separately.", "createdAt": "2020-07-13T10:52:31Z", "url": "https://github.com/elastic/apm-agent-java/pull/1289", "merged": true, "mergeCommit": {"oid": "335ca351223b7ab87e3ff91f61ba2227c3259b99"}, "closed": true, "closedAt": "2020-07-21T06:31:07Z", "author": {"login": "cachedout"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0dKGCgH2gAyNDQ4MTc2OTk5OjVkYjM0NmI0NTJkZDc4MDQxZjk3MzU4ZjgwOTQ1MDRhODQxM2RjYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2sDX5AH2gAyNDQ4MTc2OTk5OjcyNTlmOTU3YjE0ZTQyNmEwMmFhZDJiOTczNDc2OTExYzkxNTE3ODg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5db346b452dd78041f97358f8094504a8413dca5", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/5db346b452dd78041f97358f8094504a8413dca5", "committedDate": "2020-07-13T08:28:25Z", "message": "Flag to skip master branch failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "838917240fc00549ff560a939707039b312f62ab", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/838917240fc00549ff560a939707039b312f62ab", "committedDate": "2020-07-13T10:26:01Z", "message": "All changelog to be modified in-flight"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/8f63e053c1b76bf0dc72784ed56c759bb5f20dc7", "committedDate": "2020-07-13T10:51:03Z", "message": "Cleaner version of ci branch check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MjE0MTQ5", "url": "https://github.com/elastic/apm-agent-java/pull/1289#pullrequestreview-447214149", "createdAt": "2020-07-13T12:43:34Z", "commit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMjo0MzozNFrOGwm2Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMjo0MzozNFrOGwm2Gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMTI3NA==", "bodyText": "I don't see any deleteDir step and the BASE_DIR should already contain the source code, What's the reason for cloning the repo again?", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r453621274", "createdAt": "2020-07-13T12:43:34Z", "author": {"login": "v1v"}, "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -68,27 +69,30 @@ pipeline {\n             }\n           }\n         }\n-        //stage('Check master build status') {\n-        //  steps {\n-        //    script {\n-        //      // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n-        //      if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n-        //        input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n-        //      }\n-        //    }\n-        //  }\n-        //}\n+        stage('Check master build status') {\n+        when { expression { params.ignore_branch_ci_status } }\n+         steps {\n+           script {\n+             // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n+             if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n+               input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n+             }\n+           }\n+         }\n+        }\n         stage('Require confirmation that CHANGELOG.asciidoc has been updated') {\n           steps {\n             input(message: \"\"\"\n             Update CHANGELOG.asciidoc to reflect the new version release:\n             Go over PRs or git log and add bug fixes and features.\n             Move release notes from the Unreleased sub-heading to the correct [[release-notes-{major}.x]] sub-heading (Example PR for 1.13.0 release).\n \n-            Click 'Proceed' to confirm that this step has been completed or Abort to stop the build in order to complete this step.\n+            Click 'Proceed' to confirm that this step has been completed and changes have been pushed or Abort to stop the build.\n             \"\"\"\n             )\n-            sh(script: \"git pull\")\n+            dir(\"${BASE_DIR}\") {\n+              git credentialsId: 'f6c7695a-671e-4f4f-a331-acdce44ff9ba', url: 'git@github.com:elastic/apm-agent-java.git'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3Mjk5ODY4", "url": "https://github.com/elastic/apm-agent-java/pull/1289#pullrequestreview-447299868", "createdAt": "2020-07-13T14:24:16Z", "commit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoyNDoxN1rOGwq5Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDoyNDoxN1rOGwq5Gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NzU3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                       script {\n          \n          \n            \n                         // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n          \n          \n            \n                         if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n          \n          \n            \n                           input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n          \n          \n            \n                         }\n          \n          \n            \n                       }\n          \n          \n            \n                         // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n          \n          \n            \n                         whenTrue(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n          \n          \n            \n                           input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n          \n          \n            \n                         }", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r453687578", "createdAt": "2020-07-13T14:24:17Z", "author": {"login": "kuisathaverat"}, "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -68,27 +69,30 @@ pipeline {\n             }\n           }\n         }\n-        //stage('Check master build status') {\n-        //  steps {\n-        //    script {\n-        //      // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n-        //      if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n-        //        input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n-        //      }\n-        //    }\n-        //  }\n-        //}\n+        stage('Check master build status') {\n+        when { expression { params.ignore_branch_ci_status } }\n+         steps {\n+           script {\n+             // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n+             if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n+               input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n+             }\n+           }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MzAzMDQ2", "url": "https://github.com/elastic/apm-agent-java/pull/1289#pullrequestreview-447303046", "createdAt": "2020-07-13T14:27:38Z", "commit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d924f00b6a5c166eaa4127e368b5f0ce345d8a8", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/6d924f00b6a5c166eaa4127e368b5f0ce345d8a8", "committedDate": "2020-07-13T15:14:43Z", "message": "Update .ci/release/Jenkinsfile\n\nCo-authored-by: Ivan Fernandez Calvo <kuisathaverat@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3OTA5ODE4", "url": "https://github.com/elastic/apm-agent-java/pull/1289#pullrequestreview-447909818", "createdAt": "2020-07-14T08:45:30Z", "commit": {"oid": "6d924f00b6a5c166eaa4127e368b5f0ce345d8a8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwODo0NTozMFrOGxKOlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwODo0NTozMFrOGxKOlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIwMDk4MA==", "bodyText": "In branch_creation.sh, we just do a plain git pull instead. Is that intentional?", "url": "https://github.com/elastic/apm-agent-java/pull/1289#discussion_r454200980", "createdAt": "2020-07-14T08:45:30Z", "author": {"login": "felixbarny"}, "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -68,27 +69,30 @@ pipeline {\n             }\n           }\n         }\n-        //stage('Check master build status') {\n-        //  steps {\n-        //    script {\n-        //      // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n-        //      if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n-        //        input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n-        //      }\n-        //    }\n-        //  }\n-        //}\n+        stage('Check master build status') {\n+        when { expression { params.ignore_branch_ci_status } }\n+         steps {\n+           script {\n+             // If this build is not green: https://apm-ci.elastic.co/job/apm-agent-java/job/apm-agent-java-mbp/job/master/\n+             if(!buildStatus(host: 'apm-ci.elastic.co', job: ['apm-agent-java', 'apm-agent-java-mbp', 'master'], return_boolean: true)) {\n+               input(message: \"WARNING! The master build is not passing. Do you wish to continue?\")\n+             }\n+           }\n+         }\n+        }\n         stage('Require confirmation that CHANGELOG.asciidoc has been updated') {\n           steps {\n             input(message: \"\"\"\n             Update CHANGELOG.asciidoc to reflect the new version release:\n             Go over PRs or git log and add bug fixes and features.\n             Move release notes from the Unreleased sub-heading to the correct [[release-notes-{major}.x]] sub-heading (Example PR for 1.13.0 release).\n \n-            Click 'Proceed' to confirm that this step has been completed or Abort to stop the build in order to complete this step.\n+            Click 'Proceed' to confirm that this step has been completed and changes have been pushed or Abort to stop the build.\n             \"\"\"\n             )\n-            sh(script: \"git pull\")\n+            dir(\"${BASE_DIR}\") {\n+              git credentialsId: 'f6c7695a-671e-4f4f-a331-acdce44ff9ba', url: 'git@github.com:elastic/apm-agent-java.git'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMTI3NA=="}, "originalCommit": {"oid": "8f63e053c1b76bf0dc72784ed56c759bb5f20dc7"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be82000ecf9131ba6f6d5ba49010a7d703554791", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/be82000ecf9131ba6f6d5ba49010a7d703554791", "committedDate": "2020-07-20T06:57:17Z", "message": "Replace shell git call"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7259f957b14e426a02aad2b973476911c9151788", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/7259f957b14e426a02aad2b973476911c9151788", "committedDate": "2020-07-20T06:57:30Z", "message": "Merge branch 'ci_minor' of github.com:cachedout/apm-agent-java into ci_minor"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3796, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}