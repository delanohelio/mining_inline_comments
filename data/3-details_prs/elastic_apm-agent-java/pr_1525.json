{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0ODMyNTAz", "number": 1525, "title": "[load test] Use 7.x application when Java 7 is requested", "bodyText": "What does this PR do?\nUse a 7.x version of the test application when a 7.x version of Java is requested.", "createdAt": "2020-11-20T17:00:28Z", "url": "https://github.com/elastic/apm-agent-java/pull/1525", "merged": true, "mergeCommit": {"oid": "1a830ebc0b12911133adef3a9056e1cbc3924b19"}, "closed": true, "closedAt": "2020-11-23T08:23:41Z", "author": {"login": "cachedout"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeaYJOAH2gAyNTI0ODMyNTAzOjY2MzliMGQzZDM1OWZhMWEyMmE1ZDVlZTg0OGU1MGJlMDQ0Yzc1MDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdec8qhAFqTUzNTczNzA3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6639b0d3d359fa1a22a5d5ee848e50be044c7501", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/6639b0d3d359fa1a22a5d5ee848e50be044c7501", "committedDate": "2020-11-20T16:58:52Z", "message": "[load test] Use 7.x application when Java 7 is requested"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7308cc859c1724ee51587cc3b7a11ce7e340d5e0", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/7308cc859c1724ee51587cc3b7a11ce7e340d5e0", "committedDate": "2020-11-20T17:00:54Z", "message": "newline"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NjA5Mzc1", "url": "https://github.com/elastic/apm-agent-java/pull/1525#pullrequestreview-535609375", "createdAt": "2020-11-20T17:01:58Z", "commit": {"oid": "7308cc859c1724ee51587cc3b7a11ce7e340d5e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27975321d8ef199cbe556cf4a977bd474ee0f8fd", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/27975321d8ef199cbe556cf4a977bd474ee0f8fd", "committedDate": "2020-11-20T18:08:13Z", "message": "Change 7.x invocation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1Njk3NTYy", "url": "https://github.com/elastic/apm-agent-java/pull/1525#pullrequestreview-535697562", "createdAt": "2020-11-20T18:56:23Z", "commit": {"oid": "27975321d8ef199cbe556cf4a977bd474ee0f8fd"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxODo1NjoyM1rOH3dBPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQxODo1NjoyM1rOH3dBPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkwOTE4MQ==", "bodyText": "[minor style] maybe would be slightly easier to read with a variable to hold the target binary as the only difference is\n./target/petclinic.war\n./target/spring-petclinic-*.jar", "url": "https://github.com/elastic/apm-agent-java/pull/1525#discussion_r527909181", "createdAt": "2020-11-20T18:56:23Z", "author": {"login": "SylvainJuge"}, "path": ".ci/load/Jenkinsfile", "diffHunk": "@@ -163,7 +163,15 @@ pipeline {\n                                         // Start with packaging things up\n                                         sh(script: \"./mvnw package\")\n                                         echo \"start application with JVM options '${params.jvm_options}'\"\n-                                        sh(script: \"java -jar -javaagent:${WORKSPACE}/${AGENT_BASE_DIR}/apm-agent-java/elastic-apm-agent/target/elastic-apm-agent-${params.apm_version}.jar -Delastic.apm.server_urls=${env.APM_SERVER_URL} -Delastic.apm.secret_token=${env.ELASTIC_APM_API_KEY} ${params.jvm_options} -XX:+FlightRecorder -XX:StartFlightRecording=filename=flight.jfr ./target/spring-petclinic-*.jar &\")\n+                                        script {\n+                                            def ver = sh(script: \".ci/load/scripts/java_major.sh ${params.jvm_version}\", returnStdout: true).trim()\n+                                            if(ver == '7'){\n+                                                echo \"Detected 7.x Java version. Switching to 7.x compat mode and calling .war\"\n+                                                sh(script: \"java -jar -javaagent:${WORKSPACE}/${AGENT_BASE_DIR}/apm-agent-java/elastic-apm-agent/target/elastic-apm-agent-${params.apm_version}.jar -Delastic.apm.server_urls=${env.APM_SERVER_URL} -Delastic.apm.secret_token=${env.ELASTIC_APM_API_KEY} ${params.jvm_options} -XX:+FlightRecorder -XX:StartFlightRecording=filename=flight.jfr ./target/petclinic.war &\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27975321d8ef199cbe556cf4a977bd474ee0f8fd"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1NzM3MDc0", "url": "https://github.com/elastic/apm-agent-java/pull/1525#pullrequestreview-535737074", "createdAt": "2020-11-20T19:58:34Z", "commit": {"oid": "27975321d8ef199cbe556cf4a977bd474ee0f8fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3600, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}