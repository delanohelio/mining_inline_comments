{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNzQ3NTg4", "number": 1222, "title": "added capturing of request body in Elasticsearch queries", "bodyText": "closes #519\nadded capturing of request body in Elasticsearch queries: _msesarch, _count, _rollup_search, _msearch/template, _search/template", "createdAt": "2020-06-09T12:12:34Z", "url": "https://github.com/elastic/apm-agent-java/pull/1222", "merged": true, "mergeCommit": {"oid": "c547d4d5c344d82079c3ea395597da086afd5d79"}, "closed": true, "closedAt": "2020-06-25T09:15:28Z", "author": {"login": "kananindzya"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpp9ZmgBqjM0MjY0NDIxMTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuqZKrAH2gAyNDMxNzQ3NTg4OjI1N2VhMjgzYTUyYmNkODZjYjZmM2VjMmIwNDRmMjg0MjI5MTk0YTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0104ca1bff5beb99a564148252ef7d9f24496abe", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/0104ca1bff5beb99a564148252ef7d9f24496abe", "committedDate": "2020-06-09T12:11:32Z", "message": "added capturing of request body in Elasticsearch queries: _msesarch, _count, _rollup_search, _msearch/tempalte, _search/template"}, "afterCommit": {"oid": "70833403e0e78a3e22339989fe5a238836c7cf7c", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/70833403e0e78a3e22339989fe5a238836c7cf7c", "committedDate": "2020-06-09T19:09:48Z", "message": "added capturing of request body in Elasticsearch queries: _msesarch, _count, _rollup_search, _msearch/tempalte, _search/template"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NzMxNTEx", "url": "https://github.com/elastic/apm-agent-java/pull/1222#pullrequestreview-427731511", "createdAt": "2020-06-10T05:57:47Z", "commit": {"oid": "70833403e0e78a3e22339989fe5a238836c7cf7c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNTo1Nzo0OFrOGhl4lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNTo1OTo1MFrOGhl6-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg3Njg4Ng==", "bodyText": "Regex is rather expensive. Better use WildcardMatchers instead. Arrays.asList(WildcardMatcher.valueOf(\"*_search\", ...).\nTo match all, use WildcardMatcher::isAnyMatch", "url": "https://github.com/elastic/apm-agent-java/pull/1222#discussion_r437876886", "createdAt": "2020-06-10T05:57:48Z", "author": {"login": "felixbarny"}, "path": "apm-agent-plugins/apm-es-restclient-plugin/apm-es-restclient-plugin-common/src/main/java/co/elastic/apm/agent/es/restclient/ElasticsearchRestClientInstrumentationHelperImpl.java", "diffHunk": "@@ -49,7 +49,7 @@\n \n     private static final Logger logger = LoggerFactory.getLogger(ElasticsearchRestClientInstrumentationHelperImpl.class);\n \n-    public static final String SEARCH_QUERY_PATH_SUFFIX = \"_search\";\n+    public static final String QUERY_REGEXP = \".*_((search|msearch)(\\\\/template)?|count)$\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70833403e0e78a3e22339989fe5a238836c7cf7c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg3NzQ5Ng==", "bodyText": "Please test the different endpoints in different test methods.", "url": "https://github.com/elastic/apm-agent-java/pull/1222#discussion_r437877496", "createdAt": "2020-06-10T05:59:50Z", "author": {"login": "felixbarny"}, "path": "apm-agent-plugins/apm-es-restclient-plugin/apm-es-restclient-plugin-6_4/src/test/java/co/elastic/apm/agent/es/restclient/v6_4/AbstractEs6_4ClientInstrumentationTest.java", "diffHunk": "@@ -134,6 +143,99 @@ public void testDocumentScenario() throws Exception {\n         validateDbContextContent(searchSpan, \"{\\\"from\\\":0,\\\"size\\\":5,\\\"query\\\":{\\\"term\\\":{\\\"foo\\\":{\\\"value\\\":\\\"bar\\\",\\\"boost\\\":1.0}}}}\");\n \n         // Now update and re-search\n+        reporter.reset();\n+        // Do CountRequest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70833403e0e78a3e22339989fe5a238836c7cf7c"}, "originalPosition": 41}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0104022f2718be2e83a7784e7b0d1f8c994d87d3", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/0104022f2718be2e83a7784e7b0d1f8c994d87d3", "committedDate": "2020-06-11T06:11:18Z", "message": "fixed according to comments"}, "afterCommit": {"oid": "9d29fc4b2eeaac5c603c227f8c0667e32c897074", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/9d29fc4b2eeaac5c603c227f8c0667e32c897074", "committedDate": "2020-06-14T19:13:32Z", "message": "fixed according to comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMjAyMTEy", "url": "https://github.com/elastic/apm-agent-java/pull/1222#pullrequestreview-432202112", "createdAt": "2020-06-17T09:03:02Z", "commit": {"oid": "9d29fc4b2eeaac5c603c227f8c0667e32c897074"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d29fc4b2eeaac5c603c227f8c0667e32c897074", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/9d29fc4b2eeaac5c603c227f8c0667e32c897074", "committedDate": "2020-06-14T19:13:32Z", "message": "fixed according to comments"}, "afterCommit": {"oid": "4b78b8202c8c2417381a7dbc90412fff00e40210", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/4b78b8202c8c2417381a7dbc90412fff00e40210", "committedDate": "2020-06-17T11:51:45Z", "message": "fixed according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "442960c0f9c094bb9a38ed4f83eddbf6e6bd7257", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/442960c0f9c094bb9a38ed4f83eddbf6e6bd7257", "committedDate": "2020-06-17T15:19:39Z", "message": "added capturing of request body in Elasticsearch queries: _msesarch, _count, _rollup_search, _msearch/tempalte, _search/template"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a46761908991c8f5f4a68e56371b69a8210612c", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/2a46761908991c8f5f4a68e56371b69a8210612c", "committedDate": "2020-06-17T15:19:39Z", "message": "fixed according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5dc648b49ad047f819c55a83f307d734be371b9", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/b5dc648b49ad047f819c55a83f307d734be371b9", "committedDate": "2020-06-17T15:19:39Z", "message": "fixed according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b4448541b009c3c3ae55e676411f7fe2cff75d7", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/9b4448541b009c3c3ae55e676411f7fe2cff75d7", "committedDate": "2020-06-17T15:20:19Z", "message": "fixed changelog"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b78b8202c8c2417381a7dbc90412fff00e40210", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/4b78b8202c8c2417381a7dbc90412fff00e40210", "committedDate": "2020-06-17T11:51:45Z", "message": "fixed according to comments"}, "afterCommit": {"oid": "9b4448541b009c3c3ae55e676411f7fe2cff75d7", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/9b4448541b009c3c3ae55e676411f7fe2cff75d7", "committedDate": "2020-06-17T15:20:19Z", "message": "fixed changelog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "257ea283a52bcd86cb6f3ec2b044f284229194a4", "author": {"user": {"login": "felixbarny", "name": "Felix Barnsteiner"}}, "url": "https://github.com/elastic/apm-agent-java/commit/257ea283a52bcd86cb6f3ec2b044f284229194a4", "committedDate": "2020-06-25T08:30:06Z", "message": "Merge branch 'master' into issue-519-capture-elasticsearch-apis"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3736, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}