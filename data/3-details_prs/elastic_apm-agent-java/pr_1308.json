{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1NzU5NTIy", "number": 1308, "title": "Fixes for git error in release pipeline", "bodyText": "What does this PR do?\nFixes the following error in the release pipeline:\n17:32:48  [Pipeline] withEnv\n17:32:48  [Pipeline] {\n17:32:48  [Pipeline] isUnix\n17:32:48  [Pipeline] withCredentials\n17:32:48  Masking supported pattern matches of $GITHUB_USER or $GITHUB_TOKEN\n17:32:48  [Pipeline] {\n17:32:48  [Pipeline] libraryResource\n17:32:48  [Pipeline] sh (Setup git release)\n17:32:48  + BRANCH_NAME='tags/v1.9.0\n17:32:48  '\n17:32:48  + GIT_BASE_COMMIT=5de8899283b5ec1a4d9f6cb6a0fdf1ca86b32073\n17:32:48  + GITHUB_TOKEN=****\n17:32:48  + GITHUB_USER=****\n17:32:48  + ORG_NAME=elastic\n17:32:48  + REPO_NAME=apm-agent-java\n17:32:48  + git config remote.origin.url https://****:****@github.com/elastic/apm-agent-java.git\n17:32:48  + git config remote.origin.fetch '+refs/heads/*:refs/remotes/origin/*'\n17:32:48  ++ git log -1 --pretty=format:%ae\n17:32:48  + USER_MAIL=felix.barnsteiner@elastic.co\n17:32:48  ++ git log -1 --pretty=format:%an\n17:32:48  + USER_NAME='Felix Barnsteiner'\n17:32:48  + git config user.email felix.barnsteiner@elastic.co\n17:32:48  + git config user.name 'Felix Barnsteiner'\n17:32:48  + git config checkout.defaultRemote origin\n17:32:48  + git fetch --all\n17:32:48  Fetching origin\n17:32:49  + git checkout 'tags/v1.9.0\n17:32:49  '\n17:32:49  error: pathspec 'tags/v1.9.0\n17:32:49  ' did not match any file(s) known to git.\n17:32:49  [Pipeline] error\n17:32:49  [Pipeline] sh (Rollback git context)\n17:32:49  + git config remote.origin.url https://github.com/elastic/apm-agent-java.git\n17:32:49  + git config remote.upstream.url https://github.com/elastic/apm-agent-java.git\n17:32:49  [Pipeline] }\n17:32:49  [Pipeline] // withCredentials", "createdAt": "2020-07-23T14:40:44Z", "url": "https://github.com/elastic/apm-agent-java/pull/1308", "merged": true, "mergeCommit": {"oid": "2ab97c1a0300cbd875e7f87001f809a1a86ee353"}, "closed": true, "closedAt": "2020-07-27T07:24:53Z", "author": {"login": "cachedout"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3wFBrgH2gAyNDU1NzU5NTIyOjBkZGI1YzMzNjIxYmU4NmVkOTIxOWIyOGIzMWI5MDdkYjA2Mjc0ZDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3xFS9gFqTQ1NDI0NjUzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0ddb5c33621be86ed9219b28b31b907db06274d5", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/0ddb5c33621be86ed9219b28b31b907db06274d5", "committedDate": "2020-07-23T14:12:51Z", "message": "Move tag detection to script and fix sorting error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eed6204f11b5ac0b9112ea1c35d9bd3fc7eebea8", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/eed6204f11b5ac0b9112ea1c35d9bd3fc7eebea8", "committedDate": "2020-07-23T14:31:14Z", "message": "Try strip newline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56132816880569c7c3bcc7b4405c048065b0bf19", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/56132816880569c7c3bcc7b4405c048065b0bf19", "committedDate": "2020-07-23T14:34:09Z", "message": "Try tr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a679f4d826e25ef7db9a8b72558e9371cb7638e0", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/a679f4d826e25ef7db9a8b72558e9371cb7638e0", "committedDate": "2020-07-23T14:35:53Z", "message": "More tr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10ffad810c9aa69500d356d2469eab6aecda1ee3", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/10ffad810c9aa69500d356d2469eab6aecda1ee3", "committedDate": "2020-07-23T14:38:27Z", "message": "Spaces for readability"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MjIxNzIx", "url": "https://github.com/elastic/apm-agent-java/pull/1308#pullrequestreview-454221721", "createdAt": "2020-07-23T14:57:25Z", "commit": {"oid": "10ffad810c9aa69500d356d2469eab6aecda1ee3"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDo1NzoyNVrOG2Ogkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNDo1NzoyNVrOG2Ogkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTUxNDAwMg==", "bodyText": "This is up to you but I personally prefer using long options in scripts as they are more descriptive\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    git tag | sort -V | tail -1 | tr -d '\\n'\n          \n          \n            \n                    git tag | sort --version-sort | tail -1 | tr -d '\\n'", "url": "https://github.com/elastic/apm-agent-java/pull/1308#discussion_r459514002", "createdAt": "2020-07-23T14:57:25Z", "author": {"login": "felixbarny"}, "path": "scripts/jenkins/tags.sh", "diffHunk": "@@ -0,0 +1,12 @@\n+#!/usr/bin/env bash\n+case  $1  in\n+    bare)\n+        git tag | sort -V | tail -1 | tr -d '\\n'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10ffad810c9aa69500d356d2469eab6aecda1ee3"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71555f203a4b9bdebe42ae5bb78e2d10a3c90113", "author": {"user": {"login": "cachedout", "name": null}}, "url": "https://github.com/elastic/apm-agent-java/commit/71555f203a4b9bdebe42ae5bb78e2d10a3c90113", "committedDate": "2020-07-23T15:09:03Z", "message": "Update scripts/jenkins/tags.sh\n\nCo-authored-by: Felix Barnsteiner <felixbarny@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MjQ2Mzc0", "url": "https://github.com/elastic/apm-agent-java/pull/1308#pullrequestreview-454246374", "createdAt": "2020-07-23T15:22:54Z", "commit": {"oid": "71555f203a4b9bdebe42ae5bb78e2d10a3c90113"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNToyMjo1NFrOG2PqNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNToyMjo1NFrOG2PqNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTUzMjg1Mw==", "bodyText": "?.trim() could also help here if no spaces/new lines are required at all\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            env.TAG_BARE = sh(script: \"./scripts/jenkins/tags.sh bare\", returnStdout: true)\n          \n          \n            \n                            env.TAG_VER = sh(script: \"./scripts/jenkins/tags.sh ver\", returnStdout: true)\n          \n          \n            \n                            env.TAG_DOT_X = sh(script: \"./scripts/jenkins/tags.sh dot_x\", returnStdout: true)\n          \n          \n            \n                            env.TAG_BARE = sh(script: \"./scripts/jenkins/tags.sh bare\", returnStdout: true)?.trim()\n          \n          \n            \n                            env.TAG_VER = sh(script: \"./scripts/jenkins/tags.sh ver\", returnStdout: true)?.trim()\n          \n          \n            \n                            env.TAG_DOT_X = sh(script: \"./scripts/jenkins/tags.sh dot_x\", returnStdout: true)?.trim()", "url": "https://github.com/elastic/apm-agent-java/pull/1308#discussion_r459532853", "createdAt": "2020-07-23T15:22:54Z", "author": {"login": "v1v"}, "path": ".ci/release/Jenkinsfile", "diffHunk": "@@ -46,9 +46,9 @@ pipeline {\n             stash(allowEmpty: true, name: 'source', useDefaultExcludes: false)\n             dir(\"${BASE_DIR}\") {\n               script {\n-                env.TAG_BARE = sh(script: \"git tag | tail -1\", returnStdout: true)\n-                env.TAG_VER = sh(script: \"git tag | tail -1 | sed s/v//\", returnStdout: true)\n-                env.TAG_DOT_X = sh(script: 'git tag|tail -1|sed s/v//|cut -f1 -d \".\"|awk \\'{print $1\".x\"}\\'', returnStdout: true)\n+                env.TAG_BARE = sh(script: \"./scripts/jenkins/tags.sh bare\", returnStdout: true)\n+                env.TAG_VER = sh(script: \"./scripts/jenkins/tags.sh ver\", returnStdout: true)\n+                env.TAG_DOT_X = sh(script: \"./scripts/jenkins/tags.sh dot_x\", returnStdout: true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71555f203a4b9bdebe42ae5bb78e2d10a3c90113"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MjQ2NTMy", "url": "https://github.com/elastic/apm-agent-java/pull/1308#pullrequestreview-454246532", "createdAt": "2020-07-23T15:23:03Z", "commit": {"oid": "71555f203a4b9bdebe42ae5bb78e2d10a3c90113"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3819, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}