{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNTI2NDE5", "number": 1194, "title": "Set framework name and version", "bodyText": "closes #29", "createdAt": "2020-05-20T06:01:29Z", "url": "https://github.com/elastic/apm-agent-java/pull/1194", "merged": true, "mergeCommit": {"oid": "01a5c8cebbf5b06f91e1ebbc614bab6c9d710f11"}, "closed": true, "closedAt": "2020-06-10T13:25:01Z", "author": {"login": "kananindzya"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjCtYygBqjMzNTQ4MzU3MzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp5OtdAH2gAyNDIwNTI2NDE5OjAxNjJmZTM3MTEzNTNiZGNlYzFhM2EyZWY3NmYzZGIxOWQ0MWI3YzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d47bca56bca8a176d52f6f281032f58a5509ca44", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/d47bca56bca8a176d52f6f281032f58a5509ca44", "committedDate": "2020-05-19T20:51:05Z", "message": "issue-29 set framework name and version for SpringTransactionName instrumentation."}, "afterCommit": {"oid": "dbc7eef69df885d3de8edf3cdc47013d58b01413", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/dbc7eef69df885d3de8edf3cdc47013d58b01413", "committedDate": "2020-05-19T21:04:16Z", "message": "issue-29 set framework name for SpringTransactionName, JaxRsTransactionName, JaxWsTransactionName, ServletApi instrumentations."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MDIzMTYx", "url": "https://github.com/elastic/apm-agent-java/pull/1194#pullrequestreview-415023161", "createdAt": "2020-05-20T06:22:06Z", "commit": {"oid": "dbc7eef69df885d3de8edf3cdc47013d58b01413"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwNjoyMjowNlrOGX80HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwNjoyODowNVrOGX89GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc2NjgxMw==", "bodyText": "Better store frameworkName and frameworkVersion  in TransactionContext, as it's only relevant to transactions and doesn't increase the memory footprint for spans.", "url": "https://github.com/elastic/apm-agent-java/pull/1194#discussion_r427766813", "createdAt": "2020-05-20T06:22:06Z", "author": {"login": "felixbarny"}, "path": "apm-agent-core/src/main/java/co/elastic/apm/agent/impl/transaction/TraceContext.java", "diffHunk": "@@ -242,6 +242,12 @@ public boolean asChildOf(TraceContext child, Object ignore) {\n     @Nullable\n     private String serviceName;\n \n+    @Nullable\n+    private String frameworkName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbc7eef69df885d3de8edf3cdc47013d58b01413"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc2NzE3Mg==", "bodyText": "\ud83d\udc4f", "url": "https://github.com/elastic/apm-agent-java/pull/1194#discussion_r427767172", "createdAt": "2020-05-20T06:23:05Z", "author": {"login": "felixbarny"}, "path": "apm-agent-plugins/apm-spring-webmvc-plugin/src/main/java/co/elastic/apm/agent/spring/webmvc/SpringTransactionNameInstrumentation.java", "diffHunk": "@@ -129,6 +132,8 @@ static void setTransactionName(@Advice.Argument(2) Object handler) {\n                     if (logger.isDebugEnabled()) {\n                         logger.debug(\"Set name {} to transaction {}\", transaction.getNameAsString(), transaction.getTraceContext().getId());\n                     }\n+                    transaction.getTraceContext().setFrameworkName(FRAMEWORK_NAME);\n+                    transaction.getTraceContext().setFrameworkVersion(SpringVersion.getVersion());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbc7eef69df885d3de8edf3cdc47013d58b01413"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc2OTExMg==", "bodyText": "Could we use co.elastic.apm.agent.util.VersionUtils#getVersionFromPomProperties to get the version? Remember to cache the version as this method is quite expensive. Probably best to cache with a WeakConcurrentMap with a class such as javax.ws.rs.GET.class as the key. That's necessary as there could be multiple JAX-RS versions in different wars in an app server.", "url": "https://github.com/elastic/apm-agent-java/pull/1194#discussion_r427769112", "createdAt": "2020-05-20T06:28:05Z", "author": {"login": "felixbarny"}, "path": "apm-agent-plugins/apm-jaxrs-plugin/src/main/java/co/elastic/apm/agent/jaxrs/JaxRsTransactionNameInstrumentation.java", "diffHunk": "@@ -79,6 +81,7 @@ private static void setTransactionName(@SimpleMethodSignature String signature,\n                     }\n                 }\n                 transaction.withName(transactionName, PRIO_HIGH_LEVEL_FRAMEWORK, false);\n+                transaction.getTraceContext().setFrameworkName(FRAMEWORK_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbc7eef69df885d3de8edf3cdc47013d58b01413"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dbc7eef69df885d3de8edf3cdc47013d58b01413", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/dbc7eef69df885d3de8edf3cdc47013d58b01413", "committedDate": "2020-05-19T21:04:16Z", "message": "issue-29 set framework name for SpringTransactionName, JaxRsTransactionName, JaxWsTransactionName, ServletApi instrumentations."}, "afterCommit": {"oid": "1fecb0affce119a645aebfa499eab5fa73bbd9cb", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/1fecb0affce119a645aebfa499eab5fa73bbd9cb", "committedDate": "2020-05-20T10:00:12Z", "message": "issue-29 set framework name for SpringTransactionName, JaxRsTransactionName, JaxWsTransactionName, ServletApi instrumentations. Fixes according to comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MTg5MzYy", "url": "https://github.com/elastic/apm-agent-java/pull/1194#pullrequestreview-415189362", "createdAt": "2020-05-20T10:14:11Z", "commit": {"oid": "1fecb0affce119a645aebfa499eab5fa73bbd9cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMDoxNDoxMVrOGYExvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMDoxNDoxMVrOGYExvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5NzI3OQ==", "bodyText": "Don't forget to include in copyFrom and resetState", "url": "https://github.com/elastic/apm-agent-java/pull/1194#discussion_r427897279", "createdAt": "2020-05-20T10:14:11Z", "author": {"login": "felixbarny"}, "path": "apm-agent-core/src/main/java/co/elastic/apm/agent/impl/context/TransactionContext.java", "diffHunk": "@@ -57,6 +58,12 @@\n      */\n     private final User user = new User();\n \n+    @Nullable\n+    private String frameworkName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fecb0affce119a645aebfa499eab5fa73bbd9cb"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff568a2211ef69f85a2ad7e2bc88bba760380c19", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/ff568a2211ef69f85a2ad7e2bc88bba760380c19", "committedDate": "2020-05-20T18:03:33Z", "message": "issue-29 added define version for JaxRs framework(with caching)."}, "afterCommit": {"oid": "20743c0e54085f4155affe830761e82d2e9cb730", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/20743c0e54085f4155affe830761e82d2e9cb730", "committedDate": "2020-05-20T18:05:48Z", "message": "issue-29 added define version for JaxRs framework(with caching)."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac52c0a19a4d14aa0e1236fe328d52c56d483e27", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/ac52c0a19a4d14aa0e1236fe328d52c56d483e27", "committedDate": "2020-05-22T06:16:02Z", "message": "issue-29 set framework name for JavaServerFaces transaction. Updated integration tests with framework name assertions."}, "afterCommit": {"oid": "19ed400ff5a44aeb36d1a0a4a6db3e5b88aff087", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/19ed400ff5a44aeb36d1a0a4a6db3e5b88aff087", "committedDate": "2020-05-22T06:17:11Z", "message": "issue-29 set framework name for JavaServerFaces transaction. Updated integration tests with framework name assertions."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19ed400ff5a44aeb36d1a0a4a6db3e5b88aff087", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/19ed400ff5a44aeb36d1a0a4a6db3e5b88aff087", "committedDate": "2020-05-22T06:17:11Z", "message": "issue-29 set framework name for JavaServerFaces transaction. Updated integration tests with framework name assertions."}, "afterCommit": {"oid": "803269ee0b4a49108c238fcdb1b288d8719e9ba1", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/803269ee0b4a49108c238fcdb1b288d8719e9ba1", "committedDate": "2020-05-22T06:23:20Z", "message": "issue-29 set framework name for JavaServerFaces transaction. Updated integration tests with framework name assertions."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NjE5NzU1", "url": "https://github.com/elastic/apm-agent-java/pull/1194#pullrequestreview-417619755", "createdAt": "2020-05-25T10:31:24Z", "commit": {"oid": "803269ee0b4a49108c238fcdb1b288d8719e9ba1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMDozMToyNVrOGZ8uRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMDozNTo0OVrOGZ81sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg2MjQ3MA==", "bodyText": "Test that the framework name has been set", "url": "https://github.com/elastic/apm-agent-java/pull/1194#discussion_r429862470", "createdAt": "2020-05-25T10:31:25Z", "author": {"login": "felixbarny"}, "path": "apm-agent-plugins/apm-jaxrs-plugin/src/test/java/co/elastic/apm/agent/jaxrs/JaxRsTransactionNameInstrumentationTest.java", "diffHunk": "@@ -258,6 +258,16 @@ public void testJaxRsTransactionNameFromPathAnnotationInheritanceEnabledOnResour\n         assertThat(actualTransactions.get(0).getNameAsString()).isEqualTo(\"GET /testInterface/test\");\n     }\n \n+    @Test\n+    public void testJaxRsFrameworkNameAndVersion() throws IOException {\n+        config.getConfig(CoreConfiguration.class).getSampleRate().update(0.0, SpyConfiguration.CONFIG_SOURCE_NAME);\n+        ElasticApmAgent.initInstrumentation(tracer, ByteBuddyAgent.install());\n+\n+        doRequest(\"test\");\n+\n+        List<Transaction> actualTransactions = reporter.getTransactions();\n+        assertThat(actualTransactions).hasSize(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "803269ee0b4a49108c238fcdb1b288d8719e9ba1"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg2NDM2OQ==", "bodyText": "Doesn't seem to be used", "url": "https://github.com/elastic/apm-agent-java/pull/1194#discussion_r429864369", "createdAt": "2020-05-25T10:35:49Z", "author": {"login": "felixbarny"}, "path": "integration-tests/application-server-integration-tests/src/test/java/co/elastic/apm/servlet/tests/TestApp.java", "diffHunk": "@@ -62,4 +64,21 @@ public String getExpectedServiceName() {\n \n     public abstract void test(AbstractServletContainerIntegrationTest test) throws Exception;\n \n+    /**\n+     * Pretty print JsonNode\n+     *\n+     * @param jsonNode\n+     * @return\n+     */\n+    protected String prettyPrintJsonNode(JsonNode jsonNode) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "803269ee0b4a49108c238fcdb1b288d8719e9ba1"}, "originalPosition": 31}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e43ee017570a0254f6e86e2eb132bb908df9cf8", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/3e43ee017570a0254f6e86e2eb132bb908df9cf8", "committedDate": "2020-05-25T18:58:18Z", "message": "issue-29 set framework name for OpenTracing"}, "afterCommit": {"oid": "edea9cd18b8b60f57267cc293dcb19382ebb04a0", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/edea9cd18b8b60f57267cc293dcb19382ebb04a0", "committedDate": "2020-05-25T19:03:07Z", "message": "issue-29 Added frameworkName, frameworkVersion to TransactionContext. Set framework name for SpringTransactionName, JaxRsTransactionName(with version), JaxWsTransactionName, ServletApi,\nJavaServerFaces, Public Api, Kafka, gRPC, JMS, OpenTracing, Quartz(with version) instrumentations."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "edea9cd18b8b60f57267cc293dcb19382ebb04a0", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/edea9cd18b8b60f57267cc293dcb19382ebb04a0", "committedDate": "2020-05-25T19:03:07Z", "message": "issue-29 Added frameworkName, frameworkVersion to TransactionContext. Set framework name for SpringTransactionName, JaxRsTransactionName(with version), JaxWsTransactionName, ServletApi,\nJavaServerFaces, Public Api, Kafka, gRPC, JMS, OpenTracing, Quartz(with version) instrumentations."}, "afterCommit": {"oid": "22b7048663d12825eef1bd8268fc718ca6e8b36c", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/22b7048663d12825eef1bd8268fc718ca6e8b36c", "committedDate": "2020-05-25T19:14:07Z", "message": "issue-29 Added frameworkName, frameworkVersion to TransactionContext. Set framework name for SpringTransactionName, JaxRsTransactionName(with version), JaxWsTransactionName, ServletApi,\nJavaServerFaces, Public Api, Kafka, gRPC, JMS, OpenTracing, Quartz(with version) instrumentations."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22b7048663d12825eef1bd8268fc718ca6e8b36c", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/22b7048663d12825eef1bd8268fc718ca6e8b36c", "committedDate": "2020-05-25T19:14:07Z", "message": "issue-29 Added frameworkName, frameworkVersion to TransactionContext. Set framework name for SpringTransactionName, JaxRsTransactionName(with version), JaxWsTransactionName, ServletApi,\nJavaServerFaces, Public Api, Kafka, gRPC, JMS, OpenTracing, Quartz(with version) instrumentations."}, "afterCommit": {"oid": "aa4744bd7a756b1bfc1cbe1fe2aef1f766d1d3ec", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/aa4744bd7a756b1bfc1cbe1fe2aef1f766d1d3ec", "committedDate": "2020-05-25T19:20:48Z", "message": "issue-29 Added frameworkName, frameworkVersion to TransactionContext. Set framework name for SpringTransactionName, JaxRsTransactionName(with version), JaxWsTransactionName, ServletApi,\nJavaServerFaces, Public Api, Kafka, gRPC, JMS, OpenTracing, Quartz(with version) instrumentations."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4eb0309afff8492ea6117eb930b3bd793c44e829", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/4eb0309afff8492ea6117eb930b3bd793c44e829", "committedDate": "2020-05-25T19:23:16Z", "message": "issue-29 Added frameworkName, frameworkVersion to TransactionContext. Set framework name for SpringTransactionName, JaxRsTransactionName(with version), JaxWsTransactionName, ServletApi,\nJavaServerFaces, Public Api, Kafka, gRPC, JMS, OpenTracing, Quartz(with version) instrumentations."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa4744bd7a756b1bfc1cbe1fe2aef1f766d1d3ec", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/aa4744bd7a756b1bfc1cbe1fe2aef1f766d1d3ec", "committedDate": "2020-05-25T19:20:48Z", "message": "issue-29 Added frameworkName, frameworkVersion to TransactionContext. Set framework name for SpringTransactionName, JaxRsTransactionName(with version), JaxWsTransactionName, ServletApi,\nJavaServerFaces, Public Api, Kafka, gRPC, JMS, OpenTracing, Quartz(with version) instrumentations."}, "afterCommit": {"oid": "4eb0309afff8492ea6117eb930b3bd793c44e829", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/4eb0309afff8492ea6117eb930b3bd793c44e829", "committedDate": "2020-05-25T19:23:16Z", "message": "issue-29 Added frameworkName, frameworkVersion to TransactionContext. Set framework name for SpringTransactionName, JaxRsTransactionName(with version), JaxWsTransactionName, ServletApi,\nJavaServerFaces, Public Api, Kafka, gRPC, JMS, OpenTracing, Quartz(with version) instrumentations."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3OTk4MjM5", "url": "https://github.com/elastic/apm-agent-java/pull/1194#pullrequestreview-417998239", "createdAt": "2020-05-26T06:20:15Z", "commit": {"oid": "4eb0309afff8492ea6117eb930b3bd793c44e829"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNjoyMDoxNVrOGaQC5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNjozMzoxOFrOGaQWqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE3OTA0NA==", "bodyText": "This has to be public, as it needs to be visible from inlined advices", "url": "https://github.com/elastic/apm-agent-java/pull/1194#discussion_r430179044", "createdAt": "2020-05-26T06:20:15Z", "author": {"login": "felixbarny"}, "path": "apm-agent-plugins/apm-api-plugin/src/main/java/co/elastic/apm/agent/plugin/api/Utils.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*-\n+ * #%L\n+ * Elastic APM Java agent\n+ * %%\n+ * Copyright (C) 2018 - 2020 Elastic and contributors\n+ * %%\n+ * Licensed to Elasticsearch B.V. under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch B.V. licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ * #L%\n+ */\n+package co.elastic.apm.agent.plugin.api;\n+\n+public final class Utils {\n+\n+    private Utils() { }\n+\n+    protected static final String FRAMEWORK_NAME = \"API\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eb0309afff8492ea6117eb930b3bd793c44e829"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE4MjYyNA==", "bodyText": "VersionUtils may return null. Avoid re-evaluating in this case.", "url": "https://github.com/elastic/apm-agent-java/pull/1194#discussion_r430182624", "createdAt": "2020-05-26T06:29:32Z", "author": {"login": "felixbarny"}, "path": "apm-agent-plugins/apm-jaxrs-plugin/src/main/java/co/elastic/apm/agent/jaxrs/JaxRsTransactionNameInstrumentation.java", "diffHunk": "@@ -79,6 +89,13 @@ private static void setTransactionName(@SimpleMethodSignature String signature,\n                     }\n                 }\n                 transaction.withName(transactionName, PRIO_HIGH_LEVEL_FRAMEWORK, false);\n+                transaction.getContext().setFrameworkName(FRAMEWORK_NAME);\n+                String version = versionsCache.get(javax.ws.rs.GET.class);\n+                if (version == null) {\n+                    version = VersionUtils.getVersionFromPomProperties(javax.ws.rs.GET.class, GROUP_ID, ARTIFACT_ID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eb0309afff8492ea6117eb930b3bd793c44e829"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE4NDEwNg==", "bodyText": "I think I know why previously the framework has been reset. That's because for non-sampled transactions, we don't report the context. See also\n\n  \n    \n      apm-agent-java/apm-agent-core/src/main/java/co/elastic/apm/agent/impl/transaction/Transaction.java\n    \n    \n        Lines 211 to 214\n      in\n      28e6f45\n    \n    \n    \n    \n\n        \n          \n           public void beforeEnd(long epochMicros) { \n        \n\n        \n          \n               if (!isSampled()) { \n        \n\n        \n          \n                   context.resetState(); \n        \n\n        \n          \n               } \n        \n    \n  \n\n\nTherefore, it's problematic to put the framework information into the TransactionContext. I think it's better to put it directly in Transaction.", "url": "https://github.com/elastic/apm-agent-java/pull/1194#discussion_r430184106", "createdAt": "2020-05-26T06:33:18Z", "author": {"login": "felixbarny"}, "path": "apm-agent-plugins/apm-jaxrs-plugin/src/test/java/co/elastic/apm/agent/jaxrs/JaxRsTransactionNameInstrumentationTest.java", "diffHunk": "@@ -258,6 +258,16 @@ public void testJaxRsTransactionNameFromPathAnnotationInheritanceEnabledOnResour\n         assertThat(actualTransactions.get(0).getNameAsString()).isEqualTo(\"GET /testInterface/test\");\n     }\n \n+    @Test\n+    public void testJaxRsFrameworkNameAndVersion() throws IOException {\n+        config.getConfig(CoreConfiguration.class).getSampleRate().update(0.0, SpyConfiguration.CONFIG_SOURCE_NAME);\n+        ElasticApmAgent.initInstrumentation(tracer, ByteBuddyAgent.install());\n+\n+        doRequest(\"test\");\n+\n+        List<Transaction> actualTransactions = reporter.getTransactions();\n+        assertThat(actualTransactions).hasSize(1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg2MjQ3MA=="}, "originalCommit": {"oid": "803269ee0b4a49108c238fcdb1b288d8719e9ba1"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eb97d640d4a3dd1826a999a5c364d0af2bfa030", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/8eb97d640d4a3dd1826a999a5c364d0af2bfa030", "committedDate": "2020-05-27T12:01:48Z", "message": "fixes according to comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af225d8c2aa1ffc15542680b1cd7bdb73f501cf9", "author": {"user": null}, "url": "https://github.com/elastic/apm-agent-java/commit/af225d8c2aa1ffc15542680b1cd7bdb73f501cf9", "committedDate": "2020-05-27T12:10:17Z", "message": "fixed logic with frameworkName serialization."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f87003923b19ab58ee7d87ed6bf8a61a9b926231", "author": {"user": {"login": "felixbarny", "name": "Felix Barnsteiner"}}, "url": "https://github.com/elastic/apm-agent-java/commit/f87003923b19ab58ee7d87ed6bf8a61a9b926231", "committedDate": "2020-05-28T12:43:01Z", "message": "Simplify framework serialization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMDY3NzEz", "url": "https://github.com/elastic/apm-agent-java/pull/1194#pullrequestreview-420067713", "createdAt": "2020-05-28T12:43:35Z", "commit": {"oid": "f87003923b19ab58ee7d87ed6bf8a61a9b926231"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MDE3MDM5", "url": "https://github.com/elastic/apm-agent-java/pull/1194#pullrequestreview-428017039", "createdAt": "2020-06-10T12:49:20Z", "commit": {"oid": "f87003923b19ab58ee7d87ed6bf8a61a9b926231"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0162fe3711353bdcec1a3a2ef76f3db19d41b7c0", "author": {"user": {"login": "felixbarny", "name": "Felix Barnsteiner"}}, "url": "https://github.com/elastic/apm-agent-java/commit/0162fe3711353bdcec1a3a2ef76f3db19d41b7c0", "committedDate": "2020-06-10T12:57:38Z", "message": "Merge remote-tracking branch 'origin/master' into issue-29-set-framework-name-and-version"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3983, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}