{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2Mzk0MTc3", "number": 1530, "title": "[cache][ci] use cached m2 repository", "bodyText": "What does this PR do?\nThe build stage is the one preparing the build artifacts that are later on used in the following stages, so, in order to honour the .m2 cache, the build stage does the following:\n\nIf the .m2 cached folder in the CI worker exists then copy the content to the $WORKSPACE/.m2.  <--- This is the hack\nmaven build\nthe whole workspace is archived to be consumed later on in the UTs, Javadoc, Smoke Tests and so on stages.\n\nSpeed up the stash/unstash with our v2 that uses Google Storage. Ideally from 2 minutes to just a ?? seconds:\nTests\n\n UTs\n ITs\n Smoke tests\n Benchmarks\n Javadoc\n\nScreenshots\n\nPrepare the .m2 during the build stage\n\n\nIterations\n\nUse absolute path where the .m2 repository is hosted in the CI workers.\n\nIt did not work since the built cached artifacts were hosted in another CI workers.\n\nStash/Unstash\n\nReverted 156a41e since there was no much improvement, so let's keep it simple\n\n\n\ncurrently\nproposal", "createdAt": "2020-11-24T10:59:58Z", "url": "https://github.com/elastic/apm-agent-java/pull/1530", "merged": true, "mergeCommit": {"oid": "bf1d22922b85d1ff5eb6ad330e9f9901435a7721"}, "closed": true, "closedAt": "2020-11-25T15:38:58Z", "author": {"login": "v1v"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfnmmmgH2gAyNTI2Mzk0MTc3OmEzOWE0ODRmM2ExY2ZlNTUwYTQ0YzQ5YjQ3MjA0NzgxZWU5NTI1NmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdf_cb7AFqTUzODU2OTY1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a39a484f3a1cfe550a44c49b47204781ee95256f", "author": {"user": {"login": "v1v", "name": "Victor Martinez"}}, "url": "https://github.com/elastic/apm-agent-java/commit/a39a484f3a1cfe550a44c49b47204781ee95256f", "committedDate": "2020-11-24T10:57:21Z", "message": "[cache][ci] use cached m2 repository"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "030533d380b6ed4e32fe16bebc457340521d82f9", "author": {"user": {"login": "v1v", "name": "Victor Martinez"}}, "url": "https://github.com/elastic/apm-agent-java/commit/030533d380b6ed4e32fe16bebc457340521d82f9", "committedDate": "2020-11-24T12:27:26Z", "message": "Revert \"[cache][ci] use cached m2 repository\"\n\nThis reverts commit a39a484f3a1cfe550a44c49b47204781ee95256f."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7a84781e37297c5cbd051ffef1e556b5203f76a", "author": {"user": {"login": "v1v", "name": "Victor Martinez"}}, "url": "https://github.com/elastic/apm-agent-java/commit/b7a84781e37297c5cbd051ffef1e556b5203f76a", "committedDate": "2020-11-24T12:31:20Z", "message": ".m2 repository to be prepared before the building"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f04e77a0acd082b37357c094cacce7f1c7a27450", "author": {"user": {"login": "v1v", "name": "Victor Martinez"}}, "url": "https://github.com/elastic/apm-agent-java/commit/f04e77a0acd082b37357c094cacce7f1c7a27450", "committedDate": "2020-11-24T12:34:07Z", "message": "Use more declarative syntax"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "156a41efc04f0ad1636ceb9bbf28e58dbc54d3e3", "author": {"user": {"login": "v1v", "name": "Victor Martinez"}}, "url": "https://github.com/elastic/apm-agent-java/commit/156a41efc04f0ad1636ceb9bbf28e58dbc54d3e3", "committedDate": "2020-11-24T14:28:12Z", "message": "Use Google Storage as a temporary location to copy files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22ebae03cca9d84f1bd8b4fa06a54e87628b5908", "author": {"user": {"login": "v1v", "name": "Victor Martinez"}}, "url": "https://github.com/elastic/apm-agent-java/commit/22ebae03cca9d84f1bd8b4fa06a54e87628b5908", "committedDate": "2020-11-24T15:32:14Z", "message": "Revert \"Use Google Storage as a temporary location to copy files\"\n\nThis reverts commit 156a41efc04f0ad1636ceb9bbf28e58dbc54d3e3."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NjkyODQ4", "url": "https://github.com/elastic/apm-agent-java/pull/1530#pullrequestreview-537692848", "createdAt": "2020-11-24T16:28:35Z", "commit": {"oid": "22ebae03cca9d84f1bd8b4fa06a54e87628b5908"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjoyODozNVrOH5K-fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNjoyODozNVrOH5K-fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTcxMDcxOQ==", "bodyText": "where is that dir coming from? from the packer cache?", "url": "https://github.com/elastic/apm-agent-java/pull/1530#discussion_r529710719", "createdAt": "2020-11-24T16:28:35Z", "author": {"login": "felixbarny"}, "path": "Jenkinsfile", "diffHunk": "@@ -79,6 +79,10 @@ pipeline {\n             withGithubNotify(context: 'Build', tab: 'artifacts') {\n               deleteDir()\n               unstash 'source'\n+              // prepare m2 repository with the existing dependencies\n+              whenTrue(fileExists('/var/lib/jenkins/.m2/repository')) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22ebae03cca9d84f1bd8b4fa06a54e87628b5908"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NzI5Nzkx", "url": "https://github.com/elastic/apm-agent-java/pull/1530#pullrequestreview-537729791", "createdAt": "2020-11-24T17:08:28Z", "commit": {"oid": "22ebae03cca9d84f1bd8b4fa06a54e87628b5908"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTA2ODU1", "url": "https://github.com/elastic/apm-agent-java/pull/1530#pullrequestreview-537906855", "createdAt": "2020-11-24T20:58:05Z", "commit": {"oid": "22ebae03cca9d84f1bd8b4fa06a54e87628b5908"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NDQzNzE4", "url": "https://github.com/elastic/apm-agent-java/pull/1530#pullrequestreview-538443718", "createdAt": "2020-11-25T12:26:07Z", "commit": {"oid": "22ebae03cca9d84f1bd8b4fa06a54e87628b5908"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21c44bac8ebe3365b5b07be4cc3382c4be3416b1", "author": {"user": {"login": "v1v", "name": "Victor Martinez"}}, "url": "https://github.com/elastic/apm-agent-java/commit/21c44bac8ebe3365b5b07be4cc3382c4be3416b1", "committedDate": "2020-11-25T14:25:59Z", "message": "As suggested in the code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NTY5NjU5", "url": "https://github.com/elastic/apm-agent-java/pull/1530#pullrequestreview-538569659", "createdAt": "2020-11-25T14:43:58Z", "commit": {"oid": "21c44bac8ebe3365b5b07be4cc3382c4be3416b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3606, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}