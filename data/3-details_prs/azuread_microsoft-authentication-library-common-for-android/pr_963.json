{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5ODA3MjUy", "number": 963, "title": "Detect Broker Process during encryption/decryption", "bodyText": "Why making this fix?\nTeams Desk phone found an issue where it was unable to sign in when they're trying to change CP account. (logs here)\nThe root cause is that\n\nour StorageHelper would keep using Broker's secret key after it's loaded. (technical debt that I was trying to fix in #746 , which I later had to drop).\nIn this case, CP invokes WPJ prior to its sign in\nits local ADAL process unable to decrypt the value.\nRT was wiped\n\n2020-07-15T11:56:28.1690000\tINFO\tMSALCommonLoggerCallback\t 7335\t00230\tMSALCommon: Tag: MsalOAuth2TokenCachesetSingleSignOnState, Message:  [2020-07-15 11:56:28 - {\"thread_id\":\"253\",\"correlation_id\":\"ad65f8c8-1612-4415-b9ea-19d34e57d9ab\"}] Refresh tokens removed: [0] Android 25\n\n\n(I suspect) that AT is returned, but RT is not, so CP went ahead and perform WPJ without RT.\nTeams Phone can't silently sign in as BRT does not exist.\n\nProposed fix\nThis fix is much simpler than #746. We use the key whenever we're in the broker auth process.\nNot sure why I couldn't think of this at the time :/\n(getProcessName() is a courtesy from CP team).\nHow I verified\n\nPut a debugger on both :auth and non-auth process\nPerform Join() from BrokerHost. Signs in, isBrokerProcess function returns false. (Local ADAL is used to acquire token).\nLaunch MSAL and trigger join flow. isBrokerProcess function returns true (Broker is used).", "createdAt": "2020-07-16T00:03:51Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963", "merged": true, "mergeCommit": {"oid": "d7eeca118831694367a0fe046f518c9e00c5ed02"}, "closed": true, "closedAt": "2020-07-16T03:45:03Z", "author": {"login": "rpdome"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1TeRoAH2gAyNDQ5ODA3MjUyOmY2ZjVmYzQxNDA0MWRkZWQyZDRjYWU4ZDU2NGI2OGM3M2VhMzkwNGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1VT1EAH2gAyNDQ5ODA3MjUyOmE3NzEzYWRkMGI1Y2ZhYzM1OGFiMTk1NjQ2ZGZjMmRjNTFkMTI3YWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f6f5fc414041dded2d4cae8d564b68c73ea3904f", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f6f5fc414041dded2d4cae8d564b68c73ea3904f", "committedDate": "2020-07-15T23:45:20Z", "message": "Detect Broker Process during encryption/decryption"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d09f5d75e631d30c480d2e2644e87491dad8ac1c", "committedDate": "2020-07-15T23:50:00Z", "message": "Add specific name check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDIzNTE5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#pullrequestreview-449423519", "createdAt": "2020-07-16T00:08:35Z", "commit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDowODozNlrOGyVh0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDowODozNlrOGyVh0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNDcwNA==", "bodyText": "Since this is a new utility class, you could put in a private constructor so it can't be instantiated", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#discussion_r455434704", "createdAt": "2020-07-16T00:08:36Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/util/ProcessUtil.java", "diffHunk": "@@ -0,0 +1,65 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+\n+package com.microsoft.identity.common.internal.util;\n+\n+import android.app.ActivityManager;\n+import android.content.Context;\n+\n+import androidx.annotation.NonNull;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.AZURE_AUTHENTICATOR_APP_PACKAGE_NAME;\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.COMPANY_PORTAL_APP_PACKAGE_NAME;\n+\n+public class ProcessUtil {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDIzNjg4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#pullrequestreview-449423688", "createdAt": "2020-07-16T00:09:05Z", "commit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDowOTowNVrOGyVieQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDowOTowNVrOGyVieQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNDg3Mw==", "bodyText": "Javadoc? Nullability annots?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#discussion_r455434873", "createdAt": "2020-07-16T00:09:05Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/util/ProcessUtil.java", "diffHunk": "@@ -0,0 +1,65 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+\n+package com.microsoft.identity.common.internal.util;\n+\n+import android.app.ActivityManager;\n+import android.content.Context;\n+\n+import androidx.annotation.NonNull;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.AZURE_AUTHENTICATOR_APP_PACKAGE_NAME;\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.COMPANY_PORTAL_APP_PACKAGE_NAME;\n+\n+public class ProcessUtil {\n+\n+    /**\n+     * Returns true if the calling app is the auth process.\n+     */\n+    public static boolean isBrokerProcess(@NonNull final Context context) {\n+        final String processName = getProcessName(context);\n+\n+        final String authAppAuthProcess = AZURE_AUTHENTICATOR_APP_PACKAGE_NAME + \":auth\";\n+        final String cpAuthProcess = COMPANY_PORTAL_APP_PACKAGE_NAME + \":auth\";\n+\n+        return authAppAuthProcess.equalsIgnoreCase(processName) ||\n+                cpAuthProcess.equalsIgnoreCase(processName);\n+    }\n+\n+    public static String getProcessName(final Context context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDIzODgz", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#pullrequestreview-449423883", "createdAt": "2020-07-16T00:09:37Z", "commit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDI0MDg4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#pullrequestreview-449424088", "createdAt": "2020-07-16T00:10:10Z", "commit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDoxMDoxMFrOGyVj-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDoxMDoxMFrOGyVj-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNTI1OQ==", "bodyText": "Low hanging fruit: Class description for javadoc", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#discussion_r455435259", "createdAt": "2020-07-16T00:10:10Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/util/ProcessUtil.java", "diffHunk": "@@ -0,0 +1,65 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+\n+package com.microsoft.identity.common.internal.util;\n+\n+import android.app.ActivityManager;\n+import android.content.Context;\n+\n+import androidx.annotation.NonNull;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.AZURE_AUTHENTICATOR_APP_PACKAGE_NAME;\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.COMPANY_PORTAL_APP_PACKAGE_NAME;\n+\n+public class ProcessUtil {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cae9c10514b3a7af5f8b09de46c6a3ab660f7593", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/cae9c10514b3a7af5f8b09de46c6a3ab660f7593", "committedDate": "2020-07-16T00:10:19Z", "message": "Address comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94f895b47debf655139b177487dfbdb1a49301d3", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/94f895b47debf655139b177487dfbdb1a49301d3", "committedDate": "2020-07-16T00:11:02Z", "message": "Address comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDI0Njg3", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#pullrequestreview-449424687", "createdAt": "2020-07-16T00:12:06Z", "commit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDoxMjowNlrOGyVmWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDoxMjowNlrOGyVmWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNTg2Ng==", "bodyText": "I think we have a method called as getCurrentActiveBrokerPackageName, we could use that....it is also fine the way it is too. I'll leave it up to you", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#discussion_r455435866", "createdAt": "2020-07-16T00:12:06Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/util/ProcessUtil.java", "diffHunk": "@@ -0,0 +1,65 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+\n+package com.microsoft.identity.common.internal.util;\n+\n+import android.app.ActivityManager;\n+import android.content.Context;\n+\n+import androidx.annotation.NonNull;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.AZURE_AUTHENTICATOR_APP_PACKAGE_NAME;\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.COMPANY_PORTAL_APP_PACKAGE_NAME;\n+\n+public class ProcessUtil {\n+\n+    /**\n+     * Returns true if the calling app is the auth process.\n+     */\n+    public static boolean isBrokerProcess(@NonNull final Context context) {\n+        final String processName = getProcessName(context);\n+\n+        final String authAppAuthProcess = AZURE_AUTHENTICATOR_APP_PACKAGE_NAME + \":auth\";\n+        final String cpAuthProcess = COMPANY_PORTAL_APP_PACKAGE_NAME + \":auth\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDI0ODA1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#pullrequestreview-449424805", "createdAt": "2020-07-16T00:12:29Z", "commit": {"oid": "94f895b47debf655139b177487dfbdb1a49301d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDoxMjoyOVrOGyVmyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDoxMjoyOVrOGyVmyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNTk3Ng==", "bodyText": "Can/should be declared as\n@Nullable\npublic static String getProcessName(@NonNull final Context context) {\n    // ...\n}", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#discussion_r455435976", "createdAt": "2020-07-16T00:12:29Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/util/ProcessUtil.java", "diffHunk": "@@ -0,0 +1,73 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+\n+package com.microsoft.identity.common.internal.util;\n+\n+import android.app.ActivityManager;\n+import android.content.Context;\n+\n+import androidx.annotation.NonNull;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.AZURE_AUTHENTICATOR_APP_PACKAGE_NAME;\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.COMPANY_PORTAL_APP_PACKAGE_NAME;\n+\n+/**\n+ * Utility class for anything relating to process.\n+ */\n+public class ProcessUtil {\n+\n+    private ProcessUtil(){}\n+\n+    /**\n+     * Returns true if the calling app is the auth process.\n+     */\n+    public static boolean isBrokerProcess(@NonNull final Context context) {\n+        final String processName = getProcessName(context);\n+\n+        final String authAppAuthProcess = AZURE_AUTHENTICATOR_APP_PACKAGE_NAME + \":auth\";\n+        final String cpAuthProcess = COMPANY_PORTAL_APP_PACKAGE_NAME + \":auth\";\n+\n+        return authAppAuthProcess.equalsIgnoreCase(processName) ||\n+                cpAuthProcess.equalsIgnoreCase(processName);\n+    }\n+\n+    /**\n+     * Returns the running process name.\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94f895b47debf655139b177487dfbdb1a49301d3"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52c0b8c6fa506b140483ce9946065fce36032c73", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/52c0b8c6fa506b140483ce9946065fce36032c73", "committedDate": "2020-07-16T00:16:10Z", "message": "Address comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDI0MTc4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#pullrequestreview-449424178", "createdAt": "2020-07-16T00:10:28Z", "commit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDoxMDoyOFrOGyVkTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDoxNjowN1rOGyVqug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNTM0MA==", "bodyText": "public?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#discussion_r455435340", "createdAt": "2020-07-16T00:10:28Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/util/ProcessUtil.java", "diffHunk": "@@ -0,0 +1,65 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+\n+package com.microsoft.identity.common.internal.util;\n+\n+import android.app.ActivityManager;\n+import android.content.Context;\n+\n+import androidx.annotation.NonNull;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.AZURE_AUTHENTICATOR_APP_PACKAGE_NAME;\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.COMPANY_PORTAL_APP_PACKAGE_NAME;\n+\n+public class ProcessUtil {\n+\n+    /**\n+     * Returns true if the calling app is the auth process.\n+     */\n+    public static boolean isBrokerProcess(@NonNull final Context context) {\n+        final String processName = getProcessName(context);\n+\n+        final String authAppAuthProcess = AZURE_AUTHENTICATOR_APP_PACKAGE_NAME + \":auth\";\n+        final String cpAuthProcess = COMPANY_PORTAL_APP_PACKAGE_NAME + \":auth\";\n+\n+        return authAppAuthProcess.equalsIgnoreCase(processName) ||\n+                cpAuthProcess.equalsIgnoreCase(processName);\n+    }\n+\n+    public static String getProcessName(final Context context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNjEwOA==", "bodyText": "There's some odd coupling in functionality here.  You probably want an else branch here to throw an IllegalStateException or panic or something for the case where the process name doesn't match the package name.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#discussion_r455436108", "createdAt": "2020-07-16T00:13:00Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/cache/StorageHelper.java", "diffHunk": "@@ -414,14 +415,16 @@ public EncryptionType getEncryptionType(@NonNull final String data) throws Unsup\n         EncryptionType encryptionType = getEncryptionType(encryptedBlob);\n \n         if (encryptionType == EncryptionType.USER_DEFINED) {\n-            if (AuthenticationSettings.INSTANCE.getSecretKeyData() != null) {\n+            if (ProcessUtil.isBrokerProcess(mContext)){\n+                if (COMPANY_PORTAL_APP_PACKAGE_NAME.equalsIgnoreCase(packageName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzNjk4Ng==", "bodyText": "Should we take this as an argument instead of looking for both of them?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#discussion_r455436986", "createdAt": "2020-07-16T00:16:07Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/util/ProcessUtil.java", "diffHunk": "@@ -0,0 +1,65 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+\n+package com.microsoft.identity.common.internal.util;\n+\n+import android.app.ActivityManager;\n+import android.content.Context;\n+\n+import androidx.annotation.NonNull;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.AZURE_AUTHENTICATOR_APP_PACKAGE_NAME;\n+import static com.microsoft.identity.common.adal.internal.AuthenticationConstants.Broker.COMPANY_PORTAL_APP_PACKAGE_NAME;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d09f5d75e631d30c480d2e2644e87491dad8ac1c"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDI2NzYw", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#pullrequestreview-449426760", "createdAt": "2020-07-16T00:18:41Z", "commit": {"oid": "52c0b8c6fa506b140483ce9946065fce36032c73"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDI3MzY1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#pullrequestreview-449427365", "createdAt": "2020-07-16T00:20:43Z", "commit": {"oid": "52c0b8c6fa506b140483ce9946065fce36032c73"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dfa9e1dd188f6a95c1c7ef3b565b8f3b7abce00", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/5dfa9e1dd188f6a95c1c7ef3b565b8f3b7abce00", "committedDate": "2020-07-16T00:28:07Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b56db03c99b1fad0be07c3d6171b014f98c7ec1", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/7b56db03c99b1fad0be07c3d6171b014f98c7ec1", "committedDate": "2020-07-16T00:31:23Z", "message": "Make getProcessName private"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NDMwNjgz", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/963#pullrequestreview-449430683", "createdAt": "2020-07-16T00:31:58Z", "commit": {"oid": "7b56db03c99b1fad0be07c3d6171b014f98c7ec1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7713add0b5cfac358ab195646dfc2dc51d127ac", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a7713add0b5cfac358ab195646dfc2dc51d127ac", "committedDate": "2020-07-16T01:53:44Z", "message": "Update test cases"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1696, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}