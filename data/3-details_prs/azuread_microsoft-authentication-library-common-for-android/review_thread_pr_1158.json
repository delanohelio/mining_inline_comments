{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2OTM2NDE5", "number": 1158, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzowMToyN1rOFEE_rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzozNzowOVrOFEF5EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODIwNDYwOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzowMToyN1rOIEBo-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzowNDowMFrOIEBu7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5MjA4OQ==", "bodyText": "on 1 line?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541092089", "createdAt": "2020-12-11T17:01:27Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -179,13 +181,12 @@ public static synchronized void performCloudDiscovery() throws IOException {\n                 .appendQueryParameter(AUTHORIZATION_ENDPOINT, AUTHORIZATION_ENDPOINT_VALUE)\n                 .build();\n \n-        Map<String, String> headers = new HashMap<>();\n+        final UrlConnectionHttpClient httpClient = UrlConnectionHttpClient.getDefaultInstance();\n \n-        // Suppressing deprecation warnings due to the deprecated method HttpRequest.sendGet(). Raised issue https://github.com/AzureAD/microsoft-authentication-library-common-for-android/issues/1038\n-        @SuppressWarnings(WarningType.deprecation_warning)\n-        HttpResponse response = HttpRequest.sendGet(\n-                new URL(instanceDiscoveryRequestUri.toString()),\n-                headers\n+        final Map<String, String> headers = new HashMap<>();\n+\n+        final HttpResponse response = httpClient.get(\n+                new URL(instanceDiscoveryRequestUri.toString()), headers", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eac46d67be5498dc248a4bec6bda6894061c685"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5MzYxMw==", "bodyText": "I've updated. Thanks.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541093613", "createdAt": "2020-12-11T17:04:00Z", "author": {"login": "gitaumoses4"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -179,13 +181,12 @@ public static synchronized void performCloudDiscovery() throws IOException {\n                 .appendQueryParameter(AUTHORIZATION_ENDPOINT, AUTHORIZATION_ENDPOINT_VALUE)\n                 .build();\n \n-        Map<String, String> headers = new HashMap<>();\n+        final UrlConnectionHttpClient httpClient = UrlConnectionHttpClient.getDefaultInstance();\n \n-        // Suppressing deprecation warnings due to the deprecated method HttpRequest.sendGet(). Raised issue https://github.com/AzureAD/microsoft-authentication-library-common-for-android/issues/1038\n-        @SuppressWarnings(WarningType.deprecation_warning)\n-        HttpResponse response = HttpRequest.sendGet(\n-                new URL(instanceDiscoveryRequestUri.toString()),\n-                headers\n+        final Map<String, String> headers = new HashMap<>();\n+\n+        final HttpResponse response = httpClient.get(\n+                new URL(instanceDiscoveryRequestUri.toString()), headers", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5MjA4OQ=="}, "originalCommit": {"oid": "8eac46d67be5498dc248a4bec6bda6894061c685"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODIxNzEyOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzowNDozNlrOIEBwZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzowOToyOFrOIEB79A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5Mzk5MA==", "bodyText": "This can be a field.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541093990", "createdAt": "2020-12-11T17:04:36Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -179,14 +181,11 @@ public static synchronized void performCloudDiscovery() throws IOException {\n                 .appendQueryParameter(AUTHORIZATION_ENDPOINT, AUTHORIZATION_ENDPOINT_VALUE)\n                 .build();\n \n-        Map<String, String> headers = new HashMap<>();\n+        final UrlConnectionHttpClient httpClient = UrlConnectionHttpClient.getDefaultInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63531c4b9697f63f7f24c1662466d1fccc2c3da3"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5Njk0OA==", "bodyText": "Oh yes, that's right.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541096948", "createdAt": "2020-12-11T17:09:28Z", "author": {"login": "gitaumoses4"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -179,14 +181,11 @@ public static synchronized void performCloudDiscovery() throws IOException {\n                 .appendQueryParameter(AUTHORIZATION_ENDPOINT, AUTHORIZATION_ENDPOINT_VALUE)\n                 .build();\n \n-        Map<String, String> headers = new HashMap<>();\n+        final UrlConnectionHttpClient httpClient = UrlConnectionHttpClient.getDefaultInstance();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5Mzk5MA=="}, "originalCommit": {"oid": "63531c4b9697f63f7f24c1662466d1fccc2c3da3"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODI0ODczOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/OpenIdProviderConfigurationClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMjoxMlrOIECCpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMjoxMlrOIECCpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5ODY2MA==", "bodyText": "If we don't do anything with the header reference, can we just pass a new HashMap to the get call?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541098660", "createdAt": "2020-12-11T17:12:12Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/OpenIdProviderConfigurationClient.java", "diffHunk": "@@ -139,9 +141,9 @@ public synchronized OpenIdProviderConfiguration loadOpenIdProviderConfiguration(\n                     \"Using request URL: \" + configUrl\n             );\n \n-            // Suppressing deprecation warnings due to the deprecated method HttpRequest.sendGet(). Raised issue https://github.com/AzureAD/microsoft-authentication-library-common-for-android/issues/1038\n-            @SuppressWarnings(WarningType.deprecation_warning)\n-            final HttpResponse providerConfigResponse = HttpRequest.sendGet(configUrl, new HashMap<String, String>());\n+            final Map<String, String> headers = new HashMap<>();\n+\n+            final HttpResponse providerConfigResponse = httpClient.get(configUrl, headers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32b1f52456e836f19bb3d0151385bb7394e52775"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODI1MTg5OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMjo1M1rOIECEdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMjo1M1rOIECEdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5OTEyNg==", "bodyText": "ditto comment about inlining the header reference.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541099126", "createdAt": "2020-12-11T17:12:53Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -179,14 +182,9 @@ public static synchronized void performCloudDiscovery() throws IOException {\n                 .appendQueryParameter(AUTHORIZATION_ENDPOINT, AUTHORIZATION_ENDPOINT_VALUE)\n                 .build();\n \n-        Map<String, String> headers = new HashMap<>();\n+        final Map<String, String> headers = new HashMap<>();\n \n-        // Suppressing deprecation warnings due to the deprecated method HttpRequest.sendGet(). Raised issue https://github.com/AzureAD/microsoft-authentication-library-common-for-android/issues/1038\n-        @SuppressWarnings(WarningType.deprecation_warning)\n-        HttpResponse response = HttpRequest.sendGet(\n-                new URL(instanceDiscoveryRequestUri.toString()),\n-                headers\n-        );\n+        final HttpResponse response = httpClient.get(new URL(instanceDiscoveryRequestUri.toString()), headers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32b1f52456e836f19bb3d0151385bb7394e52775"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODI1NDI1OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMzozMlrOIECF3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMzozMlrOIECF3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5OTQ4NA==", "bodyText": "Can this just be an HttpClient?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541099484", "createdAt": "2020-12-11T17:13:32Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -72,6 +74,7 @@\n     private static ConcurrentMap<String, AzureActiveDirectoryCloud> sAadClouds = new ConcurrentHashMap<>();\n     private static boolean sIsInitialized = false;\n     private static Environment sEnvironment = Environment.Production;\n+    private static final UrlConnectionHttpClient httpClient = UrlConnectionHttpClient.getDefaultInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32b1f52456e836f19bb3d0151385bb7394e52775"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODI1NTY0OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/OpenIdProviderConfigurationClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMzo1MVrOIECGtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxNDo1M1rOIECJNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5OTcwMA==", "bodyText": "Can this type just be HttpClient?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541099700", "createdAt": "2020-12-11T17:13:51Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/OpenIdProviderConfigurationClient.java", "diffHunk": "@@ -54,6 +55,7 @@\n     private static final String sWellKnownConfig = \"/.well-known/openid-configuration\";\n     private static final ExecutorService sBackgroundExecutor = Executors.newCachedThreadPool();\n     private static final Map<URL, OpenIdProviderConfiguration> sConfigCache = new HashMap<>();\n+    private static final UrlConnectionHttpClient httpClient = UrlConnectionHttpClient.getDefaultInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32b1f52456e836f19bb3d0151385bb7394e52775"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEwMDM0MQ==", "bodyText": "Oh yes, thanks for this.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541100341", "createdAt": "2020-12-11T17:14:53Z", "author": {"login": "gitaumoses4"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/OpenIdProviderConfigurationClient.java", "diffHunk": "@@ -54,6 +55,7 @@\n     private static final String sWellKnownConfig = \"/.well-known/openid-configuration\";\n     private static final ExecutorService sBackgroundExecutor = Executors.newCachedThreadPool();\n     private static final Map<URL, OpenIdProviderConfiguration> sConfigCache = new HashMap<>();\n+    private static final UrlConnectionHttpClient httpClient = UrlConnectionHttpClient.getDefaultInstance();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5OTcwMA=="}, "originalCommit": {"oid": "32b1f52456e836f19bb3d0151385bb7394e52775"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODM1MTUzOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzozNzowOVrOIEC-FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzo0NDozNVrOIEDPmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTExMzg3Ng==", "bodyText": "We should set some parameters here - how many writers do we expect for this CHM?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541113876", "createdAt": "2020-12-11T17:37:09Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -72,6 +74,7 @@\n     private static ConcurrentMap<String, AzureActiveDirectoryCloud> sAadClouds = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44addd132da6029d9343b5333938f9b478c64c40"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTExNTczNQ==", "bodyText": "I'm not following. Kindly elaborate, what's CHM?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541115735", "createdAt": "2020-12-11T17:40:12Z", "author": {"login": "gitaumoses4"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -72,6 +74,7 @@\n     private static ConcurrentMap<String, AzureActiveDirectoryCloud> sAadClouds = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTExMzg3Ng=="}, "originalCommit": {"oid": "44addd132da6029d9343b5333938f9b478c64c40"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTExODM2MA==", "bodyText": "ConcurrentHashMap.  By default, there are 16 shards here in the map, but if we only respect a single writer to this map, we don't need them.  the standard initialization parameters would be (16, 0.75f, 16) - We could take (16, 0.75f, 1) if we don't expect a lot of concurrent writes.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1158#discussion_r541118360", "createdAt": "2020-12-11T17:44:35Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/azureactivedirectory/AzureActiveDirectory.java", "diffHunk": "@@ -72,6 +74,7 @@\n     private static ConcurrentMap<String, AzureActiveDirectoryCloud> sAadClouds = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTExMzg3Ng=="}, "originalCommit": {"oid": "44addd132da6029d9343b5333938f9b478c64c40"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2143, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}