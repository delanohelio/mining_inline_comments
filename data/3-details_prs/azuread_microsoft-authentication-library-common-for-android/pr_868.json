{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxODA0Njcz", "number": 868, "title": "Closes #864 - Implements Client Clock Skew Mitigation for AT/PoP", "bodyText": "Closes #864\nTODO:\n\nImplement unit tests (1218c9f)\n\nE2E Manual Tests\n\n\n\nMode\nFlow\nResult\n\n\n\n\nStandalone\nAT\nPASS\n\n\nStandalone\nATS\nPASS\n\n\nBroker/Non-Joined\nAT\nPASS\n\n\nBroker/Non-Joined\nATS\nPASS\n\n\nBroker/Joined\nAT\nPASS\n\n\nBroker/Joined\nATS\nPASS", "createdAt": "2020-03-21T02:37:55Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868", "merged": true, "mergeCommit": {"oid": "9fc3f377052b4024133baf270729a14e11c616be"}, "closed": true, "closedAt": "2020-03-24T23:09:11Z", "author": {"login": "iambmelt"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPrOxeAH2gAyMzkxODA0NjczOmEyYzM1ZjhiMjc2MmZhOTI5ZjBmOWVlZjY5ZGUwNTRkYzI0YWUxNDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ7Fw_AH2gAyMzkxODA0NjczOmRmZjEzMzI2ZTM2OWI1OTlmMGVhNGFhNDgzYzQwMTQzMWI1NjA3NmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a2c35f8b2762fa929f0f9eef69de054dc24ae148", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/a2c35f8b2762fa929f0f9eef69de054dc24ae148", "committedDate": "2020-03-21T01:57:00Z", "message": "WIP clock skew impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93d78ab3019f4127773d6baca99938bef01dc8de", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/93d78ab3019f4127773d6baca99938bef01dc8de", "committedDate": "2020-03-21T02:34:49Z", "message": "WIP -- Broker scenarios outstanding. The broker's context must be set on\nthe AuthenticationScheme object so that signing can complete"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODg1MzQw", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-378885340", "createdAt": "2020-03-21T02:38:47Z", "commit": {"oid": "93d78ab3019f4127773d6baca99938bef01dc8de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjozODo0N1rOF5nGpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjozODo0N1rOF5nGpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MzgyOA==", "bodyText": "TODO for interactive & silent cases", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r395953828", "createdAt": "2020-03-21T02:38:47Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/request/BrokerAcquireTokenSilentOperationParameters.java", "diffHunk": "@@ -181,6 +181,7 @@ public BrokerAcquireTokenSilentOperationParameters(@NonNull final BrokerAcquireT\n                         ? acquireTokenOperationParameters.getAuthenticationScheme()\n                         : new BearerAuthenticationSchemeInternal() // If null, assume Bearer for back-compat\n         );\n+        // TODO set the broker's context on the auth scheme...", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93d78ab3019f4127773d6baca99938bef01dc8de"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79344415db8b7e2af86bac0e67433352c8fa3bfc", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/79344415db8b7e2af86bac0e67433352c8fa3bfc", "committedDate": "2020-03-21T03:03:17Z", "message": "Broker arg setting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzIyMzM4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-379722338", "createdAt": "2020-03-23T18:47:45Z", "commit": {"oid": "79344415db8b7e2af86bac0e67433352c8fa3bfc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo0Nzo0NVrOF6TZ9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo0Nzo0NVrOF6TZ9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3OTY3MQ==", "bodyText": "Update the javadoc here to specify if this is millis or secs", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r396679671", "createdAt": "2020-03-23T18:47:45Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -443,6 +443,7 @@ public void run() {\n \n     @Override\n     public String mintSignedAccessToken(@NonNull final String httpMethod,\n+                                        final long timestamp,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79344415db8b7e2af86bac0e67433352c8fa3bfc"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33fd57e65cb3865fa29dd48d6900b99068dc2b9e", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/33fd57e65cb3865fa29dd48d6900b99068dc2b9e", "committedDate": "2020-03-23T19:01:59Z", "message": "Update javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzM0MTk5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-379734199", "createdAt": "2020-03-23T19:03:57Z", "commit": {"oid": "79344415db8b7e2af86bac0e67433352c8fa3bfc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTowMzo1N1rOF6T-4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTowMzo1N1rOF6T-4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4OTEyMg==", "bodyText": "Use a constant", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r396689122", "createdAt": "2020-03-23T19:03:57Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/authscheme/PopAuthenticationSchemeInternal.java", "diffHunk": "@@ -71,27 +77,38 @@\n         super(SCHEME_POP);\n     }\n \n-    PopAuthenticationSchemeInternal(@NonNull final String httpMethod,\n+    PopAuthenticationSchemeInternal(@NonNull Context context,\n+                                    @NonNull final String httpMethod,\n                                     @NonNull final URL url,\n                                     @Nullable final String nonce) {\n         super(SCHEME_POP);\n+        mContext = context;\n         mHttpMethod = httpMethod;\n         mUrl = url;\n         mNonce = nonce;\n     }\n \n     @Override\n     public String getAccessTokenForScheme(@NonNull final String accessToken) throws ClientException {\n+        // Use the provided context to get the skew\n+        final IClockSkewManager clockSkewManager = new ClockSkewManager(mContext);\n+        final long timestampMillis = clockSkewManager.getAdjustedReferenceTime().getTime();\n+\n         return Device\n                 .getDevicePoPManagerInstance()\n                 .mintSignedAccessToken(\n                         getHttpMethod(),\n+                        timestampMillis / 1000L,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79344415db8b7e2af86bac0e67433352c8fa3bfc"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzM0Mjk4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-379734298", "createdAt": "2020-03-23T19:04:04Z", "commit": {"oid": "79344415db8b7e2af86bac0e67433352c8fa3bfc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTowNDowNFrOF6T_Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTowNDowNFrOF6T_Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4OTE5NA==", "bodyText": "nit: final", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r396689194", "createdAt": "2020-03-23T19:04:04Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/authscheme/PopAuthenticationSchemeInternal.java", "diffHunk": "@@ -71,27 +77,38 @@\n         super(SCHEME_POP);\n     }\n \n-    PopAuthenticationSchemeInternal(@NonNull final String httpMethod,\n+    PopAuthenticationSchemeInternal(@NonNull Context context,\n+                                    @NonNull final String httpMethod,\n                                     @NonNull final URL url,\n                                     @Nullable final String nonce) {\n         super(SCHEME_POP);\n+        mContext = context;\n         mHttpMethod = httpMethod;\n         mUrl = url;\n         mNonce = nonce;\n     }\n \n     @Override\n     public String getAccessTokenForScheme(@NonNull final String accessToken) throws ClientException {\n+        // Use the provided context to get the skew\n+        final IClockSkewManager clockSkewManager = new ClockSkewManager(mContext);\n+        final long timestampMillis = clockSkewManager.getAdjustedReferenceTime().getTime();\n+\n         return Device\n                 .getDevicePoPManagerInstance()\n                 .mintSignedAccessToken(\n                         getHttpMethod(),\n+                        timestampMillis / 1000L,\n                         getUrl(),\n                         accessToken,\n                         getNonce()\n                 );\n     }\n \n+    public void setContext(Context context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79344415db8b7e2af86bac0e67433352c8fa3bfc"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c37cabaaf4967c3041158eb75423a44256fca06f", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/c37cabaaf4967c3041158eb75423a44256fca06f", "committedDate": "2020-03-23T20:40:29Z", "message": "Adds a constant for millis -> second conversion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e9f835f00c4107b012bc3e536f8e58a24ee265c", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/5e9f835f00c4107b012bc3e536f8e58a24ee265c", "committedDate": "2020-03-23T20:42:28Z", "message": "Adds final + nullability annot to method input"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1218c9f868bfb016a816065b3a3f880d9341fee5", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/1218c9f868bfb016a816065b3a3f880d9341fee5", "committedDate": "2020-03-23T21:38:42Z", "message": "Add tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDE4Mjgw", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-380018280", "createdAt": "2020-03-24T05:59:57Z", "commit": {"oid": "1218c9f868bfb016a816065b3a3f880d9341fee5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNTo1OTo1OFrOF6h7tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNTo1OTo1OFrOF6h7tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxNzY4Nw==", "bodyText": "Add a comment explaining what's going on here.\nIt would be preferable to have some kind of SkewProvider object here that removes the tight-coupling between the pop auth scheme and the data source", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r396917687", "createdAt": "2020-03-24T05:59:58Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java", "diffHunk": "@@ -143,13 +143,19 @@ public BrokerRequest brokerRequestFromSilentOperationParameters(@NonNull final A\n     }\n \n     @NonNull\n-    private static AbstractAuthenticationScheme getAuthenticationScheme(@NonNull final BrokerRequest request) {\n+    private static AbstractAuthenticationScheme getAuthenticationScheme(\n+            @NonNull final Context context,\n+            @NonNull final BrokerRequest request) {\n         final AbstractAuthenticationScheme requestScheme = request.getAuthenticationScheme();\n \n         if (null == requestScheme) {\n             // Default assumes the scheme is Bearer\n             return new BearerAuthenticationSchemeInternal();\n         } else {\n+            if (requestScheme instanceof PopAuthenticationSchemeInternal) {\n+                ((PopAuthenticationSchemeInternal) requestScheme).setContext(context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1218c9f868bfb016a816065b3a3f880d9341fee5"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDE4Mzk3", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-380018397", "createdAt": "2020-03-24T06:00:18Z", "commit": {"oid": "1218c9f868bfb016a816065b3a3f880d9341fee5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNjowMDoxOFrOF6h8FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNjowMDoxOFrOF6h8FA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxNzc4MA==", "bodyText": "Junk comment, remove", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r396917780", "createdAt": "2020-03-24T06:00:18Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/request/BrokerAcquireTokenSilentOperationParameters.java", "diffHunk": "@@ -181,6 +181,7 @@ public BrokerAcquireTokenSilentOperationParameters(@NonNull final BrokerAcquireT\n                         ? acquireTokenOperationParameters.getAuthenticationScheme()\n                         : new BearerAuthenticationSchemeInternal() // If null, assume Bearer for back-compat\n         );\n+        // TODO set the broker's context on the auth scheme...", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1218c9f868bfb016a816065b3a3f880d9341fee5"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDE4NjE2", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-380018616", "createdAt": "2020-03-24T06:00:57Z", "commit": {"oid": "1218c9f868bfb016a816065b3a3f880d9341fee5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNjowMDo1N1rOF6h86A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNjowMDo1N1rOF6h86A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxNzk5Mg==", "bodyText": "Extract to a method", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r396917992", "createdAt": "2020-03-24T06:00:57Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/OAuth2Strategy.java", "diffHunk": "@@ -162,12 +172,18 @@ protected HttpResponse performTokenRequest(final GenericTokenRequest request) th\n         headers.putAll(Device.getPlatformIdParameters());\n         headers.putAll(EstsTelemetry.getInstance().getTelemetryHeaders());\n \n-        return HttpRequest.sendPost(\n+        final HttpResponse response = HttpRequest.sendPost(\n                 new URL(mTokenEndpoint),\n                 headers,\n                 requestBody.getBytes(ObjectMapper.ENCODING_SCHEME),\n                 TOKEN_REQUEST_CONTENT_TYPE\n         );\n+\n+        if (null != mClockSkewManager && null != response.getDate()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1218c9f868bfb016a816065b3a3f880d9341fee5"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMDE4NzE5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-380018719", "createdAt": "2020-03-24T06:01:14Z", "commit": {"oid": "1218c9f868bfb016a816065b3a3f880d9341fee5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNjowMToxNFrOF6h9Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwNjowMToxNFrOF6h9Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxODA3MQ==", "bodyText": "Log info", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r396918071", "createdAt": "2020-03-24T06:01:14Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/OAuth2Strategy.java", "diffHunk": "@@ -88,6 +91,13 @@ public OAuth2Strategy(GenericOAuth2Configuration config,\n                           GenericOAuth2StrategyParameters strategyParameters) {\n         mConfig = config;\n         mStrategyParameters = strategyParameters;\n+\n+        if (null != mStrategyParameters.getContext()) {\n+            mClockSkewManager = new ClockSkewManager(mStrategyParameters.getContext());\n+        } else {\n+            // No valid context to persist clock skew with!", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1218c9f868bfb016a816065b3a3f880d9341fee5"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e472128dce6cdb734c76fcdc49a1c6af596d5e1", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/8e472128dce6cdb734c76fcdc49a1c6af596d5e1", "committedDate": "2020-03-24T17:40:43Z", "message": "Merge branch 'dev' into iambmelt/864"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99a269796a8cdf8cbe51e7200a9d17ebf71905a3", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/99a269796a8cdf8cbe51e7200a9d17ebf71905a3", "committedDate": "2020-03-24T17:42:48Z", "message": "Remove stray comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNTc4MDY3", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-380578067", "createdAt": "2020-03-24T18:16:05Z", "commit": {"oid": "99a269796a8cdf8cbe51e7200a9d17ebf71905a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODoxNjowNlrOF69QBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODoxNjowNlrOF69QBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM2NTI1Mg==", "bodyText": "Curious: why do we need a separate interface? Do you foresee having another ClockSkewManager?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r397365252", "createdAt": "2020-03-24T18:16:06Z", "author": {"login": "rpdome"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/util/IClockSkewManager.java", "diffHunk": "@@ -0,0 +1,81 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.common.internal.util;\n+\n+import java.util.Date;\n+\n+/**\n+ * Provides functionality related to calculating and storing server clock skews for client\n+ * synchronization.\n+ */\n+public interface IClockSkewManager {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99a269796a8cdf8cbe51e7200a9d17ebf71905a3"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNTg5MjQy", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-380589242", "createdAt": "2020-03-24T18:30:40Z", "commit": {"oid": "99a269796a8cdf8cbe51e7200a9d17ebf71905a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzQwODEw", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-380740810", "createdAt": "2020-03-24T22:25:38Z", "commit": {"oid": "99a269796a8cdf8cbe51e7200a9d17ebf71905a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjoyNTozOFrOF7FaNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjoyNTozOFrOF7FaNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ5ODkzMw==", "bodyText": "nit: Rename to context", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r397498933", "createdAt": "2020-03-24T22:25:38Z", "author": {"login": "shahzaibj"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/ClockSkewManagerTest.java", "diffHunk": "@@ -0,0 +1,132 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.common;\n+\n+import android.content.Context;\n+\n+import androidx.test.InstrumentationRegistry;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import com.microsoft.identity.common.internal.util.ClockSkewManager;\n+import com.microsoft.identity.common.internal.util.IClockSkewManager;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.Date;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class ClockSkewManagerTest {\n+\n+    private Context sContext;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99a269796a8cdf8cbe51e7200a9d17ebf71905a3"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzQxNTUz", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-380741553", "createdAt": "2020-03-24T22:27:11Z", "commit": {"oid": "99a269796a8cdf8cbe51e7200a9d17ebf71905a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjoyNzoxMVrOF7FcyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjoyNzoxMVrOF7FcyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ5OTU5Mw==", "bodyText": "Does this need to be static?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r397499593", "createdAt": "2020-03-24T22:27:11Z", "author": {"login": "shahzaibj"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/ClockSkewManagerTest.java", "diffHunk": "@@ -0,0 +1,132 @@\n+//  Copyright (c) Microsoft Corporation.\n+//  All rights reserved.\n+//\n+//  This code is licensed under the MIT License.\n+//\n+//  Permission is hereby granted, free of charge, to any person obtaining a copy\n+//  of this software and associated documentation files(the \"Software\"), to deal\n+//  in the Software without restriction, including without limitation the rights\n+//  to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+//  copies of the Software, and to permit persons to whom the Software is\n+//  furnished to do so, subject to the following conditions :\n+//\n+//  The above copyright notice and this permission notice shall be included in\n+//  all copies or substantial portions of the Software.\n+//\n+//  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+//  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+//  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+//  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+//  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+//  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+//  THE SOFTWARE.\n+package com.microsoft.identity.common;\n+\n+import android.content.Context;\n+\n+import androidx.test.InstrumentationRegistry;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import com.microsoft.identity.common.internal.util.ClockSkewManager;\n+import com.microsoft.identity.common.internal.util.IClockSkewManager;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.Date;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class ClockSkewManagerTest {\n+\n+    private Context sContext;\n+    private static IClockSkewManager sClockSkewMgr;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99a269796a8cdf8cbe51e7200a9d17ebf71905a3"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzQzNjgz", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-380743683", "createdAt": "2020-03-24T22:31:41Z", "commit": {"oid": "99a269796a8cdf8cbe51e7200a9d17ebf71905a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjozMTo0MVrOF7Fj3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMjozMTo0MVrOF7Fj3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUwMTQwNg==", "bodyText": "Why still using String internally?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#discussion_r397501406", "createdAt": "2020-03-24T22:31:41Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/SharedPreferencesFileManager.java", "diffHunk": "@@ -158,6 +158,22 @@ public final String getString(final String key) {\n         return restoredValue;\n     }\n \n+    @Override\n+    public void putLong(final String key, final long value) {\n+        putString(key, String.valueOf(value));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99a269796a8cdf8cbe51e7200a9d17ebf71905a3"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ceaf623f3ea9d34cc3c44bbcb2b8f831d59e075", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/7ceaf623f3ea9d34cc3c44bbcb2b8f831d59e075", "committedDate": "2020-03-24T22:36:22Z", "message": "Var renames"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzQ3MTk1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/868#pullrequestreview-380747195", "createdAt": "2020-03-24T22:39:45Z", "commit": {"oid": "7ceaf623f3ea9d34cc3c44bbcb2b8f831d59e075"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78c0b0bfaaaacd9c874142080ba47d3044dd6c97", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/78c0b0bfaaaacd9c874142080ba47d3044dd6c97", "committedDate": "2020-03-24T22:46:16Z", "message": "Adding comment + moving to own method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a5fb46226ca56f6acb1021fc559e4d5a3e3050c", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/9a5fb46226ca56f6acb1021fc559e4d5a3e3050c", "committedDate": "2020-03-24T22:48:15Z", "message": "Adding logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44423b149074a898862467ab380bad2cbc79dfb4", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/44423b149074a898862467ab380bad2cbc79dfb4", "committedDate": "2020-03-24T22:54:03Z", "message": "Make param final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dff13326e369b599f0ea4aa483c401431b56076b", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/dff13326e369b599f0ea4aa483c401431b56076b", "committedDate": "2020-03-24T22:59:34Z", "message": "Remove tight coupling between auth scheme and context"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1615, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}