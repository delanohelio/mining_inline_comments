{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1Nzk0MzY2", "number": 1032, "title": "Perform browser sign out on MSAL side", "bodyText": "In the FLW sign out scenario, we've been trying to let the broker do all the work, and this includes launching default browser to Sign off the device.\nHowever, this change in API 29 seems to break this. Having said that, it's not totally broken - it still works, but unreliable. (e.g. if you sign in, then sign out right away, it seems to work fine. However, if you sign in, close the app (or launch another app), and then sign out, it doesn't seem to work).\nThis fix is to move that operation (that was being run in the background (auth) process) to foreground process.\nI'll keep the change on the broker side for now since Android is smart enough to try to launch chrome twice - which means we do not need to bump protocol version.", "createdAt": "2020-09-12T07:00:21Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1032", "merged": true, "mergeCommit": {"oid": "100e3f68a98a034ade7fbb0f435c0d33c333b287"}, "closed": true, "closedAt": "2020-09-14T18:53:21Z", "author": {"login": "rpdome"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIEM4PgH2gAyNDg1Nzk0MzY2OjJmMTE5NzhhOTc0YmE3ZjY4ZWE4MmUwMGY5YjM1N2M1ZTE3MWE4M2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI2whTAH2gAyNDg1Nzk0MzY2OjM1NmJhYTBmN2MzMTA0NzlkNWIyYTU2ZDdiZDJkNTNjYjM5MWVlNzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2f11978a974ba7f68ea82e00f9b357c5e171a83b", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/2f11978a974ba7f68ea82e00f9b357c5e171a83b", "committedDate": "2020-09-12T06:42:19Z", "message": "Perform browser sign out on MSAL side"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3OTQzODk1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1032#pullrequestreview-487943895", "createdAt": "2020-09-14T16:25:43Z", "commit": {"oid": "2f11978a974ba7f68ea82e00f9b357c5e171a83b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNjoyNTo0M1rOHRdC8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNjoyNTo0M1rOHRdC8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MzcyOA==", "bodyText": "Is info really loud enough for this message?  I think it's at least a warning.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1032#discussion_r488063728", "createdAt": "2020-09-14T16:25:43Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java", "diffHunk": "@@ -567,6 +572,39 @@ public void putValueInSuccessEvent(ApiEndEvent event, Boolean result) {\n                 });\n     }\n \n+    /**\n+     * Invoke the logout endpoint on the specified browser.\n+     * If there are more than 1 session in the browser, an account picker will be displayed.\n+     * (Alternatively, we could pass the optional sessionID as one of the query string parameter, but we're not storing that at the moment).\n+     */\n+    private void logOutFromBrowser(@NonNull final Context context,\n+                                   @NonNull final RemoveAccountCommandParameters parameters) {\n+        final String methodName = \":logOutFromBrowser\";\n+\n+        String browserPackageName = null;\n+        try {\n+            final Browser browser = BrowserSelector.select(context, parameters.getBrowserSafeList());\n+            browserPackageName = browser.getPackageName();\n+        } catch (final ClientException e) {\n+            // Best effort. If none is passed to broker, then it will let the OS decide.\n+            Logger.error(TAG, e.getErrorCode(), e);\n+        }\n+\n+        try {\n+            final Intent intent = new Intent(Intent.ACTION_VIEW);\n+            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n+            intent.setData(Uri.parse(AuthenticationConstants.Browser.LOGOUT_ENDPOINT_V2));\n+            if (browserPackageName != null) {\n+                intent.setPackage(browserPackageName);\n+            }\n+            context.startActivity(intent);\n+\n+        } catch (final ActivityNotFoundException e) {\n+            Logger.info(TAG + methodName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f11978a974ba7f68ea82e00f9b357c5e171a83b"}, "originalPosition": 79}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3OTcwNzY0", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1032#pullrequestreview-487970764", "createdAt": "2020-09-14T16:58:29Z", "commit": {"oid": "2f11978a974ba7f68ea82e00f9b357c5e171a83b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNjo1ODoyOVrOHReaEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNjo1ODoyOVrOHReaEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA4NjAzMw==", "bodyText": "If you're going to add javadoc, add the method @param -eters.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1032#discussion_r488086033", "createdAt": "2020-09-14T16:58:29Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java", "diffHunk": "@@ -567,6 +572,39 @@ public void putValueInSuccessEvent(ApiEndEvent event, Boolean result) {\n                 });\n     }\n \n+    /**\n+     * Invoke the logout endpoint on the specified browser.\n+     * If there are more than 1 session in the browser, an account picker will be displayed.\n+     * (Alternatively, we could pass the optional sessionID as one of the query string parameter, but we're not storing that at the moment).\n+     */\n+    private void logOutFromBrowser(@NonNull final Context context,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f11978a974ba7f68ea82e00f9b357c5e171a83b"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3OTcxMjg1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1032#pullrequestreview-487971285", "createdAt": "2020-09-14T16:59:08Z", "commit": {"oid": "2f11978a974ba7f68ea82e00f9b357c5e171a83b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "356baa0f7c310479d5b2a56d7bd2d53cb391ee79", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/356baa0f7c310479d5b2a56d7bd2d53cb391ee79", "committedDate": "2020-09-14T17:36:30Z", "message": "Address comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1571, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}