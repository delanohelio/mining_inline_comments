{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MzUzNTkw", "number": 1068, "title": "Do not allow for missing secret key data to cause an NPE", "bodyText": "Check for null data and do not decrypt it.\nProperly synchronize and safe-copy the key array.", "createdAt": "2020-10-04T00:00:56Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1068", "merged": true, "mergeCommit": {"oid": "be024d94e1c3e71186b437bd40387fff7361a682"}, "closed": true, "closedAt": "2020-10-06T16:00:37Z", "author": {"login": "AdamBJohnsonx"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPDqGeAH2gAyNDk3MzUzNTkwOmViN2U4YjVlOGYzMDljMDg5OGEyMTJkMzNlZTk2OGVmOGI4YjRjMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPr6FwAFqTUwMjQ3NTY0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "eb7e8b5e8f309c0898a212d33ee968ef8b8b4c24", "author": {"user": {"login": "AdamBJohnsonx", "name": null}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/eb7e8b5e8f309c0898a212d33ee968ef8b8b4c24", "committedDate": "2020-10-04T00:01:48Z", "message": "Do not allow for missing secert key data to cause NPE.\n\nCheck for null data and do not decrypt it.\nProperly synchronize and safe-copy the key array."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94518cbf2b1c9fca2b19381ff9409ff2e66fe38a", "author": {"user": {"login": "AdamBJohnsonx", "name": null}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/94518cbf2b1c9fca2b19381ff9409ff2e66fe38a", "committedDate": "2020-10-03T23:59:45Z", "message": "Do not allow for missing secert key data to cause NPE.\n\nCheck for null data and do not decrypt it.\nProperly synchronize and safe-copy the key array."}, "afterCommit": {"oid": "eb7e8b5e8f309c0898a212d33ee968ef8b8b4c24", "author": {"user": {"login": "AdamBJohnsonx", "name": null}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/eb7e8b5e8f309c0898a212d33ee968ef8b8b4c24", "committedDate": "2020-10-04T00:01:48Z", "message": "Do not allow for missing secert key data to cause NPE.\n\nCheck for null data and do not decrypt it.\nProperly synchronize and safe-copy the key array."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNDY4NTAy", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1068#pullrequestreview-502468502", "createdAt": "2020-10-05T22:37:56Z", "commit": {"oid": "eb7e8b5e8f309c0898a212d33ee968ef8b8b4c24"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMjozNzo1NlrOHcwEzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMjozNzo1NlrOHcwEzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwOTgzOQ==", "bodyText": "So are we no longer using getters and setters? Do we still need them?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1068#discussion_r499909839", "createdAt": "2020-10-05T22:37:56Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -88,8 +93,8 @@\n      *\n      * @return byte[] secret data\n      */\n-    public byte[] getSecretKeyData() {\n-        return mSecretKeyData.get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb7e8b5e8f309c0898a212d33ee968ef8b8b4c24"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNDcxNjk0", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1068#pullrequestreview-502471694", "createdAt": "2020-10-05T22:45:27Z", "commit": {"oid": "eb7e8b5e8f309c0898a212d33ee968ef8b8b4c24"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMjo0NToyOFrOHcwOuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMjo0NToyOFrOHcwOuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxMjM3Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            SecretKey key = getSecretKey(secretKeyData);\n          \n          \n            \n                            return key;\n          \n          \n            \n                            return getSecretKey(secretKeyData);", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1068#discussion_r499912376", "createdAt": "2020-10-05T22:45:28Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/cache/StorageHelper.java", "diffHunk": "@@ -590,7 +590,13 @@ public SecretKey loadSecretKey(@NonNull final KeyType keyType) throws IOExceptio\n                 return getSecretKey(AuthenticationSettings.INSTANCE.getBrokerSecretKeys().get(COMPANY_PORTAL_APP_PACKAGE_NAME));\n \n             case ADAL_USER_DEFINED_KEY:\n-                return getSecretKey(AuthenticationSettings.INSTANCE.getSecretKeyData());\n+                final byte[] secretKeyData = AuthenticationSettings.INSTANCE.getSecretKeyData();\n+                if (secretKeyData == null) {\n+                    Logger.error(\"StorageHelper:loadSecretKey\", \"Went looking for a key that wasn't there.\", null);\n+                    return null;\n+                }\n+                SecretKey key = getSecretKey(secretKeyData);\n+                return key;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb7e8b5e8f309c0898a212d33ee968ef8b8b4c24"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNDcxODUy", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1068#pullrequestreview-502471852", "createdAt": "2020-10-05T22:45:51Z", "commit": {"oid": "eb7e8b5e8f309c0898a212d33ee968ef8b8b4c24"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54f8e1856cc421e2e329b6420edfa31d60a357c6", "author": {"user": {"login": "AdamBJohnsonx", "name": null}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/54f8e1856cc421e2e329b6420edfa31d60a357c6", "committedDate": "2020-10-05T22:46:32Z", "message": "Update common/src/main/java/com/microsoft/identity/common/adal/internal/cache/StorageHelper.java\r\n\r\nRemove useless assignment.\n\nCo-authored-by: Shahzaib <37125644+shahzaibj@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNDc1NjQ1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1068#pullrequestreview-502475645", "createdAt": "2020-10-05T22:55:28Z", "commit": {"oid": "54f8e1856cc421e2e329b6420edfa31d60a357c6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1360, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}