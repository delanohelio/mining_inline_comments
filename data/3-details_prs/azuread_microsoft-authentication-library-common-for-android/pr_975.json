{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1ODg3NTM3", "number": 975, "title": "DCF PR: Adding Command/Controller code", "bodyText": "In this PR, moved on from API-side implementation and implemented code on the command and controller ends.\nImplemented code in DeviceCodeFlowCommand in Common\nAdded expected errors in DeviceCodeFlowCommand in Common\nAdded abstract 'deviceCodeFlowAuthRequest()andacquireDeviceCodeFlowToken()toBaseControllerin Common Added DCF fields toMicrosoftAuthorizationResponse' in Common", "createdAt": "2020-07-23T18:39:39Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975", "merged": true, "mergeCommit": {"oid": "29b7cbd34130dc1bb230f93a62cffab619640644"}, "closed": true, "closedAt": "2020-07-27T19:59:39Z", "author": {"login": "t-fadura"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3zyd-AH2gAyNDU1ODg3NTM3OmNjOTE0ODU4NzA5YjQ4NDBhYzYzNTYzZTZkNmJlMDJjNTFiNzQ5M2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5FCUAgFqTQ1NTk3Mzk2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/cc914858709b4840ac63563e6d6be02c51b7493f", "committedDate": "2020-07-23T18:32:12Z", "message": "Added abstract methods to BaseController, command body, new fields in MicrosoftStsAuthorizationResponse object"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NDgwMjQ0", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#pullrequestreview-454480244", "createdAt": "2020-07-23T20:42:20Z", "commit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMDo0MjoyMFrOG2a2cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMDo1Mjo1OFrOG2bKxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcxNjIxMQ==", "bodyText": "Double check these error strings with @hamiltonha", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#discussion_r459716211", "createdAt": "2020-07-23T20:42:20Z", "author": {"login": "rpdome"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/commands/DeviceCodeFlowCommand.java", "diffHunk": "@@ -38,6 +40,16 @@\n  * exception handling.\n  */\n public class DeviceCodeFlowCommand extends TokenCommand {\n+\n+    public final static String AUTH_DECLINED_CODE = \"authorization_declined\";\n+    public final static String AUTH_DECLINED_MSG = \"The end user has denied the authorization request. Re-run the Device Code Flow Protocol with another user.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcyMTQxNA==", "bodyText": "nit: add an extra line", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#discussion_r459721414", "createdAt": "2020-07-23T20:52:58Z", "author": {"login": "rpdome"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/BaseController.java", "diffHunk": "@@ -143,6 +144,11 @@ public abstract boolean getDeviceMode(final CommandParameters parameters)\n     public abstract boolean removeCurrentAccount(final RemoveAccountCommandParameters parameters)\n             throws Exception;\n \n+    public abstract AuthorizationResult deviceCodeFlowAuthRequest(final DeviceCodeFlowCommandParameters parameters)\n+            throws Exception;\n+    public abstract AcquireTokenResult acquireDeviceCodeFlowToken(final AuthorizationResult authorizationResult, DeviceCodeFlowCommandParameters commandParameters)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NTIxMjE2", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#pullrequestreview-454521216", "createdAt": "2020-07-23T21:53:01Z", "commit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMTo1MzowMVrOG2c28A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMTo1MzowMVrOG2c28A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc0OTEwNA==", "bodyText": "I don't think these should live here. They should instead be in ErrorStrings.java", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#discussion_r459749104", "createdAt": "2020-07-23T21:53:01Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/commands/DeviceCodeFlowCommand.java", "diffHunk": "@@ -38,6 +40,16 @@\n  * exception handling.\n  */\n public class DeviceCodeFlowCommand extends TokenCommand {\n+\n+    public final static String AUTH_DECLINED_CODE = \"authorization_declined\";\n+    public final static String AUTH_DECLINED_MSG = \"The end user has denied the authorization request. Re-run the Device Code Flow Protocol with another user.\";\n+    public final static String EXPIRED_TOKEN_CODE = \"expired_token\";\n+    public final static String EXPIRED_TOKEN_MSG = \"The token has expired, therefore authentication is no longer possible with this flow attempt. Re-run the Device Code Flow Protocol to try again.\";\n+    // Add more errors\n+\n+    // Use this message for when DCF fails with an error code that doesn't match any of the codes above\n+    public final static String DEFAULT_ERROR_MSG = \"Device Code Flow has failed with an unexpected error. The error code shown was received from the authorization result.\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NTIzMDg3", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#pullrequestreview-454523087", "createdAt": "2020-07-23T21:56:38Z", "commit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMTo1NjozOFrOG2c9Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMTo1NjozOFrOG2c9Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc1MDY5MA==", "bodyText": "This is wrong as stated on CR on an earlier PR. This would use the BrokerMsalController if a broker is present on the device.\nThis should instead be getControllers() and loop over them to execute for each controller. For an example, see SilentTokenCommand.java", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#discussion_r459750690", "createdAt": "2020-07-23T21:56:38Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/commands/DeviceCodeFlowCommand.java", "diffHunk": "@@ -47,8 +59,30 @@ public DeviceCodeFlowCommand(@NonNull DeviceCodeFlowCommandParameters parameters\n \n     @Override\n     public AcquireTokenResult execute() throws Exception {\n-        // TODO: Implement execute body in next PR, when DCF methods have been declared/defined in LocalMsalController\n-        return null;\n+\n+        // Get the controller used to execute the command\n+        final BaseController controller = getDefaultController();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NTI0MzMy", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#pullrequestreview-454524332", "createdAt": "2020-07-23T21:59:03Z", "commit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NTM4NzEz", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#pullrequestreview-454538713", "createdAt": "2020-07-23T22:30:32Z", "commit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMjozMDozMlrOG2dwoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMjozMDozMlrOG2dwoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc2Mzg3Mw==", "bodyText": "Most of these properties are going to be unfamiliar to us, as we're just now adding support for DCF. Despite the other getters not having javadoc in this class, can I request we add it for these new methods? I think it's is particularly important to call out that these getters and their values will return null in non-DCF cases, and that these values may be applicable only in DC flows", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#discussion_r459763873", "createdAt": "2020-07-23T22:30:32Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/MicrosoftAuthorizationResponse.java", "diffHunk": "@@ -85,6 +105,15 @@ public void setCorrelationId(final String correlationId) {\n \n     public String getSessionState() { return mSessionState;}\n \n+    public String getDeviceCode() { return mDeviceCode;}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NTQyNTg4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#pullrequestreview-454542588", "createdAt": "2020-07-23T22:40:16Z", "commit": {"oid": "cc914858709b4840ac63563e6d6be02c51b7493f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d10c9d732456f17da82459baf305af7e187ca4ee", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d10c9d732456f17da82459baf305af7e187ca4ee", "committedDate": "2020-07-24T11:04:36Z", "message": "Merge branch 'dev' of https://github.com/AzureAD/microsoft-authentication-library-common-for-android into t-fadura/dcf-main"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5036cf73774718d6b95842783b370deb9342b2c1", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/5036cf73774718d6b95842783b370deb9342b2c1", "committedDate": "2020-07-24T11:05:44Z", "message": "Merge branch 'dev' into t-fadura/dcf-main"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b59441fb5a37d9ba13333b8c735ee54d2bbf1c44", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/b59441fb5a37d9ba13333b8c735ee54d2bbf1c44", "committedDate": "2020-07-24T12:15:35Z", "message": "Merge branch 't-fadura/dcf-main' of https://github.com/AzureAD/microsoft-authentication-library-common-for-android into t-fadura/dcf-main"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "028d4d12b7a594e9ce99b04c43a69295ef39afc4", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/028d4d12b7a594e9ce99b04c43a69295ef39afc4", "committedDate": "2020-07-24T13:00:04Z", "message": "All DCF fields now strings, added JavaDocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31efc4925d143c0fa6d410b200fb74773056a3df", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/31efc4925d143c0fa6d410b200fb74773056a3df", "committedDate": "2020-07-24T13:26:31Z", "message": "moved errors from DeviceCodeFlowCommand to ErrorStrings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0ODk3NTMy", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#pullrequestreview-454897532", "createdAt": "2020-07-24T13:44:24Z", "commit": {"oid": "31efc4925d143c0fa6d410b200fb74773056a3df"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89e646c50ecc74494efdc22e35660058ce3ebfea", "author": {"user": {"login": "t-fadura", "name": "Fadi Durah"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/89e646c50ecc74494efdc22e35660058ce3ebfea", "committedDate": "2020-07-24T19:56:58Z", "message": "Merge branch 'dev' into t-fadura/dcf-main"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTQ1OTU5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#pullrequestreview-455945959", "createdAt": "2020-07-27T16:31:36Z", "commit": {"oid": "89e646c50ecc74494efdc22e35660058ce3ebfea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTY5Njgz", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#pullrequestreview-455969683", "createdAt": "2020-07-27T17:01:57Z", "commit": {"oid": "89e646c50ecc74494efdc22e35660058ce3ebfea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1OTczOTYz", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#pullrequestreview-455973963", "createdAt": "2020-07-27T17:07:45Z", "commit": {"oid": "89e646c50ecc74494efdc22e35660058ce3ebfea"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzowNzo0NVrOG3rpYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxNzowNzo0NVrOG3rpYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAzOTk3MQ==", "bodyText": "nit: What requires this import?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/975#discussion_r461039971", "createdAt": "2020-07-27T17:07:45Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/microsoft/microsoftsts/MicrosoftStsAuthorizationResponse.java", "diffHunk": "@@ -24,6 +24,7 @@\n \n import com.microsoft.identity.common.internal.providers.microsoft.MicrosoftAuthorizationResponse;\n \n+import java.net.URL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89e646c50ecc74494efdc22e35660058ce3ebfea"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1496, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}