{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMDI5OTcy", "number": 988, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMzoxNzo0MFrOEWYxVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMzoxNzo0MFrOEWYxVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTA5OTczOnYy", "diffSide": "RIGHT", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/mocks/MockServerResponse.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QyMzoxNzo0MFrOG9rM4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwMjo0Mzo0NlrOG9s4dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMyNDEyOQ==", "bodyText": "Why are we removing this?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/988#discussion_r467324129", "createdAt": "2020-08-07T23:17:40Z", "author": {"login": "rpdome"}, "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/mocks/MockServerResponse.java", "diffHunk": "@@ -52,7 +52,7 @@ public static HttpResponse getMockTokenFailureInvalidGrantResponse() {\n                 \"\\t\\\"trace_id\\\": \\\"8497799a-e9f9-402f-a951-7060b5014600\\\",\\n\" +\n                 \"\\t\\\"correlation_id\\\": \\\"390d7507-c607-4f05-bb8a-51a2a7a6282b\\\",\\n\" +\n                 \"\\t\\\"error_uri\\\": \\\"https://login.microsoftonline.com/error?code=70000\\\",\\n\" +\n-                \"\\t\\\"suberror\\\": \\\"bad_token\\\"\\n\" +\n+                \"\\t\\\"suberror\\\": \\\"\\\"\\n\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c4b8f5c1bbba57365fced5bdf8399de1a55c2c4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMyNTI0MA==", "bodyText": "Back when the test was written, we weren't deleting tokens when a bad_token suberror was thrown by ESTS. However, we changed that behavior here  so now I've refactored this mock response to not throw the bad_token suberror so that MSAL doesn't remove tokens.....because the telemetry test was written around the old behavior. There were two ways to fix:\n\nKeep this mocked response and refactor the test to account for the fact that a bad_token suberror could wipe RT\nOr just refactor the Mock Response to not throw the bad_token suberror\n\nSo I went with the second approach", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/988#discussion_r467325240", "createdAt": "2020-08-07T23:22:52Z", "author": {"login": "shahzaibj"}, "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/mocks/MockServerResponse.java", "diffHunk": "@@ -52,7 +52,7 @@ public static HttpResponse getMockTokenFailureInvalidGrantResponse() {\n                 \"\\t\\\"trace_id\\\": \\\"8497799a-e9f9-402f-a951-7060b5014600\\\",\\n\" +\n                 \"\\t\\\"correlation_id\\\": \\\"390d7507-c607-4f05-bb8a-51a2a7a6282b\\\",\\n\" +\n                 \"\\t\\\"error_uri\\\": \\\"https://login.microsoftonline.com/error?code=70000\\\",\\n\" +\n-                \"\\t\\\"suberror\\\": \\\"bad_token\\\"\\n\" +\n+                \"\\t\\\"suberror\\\": \\\"\\\"\\n\" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMyNDEyOQ=="}, "originalCommit": {"oid": "1c4b8f5c1bbba57365fced5bdf8399de1a55c2c4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMzMjM0OA==", "bodyText": "given that the server is now returning bad_token, shouldn't we keep the response valid and modify the test instead?\n(IMO, the mock response should be kept as close as the actual response from the server as much as possible).", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/988#discussion_r467332348", "createdAt": "2020-08-07T23:59:43Z", "author": {"login": "rpdome"}, "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/mocks/MockServerResponse.java", "diffHunk": "@@ -52,7 +52,7 @@ public static HttpResponse getMockTokenFailureInvalidGrantResponse() {\n                 \"\\t\\\"trace_id\\\": \\\"8497799a-e9f9-402f-a951-7060b5014600\\\",\\n\" +\n                 \"\\t\\\"correlation_id\\\": \\\"390d7507-c607-4f05-bb8a-51a2a7a6282b\\\",\\n\" +\n                 \"\\t\\\"error_uri\\\": \\\"https://login.microsoftonline.com/error?code=70000\\\",\\n\" +\n-                \"\\t\\\"suberror\\\": \\\"bad_token\\\"\\n\" +\n+                \"\\t\\\"suberror\\\": \\\"\\\"\\n\" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMyNDEyOQ=="}, "originalCommit": {"oid": "1c4b8f5c1bbba57365fced5bdf8399de1a55c2c4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM1MTY3MA==", "bodyText": "I don't think the server will always return bad_token when invalid_grant occurs, so all we have done here is that we are mocking a different error scenario from the server. Essentially we are saying that the server is throwing an invalid_grant error here without any sub error.\nDo we know if the server would always return bad_token with an invalid_grant? (I don't think so). May be @kreedula can provide some insight?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/988#discussion_r467351670", "createdAt": "2020-08-08T02:43:46Z", "author": {"login": "shahzaibj"}, "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/mocks/MockServerResponse.java", "diffHunk": "@@ -52,7 +52,7 @@ public static HttpResponse getMockTokenFailureInvalidGrantResponse() {\n                 \"\\t\\\"trace_id\\\": \\\"8497799a-e9f9-402f-a951-7060b5014600\\\",\\n\" +\n                 \"\\t\\\"correlation_id\\\": \\\"390d7507-c607-4f05-bb8a-51a2a7a6282b\\\",\\n\" +\n                 \"\\t\\\"error_uri\\\": \\\"https://login.microsoftonline.com/error?code=70000\\\",\\n\" +\n-                \"\\t\\\"suberror\\\": \\\"bad_token\\\"\\n\" +\n+                \"\\t\\\"suberror\\\": \\\"\\\"\\n\" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzMyNDEyOQ=="}, "originalCommit": {"oid": "1c4b8f5c1bbba57365fced5bdf8399de1a55c2c4"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2188, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}