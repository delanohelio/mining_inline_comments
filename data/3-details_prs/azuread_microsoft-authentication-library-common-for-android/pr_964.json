{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwNDE5NDI1", "number": 964, "title": "Adding \"junk data\" tests to the MSAL Cache", "bodyText": "These are tests I wrote to verify the cache skips/preserves unexpected values; this is a setup for a future conversation around potentially storing data from OneAuth in this cache.", "createdAt": "2020-07-16T18:45:06Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/964", "merged": true, "mergeCommit": {"oid": "df83075292f6a7028d3bdab3820edd1e7f4242ac"}, "closed": true, "closedAt": "2020-07-16T21:27:28Z", "author": {"login": "iambmelt"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1jrZmgH2gAyNDUwNDE5NDI1OjQ4YzBkZmQ3NDY0NTM0YzU1NmE0YmQzZTIwNmYzZTYxNzg1YmM0OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1lQXhAH2gAyNDUwNDE5NDI1OmVlMzlkNGMxNDE5Y2FlOGFkNzAxNDI3OTliYzIxNWU0YWVlYzkxYjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "48c0dfd7464534c556a4bd3e206f3e61785bc494", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/48c0dfd7464534c556a4bd3e206f3e61785bc494", "committedDate": "2020-07-16T18:38:09Z", "message": "Adding \"junk data\" tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9295da14e2430c8d5273a27c6597dd3ad7ef036f", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/9295da14e2430c8d5273a27c6597dd3ad7ef036f", "committedDate": "2020-07-16T18:42:54Z", "message": "Moving consts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMTQ5MDU3", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/964#pullrequestreview-450149057", "createdAt": "2020-07-16T19:23:11Z", "commit": {"oid": "9295da14e2430c8d5273a27c6597dd3ad7ef036f"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxOToyMzoxMVrOGy5MXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxOToyNjozOVrOGy5W8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAxOTAzOQ==", "bodyText": "Should we check that these have some particular value?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/964#discussion_r456019039", "createdAt": "2020-07-16T19:23:11Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalOAuth2TokenCacheTest.java", "diffHunk": "@@ -344,6 +389,28 @@ public void saveTokensWithAggregationSingleEntry() throws ClientException {\n         assertNotNull(entry.getRefreshToken());\n     }\n \n+    @Test\n+    public void saveTokensWithAggregationSingleEntryWithMalformedDataInCache() throws ClientException {\n+        // Prepopulate the cache with unparseable, junk data\n+        mSharedPreferencesFileManager.putString(JUNK_KEY, JUNK_VALUE);\n+\n+        final List<ICacheRecord> result = loadTestBundleIntoCacheWithAggregation(\n+                defaultTestBundleV2\n+        );\n+\n+        assertEquals(1, result.size());\n+\n+        final ICacheRecord entry = result.get(0);\n+\n+        assertNotNull(entry.getAccount());\n+        assertNotNull(entry.getIdToken());\n+        assertNotNull(entry.getAccessToken());\n+        assertNotNull(entry.getRefreshToken());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9295da14e2430c8d5273a27c6597dd3ad7ef036f"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAyMTc0Ng==", "bodyText": "nit: if CredentialType is an enum, then you could replace with a switch.  Also, I think you can provide a string in the fail() method saying why it is failing and assist the poor person viewing the test failure to fix it.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/964#discussion_r456021746", "createdAt": "2020-07-16T19:26:39Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalOAuth2TokenCacheTest.java", "diffHunk": "@@ -294,6 +297,48 @@ public void saveTokens() throws Exception {\n         assertEquals(defaultTestBundleV2.mGeneratedIdToken, ids.get(0));\n     }\n \n+    @Test\n+    public void saveTokensWithMalformedDataInCache() throws Exception {\n+        // Prepopulate the cache with unparseable, junk data\n+        mSharedPreferencesFileManager.putString(JUNK_KEY, JUNK_VALUE);\n+\n+        mOauth2TokenCache.save(\n+                mockStrategy,\n+                mockRequest,\n+                mockResponse\n+        );\n+\n+        final List<AccountRecord> accounts = accountCredentialCache.getAccounts();\n+        assertEquals(1, accounts.size());\n+        assertEquals(defaultTestBundleV2.mGeneratedAccount, accounts.get(0));\n+\n+        final List<Credential> credentials = accountCredentialCache.getCredentials();\n+        assertEquals(3, credentials.size());\n+\n+        final List<Credential> rts = new ArrayList<>();\n+        final List<Credential> ats = new ArrayList<>();\n+        final List<Credential> ids = new ArrayList<>();\n+\n+        for (final Credential credential : credentials) {\n+            if (credential.getCredentialType().equalsIgnoreCase(CredentialType.AccessToken.name())) {\n+                ats.add(credential);\n+            } else if (credential.getCredentialType().equalsIgnoreCase(CredentialType.RefreshToken.name())) {\n+                rts.add(credential);\n+            } else if (credential.getCredentialType().equalsIgnoreCase(CredentialType.IdToken.name())) {\n+                ids.add(credential);\n+            } else {\n+                fail();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9295da14e2430c8d5273a27c6597dd3ad7ef036f"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "895c3d2c36748b8a7c40d6664bd472f11d22bf52", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/895c3d2c36748b8a7c40d6664bd472f11d22bf52", "committedDate": "2020-07-16T19:58:28Z", "message": "Refining tests for exactness"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d37efeb340eb3cfe438317e799fa5b3d4320cdb", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/8d37efeb340eb3cfe438317e799fa5b3d4320cdb", "committedDate": "2020-07-16T20:06:26Z", "message": "Convert test case to use a switch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6044e92dab13397356bce8bdd4a64ccd673704a", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/c6044e92dab13397356bce8bdd4a64ccd673704a", "committedDate": "2020-07-16T20:12:19Z", "message": "Applying changes to other tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee39d4c1419cae8ad70142799bc215e4aeec91b7", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ee39d4c1419cae8ad70142799bc215e4aeec91b7", "committedDate": "2020-07-16T20:28:26Z", "message": "Slight refactor"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1492, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}