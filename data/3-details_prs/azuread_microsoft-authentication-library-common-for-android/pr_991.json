{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MjQwNTg3", "number": 991, "title": "Handle full authority URL properly", "bodyText": "fix AzureAD/microsoft-authentication-library-for-android#1121\nWhen the following authority pattern is used in the config file\n\"authorities\" : [\n    {\n      \"type\": \"AAD\",\n      \"authority_url\": \"https://login.microsoftonline.com/rapong.onmicrosoft.com\"\n    }\n  ]\n\nAuthorityDeserializer would just take the whole \"authority_url\" and save it as cloudUrl.\nWhen we're actually trying to get an authority, we would construct that by appending cloudUrl with tenantId.\nIn this case, we'll end up getting https://login.microsoftonline.com/rapong.onmicrosoft.com/common.", "createdAt": "2020-08-06T20:12:36Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/991", "merged": true, "mergeCommit": {"oid": "3570af8f3beb024fc91026c3c55a74563bd681d3"}, "closed": true, "closedAt": "2020-08-07T19:15:04Z", "author": {"login": "rpdome"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8Vl5IAH2gAyNDY0MjQwNTg3OmJiMTI3ZTZmNTk2YWI1ZmMwMjgwNzI3ZjYyODdhOTUzZThhMzJlMzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8mo8RgH2gAyNDY0MjQwNTg3OjJmMGM2ZThjNTcyMmI1ODRkZjdmY2FmM2UwNjFjNmY5ZTRhZjllNTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bb127e6f596ab5fc0280727f6287a953e8a32e37", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/bb127e6f596ab5fc0280727f6287a953e8a32e37", "committedDate": "2020-08-06T20:10:56Z", "message": "Handle full authority URL properly"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODU4ODcx", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/991#pullrequestreview-462858871", "createdAt": "2020-08-06T20:37:41Z", "commit": {"oid": "bb127e6f596ab5fc0280727f6287a953e8a32e37"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDozNzo0MVrOG9Dagg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMDozNzo0MVrOG9Dagg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY3MjI1OA==", "bodyText": "Looks like we are just setting the tenant id on the audience -- whatever audience was created; which may not be correct in the first place i.e. not having any audience in the config defaults to AllAccounts. I think we need to make sure the the audience on the Authority is of the correct type.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/991#discussion_r466672258", "createdAt": "2020-08-06T20:37:41Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/authorities/AuthorityDeserializer.java", "diffHunk": "@@ -48,9 +51,14 @@ public Authority deserialize(JsonElement json, Type typeOfT, JsonDeserialization\n                             TAG + methodName,\n                             \"Type: AAD\"\n                     );\n-                    AzureActiveDirectoryAuthority aadAuthority = context.deserialize(authorityObject, AzureActiveDirectoryAuthority.class);\n-                    if (aadAuthority != null && aadAuthority.mAudience != null) {\n-                        aadAuthority.mAudience.setCloudUrl(aadAuthority.mAuthorityUrl);\n+                    final AzureActiveDirectoryAuthority aadAuthority = context.deserialize(authorityObject, AzureActiveDirectoryAuthority.class);\n+                    if (aadAuthority != null && aadAuthority.mAudience != null && aadAuthority.mAuthorityUrl != null) {\n+                        final Uri uri = Uri.parse(aadAuthority.mAuthorityUrl);\n+                        aadAuthority.mAudience.setCloudUrl(uri.getScheme() + \"://\" + uri.getHost());\n+                        // Try to extract tenant ID from the authority link.\n+                        if (!TextUtils.isEmpty(uri.getLastPathSegment())) {\n+                            aadAuthority.mAudience.setTenantId(uri.getLastPathSegment());\n+                        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb127e6f596ab5fc0280727f6287a953e8a32e37"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODU5MjA4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/991#pullrequestreview-462859208", "createdAt": "2020-08-06T20:38:09Z", "commit": {"oid": "bb127e6f596ab5fc0280727f6287a953e8a32e37"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b6344b1d4a9a33b98e831e8e457616476509c30", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/4b6344b1d4a9a33b98e831e8e457616476509c30", "committedDate": "2020-08-06T21:09:44Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d6b4164123e7a1f3ccc6c18f60915b9cedc11b6", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/2d6b4164123e7a1f3ccc6c18f60915b9cedc11b6", "committedDate": "2020-08-06T21:13:35Z", "message": "shorten code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODk1Nzc4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/991#pullrequestreview-462895778", "createdAt": "2020-08-06T21:40:55Z", "commit": {"oid": "2d6b4164123e7a1f3ccc6c18f60915b9cedc11b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTAzNTY0", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/991#pullrequestreview-462903564", "createdAt": "2020-08-06T21:56:12Z", "commit": {"oid": "2d6b4164123e7a1f3ccc6c18f60915b9cedc11b6"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f0c6e8c5722b584df7fcaf3e061c6f9e4af9e56", "author": {"user": {"login": "rpdome", "name": "Dome Pongmongkol"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/2f0c6e8c5722b584df7fcaf3e061c6f9e4af9e56", "committedDate": "2020-08-07T16:02:39Z", "message": "Merge branch 'dev' into rapong/fixAuthority"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1514, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}