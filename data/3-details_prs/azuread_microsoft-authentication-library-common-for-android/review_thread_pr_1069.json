{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MjAwOTAw", "number": 1069, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNDo0NDozNVrOEqkFHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoyNDo1NVrOEq2H8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMDY2NzgzOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQwNDo0NDozNVrOHc1v4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjoxOTo1NFrOHdPycQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwMjc4Ng==", "bodyText": "Add a specific code for UNKNOWN_DOWNLEVEL", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500002786", "createdAt": "2020-10-06T04:44:35Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,29 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {\n+        /**\n+         * Return if the underlying private key resides inside secure hardware (e.g., Trusted\n+         * Execution Environment (TEE) or Secure Element (SE)). No mechanism of attestation is\n+         * provided or specified.\n+         */\n+        TRUE_UNATTESTED,\n+\n+        /**\n+         * The the underlying private key is not inside secure hardware.\n+         */\n+        FALSE,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to lack of API support for\n+         * determination.\n+         */\n+        UNKNOWN", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6b75ca9ec7203ab9df3a095d1205b98f13807cf"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwMzIyMA==", "bodyText": "and UNKNOWN_QRY_ERR", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500003220", "createdAt": "2020-10-06T04:46:30Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,29 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {\n+        /**\n+         * Return if the underlying private key resides inside secure hardware (e.g., Trusted\n+         * Execution Environment (TEE) or Secure Element (SE)). No mechanism of attestation is\n+         * provided or specified.\n+         */\n+        TRUE_UNATTESTED,\n+\n+        /**\n+         * The the underlying private key is not inside secure hardware.\n+         */\n+        FALSE,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to lack of API support for\n+         * determination.\n+         */\n+        UNKNOWN", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwMjc4Ng=="}, "originalCommit": {"oid": "a6b75ca9ec7203ab9df3a095d1205b98f13807cf"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQyOTQyNQ==", "bodyText": "79411eb", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500429425", "createdAt": "2020-10-06T16:19:54Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,29 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {\n+        /**\n+         * Return if the underlying private key resides inside secure hardware (e.g., Trusted\n+         * Execution Environment (TEE) or Secure Element (SE)). No mechanism of attestation is\n+         * provided or specified.\n+         */\n+        TRUE_UNATTESTED,\n+\n+        /**\n+         * The the underlying private key is not inside secure hardware.\n+         */\n+        FALSE,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to lack of API support for\n+         * determination.\n+         */\n+        UNKNOWN", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDAwMjc4Ng=="}, "originalCommit": {"oid": "a6b75ca9ec7203ab9df3a095d1205b98f13807cf"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzMwMjg2OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjowNDowMVrOHdPJSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjoyMjoxMVrOHdP4sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxODg5MA==", "bodyText": "We don't need to capture the returned value here?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500418890", "createdAt": "2020-10-06T16:04:01Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -1044,7 +1080,7 @@ private KeyPair generateNewRsaKeyPair(@NonNull final Context context,\n \n             // If the key material is hidden (HSM or otherwise) the length is -1\n             if (length >= minKeySize || length < 0) {\n-                logSecureHardwareState(kp);\n+                getSecureHardwareState(kp);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6b75ca9ec7203ab9df3a095d1205b98f13807cf"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQyNjIxMg==", "bodyText": "Not here, no -- just using this method for its logging purposes", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500426212", "createdAt": "2020-10-06T16:15:03Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -1044,7 +1080,7 @@ private KeyPair generateNewRsaKeyPair(@NonNull final Context context,\n \n             // If the key material is hidden (HSM or otherwise) the length is -1\n             if (length >= minKeySize || length < 0) {\n-                logSecureHardwareState(kp);\n+                getSecureHardwareState(kp);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxODg5MA=="}, "originalCommit": {"oid": "a6b75ca9ec7203ab9df3a095d1205b98f13807cf"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQyOTgzMA==", "bodyText": "Will add a comment to clarify this usage", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500429830", "createdAt": "2020-10-06T16:20:26Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -1044,7 +1080,7 @@ private KeyPair generateNewRsaKeyPair(@NonNull final Context context,\n \n             // If the key material is hidden (HSM or otherwise) the length is -1\n             if (length >= minKeySize || length < 0) {\n-                logSecureHardwareState(kp);\n+                getSecureHardwareState(kp);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxODg5MA=="}, "originalCommit": {"oid": "a6b75ca9ec7203ab9df3a095d1205b98f13807cf"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzMDQ3Ng==", "bodyText": "I think it is fine -- just a bit misleading when reading the code", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500430476", "createdAt": "2020-10-06T16:21:24Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -1044,7 +1080,7 @@ private KeyPair generateNewRsaKeyPair(@NonNull final Context context,\n \n             // If the key material is hidden (HSM or otherwise) the length is -1\n             if (length >= minKeySize || length < 0) {\n-                logSecureHardwareState(kp);\n+                getSecureHardwareState(kp);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxODg5MA=="}, "originalCommit": {"oid": "a6b75ca9ec7203ab9df3a095d1205b98f13807cf"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzMTAyNg==", "bodyText": "18db49f", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500431026", "createdAt": "2020-10-06T16:22:11Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -1044,7 +1080,7 @@ private KeyPair generateNewRsaKeyPair(@NonNull final Context context,\n \n             // If the key material is hidden (HSM or otherwise) the length is -1\n             if (length >= minKeySize || length < 0) {\n-                logSecureHardwareState(kp);\n+                getSecureHardwareState(kp);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxODg5MA=="}, "originalCommit": {"oid": "a6b75ca9ec7203ab9df3a095d1205b98f13807cf"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzQxNDg2OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNjozMToxMFrOHdQPmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzozMzo0OFrOHdSpmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNjg4OA==", "bodyText": "Can we have more details (comment) on what could cause this?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500436888", "createdAt": "2020-10-06T16:31:10Z", "author": {"login": "rpdome"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -808,6 +808,42 @@ public String decrypt(@NonNull final Cipher cipher,\n         throw clientException;\n     }\n \n+    @Override\n+    public SecureHardwareState getSecureHardwareState() throws ClientException {\n+        final String errCode;\n+        final Exception exception;\n+\n+        final KeyStore.Entry keyEntry;\n+        try {\n+            keyEntry = mKeyStore.getEntry(mKeyAlias, null);\n+            final KeyPair rsaKeyPair = getKeyPairForEntry(keyEntry);\n+            return getSecureHardwareState(rsaKeyPair);\n+        } catch (final KeyStoreException e) {\n+            errCode = KEYSTORE_NOT_INITIALIZED;\n+            exception = e;\n+        } catch (final NoSuchAlgorithmException e) {\n+            errCode = NO_SUCH_ALGORITHM;\n+            exception = e;\n+        } catch (final UnrecoverableEntryException e) {\n+            errCode = INVALID_PROTECTION_PARAMS;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ3NjMxNA==", "bodyText": "fb6577a", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500476314", "createdAt": "2020-10-06T17:33:48Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -808,6 +808,42 @@ public String decrypt(@NonNull final Cipher cipher,\n         throw clientException;\n     }\n \n+    @Override\n+    public SecureHardwareState getSecureHardwareState() throws ClientException {\n+        final String errCode;\n+        final Exception exception;\n+\n+        final KeyStore.Entry keyEntry;\n+        try {\n+            keyEntry = mKeyStore.getEntry(mKeyAlias, null);\n+            final KeyPair rsaKeyPair = getKeyPairForEntry(keyEntry);\n+            return getSecureHardwareState(rsaKeyPair);\n+        } catch (final KeyStoreException e) {\n+            errCode = KEYSTORE_NOT_INITIALIZED;\n+            exception = e;\n+        } catch (final NoSuchAlgorithmException e) {\n+            errCode = NO_SUCH_ALGORITHM;\n+            exception = e;\n+        } catch (final UnrecoverableEntryException e) {\n+            errCode = INVALID_PROTECTION_PARAMS;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNjg4OA=="}, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzU0NDYxOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzowNDoxMVrOHdRhog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoyMDozNVrOHdSJAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1Nzg5MA==", "bodyText": "What is QRY?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500457890", "createdAt": "2020-10-06T17:04:11Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,35 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {\n+        /**\n+         * Return if the underlying private key resides inside secure hardware (e.g., Trusted\n+         * Execution Environment (TEE) or Secure Element (SE)). No mechanism of attestation is\n+         * provided or specified.\n+         */\n+        TRUE_UNATTESTED,\n+\n+        /**\n+         * The the underlying private key is not inside secure hardware.\n+         */\n+        FALSE,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to lack of API support for\n+         * determination.\n+         */\n+        UNKNOWN_DOWNLEVEL,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to an error during keystore\n+         * interrogation.\n+         */\n+        UNKNOWN_QRY_ERR", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MTE5MQ==", "bodyText": "It's query -- @AdamBJohnsonx had same question -- will rename for clarity\n#1069 (comment)", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500461191", "createdAt": "2020-10-06T17:09:39Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,35 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {\n+        /**\n+         * Return if the underlying private key resides inside secure hardware (e.g., Trusted\n+         * Execution Environment (TEE) or Secure Element (SE)). No mechanism of attestation is\n+         * provided or specified.\n+         */\n+        TRUE_UNATTESTED,\n+\n+        /**\n+         * The the underlying private key is not inside secure hardware.\n+         */\n+        FALSE,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to lack of API support for\n+         * determination.\n+         */\n+        UNKNOWN_DOWNLEVEL,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to an error during keystore\n+         * interrogation.\n+         */\n+        UNKNOWN_QRY_ERR", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1Nzg5MA=="}, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2Nzk2OQ==", "bodyText": "910b236", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500467969", "createdAt": "2020-10-06T17:20:35Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,35 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {\n+        /**\n+         * Return if the underlying private key resides inside secure hardware (e.g., Trusted\n+         * Execution Environment (TEE) or Secure Element (SE)). No mechanism of attestation is\n+         * provided or specified.\n+         */\n+        TRUE_UNATTESTED,\n+\n+        /**\n+         * The the underlying private key is not inside secure hardware.\n+         */\n+        FALSE,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to lack of API support for\n+         * determination.\n+         */\n+        UNKNOWN_DOWNLEVEL,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to an error during keystore\n+         * interrogation.\n+         */\n+        UNKNOWN_QRY_ERR", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1Nzg5MA=="}, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzU0NDY4OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzowNDoxMlrOHdRhsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoyMTo0OVrOHdSL5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1NzkwNQ==", "bodyText": "Do we need this?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500457905", "createdAt": "2020-10-06T17:04:12Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -1058,7 +1095,7 @@ private KeyPair generateNewRsaKeyPair(@NonNull final Context context,\n         );\n     }\n \n-    private void logSecureHardwareState(@NonNull final KeyPair kp) {\n+    private SecureHardwareState getSecureHardwareState(@NonNull final KeyPair kp) {\n         String msg;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MTMwMw==", "bodyText": "Can remove", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500461303", "createdAt": "2020-10-06T17:09:50Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -1058,7 +1095,7 @@ private KeyPair generateNewRsaKeyPair(@NonNull final Context context,\n         );\n     }\n \n-    private void logSecureHardwareState(@NonNull final KeyPair kp) {\n+    private SecureHardwareState getSecureHardwareState(@NonNull final KeyPair kp) {\n         String msg;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1NzkwNQ=="}, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2ODcwOQ==", "bodyText": "ad0fd74", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500468709", "createdAt": "2020-10-06T17:21:49Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -1058,7 +1095,7 @@ private KeyPair generateNewRsaKeyPair(@NonNull final Context context,\n         );\n     }\n \n-    private void logSecureHardwareState(@NonNull final KeyPair kp) {\n+    private SecureHardwareState getSecureHardwareState(@NonNull final KeyPair kp) {\n         String msg;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1NzkwNQ=="}, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzU1NDAzOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzowNjo0M1rOHdRnkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoyMDo0M1rOHdSJZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1OTQxMA==", "bodyText": "Can we spare some characters to make this UNKNOWN_QUERY_ERROR, or is this specified elsewhere?  If it is specified elsewhere, can we generate this enumeration based on that data?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500459410", "createdAt": "2020-10-06T17:06:43Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,35 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {\n+        /**\n+         * Return if the underlying private key resides inside secure hardware (e.g., Trusted\n+         * Execution Environment (TEE) or Secure Element (SE)). No mechanism of attestation is\n+         * provided or specified.\n+         */\n+        TRUE_UNATTESTED,\n+\n+        /**\n+         * The the underlying private key is not inside secure hardware.\n+         */\n+        FALSE,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to lack of API support for\n+         * determination.\n+         */\n+        UNKNOWN_DOWNLEVEL,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to an error during keystore\n+         * interrogation.\n+         */\n+        UNKNOWN_QRY_ERR", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MDc3OQ==", "bodyText": "Sure - will rename", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500460779", "createdAt": "2020-10-06T17:08:59Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,35 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {\n+        /**\n+         * Return if the underlying private key resides inside secure hardware (e.g., Trusted\n+         * Execution Environment (TEE) or Secure Element (SE)). No mechanism of attestation is\n+         * provided or specified.\n+         */\n+        TRUE_UNATTESTED,\n+\n+        /**\n+         * The the underlying private key is not inside secure hardware.\n+         */\n+        FALSE,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to lack of API support for\n+         * determination.\n+         */\n+        UNKNOWN_DOWNLEVEL,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to an error during keystore\n+         * interrogation.\n+         */\n+        UNKNOWN_QRY_ERR", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1OTQxMA=="}, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2ODA2OA==", "bodyText": "910b236", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500468068", "createdAt": "2020-10-06T17:20:43Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,35 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {\n+        /**\n+         * Return if the underlying private key resides inside secure hardware (e.g., Trusted\n+         * Execution Environment (TEE) or Secure Element (SE)). No mechanism of attestation is\n+         * provided or specified.\n+         */\n+        TRUE_UNATTESTED,\n+\n+        /**\n+         * The the underlying private key is not inside secure hardware.\n+         */\n+        FALSE,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to lack of API support for\n+         * determination.\n+         */\n+        UNKNOWN_DOWNLEVEL,\n+\n+        /**\n+         * It is unknown where the underlying key resides, due to an error during keystore\n+         * interrogation.\n+         */\n+        UNKNOWN_QRY_ERR", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1OTQxMA=="}, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzU2NjU2OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzowOTo1OFrOHdRvTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoyMTozMlrOHdSLKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MTM4OA==", "bodyText": "Also, since this is interface-level, do we want to reserve a keyword for TRUE_ATTESTED or something?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500461388", "createdAt": "2020-10-06T17:09:58Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,35 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2NjU1OA==", "bodyText": "It just makes things easier if we retain interface compatibility when launching a new feature.  So it's worth taking a second here and making sure that we're providing the whole space of possibilities for this value even if they're not available yet.  They should pick up that documentation though.  Unfortunate that we can't use @experimental, thought that's not strong enough.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500466558", "createdAt": "2020-10-06T17:18:17Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,35 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MTM4OA=="}, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2ODUyMQ==", "bodyText": "23bec71", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500468521", "createdAt": "2020-10-06T17:21:32Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/IDevicePopManager.java", "diffHunk": "@@ -146,6 +146,35 @@ public String toString() {\n         }\n     }\n \n+    /**\n+     * Information about the backing of the underlying keystore.\n+     */\n+    enum SecureHardwareState {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MTM4OA=="}, "originalCommit": {"oid": "18db49fcb0166da6802345ce53ee7cb1679fd781"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzYyNDE2OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzoyNDo1NVrOHdSTWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNzo1MDozMFrOHdTQFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ3MDYxNw==", "bodyText": "This is a really broad catch.  Can we narrow this at all, or, if we cannot, can we at least log some exception information here so that we can eventually narrow this down?  And if we have the ability to stuff back some telemetry, the class of the exception that's thrown here might be very interesting.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500470617", "createdAt": "2020-10-06T17:24:55Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -1069,15 +1104,19 @@ private void logSecureHardwareState(@NonNull final KeyPair kp) {\n                 );\n                 final KeyInfo info = factory.getKeySpec(privateKey, KeyInfo.class);\n                 final boolean isInsideSecureHardware = info.isInsideSecureHardware();\n-                msg = \"SecretKey is secure hardware backed? \" + isInsideSecureHardware;\n+                Logger.info(TAG, \"SecretKey is secure hardware backed? \" + isInsideSecureHardware);\n+                return isInsideSecureHardware\n+                        ? SecureHardwareState.TRUE_UNATTESTED\n+                        : SecureHardwareState.FALSE;\n             } catch (final Exception e) {\n-                msg = \"Failed to query secure hardware state.\";\n+                Logger.info(TAG, \"Failed to query secure hardware state.\");\n+                return SecureHardwareState.UNKNOWN_QUERY_ERROR;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad0fd74e0745a105a3cf05b6d7dcba8bbf37f79c"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ4NjE2Ng==", "bodyText": "Added better logging, reduced the scope of the catch block\n8ae660a", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1069#discussion_r500486166", "createdAt": "2020-10-06T17:50:30Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/platform/DevicePopManager.java", "diffHunk": "@@ -1069,15 +1104,19 @@ private void logSecureHardwareState(@NonNull final KeyPair kp) {\n                 );\n                 final KeyInfo info = factory.getKeySpec(privateKey, KeyInfo.class);\n                 final boolean isInsideSecureHardware = info.isInsideSecureHardware();\n-                msg = \"SecretKey is secure hardware backed? \" + isInsideSecureHardware;\n+                Logger.info(TAG, \"SecretKey is secure hardware backed? \" + isInsideSecureHardware);\n+                return isInsideSecureHardware\n+                        ? SecureHardwareState.TRUE_UNATTESTED\n+                        : SecureHardwareState.FALSE;\n             } catch (final Exception e) {\n-                msg = \"Failed to query secure hardware state.\";\n+                Logger.info(TAG, \"Failed to query secure hardware state.\");\n+                return SecureHardwareState.UNKNOWN_QUERY_ERROR;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ3MDYxNw=="}, "originalCommit": {"oid": "ad0fd74e0745a105a3cf05b6d7dcba8bbf37f79c"}, "originalPosition": 76}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1990, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}