{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0MDc5NDYx", "number": 933, "title": "Adds new tests for MsalCppOAuth2TokenCache", "bodyText": "Adds new test, API surface to caching components for CPP scenarios\nSummary of changes\n\nAdds MsalCppOAuth2TokenCacheTest\nAdds new removeAccount overload to OAuth2TokenCache\n\nAPI accepts a varargs array of CredentialType to delete upon removal of the AccountRecord\n\n\nMakes behavior of MsalCppOAuth2TokenCache#remove match the Credential deletion behavior specified here.\n\nDeletes: access tokens, id tokens, account\nPreserves: the refresh token\n\n\n\nPoints to clarify before merge\n\nAndroid MSAL has previously defined the presence of an Account (for getAccounts()'s purposes) as: an AccountRecord with a matching RefreshTokenRecord for a given client_id\n\nThe CPP APIs are more free form: getAllAccounts() returns whatever AccountRecords are in the cache, irrespective of whether we have an RT for this client or not\nremoveAccount() has different behavior: you can only delete an AccountRecord for which we have an RT.... should this be the case?\n\nThis could indiscriminately delete the account and its associated AT, ID tokens\nIt's possible, in the current implementation for an AccountRecord to get \"stuck\" -- if you save an AccountRecord but don't supply an RT for it, then it's as if we don't have it. getAccount() will still return it though....\n\n\n\n\n\n\nBrian's thoughts....\nI am thinking that removeAccount() should also call forceRemove() to forcibly expel the AccountRecord from the cache, if it exists. This is probably the closest behavior to what CPP expects....\n\nSummary of offline decision\nFor now, the implementation will assume a single stack. Force delete any account that was requested for removal even if no RTs exist for it; under normal single-stack conditions this is fine.", "createdAt": "2020-06-14T01:09:46Z", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933", "merged": true, "mergeCommit": {"oid": "252a11ae6e2b195cf13123f7073f5fafa1132060"}, "closed": true, "closedAt": "2020-06-17T20:44:47Z", "author": {"login": "iambmelt"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrBez1gH2gAyNDM0MDc5NDYxOmMyZGVkYzQ3ODY4NjJlYTQ4ZjY3YmYwMGY4NWMwYzFlM2Q5ZWMxMjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsPugBgH2gAyNDM0MDc5NDYxOmNiMmZmMmQwYTkwMmIyNjI2YmE3YzY0NWNkZjUxMTQxOGFhYmU5ODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/c2dedc4786862ea48f67bf00f85c0c1e3d9ec127", "committedDate": "2020-06-14T01:08:23Z", "message": "WIP new tests for CPP cache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTc5OTUz", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#pullrequestreview-430179953", "createdAt": "2020-06-14T01:10:08Z", "commit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQwMToxMDowOFrOGjaKJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQwMToxMDowOFrOGjaKJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc4MTkyNQ==", "bodyText": "\ud83d\udc40", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r439781925", "createdAt": "2020-06-14T01:10:08Z", "author": {"login": "iambmelt"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalCppOAuth2TokenCacheTest.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common;\n+\n+import android.content.Context;\n+\n+import androidx.test.InstrumentationRegistry;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import com.microsoft.identity.common.adal.internal.AndroidSecretKeyEnabledHelper;\n+import com.microsoft.identity.common.exception.ClientException;\n+import com.microsoft.identity.common.internal.authscheme.BearerAuthenticationSchemeInternal;\n+import com.microsoft.identity.common.internal.cache.AccountDeletionRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.cache.MsalCppOAuth2TokenCache;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.dto.Credential;\n+import com.microsoft.identity.common.internal.dto.CredentialType;\n+import com.microsoft.identity.common.internal.providers.microsoft.MicrosoftAccount;\n+\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.MicrosoftStsAccountCredentialAdapterTest.MOCK_ID_TOKEN_WITH_CLAIMS;\n+import static com.microsoft.identity.common.MsalOAuth2TokenCacheTest.AccountCredentialTestBundle;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CACHED_AT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CLIENT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.ENVIRONMENT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.EXPIRES_ON;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.HOME_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.LOCAL_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.REALM;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.SECRET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.TARGET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.USERNAME;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class MsalCppOAuth2TokenCacheTest extends AndroidSecretKeyEnabledHelper {\n+\n+    private MsalCppOAuth2TokenCache mCppCache;\n+\n+    // Test Accounts/Credentials\n+    private AccountCredentialTestBundle mTestBundle;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+\n+        // Context and related init\n+        final Context context = InstrumentationRegistry.getTargetContext();\n+        mCppCache = MsalCppOAuth2TokenCache.create(context);\n+\n+        // Credentials for testing\n+        mTestBundle = new AccountCredentialTestBundle(\n+                MicrosoftAccount.AUTHORITY_TYPE_V1_V2,\n+                LOCAL_ACCOUNT_ID,\n+                USERNAME,\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                REALM,\n+                TARGET,\n+                CACHED_AT,\n+                EXPIRES_ON,\n+                SECRET,\n+                CLIENT_ID,\n+                SECRET,\n+                MOCK_ID_TOKEN_WITH_CLAIMS,\n+                null,\n+                CredentialType.V1IdToken\n+        );\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        mCppCache.clearCache();\n+    }\n+\n+    @Test\n+    public void saveAndGetAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+\n+        // Save the the cache\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        // Restore it\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+\n+        Assert.assertNotNull(restoredAccount);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAccountNullTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertNull(restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAllAccountsTest() {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        final AccountRecord restoredAccount = accounts.get(0);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+\n+        // TODO this API makes no statement about the immutability of the List returned", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "originalPosition": 142}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTc5OTU2", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#pullrequestreview-430179956", "createdAt": "2020-06-14T01:10:12Z", "commit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQwMToxMDoxMlrOGjaKJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQwMToxMDoxMlrOGjaKJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc4MTkyNw==", "bodyText": "\ud83d\udc40", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r439781927", "createdAt": "2020-06-14T01:10:12Z", "author": {"login": "iambmelt"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalCppOAuth2TokenCacheTest.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common;\n+\n+import android.content.Context;\n+\n+import androidx.test.InstrumentationRegistry;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import com.microsoft.identity.common.adal.internal.AndroidSecretKeyEnabledHelper;\n+import com.microsoft.identity.common.exception.ClientException;\n+import com.microsoft.identity.common.internal.authscheme.BearerAuthenticationSchemeInternal;\n+import com.microsoft.identity.common.internal.cache.AccountDeletionRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.cache.MsalCppOAuth2TokenCache;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.dto.Credential;\n+import com.microsoft.identity.common.internal.dto.CredentialType;\n+import com.microsoft.identity.common.internal.providers.microsoft.MicrosoftAccount;\n+\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.MicrosoftStsAccountCredentialAdapterTest.MOCK_ID_TOKEN_WITH_CLAIMS;\n+import static com.microsoft.identity.common.MsalOAuth2TokenCacheTest.AccountCredentialTestBundle;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CACHED_AT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CLIENT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.ENVIRONMENT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.EXPIRES_ON;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.HOME_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.LOCAL_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.REALM;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.SECRET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.TARGET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.USERNAME;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class MsalCppOAuth2TokenCacheTest extends AndroidSecretKeyEnabledHelper {\n+\n+    private MsalCppOAuth2TokenCache mCppCache;\n+\n+    // Test Accounts/Credentials\n+    private AccountCredentialTestBundle mTestBundle;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+\n+        // Context and related init\n+        final Context context = InstrumentationRegistry.getTargetContext();\n+        mCppCache = MsalCppOAuth2TokenCache.create(context);\n+\n+        // Credentials for testing\n+        mTestBundle = new AccountCredentialTestBundle(\n+                MicrosoftAccount.AUTHORITY_TYPE_V1_V2,\n+                LOCAL_ACCOUNT_ID,\n+                USERNAME,\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                REALM,\n+                TARGET,\n+                CACHED_AT,\n+                EXPIRES_ON,\n+                SECRET,\n+                CLIENT_ID,\n+                SECRET,\n+                MOCK_ID_TOKEN_WITH_CLAIMS,\n+                null,\n+                CredentialType.V1IdToken\n+        );\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        mCppCache.clearCache();\n+    }\n+\n+    @Test\n+    public void saveAndGetAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+\n+        // Save the the cache\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        // Restore it\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+\n+        Assert.assertNotNull(restoredAccount);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAccountNullTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertNull(restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAllAccountsTest() {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        final AccountRecord restoredAccount = accounts.get(0);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+\n+        // TODO this API makes no statement about the immutability of the List returned\n+        // TODO results should not be mutable\n+    }\n+\n+    @Test\n+    public void getAllAccountsEmptyTest() {\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        Assert.assertTrue(accounts.isEmpty());\n+    }\n+\n+    @Ignore // Ignore this test until API behavior is decided\n+    @Test\n+    public void removeAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+        final AccountDeletionRecord deletionRecord = mCppCache.removeAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertEquals(generatedAccount, deletionRecord.get(0));\n+\n+        // TODO There's confusing behavior here...", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "originalPosition": 164}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwOTU2NDA0", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#pullrequestreview-430956404", "createdAt": "2020-06-15T20:08:27Z", "commit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMDowODoyN1rOGkA-Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMDo1MTowNFrOGkCR7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQxNzg5MA==", "bodyText": "What happens if you write to it?  Should we have standard tests against our interface packages that all implementations must pass?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r440417890", "createdAt": "2020-06-15T20:08:27Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalCppOAuth2TokenCacheTest.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common;\n+\n+import android.content.Context;\n+\n+import androidx.test.InstrumentationRegistry;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import com.microsoft.identity.common.adal.internal.AndroidSecretKeyEnabledHelper;\n+import com.microsoft.identity.common.exception.ClientException;\n+import com.microsoft.identity.common.internal.authscheme.BearerAuthenticationSchemeInternal;\n+import com.microsoft.identity.common.internal.cache.AccountDeletionRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.cache.MsalCppOAuth2TokenCache;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.dto.Credential;\n+import com.microsoft.identity.common.internal.dto.CredentialType;\n+import com.microsoft.identity.common.internal.providers.microsoft.MicrosoftAccount;\n+\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.MicrosoftStsAccountCredentialAdapterTest.MOCK_ID_TOKEN_WITH_CLAIMS;\n+import static com.microsoft.identity.common.MsalOAuth2TokenCacheTest.AccountCredentialTestBundle;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CACHED_AT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CLIENT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.ENVIRONMENT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.EXPIRES_ON;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.HOME_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.LOCAL_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.REALM;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.SECRET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.TARGET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.USERNAME;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class MsalCppOAuth2TokenCacheTest extends AndroidSecretKeyEnabledHelper {\n+\n+    private MsalCppOAuth2TokenCache mCppCache;\n+\n+    // Test Accounts/Credentials\n+    private AccountCredentialTestBundle mTestBundle;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+\n+        // Context and related init\n+        final Context context = InstrumentationRegistry.getTargetContext();\n+        mCppCache = MsalCppOAuth2TokenCache.create(context);\n+\n+        // Credentials for testing\n+        mTestBundle = new AccountCredentialTestBundle(\n+                MicrosoftAccount.AUTHORITY_TYPE_V1_V2,\n+                LOCAL_ACCOUNT_ID,\n+                USERNAME,\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                REALM,\n+                TARGET,\n+                CACHED_AT,\n+                EXPIRES_ON,\n+                SECRET,\n+                CLIENT_ID,\n+                SECRET,\n+                MOCK_ID_TOKEN_WITH_CLAIMS,\n+                null,\n+                CredentialType.V1IdToken\n+        );\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        mCppCache.clearCache();\n+    }\n+\n+    @Test\n+    public void saveAndGetAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+\n+        // Save the the cache\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        // Restore it\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+\n+        Assert.assertNotNull(restoredAccount);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAccountNullTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertNull(restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAllAccountsTest() {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        final AccountRecord restoredAccount = accounts.get(0);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+\n+        // TODO this API makes no statement about the immutability of the List returned", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc4MTkyNQ=="}, "originalCommit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "originalPosition": 142}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQyMTEyMA==", "bodyText": "Should this be the same object reference?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r440421120", "createdAt": "2020-06-15T20:14:40Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalCppOAuth2TokenCacheTest.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common;\n+\n+import android.content.Context;\n+\n+import androidx.test.InstrumentationRegistry;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import com.microsoft.identity.common.adal.internal.AndroidSecretKeyEnabledHelper;\n+import com.microsoft.identity.common.exception.ClientException;\n+import com.microsoft.identity.common.internal.authscheme.BearerAuthenticationSchemeInternal;\n+import com.microsoft.identity.common.internal.cache.AccountDeletionRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.cache.MsalCppOAuth2TokenCache;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.dto.Credential;\n+import com.microsoft.identity.common.internal.dto.CredentialType;\n+import com.microsoft.identity.common.internal.providers.microsoft.MicrosoftAccount;\n+\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.MicrosoftStsAccountCredentialAdapterTest.MOCK_ID_TOKEN_WITH_CLAIMS;\n+import static com.microsoft.identity.common.MsalOAuth2TokenCacheTest.AccountCredentialTestBundle;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CACHED_AT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CLIENT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.ENVIRONMENT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.EXPIRES_ON;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.HOME_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.LOCAL_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.REALM;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.SECRET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.TARGET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.USERNAME;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class MsalCppOAuth2TokenCacheTest extends AndroidSecretKeyEnabledHelper {\n+\n+    private MsalCppOAuth2TokenCache mCppCache;\n+\n+    // Test Accounts/Credentials\n+    private AccountCredentialTestBundle mTestBundle;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+\n+        // Context and related init\n+        final Context context = InstrumentationRegistry.getTargetContext();\n+        mCppCache = MsalCppOAuth2TokenCache.create(context);\n+\n+        // Credentials for testing\n+        mTestBundle = new AccountCredentialTestBundle(\n+                MicrosoftAccount.AUTHORITY_TYPE_V1_V2,\n+                LOCAL_ACCOUNT_ID,\n+                USERNAME,\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                REALM,\n+                TARGET,\n+                CACHED_AT,\n+                EXPIRES_ON,\n+                SECRET,\n+                CLIENT_ID,\n+                SECRET,\n+                MOCK_ID_TOKEN_WITH_CLAIMS,\n+                null,\n+                CredentialType.V1IdToken\n+        );\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        mCppCache.clearCache();\n+    }\n+\n+    @Test\n+    public void saveAndGetAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+\n+        // Save the the cache\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        // Restore it\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+\n+        Assert.assertNotNull(restoredAccount);\n+        Assert.assertEquals(generatedAccount, restoredAccount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQyMjM1MA==", "bodyText": "What's the use case for removeAccount?  It seems like we either need to remove it from all clients (because, say, this is called when the user is being removed from their home tenant) or we need to be able to specify the client we're removing the account from (because, say, the user is being removed from an application).  Either way, the use case should tell you which way to go.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r440422350", "createdAt": "2020-06-15T20:17:01Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalCppOAuth2TokenCacheTest.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common;\n+\n+import android.content.Context;\n+\n+import androidx.test.InstrumentationRegistry;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import com.microsoft.identity.common.adal.internal.AndroidSecretKeyEnabledHelper;\n+import com.microsoft.identity.common.exception.ClientException;\n+import com.microsoft.identity.common.internal.authscheme.BearerAuthenticationSchemeInternal;\n+import com.microsoft.identity.common.internal.cache.AccountDeletionRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.cache.MsalCppOAuth2TokenCache;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.dto.Credential;\n+import com.microsoft.identity.common.internal.dto.CredentialType;\n+import com.microsoft.identity.common.internal.providers.microsoft.MicrosoftAccount;\n+\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.MicrosoftStsAccountCredentialAdapterTest.MOCK_ID_TOKEN_WITH_CLAIMS;\n+import static com.microsoft.identity.common.MsalOAuth2TokenCacheTest.AccountCredentialTestBundle;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CACHED_AT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CLIENT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.ENVIRONMENT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.EXPIRES_ON;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.HOME_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.LOCAL_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.REALM;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.SECRET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.TARGET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.USERNAME;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class MsalCppOAuth2TokenCacheTest extends AndroidSecretKeyEnabledHelper {\n+\n+    private MsalCppOAuth2TokenCache mCppCache;\n+\n+    // Test Accounts/Credentials\n+    private AccountCredentialTestBundle mTestBundle;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+\n+        // Context and related init\n+        final Context context = InstrumentationRegistry.getTargetContext();\n+        mCppCache = MsalCppOAuth2TokenCache.create(context);\n+\n+        // Credentials for testing\n+        mTestBundle = new AccountCredentialTestBundle(\n+                MicrosoftAccount.AUTHORITY_TYPE_V1_V2,\n+                LOCAL_ACCOUNT_ID,\n+                USERNAME,\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                REALM,\n+                TARGET,\n+                CACHED_AT,\n+                EXPIRES_ON,\n+                SECRET,\n+                CLIENT_ID,\n+                SECRET,\n+                MOCK_ID_TOKEN_WITH_CLAIMS,\n+                null,\n+                CredentialType.V1IdToken\n+        );\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        mCppCache.clearCache();\n+    }\n+\n+    @Test\n+    public void saveAndGetAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+\n+        // Save the the cache\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        // Restore it\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+\n+        Assert.assertNotNull(restoredAccount);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAccountNullTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertNull(restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAllAccountsTest() {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        final AccountRecord restoredAccount = accounts.get(0);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+\n+        // TODO this API makes no statement about the immutability of the List returned\n+        // TODO results should not be mutable\n+    }\n+\n+    @Test\n+    public void getAllAccountsEmptyTest() {\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        Assert.assertTrue(accounts.isEmpty());\n+    }\n+\n+    @Ignore // Ignore this test until API behavior is decided\n+    @Test\n+    public void removeAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+        final AccountDeletionRecord deletionRecord = mCppCache.removeAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertEquals(generatedAccount, deletionRecord.get(0));\n+\n+        // TODO There's confusing behavior here...", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc4MTkyNw=="}, "originalCommit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "originalPosition": 164}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQyMjU1MQ==", "bodyText": "Should we go on and check that we don't get it from the cache?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r440422551", "createdAt": "2020-06-15T20:17:27Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalCppOAuth2TokenCacheTest.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common;\n+\n+import android.content.Context;\n+\n+import androidx.test.InstrumentationRegistry;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import com.microsoft.identity.common.adal.internal.AndroidSecretKeyEnabledHelper;\n+import com.microsoft.identity.common.exception.ClientException;\n+import com.microsoft.identity.common.internal.authscheme.BearerAuthenticationSchemeInternal;\n+import com.microsoft.identity.common.internal.cache.AccountDeletionRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.cache.MsalCppOAuth2TokenCache;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.dto.Credential;\n+import com.microsoft.identity.common.internal.dto.CredentialType;\n+import com.microsoft.identity.common.internal.providers.microsoft.MicrosoftAccount;\n+\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.MicrosoftStsAccountCredentialAdapterTest.MOCK_ID_TOKEN_WITH_CLAIMS;\n+import static com.microsoft.identity.common.MsalOAuth2TokenCacheTest.AccountCredentialTestBundle;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CACHED_AT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CLIENT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.ENVIRONMENT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.EXPIRES_ON;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.HOME_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.LOCAL_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.REALM;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.SECRET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.TARGET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.USERNAME;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class MsalCppOAuth2TokenCacheTest extends AndroidSecretKeyEnabledHelper {\n+\n+    private MsalCppOAuth2TokenCache mCppCache;\n+\n+    // Test Accounts/Credentials\n+    private AccountCredentialTestBundle mTestBundle;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+\n+        // Context and related init\n+        final Context context = InstrumentationRegistry.getTargetContext();\n+        mCppCache = MsalCppOAuth2TokenCache.create(context);\n+\n+        // Credentials for testing\n+        mTestBundle = new AccountCredentialTestBundle(\n+                MicrosoftAccount.AUTHORITY_TYPE_V1_V2,\n+                LOCAL_ACCOUNT_ID,\n+                USERNAME,\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                REALM,\n+                TARGET,\n+                CACHED_AT,\n+                EXPIRES_ON,\n+                SECRET,\n+                CLIENT_ID,\n+                SECRET,\n+                MOCK_ID_TOKEN_WITH_CLAIMS,\n+                null,\n+                CredentialType.V1IdToken\n+        );\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        mCppCache.clearCache();\n+    }\n+\n+    @Test\n+    public void saveAndGetAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+\n+        // Save the the cache\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        // Restore it\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+\n+        Assert.assertNotNull(restoredAccount);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAccountNullTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertNull(restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAllAccountsTest() {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        final AccountRecord restoredAccount = accounts.get(0);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+\n+        // TODO this API makes no statement about the immutability of the List returned\n+        // TODO results should not be mutable\n+    }\n+\n+    @Test\n+    public void getAllAccountsEmptyTest() {\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        Assert.assertTrue(accounts.isEmpty());\n+    }\n+\n+    @Ignore // Ignore this test until API behavior is decided\n+    @Test\n+    public void removeAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+        final AccountDeletionRecord deletionRecord = mCppCache.removeAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertEquals(generatedAccount, deletionRecord.get(0));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "originalPosition": 163}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQyMjkzNg==", "bodyText": "Do we need this test?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r440422936", "createdAt": "2020-06-15T20:18:09Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalCppOAuth2TokenCacheTest.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common;\n+\n+import android.content.Context;\n+\n+import androidx.test.InstrumentationRegistry;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import com.microsoft.identity.common.adal.internal.AndroidSecretKeyEnabledHelper;\n+import com.microsoft.identity.common.exception.ClientException;\n+import com.microsoft.identity.common.internal.authscheme.BearerAuthenticationSchemeInternal;\n+import com.microsoft.identity.common.internal.cache.AccountDeletionRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.cache.MsalCppOAuth2TokenCache;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.dto.Credential;\n+import com.microsoft.identity.common.internal.dto.CredentialType;\n+import com.microsoft.identity.common.internal.providers.microsoft.MicrosoftAccount;\n+\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.MicrosoftStsAccountCredentialAdapterTest.MOCK_ID_TOKEN_WITH_CLAIMS;\n+import static com.microsoft.identity.common.MsalOAuth2TokenCacheTest.AccountCredentialTestBundle;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CACHED_AT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CLIENT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.ENVIRONMENT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.EXPIRES_ON;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.HOME_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.LOCAL_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.REALM;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.SECRET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.TARGET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.USERNAME;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class MsalCppOAuth2TokenCacheTest extends AndroidSecretKeyEnabledHelper {\n+\n+    private MsalCppOAuth2TokenCache mCppCache;\n+\n+    // Test Accounts/Credentials\n+    private AccountCredentialTestBundle mTestBundle;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+\n+        // Context and related init\n+        final Context context = InstrumentationRegistry.getTargetContext();\n+        mCppCache = MsalCppOAuth2TokenCache.create(context);\n+\n+        // Credentials for testing\n+        mTestBundle = new AccountCredentialTestBundle(\n+                MicrosoftAccount.AUTHORITY_TYPE_V1_V2,\n+                LOCAL_ACCOUNT_ID,\n+                USERNAME,\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                REALM,\n+                TARGET,\n+                CACHED_AT,\n+                EXPIRES_ON,\n+                SECRET,\n+                CLIENT_ID,\n+                SECRET,\n+                MOCK_ID_TOKEN_WITH_CLAIMS,\n+                null,\n+                CredentialType.V1IdToken\n+        );\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        mCppCache.clearCache();\n+    }\n+\n+    @Test\n+    public void saveAndGetAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+\n+        // Save the the cache\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        // Restore it\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+\n+        Assert.assertNotNull(restoredAccount);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAccountNullTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertNull(restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAllAccountsTest() {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        final AccountRecord restoredAccount = accounts.get(0);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+\n+        // TODO this API makes no statement about the immutability of the List returned\n+        // TODO results should not be mutable\n+    }\n+\n+    @Test\n+    public void getAllAccountsEmptyTest() {\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        Assert.assertTrue(accounts.isEmpty());\n+    }\n+\n+    @Ignore // Ignore this test until API behavior is decided\n+    @Test\n+    public void removeAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+        final AccountDeletionRecord deletionRecord = mCppCache.removeAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertEquals(generatedAccount, deletionRecord.get(0));\n+\n+        // TODO There's confusing behavior here...\n+        // In MSAL we have defined an account as \"existing\" if we have an RT for it\n+        // This API doesn't make this constraint obvious. Should we delete any matching account?\n+        // In a double-client stack situation, this could delete an account from another app (TFL/TFW)\n+    }\n+\n+    @Test\n+    public void removeNonexistentAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        final AccountDeletionRecord deletionRecord = mCppCache.removeAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertTrue(deletionRecord.isEmpty());\n+    }\n+\n+    @Test\n+    public void saveAccountRecordIncompleteTest() {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "originalPosition": 183}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQyNjk0MA==", "bodyText": "It looks like it delegates here: \n  \n    \n      microsoft-authentication-library-common-for-android/common/src/main/java/com/microsoft/identity/common/internal/cache/MsalOAuth2TokenCache.java\n    \n    \n         Line 1039\n      in\n      c2dedc4\n    \n    \n    \n    \n\n        \n          \n           return Collections.unmodifiableList(accountsForThisApp); \n        \n    \n  \n\n which is an unmodifiable wrapper.\nThe other implementation is SharedPreferencesAccountCredentialCache, which returns a safe-copy.  \n  \n    \n      microsoft-authentication-library-common-for-android/common/src/main/java/com/microsoft/identity/common/internal/cache/SharedPreferencesAccountCredentialCache.java\n    \n    \n         Line 223\n      in\n      c2dedc4\n    \n    \n    \n    \n\n        \n          \n           public synchronized List<AccountRecord> getAccounts() { \n        \n    \n  \n\n We should pick one strategy.  And document it.\nAnd, in relation to my other comment, do such things need to return a list?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r440426940", "createdAt": "2020-06-15T20:26:28Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalCppOAuth2TokenCacheTest.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common;\n+\n+import android.content.Context;\n+\n+import androidx.test.InstrumentationRegistry;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import com.microsoft.identity.common.adal.internal.AndroidSecretKeyEnabledHelper;\n+import com.microsoft.identity.common.exception.ClientException;\n+import com.microsoft.identity.common.internal.authscheme.BearerAuthenticationSchemeInternal;\n+import com.microsoft.identity.common.internal.cache.AccountDeletionRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.cache.MsalCppOAuth2TokenCache;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.dto.Credential;\n+import com.microsoft.identity.common.internal.dto.CredentialType;\n+import com.microsoft.identity.common.internal.providers.microsoft.MicrosoftAccount;\n+\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.MicrosoftStsAccountCredentialAdapterTest.MOCK_ID_TOKEN_WITH_CLAIMS;\n+import static com.microsoft.identity.common.MsalOAuth2TokenCacheTest.AccountCredentialTestBundle;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CACHED_AT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CLIENT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.ENVIRONMENT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.EXPIRES_ON;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.HOME_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.LOCAL_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.REALM;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.SECRET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.TARGET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.USERNAME;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class MsalCppOAuth2TokenCacheTest extends AndroidSecretKeyEnabledHelper {\n+\n+    private MsalCppOAuth2TokenCache mCppCache;\n+\n+    // Test Accounts/Credentials\n+    private AccountCredentialTestBundle mTestBundle;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+\n+        // Context and related init\n+        final Context context = InstrumentationRegistry.getTargetContext();\n+        mCppCache = MsalCppOAuth2TokenCache.create(context);\n+\n+        // Credentials for testing\n+        mTestBundle = new AccountCredentialTestBundle(\n+                MicrosoftAccount.AUTHORITY_TYPE_V1_V2,\n+                LOCAL_ACCOUNT_ID,\n+                USERNAME,\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                REALM,\n+                TARGET,\n+                CACHED_AT,\n+                EXPIRES_ON,\n+                SECRET,\n+                CLIENT_ID,\n+                SECRET,\n+                MOCK_ID_TOKEN_WITH_CLAIMS,\n+                null,\n+                CredentialType.V1IdToken\n+        );\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        mCppCache.clearCache();\n+    }\n+\n+    @Test\n+    public void saveAndGetAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+\n+        // Save the the cache\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        // Restore it\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+\n+        Assert.assertNotNull(restoredAccount);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAccountNullTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertNull(restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAllAccountsTest() {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        final AccountRecord restoredAccount = accounts.get(0);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+\n+        // TODO this API makes no statement about the immutability of the List returned", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc4MTkyNQ=="}, "originalCommit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "originalPosition": 142}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQzOTI3Ng==", "bodyText": "Since we're adding this API, do we need to return a list?  Would it be sufficient just to return an Iterator, since the contains method on List is going to have to search it anyway?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r440439276", "createdAt": "2020-06-15T20:51:04Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/MsalCppOAuth2TokenCache.java", "diffHunk": "@@ -132,10 +134,24 @@ public synchronized void saveAccountRecord(@NonNull AccountRecord accountRecord)\n      * API to clear all cache.\n      * Note: This method is intended to be only used for testing purposes.\n      */\n+    @VisibleForTesting(otherwise = VisibleForTesting.NONE)\n     public synchronized void clearCache() {\n         getAccountCredentialCache().clearAll();\n     }\n \n+    /**\n+     * API to inspect cache contents.\n+     * Note: This method is intended to be only used for testing purposes.\n+     *\n+     * @return A immutable List of Credentials contained in this cache.\n+     */\n+    @VisibleForTesting(otherwise = VisibleForTesting.NONE)\n+    public synchronized List<Credential> getCredentials() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2dedc4786862ea48f67bf00f85c0c1e3d9ec127"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e0f72cc380013388b9f1b5004ae3e1d2b0f6186", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/5e0f72cc380013388b9f1b5004ae3e1d2b0f6186", "committedDate": "2020-06-15T21:02:02Z", "message": "Merge branch 'dev' into iambmelt/cpp-cache-tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f73851fc9205dd3e6ee3aaeba1dde36789f3ddf5", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f73851fc9205dd3e6ee3aaeba1dde36789f3ddf5", "committedDate": "2020-06-15T21:51:31Z", "message": "Declaring params final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5b1b2091b7f32bdd877f02ea69f88f7dcd613d8", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d5b1b2091b7f32bdd877f02ea69f88f7dcd613d8", "committedDate": "2020-06-15T22:27:38Z", "message": "Result list becomes unmodifiable, expanding ignored test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d6629a7641d8a3328772947dbdaeb2de68b074e", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/3d6629a7641d8a3328772947dbdaeb2de68b074e", "committedDate": "2020-06-15T22:29:43Z", "message": "Make a statement on immutability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f554281d073e1ef36db626afb77dc122caf7958", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/3f554281d073e1ef36db626afb77dc122caf7958", "committedDate": "2020-06-15T23:48:12Z", "message": "Refactoring for code reuse with CPP, adds the ability to control which\ncredentials are cleaned up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c756796e7ad4099d1ce0ad05ca9160d7c2de516", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/6c756796e7ad4099d1ce0ad05ca9160d7c2de516", "committedDate": "2020-06-15T23:59:17Z", "message": "Oops. Missed committing two files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b373f5581f3755a015592bcb00d9abff928c5787", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/b373f5581f3755a015592bcb00d9abff928c5787", "committedDate": "2020-06-16T00:00:42Z", "message": "Cleaning up stray newline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5e06a07ba467e86ea0e97ab4a8d1351bfa20ac3", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d5e06a07ba467e86ea0e97ab4a8d1351bfa20ac3", "committedDate": "2020-06-16T00:09:23Z", "message": "Adding negative test for cache result modification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7f386af8c452134c74609a5e7c0b8e47a2aa539", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f7f386af8c452134c74609a5e7c0b8e47a2aa539", "committedDate": "2020-06-16T00:59:09Z", "message": "Adds new forceRemoveAccount function + additional tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b9e82c94eeb126e724548da8a293bb635a7935f", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/9b9e82c94eeb126e724548da8a293bb635a7935f", "committedDate": "2020-06-16T02:16:46Z", "message": "Removing TODO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fad7a3781181c31b89aaecba7db6e4b59bf1924", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/9fad7a3781181c31b89aaecba7db6e4b59bf1924", "committedDate": "2020-06-16T23:37:34Z", "message": "Force removing accounts even if no RT is present"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "972c5836b42fe61c4a86a805a3f699c216602f75", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/972c5836b42fe61c4a86a805a3f699c216602f75", "committedDate": "2020-06-16T23:42:23Z", "message": "Merge branch 'dev' into iambmelt/cpp-cache-tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTY5NDA1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#pullrequestreview-432569405", "createdAt": "2020-06-17T16:25:59Z", "commit": {"oid": "972c5836b42fe61c4a86a805a3f699c216602f75"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjoyNTo1OVrOGlNhog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjoyNTo1OVrOGlNhog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY3MjA5OA==", "bodyText": "Let's also add an assert statement for the size of the list", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r441672098", "createdAt": "2020-06-17T16:25:59Z", "author": {"login": "shahzaibj"}, "path": "common/src/androidTest/java/com/microsoft/identity/common/MsalCppOAuth2TokenCacheTest.java", "diffHunk": "@@ -0,0 +1,316 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common;\n+\n+import android.content.Context;\n+\n+import androidx.test.InstrumentationRegistry;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import com.microsoft.identity.common.adal.internal.AndroidSecretKeyEnabledHelper;\n+import com.microsoft.identity.common.exception.ClientException;\n+import com.microsoft.identity.common.internal.authscheme.BearerAuthenticationSchemeInternal;\n+import com.microsoft.identity.common.internal.cache.AccountDeletionRecord;\n+import com.microsoft.identity.common.internal.cache.ICacheRecord;\n+import com.microsoft.identity.common.internal.cache.MsalCppOAuth2TokenCache;\n+import com.microsoft.identity.common.internal.dto.AccountRecord;\n+import com.microsoft.identity.common.internal.dto.Credential;\n+import com.microsoft.identity.common.internal.dto.CredentialType;\n+import com.microsoft.identity.common.internal.providers.microsoft.MicrosoftAccount;\n+\n+import org.junit.After;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.util.List;\n+\n+import static com.microsoft.identity.common.MicrosoftStsAccountCredentialAdapterTest.MOCK_ID_TOKEN_WITH_CLAIMS;\n+import static com.microsoft.identity.common.MsalOAuth2TokenCacheTest.AccountCredentialTestBundle;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CACHED_AT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.CLIENT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.ENVIRONMENT;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.EXPIRES_ON;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.HOME_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.LOCAL_ACCOUNT_ID;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.REALM;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.SECRET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.TARGET;\n+import static com.microsoft.identity.common.SharedPreferencesAccountCredentialCacheTest.USERNAME;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class MsalCppOAuth2TokenCacheTest extends AndroidSecretKeyEnabledHelper {\n+\n+    private MsalCppOAuth2TokenCache mCppCache;\n+\n+    // Test Accounts/Credentials\n+    private AccountCredentialTestBundle mTestBundle;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        super.setUp();\n+\n+        // Context and related init\n+        final Context context = InstrumentationRegistry.getTargetContext();\n+        mCppCache = MsalCppOAuth2TokenCache.create(context);\n+\n+        // Credentials for testing\n+        mTestBundle = new AccountCredentialTestBundle(\n+                MicrosoftAccount.AUTHORITY_TYPE_V1_V2,\n+                LOCAL_ACCOUNT_ID,\n+                USERNAME,\n+                HOME_ACCOUNT_ID,\n+                ENVIRONMENT,\n+                REALM,\n+                TARGET,\n+                CACHED_AT,\n+                EXPIRES_ON,\n+                SECRET,\n+                CLIENT_ID,\n+                SECRET,\n+                MOCK_ID_TOKEN_WITH_CLAIMS,\n+                null,\n+                CredentialType.V1IdToken\n+        );\n+    }\n+\n+    @After\n+    public void tearDown() {\n+        mCppCache.clearCache();\n+    }\n+\n+    @Test\n+    public void saveAndGetAccountTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+\n+        // Save the the cache\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        // Restore it\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+\n+        Assert.assertNotNull(restoredAccount);\n+        Assert.assertEquals(generatedAccount, restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAccountNullTest() throws ClientException {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        final AccountRecord restoredAccount = mCppCache.getAccount(\n+                generatedAccount.getHomeAccountId(),\n+                generatedAccount.getEnvironment(),\n+                generatedAccount.getRealm()\n+        );\n+        Assert.assertNull(restoredAccount);\n+    }\n+\n+    @Test\n+    public void getAllAccountsTest() {\n+        final AccountRecord generatedAccount = mTestBundle.mGeneratedAccount;\n+        mCppCache.saveAccountRecord(generatedAccount);\n+\n+        final List<AccountRecord> accounts = mCppCache.getAllAccounts();\n+        final AccountRecord restoredAccount = accounts.get(0);\n+        Assert.assertEquals(generatedAccount, restoredAccount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "972c5836b42fe61c4a86a805a3f699c216602f75"}, "originalPosition": 139}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTc0MTE3", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#pullrequestreview-432574117", "createdAt": "2020-06-17T16:31:38Z", "commit": {"oid": "972c5836b42fe61c4a86a805a3f699c216602f75"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjozMTozOFrOGlNvCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjozMTozOFrOGlNvCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY3NTUzMA==", "bodyText": "This cache MsalCppOauth2TokenCache is local cache, right? Like this is when local auth is happening and not broker?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r441675530", "createdAt": "2020-06-17T16:31:38Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/MsalCppOAuth2TokenCache.java", "diffHunk": "@@ -147,8 +205,20 @@ public synchronized void clearCache() {\n     public synchronized AccountDeletionRecord removeAccount(@NonNull final String homeAccountId,\n                                                             @Nullable final String environment,\n                                                             @NonNull final String realm) throws ClientException {\n+        // TODO This API is potentially problematic for TFW/TFL...\n+        // Normally on Android, apps are 'sandboxed' such that each app has their own cache\n+        // and we don't have to worry about 1 app stomping on another's cache\n+        //\n+        // TFW/TFL however, \"double stacked\" their app registrations into a single binary\n+        // Such that calling removeAccount() will potentially remove the Account being used by\n+        // another app.\n+        //\n+        // This API assumes the *general* case where an app is single stacked. If special\n+        // accommodations need to come later for Teams then we can reevaluate the logic here.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "972c5836b42fe61c4a86a805a3f699c216602f75"}, "originalPosition": 117}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12e089b35a9012b7423ac1190782eccb037bbcb4", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/12e089b35a9012b7423ac1190782eccb037bbcb4", "committedDate": "2020-06-17T17:01:50Z", "message": "Adding additional assertion from CR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjA5MjY1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#pullrequestreview-432609265", "createdAt": "2020-06-17T17:14:26Z", "commit": {"oid": "12e089b35a9012b7423ac1190782eccb037bbcb4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzoxNDoyN1rOGlPUzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzoxNDoyN1rOGlPUzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTcwMTU4MQ==", "bodyText": "Don't quite remember how JAVA executes this....would the getAllAccounts method be executed on each iteration of the loop? Would it be better to call this method before the loop and store the result in a variable and pass that to the loop?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r441701581", "createdAt": "2020-06-17T17:14:27Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/MsalCppOAuth2TokenCache.java", "diffHunk": "@@ -123,19 +127,73 @@ public synchronized void saveCredentials(@Nullable final AccountRecord accountRe\n      *\n      * @param accountRecord : accountRecord to be saved.\n      */\n-    public synchronized void saveAccountRecord(@NonNull AccountRecord accountRecord) {\n+    public synchronized void saveAccountRecord(@NonNull final AccountRecord accountRecord) {\n         getAccountCredentialCache().saveAccount(accountRecord);\n-\n     }\n \n     /**\n      * API to clear all cache.\n      * Note: This method is intended to be only used for testing purposes.\n      */\n+    @VisibleForTesting(otherwise = VisibleForTesting.NONE)\n     public synchronized void clearCache() {\n         getAccountCredentialCache().clearAll();\n     }\n \n+    /**\n+     * API to inspect cache contents.\n+     * Note: This method is intended to be only used for testing purposes.\n+     *\n+     * @return A immutable List of Credentials contained in this cache.\n+     */\n+    @VisibleForTesting(otherwise = VisibleForTesting.NONE)\n+    public synchronized List<Credential> getCredentials() {\n+        return Collections.unmodifiableList(\n+                getAccountCredentialCache().getCredentials()\n+        );\n+    }\n+\n+    /**\n+     * Force remove an AccountRecord matching the supplied criteria.\n+     *\n+     * @param homeAccountId HomeAccountId of the Account.\n+     * @param environment   The Environment of the Account.\n+     * @param realm         The Realm of the Account.\n+     * @return An {@link AccountDeletionRecord} containing a receipt of the removed Accounts.\n+     * @throws ClientException\n+     */\n+    @VisibleForTesting // private by default for production code\n+    public synchronized AccountDeletionRecord forceRemoveAccount(@NonNull final String homeAccountId,\n+                                                                 @Nullable final String environment,\n+                                                                 @NonNull final String realm) throws ClientException {\n+        validateNonNull(homeAccountId, \"homeAccountId\");\n+        validateNonNull(realm, \"realm\");\n+\n+        final boolean mustMatchOnEnvironment = !StringExtensions.isNullOrBlank(environment);\n+\n+        final List<AccountRecord> removedAccounts = new ArrayList<>();\n+\n+        for (final AccountRecord accountRecord : getAllAccounts()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12e089b35a9012b7423ac1190782eccb037bbcb4"}, "originalPosition": 79}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjM1Mzg4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#pullrequestreview-432635388", "createdAt": "2020-06-17T17:48:41Z", "commit": {"oid": "12e089b35a9012b7423ac1190782eccb037bbcb4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNzAxNzg1", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#pullrequestreview-432701785", "createdAt": "2020-06-17T19:17:04Z", "commit": {"oid": "12e089b35a9012b7423ac1190782eccb037bbcb4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjA1MDg5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#pullrequestreview-432605089", "createdAt": "2020-06-17T17:09:08Z", "commit": {"oid": "12e089b35a9012b7423ac1190782eccb037bbcb4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzowOTowOVrOGlPJNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNzowOTowOVrOGlPJNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY5ODYxMg==", "bodyText": "if typesToRemove is null, do we need to do anything except to - potentially - log the fact that we were called?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/933#discussion_r441698612", "createdAt": "2020-06-17T17:09:09Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/internal/cache/MsalOAuth2TokenCache.java", "diffHunk": "@@ -1175,6 +1189,42 @@ public AccountDeletionRecord removeAccount(@Nullable final String environment,\n                                                @Nullable final String clientId,\n                                                @Nullable final String homeAccountId,\n                                                @Nullable final String realm) {\n+        return removeAccount(\n+                environment,\n+                clientId,\n+                homeAccountId,\n+                realm,\n+                CredentialType.AccessToken,\n+                CredentialType.AccessToken_With_AuthScheme,\n+                CredentialType.RefreshToken,\n+                CredentialType.IdToken,\n+                CredentialType.V1IdToken\n+        );\n+    }\n+\n+    /**\n+     * Removes the specified Account or Accounts from the cache.\n+     * <p>\n+     * Note: if realm is passed as null, all tokens and AccountRecords associated to the\n+     * provided homeAccountId will be deleted. If a realm is provided, then the deletion is\n+     * restricted to only those AccountRecords and Credentials in that realm (tenant).\n+     * <p>\n+     * Environment, clientId, and home_account_id are nullable parameters. However, it should be\n+     * noted that if these params are null, this method will have no effect.\n+     *\n+     * @param environment   The environment to which the targeted Account is associated.\n+     * @param clientId      The clientId of this current app.\n+     * @param homeAccountId The homeAccountId of the Account targeted for deletion.\n+     * @param realm         The tenant id of the targeted Account (if applicable).\n+     * @param typesToRemove The CredentialTypes to delete for the targeted Account.\n+     * @return An {@link AccountDeletionRecord}, containing the deleted {@link AccountDeletionRecord}s.\n+     */\n+    @Override\n+    public AccountDeletionRecord removeAccount(@Nullable final String environment,\n+                                               @Nullable final String clientId,\n+                                               @Nullable final String homeAccountId,\n+                                               @Nullable final String realm,\n+                                               @Nullable final CredentialType... typesToRemove) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12e089b35a9012b7423ac1190782eccb037bbcb4"}, "originalPosition": 89}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb2ff2d0a902b2626ba7c645cdf511418aabe984", "author": {"user": {"login": "iambmelt", "name": "Brian Melton-Grace"}}, "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/cb2ff2d0a902b2626ba7c645cdf511418aabe984", "committedDate": "2020-06-17T20:18:07Z", "message": "Log a warning if no CredentialTypes to remove are specified"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1662, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}