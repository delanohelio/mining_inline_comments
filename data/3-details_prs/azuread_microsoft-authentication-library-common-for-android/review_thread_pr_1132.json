{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyNjc0OTU2", "number": 1132, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDoxNDowNFrOE6NgYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMTo1ODoyOFrOE6QJHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NDc0MTQ3OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDoxNDowNFrOH1I3zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDoxNDowNFrOH1I3zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ4MTkzMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                \"that supports keyStore functionality.  Consider not doing this, as it only exists\" +\n          \n          \n            \n                                \"that supports keyStore functionality.  Consider not doing this, as it only exists \" +", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1132#discussion_r525481932", "createdAt": "2020-11-17T20:14:04Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -108,11 +112,15 @@\n      *\n      * @param rawKey App related key to use in encrypt/decrypt\n      */\n-    public void setSecretKey(byte[] rawKey) {\n+    public synchronized void setSecretKey(byte[] rawKey) {\n         if (rawKey == null || rawKey.length != SECRET_RAW_KEY_LENGTH) {\n             throw new IllegalArgumentException(\"rawKey\");\n         }\n-\n+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {\n+            Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android\" +\n+                    \"that supports keyStore functionality.  Consider not doing this, as it only exists\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75dea20e15aeb71091551313218724dd74543e1f"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NDc0Mjc4OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDoxNDoxNFrOH1I4yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDoxNDoxNFrOH1I4yQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ4MjE4NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android\" +\n          \n          \n            \n                        Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android \" +", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1132#discussion_r525482185", "createdAt": "2020-11-17T20:14:14Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -108,11 +112,15 @@\n      *\n      * @param rawKey App related key to use in encrypt/decrypt\n      */\n-    public void setSecretKey(byte[] rawKey) {\n+    public synchronized void setSecretKey(byte[] rawKey) {\n         if (rawKey == null || rawKey.length != SECRET_RAW_KEY_LENGTH) {\n             throw new IllegalArgumentException(\"rawKey\");\n         }\n-\n+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {\n+            Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android\" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75dea20e15aeb71091551313218724dd74543e1f"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NTEzNDM2OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMTo0NzowNVrOH1MymQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMTo0NzowNVrOH1MymQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU0NjEzNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public synchronized void setSecretKey(byte[] rawKey) {\n          \n          \n            \n                public void setSecretKey(byte[] rawKey) {", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1132#discussion_r525546137", "createdAt": "2020-11-17T21:47:05Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -108,11 +112,15 @@\n      *\n      * @param rawKey App related key to use in encrypt/decrypt\n      */\n-    public void setSecretKey(byte[] rawKey) {\n+    public synchronized void setSecretKey(byte[] rawKey) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc9ca3c0cf959c1403bab067aca507cf015a4875"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NTE3MzQxOnYy", "diffSide": "RIGHT", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "isResolved": true, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMTo1ODoyOFrOH1NKJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMjo1Nzo0OFrOH1O7og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1MjE2Nw==", "bodyText": "and are we doing this right now?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1132#discussion_r525552167", "createdAt": "2020-11-17T21:58:28Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -112,7 +116,11 @@ public void setSecretKey(byte[] rawKey) {\n         if (rawKey == null || rawKey.length != SECRET_RAW_KEY_LENGTH) {\n             throw new IllegalArgumentException(\"rawKey\");\n         }\n-\n+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {\n+            Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android \" +\n+                    \"that supports keyStore functionality.  Consider not doing this, as it only exists \" +\n+                    \"for devices with an SDK lower than \" + Build.VERSION_CODES.JELLY_BEAN_MR2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aff9e8252327ada7cbeee7ab9884ccac0cb7c446"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1NDE1Mg==", "bodyText": "We support generating our own key, it happens here:\n\n  \n    \n      microsoft-authentication-library-common-for-android/common/src/main/java/com/microsoft/identity/common/adal/internal/cache/StorageHelper.java\n    \n    \n         Line 666\n      in\n      9a09e2e\n    \n    \n    \n    \n\n        \n          \n           private synchronized KeyPair generateKeyPairFromAndroidKeyStore() \n        \n    \n  \n\n\nFrom a customer investigation we were working on earlier, we found an app that was calling this method at startup: we suspect it's causing issues with SSO loss due to the host-app [potentially] providing mismatched keys", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1132#discussion_r525554152", "createdAt": "2020-11-17T22:02:21Z", "author": {"login": "iambmelt"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -112,7 +116,11 @@ public void setSecretKey(byte[] rawKey) {\n         if (rawKey == null || rawKey.length != SECRET_RAW_KEY_LENGTH) {\n             throw new IllegalArgumentException(\"rawKey\");\n         }\n-\n+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {\n+            Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android \" +\n+                    \"that supports keyStore functionality.  Consider not doing this, as it only exists \" +\n+                    \"for devices with an SDK lower than \" + Build.VERSION_CODES.JELLY_BEAN_MR2);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1MjE2Nw=="}, "originalCommit": {"oid": "aff9e8252327ada7cbeee7ab9884ccac0cb7c446"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1ODE1Ng==", "bodyText": "Cool.....actually how does user defined key currently work for MSAL? It is only for ADAL right?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1132#discussion_r525558156", "createdAt": "2020-11-17T22:10:05Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -112,7 +116,11 @@ public void setSecretKey(byte[] rawKey) {\n         if (rawKey == null || rawKey.length != SECRET_RAW_KEY_LENGTH) {\n             throw new IllegalArgumentException(\"rawKey\");\n         }\n-\n+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {\n+            Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android \" +\n+                    \"that supports keyStore functionality.  Consider not doing this, as it only exists \" +\n+                    \"for devices with an SDK lower than \" + Build.VERSION_CODES.JELLY_BEAN_MR2);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1MjE2Nw=="}, "originalCommit": {"oid": "aff9e8252327ada7cbeee7ab9884ccac0cb7c446"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1OTM5MQ==", "bodyText": "MSAL reads the value from the AuthenticationSettings.INSTANCE:\n    // Try to get user defined key (ADAL/MSAL).\n    if (AuthenticationSettings.INSTANCE.getSecretKeyData() != null) {\n        setBlobVersion(VERSION_USER_DEFINED);\n        return loadSecretKey(KeyType.ADAL_USER_DEFINED_KEY);\n    }\n\nAdam.", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1132#discussion_r525559391", "createdAt": "2020-11-17T22:12:30Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -112,7 +116,11 @@ public void setSecretKey(byte[] rawKey) {\n         if (rawKey == null || rawKey.length != SECRET_RAW_KEY_LENGTH) {\n             throw new IllegalArgumentException(\"rawKey\");\n         }\n-\n+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {\n+            Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android \" +\n+                    \"that supports keyStore functionality.  Consider not doing this, as it only exists \" +\n+                    \"for devices with an SDK lower than \" + Build.VERSION_CODES.JELLY_BEAN_MR2);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1MjE2Nw=="}, "originalCommit": {"oid": "aff9e8252327ada7cbeee7ab9884ccac0cb7c446"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU2MTA4Mg==", "bodyText": "Yeah but it has to be set on AuthenticationSettings.INSTANCE right? ADAL has a public method to do this...but I don't see one in MSAL", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1132#discussion_r525561082", "createdAt": "2020-11-17T22:15:55Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -112,7 +116,11 @@ public void setSecretKey(byte[] rawKey) {\n         if (rawKey == null || rawKey.length != SECRET_RAW_KEY_LENGTH) {\n             throw new IllegalArgumentException(\"rawKey\");\n         }\n-\n+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {\n+            Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android \" +\n+                    \"that supports keyStore functionality.  Consider not doing this, as it only exists \" +\n+                    \"for devices with an SDK lower than \" + Build.VERSION_CODES.JELLY_BEAN_MR2);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1MjE2Nw=="}, "originalCommit": {"oid": "aff9e8252327ada7cbeee7ab9884ccac0cb7c446"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU2MTYwOA==", "bodyText": "This is ADAL: https://github.com/AzureAD/azure-activedirectory-library-for-android/blob/cfdb40c5d0fb28e4825df030e909bc493aaaffe9/adal/src/main/java/com/microsoft/aad/adal/AuthenticationSettings.java#L82\nIs there something similar in MSAL?", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1132#discussion_r525561608", "createdAt": "2020-11-17T22:16:56Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -112,7 +116,11 @@ public void setSecretKey(byte[] rawKey) {\n         if (rawKey == null || rawKey.length != SECRET_RAW_KEY_LENGTH) {\n             throw new IllegalArgumentException(\"rawKey\");\n         }\n-\n+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {\n+            Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android \" +\n+                    \"that supports keyStore functionality.  Consider not doing this, as it only exists \" +\n+                    \"for devices with an SDK lower than \" + Build.VERSION_CODES.JELLY_BEAN_MR2);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1MjE2Nw=="}, "originalCommit": {"oid": "aff9e8252327ada7cbeee7ab9884ccac0cb7c446"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU2NzQzNw==", "bodyText": "PublicClientApplicationConfiguration.java:167", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1132#discussion_r525567437", "createdAt": "2020-11-17T22:29:05Z", "author": {"login": "AdamBJohnsonx"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -112,7 +116,11 @@ public void setSecretKey(byte[] rawKey) {\n         if (rawKey == null || rawKey.length != SECRET_RAW_KEY_LENGTH) {\n             throw new IllegalArgumentException(\"rawKey\");\n         }\n-\n+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {\n+            Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android \" +\n+                    \"that supports keyStore functionality.  Consider not doing this, as it only exists \" +\n+                    \"for devices with an SDK lower than \" + Build.VERSION_CODES.JELLY_BEAN_MR2);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1MjE2Nw=="}, "originalCommit": {"oid": "aff9e8252327ada7cbeee7ab9884ccac0cb7c446"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU4MTIxOA==", "bodyText": "Cool, Thanks!", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1132#discussion_r525581218", "createdAt": "2020-11-17T22:57:48Z", "author": {"login": "shahzaibj"}, "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationSettings.java", "diffHunk": "@@ -112,7 +116,11 @@ public void setSecretKey(byte[] rawKey) {\n         if (rawKey == null || rawKey.length != SECRET_RAW_KEY_LENGTH) {\n             throw new IllegalArgumentException(\"rawKey\");\n         }\n-\n+        if (android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN_MR2) {\n+            Logger.warn(\":setSecretKey\", \"You're using setSecretKey in a version of android \" +\n+                    \"that supports keyStore functionality.  Consider not doing this, as it only exists \" +\n+                    \"for devices with an SDK lower than \" + Build.VERSION_CODES.JELLY_BEAN_MR2);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1MjE2Nw=="}, "originalCommit": {"oid": "aff9e8252327ada7cbeee7ab9884ccac0cb7c446"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2090, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}