{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MzY3MDM1", "number": 260, "title": "[MapRouletteUploadCommand] Fix custom challenge name bug", "bodyText": "Description:\nThis fixes an issue reported by @dcastrowa where the MapRouletteUploadCommand was no longer able to set custom Challenge names.\n#222 brought in the ability to prepend country display names in each challenge, however, it set each challenge name to the challengeName property of the Task (Task.getChallengeName()). Since changing the Challenge name (via Challenge.setName()) does not propagate to its Tasks, the Challenge name sent to the API did not include the custom name in the configuration.\nPotential Impact:\nThis will allow us to use custom challenge names when uploading to MapRoulette\nUnit Test Approach:\nI added a couple unit tests that run the command using a custom challenge configuration. I also tested the command uploads to MR.\nTest Results:\nUnit tests pass.\nCustom challenge names now show up in MR", "createdAt": "2020-02-18T00:49:45Z", "url": "https://github.com/osmlab/atlas-checks/pull/260", "merged": true, "mergeCommit": {"oid": "840b9b01d5ee7a9e625ee07baa9cc9ad43c96100"}, "closed": true, "closedAt": "2020-02-19T21:08:14Z", "author": {"login": "danielduhh"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFV_qngH2gAyMzc2MzY3MDM1OjA0NmEwOGNlYWMwNTM1NmVlMDdhNGNjNGFiOWNmN2EwYzg1YmJlYzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcF9CQxgFqTM2MTQzNDE5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "046a08ceac05356ee07a4cc4ab9cf7a0c85bbec5", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/046a08ceac05356ee07a4cc4ab9cf7a0c85bbec5", "committedDate": "2020-02-17T23:33:15Z", "message": "fix custom challenge name bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d954892df89e3172bd2fa76be99641dab0001444", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/d954892df89e3172bd2fa76be99641dab0001444", "committedDate": "2020-02-18T00:45:08Z", "message": "More tests!"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b66dbac84f4e6d3cb4181069365913a978765014", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/b66dbac84f4e6d3cb4181069365913a978765014", "committedDate": "2020-02-18T00:48:13Z", "message": "extra lines"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c068bde52daea513c01b2b1c33e03f87e0f45da8", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/c068bde52daea513c01b2b1c33e03f87e0f45da8", "committedDate": "2020-02-18T00:49:54Z", "message": "Merge branch 'dev' into mr"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNzQyNDAy", "url": "https://github.com/osmlab/atlas-checks/pull/260#pullrequestreview-360742402", "createdAt": "2020-02-18T23:14:23Z", "commit": {"oid": "c068bde52daea513c01b2b1c33e03f87e0f45da8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMzoxNDoyM1rOFrV6Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMzoxNDoyM1rOFrV6Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk5MjA0Mg==", "bodyText": "Nit: should be newline here", "url": "https://github.com/osmlab/atlas-checks/pull/260#discussion_r380992042", "createdAt": "2020-02-18T23:14:23Z", "author": {"login": "seancoulter"}, "path": "src/test/resources/org/openstreetmap/atlas/checks/maproulette/checksConfig.json", "diffHunk": "@@ -0,0 +1,12 @@\n+{\n+  \"SomeCheck\": {\n+    \"challenge\": {\n+      \"name\": \"Spiky Buildings\"\n+    }\n+  },\n+  \"SomeOtherCheck\": {\n+    \"challenge\": {\n+      \"name\": \"Intersecting Lines\"\n+    }\n+  }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c068bde52daea513c01b2b1c33e03f87e0f45da8"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNzQ1ODcz", "url": "https://github.com/osmlab/atlas-checks/pull/260#pullrequestreview-360745873", "createdAt": "2020-02-18T23:23:04Z", "commit": {"oid": "c068bde52daea513c01b2b1c33e03f87e0f45da8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMzoyMzowNFrOFrWEuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQyMzoyMzowNFrOFrWEuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk5NDc0Nw==", "bodyText": "runAndTest could call this method to cut down on some duplication", "url": "https://github.com/osmlab/atlas-checks/pull/260#discussion_r380994747", "createdAt": "2020-02-18T23:23:04Z", "author": {"login": "seancoulter"}, "path": "src/test/java/org/openstreetmap/atlas/checks/maproulette/MapRouletteUploadCommandTest.java", "diffHunk": "@@ -83,6 +116,30 @@ public void writeFiles()\n         }\n     }\n \n+    /**\n+     * Similar to runAndTest, however this function will return a {@link TestMapRouletteConnection}\n+     *\n+     * @param additionalArguments\n+     *            String[] of extra arguments for {@link MapRouletteUploadCommand}, to add to the\n+     *            data i/o locations and server config\n+     * @return TestMapRouletteConnection\n+     */\n+    private TestMapRouletteConnection run(final String[] additionalArguments)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c068bde52daea513c01b2b1c33e03f87e0f45da8"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16944185e49ebfe35d8ca3672533f21630e27d6e", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/16944185e49ebfe35d8ca3672533f21630e27d6e", "committedDate": "2020-02-19T01:55:28Z", "message": "fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf3dd76f3a9614318fd0d768acb561e12c220d36", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/bf3dd76f3a9614318fd0d768acb561e12c220d36", "committedDate": "2020-02-19T02:31:01Z", "message": "sonar"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwODI4NjQz", "url": "https://github.com/osmlab/atlas-checks/pull/260#pullrequestreview-360828643", "createdAt": "2020-02-19T03:58:59Z", "commit": {"oid": "bf3dd76f3a9614318fd0d768acb561e12c220d36"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzo1OTowMFrOFraZkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQwMzo1OTowMFrOFraZkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA2NTYxOQ==", "bodyText": "nice testing! cool to see it java and how I can try and create testing in python.", "url": "https://github.com/osmlab/atlas-checks/pull/260#discussion_r381065619", "createdAt": "2020-02-19T03:59:00Z", "author": {"login": "dcastrowa"}, "path": "src/test/java/org/openstreetmap/atlas/checks/maproulette/MapRouletteUploadCommandTest.java", "diffHunk": "@@ -57,7 +60,39 @@ public void testCountryFilter()\n     public void testExecute()\n     {\n         final String[] additionalArguments = {};\n-        this.runAndTest(additionalArguments, 1, 2, 2);\n+        this.runAndTest(additionalArguments, 1, 3, 3);\n+    }\n+\n+    @Test\n+    public void testGetCountryDisplayName()\n+    {\n+        final Optional<String> countries1 = Optional.of(\"CAN,MEX\");\n+        final Optional<String> countries2 = Optional.of(\"USA\");\n+        final MapRouletteUploadCommand command = new MapRouletteUploadCommand();\n+        final String displayCountryNames1 = command.getCountryDisplayName(countries1);\n+        final String displayCountryNames2 = command.getCountryDisplayName(countries2);\n+\n+        Assert.assertEquals(\"Canada, Mexico\", displayCountryNames1);\n+        Assert.assertEquals(\"United States\", displayCountryNames2);\n+    }\n+\n+    @Test\n+    public void testGetCustomChallengeName()\n+    {\n+        final String[] additionalArguments = { String.format(\"-config=%s\",\n+                MapRouletteUploadCommandTest.class.getResource(\"checksConfig.json\").getPath()) };\n+\n+        final TestMapRouletteConnection connection = this.run(additionalArguments);\n+        final Set<Project> projects = connection.uploadedProjects();\n+\n+        final List<String> challengeNames = projects.stream().flatMap(project -> connection\n+                .challengesForProject(project).stream().map(Challenge::getName))\n+                .collect(Collectors.toList());\n+        Collections.sort(challengeNames);\n+\n+        Assert.assertEquals(\"Canada - Spiky Buildings\", challengeNames.get(0));\n+        Assert.assertEquals(\"Mexico, Belize - Intersecting Lines\", challengeNames.get(1));\n+        Assert.assertEquals(\"United States - Address Point Match\", challengeNames.get(2));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf3dd76f3a9614318fd0d768acb561e12c220d36"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwODI5MDU0", "url": "https://github.com/osmlab/atlas-checks/pull/260#pullrequestreview-360829054", "createdAt": "2020-02-19T04:00:51Z", "commit": {"oid": "bf3dd76f3a9614318fd0d768acb561e12c220d36"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17426d346cde930a4f7afd1138c09a6d66d5d6c8", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/17426d346cde930a4f7afd1138c09a6d66d5d6c8", "committedDate": "2020-02-19T05:59:09Z", "message": "remove extra lines"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMzgwMzk5", "url": "https://github.com/osmlab/atlas-checks/pull/260#pullrequestreview-361380399", "createdAt": "2020-02-19T19:37:59Z", "commit": {"oid": "17426d346cde930a4f7afd1138c09a6d66d5d6c8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNDM0MTkz", "url": "https://github.com/osmlab/atlas-checks/pull/260#pullrequestreview-361434193", "createdAt": "2020-02-19T21:02:23Z", "commit": {"oid": "17426d346cde930a4f7afd1138c09a6d66d5d6c8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3284, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}