{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4MDIwOTEw", "number": 286, "title": "Update FlagDb & Task Deserializer to filter out synthetic point tags", "bodyText": "Description:\nThis updates the FlagDB & TaskDeserializer classes to properly filter out synthetic highlight points after #280 was merged.\nPotential Impact:\nTools parsing the flag_id string in the flag table should expect new values\nUnit Test Approach:\nAdded a unit test to test the updated Flag Deserializer. Also tested the results in a flag db upload.\nTest Results:\nUnit tests pass.\nFlag DB upload shows flag_id values.", "createdAt": "2020-04-23T16:05:52Z", "url": "https://github.com/osmlab/atlas-checks/pull/286", "merged": true, "mergeCommit": {"oid": "62c5d19f9a173f8641e4f576f3323c2e30c36a95"}, "closed": true, "closedAt": "2020-05-18T21:33:46Z", "author": {"login": "danielduhh"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaWkegAH2gAyNDA4MDIwOTEwOjVlM2M4N2QyYzMyN2Q4N2IzZWYxZjNiZDMwOGE0NGVmMzFkZDc1ZDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcilptQgFqTQxMzkwNjE4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5e3c87d2c327d87b3ef1f3bd308a44ef31dd75d7", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/5e3c87d2c327d87b3ef1f3bd308a44ef31dd75d7", "committedDate": "2020-04-23T06:05:52Z", "message": "filter points"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79a77f815624e76af017b1fc2d627c3e85753068", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/79a77f815624e76af017b1fc2d627c3e85753068", "committedDate": "2020-04-23T06:07:08Z", "message": "status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1389072c3eb8b6fd0325080ba73b90f7cd3eda5f", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/1389072c3eb8b6fd0325080ba73b90f7cd3eda5f", "committedDate": "2020-04-23T06:11:40Z", "message": "add docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2af258aea142793ed48ec3bb56aff74ce16fc25f", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/2af258aea142793ed48ec3bb56aff74ce16fc25f", "committedDate": "2020-05-11T22:39:03Z", "message": "deserialize id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42b433fdb08ee377c3f54201b93c70b6df8ab468", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/42b433fdb08ee377c3f54201b93c70b6df8ab468", "committedDate": "2020-05-11T23:02:54Z", "message": "clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "231b4bf7fe946e071d14abfc6504b4572ce5abe5", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/231b4bf7fe946e071d14abfc6504b4572ce5abe5", "committedDate": "2020-05-11T23:12:47Z", "message": "add resource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c03eba7576b63c2c1cb09e5deba15dd87b5a508c", "author": {"user": null}, "url": "https://github.com/osmlab/atlas-checks/commit/c03eba7576b63c2c1cb09e5deba15dd87b5a508c", "committedDate": "2020-05-11T23:20:40Z", "message": "Merge branch 'dev' into filter_synthetic_point"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDA0NjA4", "url": "https://github.com/osmlab/atlas-checks/pull/286#pullrequestreview-410404608", "createdAt": "2020-05-12T20:40:05Z", "commit": {"oid": "c03eba7576b63c2c1cb09e5deba15dd87b5a508c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDo0MDowNVrOGUYGSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDo0MDo0M1rOGUYHhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAxOTUzMQ==", "bodyText": "The unique identifiers are unsorted so in this case it would be a good idea to call .sorted() on the stream before collecting it.", "url": "https://github.com/osmlab/atlas-checks/pull/286#discussion_r424019531", "createdAt": "2020-05-12T20:40:05Z", "author": {"login": "Bentleysb"}, "path": "src/main/java/org/openstreetmap/atlas/checks/database/FlagDatabaseSubCommand.java", "diffHunk": "@@ -239,7 +240,8 @@ public void executeFlagStatement(final PreparedStatement sql, final CheckFlag fl\n     {\n         try\n         {\n-            sql.setString(1, flag.getIdentifier());\n+            sql.setString(1, flag.getUniqueIdentifiers().stream().map(String::toString)\n+                    .collect(Collectors.joining(\",\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c03eba7576b63c2c1cb09e5deba15dd87b5a508c"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAxOTg0NA==", "bodyText": "Same thing about .sorted().", "url": "https://github.com/osmlab/atlas-checks/pull/286#discussion_r424019844", "createdAt": "2020-05-12T20:40:43Z", "author": {"login": "Bentleysb"}, "path": "src/main/java/org/openstreetmap/atlas/checks/flag/serializer/CheckFlagDeserializer.java", "diffHunk": "@@ -34,11 +39,27 @@ public CheckFlag deserialize(final JsonElement json, final Type typeOfT,\n         final JsonObject properties = full.get(PROPERTIES).getAsJsonObject();\n         final String checkName = properties.get(GENERATOR).getAsString();\n         final String instruction = properties.get(INSTRUCTIONS).getAsString();\n-        final String flagIdentifier = properties.get(ID).getAsString();\n+        final String flagIdentifier = properties.get(IDENTIFIERS) == null\n+                ? properties.get(ID).getAsString()\n+                // Convert array of ids into comma delimited string\n+                : this.parseIdentifiers((JsonArray) properties.get(IDENTIFIERS));\n         final CheckFlag flag = new CheckFlag(flagIdentifier);\n         flag.addInstruction(instruction);\n         flag.setChallengeName(checkName);\n \n         return flag;\n     }\n+\n+    /**\n+     * Returns a comma delimited string of identifiers.\n+     * \n+     * @param identifiers\n+     *            - array of flag identifiers\n+     * @return - comma delimited string\n+     */\n+    private String parseIdentifiers(final JsonArray identifiers)\n+    {\n+        return Arrays.asList(new Gson().fromJson(identifiers, String[].class)).stream()\n+                .map(String::toString).collect(Collectors.joining(\",\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c03eba7576b63c2c1cb09e5deba15dd87b5a508c"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1dccbc205f5d188a97121fe4192ebb890ab5f62", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/f1dccbc205f5d188a97121fe4192ebb890ab5f62", "committedDate": "2020-05-18T19:59:55Z", "message": "clean up conditional and test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd014f1b5f2308daf3dba38542f61118ab1e63bf", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/dd014f1b5f2308daf3dba38542f61118ab1e63bf", "committedDate": "2020-05-18T20:00:41Z", "message": "Merge branch 'filter_synthetic_point' of https://github.com/danielduhh/atlas-checks into filter_synthetic_point"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTA2MTgx", "url": "https://github.com/osmlab/atlas-checks/pull/286#pullrequestreview-413906181", "createdAt": "2020-05-18T20:11:33Z", "commit": {"oid": "dd014f1b5f2308daf3dba38542f61118ab1e63bf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3314, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}