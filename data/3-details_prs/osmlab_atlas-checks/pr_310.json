{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNjE1Njgx", "number": 310, "title": "InvalidTurnRestrictionCheck Instruction Enhancement", "bodyText": "Description:\nThis changes the logic of InvalidTurnRestrictionCheck to provide more specific instructions for different invalid cases.\nInstead of every flag having the instruction \"Relation ID: {id} is marked as turn restriction, but it is not a well-formed relation (i.e. it is missing required members)\", instructions will now include one of the following with the instruction:\n\n\"There is not a single navigable route to restrict, this restriction may be redundant or need to be split in to multiple relations\"\n\"A Turn Restriction should only have 1 via Node\"\n\"Via member is required for restrictions with the same to and from members\"\n\nPotential Impact:\nNo downstream impact, just better instructions for flags.\nUnit Test Approach:\nAdded unit test for each new instruction.\nTest Results:\nSampled 228 flags from 7 countries. All flags were unchanged other than to now have more specific instructions that match their use case.", "createdAt": "2020-06-10T18:02:39Z", "url": "https://github.com/osmlab/atlas-checks/pull/310", "merged": true, "mergeCommit": {"oid": "70ff169f3ff6d8894b8d146231c940e023b45a2b"}, "closed": true, "closedAt": "2020-06-10T20:34:05Z", "author": {"login": "Bentleysb"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoV7l6gH2gAyNDMyNjE1NjgxOjJjZTU0MTY5Y2RlZGE3ZWRlZmJlNjdlMzUwMmE0NTM2MmMyZWFiZGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp_vACAFqTQyODQwNTg2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2ce54169cdeda7edefbe67e3502a45362c2eabda", "author": {"user": {"login": "Bentleysb", "name": "Bentley Breithaupt"}}, "url": "https://github.com/osmlab/atlas-checks/commit/2ce54169cdeda7edefbe67e3502a45362c2eabda", "committedDate": "2020-06-05T17:16:09Z", "message": "instructions & testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bec37eed29f8b208ce9f6461002f14f0aa6108f", "author": {"user": {"login": "Bentleysb", "name": "Bentley Breithaupt"}}, "url": "https://github.com/osmlab/atlas-checks/commit/8bec37eed29f8b208ce9f6461002f14f0aa6108f", "committedDate": "2020-06-05T19:13:59Z", "message": "sharding fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e00287226e74ef97d5fc0d0a3335fe935f423f02", "author": {"user": {"login": "Bentleysb", "name": "Bentley Breithaupt"}}, "url": "https://github.com/osmlab/atlas-checks/commit/e00287226e74ef97d5fc0d0a3335fe935f423f02", "committedDate": "2020-06-10T15:47:06Z", "message": "revert test atlas jar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d2eaba52338c769a71965afe7f0b26015f15e93", "author": {"user": {"login": "Bentleysb", "name": "Bentley Breithaupt"}}, "url": "https://github.com/osmlab/atlas-checks/commit/1d2eaba52338c769a71965afe7f0b26015f15e93", "committedDate": "2020-06-10T17:25:51Z", "message": "Merge remote-tracking branch 'upstream/dev' into dev-turnRestrictionInstructions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbcb3df40bc589f65fdf515333ff56f23796ab72", "author": {"user": {"login": "Bentleysb", "name": "Bentley Breithaupt"}}, "url": "https://github.com/osmlab/atlas-checks/commit/bbcb3df40bc589f65fdf515333ff56f23796ab72", "committedDate": "2020-06-10T17:33:37Z", "message": "comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MzUxNjg5", "url": "https://github.com/osmlab/atlas-checks/pull/310#pullrequestreview-428351689", "createdAt": "2020-06-10T19:10:18Z", "commit": {"oid": "bbcb3df40bc589f65fdf515333ff56f23796ab72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4Mzc1NzEw", "url": "https://github.com/osmlab/atlas-checks/pull/310#pullrequestreview-428375710", "createdAt": "2020-06-10T19:46:48Z", "commit": {"oid": "bbcb3df40bc589f65fdf515333ff56f23796ab72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOTo0Njo0OVrOGiD30A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxOTo0Njo0OVrOGiD30A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM2ODIwOA==", "bodyText": "nit: Could we combine the conditionals in noneMatch() ?", "url": "https://github.com/osmlab/atlas-checks/pull/310#discussion_r438368208", "createdAt": "2020-06-10T19:46:49Z", "author": {"login": "seancoulter"}, "path": "src/main/java/org/openstreetmap/atlas/checks/validation/relations/InvalidTurnRestrictionCheck.java", "diffHunk": "@@ -46,22 +72,32 @@ public boolean validCheckForObject(final AtlasObject object)\n     @Override\n     protected Optional<CheckFlag> flag(final AtlasObject object)\n     {\n-        final Optional<CheckFlag> result;\n-\n         final Relation relation = (Relation) object;\n-        if (!TurnRestriction.from(relation).isPresent())\n+        final Set<AtlasObject> members = relation.members().stream().map(RelationMember::getEntity)\n+                .collect(Collectors.toSet());\n+\n+        // A to and from member are required\n+        if (relation.members().stream()\n+                .noneMatch(member -> member.getRole().equals(RelationTypeTag.RESTRICTION_ROLE_FROM))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbcb3df40bc589f65fdf515333ff56f23796ab72"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDAxODcz", "url": "https://github.com/osmlab/atlas-checks/pull/310#pullrequestreview-428401873", "createdAt": "2020-06-10T20:26:22Z", "commit": {"oid": "bbcb3df40bc589f65fdf515333ff56f23796ab72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDA1ODY0", "url": "https://github.com/osmlab/atlas-checks/pull/310#pullrequestreview-428405864", "createdAt": "2020-06-10T20:32:20Z", "commit": {"oid": "bbcb3df40bc589f65fdf515333ff56f23796ab72"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3347, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}