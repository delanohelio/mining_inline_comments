{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzNzk4ODMy", "number": 243, "title": "Snake road check bug", "bodyText": "Description:\nThis is a bug fix for the existing Snake Road Check.\nExisting code is meeting all the requirements except for instead of doing heading difference for connected edges the current edge was doing heading difference with all the edges on the highway. This issue is fixed with new code changes.\nCriteria to identify Snake Road is as follows:\n\nAt some point, two consecutive edges making up the Snake road must have a heading difference of at least 60 degrees.\nThe snake road must have at least 3 edges\nAt least one edge making up the snake road should have a valence greater than 4\nTo be considered a snake road, you should either have no road name or have any connected ways that share the\nsame name that you do. This is done to prevent flagging strange portions of highways that may exhibit the behavior of a snake road.\n\nPotential Impact:\nChanges made to Atlas checks.\nUnit Test Approach:\nExisting tests.\nTest Results:\nRan the check on atlas files before and after code changes and made sure the number of flags created are less. Also, with the help of analyst making sure the generated flags are still satisfying criteria for Snake Road check.\nRan SnakeRoadCheck bug on approximately 65 MB data Atlas files and found below metrics.\nWith old code: 84 flags were created.\nWith new code changes: 34 flags were created.\nFlag count is decreased as expected and also verified each flag generated is satisfying snake road check requirement.", "createdAt": "2020-01-16T19:05:07Z", "url": "https://github.com/osmlab/atlas-checks/pull/243", "merged": true, "mergeCommit": {"oid": "1127968f9e9086e188dfb46751ab3fd76d0a13c0"}, "closed": true, "closedAt": "2020-02-17T17:44:13Z", "author": {"login": "smaheshwaram"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-lJuygFqTM0OTA0MTgzMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFQ_-qAFqTM1OTg5NDgyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MDQxODMz", "url": "https://github.com/osmlab/atlas-checks/pull/243#pullrequestreview-349041833", "createdAt": "2020-01-27T23:15:21Z", "commit": {"oid": "8a307566b67a885de04b85840d7903a2fb6725c1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMzoxNToyMVrOFiUvdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QyMzoxNToyMVrOFiUvdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUzNTczNA==", "bodyText": "Isn't this change performing the same operation as before? For all connections, checkIfEdgeHeadingDifferenceExceedsThreshold(comingFrom, comingTo); was called from walk.visitedEdge previously, and now it is called here. Was this to improve performance or is there something I am missing?", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r371535734", "createdAt": "2020-01-27T23:15:21Z", "author": {"login": "sayas01"}, "path": "src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/SnakeRoadCheck.java", "diffHunk": "@@ -160,6 +161,10 @@ private boolean networkWalkQualifiesAsSnakeRoad(final SnakeRoadNetworkWalk walk)\n      */\n     private void walkNetwork(final Edge current, final SnakeRoadNetworkWalk walk)\n     {\n+        final Set<Edge> directConnections = walk.getConnectedMasterEdgeOfTheSameWay(current);\n+        directConnections.stream().forEach(connection -> walk", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a307566b67a885de04b85840d7903a2fb6725c1"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTA2NTA0", "url": "https://github.com/osmlab/atlas-checks/pull/243#pullrequestreview-354106504", "createdAt": "2020-02-05T23:12:26Z", "commit": {"oid": "0e21d292bb73c4a499ce29baa78dcc3d6f0e215a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzoxMjoyNlrOFmKaug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzoxMjoyNlrOFmKaug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU2MDg5MA==", "bodyText": "to avoid reprocessing, we can just say final Set<Edge> directConnections = walk.getDirectConnections() here. Might need to change Set to a LinkedList doing this", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r375560890", "createdAt": "2020-02-05T23:12:26Z", "author": {"login": "seancoulter"}, "path": "src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/SnakeRoadCheck.java", "diffHunk": "@@ -160,6 +161,10 @@ private boolean networkWalkQualifiesAsSnakeRoad(final SnakeRoadNetworkWalk walk)\n      */\n     private void walkNetwork(final Edge current, final SnakeRoadNetworkWalk walk)\n     {\n+        final Set<Edge> directConnections = walk.getConnectedMasterEdgeOfTheSameWay(current);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e21d292bb73c4a499ce29baa78dcc3d6f0e215a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2ODQ1NDEw", "url": "https://github.com/osmlab/atlas-checks/pull/243#pullrequestreview-356845410", "createdAt": "2020-02-11T17:20:42Z", "commit": {"oid": "1f27e83d04135a0e62161ead5c1a7fcad79a489f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2OTEwMDc1", "url": "https://github.com/osmlab/atlas-checks/pull/243#pullrequestreview-356910075", "createdAt": "2020-02-11T18:56:20Z", "commit": {"oid": "1f27e83d04135a0e62161ead5c1a7fcad79a489f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxODo1NjoyMFrOFoVEVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxODo1NjoyMFrOFoVEVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzgzMjUzNQ==", "bodyText": "conn -> onceRemovedConnection", "url": "https://github.com/osmlab/atlas-checks/pull/243#discussion_r377832535", "createdAt": "2020-02-11T18:56:20Z", "author": {"login": "seancoulter"}, "path": "src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/SnakeRoadCheck.java", "diffHunk": "@@ -168,9 +169,13 @@ private void walkNetwork(final Edge current, final SnakeRoadNetworkWalk walk)\n             // Process it\n             walk.visitEdge(current, connection);\n \n+            final Set<Edge> oneLayerRemovedConnections = walk\n+                    .getConnectedMasterEdgeOfTheSameWay(connection);\n+            oneLayerRemovedConnections.forEach(\n+                    conn -> walk.checkIfEdgeHeadingDifferenceExceedsThreshold(connection, conn));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f27e83d04135a0e62161ead5c1a7fcad79a489f"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MDYyOTYx", "url": "https://github.com/osmlab/atlas-checks/pull/243#pullrequestreview-357062961", "createdAt": "2020-02-11T23:07:06Z", "commit": {"oid": "00c7738594f01b79912da243bbfa73f2b033dcf2"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MDcxNTA0", "url": "https://github.com/osmlab/atlas-checks/pull/243#pullrequestreview-357071504", "createdAt": "2020-02-11T23:27:36Z", "commit": {"oid": "52325e8cb213f36c91b66383e5128218e29065ef"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MDcyNTM4", "url": "https://github.com/osmlab/atlas-checks/pull/243#pullrequestreview-357072538", "createdAt": "2020-02-11T23:30:17Z", "commit": {"oid": "52325e8cb213f36c91b66383e5128218e29065ef"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "caf38fc8040833f451715a013e423c6224c778b8", "author": {"user": null}, "url": "https://github.com/osmlab/atlas-checks/commit/caf38fc8040833f451715a013e423c6224c778b8", "committedDate": "2020-02-12T17:53:55Z", "message": "SnakeRoadCheck, trying to clean up commit count."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "52325e8cb213f36c91b66383e5128218e29065ef", "author": {"user": null}, "url": "https://github.com/osmlab/atlas-checks/commit/52325e8cb213f36c91b66383e5128218e29065ef", "committedDate": "2020-02-11T23:08:39Z", "message": "SnakeRoadCheck, formatting fix."}, "afterCommit": {"oid": "caf38fc8040833f451715a013e423c6224c778b8", "author": {"user": null}, "url": "https://github.com/osmlab/atlas-checks/commit/caf38fc8040833f451715a013e423c6224c778b8", "committedDate": "2020-02-12T17:53:55Z", "message": "SnakeRoadCheck, trying to clean up commit count."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3Njc5ODUx", "url": "https://github.com/osmlab/atlas-checks/pull/243#pullrequestreview-357679851", "createdAt": "2020-02-12T18:19:40Z", "commit": {"oid": "caf38fc8040833f451715a013e423c6224c778b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29b6c66198ec98b324d552f4fd8308940e5269d2", "author": {"user": {"login": "danielduhh", "name": "Daniel B"}}, "url": "https://github.com/osmlab/atlas-checks/commit/29b6c66198ec98b324d552f4fd8308940e5269d2", "committedDate": "2020-02-13T17:51:30Z", "message": "Merge branch 'dev' into snake-road-check-bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDI3MDg3", "url": "https://github.com/osmlab/atlas-checks/pull/243#pullrequestreview-358427087", "createdAt": "2020-02-13T17:51:49Z", "commit": {"oid": "caf38fc8040833f451715a013e423c6224c778b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDI3ODYz", "url": "https://github.com/osmlab/atlas-checks/pull/243#pullrequestreview-358427863", "createdAt": "2020-02-13T17:52:57Z", "commit": {"oid": "29b6c66198ec98b324d552f4fd8308940e5269d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5ODk0ODI0", "url": "https://github.com/osmlab/atlas-checks/pull/243#pullrequestreview-359894824", "createdAt": "2020-02-17T17:44:04Z", "commit": {"oid": "29b6c66198ec98b324d552f4fd8308940e5269d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3255, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}