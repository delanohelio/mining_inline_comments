{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1Mzc3NjM5", "number": 284, "title": "ShadowDetectionCheck Very Large Building Bug", "bodyText": "Description:\nShadowDetectionCheck was found to be very slow at processing areas that contain buildings with lots of correctly grounded parts. In this case the check would process all the parts multiple time.\nThis fixes this by doing two things. One, all processed parts are marked as flagged so that they are not checked twice. Two, the BFS no longer short circuits upon finding a connection to the ground. Instead all connected parts are collected so that they can be marked as processed.\nExample of a building that was extremely slow due to duplicate processing:\nhttps://www.openstreetmap.org/relation/4156588\nPotential Impact:\nDecrease the runtime of ShadowDetectionCheck\nUnit Test Approach:\nNo changes necessary.\nTest Results:\nTested on an area containing the example feature above. Run time was decreased from ~10 hours to ~1 minute.\nRan on three smaller countries to test for changes in flags. All flags were the same.", "createdAt": "2020-04-17T23:12:21Z", "url": "https://github.com/osmlab/atlas-checks/pull/284", "merged": true, "mergeCommit": {"oid": "f370c14126e73aeb5b0731e9f26c17426b21dd76"}, "closed": true, "closedAt": "2020-05-01T00:08:23Z", "author": {"login": "Bentleysb"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYoLH4gH2gAyNDA1Mzc3NjM5OmIxNjYzNDE0YzMwNTI4MGE4ZmZjZTNkMTY3MjMyZjg1NTg2NzJkMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcc2I9IgFqTQwMzk1NDg4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b1663414c305280a8ffce3d167232f8558672d03", "author": {"user": {"login": "Bentleysb", "name": "Bentley Breithaupt"}}, "url": "https://github.com/osmlab/atlas-checks/commit/b1663414c305280a8ffce3d167232f8558672d03", "committedDate": "2020-04-17T21:28:37Z", "message": "look at featrues once"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47576a5fe2191947a7b9c2ece60625742a801edb", "author": {"user": {"login": "Bentleysb", "name": "Bentley Breithaupt"}}, "url": "https://github.com/osmlab/atlas-checks/commit/47576a5fe2191947a7b9c2ece60625742a801edb", "committedDate": "2020-04-17T22:58:45Z", "message": "rm old flagged check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0d5ef8e9dbf0f5d802eead5f6f36a040071d0c0", "author": {"user": null}, "url": "https://github.com/osmlab/atlas-checks/commit/c0d5ef8e9dbf0f5d802eead5f6f36a040071d0c0", "committedDate": "2020-04-21T22:08:18Z", "message": "Merge branch 'dev' into dev-fastShadow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzODAyODE1", "url": "https://github.com/osmlab/atlas-checks/pull/284#pullrequestreview-403802815", "createdAt": "2020-04-30T19:10:39Z", "commit": {"oid": "c0d5ef8e9dbf0f5d802eead5f6f36a040071d0c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzODExOTg1", "url": "https://github.com/osmlab/atlas-checks/pull/284#pullrequestreview-403811985", "createdAt": "2020-04-30T19:24:00Z", "commit": {"oid": "c0d5ef8e9dbf0f5d802eead5f6f36a040071d0c0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxOToyNDowMFrOGO3KZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxOToyNDowMFrOGO3KZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIzNzAzMA==", "bodyText": "@danielduhh, the code smell is because connectedParts.getSecond() is of type Boolean instead of boolean. The resolution seems to be to cast it to a boolean which seems a bit odd/redundant. Sonar is just worried about it being null, which can't happen in this case.", "url": "https://github.com/osmlab/atlas-checks/pull/284#discussion_r418237030", "createdAt": "2020-04-30T19:24:00Z", "author": {"login": "Bentleysb"}, "path": "src/main/java/org/openstreetmap/atlas/checks/validation/areas/ShadowDetectionCheck.java", "diffHunk": "@@ -104,8 +105,8 @@ public boolean validCheckForObject(final AtlasObject object)\n     protected Optional<CheckFlag> flag(final AtlasObject object)\n     {\n         // Gather connected building parts and check for a connection to the ground\n-        final Set<AtlasObject> floatingParts = this.getFloatingParts(object);\n-        if (!floatingParts.isEmpty())\n+        final Tuple<Set<AtlasObject>, Boolean> connectedParts = this.getConnectedParts(object);\n+        if (connectedParts.getSecond())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0d5ef8e9dbf0f5d802eead5f6f36a040071d0c0"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTU0ODg3", "url": "https://github.com/osmlab/atlas-checks/pull/284#pullrequestreview-403954887", "createdAt": "2020-05-01T00:00:37Z", "commit": {"oid": "c0d5ef8e9dbf0f5d802eead5f6f36a040071d0c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3309, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}