{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NDc4ODgy", "number": 418, "title": "Add Map Roulette Upload to AWS script", "bodyText": "Description:\nAdd a bit of code to the AWS script so Map Roulette challenges can be created from data produced from the AWS check script.\nPotential Impact:\nNone to existing functionality. Adds a new command to the script.\nUnit Test Approach:\nI ran this a few times against different log files to produce MR projects and challenges.\nI found one issue during testing for this change: #415\nOnce that bug is fixed processing mr project will be much more consistent.\nTest Results:\nAll good.", "createdAt": "2020-11-11T22:10:39Z", "url": "https://github.com/osmlab/atlas-checks/pull/418", "merged": true, "mergeCommit": {"oid": "fe35dee158afe661c8cc46c47ba7b3aca8503556"}, "closed": true, "closedAt": "2020-11-18T23:01:59Z", "author": {"login": "atiannicelli"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZTvfwgH2gAyNTE5NDc4ODgyOjg4OWU2YzQzNjJhM2UzMTYyOTdmMzEyZWZlNmJhNjg4YzAwYzViNTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd1I9yAFqTUzMzg5NjE4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "889e6c4362a3e316297f312efe6ba688c00c5b53", "author": {"user": {"login": "atiannicelli", "name": "Alex Iannicelli"}}, "url": "https://github.com/osmlab/atlas-checks/commit/889e6c4362a3e316297f312efe6ba688c00c5b53", "committedDate": "2020-11-04T20:25:25Z", "message": "Copy S3 files by default."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5099601931bd2744cf34e55585e3b4c171ccd099", "author": {"user": {"login": "atiannicelli", "name": "Alex Iannicelli"}}, "url": "https://github.com/osmlab/atlas-checks/commit/5099601931bd2744cf34e55585e3b4c171ccd099", "committedDate": "2020-11-04T20:37:10Z", "message": "update to latest version. Need a better way to do this."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7968e4b9428557c3086866ffbe589d2ce2ecd457", "author": {"user": {"login": "atiannicelli", "name": "Alex Iannicelli"}}, "url": "https://github.com/osmlab/atlas-checks/commit/7968e4b9428557c3086866ffbe589d2ce2ecd457", "committedDate": "2020-11-04T20:42:45Z", "message": "wildcard the version as there should only be one."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a35d0e382291ba027db9fd2522a2d4c84904eec4", "author": {"user": {"login": "atiannicelli", "name": "Alex Iannicelli"}}, "url": "https://github.com/osmlab/atlas-checks/commit/a35d0e382291ba027db9fd2522a2d4c84904eec4", "committedDate": "2020-11-09T15:20:05Z", "message": "add some fixes I ran into while testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aebf0d9c509439f54ec22b6585a48dd0f42b6f8a", "author": {"user": {"login": "atiannicelli", "name": "Alex Iannicelli"}}, "url": "https://github.com/osmlab/atlas-checks/commit/aebf0d9c509439f54ec22b6585a48dd0f42b6f8a", "committedDate": "2020-11-09T15:20:17Z", "message": "Merge branch 'dev' of github.com:osmlab/atlas-checks into s3Copy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d74ddf2825049419cc2f206b04b2330bca47ea69", "author": {"user": {"login": "atiannicelli", "name": "Alex Iannicelli"}}, "url": "https://github.com/osmlab/atlas-checks/commit/d74ddf2825049419cc2f206b04b2330bca47ea69", "committedDate": "2020-11-11T22:04:35Z", "message": "Add MR upload command to AWS script."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63a4b53a73bc34ac97d6a7f1be45a08197defd62", "author": {"user": {"login": "atiannicelli", "name": "Alex Iannicelli"}}, "url": "https://github.com/osmlab/atlas-checks/commit/63a4b53a73bc34ac97d6a7f1be45a08197defd62", "committedDate": "2020-11-16T18:57:17Z", "message": "add includeFixSuggestions flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "987a760d007fad7202bd9a0d855055efed854955", "author": {"user": {"login": "atiannicelli", "name": "Alex Iannicelli"}}, "url": "https://github.com/osmlab/atlas-checks/commit/987a760d007fad7202bd9a0d855055efed854955", "committedDate": "2020-11-17T18:18:10Z", "message": "add maxPoolMinutes to maproulette upload command call"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjgyNjk0", "url": "https://github.com/osmlab/atlas-checks/pull/418#pullrequestreview-532682694", "createdAt": "2020-11-17T18:45:55Z", "commit": {"oid": "987a760d007fad7202bd9a0d855055efed854955"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd23d92cb47158998165ac9a12dc6c59cb04b670", "author": {"user": {"login": "atiannicelli", "name": "Alex Iannicelli"}}, "url": "https://github.com/osmlab/atlas-checks/commit/bd23d92cb47158998165ac9a12dc6c59cb04b670", "committedDate": "2020-11-18T15:12:33Z", "message": "Merge branch 'dev' into awsScriptMapRoulette"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODAxMjY0", "url": "https://github.com/osmlab/atlas-checks/pull/418#pullrequestreview-533801264", "createdAt": "2020-11-18T19:26:37Z", "commit": {"oid": "bd23d92cb47158998165ac9a12dc6c59cb04b670"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxOToyNjozN1rOH1-i8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxOToyNjozN1rOH1-i8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2MTMzMQ==", "bodyText": "Could we make the jar location configurable?", "url": "https://github.com/osmlab/atlas-checks/pull/418#discussion_r526361331", "createdAt": "2020-11-18T19:26:37Z", "author": {"login": "seancoulter"}, "path": "scripts/cloud-check-control/cloudAtlasCheckControl.py", "diffHunk": "@@ -231,6 +244,55 @@ def sync(self):\n         if self.terminate:\n             self.terminate_instance()\n \n+    def challenge(self):\n+        logger.info(\"Creating map roulette challenge.\")\n+\n+        # sync the country folders to the local directory\n+        for c in list(self.countries.split(\",\")):\n+            logger.info(\n+                \"syncing {}/flag/{} to {}/flag/{}\".format(\n+                    self.s3OutFolder, c, self.atlasOutDir, c\n+                )\n+            )\n+            if self.ssh_cmd(\n+                \"aws s3 sync --only-show-errors s3://{0}/flag/{1} {2}/flag/{1}\".format(\n+                    self.s3OutFolder, c, self.atlasOutDir\n+                )\n+            ):\n+                finish(\"Failed to sync S3://{}/{}\".format(self.s3OutFolder, c), -1)\n+        if self.ssh_cmd(\n+            \"aws s3 cp s3://{} {}\".format(\n+                self.atlasConfig, os.path.join(self.homeDir, self.atlasConfig)\n+            )\n+        ):\n+            finish(\"Failed to copy config S3://{}\".format(self.atlasConfig), -1)\n+\n+        # push output to s3\n+        cmd = \"aws s3 sync --only-show-errors --exclude *.crc {} s3://{} \".format(\n+            self.atlasOutDir, self.s3OutFolder\n+        )\n+        if self.ssh_cmd(cmd):\n+            finish(\"Unable to sync with S3\", -1)\n+\n+        cmd = (\n+            \"java -cp atlas-checks/build/libs/atlas-checks-*-SNAPSHOT-shaded.jar\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd23d92cb47158998165ac9a12dc6c59cb04b670"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be93b5a421785398fa371ee1924f76b883229086", "author": {"user": {"login": "atiannicelli", "name": "Alex Iannicelli"}}, "url": "https://github.com/osmlab/atlas-checks/commit/be93b5a421785398fa371ee1924f76b883229086", "committedDate": "2020-11-18T20:51:05Z", "message": "Merge branch 'dev' of github.com:osmlab/atlas-checks into awsScriptMapRoulette"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0c4827721fd8bc52961b671f90710c547022fdb", "author": {"user": {"login": "atiannicelli", "name": "Alex Iannicelli"}}, "url": "https://github.com/osmlab/atlas-checks/commit/f0c4827721fd8bc52961b671f90710c547022fdb", "committedDate": "2020-11-18T21:08:07Z", "message": "add parameter for jar file."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODgyMTQy", "url": "https://github.com/osmlab/atlas-checks/pull/418#pullrequestreview-533882142", "createdAt": "2020-11-18T21:15:24Z", "commit": {"oid": "f0c4827721fd8bc52961b671f90710c547022fdb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzODk2MTg4", "url": "https://github.com/osmlab/atlas-checks/pull/418#pullrequestreview-533896188", "createdAt": "2020-11-18T21:35:48Z", "commit": {"oid": "f0c4827721fd8bc52961b671f90710c547022fdb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3219, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}