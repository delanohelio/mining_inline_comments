{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MTIzNTE4", "number": 389, "title": "[JENKINS-59791] Added remote API for blames info", "bodyText": "See JENKINS-59791.", "createdAt": "2020-02-21T06:23:52Z", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389", "merged": true, "mergeCommit": {"oid": "aef2f6c72df915a99829f9c98bb43db234092378"}, "closed": true, "closedAt": "2020-02-23T10:42:39Z", "author": {"login": "XiongKezhi"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGZcWMgH2gAyMzc4MTIzNTE4OmM5NWQyMTZjNjdkZDYyNTg2YTMwYTNjZDVkZWUyZDYyZjQ4MzkzODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcG4Ix1AH2gAyMzc4MTIzNTE4OmFlZjJmNmM3MmRmOTE1YTk5ODI5ZjljOThiYjQzZGIyMzQwOTIzNzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c95d216c67dd62586a30a3cd5dee2d62f4839380", "author": {"user": {"login": "XiongKezhi", "name": "Kezhi Xiong"}}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/c95d216c67dd62586a30a3cd5dee2d62f4839380", "committedDate": "2020-02-21T06:08:13Z", "message": "added BlameApi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58b21630e7729fa7b3394e56bf4d4604aa6fe2b1", "author": {"user": {"login": "XiongKezhi", "name": "Kezhi Xiong"}}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/58b21630e7729fa7b3394e56bf4d4604aa6fe2b1", "committedDate": "2020-02-21T06:37:12Z", "message": "resolved some quality issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57603ba43b63369a513eba8f8a9ae9a8407ecf1c", "author": {"user": {"login": "XiongKezhi", "name": "Kezhi Xiong"}}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/57603ba43b63369a513eba8f8a9ae9a8407ecf1c", "committedDate": "2020-02-21T07:07:40Z", "message": "refactored IssueApi's constructor to allow nullable param"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDUwMjc0", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#pullrequestreview-362450274", "createdAt": "2020-02-21T07:55:35Z", "commit": {"oid": "57603ba43b63369a513eba8f8a9ae9a8407ecf1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwNzo1NTozNlrOFsuT7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwNzo1NTozNlrOFsuT7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0MDQyOA==", "bodyText": "Wouldn't it be much simpler if we denormalize the Blames and add 3 additional getters to IssueApi? Then BlameApi is not required at all?", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382440428", "createdAt": "2020-02-21T07:55:36Z", "author": {"login": "uhafner"}, "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/BlameApi.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package io.jenkins.plugins.analysis.core.restapi;\n+\n+import org.kohsuke.stapler.export.Exported;\n+import org.kohsuke.stapler.export.ExportedBean;\n+\n+import io.jenkins.plugins.forensics.blame.FileBlame;\n+\n+/**\n+ * Remote API for a {@link FileBlame}. Simple Java Bean that exposes several methods of an {@link FileBlame} instance.\n+ *\n+ * @author Kezhi Xiong\n+ */\n+@ExportedBean\n+public class BlameApi {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57603ba43b63369a513eba8f8a9ae9a8407ecf1c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c", "author": {"user": {"login": "XiongKezhi", "name": "Kezhi Xiong"}}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/91da2e5e3e634d94f6b01022aad24ee4c75d2c2c", "committedDate": "2020-02-21T11:43:59Z", "message": "refactored code and deleted the BlameApi for simplicity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMDI5NzYx", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#pullrequestreview-363029761", "createdAt": "2020-02-22T13:49:08Z", "commit": {"oid": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQxMzo0OTowOVrOFtLNfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQxMzo1NzozNFrOFtLPng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxMzkxOA==", "bodyText": "Use Blame from #391.", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382913918", "createdAt": "2020-02-22T13:49:09Z", "author": {"login": "uhafner"}, "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/IssueApi.java", "diffHunk": "@@ -13,15 +16,19 @@\n @ExportedBean\n public class IssueApi {\n     private final Issue issue;\n+    private final FileBlame fileBlame;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxMzkyNg==", "bodyText": "see above", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382913926", "createdAt": "2020-02-22T13:49:23Z", "author": {"login": "uhafner"}, "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/IssueApi.java", "diffHunk": "@@ -13,15 +16,19 @@\n @ExportedBean\n public class IssueApi {\n     private final Issue issue;\n+    private final FileBlame fileBlame;\n \n     /**\n      * Creates a new {@link IssueApi}.\n      *\n      * @param issue\n      *         the issue to expose the properties from\n+     * @param fileBlame\n+     *          the blame of the issue file\n      */\n-    public IssueApi(final Issue issue) {\n+    public IssueApi(final Issue issue, @Nullable final FileBlame fileBlame) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxMzk4MA==", "bodyText": "Using Blame introduced in #391 makes this call much simpler:\nreturn blame.getAuthor();", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382913980", "createdAt": "2020-02-22T13:50:25Z", "author": {"login": "uhafner"}, "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/IssueApi.java", "diffHunk": "@@ -103,4 +110,43 @@ public String getReference() {\n     public String getFingerprint() {\n         return issue.getFingerprint();\n     }\n+\n+    /**\n+     * Returns the author's name of the blame.\n+     *\n+     * @return the name of the author\n+     */\n+    @Exported\n+    public String getAuthor() {\n+        if (fileBlame != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxNDA0Nw==", "bodyText": "I think it makes sense to add an addedAt property as well.", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382914047", "createdAt": "2020-02-22T13:51:11Z", "author": {"login": "uhafner"}, "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/IssueApi.java", "diffHunk": "@@ -103,4 +110,43 @@ public String getReference() {\n     public String getFingerprint() {\n         return issue.getFingerprint();\n     }\n+\n+    /**\n+     * Returns the author's name of the blame.\n+     *\n+     * @return the name of the author\n+     */\n+    @Exported\n+    public String getAuthor() {\n+        if (fileBlame != null) {\n+            return fileBlame.getName(getLineStart());\n+        }\n+        return \"\";\n+    }\n+\n+    /**\n+     * Returns the author's email of the blame.\n+     *\n+     * @return the email of the author\n+     */\n+    @Exported\n+    public String getEmail() {\n+        if (fileBlame != null) {\n+            return fileBlame.getEmail(getLineStart());\n+        }\n+        return \"\";\n+    }\n+\n+    /**\n+     * Returns the commit's sha1 of the blame.\n+     *\n+     * @return the commit's sha1 of the blame\n+     */\n+    @Exported\n+    public String getCommit() {\n+        if (fileBlame != null) {\n+            return fileBlame.getCommit(getLineStart());\n+        }\n+        return \"\";\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxNDQ2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (blames.contains(issue.getFileName())) {\n          \n          \n            \n                        return new IssueApi(issue, blames.getBlame(issue.getFileName()));\n          \n          \n            \n                    }\n          \n          \n            \n                    return new IssueApi(issue, null);\n          \n          \n            \n            return new IssueApi(issue, new Blame(issue, blames));", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382914462", "createdAt": "2020-02-22T13:57:34Z", "author": {"login": "uhafner"}, "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/ReportApi.java", "diffHunk": "@@ -33,7 +40,14 @@ public ReportApi(final Report report) {\n     }\n \n     private List<IssueApi> map() {\n-        return report.stream().map(IssueApi::new).collect(Collectors.toList());\n+        return report.stream().map(this::createIssueApi).collect(Collectors.toList());\n+    }\n+\n+    private IssueApi createIssueApi(final Issue issue) {\n+        if (blames.contains(issue.getFileName())) {\n+            return new IssueApi(issue, blames.getBlame(issue.getFileName()));\n+        }\n+        return new IssueApi(issue, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc12d1e64790c0457439e94c0e0ad185a0ce1956", "author": {"user": {"login": "XiongKezhi", "name": "Kezhi Xiong"}}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/bc12d1e64790c0457439e94c0e0ad185a0ce1956", "committedDate": "2020-02-22T15:48:31Z", "message": "Merge remote-tracking branch 'upstream/master' into JENKINS-59791"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aef2f6c72df915a99829f9c98bb43db234092378", "author": {"user": {"login": "XiongKezhi", "name": "Kezhi Xiong"}}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/aef2f6c72df915a99829f9c98bb43db234092378", "committedDate": "2020-02-22T17:53:54Z", "message": "refactored to use Blame in IssueApi"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 8, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}