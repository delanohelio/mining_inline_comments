{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNDE1MjM0", "number": 414, "title": "[JENKINS-59592] Link issue column to selected type", "bodyText": "See JENKINS-59592", "createdAt": "2020-03-02T14:28:23Z", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/414", "merged": true, "mergeCommit": {"oid": "9f902c1ad939eae955ad12282bfd5f5ed473faf8"}, "closed": true, "closedAt": "2020-03-05T19:35:24Z", "author": {"login": "XiongKezhi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJt616AH2gAyMzgyNDE1MjM0OjUyYTVkMzA2ZjE1MjRjMTRhZThmZDJkMGYyZmQ3NGUwZWJmZTg5OWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKwxh2AFqTM2OTg1NTMzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "52a5d306f1524c14ae8fd2d0f2fd74e0ebfe899a", "author": {"user": {"login": "XiongKezhi", "name": "Kezhi Xiong"}}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/52a5d306f1524c14ae8fd2d0f2fd74e0ebfe899a", "committedDate": "2020-03-02T13:41:24Z", "message": "Link issue column to selected type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c782e3a293b1236679a943b00b3a6d6e120bdb47", "author": {"user": {"login": "XiongKezhi", "name": "Kezhi Xiong"}}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/c782e3a293b1236679a943b00b3a6d6e120bdb47", "committedDate": "2020-03-02T14:25:51Z", "message": "Delelte unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c2dcacfc62a6ecb909b786451053387100de762", "author": {"user": {"login": "XiongKezhi", "name": "Kezhi Xiong"}}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/5c2dcacfc62a6ecb909b786451053387100de762", "committedDate": "2020-03-02T14:36:18Z", "message": "Resolve locale problme when using toLowerCase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NTU2NTM1", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/414#pullrequestreview-368556535", "createdAt": "2020-03-04T07:38:09Z", "commit": {"oid": "5c2dcacfc62a6ecb909b786451053387100de762"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNzozODoxMFrOFxineA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNzo1Mjo0OVrOFxi8SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5MTcwNA==", "bodyText": "Make this more object oriented (tell don't ask).\nAdd a getUrl method in StatisticsProperties. And there add an additional constructor parameter that provides the URL.  E.g. in https://github.com/jenkinsci/warnings-ng-plugin/blob/master/src/main/java/io/jenkins/plugins/analysis/core/util/IssuesStatistics.java#L243:\nNEW_HIGH(Messages._Statistics_New_High(), IssuesStatistics::getNewHighSize, \"new/high\"),\n\nThere is no need to compute it using an algorithm.", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/414#discussion_r387491704", "createdAt": "2020-03-04T07:38:10Z", "author": {"login": "uhafner"}, "path": "src/main/java/io/jenkins/plugins/analysis/core/columns/IssuesTotalColumn.java", "diffHunk": "@@ -264,12 +264,18 @@ public ListBoxModel doFillTypeItems() {\n             this.url = url;\n         }\n \n-        AnalysisResultDescription(final ResultAction result, final LabelProviderFactory labelProviderFactory) {\n+        AnalysisResultDescription(final ResultAction result, final LabelProviderFactory labelProviderFactory,\n+                final StatisticProperties type) {\n             StaticAnalysisLabelProvider labelProvider = labelProviderFactory.create(result.getId(), result.getName());\n             name = labelProvider.getLinkName();\n             icon = labelProvider.getSmallIconUrl();\n             total = result.getResult().getTotalSize();\n-            url = result.getUrlName();\n+\n+            String typeUrl = type.name().split(\"_\")[0];\n+            if (!typeUrl.matches(\"NEW|FIXED\")) {\n+                typeUrl = \"\";\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2dcacfc62a6ecb909b786451053387100de762"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5MzgyMQ==", "bodyText": "Maybe it is even better to provide a method getUrl that has an extra parameter prefix that handles the problem that the URL should not have a slash as last element. Then we can invoke it with\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        String typeUrl = type.name().split(\"_\")[0];\n          \n          \n            \n                        if (!typeUrl.matches(\"NEW|FIXED\")) {\n          \n          \n            \n                            typeUrl = \"\";\n          \n          \n            \n                        }\n          \n          \n            \n            url = type.getUrl(result.getOwner().getNumber() + \"/\" + result.getUrlName())", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/414#discussion_r387493821", "createdAt": "2020-03-04T07:44:05Z", "author": {"login": "uhafner"}, "path": "src/main/java/io/jenkins/plugins/analysis/core/columns/IssuesTotalColumn.java", "diffHunk": "@@ -264,12 +264,18 @@ public ListBoxModel doFillTypeItems() {\n             this.url = url;\n         }\n \n-        AnalysisResultDescription(final ResultAction result, final LabelProviderFactory labelProviderFactory) {\n+        AnalysisResultDescription(final ResultAction result, final LabelProviderFactory labelProviderFactory,\n+                final StatisticProperties type) {\n             StaticAnalysisLabelProvider labelProvider = labelProviderFactory.create(result.getId(), result.getName());\n             name = labelProvider.getLinkName();\n             icon = labelProvider.getSmallIconUrl();\n             total = result.getResult().getTotalSize();\n-            url = result.getUrlName();\n+\n+            String typeUrl = type.name().split(\"_\")[0];\n+            if (!typeUrl.matches(\"NEW|FIXED\")) {\n+                typeUrl = \"\";\n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5MTcwNA=="}, "originalCommit": {"oid": "5c2dcacfc62a6ecb909b786451053387100de762"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5NTkyNQ==", "bodyText": "I wonder that this works, typically you need to split when and mock.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        when(resultAction.getOwner()).thenReturn(mock(Run.class));\n          \n          \n            \n                        Run<?> run = mock(Run.class);\n          \n          \n            \n                        for (ResultAction resultAction : job.getLastCompletedBuild().getActions(ResultAction.class)) {\n          \n          \n            \n                            when(resultAction.getOwner()).thenReturn(run);\n          \n          \n            \n                        }", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/414#discussion_r387495925", "createdAt": "2020-03-04T07:49:57Z", "author": {"login": "uhafner"}, "path": "src/test/java/io/jenkins/plugins/analysis/core/columns/IssuesTotalColumnTest.java", "diffHunk": "@@ -153,8 +155,14 @@ private void verifySumOfChecksStyleAndSpotBugs(final IssuesTotalColumn column) {\n         assertThat(column.getTotal(job)).hasValue(1 + 2);\n         assertThat(column.getUrl(job)).isEmpty();\n \n+        for (ResultAction resultAction : job.getLastCompletedBuild().getActions(ResultAction.class)) {\n+            when(resultAction.getOwner()).thenReturn(mock(Run.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2dcacfc62a6ecb909b786451053387100de762"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5NzAzMg==", "bodyText": "I would expect that some tests fail after your change: https://github.com/jenkinsci/warnings-ng-plugin/blob/master/src/test/java/io/jenkins/plugins/analysis/core/columns/IssuesTotalColumnTest.java#L83\nThere should be a reference to new? Also it would be nice to have a test that uses a severity.", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/414#discussion_r387497032", "createdAt": "2020-03-04T07:52:49Z", "author": {"login": "uhafner"}, "path": "src/main/java/io/jenkins/plugins/analysis/core/columns/IssuesTotalColumn.java", "diffHunk": "@@ -264,12 +264,18 @@ public ListBoxModel doFillTypeItems() {\n             this.url = url;\n         }\n \n-        AnalysisResultDescription(final ResultAction result, final LabelProviderFactory labelProviderFactory) {\n+        AnalysisResultDescription(final ResultAction result, final LabelProviderFactory labelProviderFactory,\n+                final StatisticProperties type) {\n             StaticAnalysisLabelProvider labelProvider = labelProviderFactory.create(result.getId(), result.getName());\n             name = labelProvider.getLinkName();\n             icon = labelProvider.getSmallIconUrl();\n             total = result.getResult().getTotalSize();\n-            url = result.getUrlName();\n+\n+            String typeUrl = type.name().split(\"_\")[0];\n+            if (!typeUrl.matches(\"NEW|FIXED\")) {\n+                typeUrl = \"\";\n+            }\n+            url = result.getOwner().getNumber() + \"/\" + result.getUrlName() + \"/\" + typeUrl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2dcacfc62a6ecb909b786451053387100de762"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e231068b1005caee9f8b10237cf2c6d6eba92114", "author": {"user": {"login": "XiongKezhi", "name": "Kezhi Xiong"}}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/e231068b1005caee9f8b10237cf2c6d6eba92114", "committedDate": "2020-03-05T13:29:18Z", "message": "Add getUrl to IssuesTablePortletDescriptor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODU1MzM4", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/414#pullrequestreview-369855338", "createdAt": "2020-03-05T19:34:52Z", "commit": {"oid": "e231068b1005caee9f8b10237cf2c6d6eba92114"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 12, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}