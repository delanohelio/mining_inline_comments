{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4ODEyNDU3", "number": 686, "title": "Include counts by severity in aggregation API response.", "bodyText": "Former versions of analysis plugins included a count breakdown by severity in their APIs. In order to expose the counts by severity, one would need to call the current aggregation API, and then for each tool, call the latestUrl and count the issues by severity. Fortunately, the data is already available in a map, and just needs to be passed back in the response. This PR does that.\nInitial attempts were to add this method to ToolApi\n@Exported\npublic Map<Severity, Integer> getSizePerSeverity() {\n   ...\n}\n\nbut in the API response, the field was rendered as sizePerSeverity: [63, 0, 0, 0] instead of as a JSON map. Wasn't sure how to fix that, so I instead created 4 getters, one for each severity.\nAssumption - That the sizePerSeverity map is not null and properly populated such that the sum of counts across all severities add up to the total number of issues. That is, all issues have a severity. If this is not the case, then an additional getter could be added to show unrankedSize, which would be (size - (error + high + normal + low)).\nI deployed the compiled hpi file to a Jenkins instance. This is a sample response (note that fields come back in alphabetical, rather than logical order as shown in the documentation which should not be an issue for consumers of the API).\n{\n  \"_class\": \"io.jenkins.plugins.analysis.core.restapi.AggregationApi\",\n  \"tools\": [\n    {\n      \"errorSize\": 63,\n      \"highSize\": 0,\n      \"id\": \"checkstyle\",\n      \"latestUrl\": \"http://.../job/SpringBootApp_IT/30/checkstyle\",\n      \"lowSize\": 0,\n      \"name\": \"CheckStyle Warnings\",\n      \"normalSize\": 0,\n      \"size\": 63\n    },\n    {\n      \"errorSize\": 0,\n      \"highSize\": 0,\n      \"id\": \"pmd\",\n      \"latestUrl\": \"http://.../job/SpringBootApp_IT/30/pmd\",\n      \"lowSize\": 0,\n      \"name\": \"PMD Warnings\",\n      \"normalSize\": 3,\n      \"size\": 3\n    }\n  ]\n}", "createdAt": "2020-11-10T22:54:10Z", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/686", "merged": true, "mergeCommit": {"oid": "0fe4c70a1c0e143b43f57d721c3283319f5dbb38"}, "closed": true, "closedAt": "2020-11-13T23:25:29Z", "author": {"login": "douglasbgray"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbRQqzgH2gAyNTE4ODEyNDU3OjE0NjIyNmEyMDc3YmYwZjg5ODM3ZDU5ZGMwMzMzMjdmYzI5NDNiODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcL4vngFqTUzMDMyNzQ1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "146226a2077bf0f89837d59dc033327fc2943b86", "author": {"user": null}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/146226a2077bf0f89837d59dc033327fc2943b86", "committedDate": "2020-11-10T22:39:47Z", "message": "Include counts by severity in aggregation API response."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMTE5MTI5", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/686#pullrequestreview-530119129", "createdAt": "2020-11-13T14:44:23Z", "commit": {"oid": "146226a2077bf0f89837d59dc033327fc2943b86"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNDo0NDoyM1rOHyxCwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNDo0NToyNVrOHyxFeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjk5NDM3MA==", "bodyText": "Do not delete the old constructor, rather mark it as deprecated and call the new one with an empty map so that other consumers of this API still need no changes. (See build failure due to revapi.)", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/686#discussion_r522994370", "createdAt": "2020-11-13T14:44:23Z", "author": {"login": "uhafner"}, "path": "plugin/src/main/java/io/jenkins/plugins/analysis/core/restapi/ToolApi.java", "diffHunk": "@@ -28,12 +33,17 @@\n      *         the URL to the latest results\n      * @param size\n      *         the number of warnings\n+     * @param sizePerSeverity\n+     *         the number of warnings, grouped by severity. Assumption is that\n+     *         this is not null, and that it is properly populated with counts\n+     *         that when summed, total the \"size\" parameter.\n      */\n-    public ToolApi(final String id, final String name, final String latestUrl, final int size) {\n+    public ToolApi(final String id, final String name, final String latestUrl, final int size, final Map<Severity, Integer> sizePerSeverity) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "146226a2077bf0f89837d59dc033327fc2943b86"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjk5NTA2NA==", "bodyText": "Your assumption is correct.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 *         the number of warnings, grouped by severity. Assumption is that\n          \n          \n            \n                 *         this is not null, and that it is properly populated with counts\n          \n          \n            \n                 *         that when summed, total the \"size\" parameter.\n          \n          \n            \n                 *         the number of warnings, grouped by severity", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/686#discussion_r522995064", "createdAt": "2020-11-13T14:45:25Z", "author": {"login": "uhafner"}, "path": "plugin/src/main/java/io/jenkins/plugins/analysis/core/restapi/ToolApi.java", "diffHunk": "@@ -28,12 +33,17 @@\n      *         the URL to the latest results\n      * @param size\n      *         the number of warnings\n+     * @param sizePerSeverity\n+     *         the number of warnings, grouped by severity. Assumption is that\n+     *         this is not null, and that it is properly populated with counts\n+     *         that when summed, total the \"size\" parameter.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "146226a2077bf0f89837d59dc033327fc2943b86"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4566a73e2088af70276a83271107f5f3c31775ad", "author": {"user": null}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/4566a73e2088af70276a83271107f5f3c31775ad", "committedDate": "2020-11-13T17:23:48Z", "message": "Deprecate former constructor. Remove comment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdcce460285685af41ac91eff652886e4ad64345", "author": {"user": null}, "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/fdcce460285685af41ac91eff652886e4ad64345", "committedDate": "2020-11-13T18:24:17Z", "message": "Remove trailing period (for consistency)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMzI3NDU0", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/686#pullrequestreview-530327454", "createdAt": "2020-11-13T18:58:03Z", "commit": {"oid": "fdcce460285685af41ac91eff652886e4ad64345"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 108, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}