{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4OTQ4NTQ0", "number": 1609, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMDowMjowOFrOEUi5FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMDowMzoxM1rOEUi6SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5OTc4NjQ0OnYy", "diffSide": "RIGHT", "path": "src/main/java/apoc/refactor/rename/Rename.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMDowMjowOFrOG6zpJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDowNToyMFrOHafRXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMxNjcxMA==", "bodyText": "need to update description", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1609#discussion_r464316710", "createdAt": "2020-08-03T10:02:08Z", "author": {"login": "jexp"}, "path": "src/main/java/apoc/refactor/rename/Rename.java", "diffHunk": "@@ -61,27 +63,52 @@\n \t */\n \t@Procedure(mode = Mode.WRITE)\n \t@Description(\"apoc.refactor.rename.type(oldType, newType, [rels]) | rename all relationships with type 'oldType' to 'newType'. If 'rels' is provided renaming is applied to this set only\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e945e6c31fd72691e7b8c75ca4764bd6e014a2db"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUzNzM3Mw==", "bodyText": "done", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1609#discussion_r497537373", "createdAt": "2020-09-30T14:05:20Z", "author": {"login": "conker84"}, "path": "src/main/java/apoc/refactor/rename/Rename.java", "diffHunk": "@@ -61,27 +63,52 @@\n \t */\n \t@Procedure(mode = Mode.WRITE)\n \t@Description(\"apoc.refactor.rename.type(oldType, newType, [rels]) | rename all relationships with type 'oldType' to 'newType'. If 'rels' is provided renaming is applied to this set only\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMxNjcxMA=="}, "originalCommit": {"oid": "e945e6c31fd72691e7b8c75ca4764bd6e014a2db"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5OTc4Nzg2OnYy", "diffSide": "RIGHT", "path": "src/main/java/apoc/refactor/rename/Rename.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMDowMjo0MlrOG6zqHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDowNzoyNFrOHafXZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMxNjk1Ng==", "bodyText": "perhaps move to Periodic.java or Util.java?", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1609#discussion_r464316956", "createdAt": "2020-08-03T10:02:42Z", "author": {"login": "jexp"}, "path": "src/main/java/apoc/refactor/rename/Rename.java", "diffHunk": "@@ -61,27 +63,52 @@\n \t */\n \t@Procedure(mode = Mode.WRITE)\n \t@Description(\"apoc.refactor.rename.type(oldType, newType, [rels]) | rename all relationships with type 'oldType' to 'newType'. If 'rels' is provided renaming is applied to this set only\")\n-\tpublic Stream<BatchAndTotalResultWithInfo> type(@Name(\"oldType\") String oldType, @Name(\"newType\") String newType, @Name(value = \"rels\", defaultValue = \"[]\") List<Relationship> rels) {\n+\tpublic Stream<BatchAndTotalResultWithInfo> type(@Name(\"oldType\") String oldType,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(\"newType\") String newType,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(value = \"rels\", defaultValue = \"[]\") List<Relationship> rels,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(value = \"config\", defaultValue = \"{}\") Map<String, Object> config) {\n \t\trels = rels.stream().map(r -> Util.rebind(tx, r)).collect(Collectors.toList());\n-\t\tList<Long> relIds = rels.stream().map(r -> r.getId()).collect(Collectors.toList());\n \t\tString cypherIterate = rels != null && ! rels.isEmpty() ?\n \t\t\t\t\"UNWIND $rels AS oldRel WITH oldRel WHERE type(oldRel)=\\\"\"+oldType+\"\\\" RETURN oldRel,startNode(oldRel) as a,endNode(oldRel) as b\" :\n \t\t\t\t\"MATCH (a)-[oldRel:`\"+oldType+\"`]->(b) RETURN oldRel,a,b\";\n \t\tString cypherAction = \"CREATE(a)-[newRel:`\"+newType+\"`]->(b)\"+ \"SET newRel+=oldRel DELETE oldRel\";\n-\t\tMap<String, Object> parameters = MapUtil.map(\"batchSize\", 100000, \"parallel\", true, \"iterateList\", true, \"params\", MapUtil.map(\"rels\", rels));\n+\t\tfinal Map<String, Object> params = MapUtil.map(\"rels\", rels);\n+\t\tMap<String, Object> parameters = getPeriodicConfig(config, params);\n \t\treturn getResultOfBatchAndTotalWithInfo(newPeriodic().iterate(cypherIterate, cypherAction, parameters), db, null, oldType, null);\n \t}\n \n+\t@NotNull", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e945e6c31fd72691e7b8c75ca4764bd6e014a2db"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUzODkxOQ==", "bodyText": "I prefer to leave it here because the defaults are custom defined in this procedure", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1609#discussion_r497538919", "createdAt": "2020-09-30T14:07:24Z", "author": {"login": "conker84"}, "path": "src/main/java/apoc/refactor/rename/Rename.java", "diffHunk": "@@ -61,27 +63,52 @@\n \t */\n \t@Procedure(mode = Mode.WRITE)\n \t@Description(\"apoc.refactor.rename.type(oldType, newType, [rels]) | rename all relationships with type 'oldType' to 'newType'. If 'rels' is provided renaming is applied to this set only\")\n-\tpublic Stream<BatchAndTotalResultWithInfo> type(@Name(\"oldType\") String oldType, @Name(\"newType\") String newType, @Name(value = \"rels\", defaultValue = \"[]\") List<Relationship> rels) {\n+\tpublic Stream<BatchAndTotalResultWithInfo> type(@Name(\"oldType\") String oldType,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(\"newType\") String newType,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(value = \"rels\", defaultValue = \"[]\") List<Relationship> rels,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(value = \"config\", defaultValue = \"{}\") Map<String, Object> config) {\n \t\trels = rels.stream().map(r -> Util.rebind(tx, r)).collect(Collectors.toList());\n-\t\tList<Long> relIds = rels.stream().map(r -> r.getId()).collect(Collectors.toList());\n \t\tString cypherIterate = rels != null && ! rels.isEmpty() ?\n \t\t\t\t\"UNWIND $rels AS oldRel WITH oldRel WHERE type(oldRel)=\\\"\"+oldType+\"\\\" RETURN oldRel,startNode(oldRel) as a,endNode(oldRel) as b\" :\n \t\t\t\t\"MATCH (a)-[oldRel:`\"+oldType+\"`]->(b) RETURN oldRel,a,b\";\n \t\tString cypherAction = \"CREATE(a)-[newRel:`\"+newType+\"`]->(b)\"+ \"SET newRel+=oldRel DELETE oldRel\";\n-\t\tMap<String, Object> parameters = MapUtil.map(\"batchSize\", 100000, \"parallel\", true, \"iterateList\", true, \"params\", MapUtil.map(\"rels\", rels));\n+\t\tfinal Map<String, Object> params = MapUtil.map(\"rels\", rels);\n+\t\tMap<String, Object> parameters = getPeriodicConfig(config, params);\n \t\treturn getResultOfBatchAndTotalWithInfo(newPeriodic().iterate(cypherIterate, cypherAction, parameters), db, null, oldType, null);\n \t}\n \n+\t@NotNull", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMxNjk1Ng=="}, "originalCommit": {"oid": "e945e6c31fd72691e7b8c75ca4764bd6e014a2db"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5OTc4OTEwOnYy", "diffSide": "RIGHT", "path": "src/main/java/apoc/refactor/rename/Rename.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMDowMzowMlrOG6zq2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDowNzoyOFrOHafXnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMxNzE0NA==", "bodyText": "adjust description", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1609#discussion_r464317144", "createdAt": "2020-08-03T10:03:02Z", "author": {"login": "jexp"}, "path": "src/main/java/apoc/refactor/rename/Rename.java", "diffHunk": "@@ -61,27 +63,52 @@\n \t */\n \t@Procedure(mode = Mode.WRITE)\n \t@Description(\"apoc.refactor.rename.type(oldType, newType, [rels]) | rename all relationships with type 'oldType' to 'newType'. If 'rels' is provided renaming is applied to this set only\")\n-\tpublic Stream<BatchAndTotalResultWithInfo> type(@Name(\"oldType\") String oldType, @Name(\"newType\") String newType, @Name(value = \"rels\", defaultValue = \"[]\") List<Relationship> rels) {\n+\tpublic Stream<BatchAndTotalResultWithInfo> type(@Name(\"oldType\") String oldType,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(\"newType\") String newType,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(value = \"rels\", defaultValue = \"[]\") List<Relationship> rels,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(value = \"config\", defaultValue = \"{}\") Map<String, Object> config) {\n \t\trels = rels.stream().map(r -> Util.rebind(tx, r)).collect(Collectors.toList());\n-\t\tList<Long> relIds = rels.stream().map(r -> r.getId()).collect(Collectors.toList());\n \t\tString cypherIterate = rels != null && ! rels.isEmpty() ?\n \t\t\t\t\"UNWIND $rels AS oldRel WITH oldRel WHERE type(oldRel)=\\\"\"+oldType+\"\\\" RETURN oldRel,startNode(oldRel) as a,endNode(oldRel) as b\" :\n \t\t\t\t\"MATCH (a)-[oldRel:`\"+oldType+\"`]->(b) RETURN oldRel,a,b\";\n \t\tString cypherAction = \"CREATE(a)-[newRel:`\"+newType+\"`]->(b)\"+ \"SET newRel+=oldRel DELETE oldRel\";\n-\t\tMap<String, Object> parameters = MapUtil.map(\"batchSize\", 100000, \"parallel\", true, \"iterateList\", true, \"params\", MapUtil.map(\"rels\", rels));\n+\t\tfinal Map<String, Object> params = MapUtil.map(\"rels\", rels);\n+\t\tMap<String, Object> parameters = getPeriodicConfig(config, params);\n \t\treturn getResultOfBatchAndTotalWithInfo(newPeriodic().iterate(cypherIterate, cypherAction, parameters), db, null, oldType, null);\n \t}\n \n+\t@NotNull\n+\tprivate Map<String, Object> getPeriodicConfig(@Name(value = \"config\", defaultValue = \"{}\") Map<String, Object> config, Map<String, Object> params) {\n+\t\tif (config == null) {\n+\t\t\tconfig = Collections.emptyMap();\n+\t\t}\n+\t\tfinal int batchSize = Util.toInteger(config.getOrDefault(\"batchSize\", 100000));\n+\t\tfinal int concurrency = Util.toInteger(config.getOrDefault(\"concurrency\", 50));\n+\t\tfinal int retries = Util.toInteger(config.getOrDefault(\"retries\", 0));\n+\t\tfinal boolean parallel = Util.toBoolean(config.getOrDefault(\"parallel\", true));\n+\t\tfinal String batchMode = config.getOrDefault(\"batchMode\", \"BATCH\").toString();\n+\t\treturn MapUtil.map(\"batchSize\", batchSize,\n+\t\t\t\t\"retries\", retries,\n+\t\t\t\t\"parallel\", parallel,\n+\t\t\t\t\"batchMode\", batchMode,\n+\t\t\t\t\"concurrency\", concurrency,\n+\t\t\t\t\"params\", params);\n+\t}\n+\n \t/**\n \t * Rename property of a node by creating a new one and deleting the old.\n \t */\n \t@Procedure(mode = Mode.WRITE)\n \t@Description(\"apoc.refactor.rename.nodeProperty(oldName, newName, [nodes]) | rename all node's property from 'oldName' to 'newName'. If 'nodes' is provided renaming is applied to this set only\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e945e6c31fd72691e7b8c75ca4764bd6e014a2db"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUzODk3NQ==", "bodyText": "done", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1609#discussion_r497538975", "createdAt": "2020-09-30T14:07:28Z", "author": {"login": "conker84"}, "path": "src/main/java/apoc/refactor/rename/Rename.java", "diffHunk": "@@ -61,27 +63,52 @@\n \t */\n \t@Procedure(mode = Mode.WRITE)\n \t@Description(\"apoc.refactor.rename.type(oldType, newType, [rels]) | rename all relationships with type 'oldType' to 'newType'. If 'rels' is provided renaming is applied to this set only\")\n-\tpublic Stream<BatchAndTotalResultWithInfo> type(@Name(\"oldType\") String oldType, @Name(\"newType\") String newType, @Name(value = \"rels\", defaultValue = \"[]\") List<Relationship> rels) {\n+\tpublic Stream<BatchAndTotalResultWithInfo> type(@Name(\"oldType\") String oldType,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(\"newType\") String newType,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(value = \"rels\", defaultValue = \"[]\") List<Relationship> rels,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t@Name(value = \"config\", defaultValue = \"{}\") Map<String, Object> config) {\n \t\trels = rels.stream().map(r -> Util.rebind(tx, r)).collect(Collectors.toList());\n-\t\tList<Long> relIds = rels.stream().map(r -> r.getId()).collect(Collectors.toList());\n \t\tString cypherIterate = rels != null && ! rels.isEmpty() ?\n \t\t\t\t\"UNWIND $rels AS oldRel WITH oldRel WHERE type(oldRel)=\\\"\"+oldType+\"\\\" RETURN oldRel,startNode(oldRel) as a,endNode(oldRel) as b\" :\n \t\t\t\t\"MATCH (a)-[oldRel:`\"+oldType+\"`]->(b) RETURN oldRel,a,b\";\n \t\tString cypherAction = \"CREATE(a)-[newRel:`\"+newType+\"`]->(b)\"+ \"SET newRel+=oldRel DELETE oldRel\";\n-\t\tMap<String, Object> parameters = MapUtil.map(\"batchSize\", 100000, \"parallel\", true, \"iterateList\", true, \"params\", MapUtil.map(\"rels\", rels));\n+\t\tfinal Map<String, Object> params = MapUtil.map(\"rels\", rels);\n+\t\tMap<String, Object> parameters = getPeriodicConfig(config, params);\n \t\treturn getResultOfBatchAndTotalWithInfo(newPeriodic().iterate(cypherIterate, cypherAction, parameters), db, null, oldType, null);\n \t}\n \n+\t@NotNull\n+\tprivate Map<String, Object> getPeriodicConfig(@Name(value = \"config\", defaultValue = \"{}\") Map<String, Object> config, Map<String, Object> params) {\n+\t\tif (config == null) {\n+\t\t\tconfig = Collections.emptyMap();\n+\t\t}\n+\t\tfinal int batchSize = Util.toInteger(config.getOrDefault(\"batchSize\", 100000));\n+\t\tfinal int concurrency = Util.toInteger(config.getOrDefault(\"concurrency\", 50));\n+\t\tfinal int retries = Util.toInteger(config.getOrDefault(\"retries\", 0));\n+\t\tfinal boolean parallel = Util.toBoolean(config.getOrDefault(\"parallel\", true));\n+\t\tfinal String batchMode = config.getOrDefault(\"batchMode\", \"BATCH\").toString();\n+\t\treturn MapUtil.map(\"batchSize\", batchSize,\n+\t\t\t\t\"retries\", retries,\n+\t\t\t\t\"parallel\", parallel,\n+\t\t\t\t\"batchMode\", batchMode,\n+\t\t\t\t\"concurrency\", concurrency,\n+\t\t\t\t\"params\", params);\n+\t}\n+\n \t/**\n \t * Rename property of a node by creating a new one and deleting the old.\n \t */\n \t@Procedure(mode = Mode.WRITE)\n \t@Description(\"apoc.refactor.rename.nodeProperty(oldName, newName, [nodes]) | rename all node's property from 'oldName' to 'newName'. If 'nodes' is provided renaming is applied to this set only\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMxNzE0NA=="}, "originalCommit": {"oid": "e945e6c31fd72691e7b8c75ca4764bd6e014a2db"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5OTc4OTUzOnYy", "diffSide": "RIGHT", "path": "src/main/java/apoc/refactor/rename/Rename.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxMDowMzoxM1rOG6zrMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNDowNzozMlrOHafXyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMxNzIzMg==", "bodyText": "description", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1609#discussion_r464317232", "createdAt": "2020-08-03T10:03:13Z", "author": {"login": "jexp"}, "path": "src/main/java/apoc/refactor/rename/Rename.java", "diffHunk": "@@ -90,11 +117,15 @@\n \t */\n \t@Procedure(mode = Mode.WRITE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e945e6c31fd72691e7b8c75ca4764bd6e014a2db"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzUzOTAxOQ==", "bodyText": "done", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1609#discussion_r497539019", "createdAt": "2020-09-30T14:07:32Z", "author": {"login": "conker84"}, "path": "src/main/java/apoc/refactor/rename/Rename.java", "diffHunk": "@@ -90,11 +117,15 @@\n \t */\n \t@Procedure(mode = Mode.WRITE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDMxNzIzMg=="}, "originalCommit": {"oid": "e945e6c31fd72691e7b8c75ca4764bd6e014a2db"}, "originalPosition": 77}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4335, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}