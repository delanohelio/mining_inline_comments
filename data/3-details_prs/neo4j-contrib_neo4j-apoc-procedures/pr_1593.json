{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4OTY3MjEx", "number": 1593, "title": "fixes #1581: Error in query - CALL apoc.schema.nodes()", "bodyText": "Fixes #1581\nThis PR contains two changes the one related to #1518 (because otherwise I had compilation problems) and the changes required to fix the problem raised in the #1581\nFix the problem has been not quite straightforward because seems there is a bug in the Neo4j so I had to provide the workaround that you can find in Schemas.java from line 438 to 451.\nProposed Changes (Mandatory)\nA brief list of proposed changes in order to fix the issue:\n\nFixed the bug", "createdAt": "2020-07-14T15:52:32Z", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1593", "merged": true, "mergeCommit": {"oid": "6e67d2f27e44cf98c5e2bc683b7cd7dec18310bc"}, "closed": true, "closedAt": "2020-07-20T13:34:12Z", "author": {"login": "conker84"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc11eAsgFqTQ1MDc0Nzg0OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2wbGPABqjM1NjU0NTQ2NjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNzQ3ODQ4", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1593#pullrequestreview-450747848", "createdAt": "2020-07-17T15:21:49Z", "commit": {"oid": "287c1de3fec37270c2c4b172a1b89d1d91281daf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNzUwODgw", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1593#pullrequestreview-450750880", "createdAt": "2020-07-17T15:25:42Z", "commit": {"oid": "287c1de3fec37270c2c4b172a1b89d1d91281daf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNToyNTo0MlrOGzXWlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNToyNTo0MlrOGzXWlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUxMzE3Mg==", "bodyText": "@conker84 I think you said it will work across all versions if we use the procedure approach? If so, let's do that and not bother calling the API in the lines above.", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1593#discussion_r456513172", "createdAt": "2020-07-17T15:25:42Z", "author": {"login": "mneedham"}, "path": "src/main/java/apoc/schema/Schemas.java", "diffHunk": "@@ -417,6 +435,20 @@ private IndexConstraintNodeInfo nodeInfoFromIndexDefinition(IndexReference index\n         List<String> properties = new ArrayList<>();\n         Arrays.stream(indexReference.properties()).forEach((i) -> properties.add(tokens.propertyKeyGetName(i)));\n         try {\n+            float populationProgressValue;\n+            try {\n+                final PopulationProgress populationProgress = schemaRead.indexGetPopulationProgress(indexReference);\n+                populationProgressValue = populationProgress.getCompleted() / populationProgress.getTotal() * 100;\n+            } catch (IncompatibleClassChangeError e) {\n+                // Workaround because in Neo4j 3.5.19 we have the following error\n+                // Failed to invoke procedure `apoc.schema.nodes`: Caused by: java.lang.IncompatibleClassChangeError: Found interface org.neo4j.storageengine.api.schema.PopulationProgress, but class was expected\n+                populationProgressValue = db.execute(\"CALL db.indexes() YIELD tokenNames, properties, progress \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "287c1de3fec37270c2c4b172a1b89d1d91281daf"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91327eabf9f41ab0bf12b61def762070ab3a843f", "author": {"user": {"login": "conker84", "name": "Andrea Santurbano"}}, "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/commit/91327eabf9f41ab0bf12b61def762070ab3a843f", "committedDate": "2020-07-20T12:02:48Z", "message": "fixes #1581: Error in query - CALL apoc.schema.nodes()"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "287c1de3fec37270c2c4b172a1b89d1d91281daf", "author": {"user": {"login": "conker84", "name": "Andrea Santurbano"}}, "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/commit/287c1de3fec37270c2c4b172a1b89d1d91281daf", "committedDate": "2020-07-14T15:45:30Z", "message": "fixes #1581: Error in query - CALL apoc.schema.nodes()"}, "afterCommit": {"oid": "91327eabf9f41ab0bf12b61def762070ab3a843f", "author": {"user": {"login": "conker84", "name": "Andrea Santurbano"}}, "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/commit/91327eabf9f41ab0bf12b61def762070ab3a843f", "committedDate": "2020-07-20T12:02:48Z", "message": "fixes #1581: Error in query - CALL apoc.schema.nodes()"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 935, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}