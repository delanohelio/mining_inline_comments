{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0Njg4NTk1", "number": 1708, "title": "fixes #1705: Quote identifiers starting with a dollar character", "bodyText": "Fixes #1705\nChecking the documentation for Cypher the $ character seems to be forbidden at the start of a Neo4j identifier as opposed to a Java identifier. This causes the issue from #1705.\nProposed Changes\n\nCheck in Util.quote whether the passed identifier starts with a $ character and then quote it, even if it is a valid Java identifier\nAdd test cases for the identifier $lock and others mentioned in the documentation for Cypher\nEnsure that quotes are not applied in cases which previously where not quoted and which do work without quotes. This helps to avoid many test failures e.g. in ExportCypherTest\n\nReasoning\nNeo4j Browser for example quotes defensively (i.e. more than absolutely necessary). The rule Neo4j Browser seems to use is to quote every identifier containing non-alphabetic characters (e.g. even some_var or _id).\nIf Util.quote similarly where to use defensive quoting, identifiers such as _id would have also been quoted causing the aforementioned test failures from 3.", "createdAt": "2020-11-03T12:06:19Z", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1708", "merged": true, "mergeCommit": {"oid": "382db945c1646551de2517e98243fb56081180f0"}, "closed": true, "closedAt": "2020-11-19T14:13:48Z", "author": {"login": "Phoosha"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZK1MvAFqTUyMzE5NzIxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZfZHfAFqTUyNDA5ODcwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMTk3MjEy", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1708#pullrequestreview-523197212", "createdAt": "2020-11-04T09:49:36Z", "commit": {"oid": "753e01f83ad446c5e2fc52ddb45b85c77fb257f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwOTo0OTozNlrOHtQiyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwOTo0OTozNlrOHtQiyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzIxOTAxNw==", "bodyText": "maybe makes sense trim the string?", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1708#discussion_r517219017", "createdAt": "2020-11-04T09:49:36Z", "author": {"login": "conker84"}, "path": "core/src/test/java/apoc/util/UtilQuoteTest.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package apoc.util;\n+\n+import org.junit.ClassRule;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import org.neo4j.test.rule.DbmsRule;\n+import org.neo4j.test.rule.ImpermanentDbmsRule;\n+\n+import java.util.Arrays;\n+import java.util.Collection;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assume.assumeTrue;\n+\n+@RunWith(Parameterized.class)\n+public class UtilQuoteTest {\n+\n+    @ClassRule\n+    public static DbmsRule db = new ImpermanentDbmsRule();\n+\n+    @Parameterized.Parameters\n+    public static Collection<Object[]> parameters() {\n+        return Arrays.asList(new Object[][] {\n+                { \"abc\", true },\n+                { \"_id\", true },\n+                { \"some_var\", true },\n+                { \"$lock\", false },\n+                { \"has$inside\", true },\n+                { \"\u00e4hhh\", true },\n+                { \"r\u00fcbe\", true },\n+                { \"r\u00e5dhuset\", true },\n+                { \"1first\", false },\n+                { \"first1\", true },\n+                { \"a weird identifier\", false },\n+                { \"^n\", false },\n+                { \"$$n\", false },\n+                { \" $var \", false },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753e01f83ad446c5e2fc52ddb45b85c77fb257f8"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0dc1a16ce41cf59d84f2db3891a9f2e6f457a1a1", "author": {"user": {"login": "Phoosha", "name": "Andreas Born"}}, "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/commit/0dc1a16ce41cf59d84f2db3891a9f2e6f457a1a1", "committedDate": "2020-11-04T12:28:08Z", "message": "fixes #1705: Quote identifiers starting with dollar"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "753e01f83ad446c5e2fc52ddb45b85c77fb257f8", "author": {"user": {"login": "Phoosha", "name": "Andreas Born"}}, "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/commit/753e01f83ad446c5e2fc52ddb45b85c77fb257f8", "committedDate": "2020-11-03T11:35:15Z", "message": "fixes #1705: Quote identifiers starting with dollar"}, "afterCommit": {"oid": "0dc1a16ce41cf59d84f2db3891a9f2e6f457a1a1", "author": {"user": {"login": "Phoosha", "name": "Andreas Born"}}, "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/commit/0dc1a16ce41cf59d84f2db3891a9f2e6f457a1a1", "committedDate": "2020-11-04T12:28:08Z", "message": "fixes #1705: Quote identifiers starting with dollar"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MDk4NzAy", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1708#pullrequestreview-524098702", "createdAt": "2020-11-05T09:59:50Z", "commit": {"oid": "0dc1a16ce41cf59d84f2db3891a9f2e6f457a1a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 883, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}