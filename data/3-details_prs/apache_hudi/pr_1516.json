{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNDMzMzA5", "number": 1516, "title": "[HUDI-784] Adressing issue with log reader on GCS", "bodyText": "What is the purpose of the pull request\nThis one was hard to reproduce and debug, but proposed fix gets rid of the error. Still not sure whether it is issue with GCS library or static array.\nBrief change log\n\nModifed HoodieLogFileReader.\n\nVerify this pull request\nNot sure what the test should be...\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-04-14T21:53:45Z", "url": "https://github.com/apache/hudi/pull/1516", "merged": true, "mergeCommit": {"oid": "e783ab174946a0b767396239c0132c31c8d26458"}, "closed": true, "closedAt": "2020-05-07T20:05:33Z", "author": {"login": "afilipchik"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXqs26gH2gAyNDAzNDMzMzA5OjU3YzAyNDU5ZDRhY2MyN2E2NDQxODNiNWM1MmQzMWU5MWRhYjYyZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfC9e5AFqTQwNzc5NjMzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "57c02459d4acc27a644183b5c52d31e91dab62fe", "author": {"user": null}, "url": "https://github.com/apache/hudi/commit/57c02459d4acc27a644183b5c52d31e91dab62fe", "committedDate": "2020-04-14T21:51:21Z", "message": "Adressing issue with log reader on GCS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTkwMjM5", "url": "https://github.com/apache/hudi/pull/1516#pullrequestreview-396590239", "createdAt": "2020-04-20T15:57:15Z", "commit": {"oid": "57c02459d4acc27a644183b5c52d31e91dab62fe"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNTo1NzoxNVrOGIbp9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNjowMDo1OVrOGIb1nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ5NDkwMw==", "bodyText": "makes sense to be non-static.", "url": "https://github.com/apache/hudi/pull/1516#discussion_r411494903", "createdAt": "2020-04-20T15:57:15Z", "author": {"login": "bvaradar"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/log/HoodieLogFileReader.java", "diffHunk": "@@ -59,7 +59,7 @@\n \n   private final FSDataInputStream inputStream;\n   private final HoodieLogFile logFile;\n-  private static final byte[] MAGIC_BUFFER = new byte[6];\n+  private final byte[] magicBuffer = new byte[6];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c02459d4acc27a644183b5c52d31e91dab62fe"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ5Nzg4NQ==", "bodyText": "What is the original exception were you seeing ?\nThis seek() call is immediately after open() so should be innocuous for other file-systems. right ?\nIt would be better to inline document the reasoning behind this change for future understanding.", "url": "https://github.com/apache/hudi/pull/1516#discussion_r411497885", "createdAt": "2020-04-20T16:00:59Z", "author": {"login": "bvaradar"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/log/HoodieLogFileReader.java", "diffHunk": "@@ -79,6 +79,7 @@\n       this.inputStream = fsDataInputStream;\n     }\n \n+    fsDataInputStream.seek(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c02459d4acc27a644183b5c52d31e91dab62fe"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3d67edbd90a1fb81500f491dcfcec6f92bb13e6", "author": {"user": null}, "url": "https://github.com/apache/hudi/commit/b3d67edbd90a1fb81500f491dcfcec6f92bb13e6", "committedDate": "2020-04-20T17:29:03Z", "message": "Added comemnt and a check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMjI2OTE1", "url": "https://github.com/apache/hudi/pull/1516#pullrequestreview-402226915", "createdAt": "2020-04-28T21:30:35Z", "commit": {"oid": "b3d67edbd90a1fb81500f491dcfcec6f92bb13e6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMTozMDozNVrOGNnuxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMTozMDozNVrOGNnuxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkzNTYyMQ==", "bodyText": "@afilipchik : Can we revert this change then and try as it is likely the issue with static vs non-static ?", "url": "https://github.com/apache/hudi/pull/1516#discussion_r416935621", "createdAt": "2020-04-28T21:30:35Z", "author": {"login": "bvaradar"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/log/HoodieLogFileReader.java", "diffHunk": "@@ -79,6 +79,11 @@\n       this.inputStream = fsDataInputStream;\n     }\n \n+    // Defensive measure to make sure nothing advanced the stream.\n+    if (fsDataInputStream.getPos() != 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d67edbd90a1fb81500f491dcfcec6f92bb13e6"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1dd6ef23eba4a1b81a8006a1404ec31d65ecadb", "author": {"user": null}, "url": "https://github.com/apache/hudi/commit/e1dd6ef23eba4a1b81a8006a1404ec31d65ecadb", "committedDate": "2020-05-05T03:55:42Z", "message": "Removing defensive seek 0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3Nzk2MzM0", "url": "https://github.com/apache/hudi/pull/1516#pullrequestreview-407796334", "createdAt": "2020-05-07T20:04:42Z", "commit": {"oid": "e1dd6ef23eba4a1b81a8006a1404ec31d65ecadb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3392, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}