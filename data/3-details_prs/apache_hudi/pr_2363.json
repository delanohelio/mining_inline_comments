{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MTAzMzU5", "number": 2363, "title": "[HUDI-1484] Escape the partition value in HiveSyncTool", "bodyText": "What is the purpose of the pull request\nDecode the partition value in HiveSyncTool if the URL_ENCODE_PARTITIONING_OPT_KEY set true. Because Hive itself will do escape processing on partition Value. Without this Decoding, the partition value will be encoded twice which lead to incorrect query result in hive or spark sql.\nBrief change log\nDecode the partition value in HiveSyncTool if the URL_ENCODE_PARTITIONING_OPT_KEY set true.\nVerify this pull request\n\nAdded integration tests for in sparksql-incremental.commands\n\nCommitter checklist\n\n\n[x ] Has a corresponding JIRA in PR title & commit\n\n\n[x ] Commit message is descriptive of the change\n\n\n[x ] CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-12-22T12:51:02Z", "url": "https://github.com/apache/hudi/pull/2363", "merged": true, "mergeCommit": {"oid": "b83d1d3e61d51a7b098789532e31531d94330cb0"}, "closed": true, "closedAt": "2020-12-29T04:02:37Z", "author": {"login": "pengzhiwei2018"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoqzHXgBqjQxNDAyMTUzMjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdqypOOAFqTU1OTM3MDY2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22a1601a8bddadab314e8f50c3fdf39cc12f2fde", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/22a1601a8bddadab314e8f50c3fdf39cc12f2fde", "committedDate": "2020-12-22T13:43:56Z", "message": "fix test case"}, "afterCommit": {"oid": "b98a58abfbf14937739ab09c3f85f3232af16380", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/b98a58abfbf14937739ab09c3f85f3232af16380", "committedDate": "2020-12-22T13:45:37Z", "message": "[HUDI-1484] Escape the partition value in HiveSyncTool\n\nfix test case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c16bd2aa03b78070cdfb855f78e1340b2b347a67", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/c16bd2aa03b78070cdfb855f78e1340b2b347a67", "committedDate": "2020-12-22T16:26:20Z", "message": "fix test case"}, "afterCommit": {"oid": "01548c20602040d268ccfe47089ad45585f55ea0", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/01548c20602040d268ccfe47089ad45585f55ea0", "committedDate": "2020-12-22T16:27:05Z", "message": "[HUDI-1484] Escape the partition value in HiveSyncTool\n\nfix test case\n\nfix test case\n\nfix test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NjkwMDEx", "url": "https://github.com/apache/hudi/pull/2363#pullrequestreview-557690011", "createdAt": "2020-12-23T07:34:25Z", "commit": {"oid": "01548c20602040d268ccfe47089ad45585f55ea0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzozNDoyNlrOIKYXug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzozNDoyNlrOIKYXug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc1NTk2Mg==", "bodyText": "It seems we already have a val named DEFAULT_URL_ENCODE_PARTITIONING_OPT_VAL in DataSourceOptions, how about using this one, avoid importing KeyGeneratorOptions", "url": "https://github.com/apache/hudi/pull/2363#discussion_r547755962", "createdAt": "2020-12-23T07:34:26Z", "author": {"login": "wangxianghu"}, "path": "hudi-spark-datasource/hudi-spark/src/main/scala/org/apache/hudi/HoodieSparkSqlWriter.scala", "diffHunk": "@@ -364,6 +365,9 @@ private[hudi] object HoodieSparkSqlWriter {\n     hiveSyncConfig.partitionValueExtractorClass = parameters(HIVE_PARTITION_EXTRACTOR_CLASS_OPT_KEY)\n     hiveSyncConfig.useJdbc = parameters(HIVE_USE_JDBC_OPT_KEY).toBoolean\n     hiveSyncConfig.supportTimestamp = parameters.get(HIVE_SUPPORT_TIMESTAMP).exists(r => r.toBoolean)\n+    hiveSyncConfig.decodePartition =\n+      parameters.getOrElse(URL_ENCODE_PARTITIONING_OPT_KEY,\n+        KeyGeneratorOptions.DEFAULT_URL_ENCODE_PARTITIONING_OPT_VAL).toBoolean", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01548c20602040d268ccfe47089ad45585f55ea0"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39aafbc9ff8a6fa606779e85ddfc195a24bc7a1f", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/39aafbc9ff8a6fa606779e85ddfc195a24bc7a1f", "committedDate": "2020-12-23T11:16:09Z", "message": "remove unused import"}, "afterCommit": {"oid": "ae565ee37f41e43eec483b422f0478693356b39f", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/ae565ee37f41e43eec483b422f0478693356b39f", "committedDate": "2020-12-23T11:16:46Z", "message": "[HUDI-1484] Escape the partition value in HiveSyncTool\n\nfix test case\n\nfix test case\n\nfix test case\n\nremove unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cd2540ac32d1ebbfc22a3fa8d9a8d1e9079aa3d", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/8cd2540ac32d1ebbfc22a3fa8d9a8d1e9079aa3d", "committedDate": "2020-12-23T12:47:43Z", "message": "[HUDI-1484] Escape the partition value in HiveSyncTool\n\nfix test case\n\nfix test case\n\nfix test case\n\nremove unused import"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae565ee37f41e43eec483b422f0478693356b39f", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/ae565ee37f41e43eec483b422f0478693356b39f", "committedDate": "2020-12-23T11:16:46Z", "message": "[HUDI-1484] Escape the partition value in HiveSyncTool\n\nfix test case\n\nfix test case\n\nfix test case\n\nremove unused import"}, "afterCommit": {"oid": "8cd2540ac32d1ebbfc22a3fa8d9a8d1e9079aa3d", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/8cd2540ac32d1ebbfc22a3fa8d9a8d1e9079aa3d", "committedDate": "2020-12-23T12:47:43Z", "message": "[HUDI-1484] Escape the partition value in HiveSyncTool\n\nfix test case\n\nfix test case\n\nfix test case\n\nremove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MzY3OTU0", "url": "https://github.com/apache/hudi/pull/2363#pullrequestreview-558367954", "createdAt": "2020-12-24T06:26:22Z", "commit": {"oid": "8cd2540ac32d1ebbfc22a3fa8d9a8d1e9079aa3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MzcwNjYx", "url": "https://github.com/apache/hudi/pull/2363#pullrequestreview-559370661", "createdAt": "2020-12-29T04:02:20Z", "commit": {"oid": "8cd2540ac32d1ebbfc22a3fa8d9a8d1e9079aa3d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4068, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}