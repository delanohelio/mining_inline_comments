{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NTc1MjM1", "number": 1530, "title": "[HUDI-809] Migrate CommonTestHarness to JUnit 5", "bodyText": "Create an interim test class org.apache.hudi.common.testutils.HoodieCommonTestHarness to migrate subclasses of org.apache.hudi.common.HoodieCommonTestHarness\n\nFollowing #1504 #1521\nMigration status (after merging)\n\n\n\nPackage\nJUnit 5 lib\nAPI migration\nRestructure packages\n\n\n\n\nhudi-cli\n\u2705\n\ud83d\udea7\n-\n\n\nhudi-client\n\u2705\n\ud83d\udea7\n-\n\n\nhudi-common\n\u2705\n\ud83d\udea7\n\ud83d\udea7\n\n\nhudi-hadoop-mr\n\u2705\n\u2705\n-\n\n\nhudi-hive-sync\n\u2705\n\u2705\n-\n\n\nhudi-integ-test\n\u2705\n\u2705\nN.A.\n\n\nhudi-spark\n\u2705\n\u2705\n-\n\n\nhudi-timeline-service\n\u2705\n\u2705\n-\n\n\nhudi-utilities\n\u2705\n\ud83d\udea7\n-\n\n\n\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-04-18T23:25:22Z", "url": "https://github.com/apache/hudi/pull/1530", "merged": true, "mergeCommit": {"oid": "6e15eebd81da41b1076179a8ddcedcf07d1c9043"}, "closed": true, "closedAt": "2020-04-22T06:10:26Z", "author": {"login": "xushiyan"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZBMYWgBqjMyNDg1OTM2NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaCCCegFqTM5Nzg2NjgxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MDI0MDI2", "url": "https://github.com/apache/hudi/pull/1530#pullrequestreview-397024026", "createdAt": "2020-04-21T06:32:54Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNjozMjo1NFrOGI02FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwODozNzo0OVrOGI5w9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkwNzYwNA==", "bodyText": "redundant empty line?", "url": "https://github.com/apache/hudi/pull/1530#discussion_r411907604", "createdAt": "2020-04-21T06:32:54Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/table/view/TestHoodieTableFileSystemView.java", "diffHunk": "@@ -59,9 +58,10 @@\n import java.util.stream.Collectors;\n import java.util.stream.Stream;\n \n-import static org.junit.Assert.assertEquals;\n-import static org.junit.Assert.assertFalse;\n-import static org.junit.Assert.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk4ODIxMw==", "bodyText": "Can we use another name to distinguish each other?", "url": "https://github.com/apache/hudi/pull/1530#discussion_r411988213", "createdAt": "2020-04-21T08:37:49Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieCommonTestHarness.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.common.testutils;\n+\n+import org.apache.hudi.common.model.HoodieTestUtils;\n+import org.apache.hudi.common.table.HoodieTableMetaClient;\n+\n+import org.junit.jupiter.api.io.TempDir;\n+\n+import java.io.IOException;\n+\n+/**\n+ * The JUnit 5 version of {@link org.apache.hudi.common.HoodieCommonTestHarness}.\n+ * <p>\n+ * To incrementally migrate test classes.\n+ */\n+public class HoodieCommonTestHarness extends org.apache.hudi.common.HoodieCommonTestHarness {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ab089e7b12867d4d55343821d6bee7702acbbd8", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/4ab089e7b12867d4d55343821d6bee7702acbbd8", "committedDate": "2020-04-21T17:22:25Z", "message": "[HUDI-809] Migrate CommonTestHarness to JUnit 5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66ca2f8bf77a55f9e62e6695a798b862c249dd72", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/66ca2f8bf77a55f9e62e6695a798b862c249dd72", "committedDate": "2020-04-21T17:29:50Z", "message": "address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "66ca2f8bf77a55f9e62e6695a798b862c249dd72", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/66ca2f8bf77a55f9e62e6695a798b862c249dd72", "committedDate": "2020-04-21T17:29:50Z", "message": "address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62ebb73afb310bb6c33e5fda2e937a561790b9d6", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/62ebb73afb310bb6c33e5fda2e937a561790b9d6", "committedDate": "2020-04-21T18:53:49Z", "message": "migrate a new test class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "62ebb73afb310bb6c33e5fda2e937a561790b9d6", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/62ebb73afb310bb6c33e5fda2e937a561790b9d6", "committedDate": "2020-04-21T18:53:49Z", "message": "migrate a new test class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3ODY2ODEx", "url": "https://github.com/apache/hudi/pull/1530#pullrequestreview-397866811", "createdAt": "2020-04-22T06:04:07Z", "commit": {"oid": "62ebb73afb310bb6c33e5fda2e937a561790b9d6"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNjowNDowN1rOGJk1xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNjowNDo1MVrOGJk2yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY5Mzk1Ng==", "bodyText": "here", "url": "https://github.com/apache/hudi/pull/1530#discussion_r412693956", "createdAt": "2020-04-22T06:04:07Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/table/TestHoodieTableMetaClient.java", "diffHunk": "@@ -18,41 +18,41 @@\n \n package org.apache.hudi.common.table;\n \n-import org.apache.hudi.common.HoodieCommonTestHarness;\n import org.apache.hudi.common.model.HoodieTestUtils;\n import org.apache.hudi.common.table.timeline.HoodieActiveTimeline;\n import org.apache.hudi.common.table.timeline.HoodieInstant;\n import org.apache.hudi.common.table.timeline.HoodieTimeline;\n+import org.apache.hudi.common.testutils.HoodieCommonTestHarnessJunit5;\n import org.apache.hudi.common.util.Option;\n \n-import org.junit.Before;\n-import org.junit.Test;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n \n import java.io.IOException;\n \n-import static org.junit.Assert.assertArrayEquals;\n-import static org.junit.Assert.assertEquals;\n-import static org.junit.Assert.assertFalse;\n-import static org.junit.Assert.assertNotEquals;\n-import static org.junit.Assert.assertNotNull;\n-import static org.junit.Assert.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertArrayEquals;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertNotEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n \n /**\n  * Tests hoodie table meta client {@link HoodieTableMetaClient}.\n  */\n-public class TestHoodieTableMetaClient extends HoodieCommonTestHarness {\n+public class TestHoodieTableMetaClient extends HoodieCommonTestHarnessJunit5 {\n \n-  @Before\n+  @BeforeEach\n   public void init() throws IOException {\n     initMetaClient();\n   }\n \n   @Test\n   public void checkMetadata() {\n-    assertEquals(\"Table name should be raw_trips\", HoodieTestUtils.RAW_TRIPS_TEST_NAME,\n-        metaClient.getTableConfig().getTableName());\n-    assertEquals(\"Basepath should be the one assigned\", basePath, metaClient.getBasePath());\n-    assertEquals(\"Metapath should be ${basepath}/.hoodie\", basePath + \"/.hoodie\", metaClient.getMetaPath());\n+    assertEquals(HoodieTestUtils.RAW_TRIPS_TEST_NAME, metaClient.getTableConfig().getTableName(), \"Table name should be raw_trips\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62ebb73afb310bb6c33e5fda2e937a561790b9d6"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY5NDA0NQ==", "bodyText": "here", "url": "https://github.com/apache/hudi/pull/1530#discussion_r412694045", "createdAt": "2020-04-22T06:04:23Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/table/TestHoodieTableMetaClient.java", "diffHunk": "@@ -67,16 +67,15 @@ public void checkSerDe() {\n     commitTimeline.saveAsComplete(instant, Option.of(\"test-detail\".getBytes()));\n     commitTimeline = commitTimeline.reload();\n     HoodieInstant completedInstant = HoodieTimeline.getCompletedInstant(instant);\n-    assertEquals(\"Commit should be 1 and completed\", completedInstant, commitTimeline.getInstants().findFirst().get());\n-    assertArrayEquals(\"Commit value should be \\\"test-detail\\\"\", \"test-detail\".getBytes(),\n-        commitTimeline.getInstantDetails(completedInstant).get());\n+    assertEquals(completedInstant, commitTimeline.getInstants().findFirst().get(), \"Commit should be 1 and completed\");\n+    assertArrayEquals(\"test-detail\".getBytes(), commitTimeline.getInstantDetails(completedInstant).get(), \"Commit value should be \\\"test-detail\\\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62ebb73afb310bb6c33e5fda2e937a561790b9d6"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY5NDIxOA==", "bodyText": "here", "url": "https://github.com/apache/hudi/pull/1530#discussion_r412694218", "createdAt": "2020-04-22T06:04:51Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/table/TestHoodieTableMetaClient.java", "diffHunk": "@@ -85,21 +84,20 @@ public void checkCommitTimeline() {\n     // Commit timeline should not auto-reload every time getActiveCommitTimeline(), it should be cached\n     activeTimeline = metaClient.getActiveTimeline();\n     activeCommitTimeline = activeTimeline.getCommitTimeline();\n-    assertTrue(\"Should be empty commit timeline\", activeCommitTimeline.empty());\n+    assertTrue(activeCommitTimeline.empty(), \"Should be empty commit timeline\");\n \n     HoodieInstant completedInstant = HoodieTimeline.getCompletedInstant(instant);\n     activeTimeline = activeTimeline.reload();\n     activeCommitTimeline = activeTimeline.getCommitTimeline();\n-    assertFalse(\"Should be the 1 commit we made\", activeCommitTimeline.empty());\n-    assertEquals(\"Commit should be 1\", completedInstant, activeCommitTimeline.getInstants().findFirst().get());\n-    assertArrayEquals(\"Commit value should be \\\"test-detail\\\"\", \"test-detail\".getBytes(),\n-        activeCommitTimeline.getInstantDetails(completedInstant).get());\n+    assertFalse(activeCommitTimeline.empty(), \"Should be the 1 commit we made\");\n+    assertEquals(completedInstant, activeCommitTimeline.getInstants().findFirst().get(), \"Commit should be 1\");\n+    assertArrayEquals(\"test-detail\".getBytes(), activeCommitTimeline.getInstantDetails(completedInstant).get(), \"Commit value should be \\\"test-detail\\\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62ebb73afb310bb6c33e5fda2e937a561790b9d6"}, "originalPosition": 93}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3445, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}