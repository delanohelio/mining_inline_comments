{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzMjQzMDgw", "number": 1851, "title": "[HUDI-1113] Add user define metrics reporter", "bodyText": "Tips\n\nThank you very much for contributing to Apache Hudi.\nPlease review https://hudi.apache.org/contributing.html before opening a pull request.\n\nWhat is the purpose of the pull request\nThis pull request adds a user defined metrics reporter to allow sending metric with customer logic\nBrief change log\n\nAdd configs in HoodieMetricsConfig\nAdd configs in HoodieWriteConfig\nAdd AbstractUserDefinedMetricsReporter.java\nAdd DefauletUserDefinedMetricsReporter.java (for test)\nModify logic in MetricsReporterFactory.java\nAdd new type in MetricReporterType.java\n\nVerify this pull request\nThis pull request is already covered by existing tests, such as (please describe tests).\norg.apache.hudi.metrics.TestMetricsReporterFactory.metricsReporterFactoryShouldReturnUserDefinedReporter\n  @Test\n  public void metricsReporterFactoryShouldReturnUserDefinedReporter() {\n    when(config.getMetricsReporterType()).thenReturn(MetricsReporterType.USER_DEFINED);\n    when(config.getUserDefinedMetricClassName()).thenReturn(DefaultUserDefinedMetricsReporter.class.getName());\n\n    Properties props = new Properties();\n    props.setProperty(\"testKey\", \"testValue\");\n\n    when(config.getProps()).thenReturn(props);\n    MetricsReporter reporter = MetricsReporterFactory.createReporter(config, registry);\n    assertTrue(reporter instanceof AbstractUserDefinedMetricsReporter);\n\n    assertEquals(props, ((DefaultUserDefinedMetricsReporter) reporter).getProps());\n    assertEquals(registry, ((DefaultUserDefinedMetricsReporter) reporter).getRegistry());\n  }\n\nThis change added tests and can be verified as follows:\n(example:)\n\nAdded integration tests for end-to-end.\nAdded HoodieClientWriteTest to verify the change.\nManually verified the change by running a job locally.\n\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-07-20T09:24:39Z", "url": "https://github.com/apache/hudi/pull/1851", "merged": true, "mergeCommit": {"oid": "c39778c150ad2d5f38af4628fea21de4c191d3ca"}, "closed": true, "closedAt": "2020-07-23T05:46:37Z", "author": {"login": "zherenyu831"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2uJTLgH2gAyNDUzMjQzMDgwOjIxMjhlYjYzNmQ5MjYyZWQ1Y2MwMzUzYTk3NmZmMGU5YWIxZTE3MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3o1RBAFqTQ1Mzg0ODQ0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2128eb636d9262ed5cc0353a976ff0e9ab1e1718", "author": {"user": {"login": "zherenyu831", "name": null}}, "url": "https://github.com/apache/hudi/commit/2128eb636d9262ed5cc0353a976ff0e9ab1e1718", "committedDate": "2020-07-20T09:23:47Z", "message": "Add user define metrics reporter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f08f8ce59851dbaa09bd43d18aece7566e949f65", "author": {"user": {"login": "zherenyu831", "name": null}}, "url": "https://github.com/apache/hudi/commit/f08f8ce59851dbaa09bd43d18aece7566e949f65", "committedDate": "2020-07-20T09:30:26Z", "message": "Reformat code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe80ed72bc5f1dd29da3a61f88b5816aecab8355", "author": {"user": {"login": "zherenyu831", "name": null}}, "url": "https://github.com/apache/hudi/commit/fe80ed72bc5f1dd29da3a61f88b5816aecab8355", "committedDate": "2020-07-21T01:16:53Z", "message": "Pass metricRegistry to user defined metric reporter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a0bb4cd9cd2bd1f2e382f6e7a9768c5f7ef10bb", "author": {"user": {"login": "zherenyu831", "name": null}}, "url": "https://github.com/apache/hudi/commit/0a0bb4cd9cd2bd1f2e382f6e7a9768c5f7ef10bb", "committedDate": "2020-07-21T01:23:05Z", "message": "Add license"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270", "author": {"user": {"login": "zherenyu831", "name": null}}, "url": "https://github.com/apache/hudi/commit/b8d6b93de3f3c4071dc81610f9d65f8668c6a270", "committedDate": "2020-07-21T03:45:14Z", "message": "Update default value logic of user defined reporter config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyOTMwNzg1", "url": "https://github.com/apache/hudi/pull/1851#pullrequestreview-452930785", "createdAt": "2020-07-22T01:17:00Z", "commit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMToxNzowMFrOG1PPSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMToxNzowMFrOG1PPSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ3NzM4NA==", "bodyText": "we would remove this, please refer to https://github.com/apache/hudi/blob/master/hudi-client/src/main/java/org/apache/hudi/index/HoodieIndex.java#L56", "url": "https://github.com/apache/hudi/pull/1851#discussion_r458477384", "createdAt": "2020-07-22T01:17:00Z", "author": {"login": "leesf"}, "path": "hudi-client/src/main/java/org/apache/hudi/metrics/MetricsReporterFactory.java", "diffHunk": "@@ -48,6 +51,10 @@ public static MetricsReporter createReporter(HoodieWriteConfig config, MetricReg\n       case DATADOG:\n         reporter = new DatadogMetricsReporter(config, registry);\n         break;\n+      case USER_DEFINED:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyOTMwODg0", "url": "https://github.com/apache/hudi/pull/1851#pullrequestreview-452930884", "createdAt": "2020-07-22T01:17:18Z", "commit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMToxNzoxOFrOG1PPmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMToxNzoxOFrOG1PPmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ3NzQ2NQ==", "bodyText": "would remove USER_DEFINED.", "url": "https://github.com/apache/hudi/pull/1851#discussion_r458477465", "createdAt": "2020-07-22T01:17:18Z", "author": {"login": "leesf"}, "path": "hudi-client/src/main/java/org/apache/hudi/metrics/MetricsReporterType.java", "diffHunk": "@@ -22,5 +22,5 @@\n  * Types of the reporter. Right now we only support Graphite. We can include JMX and CSV in the future.\n  */\n public enum MetricsReporterType {\n-  GRAPHITE, INMEMORY, JMX, DATADOG\n+  GRAPHITE, INMEMORY, JMX, DATADOG, USER_DEFINED", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyOTMxMjk0", "url": "https://github.com/apache/hudi/pull/1851#pullrequestreview-452931294", "createdAt": "2020-07-22T01:18:49Z", "commit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMToxODo0OVrOG1PRAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMToxODo0OVrOG1PRAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ3NzgyNg==", "bodyText": "if just used for testing, we would move it into test class.", "url": "https://github.com/apache/hudi/pull/1851#discussion_r458477826", "createdAt": "2020-07-22T01:18:49Z", "author": {"login": "leesf"}, "path": "hudi-client/src/main/java/org/apache/hudi/metrics/userdefined/DefaultUserDefinedMetricsReporter.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.metrics.userdefined;\n+\n+import com.codahale.metrics.MetricRegistry;\n+\n+import java.io.Closeable;\n+import java.util.Properties;\n+\n+/**\n+ * Used for testing.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyOTMxOTA4", "url": "https://github.com/apache/hudi/pull/1851#pullrequestreview-452931908", "createdAt": "2020-07-22T01:20:43Z", "commit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMToyMDo0M1rOG1PTQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMToyMDo0M1rOG1PTQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ3ODQwMA==", "bodyText": "DEFUALT would be empty string. also please refer to \n  \n    \n      hudi/hudi-client/src/main/java/org/apache/hudi/config/HoodieIndexConfig.java\n    \n    \n         Line 42\n      in\n      5e7ab11\n    \n    \n    \n    \n\n        \n          \n           public static final String DEFAULT_INDEX_CLASS = \"\";", "url": "https://github.com/apache/hudi/pull/1851#discussion_r458478400", "createdAt": "2020-07-22T01:20:43Z", "author": {"login": "leesf"}, "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieMetricsConfig.java", "diffHunk": "@@ -58,6 +59,12 @@\n \n   public static final String GRAPHITE_METRIC_PREFIX = GRAPHITE_PREFIX + \".metric.prefix\";\n \n+  // User defined\n+  public static final String USER_DEFINED_REPORTER_PREFIX = METRIC_PREFIX + \".user.defined\";\n+  public static final String USER_DEFINED_REPORTER_CLASS = USER_DEFINED_REPORTER_PREFIX + \".class\";\n+\n+  public static final String DEFAULT_USER_DEFINED_REPORTER_CLASS = DefaultUserDefinedMetricsReporter.class.getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyOTMyMzg3", "url": "https://github.com/apache/hudi/pull/1851#pullrequestreview-452932387", "createdAt": "2020-07-22T01:22:21Z", "commit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMToyMjoyMVrOG1PU7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMToyMjoyMVrOG1PU7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ3ODgyOQ==", "bodyText": "would rename to METRICS_REPORTER_CLASS = \"metrics.reporter.class\" ?", "url": "https://github.com/apache/hudi/pull/1851#discussion_r458478829", "createdAt": "2020-07-22T01:22:21Z", "author": {"login": "leesf"}, "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieMetricsConfig.java", "diffHunk": "@@ -58,6 +59,12 @@\n \n   public static final String GRAPHITE_METRIC_PREFIX = GRAPHITE_PREFIX + \".metric.prefix\";\n \n+  // User defined\n+  public static final String USER_DEFINED_REPORTER_PREFIX = METRIC_PREFIX + \".user.defined\";\n+  public static final String USER_DEFINED_REPORTER_CLASS = USER_DEFINED_REPORTER_PREFIX + \".class\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyOTMyODYy", "url": "https://github.com/apache/hudi/pull/1851#pullrequestreview-452932862", "createdAt": "2020-07-22T01:23:56Z", "commit": {"oid": "b8d6b93de3f3c4071dc81610f9d65f8668c6a270"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51f9bd076fb0ddb119d4ef7dbe004a50ab4c7e0f", "author": {"user": {"login": "zherenyu831", "name": null}}, "url": "https://github.com/apache/hudi/commit/51f9bd076fb0ddb119d4ef7dbe004a50ab4c7e0f", "committedDate": "2020-07-22T06:58:38Z", "message": "Update for comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "572cf6e5f9d15cff0a2bf0baee058d80261f4289", "author": {"user": {"login": "zherenyu831", "name": null}}, "url": "https://github.com/apache/hudi/commit/572cf6e5f9d15cff0a2bf0baee058d80261f4289", "committedDate": "2020-07-22T07:07:51Z", "message": "Fix comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMTYyOTEz", "url": "https://github.com/apache/hudi/pull/1851#pullrequestreview-453162913", "createdAt": "2020-07-22T09:47:35Z", "commit": {"oid": "572cf6e5f9d15cff0a2bf0baee058d80261f4289"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwOTo0NzozNVrOG1bGng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwOTo0NzozNVrOG1bGng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY3MTc3NA==", "bodyText": "This class along with TestMetricReporter would both move to TestMetricsReporterFactory.java ?", "url": "https://github.com/apache/hudi/pull/1851#discussion_r458671774", "createdAt": "2020-07-22T09:47:35Z", "author": {"login": "leesf"}, "path": "hudi-client/src/test/java/org/apache/hudi/metrics/TestIllegalMetricReporter.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.hudi.metrics;\n+\n+import com.codahale.metrics.MetricRegistry;\n+\n+import java.util.Properties;\n+\n+/**\n+ * Test class for user defined metric reporter.\n+ */\n+public class TestIllegalMetricReporter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "572cf6e5f9d15cff0a2bf0baee058d80261f4289"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMTYzOTA1", "url": "https://github.com/apache/hudi/pull/1851#pullrequestreview-453163905", "createdAt": "2020-07-22T09:48:55Z", "commit": {"oid": "572cf6e5f9d15cff0a2bf0baee058d80261f4289"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwOTo0ODo1NVrOG1bJjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwOTo0ODo1NVrOG1bJjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY3MjUyNA==", "bodyText": "Let's use HoodieException instead of creating a new Exception class?", "url": "https://github.com/apache/hudi/pull/1851#discussion_r458672524", "createdAt": "2020-07-22T09:48:55Z", "author": {"login": "leesf"}, "path": "hudi-client/src/main/java/org/apache/hudi/exception/HoodieMetricsException.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.exception;\n+\n+/**\n+ * <p>\n+ * Exception thrown when error happens on metrics process.\n+ * </p>\n+ */\n+public class HoodieMetricsException extends HoodieException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "572cf6e5f9d15cff0a2bf0baee058d80261f4289"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1a1af526d37c23bcf9be98d36cebbd03c52e47a", "author": {"user": {"login": "zherenyu831", "name": null}}, "url": "https://github.com/apache/hudi/commit/b1a1af526d37c23bcf9be98d36cebbd03c52e47a", "committedDate": "2020-07-22T10:33:42Z", "message": "Merge test classes and use HoodieException instead of new one"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODIwNTM5", "url": "https://github.com/apache/hudi/pull/1851#pullrequestreview-453820539", "createdAt": "2020-07-23T03:48:57Z", "commit": {"oid": "b1a1af526d37c23bcf9be98d36cebbd03c52e47a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMzo0ODo1N1rOG17YBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMzo0ODo1N1rOG17YBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIwMDUxOQ==", "bodyText": "would rename to DummyMetricsReporter", "url": "https://github.com/apache/hudi/pull/1851#discussion_r459200519", "createdAt": "2020-07-23T03:48:57Z", "author": {"login": "leesf"}, "path": "hudi-client/src/test/java/org/apache/hudi/metrics/TestMetricsReporterFactory.java", "diffHunk": "@@ -45,4 +52,53 @@ public void metricsReporterFactoryShouldReturnReporter() {\n     MetricsReporter reporter = MetricsReporterFactory.createReporter(config, registry);\n     assertTrue(reporter instanceof InMemoryMetricsReporter);\n   }\n+\n+  @Test\n+  public void metricsReporterFactoryShouldReturnUserDefinedReporter() {\n+    when(config.getMetricReporterClassName()).thenReturn(TestMetricReporter.class.getName());\n+\n+    Properties props = new Properties();\n+    props.setProperty(\"testKey\", \"testValue\");\n+\n+    when(config.getProps()).thenReturn(props);\n+    MetricsReporter reporter = MetricsReporterFactory.createReporter(config, registry);\n+    assertTrue(reporter instanceof AbstractUserDefinedMetricsReporter);\n+    assertEquals(props, ((TestMetricReporter) reporter).getProps());\n+    assertEquals(registry, ((TestMetricReporter) reporter).getRegistry());\n+  }\n+\n+  @Test\n+  public void metricsReporterFactoryShouldThrowExceptionWhenMetricsReporterClassIsIllegal() {\n+    when(config.getMetricReporterClassName()).thenReturn(TestIllegalMetricReporter.class.getName());\n+    when(config.getProps()).thenReturn(new Properties());\n+    assertThrows(HoodieException.class, () -> MetricsReporterFactory.createReporter(config, registry));\n+  }\n+\n+  public static class TestMetricReporter extends AbstractUserDefinedMetricsReporter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a1af526d37c23bcf9be98d36cebbd03c52e47a"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODIwNjc4", "url": "https://github.com/apache/hudi/pull/1851#pullrequestreview-453820678", "createdAt": "2020-07-23T03:49:35Z", "commit": {"oid": "b1a1af526d37c23bcf9be98d36cebbd03c52e47a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMzo0OTozNVrOG17Ynw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMzo0OTozNVrOG17Ynw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIwMDY3MQ==", "bodyText": "would rename to IllegalTestMetricsReporter", "url": "https://github.com/apache/hudi/pull/1851#discussion_r459200671", "createdAt": "2020-07-23T03:49:35Z", "author": {"login": "leesf"}, "path": "hudi-client/src/test/java/org/apache/hudi/metrics/TestMetricsReporterFactory.java", "diffHunk": "@@ -45,4 +52,53 @@ public void metricsReporterFactoryShouldReturnReporter() {\n     MetricsReporter reporter = MetricsReporterFactory.createReporter(config, registry);\n     assertTrue(reporter instanceof InMemoryMetricsReporter);\n   }\n+\n+  @Test\n+  public void metricsReporterFactoryShouldReturnUserDefinedReporter() {\n+    when(config.getMetricReporterClassName()).thenReturn(TestMetricReporter.class.getName());\n+\n+    Properties props = new Properties();\n+    props.setProperty(\"testKey\", \"testValue\");\n+\n+    when(config.getProps()).thenReturn(props);\n+    MetricsReporter reporter = MetricsReporterFactory.createReporter(config, registry);\n+    assertTrue(reporter instanceof AbstractUserDefinedMetricsReporter);\n+    assertEquals(props, ((TestMetricReporter) reporter).getProps());\n+    assertEquals(registry, ((TestMetricReporter) reporter).getRegistry());\n+  }\n+\n+  @Test\n+  public void metricsReporterFactoryShouldThrowExceptionWhenMetricsReporterClassIsIllegal() {\n+    when(config.getMetricReporterClassName()).thenReturn(TestIllegalMetricReporter.class.getName());\n+    when(config.getProps()).thenReturn(new Properties());\n+    assertThrows(HoodieException.class, () -> MetricsReporterFactory.createReporter(config, registry));\n+  }\n+\n+  public static class TestMetricReporter extends AbstractUserDefinedMetricsReporter {\n+\n+    public TestMetricReporter(Properties props, MetricRegistry registry) {\n+      super(props, registry);\n+    }\n+\n+    @Override\n+    public void start() {}\n+\n+    @Override\n+    public void report() {}\n+\n+    @Override\n+    public Closeable getReporter() {\n+      return null;\n+    }\n+\n+    @Override\n+    public void stop() {}\n+  }\n+\n+  public static class TestIllegalMetricReporter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1a1af526d37c23bcf9be98d36cebbd03c52e47a"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78853cc358ca7f061bc2f7ba66dd20cb90f4e6e2", "author": {"user": {"login": "zherenyu831", "name": null}}, "url": "https://github.com/apache/hudi/commit/78853cc358ca7f061bc2f7ba66dd20cb90f4e6e2", "committedDate": "2020-07-23T04:59:15Z", "message": "Rename test classes names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzODQ4NDQ4", "url": "https://github.com/apache/hudi/pull/1851#pullrequestreview-453848448", "createdAt": "2020-07-23T05:46:18Z", "commit": {"oid": "78853cc358ca7f061bc2f7ba66dd20cb90f4e6e2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3002, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}