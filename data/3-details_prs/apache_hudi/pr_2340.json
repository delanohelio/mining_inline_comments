{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMDEzMDg0", "number": 2340, "title": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0", "bodyText": "Tips\n\nThank you very much for contributing to Apache Hudi.\nPlease review https://hudi.apache.org/contributing.html before opening a pull request.\n\nWhat is the purpose of the pull request\nMake QuickstartUtil generate random timestamp instead of 0\ntimestamp generated by QuickstartUtil is always 0, which is inconvenient to test TimestampBasedKeyGenerator\nBrief change log\n(for example:)\n\nModify AnnotationLocation checkstyle rule in checkstyle.xml\n\nVerify this pull request\n(Please pick either of the following options)\nThis pull request is a trivial rework / code cleanup without any test coverage.\n(or)\nThis pull request is already covered by existing tests, such as (please describe tests).\n(or)\nThis change added tests and can be verified as follows:\n(example:)\n\nAdded integration tests for end-to-end.\nAdded HoodieClientWriteTest to verify the change.\nManually verified the change by running a job locally.\n\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-12-16T09:18:11Z", "url": "https://github.com/apache/hudi/pull/2340", "merged": true, "mergeCommit": {"oid": "4ddfc61d70e39bc09dd1aa020bde26284ed35d39"}, "closed": true, "closedAt": "2020-12-17T10:00:23Z", "author": {"login": "wangxianghu"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmraGZgBqjQxMTg2NDkxMDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdm5likgFqTU1NDIyMjQ0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9426cb8859bd71fa485b19ffa7819732fa09db1", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/e9426cb8859bd71fa485b19ffa7819732fa09db1", "committedDate": "2020-12-16T09:14:51Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}, "afterCommit": {"oid": "67f95c9158c3810f92f97d3ec9b18d624952fef2", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/67f95c9158c3810f92f97d3ec9b18d624952fef2", "committedDate": "2020-12-16T09:20:11Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67f95c9158c3810f92f97d3ec9b18d624952fef2", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/67f95c9158c3810f92f97d3ec9b18d624952fef2", "committedDate": "2020-12-16T09:20:11Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}, "afterCommit": {"oid": "c7e796f2ea3d362fdd0fe15bd3ab8cf9449f552f", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/c7e796f2ea3d362fdd0fe15bd3ab8cf9449f552f", "committedDate": "2020-12-16T10:27:05Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7e796f2ea3d362fdd0fe15bd3ab8cf9449f552f", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/c7e796f2ea3d362fdd0fe15bd3ab8cf9449f552f", "committedDate": "2020-12-16T10:27:05Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}, "afterCommit": {"oid": "85a4b6d72fc61296301fb0b7ec6fabcc8957f041", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/85a4b6d72fc61296301fb0b7ec6fabcc8957f041", "committedDate": "2020-12-16T10:28:48Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85a4b6d72fc61296301fb0b7ec6fabcc8957f041", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/85a4b6d72fc61296301fb0b7ec6fabcc8957f041", "committedDate": "2020-12-16T10:28:48Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}, "afterCommit": {"oid": "472bc82cb6cbf381181030731ab6791088f0e075", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/472bc82cb6cbf381181030731ab6791088f0e075", "committedDate": "2020-12-16T10:30:17Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "472bc82cb6cbf381181030731ab6791088f0e075", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/472bc82cb6cbf381181030731ab6791088f0e075", "committedDate": "2020-12-16T10:30:17Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}, "afterCommit": {"oid": "aa0b73a258c04644054f6894620ff6221785f0ce", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/aa0b73a258c04644054f6894620ff6221785f0ce", "committedDate": "2020-12-16T10:32:38Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa0b73a258c04644054f6894620ff6221785f0ce", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/aa0b73a258c04644054f6894620ff6221785f0ce", "committedDate": "2020-12-16T10:32:38Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}, "afterCommit": {"oid": "99af63bdc0b94adb8cd6f364175c91039c3ac6af", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/99af63bdc0b94adb8cd6f364175c91039c3ac6af", "committedDate": "2020-12-16T10:51:41Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNTk4NTAx", "url": "https://github.com/apache/hudi/pull/2340#pullrequestreview-553598501", "createdAt": "2020-12-16T11:31:56Z", "commit": {"oid": "99af63bdc0b94adb8cd6f364175c91039c3ac6af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTozMTo1N1rOIHA2Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTozMTo1N1rOIHA2Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIyNDgwMg==", "bodyText": "It's not good for reading.  now - daysBefore  = now - (now - daysTillNow * 24 * 60 * 60 * 1000L)?", "url": "https://github.com/apache/hudi/pull/2340#discussion_r544224802", "createdAt": "2020-12-16T11:31:57Z", "author": {"login": "yanghua"}, "path": "hudi-spark-datasource/hudi-spark/src/main/java/org/apache/hudi/QuickstartUtils.java", "diffHunk": "@@ -121,11 +121,23 @@ public static GenericRecord generateGenericRecord(String rowKey, String riderNam\n      */\n     public static OverwriteWithLatestAvroPayload generateRandomValue(HoodieKey key, String riderDriverSuffix)\n         throws IOException {\n+      // The timestamp generated is limited to range from 7 days before to now, to avoid generating too many\n+      // partitionPaths when user use timestamp as partitionPath filed.\n       GenericRecord rec =\n-          generateGenericRecord(key.getRecordKey(), \"rider-\" + riderDriverSuffix, \"driver-\" + riderDriverSuffix, 0);\n+          generateGenericRecord(key.getRecordKey(), \"rider-\" + riderDriverSuffix,\"driver-\"\n+              + riderDriverSuffix, generateRangeRandomTimestamp(7));\n       return new OverwriteWithLatestAvroPayload(Option.of(rec));\n     }\n \n+    /**\n+     * Generate timestamp range from {@param daysTillNow} before to now.\n+     */\n+    private static long generateRangeRandomTimestamp(int daysTillNow) {\n+      long now = System.currentTimeMillis();\n+      long daysBefore = now - daysTillNow * 24 * 60 * 60 * 1000L;\n+      return daysBefore + (long)(Math.random() * (now - daysBefore));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99af63bdc0b94adb8cd6f364175c91039c3ac6af"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "99af63bdc0b94adb8cd6f364175c91039c3ac6af", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/99af63bdc0b94adb8cd6f364175c91039c3ac6af", "committedDate": "2020-12-16T10:51:41Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}, "afterCommit": {"oid": "10a83f56167663bc570ce1b3dd71d42fa0525858", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/10a83f56167663bc570ce1b3dd71d42fa0525858", "committedDate": "2020-12-16T11:45:14Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "10a83f56167663bc570ce1b3dd71d42fa0525858", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/10a83f56167663bc570ce1b3dd71d42fa0525858", "committedDate": "2020-12-16T11:45:14Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}, "afterCommit": {"oid": "0d61040f6bc755b9acf8302b61649e9e13a336b4", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/0d61040f6bc755b9acf8302b61649e9e13a336b4", "committedDate": "2020-12-16T11:46:22Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNzYxMDY4", "url": "https://github.com/apache/hudi/pull/2340#pullrequestreview-553761068", "createdAt": "2020-12-16T14:50:03Z", "commit": {"oid": "0d61040f6bc755b9acf8302b61649e9e13a336b4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNDo1MDowM1rOIHJEFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNTowNzozMlrOIHJ8tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM1OTQ0NA==", "bodyText": "Does maxIntervalMillis look better?", "url": "https://github.com/apache/hudi/pull/2340#discussion_r544359444", "createdAt": "2020-12-16T14:50:03Z", "author": {"login": "yanghua"}, "path": "hudi-spark-datasource/hudi-spark/src/main/java/org/apache/hudi/QuickstartUtils.java", "diffHunk": "@@ -121,11 +121,22 @@ public static GenericRecord generateGenericRecord(String rowKey, String riderNam\n      */\n     public static OverwriteWithLatestAvroPayload generateRandomValue(HoodieKey key, String riderDriverSuffix)\n         throws IOException {\n+      // The timestamp generated is limited to range from 7 days before to now, to avoid generating too many\n+      // partitionPaths when user use timestamp as partitionPath filed.\n       GenericRecord rec =\n-          generateGenericRecord(key.getRecordKey(), \"rider-\" + riderDriverSuffix, \"driver-\" + riderDriverSuffix, 0);\n+          generateGenericRecord(key.getRecordKey(), \"rider-\" + riderDriverSuffix,\"driver-\"\n+              + riderDriverSuffix, generateRangeRandomTimestamp(7));\n       return new OverwriteWithLatestAvroPayload(Option.of(rec));\n     }\n \n+    /**\n+     * Generate timestamp range from {@param daysTillNow} before to now.\n+     */\n+    private static long generateRangeRandomTimestamp(int daysTillNow) {\n+      long interval = daysTillNow * 24 * 60 * 60 * 1000L;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d61040f6bc755b9acf8302b61649e9e13a336b4"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM3Mzk0Mg==", "bodyText": "Miss whitespace before \"driver-\"", "url": "https://github.com/apache/hudi/pull/2340#discussion_r544373942", "createdAt": "2020-12-16T15:07:32Z", "author": {"login": "yanghua"}, "path": "hudi-spark-datasource/hudi-spark/src/main/java/org/apache/hudi/QuickstartUtils.java", "diffHunk": "@@ -121,11 +121,22 @@ public static GenericRecord generateGenericRecord(String rowKey, String riderNam\n      */\n     public static OverwriteWithLatestAvroPayload generateRandomValue(HoodieKey key, String riderDriverSuffix)\n         throws IOException {\n+      // The timestamp generated is limited to range from 7 days before to now, to avoid generating too many\n+      // partitionPaths when user use timestamp as partitionPath filed.\n       GenericRecord rec =\n-          generateGenericRecord(key.getRecordKey(), \"rider-\" + riderDriverSuffix, \"driver-\" + riderDriverSuffix, 0);\n+          generateGenericRecord(key.getRecordKey(), \"rider-\" + riderDriverSuffix,\"driver-\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d61040f6bc755b9acf8302b61649e9e13a336b4"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aac1b438e22050552e44bc2c8df1ccc55c74eda", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/0aac1b438e22050552e44bc2c8df1ccc55c74eda", "committedDate": "2020-12-17T01:16:49Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d61040f6bc755b9acf8302b61649e9e13a336b4", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/0d61040f6bc755b9acf8302b61649e9e13a336b4", "committedDate": "2020-12-16T11:46:22Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}, "afterCommit": {"oid": "0aac1b438e22050552e44bc2c8df1ccc55c74eda", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/0aac1b438e22050552e44bc2c8df1ccc55c74eda", "committedDate": "2020-12-17T01:16:49Z", "message": "[MINOR] Make QuickstartUtil generate random timestamp instead of 0"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MjIyNDQ5", "url": "https://github.com/apache/hudi/pull/2340#pullrequestreview-554222449", "createdAt": "2020-12-17T01:51:57Z", "commit": {"oid": "0aac1b438e22050552e44bc2c8df1ccc55c74eda"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4012, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}