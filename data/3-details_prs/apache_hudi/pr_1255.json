{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NjE5OTE3", "number": 1255, "title": "[HUDI-559] : Make sure by default table layout version honors the configuration in hoodie.properties", "bodyText": "What is the purpose of the pull request\nMake sure by default table layout version honors the configuration in hoodie.properties\nVerify this pull request\nThis pull request is a trivial rework / code cleanup without any test coverage.\nThis pull request is already covered by existing tests, such as (please describe tests).\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-01-20T02:55:35Z", "url": "https://github.com/apache/hudi/pull/1255", "merged": true, "mergeCommit": {"oid": "ba54a7e9731a8371a8a85e04570d2c951a74ce53"}, "closed": true, "closedAt": "2020-01-20T08:02:56Z", "author": {"login": "bvaradar"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8D13QAFqTM0NTA2MzA4Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8HYFxABqjI5NjE4NDA2MjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MDYzMDg2", "url": "https://github.com/apache/hudi/pull/1255#pullrequestreview-345063086", "createdAt": "2020-01-20T03:15:40Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwMzoxNTo0MVrOFfSq0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwMzoxODoxMFrOFfSsRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODM1NjA1MQ==", "bodyText": "should we just use a VERSION_0 instead of null?", "url": "https://github.com/apache/hudi/pull/1255#discussion_r368356051", "createdAt": "2020-01-20T03:15:41Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieWriteConfig.java", "diffHunk": "@@ -145,7 +145,8 @@ public Boolean shouldAssumeDatePartitioning() {\n   }\n \n   public Integer getTimelineLayoutVersion() {\n-    return Integer.parseInt(props.getProperty(TIMELINE_LAYOUT_VERSION));\n+    return props.containsKey(TIMELINE_LAYOUT_VERSION)\n+        ? Integer.parseInt(props.getProperty(TIMELINE_LAYOUT_VERSION)) : null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODM1NjQyMg==", "bodyText": "and can't we do this using the regular defaults way? why the special handling for containsKey etc? props.getProperty(k, default)?", "url": "https://github.com/apache/hudi/pull/1255#discussion_r368356422", "createdAt": "2020-01-20T03:18:10Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieWriteConfig.java", "diffHunk": "@@ -145,7 +145,8 @@ public Boolean shouldAssumeDatePartitioning() {\n   }\n \n   public Integer getTimelineLayoutVersion() {\n-    return Integer.parseInt(props.getProperty(TIMELINE_LAYOUT_VERSION));\n+    return props.containsKey(TIMELINE_LAYOUT_VERSION)\n+        ? Integer.parseInt(props.getProperty(TIMELINE_LAYOUT_VERSION)) : null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODM1NjA1MQ=="}, "originalCommit": null, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MDc1NDQ2", "url": "https://github.com/apache/hudi/pull/1255#pullrequestreview-345075446", "createdAt": "2020-01-20T04:30:40Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MTAwMTQ5", "url": "https://github.com/apache/hudi/pull/1255#pullrequestreview-345100149", "createdAt": "2020-01-20T06:32:48Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwNjozMjo0OFrOFfUh0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwNjozNToyMVrOFfUjpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODM4NjUxNQ==", "bodyText": "can't this be null? if so, would compareTo below be still happy?", "url": "https://github.com/apache/hudi/pull/1255#discussion_r368386515", "createdAt": "2020-01-20T06:32:48Z", "author": {"login": "vinothchandar"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/HoodieTableMetaClient.java", "diffHunk": "@@ -117,6 +117,13 @@ public HoodieTableMetaClient(Configuration conf, String basePath, boolean loadAc\n     TableNotFoundException.checkTableValidity(fs, basePathDir, metaPathDir);\n     this.tableConfig = new HoodieTableConfig(fs, metaPath, payloadClassName);\n     this.tableType = tableConfig.getTableType();\n+    if (layoutVersion.isPresent()) {\n+      // Ensure layout version passed in config is not lower than the one seen in hoodie.properties\n+      TimelineLayoutVersion tableConfigVersion = tableConfig.getTimelineLayoutVersion();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODM4Njk4MA==", "bodyText": "can the default in HoodieWriteConfig be Option.empty instead of null? Then, we can simply make config.getTimelineLayoutVersion() return a Option directly", "url": "https://github.com/apache/hudi/pull/1255#discussion_r368386980", "createdAt": "2020-01-20T06:35:21Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/src/main/java/org/apache/hudi/client/utils/ClientUtils.java", "diffHunk": "@@ -37,6 +37,8 @@\n   public static HoodieTableMetaClient createMetaClient(JavaSparkContext jsc, HoodieWriteConfig config,\n       boolean loadActiveTimelineOnLoad) {\n     return new HoodieTableMetaClient(jsc.hadoopConfiguration(), config.getBasePath(), loadActiveTimelineOnLoad,\n-        config.getConsistencyGuardConfig(), Option.of(new TimelineLayoutVersion(config.getTimelineLayoutVersion())));\n+        config.getConsistencyGuardConfig(),\n+        Option.ofNullable((config.getTimelineLayoutVersion() != null)\n+            ? new TimelineLayoutVersion(config.getTimelineLayoutVersion()) : null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49775272e0c643fe1d776ede8e950facb0d81525", "author": {"user": {"login": "bvaradar", "name": "Balaji Varadarajan"}}, "url": "https://github.com/apache/hudi/commit/49775272e0c643fe1d776ede8e950facb0d81525", "committedDate": "2020-01-20T07:25:48Z", "message": "[HUDI-559] : Make the timeline layout version default to be null version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "49775272e0c643fe1d776ede8e950facb0d81525", "author": {"user": {"login": "bvaradar", "name": "Balaji Varadarajan"}}, "url": "https://github.com/apache/hudi/commit/49775272e0c643fe1d776ede8e950facb0d81525", "committedDate": "2020-01-20T07:25:48Z", "message": "[HUDI-559] : Make the timeline layout version default to be null version"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4111, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}