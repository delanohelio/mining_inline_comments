{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2MDk1MDQ2", "number": 1871, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNTo1Njo1M1rOEWa2Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxMDo1Nzo1NVrOEWvrQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTQ0MDMxOnYy", "diffSide": "RIGHT", "path": "hudi-client/src/test/java/org/apache/hudi/testutils/HoodieClientTestUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNTo1Njo1NFrOG9t1LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNTo1Njo1NFrOG9t1LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM2NzIxMg==", "bodyText": "deleted APIs that turn out be to useful moved to org.apache.hudi.common.testutils.FilesTestUtils", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467367212", "createdAt": "2020-08-08T05:56:54Z", "author": {"login": "xushiyan"}, "path": "hudi-client/src/test/java/org/apache/hudi/testutils/HoodieClientTestUtils.java", "diffHunk": "@@ -74,57 +74,6 @@\n public class HoodieClientTestUtils {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfcdd491225ab05543b12a8672e3b356b03238f0"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTQ0MTc3OnYy", "diffSide": "LEFT", "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNTo1OTozM1rOG9t16A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNTo1OTozM1rOG9t16A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM2NzQwMA==", "bodyText": "not used", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467367400", "createdAt": "2020-08-08T05:59:33Z", "author": {"login": "xushiyan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -99,7 +99,6 @@\n  */\n public class HoodieTestUtils {\n \n-  public static final String TEST_EXTENSION = \".test\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfcdd491225ab05543b12a8672e3b356b03238f0"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxOTQ0Mjc2OnYy", "diffSide": "RIGHT", "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNjowMDo0OVrOG9t2Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOFQwNjowMDo0OVrOG9t2Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzM2NzUwNg==", "bodyText": "mark private to prevent new usage. to be replaced with HoodieTestTable, too.", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467367506", "createdAt": "2020-08-08T06:00:49Z", "author": {"login": "xushiyan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -279,8 +268,8 @@ public static String createDataFile(String basePath, String partitionPath, Strin\n     return fileID;\n   }\n \n-  public static String createDataFileFixLength(String basePath, String partitionPath, String instantTime, String fileID,\n-      long length) throws IOException {\n+  private static String createDataFileFixLength(String basePath, String partitionPath, String instantTime, String fileID,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfcdd491225ab05543b12a8672e3b356b03238f0"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMDY1NjYwOnYy", "diffSide": "RIGHT", "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/FilesTestUtils.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOVQwMzoyOTowN1rOG93zog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDoyNzoyNFrOG-BFHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUzMDY1OA==", "bodyText": "IMO, The name of this class may make readers confused? It seems to represent that it is a utility class about testing file function. WDYT about renaming it to FileMockUtils?", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467530658", "createdAt": "2020-08-09T03:29:07Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/FilesTestUtils.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.hudi.common.testutils;\n+\n+import org.apache.hudi.common.fs.FSUtils;\n+import org.apache.hudi.common.model.HoodieFileFormat;\n+import org.apache.hudi.common.model.IOType;\n+import org.apache.hudi.common.table.HoodieTableMetaClient;\n+import org.apache.hudi.common.table.timeline.HoodieTimeline;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+\n+public class FilesTestUtils {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2NDMxOQ==", "bodyText": "ok i see your point. To follow the idea of create in another comment, how about FileCreateUtils ?", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467664319", "createdAt": "2020-08-10T02:32:52Z", "author": {"login": "xushiyan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/FilesTestUtils.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.hudi.common.testutils;\n+\n+import org.apache.hudi.common.fs.FSUtils;\n+import org.apache.hudi.common.model.HoodieFileFormat;\n+import org.apache.hudi.common.model.IOType;\n+import org.apache.hudi.common.table.HoodieTableMetaClient;\n+import org.apache.hudi.common.table.timeline.HoodieTimeline;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+\n+public class FilesTestUtils {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUzMDY1OA=="}, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MjU5MQ==", "bodyText": "sounds good.", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467682591", "createdAt": "2020-08-10T04:27:24Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/FilesTestUtils.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.hudi.common.testutils;\n+\n+import org.apache.hudi.common.fs.FSUtils;\n+import org.apache.hudi.common.model.HoodieFileFormat;\n+import org.apache.hudi.common.model.IOType;\n+import org.apache.hudi.common.table.HoodieTableMetaClient;\n+import org.apache.hudi.common.table.timeline.HoodieTimeline;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+\n+public class FilesTestUtils {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUzMDY1OA=="}, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMDY2ODExOnYy", "diffSide": "RIGHT", "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/FilesTestUtils.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOVQwMzo0ODoxMlrOG934tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDoyNjoyM1rOG-BEfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUzMTk1Nw==", "bodyText": "IMO, mock is a better naming than fake. mock is a more generic term in test field. Just a thought.", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467531957", "createdAt": "2020-08-09T03:48:12Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/FilesTestUtils.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.hudi.common.testutils;\n+\n+import org.apache.hudi.common.fs.FSUtils;\n+import org.apache.hudi.common.model.HoodieFileFormat;\n+import org.apache.hudi.common.model.IOType;\n+import org.apache.hudi.common.table.HoodieTableMetaClient;\n+import org.apache.hudi.common.table.timeline.HoodieTimeline;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+\n+public class FilesTestUtils {\n+\n+  private static void fakeMetaFile(String basePath, String instantTime, String suffix) throws IOException {\n+    String parentPath = basePath + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME;\n+    new File(parentPath).mkdirs();\n+    new File(parentPath + \"/\" + instantTime + suffix).createNewFile();\n+  }\n+\n+  public static void fakeCommit(String basePath, String instantTime) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MTc3NA==", "bodyText": "hmm i'm a bit hesitated about using mock as this is commonly used by Mockito. it could imply mock object is used here, while we're actually creating files..", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467661774", "createdAt": "2020-08-10T02:16:19Z", "author": {"login": "xushiyan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/FilesTestUtils.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.hudi.common.testutils;\n+\n+import org.apache.hudi.common.fs.FSUtils;\n+import org.apache.hudi.common.model.HoodieFileFormat;\n+import org.apache.hudi.common.model.IOType;\n+import org.apache.hudi.common.table.HoodieTableMetaClient;\n+import org.apache.hudi.common.table.timeline.HoodieTimeline;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+\n+public class FilesTestUtils {\n+\n+  private static void fakeMetaFile(String basePath, String instantTime, String suffix) throws IOException {\n+    String parentPath = basePath + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME;\n+    new File(parentPath).mkdirs();\n+    new File(parentPath + \"/\" + instantTime + suffix).createNewFile();\n+  }\n+\n+  public static void fakeCommit(String basePath, String instantTime) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUzMTk1Nw=="}, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MjYxMQ==", "bodyText": "@yanghua how about create? since it is actually \"creating\" stuff. e.g., legit marker files are indeed \"created\" by these APIs. Plus the follow-up work is to write actual data to these files, which make them real..", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467662611", "createdAt": "2020-08-10T02:22:02Z", "author": {"login": "xushiyan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/FilesTestUtils.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.hudi.common.testutils;\n+\n+import org.apache.hudi.common.fs.FSUtils;\n+import org.apache.hudi.common.model.HoodieFileFormat;\n+import org.apache.hudi.common.model.IOType;\n+import org.apache.hudi.common.table.HoodieTableMetaClient;\n+import org.apache.hudi.common.table.timeline.HoodieTimeline;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+\n+public class FilesTestUtils {\n+\n+  private static void fakeMetaFile(String basePath, String instantTime, String suffix) throws IOException {\n+    String parentPath = basePath + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME;\n+    new File(parentPath).mkdirs();\n+    new File(parentPath + \"/\" + instantTime + suffix).createNewFile();\n+  }\n+\n+  public static void fakeCommit(String basePath, String instantTime) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUzMTk1Nw=="}, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MjQyOQ==", "bodyText": "Ok, sg.", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467682429", "createdAt": "2020-08-10T04:26:23Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/FilesTestUtils.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.hudi.common.testutils;\n+\n+import org.apache.hudi.common.fs.FSUtils;\n+import org.apache.hudi.common.model.HoodieFileFormat;\n+import org.apache.hudi.common.model.IOType;\n+import org.apache.hudi.common.table.HoodieTableMetaClient;\n+import org.apache.hudi.common.table.timeline.HoodieTimeline;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+\n+public class FilesTestUtils {\n+\n+  private static void fakeMetaFile(String basePath, String instantTime, String suffix) throws IOException {\n+    String parentPath = basePath + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME;\n+    new File(parentPath).mkdirs();\n+    new File(parentPath + \"/\" + instantTime + suffix).createNewFile();\n+  }\n+\n+  public static void fakeCommit(String basePath, String instantTime) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzUzMTk1Nw=="}, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTA0MDQ3OnYy", "diffSide": "RIGHT", "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/FilesTestUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOVQxMjoyMDo1OFrOG96pMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOVQxMjoyMDo1OFrOG96pMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzU3NzEzOQ==", "bodyText": "Using Files.createFile(...) may be better?", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467577139", "createdAt": "2020-08-09T12:20:58Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/FilesTestUtils.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.hudi.common.testutils;\n+\n+import org.apache.hudi.common.fs.FSUtils;\n+import org.apache.hudi.common.model.HoodieFileFormat;\n+import org.apache.hudi.common.model.IOType;\n+import org.apache.hudi.common.table.HoodieTableMetaClient;\n+import org.apache.hudi.common.table.timeline.HoodieTimeline;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.RandomAccessFile;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+\n+public class FilesTestUtils {\n+\n+  private static void fakeMetaFile(String basePath, String instantTime, String suffix) throws IOException {\n+    String parentPath = basePath + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME;\n+    new File(parentPath).mkdirs();\n+    new File(parentPath + \"/\" + instantTime + suffix).createNewFile();\n+  }\n+\n+  public static void fakeCommit(String basePath, String instantTime) throws IOException {\n+    fakeMetaFile(basePath, instantTime, HoodieTimeline.COMMIT_EXTENSION);\n+  }\n+\n+  public static void fakeRequestedCommit(String basePath, String instantTime) throws IOException {\n+    fakeMetaFile(basePath, instantTime, HoodieTimeline.REQUESTED_COMMIT_EXTENSION);\n+  }\n+\n+  public static void fakeInflightCommit(String basePath, String instantTime) throws IOException {\n+    fakeMetaFile(basePath, instantTime, HoodieTimeline.INFLIGHT_COMMIT_EXTENSION);\n+  }\n+\n+  public static void fakeDeltaCommit(String basePath, String instantTime) throws IOException {\n+    fakeMetaFile(basePath, instantTime, HoodieTimeline.DELTA_COMMIT_EXTENSION);\n+  }\n+\n+  public static void fakeRequestedDeltaCommit(String basePath, String instantTime) throws IOException {\n+    fakeMetaFile(basePath, instantTime, HoodieTimeline.REQUESTED_DELTA_COMMIT_EXTENSION);\n+  }\n+\n+  public static void fakeInflightDeltaCommit(String basePath, String instantTime) throws IOException {\n+    fakeMetaFile(basePath, instantTime, HoodieTimeline.INFLIGHT_DELTA_COMMIT_EXTENSION);\n+  }\n+\n+  public static void fakeDataFile(String basePath, String partitionPath, String instantTime, String fileId)\n+      throws Exception {\n+    fakeDataFile(basePath, partitionPath, instantTime, fileId, 0);\n+  }\n+\n+  public static void fakeDataFile(String basePath, String partitionPath, String instantTime, String fileId, long length)\n+      throws Exception {\n+    String parentPath = String.format(\"%s/%s\", basePath, partitionPath);\n+    new File(parentPath).mkdirs();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTA0MzIzOnYy", "diffSide": "RIGHT", "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wOVQxMjoyNDo0N1rOG96qfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDozMjo1M1rOG-BI6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzU3NzQ3MQ==", "bodyText": "Does this indentation style break the rule of the project?", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467577471", "createdAt": "2020-08-09T12:24:47Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -307,31 +299,26 @@ public static String createNewLogFile(FileSystem fs, String basePath, String par\n     return fileID;\n   }\n \n-  public static void createCompactionCommitFiles(FileSystem fs, String basePath, String... instantTimes)\n-      throws IOException {\n-    for (String instantTime : instantTimes) {\n-      boolean createFile = fs.createNewFile(new Path(basePath + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\"\n-          + HoodieTimeline.makeCommitFileName(instantTime)));\n-      if (!createFile) {\n-        throw new IOException(\"cannot create commit file for commit \" + instantTime);\n-      }\n-    }\n-  }\n-\n   public static void createCompactionRequest(HoodieTableMetaClient metaClient, String instant,\n-      List<Pair<String, FileSlice>> fileSliceList) throws IOException {\n+                                             List<Pair<String, FileSlice>> fileSliceList) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MTEwNA==", "bodyText": "Checkstyle did not complain about (or cover) it. The intellij of the new version starts to format this way. Guess it is due to missing a checkstyle rule for this, causing IDE format in its own way. Right now I've seen this style exist too in the codebase.", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467661104", "createdAt": "2020-08-10T02:11:36Z", "author": {"login": "xushiyan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -307,31 +299,26 @@ public static String createNewLogFile(FileSystem fs, String basePath, String par\n     return fileID;\n   }\n \n-  public static void createCompactionCommitFiles(FileSystem fs, String basePath, String... instantTimes)\n-      throws IOException {\n-    for (String instantTime : instantTimes) {\n-      boolean createFile = fs.createNewFile(new Path(basePath + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\"\n-          + HoodieTimeline.makeCommitFileName(instantTime)));\n-      if (!createFile) {\n-        throw new IOException(\"cannot create commit file for commit \" + instantTime);\n-      }\n-    }\n-  }\n-\n   public static void createCompactionRequest(HoodieTableMetaClient metaClient, String instant,\n-      List<Pair<String, FileSlice>> fileSliceList) throws IOException {\n+                                             List<Pair<String, FileSlice>> fileSliceList) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzU3NzQ3MQ=="}, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2OTI5MA==", "bodyText": "I see the issue is that we did not set forceStrictCondition to true, that's why intellij can align this and make the indentation longer than what the rule sets.\nhttps://checkstyle.sourceforge.io/config_misc.html#Indentation_Properties\n@yanghua Do you agree we should set it to true? This can be done in a separate PR.", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467669290", "createdAt": "2020-08-10T03:03:58Z", "author": {"login": "xushiyan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -307,31 +299,26 @@ public static String createNewLogFile(FileSystem fs, String basePath, String par\n     return fileID;\n   }\n \n-  public static void createCompactionCommitFiles(FileSystem fs, String basePath, String... instantTimes)\n-      throws IOException {\n-    for (String instantTime : instantTimes) {\n-      boolean createFile = fs.createNewFile(new Path(basePath + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\"\n-          + HoodieTimeline.makeCommitFileName(instantTime)));\n-      if (!createFile) {\n-        throw new IOException(\"cannot create commit file for commit \" + instantTime);\n-      }\n-    }\n-  }\n-\n   public static void createCompactionRequest(HoodieTableMetaClient metaClient, String instant,\n-      List<Pair<String, FileSlice>> fileSliceList) throws IOException {\n+                                             List<Pair<String, FileSlice>> fileSliceList) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzU3NzQ3MQ=="}, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MzU2Mg==", "bodyText": "Let @vinothchandar chime in. I knew that @vinothchandar 's major concern is that whether the rule of code style support automatically formatting or not.\nHere I will ignore these issues.", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467683562", "createdAt": "2020-08-10T04:32:53Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -307,31 +299,26 @@ public static String createNewLogFile(FileSystem fs, String basePath, String par\n     return fileID;\n   }\n \n-  public static void createCompactionCommitFiles(FileSystem fs, String basePath, String... instantTimes)\n-      throws IOException {\n-    for (String instantTime : instantTimes) {\n-      boolean createFile = fs.createNewFile(new Path(basePath + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\"\n-          + HoodieTimeline.makeCommitFileName(instantTime)));\n-      if (!createFile) {\n-        throw new IOException(\"cannot create commit file for commit \" + instantTime);\n-      }\n-    }\n-  }\n-\n   public static void createCompactionRequest(HoodieTableMetaClient metaClient, String instant,\n-      List<Pair<String, FileSlice>> fileSliceList) throws IOException {\n+                                             List<Pair<String, FileSlice>> fileSliceList) throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzU3NzQ3MQ=="}, "originalCommit": {"oid": "ddb560111ec9c752867c0e41752e83396a562664"}, "originalPosition": 141}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMjg1MTEyOnYy", "diffSide": "RIGHT", "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxMDo1NzoyNVrOG-J6QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMTo0NTozMVrOG-lfNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgyNzI2NA==", "bodyText": "Can we use Paths.get() to reduce link path parts via /?", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467827264", "createdAt": "2020-08-10T10:57:25Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -237,11 +229,12 @@ public static void createPendingCleanFiles(HoodieTableMetaClient metaClient, Str\n \n   public static void createCorruptedPendingCleanFiles(HoodieTableMetaClient metaClient, String commitTime) {\n     Arrays.asList(HoodieTimeline.makeRequestedCleanerFileName(commitTime),\n-        HoodieTimeline.makeInflightCleanerFileName(commitTime)).forEach(f -> {\n+        HoodieTimeline.makeInflightCleanerFileName(commitTime))\n+        .forEach(f -> {\n           FSDataOutputStream os = null;\n           try {\n             Path commitFile = new Path(\n-                    metaClient.getBasePath() + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\" + f);\n+                metaClient.getBasePath() + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\" + f);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c841a398870142c5e153d924094dbd086d154e4"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAzMjEzMw==", "bodyText": "sure, fixed 2 of this. Please note that, as this is from the original codebase, i didn't change all of this kind of usage in this file. I think it could be a good chance to change while moving the APIs to HoodieTestTable.", "url": "https://github.com/apache/hudi/pull/1871#discussion_r468032133", "createdAt": "2020-08-10T16:32:45Z", "author": {"login": "xushiyan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -237,11 +229,12 @@ public static void createPendingCleanFiles(HoodieTableMetaClient metaClient, Str\n \n   public static void createCorruptedPendingCleanFiles(HoodieTableMetaClient metaClient, String commitTime) {\n     Arrays.asList(HoodieTimeline.makeRequestedCleanerFileName(commitTime),\n-        HoodieTimeline.makeInflightCleanerFileName(commitTime)).forEach(f -> {\n+        HoodieTimeline.makeInflightCleanerFileName(commitTime))\n+        .forEach(f -> {\n           FSDataOutputStream os = null;\n           try {\n             Path commitFile = new Path(\n-                    metaClient.getBasePath() + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\" + f);\n+                metaClient.getBasePath() + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\" + f);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgyNzI2NA=="}, "originalCommit": {"oid": "0c841a398870142c5e153d924094dbd086d154e4"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3NjE5NA==", "bodyText": "Ok, I noticed this because I saw the indent has been changed. Actually, I suggested that we can focus on the core work about the PR want to do. Do not touch something else e.g. indent and code style. Of cause, I should not ask you to change this.", "url": "https://github.com/apache/hudi/pull/1871#discussion_r468276194", "createdAt": "2020-08-11T01:34:04Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -237,11 +229,12 @@ public static void createPendingCleanFiles(HoodieTableMetaClient metaClient, Str\n \n   public static void createCorruptedPendingCleanFiles(HoodieTableMetaClient metaClient, String commitTime) {\n     Arrays.asList(HoodieTimeline.makeRequestedCleanerFileName(commitTime),\n-        HoodieTimeline.makeInflightCleanerFileName(commitTime)).forEach(f -> {\n+        HoodieTimeline.makeInflightCleanerFileName(commitTime))\n+        .forEach(f -> {\n           FSDataOutputStream os = null;\n           try {\n             Path commitFile = new Path(\n-                    metaClient.getBasePath() + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\" + f);\n+                metaClient.getBasePath() + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\" + f);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgyNzI2NA=="}, "originalCommit": {"oid": "0c841a398870142c5e153d924094dbd086d154e4"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3OTA5Mg==", "bodyText": "ok @yanghua ,  understood. I agree that the work should focus on the task. I didn't intend to change these; intellij did it for me. i should have disabled the auto-formatting. will keep this sort of diffs out from now on. thanks", "url": "https://github.com/apache/hudi/pull/1871#discussion_r468279092", "createdAt": "2020-08-11T01:45:31Z", "author": {"login": "xushiyan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -237,11 +229,12 @@ public static void createPendingCleanFiles(HoodieTableMetaClient metaClient, Str\n \n   public static void createCorruptedPendingCleanFiles(HoodieTableMetaClient metaClient, String commitTime) {\n     Arrays.asList(HoodieTimeline.makeRequestedCleanerFileName(commitTime),\n-        HoodieTimeline.makeInflightCleanerFileName(commitTime)).forEach(f -> {\n+        HoodieTimeline.makeInflightCleanerFileName(commitTime))\n+        .forEach(f -> {\n           FSDataOutputStream os = null;\n           try {\n             Path commitFile = new Path(\n-                    metaClient.getBasePath() + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\" + f);\n+                metaClient.getBasePath() + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\" + f);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgyNzI2NA=="}, "originalCommit": {"oid": "0c841a398870142c5e153d924094dbd086d154e4"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMjg1MjQ5OnYy", "diffSide": "RIGHT", "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxMDo1Nzo1NVrOG-J7Cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNjoxNToyMVrOG-Vxfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgyNzQ2Nw==", "bodyText": "Why do we need to break the forEach?", "url": "https://github.com/apache/hudi/pull/1871#discussion_r467827467", "createdAt": "2020-08-10T10:57:55Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -237,11 +229,12 @@ public static void createPendingCleanFiles(HoodieTableMetaClient metaClient, Str\n \n   public static void createCorruptedPendingCleanFiles(HoodieTableMetaClient metaClient, String commitTime) {\n     Arrays.asList(HoodieTimeline.makeRequestedCleanerFileName(commitTime),\n-        HoodieTimeline.makeInflightCleanerFileName(commitTime)).forEach(f -> {\n+        HoodieTimeline.makeInflightCleanerFileName(commitTime))\n+        .forEach(f -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c841a398870142c5e153d924094dbd086d154e4"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAyMTYzMA==", "bodyText": "intellij will force some weird indentation that breaks checkstyle rule...this is the easiest way I can find to prevent that", "url": "https://github.com/apache/hudi/pull/1871#discussion_r468021630", "createdAt": "2020-08-10T16:15:21Z", "author": {"login": "xushiyan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestUtils.java", "diffHunk": "@@ -237,11 +229,12 @@ public static void createPendingCleanFiles(HoodieTableMetaClient metaClient, Str\n \n   public static void createCorruptedPendingCleanFiles(HoodieTableMetaClient metaClient, String commitTime) {\n     Arrays.asList(HoodieTimeline.makeRequestedCleanerFileName(commitTime),\n-        HoodieTimeline.makeInflightCleanerFileName(commitTime)).forEach(f -> {\n+        HoodieTimeline.makeInflightCleanerFileName(commitTime))\n+        .forEach(f -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgyNzQ2Nw=="}, "originalCommit": {"oid": "0c841a398870142c5e153d924094dbd086d154e4"}, "originalPosition": 92}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4357, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}