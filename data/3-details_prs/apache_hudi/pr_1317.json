{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyOTYxMTk0", "number": 1317, "title": "[HUDI-605] Avoid calculating the size of schema redundantly", "bodyText": "What is the purpose of the pull request\nThe same schema object is shared amongst all records in the JVM.\nBrief change log\n\nCalculate the size of schema when init HoodieRecordSizeEstimator\n\nVerify this pull request\nThis pull request is already covered by existing tests:\norg.apache.hudi.common.util.collection.TestDiskBasedMap.\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-02-10T06:24:47Z", "url": "https://github.com/apache/hudi/pull/1317", "merged": true, "mergeCommit": {"oid": "d2c872ede47bf532193b208a8924932c7e1f7741"}, "closed": true, "closedAt": "2020-02-12T11:40:53Z", "author": {"login": "lamberken"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC2_nCgH2gAyMzcyOTYxMTk0OjdlNDZiZGRhNjZhNzRlZWI2MjJkYjNmNjE3MDZhNmM5MjVhODFlYzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDkyt3AFqTM1NzM4NTA2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7e46bdda66a74eeb622db3f61706a6c925a81ec7", "author": {"user": {"login": "lamberken", "name": "lamberken"}}, "url": "https://github.com/apache/hudi/commit/7e46bdda66a74eeb622db3f61706a6c925a81ec7", "committedDate": "2020-02-10T06:18:17Z", "message": "[HUDI-605] Avoid calculating the size of schema redundantly"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzIzMTE0", "url": "https://github.com/apache/hudi/pull/1317#pullrequestreview-355723114", "createdAt": "2020-02-10T07:09:07Z", "commit": {"oid": "7e46bdda66a74eeb622db3f61706a6c925a81ec7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNzowOTowN1rOFnb0kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNzowOTowN1rOFnb0kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg5NDYxMA==", "bodyText": "why change these?", "url": "https://github.com/apache/hudi/pull/1317#discussion_r376894610", "createdAt": "2020-02-10T07:09:07Z", "author": {"login": "vinothchandar"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/util/collection/DiskBasedMap.java", "diffHunk": "@@ -223,8 +223,8 @@ private R get(ValueMetadata entry) {\n   private synchronized R put(T key, R value, boolean flush) {\n     try {\n       byte[] val = SerializationUtils.serialize(value);\n-      Integer valueSize = val.length;\n-      Long timestamp = System.currentTimeMillis();\n+      int valueSize = val.length;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e46bdda66a74eeb622db3f61706a6c925a81ec7"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9784ca2f0df2e9da85ee0c548ac05a487aec4049", "author": {"user": {"login": "lamberken", "name": "lamberken"}}, "url": "https://github.com/apache/hudi/commit/9784ca2f0df2e9da85ee0c548ac05a487aec4049", "committedDate": "2020-02-10T07:26:23Z", "message": "revert org.apache.hudi.common.util.collection.DiskBasedMap"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2Njc1MDQw", "url": "https://github.com/apache/hudi/pull/1317#pullrequestreview-356675040", "createdAt": "2020-02-11T13:57:46Z", "commit": {"oid": "9784ca2f0df2e9da85ee0c548ac05a487aec4049"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo1Nzo0N1rOFoJ3_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo1Nzo0N1rOFoJ3_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY0OTE1MQ==", "bodyText": "Would be still keep to LOG.info or Any reason to change to debug?", "url": "https://github.com/apache/hudi/pull/1317#discussion_r377649151", "createdAt": "2020-02-11T13:57:47Z", "author": {"login": "leesf"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/util/HoodieRecordSizeEstimator.java", "diffHunk": "@@ -49,8 +48,9 @@ public long sizeEstimate(HoodieRecord<T> hoodieRecord) {\n     // note the sizes and differences. A correct estimation in such cases is handled in\n     /** {@link ExternalSpillableMap} **/\n     long sizeOfRecord = ObjectSizeCalculator.getObjectSize(hoodieRecord);\n-    long sizeOfSchema = ObjectSizeCalculator.getObjectSize(schema);\n-    LOG.info(\"SizeOfRecord => \" + sizeOfRecord + \" SizeOfSchema => \" + sizeOfSchema);\n+    if (LOG.isDebugEnabled()) {\n+      LOG.debug(\"SizeOfRecord => \" + sizeOfRecord + \" SizeOfSchema => \" + sizeOfSchema);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9784ca2f0df2e9da85ee0c548ac05a487aec4049"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3Mzg1MDYx", "url": "https://github.com/apache/hudi/pull/1317#pullrequestreview-357385061", "createdAt": "2020-02-12T11:39:50Z", "commit": {"oid": "9784ca2f0df2e9da85ee0c548ac05a487aec4049"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4219, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}