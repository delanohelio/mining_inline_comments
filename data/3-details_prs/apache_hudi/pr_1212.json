{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxODEyNjk4", "number": 1212, "title": "[HUDI-509] Renaming code in sync with cWiki restructuring", "bodyText": "Tips\n\nThank you very much for contributing to Apache Hudi.\nPlease review https://hudi.apache.org/contributing.html before opening a pull request.\n\nWhat is the purpose of the pull request\nThis PR renames classes,configs in Hudi to align with the new terminologies defined in the cWiki design and architecture page.\nBrief change log\n\nStorage Type replaced with Table Type (remaining instances)\nView types replaced with query types;\nReadOptimized view referred as Snapshot Query\nTableFileSystemView sub interfaces renamed to BaseFileOnly and Slice Views\nHoodieDataFile renamed to HoodieBaseFile\nHive Sync tool will register RO tables for MOR with a _ro suffix\nDatasource/Deltastreamer options renamed accordingly\nSupport fallback to old config values as well, so migration is painless\nConfig for controlling _ro suffix addition\nIntegration test fixed accordingly\n\nVerify this pull request\nThis change is covered by existing tests; integration tests have been redone where needed\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-01-12T09:52:44Z", "url": "https://github.com/apache/hudi/pull/1212", "merged": true, "mergeCommit": {"oid": "c2c0f6b13d5b72b3098ed1b343b0a89679f854b3"}, "closed": true, "closedAt": "2020-01-17T07:58:48Z", "author": {"login": "vinothchandar"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5kv9pgFqTM0MTU2NDc2OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7JmEJgH2gAyMzYxODEyNjk4OmIxMmNkNDYxNDg0YTcwMTMzNDQ1YWY4NzEzMzc4ZWRlNTJmMTNkZTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTY0NzY5", "url": "https://github.com/apache/hudi/pull/1212#pullrequestreview-341564769", "createdAt": "2020-01-12T09:57:35Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQwOTo1NzozNVrOFcorEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQwOTo1NzozNVrOFcorEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU3MDgzNQ==", "bodyText": "IMO, this means ORC support is coming \ud83d\udc4d", "url": "https://github.com/apache/hudi/pull/1212#discussion_r365570835", "createdAt": "2020-01-12T09:57:35Z", "author": {"login": "lamberken"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/model/HoodieBaseFile.java", "diffHunk": "@@ -27,21 +27,21 @@\n import java.util.Objects;\n \n /**\n- * Hoodie data file.\n+ * Hoodie base file.\n  */\n-public class HoodieDataFile implements Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMzYxMjY0", "url": "https://github.com/apache/hudi/pull/1212#pullrequestreview-342361264", "createdAt": "2020-01-14T08:38:34Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODozODozNFrOFdPjwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwODo1NDowMVrOFdP8Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIwNzkzNg==", "bodyText": "I tried retaining --storage-type as well. but have to choose betwen this and the new --table-typeto mark as required.. Whichever we pick, it wont be ideal. So choose to simply rename, requiring the users to make a small change in the command, when upgrading.", "url": "https://github.com/apache/hudi/pull/1212#discussion_r366207936", "createdAt": "2020-01-14T08:38:34Z", "author": {"login": "vinothchandar"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/deltastreamer/HoodieDeltaStreamer.java", "diffHunk": "@@ -160,9 +160,9 @@ public Operation convert(String value) throws ParameterException {\n     @Parameter(names = {\"--target-table\"}, description = \"name of the target table in Hive\", required = true)\n     public String targetTableName;\n \n-    @Parameter(names = {\"--storage-type\"}, description = \"Type of Storage. COPY_ON_WRITE (or) MERGE_ON_READ\",\n+    @Parameter(names = {\"--table-type\"}, description = \"Type of table. COPY_ON_WRITE (or) MERGE_ON_READ\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIxNDIzNA==", "bodyText": "this is a behavior change... previously MOR realtime view errored out here.. now we just return the same RO query results with a warning..", "url": "https://github.com/apache/hudi/pull/1212#discussion_r366214234", "createdAt": "2020-01-14T08:54:01Z", "author": {"login": "vinothchandar"}, "path": "hudi-spark/src/main/scala/org/apache/hudi/DefaultSource.scala", "diffHunk": "@@ -50,20 +50,14 @@ class DefaultSource extends RelationProvider\n                               optParams: Map[String, String],\n                               schema: StructType): BaseRelation = {\n     // Add default options for unspecified read options keys.\n-    val parameters = Map(VIEW_TYPE_OPT_KEY -> DEFAULT_VIEW_TYPE_OPT_VAL) ++ optParams\n+    val parameters = Map(QUERY_TYPE_OPT_KEY -> DEFAULT_QUERY_TYPE_OPT_VAL) ++ optParams\n \n     val path = parameters.get(\"path\")\n     if (path.isEmpty) {\n       throw new HoodieException(\"'path' must be specified.\")\n     }\n \n-    if (parameters(VIEW_TYPE_OPT_KEY).equals(VIEW_TYPE_REALTIME_OPT_VAL)) {\n-      throw new HoodieException(\"Realtime view not supported yet via data source. Please use HiveContext route.\")\n-    }\n-\n-    if (parameters(VIEW_TYPE_OPT_KEY).equals(VIEW_TYPE_INCREMENTAL_OPT_VAL)) {\n-      new IncrementalRelation(sqlContext, path.get, optParams, schema)\n-    } else {\n+    if (parameters(QUERY_TYPE_OPT_KEY).equals(QUERY_TYPE_SNAPSHOT_OPT_VAL)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyOTU3Nzk2", "url": "https://github.com/apache/hudi/pull/1212#pullrequestreview-342957796", "createdAt": "2020-01-15T02:28:25Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNjEyNzMx", "url": "https://github.com/apache/hudi/pull/1212#pullrequestreview-343612731", "createdAt": "2020-01-16T00:39:14Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwMDozOToxNFrOFeK2Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwMDozOToxNFrOFeK2Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE3OTM2Ng==", "bodyText": "s/full/complete?", "url": "https://github.com/apache/hudi/pull/1212#discussion_r367179366", "createdAt": "2020-01-16T00:39:14Z", "author": {"login": "n3nash"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/SyncableFileSystemView.java", "diffHunk": "@@ -18,12 +18,15 @@\n \n package org.apache.hudi.common.table;\n \n+import org.apache.hudi.common.table.TableFileSystemView.BaseFileOnlyView;\n+import org.apache.hudi.common.table.TableFileSystemView.SliceView;\n+\n /**\n- * A consolidated file-system view interface exposing both realtime and read-optimized views along with\n+ * A consolidated file-system view interface exposing both full and basefile only views along with", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNjEzMDE5", "url": "https://github.com/apache/hudi/pull/1212#pullrequestreview-343613019", "createdAt": "2020-01-16T00:40:04Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwMDo0MDowNVrOFeK3Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQwMDo0MDowNVrOFeK3Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE3OTYwNw==", "bodyText": "Not sure if it's the best user-experience to augment the table name with a postfix for all tables..", "url": "https://github.com/apache/hudi/pull/1212#discussion_r367179607", "createdAt": "2020-01-16T00:40:05Z", "author": {"login": "n3nash"}, "path": "hudi-hive/src/main/java/org/apache/hudi/hive/HiveSyncTool.java", "diffHunk": "@@ -53,30 +53,44 @@\n public class HiveSyncTool {\n \n   private static final Logger LOG = LogManager.getLogger(HiveSyncTool.class);\n-  private final HoodieHiveClient hoodieHiveClient;\n-  public static final String SUFFIX_REALTIME_TABLE = \"_rt\";\n+  public static final String SUFFIX_SNAPSHOT_TABLE = \"_rt\";\n+  public static final String SUFFIX_READ_OPTIMIZED_TABLE = \"_ro\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNjEzMjQ1", "url": "https://github.com/apache/hudi/pull/1212#pullrequestreview-343613245", "createdAt": "2020-01-16T00:40:51Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "426aeced1b819a610219e744a1b801bcf13c7402", "author": {"user": {"login": "vinothchandar", "name": "vinoth chandar"}}, "url": "https://github.com/apache/hudi/commit/426aeced1b819a610219e744a1b801bcf13c7402", "committedDate": "2020-01-16T18:13:39Z", "message": "[HUDI-509] Renaming code in sync with cWiki restructuring\n\n - Storage Type replaced with Table Type (remaining instances)\n - View types replaced with query types;\n - ReadOptimized view referred as Snapshot Query\n - TableFileSystemView sub interfaces renamed to BaseFileOnly and Slice Views\n - HoodieDataFile renamed to HoodieBaseFile\n - Hive Sync tool will register RO tables for MOR with a `_ro` suffix\n - Datasource/Deltastreamer options renamed accordingly\n\nTDB\n [ ] Support fallback to old config values as well, so migration is painless\n [ ] Config for controlling _ro suffix addition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4007e23f184f9fa9e9d19700eb5b30f6c1c51ba", "author": {"user": {"login": "vinothchandar", "name": "vinoth chandar"}}, "url": "https://github.com/apache/hudi/commit/c4007e23f184f9fa9e9d19700eb5b30f6c1c51ba", "committedDate": "2020-01-16T18:13:39Z", "message": "Fix issue with hive sync, by refactoring how table name is passed around"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2633bcb7e2715aa7debeef1c160c1e8496faf6ff", "author": {"user": {"login": "vinothchandar", "name": "vinoth chandar"}}, "url": "https://github.com/apache/hudi/commit/2633bcb7e2715aa7debeef1c160c1e8496faf6ff", "committedDate": "2020-01-16T18:14:20Z", "message": "Adding translation to new configs, in cases where user specifies the old configs still"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97d21b1bf3e301357ad35ced94f16bf075f25c22", "author": {"user": {"login": "vinothchandar", "name": "vinoth chandar"}}, "url": "https://github.com/apache/hudi/commit/97d21b1bf3e301357ad35ced94f16bf075f25c22", "committedDate": "2020-01-16T18:14:21Z", "message": "Also fix HoodieJavaApp, update doap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "97d21b1bf3e301357ad35ced94f16bf075f25c22", "author": {"user": {"login": "vinothchandar", "name": "vinoth chandar"}}, "url": "https://github.com/apache/hudi/commit/97d21b1bf3e301357ad35ced94f16bf075f25c22", "committedDate": "2020-01-16T18:14:21Z", "message": "Also fix HoodieJavaApp, update doap"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MjUyNzQx", "url": "https://github.com/apache/hudi/pull/1212#pullrequestreview-344252741", "createdAt": "2020-01-16T22:14:20Z", "commit": {"oid": "97d21b1bf3e301357ad35ced94f16bf075f25c22"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMjoxNDoyMFrOFepSdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMjoxNDoyMFrOFepSdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY3ODA2OA==", "bodyText": "@vinothchandar Do we want to rename the method as well to 'toHoodieBaseFile' ?", "url": "https://github.com/apache/hudi/pull/1212#discussion_r367678068", "createdAt": "2020-01-16T22:14:20Z", "author": {"login": "bhasudha"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/timeline/dto/DataFileDTO.java", "diffHunk": "@@ -36,22 +36,22 @@\n   @JsonProperty(\"fileLen\")\n   private long fileLen;\n \n-  public static HoodieDataFile toHoodieDataFile(DataFileDTO dto) {\n+  public static HoodieBaseFile toHoodieDataFile(DataFileDTO dto) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d21b1bf3e301357ad35ced94f16bf075f25c22"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MjUyOTYw", "url": "https://github.com/apache/hudi/pull/1212#pullrequestreview-344252960", "createdAt": "2020-01-16T22:14:49Z", "commit": {"oid": "97d21b1bf3e301357ad35ced94f16bf075f25c22"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMjoxNDo0OVrOFepTJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMjoxNDo0OVrOFepTJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY3ODI0NQ==", "bodyText": "'fromHoodieBaseFile' instead ?", "url": "https://github.com/apache/hudi/pull/1212#discussion_r367678245", "createdAt": "2020-01-16T22:14:49Z", "author": {"login": "bhasudha"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/timeline/dto/DataFileDTO.java", "diffHunk": "@@ -36,22 +36,22 @@\n   @JsonProperty(\"fileLen\")\n   private long fileLen;\n \n-  public static HoodieDataFile toHoodieDataFile(DataFileDTO dto) {\n+  public static HoodieBaseFile toHoodieDataFile(DataFileDTO dto) {\n     if (null == dto) {\n       return null;\n     }\n \n-    HoodieDataFile dataFile = null;\n+    HoodieBaseFile dataFile = null;\n     if (null != dto.fileStatus) {\n-      dataFile = new HoodieDataFile(FileStatusDTO.toFileStatus(dto.fileStatus));\n+      dataFile = new HoodieBaseFile(FileStatusDTO.toFileStatus(dto.fileStatus));\n     } else {\n-      dataFile = new HoodieDataFile(dto.fullPath);\n+      dataFile = new HoodieBaseFile(dto.fullPath);\n       dataFile.setFileLen(dto.fileLen);\n     }\n     return dataFile;\n   }\n \n-  public static DataFileDTO fromHoodieDataFile(HoodieDataFile dataFile) {\n+  public static DataFileDTO fromHoodieDataFile(HoodieBaseFile dataFile) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d21b1bf3e301357ad35ced94f16bf075f25c22"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MjU1MTU4", "url": "https://github.com/apache/hudi/pull/1212#pullrequestreview-344255158", "createdAt": "2020-01-16T22:19:17Z", "commit": {"oid": "97d21b1bf3e301357ad35ced94f16bf075f25c22"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMjoxOToxOFrOFepZhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNlQyMjoxOToxOFrOFepZhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzY3OTg3Nw==", "bodyText": "convertFileStatusesToBaseFiles instead ? No strong opinion on these. I think it should be okay to leave it as is since the return type is indicative already.", "url": "https://github.com/apache/hudi/pull/1212#discussion_r367679877", "createdAt": "2020-01-16T22:19:18Z", "author": {"login": "bhasudha"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/view/AbstractTableFileSystemView.java", "diffHunk": "@@ -249,10 +249,10 @@ private void ensurePartitionLoadedCorrectly(String partition) {\n    *\n    * @param statuses List of File-Status\n    */\n-  private Stream<HoodieDataFile> convertFileStatusesToDataFiles(FileStatus[] statuses) {\n+  private Stream<HoodieBaseFile> convertFileStatusesToDataFiles(FileStatus[] statuses) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97d21b1bf3e301357ad35ced94f16bf075f25c22"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0MjY1NzA1", "url": "https://github.com/apache/hudi/pull/1212#pullrequestreview-344265705", "createdAt": "2020-01-16T22:42:46Z", "commit": {"oid": "97d21b1bf3e301357ad35ced94f16bf075f25c22"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b12cd461484a70133445af8713378ede52f13de6", "author": {"user": {"login": "vinothchandar", "name": "vinoth chandar"}}, "url": "https://github.com/apache/hudi/commit/b12cd461484a70133445af8713378ede52f13de6", "committedDate": "2020-01-17T07:27:11Z", "message": "Renaming DataFile to BaseFile across DTOs, HoodieFileSlice and AbstractTableFileSystemView"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4045, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}