{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NjM0MzI3", "number": 1330, "title": "[HUDI-607] Fix to allow creation/syncing of Hive tables partitioned by Date type columns", "bodyText": "What is the purpose of the pull request\nThe issue is well described in https://issues.apache.org/jira/browse/HUDI-607 . It fixes an issue where Hive sync fails to create table, when a Date type column is the partition column for the table.\nBrief change log\n\nMake changes in DataSourceUtils, to check if the field for which value is being returned is of Avro Logical Date Type. If yes, it is returned as the actual date string and not epoch day value. This would let Hudi use the actual date string as the value, everywhere in its metadata.\nUnit tests\n\nVerify this pull request\nThis change added tests and can be verified as follows:\n\nAdded DataSourceUtilsTest class\n\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-02-13T02:16:26Z", "url": "https://github.com/apache/hudi/pull/1330", "merged": true, "mergeCommit": {"oid": "2d040145810b8b14c59c5882f9115698351039d1"}, "closed": true, "closedAt": "2020-03-01T18:42:59Z", "author": {"login": "umehrot2"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEF4YIgFqTM1ODY3NTMzNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIswU0gBqjMwODEyNjQxNjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4Njc1MzM3", "url": "https://github.com/apache/hudi/pull/1330#pullrequestreview-358675337", "createdAt": "2020-02-14T02:11:44Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwMjoxMTo0NFrOFppvUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQwMjoxMjozOFrOFppwAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIxOTc5NA==", "bodyText": "Should we do this conversion out in the caller of this method instead?", "url": "https://github.com/apache/hudi/pull/1330#discussion_r379219794", "createdAt": "2020-02-14T02:11:44Z", "author": {"login": "vinothchandar"}, "path": "hudi-spark/src/main/java/org/apache/hudi/DataSourceUtils.java", "diffHunk": "@@ -77,6 +80,11 @@ public static Object getNestedFieldVal(GenericRecord record, String fieldName, b\n \n       // return, if last part of name\n       if (i == parts.length - 1) {\n+\n+        if (isLogicalTypeDate(valueNode, part)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIxOTk2OQ==", "bodyText": "May not be related to this PR. but is time zone information lost when we convert from Date to Long (row -> avro)?", "url": "https://github.com/apache/hudi/pull/1330#discussion_r379219969", "createdAt": "2020-02-14T02:12:38Z", "author": {"login": "vinothchandar"}, "path": "hudi-spark/src/main/java/org/apache/hudi/DataSourceUtils.java", "diffHunk": "@@ -77,6 +80,11 @@ public static Object getNestedFieldVal(GenericRecord record, String fieldName, b\n \n       // return, if last part of name\n       if (i == parts.length - 1) {\n+\n+        if (isLogicalTypeDate(valueNode, part)) {\n+          return LocalDate.ofEpochDay(Long.parseLong(val.toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNjQ4MjI0", "url": "https://github.com/apache/hudi/pull/1330#pullrequestreview-363648224", "createdAt": "2020-02-24T19:38:07Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOTozODowN1rOFttSMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxOTozODowN1rOFttSMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ3MjE3Ng==", "bodyText": "Hmmm.. just feel that now, this method is doing multiple things and those get tricky over time.. Simple compromise.. please pull this  conversion code to its own helper method, that we can invoke from here.. that way, over time, more conversions are just added to that helper., while this methods just focusses on getting a nested value .", "url": "https://github.com/apache/hudi/pull/1330#discussion_r383472176", "createdAt": "2020-02-24T19:38:07Z", "author": {"login": "vinothchandar"}, "path": "hudi-spark/src/main/java/org/apache/hudi/DataSourceUtils.java", "diffHunk": "@@ -77,6 +80,11 @@ public static Object getNestedFieldVal(GenericRecord record, String fieldName, b\n \n       // return, if last part of name\n       if (i == parts.length - 1) {\n+\n+        if (isLogicalTypeDate(valueNode, part)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIxOTc5NA=="}, "originalCommit": null, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "df0a349f454c9d461a7ba3ab99c3aa6b6f76781c", "author": {"user": {"login": "umehrot2", "name": "Udit Mehrotra"}}, "url": "https://github.com/apache/hudi/commit/df0a349f454c9d461a7ba3ab99c3aa6b6f76781c", "committedDate": "2020-02-28T09:44:45Z", "message": "Fix to allow creation/syncing of Hive tables partitioned by Date type columns\n\ncr https://code.amazon.com/reviews/CR-19052768"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "df0a349f454c9d461a7ba3ab99c3aa6b6f76781c", "author": {"user": {"login": "umehrot2", "name": "Udit Mehrotra"}}, "url": "https://github.com/apache/hudi/commit/df0a349f454c9d461a7ba3ab99c3aa6b6f76781c", "committedDate": "2020-02-28T09:44:45Z", "message": "Fix to allow creation/syncing of Hive tables partitioned by Date type columns\n\ncr https://code.amazon.com/reviews/CR-19052768"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3541, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}