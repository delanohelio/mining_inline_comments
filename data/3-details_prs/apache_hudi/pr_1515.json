{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNDI4NzMx", "number": 1515, "title": "[HUDI-795] Ignoring missing aux folder", "bodyText": "What is the purpose of the pull request\nSeeing breakages on GCS. When something removes the folder deleteAllInstantsOlderorEqualsInAuxMetaFolder breaks.\nBrief change log\n\nModifed HoodieCommitArchiveLog.deleteAllInstantsOlderorEqualsInAuxMetaFolder to ignore missing folder\n\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-04-14T21:41:47Z", "url": "https://github.com/apache/hudi/pull/1515", "merged": true, "mergeCommit": {"oid": "aea7c1657ee41ac740b4974f4239c90960553f64"}, "closed": true, "closedAt": "2020-04-22T16:47:32Z", "author": {"login": "afilipchik"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXqgCmgH2gAyNDAzNDI4NzMxOmZlMjk2NDVkMzEyMjAwYTRkY2E4ZDMzZTRiYTVlYzA5OWY3ZThmNGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaLH4wgFqTM5ODM4MDU2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fe29645d312200a4dca8d33e4ba5ec099f7e8f4e", "author": {"user": null}, "url": "https://github.com/apache/hudi/commit/fe29645d312200a4dca8d33e4ba5ec099f7e8f4e", "committedDate": "2020-04-14T21:37:21Z", "message": "Ignoring missing aux folde"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTQ0NTU4", "url": "https://github.com/apache/hudi/pull/1515#pullrequestreview-393944558", "createdAt": "2020-04-15T16:35:01Z", "commit": {"oid": "fe29645d312200a4dca8d33e4ba5ec099f7e8f4e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNjozNTowMVrOGGCF1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNjozNTowMVrOGGCF1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk3ODkwMw==", "bodyText": "Can you please provide specific pointers on how the folder gets removed on GCS? Is it GCS specific?", "url": "https://github.com/apache/hudi/pull/1515#discussion_r408978903", "createdAt": "2020-04-15T16:35:01Z", "author": {"login": "pratyakshsharma"}, "path": "hudi-client/src/main/java/org/apache/hudi/table/HoodieCommitArchiveLog.java", "diffHunk": "@@ -219,14 +220,23 @@ private boolean deleteArchivedInstants(List<HoodieInstant> archivedInstants) thr\n    * @throws IOException in case of error\n    */\n   private boolean deleteAllInstantsOlderorEqualsInAuxMetaFolder(HoodieInstant thresholdInstant) throws IOException {\n-    List<HoodieInstant> instants = metaClient.scanHoodieInstantsFromFileSystem(\n-        new Path(metaClient.getMetaAuxiliaryPath()), HoodieActiveTimeline.VALID_EXTENSIONS_IN_ACTIVE_TIMELINE, false);\n+    List<HoodieInstant> instants = null;\n+    boolean success = true;\n+    try {\n+      instants =\n+          metaClient.scanHoodieInstantsFromFileSystem(\n+              new Path(metaClient.getMetaAuxiliaryPath()),\n+              HoodieActiveTimeline.VALID_EXTENSIONS_IN_ACTIVE_TIMELINE,\n+              false);\n+    } catch (FileNotFoundException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe29645d312200a4dca8d33e4ba5ec099f7e8f4e"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa7850d7e3d3398205e41dfd0c1a1569449daee1", "author": {"user": null}, "url": "https://github.com/apache/hudi/commit/aa7850d7e3d3398205e41dfd0c1a1569449daee1", "committedDate": "2020-04-20T17:06:29Z", "message": "Updated comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NzAwMDIx", "url": "https://github.com/apache/hudi/pull/1515#pullrequestreview-396700021", "createdAt": "2020-04-20T18:19:37Z", "commit": {"oid": "aa7850d7e3d3398205e41dfd0c1a1569449daee1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxODoxOTozN1rOGIhltw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxODoxOTozN1rOGIhltw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU5MjExOQ==", "bodyText": "Guess it would be better to use multi line comments here like\n/*\n*\n*/", "url": "https://github.com/apache/hudi/pull/1515#discussion_r411592119", "createdAt": "2020-04-20T18:19:37Z", "author": {"login": "pratyakshsharma"}, "path": "hudi-client/src/main/java/org/apache/hudi/table/HoodieCommitArchiveLog.java", "diffHunk": "@@ -219,14 +220,29 @@ private boolean deleteArchivedInstants(List<HoodieInstant> archivedInstants) thr\n    * @throws IOException in case of error\n    */\n   private boolean deleteAllInstantsOlderorEqualsInAuxMetaFolder(HoodieInstant thresholdInstant) throws IOException {\n-    List<HoodieInstant> instants = metaClient.scanHoodieInstantsFromFileSystem(\n-        new Path(metaClient.getMetaAuxiliaryPath()), HoodieActiveTimeline.VALID_EXTENSIONS_IN_ACTIVE_TIMELINE, false);\n+    List<HoodieInstant> instants = null;\n+    boolean success = true;\n+    try {\n+      instants =\n+          metaClient.scanHoodieInstantsFromFileSystem(\n+              new Path(metaClient.getMetaAuxiliaryPath()),\n+              HoodieActiveTimeline.VALID_EXTENSIONS_IN_ACTIVE_TIMELINE,\n+              false);\n+    } catch (FileNotFoundException e) {\n+      // On some FSs deletion of all files in the directory can auto remove the directory itself.\n+      // GCS is one example, as it doesn't have real directories and subdirectories. When client\n+      // removes all the files from a \"folder\" on GCS is has to create a special \"/\" to keep the folder\n+      // around. If this doesn't happen (timeout, misconfigured client, ...) folder will be deleted and\n+      // in this case we should not break when aux folder is not found.\n+      // GCS information: (https://cloud.google.com/storage/docs/gsutil/addlhelp/HowSubdirectoriesWork)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa7850d7e3d3398205e41dfd0c1a1569449daee1"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7500d06e325cef1a50e8812058da7f02c0470c15", "author": {"user": null}, "url": "https://github.com/apache/hudi/commit/7500d06e325cef1a50e8812058da7f02c0470c15", "committedDate": "2020-04-21T23:56:10Z", "message": "Changed comments style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MzgwNTY3", "url": "https://github.com/apache/hudi/pull/1515#pullrequestreview-398380567", "createdAt": "2020-04-22T16:45:41Z", "commit": {"oid": "7500d06e325cef1a50e8812058da7f02c0470c15"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3388, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}