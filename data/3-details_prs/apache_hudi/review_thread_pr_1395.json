{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NDE5MTM0", "number": 1395, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwOTozOTo1M1rODnxOhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwOTozOTo1M1rODnxOhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMDI3NTkwOnYy", "diffSide": "RIGHT", "path": "hudi-client/src/test/java/org/apache/hudi/common/HoodieTestDataGenerator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QwOTozOTo1NFrOF19KXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxODozMzozOVrOF2OZfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjEyMDkyNQ==", "bodyText": "this line is solving the use case that you pointed out in jira @prashantwason . I guess the fix is complete and good to merge.", "url": "https://github.com/apache/hudi/pull/1395#discussion_r392120925", "createdAt": "2020-03-13T09:39:54Z", "author": {"login": "pratyakshsharma"}, "path": "hudi-client/src/test/java/org/apache/hudi/common/HoodieTestDataGenerator.java", "diffHunk": "@@ -429,24 +428,24 @@ public HoodieRecord generateUpdateRecord(HoodieKey key, String commitTime) throw\n    */\n   public Stream<HoodieKey> generateUniqueDeleteStream(Integer n) {\n     final Set<KeyPartition> used = new HashSet<>();\n-\n     if (n > numExistingKeys) {\n       throw new IllegalArgumentException(\"Requested unique deletes is greater than number of available keys\");\n     }\n \n-    return IntStream.range(0, n).boxed().map(i -> {\n-      int index = numExistingKeys == 1 ? 0 : RAND.nextInt(numExistingKeys - 1);\n-      KeyPartition kp = existingKeys.get(index);\n-      // Find the available keyPartition starting from randomly chosen one.\n-      while (used.contains(kp)) {\n+    List<HoodieKey> result = new ArrayList<>();\n+    for (int i = 0; i < n; i++) {\n+      int index = RAND.nextInt(numExistingKeys);\n+      while (!existingKeys.containsKey(index)) {\n         index = (index + 1) % numExistingKeys;\n-        kp = existingKeys.get(index);\n       }\n-      existingKeys.remove(kp);\n+      KeyPartition kp = existingKeys.remove(index);\n+      existingKeys.put(index, existingKeys.get(numExistingKeys - 1));\n+      existingKeys.remove(numExistingKeys - 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7d9f28dced40d6bcad84a35211fe7d2de286933"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQwMzMyNA==", "bodyText": "Looks good. I didnt read the fix correctly.", "url": "https://github.com/apache/hudi/pull/1395#discussion_r392403324", "createdAt": "2020-03-13T18:33:39Z", "author": {"login": "prashantwason"}, "path": "hudi-client/src/test/java/org/apache/hudi/common/HoodieTestDataGenerator.java", "diffHunk": "@@ -429,24 +428,24 @@ public HoodieRecord generateUpdateRecord(HoodieKey key, String commitTime) throw\n    */\n   public Stream<HoodieKey> generateUniqueDeleteStream(Integer n) {\n     final Set<KeyPartition> used = new HashSet<>();\n-\n     if (n > numExistingKeys) {\n       throw new IllegalArgumentException(\"Requested unique deletes is greater than number of available keys\");\n     }\n \n-    return IntStream.range(0, n).boxed().map(i -> {\n-      int index = numExistingKeys == 1 ? 0 : RAND.nextInt(numExistingKeys - 1);\n-      KeyPartition kp = existingKeys.get(index);\n-      // Find the available keyPartition starting from randomly chosen one.\n-      while (used.contains(kp)) {\n+    List<HoodieKey> result = new ArrayList<>();\n+    for (int i = 0; i < n; i++) {\n+      int index = RAND.nextInt(numExistingKeys);\n+      while (!existingKeys.containsKey(index)) {\n         index = (index + 1) % numExistingKeys;\n-        kp = existingKeys.get(index);\n       }\n-      existingKeys.remove(kp);\n+      KeyPartition kp = existingKeys.remove(index);\n+      existingKeys.put(index, existingKeys.get(numExistingKeys - 1));\n+      existingKeys.remove(numExistingKeys - 1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjEyMDkyNQ=="}, "originalCommit": {"oid": "e7d9f28dced40d6bcad84a35211fe7d2de286933"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4898, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}