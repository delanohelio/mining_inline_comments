{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NTA5MjM2", "number": 1397, "title": "[HUDI-692] Add delete savepoint for cli", "bodyText": "What is the purpose of the pull request\nNow, deleteSavepoint already provided in HoodieWriteClient, but not provide to user, add it in CLI.\nBrief change log\n\nAdd delete savepoint for cli\n\nVerify this pull request\nThis pull request is a trivial rework / code cleanup without any test coverage.\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-03-11T06:35:02Z", "url": "https://github.com/apache/hudi/pull/1397", "merged": true, "mergeCommit": {"oid": "0f892ef62c76436b17030e6edb4642f476d7de1e"}, "closed": true, "closedAt": "2020-03-11T23:49:02Z", "author": {"login": "hddong"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMhMECgH2gAyMzg2NTA5MjM2OmMyODA3MTk5ZTc2YjFmNzg5YzdlZDE5MjliMzk0MzEzYzRmNTlkZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMv9NTAFqTM3MzE5Nzk3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c2807199e76b1f789c7ed1929b394313c4f59dd8", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/c2807199e76b1f789c7ed1929b394313c4f59dd8", "committedDate": "2020-03-11T06:33:13Z", "message": "Add delete savepoint for cli"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24b6039bffa904b91fa3dcb99705e50e4c9c364d", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/24b6039bffa904b91fa3dcb99705e50e4c9c364d", "committedDate": "2020-03-11T07:33:29Z", "message": "Add check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNTgyODcy", "url": "https://github.com/apache/hudi/pull/1397#pullrequestreview-372582872", "createdAt": "2020-03-11T09:15:33Z", "commit": {"oid": "24b6039bffa904b91fa3dcb99705e50e4c9c364d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOToxNTozNFrOF0ukTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOToxNTozNFrOF0ukTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgzMzIzMQ==", "bodyText": "JavaSparkContext implements AutoCloseable interface, can we use try-with-resource here to avoid the resource leak?", "url": "https://github.com/apache/hudi/pull/1397#discussion_r390833231", "createdAt": "2020-03-11T09:15:34Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/SavepointsCommand.java", "diffHunk": "@@ -127,6 +127,26 @@ public String refreshMetaClient() {\n     return \"Metadata for table \" + HoodieCLI.getTableMetaClient().getTableConfig().getTableName() + \" refreshed.\";\n   }\n \n+  @CliCommand(value = \"savepoint delete\", help = \"Delete the savepoint\")\n+  public String deleteSavepoint(@CliOption(key = {\"commit\"}, help = \"Delete a savepoint\") final String commitTime) throws Exception {\n+    HoodieTableMetaClient metaClient = HoodieCLI.getTableMetaClient();\n+    HoodieTimeline completedInstants = metaClient.getActiveTimeline().getSavePointTimeline().filterCompletedInstants();\n+    if (completedInstants.empty()) {\n+      throw new HoodieException(\"There are no completed savepoint to run delete\");\n+    }\n+    HoodieInstant savePoint = new HoodieInstant(false, HoodieTimeline.SAVEPOINT_ACTION, commitTime);\n+\n+    if (!completedInstants.containsInstant(savePoint)) {\n+      return \"Commit \" + commitTime + \" not found in Commits \" + completedInstants;\n+    }\n+\n+    JavaSparkContext jsc = SparkUtil.initJavaSparkConf(\"Delete Savepoint\");\n+    HoodieWriteClient client = createHoodieClient(jsc, metaClient.getBasePath());\n+    client.deleteSavepoint(commitTime);\n+    jsc.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24b6039bffa904b91fa3dcb99705e50e4c9c364d"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6fe5b93dc4674a896eb1e7ec6ec79ce33940d7e", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/e6fe5b93dc4674a896eb1e7ec6ec79ce33940d7e", "committedDate": "2020-03-11T10:35:55Z", "message": "Move JavaSparkContext to try"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjc2MzYz", "url": "https://github.com/apache/hudi/pull/1397#pullrequestreview-372676363", "createdAt": "2020-03-11T11:30:06Z", "commit": {"oid": "e6fe5b93dc4674a896eb1e7ec6ec79ce33940d7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTk3OTc3", "url": "https://github.com/apache/hudi/pull/1397#pullrequestreview-373197977", "createdAt": "2020-03-11T23:45:34Z", "commit": {"oid": "e6fe5b93dc4674a896eb1e7ec6ec79ce33940d7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3835, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}