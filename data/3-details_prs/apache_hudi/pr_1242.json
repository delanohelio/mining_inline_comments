{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0MDU2NTYx", "number": 1242, "title": "[HUDI-544] Archived commits command code cleanup", "bodyText": "What is the purpose of the pull request\nNow, archive path have two different default value: \"archived\" and \"\". It cause a bug.\nBrief change log\n\nChange default path to archive\nCli read archive by path stored in .hoodie\nUser define archive path\n\nVerify this pull request\nThis pull request is a trivial rework / code cleanup without any test coverage.\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-01-17T09:50:34Z", "url": "https://github.com/apache/hudi/pull/1242", "merged": true, "mergeCommit": {"oid": "2eaba0962a67d72000a3b1033f5f3d5bde5f4d7f"}, "closed": true, "closedAt": "2020-09-25T16:36:42Z", "author": {"login": "hddong"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-NC3oAFqTM0ODM5ODgzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJDuuHABqjM3NjcxNDU0MTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4Mzk4ODM2", "url": "https://github.com/apache/hudi/pull/1242#pullrequestreview-348398836", "createdAt": "2020-01-26T19:08:52Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNlQxOTowODo1MlrOFh1aIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNlQxOTowODo1MlrOFh1aIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTAyMjM3MA==", "bodyText": "this is already overridden at the datasource and deltastreamer level.. Please revert this since it can affect all the old tables written into . ..\n@n3nash can you advise here.. only reason to not change is all the old data at uber..", "url": "https://github.com/apache/hudi/pull/1242#discussion_r371022370", "createdAt": "2020-01-26T19:08:52Z", "author": {"login": "vinothchandar"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/HoodieTableConfig.java", "diffHunk": "@@ -68,7 +68,7 @@\n   public static final HoodieFileFormat DEFAULT_LOG_FILE_FORMAT = HoodieFileFormat.HOODIE_LOG;\n   public static final String DEFAULT_PAYLOAD_CLASS = OverwriteWithLatestAvroPayload.class.getName();\n   public static final Integer DEFAULT_TIMELINE_LAYOUT_VERSION = TimelineLayoutVersion.VERSION_0;\n-  public static final String DEFAULT_ARCHIVELOG_FOLDER = \"\";\n+  public static final String DEFAULT_ARCHIVELOG_FOLDER = \"archived\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNDM1ODA3", "url": "https://github.com/apache/hudi/pull/1242#pullrequestreview-351435807", "createdAt": "2020-01-31T11:08:10Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMTowODoxMFrOFkIPBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMTowODoxMFrOFkIPBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQyNzk3NQ==", "bodyText": "If remove this option, user can not use specified path.", "url": "https://github.com/apache/hudi/pull/1242#discussion_r373427975", "createdAt": "2020-01-31T11:08:10Z", "author": {"login": "hmatu"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/ArchivedCommitsCommand.java", "diffHunk": "@@ -54,7 +55,6 @@\n \n   @CliCommand(value = \"show archived commit stats\", help = \"Read commits from archived files and show details\")\n   public String showArchivedCommits(\n-      @CliOption(key = {\"archiveFolderPattern\"}, help = \"Archive Folder\", unspecifiedDefaultValue = \"\") String folder,", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjgyODQ4", "url": "https://github.com/apache/hudi/pull/1242#pullrequestreview-352682848", "createdAt": "2020-02-04T01:58:17Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMTo1ODoxN1rOFlF9mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMTo1ODoxN1rOFlF9mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQzOTMyMw==", "bodyText": "I'm assuming HoodieCLI.getTableMetaClient().getArchivePath() returns the path with .hoodie ?", "url": "https://github.com/apache/hudi/pull/1242#discussion_r374439323", "createdAt": "2020-02-04T01:58:17Z", "author": {"login": "n3nash"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/ArchivedCommitsCommand.java", "diffHunk": "@@ -63,10 +63,7 @@ public String showArchivedCommits(\n       throws IOException {\n     System.out.println(\"===============> Showing only \" + limit + \" archived commits <===============\");\n     String basePath = HoodieCLI.getTableMetaClient().getBasePath();\n-    Path archivePath = new Path(basePath + \"/.hoodie/.commits_.archive*\");\n-    if (folder != null && !folder.isEmpty()) {\n-      archivePath = new Path(basePath + \"/.hoodie/\" + folder);\n-    }\n+    Path archivePath = new Path(HoodieCLI.getTableMetaClient().getArchivePath() + \"/.commits_.archive*\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjgzODYz", "url": "https://github.com/apache/hudi/pull/1242#pullrequestreview-352683863", "createdAt": "2020-02-04T02:01:48Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyOTEyMjEw", "url": "https://github.com/apache/hudi/pull/1242#pullrequestreview-352912210", "createdAt": "2020-02-04T11:42:51Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMTo0Mjo1MVrOFlRJbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMTo0Mjo1MVrOFlRJbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDYyMjU3NQ==", "bodyText": "This can affect all the old tables read archives.", "url": "https://github.com/apache/hudi/pull/1242#discussion_r374622575", "createdAt": "2020-02-04T11:42:51Z", "author": {"login": "hmatu"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/ArchivedCommitsCommand.java", "diffHunk": "@@ -138,9 +139,11 @@ public String showCommits(\n       throws IOException {\n \n     System.out.println(\"===============> Showing only \" + limit + \" archived commits <===============\");\n-    String basePath = HoodieCLI.getTableMetaClient().getBasePath();\n+    HoodieTableMetaClient metaClient = HoodieCLI.getTableMetaClient();\n+    String basePath = metaClient.getBasePath();\n+    Path archivePath = new Path(metaClient.getArchivePath() + \"/.commits_.archive*\");\n     FileStatus[] fsStatuses =\n-        FSUtils.getFs(basePath, HoodieCLI.conf).globStatus(new Path(basePath + \"/.hoodie/.commits_.archive*\"));\n+        FSUtils.getFs(basePath, HoodieCLI.conf).globStatus(archivePath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3Njk1OTAw", "url": "https://github.com/apache/hudi/pull/1242#pullrequestreview-357695900", "createdAt": "2020-02-12T18:43:57Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MDIxMjM2", "url": "https://github.com/apache/hudi/pull/1242#pullrequestreview-386021236", "createdAt": "2020-04-01T23:40:03Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzo0MDowM1rOF_Waug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzo0MDowM1rOF_Waug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk3MTg5OA==", "bodyText": "@hddong I'm accepting and will merge after you create another ticket for us to add to the release notes that if someone was actually overriding HOODIE_ARCHIVELOG_FOLDER_PROP_NAME that was not being honored before and now will be honored for those cases it can break (since this is the right thing to do)", "url": "https://github.com/apache/hudi/pull/1242#discussion_r401971898", "createdAt": "2020-04-01T23:40:03Z", "author": {"login": "n3nash"}, "path": "hudi-spark/src/main/scala/org/apache/hudi/HoodieSparkSqlWriter.scala", "diffHunk": "@@ -119,8 +119,10 @@ private[hudi] object HoodieSparkSqlWriter {\n \n       // Create the table if not present\n       if (!exists) {\n+        val archiveLogFolder = parameters.getOrElse(\n+          HoodieTableConfig.HOODIE_ARCHIVELOG_FOLDER_PROP_NAME, \"archived\")\n         HoodieTableMetaClient.initTableType(sparkContext.hadoopConfiguration, path.get, tableType,\n-          tblName.get, \"archived\", parameters(PAYLOAD_CLASS_OPT_KEY))\n+          tblName.get, archiveLogFolder, parameters(PAYLOAD_CLASS_OPT_KEY))", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MDIxMzU3", "url": "https://github.com/apache/hudi/pull/1242#pullrequestreview-386021357", "createdAt": "2020-04-01T23:40:25Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "0e54583e99874215c75fc3ea737c39e7d82e4ed9", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/0e54583e99874215c75fc3ea737c39e7d82e4ed9", "committedDate": "2020-07-10T02:32:20Z", "message": "Archived commits command code cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e54583e99874215c75fc3ea737c39e7d82e4ed9", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/0e54583e99874215c75fc3ea737c39e7d82e4ed9", "committedDate": "2020-07-10T02:32:20Z", "message": "Archived commits command code cleanup"}, "afterCommit": {"oid": "aaa49912e0efc4c8ba3a1cc3d54b979bf72fe8b2", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/aaa49912e0efc4c8ba3a1cc3d54b979bf72fe8b2", "committedDate": "2020-08-05T09:55:06Z", "message": "Archived commits command code cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ceb75bd7e3d51d4768020be5a7cd59d9df093235", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/ceb75bd7e3d51d4768020be5a7cd59d9df093235", "committedDate": "2020-08-11T07:45:34Z", "message": "Merge branch 'master' into hudi-544"}, "afterCommit": {"oid": "4f4246c512310b66241adf589cd9f1147aa9a5d9", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/4f4246c512310b66241adf589cd9f1147aa9a5d9", "committedDate": "2020-08-12T02:03:38Z", "message": "Archived commits command code cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "47ca9e0e51e4549cbdcd95ae6eed6d5067a2afdd", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/47ca9e0e51e4549cbdcd95ae6eed6d5067a2afdd", "committedDate": "2020-08-12T03:28:19Z", "message": "Update HoodieSparkSqlWriter.scala"}, "afterCommit": {"oid": "1808c57dcbec73a395aaa971ce1e5a7a0c42f91b", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/1808c57dcbec73a395aaa971ce1e5a7a0c42f91b", "committedDate": "2020-08-12T10:05:40Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc10456c363693a1401da6293bf73c898b1c3880", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/fc10456c363693a1401da6293bf73c898b1c3880", "committedDate": "2020-09-15T08:42:44Z", "message": "Archived commits command code cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d739af9561a071827f10117dda8a3d413025185", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/0d739af9561a071827f10117dda8a3d413025185", "committedDate": "2020-09-15T08:42:46Z", "message": "fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1808c57dcbec73a395aaa971ce1e5a7a0c42f91b", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/1808c57dcbec73a395aaa971ce1e5a7a0c42f91b", "committedDate": "2020-08-12T10:05:40Z", "message": "fix"}, "afterCommit": {"oid": "0d739af9561a071827f10117dda8a3d413025185", "author": {"user": {"login": "hddong", "name": "hongdd"}}, "url": "https://github.com/apache/hudi/commit/0d739af9561a071827f10117dda8a3d413025185", "committedDate": "2020-09-15T08:42:46Z", "message": "fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4101, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}