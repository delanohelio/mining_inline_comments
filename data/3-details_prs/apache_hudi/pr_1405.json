{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MTgyMDA0", "number": 1405, "title": "[HUDI-344] Add partitioner param to Exporter", "bodyText": "To allow custom repartitioning during export\n\nVerify this pull request\nThis pull request is already covered by existing tests, such as org.apache.hudi.utilities.TestHoodieSnapshotExporter\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-03-14T06:24:12Z", "url": "https://github.com/apache/hudi/pull/1405", "merged": true, "mergeCommit": {"oid": "779edc068865898049569da0fe750574f93a0dca"}, "closed": true, "closedAt": "2020-03-18T11:24:05Z", "author": {"login": "xushiyan"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNfVpeABqjMxMjkwNDk4NDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO1ildAFqTM3Njc3MzE5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzMzMjY0", "url": "https://github.com/apache/hudi/pull/1405#pullrequestreview-374733264", "createdAt": "2020-03-14T15:16:02Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNToxNjowM1rOF2aInw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNToxNjowM1rOF2aInw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5NTYxNQ==", "bodyText": "\"hudi\" would be constant?", "url": "https://github.com/apache/hudi/pull/1405#discussion_r392595615", "createdAt": "2020-03-14T15:16:03Z", "author": {"login": "leesf"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/HoodieSnapshotExporter.java", "diffHunk": "@@ -113,21 +126,7 @@ public int export(SparkSession spark, Config cfg) throws IOException {\n         return -1;\n       }\n       if (!cfg.outputFormat.equalsIgnoreCase(\"hudi\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 93}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzMzNDEy", "url": "https://github.com/apache/hudi/pull/1405#pullrequestreview-374733412", "createdAt": "2020-03-14T15:18:18Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNToxODoxOFrOF2aJQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNToxODoxOFrOF2aJQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU5NTc3Nw==", "bodyText": "Also need UT for user-defined Partitioner?", "url": "https://github.com/apache/hudi/pull/1405#discussion_r392595777", "createdAt": "2020-03-14T15:18:18Z", "author": {"login": "leesf"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/HoodieSnapshotExporter.java", "diffHunk": "@@ -47,36 +49,47 @@\n import org.apache.spark.sql.SparkSession;\n import org.apache.spark.sql.execution.datasources.DataSource;\n \n-import scala.Tuple2;\n-import scala.collection.JavaConversions;\n-\n import java.io.IOException;\n import java.io.Serializable;\n import java.util.ArrayList;\n-import java.util.Arrays;\n import java.util.List;\n import java.util.stream.Collectors;\n \n+import scala.Tuple2;\n+import scala.collection.JavaConversions;\n+\n /**\n  * Export the latest records of Hudi dataset to a set of external files (e.g., plain parquet files).\n  *\n  * @experimental This export is an experimental tool. If you want to export hudi to hudi, please use HoodieSnapshotCopier.\n  */\n public class HoodieSnapshotExporter {\n+\n+  @FunctionalInterface\n+  public interface Partitioner {\n+\n+    DataFrameWriter<Row> partition(Dataset<Row> source);\n+\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzMzNDI2", "url": "https://github.com/apache/hudi/pull/1405#pullrequestreview-374733426", "createdAt": "2020-03-14T15:18:28Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1ODUwODk3", "url": "https://github.com/apache/hudi/pull/1405#pullrequestreview-375850897", "createdAt": "2020-03-17T09:09:11Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwOTowOToxMVrOF3TYkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwOTowOToxMVrOF3TYkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUzMzU4Ng==", "bodyText": "should we document this that only support three formats?", "url": "https://github.com/apache/hudi/pull/1405#discussion_r393533586", "createdAt": "2020-03-17T09:09:11Z", "author": {"login": "leesf"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/HoodieSnapshotExporter.java", "diffHunk": "@@ -45,41 +50,65 @@\n import org.apache.spark.sql.Row;\n import org.apache.spark.sql.SaveMode;\n import org.apache.spark.sql.SparkSession;\n-import org.apache.spark.sql.execution.datasources.DataSource;\n-\n-import scala.Tuple2;\n-import scala.collection.JavaConversions;\n \n import java.io.IOException;\n import java.io.Serializable;\n import java.util.ArrayList;\n-import java.util.Arrays;\n import java.util.List;\n import java.util.stream.Collectors;\n \n+import scala.Tuple2;\n+import scala.collection.JavaConversions;\n+\n /**\n  * Export the latest records of Hudi dataset to a set of external files (e.g., plain parquet files).\n  *\n  * @experimental This export is an experimental tool. If you want to export hudi to hudi, please use HoodieSnapshotCopier.\n  */\n public class HoodieSnapshotExporter {\n+\n+  @FunctionalInterface\n+  public interface Partitioner {\n+\n+    DataFrameWriter<Row> partition(Dataset<Row> source);\n+\n+  }\n+\n   private static final Logger LOG = LogManager.getLogger(HoodieSnapshotExporter.class);\n \n+  public static class OutputFormatValidator implements IValueValidator<String> {\n+\n+    static final String HUDI = \"hudi\";\n+    static final List<String> FORMATS = ImmutableList.of(\"json\", \"parquet\", HUDI);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1ODUzMjM2", "url": "https://github.com/apache/hudi/pull/1405#pullrequestreview-375853236", "createdAt": "2020-03-17T09:12:37Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e8d156f5873c2bafd2e7478883983808106d151", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/8e8d156f5873c2bafd2e7478883983808106d151", "committedDate": "2020-03-17T20:58:56Z", "message": "[HUDI-344] Add partitioner param to Exporter\n\n* allow custom repartitioning during export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e29052c502e71cb5016e2781e0829b2c498b83b", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/3e29052c502e71cb5016e2781e0829b2c498b83b", "committedDate": "2020-03-17T20:58:56Z", "message": "[HUDI-344] Add UT for user defined partitioner"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b00b57712c7406e0be67c9b10c1a5ef45814b5c", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/7b00b57712c7406e0be67c9b10c1a5ef45814b5c", "committedDate": "2020-03-17T22:20:29Z", "message": "Add help line explanation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "7b00b57712c7406e0be67c9b10c1a5ef45814b5c", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/7b00b57712c7406e0be67c9b10c1a5ef45814b5c", "committedDate": "2020-03-17T22:20:29Z", "message": "Add help line explanation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NzczMTkx", "url": "https://github.com/apache/hudi/pull/1405#pullrequestreview-376773191", "createdAt": "2020-03-18T11:23:46Z", "commit": {"oid": "7b00b57712c7406e0be67c9b10c1a5ef45814b5c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3878, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}