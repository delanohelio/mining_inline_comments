{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NjM2NDY4", "number": 1290, "title": "[HUDI-584] Relocate spark-avro dependency by maven-shade-plugin", "bodyText": "What is the purpose of the pull request\nFrom spark-avro-guide, we know that the spark-avro module is external, it is not exists in spark-2.4.4-bin-hadoop2.7.tgz.\nShade spark-avro:\n\nUser will not use --packages org.apache.spark:spark-avro_2.11:2.4.4\nUser also don't need care about using the scala-2.11 or scala-2.12\nAvoid conflicts with local jar\n\nBrief change log\n\nRelocate spark-avro dependency by maven-shade-plugin\n\nVerify this pull request\nexport SPARK_HOME=/work/BigData/install/spark/spark-2.4.4-bin-hadoop2.7\n\n${SPARK_HOME}/bin/spark-shell \\\n    --jars `ls packaging/hudi-spark-bundle/target/hudi-spark-bundle_*.*-*.*.*-SNAPSHOT.jar` \\\n    --conf 'spark.serializer=org.apache.spark.serializer.KryoSerializer'\n\nval basePath = \"file:///tmp/hudi_mor_table\"\n\nvar datas = List(\"\"\"{ \"name\": \"kenken\", \"ts\": 1574297893836, \"age\": 12, \"location\": \"latitude\"}\"\"\")\nval df = spark.read.json(spark.sparkContext.parallelize(datas, 2))\ndf.write.format(\"org.apache.hudi\").\n    option(\"hoodie.datasource.write.recordkey.field\", \"name\").\n    option(\"hoodie.datasource.write.partitionpath.field\", \"location\").\n    option(\"hoodie.datasource.write.precombine.field\", \"ts\").\n    option(\"hoodie.table.name\", \"tableName\").\n    mode(\"Overwrite\").\n    save(basePath)\n\nspark.read.format(\"org.apache.hudi\").load(basePath + \"/*/\").show()\n\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-01-29T16:00:39Z", "url": "https://github.com/apache/hudi/pull/1290", "merged": true, "mergeCommit": {"oid": "5f85c267040fd51c186794fdae900162ab176b14"}, "closed": true, "closedAt": "2020-03-04T19:01:50Z", "author": {"login": "lamberken"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_IJmWgFqTM1MDIyMzk4NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKbrP4AFqTM2OTAzOTY3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjIzOTg0", "url": "https://github.com/apache/hudi/pull/1290#pullrequestreview-350223984", "createdAt": "2020-01-29T16:01:53Z", "commit": null, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMzU3NTU3", "url": "https://github.com/apache/hudi/pull/1290#pullrequestreview-350357557", "createdAt": "2020-01-29T19:13:37Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxOToxMzozN1rOFjUWhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxOToxMzozN1rOFjUWhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU3NzkyNQ==", "bodyText": "just leave it as instantTime ? (also this change is different from what the PR says so lets not have it in this PR)", "url": "https://github.com/apache/hudi/pull/1290#discussion_r372577925", "createdAt": "2020-01-29T19:13:37Z", "author": {"login": "n3nash"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/HoodieLogFileCommand.java", "diffHunk": "@@ -104,7 +104,7 @@ public String showLogFileCommits(\n           try {\n             instantTime = n.getLogBlockHeader().get(HeaderMetadataType.INSTANT_TIME);\n             if (instantTime == null) {\n-              throw new Exception(\"Invalid instant time \" + instantTime);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDY0NTAy", "url": "https://github.com/apache/hudi/pull/1290#pullrequestreview-353464502", "createdAt": "2020-02-05T04:49:27Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2OTQxNjc2", "url": "https://github.com/apache/hudi/pull/1290#pullrequestreview-366941676", "createdAt": "2020-03-02T04:10:19Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwNDoxMDoxOVrOFwTK2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQwNDoxMzoxMlrOFwTMoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE5MDA0MQ==", "bodyText": "can we also add the --package  instruction here to explicitly say how to add spark-avro if building without it.", "url": "https://github.com/apache/hudi/pull/1290#discussion_r386190041", "createdAt": "2020-03-02T04:10:19Z", "author": {"login": "bhasudha"}, "path": "README.md", "diffHunk": "@@ -71,6 +71,14 @@ The default Scala version supported is 2.11. To build for Scala 2.12 version, bu\n mvn clean package -DskipTests -DskipITs -Dscala-2.12\n ```\n \n+### Build without spark-avro module\n+\n+The default hudi-jar bundles spark-avro module. To build without spark-avro module, build using `spark-shade-unbundle-avro` profile", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE5MDQ5Ng==", "bodyText": "@lamber-ken I see a '/' here for the property \"spark.bundle.spark.shade.prefix\" if the profile is activated. Is this intended? Does this mean shade with empty prefix (same as not shading)? I dont know much about profiling either so wanted to clarify with you.", "url": "https://github.com/apache/hudi/pull/1290#discussion_r386190496", "createdAt": "2020-03-02T04:13:12Z", "author": {"login": "bhasudha"}, "path": "packaging/hudi-spark-bundle/pom.xml", "diffHunk": "@@ -248,6 +260,13 @@\n         <spark.bundle.hive.shade.prefix>org.apache.hudi.</spark.bundle.hive.shade.prefix>\n       </properties>\n     </profile>\n+    <profile>\n+      <id>spark-shade-unbundle-avro</id>\n+      <properties>\n+        <spark.bundle.avro.scope>provided</spark.bundle.avro.scope>\n+        <spark.bundle.spark.shade.prefix>/</spark.bundle.spark.shade.prefix>", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7be999a65c05df994bead40bdb2e769be404be19", "author": {"user": {"login": "lamberken", "name": "lamberken"}}, "url": "https://github.com/apache/hudi/commit/7be999a65c05df994bead40bdb2e769be404be19", "committedDate": "2020-03-02T06:52:51Z", "message": "[HUDI-584] Relocate spark-avro dependency by maven-shade-plugin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MDM0NjE4", "url": "https://github.com/apache/hudi/pull/1290#pullrequestreview-369034618", "createdAt": "2020-03-04T18:52:48Z", "commit": {"oid": "7be999a65c05df994bead40bdb2e769be404be19"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MDM5Njc5", "url": "https://github.com/apache/hudi/pull/1290#pullrequestreview-369039679", "createdAt": "2020-03-04T19:00:00Z", "commit": {"oid": "7be999a65c05df994bead40bdb2e769be404be19"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4172, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}