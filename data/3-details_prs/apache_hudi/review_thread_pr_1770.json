{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwOTE4MjYw", "number": 1770, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDozODowNFrOEOeyBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMDozODo0NVrOEQ2JHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjE5ODQ2OnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/main/java/org/apache/hudi/cli/HoodieCLI.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDozODowNFrOGxqE2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNDowNDoxM1rOG1j9-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcyMjc3Nw==", "bodyText": "We could introduce a new annotation e.g. @VisibleForTesting in the future just like Flink has done to only open the public method for testing purposes. WDYT? @vinothchandar", "url": "https://github.com/apache/hudi/pull/1770#discussion_r454722777", "createdAt": "2020-07-15T00:38:04Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/HoodieCLI.java", "diffHunk": "@@ -115,4 +115,16 @@ public static synchronized TempViewProvider getTempViewProvider() {\n     return tempViewProvider;\n   }\n \n+  /**\n+   * Close tempViewProvider.\n+   * <p/>\n+   * For test, avoid multiple SparkContexts.\n+   */\n+  public static synchronized void closeTempViewProvider() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1327a38d439b6596717fe231eda335887da9bb4d"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgxNzAxOQ==", "bodyText": "+1, @VisibleForTesting can be useful.", "url": "https://github.com/apache/hudi/pull/1770#discussion_r458817019", "createdAt": "2020-07-22T14:04:13Z", "author": {"login": "hddong"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/HoodieCLI.java", "diffHunk": "@@ -115,4 +115,16 @@ public static synchronized TempViewProvider getTempViewProvider() {\n     return tempViewProvider;\n   }\n \n+  /**\n+   * Close tempViewProvider.\n+   * <p/>\n+   * For test, avoid multiple SparkContexts.\n+   */\n+  public static synchronized void closeTempViewProvider() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcyMjc3Nw=="}, "originalCommit": {"oid": "1327a38d439b6596717fe231eda335887da9bb4d"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjIwNjc5OnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/TempViewCommand.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDo0Mjo0MFrOGxqJsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDo0NDoyN1rOGxqLVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcyNDAxNw==", "bodyText": "It would be better to return the similar messages for try and catch block, for example, Query ran successfully?", "url": "https://github.com/apache/hudi/pull/1770#discussion_r454724017", "createdAt": "2020-07-15T00:42:40Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/TempViewCommand.java", "diffHunk": "@@ -20,36 +20,51 @@\n \n import org.apache.hudi.cli.HoodieCLI;\n \n+import org.apache.hudi.exception.HoodieException;\n import org.springframework.shell.core.CommandMarker;\n import org.springframework.shell.core.annotation.CliCommand;\n import org.springframework.shell.core.annotation.CliOption;\n import org.springframework.stereotype.Component;\n \n-import java.io.IOException;\n-\n /**\n  * CLI command to query/delete temp views.\n  */\n @Component\n public class TempViewCommand implements CommandMarker {\n \n-  private static final String EMPTY_STRING = \"\";\n-\n-  @CliCommand(value = \"temp_query\", help = \"query against created temp view\")\n+  @CliCommand(value = {\"temp_query\", \"temp query\"}, help = \"query against created temp view\")\n   public String query(\n-          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql)\n-          throws IOException {\n+          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql) {\n+\n+    try {\n+      HoodieCLI.getTempViewProvider().runQuery(sql);\n+      return \"Success queried!\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1327a38d439b6596717fe231eda335887da9bb4d"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcyNDQzNg==", "bodyText": "Considering it will be used to assert in the test case. Maybe we could define a constant message?", "url": "https://github.com/apache/hudi/pull/1770#discussion_r454724436", "createdAt": "2020-07-15T00:44:27Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/TempViewCommand.java", "diffHunk": "@@ -20,36 +20,51 @@\n \n import org.apache.hudi.cli.HoodieCLI;\n \n+import org.apache.hudi.exception.HoodieException;\n import org.springframework.shell.core.CommandMarker;\n import org.springframework.shell.core.annotation.CliCommand;\n import org.springframework.shell.core.annotation.CliOption;\n import org.springframework.stereotype.Component;\n \n-import java.io.IOException;\n-\n /**\n  * CLI command to query/delete temp views.\n  */\n @Component\n public class TempViewCommand implements CommandMarker {\n \n-  private static final String EMPTY_STRING = \"\";\n-\n-  @CliCommand(value = \"temp_query\", help = \"query against created temp view\")\n+  @CliCommand(value = {\"temp_query\", \"temp query\"}, help = \"query against created temp view\")\n   public String query(\n-          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql)\n-          throws IOException {\n+          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql) {\n+\n+    try {\n+      HoodieCLI.getTempViewProvider().runQuery(sql);\n+      return \"Success queried!\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcyNDAxNw=="}, "originalCommit": {"oid": "1327a38d439b6596717fe231eda335887da9bb4d"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjIxMTU1OnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/TempViewCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDo0NTozNVrOGxqMng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDo0NTozNVrOGxqMng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcyNDc2Ng==", "bodyText": "Shall we introduce another alias (e.g. temps_shoe) to keep the same style with other commands?", "url": "https://github.com/apache/hudi/pull/1770#discussion_r454724766", "createdAt": "2020-07-15T00:45:35Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/TempViewCommand.java", "diffHunk": "@@ -20,36 +20,51 @@\n \n import org.apache.hudi.cli.HoodieCLI;\n \n+import org.apache.hudi.exception.HoodieException;\n import org.springframework.shell.core.CommandMarker;\n import org.springframework.shell.core.annotation.CliCommand;\n import org.springframework.shell.core.annotation.CliOption;\n import org.springframework.stereotype.Component;\n \n-import java.io.IOException;\n-\n /**\n  * CLI command to query/delete temp views.\n  */\n @Component\n public class TempViewCommand implements CommandMarker {\n \n-  private static final String EMPTY_STRING = \"\";\n-\n-  @CliCommand(value = \"temp_query\", help = \"query against created temp view\")\n+  @CliCommand(value = {\"temp_query\", \"temp query\"}, help = \"query against created temp view\")\n   public String query(\n-          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql)\n-          throws IOException {\n+          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql) {\n+\n+    try {\n+      HoodieCLI.getTempViewProvider().runQuery(sql);\n+      return \"Success queried!\";\n+    } catch (HoodieException ex) {\n+      return \"Query ran failed!\";\n+    }\n+\n+  }\n+\n+  @CliCommand(value = \"temps show\", help = \"Show all views name\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1327a38d439b6596717fe231eda335887da9bb4d"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjIxMzU4OnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/TempViewCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDo0Njo0MlrOGxqNvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDo0Njo0MlrOGxqNvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcyNTA1Mg==", "bodyText": "Do we need to add the keyword name here?", "url": "https://github.com/apache/hudi/pull/1770#discussion_r454725052", "createdAt": "2020-07-15T00:46:42Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/TempViewCommand.java", "diffHunk": "@@ -20,36 +20,51 @@\n \n import org.apache.hudi.cli.HoodieCLI;\n \n+import org.apache.hudi.exception.HoodieException;\n import org.springframework.shell.core.CommandMarker;\n import org.springframework.shell.core.annotation.CliCommand;\n import org.springframework.shell.core.annotation.CliOption;\n import org.springframework.stereotype.Component;\n \n-import java.io.IOException;\n-\n /**\n  * CLI command to query/delete temp views.\n  */\n @Component\n public class TempViewCommand implements CommandMarker {\n \n-  private static final String EMPTY_STRING = \"\";\n-\n-  @CliCommand(value = \"temp_query\", help = \"query against created temp view\")\n+  @CliCommand(value = {\"temp_query\", \"temp query\"}, help = \"query against created temp view\")\n   public String query(\n-          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql)\n-          throws IOException {\n+          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql) {\n+\n+    try {\n+      HoodieCLI.getTempViewProvider().runQuery(sql);\n+      return \"Success queried!\";\n+    } catch (HoodieException ex) {\n+      return \"Query ran failed!\";\n+    }\n+\n+  }\n+\n+  @CliCommand(value = \"temps show\", help = \"Show all views name\")\n+  public String showAll() {\n \n-    HoodieCLI.getTempViewProvider().runQuery(sql);\n-    return EMPTY_STRING;\n+    try {\n+      HoodieCLI.getTempViewProvider().showAllTables();\n+      return \"Show all views name successfully!\";\n+    } catch (HoodieException ex) {\n+      return \"Show all views failed!\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1327a38d439b6596717fe231eda335887da9bb4d"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjIxNzkxOnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/main/java/org/apache/hudi/cli/utils/SparkTempViewProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDo0OToxN1rOGxqQQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDo0OToxN1rOGxqQQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcyNTY5OQ==", "bodyText": "IMO, maybe showAllViews is a better name (just a thought)? I understand here is a method named deleteTable.", "url": "https://github.com/apache/hudi/pull/1770#discussion_r454725699", "createdAt": "2020-07-15T00:49:17Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/utils/SparkTempViewProvider.java", "diffHunk": "@@ -101,6 +101,17 @@ public void runQuery(String sqlText) {\n     }\n   }\n \n+  @Override\n+  public void showAllTables() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1327a38d439b6596717fe231eda335887da9bb4d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjIyMDUzOnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/main/java/org/apache/hudi/cli/utils/TempViewProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDo1MDoyMFrOGxqRoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMDo1MDoyMFrOGxqRoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcyNjA0OA==", "bodyText": "remove this annotation here.", "url": "https://github.com/apache/hudi/pull/1770#discussion_r454726048", "createdAt": "2020-07-15T00:50:20Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/utils/TempViewProvider.java", "diffHunk": "@@ -18,12 +18,18 @@\n \n package org.apache.hudi.cli.utils;\n \n+import java.io.Closeable;\n import java.util.List;\n \n-public interface TempViewProvider {\n+public interface TempViewProvider extends Closeable {\n   void createOrReplace(String tableName, List<String> headers, List<List<Comparable>> rows);\n \n   void runQuery(String sqlText);\n \n+  void showAllTables();\n+\n   void deleteTable(String tableName);\n+\n+  @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1327a38d439b6596717fe231eda335887da9bb4d"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzg3NzEzOnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestTempViewCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToyMzozN1rOGx5u8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToyMzozN1rOGx5u8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3OTMxMw==", "bodyText": "It would be better to add the access modifier.", "url": "https://github.com/apache/hudi/pull/1770#discussion_r454979313", "createdAt": "2020-07-15T11:23:37Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestTempViewCommand.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.cli.commands;\n+\n+import org.apache.hudi.cli.HoodieCLI;\n+import org.apache.hudi.cli.testutils.AbstractShellBaseIntegrationTest;\n+import org.apache.hudi.exception.HoodieException;\n+\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.shell.core.CommandResult;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class TestTempViewCommand extends AbstractShellBaseIntegrationTest {\n+\n+  String tableName = \"test_table\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1327a38d439b6596717fe231eda335887da9bb4d"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzg4NTIyOnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestTempViewCommand.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToyNjoxNFrOGx5z3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToyNjoxNFrOGx5z3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk4MDU3NQ==", "bodyText": "No need to call String.format?", "url": "https://github.com/apache/hudi/pull/1770#discussion_r454980575", "createdAt": "2020-07-15T11:26:14Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestTempViewCommand.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.cli.commands;\n+\n+import org.apache.hudi.cli.HoodieCLI;\n+import org.apache.hudi.cli.testutils.AbstractShellBaseIntegrationTest;\n+import org.apache.hudi.exception.HoodieException;\n+\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.shell.core.CommandResult;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class TestTempViewCommand extends AbstractShellBaseIntegrationTest {\n+\n+  String tableName = \"test_table\";\n+\n+  @BeforeEach\n+  public void init() {\n+    List<List<Comparable>> rows = new ArrayList<>();\n+    for (int i = 0; i < 3; i++) {\n+      rows.add(Arrays.asList(new Comparable[] {\"c1\", \"c2\", \"c3\"}));\n+    }\n+    HoodieCLI.getTempViewProvider().createOrReplace(tableName, Arrays.asList(\"t1\", \"t2\", \"t3\"), rows);\n+  }\n+\n+  @AfterAll\n+  public static void shutdown() {\n+    if (HoodieCLI.getTempViewProvider() != null) {\n+      HoodieCLI.closeTempViewProvider();\n+    }\n+  }\n+\n+  @Test\n+  public void testQueryWithException() {\n+    CommandResult cr = getShell().executeCommand(String.format(\"temp query --sql 'select * from %s'\", \"table_1\"));\n+    assertTrue(cr.getResult().toString().startsWith(\"Query ran failed!\"));\n+  }\n+\n+  @Test\n+  public void testQuery() {\n+    CommandResult cr = getShell().executeCommand(String.format(\"temp query --sql 'select * from %s'\", tableName));\n+    assertEquals(\"Success queried!\", cr.getResult().toString());\n+  }\n+\n+  @Test\n+  public void testShowAll() {\n+    CommandResult cr = getShell().executeCommand(String.format(\"temps show\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1327a38d439b6596717fe231eda335887da9bb4d"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MDk4OTM3OnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/TempViewCommand.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMDozNDozMFrOG1OiUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QwMDo0MToyN1rOG1443w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ2NTg3NQ==", "bodyText": "Can we log the detailed exception information before returning the result?", "url": "https://github.com/apache/hudi/pull/1770#discussion_r458465875", "createdAt": "2020-07-22T00:34:30Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/TempViewCommand.java", "diffHunk": "@@ -20,36 +20,55 @@\n \n import org.apache.hudi.cli.HoodieCLI;\n \n+import org.apache.hudi.exception.HoodieException;\n import org.springframework.shell.core.CommandMarker;\n import org.springframework.shell.core.annotation.CliCommand;\n import org.springframework.shell.core.annotation.CliOption;\n import org.springframework.stereotype.Component;\n \n-import java.io.IOException;\n-\n /**\n  * CLI command to query/delete temp views.\n  */\n @Component\n public class TempViewCommand implements CommandMarker {\n \n-  private static final String EMPTY_STRING = \"\";\n+  public static final String QUERY_SUCCESS = \"Query ran successfully!\";\n+  public static final String QUERY_FAIL = \"Query ran failed!\";\n+  public static final String SHOW_SUCCESS = \"Show all views name successfully!\";\n \n-  @CliCommand(value = \"temp_query\", help = \"query against created temp view\")\n+  @CliCommand(value = {\"temp_query\", \"temp query\"}, help = \"query against created temp view\")\n   public String query(\n-          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql)\n-          throws IOException {\n+          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql) {\n+\n+    try {\n+      HoodieCLI.getTempViewProvider().runQuery(sql);\n+      return QUERY_SUCCESS;\n+    } catch (HoodieException ex) {\n+      return QUERY_FAIL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "934ccad3617e92724b7ef38535a8281e0bda47af"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgxNzc1Mw==", "bodyText": "runQuery showAllViews  and deleteTable  had log the detailed exception.", "url": "https://github.com/apache/hudi/pull/1770#discussion_r458817753", "createdAt": "2020-07-22T14:05:12Z", "author": {"login": "hddong"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/TempViewCommand.java", "diffHunk": "@@ -20,36 +20,55 @@\n \n import org.apache.hudi.cli.HoodieCLI;\n \n+import org.apache.hudi.exception.HoodieException;\n import org.springframework.shell.core.CommandMarker;\n import org.springframework.shell.core.annotation.CliCommand;\n import org.springframework.shell.core.annotation.CliOption;\n import org.springframework.stereotype.Component;\n \n-import java.io.IOException;\n-\n /**\n  * CLI command to query/delete temp views.\n  */\n @Component\n public class TempViewCommand implements CommandMarker {\n \n-  private static final String EMPTY_STRING = \"\";\n+  public static final String QUERY_SUCCESS = \"Query ran successfully!\";\n+  public static final String QUERY_FAIL = \"Query ran failed!\";\n+  public static final String SHOW_SUCCESS = \"Show all views name successfully!\";\n \n-  @CliCommand(value = \"temp_query\", help = \"query against created temp view\")\n+  @CliCommand(value = {\"temp_query\", \"temp query\"}, help = \"query against created temp view\")\n   public String query(\n-          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql)\n-          throws IOException {\n+          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql) {\n+\n+    try {\n+      HoodieCLI.getTempViewProvider().runQuery(sql);\n+      return QUERY_SUCCESS;\n+    } catch (HoodieException ex) {\n+      return QUERY_FAIL;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ2NTg3NQ=="}, "originalCommit": {"oid": "934ccad3617e92724b7ef38535a8281e0bda47af"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTE1OTc3NQ==", "bodyText": "OK~", "url": "https://github.com/apache/hudi/pull/1770#discussion_r459159775", "createdAt": "2020-07-23T00:41:27Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/commands/TempViewCommand.java", "diffHunk": "@@ -20,36 +20,55 @@\n \n import org.apache.hudi.cli.HoodieCLI;\n \n+import org.apache.hudi.exception.HoodieException;\n import org.springframework.shell.core.CommandMarker;\n import org.springframework.shell.core.annotation.CliCommand;\n import org.springframework.shell.core.annotation.CliOption;\n import org.springframework.stereotype.Component;\n \n-import java.io.IOException;\n-\n /**\n  * CLI command to query/delete temp views.\n  */\n @Component\n public class TempViewCommand implements CommandMarker {\n \n-  private static final String EMPTY_STRING = \"\";\n+  public static final String QUERY_SUCCESS = \"Query ran successfully!\";\n+  public static final String QUERY_FAIL = \"Query ran failed!\";\n+  public static final String SHOW_SUCCESS = \"Show all views name successfully!\";\n \n-  @CliCommand(value = \"temp_query\", help = \"query against created temp view\")\n+  @CliCommand(value = {\"temp_query\", \"temp query\"}, help = \"query against created temp view\")\n   public String query(\n-          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql)\n-          throws IOException {\n+          @CliOption(key = {\"sql\"}, mandatory = true, help = \"select query to run against view\") final String sql) {\n+\n+    try {\n+      HoodieCLI.getTempViewProvider().runQuery(sql);\n+      return QUERY_SUCCESS;\n+    } catch (HoodieException ex) {\n+      return QUERY_FAIL;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ2NTg3NQ=="}, "originalCommit": {"oid": "934ccad3617e92724b7ef38535a8281e0bda47af"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MDk5NzQwOnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/main/java/org/apache/hudi/cli/utils/SparkTempViewProvider.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwMDozODo0NVrOG1Om9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQxNDowOTo0NFrOG1kNtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ2NzA2Mg==", "bodyText": "IMO, this error description is not correct, right? The throwable not only covers the initialization of the spark context", "url": "https://github.com/apache/hudi/pull/1770#discussion_r458467062", "createdAt": "2020-07-22T00:38:45Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/utils/SparkTempViewProvider.java", "diffHunk": "@@ -101,6 +101,17 @@ public void runQuery(String sqlText) {\n     }\n   }\n \n+  @Override\n+  public void showAllViews() {\n+    try {\n+      sqlContext.sql(\"SHOW TABLES\").show(Integer.MAX_VALUE, false);\n+    } catch (Throwable ex) {\n+      // log full stack trace and rethrow. Without this its difficult to debug failures, if any\n+      LOG.error(\"unable to initialize spark context \", ex);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "934ccad3617e92724b7ef38535a8281e0bda47af"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgyMTA0Ng==", "bodyText": "IMO, this error description is not correct, right? The throwable not only covers the initialization of the spark context\n\nYes, change it to unable to get all views.", "url": "https://github.com/apache/hudi/pull/1770#discussion_r458821046", "createdAt": "2020-07-22T14:09:44Z", "author": {"login": "hddong"}, "path": "hudi-cli/src/main/java/org/apache/hudi/cli/utils/SparkTempViewProvider.java", "diffHunk": "@@ -101,6 +101,17 @@ public void runQuery(String sqlText) {\n     }\n   }\n \n+  @Override\n+  public void showAllViews() {\n+    try {\n+      sqlContext.sql(\"SHOW TABLES\").show(Integer.MAX_VALUE, false);\n+    } catch (Throwable ex) {\n+      // log full stack trace and rethrow. Without this its difficult to debug failures, if any\n+      LOG.error(\"unable to initialize spark context \", ex);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ2NzA2Mg=="}, "originalCommit": {"oid": "934ccad3617e92724b7ef38535a8281e0bda47af"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4518, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}