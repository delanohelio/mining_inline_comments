{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MTEzMDQ3", "number": 1616, "title": "[HUDI-786] Fixing read beyond inline length in InlineFS", "bodyText": "Fixing read beyond inline length in InlineFS.\n\nFix throws IOException when such read is attempted.\n\nVerify this pull request\nThis pull request is already covered by existing tests, such as TestInlineFileSystem#testFileSystemApis()\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-05-11T13:41:15Z", "url": "https://github.com/apache/hudi/pull/1616", "merged": true, "mergeCommit": {"oid": "5a0d3f1cf963e0061364d915ac86a465dd079bac"}, "closed": true, "closedAt": "2020-05-28T19:59:12Z", "author": {"login": "nsivabalan"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgP4B3AH2gAyNDE2MTEzMDQ3OjdiZGRjZjY2MmEzMzA3OWUzMmQzYWU2OWUwNmQ3OTk1YTliYzdlMTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclyyxBgFqTQyMDQxMTAxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7bddcf662a33079e32d3ae69e06d7995a9bc7e16", "author": {"user": {"login": "nsivabalan", "name": "Sivabalan Narayanan"}}, "url": "https://github.com/apache/hudi/commit/7bddcf662a33079e32d3ae69e06d7995a9bc7e16", "committedDate": "2020-05-11T13:41:26Z", "message": "Fixing read beyond inline length FS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "7bddcf662a33079e32d3ae69e06d7995a9bc7e16", "author": {"user": {"login": "nsivabalan", "name": "Sivabalan Narayanan"}}, "url": "https://github.com/apache/hudi/commit/7bddcf662a33079e32d3ae69e06d7995a9bc7e16", "committedDate": "2020-05-11T13:41:26Z", "message": "Fixing read beyond inline length FS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MzIyNjYz", "url": "https://github.com/apache/hudi/pull/1616#pullrequestreview-409322663", "createdAt": "2020-05-11T16:14:39Z", "commit": {"oid": "7bddcf662a33079e32d3ae69e06d7995a9bc7e16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNjoxNDozOVrOGTjX0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNjoxNDozOVrOGTjX0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1NTY2NQ==", "bodyText": "@nsivabalan : Dont we need to have this bounds check even for seek/read (offset-based) APIs ?", "url": "https://github.com/apache/hudi/pull/1616#discussion_r423155665", "createdAt": "2020-05-11T16:14:39Z", "author": {"login": "bvaradar"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/fs/inline/InLineFsDataInputStream.java", "diffHunk": "@@ -56,24 +56,29 @@ public long getPos() throws IOException {\n \n   @Override\n   public int read(long position, byte[] buffer, int offset, int length) throws IOException {\n+    if ((length - offset) > this.length) {\n+      throw new IOException(\"Attempting to read past inline content\");\n+    }\n     return outerStream.read(startOffset + position, buffer, offset, length);\n   }\n \n   @Override\n   public void readFully(long position, byte[] buffer, int offset, int length) throws IOException {\n+    if ((length - offset) > this.length) {\n+      throw new IOException(\"Attempting to read past inline content\");\n+    }\n     outerStream.readFully(startOffset + position, buffer, offset, length);\n   }\n \n   @Override\n   public void readFully(long position, byte[] buffer)\n       throws IOException {\n-    outerStream.readFully(startOffset + position, buffer, 0, buffer.length);\n+    readFully(position, buffer, 0, buffer.length);\n   }\n \n   @Override\n   public boolean seekToNewSource(long targetPos) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bddcf662a33079e32d3ae69e06d7995a9bc7e16"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzEzNDE3", "url": "https://github.com/apache/hudi/pull/1616#pullrequestreview-417313417", "createdAt": "2020-05-23T22:33:51Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzM3MjIz", "url": "https://github.com/apache/hudi/pull/1616#pullrequestreview-417337223", "createdAt": "2020-05-24T08:20:31Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwODoyMDozMlrOGZtaog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwODoyMDozMlrOGZtaog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYxMTY4Mg==", "bodyText": "I think the condition be length + offset > this.length. Right ? Can you please check", "url": "https://github.com/apache/hudi/pull/1616#discussion_r429611682", "createdAt": "2020-05-24T08:20:32Z", "author": {"login": "bvaradar"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/fs/inline/InLineFsDataInputStream.java", "diffHunk": "@@ -56,24 +60,32 @@ public long getPos() throws IOException {\n \n   @Override\n   public int read(long position, byte[] buffer, int offset, int length) throws IOException {\n+    if ((length - offset) > this.length) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "84dc7b55d70518f2353e243c28689e0c8fb28676", "author": {"user": {"login": "nsivabalan", "name": "Sivabalan Narayanan"}}, "url": "https://github.com/apache/hudi/commit/84dc7b55d70518f2353e243c28689e0c8fb28676", "committedDate": "2020-05-28T18:02:23Z", "message": "Fixing seek and tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "84dc7b55d70518f2353e243c28689e0c8fb28676", "author": {"user": {"login": "nsivabalan", "name": "Sivabalan Narayanan"}}, "url": "https://github.com/apache/hudi/commit/84dc7b55d70518f2353e243c28689e0c8fb28676", "committedDate": "2020-05-28T18:02:23Z", "message": "Fixing seek and tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDExMDEz", "url": "https://github.com/apache/hudi/pull/1616#pullrequestreview-420411013", "createdAt": "2020-05-28T19:11:59Z", "commit": {"oid": "84dc7b55d70518f2353e243c28689e0c8fb28676"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3126, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}