{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzOTUzODA5", "number": 2361, "title": "[HUDI-1485] Fix Deletes issued without any prior commits exception", "bodyText": "Tips\n\nThank you very much for contributing to Apache Hudi.\nPlease review https://hudi.apache.org/contributing.html before opening a pull request.\n\nWhat is the purpose of the pull request\nFix Deletes issued without any prior commits exception\nBrief change log\ncurrently, delete operation query delete instant in commit and deltacommit action only , replacecommit  will not be found.\nif the records to be deleted is writen by a replacecommit action ,it won't be found.\nVerify this pull request\n(Please pick either of the following options)\nThis pull request is a trivial rework / code cleanup without any test coverage.\n(or)\nThis pull request is already covered by existing tests, such as (please describe tests).\n(or)\nThis change added tests and can be verified as follows:\n(example:)\n\nAdded integration tests for end-to-end.\nAdded HoodieClientWriteTest to verify the change.\nManually verified the change by running a job locally.\n\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-12-22T08:19:57Z", "url": "https://github.com/apache/hudi/pull/2361", "merged": true, "mergeCommit": {"oid": "01ad449ad68d9c77ee1493fcdf833df53df6106a"}, "closed": true, "closedAt": "2020-12-22T15:10:20Z", "author": {"login": "wangxianghu"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdolVoLgH2gAyNTQzOTUzODA5OmFjMGY0ZDBiZGRhMGEzNDY0NGM3NDY1MGNiZmZmNTA1ZDAyYThjYzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoqukWgFqTU1NzA4NjA4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ac0f4d0bdda0a34644c74650cbfff505d02a8cc3", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/ac0f4d0bdda0a34644c74650cbfff505d02a8cc3", "committedDate": "2020-12-22T07:24:19Z", "message": "[HUDI-1485] Fix Deletes issued without any prior commits exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2OTEyMzQ1", "url": "https://github.com/apache/hudi/pull/2361#pullrequestreview-556912345", "createdAt": "2020-12-22T08:47:56Z", "commit": {"oid": "ac0f4d0bdda0a34644c74650cbfff505d02a8cc3"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwODo0Nzo1NlrOIJzJjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwODo0Nzo1NlrOIJzJjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzE0NjEyNQ==", "bodyText": "good catch", "url": "https://github.com/apache/hudi/pull/2361#discussion_r547146125", "createdAt": "2020-12-22T08:47:56Z", "author": {"login": "Trevor-zhang"}, "path": "hudi-client/hudi-client-common/src/main/java/org/apache/hudi/client/AbstractHoodieWriteClient.java", "diffHunk": "@@ -772,7 +772,8 @@ protected void setWriteSchemaForDeletes(HoodieTableMetaClient metaClient) {\n     try {\n       HoodieActiveTimeline activeTimeline = metaClient.getActiveTimeline();\n       Option<HoodieInstant> lastInstant =\n-          activeTimeline.filterCompletedInstants().filter(s -> s.getAction().equals(metaClient.getCommitActionType()))\n+          activeTimeline.filterCompletedInstants().filter(s -> s.getAction().equals(metaClient.getCommitActionType())\n+          || s.getAction().equals(HoodieActiveTimeline.REPLACE_COMMIT_ACTION))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac0f4d0bdda0a34644c74650cbfff505d02a8cc3"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MDg2MDg5", "url": "https://github.com/apache/hudi/pull/2361#pullrequestreview-557086089", "createdAt": "2020-12-22T13:41:05Z", "commit": {"oid": "ac0f4d0bdda0a34644c74650cbfff505d02a8cc3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4063, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}