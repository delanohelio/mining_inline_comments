{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NjE0MjY4", "number": 2319, "title": "[MINOR] Improve code readability by passing in the fileComparisonsRDD in bloom index", "bodyText": "What is the purpose of the pull request\nThe option 'hoodie.bloom.index.prune.by.ranges' is default true, so it\nexpects to be an improvement.\nBrief change log\n\nSome refactoring to SparkHoodieBloomIndex\n\nVerify this pull request\nExisting tests\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-12-10T03:40:28Z", "url": "https://github.com/apache/hudi/pull/2319", "merged": true, "mergeCommit": {"oid": "93d9c25aee37d36c03e4c0edfc18db7da819ce2d"}, "closed": true, "closedAt": "2020-12-15T06:35:24Z", "author": {"login": "danny0405"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkzYy4gFqTU0OTE5MjMyOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlDJyFABqjQwOTg5NzcyNjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MTkyMzI4", "url": "https://github.com/apache/hudi/pull/2319#pullrequestreview-549192328", "createdAt": "2020-12-10T13:26:25Z", "commit": {"oid": "0c991a84ad90fcb7226ee60a0fa2c89d6ffa4f17"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMzoyNjoyNVrOIDJJiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxMzoyNjoyNVrOIDJJiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDE2NjUzOQ==", "bodyText": "@shenh062326 FYI, related to your Tuple2 refactoring PR \ud83d\ude09 .", "url": "https://github.com/apache/hudi/pull/2319#discussion_r540166539", "createdAt": "2020-12-10T13:26:25Z", "author": {"login": "garyli1019"}, "path": "hudi-client/hudi-spark-client/src/main/java/org/apache/hudi/index/bloom/SparkHoodieBloomIndex.java", "diffHunk": "@@ -252,11 +252,9 @@ public boolean isImplicitWithStorage() {\n    * Make sure the parallelism is atleast the groupby parallelism for tagging location\n    */\n   JavaPairRDD<HoodieKey, HoodieRecordLocation> findMatchingFilesForRecordKeys(\n-      final Map<String, List<BloomIndexFileInfo>> partitionToFileIndexInfo,\n-      JavaPairRDD<String, String> partitionRecordKeyPairRDD, int shuffleParallelism, HoodieTable hoodieTable,\n+      JavaRDD<Tuple2<String, HoodieKey>> fileComparisonsRDD,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c991a84ad90fcb7226ee60a0fa2c89d6ffa4f17"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5MjY1Njc4", "url": "https://github.com/apache/hudi/pull/2319#pullrequestreview-549265678", "createdAt": "2020-12-10T14:44:02Z", "commit": {"oid": "0c991a84ad90fcb7226ee60a0fa2c89d6ffa4f17"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNDo0NDowMlrOIDMrUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMFQxNDo0NDowMlrOIDMrUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDIyNDMzOQ==", "bodyText": "Maybe we can move fileGroupToComparisons  into this line or break the hoodieTable  to the next line. It would be better?", "url": "https://github.com/apache/hudi/pull/2319#discussion_r540224339", "createdAt": "2020-12-10T14:44:02Z", "author": {"login": "yanghua"}, "path": "hudi-client/hudi-spark-client/src/main/java/org/apache/hudi/index/bloom/SparkHoodieBloomIndex.java", "diffHunk": "@@ -252,11 +252,9 @@ public boolean isImplicitWithStorage() {\n    * Make sure the parallelism is atleast the groupby parallelism for tagging location\n    */\n   JavaPairRDD<HoodieKey, HoodieRecordLocation> findMatchingFilesForRecordKeys(\n-      final Map<String, List<BloomIndexFileInfo>> partitionToFileIndexInfo,\n-      JavaPairRDD<String, String> partitionRecordKeyPairRDD, int shuffleParallelism, HoodieTable hoodieTable,\n+      JavaRDD<Tuple2<String, HoodieKey>> fileComparisonsRDD,\n+      int shuffleParallelism, HoodieTable hoodieTable,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c991a84ad90fcb7226ee60a0fa2c89d6ffa4f17"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c991a84ad90fcb7226ee60a0fa2c89d6ffa4f17", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/hudi/commit/0c991a84ad90fcb7226ee60a0fa2c89d6ffa4f17", "committedDate": "2020-12-10T03:37:21Z", "message": "[MINOR] Improve to only compute fileComparisonsRDD once when 'hoodie.bloom.index.prune.by.ranges' is set to true\n\nThe option 'hoodie.bloom.index.prune.by.ranges' is default true, so it\nexpects to be an improvement."}, "afterCommit": {"oid": "861fbe0d0fd396b5caaf81df510952103ba5070a", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/hudi/commit/861fbe0d0fd396b5caaf81df510952103ba5070a", "committedDate": "2020-12-11T02:45:38Z", "message": "[MINOR] Improve to only compute fileComparisonsRDD once when 'hoodie.bloom.index.prune.by.ranges' is set to true\n\nThe option 'hoodie.bloom.index.prune.by.ranges' is default true, so it\nexpects to be an improvement."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5ODUwMjc0", "url": "https://github.com/apache/hudi/pull/2319#pullrequestreview-549850274", "createdAt": "2020-12-11T07:16:50Z", "commit": {"oid": "861fbe0d0fd396b5caaf81df510952103ba5070a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNzoxNjo1MFrOIDsCNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNzoxODo0NVrOIDsFJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDczODEwMg==", "bodyText": "nit: wondering how checkstyle is happy with the indentation here. :)", "url": "https://github.com/apache/hudi/pull/2319#discussion_r540738102", "createdAt": "2020-12-11T07:16:50Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/hudi-spark-client/src/main/java/org/apache/hudi/index/bloom/SparkHoodieBloomIndex.java", "diffHunk": "@@ -252,11 +252,10 @@ public boolean isImplicitWithStorage() {\n    * Make sure the parallelism is atleast the groupby parallelism for tagging location\n    */\n   JavaPairRDD<HoodieKey, HoodieRecordLocation> findMatchingFilesForRecordKeys(\n-      final Map<String, List<BloomIndexFileInfo>> partitionToFileIndexInfo,\n-      JavaPairRDD<String, String> partitionRecordKeyPairRDD, int shuffleParallelism, HoodieTable hoodieTable,\n+      JavaRDD<Tuple2<String, HoodieKey>> fileComparisonsRDD,\n+      int shuffleParallelism,\n+\t  HoodieTable hoodieTable,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "861fbe0d0fd396b5caaf81df510952103ba5070a"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDczODg1NA==", "bodyText": "do you actually see from the Spark UI that its not computed twice? I ask because, fileComparisonsRDD is not cached and thus even though this is declared only once, during runtime, Spark will lazily recompute fileComparisonsRDD once for each method that uses it.", "url": "https://github.com/apache/hudi/pull/2319#discussion_r540738854", "createdAt": "2020-12-11T07:18:45Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/hudi-spark-client/src/main/java/org/apache/hudi/index/bloom/SparkHoodieBloomIndex.java", "diffHunk": "@@ -122,13 +122,15 @@ public SparkHoodieBloomIndex(HoodieWriteConfig config) {\n \n     // Step 3: Obtain a RDD, for each incoming record, that already exists, with the file id,\n     // that contains it.\n+    JavaRDD<Tuple2<String, HoodieKey>> fileComparisonsRDD =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "861fbe0d0fd396b5caaf81df510952103ba5070a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "622c3c7ce63a2536e6fd6274dcf0c2e552015d32", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/hudi/commit/622c3c7ce63a2536e6fd6274dcf0c2e552015d32", "committedDate": "2020-12-11T07:52:34Z", "message": "[MINOR] Improve to only compute fileComparisonsRDD once when 'hoodie.bloom.index.prune.by.ranges' is set to true\n\nThe option 'hoodie.bloom.index.prune.by.ranges' is default true, so it\nexpects to be an improvement."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "861fbe0d0fd396b5caaf81df510952103ba5070a", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/hudi/commit/861fbe0d0fd396b5caaf81df510952103ba5070a", "committedDate": "2020-12-11T02:45:38Z", "message": "[MINOR] Improve to only compute fileComparisonsRDD once when 'hoodie.bloom.index.prune.by.ranges' is set to true\n\nThe option 'hoodie.bloom.index.prune.by.ranges' is default true, so it\nexpects to be an improvement."}, "afterCommit": {"oid": "622c3c7ce63a2536e6fd6274dcf0c2e552015d32", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/hudi/commit/622c3c7ce63a2536e6fd6274dcf0c2e552015d32", "committedDate": "2020-12-11T07:52:34Z", "message": "[MINOR] Improve to only compute fileComparisonsRDD once when 'hoodie.bloom.index.prune.by.ranges' is set to true\n\nThe option 'hoodie.bloom.index.prune.by.ranges' is default true, so it\nexpects to be an improvement."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3968, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}