{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNjY4MjQy", "number": 2112, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMjowMjoyM1rOEnPCAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMjoyNjo1OVrOEnbzsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NTc2MTkzOnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/test/java/org/apache/hudi/cli/testutils/HoodieTestCommitMetadataGenerator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMjowMjoyM1rOHXuKpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMjowMjoyM1rOHXuKpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYzNTY4Nw==", "bodyText": "change stream#foreach to for-loop to avoid the noisy try-catch block.", "url": "https://github.com/apache/hudi/pull/2112#discussion_r494635687", "createdAt": "2020-09-24T22:02:23Z", "author": {"login": "xushiyan"}, "path": "hudi-cli/src/test/java/org/apache/hudi/cli/testutils/HoodieTestCommitMetadataGenerator.java", "diffHunk": "@@ -62,67 +62,53 @@\n   /**\n    * Create a commit file with default CommitMetadata.\n    */\n-  public static void createCommitFileWithMetadata(String basePath, String commitTime, Configuration configuration) {\n+  public static void createCommitFileWithMetadata(String basePath, String commitTime, Configuration configuration) throws Exception {\n     createCommitFileWithMetadata(basePath, commitTime, configuration, Option.empty(), Option.empty());\n   }\n \n   public static void createCommitFileWithMetadata(String basePath, String commitTime, Configuration configuration,\n-      Option<Integer> writes, Option<Integer> updates) {\n+      Option<Integer> writes, Option<Integer> updates) throws Exception {\n     createCommitFileWithMetadata(basePath, commitTime, configuration, UUID.randomUUID().toString(),\n         UUID.randomUUID().toString(), writes, updates);\n   }\n \n   public static void createCommitFileWithMetadata(String basePath, String commitTime, Configuration configuration,\n-      String fileId1, String fileId2, Option<Integer> writes, Option<Integer> updates) {\n-    Arrays.asList(HoodieTimeline.makeCommitFileName(commitTime), HoodieTimeline.makeInflightCommitFileName(commitTime),\n-        HoodieTimeline.makeRequestedCommitFileName(commitTime))\n-        .forEach(f -> {\n-          Path commitFile = new Path(\n-              basePath + \"/\" + HoodieTableMetaClient.METAFOLDER_NAME + \"/\" + f);\n-          FSDataOutputStream os = null;\n-          try {\n-            FileSystem fs = FSUtils.getFs(basePath, configuration);\n-            os = fs.create(commitFile, true);\n-            // Generate commitMetadata\n-            HoodieCommitMetadata commitMetadata =\n-                generateCommitMetadata(basePath, commitTime, fileId1, fileId2, writes, updates);\n-            // Write empty commit metadata\n-            os.writeBytes(new String(commitMetadata.toJsonString().getBytes(StandardCharsets.UTF_8)));\n-          } catch (IOException ioe) {\n-            throw new HoodieIOException(ioe.getMessage(), ioe);\n-          } finally {\n-            if (null != os) {\n-              try {\n-                os.close();\n-              } catch (IOException e) {\n-                throw new HoodieIOException(e.getMessage(), e);\n-              }\n-            }\n-          }\n-        });\n+      String fileId1, String fileId2, Option<Integer> writes, Option<Integer> updates) throws Exception {\n+    List<String> commitFileNames = Arrays.asList(HoodieTimeline.makeCommitFileName(commitTime), HoodieTimeline.makeInflightCommitFileName(commitTime),\n+        HoodieTimeline.makeRequestedCommitFileName(commitTime));\n+    for (String name : commitFileNames) {\n+      Path commitFilePath = new Path(Paths.get(basePath, HoodieTableMetaClient.METAFOLDER_NAME, name).toString());\n+      try (FSDataOutputStream os = FSUtils.getFs(basePath, configuration).create(commitFilePath, true)) {\n+        // Generate commitMetadata\n+        HoodieCommitMetadata commitMetadata =\n+            generateCommitMetadata(basePath, commitTime, fileId1, fileId2, writes, updates);\n+        // Write empty commit metadata\n+        os.writeBytes(new String(commitMetadata.toJsonString().getBytes(StandardCharsets.UTF_8)));\n+      }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6fe876d5fc9db60777899f864dcdaf8857601f50"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5Nzg1NDIxOnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestCommitsCommand.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMjoyNjo0M1rOHYBfYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNlQxMzoyMDo1M1rOHYgQIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1MjI5MQ==", "bodyText": "Why we should do this refactor?", "url": "https://github.com/apache/hudi/pull/2112#discussion_r494952291", "createdAt": "2020-09-25T12:26:43Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestCommitsCommand.java", "diffHunk": "@@ -76,17 +76,19 @@ public void init() throws IOException {\n         \"\", TimelineLayoutVersion.VERSION_1, \"org.apache.hudi.common.model.HoodieAvroPayload\");\n   }\n \n-  private LinkedHashMap<String, Integer[]> generateData() {\n+  private LinkedHashMap<String, Integer[]> generateData() throws Exception {\n     // generate data and metadata\n     LinkedHashMap<String, Integer[]> data = new LinkedHashMap<>();\n     data.put(\"102\", new Integer[] {15, 10});\n     data.put(\"101\", new Integer[] {20, 10});\n     data.put(\"100\", new Integer[] {15, 15});\n \n-    data.forEach((key, value) -> {\n+    for (Map.Entry<String, Integer[]> entry : data.entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5171847b208e25557d23f81cc916f2646e0eb938"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ0OTI5Ng==", "bodyText": "@yanghua In HoodieTestCommitMetadataGenerator#createCommitFileWithMetadata (refer to the comment above), I removed the try catch block by declaring the exception hence the callers need to declare it too. The callers' forEach force it to be caught therefore changed to for-loop. I'm trying to adopt a preference of declaring Exception over catching them and for-loop over Stream#forEach to avoid noisy try-catch. Please let me know your thoughts.", "url": "https://github.com/apache/hudi/pull/2112#discussion_r495449296", "createdAt": "2020-09-26T11:53:20Z", "author": {"login": "xushiyan"}, "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestCommitsCommand.java", "diffHunk": "@@ -76,17 +76,19 @@ public void init() throws IOException {\n         \"\", TimelineLayoutVersion.VERSION_1, \"org.apache.hudi.common.model.HoodieAvroPayload\");\n   }\n \n-  private LinkedHashMap<String, Integer[]> generateData() {\n+  private LinkedHashMap<String, Integer[]> generateData() throws Exception {\n     // generate data and metadata\n     LinkedHashMap<String, Integer[]> data = new LinkedHashMap<>();\n     data.put(\"102\", new Integer[] {15, 10});\n     data.put(\"101\", new Integer[] {20, 10});\n     data.put(\"100\", new Integer[] {15, 15});\n \n-    data.forEach((key, value) -> {\n+    for (Map.Entry<String, Integer[]> entry : data.entrySet()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1MjI5MQ=="}, "originalCommit": {"oid": "5171847b208e25557d23f81cc916f2646e0eb938"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ1NjI5MQ==", "bodyText": "Ok, I can accept this explanation.", "url": "https://github.com/apache/hudi/pull/2112#discussion_r495456291", "createdAt": "2020-09-26T13:20:53Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestCommitsCommand.java", "diffHunk": "@@ -76,17 +76,19 @@ public void init() throws IOException {\n         \"\", TimelineLayoutVersion.VERSION_1, \"org.apache.hudi.common.model.HoodieAvroPayload\");\n   }\n \n-  private LinkedHashMap<String, Integer[]> generateData() {\n+  private LinkedHashMap<String, Integer[]> generateData() throws Exception {\n     // generate data and metadata\n     LinkedHashMap<String, Integer[]> data = new LinkedHashMap<>();\n     data.put(\"102\", new Integer[] {15, 10});\n     data.put(\"101\", new Integer[] {20, 10});\n     data.put(\"100\", new Integer[] {15, 15});\n \n-    data.forEach((key, value) -> {\n+    for (Map.Entry<String, Integer[]> entry : data.entrySet()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1MjI5MQ=="}, "originalCommit": {"oid": "5171847b208e25557d23f81cc916f2646e0eb938"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5Nzg1NTIzOnYy", "diffSide": "RIGHT", "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestCommitsCommand.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMjoyNjo1OVrOHYBf-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMjoyNjo1OVrOHYBf-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1MjQ0Mg==", "bodyText": "ditto", "url": "https://github.com/apache/hudi/pull/2112#discussion_r494952442", "createdAt": "2020-09-25T12:26:59Z", "author": {"login": "yanghua"}, "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestCommitsCommand.java", "diffHunk": "@@ -168,10 +170,12 @@ public void testShowArchivedCommits() throws IOException {\n     data.put(\"102\", new Integer[] {25, 45});\n     data.put(\"101\", new Integer[] {35, 15});\n \n-    data.forEach((key, value) -> {\n+    for (Map.Entry<String, Integer[]> entry : data.entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5171847b208e25557d23f81cc916f2646e0eb938"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4297, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}