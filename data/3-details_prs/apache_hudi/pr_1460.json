{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MDU1MzU0", "number": 1460, "title": "[HUDI-679] Make io package Spark free", "bodyText": "Tips\n\nThank you very much for contributing to Apache Hudi.\nPlease review https://hudi.apache.org/contributing.html before opening a pull request.\n\nWhat is the purpose of the pull request\nMake io package spark free.\nBrief change log\n\nIntroduce SparkSupplier.java\nRemove the usage of TaskContext in io package.\n\nVerify this pull request\nThis pull request is a trivial rework / code cleanup without any test coverage.\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-03-28T06:36:29Z", "url": "https://github.com/apache/hudi/pull/1460", "merged": true, "mergeCommit": {"oid": "07c3c5d797f612f9b73b2805b65275c2029c2442"}, "closed": true, "closedAt": "2020-03-29T08:54:00Z", "author": {"login": "leesf"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR_XPeAH2gAyMzk1MDU1MzU0OjVmNjViZmIwMjg0NmNlNjFiZDczM2I3MGJjY2I5ODFmOTgzNDg3Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSV-_uAFqTM4MzM4NzkyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5f65bfb02846ce61bd733b70bccb981f98348777", "author": {"user": {"login": "leesf", "name": "leesf"}}, "url": "https://github.com/apache/hudi/commit/5f65bfb02846ce61bd733b70bccb981f98348777", "committedDate": "2020-03-28T06:32:12Z", "message": "[HUDI-679] Make io package Spark free"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24e68e3a8238453a603455eb9c69b438a82bc25c", "author": {"user": {"login": "leesf", "name": "leesf"}}, "url": "https://github.com/apache/hudi/commit/24e68e3a8238453a603455eb9c69b438a82bc25c", "committedDate": "2020-03-28T08:31:41Z", "message": "address travis failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb7268f4d20e9bffa60220487fed03a945916b99", "author": {"user": {"login": "leesf", "name": "leesf"}}, "url": "https://github.com/apache/hudi/commit/bb7268f4d20e9bffa60220487fed03a945916b99", "committedDate": "2020-03-28T09:25:57Z", "message": "add travis"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzAzNDgx", "url": "https://github.com/apache/hudi/pull/1460#pullrequestreview-383303481", "createdAt": "2020-03-28T11:01:54Z", "commit": {"oid": "bb7268f4d20e9bffa60220487fed03a945916b99"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxMTowMTo1NFrOF9IprA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxMTowMjo0N1rOF9Ip6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY0OTE5Ng==", "bodyText": "Considering this interface supports some information about TaskContext, can we rename to SparkTaskContextDetailSupplier?", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399649196", "createdAt": "2020-03-28T11:01:54Z", "author": {"login": "yanghua"}, "path": "hudi-client/src/main/java/org/apache/hudi/client/SparkSupplier.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.client;\n+\n+import org.apache.spark.TaskContext;\n+\n+import java.io.Serializable;\n+import java.util.function.Supplier;\n+\n+/**\n+ * Spark Supplier.\n+ */\n+public interface SparkSupplier<T> extends Supplier<T>, Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb7268f4d20e9bffa60220487fed03a945916b99"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY0OTI1OA==", "bodyText": "Can we add empty line to split this definition?  Additionally, add some comments?", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399649258", "createdAt": "2020-03-28T11:02:47Z", "author": {"login": "yanghua"}, "path": "hudi-client/src/main/java/org/apache/hudi/client/SparkSupplier.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.client;\n+\n+import org.apache.spark.TaskContext;\n+\n+import java.io.Serializable;\n+import java.util.function.Supplier;\n+\n+/**\n+ * Spark Supplier.\n+ */\n+public interface SparkSupplier<T> extends Supplier<T>, Serializable {\n+  SparkSupplier<Integer> PARTITION_SUPPLIER = () -> TaskContext.getPartitionId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb7268f4d20e9bffa60220487fed03a945916b99"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ef6c852631c8344a77def77a9e8f8d81a67c283", "author": {"user": {"login": "leesf", "name": "leesf"}}, "url": "https://github.com/apache/hudi/commit/9ef6c852631c8344a77def77a9e8f8d81a67c283", "committedDate": "2020-03-28T11:31:14Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzExMzk2", "url": "https://github.com/apache/hudi/pull/1460#pullrequestreview-383311396", "createdAt": "2020-03-28T13:02:40Z", "commit": {"oid": "9ef6c852631c8344a77def77a9e8f8d81a67c283"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxMzowMjo0MFrOF9JUPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxMzowODozMVrOF9JWMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2MDA5NA==", "bodyText": "PARTITION_ID_SUPPLIER ?", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399660094", "createdAt": "2020-03-28T13:02:40Z", "author": {"login": "yanghua"}, "path": "hudi-client/src/main/java/org/apache/hudi/client/SparkTaskContextDetailSupplier.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.client;\n+\n+import org.apache.spark.TaskContext;\n+\n+import java.io.Serializable;\n+import java.util.function.Supplier;\n+\n+/**\n+ * Spark Supplier.\n+ */\n+public interface SparkTaskContextDetailSupplier<T> extends Supplier<T>, Serializable {\n+\n+  /**\n+   * Supplier to get partition id.\n+   */\n+  SparkTaskContextDetailSupplier<Integer> PARTITION_SUPPLIER = () -> TaskContext.getPartitionId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ef6c852631c8344a77def77a9e8f8d81a67c283"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2MDEzMg==", "bodyText": "STAGE_ID_SUPPLIER ?", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399660132", "createdAt": "2020-03-28T13:03:01Z", "author": {"login": "yanghua"}, "path": "hudi-client/src/main/java/org/apache/hudi/client/SparkTaskContextDetailSupplier.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.client;\n+\n+import org.apache.spark.TaskContext;\n+\n+import java.io.Serializable;\n+import java.util.function.Supplier;\n+\n+/**\n+ * Spark Supplier.\n+ */\n+public interface SparkTaskContextDetailSupplier<T> extends Supplier<T>, Serializable {\n+\n+  /**\n+   * Supplier to get partition id.\n+   */\n+  SparkTaskContextDetailSupplier<Integer> PARTITION_SUPPLIER = () -> TaskContext.getPartitionId();\n+\n+  /**\n+   * Supplier to get stage id.\n+   */\n+  SparkTaskContextDetailSupplier<Integer> STAGE_SUPPLIER = () -> TaskContext.get().stageId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ef6c852631c8344a77def77a9e8f8d81a67c283"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2MDE2Nw==", "bodyText": "ATTEMPT_ID_SUPPLIER ?", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399660167", "createdAt": "2020-03-28T13:03:29Z", "author": {"login": "yanghua"}, "path": "hudi-client/src/main/java/org/apache/hudi/client/SparkTaskContextDetailSupplier.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.client;\n+\n+import org.apache.spark.TaskContext;\n+\n+import java.io.Serializable;\n+import java.util.function.Supplier;\n+\n+/**\n+ * Spark Supplier.\n+ */\n+public interface SparkTaskContextDetailSupplier<T> extends Supplier<T>, Serializable {\n+\n+  /**\n+   * Supplier to get partition id.\n+   */\n+  SparkTaskContextDetailSupplier<Integer> PARTITION_SUPPLIER = () -> TaskContext.getPartitionId();\n+\n+  /**\n+   * Supplier to get stage id.\n+   */\n+  SparkTaskContextDetailSupplier<Integer> STAGE_SUPPLIER = () -> TaskContext.get().stageId();\n+\n+  /**\n+   * Supplier to get task attempt id.\n+   */\n+  SparkTaskContextDetailSupplier<Long> ATTEMPT_SUPPLIER = () -> TaskContext.get().taskAttemptId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ef6c852631c8344a77def77a9e8f8d81a67c283"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2MDMzOA==", "bodyText": "hoodieTable.getIdSupplier() is not clear here. I suggest we can rename these getter to e.g. getPartitionIdSupplier, getStageId and getAttemptId?", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399660338", "createdAt": "2020-03-28T13:05:15Z", "author": {"login": "yanghua"}, "path": "hudi-client/src/main/java/org/apache/hudi/execution/BulkInsertMapFunction.java", "diffHunk": "@@ -51,6 +51,7 @@ public BulkInsertMapFunction(String instantTime, HoodieWriteConfig config, Hoodi\n   @Override\n   public Iterator<List<WriteStatus>> call(Integer partition, Iterator<HoodieRecord<T>> sortedRecordItr) {\n     return new CopyOnWriteLazyInsertIterable<>(sortedRecordItr, config, instantTime, hoodieTable,\n-        fileIDPrefixes.get(partition));\n+        fileIDPrefixes.get(partition), hoodieTable.getIdSupplier(), hoodieTable.getStageSupplier(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ef6c852631c8344a77def77a9e8f8d81a67c283"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2MDM3Mg==", "bodyText": "ditto", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399660372", "createdAt": "2020-03-28T13:05:33Z", "author": {"login": "yanghua"}, "path": "hudi-client/src/main/java/org/apache/hudi/execution/CopyOnWriteLazyInsertIterable.java", "diffHunk": "@@ -50,15 +51,23 @@\n   protected final HoodieTable<T> hoodieTable;\n   protected final String idPrefix;\n   protected int numFilesWritten;\n+  protected Supplier<Integer> idSupplier;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ef6c852631c8344a77def77a9e8f8d81a67c283"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2MDQ2Ng==", "bodyText": "Actually, I am not sure if we can package these three args into a DTO structure. Just a thought, you can ignore.", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399660466", "createdAt": "2020-03-28T13:06:49Z", "author": {"login": "yanghua"}, "path": "hudi-client/src/main/java/org/apache/hudi/execution/CopyOnWriteLazyInsertIterable.java", "diffHunk": "@@ -50,15 +51,23 @@\n   protected final HoodieTable<T> hoodieTable;\n   protected final String idPrefix;\n   protected int numFilesWritten;\n+  protected Supplier<Integer> idSupplier;\n+  protected Supplier<Integer> stageSupplier;\n+  protected Supplier<Long> attemptSupplier;\n \n   public CopyOnWriteLazyInsertIterable(Iterator<HoodieRecord<T>> sortedRecordItr, HoodieWriteConfig config,\n-                                       String instantTime, HoodieTable<T> hoodieTable, String idPrefix) {\n+                                       String instantTime, HoodieTable<T> hoodieTable, String idPrefix,\n+                                       Supplier<Integer> idSupplier, Supplier<Integer> stageSupplier,\n+                                       Supplier<Long> attemptSupplier) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ef6c852631c8344a77def77a9e8f8d81a67c283"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2MDU5NQ==", "bodyText": "ditto, IMO, id here is not clear. partition id is better.", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399660595", "createdAt": "2020-03-28T13:08:31Z", "author": {"login": "yanghua"}, "path": "hudi-client/src/main/java/org/apache/hudi/io/HoodieWriteHandle.java", "diffHunk": "@@ -55,26 +55,32 @@\n   protected final String partitionPath;\n   protected final String fileId;\n   protected final String writeToken;\n+  protected final Supplier<Integer> idSupplier;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ef6c852631c8344a77def77a9e8f8d81a67c283"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "934c41dea3b8931288f1b339f95140f5e8f5b048", "author": {"user": {"login": "leesf", "name": "leesf"}}, "url": "https://github.com/apache/hudi/commit/934c41dea3b8931288f1b339f95140f5e8f5b048", "committedDate": "2020-03-28T15:21:28Z", "message": "address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9a3c06b0907886d62812d9ed5255bfa47babcd6", "author": {"user": {"login": "leesf", "name": "leesf"}}, "url": "https://github.com/apache/hudi/commit/e9a3c06b0907886d62812d9ed5255bfa47babcd6", "committedDate": "2020-03-28T15:22:53Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzQxODE5", "url": "https://github.com/apache/hudi/pull/1460#pullrequestreview-383341819", "createdAt": "2020-03-28T19:24:56Z", "commit": {"oid": "e9a3c06b0907886d62812d9ed5255bfa47babcd6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxOToyNDo1NlrOF9LuMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxOTozMTozM1rOF9Lw2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5OTUwNg==", "bodyText": "Should be interface be something generic like WriteTaskContextSupplier  which is extended by SparkTaskContextSupplier ?", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399699506", "createdAt": "2020-03-28T19:24:56Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/src/main/java/org/apache/hudi/client/SparkTaskContextDetailSupplier.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.client;\n+\n+import org.apache.spark.TaskContext;\n+\n+import java.io.Serializable;\n+import java.util.function.Supplier;\n+\n+/**\n+ * Spark Supplier.\n+ */\n+public interface SparkTaskContextDetailSupplier<T> extends Supplier<T>, Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9a3c06b0907886d62812d9ed5255bfa47babcd6"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5OTc5NA==", "bodyText": "I am not sure this abstraction is at the right level.. Should this have to be Supplier.. I think we can just have three methods that return Supplier<Integer> and Supplier<Long> and pass just one argument through the code path i.e the SparkTaskContextSuppler instance..", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399699794", "createdAt": "2020-03-28T19:27:59Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/src/main/java/org/apache/hudi/client/SparkTaskContextDetailSupplier.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.client;\n+\n+import org.apache.spark.TaskContext;\n+\n+import java.io.Serializable;\n+import java.util.function.Supplier;\n+\n+/**\n+ * Spark Supplier.\n+ */\n+public interface SparkTaskContextDetailSupplier<T> extends Supplier<T>, Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9a3c06b0907886d62812d9ed5255bfa47babcd6"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5OTk0MQ==", "bodyText": "then this can go away.. I feel this is additional abstraction, that we may not need..", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399699941", "createdAt": "2020-03-28T19:29:06Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/src/main/java/org/apache/hudi/client/Suppliers.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.client;\n+\n+import java.io.Serializable;\n+\n+/**\n+ * A bundle of Suppliers.\n+ */\n+public class Suppliers implements Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9a3c06b0907886d62812d9ed5255bfa47babcd6"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcwMDA1OA==", "bodyText": "side point: we should fix method arg formatting  consistently between intellij and checkstyle. Keep seeing these sort of whitespace changes in PRs.", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399700058", "createdAt": "2020-03-28T19:30:23Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/src/main/java/org/apache/hudi/execution/MergeOnReadLazyInsertIterable.java", "diffHunk": "@@ -35,8 +36,9 @@\n public class MergeOnReadLazyInsertIterable<T extends HoodieRecordPayload> extends CopyOnWriteLazyInsertIterable<T> {\n \n   public MergeOnReadLazyInsertIterable(Iterator<HoodieRecord<T>> sortedRecordItr, HoodieWriteConfig config,\n-      String instantTime, HoodieTable<T> hoodieTable, String idPfx) {\n-    super(sortedRecordItr, config, instantTime, hoodieTable, idPfx);\n+                                       String instantTime, HoodieTable<T> hoodieTable, String idPfx,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9a3c06b0907886d62812d9ed5255bfa47babcd6"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcwMDE4NA==", "bodyText": "rename to just makeWriteToken()?", "url": "https://github.com/apache/hudi/pull/1460#discussion_r399700184", "createdAt": "2020-03-28T19:31:33Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/src/main/java/org/apache/hudi/io/HoodieWriteHandle.java", "diffHunk": "@@ -55,26 +55,27 @@\n   protected final String partitionPath;\n   protected final String fileId;\n   protected final String writeToken;\n+  protected final Suppliers suppliers;\n \n   public HoodieWriteHandle(HoodieWriteConfig config, String instantTime, String partitionPath,\n-                           String fileId, HoodieTable<T> hoodieTable) {\n+                           String fileId, HoodieTable<T> hoodieTable, Suppliers suppliers) {\n     super(config, instantTime, hoodieTable);\n     this.partitionPath = partitionPath;\n     this.fileId = fileId;\n-    this.writeToken = makeSparkWriteToken();\n     this.originalSchema = new Schema.Parser().parse(config.getSchema());\n     this.writerSchema = createHoodieWriteSchema(originalSchema);\n     this.timer = new HoodieTimer().startTimer();\n     this.writeStatus = (WriteStatus) ReflectionUtils.loadClass(config.getWriteStatusClassName(),\n         !hoodieTable.getIndex().isImplicitWithStorage(), config.getWriteStatusFailureFraction());\n+    this.suppliers = suppliers;\n+    this.writeToken = makeSparkWriteToken();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9a3c06b0907886d62812d9ed5255bfa47babcd6"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d215b83c25e3df548d44d8a8c4d20a16efbf863", "author": {"user": {"login": "leesf", "name": "leesf"}}, "url": "https://github.com/apache/hudi/commit/3d215b83c25e3df548d44d8a8c4d20a16efbf863", "committedDate": "2020-03-29T05:09:06Z", "message": "address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07f073a7b0c5e326524961105fed84a2b92e2c18", "author": {"user": {"login": "leesf", "name": "leesf"}}, "url": "https://github.com/apache/hudi/commit/07f073a7b0c5e326524961105fed84a2b92e2c18", "committedDate": "2020-03-29T05:12:15Z", "message": "format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzc0OTk4", "url": "https://github.com/apache/hudi/pull/1460#pullrequestreview-383374998", "createdAt": "2020-03-29T05:34:29Z", "commit": {"oid": "07f073a7b0c5e326524961105fed84a2b92e2c18"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzg3OTIy", "url": "https://github.com/apache/hudi/pull/1460#pullrequestreview-383387922", "createdAt": "2020-03-29T08:53:32Z", "commit": {"oid": "07f073a7b0c5e326524961105fed84a2b92e2c18"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3283, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}