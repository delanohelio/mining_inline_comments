{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NTQyOTk5", "number": 1348, "title": "HUDI-597 Enable incremental pulling from defined partitions", "bodyText": "Tips\n\nThank you very much for contributing to Apache Hudi.\nPlease review https://hudi.apache.org/contributing.html before opening a pull request.\n\nWhat is the purpose of the pull request\nAllow the user to do incremental pulling from certain partitions\nBrief change log\n\nAdded a new option in DataSourceReadOptions\nApplied a glob pattern filter if the option is defined by user\nAdded a unit test for this feature\n\nVerify this pull request\nThis change added tests and can be verified as follows:\n\nAdded a test in testCopyOnWriteStorage\n\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-02-22T02:56:39Z", "url": "https://github.com/apache/hudi/pull/1348", "merged": true, "mergeCommit": {"oid": "4e7fcde4a6c69a070987fb97d978564f105ce547"}, "closed": true, "closedAt": "2020-02-24T19:46:31Z", "author": {"login": "garyli1019"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHCdCqgFqTM2MzA2NzE4Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHi8QAAFqTM2MzY1MzI5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMDY3MTgy", "url": "https://github.com/apache/hudi/pull/1348#pullrequestreview-363067182", "createdAt": "2020-02-23T05:46:39Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwNTo0NjozOVrOFtObQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwNTo1NDo0MVrOFtOctw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2NjU5NA==", "bodyText": "can we move the \"\" default to DataSourceOptions, to keep it consistent with how the other options are defined", "url": "https://github.com/apache/hudi/pull/1348#discussion_r382966594", "createdAt": "2020-02-23T05:46:39Z", "author": {"login": "vinothchandar"}, "path": "hudi-spark/src/main/scala/org/apache/hudi/IncrementalRelation.scala", "diffHunk": "@@ -84,7 +85,7 @@ class IncrementalRelation(val sqlContext: SQLContext,\n \n   val filters = {\n     if (optParams.contains(DataSourceReadOptions.PUSH_DOWN_INCR_FILTERS_OPT_KEY)) {\n-      val filterStr = optParams.get(DataSourceReadOptions.PUSH_DOWN_INCR_FILTERS_OPT_KEY).getOrElse(\"\")\n+      val filterStr = optParams.getOrElse(DataSourceReadOptions.PUSH_DOWN_INCR_FILTERS_OPT_KEY, \"\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2NjY2NA==", "bodyText": "here we will compare with the default variable constant.", "url": "https://github.com/apache/hudi/pull/1348#discussion_r382966664", "createdAt": "2020-02-23T05:48:26Z", "author": {"login": "vinothchandar"}, "path": "hudi-spark/src/main/scala/org/apache/hudi/IncrementalRelation.scala", "diffHunk": "@@ -100,17 +101,22 @@ class IncrementalRelation(val sqlContext: SQLContext,\n         .get, classOf[HoodieCommitMetadata])\n       fileIdToFullPath ++= metadata.getFileIdAndFullPaths(basePath).toMap\n     }\n+    val pathGlobPattern = optParams.getOrElse(DataSourceReadOptions.INCR_PATH_GLOB_OPT_KEY, \"\")\n+    val filteredFullPath = if(!pathGlobPattern.equals(\"\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2NjcwNQ==", "bodyText": "please enclose within braces for readability.", "url": "https://github.com/apache/hudi/pull/1348#discussion_r382966705", "createdAt": "2020-02-23T05:49:24Z", "author": {"login": "vinothchandar"}, "path": "hudi-spark/src/main/scala/org/apache/hudi/IncrementalRelation.scala", "diffHunk": "@@ -100,17 +101,22 @@ class IncrementalRelation(val sqlContext: SQLContext,\n         .get, classOf[HoodieCommitMetadata])\n       fileIdToFullPath ++= metadata.getFileIdAndFullPaths(basePath).toMap\n     }\n+    val pathGlobPattern = optParams.getOrElse(DataSourceReadOptions.INCR_PATH_GLOB_OPT_KEY, \"\")\n+    val filteredFullPath = if(!pathGlobPattern.equals(\"\")) {\n+      val globMatcher = new GlobPattern(\"*\" + pathGlobPattern)\n+      fileIdToFullPath.filter(p => globMatcher.matches(p._2))\n+    } else fileIdToFullPath", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2Njg1Mg==", "bodyText": "should we leave the * to the user? i.e let the user pass in * if needed? or is that needed for the matching...\nI am not familiar with this class per se..\nAlso http://hadoop.apache.org/docs/r2.8.0/api/allclasses-noframe.html does not seem to have GlobPattern is this class still around.. Was a bit confused by that..", "url": "https://github.com/apache/hudi/pull/1348#discussion_r382966852", "createdAt": "2020-02-23T05:52:37Z", "author": {"login": "vinothchandar"}, "path": "hudi-spark/src/main/scala/org/apache/hudi/IncrementalRelation.scala", "diffHunk": "@@ -100,17 +101,22 @@ class IncrementalRelation(val sqlContext: SQLContext,\n         .get, classOf[HoodieCommitMetadata])\n       fileIdToFullPath ++= metadata.getFileIdAndFullPaths(basePath).toMap\n     }\n+    val pathGlobPattern = optParams.getOrElse(DataSourceReadOptions.INCR_PATH_GLOB_OPT_KEY, \"\")\n+    val filteredFullPath = if(!pathGlobPattern.equals(\"\")) {\n+      val globMatcher = new GlobPattern(\"*\" + pathGlobPattern)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2Njk2Nw==", "bodyText": "is the leading / necessary?  could we make it (if not already) such that the matchong works with or without it..", "url": "https://github.com/apache/hudi/pull/1348#discussion_r382966967", "createdAt": "2020-02-23T05:54:41Z", "author": {"login": "vinothchandar"}, "path": "hudi-spark/src/test/scala/TestDataSource.scala", "diffHunk": "@@ -135,6 +136,14 @@ class TestDataSource extends AssertionsForJUnit {\n     countsPerCommit = hoodieIncViewDF2.groupBy(\"_hoodie_commit_time\").count().collect();\n     assertEquals(1, countsPerCommit.length)\n     assertEquals(commitInstantTime2, countsPerCommit(0).get(0))\n+\n+    // pull the latest commit within certain partitions\n+    val hoodieIncViewDF3 = spark.read.format(\"org.apache.hudi\")\n+      .option(DataSourceReadOptions.QUERY_TYPE_OPT_KEY, DataSourceReadOptions.QUERY_TYPE_INCREMENTAL_OPT_VAL)\n+      .option(DataSourceReadOptions.BEGIN_INSTANTTIME_OPT_KEY, commitInstantTime1)\n+      .option(DataSourceReadOptions.INCR_PATH_GLOB_OPT_KEY, \"/2016/*/*/*\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8306986f932c7a012226d82c7b3e8a8c967440e8", "author": {"user": {"login": "garyli1019", "name": "Gary Li"}}, "url": "https://github.com/apache/hudi/commit/8306986f932c7a012226d82c7b3e8a8c967440e8", "committedDate": "2020-02-24T00:52:50Z", "message": "HUDI-597 Enable incremental pulling from defined partitions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "8306986f932c7a012226d82c7b3e8a8c967440e8", "author": {"user": {"login": "garyli1019", "name": "Gary Li"}}, "url": "https://github.com/apache/hudi/commit/8306986f932c7a012226d82c7b3e8a8c967440e8", "committedDate": "2020-02-24T00:52:50Z", "message": "HUDI-597 Enable incremental pulling from defined partitions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNjUzMjky", "url": "https://github.com/apache/hudi/pull/1348#pullrequestreview-363653292", "createdAt": "2020-02-24T19:46:08Z", "commit": {"oid": "8306986f932c7a012226d82c7b3e8a8c967440e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3630, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}