{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MTExNDU0", "number": 2227, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwMzoxODo0M1rOE1Dr6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMFQxNzoyOToyNVrOFcqx3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0MDcwMzc4OnYy", "diffSide": "RIGHT", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwMzoxODo0M1rOHtH0Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNlQxMjoxODowMFrOIg9Puw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzA3NTk4Nw==", "bodyText": "I suggest check the string value of  auto.offset.reset and set default value to LATEST  if it is not set to LATEST or EARLIEST before we get the KafkaResetOffsetStrategies.\nBecause KafkaResetOffsetStrategies has only two values: LATEST and LATEST, if the user set it to other value this line will throw an exception.\nthe lines bellow is useless:\ndefault:\n            throw new HoodieNotSupportedException(\"Auto reset value must be one of 'earliest' or 'latest' \");", "url": "https://github.com/apache/hudi/pull/2227#discussion_r517075987", "createdAt": "2020-11-04T03:18:43Z", "author": {"login": "wangxianghu"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "diffHunk": "@@ -156,15 +160,18 @@ public static long totalNewMessages(OffsetRange[] ranges) {\n   private final HashMap<String, Object> kafkaParams;\n   private final TypedProperties props;\n   protected final String topicName;\n+  private final KafkaResetOffsetStrategies autoResetValue;\n \n   public KafkaOffsetGen(TypedProperties props) {\n     this.props = props;\n+\n     kafkaParams = new HashMap<>();\n     for (Object prop : props.keySet()) {\n       kafkaParams.put(prop.toString(), props.get(prop.toString()));\n     }\n     DataSourceUtils.checkRequiredProperties(props, Collections.singletonList(Config.KAFKA_TOPIC_NAME));\n     topicName = props.getString(Config.KAFKA_TOPIC_NAME);\n+    autoResetValue = KafkaResetOffsetStrategies.valueOf(props.getString(\"auto.offset.reset\", Config.DEFAULT_AUTO_RESET_OFFSET.toString()).toUpperCase());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07153c11e5650506c929d1875069b79696127b59"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQyODc5NQ==", "bodyText": "@liujinhui1994 any response?", "url": "https://github.com/apache/hudi/pull/2227#discussion_r571428795", "createdAt": "2021-02-06T12:18:00Z", "author": {"login": "yanghua"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "diffHunk": "@@ -156,15 +160,18 @@ public static long totalNewMessages(OffsetRange[] ranges) {\n   private final HashMap<String, Object> kafkaParams;\n   private final TypedProperties props;\n   protected final String topicName;\n+  private final KafkaResetOffsetStrategies autoResetValue;\n \n   public KafkaOffsetGen(TypedProperties props) {\n     this.props = props;\n+\n     kafkaParams = new HashMap<>();\n     for (Object prop : props.keySet()) {\n       kafkaParams.put(prop.toString(), props.get(prop.toString()));\n     }\n     DataSourceUtils.checkRequiredProperties(props, Collections.singletonList(Config.KAFKA_TOPIC_NAME));\n     topicName = props.getString(Config.KAFKA_TOPIC_NAME);\n+    autoResetValue = KafkaResetOffsetStrategies.valueOf(props.getString(\"auto.offset.reset\", Config.DEFAULT_AUTO_RESET_OFFSET.toString()).toUpperCase());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzA3NTk4Nw=="}, "originalCommit": {"oid": "07153c11e5650506c929d1875069b79696127b59"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzYwMTA4NDI2OnYy", "diffSide": "RIGHT", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNlQxMjoxNTo1MVrOIg9Jcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMFQwOTozMDoxMVrOIox04A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQyNzE4Ng==", "bodyText": "checkTopicCheckpoint  looks better\uff1f", "url": "https://github.com/apache/hudi/pull/2227#discussion_r571427186", "createdAt": "2021-02-06T12:15:51Z", "author": {"login": "yanghua"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "diffHunk": "@@ -257,6 +273,11 @@ public boolean checkTopicExists(KafkaConsumer consumer)  {\n     return result.containsKey(topicName);\n   }\n \n+  public boolean checkTopicCheckPoint(Option<String> lastCheckpointStr) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3fe5e042f31f5b76657eabbbb7bfc954b458843"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjAwMjI3Mg==", "bodyText": "may I know why this is public ?", "url": "https://github.com/apache/hudi/pull/2227#discussion_r572002272", "createdAt": "2021-02-08T12:18:36Z", "author": {"login": "nsivabalan"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "diffHunk": "@@ -257,6 +273,11 @@ public boolean checkTopicExists(KafkaConsumer consumer)  {\n     return result.containsKey(topicName);\n   }\n \n+  public boolean checkTopicCheckPoint(Option<String> lastCheckpointStr) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQyNzE4Ng=="}, "originalCommit": {"oid": "d3fe5e042f31f5b76657eabbbb7bfc954b458843"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTYzMDMwNA==", "bodyText": "thanks for pointing out", "url": "https://github.com/apache/hudi/pull/2227#discussion_r579630304", "createdAt": "2021-02-20T09:30:11Z", "author": {"login": "liujinhui1994"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "diffHunk": "@@ -257,6 +273,11 @@ public boolean checkTopicExists(KafkaConsumer consumer)  {\n     return result.containsKey(topicName);\n   }\n \n+  public boolean checkTopicCheckPoint(Option<String> lastCheckpointStr) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQyNzE4Ng=="}, "originalCommit": {"oid": "d3fe5e042f31f5b76657eabbbb7bfc954b458843"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzYwMTA5MjE3OnYy", "diffSide": "RIGHT", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNlQxMjoxNzozNFrOIg9Pbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNlQxMjoxNzozNFrOIg9Pbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTQyODcxOA==", "bodyText": "Please add some comments to describe the pattern? i.e. an example checkpoint string?", "url": "https://github.com/apache/hudi/pull/2227#discussion_r571428718", "createdAt": "2021-02-06T12:17:34Z", "author": {"login": "yanghua"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "diffHunk": "@@ -49,6 +51,8 @@\n \n   private static final Logger LOG = LogManager.getLogger(KafkaOffsetGen.class);\n \n+  private final Pattern pattern = Pattern.compile(\".*,.*:.*\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3fe5e042f31f5b76657eabbbb7bfc954b458843"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzYwNTMwMDYxOnYy", "diffSide": "RIGHT", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wOFQxMjoxOTozOVrOIhgSNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMFQwOToyOToxN1rOIox0Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjAwMjg3MA==", "bodyText": "is it intentional for NONE we will throw exception? also, may I know where is NONE(KafkaResetOffsetStrategies) used?", "url": "https://github.com/apache/hudi/pull/2227#discussion_r572002870", "createdAt": "2021-02-08T12:19:39Z", "author": {"login": "nsivabalan"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "diffHunk": "@@ -227,12 +232,23 @@ public KafkaOffsetGen(TypedProperties props) {\n   // else return earliest offsets\n   private Map<TopicPartition, Long> checkupValidOffsets(KafkaConsumer consumer,\n                                                         Option<String> lastCheckpointStr, Set<TopicPartition> topicPartitions) {\n-    Map<TopicPartition, Long> checkpointOffsets = CheckpointUtils.strToOffsets(lastCheckpointStr.get());\n     Map<TopicPartition, Long> earliestOffsets = consumer.beginningOffsets(topicPartitions);\n+    if (checkTopicCheckPoint(lastCheckpointStr)) {\n+      Map<TopicPartition, Long> checkpointOffsets = CheckpointUtils.strToOffsets(lastCheckpointStr.get());\n+      boolean checkpointOffsetReseter = checkpointOffsets.entrySet().stream()\n+              .anyMatch(offset -> offset.getValue() < earliestOffsets.get(offset.getKey()));\n+      return checkpointOffsetReseter ? earliestOffsets : checkpointOffsets;\n+    }\n+\n+    switch (autoResetValue) {\n+      case EARLIEST:\n+        return earliestOffsets;\n+      case LATEST:\n+        return consumer.endOffsets(topicPartitions);\n+      default:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3fe5e042f31f5b76657eabbbb7bfc954b458843"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTYzMDE1OA==", "bodyText": "I also don\u2019t think it\u2019s necessary to add NONE", "url": "https://github.com/apache/hudi/pull/2227#discussion_r579630158", "createdAt": "2021-02-20T09:29:17Z", "author": {"login": "liujinhui1994"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "diffHunk": "@@ -227,12 +232,23 @@ public KafkaOffsetGen(TypedProperties props) {\n   // else return earliest offsets\n   private Map<TopicPartition, Long> checkupValidOffsets(KafkaConsumer consumer,\n                                                         Option<String> lastCheckpointStr, Set<TopicPartition> topicPartitions) {\n-    Map<TopicPartition, Long> checkpointOffsets = CheckpointUtils.strToOffsets(lastCheckpointStr.get());\n     Map<TopicPartition, Long> earliestOffsets = consumer.beginningOffsets(topicPartitions);\n+    if (checkTopicCheckPoint(lastCheckpointStr)) {\n+      Map<TopicPartition, Long> checkpointOffsets = CheckpointUtils.strToOffsets(lastCheckpointStr.get());\n+      boolean checkpointOffsetReseter = checkpointOffsets.entrySet().stream()\n+              .anyMatch(offset -> offset.getValue() < earliestOffsets.get(offset.getKey()));\n+      return checkpointOffsetReseter ? earliestOffsets : checkpointOffsets;\n+    }\n+\n+    switch (autoResetValue) {\n+      case EARLIEST:\n+        return earliestOffsets;\n+      case LATEST:\n+        return consumer.endOffsets(topicPartitions);\n+      default:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjAwMjg3MA=="}, "originalCommit": {"oid": "d3fe5e042f31f5b76657eabbbb7bfc954b458843"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzY1NjA1MzQxOnYy", "diffSide": "RIGHT", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMFQxNzoyOToyNVrOIo1HuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yM1QwOToyNzowNlrOIp-Lcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTY4NDI4MA==", "bodyText": "lets add this to Config (in line 154 in this file)\nAlso, lets name this our usual way.\n\"hoodie.deltastreamer.source.kafka.auto.offset.reset\"", "url": "https://github.com/apache/hudi/pull/2227#discussion_r579684280", "createdAt": "2021-02-20T17:29:25Z", "author": {"login": "nsivabalan"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "diffHunk": "@@ -156,15 +163,18 @@ public static long totalNewMessages(OffsetRange[] ranges) {\n   private final HashMap<String, Object> kafkaParams;\n   private final TypedProperties props;\n   protected final String topicName;\n+  private final KafkaResetOffsetStrategies autoResetValue;\n \n   public KafkaOffsetGen(TypedProperties props) {\n     this.props = props;\n+\n     kafkaParams = new HashMap<>();\n     for (Object prop : props.keySet()) {\n       kafkaParams.put(prop.toString(), props.get(prop.toString()));\n     }\n     DataSourceUtils.checkRequiredProperties(props, Collections.singletonList(Config.KAFKA_TOPIC_NAME));\n     topicName = props.getString(Config.KAFKA_TOPIC_NAME);\n+    autoResetValue = KafkaResetOffsetStrategies.valueOf(props.getString(\"auto.offset.reset\", Config.DEFAULT_AUTO_RESET_OFFSET.toString()).toUpperCase());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43d4f7f639a19f389c4d7ca9725b963ada2c7e80"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDg4MTI2Ng==", "bodyText": "ok", "url": "https://github.com/apache/hudi/pull/2227#discussion_r580881266", "createdAt": "2021-02-23T09:27:06Z", "author": {"login": "liujinhui1994"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/KafkaOffsetGen.java", "diffHunk": "@@ -156,15 +163,18 @@ public static long totalNewMessages(OffsetRange[] ranges) {\n   private final HashMap<String, Object> kafkaParams;\n   private final TypedProperties props;\n   protected final String topicName;\n+  private final KafkaResetOffsetStrategies autoResetValue;\n \n   public KafkaOffsetGen(TypedProperties props) {\n     this.props = props;\n+\n     kafkaParams = new HashMap<>();\n     for (Object prop : props.keySet()) {\n       kafkaParams.put(prop.toString(), props.get(prop.toString()));\n     }\n     DataSourceUtils.checkRequiredProperties(props, Collections.singletonList(Config.KAFKA_TOPIC_NAME));\n     topicName = props.getString(Config.KAFKA_TOPIC_NAME);\n+    autoResetValue = KafkaResetOffsetStrategies.valueOf(props.getString(\"auto.offset.reset\", Config.DEFAULT_AUTO_RESET_OFFSET.toString()).toUpperCase());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTY4NDI4MA=="}, "originalCommit": {"oid": "43d4f7f639a19f389c4d7ca9725b963ada2c7e80"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4145, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}