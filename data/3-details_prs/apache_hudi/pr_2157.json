{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNTY5MzMx", "number": 2157, "title": "[HUDI-1330] handle prefix filtering at directory level", "bodyText": "Tips\n\nThank you very much for contributing to Apache Hudi.\nPlease review https://hudi.apache.org/contributing.html before opening a pull request.\n\nWhat is the purpose of the pull request\nThe current DFSPathSelector only ignore prefix(_, .) at the file level while files under intermediate directories\ne.g. (.checkpoint/*) are still considered which result in bad-format exception during reading.\nBrief change log\n\nhudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/DFSPathSelector.java\nhudi-utilities/src/test/java/org/apache/hudi/utilities/testutils/sources/AbstractDFSSourceTestBase.java\n\nVerify this pull request\n\nadditional tests under AbstractDFSSourceTestBase\n\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-10-09T12:52:25Z", "url": "https://github.com/apache/hudi/pull/2157", "merged": true, "mergeCommit": {"oid": "af5ef4d49d9c7eb610c446d8058216f39bb2fcfa"}, "closed": true, "closedAt": "2020-10-21T06:20:20Z", "author": {"login": "hotienvu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRQ6-rgFqTUwNjEyNDgyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUaWRpgBqjM4OTkzMzI0NDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MTI0ODI5", "url": "https://github.com/apache/hudi/pull/2157#pullrequestreview-506124829", "createdAt": "2020-10-10T20:36:51Z", "commit": {"oid": "14b56db5f68a078baa411fde61237b4fadc482b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQyMDozNjo1MVrOHfiTBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQyMDozNjo1MVrOHfiTBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyOTgzMA==", "bodyText": "let us add java docs here?", "url": "https://github.com/apache/hudi/pull/2157#discussion_r502829830", "createdAt": "2020-10-10T20:36:51Z", "author": {"login": "pratyakshsharma"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/DFSPathSelector.java", "diffHunk": "@@ -119,4 +103,18 @@ public DFSPathSelector(TypedProperties props, Configuration hadoopConf) {\n       throw new HoodieIOException(\"Unable to read from source from checkpoint: \" + lastCheckpointStr, ioe);\n     }\n   }\n+\n+  private List<FileStatus> listEligibleFiles(FileSystem fs, Path path, long lastCheckpointTime) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b56db5f68a078baa411fde61237b4fadc482b1"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MTM5NjY0", "url": "https://github.com/apache/hudi/pull/2157#pullrequestreview-507139664", "createdAt": "2020-10-13T07:26:34Z", "commit": {"oid": "83a2e3ee3c8e969d2f41407f3a6f8d256d960269"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNzoyNjozNVrOHgY3vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwNzoyNjozNVrOHgY3vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcyMzk2Ng==", "bodyText": "what's the advantage of walking recursively by ourselves, instead of calling fs.listStatus(,true) like before?  (in the interest of keeping PR minimal and changing just the prefix filtering)", "url": "https://github.com/apache/hudi/pull/2157#discussion_r503723966", "createdAt": "2020-10-13T07:26:35Z", "author": {"login": "vinothchandar"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/DFSPathSelector.java", "diffHunk": "@@ -119,4 +103,25 @@ public DFSPathSelector(TypedProperties props, Configuration hadoopConf) {\n       throw new HoodieIOException(\"Unable to read from source from checkpoint: \" + lastCheckpointStr, ioe);\n     }\n   }\n+\n+  /**\n+   * List files recursively, filter out illegible files/directories while doing so.\n+   */\n+  private List<FileStatus> listEligibleFiles(FileSystem fs, Path path, long lastCheckpointTime) throws IOException {\n+    // skip files/dirs whose names start with (_, ., etc)\n+    FileStatus[] statuses = fs.listStatus(path, file ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83a2e3ee3c8e969d2f41407f3a6f8d256d960269"}, "originalPosition": 80}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90cfa005dbab62279770ba10ec480200e47931ed", "author": {"user": {"login": "hotienvu", "name": "Ho Tien Vu"}}, "url": "https://github.com/apache/hudi/commit/90cfa005dbab62279770ba10ec480200e47931ed", "committedDate": "2020-10-15T11:49:56Z", "message": "Merge branch 'master' of https://github.com/apache/hudi into dfs-source-filter-dir"}, "afterCommit": {"oid": "68b3d65a4d8324c1f69a74b906cb2f538448f95c", "author": {"user": {"login": "hotienvu", "name": "Ho Tien Vu"}}, "url": "https://github.com/apache/hudi/commit/68b3d65a4d8324c1f69a74b906cb2f538448f95c", "committedDate": "2020-10-15T13:08:51Z", "message": "handle prefix filtering at directory level\n\nThe current DFSPathSelector only ignore prefix(_, .) at the file level while files under subdirectories\ne.g. (.checkpoint/*) are still considered which result in bad-format exception during reading."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68b3d65a4d8324c1f69a74b906cb2f538448f95c", "author": {"user": {"login": "hotienvu", "name": "Ho Tien Vu"}}, "url": "https://github.com/apache/hudi/commit/68b3d65a4d8324c1f69a74b906cb2f538448f95c", "committedDate": "2020-10-15T13:08:51Z", "message": "handle prefix filtering at directory level\n\nThe current DFSPathSelector only ignore prefix(_, .) at the file level while files under subdirectories\ne.g. (.checkpoint/*) are still considered which result in bad-format exception during reading."}, "afterCommit": {"oid": "c272a6c808a5fddd920175ea2692a17db9a0f168", "author": {"user": {"login": "hotienvu", "name": "Ho Tien Vu"}}, "url": "https://github.com/apache/hudi/commit/c272a6c808a5fddd920175ea2692a17db9a0f168", "committedDate": "2020-10-19T13:54:42Z", "message": "handle prefix filtering at directory level\n\nThe current DFSPathSelector only ignore prefix(_, .) at the file level while files under subdirectories\ne.g. (.checkpoint/*) are still considered which result in bad-format exception during reading."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "155366df398738e0f19ee978a0c355053cbd48c3", "author": {"user": {"login": "hotienvu", "name": "Ho Tien Vu"}}, "url": "https://github.com/apache/hudi/commit/155366df398738e0f19ee978a0c355053cbd48c3", "committedDate": "2020-10-20T15:16:44Z", "message": "[HUDI-1330] handle prefix filtering at directory level\n\nThe current DFSPathSelector only ignore prefix(_, .) at the file level while files under subdirectories\ne.g. (.checkpoint/*) are still considered which result in bad-format exception during reading."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c272a6c808a5fddd920175ea2692a17db9a0f168", "author": {"user": {"login": "hotienvu", "name": "Ho Tien Vu"}}, "url": "https://github.com/apache/hudi/commit/c272a6c808a5fddd920175ea2692a17db9a0f168", "committedDate": "2020-10-19T13:54:42Z", "message": "handle prefix filtering at directory level\n\nThe current DFSPathSelector only ignore prefix(_, .) at the file level while files under subdirectories\ne.g. (.checkpoint/*) are still considered which result in bad-format exception during reading."}, "afterCommit": {"oid": "155366df398738e0f19ee978a0c355053cbd48c3", "author": {"user": {"login": "hotienvu", "name": "Ho Tien Vu"}}, "url": "https://github.com/apache/hudi/commit/155366df398738e0f19ee978a0c355053cbd48c3", "committedDate": "2020-10-20T15:16:44Z", "message": "[HUDI-1330] handle prefix filtering at directory level\n\nThe current DFSPathSelector only ignore prefix(_, .) at the file level while files under subdirectories\ne.g. (.checkpoint/*) are still considered which result in bad-format exception during reading."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4665, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}