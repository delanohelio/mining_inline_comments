{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzODg3NDU5", "number": 1237, "reviewThreads": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMDoyNzo1NlrODY-EGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQxMzozMjo0N1rODca28A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NTA5Mjc1OnYy", "diffSide": "RIGHT", "path": "hudi-common/src/main/java/org/apache/hudi/avro/MercifulJsonConverter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMDoyNzo1NlrOFfIZ6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMDozMzo1NVrOFfIdvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE4Nzg4Mg==", "bodyText": "better to List<Object> listRes = new ArrayList<>(); ?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368187882", "createdAt": "2020-01-18T00:27:56Z", "author": {"login": "leesf"}, "path": "hudi-common/src/main/java/org/apache/hudi/avro/MercifulJsonConverter.java", "diffHunk": "@@ -286,7 +284,7 @@ private static JsonToAvroFieldProcessor generateArrayTypeHandler() {\n       public Pair<Boolean, Object> convert(Object value, String name, Schema schema)\n           throws HoodieJsonToAvroConversionException {\n         Schema elementSchema = schema.getElementType();\n-        List listRes = new ArrayList();\n+        List listRes = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE4ODg2MA==", "bodyText": "makes sense this is Jackson API", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368188860", "createdAt": "2020-01-18T00:33:55Z", "author": {"login": "smarthi"}, "path": "hudi-common/src/main/java/org/apache/hudi/avro/MercifulJsonConverter.java", "diffHunk": "@@ -286,7 +284,7 @@ private static JsonToAvroFieldProcessor generateArrayTypeHandler() {\n       public Pair<Boolean, Object> convert(Object value, String name, Schema schema)\n           throws HoodieJsonToAvroConversionException {\n         Schema elementSchema = schema.getElementType();\n-        List listRes = new ArrayList();\n+        List listRes = new ArrayList<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE4Nzg4Mg=="}, "originalCommit": null, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NTExNDY2OnYy", "diffSide": "RIGHT", "path": "hudi-common/src/main/java/org/apache/hudi/common/table/view/RocksDbBasedFileSystemView.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMDo1MDozNVrOFfIm4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMDo1MDozNVrOFfIm4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5MTIwMA==", "bodyText": "still keep this line uncommented?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368191200", "createdAt": "2020-01-18T00:50:35Z", "author": {"login": "leesf"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/view/RocksDbBasedFileSystemView.java", "diffHunk": "@@ -194,69 +193,66 @@ protected void storePartitionView(String partitionPath, List<HoodieFileGroup> fi\n    */\n   protected void applyDeltaFileSlicesToPartitionView(String partition, List<HoodieFileGroup> deltaFileGroups,\n       DeltaApplyMode mode) {\n-    rocksDB.writeBatch(batch -> {\n-      deltaFileGroups.stream().forEach(fg -> {\n-        fg.getAllRawFileSlices().map(fs -> {\n-          FileSlice oldSlice = getFileSlice(partition, fs.getFileId(), fs.getBaseInstantTime());\n-          if (null == oldSlice) {\n-            return fs;\n-          } else {\n-            // First remove the file-slice\n-            LOG.info(\"Removing old Slice in DB. FS=\" + oldSlice);\n-            rocksDB.deleteInBatch(batch, schemaHelper.getColFamilyForView(),\n-                schemaHelper.getKeyForSliceView(fg, oldSlice));\n-            rocksDB.deleteInBatch(batch, schemaHelper.getColFamilyForView(),\n-                schemaHelper.getKeyForDataFileView(fg, oldSlice));\n-\n-            Map<String, HoodieLogFile> logFiles = oldSlice.getLogFiles()\n-                .map(lf -> Pair.of(Path.getPathWithoutSchemeAndAuthority(lf.getPath()).toString(), lf))\n-                .collect(Collectors.toMap(Pair::getKey, Pair::getValue));\n-            Map<String, HoodieLogFile> deltaLogFiles =\n-                fs.getLogFiles().map(lf -> Pair.of(Path.getPathWithoutSchemeAndAuthority(lf.getPath()).toString(), lf))\n+    rocksDB.writeBatch(batch ->\n+        deltaFileGroups.forEach(fg ->\n+            fg.getAllRawFileSlices().map(fs -> {\n+              FileSlice oldSlice = getFileSlice(partition, fs.getFileId(), fs.getBaseInstantTime());\n+              if (null == oldSlice) {\n+                return fs;\n+              } else {\n+                // First remove the file-slice\n+                // LOG.info(\"Removing old Slice in DB. FS=\" + oldSlice);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 131}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NTExODA4OnYy", "diffSide": "RIGHT", "path": "hudi-common/src/main/java/org/apache/hudi/common/util/FSUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMDo1NDo0OVrOFfIo8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMDo1NDo0OVrOFfIo8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5MTcyOA==", "bodyText": "ditto, any concerns?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368191728", "createdAt": "2020-01-18T00:54:49Z", "author": {"login": "leesf"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/util/FSUtils.java", "diffHunk": "@@ -198,7 +193,7 @@ public static String getRelativePartitionPath(Path basePath, Path partitionPath)\n     return partitions;\n   }\n \n-  public static final List<String> getAllDataFilesForMarkers(FileSystem fs, String basePath, String instantTs,\n+  public static List<String> getAllDataFilesForMarkers(FileSystem fs, String basePath, String instantTs,", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NTE0OTYxOnYy", "diffSide": "RIGHT", "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/HoodieHiveUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMTozMTo0OVrOFfI6tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMjo0ODo1MFrOFfJNww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5NjI3Nw==", "bodyText": "would it return null? we need avoid return null.", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368196277", "createdAt": "2020-01-18T01:31:49Z", "author": {"login": "leesf"}, "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/HoodieHiveUtil.java", "diffHunk": "@@ -71,18 +71,13 @@ public static Path getNthParent(Path path, int n) {\n   public static List<String> getIncrementalTableNames(JobContext job) {\n     Map<String, String> tablesModeMap = job.getConfiguration()\n         .getValByRegex(HOODIE_CONSUME_MODE_PATTERN_STRING.pattern());\n-    List<String> result = tablesModeMap.entrySet().stream().map(s -> {\n+    return tablesModeMap.entrySet().stream().map(s -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIwMTE1NQ==", "bodyText": "good catch - fixed it", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368201155", "createdAt": "2020-01-18T02:48:50Z", "author": {"login": "smarthi"}, "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/HoodieHiveUtil.java", "diffHunk": "@@ -71,18 +71,13 @@ public static Path getNthParent(Path path, int n) {\n   public static List<String> getIncrementalTableNames(JobContext job) {\n     Map<String, String> tablesModeMap = job.getConfiguration()\n         .getValByRegex(HOODIE_CONSUME_MODE_PATTERN_STRING.pattern());\n-    List<String> result = tablesModeMap.entrySet().stream().map(s -> {\n+    return tablesModeMap.entrySet().stream().map(s -> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5NjI3Nw=="}, "originalCommit": null, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NTE1MDE4OnYy", "diffSide": "RIGHT", "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/HoodieParquetInputFormat.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMTozMzowMlrOFfI7Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMjo0NDoxMVrOFfJM4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5NjM2Nw==", "bodyText": "skip null result?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368196367", "createdAt": "2020-01-18T01:33:02Z", "author": {"login": "leesf"}, "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/HoodieParquetInputFormat.java", "diffHunk": "@@ -108,9 +107,7 @@\n       LOG.info(\"Found a total of \" + groupedFileStatus.size() + \" groups\");\n       for (Map.Entry<HoodieTableMetaClient, List<FileStatus>> entry : groupedFileStatus.entrySet()) {\n         List<FileStatus> result = filterFileStatusForSnapshotMode(entry.getKey(), entry.getValue());\n-        if (result != null) {\n-          returns.addAll(result);\n-        }\n+        returns.addAll(result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIwMDkyOQ==", "bodyText": "fixed", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368200929", "createdAt": "2020-01-18T02:44:11Z", "author": {"login": "smarthi"}, "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/HoodieParquetInputFormat.java", "diffHunk": "@@ -108,9 +107,7 @@\n       LOG.info(\"Found a total of \" + groupedFileStatus.size() + \" groups\");\n       for (Map.Entry<HoodieTableMetaClient, List<FileStatus>> entry : groupedFileStatus.entrySet()) {\n         List<FileStatus> result = filterFileStatusForSnapshotMode(entry.getKey(), entry.getValue());\n-        if (result != null) {\n-          returns.addAll(result);\n-        }\n+        returns.addAll(result);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5NjM2Nw=="}, "originalCommit": null, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NTE1MDk5OnYy", "diffSide": "LEFT", "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/HoodieParquetInputFormat.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMTozNDoyMFrOFfI7eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwMjo0Mzo1N1rOFfJM1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5NjQ3Mw==", "bodyText": "incrementalInputPaths won't be null?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368196473", "createdAt": "2020-01-18T01:34:20Z", "author": {"login": "leesf"}, "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/HoodieParquetInputFormat.java", "diffHunk": "@@ -171,15 +167,15 @@\n           return false;\n         })\n         .collect(Collectors.joining(\",\"));\n-    if (incrementalInputPaths == null || incrementalInputPaths.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIwMDkxOQ==", "bodyText": "good catch- fixed it", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368200919", "createdAt": "2020-01-18T02:43:57Z", "author": {"login": "smarthi"}, "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/HoodieParquetInputFormat.java", "diffHunk": "@@ -171,15 +167,15 @@\n           return false;\n         })\n         .collect(Collectors.joining(\",\"));\n-    if (incrementalInputPaths == null || incrementalInputPaths.isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE5NjQ3Mw=="}, "originalCommit": null, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NTI1ODU4OnYy", "diffSide": "LEFT", "path": "hudi-common/src/test/java/org/apache/hudi/common/util/TestFSUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwNjo0MToxMlrOFfJycQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xOFQwNjo0OToyN1rOFfJzzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMDU0NQ==", "bodyText": "Based on other test code style, we can let the @Test annotation close to the method so that we can keep /** here. WDYT?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368210545", "createdAt": "2020-01-18T06:41:12Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/util/TestFSUtils.java", "diffHunk": "@@ -74,7 +74,7 @@ public void testMaskFileName() {\n   }\n \n   @Test\n-  /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMDg5Mg==", "bodyText": "ok", "url": "https://github.com/apache/hudi/pull/1237#discussion_r368210892", "createdAt": "2020-01-18T06:49:27Z", "author": {"login": "smarthi"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/util/TestFSUtils.java", "diffHunk": "@@ -74,7 +74,7 @@ public void testMaskFileName() {\n   }\n \n   @Test\n-  /**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIxMDU0NQ=="}, "originalCommit": null, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTEyOTM2OnYy", "diffSide": "RIGHT", "path": "hudi-common/src/main/java/org/apache/hudi/common/bloom/filter/InternalDynamicBloomFilter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwNjo0Mzo1MlrOFkcp9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwNjo0Mzo1MlrOFkcp9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2MjU0OQ==", "bodyText": "So org.apache.hadoop.util.bloom.BloomFilter could be also changed to BloomFilter?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373762549", "createdAt": "2020-02-01T06:43:52Z", "author": {"login": "leesf"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/bloom/filter/InternalDynamicBloomFilter.java", "diffHunk": "@@ -217,12 +214,8 @@ public void readFields(DataInput in) throws IOException {\n    * Adds a new row to <i>this</i> dynamic Bloom filter.\n    */\n   private void addRow() {\n-    org.apache.hadoop.util.bloom.BloomFilter[] tmp = new org.apache.hadoop.util.bloom.BloomFilter[matrix.length + 1];\n-\n-    for (int i = 0; i < matrix.length; i++) {\n-      tmp[i] = matrix[i];\n-    }\n-\n+    BloomFilter[] tmp = new BloomFilter[matrix.length + 1];\n+    System.arraycopy(matrix, 0, tmp, 0, matrix.length);\n     tmp[tmp.length - 1] = new org.apache.hadoop.util.bloom.BloomFilter(vectorSize, nbHash, hashType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTEzMDUyOnYy", "diffSide": "RIGHT", "path": "hudi-common/src/main/java/org/apache/hudi/common/table/timeline/HoodieInstant.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwNjo0NzowMlrOFkcqhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwNzozODozN1rOFkcx1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2MjY5NQ==", "bodyText": "keep the final  as is ?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373762695", "createdAt": "2020-02-01T06:47:02Z", "author": {"login": "leesf"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/timeline/HoodieInstant.java", "diffHunk": "@@ -45,13 +45,13 @@\n       .put(HoodieTimeline.COMPACTION_ACTION, HoodieTimeline.COMMIT_ACTION).build();\n \n   public static final Comparator<HoodieInstant> ACTION_COMPARATOR =\n-      Comparator.<HoodieInstant, String>comparing(instant -> getComparableAction(instant.getAction()));\n+      Comparator.comparing(instant -> getComparableAction(instant.getAction()));\n \n   public static final Comparator<HoodieInstant> COMPARATOR = Comparator.comparing(HoodieInstant::getTimestamp)\n       .thenComparing(ACTION_COMPARATOR).thenComparing(HoodieInstant::getState);\n \n-  public static final String getComparableAction(String action) {\n-    return COMPARABLE_ACTIONS.containsKey(action) ? COMPARABLE_ACTIONS.get(action) : action;\n+  public static String getComparableAction(String action) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NDU2NQ==", "bodyText": "its redundant for static methods since they can't be overriden anyways, right?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373764565", "createdAt": "2020-02-01T07:38:37Z", "author": {"login": "smarthi"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/table/timeline/HoodieInstant.java", "diffHunk": "@@ -45,13 +45,13 @@\n       .put(HoodieTimeline.COMPACTION_ACTION, HoodieTimeline.COMMIT_ACTION).build();\n \n   public static final Comparator<HoodieInstant> ACTION_COMPARATOR =\n-      Comparator.<HoodieInstant, String>comparing(instant -> getComparableAction(instant.getAction()));\n+      Comparator.comparing(instant -> getComparableAction(instant.getAction()));\n \n   public static final Comparator<HoodieInstant> COMPARATOR = Comparator.comparing(HoodieInstant::getTimestamp)\n       .thenComparing(ACTION_COMPARATOR).thenComparing(HoodieInstant::getState);\n \n-  public static final String getComparableAction(String action) {\n-    return COMPARABLE_ACTIONS.containsKey(action) ? COMPARABLE_ACTIONS.get(action) : action;\n+  public static String getComparableAction(String action) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2MjY5NQ=="}, "originalCommit": null, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTEzMjE0OnYy", "diffSide": "RIGHT", "path": "hudi-common/src/main/java/org/apache/hudi/common/util/BufferedRandomAccessFile.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwNjo1MjozMFrOFkcrXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwNjo1MjozMFrOFkcrXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2MjkwOA==", "bodyText": "good catch", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373762908", "createdAt": "2020-02-01T06:52:30Z", "author": {"login": "leesf"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/util/BufferedRandomAccessFile.java", "diffHunk": "@@ -1,4 +1,4 @@\n-/**\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTE0NTQ4OnYy", "diffSide": "LEFT", "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/hive/HoodieCombineHiveInputFormat.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwNzozOToxOFrOFkcx7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwNzozOToxOFrOFkcx7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NDU4OA==", "bodyText": "good catch, combine == null is always false.", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373764588", "createdAt": "2020-02-01T07:39:18Z", "author": {"login": "leesf"}, "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/hive/HoodieCombineHiveInputFormat.java", "diffHunk": "@@ -356,25 +357,21 @@ public int hashCode() {\n     HoodieCombineHiveInputFormat.HoodieCombineFileInputFormatShim combine =\n         new HoodieCombineHiveInputFormat.HoodieCombineFileInputFormatShim();\n \n-    InputSplit[] splits = null;\n-    if (combine == null) {\n-      splits = super.getSplits(job, numSplits);\n-      return splits;\n-    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTE0OTc1OnYy", "diffSide": "RIGHT", "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/realtime/HoodieParquetRealtimeInputFormat.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwNzo1NDowNFrOFkc0Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwNzo1NDowNFrOFkc0Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NTE2Nw==", "bodyText": "readColNames is not null. so !readColNames.contains(fieldName) is okay.", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373765167", "createdAt": "2020-02-01T07:54:04Z", "author": {"login": "leesf"}, "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/realtime/HoodieParquetRealtimeInputFormat.java", "diffHunk": "@@ -175,7 +176,7 @@ private static Configuration addProjectionField(Configuration conf, String field\n       readColIdsPrefix = \"\";\n     }\n \n-    if (!readColNames.contains(fieldName)) {\n+    if (!Objects.requireNonNull(readColNames).contains(fieldName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTI1NjYzOnYy", "diffSide": "RIGHT", "path": "hudi-common/src/main/java/org/apache/hudi/common/versioning/compaction/CompactionV1MigrationHandler.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQxMjo1ODoyNlrOFkdpYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQxNToyMDo1MFrOFkeCYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc3ODc4NQ==", "bodyText": "If we let builder's each setXXX method one line, the readability would be better. WDYT?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373778785", "createdAt": "2020-02-01T12:58:26Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/versioning/compaction/CompactionV1MigrationHandler.java", "diffHunk": "@@ -59,14 +59,12 @@ public HoodieCompactionPlan downgradeFrom(HoodieCompactionPlan input) {\n     final Path basePath = new Path(metaClient.getBasePath());\n     List<HoodieCompactionOperation> v1CompactionOperationList = new ArrayList<>();\n     if (null != input.getOperations()) {\n-      v1CompactionOperationList = input.getOperations().stream().map(inp -> {\n-        return HoodieCompactionOperation.newBuilder().setBaseInstantTime(inp.getBaseInstantTime())\n-            .setFileId(inp.getFileId()).setPartitionPath(inp.getPartitionPath()).setMetrics(inp.getMetrics())\n-            .setDataFilePath(convertToV1Path(basePath, inp.getPartitionPath(), inp.getDataFilePath()))\n-            .setDeltaFilePaths(inp.getDeltaFilePaths().stream()\n-                .map(s -> convertToV1Path(basePath, inp.getPartitionPath(), s)).collect(Collectors.toList()))\n-            .build();\n-      }).collect(Collectors.toList());\n+      v1CompactionOperationList = input.getOperations().stream().map(inp -> HoodieCompactionOperation.newBuilder().setBaseInstantTime(inp.getBaseInstantTime())\n+          .setFileId(inp.getFileId()).setPartitionPath(inp.getPartitionPath()).setMetrics(inp.getMetrics())", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4MTc3NA==", "bodyText": "agreed", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373781774", "createdAt": "2020-02-01T14:07:27Z", "author": {"login": "smarthi"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/versioning/compaction/CompactionV1MigrationHandler.java", "diffHunk": "@@ -59,14 +59,12 @@ public HoodieCompactionPlan downgradeFrom(HoodieCompactionPlan input) {\n     final Path basePath = new Path(metaClient.getBasePath());\n     List<HoodieCompactionOperation> v1CompactionOperationList = new ArrayList<>();\n     if (null != input.getOperations()) {\n-      v1CompactionOperationList = input.getOperations().stream().map(inp -> {\n-        return HoodieCompactionOperation.newBuilder().setBaseInstantTime(inp.getBaseInstantTime())\n-            .setFileId(inp.getFileId()).setPartitionPath(inp.getPartitionPath()).setMetrics(inp.getMetrics())\n-            .setDataFilePath(convertToV1Path(basePath, inp.getPartitionPath(), inp.getDataFilePath()))\n-            .setDeltaFilePaths(inp.getDeltaFilePaths().stream()\n-                .map(s -> convertToV1Path(basePath, inp.getPartitionPath(), s)).collect(Collectors.toList()))\n-            .build();\n-      }).collect(Collectors.toList());\n+      v1CompactionOperationList = input.getOperations().stream().map(inp -> HoodieCompactionOperation.newBuilder().setBaseInstantTime(inp.getBaseInstantTime())\n+          .setFileId(inp.getFileId()).setPartitionPath(inp.getPartitionPath()).setMetrics(inp.getMetrics())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc3ODc4NQ=="}, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4NDY4Mg==", "bodyText": "Did you revert all the changes of CompactionV1MigrationHandler?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373784682", "createdAt": "2020-02-01T15:09:47Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/versioning/compaction/CompactionV1MigrationHandler.java", "diffHunk": "@@ -59,14 +59,12 @@ public HoodieCompactionPlan downgradeFrom(HoodieCompactionPlan input) {\n     final Path basePath = new Path(metaClient.getBasePath());\n     List<HoodieCompactionOperation> v1CompactionOperationList = new ArrayList<>();\n     if (null != input.getOperations()) {\n-      v1CompactionOperationList = input.getOperations().stream().map(inp -> {\n-        return HoodieCompactionOperation.newBuilder().setBaseInstantTime(inp.getBaseInstantTime())\n-            .setFileId(inp.getFileId()).setPartitionPath(inp.getPartitionPath()).setMetrics(inp.getMetrics())\n-            .setDataFilePath(convertToV1Path(basePath, inp.getPartitionPath(), inp.getDataFilePath()))\n-            .setDeltaFilePaths(inp.getDeltaFilePaths().stream()\n-                .map(s -> convertToV1Path(basePath, inp.getPartitionPath(), s)).collect(Collectors.toList()))\n-            .build();\n-      }).collect(Collectors.toList());\n+      v1CompactionOperationList = input.getOperations().stream().map(inp -> HoodieCompactionOperation.newBuilder().setBaseInstantTime(inp.getBaseInstantTime())\n+          .setFileId(inp.getFileId()).setPartitionPath(inp.getPartitionPath()).setMetrics(inp.getMetrics())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc3ODc4NQ=="}, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4NTA4MQ==", "bodyText": "yes - too tired and busy now - and u have a point about code readability.", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373785081", "createdAt": "2020-02-01T15:18:11Z", "author": {"login": "smarthi"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/versioning/compaction/CompactionV1MigrationHandler.java", "diffHunk": "@@ -59,14 +59,12 @@ public HoodieCompactionPlan downgradeFrom(HoodieCompactionPlan input) {\n     final Path basePath = new Path(metaClient.getBasePath());\n     List<HoodieCompactionOperation> v1CompactionOperationList = new ArrayList<>();\n     if (null != input.getOperations()) {\n-      v1CompactionOperationList = input.getOperations().stream().map(inp -> {\n-        return HoodieCompactionOperation.newBuilder().setBaseInstantTime(inp.getBaseInstantTime())\n-            .setFileId(inp.getFileId()).setPartitionPath(inp.getPartitionPath()).setMetrics(inp.getMetrics())\n-            .setDataFilePath(convertToV1Path(basePath, inp.getPartitionPath(), inp.getDataFilePath()))\n-            .setDeltaFilePaths(inp.getDeltaFilePaths().stream()\n-                .map(s -> convertToV1Path(basePath, inp.getPartitionPath(), s)).collect(Collectors.toList()))\n-            .build();\n-      }).collect(Collectors.toList());\n+      v1CompactionOperationList = input.getOperations().stream().map(inp -> HoodieCompactionOperation.newBuilder().setBaseInstantTime(inp.getBaseInstantTime())\n+          .setFileId(inp.getFileId()).setPartitionPath(inp.getPartitionPath()).setMetrics(inp.getMetrics())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc3ODc4NQ=="}, "originalCommit": null, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4NTE4NQ==", "bodyText": "OK, just make sure. It does not matter.", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373785185", "createdAt": "2020-02-01T15:20:50Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/main/java/org/apache/hudi/common/versioning/compaction/CompactionV1MigrationHandler.java", "diffHunk": "@@ -59,14 +59,12 @@ public HoodieCompactionPlan downgradeFrom(HoodieCompactionPlan input) {\n     final Path basePath = new Path(metaClient.getBasePath());\n     List<HoodieCompactionOperation> v1CompactionOperationList = new ArrayList<>();\n     if (null != input.getOperations()) {\n-      v1CompactionOperationList = input.getOperations().stream().map(inp -> {\n-        return HoodieCompactionOperation.newBuilder().setBaseInstantTime(inp.getBaseInstantTime())\n-            .setFileId(inp.getFileId()).setPartitionPath(inp.getPartitionPath()).setMetrics(inp.getMetrics())\n-            .setDataFilePath(convertToV1Path(basePath, inp.getPartitionPath(), inp.getDataFilePath()))\n-            .setDeltaFilePaths(inp.getDeltaFilePaths().stream()\n-                .map(s -> convertToV1Path(basePath, inp.getPartitionPath(), s)).collect(Collectors.toList()))\n-            .build();\n-      }).collect(Collectors.toList());\n+      v1CompactionOperationList = input.getOperations().stream().map(inp -> HoodieCompactionOperation.newBuilder().setBaseInstantTime(inp.getBaseInstantTime())\n+          .setFileId(inp.getFileId()).setPartitionPath(inp.getPartitionPath()).setMetrics(inp.getMetrics())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc3ODc4NQ=="}, "originalCommit": null, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTI1ODk5OnYy", "diffSide": "LEFT", "path": "hudi-common/src/test/java/org/apache/hudi/common/table/log/TestHoodieLogFormat.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQxMzowNjoxNVrOFkdqjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQxMzowNjoxNVrOFkdqjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc3OTA4Ng==", "bodyText": "Would you mind to explain why we should to remove this assertion?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373779086", "createdAt": "2020-02-01T13:06:15Z", "author": {"login": "yanghua"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/table/log/TestHoodieLogFormat.java", "diffHunk": "@@ -414,7 +414,6 @@ public void testBasicAppendAndRead() throws IOException, URISyntaxException, Int\n         dataBlockRead.getRecords().size());\n     assertEquals(\"Both records lists should be the same. (ordering guaranteed)\", copyOfRecords1,\n         dataBlockRead.getRecords());\n-    assertEquals(dataBlockRead.getSchema(), getSimpleSchema());", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTI2NzY4OnYy", "diffSide": "RIGHT", "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/hive/HoodieCombineHiveInputFormat.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQxMzozMjo0N1rOFkdusQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQxMzozMjo0N1rOFkdusQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4MDE0NQ==", "bodyText": "We can also use List<InputSplit> result = new ArrayList<>(); to follow the same code style in this file. WDYT?", "url": "https://github.com/apache/hudi/pull/1237#discussion_r373780145", "createdAt": "2020-02-01T13:32:47Z", "author": {"login": "yanghua"}, "path": "hudi-hadoop-mr/src/main/java/org/apache/hudi/hadoop/hive/HoodieCombineHiveInputFormat.java", "diffHunk": "@@ -522,12 +519,12 @@ public int hashCode() {\n     perfLogger.PerfLogBegin(CLASS_NAME, PerfLogger.GET_SPLITS);\n     init(job);\n \n-    ArrayList<InputSplit> result = new ArrayList<InputSplit>();\n+    ArrayList<InputSplit> result = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 106}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4972, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}