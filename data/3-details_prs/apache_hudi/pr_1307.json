{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMTM5NjIx", "number": 1307, "title": "[HUDI-570] Improve test coverage for FSUtils.java", "bodyText": "What is the purpose of the pull request\nIncrease the test coverage for FSUtils.java under hudi-common.\nBrief change log\nAdded test cases to increase coverage.\nVerify this pull request\nThis change added tests and can be verified as follows:\n\ntestDeleteOlderRollbackFiles\ntestDeleteOlderCleanMetaFiles\ntestFileNameRelatedFunctions\n\nCommitter checklist\n\n\n[x ] Has a corresponding JIRA in PR title & commit\n\n\n[x ] Commit message is descriptive of the change\n\n\n[x ] CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-02-05T01:24:55Z", "url": "https://github.com/apache/hudi/pull/1307", "merged": true, "mergeCommit": {"oid": "1fb0b001a38ddc940995e45f5cd53701d0110c3b"}, "closed": true, "closedAt": "2020-02-05T22:25:25Z", "author": {"login": "nbalajee"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBNPmsgFqTM1MzQ0MjE0NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBdssKAFqTM1NDA3OTc0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDQyMTQ1", "url": "https://github.com/apache/hudi/pull/1307#pullrequestreview-353442145", "createdAt": "2020-02-05T03:05:49Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwMzowNTo0OVrOFlqiAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwMzowNTo0OVrOFlqiAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAzODQ2Nw==", "bodyText": "We shouldn't have counter variables as members of a test class, each test might mutate it and eventually break other tests", "url": "https://github.com/apache/hudi/pull/1307#discussion_r375038467", "createdAt": "2020-02-05T03:05:49Z", "author": {"login": "n3nash"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/util/TestFSUtils.java", "diffHunk": "@@ -43,11 +49,33 @@\n import java.util.stream.Stream;\n \n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n \n /**\n  * Tests file system utils.\n  */\n public class TestFSUtils extends HoodieCommonTestHarness {\n+  private long minRollbackToKeep = 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDQyNzYz", "url": "https://github.com/apache/hudi/pull/1307#pullrequestreview-353442763", "createdAt": "2020-02-05T03:08:30Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwMzowODozMFrOFlqkBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwMzowODozMFrOFlqkBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAzODk4MA==", "bodyText": "You don't need this init, the HoodieTestHarness actually creates a DFS based file system which works for log records and should not run into the exception for which you might be creating the local file system", "url": "https://github.com/apache/hudi/pull/1307#discussion_r375038980", "createdAt": "2020-02-05T03:08:30Z", "author": {"login": "n3nash"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/util/TestFSUtils.java", "diffHunk": "@@ -43,11 +49,33 @@\n import java.util.stream.Stream;\n \n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n \n /**\n  * Tests file system utils.\n  */\n public class TestFSUtils extends HoodieCommonTestHarness {\n+  private long minRollbackToKeep = 10;\n+  private long minCleanToKeep = 10;\n+  protected transient FileSystem fs;\n+  protected String basePath = null;\n+\n+  @Before", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDQyOTE2", "url": "https://github.com/apache/hudi/pull/1307#pullrequestreview-353442916", "createdAt": "2020-02-05T03:09:13Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwMzowOToxM1rOFlqkjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwMzowOToxM1rOFlqkjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAzOTExNw==", "bodyText": "Once you use the basePath from the DFS started by the TestHarness and create files underneath, when the test dies, it will automatically clean those files. You shouldn't need to clean it here", "url": "https://github.com/apache/hudi/pull/1307#discussion_r375039117", "createdAt": "2020-02-05T03:09:13Z", "author": {"login": "n3nash"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/util/TestFSUtils.java", "diffHunk": "@@ -261,4 +289,87 @@ public void testLogFilesComparison() {\n   public static String makeOldLogFileName(String fileId, String logFileExtension, String baseCommitTime, int version) {\n     return \".\" + String.format(\"%s_%s%s.%d\", fileId, baseCommitTime, logFileExtension, version);\n   }\n+\n+  private void cleanupFiles(File[] cleanupFiles) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 98}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDQyOTU4", "url": "https://github.com/apache/hudi/pull/1307#pullrequestreview-353442958", "createdAt": "2020-02-05T03:09:26Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4361654eb252cbf96f6b7236462846e03749c44d", "author": {"user": {"login": "nbalajee", "name": "Balajee Nagasubramaniam"}}, "url": "https://github.com/apache/hudi/commit/4361654eb252cbf96f6b7236462846e03749c44d", "committedDate": "2020-02-05T21:27:59Z", "message": "[HUDI-570] - Improve test coverage for FSUtils.java"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "4361654eb252cbf96f6b7236462846e03749c44d", "author": {"user": {"login": "nbalajee", "name": "Balajee Nagasubramaniam"}}, "url": "https://github.com/apache/hudi/commit/4361654eb252cbf96f6b7236462846e03749c44d", "committedDate": "2020-02-05T21:27:59Z", "message": "[HUDI-570] - Improve test coverage for FSUtils.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MDc5NzQ2", "url": "https://github.com/apache/hudi/pull/1307#pullrequestreview-354079746", "createdAt": "2020-02-05T22:16:04Z", "commit": {"oid": "4361654eb252cbf96f6b7236462846e03749c44d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4204, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}