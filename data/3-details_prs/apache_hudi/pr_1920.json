{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMzIxOTY1", "number": 1920, "title": "[HUDI-1150] Fix unable to parse input partition field :1 exception when using TimestampBasedKeyGenerator", "bodyText": "\u2026n using TimestampBasedKeyGenerator\nTips\n\nThank you very much for contributing to Apache Hudi.\nPlease review https://hudi.apache.org/contributing.html before opening a pull request.\n\nWhat is the purpose of the pull request\n*Fix unable to parse input partition field :1 exception when using TimestampBasedKeyGenerator *\nBrief change log\nscene to reproduce\uff1a\n1. use TimestampBasedKeyGenerator\n2. set hoodie.deltastreamer.keygen.timebased.timestamp.type = DATE_STRING\n3. partitionpath field value is null\nwhen partitionpath field value is null TimestampBasedKeyGenerator will set it to1L, which can not be parsed correctly.\nUser class threw exception: java.util.concurrent.ExecutionException: org.apache.hudi.exception.HoodieException: Job aborted due to stage failure: Task 0 in stage 1.0 failed 4 times, most recent failure: Lost task 0.3 in stage 1.0 (TID 4, prod-t3-data-lake-007, executor 6): org.apache.hudi.exception.HoodieDeltaStreamerException: Unable to parse input partition field :1\nat org.apache.hudi.keygen.TimestampBasedKeyGenerator.getPartitionPath(TimestampBasedKeyGenerator.java:156)\nat org.apache.hudi.keygen.CustomKeyGenerator.getPartitionPath(CustomKeyGenerator.java:108)\nat org.apache.hudi.keygen.CustomKeyGenerator.getKey(CustomKeyGenerator.java:78)\nat org.apache.hudi.utilities.deltastreamer.DeltaSync.lambda$readFromSource$9fce03f0$1(DeltaSync.java:343)\nat org.apache.spark.api.java.JavaPairRDD$$anonfun$toScalaFunction$1.apply(JavaPairRDD.scala:1040)\nat scala.collection.Iterator$$anon$11.next(Iterator.scala:410)\nat scala.collection.Iterator$$anon$10.next(Iterator.scala:394)\nat scala.collection.Iterator$class.foreach(Iterator.scala:891)\nat scala.collection.AbstractIterator.foreach(Iterator.scala:1334)\nat scala.collection.generic.Growable$class.$plus$plus$eq(Growable.scala:59)\nat scala.collection.mutable.ArrayBuffer.$plus$plus$eq(ArrayBuffer.scala:104)\nat scala.collection.mutable.ArrayBuffer.$plus$plus$eq(ArrayBuffer.scala:48)\nat scala.collection.TraversableOnce$class.to(TraversableOnce.scala:310)\nat scala.collection.AbstractIterator.to(Iterator.scala:1334)\nat scala.collection.TraversableOnce$class.toBuffer(TraversableOnce.scala:302)\nat scala.collection.AbstractIterator.toBuffer(Iterator.scala:1334)\nat scala.collection.TraversableOnce$class.toArray(TraversableOnce.scala:289)\nat scala.collection.AbstractIterator.toArray(Iterator.scala:1334)\nat org.apache.spark.rdd.RDD$$anonfun$take$1$$anonfun$29.apply(RDD.scala:1364)\nat org.apache.spark.rdd.RDD$$anonfun$take$1$$anonfun$29.apply(RDD.scala:1364)\nat org.apache.spark.SparkContext$$anonfun$runJob$5.apply(SparkContext.scala:2121)\nat org.apache.spark.SparkContext$$anonfun$runJob$5.apply(SparkContext.scala:2121)\nat org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)\nat org.apache.spark.scheduler.Task.run(Task.scala:121)\nat org.apache.spark.executor.Executor$TaskRunner$$anonfun$11.apply(Executor.scala:407)\nat org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1408)\nat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:413)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\nat java.lang.Thread.run(Thread.java:748)\nCaused by: java.lang.RuntimeException: hoodie.deltastreamer.keygen.timebased.timestamp.scalar.time.unit is not specified but scalar it supplied as time value\nat org.apache.hudi.keygen.TimestampBasedKeyGenerator.convertLongTimeToMillis(TimestampBasedKeyGenerator.java:163)\nat org.apache.hudi.keygen.TimestampBasedKeyGenerator.getPartitionPath(TimestampBasedKeyGenerator.java:138)\n... 29 more\nVerify this pull request\nThis pull request is already covered by org.apache.hudi.keygen.TestTimestampBasedKeyGenerator#testTimestampBasedKeyGenerator*.\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-08-05T11:26:08Z", "url": "https://github.com/apache/hudi/pull/1920", "merged": true, "mergeCommit": {"oid": "35b21855da209c812e006c1afff3d940d5ac2a18"}, "closed": true, "closedAt": "2020-08-23T11:56:51Z", "author": {"login": "wangxianghu"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc75qkdABqjM2MjQyNzE0MjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBssT_gFqTQ3MzAwNTA3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a2ff28d86c48eeb65740665e3828c72d6d3caa29", "author": {"user": null}, "url": "https://github.com/apache/hudi/commit/a2ff28d86c48eeb65740665e3828c72d6d3caa29", "committedDate": "2020-08-05T10:04:51Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when using TimestampBasedKeyGenerator"}, "afterCommit": {"oid": "4a5ed78923d660801ecf23cb71acdfcd1cb30969", "author": {"user": null}, "url": "https://github.com/apache/hudi/commit/4a5ed78923d660801ecf23cb71acdfcd1cb30969", "committedDate": "2020-08-05T11:38:06Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when using TimestampBasedKeyGenerator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNzEyMjk0", "url": "https://github.com/apache/hudi/pull/1920#pullrequestreview-461712294", "createdAt": "2020-08-05T14:20:33Z", "commit": {"oid": "4a5ed78923d660801ecf23cb71acdfcd1cb30969"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoyMDozNFrOG8L5XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoyMDozNFrOG8L5XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc2MjY1Mg==", "bodyText": "can we make this package-private?", "url": "https://github.com/apache/hudi/pull/1920#discussion_r465762652", "createdAt": "2020-08-05T14:20:34Z", "author": {"login": "pratyakshsharma"}, "path": "hudi-spark/src/main/java/org/apache/hudi/keygen/parser/HoodieDateTimeParserImpl.java", "diffHunk": "@@ -58,7 +58,7 @@ public HoodieDateTimeParserImpl(TypedProperties config) {\n     }\n   }\n \n-  private String getConfigInputDateFormatDelimiter() {\n+  public String getConfigInputDateFormatDelimiter() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a5ed78923d660801ecf23cb71acdfcd1cb30969"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNzE0NjQ5", "url": "https://github.com/apache/hudi/pull/1920#pullrequestreview-461714649", "createdAt": "2020-08-05T14:22:57Z", "commit": {"oid": "4a5ed78923d660801ecf23cb71acdfcd1cb30969"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoyMjo1N1rOG8MAkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNDoyMjo1N1rOG8MAkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTc2NDQ5OA==", "bodyText": "Let us add a test case for the scenario when timestampType is SCALAR or EPOCH_MILLISECONDS and the value of the field is null?", "url": "https://github.com/apache/hudi/pull/1920#discussion_r465764498", "createdAt": "2020-08-05T14:22:57Z", "author": {"login": "pratyakshsharma"}, "path": "hudi-spark/src/test/java/org/apache/hudi/keygen/TestTimestampBasedKeyGenerator.java", "diffHunk": "@@ -107,6 +107,13 @@ public void testTimestampBasedKeyGenerator() throws IOException {\n     properties = getBaseKeyConfig(\"DATE_STRING\", \"yyyy-MM-dd hh\", \"GMT\", null);\n     HoodieKey hk4 = new TimestampBasedKeyGenerator(properties).getKey(baseRecord);\n     assertEquals(\"2020-01-06 12\", hk4.getPartitionPath());\n+\n+    // timestamp is DATE_STRING, timezone is GMT+8:00, createTime is null\n+    baseRecord.put(\"createTime\", null);\n+    properties = getBaseKeyConfig(\"DATE_STRING\", \"yyyy-MM-dd hh:mm:ss\", \"GMT+8:00\", null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a5ed78923d660801ecf23cb71acdfcd1cb30969"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a5ed78923d660801ecf23cb71acdfcd1cb30969", "author": {"user": null}, "url": "https://github.com/apache/hudi/commit/4a5ed78923d660801ecf23cb71acdfcd1cb30969", "committedDate": "2020-08-05T11:38:06Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when using TimestampBasedKeyGenerator"}, "afterCommit": {"oid": "6150d3e78f6a8878c6970e14a75f1c5af9f7b798", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/6150d3e78f6a8878c6970e14a75f1c5af9f7b798", "committedDate": "2020-08-05T15:46:47Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when using TimestampBasedKeyGenerator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6150d3e78f6a8878c6970e14a75f1c5af9f7b798", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/6150d3e78f6a8878c6970e14a75f1c5af9f7b798", "committedDate": "2020-08-05T15:46:47Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when using TimestampBasedKeyGenerator"}, "afterCommit": {"oid": "9f28102aa99268340ec4ab94acaa2dd77fa5f89b", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/9f28102aa99268340ec4ab94acaa2dd77fa5f89b", "committedDate": "2020-08-05T15:59:04Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when using TimestampBasedKeyGenerator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9f28102aa99268340ec4ab94acaa2dd77fa5f89b", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/9f28102aa99268340ec4ab94acaa2dd77fa5f89b", "committedDate": "2020-08-05T15:59:04Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when using TimestampBasedKeyGenerator"}, "afterCommit": {"oid": "009ab1330b9b7b9b5bbaa7df5d69436028813aac", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/009ab1330b9b7b9b5bbaa7df5d69436028813aac", "committedDate": "2020-08-05T16:00:11Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when using TimestampBasedKeyGenerator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "009ab1330b9b7b9b5bbaa7df5d69436028813aac", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/009ab1330b9b7b9b5bbaa7df5d69436028813aac", "committedDate": "2020-08-05T16:00:11Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when using TimestampBasedKeyGenerator"}, "afterCommit": {"oid": "5ba27d18c67bc8149b23532e51056f3a64b59d74", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/5ba27d18c67bc8149b23532e51056f3a64b59d74", "committedDate": "2020-08-06T10:11:39Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when\nusing TimestampBasedKeyGenerator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ba27d18c67bc8149b23532e51056f3a64b59d74", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/5ba27d18c67bc8149b23532e51056f3a64b59d74", "committedDate": "2020-08-06T10:11:39Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when\nusing TimestampBasedKeyGenerator"}, "afterCommit": {"oid": "1fa5349d49edfb7fc8cf023534847b3aca4357ac", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/1fa5349d49edfb7fc8cf023534847b3aca4357ac", "committedDate": "2020-08-06T13:53:00Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception when\nusing TimestampBasedKeyGenerator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17d9c0447f972b2ebb4193a2c72b7bf529f47b08", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/17d9c0447f972b2ebb4193a2c72b7bf529f47b08", "committedDate": "2020-08-08T02:55:20Z", "message": "fix timeZone issue"}, "afterCommit": {"oid": "db2b6c2882f537adf24405bc5788aa4a064e119c", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/db2b6c2882f537adf24405bc5788aa4a064e119c", "committedDate": "2020-08-08T03:12:25Z", "message": "fix timeZone issue"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db2b6c2882f537adf24405bc5788aa4a064e119c", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/db2b6c2882f537adf24405bc5788aa4a064e119c", "committedDate": "2020-08-08T03:12:25Z", "message": "fix timeZone issue"}, "afterCommit": {"oid": "21fddc9ec7adaecbb749b655cb9a12c45dcb0b95", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/21fddc9ec7adaecbb749b655cb9a12c45dcb0b95", "committedDate": "2020-08-08T05:48:00Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21fddc9ec7adaecbb749b655cb9a12c45dcb0b95", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/21fddc9ec7adaecbb749b655cb9a12c45dcb0b95", "committedDate": "2020-08-08T05:48:00Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "73068de0cac83434fbdbcbda8d787c7faadb4e2a", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/73068de0cac83434fbdbcbda8d787c7faadb4e2a", "committedDate": "2020-08-08T05:51:25Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "73068de0cac83434fbdbcbda8d787c7faadb4e2a", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/73068de0cac83434fbdbcbda8d787c7faadb4e2a", "committedDate": "2020-08-08T05:51:25Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "64f7543d272ca0c3596f1d7b692ff1e92cae3246", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/64f7543d272ca0c3596f1d7b692ff1e92cae3246", "committedDate": "2020-08-08T09:25:04Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "64f7543d272ca0c3596f1d7b692ff1e92cae3246", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/64f7543d272ca0c3596f1d7b692ff1e92cae3246", "committedDate": "2020-08-08T09:25:04Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "669987672501e30d1c06b1a3c27713859dc937df", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/669987672501e30d1c06b1a3c27713859dc937df", "committedDate": "2020-08-09T04:22:32Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "669987672501e30d1c06b1a3c27713859dc937df", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/669987672501e30d1c06b1a3c27713859dc937df", "committedDate": "2020-08-09T04:22:32Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "53b44eea0b919250f65e8c5380a996381ec1d3cb", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/53b44eea0b919250f65e8c5380a996381ec1d3cb", "committedDate": "2020-08-09T05:22:34Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4MjEwNDcx", "url": "https://github.com/apache/hudi/pull/1920#pullrequestreview-468210471", "createdAt": "2020-08-17T06:58:26Z", "commit": {"oid": "53b44eea0b919250f65e8c5380a996381ec1d3cb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwNjo1ODoyNlrOHBb33Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwNjo1ODoyNlrOHBb33Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI2NzI5Mw==", "bodyText": "If you define a variable named result, then stop using return statement in the middle of the method body. Please set the value of the variable and return it at the end of the method.", "url": "https://github.com/apache/hudi/pull/1920#discussion_r471267293", "createdAt": "2020-08-17T06:58:26Z", "author": {"login": "yanghua"}, "path": "hudi-spark/src/main/java/org/apache/hudi/keygen/TimestampBasedKeyGenerator.java", "diffHunk": "@@ -170,6 +173,32 @@ public String getPartitionPath(GenericRecord record) {\n     }\n   }\n \n+  /**\n+   * Set default value to partitionVal if the input value of partitionPathField is null.\n+   */\n+  private Object getDefaultPartitionVal() {\n+    Object result = 1L;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53b44eea0b919250f65e8c5380a996381ec1d3cb"}, "originalPosition": 41}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab309d15f96c32065841b8cb4f14f9dc8d84483b", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/ab309d15f96c32065841b8cb4f14f9dc8d84483b", "committedDate": "2020-08-17T07:16:27Z", "message": "change return result time of getDefaultPartitionVal method"}, "afterCommit": {"oid": "3446466136e1b0bde4286a0aaed2c5d52e9daa12", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/3446466136e1b0bde4286a0aaed2c5d52e9daa12", "committedDate": "2020-08-17T08:38:50Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3446466136e1b0bde4286a0aaed2c5d52e9daa12", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/3446466136e1b0bde4286a0aaed2c5d52e9daa12", "committedDate": "2020-08-17T08:38:50Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "4145bf0769d47122ed5a0f26b1effea804c2700b", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/4145bf0769d47122ed5a0f26b1effea804c2700b", "committedDate": "2020-08-17T09:27:21Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4145bf0769d47122ed5a0f26b1effea804c2700b", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/4145bf0769d47122ed5a0f26b1effea804c2700b", "committedDate": "2020-08-17T09:27:21Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "72637d9456e00f3fd9976aea57b18ac41f0f531f", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/72637d9456e00f3fd9976aea57b18ac41f0f531f", "committedDate": "2020-08-17T10:17:38Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72637d9456e00f3fd9976aea57b18ac41f0f531f", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/72637d9456e00f3fd9976aea57b18ac41f0f531f", "committedDate": "2020-08-17T10:17:38Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "d1bfe1549f925946ae79923655087b5ce82354fd", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/d1bfe1549f925946ae79923655087b5ce82354fd", "committedDate": "2020-08-20T01:27:16Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNDE4MzAw", "url": "https://github.com/apache/hudi/pull/1920#pullrequestreview-472418300", "createdAt": "2020-08-21T11:37:20Z", "commit": {"oid": "d1bfe1549f925946ae79923655087b5ce82354fd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMTozNzoyMVrOHEp4Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMTozNzoyMVrOHEp4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY0MjQ4Mw==", "bodyText": "For safety, you should judge if the parser is the instance of HoodieDateTimeParserImpl . Although, there is only one implementation currently.", "url": "https://github.com/apache/hudi/pull/1920#discussion_r474642483", "createdAt": "2020-08-21T11:37:21Z", "author": {"login": "yanghua"}, "path": "hudi-spark/src/main/java/org/apache/hudi/keygen/TimestampBasedKeyGenerator.java", "diffHunk": "@@ -199,6 +202,32 @@ private String getPartitionPath(Object partitionVal) {\n     return hiveStylePartitioning ? getPartitionPathFields().get(0) + \"=\" + partitionPath : partitionPath;\n   }\n \n+  /**\n+   * Set default value to partitionVal if the input value of partitionPathField is null.\n+   */\n+  private Object getDefaultPartitionVal() {\n+    Object result = 1L;\n+    if (timestampType == TimestampType.DATE_STRING || timestampType == TimestampType.MIXED) {\n+      // since partitionVal is null, we can set a default value of any format as TIMESTAMP_INPUT_DATE_FORMAT_PROP\n+      // configured, here we take the first.\n+      String delimiter = ((HoodieDateTimeParserImpl) parser).getConfigInputDateFormatDelimiter();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1bfe1549f925946ae79923655087b5ce82354fd"}, "originalPosition": 45}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d1bfe1549f925946ae79923655087b5ce82354fd", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/d1bfe1549f925946ae79923655087b5ce82354fd", "committedDate": "2020-08-20T01:27:16Z", "message": "[HUDI-1150]Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "babc5c4cad2d14b1aa712a0f6e4b047bc3bd6e76", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/babc5c4cad2d14b1aa712a0f6e4b047bc3bd6e76", "committedDate": "2020-08-21T14:30:48Z", "message": "refactor HoodieDateTimeParser to an abstract class to hold reusable code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "babc5c4cad2d14b1aa712a0f6e4b047bc3bd6e76", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/babc5c4cad2d14b1aa712a0f6e4b047bc3bd6e76", "committedDate": "2020-08-21T14:30:48Z", "message": "refactor HoodieDateTimeParser to an abstract class to hold reusable code"}, "afterCommit": {"oid": "dd75266cc53703b20494bb8d1f903d7d798e44c4", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/dd75266cc53703b20494bb8d1f903d7d798e44c4", "committedDate": "2020-08-21T14:33:28Z", "message": "refactor HoodieDateTimeParser to an abstract class to hold reusable code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd75266cc53703b20494bb8d1f903d7d798e44c4", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/dd75266cc53703b20494bb8d1f903d7d798e44c4", "committedDate": "2020-08-21T14:33:28Z", "message": "refactor HoodieDateTimeParser to an abstract class to hold reusable code"}, "afterCommit": {"oid": "4f3946c610aa7eea782f69edcc56c1e24985800b", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/4f3946c610aa7eea782f69edcc56c1e24985800b", "committedDate": "2020-08-21T14:46:09Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f3946c610aa7eea782f69edcc56c1e24985800b", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/4f3946c610aa7eea782f69edcc56c1e24985800b", "committedDate": "2020-08-21T14:46:09Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "ccef7314a5eae0e2070dfc620bedc04ec45c05a9", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/ccef7314a5eae0e2070dfc620bedc04ec45c05a9", "committedDate": "2020-08-21T15:21:51Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ccef7314a5eae0e2070dfc620bedc04ec45c05a9", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/ccef7314a5eae0e2070dfc620bedc04ec45c05a9", "committedDate": "2020-08-21T15:21:51Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "afee34ce2f33b03f378acebae8ddb06cd5beda25", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/afee34ce2f33b03f378acebae8ddb06cd5beda25", "committedDate": "2020-08-22T02:44:38Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "afee34ce2f33b03f378acebae8ddb06cd5beda25", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/afee34ce2f33b03f378acebae8ddb06cd5beda25", "committedDate": "2020-08-22T02:44:38Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "ccef7314a5eae0e2070dfc620bedc04ec45c05a9", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/ccef7314a5eae0e2070dfc620bedc04ec45c05a9", "committedDate": "2020-08-21T15:21:51Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ccef7314a5eae0e2070dfc620bedc04ec45c05a9", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/ccef7314a5eae0e2070dfc620bedc04ec45c05a9", "committedDate": "2020-08-21T15:21:51Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "bc2f382de5d044260a6030b6ff9ee4d98cf7098f", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/bc2f382de5d044260a6030b6ff9ee4d98cf7098f", "committedDate": "2020-08-22T02:55:05Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyOTI4NzQz", "url": "https://github.com/apache/hudi/pull/1920#pullrequestreview-472928743", "createdAt": "2020-08-22T14:04:50Z", "commit": {"oid": "bc2f382de5d044260a6030b6ff9ee4d98cf7098f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNDowNDo1MFrOHFFdRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNDowNDo1MFrOHFFdRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTA5NDM0MQ==", "bodyText": "I am not sure if it's a good design. You make a detailed implementation pull-up into an abstraction. Why? getInputDateTimeZone and getOutputDateTimeZone  should be abstract method and be pushed down to a sub-class like before. Moreover, you can see it contains if/else block, it is full of changes.\nThe main benefit of abstract classes is to provide templates for the implementation of some subclasses. Instead of thinking that the default implementation is a template and marking it as an abstract class.\nSo I think the original design is good. WDYT?", "url": "https://github.com/apache/hudi/pull/1920#discussion_r475094341", "createdAt": "2020-08-22T14:04:50Z", "author": {"login": "yanghua"}, "path": "hudi-spark/src/main/java/org/apache/hudi/keygen/parser/AbstractHoodieDateTimeParser.java", "diffHunk": "@@ -0,0 +1,90 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.keygen.parser;\n+\n+import org.apache.hudi.common.config.TypedProperties;\n+import org.apache.hudi.common.util.Option;\n+import org.apache.hudi.keygen.TimestampBasedKeyGenerator;\n+import org.joda.time.DateTimeZone;\n+import org.joda.time.format.DateTimeFormatter;\n+\n+import java.io.Serializable;\n+import java.util.TimeZone;\n+\n+public abstract class AbstractHoodieDateTimeParser implements Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc2f382de5d044260a6030b6ff9ee4d98cf7098f"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc2f382de5d044260a6030b6ff9ee4d98cf7098f", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/bc2f382de5d044260a6030b6ff9ee4d98cf7098f", "committedDate": "2020-08-22T02:55:05Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "54331e2098d5682a8aba4a6f0e59f1b5578cb4f1", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/54331e2098d5682a8aba4a6f0e59f1b5578cb4f1", "committedDate": "2020-08-22T15:02:22Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59c62cd6624cb5716713f7ffd4f345799cc186d2", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/59c62cd6624cb5716713f7ffd4f345799cc186d2", "committedDate": "2020-08-22T15:05:21Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "54331e2098d5682a8aba4a6f0e59f1b5578cb4f1", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/54331e2098d5682a8aba4a6f0e59f1b5578cb4f1", "committedDate": "2020-08-22T15:02:22Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}, "afterCommit": {"oid": "59c62cd6624cb5716713f7ffd4f345799cc186d2", "author": {"user": {"login": "wangxianghu", "name": "wangxianghu"}}, "url": "https://github.com/apache/hudi/commit/59c62cd6624cb5716713f7ffd4f345799cc186d2", "committedDate": "2020-08-22T15:05:21Z", "message": "[HUDI-1150] Fix unable to parse input partition field :1 exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMDA1MDc0", "url": "https://github.com/apache/hudi/pull/1920#pullrequestreview-473005074", "createdAt": "2020-08-23T11:55:23Z", "commit": {"oid": "59c62cd6624cb5716713f7ffd4f345799cc186d2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4783, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}