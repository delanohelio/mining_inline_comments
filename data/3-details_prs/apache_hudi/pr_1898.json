{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYxNTA1MTcy", "number": 1898, "title": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer", "bodyText": "Tips\n\nThank you very much for contributing to Apache Hudi.\nPlease review https://hudi.apache.org/contributing.html before opening a pull request.\n\nWhat is the purpose of the pull request\nAttempt to fix this issue\nBrief change log\nUpdating the way --hoodie-conf is parsed for HoodieDeltaStreamer. This also includes adding some functional tests for such command line argument parsing\nVerify this pull request\nThis change added tests and can be verified as follows:\n\n\n\nAdded a functional test in code *\n\n\nManually verified the change by running a job locally.\n\nTried running\nmvn clean package -DskipITs\nTestClientRollback>HoodieClientTestBase.setUp:78->HoodieClientTestHarness.initResources:100->HoodieClientTestHarness.initSparkContexts:139->HoodieClientTestHarness.initSparkContexts:126 \u00bb Spark\n\nSo planning to see if the same error happens in CI, if so attempt to fix it. Otherwise, something with my setup locally is wrong\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-08-01T23:15:45Z", "url": "https://github.com/apache/hudi/pull/1898", "merged": true, "mergeCommit": {"oid": "217a84192c594929963856d2224b9282a71c4048"}, "closed": true, "closedAt": "2020-08-05T04:42:52Z", "author": {"login": "sreeram26"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7Vrh7AFqTQ2MDIxNzAxMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7ztokgFqTQ2MTMzNTM3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjE3MDEx", "url": "https://github.com/apache/hudi/pull/1898#pullrequestreview-460217011", "createdAt": "2020-08-03T17:36:26Z", "commit": {"oid": "8c9840d3a6edd70fb881d341323863111f4800db"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzozNjoyNlrOG7CggA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzo0MTowOVrOG7CxFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2MDI1Ng==", "bodyText": "can be removed.", "url": "https://github.com/apache/hudi/pull/1898#discussion_r464560256", "createdAt": "2020-08-03T17:36:26Z", "author": {"login": "bvaradar"}, "path": "hudi-utilities/src/test/java/org/apache/hudi/utilities/functional/TestHoodieDeltaStreamer.java", "diffHunk": "@@ -394,6 +414,95 @@ public void testProps() {\n         props.getString(\"hoodie.datasource.write.keygenerator.class\"));\n   }\n \n+  private static HoodieDeltaStreamer.Config getBaseConfig() {\n+    // Base config with all required fields\n+    HoodieDeltaStreamer.Config base = new HoodieDeltaStreamer.Config();\n+    base.targetBasePath = TGT_BASE_PATH_VALUE;\n+    base.tableType = TABLE_TYPE_VALUE;\n+    base.targetTableName = TARGET_TABLE_VALUE;\n+    return base;\n+  }\n+\n+  private static Stream<Arguments> provideValidCliArgs() {\n+\n+    HoodieDeltaStreamer.Config base = getBaseConfig();\n+    // String parameter\n+    HoodieDeltaStreamer.Config conf1 = getBaseConfig();\n+    conf1.baseFileFormat = BASE_FILE_FORMAT_VALUE;\n+\n+    // Integer parameter\n+    HoodieDeltaStreamer.Config conf2 = getBaseConfig();\n+    conf2.sourceLimit = Long.parseLong(SOURCE_LIMIT_VALUE);\n+\n+    // Boolean Parameter\n+    HoodieDeltaStreamer.Config conf3 = getBaseConfig();\n+    conf3.enableHiveSync = true;\n+\n+    // ArrayList Parameter with 1 value\n+    HoodieDeltaStreamer.Config conf4 = getBaseConfig();\n+    conf4.configs = Arrays.asList(HOODIE_CONF_VALUE1);\n+\n+    // ArrayList Parameter with comma separated values\n+    HoodieDeltaStreamer.Config conf5 = getBaseConfig();\n+    conf5.configs = Arrays.asList(HOODIE_CONF_VALUE2);\n+\n+    // Multiple ArrayList values\n+    HoodieDeltaStreamer.Config conf6 = getBaseConfig();\n+    conf6.configs = Arrays.asList(HOODIE_CONF_VALUE1, HOODIE_CONF_VALUE2);\n+\n+    // Super set of all cases\n+    HoodieDeltaStreamer.Config conf = getBaseConfig();\n+    conf.baseFileFormat = BASE_FILE_FORMAT_VALUE;\n+    conf.sourceLimit = Long.parseLong(SOURCE_LIMIT_VALUE);\n+    conf.enableHiveSync = true;\n+    conf.configs = Arrays.asList(HOODIE_CONF_VALUE1, HOODIE_CONF_VALUE2);\n+\n+    String[] allConfig = new String[]{TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE, SOURCE_LIMIT_PARAM,\n+        SOURCE_LIMIT_VALUE, TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+        BASE_FILE_FORMAT_PARAM, BASE_FILE_FORMAT_VALUE, ENABLE_HIVE_SYNC_PARAM, HOODIE_CONF_PARAM, HOODIE_CONF_VALUE1,\n+        HOODIE_CONF_PARAM, HOODIE_CONF_VALUE2};\n+\n+    return Stream.of(\n+            // Base\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE}, base),\n+            // String\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                BASE_FILE_FORMAT_PARAM, BASE_FILE_FORMAT_VALUE}, conf1),\n+            // Integer\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                SOURCE_LIMIT_PARAM, SOURCE_LIMIT_VALUE}, conf2),\n+            // Boolean\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                ENABLE_HIVE_SYNC_PARAM}, conf3),\n+            // Array List 1\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                HOODIE_CONF_PARAM, HOODIE_CONF_VALUE1}, conf4),\n+            // Array List with comma\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                HOODIE_CONF_PARAM, HOODIE_CONF_VALUE2}, conf5),\n+            // Array list with multiple values\n+            Arguments.of(new String[] {TGT_BASE_PATH_PARAM, TGT_BASE_PATH_VALUE,\n+                TABLE_TYPE_PARAM, TABLE_TYPE_VALUE, TARGET_TABLE_PARAM, TARGET_TABLE_VALUE,\n+                HOODIE_CONF_PARAM, HOODIE_CONF_VALUE1, HOODIE_CONF_PARAM, HOODIE_CONF_VALUE2}, conf6),\n+            // All\n+            Arguments.of(allConfig, conf)\n+    );\n+  }\n+  \n+  @ParameterizedTest\n+  @MethodSource(\"provideValidCliArgs\")\n+  public void testValidCommandLineArgs(String[] args, HoodieDeltaStreamer.Config expected) {\n+    System.out.println(\"Expected: \");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c9840d3a6edd70fb881d341323863111f4800db"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU2NDUwMA==", "bodyText": "Question : Any specific reason why equals/hashcode are added ? Was it added as part of general  best-practices ?", "url": "https://github.com/apache/hudi/pull/1898#discussion_r464564500", "createdAt": "2020-08-03T17:41:09Z", "author": {"login": "bvaradar"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/deltastreamer/HoodieDeltaStreamer.java", "diffHunk": "@@ -306,16 +317,106 @@ public boolean isInlineCompactionEnabled() {\n       return !continuousMode && !forceDisableCompaction\n           && HoodieTableType.MERGE_ON_READ.equals(HoodieTableType.valueOf(tableType));\n     }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c9840d3a6edd70fb881d341323863111f4800db"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzM5MDM4", "url": "https://github.com/apache/hudi/pull/1898#pullrequestreview-460339038", "createdAt": "2020-08-03T21:02:42Z", "commit": {"oid": "99a09437f114fb7690d0b1100d17545c7d1eca47"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMTowMjo0MlrOG7Iomg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMTowMjo0MlrOG7Iomg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY2MDYzNA==", "bodyText": "How about making this class public and moving it to a more general package e.g. hudi-common?\nThere are some other classes which might also need this VoidSplitter, e.g. https://github.com/apache/hudi/blob/master/hudi-utilities/src/main/java/org/apache/hudi/utilities/HDFSParquetImporter.java#L280, https://github.com/apache/hudi/blob/master/hudi-utilities/src/main/java/org/apache/hudi/utilities/HoodieCompactor.java#L92", "url": "https://github.com/apache/hudi/pull/1898#discussion_r464660634", "createdAt": "2020-08-03T21:02:42Z", "author": {"login": "zhedoubushishi"}, "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/deltastreamer/HoodieDeltaStreamer.java", "diffHunk": "@@ -165,6 +168,12 @@ public Operation convert(String value) throws ParameterException {\n     }\n   }\n \n+  private static final class VoidSplitter implements IParameterSplitter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99a09437f114fb7690d0b1100d17545c7d1eca47"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e3d1cef1dd57046b522d5601eeefd072264f2a90", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/e3d1cef1dd57046b522d5601eeefd072264f2a90", "committedDate": "2020-08-03T23:36:47Z", "message": "Trigger Build"}, "afterCommit": {"oid": "57d63cc922327f2f6eca92c720171c2914a5bdfa", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/57d63cc922327f2f6eca92c720171c2914a5bdfa", "committedDate": "2020-08-04T15:02:06Z", "message": "Move VoidSplitter to hudi-common"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "57d63cc922327f2f6eca92c720171c2914a5bdfa", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/57d63cc922327f2f6eca92c720171c2914a5bdfa", "committedDate": "2020-08-04T15:02:06Z", "message": "Move VoidSplitter to hudi-common"}, "afterCommit": {"oid": "5230f8cd58d27876165b34d115aeb47ad77605f5", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/5230f8cd58d27876165b34d115aeb47ad77605f5", "committedDate": "2020-08-04T15:07:16Z", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5230f8cd58d27876165b34d115aeb47ad77605f5", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/5230f8cd58d27876165b34d115aeb47ad77605f5", "committedDate": "2020-08-04T15:07:16Z", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer"}, "afterCommit": {"oid": "4b34401a62dcd3b070c4dae919312e4d663503d5", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/4b34401a62dcd3b070c4dae919312e4d663503d5", "committedDate": "2020-08-04T16:47:21Z", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f6e3c934cb40b198612433efa2d80b08e94e0422", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/f6e3c934cb40b198612433efa2d80b08e94e0422", "committedDate": "2020-08-04T18:46:50Z", "message": "Trigger Build"}, "afterCommit": {"oid": "43b3907a50fc5cf7679c9a148e70ebd931946af8", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/43b3907a50fc5cf7679c9a148e70ebd931946af8", "committedDate": "2020-08-04T23:09:50Z", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43b3907a50fc5cf7679c9a148e70ebd931946af8", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/43b3907a50fc5cf7679c9a148e70ebd931946af8", "committedDate": "2020-08-04T23:09:50Z", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer"}, "afterCommit": {"oid": "ac0ad66ded018e3666354525a4c5ca8eb99844b2", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/ac0ad66ded018e3666354525a4c5ca8eb99844b2", "committedDate": "2020-08-05T00:00:56Z", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d786b6062c37bc1c32766bd63acb7f82633d14b", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/0d786b6062c37bc1c32766bd63acb7f82633d14b", "committedDate": "2020-08-05T01:43:53Z", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac0ad66ded018e3666354525a4c5ca8eb99844b2", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/ac0ad66ded018e3666354525a4c5ca8eb99844b2", "committedDate": "2020-08-05T00:00:56Z", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer"}, "afterCommit": {"oid": "0d786b6062c37bc1c32766bd63acb7f82633d14b", "author": {"user": {"login": "sreeram26", "name": "Sreeram Ramji"}}, "url": "https://github.com/apache/hudi/commit/0d786b6062c37bc1c32766bd63acb7f82633d14b", "committedDate": "2020-08-05T01:43:53Z", "message": "[HUDI-1140] Fix Jcommander issue for --hoodie-conf in DeltaStreamer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMzM1Mzc5", "url": "https://github.com/apache/hudi/pull/1898#pullrequestreview-461335379", "createdAt": "2020-08-05T04:42:37Z", "commit": {"oid": "0d786b6062c37bc1c32766bd63acb7f82633d14b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4753, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}