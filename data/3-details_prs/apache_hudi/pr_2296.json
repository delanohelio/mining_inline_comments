{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMzg0MzA3", "number": 2296, "title": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write", "bodyText": "Tips\n\nThank you very much for contributing to Apache Hudi.\nPlease review https://hudi.apache.org/contributing.html before opening a pull request.\n\nWhat is the purpose of the pull request\nRemove some of the junk code which may affect the performace.\nBrief change log\nRemove some junk code in HoodieSparkSqlWriter\nVerify this pull request\n(Please pick either of the following options)\nThis pull request is a trivial rework / code cleanup without any test coverage.\n(or)\nThis pull request is already covered by existing tests, such as (please describe tests).\n(or)\nThis change added tests and can be verified as follows:\n(example:)\n\nAdded integration tests for end-to-end.\nAdded HoodieClientWriteTest to verify the change.\nManually verified the change by running a job locally.\n\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-12-04T08:47:57Z", "url": "https://github.com/apache/hudi/pull/2296", "merged": true, "mergeCommit": {"oid": "bbadac7de1bb57300ca7e796ebb401fdbb66a0f8"}, "closed": true, "closedAt": "2021-07-29T04:30:18Z", "author": {"login": "pengzhiwei2018"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj7nD_gFqTU0NjUxMjA2NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABevAUa6ABqjUwODMzNzg2OTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTEyMDY0", "url": "https://github.com/apache/hudi/pull/2296#pullrequestreview-546512064", "createdAt": "2020-12-07T20:31:39Z", "commit": {"oid": "19bdadefb4eab5f42c12ce0260fbbf3fb3590acd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MjMxNjgz", "url": "https://github.com/apache/hudi/pull/2296#pullrequestreview-548231683", "createdAt": "2020-12-09T14:22:41Z", "commit": {"oid": "19bdadefb4eab5f42c12ce0260fbbf3fb3590acd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNDoyMjo0MVrOICXHRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNDoyMjo0MVrOICXHRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM0Njc1Ng==", "bodyText": "Hi @pengzhiwei2018  I think this is necessary. It is possible that the incoming rdd is empty and we need to handle that. Are you seeing any performance issues here?\nWorth to mention that this is the first Spark action, if you are seeing isEmpty() take too long in Spark UI, it's probably the transformation before this action.", "url": "https://github.com/apache/hudi/pull/2296#discussion_r539346756", "createdAt": "2020-12-09T14:22:41Z", "author": {"login": "garyli1019"}, "path": "hudi-spark/src/main/scala/org/apache/hudi/HoodieSparkSqlWriter.scala", "diffHunk": "@@ -178,11 +178,6 @@ private[hudi] object HoodieSparkSqlWriter {\n             } else {\n               hoodieAllIncomingRecords\n             }\n-\n-          if (hoodieRecords.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19bdadefb4eab5f42c12ce0260fbbf3fb3590acd"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19bdadefb4eab5f42c12ce0260fbbf3fb3590acd", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/19bdadefb4eab5f42c12ce0260fbbf3fb3590acd", "committedDate": "2020-12-04T08:45:59Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write"}, "afterCommit": {"oid": "39c0618daffe76038d5691caa358ac5a75bdcd8b", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/39c0618daffe76038d5691caa358ac5a75bdcd8b", "committedDate": "2020-12-10T03:15:10Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bae8a09d06fc699101fdab4e9525610edc51742f", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/bae8a09d06fc699101fdab4e9525610edc51742f", "committedDate": "2020-12-14T09:44:58Z", "message": "add some test case"}, "afterCommit": {"oid": "f86f5b5619394a9e99ccf6c855a1a82b3a095b7d", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/f86f5b5619394a9e99ccf6c855a1a82b3a095b7d", "committedDate": "2020-12-14T09:46:02Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write\n\nadd some test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMDY0ODQy", "url": "https://github.com/apache/hudi/pull/2296#pullrequestreview-552064842", "createdAt": "2020-12-15T02:48:22Z", "commit": {"oid": "f86f5b5619394a9e99ccf6c855a1a82b3a095b7d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMjo0ODoyMlrOIF2XDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQwMjo1Mzo0OVrOIF2eZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAwNDQzMA==", "bodyText": "I don't think we should make an empty commit. Empty commits might pollute the timeline, cleaning, compactions e.t.c. and trigger some unexpected behaviors. WDYT?", "url": "https://github.com/apache/hudi/pull/2296#discussion_r543004430", "createdAt": "2020-12-15T02:48:22Z", "author": {"login": "garyli1019"}, "path": "hudi-spark-datasource/hudi-spark/src/test/scala/org/apache/hudi/functional/TestCOWDataSource.scala", "diffHunk": "@@ -320,4 +320,21 @@ class TestCOWDataSource extends HoodieClientTestBase {\n \n     assertTrue(HoodieDataSourceHelpers.hasNewCommits(fs, basePath, \"000\"))\n   }\n+\n+  @Test def testWithEmptyInput(): Unit = {\n+    val inputDF1 = spark.read.json(spark.sparkContext.parallelize(Seq.empty[String], 1))\n+    inputDF1.write.format(\"org.apache.hudi\")\n+      .options(commonOpts)\n+      .option(DataSourceWriteOptions.OPERATION_OPT_KEY, DataSourceWriteOptions.INSERT_OPERATION_OPT_VAL)\n+      .mode(SaveMode.Overwrite)\n+      .save(basePath)\n+    assertTrue(HoodieDataSourceHelpers.hasNewCommits(fs, basePath, \"000\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f86f5b5619394a9e99ccf6c855a1a82b3a095b7d"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAwNjMxMQ==", "bodyText": "Have you done any experiments on this? Like putting another Spark action before this.\nrdd.isEmpty() is the most efficient way I could find that will do the empty check. Maybe we can change the description of this action so the user won't misunderstand?", "url": "https://github.com/apache/hudi/pull/2296#discussion_r543006311", "createdAt": "2020-12-15T02:53:49Z", "author": {"login": "garyli1019"}, "path": "hudi-spark-datasource/hudi-spark/src/main/scala/org/apache/hudi/HoodieSparkSqlWriter.scala", "diffHunk": "@@ -182,11 +182,6 @@ private[hudi] object HoodieSparkSqlWriter {\n             } else {\n               hoodieAllIncomingRecords\n             }\n-\n-          if (hoodieRecords.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f86f5b5619394a9e99ccf6c855a1a82b3a095b7d"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f86f5b5619394a9e99ccf6c855a1a82b3a095b7d", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/f86f5b5619394a9e99ccf6c855a1a82b3a095b7d", "committedDate": "2020-12-14T09:46:02Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write\n\nadd some test case"}, "afterCommit": {"oid": "d39721bb754db6d114fafd8eaa7a342c090199b1", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/d39721bb754db6d114fafd8eaa7a342c090199b1", "committedDate": "2021-01-30T14:02:58Z", "message": "skip empty commit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d39721bb754db6d114fafd8eaa7a342c090199b1", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/d39721bb754db6d114fafd8eaa7a342c090199b1", "committedDate": "2021-01-30T14:02:58Z", "message": "skip empty commit"}, "afterCommit": {"oid": "9dffc5ac02d7beedba9f694cb028d86a5438391c", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/9dffc5ac02d7beedba9f694cb028d86a5438391c", "committedDate": "2021-01-30T14:04:08Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write\n\nadd some test case\n\nskip empty commit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "16ffb37885800687d6e07557759d7e7f03730509", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/16ffb37885800687d6e07557759d7e7f03730509", "committedDate": "2021-02-01T16:19:21Z", "message": "fix test case"}, "afterCommit": {"oid": "69b232a039ef3829667b4887f1509c7763ce5f3f", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/69b232a039ef3829667b4887f1509c7763ce5f3f", "committedDate": "2021-02-01T16:20:12Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write\n\nadd some test case\n\nskip empty commit\n\nfix test case"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c16d1f106887c94e9f2f14ead12d8626cda58ed5", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/c16d1f106887c94e9f2f14ead12d8626cda58ed5", "committedDate": "2021-02-02T02:10:24Z", "message": "add comment"}, "afterCommit": {"oid": "673e8e7b1b2893676a6b507b66b12e2625409ab7", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/673e8e7b1b2893676a6b507b66b12e2625409ab7", "committedDate": "2021-02-02T02:11:31Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write\n\nadd some test case\n\nskip empty commit\n\nfix test case\n\nadd comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgxNDYzNjgy", "url": "https://github.com/apache/hudi/pull/2296#pullrequestreview-581463682", "createdAt": "2021-02-02T15:26:39Z", "commit": {"oid": "673e8e7b1b2893676a6b507b66b12e2625409ab7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMlQxNToyNjozOVrOIeWOYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMlQxNToyNzoyOFrOIeWRGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODY5MjMyMw==", "bodyText": "Will this check impact the performance of non-empty commit? Will the previous stages being cached?\nI personally feel it's better to do the empty check before run into hudi's operation.", "url": "https://github.com/apache/hudi/pull/2296#discussion_r568692323", "createdAt": "2021-02-02T15:26:39Z", "author": {"login": "garyli1019"}, "path": "hudi-client/hudi-client-common/src/main/java/org/apache/hudi/client/AbstractHoodieWriteClient.java", "diffHunk": "@@ -173,6 +173,10 @@ public boolean commitStats(String instantTime, List<HoodieWriteStat> stats, Opti\n \n   public boolean commitStats(String instantTime, List<HoodieWriteStat> stats, Option<Map<String, String>> extraMetadata,\n                              String commitActionType, Map<String, List<String>> partitionToReplaceFileIds) {\n+    // Skip the empty commit\n+    if (stats.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "673e8e7b1b2893676a6b507b66b12e2625409ab7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODY5MzAxNw==", "bodyText": "should remain unchanged?", "url": "https://github.com/apache/hudi/pull/2296#discussion_r568693017", "createdAt": "2021-02-02T15:27:28Z", "author": {"login": "garyli1019"}, "path": "hudi-client/hudi-spark-client/src/test/java/org/apache/hudi/table/action/compact/TestHoodieCompactor.java", "diffHunk": "@@ -186,7 +191,7 @@ public void testWriteStatusContentsAfterCompaction() throws Exception {\n       for (String partitionPath : dataGen.getPartitionPaths()) {\n         List<WriteStatus> writeStatuses = result.collect();\n         assertTrue(writeStatuses.stream()\n-            .filter(writeStatus -> writeStatus.getStat().getPartitionPath().contentEquals(partitionPath)).count() > 0);\n+            .filter(writeStatus1 -> writeStatus1.getStat().getPartitionPath().contentEquals(partitionPath)).count() > 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "673e8e7b1b2893676a6b507b66b12e2625409ab7"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4384cf625b6a518f236b1236636ecd270f75896a", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/4384cf625b6a518f236b1236636ecd270f75896a", "committedDate": "2021-02-02T16:13:53Z", "message": "remove useless change"}, "afterCommit": {"oid": "d4e3d89e0c02f1b9a704a61627f7aafec14e67e6", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/d4e3d89e0c02f1b9a704a61627f7aafec14e67e6", "committedDate": "2021-02-03T02:16:13Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write\n\nadd some test case\n\nskip empty commit\n\nfix test case\n\nadd comment\n\nremove useless change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgzNzI1OTY3", "url": "https://github.com/apache/hudi/pull/2296#pullrequestreview-583725967", "createdAt": "2021-02-04T19:10:03Z", "commit": {"oid": "d4e3d89e0c02f1b9a704a61627f7aafec14e67e6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxOToxMDowM1rOIgDIOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wNFQxOToxMDowM1rOIgDIOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDQ3NjYwMw==", "bodyText": "I think there was an explicit ask to allow the empty commit before. Lets take deltastreamer which stores the offset of the kafka checkpoints in the commit metadata. If we don't commit when stats are empty the checkpoint will never advance. The transformer  in delta streamer could filter out all records read in that batch for e.g and lead to an empty commit. but the kafka offsets would have advanced. So its not good to do this IMO", "url": "https://github.com/apache/hudi/pull/2296#discussion_r570476603", "createdAt": "2021-02-04T19:10:03Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/hudi-client-common/src/main/java/org/apache/hudi/client/AbstractHoodieWriteClient.java", "diffHunk": "@@ -173,6 +173,10 @@ public boolean commitStats(String instantTime, List<HoodieWriteStat> stats, Opti\n \n   public boolean commitStats(String instantTime, List<HoodieWriteStat> stats, Option<Map<String, String>> extraMetadata,\n                              String commitActionType, Map<String, List<String>> partitionToReplaceFileIds) {\n+    // Skip the empty commit\n+    if (stats.isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODY5MjMyMw=="}, "originalCommit": {"oid": "673e8e7b1b2893676a6b507b66b12e2625409ab7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAxNTk1Mjgw", "url": "https://github.com/apache/hudi/pull/2296#pullrequestreview-701595280", "createdAt": "2021-07-08T02:48:46Z", "commit": {"oid": "d4e3d89e0c02f1b9a704a61627f7aafec14e67e6"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0wOFQwMjo0ODo0NlrOJ6_ImA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0wOFQwMjo1MDo1NVrOJ6_LGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTgzMTU3Ng==", "bodyText": "lets control this using a new config?", "url": "https://github.com/apache/hudi/pull/2296#discussion_r665831576", "createdAt": "2021-07-08T02:48:46Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/hudi-client-common/src/main/java/org/apache/hudi/client/AbstractHoodieWriteClient.java", "diffHunk": "@@ -173,6 +173,10 @@ public boolean commitStats(String instantTime, List<HoodieWriteStat> stats, Opti\n \n   public boolean commitStats(String instantTime, List<HoodieWriteStat> stats, Option<Map<String, String>> extraMetadata,\n                              String commitActionType, Map<String, List<String>> partitionToReplaceFileIds) {\n+    // Skip the empty commit\n+    if (stats.isEmpty()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODY5MjMyMw=="}, "originalCommit": {"oid": "673e8e7b1b2893676a6b507b66b12e2625409ab7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTgzMTc4Mg==", "bodyText": "empty input, you mean?", "url": "https://github.com/apache/hudi/pull/2296#discussion_r665831782", "createdAt": "2021-07-08T02:49:30Z", "author": {"login": "vinothchandar"}, "path": "hudi-spark-datasource/hudi-spark/src/test/scala/org/apache/hudi/functional/TestCOWDataSource.scala", "diffHunk": "@@ -348,4 +348,23 @@ class TestCOWDataSource extends HoodieClientTestBase {\n \n     assertTrue(HoodieDataSourceHelpers.hasNewCommits(fs, basePath, \"000\"))\n   }\n+\n+  @Test def testWithEmptyInput(): Unit = {\n+    val inputDF1 = spark.read.json(spark.sparkContext.parallelize(Seq.empty[String], 1))\n+    inputDF1.write.format(\"org.apache.hudi\")\n+      .options(commonOpts)\n+      .option(DataSourceWriteOptions.OPERATION_OPT_KEY, DataSourceWriteOptions.INSERT_OPERATION_OPT_VAL)\n+      .mode(SaveMode.Overwrite)\n+      .save(basePath)\n+    // Empty commit does not has a new commit", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4e3d89e0c02f1b9a704a61627f7aafec14e67e6"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NTgzMjIxNg==", "bodyText": "we should actually have this generate an empty commit and test. If we don't then we checkpoints won't move.\nConsider this scenario, when deltastreamer reads from kafka using a custom transformer. If the transformer filters out all records from Kafka, we will have empty input for write, but the kafka offsets have to move ahead.", "url": "https://github.com/apache/hudi/pull/2296#discussion_r665832216", "createdAt": "2021-07-08T02:50:55Z", "author": {"login": "vinothchandar"}, "path": "hudi-utilities/src/test/java/org/apache/hudi/utilities/functional/TestHoodieDeltaStreamer.java", "diffHunk": "@@ -932,15 +932,10 @@ public void testFilterDupes() throws Exception {\n     ds2.sync();\n     mClient = new HoodieTableMetaClient(jsc.hadoopConfiguration(), tableBasePath, true);\n     HoodieInstant newLastFinished = mClient.getCommitsTimeline().filterCompletedInstants().lastInstant().get();\n-    assertTrue(HoodieTimeline.compareTimestamps(newLastFinished.getTimestamp(), HoodieTimeline.GREATER_THAN, lastFinished.getTimestamp()\n+    // there is not new commit generate for empty commits", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4e3d89e0c02f1b9a704a61627f7aafec14e67e6"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4e3d89e0c02f1b9a704a61627f7aafec14e67e6", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/d4e3d89e0c02f1b9a704a61627f7aafec14e67e6", "committedDate": "2021-02-03T02:16:13Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write\n\nadd some test case\n\nskip empty commit\n\nfix test case\n\nadd comment\n\nremove useless change"}, "afterCommit": {"oid": "04142242b1687b3fd37523dcf78edd18bcd71157", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/04142242b1687b3fd37523dcf78edd18bcd71157", "committedDate": "2021-07-15T11:33:06Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write\n\nadd some test case\n\nskip empty commit\n\nfix test case\n\nadd comment\n\nremove useless change"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04142242b1687b3fd37523dcf78edd18bcd71157", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/04142242b1687b3fd37523dcf78edd18bcd71157", "committedDate": "2021-07-15T11:33:06Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write\n\nadd some test case\n\nskip empty commit\n\nfix test case\n\nadd comment\n\nremove useless change"}, "afterCommit": {"oid": "380fc82fc31f5ebdede6bfef992177e8cc09016c", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/380fc82fc31f5ebdede6bfef992177e8cc09016c", "committedDate": "2021-07-15T11:33:51Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7880da37214b5fbd8524f24a09ed61dad93670ed", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/7880da37214b5fbd8524f24a09ed61dad93670ed", "committedDate": "2021-07-15T11:59:00Z", "message": "fix test case"}, "afterCommit": {"oid": "dc36883644cf88971ecf13dc3642d60e60a1e6ec", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/dc36883644cf88971ecf13dc3642d60e60a1e6ec", "committedDate": "2021-07-15T11:59:27Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd6767b606cfa19b064e4455f7a396e84e13d839", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/cd6767b606cfa19b064e4455f7a396e84e13d839", "committedDate": "2021-07-15T12:07:12Z", "message": "fix bug"}, "afterCommit": {"oid": "7ebc9ff5395d8790339586ae3ff7e56b05a6a569", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/7ebc9ff5395d8790339586ae3ff7e56b05a6a569", "committedDate": "2021-07-15T12:07:35Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c0d62ca35befeccafde02fa0ce674253ec17990", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/1c0d62ca35befeccafde02fa0ce674253ec17990", "committedDate": "2021-07-15T12:10:45Z", "message": "fix case"}, "afterCommit": {"oid": "1abea6c4b0431492eccdecb6aa3a3deab503b36c", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/1abea6c4b0431492eccdecb6aa3a3deab503b36c", "committedDate": "2021-07-15T12:11:10Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c86b7708e4204d585180ae8e9187c416ba6d052", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/4c86b7708e4204d585180ae8e9187c416ba6d052", "committedDate": "2021-07-15T12:11:55Z", "message": "remove line"}, "afterCommit": {"oid": "244d86b04feb328d55597223bdf33f50a17c708f", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/244d86b04feb328d55597223bdf33f50a17c708f", "committedDate": "2021-07-15T12:12:16Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa8ba5e890fd394820a0ff91e0395b9be62d7ba8", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/fa8ba5e890fd394820a0ff91e0395b9be62d7ba8", "committedDate": "2021-07-16T03:58:21Z", "message": "fix format"}, "afterCommit": {"oid": "6ac9d507dc541a7e17741c3e1fcd8a6bb28aecc6", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/6ac9d507dc541a7e17741c3e1fcd8a6bb28aecc6", "committedDate": "2021-07-16T03:58:51Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzE3NTYxMTQ3", "url": "https://github.com/apache/hudi/pull/2296#pullrequestreview-717561147", "createdAt": "2021-07-29T00:11:38Z", "commit": {"oid": "6ac9d507dc541a7e17741c3e1fcd8a6bb28aecc6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0yOVQwMDoxMTozOFrOKHSjzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0yOVQwMDoxMTozOFrOKHSjzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3ODczMjc0OA==", "bodyText": "reword: Whether to allow generation of empty commits, even if no data was written in the commit. It's useful in cases where extra metadata needs to be published regardless e.g tracking source offsets when ingesting data", "url": "https://github.com/apache/hudi/pull/2296#discussion_r678732748", "createdAt": "2021-07-29T00:11:38Z", "author": {"login": "vinothchandar"}, "path": "hudi-client/hudi-client-common/src/main/java/org/apache/hudi/config/HoodieWriteConfig.java", "diffHunk": "@@ -366,6 +366,11 @@\n       .withDocumentation(\"When enabled, records in older schema are rewritten into newer schema during upsert,delete and background\"\n           + \" compaction,clustering operations.\");\n \n+  public static final ConfigProperty<Boolean> ALLOW_EMPTY_COMMIT = ConfigProperty\n+       .key(\"hoodie.allow.empty.commmit\")\n+       .defaultValue(true)\n+       .withDocumentation(\"Whether to allow generate empty commit when the input is empty.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ac9d507dc541a7e17741c3e1fcd8a6bb28aecc6"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzE3NTYxNjA5", "url": "https://github.com/apache/hudi/pull/2296#pullrequestreview-717561609", "createdAt": "2021-07-29T00:13:03Z", "commit": {"oid": "6ac9d507dc541a7e17741c3e1fcd8a6bb28aecc6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f04fd3e1c0f889389c08f533f6621eb843695e88", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/f04fd3e1c0f889389c08f533f6621eb843695e88", "committedDate": "2021-07-29T02:24:50Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "edbb01fca368c74c6504bad0bae0c3723bce583d", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/edbb01fca368c74c6504bad0bae0c3723bce583d", "committedDate": "2021-07-29T02:23:54Z", "message": "fix spell error and doc"}, "afterCommit": {"oid": "f04fd3e1c0f889389c08f533f6621eb843695e88", "author": {"user": {"login": "pengzhiwei2018", "name": "pengzhiwei"}}, "url": "https://github.com/apache/hudi/commit/f04fd3e1c0f889389c08f533f6621eb843695e88", "committedDate": "2021-07-29T02:24:50Z", "message": "[HUDI-1425] Performance loss with the additional hoodieRecords.isEmpty() in HoodieSparkSqlWriter#write"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4385, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}