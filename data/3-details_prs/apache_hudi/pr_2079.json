{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyOTExODQ0", "number": 2079, "title": "[HUDI-995] Use HoodieTestTable in more classes", "bodyText": "Migrate test data prep logic in\n\nTestStatsCommand\nTestHoodieROTablePathFilter\n\nRe-implement methods for create new commit times in HoodieTestUtils and HoodieClientTestHarness\n\nMove relevant APIs to HoodieTestTable\nMigrate usages\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils\nTips\n\nThank you very much for contributing to Apache Hudi.\nPlease review https://hudi.apache.org/contributing.html before opening a pull request.\n\nWhat is the purpose of the pull request\n(For example: This pull request adds quick-start document.)\nBrief change log\n(for example:)\n\nModify AnnotationLocation checkstyle rule in checkstyle.xml\n\nVerify this pull request\n(Please pick either of the following options)\nThis pull request is a trivial rework / code cleanup without any test coverage.\n(or)\nThis pull request is already covered by existing tests, such as (please describe tests).\n(or)\nThis change added tests and can be verified as follows:\n(example:)\n\nAdded integration tests for end-to-end.\nAdded HoodieClientWriteTest to verify the change.\nManually verified the change by running a job locally.\n\nCommitter checklist\n\n\n Has a corresponding JIRA in PR title & commit\n\n\n Commit message is descriptive of the change\n\n\n CI is green\n\n\n Necessary doc changes done or have another open PR\n\n\n For large changes, please consider breaking it into sub-tasks under an umbrella JIRA.", "createdAt": "2020-09-09T15:05:39Z", "url": "https://github.com/apache/hudi/pull/2079", "merged": true, "mergeCommit": {"oid": "3201665295122a892c8ade92aca5f72426a403fd"}, "closed": true, "closedAt": "2020-09-17T16:29:08Z", "author": {"login": "xushiyan"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH3MDdgBqjM3NTY4MTUxMzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI3dQlABqjM3NjQ3NzE3MjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ea0086a2e183bdca98e8171e6de44a99fa69bec", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/3ea0086a2e183bdca98e8171e6de44a99fa69bec", "committedDate": "2020-09-09T15:01:16Z", "message": "[HUDI-995] Use HoodieTestTable in more classes\n\nMigrate test data prep logic in\n- TestStatsCommand\n- TestHoodieROTablePathFilter\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils"}, "afterCommit": {"oid": "32374dbc435419d6e36a91babf0b4e46d2c50345", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/32374dbc435419d6e36a91babf0b4e46d2c50345", "committedDate": "2020-09-11T15:32:30Z", "message": "[HUDI-995] Use HoodieTestTable in more classes\n\nMigrate test data prep logic in\n- TestStatsCommand\n- TestHoodieROTablePathFilter\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "32374dbc435419d6e36a91babf0b4e46d2c50345", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/32374dbc435419d6e36a91babf0b4e46d2c50345", "committedDate": "2020-09-11T15:32:30Z", "message": "[HUDI-995] Use HoodieTestTable in more classes\n\nMigrate test data prep logic in\n- TestStatsCommand\n- TestHoodieROTablePathFilter\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils"}, "afterCommit": {"oid": "5a9e5a2bbc74ebc72528e16e1ef6b073f8c2f12c", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/5a9e5a2bbc74ebc72528e16e1ef6b073f8c2f12c", "committedDate": "2020-09-12T17:56:45Z", "message": "[HUDI-995] Use HoodieTestTable in more classes\n\nMigrate test data prep logic in\n- TestStatsCommand\n- TestHoodieROTablePathFilter\n\nRe-implement methods for create new commit times in HoodieTestUtils and HoodieClientTestHarness\n- Move relevant APIs to HoodieTestTable\n- Migrate usages\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5a9e5a2bbc74ebc72528e16e1ef6b073f8c2f12c", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/5a9e5a2bbc74ebc72528e16e1ef6b073f8c2f12c", "committedDate": "2020-09-12T17:56:45Z", "message": "[HUDI-995] Use HoodieTestTable in more classes\n\nMigrate test data prep logic in\n- TestStatsCommand\n- TestHoodieROTablePathFilter\n\nRe-implement methods for create new commit times in HoodieTestUtils and HoodieClientTestHarness\n- Move relevant APIs to HoodieTestTable\n- Migrate usages\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils"}, "afterCommit": {"oid": "cbd72a78b898a5af76f94e4d53c3b29d39a8dacd", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/cbd72a78b898a5af76f94e4d53c3b29d39a8dacd", "committedDate": "2020-09-12T18:09:22Z", "message": "[HUDI-995] Use HoodieTestTable in more classes\n\nMigrate test data prep logic in\n- TestStatsCommand\n- TestHoodieROTablePathFilter\n\nRe-implement methods for create new commit times in HoodieTestUtils and HoodieClientTestHarness\n- Move relevant APIs to HoodieTestTable\n- Migrate usages\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjQ2MDU3", "url": "https://github.com/apache/hudi/pull/2079#pullrequestreview-487246057", "createdAt": "2020-09-12T18:03:27Z", "commit": {"oid": "5a9e5a2bbc74ebc72528e16e1ef6b073f8c2f12c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQxODowMzoyN1rOHQ2lsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQxODowNToxNFrOHQ2mRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQzMzY1MA==", "bodyText": "Remove this implementation due to lack of reusability; use HoodieTestTable#makeNewCommitTime(int sequence) instead", "url": "https://github.com/apache/hudi/pull/2079#discussion_r487433650", "createdAt": "2020-09-12T18:03:27Z", "author": {"login": "xushiyan"}, "path": "hudi-client/src/test/java/org/apache/hudi/testutils/HoodieClientTestHarness.java", "diffHunk": "@@ -66,17 +65,12 @@\n   protected transient HoodieTestDataGenerator dataGen = null;\n   protected transient ExecutorService executorService;\n   protected transient HoodieTableMetaClient metaClient;\n-  private static AtomicInteger instantGen = new AtomicInteger(1);\n   protected transient HoodieWriteClient writeClient;\n   protected transient HoodieReadClient readClient;\n   protected transient HoodieTableFileSystemView tableView;\n \n   protected final SparkTaskContextSupplier supplier = new SparkTaskContextSupplier();\n \n-  public String getNextInstant() {\n-    return String.format(\"%09d\", instantGen.getAndIncrement());\n-  }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a9e5a2bbc74ebc72528e16e1ef6b073f8c2f12c"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQzMzc5Ng==", "bodyText": "to replace HoodieTestUtils#monotonicIncreasingCommitTimestamps(int numTimestamps, int startSecsDelta)", "url": "https://github.com/apache/hudi/pull/2079#discussion_r487433796", "createdAt": "2020-09-12T18:05:14Z", "author": {"login": "xushiyan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestTable.java", "diffHunk": "@@ -66,6 +73,30 @@ public static HoodieTestTable of(HoodieTableMetaClient metaClient) {\n     return new HoodieTestTable(metaClient.getBasePath(), metaClient.getRawFs(), metaClient);\n   }\n \n+  public static String makeNewCommitTime(int sequence) {\n+    return String.format(\"%09d\", sequence);\n+  }\n+\n+  public static String makeNewCommitTime() {\n+    return makeNewCommitTime(Instant.now());\n+  }\n+\n+  public static String makeNewCommitTime(Instant time) {\n+    return COMMIT_FORMATTER.format(time);\n+  }\n+\n+  public static List<String> makeNewCommitTimes(int num) {\n+    return makeNewCommitTimes(num, 1);\n+  }\n+\n+  public static List<String> makeNewCommitTimes(int num, int firstOffsetSeconds) {\n+    final Instant now = Instant.now();\n+    return IntStream.range(0, num)\n+        .mapToObj(i ->\n+            makeNewCommitTime(now.plus(i == 0 ? firstOffsetSeconds : firstOffsetSeconds + i, SECONDS)))\n+        .collect(Collectors.toList());\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a9e5a2bbc74ebc72528e16e1ef6b073f8c2f12c"}, "originalPosition": 62}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cbd72a78b898a5af76f94e4d53c3b29d39a8dacd", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/cbd72a78b898a5af76f94e4d53c3b29d39a8dacd", "committedDate": "2020-09-12T18:09:22Z", "message": "[HUDI-995] Use HoodieTestTable in more classes\n\nMigrate test data prep logic in\n- TestStatsCommand\n- TestHoodieROTablePathFilter\n\nRe-implement methods for create new commit times in HoodieTestUtils and HoodieClientTestHarness\n- Move relevant APIs to HoodieTestTable\n- Migrate usages\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils"}, "afterCommit": {"oid": "92ee1e9d6317c44b599d34d6a7c229a3fb290664", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/92ee1e9d6317c44b599d34d6a7c229a3fb290664", "committedDate": "2020-09-12T21:27:24Z", "message": "[HUDI-995] Use HoodieTestTable in more classes\n\nMigrate test data prep logic in\n- TestStatsCommand\n- TestHoodieROTablePathFilter\n\nRe-implement methods for create new commit times in HoodieTestUtils and HoodieClientTestHarness\n- Move relevant APIs to HoodieTestTable\n- Migrate usages\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dcf002af99d8a3ee383a2cf42dede28bb1d7efb", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/7dcf002af99d8a3ee383a2cf42dede28bb1d7efb", "committedDate": "2020-09-12T21:29:32Z", "message": "[HUDI-995] Use HoodieTestTable in more classes\n\nMigrate test data prep logic in\n- TestStatsCommand\n- TestHoodieROTablePathFilter\n\nRe-implement methods for create new commit times in HoodieTestUtils and HoodieClientTestHarness\n- Move relevant APIs to HoodieTestTable\n- Migrate usages\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "92ee1e9d6317c44b599d34d6a7c229a3fb290664", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/92ee1e9d6317c44b599d34d6a7c229a3fb290664", "committedDate": "2020-09-12T21:27:24Z", "message": "[HUDI-995] Use HoodieTestTable in more classes\n\nMigrate test data prep logic in\n- TestStatsCommand\n- TestHoodieROTablePathFilter\n\nRe-implement methods for create new commit times in HoodieTestUtils and HoodieClientTestHarness\n- Move relevant APIs to HoodieTestTable\n- Migrate usages\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils"}, "afterCommit": {"oid": "7dcf002af99d8a3ee383a2cf42dede28bb1d7efb", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/7dcf002af99d8a3ee383a2cf42dede28bb1d7efb", "committedDate": "2020-09-12T21:29:32Z", "message": "[HUDI-995] Use HoodieTestTable in more classes\n\nMigrate test data prep logic in\n- TestStatsCommand\n- TestHoodieROTablePathFilter\n\nRe-implement methods for create new commit times in HoodieTestUtils and HoodieClientTestHarness\n- Move relevant APIs to HoodieTestTable\n- Migrate usages\n\nAfter changing to HoodieTestTable APIs, removed unused deprecated APIs in HoodieTestUtils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzY5NzM2", "url": "https://github.com/apache/hudi/pull/2079#pullrequestreview-487369736", "createdAt": "2020-09-14T01:46:22Z", "commit": {"oid": "7dcf002af99d8a3ee383a2cf42dede28bb1d7efb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMTo0NjoyM1rOHRBcHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMTo0NjoyM1rOHRBcHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYxMTQyMQ==", "bodyText": "redundant indent?", "url": "https://github.com/apache/hudi/pull/2079#discussion_r487611421", "createdAt": "2020-09-14T01:46:23Z", "author": {"login": "yanghua"}, "path": "hudi-client/src/test/java/org/apache/hudi/table/TestCleaner.java", "diffHunk": "@@ -1058,10 +1069,21 @@ public void testCleanPreviousCorruptedCleanFiles() throws IOException {\n         HoodieWriteConfig.newBuilder()\n             .withPath(basePath).withAssumeDatePartitioning(true)\n             .withCompactionConfig(HoodieCompactionConfig.newBuilder()\n-            .withCleanerPolicy(HoodieCleaningPolicy.KEEP_LATEST_FILE_VERSIONS).retainFileVersions(1).build())\n+                .withCleanerPolicy(HoodieCleaningPolicy.KEEP_LATEST_FILE_VERSIONS).retainFileVersions(1).build())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dcf002af99d8a3ee383a2cf42dede28bb1d7efb"}, "originalPosition": 96}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa3ace27428cdcd55afb38cf1ab5c7ca48369f04", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/aa3ace27428cdcd55afb38cf1ab5c7ca48369f04", "committedDate": "2020-09-14T13:02:53Z", "message": "revert indent"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "564d3ec62d46063027d6fc53e6ba77b8fdb75a31", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/564d3ec62d46063027d6fc53e6ba77b8fdb75a31", "committedDate": "2020-09-14T13:00:03Z", "message": "revert indent"}, "afterCommit": {"oid": "aa3ace27428cdcd55afb38cf1ab5c7ca48369f04", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/aa3ace27428cdcd55afb38cf1ab5c7ca48369f04", "committedDate": "2020-09-14T13:02:53Z", "message": "revert indent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88e9afbea96305a44994548ea866502350a863dc", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/88e9afbea96305a44994548ea866502350a863dc", "committedDate": "2020-09-14T14:53:23Z", "message": "Trigger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3OTY2NDY0", "url": "https://github.com/apache/hudi/pull/2079#pullrequestreview-487966464", "createdAt": "2020-09-14T16:52:43Z", "commit": {"oid": "88e9afbea96305a44994548ea866502350a863dc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNjo1Mjo0NFrOHReH7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNjo1Mjo0NFrOHReH7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA4MTM4OQ==", "bodyText": "can we name this something like \"makeIncrementalCommitTimes\"", "url": "https://github.com/apache/hudi/pull/2079#discussion_r488081389", "createdAt": "2020-09-14T16:52:44Z", "author": {"login": "nsivabalan"}, "path": "hudi-common/src/test/java/org/apache/hudi/common/testutils/HoodieTestTable.java", "diffHunk": "@@ -66,6 +74,30 @@ public static HoodieTestTable of(HoodieTableMetaClient metaClient) {\n     return new HoodieTestTable(metaClient.getBasePath(), metaClient.getRawFs(), metaClient);\n   }\n \n+  public static String makeNewCommitTime(int sequence) {\n+    return String.format(\"%09d\", sequence);\n+  }\n+\n+  public static String makeNewCommitTime() {\n+    return makeNewCommitTime(Instant.now());\n+  }\n+\n+  public static String makeNewCommitTime(Instant dateTime) {\n+    return COMMIT_FORMATTER.format(Date.from(dateTime));\n+  }\n+\n+  public static List<String> makeNewCommitTimes(int num) {\n+    return makeNewCommitTimes(num, 1);\n+  }\n+\n+  public static List<String> makeNewCommitTimes(int num, int firstOffsetSeconds) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88e9afbea96305a44994548ea866502350a863dc"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7b35cc54798ba548f381e10af088cbe05c357ef", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/f7b35cc54798ba548f381e10af088cbe05c357ef", "committedDate": "2020-09-14T18:06:11Z", "message": "rename to makeIncrementalCommitTimes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dfac702413d117a5ad83e610aacee85c5365999", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/7dfac702413d117a5ad83e610aacee85c5365999", "committedDate": "2020-09-14T18:25:17Z", "message": "remove redundant ternary operator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3d0af5f6e4b711c96e60da8687bad3d54c5da95", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/f3d0af5f6e4b711c96e60da8687bad3d54c5da95", "committedDate": "2020-09-14T18:24:36Z", "message": "remove redundant ternary operator"}, "afterCommit": {"oid": "7dfac702413d117a5ad83e610aacee85c5365999", "author": {"user": {"login": "xushiyan", "name": "Raymond Xu"}}, "url": "https://github.com/apache/hudi/commit/7dfac702413d117a5ad83e610aacee85c5365999", "committedDate": "2020-09-14T18:25:17Z", "message": "remove redundant ternary operator"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4524, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}