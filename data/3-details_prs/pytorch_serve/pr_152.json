{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MTI5NjYw", "number": 152, "title": "Removed snapshot dependency on model", "bodyText": "Description\nThis PR takes care of concern raised in #130 i.e. remove snapshot dependency on model object.\nFixes #130\nType of change\n\n Bug fix (non-breaking change which fixes an issue)\n\nFeature/Issue validation/testing\nThe changes are internal in nature hence already covered by the existing set of snapshot related UT/ITs.\n\nLogs\nsanity_test.log\n\nChecklist:\n\n Have you added tests that prove your fix is effective or that this feature works?\nNA\n New and existing unit tests pass locally with these changes?\n Has code been commented, particularly in hard-to-understand areas?\nNA\n Have you made corresponding changes to the documentation?\nNA", "createdAt": "2020-04-01T17:24:46Z", "url": "https://github.com/pytorch/serve/pull/152", "merged": true, "mergeCommit": {"oid": "2e4844b251201423709c8285efb22d5e111eab9a"}, "closed": true, "closedAt": "2020-05-07T01:34:52Z", "author": {"login": "dhaniram-kshirsagar"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcStJldgH2gAyMzk3MTI5NjYwOmVjZmQzNWFlZDMyOThkYmYzMmUzNmMyYzNkNjA5MDljNjNlYTE3NGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcezE_OgFqTQwNzA5NDY4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ecfd35aed3298dbf32e36c2c3d60909c63ea174b", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/ecfd35aed3298dbf32e36c2c3d60909c63ea174b", "committedDate": "2020-03-30T11:52:55Z", "message": "Snapshot is now independent of model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90e2a1ee5fa53a48ff8b38626e77c925e6b9fedc", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/90e2a1ee5fa53a48ff8b38626e77c925e6b9fedc", "committedDate": "2020-04-01T15:36:10Z", "message": "merged snapshot latest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c22dcd755c4af9469cade7757f9872e7c1695061", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/c22dcd755c4af9469cade7757f9872e7c1695061", "committedDate": "2020-04-01T16:27:41Z", "message": "fixed checkstyle issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b10550fb19201c50711cfc58c548c89b5cd9f00a", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/b10550fb19201c50711cfc58c548c89b5cd9f00a", "committedDate": "2020-04-01T17:03:17Z", "message": "fixed formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e450d207f80c5630c3f6c50c4776cb2172eade4", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/3e450d207f80c5630c3f6c50c4776cb2172eade4", "committedDate": "2020-04-09T14:45:58Z", "message": "Merge branch 'stage_release' into issue_130"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c75ecd42746895fadf4b55f77c477b0a11a1cbd7", "author": {"user": {"login": "eslesar-aws", "name": "Eric Slesar"}}, "url": "https://github.com/pytorch/serve/commit/c75ecd42746895fadf4b55f77c477b0a11a1cbd7", "committedDate": "2020-04-09T18:38:26Z", "message": "doc review: configuration and custom_service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bc2c094a3a68dede15f75f625096556c3573ab8", "author": {"user": {"login": "eslesar-aws", "name": "Eric Slesar"}}, "url": "https://github.com/pytorch/serve/commit/2bc2c094a3a68dede15f75f625096556c3573ab8", "committedDate": "2020-04-09T22:05:34Z", "message": "addressed review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b871ed67516908fe705accc015a3dc87761a1b84", "author": {"user": {"login": "aaronmarkham", "name": "Aaron Markham"}}, "url": "https://github.com/pytorch/serve/commit/b871ed67516908fe705accc015a3dc87761a1b84", "committedDate": "2020-04-09T22:53:32Z", "message": "Merge pull request #173 from eslesar-aws/doc-review-config-custom\n\ndoc review: configuration.md and custom_service.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c2fe49064c94fb7110cf640492ed2b41576ed80", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/0c2fe49064c94fb7110cf640492ed2b41576ed80", "committedDate": "2020-04-10T05:37:56Z", "message": "Merge branch 'stage_release' into issue_130"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbc281582215a3b9c8ad92c2d78deb660a429796", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/dbc281582215a3b9c8ad92c2d78deb660a429796", "committedDate": "2020-04-10T13:01:57Z", "message": "fixed incorrect merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95808a31aefdb85a2264d3998c927cc874749814", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/95808a31aefdb85a2264d3998c927cc874749814", "committedDate": "2020-04-24T08:48:58Z", "message": "Merge branch 'master' into issue_130"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNzkwMzEw", "url": "https://github.com/pytorch/serve/pull/152#pullrequestreview-403790310", "createdAt": "2020-04-30T18:52:31Z", "commit": {"oid": "95808a31aefdb85a2264d3998c927cc874749814"}, "state": "DISMISSED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxODo1MjozMVrOGO2IHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxODo1NToxMVrOGO2N1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMDA2Mg==", "bodyText": "move \"marName\" to a global name", "url": "https://github.com/pytorch/serve/pull/152#discussion_r418220062", "createdAt": "2020-04-30T18:52:31Z", "author": {"login": "mycpuorg"}, "path": "frontend/server/src/main/java/org/pytorch/serve/snapshot/SnapshotManager.java", "diffHunk": "@@ -170,12 +144,12 @@ private boolean validate(Snapshot snapshot) throws IOException, InvalidSnapshotE\n         logger.info(\"Validating snapshot {}\", snapshot.getName());\n         String modelStore = configManager.getModelStore();\n \n-        Map<String, Map<String, ModelSnapshot>> models = snapshot.getModels();\n-        for (Map.Entry<String, Map<String, ModelSnapshot>> modelMap : models.entrySet()) {\n+        Map<String, Map<String, JsonObject>> models = snapshot.getModels();\n+        for (Map.Entry<String, Map<String, JsonObject>> modelMap : models.entrySet()) {\n             String modelName = modelMap.getKey();\n-            for (Map.Entry<String, ModelSnapshot> versionModel : modelMap.getValue().entrySet()) {\n+            for (Map.Entry<String, JsonObject> versionModel : modelMap.getValue().entrySet()) {\n                 String versionId = versionModel.getKey();\n-                String marName = versionModel.getValue().getMarName();\n+                String marName = versionModel.getValue().get(\"marName\").getAsString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95808a31aefdb85a2264d3998c927cc874749814"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMDU0NQ==", "bodyText": "In general, keep all these const string names to a global location.\nSame here. const strings / prop names to either global location or use getter methods.", "url": "https://github.com/pytorch/serve/pull/152#discussion_r418220545", "createdAt": "2020-04-30T18:53:23Z", "author": {"login": "mycpuorg"}, "path": "frontend/server/src/main/java/org/pytorch/serve/wlm/Model.java", "diffHunk": "@@ -48,6 +50,28 @@ public Model(ModelArchive modelArchive, int queueSize) {\n                         this.modelArchive.getModelName(), this.modelArchive.getModelVersion());\n     }\n \n+    public JsonObject getModelState(boolean isDefaultVersion) {\n+\n+        JsonObject modelInfo = new JsonObject();\n+        modelInfo.addProperty(\"defaultVersion\", isDefaultVersion);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95808a31aefdb85a2264d3998c927cc874749814"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMTA4OQ==", "bodyText": "Same here. const strings / prop names to either global location or use getter methods.", "url": "https://github.com/pytorch/serve/pull/152#discussion_r418221089", "createdAt": "2020-04-30T18:54:23Z", "author": {"login": "mycpuorg"}, "path": "frontend/server/src/main/java/org/pytorch/serve/wlm/ModelManager.java", "diffHunk": "@@ -71,6 +73,29 @@ public ModelArchive registerModel(String url, String defaultModelName)\n                 defaultModelName);\n     }\n \n+    public void registerAndUpdateModel(String modelName, JsonObject modelInfo)\n+            throws ModelException, IOException {\n+\n+        boolean defaultVersion = modelInfo.get(\"defaultVersion\").getAsBoolean();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95808a31aefdb85a2264d3998c927cc874749814"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIyMTUyNg==", "bodyText": "Same here. const strings / prop names to either global location or use getter methods.", "url": "https://github.com/pytorch/serve/pull/152#discussion_r418221526", "createdAt": "2020-04-30T18:55:11Z", "author": {"login": "mycpuorg"}, "path": "frontend/server/src/test/java/org/pytorch/serve/SnapshotTest.java", "diffHunk": "@@ -368,11 +368,11 @@ private void updateSnapshot(Properties prop) {\n         Snapshot snapshot = GSON.fromJson(prop.getProperty(\"model_snapshot\"), Snapshot.class);\n         snapshot.setName(\"snapshot\");\n         snapshot.setCreated(123456);\n-        for (Map.Entry<String, Map<String, ModelSnapshot>> modelMap :\n+        for (Map.Entry<String, Map<String, JsonObject>> modelMap :\n                 snapshot.getModels().entrySet()) {\n-            for (Map.Entry<String, ModelSnapshot> versionModel : modelMap.getValue().entrySet()) {\n-                versionModel.getValue().setMinWorkers(4);\n-                versionModel.getValue().setMaxWorkers(4);\n+            for (Map.Entry<String, JsonObject> versionModel : modelMap.getValue().entrySet()) {\n+                versionModel.getValue().addProperty(\"minWorkers\", 4);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95808a31aefdb85a2264d3998c927cc874749814"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec2533fb4790a62981d02367bf96b31d907adeee", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/ec2533fb4790a62981d02367bf96b31d907adeee", "committedDate": "2020-05-04T11:02:51Z", "message": "Merge branch 'staging_0_1_1' into issue_130"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da4c91be6a9c526ead54b844f3c65b2582606c47", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/da4c91be6a9c526ead54b844f3c65b2582606c47", "committedDate": "2020-05-04T18:32:10Z", "message": "fixed review comments and corrected the error messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6f163851e69c62c68ede486265bcd1d9164cb68", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/c6f163851e69c62c68ede486265bcd1d9164cb68", "committedDate": "2020-05-04T18:32:49Z", "message": "Merge branch 'issue_130' of https://github.com/pytorch/serve into issue_130"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3da7cdb168f1e1450da0f3386b892b7d54c3318", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/b3da7cdb168f1e1450da0f3386b892b7d54c3318", "committedDate": "2020-05-04T18:45:51Z", "message": "adding remaining fixes for string constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ffb9dd8de9dc5b30f7b9bf41604ac6d8a425a48", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/5ffb9dd8de9dc5b30f7b9bf41604ac6d8a425a48", "committedDate": "2020-05-04T18:47:26Z", "message": "Merge branch 'staging_0_1_1' into issue_130"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f0fb5e553bef09a62140b8772523de75cfa7fd7", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/0f0fb5e553bef09a62140b8772523de75cfa7fd7", "committedDate": "2020-05-05T03:11:25Z", "message": "Merge branch 'staging_0_1_1' into issue_130"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MDEzMjkz", "url": "https://github.com/pytorch/serve/pull/152#pullrequestreview-406013293", "createdAt": "2020-05-05T17:40:38Z", "commit": {"oid": "0f0fb5e553bef09a62140b8772523de75cfa7fd7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDk0Njgy", "url": "https://github.com/pytorch/serve/pull/152#pullrequestreview-407094682", "createdAt": "2020-05-07T01:34:25Z", "commit": {"oid": "0f0fb5e553bef09a62140b8772523de75cfa7fd7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2467, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}