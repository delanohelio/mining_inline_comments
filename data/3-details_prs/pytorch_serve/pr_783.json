{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwODYyMjI3", "number": 783, "title": "Fixed: Model reader logging bugs.", "bodyText": "Description\nThe lines read from the stdout/stderr of the handler will now be logged on a distinct logger (the MODEL_LOG). This will give much finer grained control over logging in custom handlers. For example, the log4j settings for MODEL_LOG can be set to log everything with no formatting, giving complete control of the logging situation to the custom handler.\nI believe this is the intended use of the MODEL_LOGGER logger name. Currently it is not used.\nIn addition, the metrics logger is now initialized via a sl4j logging factory rather than through log4j. The call to log metrics was slightly modified to fit with this more generic logger which only accepts String arguments.\nFixes #727\nType of change\nPlease delete options that are not relevant.\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to not work as expected)\n This change requires a documentation update\n\nFeature/Issue validation/testing\nA unit test for the MODEL_LOG already exists, but no code in the server actually used this logger.\nChecklist:\n\n Have you added tests that prove your fix is effective or that this feature works?\n New and existing unit tests pass locally with these changes?\n Has code been commented, particularly in hard-to-understand areas?\n Have you made corresponding changes to the documentation?", "createdAt": "2020-11-13T21:33:39Z", "url": "https://github.com/pytorch/serve/pull/783", "merged": true, "mergeCommit": {"oid": "4f7349a13e98a1f44f76db01af976ed00da5d468"}, "closed": true, "closedAt": "2021-04-19T17:14:18Z", "author": {"login": "aparmentier-coveo"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcOUK4gBqjM5OTU0OTcyNjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeOsKTIAH2gAyNTIwODYyMjI3OmY1ZjNiYmJhNWJiOGIxOTEwZDU3YTc1NzFkYTE5ZTNjNjYwOGI1NzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "58ccd3ba8f320f9a105a9f0c7dde99f516cb07d9", "author": {"user": {"login": "aparmentier-coveo", "name": "Alex Parmentier"}}, "url": "https://github.com/pytorch/serve/commit/58ccd3ba8f320f9a105a9f0c7dde99f516cb07d9", "committedDate": "2020-11-13T20:46:07Z", "message": "Fixed: Model reader logging bugs.\n\n* The lines read from the stdout/stderr of the handler will now be\nlogged on a distinct logger (the MODEL_LOGGER). This gives much finer\ngrained control over logging in custom handlers.\n* The metrics logger is now initialized via and sl4j logging factory\nrather than through log4j. The call to log metrics was slightly modified\nto fit with this more generic logger which only accepts String\narguments."}, "afterCommit": {"oid": "140bcca7b79025146b045d42fb01736d1b007360", "author": {"user": {"login": "aparmentier-coveo", "name": "Alex Parmentier"}}, "url": "https://github.com/pytorch/serve/commit/140bcca7b79025146b045d42fb01736d1b007360", "committedDate": "2020-11-13T21:47:42Z", "message": "Fixed: Model reader logging bugs.\n\n* The lines read from the stdout/stderr of the handler will now be\nlogged on a distinct logger (the MODEL_LOGGER). This gives much finer\ngrained control over logging in custom handlers.\n* The metrics logger is now initialized via and sl4j logging factory\nrather than through log4j. The call to log metrics was slightly modified\nto fit with this more generic logger which only accepts String\narguments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjEyNzk5MTIz", "url": "https://github.com/pytorch/serve/pull/783#pullrequestreview-612799123", "createdAt": "2021-03-16T02:18:58Z", "commit": {"oid": "d691dda23759a83c1d00818615bb8ded612d6e2a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQwMjoxODo1OFrOI3QmdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0xNlQwMjoxODo1OFrOI3QmdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5NDgxNDU4MA==", "bodyText": "These changes store model log in separate log files. It is much easier for user to control model log format. The only problem is that the mapping information b/w frontend worker thread id and backend worker pid is missing. It will be difficult to debug TS to detect if there is sth wrong with frontend worker thread.", "url": "https://github.com/pytorch/serve/pull/783#discussion_r594814580", "createdAt": "2021-03-16T02:18:58Z", "author": {"login": "lxning"}, "path": "frontend/server/src/main/java/org/pytorch/serve/wlm/WorkerLifeCycle.java", "diffHunk": "@@ -141,8 +141,10 @@ private synchronized void setPort(int port) {\n         private boolean error;\n         private WorkerLifeCycle lifeCycle;\n         private AtomicBoolean isRunning = new AtomicBoolean(true);\n-        private static final org.apache.log4j.Logger loggerModelMetrics =\n-                org.apache.log4j.Logger.getLogger(ConfigManager.MODEL_METRICS_LOGGER);\n+        private static final Logger loggerModelMetrics =\n+                LoggerFactory.getLogger(ConfigManager.MODEL_METRICS_LOGGER);\n+        private static final Logger loggerModelOutput =\n+                LoggerFactory.getLogger(ConfigManager.MODEL_LOGGER);\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d691dda23759a83c1d00818615bb8ded612d6e2a"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebdfce3ac6b1d267092f9388a5c9963d3b654126", "author": {"user": {"login": "aparmentier-coveo", "name": "Alex Parmentier"}}, "url": "https://github.com/pytorch/serve/commit/ebdfce3ac6b1d267092f9388a5c9963d3b654126", "committedDate": "2021-03-17T20:47:08Z", "message": "Fixed: Model reader logging bugs.\n\n* The lines read from the stdout/stderr of the handler will now be\nlogged on a distinct logger (the MODEL_LOGGER). This gives much finer\ngrained control over logging in custom handlers.\n* The metrics logger is now initialized via and sl4j logging factory\nrather than through log4j. The call to log metrics was slightly modified\nto fit with this more generic logger which only accepts String\narguments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "810eee04605c50a15661c17398383ffef3c0617b", "author": {"user": {"login": "aparmentier-coveo", "name": "Alex Parmentier"}}, "url": "https://github.com/pytorch/serve/commit/810eee04605c50a15661c17398383ffef3c0617b", "committedDate": "2021-03-17T20:47:08Z", "message": "Fixed: MODEL_LOG thread name added."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d691dda23759a83c1d00818615bb8ded612d6e2a", "author": {"user": {"login": "aparmentier-coveo", "name": "Alex Parmentier"}}, "url": "https://github.com/pytorch/serve/commit/d691dda23759a83c1d00818615bb8ded612d6e2a", "committedDate": "2021-01-08T18:27:49Z", "message": "Merge remote-tracking branch 'master/master' into logging/fix-model-reader"}, "afterCommit": {"oid": "810eee04605c50a15661c17398383ffef3c0617b", "author": {"user": {"login": "aparmentier-coveo", "name": "Alex Parmentier"}}, "url": "https://github.com/pytorch/serve/commit/810eee04605c50a15661c17398383ffef3c0617b", "committedDate": "2021-03-17T20:47:08Z", "message": "Fixed: MODEL_LOG thread name added."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjE0OTQ3MTg2", "url": "https://github.com/pytorch/serve/pull/783#pullrequestreview-614947186", "createdAt": "2021-03-18T03:13:37Z", "commit": {"oid": "810eee04605c50a15661c17398383ffef3c0617b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjM4MDEwODk5", "url": "https://github.com/pytorch/serve/pull/783#pullrequestreview-638010899", "createdAt": "2021-04-16T19:05:34Z", "commit": {"oid": "810eee04605c50a15661c17398383ffef3c0617b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26f9b5ba9d43ac384a7ca7b95a26a7fb1987ba4b", "author": {"user": {"login": "dhanainme", "name": null}}, "url": "https://github.com/pytorch/serve/commit/26f9b5ba9d43ac384a7ca7b95a26a7fb1987ba4b", "committedDate": "2021-04-16T19:06:10Z", "message": "Merge branch 'master' into logging/fix-model-reader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f090d6ced3da95287fca96a48ac06bf73fb170bb", "author": {"user": {"login": "lxning", "name": null}}, "url": "https://github.com/pytorch/serve/commit/f090d6ced3da95287fca96a48ac06bf73fb170bb", "committedDate": "2021-04-19T16:16:05Z", "message": "Merge branch 'master' into logging/fix-model-reader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5f3bbba5bb8b1910d57a7571da19e3c6608b571", "author": {"user": {"login": "lxning", "name": null}}, "url": "https://github.com/pytorch/serve/commit/f5f3bbba5bb8b1910d57a7571da19e3c6608b571", "committedDate": "2021-04-19T16:50:24Z", "message": "Merge branch 'master' into logging/fix-model-reader"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2128, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}