{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMjM3MDMz", "number": 377, "title": "Added scripts to build torchserve and torch-model-archiver release wheels", "bodyText": "Description\nAdded scripts to build torchserve and torch-model-archiver release wheels\nFixes #289\nType of change\nPlease delete options that are not relevant.\n\n New feature (non-breaking change which adds functionality)\n This change requires a documentation update\n\nFeature/Issue validation/testing\nTested wheels as well as conda packages on c4.2xlarge instance with DL AMI 29.0\n\nLogs\n\ntest_wheels.log\nconda_package.log\nChecklist:\n\n Have you added tests that prove your fix is effective or that this feature works?\n New and existing unit tests pass locally with these changes?\n Has code been commented, particularly in hard-to-understand areas?\n Have you made corresponding changes to the documentation?", "createdAt": "2020-05-21T09:01:00Z", "url": "https://github.com/pytorch/serve/pull/377", "merged": true, "mergeCommit": {"oid": "01088a790170ae7935d85363dc09f72ce29104b8"}, "closed": true, "closedAt": "2020-07-23T18:21:56Z", "author": {"login": "harshbafna"}, "timelineItems": {"totalCount": 35, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjZtGPgH2gAyNDIxMjM3MDMzOjQ2ZjNkN2RhYmQwNjJmNjEyZWI2ZjJhYTUwOWY3ODViYmQ4ZjBhMGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3zTuMgH2gAyNDIxMjM3MDMzOmM0ZjEwNmMyYWNmMzJmNGJmY2M2MjlhOWMxZGYxYWMxY2U5ZTk3NWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "46f3d7dabd062f612eb6f2aa509f785bbd8f0a0e", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/46f3d7dabd062f612eb6f2aa509f785bbd8f0a0e", "committedDate": "2020-05-21T08:50:19Z", "message": "added scripts to build torchserve and torch-model-archiver wheels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "155384646228b8e394e61735b3e09377b5d415ec", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/155384646228b8e394e61735b3e09377b5d415ec", "committedDate": "2020-05-21T09:01:09Z", "message": "Merge branch 'staging_0_1_1' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a445dfb0b0f07ea499878b9834469c11a5de0fca", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/a445dfb0b0f07ea499878b9834469c11a5de0fca", "committedDate": "2020-05-25T11:03:56Z", "message": "Merge branch 'staging_0_1_1' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59943ab1b91fd3adb0834404c67fc25862ced286", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/59943ab1b91fd3adb0834404c67fc25862ced286", "committedDate": "2020-05-25T14:25:17Z", "message": "templatized conda meta.yaml for version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f7b0c268ca564e2ede19b2e44a5b806738ea37b", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/0f7b0c268ca564e2ede19b2e44a5b806738ea37b", "committedDate": "2020-05-26T12:08:46Z", "message": "added steps to install dependencies for building wheels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a195875ec7a4ed8cb6601a3c6c87a0c4885d4646", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/a195875ec7a4ed8cb6601a3c6c87a0c4885d4646", "committedDate": "2020-05-26T12:09:00Z", "message": "updated readme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "880563789b0e3f01c93b9ec09a1529daaf396909", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/880563789b0e3f01c93b9ec09a1529daaf396909", "committedDate": "2020-05-26T12:13:22Z", "message": "corrected path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fb5106744147cfa3186510f912b0afa60a359c2", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/5fb5106744147cfa3186510f912b0afa60a359c2", "committedDate": "2020-05-26T13:09:09Z", "message": "generalised install java dep for macos and ubuntu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "729151670771dfbad09f534f023c4e40bca7ef03", "author": {"user": {"login": "chauhang", "name": "Geeta Chauhan"}}, "url": "https://github.com/pytorch/serve/commit/729151670771dfbad09f534f023c4e40bca7ef03", "committedDate": "2020-05-27T04:44:42Z", "message": "Merge branch 'staging_0_1_1' into issue_289"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5MzkwMTU1", "url": "https://github.com/pytorch/serve/pull/377#pullrequestreview-419390155", "createdAt": "2020-05-27T16:14:43Z", "commit": {"oid": "729151670771dfbad09f534f023c4e40bca7ef03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNjoxNDo0M1rOGbSkhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNjoxNDo0M1rOGbSkhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI2ODk5Ng==", "bodyText": "It's worth adding these version files in this change to start with \"0.1.0\"", "url": "https://github.com/pytorch/serve/pull/377#discussion_r431268996", "createdAt": "2020-05-27T16:14:43Z", "author": {"login": "mycpuorg"}, "path": "binaries/conda/build_packages.sh", "diffHunk": "@@ -4,12 +4,18 @@ set -eou pipefail\n \n PYTHON_VERSIONS=\"3.6 3.7 3.8\"\n PKGS=\"torchserve torch-model-archiver\"\n+TORCHSERVE_VERSION=`cat ../../ts/version.txt`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "729151670771dfbad09f534f023c4e40bca7ef03"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5MzkwNzY4", "url": "https://github.com/pytorch/serve/pull/377#pullrequestreview-419390768", "createdAt": "2020-05-27T16:15:29Z", "commit": {"oid": "729151670771dfbad09f534f023c4e40bca7ef03"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c6bf0d45d780ebd12bb97bc6802612d2feea3e1", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/2c6bf0d45d780ebd12bb97bc6802612d2feea3e1", "committedDate": "2020-05-29T04:47:55Z", "message": "Merge branch 'staging_0_1_1' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cee918be724b96838e74c2d8a0eb3b8a4d5d6d5", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/5cee918be724b96838e74c2d8a0eb3b8a4d5d6d5", "committedDate": "2020-05-29T06:27:03Z", "message": "Merge branch 'staging_0_1_1' into issue_289"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMjMxNzg5", "url": "https://github.com/pytorch/serve/pull/377#pullrequestreview-421231789", "createdAt": "2020-05-29T19:32:45Z", "commit": {"oid": "5cee918be724b96838e74c2d8a0eb3b8a4d5d6d5"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOTozMjo0NVrOGcpcYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOTozNTozNFrOGcphEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MjMyMw==", "bodyText": "For our shell scripts we prefer to use the $() notation versus back-ticks for executing commands.\nJust to keep things consistent.", "url": "https://github.com/pytorch/serve/pull/377#discussion_r432692323", "createdAt": "2020-05-29T19:32:45Z", "author": {"login": "seemethere"}, "path": "binaries/conda/build_packages.sh", "diffHunk": "@@ -4,12 +4,18 @@ set -eou pipefail\n \n PYTHON_VERSIONS=\"3.6 3.7 3.8\"\n PKGS=\"torchserve torch-model-archiver\"\n+TORCHSERVE_VERSION=`cat ../../ts/version.txt`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cee918be724b96838e74c2d8a0eb3b8a4d5d6d5"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5Mjk2OA==", "bodyText": "For this we can actually for-go having to use a template at all and instead prefer to use environment variables here.\nFor reference, this is how we do it for our upstream pytorch conda packages:\npackage:\n  name: pytorch\n  version: \"{{ environ.get('PYTORCH_BUILD_VERSION') }}\"\nhttps://github.com/pytorch/builder/blob/191b23db356f04b7501cfc818c45a1a4db66d7db/conda/pytorch-nightly/meta.yaml#L1-L3", "url": "https://github.com/pytorch/serve/pull/377#discussion_r432692968", "createdAt": "2020-05-29T19:34:17Z", "author": {"login": "seemethere"}, "path": "binaries/conda/build_packages.sh", "diffHunk": "@@ -4,12 +4,18 @@ set -eou pipefail\n \n PYTHON_VERSIONS=\"3.6 3.7 3.8\"\n PKGS=\"torchserve torch-model-archiver\"\n+TORCHSERVE_VERSION=`cat ../../ts/version.txt`\n+TORCH_MODEL_ARCHIVER_VERSION=`cat ../../model-archiver/model_archiver/version.txt`\n \n for pkg in ${PKGS}; do\n+    PKG_VERSION=$(echo $pkg | tr 'a-z' 'A-Z' | tr '-' '_')_VERSION\n+    cat $pkg/meta.yaml.tmpl | sed -e \"s/{version}/$PKG_VERSION/\" >> $pkg/meta.yaml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cee918be724b96838e74c2d8a0eb3b8a4d5d6d5"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MzUyMQ==", "bodyText": "To make it so that cleanup is always run, regardless of where you exit in the script you can use a trap, see https://tldp.org/LDP/Bash-Beginners-Guide/html/sect_12_02.html", "url": "https://github.com/pytorch/serve/pull/377#discussion_r432693521", "createdAt": "2020-05-29T19:35:34Z", "author": {"login": "seemethere"}, "path": "binaries/pip/build_wheels.sh", "diffHunk": "@@ -0,0 +1,50 @@\n+#!/usr/bin/env bash\n+\n+set -eou pipefail\n+\n+source ../../scripts/install_utils\n+\n+cleanup()\n+{\n+  rm -rf dist\n+  rm -rf build\n+  rm -rf *.egg-info\n+}\n+\n+create_torchserve_wheel()\n+{\n+  cd ../../\n+\n+  python setup.py bdist_wheel --release --universal\n+\n+  cp dist/*.whl binaries/pip/output/\n+\n+  cleanup\n+\n+  cd -\n+}\n+\n+create_model_archiver_wheel()\n+{\n+  cd ../../model-archiver\n+\n+  python setup.py bdist_wheel --release --universal\n+\n+  cp dist/*.whl ../binaries/pip/output/\n+\n+  cleanup", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cee918be724b96838e74c2d8a0eb3b8a4d5d6d5"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10d6977dd687d188b53a1db385c6f59847987883", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/10d6977dd687d188b53a1db385c6f59847987883", "committedDate": "2020-06-01T06:05:48Z", "message": "replaced template files with environment variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c118ba26b7bc6e1286be36f9b65b101306590c6", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/7c118ba26b7bc6e1286be36f9b65b101306590c6", "committedDate": "2020-06-01T08:34:16Z", "message": "Merge branch 'staging_0_1_1' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3447dcb8a48822b52fa5e896fbbfb2bad56b06ab", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/3447dcb8a48822b52fa5e896fbbfb2bad56b06ab", "committedDate": "2020-06-01T14:58:14Z", "message": "added traps for cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ced453d0e46e8eed7b8099a1871bc32c921c278", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/1ced453d0e46e8eed7b8099a1871bc32c921c278", "committedDate": "2020-06-01T14:59:44Z", "message": "Merge branch 'issue_289' of https://github.com/pytorch/serve into issue_289"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzQ1NzA2", "url": "https://github.com/pytorch/serve/pull/377#pullrequestreview-423745706", "createdAt": "2020-06-03T16:48:08Z", "commit": {"oid": "1ced453d0e46e8eed7b8099a1871bc32c921c278"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fef43d4859fb17ea72f51e8e4b6c888080ace06", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/1fef43d4859fb17ea72f51e8e4b6c888080ace06", "committedDate": "2020-06-06T03:15:22Z", "message": "Merge branch 'staging_0_1_1' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "437ac963ff6e38a4f3cacdf36e065e438682a2f7", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/437ac963ff6e38a4f3cacdf36e065e438682a2f7", "committedDate": "2020-06-10T03:02:23Z", "message": "Merge branch 'staging_0_1_1' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e68d6b86cc9f7a49db758c2bc163df9e522b4488", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/e68d6b86cc9f7a49db758c2bc163df9e522b4488", "committedDate": "2020-06-19T06:12:29Z", "message": "Merge branch 'master' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a6c2401eb7266263ede837d425221b12479b0ad", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/5a6c2401eb7266263ede837d425221b12479b0ad", "committedDate": "2020-06-19T06:14:27Z", "message": "rebased to master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "208c18040bea247865f2f1a8bde90d453ef6b038", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/208c18040bea247865f2f1a8bde90d453ef6b038", "committedDate": "2020-06-26T05:03:51Z", "message": "Merge branch 'master' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f157f32eccc8ac4ecd97025a98a14e0656ca00d0", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/f157f32eccc8ac4ecd97025a98a14e0656ca00d0", "committedDate": "2020-06-26T10:41:42Z", "message": "Merge branch 'master' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df42a92d7f00ef2bf4ee9af3ed15a94fed627ce7", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/df42a92d7f00ef2bf4ee9af3ed15a94fed627ce7", "committedDate": "2020-07-03T08:20:50Z", "message": "Merge branch 'master' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c61587a72559fca9ddf43d6eeea4fbe14e79707", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/6c61587a72559fca9ddf43d6eeea4fbe14e79707", "committedDate": "2020-07-07T03:28:14Z", "message": "Merge branch 'master' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9264f7530914991927f746800ff5a1535ba8d10", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/f9264f7530914991927f746800ff5a1535ba8d10", "committedDate": "2020-07-08T04:02:27Z", "message": "Merge branch 'master' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea35877bd35870f23647507f055f9e76002f422a", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/ea35877bd35870f23647507f055f9e76002f422a", "committedDate": "2020-07-15T05:47:42Z", "message": "Merge branch 'master' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "058c6b952d93cc325ca48f3b2b3e0bd9a1aa2fc9", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/058c6b952d93cc325ca48f3b2b3e0bd9a1aa2fc9", "committedDate": "2020-07-18T01:56:52Z", "message": "Merge branch 'master' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c43c757a877b402d8ebbe543906664720e57d651", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/c43c757a877b402d8ebbe543906664720e57d651", "committedDate": "2020-07-22T13:05:21Z", "message": "merged master and resolved conficts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e1f8f848e15fed2164f3194722ff2c68e2c32f9", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/2e1f8f848e15fed2164f3194722ff2c68e2c32f9", "committedDate": "2020-07-22T15:07:01Z", "message": "Merge branch 'master' into issue_289"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fd03846b3445604d5726e90b4b6c1e1f18fbe61", "author": {"user": {"login": "maaquib", "name": "Aaqib"}}, "url": "https://github.com/pytorch/serve/commit/3fd03846b3445604d5726e90b4b6c1e1f18fbe61", "committedDate": "2020-07-23T16:20:14Z", "message": "Merge branch 'master' into issue_289"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MzU4NDc5", "url": "https://github.com/pytorch/serve/pull/377#pullrequestreview-454358479", "createdAt": "2020-07-23T17:42:27Z", "commit": {"oid": "3fd03846b3445604d5726e90b4b6c1e1f18fbe61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4f106c2acf32f4bfcc629a9c1df1ac1ce9e975a", "author": {"user": {"login": "maaquib", "name": "Aaqib"}}, "url": "https://github.com/pytorch/serve/commit/c4f106c2acf32f4bfcc629a9c1df1ac1ce9e975a", "committedDate": "2020-07-23T17:58:37Z", "message": "Merge branch 'master' into issue_289"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2150, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}