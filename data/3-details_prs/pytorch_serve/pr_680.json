{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzODgxMTU0", "number": 680, "title": "Gpu usage info and pid of workers in model description API", "bodyText": "Description\nCurrently, the Model Description API gives no GPU usage info nor the PID of workers, which is not convenient for those who want to manage the status of running models. So in this PR, I have added the gpu-usage and pid of workers fields in the Model Description API.\nFixes #597\nType of change\nPlease delete options that are not relevant.\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to not work as expected)\n This change requires a documentation update\n\nTest Logs\nFollowing are the test logs,\nubuntu@ip-172-31-41-36:~$ curl http://localhost:8081/models/densenet161\n[\n  {\n    \"modelName\": \"densenet161\",\n    \"modelVersion\": \"1.0\",\n    \"modelUrl\": \"densenet161.mar\",\n    \"runtime\": \"python\",\n    \"minWorkers\": 4,\n    \"maxWorkers\": 4,\n    \"batchSize\": 1,\n    \"maxBatchDelay\": 100,\n    \"loadedAtStartup\": true,\n    \"workers\": [\n      {\n        \"id\": \"9000\",\n        \"startTime\": \"2020-09-10T12:55:20.122Z\",\n        \"status\": \"READY\",\n        \"gpu\": true,\n        \"memoryUsage\": 3454746624,\n        \"pid\": 9083,\n        \"gpuUsage\": \"gpuId::1 utilization.gpu [%]::0 %   utilization.memory [%]::0 %   memory.used [MiB]::1322 MiB \"\n      },\n      {\n        \"id\": \"9001\",\n        \"startTime\": \"2020-09-10T12:55:20.124Z\",\n        \"status\": \"READY\",\n        \"gpu\": true,\n        \"memoryUsage\": 3434995712,\n        \"pid\": 9081,\n        \"gpuUsage\": \"gpuId::2 utilization.gpu [%]::0 %   utilization.memory [%]::0 %   memory.used [MiB]::1322 MiB \"\n      },\n      {\n        \"id\": \"9002\",\n        \"startTime\": \"2020-09-10T12:55:20.124Z\",\n        \"status\": \"READY\",\n        \"gpu\": true,\n        \"memoryUsage\": 3452321792,\n        \"pid\": 9082,\n        \"gpuUsage\": \"gpuId::3 utilization.gpu [%]::0 %   utilization.memory [%]::0 %   memory.used [MiB]::1322 MiB \"\n      },\n      {\n        \"id\": \"9003\",\n        \"startTime\": \"2020-09-10T12:55:20.124Z\",\n        \"status\": \"READY\",\n        \"gpu\": true,\n        \"memoryUsage\": 2712588288,\n        \"pid\": 9080,\n        \"gpuUsage\": \"gpuId::0 utilization.gpu [%]::0 %   utilization.memory [%]::0 %   memory.used [MiB]::5255 MiB \"\n      }\n    ]\n  }\n]", "createdAt": "2020-09-10T13:49:37Z", "url": "https://github.com/pytorch/serve/pull/680", "merged": true, "mergeCommit": {"oid": "f73ba66497fbce1b950858b7fc85f3842bd358a0"}, "closed": true, "closedAt": "2020-10-22T17:26:02Z", "author": {"login": "AshwinChafale"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-xmEbgH2gAyNDgzODgxMTU0OjI3ZTRmMWRhMmJhNTY0NDRjZGVlZWNmMjIzNTQ4NmU5MTVmMzMzNGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUy37qAFqTUxNDEzMzUwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "27e4f1da2ba56444cdeeecf2235486e915f3334c", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/27e4f1da2ba56444cdeeecf2235486e915f3334c", "committedDate": "2020-08-14T09:56:19Z", "message": "Merge pull request #1 from pytorch/master\n\nMerging the current changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "992fbfcaa63532d5e9982cee4ba6f3b9fbab83a7", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/992fbfcaa63532d5e9982cee4ba6f3b9fbab83a7", "committedDate": "2020-08-14T10:10:57Z", "message": "Added environment header in Sanity & Regression test suite"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34ca16898ee8499de550c3b7c51fd5c6ea7691bf", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/34ca16898ee8499de550c3b7c51fd5c6ea7691bf", "committedDate": "2020-08-14T10:11:56Z", "message": "Added collect_env.py python script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56db69965148bf808474ba0ade2dea98e4423c67", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/56db69965148bf808474ba0ade2dea98e4423c67", "committedDate": "2020-09-03T14:57:26Z", "message": "Undo few unwanted changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daea5794cee2f178fd1894b21b09ed3ff1508ad8", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/daea5794cee2f178fd1894b21b09ed3ff1508ad8", "committedDate": "2020-09-07T07:57:42Z", "message": "Added cuda memory usage info and pid of workers in model description API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fcedcac389cea5d71bb9ff6e8c75d4eba429062", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/2fcedcac389cea5d71bb9ff6e8c75d4eba429062", "committedDate": "2020-09-07T11:54:05Z", "message": "Modified WorkerThread.java file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "963f26c890cd3f853c2d662a03e7ec41be56e65b", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/963f26c890cd3f853c2d662a03e7ec41be56e65b", "committedDate": "2020-09-07T13:26:01Z", "message": "."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef892d7d852d015eda92c73fa6d52ed9a5d47f4a", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/ef892d7d852d015eda92c73fa6d52ed9a5d47f4a", "committedDate": "2020-09-07T13:39:29Z", "message": "."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fa04efd60420b1c9687944ac132671e3d03a720", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/6fa04efd60420b1c9687944ac132671e3d03a720", "committedDate": "2020-09-07T14:21:25Z", "message": "."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7027ae9fd3b4808855eb3262dcf42faf9e40c237", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/7027ae9fd3b4808855eb3262dcf42faf9e40c237", "committedDate": "2020-09-07T14:27:15Z", "message": ".."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44bcd6dfd60fb18ee5e36e6cef1b9f5a3ea0a8b3", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/44bcd6dfd60fb18ee5e36e6cef1b9f5a3ea0a8b3", "committedDate": "2020-09-07T14:34:45Z", "message": "Updated WorkerThread.java file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b4e4f7fadb2cc8c4ec5b94420629166395724ac", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/7b4e4f7fadb2cc8c4ec5b94420629166395724ac", "committedDate": "2020-09-10T12:48:56Z", "message": "Show gpuUsage specific to gpu-id on which the model is loaded"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc3e3631ce3d5626495b24eafe5dc03c37d6c200", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/dc3e3631ce3d5626495b24eafe5dc03c37d6c200", "committedDate": "2020-09-10T13:10:32Z", "message": "Deleted cuda_script.py file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a5e0c13dee440943a1da7c32d86e6d872832d68", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/2a5e0c13dee440943a1da7c32d86e6d872832d68", "committedDate": "2020-09-10T13:59:53Z", "message": "Fixed sanity failed log : Array brackets at illegal position."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b113aa4513b926e08e121e6cc5dc4fab24cc1aa", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/1b113aa4513b926e08e121e6cc5dc4fab24cc1aa", "committedDate": "2020-09-10T14:02:27Z", "message": " Fixed sanity failed log : Array brackets at illegal position."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34072d25a11457c848ee646d4de135379a0fbe9d", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/34072d25a11457c848ee646d4de135379a0fbe9d", "committedDate": "2020-09-10T14:23:21Z", "message": "Merge pull request #2 from pytorch/master\n\nMerging changes from origin repo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be5246ceb6fe5947891247bedff7411d98e3858c", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/be5246ceb6fe5947891247bedff7411d98e3858c", "committedDate": "2020-09-11T06:01:04Z", "message": "Updated WorkerThread.java file to handle Cannot run program nvidia-smi error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78c8bf7665dafdee9d744e2a29e7ab9461fc5377", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/78c8bf7665dafdee9d744e2a29e7ab9461fc5377", "committedDate": "2020-09-11T06:01:48Z", "message": "Merge branch 'issue_597' of https://github.com/AshwinChafale/serve into issue_597"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NzA1MTE3", "url": "https://github.com/pytorch/serve/pull/680#pullrequestreview-487705117", "createdAt": "2020-09-14T12:33:08Z", "commit": {"oid": "78c8bf7665dafdee9d744e2a29e7ab9461fc5377"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4559837050a82f1ada86fa0120b5bf3d1480a99", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/f4559837050a82f1ada86fa0120b5bf3d1480a99", "committedDate": "2020-09-14T16:32:09Z", "message": "Corrected PWD violations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32905235f9577c97fedfdfe84d45bdad14e6d424", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/32905235f9577c97fedfdfe84d45bdad14e6d424", "committedDate": "2020-09-14T16:42:08Z", "message": "Updated WorkerThread.java file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bda0ec8fd8aa681dcbd1c81f3f83cdc1e0035fa", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/9bda0ec8fd8aa681dcbd1c81f3f83cdc1e0035fa", "committedDate": "2020-09-15T04:26:26Z", "message": "Merge branch 'master' into issue_597"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4ODAxOTMx", "url": "https://github.com/pytorch/serve/pull/680#pullrequestreview-498801931", "createdAt": "2020-09-29T19:13:28Z", "commit": {"oid": "9bda0ec8fd8aa681dcbd1c81f3f83cdc1e0035fa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOToxMzoyOFrOHZ9EMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxOToxNzo1MlrOHZ9TFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk3Njk0NA==", "bodyText": "NIT: This seems to be nvidia specific. Can you investigate if we can do this in a more generic way using some opengl java library?", "url": "https://github.com/pytorch/serve/pull/680#discussion_r496976944", "createdAt": "2020-09-29T19:13:28Z", "author": {"login": "maaquib"}, "path": "frontend/server/src/main/java/org/pytorch/serve/wlm/WorkerThread.java", "diffHunk": "@@ -76,6 +80,47 @@ public WorkerState getState() {\n         return state;\n     }\n \n+    public String getGpuUsage() {\n+        Process process;\n+        StringBuffer gpuUsage = new StringBuffer();\n+        if (gpuId >= 0) {\n+            try {\n+                process =\n+                        Runtime.getRuntime()\n+                                .exec(\n+                                        \"nvidia-smi -i \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bda0ec8fd8aa681dcbd1c81f3f83cdc1e0035fa"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk4MDc1OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            InputStream stdout = process.getInputStream();\n          \n          \n            \n                            process.waitFor();\n          \n          \n            \n                            int exitCode = process.exitValue();\n          \n          \n            \n                            if (exitCode != 0) {\n          \n          \n            \n                                // Log error message from process.getErrorStream() and return\n          \n          \n            \n                            }\n          \n          \n            \n                            InputStream stdout = process.getInputStream();", "url": "https://github.com/pytorch/serve/pull/680#discussion_r496980758", "createdAt": "2020-09-29T19:17:52Z", "author": {"login": "maaquib"}, "path": "frontend/server/src/main/java/org/pytorch/serve/wlm/WorkerThread.java", "diffHunk": "@@ -76,6 +80,47 @@ public WorkerState getState() {\n         return state;\n     }\n \n+    public String getGpuUsage() {\n+        Process process;\n+        StringBuffer gpuUsage = new StringBuffer();\n+        if (gpuId >= 0) {\n+            try {\n+                process =\n+                        Runtime.getRuntime()\n+                                .exec(\n+                                        \"nvidia-smi -i \"\n+                                                + gpuId\n+                                                + \" --query-gpu=utilization.gpu,utilization.memory,memory.used --format=csv\");\n+                InputStream stdout = process.getInputStream();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bda0ec8fd8aa681dcbd1c81f3f83cdc1e0035fa"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23a2a740a3465d13526d5a2ce564f3863257127a", "author": {"user": {"login": "maaquib", "name": "Aaqib"}}, "url": "https://github.com/pytorch/serve/commit/23a2a740a3465d13526d5a2ce564f3863257127a", "committedDate": "2020-09-29T19:19:50Z", "message": "Merge branch 'master' into issue_597"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4ODA2OTYy", "url": "https://github.com/pytorch/serve/pull/680#pullrequestreview-498806962", "createdAt": "2020-09-29T19:20:38Z", "commit": {"oid": "23a2a740a3465d13526d5a2ce564f3863257127a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c6b55a1ec27037dea6e609352cd4341341d56d8", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/5c6b55a1ec27037dea6e609352cd4341341d56d8", "committedDate": "2020-09-30T11:36:35Z", "message": "Update frontend/server/src/main/java/org/pytorch/serve/wlm/WorkerThread.java\n\nCo-authored-by: Aaqib <maaquib@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a03dfe5a53b88f806745df116a5b6bc405a49818", "author": {"user": {"login": "AshwinChafale", "name": "Ashwin Chafale"}}, "url": "https://github.com/pytorch/serve/commit/a03dfe5a53b88f806745df116a5b6bc405a49818", "committedDate": "2020-09-30T12:01:31Z", "message": "Updated server/src/main/java/org/pytorch/serve/wlm/WorkerThread.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9408b31fe158889648cef5f4f360dd6e7ea3137b", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/9408b31fe158889648cef5f4f360dd6e7ea3137b", "committedDate": "2020-10-14T09:01:12Z", "message": "Merge branch 'master' into issue_597"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90a4900abe985769d2786f668b3978c3d154fe70", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/90a4900abe985769d2786f668b3978c3d154fe70", "committedDate": "2020-10-14T12:10:06Z", "message": "added todo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07a03314aca24b71deb7ef2f287733da9f0c30d4", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/07a03314aca24b71deb7ef2f287733da9f0c30d4", "committedDate": "2020-10-14T12:20:14Z", "message": "fixed java formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTg2NjUw", "url": "https://github.com/pytorch/serve/pull/680#pullrequestreview-512986650", "createdAt": "2020-10-20T17:48:47Z", "commit": {"oid": "07a03314aca24b71deb7ef2f287733da9f0c30d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22a5c58b8302ece3cef827056927e779537e7adf", "author": {"user": {"login": "maaquib", "name": "Aaqib"}}, "url": "https://github.com/pytorch/serve/commit/22a5c58b8302ece3cef827056927e779537e7adf", "committedDate": "2020-10-21T17:28:49Z", "message": "Merge branch 'master' into issue_597"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTMzNTA3", "url": "https://github.com/pytorch/serve/pull/680#pullrequestreview-514133507", "createdAt": "2020-10-21T19:52:04Z", "commit": {"oid": "22a5c58b8302ece3cef827056927e779537e7adf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2075, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}