{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMDQ4ODYy", "number": 302, "title": "Huggingface Transformers generalization", "bodyText": "Description\nGeneralizing the Huggingface transformers handler, to handle different models such as BERT, RoBERTa, XLM, etc. for use cases defined in the AutoModel class such as AutoModelForSequenceClassification, AutoModelForQuestionAnswering, AutoModelForTokenClassification, and AutoModelWithLMHead will be added later.\nFixes #(issue)\nAdding a generalized handler for  Huggingface transformers, issue_267.\nType of change\n\n New feature (non-breaking change which adds functionality)\n\nFeature/Issue validation/testing\nFollowing the procedure in the REAMDE, can reproduce the results.\nChecklist:\n\n Have you added tests that prove your fix is effective or that this feature works?\n Has code been commented, particularly in hard-to-understand areas?\n Have you made corresponding changes to the documentation?", "createdAt": "2020-05-04T16:17:09Z", "url": "https://github.com/pytorch/serve/pull/302", "merged": true, "mergeCommit": {"oid": "d720e3bb7cfe8fd8e3ddc882a1ab657c6f6225dd"}, "closed": true, "closedAt": "2020-05-18T19:02:40Z", "author": {"login": "HamidShojanazeri"}, "timelineItems": {"totalCount": 62, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABca59RxAH2gAyNDEzMDQ4ODYyOjYxYjc4MjVmODQ5ZTI4YmYwOWIyNGM0NDE1ZGQ2NTEwZjdhYjA5YWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcikU3kgH2gAyNDEzMDQ4ODYyOjY4YzZlOTUxM2VmMWNmOWUxMzgyMmZkNjIyZjI4MDNjMzMxMWQ2ZWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61b7825f849e28bf09b24c4415dd6510f7ab09aa", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/61b7825f849e28bf09b24c4415dd6510f7ab09aa", "committedDate": "2020-04-24T23:19:38Z", "message": "Scripts to seriliaze a Bert model using jit.trace and a handler for Bert model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49d00121ae05a01f03a1bfce00160dd21b1bb361", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/49d00121ae05a01f03a1bfce00160dd21b1bb361", "committedDate": "2020-04-25T05:15:28Z", "message": "modified to include mapping of predicitons and decoding received text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a4d5941fce84d8a90f90717549dcb29750f23cc", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/2a4d5941fce84d8a90f90717549dcb29750f23cc", "committedDate": "2020-04-25T05:16:31Z", "message": "move back the original text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ada4526abc050348eb86518be7e07847717cd09", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/3ada4526abc050348eb86518be7e07847717cd09", "committedDate": "2020-04-25T05:17:28Z", "message": "moved the index_to_name to bert folder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b22b62bd93b74c3f621f3ce31a27015aa37cab2", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/7b22b62bd93b74c3f621f3ce31a27015aa37cab2", "committedDate": "2020-04-25T05:25:52Z", "message": "Transformers/ Bert serving with Torchserve readme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c609fde3198077d3d358115c0fd2ca4478925475", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/c609fde3198077d3d358115c0fd2ca4478925475", "committedDate": "2020-04-25T05:34:47Z", "message": " deleting an unused dictionary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45f376d82a8a2f349351ded79359f3bf7fa23ead", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/45f376d82a8a2f349351ded79359f3bf7fa23ead", "committedDate": "2020-04-25T05:41:52Z", "message": " just cleaning some of the commented out parts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f52a874acef97dd358ee84626c243741426f2fb", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/4f52a874acef97dd358ee84626c243741426f2fb", "committedDate": "2020-04-26T17:52:43Z", "message": "cleaning up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d13476adea12dcbe5e795788a3e1507d499a1b0b", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/d13476adea12dcbe5e795788a3e1507d499a1b0b", "committedDate": "2020-04-26T18:46:10Z", "message": " Cleaning up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8998287f06d89a448b1b0dce5eb6b82c5d58fef", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/f8998287f06d89a448b1b0dce5eb6b82c5d58fef", "committedDate": "2020-04-26T19:24:53Z", "message": "uncommenting the logging and cleaning  the comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92778233e50ff24de91027f44535f4267d998ab6", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/92778233e50ff24de91027f44535f4267d998ab6", "committedDate": "2020-04-29T07:08:37Z", "message": "Download and save the checkpoints, config file and vocab of  the BERT from Transformers for demonstration purposes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bda474ac5b59d749b50cf3660546deaf2983f458", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/bda474ac5b59d749b50cf3660546deaf2983f458", "committedDate": "2020-04-29T07:09:18Z", "message": "mapping of predicitons to labels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec59c7913a4b555547dfd48ac33967600503ff77", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/ec59c7913a4b555547dfd48ac33967600503ff77", "committedDate": "2020-04-29T07:09:58Z", "message": "a custom handler for transformers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cdb264c59a5f9235167975acc71af4a0594855d", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/0cdb264c59a5f9235167975acc71af4a0594855d", "committedDate": "2020-04-29T07:10:37Z", "message": "README."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db45f87f5202557c2266a0ad8b85edaff663c749", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/db45f87f5202557c2266a0ad8b85edaff663c749", "committedDate": "2020-04-29T07:11:18Z", "message": "sample of input text."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "940008d631047b7d6d3447d03a79c2d94c5a10ab", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/940008d631047b7d6d3447d03a79c2d94c5a10ab", "committedDate": "2020-04-29T15:47:37Z", "message": " modifying the descriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13b1e16bd1d95c768399adf71af040ee7f3c3e2d", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/13b1e16bd1d95c768399adf71af040ee7f3c3e2d", "committedDate": "2020-04-29T15:54:05Z", "message": " modifying the descriptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "deda5d2c20cbea6d37efcedbf257231bc8a75cdf", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/deda5d2c20cbea6d37efcedbf257231bc8a75cdf", "committedDate": "2020-04-29T16:30:29Z", "message": " adding comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e03fec8487293b8020c812aaed4942496533f26", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/1e03fec8487293b8020c812aaed4942496533f26", "committedDate": "2020-04-29T16:31:07Z", "message": " adding commnets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55c031842b507c9f0f784483f6a60ba582abb1fb", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/55c031842b507c9f0f784483f6a60ba582abb1fb", "committedDate": "2020-04-29T16:32:00Z", "message": " Fromatting modifications"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5fbc07d9a9e1d78909dd432de4595323efbb2f8", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/e5fbc07d9a9e1d78909dd432de4595323efbb2f8", "committedDate": "2020-04-29T16:37:47Z", "message": " modified comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbb8da5617ff4c945a46a19960eae45b83a2a3bf", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/dbb8da5617ff4c945a46a19960eae45b83a2a3bf", "committedDate": "2020-04-29T22:12:21Z", "message": " added the citations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56ceffac67fbafffccfd4926d54d7a7a34333112", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/56ceffac67fbafffccfd4926d54d7a7a34333112", "committedDate": "2020-04-30T03:27:45Z", "message": "adding hugginface as the type of transformer model we are referring to"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6190198fb621d078c940f870af9da0c0467b2206", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/6190198fb621d078c940f870af9da0c0467b2206", "committedDate": "2020-04-30T03:34:59Z", "message": "renaming the folder to huggingface_transformers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58507d3d3740bc490e734de4fa77e70ec6b224a6", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/58507d3d3740bc490e734de4fa77e70ec6b224a6", "committedDate": "2020-04-30T03:46:28Z", "message": "Removing the bert folder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5bc08edbc03cfb09bba1bc3895ef1b62e7ddaa7", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/d5bc08edbc03cfb09bba1bc3895ef1b62e7ddaa7", "committedDate": "2020-05-03T01:57:46Z", "message": "simple modification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "766b74470fc7dd429a9af125f4b86f3de49c33e4", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/766b74470fc7dd429a9af125f4b86f3de49c33e4", "committedDate": "2020-05-03T04:59:19Z", "message": "modifed the script to use a setup_config.json for loading and saving models"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fc3d25d60fad15113dada527adced64ba41dabb", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/5fc3d25d60fad15113dada527adced64ba41dabb", "committedDate": "2020-05-03T05:00:42Z", "message": "added the section for transfomer_handler_generalized"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c101a348978b11139b0ff2b7d98f28c8e89d5358", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/c101a348978b11139b0ff2b7d98f28c8e89d5358", "committedDate": "2020-05-03T05:01:15Z", "message": "the generalized handler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b950d8df697d0680d7406867c504dedf3771a279", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/b950d8df697d0680d7406867c504dedf3771a279", "committedDate": "2020-05-03T05:02:09Z", "message": "set_up config intialization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95f91fe52bf0944cf970ab3b912b4ac0c7892ae3", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/95f91fe52bf0944cf970ab3b912b4ac0c7892ae3", "committedDate": "2020-05-04T00:01:38Z", "message": " edited for transfomer generalization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de0b8d904403babc9110c59f598845fdd3f21127", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/de0b8d904403babc9110c59f598845fdd3f21127", "committedDate": "2020-05-04T00:03:23Z", "message": " modified to use just input_ids as inputs for models"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12c17da33f4bc46e8bfab473c34e2164caba1536", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/12c17da33f4bc46e8bfab473c34e2164caba1536", "committedDate": "2020-05-04T00:04:10Z", "message": "modified for question answering"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f650bdaa947d7bb2c7de0efd6c75d94477717aa", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/8f650bdaa947d7bb2c7de0efd6c75d94477717aa", "committedDate": "2020-05-04T00:04:51Z", "message": "modified to include the number of labels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11648345c00cf2622df6e5118a1046a0cef64f86", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/11648345c00cf2622df6e5118a1046a0cef64f86", "committedDate": "2020-05-04T00:10:41Z", "message": "corrected typos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "646b66a30eac12240d8062adfc86d0aad77f5b60", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/646b66a30eac12240d8062adfc86d0aad77f5b60", "committedDate": "2020-05-04T02:40:12Z", "message": "modifed variable names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1162c0132655cd797a8f2f71785c3653403f15b8", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/1162c0132655cd797a8f2f71785c3653403f15b8", "committedDate": "2020-05-04T02:40:36Z", "message": "edited for clarity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8fea21ecbf0c2f1aa9c00f881c1ad2d75e78053", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/a8fea21ecbf0c2f1aa9c00f881c1ad2d75e78053", "committedDate": "2020-05-04T02:43:03Z", "message": "modifed variable names, simplified the initlialize in the handler class, removed the warnning from QA case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "785737e3fd373492b8c9834a337b0c748c2f5f3d", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/785737e3fd373492b8c9834a337b0c748c2f5f3d", "committedDate": "2020-05-04T02:44:54Z", "message": "modifed values for QA"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94abfd96d42bdeacd4d86858d75bd3af5e8fb1da", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/94abfd96d42bdeacd4d86858d75bd3af5e8fb1da", "committedDate": "2020-05-04T02:45:29Z", "message": "modifed the variable names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3ab957dea79499f188c6d2fc930089e09e1eb64", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/b3ab957dea79499f188c6d2fc930089e09e1eb64", "committedDate": "2020-05-04T03:12:33Z", "message": " added comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "784a38f44302a122503a6ff7b7113cd328fcca6a", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/784a38f44302a122503a6ff7b7113cd328fcca6a", "committedDate": "2020-05-04T16:03:02Z", "message": "modified to add clarity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44217c1775ca52cbd1bf41a686d642b679a54333", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/44217c1775ca52cbd1bf41a686d642b679a54333", "committedDate": "2020-05-04T16:10:01Z", "message": "add comment in preprocessing of QA"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzA0MTc4", "url": "https://github.com/pytorch/serve/pull/302#pullrequestreview-405304178", "createdAt": "2020-05-04T20:01:12Z", "commit": {"oid": "44217c1775ca52cbd1bf41a686d642b679a54333"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDowMToxM1rOGQQBwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoxNDoxNVrOGQQc4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5Mjk5Mg==", "bodyText": "Should we add a else warning here if the mode is not supported?", "url": "https://github.com/pytorch/serve/pull/302#discussion_r419692992", "createdAt": "2020-05-04T20:01:13Z", "author": {"login": "zhangguanheng66"}, "path": "examples/Huggingface_Transformers/Download_Transformer_models.py", "diffHunk": "@@ -0,0 +1,103 @@\n+import transformers\n+from pathlib import Path\n+import os\n+import json\n+import torch\n+from transformers import (AutoModelForSequenceClassification, AutoTokenizer, AutoModelForQuestionAnswering,\n+ AutoModelForTokenClassification, AutoConfig)\n+\"\"\" This function, save the checkpoint, config file along with tokenizer config and vocab files\n+    of a transformer model of your choice.\n+\"\"\"\n+print('Transformers version',transformers.__version__)\n+\n+def transformers_model_dowloader(mode,pretrained_model_name,num_labels,do_lower_case):\n+    print(\"Download model and tokenizer\", pretrained_model_name)\n+    #loading pre-trained model and tokenizer\n+    if mode== \"sequence_classification\":\n+        config = AutoConfig.from_pretrained(pretrained_model_name,num_labels=num_labels)\n+        model = AutoModelForSequenceClassification.from_pretrained(pretrained_model_name, config=config)\n+        tokenizer = AutoTokenizer.from_pretrained(pretrained_model_name,do_lower_case=do_lower_case)\n+    elif mode== \"question_answering\":\n+        model = AutoModelForQuestionAnswering.from_pretrained(pretrained_model_name)\n+        tokenizer = AutoTokenizer.from_pretrained(pretrained_model_name,do_lower_case=do_lower_case)\n+    elif mode== \"token_classification\":\n+        config = AutoConfig.from_pretrained(pretrained_model_name,num_labels=num_labels)\n+        model = AutoModelForTokenClassification.from_pretrained(pretrained_model_name)\n+        tokenizer = AutoTokenizer.from_pretrained(pretrained_model_name,do_lower_case=do_lower_case)\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44217c1775ca52cbd1bf41a686d642b679a54333"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY5OTkzOQ==", "bodyText": "why not combine self.initialize func and constructor together? Do you expect user to initialize the class multiple times?", "url": "https://github.com/pytorch/serve/pull/302#discussion_r419699939", "createdAt": "2020-05-04T20:14:15Z", "author": {"login": "zhangguanheng66"}, "path": "examples/Huggingface_Transformers/Transformers_handler.py", "diffHunk": "@@ -0,0 +1,112 @@\n+from abc import ABC\n+import json\n+import logging\n+import os\n+\n+import torch\n+from transformers import AutoModelForSequenceClassification, AutoTokenizer\n+\n+from ts.torch_handler.base_handler import BaseHandler\n+\n+logger = logging.getLogger(__name__)\n+\n+\n+class TransformersSeqClassifierHandler(BaseHandler, ABC):\n+    \"\"\"\n+    Transformers text classifier handler class. This handler takes a text (string) and\n+    as input and returns the classification text based on the serialized transformers checkpoint.\n+    \"\"\"\n+    def __init__(self):\n+        super(TransformersSeqClassifierHandler, self).__init__()\n+        self.initialized = False\n+\n+    def initialize(self, ctx):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44217c1775ca52cbd1bf41a686d642b679a54333"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a2d32af6da6e44d5cf34d65c00e4dc21f85f90a", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/1a2d32af6da6e44d5cf34d65c00e4dc21f85f90a", "committedDate": "2020-05-04T21:44:04Z", "message": "added warning for the case mode is not selected properly and combined constructor and initlaize fucntion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "777466b6a20de61f03071e27ef4bd41c42548b0a", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/777466b6a20de61f03071e27ef4bd41c42548b0a", "committedDate": "2020-05-04T21:46:38Z", "message": "clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2518edc4908713aedba980031f881a696e6dd557", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/2518edc4908713aedba980031f881a696e6dd557", "committedDate": "2020-05-04T22:22:36Z", "message": "clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66ce189907effb8fb96e33cbd12fccea2353d958", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/66ce189907effb8fb96e33cbd12fccea2353d958", "committedDate": "2020-05-04T23:05:02Z", "message": "combined constructor and initliaze func"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0752c4f8e47494cf853676bec862abbd08807f06", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/0752c4f8e47494cf853676bec862abbd08807f06", "committedDate": "2020-05-04T23:05:38Z", "message": "combined constructor and initliaze func"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e609eb2e1daf68c29e5f6432b7a05d84c049daae", "author": {"user": {"login": "chauhang", "name": "Geeta Chauhan"}}, "url": "https://github.com/pytorch/serve/commit/e609eb2e1daf68c29e5f6432b7a05d84c049daae", "committedDate": "2020-05-04T23:54:47Z", "message": "Merge branch 'staging_0_1_1' into transformers_generalization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MDk1Nzcz", "url": "https://github.com/pytorch/serve/pull/302#pullrequestreview-407095773", "createdAt": "2020-05-07T01:38:01Z", "commit": {"oid": "e609eb2e1daf68c29e5f6432b7a05d84c049daae"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMTozODowMVrOGRrVYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMTozOToxNVrOGRrWsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE4ODk2Mw==", "bodyText": "We could be doing all these inside the initialize method instead of the constructor. initialize is called with service context which can be very helpful.", "url": "https://github.com/pytorch/serve/pull/302#discussion_r421188963", "createdAt": "2020-05-07T01:38:01Z", "author": {"login": "mycpuorg"}, "path": "examples/Huggingface_Transformers/Transformer_handler_generalized.py", "diffHunk": "@@ -0,0 +1,148 @@\n+from abc import ABC\n+import json\n+import logging\n+import os\n+import ast\n+import torch\n+from transformers import AutoModelForSequenceClassification, AutoTokenizer, AutoModelForQuestionAnswering,AutoModelForTokenClassification\n+\n+from ts.torch_handler.base_handler import BaseHandler\n+\n+logger = logging.getLogger(__name__)\n+\n+\n+class TransformersSeqClassifierHandler(BaseHandler, ABC):\n+    \"\"\"\n+    Transformers handler class for sequence, token classification and question answering.\n+    \"\"\"\n+    def __init__(self,ctx):\n+        super(TransformersSeqClassifierHandler, self).__init__()\n+        self.manifest = ctx.manifest\n+        properties = ctx.system_properties", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e609eb2e1daf68c29e5f6432b7a05d84c049daae"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE4OTI5Ng==", "bodyText": "Same comment as before.\nIn general, both initialize and instantiation happen around the same time during model load stage. But the initialize function is called with service context  which gives the handler information provided about the model during registration such as:\n\nmodel_name\nmodel_dir\nmanifest\nbatch_size\ngpu\nts.version\n\nSo the handlers can make better decisions during initialize than in constructor.", "url": "https://github.com/pytorch/serve/pull/302#discussion_r421189296", "createdAt": "2020-05-07T01:39:15Z", "author": {"login": "mycpuorg"}, "path": "examples/Huggingface_Transformers/Transformers_handler.py", "diffHunk": "@@ -0,0 +1,106 @@\n+from abc import ABC\n+import json\n+import logging\n+import os\n+\n+import torch\n+from transformers import AutoModelForSequenceClassification, AutoTokenizer\n+\n+from ts.torch_handler.base_handler import BaseHandler\n+\n+logger = logging.getLogger(__name__)\n+\n+\n+class TransformersSeqClassifierHandler(BaseHandler, ABC):\n+    \"\"\"\n+    Transformers text classifier handler class. This handler takes a text (string) and\n+    as input and returns the classification text based on the serialized transformers checkpoint.\n+    \"\"\"\n+    def __init__(self, ctx):\n+        super(TransformersSeqClassifierHandler, self).__init__()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e609eb2e1daf68c29e5f6432b7a05d84c049daae"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bb1597dd213bb88e6199e1545a44135885473c2", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/5bb1597dd213bb88e6199e1545a44135885473c2", "committedDate": "2020-05-07T04:22:49Z", "message": "Separated the constructor and initliaze func"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f08db9918ce491ba58e1b5edc7ce68c6a555737f", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/f08db9918ce491ba58e1b5edc7ce68c6a555737f", "committedDate": "2020-05-07T05:38:45Z", "message": "Modified to remove the classification part and update with generalized version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13af3dd57d86f84107157fb5f5e7699b6ab71aaa", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/13af3dd57d86f84107157fb5f5e7699b6ab71aaa", "committedDate": "2020-05-07T05:49:01Z", "message": "Merge branch 'transformers_generalization' of https://github.com/HamidShojanazeri/serve into transformers_generalization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04a84033ee260f936ae554d9bbc795def66388b4", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/04a84033ee260f936ae554d9bbc795def66388b4", "committedDate": "2020-05-07T05:57:29Z", "message": "resolved the coflict and separated the costructor and initliaze func"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "609f3f258d94ee836f1072b4abad0fd809dc7b76", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/609f3f258d94ee836f1072b4abad0fd809dc7b76", "committedDate": "2020-05-07T23:19:09Z", "message": "removed the handler for classification case as the generalized version handles the case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36717605b9cd6e0faeaa52fd0e57c33cba4aee94", "author": {"user": {"login": "mycpuorg", "name": null}}, "url": "https://github.com/pytorch/serve/commit/36717605b9cd6e0faeaa52fd0e57c33cba4aee94", "committedDate": "2020-05-08T17:12:29Z", "message": "Merge branch 'staging_0_1_1' into transformers_generalization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NTc4MjU5", "url": "https://github.com/pytorch/serve/pull/302#pullrequestreview-409578259", "createdAt": "2020-05-11T22:34:44Z", "commit": {"oid": "36717605b9cd6e0faeaa52fd0e57c33cba4aee94"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d08247f5825e59cffe415c6dcbd7b6d9b057b62", "author": {"user": {"login": "chauhang", "name": "Geeta Chauhan"}}, "url": "https://github.com/pytorch/serve/commit/3d08247f5825e59cffe415c6dcbd7b6d9b057b62", "committedDate": "2020-05-16T20:58:15Z", "message": "Merge branch 'staging_0_1_1' into transformers_generalization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTA4Nzgz", "url": "https://github.com/pytorch/serve/pull/302#pullrequestreview-413108783", "createdAt": "2020-05-16T21:08:56Z", "commit": {"oid": "3d08247f5825e59cffe415c6dcbd7b6d9b057b62"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzODQ0NTQx", "url": "https://github.com/pytorch/serve/pull/302#pullrequestreview-413844541", "createdAt": "2020-05-18T18:38:43Z", "commit": {"oid": "3d08247f5825e59cffe415c6dcbd7b6d9b057b62"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68c6e9513ef1cf9e13822fd622f2803c3311d6ed", "author": {"user": {"login": "mycpuorg", "name": null}}, "url": "https://github.com/pytorch/serve/commit/68c6e9513ef1cf9e13822fd622f2803c3311d6ed", "committedDate": "2020-05-18T18:38:53Z", "message": "Merge branch 'staging_0_1_1' into transformers_generalization"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2373, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}