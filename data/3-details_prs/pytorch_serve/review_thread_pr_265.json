{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4Mzc1NjU2", "number": 265, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMTo1MjoxN1rOD1-Hrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMjozOTowOVrOD-xhgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3OTE4ODk0OnYy", "diffSide": "RIGHT", "path": "ts/torch_handler/object_detector.py", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMTo1MjoxN1rOGLqh2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwOToyMzoyMFrOGMZccw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4NDMxNA==", "bodyText": "My understanding is that this bug will also strike users on TorchVision 0.4. Could we change this condition to demand a version < 0.6?\nThoughts:\n\nWe don't want to do a string comparison, because that would fail if we get to version 0.10.0.\nI've done some digging, and PyTorch & TorchVision version strings are consistently three integers separated by periods. So if we were to split the version string on the periods, and treat the components like ints, that would look something like:\n\nif major_version <= 0 and minor_version < 6:\n    ...", "url": "https://github.com/pytorch/serve/pull/265#discussion_r414884314", "createdAt": "2020-04-24T21:52:17Z", "author": {"login": "fbbradheintz"}, "path": "ts/torch_handler/object_detector.py", "diffHunk": "@@ -17,11 +18,12 @@ def __init__(self):\n \n     def initialize(self, ctx):\n         super(VisionHandler, self).initialize(ctx)\n-        self.initialized = False\n-        self.device = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\")\n-        self.model.to(self.device)\n-        self.model.eval()\n-        self.initialized = True\n+        if torchvision_version == \"0.5.0\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c4a43cd5bc0621a58c6c7ba288ebc29a7672d1a"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTM5OTUyMg==", "bodyText": "(NB: I don't encourage treating versions strings numerically in the general case, but this is a narrow, bounded case with low risk that serves our need here.)", "url": "https://github.com/pytorch/serve/pull/265#discussion_r415399522", "createdAt": "2020-04-26T20:58:38Z", "author": {"login": "fbbradheintz"}, "path": "ts/torch_handler/object_detector.py", "diffHunk": "@@ -17,11 +18,12 @@ def __init__(self):\n \n     def initialize(self, ctx):\n         super(VisionHandler, self).initialize(ctx)\n-        self.initialized = False\n-        self.device = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\")\n-        self.model.to(self.device)\n-        self.model.eval()\n-        self.initialized = True\n+        if torchvision_version == \"0.5.0\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4NDMxNA=="}, "originalCommit": {"oid": "3c4a43cd5bc0621a58c6c7ba288ebc29a7672d1a"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTY1Mjk3OQ==", "bodyText": "Done.", "url": "https://github.com/pytorch/serve/pull/265#discussion_r415652979", "createdAt": "2020-04-27T09:23:20Z", "author": {"login": "harshbafna"}, "path": "ts/torch_handler/object_detector.py", "diffHunk": "@@ -17,11 +18,12 @@ def __init__(self):\n \n     def initialize(self, ctx):\n         super(VisionHandler, self).initialize(ctx)\n-        self.initialized = False\n-        self.device = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\")\n-        self.model.to(self.device)\n-        self.model.eval()\n-        self.initialized = True\n+        if torchvision_version == \"0.5.0\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg4NDMxNA=="}, "originalCommit": {"oid": "3c4a43cd5bc0621a58c6c7ba288ebc29a7672d1a"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODAzNjU3OnYy", "diffSide": "RIGHT", "path": "codebuild/Dockerfile.cpu", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzozMzozM1rOGXBD7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjowNDoyOFrOGXdK6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NzgyMg==", "bodyText": "curious, why is this change here?", "url": "https://github.com/pytorch/serve/pull/265#discussion_r426787822", "createdAt": "2020-05-18T17:33:33Z", "author": {"login": "mycpuorg"}, "path": "codebuild/Dockerfile.cpu", "diffHunk": "@@ -20,7 +20,7 @@\n   RUN update-alternatives --install /usr/bin/python python /usr/bin/python3 1\n   RUN update-alternatives --install /usr/local/bin/pip pip /usr/local/bin/pip3 1\n   \n-  RUN pip install torch torchvision -f https://download.pytorch.org/whl/torch_stable.html\n+  RUN pip install torch torchvision torchtext -f https://download.pytorch.org/whl/torch_stable.html", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d816d46c696149cb0be727edfe61628c2a40a5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0NjI0MQ==", "bodyText": "As a part of this PR we added changes in the sanity script for validating the object_detector default handler. Later we thought of adding the changes to validate the remaining default handlers as well. For validating the text_classification default handler we needed torchtext installed in the codebuild docker image.", "url": "https://github.com/pytorch/serve/pull/265#discussion_r427246241", "createdAt": "2020-05-19T12:00:36Z", "author": {"login": "harshbafna"}, "path": "codebuild/Dockerfile.cpu", "diffHunk": "@@ -20,7 +20,7 @@\n   RUN update-alternatives --install /usr/bin/python python /usr/bin/python3 1\n   RUN update-alternatives --install /usr/local/bin/pip pip /usr/local/bin/pip3 1\n   \n-  RUN pip install torch torchvision -f https://download.pytorch.org/whl/torch_stable.html\n+  RUN pip install torch torchvision torchtext -f https://download.pytorch.org/whl/torch_stable.html", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NzgyMg=="}, "originalCommit": {"oid": "f1d816d46c696149cb0be727edfe61628c2a40a5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0ODM2Mw==", "bodyText": "@mycpuorg\nComing to think of it, the new regression suite also validates all the default handlers. This looks like a repetition of work and managing the same regression in two different places.", "url": "https://github.com/pytorch/serve/pull/265#discussion_r427248363", "createdAt": "2020-05-19T12:04:28Z", "author": {"login": "harshbafna"}, "path": "codebuild/Dockerfile.cpu", "diffHunk": "@@ -20,7 +20,7 @@\n   RUN update-alternatives --install /usr/bin/python python /usr/bin/python3 1\n   RUN update-alternatives --install /usr/local/bin/pip pip /usr/local/bin/pip3 1\n   \n-  RUN pip install torch torchvision -f https://download.pytorch.org/whl/torch_stable.html\n+  RUN pip install torch torchvision torchtext -f https://download.pytorch.org/whl/torch_stable.html", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NzgyMg=="}, "originalCommit": {"oid": "f1d816d46c696149cb0be727edfe61628c2a40a5"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODAzNzgzOnYy", "diffSide": "RIGHT", "path": "codebuild/Dockerfile.gpu", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzozMzo1N1rOGXBExA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzozMzo1N1rOGXBExA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4ODAzNg==", "bodyText": "Same comment. Docker file changes should not come with this.", "url": "https://github.com/pytorch/serve/pull/265#discussion_r426788036", "createdAt": "2020-05-18T17:33:57Z", "author": {"login": "mycpuorg"}, "path": "codebuild/Dockerfile.gpu", "diffHunk": "@@ -20,7 +20,7 @@\n   RUN update-alternatives --install /usr/bin/python python /usr/bin/python3 1\n   RUN update-alternatives --install /usr/local/bin/pip pip /usr/local/bin/pip3 1\n   \n-  RUN pip install torch torchvision \n+  RUN pip install torch torchvision torchtext", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d816d46c696149cb0be727edfe61628c2a40a5"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODA3Mjc3OnYy", "diffSide": "RIGHT", "path": "torchserve_sanity.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzo0NDo0M1rOGXBawQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMzo1MDo1MVrOGXhaaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5MzY2NQ==", "bodyText": "# models\nmodels=(\"fastrcnn\" \"vgg11\" \"resnet18\" \"waveglow\")\n\n# inputs - ensure length matches models\nmodel_inputs=(\"persons.jpg\" \"television.jpg\" \"kitten.jpg\" \"voice.wav\")\n\nfor i in ${!models[@]};\ndo\n  m=${models[$i]}\n  i=${model_inputs[$i]}\n  register_model \"$m\"\n  run_inference \"$m\" \"$i\"\n  unregister_model \"$m\"\ndone", "url": "https://github.com/pytorch/serve/pull/265#discussion_r426793665", "createdAt": "2020-05-18T17:44:43Z", "author": {"login": "mycpuorg"}, "path": "torchserve_sanity.sh", "diffHunk": "@@ -135,7 +154,43 @@ mkdir -p model_store\n \n start_torchserve\n \n-register_model\n+# run object detection example\n+\n+register_model \"fastrcnn\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d816d46c696149cb0be727edfe61628c2a40a5"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMxNzg2NQ==", "bodyText": "Done.", "url": "https://github.com/pytorch/serve/pull/265#discussion_r427317865", "createdAt": "2020-05-19T13:50:51Z", "author": {"login": "harshbafna"}, "path": "torchserve_sanity.sh", "diffHunk": "@@ -135,7 +154,43 @@ mkdir -p model_store\n \n start_torchserve\n \n-register_model\n+# run object detection example\n+\n+register_model \"fastrcnn\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5MzY2NQ=="}, "originalCommit": {"oid": "f1d816d46c696149cb0be727edfe61628c2a40a5"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MTQ5Njk2OnYy", "diffSide": "LEFT", "path": "torchserve_sanity.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMjozOTowOVrOGZFOIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMzo0MTo1N1rOGZJu3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1MzEyMA==", "bodyText": "do you really want to remove this?\nWasn't this to verify snapshot resume? Noticed that you are not unregistering resnet for this specific reason, right?", "url": "https://github.com/pytorch/serve/pull/265#discussion_r428953120", "createdAt": "2020-05-21T22:39:09Z", "author": {"login": "mycpuorg"}, "path": "torchserve_sanity.sh", "diffHunk": "@@ -35,7 +53,7 @@ stop_torchserve\n \n start_torchserve\n \n-run_inference resnet-18 examples/image_classifier/kitten.jpg", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db723c331e9ee6c7b0254a9e9041c348fda5d110"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAyNzAzOA==", "bodyText": "Done.", "url": "https://github.com/pytorch/serve/pull/265#discussion_r429027038", "createdAt": "2020-05-22T03:41:57Z", "author": {"login": "harshbafna"}, "path": "torchserve_sanity.sh", "diffHunk": "@@ -35,7 +53,7 @@ stop_torchserve\n \n start_torchserve\n \n-run_inference resnet-18 examples/image_classifier/kitten.jpg", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk1MzEyMA=="}, "originalCommit": {"oid": "db723c331e9ee6c7b0254a9e9041c348fda5d110"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1614, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}