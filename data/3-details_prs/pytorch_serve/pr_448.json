{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMzMwNzk0", "number": 448, "title": "Benchmark script enhancements to support docker [public or local image] for jmeter and ab", "bodyText": "Description\n\nAdds python script for supporting benchmarking of Inference API's using Apache Bench.\nUpdated the README.md file also.\nAdded new requirements-ab.txt for dependencies for Apache Bench.\nAB python script supports both cmd line args as well as through a config file(JSON)\nAdds support for ab bench execution in local and docker (cpu & gpu).\n\nFixes #216\nType of change\n\n New feature (non-breaking change which adds functionality)\n This change requires a documentation update\n\nFeature/Issue validation/testing\n\n\n Test A Run AB benchmark as per https://github.com/pytorch/serve/blob/2e873977281eaa16d8834de06c34ee74b78b2818/benchmarks/README.md#benchmark\n\n\n Test B\n\n\nUT/IT execution results\n\n\nLogs\nTorchserve Sanity logs :\nGPU_sanity.txt\nCPU_sanity_logs.txt\n\n\nTesting Various AB benchmark scenarios :\nab_benmark_gpu_logs.txt\nab_benmark_cpu_logs.txt\nSample output files:\nresult.txt\nab_report.csv.txt\n\nTesting done for updates in benchmark.py(Jmeter benchmark):\nbenchmark_PY_testing_logs.txt\nChecklist:\n\n Have you added tests that prove your fix is effective or that this feature works?\n New and existing unit tests pass locally with these changes?\n Has code been commented, particularly in hard-to-understand areas?\n Have you made corresponding changes to the documentation?", "createdAt": "2020-06-10T09:33:01Z", "url": "https://github.com/pytorch/serve/pull/448", "merged": true, "mergeCommit": {"oid": "ebe55b0d099aa0e7c32af6a284d11b992c86078b"}, "closed": true, "closedAt": "2020-07-22T07:02:57Z", "author": {"login": "deepakbabel23"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcp2OgrAH2gAyNDMyMzMwNzk0OmQ2OTRjMWExOTgyMzJmYmE4M2E5MzdlNTIwNTdiNzk4Y2Q5MmZiYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3VU1mgFqTQzNTc0MDk1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d694c1a198232fba83a937e52057b798cd92fba7", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/d694c1a198232fba83a937e52057b798cd92fba7", "committedDate": "2020-06-10T09:27:42Z", "message": "Incorporated changes required for using Apache Bench(with documentation). Also fixed the config.properties file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "589be7c1fa678725b55e4d3e82600b1b8b1702b0", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/589be7c1fa678725b55e4d3e82600b1b8b1702b0", "committedDate": "2020-06-10T10:10:26Z", "message": "Minor documentation update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f73c10b4c3bc07fa3dfe7ee3da5f36295f5649ec", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/f73c10b4c3bc07fa3dfe7ee3da5f36295f5649ec", "committedDate": "2020-06-10T12:55:13Z", "message": "Resolved minor merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "381df50738a1934a397a01f387e3ea0087f837f4", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/381df50738a1934a397a01f387e3ea0087f837f4", "committedDate": "2020-06-10T16:55:23Z", "message": "Proceed with script execution even if we are not able to retrieve torchserve version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5888bf13783ed9e69d3a96f6f275d809d766d29a", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/5888bf13783ed9e69d3a96f6f275d809d766d29a", "committedDate": "2020-06-10T19:37:21Z", "message": "Minor documentation update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35d2d33df7dd33eec6c92f98788fe6b1fabab264", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/35d2d33df7dd33eec6c92f98788fe6b1fabab264", "committedDate": "2020-06-10T20:05:34Z", "message": "Corrected benchmark script name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "862f2c720c68bcd8d2b84a68ac50d4ae4935eee2", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/862f2c720c68bcd8d2b84a68ac50d4ae4935eee2", "committedDate": "2020-06-10T20:20:21Z", "message": "Corrected Model Zoo path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4317773540a9a70e0e4d8a0fcf3cb53cc048b7f9", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/4317773540a9a70e0e4d8a0fcf3cb53cc048b7f9", "committedDate": "2020-06-10T21:48:22Z", "message": "Minor docs updation in examples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c73dc048ebd1a0821e2551a645f63ac8e965d1db", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/c73dc048ebd1a0821e2551a645f63ac8e965d1db", "committedDate": "2020-06-10T22:02:54Z", "message": "Updated Examples usage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e817e7dca547b59e75530f83f4de5ff9bdcdbfcf", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/e817e7dca547b59e75530f83f4de5ff9bdcdbfcf", "committedDate": "2020-06-14T11:40:01Z", "message": "Updating doc."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7049a8486a52816d015e69f78a413d39d97a6761", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/7049a8486a52816d015e69f78a413d39d97a6761", "committedDate": "2020-06-15T04:58:27Z", "message": "Fixed jmeter benchmark and overall doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d94834239cd3519f4296dea869cafb61cadeb610", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/d94834239cd3519f4296dea869cafb61cadeb610", "committedDate": "2020-06-15T05:03:56Z", "message": "Reverting cp mistate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40e0db8e0f23b9a182fb8fd3e3a96ee3b11a3e29", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/40e0db8e0f23b9a182fb8fd3e3a96ee3b11a3e29", "committedDate": "2020-06-15T05:05:28Z", "message": "Update README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "154093d53699d9f9e0f8f86964f9393c8eeff104", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/154093d53699d9f9e0f8f86964f9393c8eeff104", "committedDate": "2020-06-15T05:12:26Z", "message": "Update README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce5b6afa35a7d0379efcac2e09c97e6666929d1e", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/ce5b6afa35a7d0379efcac2e09c97e6666929d1e", "committedDate": "2020-06-15T23:09:36Z", "message": "Fixed some bugs due to merge and removed unused code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "912697506547b8ef541f71bf5f7e56043f108e2c", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/912697506547b8ef541f71bf5f7e56043f108e2c", "committedDate": "2020-06-16T00:26:08Z", "message": "Corrected minor bugs in benchmark.py related to docker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "998bf9f122453cdd8d4852f7609e2acda895c820", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/998bf9f122453cdd8d4852f7609e2acda895c820", "committedDate": "2020-06-16T00:26:48Z", "message": "Merge branch 'master' of https://github.com/deepakbabel23/serve"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5981490527acaf254a4643bc8d8a97e95865316", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/d5981490527acaf254a4643bc8d8a97e95865316", "committedDate": "2020-06-16T00:58:56Z", "message": "Updated README"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b5e51c4e5edc653a3975ed2f9fd4013f5c3840c", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/5b5e51c4e5edc653a3975ed2f9fd4013f5c3840c", "committedDate": "2020-06-16T18:20:42Z", "message": "Updated README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58d6c7f5fc2a58bbd72c42346618ff444a2e7a1b", "author": {"user": {"login": "deepakbabel23", "name": "Deepak"}}, "url": "https://github.com/pytorch/serve/commit/58d6c7f5fc2a58bbd72c42346618ff444a2e7a1b", "committedDate": "2020-06-16T18:29:21Z", "message": "Updated docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a05eb5abc58bdd5dc84ffd5a02ce2c66108580b5", "author": {"user": {"login": "deepakbabel23", "name": "Deepak"}}, "url": "https://github.com/pytorch/serve/commit/a05eb5abc58bdd5dc84ffd5a02ce2c66108580b5", "committedDate": "2020-06-16T19:41:59Z", "message": "Fixed a minor bug related to invalid image input. Also did small optimization of previous bug fix."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7491bc504d7dd25ec9ca23bb00e632a4345ee02", "author": {"user": {"login": "shivamshriwas", "name": "shivamshriwas"}}, "url": "https://github.com/pytorch/serve/commit/b7491bc504d7dd25ec9ca23bb00e632a4345ee02", "committedDate": "2020-06-30T08:23:48Z", "message": "Added python script to run AB benchmark.\n- updated docs\n- removed sh script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90f079a564c19f398759abe4620a26c1fb65acfb", "author": {"user": {"login": "shivamshriwas", "name": "shivamshriwas"}}, "url": "https://github.com/pytorch/serve/commit/90f079a564c19f398759abe4620a26c1fb65acfb", "committedDate": "2020-06-30T08:50:40Z", "message": "updated config and docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5429be8a70a9266ad297908435a913682db35b6a", "author": {"user": {"login": "shivamshriwas", "name": "shivamshriwas"}}, "url": "https://github.com/pytorch/serve/commit/5429be8a70a9266ad297908435a913682db35b6a", "committedDate": "2020-07-09T05:43:51Z", "message": "addressed review comments\n- updated doc\n- renamed and updated python script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e873977281eaa16d8834de06c34ee74b78b2818", "author": {"user": {"login": "shivamshriwas", "name": "shivamshriwas"}}, "url": "https://github.com/pytorch/serve/commit/2e873977281eaa16d8834de06c34ee74b78b2818", "committedDate": "2020-07-09T06:48:19Z", "message": "Merge branch 'master' of https://github.com/pytorch/serve\n\n# Conflicts:\n#\tbenchmarks/README.md\n#\tbenchmarks/benchmark-ab.sh\n#\tbenchmarks/benchmark.py"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aa05b01243cc88d6748f5180e729670fdacbfac", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/0aa05b01243cc88d6748f5180e729670fdacbfac", "committedDate": "2020-07-09T14:19:42Z", "message": "Fixed bug to correctly check the returncode value of docker_run_call command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5a3aed67611a1df0c481db7a88b74cb012819a0", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/e5a3aed67611a1df0c481db7a88b74cb012819a0", "committedDate": "2020-07-16T15:41:08Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fe5e3831b8c1bd0a836d85f2a6a09bf6f14dcfb", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/8fe5e3831b8c1bd0a836d85f2a6a09bf6f14dcfb", "committedDate": "2020-07-21T05:55:50Z", "message": "Merge branch 'master' into master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NzQwOTU5", "url": "https://github.com/pytorch/serve/pull/448#pullrequestreview-435740959", "createdAt": "2020-06-23T12:42:30Z", "commit": {"oid": "a05eb5abc58bdd5dc84ffd5a02ce2c66108580b5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMjo0MjozMFrOGnnW8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxMjo0MjozMFrOGnnW8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE5MjQ5OQ==", "bodyText": "Please change these to Torch serve from MMS.\nMMS refers here to Model latency would be better if thats mentioned clearly", "url": "https://github.com/pytorch/serve/pull/448#discussion_r444192499", "createdAt": "2020-06-23T12:42:30Z", "author": {"login": "dhanainme"}, "path": "benchmarks/README.md", "diffHunk": "@@ -122,74 +145,119 @@ Run with custom options\\\n \n Run against an already running instance of TorchServe\\\n ```./benchmark.py latency --ts 127.0.0.1``` (defaults to http, port 80, management port = port + 1)\\\n-```./benchmark.py latency --ts 127.0.0.1:8080 --management-port 8081```\\\n-```./benchmark.py latency --ts https://127.0.0.1:8443```\n+```./benchmark.py latency --ts 127.0.0.1:8080 --management-port 8081```\n \n \n Run verbose with only a single loop\\\n ```./benchmark.py latency -v -l 1```\n \n+## Known Issues(Running with SSL):\n+Using ```https``` instead of  ```http``` as the choice of protocol might not work properly currently. This is not a tested option.\n+```./benchmark.py latency --ts https://127.0.0.1:8443```\n+\n \n ## Benchmark options\n \n The full list of options can be found by running with the -h or --help flags.\n \n # Benchmarking with Apache Bench\n \n-## Installation \n+Apache Bench can also be used in torchserve for Benchmarking performance of inference API's. The ApacheBench tool (ab) can load test servers by sending an arbitrary number of concurrent requests.\n+\n+The benchmarks measure the performance of torchserve on inference API for various models. It supports passed in a URL to the .mar file. It also runs various benchmarks using these models (see benchmarks section below).\n+\n+## Installation\n+\n+It assumes that you have followed quick start/installation section and have required pre-requisites i.e. python3, java and docker [if needed]. If not then please refer [quick start](https://github.com/pytorch/serve/blob/master/README.md) for setup.\n+\n+### Ubuntu\n+\n+First check if you already have Apache Bench(ab) installed on your Ubuntu box(local/EC2 instance). The following code will help verify the installation \u2212\n \n-### For Ubuntu\n+#### ab -V\n \n+If ab is not installed on your machine, then please follow the following steps:\n+\n+Refresh the package database.\n+\n+```bash\n+apt-get update\n ```\n-apt-get install apache2-utils\n+Install the apache2-utils package to get access to ApacheBench.\n \n+```bash\n+apt-get install apache2-utils\n ```\n \n-Apache Bench is installed in Mac by default. You can test by running ```ab -h```\n+### macOS\n+\n+For mac, you will be using 'ab' which is by default installed in macOS. You can test by running ```ab -h```.\n+\n+Apart from ab, You will also need to have following:\n \n-## Benchmark \n+- bc: for metric percentile calculation\n+- nvidia-docker for gpu machine\n+\n+## Models\n+\n+The pre-trained models for the benchmark can be mostly found in the [TorchServe model zoo](https://github.com/pytorch/serve/blob/master/docs/model_zoo.md)\n+\n+### Benchmarks\n+We support several basic benchmarks:\n+\n+- MMS throughput\n+- MMS latency P50\n+- MMS latency P90\n+- MMS latency P99\n+- MMS latency mean\n+- MMS HTTP error rate", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a05eb5abc58bdd5dc84ffd5a02ce2c66108580b5"}, "originalPosition": 182}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2201, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}