{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwNjc0OTE2", "number": 282, "title": "Corrected HTTP response code for Model version does not exists exception", "bodyText": "Description\nStandardise \"Model version not  found.\" response for all applicable Api's with Http status code 404.\nAdded UT for model version does not exists test scenarios for various Api's.\nUpdated OpenApi  responses.\nFixes #196\nType of change\n\n Bug fix (non-breaking change which fixes an issue)\n\nFeature/Issue validation/testing\nGiven the model archives r18_v1.0.mar and r18_v1.1.mar, which contain versions v1.0 and v1.1 respectively of model r18, bring up a TorchServe instance with no models running, and run the following commands:\ncurl -X POST \"http://localhost:8081/models?url=r18_v1.0.mar&initial_workers=1\"\ncurl -X POST \"http://localhost:8081/models?url=r18_v1.1.mar&initial_workers=1\"\n\n\n\n Test A : attempt to set-default model of non existing model version\nrun cmd  curl -X PUT http://localhost:8081/models/r18/1.1/set-default\n\nExpected:\n{\n  \"code\": 404,\n  \"type\": \"ModelVersionNotFoundException\",\n  \"message\": \"Model version 1.1 does not exist for model r18\"\n}\n\nsimilar response is expected for other apis where in request model version is specified but that version does not exist.\n\n\nscale workers api : curl -X PUT \"http://localhost:8081/models/r18/1.1?min_worker=2\"\n\n\nunregister api : curl -X  DELETE \"http://localhost:8081/models/r18/1.1\"\n\n\ndescribe specific model api : curl -X GET \"http://localhost:8081/models/r18/1.1\"\n\n\ninference api for r18 model\n\n\n Test B: Attempt to delete default version\nrun  curl -X  DELETE \"http://localhost:8081/models/r18/v1.0\"\nExpected :\n\n\n{\n  \"code\": 403,\n  \"type\": \"InvalidModelVersionException\",\n  \"message\": \"Cannot remove default version for model r18\"\n}\n\n\nLogs\nissue_196_torchserve_sanity_log.txt\n\nChecklist:\n\n Have you added tests that prove your fix is effective or that this feature works?\n New and existing unit tests pass locally with these changes?\n Has code been commented, particularly in hard-to-understand areas?\n Have you made corresponding changes to the documentation?", "createdAt": "2020-04-29T12:14:51Z", "url": "https://github.com/pytorch/serve/pull/282", "merged": true, "mergeCommit": {"oid": "a9b5660647d2bc50e7f315f1875b30390438f4ae"}, "closed": true, "closedAt": "2020-05-16T01:13:46Z", "author": null, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccXWW-AH2gAyNDEwNjc0OTE2OjY1MjEzYTE5MjE4ZmE3NDcyOTUxYjkyM2I2NDViNzEwM2EyY2RiYmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchr6l9AH2gAyNDEwNjc0OTE2OjU5MmQ3ZTI4ZTNlZDM2ZmU0Y2VlYmRhZDk5ZWFhZjUzMzBkNWIzNTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "65213a19218fa7472951b923b645b7103a2cdbbe", "author": {"user": null}, "url": "https://github.com/pytorch/serve/commit/65213a19218fa7472951b923b645b7103a2cdbbe", "committedDate": "2020-04-29T12:08:12Z", "message": "issue 196 patch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMjU2ODI3", "url": "https://github.com/pytorch/serve/pull/282#pullrequestreview-403256827", "createdAt": "2020-04-30T07:11:43Z", "commit": {"oid": "65213a19218fa7472951b923b645b7103a2cdbbe"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNzoxMTo0M1rOGOci5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwNzozNzo0M1rOGOdXfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgwMDkzMg==", "bodyText": "Should this be 'throw ModelVersionNotFoundException'? Also, let's keep only one class.", "url": "https://github.com/pytorch/serve/pull/282#discussion_r417800932", "createdAt": "2020-04-30T07:11:43Z", "author": {"login": "dhaniram-kshirsagar"}, "path": "frontend/server/src/main/java/org/pytorch/serve/http/ManagementRequestHandler.java", "diffHunk": "@@ -270,13 +270,14 @@ private void handleUnregisterModel(\n         } else if (httpResponseStatus == HttpResponseStatus.BAD_REQUEST) {\n             throw new ModelVersionNotFoundException(\n                     String.format(\n-                            \"Model version: %s not found for model: %s\", modelVersion, modelName));\n+                            \"Model version: %s does not exist for model: %s\",\n+                            modelVersion, modelName));\n         } else if (httpResponseStatus == HttpResponseStatus.INTERNAL_SERVER_ERROR) {\n             throw new InternalServerException(\"Interrupted while cleaning resources: \" + modelName);\n         } else if (httpResponseStatus == HttpResponseStatus.REQUEST_TIMEOUT) {\n             throw new RequestTimeoutException(\"Timed out while cleaning resources: \" + modelName);\n         } else if (httpResponseStatus == HttpResponseStatus.FORBIDDEN) {\n-            throw new InternalServerException(\n+            throw new InvalidModelVersionException(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65213a19218fa7472951b923b645b7103a2cdbbe"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgwOTY5MQ==", "bodyText": "As per #196, it should be 404 and not 403. Why 403? Also, let's keep things simple i.e. Catch ModelVersionNotFound exception in NOT-FOUND if clause above instead of having base as illegalArgexception.", "url": "https://github.com/pytorch/serve/pull/282#discussion_r417809691", "createdAt": "2020-04-30T07:29:00Z", "author": {"login": "dhaniram-kshirsagar"}, "path": "frontend/server/src/main/java/org/pytorch/serve/http/HttpRequestHandler.java", "diffHunk": "@@ -61,6 +61,9 @@ protected void channelRead0(ChannelHandlerContext ctx, FullHttpRequest req) {\n         } catch (OutOfMemoryError e) {\n             logger.trace(\"\", e);\n             NettyUtils.sendError(ctx, HttpResponseStatus.INSUFFICIENT_STORAGE, e);\n+        } catch (IllegalArgumentException e) {\n+            logger.error(\"\", e);\n+            NettyUtils.sendError(ctx, HttpResponseStatus.FORBIDDEN, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65213a19218fa7472951b923b645b7103a2cdbbe"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgxNDM5OA==", "bodyText": "I think it should be NOT_FOUND as commented above.", "url": "https://github.com/pytorch/serve/pull/282#discussion_r417814398", "createdAt": "2020-04-30T07:37:43Z", "author": {"login": "dhaniram-kshirsagar"}, "path": "frontend/server/src/test/java/org/pytorch/serve/ModelServerTest.java", "diffHunk": "@@ -426,7 +430,7 @@ private void testSetInvalidVersionDefault(String modelName, String defaultVersio\n         TestUtils.getLatch().await();\n \n         ErrorResponse resp = JsonUtils.GSON.fromJson(TestUtils.getResult(), ErrorResponse.class);\n-        Assert.assertEquals(resp.getCode(), HttpResponseStatus.INTERNAL_SERVER_ERROR.code());\n+        Assert.assertEquals(resp.getCode(), HttpResponseStatus.BAD_REQUEST.code());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65213a19218fa7472951b923b645b7103a2cdbbe"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzODMwNTM3", "url": "https://github.com/pytorch/serve/pull/282#pullrequestreview-403830537", "createdAt": "2020-04-30T19:52:39Z", "commit": {"oid": "65213a19218fa7472951b923b645b7103a2cdbbe"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57debd9d3cbc98a40e8c06761a26c6cab5550e89", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/57debd9d3cbc98a40e8c06761a26c6cab5550e89", "committedDate": "2020-05-01T08:25:49Z", "message": "Merge branch 'staging_0_1_1' into issue_196"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MDY4MTc3", "url": "https://github.com/pytorch/serve/pull/282#pullrequestreview-404068177", "createdAt": "2020-05-01T08:30:51Z", "commit": {"oid": "65213a19218fa7472951b923b645b7103a2cdbbe"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a057b92af16f0feea9e8ff4c75a3ed293eca6272", "author": {"user": {"login": "maaquib", "name": "Aaqib"}}, "url": "https://github.com/pytorch/serve/commit/a057b92af16f0feea9e8ff4c75a3ed293eca6272", "committedDate": "2020-05-02T01:39:17Z", "message": "Merge branch 'staging_0_1_1' into issue_196"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d169c2d070686323aa0b436c310810012a7ed48", "author": {"user": {"login": "shivamshriwas", "name": "shivamshriwas"}}, "url": "https://github.com/pytorch/serve/commit/6d169c2d070686323aa0b436c310810012a7ed48", "committedDate": "2020-05-06T05:06:05Z", "message": "Added openapi missing responses. - incorporated review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24567fe3928620d52f17b8351557778330594c38", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/24567fe3928620d52f17b8351557778330594c38", "committedDate": "2020-05-06T06:18:14Z", "message": "Merge branch 'staging_0_1_1' into issue_196"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6d2cf699c0921c2b9fd7576382b9abcafd5ef52", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/f6d2cf699c0921c2b9fd7576382b9abcafd5ef52", "committedDate": "2020-05-07T02:57:19Z", "message": "Merge branch 'staging_0_1_1' into issue_196"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b82ba646f0f98bad10cee46ee891bb31a5f95a61", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/b82ba646f0f98bad10cee46ee891bb31a5f95a61", "committedDate": "2020-05-07T03:07:10Z", "message": "updated method signature after resolving merge conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NTc1MzQ3", "url": "https://github.com/pytorch/serve/pull/282#pullrequestreview-407575347", "createdAt": "2020-05-07T15:15:38Z", "commit": {"oid": "b82ba646f0f98bad10cee46ee891bb31a5f95a61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "592d7e28e3ed36fe4ceebdad99eaaf5330d5b351", "author": {"user": {"login": "dhanainme", "name": null}}, "url": "https://github.com/pytorch/serve/commit/592d7e28e3ed36fe4ceebdad99eaaf5330d5b351", "committedDate": "2020-05-16T00:55:30Z", "message": "Merge branch 'staging_0_1_1' into issue_196"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2348, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}