{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2Mzk1NDQy", "number": 467, "title": "Regression suite enhancement", "bodyText": "Description\n\nfixes issue for rerun test suite consecutively.\ndumps serve logs in  /tmp/ts.log for all collections run.\ncleans test suite logs for each run\nCleanup after each model test\nadded response comparison for text based and json (image classification json output) for others and binary output , status code is verified.\nJSON output scores is compared with tolerance factor given in data file. As output scores of model  will have prediction may vary.\nEnhanced the regression tests added for huggingface examples\n\nFixes #394 #393\nType of change\nPlease delete options that are not relevant.\n\n Bug fix (non-breaking change which fixes an issue)\n\nFeature/Issue validation/testing\nRun regression suite consecutively\n\n\n Test A\nRegression suite runs consecutively\n\n\n Test B\nfor model zoo inference test models are unregistered after inference test is completed of the model.\nVerify in /tmp/test_exec.log\n\n\nUT/IT execution results\n\n\nLogs\nRegression suite was run consecutively twice in a docker container and below are generated console logs and reports.\nReports names are renamed here, originally test_exec.log and ts.log are file names and they are overwritten if the suite is rerun. instance\n\n\nconsole logs : regression_suite_enhacement_console_log.txt\n\n\nReports:\nTest suite execution logs:\ntest_exec_2.log\ntest_exec_1.log\n\n\nTest suite execution server logs:\nts_2.log\nts_1.log\n\n\n\n\nTested multiple runs of regression suite on the following instance as well:\n\nGPU - EC2 gpu docker container  gpu_device_gpu_docker.zip\nGPU - EC2  CPU docker container   gpu_device_cpu_docker.zip\nCPU - EC2 CPU docker container  cpu_device_cpu_docker.zip\n\nCurrrent know test case failures\nModel zoo BERT scripted models inference test cases are failing on GPU instance type. : #479\nOnce the new BERT mar files are updated on S3 these test cases will pass on GPU as well\nVGG11 fails on GPU : #535\nManagement API failure: #511\nChecklist:\n\n Have you added tests that prove your fix is effective or that this feature works?\n New and existing unit tests pass locally with these changes?\n Has code been commented, particularly in hard-to-understand areas?\n Have you made corresponding changes to the documentation?\n\nNote: This is the rebased PR of #398", "createdAt": "2020-06-18T11:01:02Z", "url": "https://github.com/pytorch/serve/pull/467", "merged": true, "mergeCommit": {"oid": "8f1c235a8c18016230e67b209c031d8b74618d67"}, "closed": true, "closedAt": "2020-07-22T14:59:28Z", "author": {"login": "shivamshriwas"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsb0RggH2gAyNDM2Mzk1NDQyOjZlZjg5NzgxYzJjMjljN2I1YTVlYTQzZTg4MjhjMGE0NDNjMDBjNjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2_07_AH2gAyNDM2Mzk1NDQyOmZiNGVjMTY2NjYxYzE2M2ZhMzk4NzYyZmUyYjBiZTY2YzY0ZTlhOWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ef89781c2c29c7b5a5ea43e8828c0a443c00c69", "author": {"user": {"login": "shivamshriwas", "name": "shivamshriwas"}}, "url": "https://github.com/pytorch/serve/commit/6ef89781c2c29c7b5a5ea43e8828c0a443c00c69", "committedDate": "2020-06-18T10:23:17Z", "message": "rebased with master branch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTY4NzU2", "url": "https://github.com/pytorch/serve/pull/467#pullrequestreview-437168756", "createdAt": "2020-06-25T05:01:01Z", "commit": {"oid": "6ef89781c2c29c7b5a5ea43e8828c0a443c00c69"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNTowMTowMVrOGorbeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwNTowMjo1MlrOGordMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwNzc2OA==", "bodyText": "This info was recently added to track date / branch / commit against which the test ran. Please dont remove this or add this elsewhere.", "url": "https://github.com/pytorch/serve/pull/467#discussion_r445307768", "createdAt": "2020-06-25T05:01:01Z", "author": {"login": "dhanainme"}, "path": "test/regression_tests.sh", "diffHunk": "@@ -28,9 +28,6 @@ install_torchserve_from_source() {\n   cd serve\n   echo \"Installing torchserve torch-model-archiver from source\"\n   ./scripts/install_from_src_ubuntu\n-  echo \"TS Branch : \" $(git rev-parse --abbrev-ref HEAD) >> $3\n-  echo \"TS Branch Commit Id : \" $(git rev-parse HEAD) >> $3\n-  echo \"Build date : \" $(date) >> $3\n   echo \"Torchserve Succesfully installed\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ef89781c2c29c7b5a5ea43e8828c0a443c00c69"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTMwODIwOA==", "bodyText": "These numbers are too specific even for a test.\nCan you please add some info about testing done to confirm that the tolerance values are in the range that we expect.", "url": "https://github.com/pytorch/serve/pull/467#discussion_r445308208", "createdAt": "2020-06-25T05:02:52Z", "author": {"login": "dhanainme"}, "path": "test/postman/inference_data.json", "diffHunk": "@@ -1,120 +1,360 @@\n-[{\n-\t\t\"url\": \"https://torchserve.s3.amazonaws.com/mar_files/my_text_classifier.mar\",\n-\t\t\"model_name\": \"my_text_classifier\",\n-\t\t\"worker\": 1,\n-\t\t\"synchronous\": \"true\",\n-\t\t\"file\": \"../examples/text_classification/sample_text.txt\"\n-\t},\n-\t{\n-\t\t\"url\": \"https://torchserve.s3.amazonaws.com/mar_files/squeezenet1_1.mar\",\n-\t\t\"model_name\": \"squeezenet1_1\",\n-\t\t\"worker\": 1,\n-\t\t\"synchronous\": \"true\",\n-\t\t\"file\": \"../examples/image_classifier/kitten.jpg\"\n-\t},\n-\t{\n-\t\t\"url\": \"https://torchserve.s3.amazonaws.com/mar_files/densenet161.mar\",\n-\t\t\"model_name\": \"densenet161\",\n-\t\t\"worker\": 1,\n-\t\t\"synchronous\": \"true\",\n-\t\t\"file\": \"../examples/image_classifier/kitten.jpg\"\n-\t},\n-\t{\n-\t\t\"url\": \"https://torchserve.s3.amazonaws.com/mar_files/alexnet.mar\",\n-\t\t\"model_name\": \"alexnet\",\n-\t\t\"worker\": 1,\n-\t\t\"synchronous\": \"true\",\n-\t\t\"file\": \"../examples/image_classifier/kitten.jpg\"\n-\t},\n-\t{\n-\t\t\"url\": \"https://torchserve.s3.amazonaws.com/mar_files/resnet-18.mar\",\n-\t\t\"model_name\": \"resnet-18\",\n-\t\t\"worker\": 1,\n-\t\t\"synchronous\": \"true\",\n-\t\t\"file\": \"../examples/image_classifier/kitten.jpg\"\n-\t},\n-\t{\n-\t\t\"url\": \"https://torchserve.s3.amazonaws.com/mar_files/vgg11.mar\",\n-\t\t\"model_name\": \"vgg11\",\n-\t\t\"worker\": 1,\n-\t\t\"synchronous\": \"true\",\n-\t\t\"file\": \"../examples/image_classifier/kitten.jpg\"\n-\t},\n-\t{\n-\t\t\"url\": \"https://torchserve.s3.amazonaws.com/mar_files/mnist.mar\",\n-\t\t\"model_name\": \"mnist\",\n-\t\t\"worker\": 1,\n-\t\t\"synchronous\": \"true\",\n-\t\t\"file\": \"../examples/image_classifier/mnist/test_data/0.png\"\n-\t},\n-\t{\n-\t\t\"url\": \"https://torchserve.s3.amazonaws.com/mar_files/fastrcnn.mar\",\n-\t\t\"model_name\": \"fastrcnn\",\n-\t\t\"worker\": 1,\n-\t\t\"synchronous\": \"true\",\n-\t\t\"file\": \"../examples/object_detector/persons.jpg\"\n-\t},\n-\t{\n-\t\t\"url\": \"https://torchserve.s3.amazonaws.com/mar_files/maskrcnn.mar\",\n-\t\t\"model_name\": \"maskrcnn\",\n-\t\t\"worker\": 1,\n-\t\t\"synchronous\": \"true\",\n-\t\t\"file\": \"../examples/object_detector/persons.jpg\"\n-\t},\n-\t{\n-\t\t\"url\": \"https://torchserve.s3.amazonaws.com/mar_files/fcn_resnet_101.mar\",\n-\t\t\"model_name\": \"fcn_resnet_101\",\n-\t\t\"worker\": 1,\n-\t\t\"synchronous\": \"true\",\n-\t\t\"file\": \"../examples/object_detector/persons.jpg\"\n-\t},\n-\t{\n-\t\t\"url\": \"https://torchserve.s3.amazonaws.com/mar_files/resnet-152-batch.mar\",\n-\t\t\"model_name\": \"resnet152\",\n-\t\t\"worker\": 1,\n-\t\t\"synchronous\": \"true\",\n-\t\t\"file\": \"../examples/image_classifier/kitten.jpg\"\n-\t},\n-        {\n-                \"url\": \"https://torchserve.s3.amazonaws.com/mar_files/roberta_qa_torchscript.mar\",\n-                \"model_name\": \"roberta_qa_torchscript.mar\",\n-                \"worker\": 1,\n-                \"synchronous\": \"true\",\n-                \"file\": \"../examples/Huggingface_Transformers/sample_text.txt\"\n-        },\n-        {\n-                \"url\": \"https://torchserve.s3.amazonaws.com/mar_files/roberta_qa_no_torchscript.mar\",\n-                \"model_name\": \"roberta_qa_no_torchscript\",\n-                \"worker\": 1,\n-                \"synchronous\": \"true\",\n-                \"file\": \"../examples/Huggingface_Transformers/sample_text.txt\"\n-        },\n-        {\n-                \"url\": \"https://torchserve.s3.amazonaws.com/mar_files/bert_token_classification_torchscript.mar\",\n-                \"model_name\": \"bert_token_classification_torchscript\",\n-                \"worker\": 1,\n-                \"synchronous\": \"true\",\n-                \"file\": \"../examples/text_classification/sample_text.txt\"\n-        },\n-        {\n-                \"url\": \"https://torchserve.s3.amazonaws.com/mar_files/bert_token_classification_no_torchscript.mar\",\n-                \"model_name\": \"bert_token_classification_no_torchscript\",\n-                \"worker\": \"1\",\n-                \"synchronous\": \"true\",\n-                \"file\" : \"../examples/text_classification/sample_text.txt\"\n-        },\n-        {\n-                \"url\": \"https://torchserve.s3.amazonaws.com/mar_files/bert_seqc_with_torchscript.mar\",\n-                \"model_name\": \"bert_seqc_with_torchscript\",\n-                \"worker\": \"1\",\n-                \"synchronous\": \"true\",\n-                \"file\" : \"../examples/text_classification/sample_text.txt\"\n-        },\n-        {\n-                \"url\": \"https://torchserve.s3.amazonaws.com/mar_files/bert_seqc_without_torchscript.mar\",\n-                \"model_name\": \"bert_seqc_without_torchscript\",\n-                \"worker\": \"1\",\n-                \"synchronous\": \"true\",\n-                \"file\" : \"../examples/text_classification/sample_text.txt\"\n-        }\n-]\n+[\n+    {\n+        \"url\":\"https://torchserve.s3.amazonaws.com/mar_files/my_text_classifier.mar\",\n+        \"model_name\":\"my_text_classifier\",\n+        \"worker\":1,\n+        \"synchronous\":\"true\",\n+        \"file\":\"../examples/text_classification/sample_text.txt\",\n+        \"content-type\":\"text/plain\",\n+        \"expected\":\"Business\"\n+    },\n+    {\n+        \"url\":\"https://torchserve.s3.amazonaws.com/mar_files/squeezenet1_1.mar\",\n+        \"model_name\":\"squeezenet1_1\",\n+        \"worker\":1,\n+        \"synchronous\":\"true\",\n+        \"file\":\"../examples/image_classifier/kitten.jpg\",\n+        \"content-type\":\"application/json\",\n+        \"validator\":\"image_classification\",\n+        \"expected\":[\n+            {\n+                \"tabby\":0.2752002477645874\n+            },\n+            {\n+                \"lynx\":0.2546876072883606\n+            },\n+            {\n+                \"tiger_cat\":0.24254210293293\n+            },\n+            {\n+                \"Egyptian_cat\":0.2213735282421112\n+            },\n+            {\n+                \"cougar\":0.0022544863168150187\n+            }\n+        ],\n+        \"tolerance\":1\n+    },\n+    {\n+        \"url\":\"https://torchserve.s3.amazonaws.com/mar_files/densenet161.mar\",\n+        \"model_name\":\"densenet161\",\n+        \"worker\":1,\n+        \"synchronous\":\"true\",\n+        \"file\":\"../examples/image_classifier/kitten.jpg\",\n+        \"content-type\":\"application/json\",\n+        \"validator\":\"image_classification\",\n+        \"expected\":[\n+            {\n+                \"tiger_cat\":0.4693359136581421\n+            },\n+            {\n+                \"tabby\":0.4633873701095581\n+            },\n+            {\n+                \"Egyptian_cat\":0.06456154584884644\n+            },\n+            {\n+                \"lynx\":0.001282821292988956\n+            },\n+            {\n+                \"plastic_bag\":0.00023323031200561672\n+            }\n+        ],\n+        \"tolerance\":1\n+    },\n+    {\n+        \"url\":\"https://torchserve.s3.amazonaws.com/mar_files/alexnet.mar\",\n+        \"model_name\":\"alexnet\",\n+        \"worker\":1,\n+        \"synchronous\":\"true\",\n+        \"file\":\"../examples/image_classifier/kitten.jpg\",\n+        \"content-type\":\"application/json\",\n+        \"validator\":\"image_classification\",\n+        \"expected\":[\n+            {\n+                \"tabby\":0.31839194893836975\n+            },\n+            {\n+                \"tiger_cat\":0.2651394307613373\n+            },\n+            {\n+                \"Egyptian_cat\":0.24323278665542603\n+            },\n+            {\n+                \"lynx\":0.16119907796382904\n+            },\n+            {\n+                \"tiger\":0.006510233972221613\n+            }\n+        ],\n+        \"tolerance\":1\n+    },\n+    {\n+        \"url\":\"https://torchserve.s3.amazonaws.com/mar_files/resnet-18.mar\",\n+        \"model_name\":\"resnet-18\",\n+        \"worker\":1,\n+        \"synchronous\":\"true\",\n+        \"file\":\"../examples/image_classifier/kitten.jpg\",\n+        \"content-type\":\"application/json\",\n+        \"validator\":\"image_classification\",\n+        \"expected\":[\n+            {\n+                \"tabby\":0.40864479541778564\n+            },\n+            {\n+                \"tiger_cat\":0.35061511397361755\n+            },\n+            {\n+                \"Egyptian_cat\":0.1260961890220642\n+            },\n+            {\n+                \"lynx\":0.023326940834522247\n+            },\n+            {\n+                \"bucket\":0.011855212040245533\n+            }\n+        ],\n+        \"tolerance\":1\n+    },\n+    {\n+        \"url\":\"https://torchserve.s3.amazonaws.com/mar_files/vgg11.mar\",\n+        \"model_name\":\"vgg11\",\n+        \"worker\":1,\n+        \"synchronous\":\"true\",\n+        \"file\":\"../examples/image_classifier/kitten.jpg\",\n+        \"content-type\":\"application/json\",\n+        \"validator\":\"image_classification\",\n+        \"expected\":[\n+            {\n+                \"tiger_cat\":0.5501413345336914\n+            },\n+            {\n+                \"tabby\":0.3231860101222992\n+            },\n+            {\n+                \"Egyptian_cat\":0.11440037935972214\n+            },\n+            {\n+                \"lynx\":0.006006305105984211\n+            },\n+            {\n+                \"tiger\":0.004394155461341143\n+            }\n+        ],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ef89781c2c29c7b5a5ea43e8828c0a443c00c69"}, "originalPosition": 263}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed99c6237398edc8c1db00ebe23e88db41fe8b69", "author": {"user": {"login": "dhaniram-kshirsagar", "name": null}}, "url": "https://github.com/pytorch/serve/commit/ed99c6237398edc8c1db00ebe23e88db41fe8b69", "committedDate": "2020-06-29T15:05:47Z", "message": "Merge branch 'master' into issue_394"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7b962ec3926297bcb4f60bba652d7e404d13691", "author": {"user": {"login": "shivamshriwas", "name": "shivamshriwas"}}, "url": "https://github.com/pytorch/serve/commit/e7b962ec3926297bcb4f60bba652d7e404d13691", "committedDate": "2020-07-01T21:22:08Z", "message": "fixed regression.sh\n-  resolved issues after merge master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "962197cd8c0472771582b17cbd9a890a739ad25f", "author": {"user": {"login": "shivamshriwas", "name": "shivamshriwas"}}, "url": "https://github.com/pytorch/serve/commit/962197cd8c0472771582b17cbd9a890a739ad25f", "committedDate": "2020-07-01T21:22:58Z", "message": "Merge branch 'issue_394' of https://github.com/pytorch/serve into issue_394"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e0b8062042bd502365e3974b171889d48ce890c", "author": {"user": {"login": "shivamshriwas", "name": "shivamshriwas"}}, "url": "https://github.com/pytorch/serve/commit/1e0b8062042bd502365e3974b171889d48ce890c", "committedDate": "2020-07-01T21:27:17Z", "message": "fixed typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95aa6401ba683126a5d5d3ca3883fb788c6162bd", "author": {"user": {"login": "shivamshriwas", "name": "shivamshriwas"}}, "url": "https://github.com/pytorch/serve/commit/95aa6401ba683126a5d5d3ca3883fb788c6162bd", "committedDate": "2020-07-15T11:49:51Z", "message": "Added torchscripted models for inference api test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7722c7187eda2b6fd84cedf7cbe81ca5b800250f", "author": {"user": {"login": "shivamshriwas", "name": "shivamshriwas"}}, "url": "https://github.com/pytorch/serve/commit/7722c7187eda2b6fd84cedf7cbe81ca5b800250f", "committedDate": "2020-07-15T12:13:11Z", "message": "Merge branch 'master' of https://github.com/pytorch/serve into issue_394\n\n# Conflicts:\n#\ttest/regression_tests.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb4ec166661c163fa398762fe2b0be66c64e9a9c", "author": {"user": {"login": "harshbafna", "name": "Harsh Bafna"}}, "url": "https://github.com/pytorch/serve/commit/fb4ec166661c163fa398762fe2b0be66c64e9a9c", "committedDate": "2020-07-21T05:59:50Z", "message": "Merge branch 'master' into issue_394"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2220, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}