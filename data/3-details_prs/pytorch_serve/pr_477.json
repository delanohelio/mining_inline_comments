{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4Nzk1MzE4", "number": 477, "title": "Issue#466", "bodyText": "Description\nFix the issue with inconsistent behavior of models between eager mode and Torchscript.\nFixes #(issue)\n#466\nType of change\n\n\n Bug fix (non-breaking change which fixes an issue)\n\n\n This change requires a documentation update\n\n\ntesting\n\n\nUse the setting in the for setup_config.json\nsetup_config.log\n\n\nPython Download_Transformer_models.py\n\n\ntorch-model-archiver --model-name DistillBERT_qa_Torchscript --version 1.0 --serialized-file\n\n\nTransformer_model/traced_model.pt --handler ./Transformer_handler_generalized.py --extra-files \"./setup_config.json\"\n\n\nmv DistillBERT_Torchscript.mar model_store\n\n\ntorchserve --start --model-store model_store --models my_tc=DistillBERT_qa_Torchscript.mar\n\n\ncurl -X POST http://127.0.0.1:8080/predictions/my_tc -T ./sample_text.txt\n\n\nRepeat the above steps by modifying the first step and set the save_mode = \"pretrained\" in the setup_config.json\nand for step 2:\ntorch-model-archiver --model-name DistillBERT_qa --version 1.0 --serialized-file Transformer_model/pytorch_model.bin --handler ./Transformer_handler_generalized.py --extra-files \"Transformer_model/config.json,./setup_config.json\"\n\nLogs\nrun.log\n\nChecklist:\n\n Have you added tests that prove your fix is effective or that this feature works?\n Have you made corresponding changes to the documentation?", "createdAt": "2020-06-23T20:14:37Z", "url": "https://github.com/pytorch/serve/pull/477", "merged": true, "mergeCommit": {"oid": "689c78e6a7823ff2b024abd35c50df9400d57f84"}, "closed": true, "closedAt": "2020-06-26T05:59:35Z", "author": {"login": "HamidShojanazeri"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuLHs7AH2gAyNDM4Nzk1MzE4OjFjZGMxNmNkMjE2M2FiOWM5OTQ3Mzk5ODFhNjIwYWUwNzMxODFkMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu4OZ8gH2gAyNDM4Nzk1MzE4OmJjMWVmM2U2YmM3Y2YxNWQxODA5OGNlN2JkOTFjYTg1NzE1YmY4MmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1cdc16cd2163ab9c994739981a620ae073181d26", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/1cdc16cd2163ab9c994739981a620ae073181d26", "committedDate": "2020-06-23T20:03:58Z", "message": " Add manual seed and finetune setting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3b71f4e82d3ec9a751b77de9bcb641a71c2e86d", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/b3b71f4e82d3ec9a751b77de9bcb641a71c2e86d", "committedDate": "2020-06-23T20:05:08Z", "message": "add finetune settiing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d136deecffc719be20e2e360e0304b78eea7257c", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/d136deecffc719be20e2e360e0304b78eea7257c", "committedDate": "2020-06-23T20:05:42Z", "message": "Add manual setting and fine tune option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae6c28d8d90ea11ab6908657a2285fd04a494f9a", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/ae6c28d8d90ea11ab6908657a2285fd04a494f9a", "committedDate": "2020-06-23T20:06:06Z", "message": "Add finetune setting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTMwNzk5", "url": "https://github.com/pytorch/serve/pull/477#pullrequestreview-436130799", "createdAt": "2020-06-23T20:29:36Z", "commit": {"oid": "ae6c28d8d90ea11ab6908657a2285fd04a494f9a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDozMDo0NFrOGn5biQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMToyMTo0NFrOGn7GYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ4ODU4NQ==", "bodyText": "What is the purpose of setting the seed? We are not training the model here, only downloading a trained model, so not clear why this is needed", "url": "https://github.com/pytorch/serve/pull/477#discussion_r444488585", "createdAt": "2020-06-23T20:30:44Z", "author": {"login": "chauhang"}, "path": "examples/Huggingface_Transformers/Download_Transformer_models.py", "diffHunk": "@@ -5,25 +5,26 @@\n import torch\n from transformers import (AutoModelForSequenceClassification, AutoTokenizer, AutoModelForQuestionAnswering,\n  AutoModelForTokenClassification, AutoConfig)\n+from transformers import set_seed\n \"\"\" This function, save the checkpoint, config file along with tokenizer config and vocab files\n     of a transformer model of your choice.\n \"\"\"\n print('Transformers version',transformers.__version__)\n-\n-def transformers_model_dowloader(mode,pretrained_model_name,num_labels,do_lower_case,max_length,torchscript):\n+set_seed(1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae6c28d8d90ea11ab6908657a2285fd04a494f9a"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ4OTYxMw==", "bodyText": "Why is this needed for model predictions?", "url": "https://github.com/pytorch/serve/pull/477#discussion_r444489613", "createdAt": "2020-06-23T20:32:43Z", "author": {"login": "chauhang"}, "path": "examples/Huggingface_Transformers/Transformer_handler_generalized.py", "diffHunk": "@@ -5,11 +5,11 @@\n import ast\n import torch\n from transformers import AutoModelForSequenceClassification, AutoTokenizer, AutoModelForQuestionAnswering,AutoModelForTokenClassification\n-\n+from transformers import set_seed\n from ts.torch_handler.base_handler import BaseHandler\n \n logger = logging.getLogger(__name__)\n-\n+set_seed(1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae6c28d8d90ea11ab6908657a2285fd04a494f9a"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUxNTkzNg==", "bodyText": "There is already a model_name field. Can that not be used for fine tuned models name/path for the finetuned models as well? Please explain why we need a second field.", "url": "https://github.com/pytorch/serve/pull/477#discussion_r444515936", "createdAt": "2020-06-23T21:21:44Z", "author": {"login": "chauhang"}, "path": "examples/Huggingface_Transformers/README.md", "diffHunk": "@@ -58,6 +58,8 @@ In the setup_config.json :\n \n *model_name* : bert-base-uncased , roberta-base or other available pre-trained models.\n \n+*fine_tuned* : name or path to the finetuned model if available, for example \"distilbert-base-cased-distilled-squad\", leave it blank if not available.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae6c28d8d90ea11ab6908657a2285fd04a494f9a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f94aad1fb284596479f788457697e8ba7e6065a6", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/f94aad1fb284596479f788457697e8ba7e6065a6", "committedDate": "2020-06-23T22:09:32Z", "message": "Remove the seed setting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95159f455ffdab47f40f9665d61c8688d51207e0", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/95159f455ffdab47f40f9665d61c8688d51207e0", "committedDate": "2020-06-25T15:55:58Z", "message": " Remove fine_tuned field and added mapping to device to input of trace model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70492f5c850308b8f6e9f578d10862c84d90e501", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/70492f5c850308b8f6e9f578d10862c84d90e501", "committedDate": "2020-06-25T16:05:54Z", "message": "Add calrification on passing required files for passing customized vocab and removing fine_tuned field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a743145ac08026a6bcacd829b2bbe1eeefced8f3", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/a743145ac08026a6bcacd829b2bbe1eeefced8f3", "committedDate": "2020-06-25T16:09:29Z", "message": "Add check for availabilty of vocab files txt or json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab403224e8d233a00e601f93447bef0415ce7333", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/ab403224e8d233a00e601f93447bef0415ce7333", "committedDate": "2020-06-25T18:15:48Z", "message": "remove finetuned filed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46d095be7fcdc21685f4cc660006f850368d7b32", "author": {"user": {"login": "HamidShojanazeri", "name": "Hamid Shojanazeri"}}, "url": "https://github.com/pytorch/serve/commit/46d095be7fcdc21685f4cc660006f850368d7b32", "committedDate": "2020-06-25T19:16:14Z", "message": "clean up"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3OTQ1ODky", "url": "https://github.com/pytorch/serve/pull/477#pullrequestreview-437945892", "createdAt": "2020-06-26T00:36:51Z", "commit": {"oid": "46d095be7fcdc21685f4cc660006f850368d7b32"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc1ef3e6bc7cf15d18098ce7bd91ca85715bf82b", "author": {"user": {"login": "chauhang", "name": "Geeta Chauhan"}}, "url": "https://github.com/pytorch/serve/commit/bc1ef3e6bc7cf15d18098ce7bd91ca85715bf82b", "committedDate": "2020-06-26T00:37:01Z", "message": "Merge branch 'master' into issue#466"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2232, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}