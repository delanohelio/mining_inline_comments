{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NTQxNzA1", "number": 1167, "title": "UI: Fix Role Permissions Options", "bodyText": "Only display the contexts relevant to the descriptor selected\nShow no contexts until descriptor selected\nHide upload permissions for descriptors other than Settings", "createdAt": "2020-09-15T20:21:34Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167", "merged": true, "mergeCommit": {"oid": "0a4195ffb64ae997aad80b6dd5915382cf3c05a3"}, "closed": true, "closedAt": "2020-09-16T12:46:47Z", "author": {"login": "gkillough"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJNHeWgH2gAyNDg3NTQxNzA1OjdmYjYwYmE1NDZjZGY1NTFkZDc5ODliOTQzOTI5OTYzMDczNThiY2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJby4bAFqTQ4OTU4NTQ3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7fb60ba546cdf551dd7989b94392996307358bca", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7fb60ba546cdf551dd7989b94392996307358bca", "committedDate": "2020-09-15T19:39:29Z", "message": "Fix(JS): Only display relevant contexts in permissions table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/8a3a47e7065d54637b090170fcb28cdbd38383c7", "committedDate": "2020-09-15T20:13:45Z", "message": "Fix(JS): Hide upload permissions as options for non-settings descriptors in roles table"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDQxNTc2", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#pullrequestreview-489041576", "createdAt": "2020-09-15T20:22:53Z", "commit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDoyMjo1M1rOHSTLIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDoyMjo1M1rOHSTLIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1MDU2MQ==", "bodyText": "If the settings permissions happen to be set, unset them if the descriptor isn't 'Settings'.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r488950561", "createdAt": "2020-09-15T20:22:53Z", "author": {"login": "gkillough"}, "path": "src/main/js/dynamic/loaded/users/PermissionTable.js", "diffHunk": "@@ -47,7 +48,15 @@ class PermissionTable extends Component {\n         const updatedValue = type === 'checkbox' ? checked.toString()\n             .toLowerCase() === 'true' : value;\n         const trimmedValue = (Array.isArray(updatedValue) && updatedValue.length > 0) ? updatedValue[0] : updatedValue;\n-        const newPermissions = Object.assign(permissionsData, { [name]: trimmedValue });\n+\n+        let newPermissions = Object.assign(permissionsData, { [name]: trimmedValue });\n+        if (newPermissions && newPermissions.descriptorName !== 'Settings') {\n+            newPermissions = Object.assign(newPermissions, {\n+                [PERMISSIONS_TABLE.UPLOAD_READ]: undefined,\n+                [PERMISSIONS_TABLE.UPLOAD_WRITE]: undefined,\n+                [PERMISSIONS_TABLE.UPLOAD_DELETE]: undefined\n+            });\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDQyMjM4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#pullrequestreview-489042238", "createdAt": "2020-09-15T20:23:51Z", "commit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDoyMzo1MVrOHSTNFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDoyMzo1MVrOHSTNFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1MTA2Mw==", "bodyText": "If the user changes descriptors, clear the context if it is no longer relevant to the new descriptor.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r488951063", "createdAt": "2020-09-15T20:23:51Z", "author": {"login": "gkillough"}, "path": "src/main/js/dynamic/loaded/users/PermissionTable.js", "diffHunk": "@@ -147,13 +156,30 @@ class PermissionTable extends Component {\n     }\n \n     createContextOptions() {\n-        return [{\n-            label: CONTEXT_TYPE.DISTRIBUTION,\n-            value: CONTEXT_TYPE.DISTRIBUTION\n-        }, {\n-            label: CONTEXT_TYPE.GLOBAL,\n-            value: CONTEXT_TYPE.GLOBAL\n-        }];\n+        const { permissionsData } = this.state;\n+        const { descriptors } = this.props;\n+\n+        const availableContexts = [];\n+        if (permissionsData && permissionsData.descriptorName) {\n+            descriptors.forEach((descriptor) => {\n+                if (descriptor.label === permissionsData.descriptorName) {\n+                    availableContexts.push(descriptor.context);\n+                }\n+            });\n+\n+            if (permissionsData.context && !availableContexts.includes(permissionsData.context)) {\n+                this.setState({\n+                    permissionsData: {\n+                        descriptorName: permissionsData.descriptorName\n+                    }\n+                });\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDQ5ODE3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#pullrequestreview-489049817", "createdAt": "2020-09-15T20:34:57Z", "commit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDozNDo1N1rOHSTj_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDozNDo1N1rOHSTj_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk1NjkyNg==", "bodyText": "This import should be absolute not relative", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r488956926", "createdAt": "2020-09-15T20:34:57Z", "author": {"login": "jamesrichard91"}, "path": "src/main/js/dynamic/loaded/users/PermissionTable.js", "diffHunk": "@@ -4,6 +4,7 @@ import TableDisplay from 'field/TableDisplay';\n import DynamicSelectInput from 'field/input/DynamicSelect';\n import CheckboxInput from 'field/input/CheckboxInput';\n import { CONTEXT_TYPE } from 'util/descriptorUtilities';\n+import StatusMessage from '../../../field/StatusMessage';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDUxMTI5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#pullrequestreview-489051129", "createdAt": "2020-09-15T20:36:49Z", "commit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDY2MDA5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#pullrequestreview-489066009", "createdAt": "2020-09-15T20:59:09Z", "commit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTU0Nzgw", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#pullrequestreview-489554780", "createdAt": "2020-09-16T12:05:49Z", "commit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjowNTo0OVrOHStpDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMjowNTo0OVrOHStpDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM4NDIwNQ==", "bodyText": "Same as above use 'Authentication' not 'Settings'", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#discussion_r489384205", "createdAt": "2020-09-16T12:05:49Z", "author": {"login": "psantos1113"}, "path": "src/main/js/dynamic/loaded/users/PermissionTable.js", "diffHunk": "@@ -178,11 +204,44 @@ class PermissionTable extends Component {\n     }\n \n     createPermissionsModal() {\n-        const { permissionsData } = this.state;\n+        const { permissionsData, errorMessage } = this.state;\n+\n+        let uploadInputs;\n+        // Currently, there does not seem to be a good way to filter this dynamically.\n+        // For now, restrict upload permissions to 'Settings'.\n+        if (permissionsData && permissionsData.descriptorName === 'Settings') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTU1MjE0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#pullrequestreview-489555214", "createdAt": "2020-09-16T12:06:26Z", "commit": {"oid": "8a3a47e7065d54637b090170fcb28cdbd38383c7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdeb971bf7091a4a4f78c10556a42155064a7e4c", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/bdeb971bf7091a4a4f78c10556a42155064a7e4c", "committedDate": "2020-09-16T12:41:01Z", "message": "Fix(JS): Change upload permission UI restriction to 'Authentication' from 'Settings'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTg0Mzcw", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#pullrequestreview-489584370", "createdAt": "2020-09-16T12:44:38Z", "commit": {"oid": "bdeb971bf7091a4a4f78c10556a42155064a7e4c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTg1NDc2", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1167#pullrequestreview-489585476", "createdAt": "2020-09-16T12:45:34Z", "commit": {"oid": "bdeb971bf7091a4a4f78c10556a42155064a7e4c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3474, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}