{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NjMzNzIw", "number": 981, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyNDo1NFrOD9fMKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxOTo0Njo0MFrOD9h8xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODAwNzQ0OnYy", "diffSide": "RIGHT", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/util/DateUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyNDo1NFrOGXAxqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyNzozOVrOGXA3sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4MzE0Nw==", "bodyText": "Shouldn't this be\n return OffsetDateTime.now(ZoneOffset.UTC);", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426783147", "createdAt": "2020-05-18T17:24:54Z", "author": {"login": "jamesrichard91"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/util/DateUtils.java", "diffHunk": "@@ -24,38 +24,46 @@\n \n import java.text.ParseException;\n import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n import java.time.ZoneOffset;\n-import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeParseException;\n import java.util.Date;\n-import java.util.TimeZone;\n \n public final class DateUtils {\n     public static final String DOCKER_DATE_FORMAT = \"yyyy-MM-dd'T'HH:mm:ss.SSSSSS'Z'\";\n     public static final String AUDIT_DATE_FORMAT = \"yyyy-MM-dd HH:mm:ss.SSS\";\n     public static final String UTC_DATE_FORMAT_TO_MINUTE = \"yyyy-MM-dd HH:mm '(UTC)'\";\n \n-    public static Date createCurrentDateTimestamp() {\n-        final ZonedDateTime zonedDateTime = ZonedDateTime.now().withZoneSameInstant(ZoneOffset.UTC);\n-        return Date.from(zonedDateTime.toInstant());\n+    public static OffsetDateTime createCurrentDateTimestamp() {\n+        return OffsetDateTime.now();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NDY4OA==", "bodyText": "OffsetDateTime stores the UTC time.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426784688", "createdAt": "2020-05-18T17:27:39Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/util/DateUtils.java", "diffHunk": "@@ -24,38 +24,46 @@\n \n import java.text.ParseException;\n import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n import java.time.ZoneOffset;\n-import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeParseException;\n import java.util.Date;\n-import java.util.TimeZone;\n \n public final class DateUtils {\n     public static final String DOCKER_DATE_FORMAT = \"yyyy-MM-dd'T'HH:mm:ss.SSSSSS'Z'\";\n     public static final String AUDIT_DATE_FORMAT = \"yyyy-MM-dd HH:mm:ss.SSS\";\n     public static final String UTC_DATE_FORMAT_TO_MINUTE = \"yyyy-MM-dd HH:mm '(UTC)'\";\n \n-    public static Date createCurrentDateTimestamp() {\n-        final ZonedDateTime zonedDateTime = ZonedDateTime.now().withZoneSameInstant(ZoneOffset.UTC);\n-        return Date.from(zonedDateTime.toInstant());\n+    public static OffsetDateTime createCurrentDateTimestamp() {\n+        return OffsetDateTime.now();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4MzE0Nw=="}, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODAwOTcyOnYy", "diffSide": "RIGHT", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/util/DateUtils.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyNToyN1rOGXAy-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzozNDo0M1rOGXBGeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4MzQ4Mw==", "bodyText": "Shouldn't this still call createCurrentDateTimestamp?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426783483", "createdAt": "2020-05-18T17:25:27Z", "author": {"login": "jamesrichard91"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/util/DateUtils.java", "diffHunk": "@@ -24,38 +24,46 @@\n \n import java.text.ParseException;\n import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n import java.time.ZoneOffset;\n-import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeParseException;\n import java.util.Date;\n-import java.util.TimeZone;\n \n public final class DateUtils {\n     public static final String DOCKER_DATE_FORMAT = \"yyyy-MM-dd'T'HH:mm:ss.SSSSSS'Z'\";\n     public static final String AUDIT_DATE_FORMAT = \"yyyy-MM-dd HH:mm:ss.SSS\";\n     public static final String UTC_DATE_FORMAT_TO_MINUTE = \"yyyy-MM-dd HH:mm '(UTC)'\";\n \n-    public static Date createCurrentDateTimestamp() {\n-        final ZonedDateTime zonedDateTime = ZonedDateTime.now().withZoneSameInstant(ZoneOffset.UTC);\n-        return Date.from(zonedDateTime.toInstant());\n+    public static OffsetDateTime createCurrentDateTimestamp() {\n+        return OffsetDateTime.now();\n     }\n \n     public static String createCurrentDateString(String format) {\n-        Date currentDate = createCurrentDateTimestamp();\n+        OffsetDateTime currentDate = OffsetDateTime.now();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NDg4Mw==", "bodyText": "I probably should have deprecated that method. I will do that now.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426784883", "createdAt": "2020-05-18T17:27:59Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/util/DateUtils.java", "diffHunk": "@@ -24,38 +24,46 @@\n \n import java.text.ParseException;\n import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n import java.time.ZoneOffset;\n-import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeParseException;\n import java.util.Date;\n-import java.util.TimeZone;\n \n public final class DateUtils {\n     public static final String DOCKER_DATE_FORMAT = \"yyyy-MM-dd'T'HH:mm:ss.SSSSSS'Z'\";\n     public static final String AUDIT_DATE_FORMAT = \"yyyy-MM-dd HH:mm:ss.SSS\";\n     public static final String UTC_DATE_FORMAT_TO_MINUTE = \"yyyy-MM-dd HH:mm '(UTC)'\";\n \n-    public static Date createCurrentDateTimestamp() {\n-        final ZonedDateTime zonedDateTime = ZonedDateTime.now().withZoneSameInstant(ZoneOffset.UTC);\n-        return Date.from(zonedDateTime.toInstant());\n+    public static OffsetDateTime createCurrentDateTimestamp() {\n+        return OffsetDateTime.now();\n     }\n \n     public static String createCurrentDateString(String format) {\n-        Date currentDate = createCurrentDateTimestamp();\n+        OffsetDateTime currentDate = OffsetDateTime.now();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4MzQ4Mw=="}, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4ODQ3Mw==", "bodyText": "After a quick offline discussion, it makes more sense to keep this method and replace the OffsetDateTime.now() to minimize type migration headaches in the future.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426788473", "createdAt": "2020-05-18T17:34:43Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/util/DateUtils.java", "diffHunk": "@@ -24,38 +24,46 @@\n \n import java.text.ParseException;\n import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n import java.time.ZoneOffset;\n-import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeParseException;\n import java.util.Date;\n-import java.util.TimeZone;\n \n public final class DateUtils {\n     public static final String DOCKER_DATE_FORMAT = \"yyyy-MM-dd'T'HH:mm:ss.SSSSSS'Z'\";\n     public static final String AUDIT_DATE_FORMAT = \"yyyy-MM-dd HH:mm:ss.SSS\";\n     public static final String UTC_DATE_FORMAT_TO_MINUTE = \"yyyy-MM-dd HH:mm '(UTC)'\";\n \n-    public static Date createCurrentDateTimestamp() {\n-        final ZonedDateTime zonedDateTime = ZonedDateTime.now().withZoneSameInstant(ZoneOffset.UTC);\n-        return Date.from(zonedDateTime.toInstant());\n+    public static OffsetDateTime createCurrentDateTimestamp() {\n+        return OffsetDateTime.now();\n     }\n \n     public static String createCurrentDateString(String format) {\n-        Date currentDate = createCurrentDateTimestamp();\n+        OffsetDateTime currentDate = OffsetDateTime.now();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4MzQ4Mw=="}, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODAxMjYxOnYy", "diffSide": "RIGHT", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/util/DateUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyNjoyMlrOGXA07A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxOTo0ODoxMlrOGXFQ6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4Mzk4MA==", "bodyText": "Are we sure this is alright without setting the timezone?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426783980", "createdAt": "2020-05-18T17:26:22Z", "author": {"login": "jamesrichard91"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/util/DateUtils.java", "diffHunk": "@@ -24,38 +24,46 @@\n \n import java.text.ParseException;\n import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n import java.time.ZoneOffset;\n-import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeParseException;\n import java.util.Date;\n-import java.util.TimeZone;\n \n public final class DateUtils {\n     public static final String DOCKER_DATE_FORMAT = \"yyyy-MM-dd'T'HH:mm:ss.SSSSSS'Z'\";\n     public static final String AUDIT_DATE_FORMAT = \"yyyy-MM-dd HH:mm:ss.SSS\";\n     public static final String UTC_DATE_FORMAT_TO_MINUTE = \"yyyy-MM-dd HH:mm '(UTC)'\";\n \n-    public static Date createCurrentDateTimestamp() {\n-        final ZonedDateTime zonedDateTime = ZonedDateTime.now().withZoneSameInstant(ZoneOffset.UTC);\n-        return Date.from(zonedDateTime.toInstant());\n+    public static OffsetDateTime createCurrentDateTimestamp() {\n+        return OffsetDateTime.now();\n     }\n \n     public static String createCurrentDateString(String format) {\n-        Date currentDate = createCurrentDateTimestamp();\n+        OffsetDateTime currentDate = OffsetDateTime.now();\n         return formatDate(currentDate, format);\n     }\n \n-    public static String formatDate(Date date, String format) {\n-        SimpleDateFormat simpleDateFormat = new SimpleDateFormat(format);\n-        simpleDateFormat.setTimeZone(TimeZone.getTimeZone(\"UTC\"));\n-        return simpleDateFormat.format(date);\n+    public static String formatDate(OffsetDateTime date, String format) {\n+        DateTimeFormatter dtf = DateTimeFormatter.ofPattern(format);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg1NjY4MQ==", "bodyText": "We are treating all dates as if they were UTC now, so this should be fine.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426856681", "createdAt": "2020-05-18T19:48:12Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/util/DateUtils.java", "diffHunk": "@@ -24,38 +24,46 @@\n \n import java.text.ParseException;\n import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n import java.time.ZoneOffset;\n-import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeParseException;\n import java.util.Date;\n-import java.util.TimeZone;\n \n public final class DateUtils {\n     public static final String DOCKER_DATE_FORMAT = \"yyyy-MM-dd'T'HH:mm:ss.SSSSSS'Z'\";\n     public static final String AUDIT_DATE_FORMAT = \"yyyy-MM-dd HH:mm:ss.SSS\";\n     public static final String UTC_DATE_FORMAT_TO_MINUTE = \"yyyy-MM-dd HH:mm '(UTC)'\";\n \n-    public static Date createCurrentDateTimestamp() {\n-        final ZonedDateTime zonedDateTime = ZonedDateTime.now().withZoneSameInstant(ZoneOffset.UTC);\n-        return Date.from(zonedDateTime.toInstant());\n+    public static OffsetDateTime createCurrentDateTimestamp() {\n+        return OffsetDateTime.now();\n     }\n \n     public static String createCurrentDateString(String format) {\n-        Date currentDate = createCurrentDateTimestamp();\n+        OffsetDateTime currentDate = OffsetDateTime.now();\n         return formatDate(currentDate, format);\n     }\n \n-    public static String formatDate(Date date, String format) {\n-        SimpleDateFormat simpleDateFormat = new SimpleDateFormat(format);\n-        simpleDateFormat.setTimeZone(TimeZone.getTimeZone(\"UTC\"));\n-        return simpleDateFormat.format(date);\n+    public static String formatDate(OffsetDateTime date, String format) {\n+        DateTimeFormatter dtf = DateTimeFormatter.ofPattern(format);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4Mzk4MA=="}, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODAxNzIwOnYy", "diffSide": "RIGHT", "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultAuditUtility.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyNzo0N1rOGXA3-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyNzo0N1rOGXA3-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NDc2MA==", "bodyText": "I think we should be using DateUtils.createCurrentDateTimestamp() across Alert when we are getting the current time.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426784760", "createdAt": "2020-05-18T17:27:47Z", "author": {"login": "jamesrichard91"}, "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultAuditUtility.java", "diffHunk": "@@ -134,7 +134,7 @@ public DefaultAuditUtility(AuditEntryRepository auditEntryRepository, AuditNotif\n                                                   .concat(componentNotificationIds.stream(), topLevelActionNotificationIds.stream())\n                                                   .collect(Collectors.toSet());\n         for (Long notificationId : allMessageNotificationIds) {\n-            AuditEntryEntity auditEntryEntity = new AuditEntryEntity(jobId, new Date(System.currentTimeMillis()), null, null, null, null);\n+            AuditEntryEntity auditEntryEntity = new AuditEntryEntity(jobId, OffsetDateTime.now(), null, null, null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODAxODkzOnYy", "diffSide": "RIGHT", "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultAuditUtility.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyODoxOVrOGXA5LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyODoxOVrOGXA5LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NTA2OQ==", "bodyText": "I think we should be using DateUtils.createCurrentDateTimestamp()", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426785069", "createdAt": "2020-05-18T17:28:19Z", "author": {"login": "jamesrichard91"}, "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultAuditUtility.java", "diffHunk": "@@ -166,7 +166,7 @@ public void setAuditEntrySuccess(Collection<Long> auditEntryIds) {\n                 auditEntryEntity.setStatus(AuditEntryStatus.SUCCESS.toString());\n                 auditEntryEntity.setErrorMessage(null);\n                 auditEntryEntity.setErrorStackTrace(null);\n-                auditEntryEntity.setTimeLastSent(new Date(System.currentTimeMillis()));\n+                auditEntryEntity.setTimeLastSent(OffsetDateTime.now());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODAxOTI0OnYy", "diffSide": "RIGHT", "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultAuditUtility.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyODoyNFrOGXA5Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyODoyNFrOGXA5Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NTEyMw==", "bodyText": "I think we should be using DateUtils.createCurrentDateTimestamp()", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426785123", "createdAt": "2020-05-18T17:28:24Z", "author": {"login": "jamesrichard91"}, "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultAuditUtility.java", "diffHunk": "@@ -197,7 +197,7 @@ public void setAuditEntryFailure(Collection<Long> auditEntryIds, String errorMes\n                     }\n                 }\n                 auditEntryEntity.setErrorStackTrace(exceptionStackTrace);\n-                auditEntryEntity.setTimeLastSent(new Date(System.currentTimeMillis()));\n+                auditEntryEntity.setTimeLastSent(OffsetDateTime.now());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODAyMjMwOnYy", "diffSide": "RIGHT", "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultNotificationManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoyOToyNVrOGXA7VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxOToxMDowNFrOGXEIFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NTYyMQ==", "bodyText": "Shouldn't we get the offset date time for UTC?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426785621", "createdAt": "2020-05-18T17:29:25Z", "author": {"login": "jamesrichard91"}, "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultNotificationManager.java", "diffHunk": "@@ -136,26 +134,24 @@ public DefaultNotificationManager(NotificationContentRepository notificationCont\n \n     @Override\n     @Transactional(readOnly = true, isolation = Isolation.READ_COMMITTED)\n-    public List<AlertNotificationModel> findByCreatedAtBetween(Date startDate, Date endDate) {\n+    public List<AlertNotificationModel> findByCreatedAtBetween(OffsetDateTime startDate, OffsetDateTime endDate) {\n         List<NotificationEntity> byCreatedAtBetween = notificationContentRepository.findByCreatedAtBetween(startDate, endDate);\n         return toModels(byCreatedAtBetween);\n     }\n \n     @Override\n     @Transactional(readOnly = true, isolation = Isolation.READ_COMMITTED)\n-    public List<AlertNotificationModel> findByCreatedAtBefore(Date date) {\n+    public List<AlertNotificationModel> findByCreatedAtBefore(OffsetDateTime date) {\n         List<NotificationEntity> byCreatedAtBefore = notificationContentRepository.findByCreatedAtBefore(date);\n         return toModels(byCreatedAtBefore);\n     }\n \n     @Override\n     public List<AlertNotificationModel> findByCreatedAtBeforeDayOffset(int dayOffset) {\n-        ZonedDateTime zonedDate = ZonedDateTime.now();\n-        zonedDate = zonedDate.minusDays(dayOffset);\n-        zonedDate = zonedDate.withZoneSameInstant(ZoneOffset.UTC);\n-        zonedDate = zonedDate.withHour(0).withMinute(0).withSecond(0).withNano(0);\n-        Date date = Date.from(zonedDate.toInstant());\n-        return findByCreatedAtBefore(date);\n+        OffsetDateTime searchTime = OffsetDateTime.now()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgzODAzOQ==", "bodyText": "as mentioned earlier OffsetDateTime.now() get's the time for UTC.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426838039", "createdAt": "2020-05-18T19:10:04Z", "author": {"login": "psantos1113"}, "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultNotificationManager.java", "diffHunk": "@@ -136,26 +134,24 @@ public DefaultNotificationManager(NotificationContentRepository notificationCont\n \n     @Override\n     @Transactional(readOnly = true, isolation = Isolation.READ_COMMITTED)\n-    public List<AlertNotificationModel> findByCreatedAtBetween(Date startDate, Date endDate) {\n+    public List<AlertNotificationModel> findByCreatedAtBetween(OffsetDateTime startDate, OffsetDateTime endDate) {\n         List<NotificationEntity> byCreatedAtBetween = notificationContentRepository.findByCreatedAtBetween(startDate, endDate);\n         return toModels(byCreatedAtBetween);\n     }\n \n     @Override\n     @Transactional(readOnly = true, isolation = Isolation.READ_COMMITTED)\n-    public List<AlertNotificationModel> findByCreatedAtBefore(Date date) {\n+    public List<AlertNotificationModel> findByCreatedAtBefore(OffsetDateTime date) {\n         List<NotificationEntity> byCreatedAtBefore = notificationContentRepository.findByCreatedAtBefore(date);\n         return toModels(byCreatedAtBefore);\n     }\n \n     @Override\n     public List<AlertNotificationModel> findByCreatedAtBeforeDayOffset(int dayOffset) {\n-        ZonedDateTime zonedDate = ZonedDateTime.now();\n-        zonedDate = zonedDate.minusDays(dayOffset);\n-        zonedDate = zonedDate.withZoneSameInstant(ZoneOffset.UTC);\n-        zonedDate = zonedDate.withHour(0).withMinute(0).withSecond(0).withNano(0);\n-        Date date = Date.from(zonedDate.toInstant());\n-        return findByCreatedAtBefore(date);\n+        OffsetDateTime searchTime = OffsetDateTime.now()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NTYyMQ=="}, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODA3MjY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/workflow/scheduled/PurgeTask.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzo0NDo0MlrOGXBatQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxOTozMjoyNVrOGXEzOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5MzY1Mw==", "bodyText": "There are a few places we create a Date and substract an offset. Shouldn't we have a method in DateUtils to do this?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426793653", "createdAt": "2020-05-18T17:44:42Z", "author": {"login": "jamesrichard91"}, "path": "src/main/java/com/synopsys/integration/alert/workflow/scheduled/PurgeTask.java", "diffHunk": "@@ -130,20 +128,19 @@ private void purgeNotifications() {\n \n     private void purgeSystemMessages() {\n         try {\n-            Date date = createDate();\n+            OffsetDateTime date = createDate();\n             List<SystemMessageModel> messages = systemMessageUtility.getSystemMessagesBefore(date);\n             systemMessageUtility.deleteSystemMessages(messages);\n         } catch (Exception ex) {\n             logger.error(\"Error purging system messages\", ex);\n         }\n     }\n \n-    public Date createDate() {\n-        ZonedDateTime zonedDate = ZonedDateTime.now();\n-        zonedDate = zonedDate.minusDays(dayOffset);\n-        zonedDate = zonedDate.withZoneSameInstant(ZoneOffset.UTC);\n-        zonedDate = zonedDate.withHour(0).withMinute(0).withSecond(0).withNano(0);\n-        return Date.from(zonedDate.toInstant());\n+    // TODO give this method a more descriptive name\n+    public OffsetDateTime createDate() {\n+        return OffsetDateTime.now()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg0OTA4Mw==", "bodyText": "I see this used in NotificationManager.findByCreatedAtBeforeDayOffset and PurgeTask but the NotificationMananger interface I don't find any usage of the method outside of tests.  It may have been used in processing in the past but may not be used anymore.  We might want to TODO or FIXME to remove the method in NotificationManager", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426849083", "createdAt": "2020-05-18T19:32:25Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/workflow/scheduled/PurgeTask.java", "diffHunk": "@@ -130,20 +128,19 @@ private void purgeNotifications() {\n \n     private void purgeSystemMessages() {\n         try {\n-            Date date = createDate();\n+            OffsetDateTime date = createDate();\n             List<SystemMessageModel> messages = systemMessageUtility.getSystemMessagesBefore(date);\n             systemMessageUtility.deleteSystemMessages(messages);\n         } catch (Exception ex) {\n             logger.error(\"Error purging system messages\", ex);\n         }\n     }\n \n-    public Date createDate() {\n-        ZonedDateTime zonedDate = ZonedDateTime.now();\n-        zonedDate = zonedDate.minusDays(dayOffset);\n-        zonedDate = zonedDate.withZoneSameInstant(ZoneOffset.UTC);\n-        zonedDate = zonedDate.withHour(0).withMinute(0).withSecond(0).withNano(0);\n-        return Date.from(zonedDate.toInstant());\n+    // TODO give this method a more descriptive name\n+    public OffsetDateTime createDate() {\n+        return OffsetDateTime.now()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5MzY1Mw=="}, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODEwMzMyOnYy", "diffSide": "RIGHT", "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/DefaultNotificationManagerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzo1MzozM1rOGXBtuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxODoxNDowOVrOGXCXwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5ODUyMw==", "bodyText": "Does this work? I don't see any methods that accept a date object in OffsetDateTime, would this need to be rewritten to something like OffsetDateTime.now()?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426798523", "createdAt": "2020-05-18T17:53:33Z", "author": {"login": "ChomickiM"}, "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/DefaultNotificationManagerTest.java", "diffHunk": "@@ -47,8 +48,8 @@\n \n     @Test\n     public void saveAllNotificationsTest() throws Exception {\n-        Date createdAt = new Date();\n-        Date providerCreationTime = new Date(System.currentTimeMillis() - 10000);\n+        OffsetDateTime createdAt = new Date();\n+        OffsetDateTime providerCreationTime = new Date(System.currentTimeMillis() - 10000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgwOTI4MA==", "bodyText": "Good catch.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426809280", "createdAt": "2020-05-18T18:14:09Z", "author": {"login": "gkillough"}, "path": "alert-database/src/test/java/com/synopsys/integration/alert/database/api/DefaultNotificationManagerTest.java", "diffHunk": "@@ -47,8 +48,8 @@\n \n     @Test\n     public void saveAllNotificationsTest() throws Exception {\n-        Date createdAt = new Date();\n-        Date providerCreationTime = new Date(System.currentTimeMillis() - 10000);\n+        OffsetDateTime createdAt = new Date();\n+        OffsetDateTime providerCreationTime = new Date(System.currentTimeMillis() - 10000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5ODUyMw=="}, "originalCommit": {"oid": "0381525834d38ea33248ee7354c47fce01036b0c"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODQ1OTU4OnYy", "diffSide": "RIGHT", "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultAuditUtility.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxOTo0Njo0MFrOGXFNwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMDowMDoxNlrOGXFnug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg1NTg3Mg==", "bodyText": "In a separate conversation you mentioned that DateUtils.AUDIT_DATE_FORMAT was used in a test only, but this class was using the format. The method that uses the parseDateString is converting to paged models.  I believe it is being used. Is this correct to replace this format with the less precise minute format?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426855872", "createdAt": "2020-05-18T19:46:40Z", "author": {"login": "psantos1113"}, "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultAuditUtility.java", "diffHunk": "@@ -346,10 +345,10 @@ private NotificationConfig populateConfigFromEntity(AlertNotificationModel notif\n         return new NotificationConfig(id, createdAt, notificationEntity.getProvider(), providerConfigId, providerConfigName, providerCreationTime, notificationEntity.getNotificationType(), notificationEntity.getContent());\n     }\n \n-    private Date parseDateString(String dateString) {\n-        Date date = null;\n+    private OffsetDateTime parseDateString(String dateString) {\n+        OffsetDateTime date = null;\n         try {\n-            date = DateUtils.parseDate(dateString, DateUtils.AUDIT_DATE_FORMAT);\n+            date = DateUtils.parseDate(dateString, DateUtils.UTC_DATE_FORMAT_TO_MINUTE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8d347399443bcd975c5e38276a55e124fb1082e7"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg2MjUyMg==", "bodyText": "Yeah, I must have missed this reference in the refactor. I think you are correct and we should keep it.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/981#discussion_r426862522", "createdAt": "2020-05-18T20:00:16Z", "author": {"login": "gkillough"}, "path": "alert-database/src/main/java/com/synopsys/integration/alert/database/api/DefaultAuditUtility.java", "diffHunk": "@@ -346,10 +345,10 @@ private NotificationConfig populateConfigFromEntity(AlertNotificationModel notif\n         return new NotificationConfig(id, createdAt, notificationEntity.getProvider(), providerConfigId, providerConfigName, providerCreationTime, notificationEntity.getNotificationType(), notificationEntity.getContent());\n     }\n \n-    private Date parseDateString(String dateString) {\n-        Date date = null;\n+    private OffsetDateTime parseDateString(String dateString) {\n+        OffsetDateTime date = null;\n         try {\n-            date = DateUtils.parseDate(dateString, DateUtils.AUDIT_DATE_FORMAT);\n+            date = DateUtils.parseDate(dateString, DateUtils.UTC_DATE_FORMAT_TO_MINUTE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg1NTg3Mg=="}, "originalCommit": {"oid": "8d347399443bcd975c5e38276a55e124fb1082e7"}, "originalPosition": 95}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2015, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}