{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyMjk3NDcw", "number": 1161, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMTowOTowNFrOEhaneA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMToxNTowN1rOEhauTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNDc0NTUyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsRequestDelegator.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMTowOTowNFrOHOuGOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDowNzo1NlrOHPJK6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5NzM3MQ==", "bodyText": "Im not sure if this covers the TODO on line 72 for validating the configuration. Was there more to be validated once the connection is established?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1161#discussion_r485197371", "createdAt": "2020-09-08T21:09:04Z", "author": {"login": "jamesrichard91"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsRequestDelegator.java", "diffHunk": "@@ -63,6 +63,7 @@ public AzureBoardsRequestDelegator(Gson gson, ProxyManager proxyManager, AzureBo\n     public IssueTrackerResponse sendRequests(List<IssueTrackerRequest> requests) throws IntegrationException {\n         IssueConfig azureIssueConfig = context.getIssueConfig();\n         AzureBoardsProperties azureBoardsProperties = context.getIssueTrackerConfig();\n+        azureBoardsProperties.validateProperties();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b30ab0ad4afa5797bf1dcfba09db365555ea12d1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU1OTAxNQ==", "bodyText": "I think your code handles the TODO. The only other problem I foresee is having the wrong scopes.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1161#discussion_r485559015", "createdAt": "2020-09-09T12:06:47Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsRequestDelegator.java", "diffHunk": "@@ -63,6 +63,7 @@ public AzureBoardsRequestDelegator(Gson gson, ProxyManager proxyManager, AzureBo\n     public IssueTrackerResponse sendRequests(List<IssueTrackerRequest> requests) throws IntegrationException {\n         IssueConfig azureIssueConfig = context.getIssueConfig();\n         AzureBoardsProperties azureBoardsProperties = context.getIssueTrackerConfig();\n+        azureBoardsProperties.validateProperties();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5NzM3MQ=="}, "originalCommit": {"oid": "b30ab0ad4afa5797bf1dcfba09db365555ea12d1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU2MDA1NQ==", "bodyText": "I guess we might probably want to validate the connection by performing a HEAD request to some endpoint like projects.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1161#discussion_r485560055", "createdAt": "2020-09-09T12:08:41Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsRequestDelegator.java", "diffHunk": "@@ -63,6 +63,7 @@ public AzureBoardsRequestDelegator(Gson gson, ProxyManager proxyManager, AzureBo\n     public IssueTrackerResponse sendRequests(List<IssueTrackerRequest> requests) throws IntegrationException {\n         IssueConfig azureIssueConfig = context.getIssueConfig();\n         AzureBoardsProperties azureBoardsProperties = context.getIssueTrackerConfig();\n+        azureBoardsProperties.validateProperties();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5NzM3MQ=="}, "originalCommit": {"oid": "b30ab0ad4afa5797bf1dcfba09db365555ea12d1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU2NjgwNw==", "bodyText": "Your code handles the TODO.  Yes if the application is configured with different scopes than we expect then that will cause a failure.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1161#discussion_r485566807", "createdAt": "2020-09-09T12:20:49Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsRequestDelegator.java", "diffHunk": "@@ -63,6 +63,7 @@ public AzureBoardsRequestDelegator(Gson gson, ProxyManager proxyManager, AzureBo\n     public IssueTrackerResponse sendRequests(List<IssueTrackerRequest> requests) throws IntegrationException {\n         IssueConfig azureIssueConfig = context.getIssueConfig();\n         AzureBoardsProperties azureBoardsProperties = context.getIssueTrackerConfig();\n+        azureBoardsProperties.validateProperties();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5NzM3MQ=="}, "originalCommit": {"oid": "b30ab0ad4afa5797bf1dcfba09db365555ea12d1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYzODQ3OA==", "bodyText": "Ya I am only validating the user provided configuration, I am not testing the connection to Azure. Is that something we want to add? If it is I will adjust the TODO statement accordingly", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1161#discussion_r485638478", "createdAt": "2020-09-09T14:04:48Z", "author": {"login": "jamesrichard91"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsRequestDelegator.java", "diffHunk": "@@ -63,6 +63,7 @@ public AzureBoardsRequestDelegator(Gson gson, ProxyManager proxyManager, AzureBo\n     public IssueTrackerResponse sendRequests(List<IssueTrackerRequest> requests) throws IntegrationException {\n         IssueConfig azureIssueConfig = context.getIssueConfig();\n         AzureBoardsProperties azureBoardsProperties = context.getIssueTrackerConfig();\n+        azureBoardsProperties.validateProperties();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5NzM3MQ=="}, "originalCommit": {"oid": "b30ab0ad4afa5797bf1dcfba09db365555ea12d1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY0MDkzOA==", "bodyText": "I think if we start running into issues with scopes not matching up then we will need to make it configurable in the future.  I think for now we can remove the TODO since you handle the user provided fields.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1161#discussion_r485640938", "createdAt": "2020-09-09T14:07:56Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsRequestDelegator.java", "diffHunk": "@@ -63,6 +63,7 @@ public AzureBoardsRequestDelegator(Gson gson, ProxyManager proxyManager, AzureBo\n     public IssueTrackerResponse sendRequests(List<IssueTrackerRequest> requests) throws IntegrationException {\n         IssueConfig azureIssueConfig = context.getIssueConfig();\n         AzureBoardsProperties azureBoardsProperties = context.getIssueTrackerConfig();\n+        azureBoardsProperties.validateProperties();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5NzM3MQ=="}, "originalCommit": {"oid": "b30ab0ad4afa5797bf1dcfba09db365555ea12d1"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNDc2MzAyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsProperties.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQyMToxNTowN1rOHOuQ9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxNDoxMToxMlrOHPJU8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIwMDExOA==", "bodyText": "The oauthUserId doesn't get populated until the authentication with Azure occurs, right?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1161#discussion_r485200118", "createdAt": "2020-09-08T21:15:07Z", "author": {"login": "jamesrichard91"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsProperties.java", "diffHunk": "@@ -108,6 +110,15 @@ public String getOauthUserId() {\n         return scopes;\n     }\n \n+    public void validateProperties() throws AlertConfigurationException {\n+        if (StringUtils.isBlank(organizationName) || StringUtils.isBlank(clientId) || StringUtils.isBlank(clientSecret)) {\n+            throw new AlertConfigurationException(\"The global configuration for Azure is missing required information.\");\n+        }\n+        if (StringUtils.isBlank(oauthUserId)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b30ab0ad4afa5797bf1dcfba09db365555ea12d1"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU2NjAzNg==", "bodyText": "The oauthUserId get's populated when fromFieldAccessor is called.  We don't know the user when performing the handshake so we are always using the value of DEFAULT_AZURE_OAUTH_USER_ID constant.  Are you seeing it have a value other than the default?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1161#discussion_r485566036", "createdAt": "2020-09-09T12:19:25Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsProperties.java", "diffHunk": "@@ -108,6 +110,15 @@ public String getOauthUserId() {\n         return scopes;\n     }\n \n+    public void validateProperties() throws AlertConfigurationException {\n+        if (StringUtils.isBlank(organizationName) || StringUtils.isBlank(clientId) || StringUtils.isBlank(clientSecret)) {\n+            throw new AlertConfigurationException(\"The global configuration for Azure is missing required information.\");\n+        }\n+        if (StringUtils.isBlank(oauthUserId)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIwMDExOA=="}, "originalCommit": {"oid": "b30ab0ad4afa5797bf1dcfba09db365555ea12d1"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYzNzQ1Mg==", "bodyText": "Ok. I didn't realize that we were setting a default value for that field. I thought it would only get populated if the User has pressed the \"Authenticate\" button in  the Azure configuration. I assumed it would be blank if the User filled in the fields and only pressed save not authenticate.\nIf this field is always going to have a value then should I remove this part of the validation?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1161#discussion_r485637452", "createdAt": "2020-09-09T14:03:30Z", "author": {"login": "jamesrichard91"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsProperties.java", "diffHunk": "@@ -108,6 +110,15 @@ public String getOauthUserId() {\n         return scopes;\n     }\n \n+    public void validateProperties() throws AlertConfigurationException {\n+        if (StringUtils.isBlank(organizationName) || StringUtils.isBlank(clientId) || StringUtils.isBlank(clientSecret)) {\n+            throw new AlertConfigurationException(\"The global configuration for Azure is missing required information.\");\n+        }\n+        if (StringUtils.isBlank(oauthUserId)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIwMDExOA=="}, "originalCommit": {"oid": "b30ab0ad4afa5797bf1dcfba09db365555ea12d1"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTY0MzUwNw==", "bodyText": "yes I would remove it.  The documentation has an example where the email address is passed in via the state query parameter.  We don't capture the user email in the global configuration from the UI to be able to include it in the state query parameter.  Since we have only one configuration for Azure boards our default key is sufficient for now.  If we started having multiple Azure boards tokens then we would need unique keys.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1161#discussion_r485643507", "createdAt": "2020-09-09T14:11:12Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureBoardsProperties.java", "diffHunk": "@@ -108,6 +110,15 @@ public String getOauthUserId() {\n         return scopes;\n     }\n \n+    public void validateProperties() throws AlertConfigurationException {\n+        if (StringUtils.isBlank(organizationName) || StringUtils.isBlank(clientId) || StringUtils.isBlank(clientSecret)) {\n+            throw new AlertConfigurationException(\"The global configuration for Azure is missing required information.\");\n+        }\n+        if (StringUtils.isBlank(oauthUserId)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTIwMDExOA=="}, "originalCommit": {"oid": "b30ab0ad4afa5797bf1dcfba09db365555ea12d1"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1732, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}