{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0Nzg2NTc2", "number": 1138, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0MTowMVrOEdR60w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0Njo0OVrOEdSEhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MTM3NzQ3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0MTowMVrOHIWRWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo1NjowNVrOHIW4fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxNTU0NA==", "bodyText": "I don't think we need to check this. We know that the sub-topic is the project-version for Black Duck and if there is ever another provider, it will be likely that we need to include this for feature parity.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#discussion_r478515544", "createdAt": "2020-08-27T15:41:01Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "diffHunk": "@@ -98,8 +100,16 @@ public void distributeMessage(DistributionEvent event) throws IntegrationExcepti\n \n     public void sendMessage(EmailProperties emailProperties, Set<String> emailAddresses, String subjectLine, String formatType, EmailAttachmentFormat attachmentFormat, MessageContentGroup messageContent) throws IntegrationException {\n         String topicValue = null;\n+        Optional<String> subTopicValue = Optional.empty();\n         if (!messageContent.isEmpty()) {\n             topicValue = messageContent.getCommonTopic().getValue();\n+            subTopicValue = messageContent.getSubContent()\n+                                .stream()\n+                                .map(ProviderMessageContent::getSubTopic)\n+                                .flatMap(Optional::stream)\n+                                .filter(linkableItem -> MessageBuilderConstants.LABEL_PROJECT_VERSION_NAME.equals(linkableItem.getName()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUyNTU2NA==", "bodyText": "A license limit notification won't include a version unless I'm mistaken. The API of ProviderMessageContent doesn't make it clear that the sub topic is the version so given that API I suggested filtering to be sure you have the project version sub topic.  The initial code just had find first.  But with your suggestion to join the sub topics the filtering may not make sense anymore.  If we remove the filter portion of the stream then I would like to see a comment above that states we're assuming the sub-topic is the version.   Just in case we get a bug later on that the subject isn't correct we have a comment to refresh our memory on the assumption in case it comes into play.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#discussion_r478525564", "createdAt": "2020-08-27T15:56:05Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "diffHunk": "@@ -98,8 +100,16 @@ public void distributeMessage(DistributionEvent event) throws IntegrationExcepti\n \n     public void sendMessage(EmailProperties emailProperties, Set<String> emailAddresses, String subjectLine, String formatType, EmailAttachmentFormat attachmentFormat, MessageContentGroup messageContent) throws IntegrationException {\n         String topicValue = null;\n+        Optional<String> subTopicValue = Optional.empty();\n         if (!messageContent.isEmpty()) {\n             topicValue = messageContent.getCommonTopic().getValue();\n+            subTopicValue = messageContent.getSubContent()\n+                                .stream()\n+                                .map(ProviderMessageContent::getSubTopic)\n+                                .flatMap(Optional::stream)\n+                                .filter(linkableItem -> MessageBuilderConstants.LABEL_PROJECT_VERSION_NAME.equals(linkableItem.getName()))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxNTU0NA=="}, "originalCommit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MTM4MzgyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0MjozNlrOHIWVYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo1NDoyOFrOHIW0Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxNjU3OQ==", "bodyText": "Because there can be multiple project-versions, we should return a joined list of them.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            .findFirst();\n          \n          \n            \n                                            .collect(Collectors.joining(\", \"));", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#discussion_r478516579", "createdAt": "2020-08-27T15:42:36Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "diffHunk": "@@ -98,8 +100,16 @@ public void distributeMessage(DistributionEvent event) throws IntegrationExcepti\n \n     public void sendMessage(EmailProperties emailProperties, Set<String> emailAddresses, String subjectLine, String formatType, EmailAttachmentFormat attachmentFormat, MessageContentGroup messageContent) throws IntegrationException {\n         String topicValue = null;\n+        Optional<String> subTopicValue = Optional.empty();\n         if (!messageContent.isEmpty()) {\n             topicValue = messageContent.getCommonTopic().getValue();\n+            subTopicValue = messageContent.getSubContent()\n+                                .stream()\n+                                .map(ProviderMessageContent::getSubTopic)\n+                                .flatMap(Optional::stream)\n+                                .filter(linkableItem -> MessageBuilderConstants.LABEL_PROJECT_VERSION_NAME.equals(linkableItem.getName()))\n+                                .map(LinkableItem::getValue)\n+                                .findFirst();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUyMjMzNA==", "bodyText": "In my testing of this feature I saw that for multiple versions we have multiple emails for each. So \"projectA version1\" and \"projectA version2\" would come in as 2 separate emails with those titles. Is there a case where they would be combined?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#discussion_r478522334", "createdAt": "2020-08-27T15:51:17Z", "author": {"login": "ChomickiM"}, "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "diffHunk": "@@ -98,8 +100,16 @@ public void distributeMessage(DistributionEvent event) throws IntegrationExcepti\n \n     public void sendMessage(EmailProperties emailProperties, Set<String> emailAddresses, String subjectLine, String formatType, EmailAttachmentFormat attachmentFormat, MessageContentGroup messageContent) throws IntegrationException {\n         String topicValue = null;\n+        Optional<String> subTopicValue = Optional.empty();\n         if (!messageContent.isEmpty()) {\n             topicValue = messageContent.getCommonTopic().getValue();\n+            subTopicValue = messageContent.getSubContent()\n+                                .stream()\n+                                .map(ProviderMessageContent::getSubTopic)\n+                                .flatMap(Optional::stream)\n+                                .filter(linkableItem -> MessageBuilderConstants.LABEL_PROJECT_VERSION_NAME.equals(linkableItem.getName()))\n+                                .map(LinkableItem::getValue)\n+                                .findFirst();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxNjU3OQ=="}, "originalCommit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUyNDE5MQ==", "bodyText": "I believe they are supposed to be combined if they get processed in the same batch of notifications.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#discussion_r478524191", "createdAt": "2020-08-27T15:54:00Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "diffHunk": "@@ -98,8 +100,16 @@ public void distributeMessage(DistributionEvent event) throws IntegrationExcepti\n \n     public void sendMessage(EmailProperties emailProperties, Set<String> emailAddresses, String subjectLine, String formatType, EmailAttachmentFormat attachmentFormat, MessageContentGroup messageContent) throws IntegrationException {\n         String topicValue = null;\n+        Optional<String> subTopicValue = Optional.empty();\n         if (!messageContent.isEmpty()) {\n             topicValue = messageContent.getCommonTopic().getValue();\n+            subTopicValue = messageContent.getSubContent()\n+                                .stream()\n+                                .map(ProviderMessageContent::getSubTopic)\n+                                .flatMap(Optional::stream)\n+                                .filter(linkableItem -> MessageBuilderConstants.LABEL_PROJECT_VERSION_NAME.equals(linkableItem.getName()))\n+                                .map(LinkableItem::getValue)\n+                                .findFirst();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxNjU3OQ=="}, "originalCommit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUyNDUwMg==", "bodyText": "Either way, this will work.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#discussion_r478524502", "createdAt": "2020-08-27T15:54:28Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "diffHunk": "@@ -98,8 +100,16 @@ public void distributeMessage(DistributionEvent event) throws IntegrationExcepti\n \n     public void sendMessage(EmailProperties emailProperties, Set<String> emailAddresses, String subjectLine, String formatType, EmailAttachmentFormat attachmentFormat, MessageContentGroup messageContent) throws IntegrationException {\n         String topicValue = null;\n+        Optional<String> subTopicValue = Optional.empty();\n         if (!messageContent.isEmpty()) {\n             topicValue = messageContent.getCommonTopic().getValue();\n+            subTopicValue = messageContent.getSubContent()\n+                                .stream()\n+                                .map(ProviderMessageContent::getSubTopic)\n+                                .flatMap(Optional::stream)\n+                                .filter(linkableItem -> MessageBuilderConstants.LABEL_PROJECT_VERSION_NAME.equals(linkableItem.getName()))\n+                                .map(LinkableItem::getValue)\n+                                .findFirst();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxNjU3OQ=="}, "originalCommit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MTQwMjMwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0Njo0OVrOHIWglQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo1NzowM1rOHIW61Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxOTQ0NQ==", "bodyText": "We might want to consider truncating this if it exceeds a certain number of characters.\n78 is the suggested number of RCF 2822 https://tools.ietf.org/html/rfc2822#section-2.1.1", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#discussion_r478519445", "createdAt": "2020-08-27T15:46:49Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "diffHunk": "@@ -146,9 +156,13 @@ public void sendMessage(EmailProperties emailProperties, Set<String> emailAddres\n         return optionalAttachmentFile;\n     }\n \n-    private String createEnhancedSubjectLine(String originalSubjectLine, String providerProjectName) {\n+    private String createEnhancedSubjectLine(String originalSubjectLine, String providerProjectName, Optional<String> providerProjectVersionName) {\n         if (StringUtils.isNotBlank(providerProjectName)) {\n-            return String.format(\"%s | For: %s\", originalSubjectLine, providerProjectName);\n+            String subjectLine = String.format(\"%s | For: %s\", originalSubjectLine, providerProjectName);\n+            if (providerProjectVersionName.isPresent()) {\n+                subjectLine += String.format(\" %s\", providerProjectVersionName.get());\n+            }\n+            return subjectLine;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUyNjE2NQ==", "bodyText": "StringUtils should have the abbreviate method if I remember correctly to do that.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#discussion_r478526165", "createdAt": "2020-08-27T15:57:03Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "diffHunk": "@@ -146,9 +156,13 @@ public void sendMessage(EmailProperties emailProperties, Set<String> emailAddres\n         return optionalAttachmentFile;\n     }\n \n-    private String createEnhancedSubjectLine(String originalSubjectLine, String providerProjectName) {\n+    private String createEnhancedSubjectLine(String originalSubjectLine, String providerProjectName, Optional<String> providerProjectVersionName) {\n         if (StringUtils.isNotBlank(providerProjectName)) {\n-            return String.format(\"%s | For: %s\", originalSubjectLine, providerProjectName);\n+            String subjectLine = String.format(\"%s | For: %s\", originalSubjectLine, providerProjectName);\n+            if (providerProjectVersionName.isPresent()) {\n+                subjectLine += String.format(\" %s\", providerProjectVersionName.get());\n+            }\n+            return subjectLine;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxOTQ0NQ=="}, "originalCommit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1704, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}