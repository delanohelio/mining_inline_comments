{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1NjQyMTk3", "number": 1200, "title": "Jr auth manager", "bodyText": "Moving more of the RoleAccessor usage into the AuthorizationManager.", "createdAt": "2020-09-30T16:43:25Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1200", "merged": true, "mergeCommit": {"oid": "d191f9ee6f7003bd035837bf9c62fbdd1f858947"}, "closed": true, "closedAt": "2020-09-30T20:00:51Z", "author": {"login": "jamesrichard91"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdN_CcEAH2gAyNDk1NjQyMTk3OjdhODM5MWM0YTkyNGQyNzA4ZTYwYWM3MmE1NWIxYWQ1Yjk2MDUyM2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOCZ_9gH2gAyNDk1NjQyMTk3OjE5MTVjMDI4OTQ5YzJhMzQ1MzM2Njc5OWIxMTAzZWU1YzBmYzk0ZGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7a8391c4a924d2708e60ac72a55b1ad5b960523c", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7a8391c4a924d2708e60ac72a55b1ad5b960523c", "committedDate": "2020-09-30T16:04:56Z", "message": "Refactor: Updating the AuthorizationManager with more pass through methods for the RoleAccessor to reduce the number of dependencies in classes that use the AuthorizationManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30e99cf54b09699883d383a3d29849dbc926c802", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/30e99cf54b09699883d383a3d29849dbc926c802", "committedDate": "2020-09-30T16:37:07Z", "message": "Merge branch 'master' into jr_auth_manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ee4f6e637267a698eb1954d8c21ac9d19e474c1", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/6ee4f6e637267a698eb1954d8c21ac9d19e474c1", "committedDate": "2020-09-30T16:41:41Z", "message": "Fixing compile issues in tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjI0MTEw", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1200#pullrequestreview-499624110", "createdAt": "2020-09-30T16:45:05Z", "commit": {"oid": "6ee4f6e637267a698eb1954d8c21ac9d19e474c1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNjo0NTowNVrOHambog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNjo0NTowNVrOHambog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY1NDY5MA==", "bodyText": "Now that the roles are being updated using methods in this class and the cache is being updated in those methods, is it alright to check the cache for the role name? Or should we still using the RoleAccessor to check the database?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1200#discussion_r497654690", "createdAt": "2020-09-30T16:45:05Z", "author": {"login": "jamesrichard91"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/security/authorization/AuthorizationManager.java", "diffHunk": "@@ -139,6 +139,23 @@ public final boolean hasAllPermissions(String context, String descriptorName, Ac\n                    .anyMatch(name -> permissionCache.containsKey(name) && permissionCache.get(name).hasPermissions(permissionKey, operations));\n     }\n \n+    public Set<UserRoleModel> getRoles() {\n+        return roleAccessor.getRoles();\n+    }\n+\n+    public Set<UserRoleModel> getRoles(Collection<Long> roleIds) {\n+        return roleAccessor.getRoles(roleIds);\n+    }\n+\n+    public boolean doesRoleNameExist(String name) {\n+        return permissionCache.containsKey(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ee4f6e637267a698eb1954d8c21ac9d19e474c1"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjU1NDY2", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1200#pullrequestreview-499655466", "createdAt": "2020-09-30T17:24:12Z", "commit": {"oid": "6ee4f6e637267a698eb1954d8c21ac9d19e474c1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d141aebdfbdd7cd1a25894cf234d7facbbf2605b", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/d141aebdfbdd7cd1a25894cf234d7facbbf2605b", "committedDate": "2020-09-30T17:51:14Z", "message": "Merge branch 'master' into jr_auth_manager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjkyOTQ4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1200#pullrequestreview-499692948", "createdAt": "2020-09-30T18:13:59Z", "commit": {"oid": "d141aebdfbdd7cd1a25894cf234d7facbbf2605b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODoxMzo1OVrOHapsdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODoxMzo1OVrOHapsdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcwODE1MA==", "bodyText": "I'm not sure delegating Role retrieval to the AuthorizationManager is the right move. Yes, AuthorizationManager has a RoleAccessor, and yes, the RoleActions would otherwise need both, but I do not believe this is correctly separating concerns. RoleAccessor is the thing that should be depended on to read/write roles to and from the database and AuthorizationManager is the utility that cross-references roles with users.\nI'm not entirely sure why AuthorizationManager was even being used in this class before.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1200#discussion_r497708150", "createdAt": "2020-09-30T18:13:59Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/role/RoleActions.java", "diffHunk": "@@ -56,19 +55,17 @@\n @Component\n public class RoleActions {\n     private static final String FIELD_KEY_ROLE_NAME = \"roleName\";\n-    private final RoleAccessor roleAccessor;\n     private final AuthorizationManager authorizationManager;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d141aebdfbdd7cd1a25894cf234d7facbbf2605b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "253e5cec5eeb571fbff3b1cd11aecc43c8dbd6c8", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/253e5cec5eeb571fbff3b1cd11aecc43c8dbd6c8", "committedDate": "2020-09-30T19:54:24Z", "message": "Merge branch 'master' into jr_auth_manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1915c028949c2a3453366799b1103ee5c0fc94da", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/1915c028949c2a3453366799b1103ee5c0fc94da", "committedDate": "2020-09-30T20:00:23Z", "message": "Reverting some of the changes to keep using the RoleAccessor to retrieve the roles from the database"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3533, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}