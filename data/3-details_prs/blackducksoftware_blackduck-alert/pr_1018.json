{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzODU3MjAy", "number": 1018, "title": "unknown config fix", "bodyText": "Create a task to check if there are no provider configurations in the system.\n\n\nOn startup all system messages are removed and then system validation occurs.\n\n\nBlackDuckValidator is used to validate a Black Duck configuration and not determine if there are no provider configurations defined.\n\n\nUse the existing database structure to create provider specific system messages.  Since system message types are stored as strings the provider specific message types use the following format:\n<CONFIG_ID>_<SYSTEM_MESSAGE_TYPE> This ensures that the Black Duck validator can remove only the system messages for that provider because the config Id is present in the message type.\n\n\nAs a fix for a feature release using the same database structure was used here to fix the issue.\nIn the future we may want to revisit the System Message database structure.  We may want to separate into multiple tables.  A table for provider messages, a table for user based messages when user profiles are introduced, and system wide messages.", "createdAt": "2020-06-12T19:49:22Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1018", "merged": true, "mergeCommit": {"oid": "26db8607e2d0b806b0a4fb745038d6022d60035f"}, "closed": true, "closedAt": "2020-06-15T14:23:16Z", "author": {"login": "psantos1113"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqST-wgH2gAyNDMzODU3MjAyOjJkMzc2MWI4MTgyMGQzZGI5ZjY2MzI2ZGI3MmNiMDQyZjk3MDQwNjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrg370gFqTQzMDY1NTY0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2d3761b81820d3db9f66326db72cb042f9704068", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/2d3761b81820d3db9f66326db72cb042f9704068", "committedDate": "2020-06-11T18:11:01Z", "message": "fix: Ability to create messages by configuration."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72f8611f4d9d7c8642328ea6e564ff90dbbcaa47", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/72f8611f4d9d7c8642328ea6e564ff90dbbcaa47", "committedDate": "2020-06-12T14:43:18Z", "message": "fix: Add a task to find missing configs and log system message."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79009ff7fb20e67005c0ad3a1d360a39118c90a6", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/79009ff7fb20e67005c0ad3a1d360a39118c90a6", "committedDate": "2020-06-12T18:56:35Z", "message": "fix: Add system messages by provider config in order to remove correctly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f75281fcfc70dafb824c98a90b8e260ca149e13e", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f75281fcfc70dafb824c98a90b8e260ca149e13e", "committedDate": "2020-06-12T19:47:28Z", "message": "refactor: Remove an unnecessary method to remove configurations."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5OTk5NTUw", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1018#pullrequestreview-429999550", "createdAt": "2020-06-12T19:49:55Z", "commit": {"oid": "f75281fcfc70dafb824c98a90b8e260ca149e13e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxOTo0OTo1NVrOGjP3Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxOTo0OTo1NVrOGjP3Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYxMzI1MA==", "bodyText": "This class is the only class for determining if there are no providers configured at all.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1018#discussion_r439613250", "createdAt": "2020-06-12T19:49:55Z", "author": {"login": "psantos1113"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/provider/ProviderConfigMissingValidator.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/**\n+ * alert-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.common.provider;\n+\n+import java.util.List;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.SystemMessageSeverity;\n+import com.synopsys.integration.alert.common.enumeration.SystemMessageType;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.SystemMessageUtility;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationModel;\n+import com.synopsys.integration.alert.common.provider.lifecycle.ProvidersMissingTask;\n+import com.synopsys.integration.alert.common.system.BaseSystemValidator;\n+\n+@Component\n+public class ProviderConfigMissingValidator extends BaseSystemValidator {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f75281fcfc70dafb824c98a90b8e260ca149e13e"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDAwMzUx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1018#pullrequestreview-430000351", "createdAt": "2020-06-12T19:51:32Z", "commit": {"oid": "f75281fcfc70dafb824c98a90b8e260ca149e13e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxOTo1MTozMlrOGjP53w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxOTo1MTozMlrOGjP53w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYxMzkxOQ==", "bodyText": "I will remove this line I shouldn't need it anymore.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1018#discussion_r439613919", "createdAt": "2020-06-12T19:51:32Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/BlackDuckValidator.java", "diffHunk": "@@ -61,17 +60,13 @@ public boolean validate(BlackDuckProperties blackDuckProperties) {\n         String configName = blackDuckProperties.getConfigName();\n         logger.info(\"Validating Black Duck configuration '{}'...\", configName);\n \n-        removeNoProviderConfigMessages();\n+        removeSystemMessagesByType(SystemMessageType.BLACKDUCK_PROVIDER_CONFIGURATION_MISSING);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f75281fcfc70dafb824c98a90b8e260ca149e13e"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDAxMDQ5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1018#pullrequestreview-430001049", "createdAt": "2020-06-12T19:52:48Z", "commit": {"oid": "f75281fcfc70dafb824c98a90b8e260ca149e13e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxOTo1Mjo0OFrOGjP79A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxOTo1Mjo0OFrOGjP79A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYxNDQ1Mg==", "bodyText": "This is a startup component that determines if the system is in a valid state or not.  On startup clear old messages and start clean.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1018#discussion_r439614452", "createdAt": "2020-06-12T19:52:48Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/workflow/startup/component/SystemMessageInitializer.java", "diffHunk": "@@ -64,6 +68,7 @@ public boolean validate() {\n         logger.info(\"----------------------------------------\");\n         logger.info(\"Validating system configuration....\");\n \n+        clearOldMessages();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f75281fcfc70dafb824c98a90b8e260ca149e13e"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDA0ODA4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1018#pullrequestreview-430004808", "createdAt": "2020-06-12T19:59:55Z", "commit": {"oid": "f75281fcfc70dafb824c98a90b8e260ca149e13e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0543538bdc6d3527cee82b3f9e33c8875d75e363", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/0543538bdc6d3527cee82b3f9e33c8875d75e363", "committedDate": "2020-06-12T20:01:08Z", "message": "refactor: Remove an unneeded method."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDE4MzQz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1018#pullrequestreview-430018343", "createdAt": "2020-06-12T20:26:53Z", "commit": {"oid": "0543538bdc6d3527cee82b3f9e33c8875d75e363"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87b9333a869fcabf7316078f9c6d4acde0fdc34d", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/87b9333a869fcabf7316078f9c6d4acde0fdc34d", "committedDate": "2020-06-15T10:47:06Z", "message": "Merge remote-tracking branch 'origin/master' into ps_unknown_config_fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNjAyNTI3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1018#pullrequestreview-430602527", "createdAt": "2020-06-15T12:39:04Z", "commit": {"oid": "87b9333a869fcabf7316078f9c6d4acde0fdc34d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNjU1NjQ3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1018#pullrequestreview-430655647", "createdAt": "2020-06-15T13:42:53Z", "commit": {"oid": "87b9333a869fcabf7316078f9c6d4acde0fdc34d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3546, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}