{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMTk3MzUw", "number": 799, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNjowMjowM1rODXMnmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNjowNzozOVrODXMuPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NjUwNTg2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/workflow/startup/component/AuthenticationSettingsMigration.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNjowMjowM1rOFcYg2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNjowMjowM1rOFcYg2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTMwNjA3NA==", "bodyText": "This can be replaced with a method reference. Also, I generally prefer the orElse on it's own line.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/799#discussion_r365306074", "createdAt": "2020-01-10T16:02:03Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/workflow/startup/component/AuthenticationSettingsMigration.java", "diffHunk": "@@ -0,0 +1,161 @@\n+/**\n+ * blackduck-alert\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.workflow.startup.component;\n+\n+import java.util.Collection;\n+import java.util.Comparator;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.core.annotation.Order;\n+import org.springframework.stereotype.Component;\n+\n+import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.descriptor.accessor.SettingsUtility;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationFieldModel;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationModel;\n+import com.synopsys.integration.alert.common.persistence.model.DefinedFieldModel;\n+import com.synopsys.integration.alert.common.persistence.util.ConfigurationFieldModelConverter;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n+import com.synopsys.integration.alert.component.authentication.descriptor.AuthenticationDescriptorKey;\n+import com.synopsys.integration.alert.component.settings.descriptor.SettingsDescriptor;\n+import com.synopsys.integration.alert.web.config.FieldModelProcessor;\n+\n+@Component\n+@Order(2)\n+// TODO Remove this class in 6.0.0\n+// TODO Revisit the order of the startup components\n+public class AuthenticationSettingsMigration extends StartupComponent {\n+    private Logger logger = LoggerFactory.getLogger(AuthenticationSettingsMigration.class);\n+    private EnvironmentVariableUtility environmentUtility;\n+    private DescriptorAccessor descriptorAccessor;\n+    private ConfigurationAccessor fieldConfigurationAccessor;\n+    private ConfigurationFieldModelConverter modelConverter;\n+    private FieldModelProcessor fieldModelProcessor;\n+    private AuthenticationDescriptorKey authenticationDescriptorKey;\n+    private SettingsUtility settingsUtility;\n+\n+    @Autowired\n+    public AuthenticationSettingsMigration(EnvironmentVariableUtility environmentUtility, DescriptorAccessor descriptorAccessor, ConfigurationAccessor fieldConfigurationAccessor,\n+        ConfigurationFieldModelConverter modelConverter, FieldModelProcessor fieldModelProcessor, AuthenticationDescriptorKey authenticationDescriptorKey, SettingsUtility settingsUtility) {\n+        this.environmentUtility = environmentUtility;\n+        this.descriptorAccessor = descriptorAccessor;\n+        this.fieldConfigurationAccessor = fieldConfigurationAccessor;\n+        this.modelConverter = modelConverter;\n+        this.fieldModelProcessor = fieldModelProcessor;\n+        this.authenticationDescriptorKey = authenticationDescriptorKey;\n+        this.settingsUtility = settingsUtility;\n+    }\n+\n+    @Override\n+    protected void initialize() {\n+        logger.info(\"Settings authentication variable migration start...\");\n+        try {\n+            List<DefinedFieldModel> fieldsForDescriptor = descriptorAccessor.getFieldsForDescriptor(authenticationDescriptorKey, ConfigContextEnum.GLOBAL).stream()\n+                                                              .sorted(Comparator.comparing(DefinedFieldModel::getKey))\n+                                                              .collect(Collectors.toList());\n+            List<ConfigurationModel> foundConfigurationModels = fieldConfigurationAccessor.getConfigurationByDescriptorKeyAndContext(authenticationDescriptorKey, ConfigContextEnum.GLOBAL);\n+\n+            Map<String, ConfigurationFieldModel> existingConfiguredFields = new HashMap<>();\n+            foundConfigurationModels.forEach(config -> existingConfiguredFields.putAll(config.getCopyOfKeyToFieldMap()));\n+\n+            Set<ConfigurationFieldModel> configurationModels = createFieldModelsFromDefinedFields(fieldsForDescriptor, existingConfiguredFields);\n+            boolean overwriteConfig = settingsUtility.getConfiguration()\n+                                          .flatMap(configurationModel -> configurationModel.getField(SettingsDescriptor.KEY_STARTUP_ENVIRONMENT_VARIABLE_OVERRIDE))\n+                                          .flatMap(ConfigurationFieldModel::getFieldValue)\n+                                          .map(value -> Boolean.valueOf(value)).orElse(Boolean.FALSE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cd527f90aede584dc4dcc9139afb91b63234d24"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1NjUyMjg3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/workflow/startup/component/ConfigurationLogger.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxNjowNzozOVrOFcYrXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxODozMTowOFrOFccc3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTMwODc2NQ==", "bodyText": "Perhaps we should make our standard steps increments of 10? That way we can fit temporary/new steps in between existing without re-ordering everything every time", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/799#discussion_r365308765", "createdAt": "2020-01-10T16:07:39Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/workflow/startup/component/ConfigurationLogger.java", "diffHunk": "@@ -35,27 +35,27 @@\n import com.synopsys.integration.alert.common.rest.ProxyManager;\n \n @Component\n-@Order(4)\n+@Order(5)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cd527f90aede584dc4dcc9139afb91b63234d24"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTM3MDU4OA==", "bodyText": "I will implement that change in 5.3.0 as an enhancement when this change is merged.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/799#discussion_r365370588", "createdAt": "2020-01-10T18:31:08Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/workflow/startup/component/ConfigurationLogger.java", "diffHunk": "@@ -35,27 +35,27 @@\n import com.synopsys.integration.alert.common.rest.ProxyManager;\n \n @Component\n-@Order(4)\n+@Order(5)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTMwODc2NQ=="}, "originalCommit": {"oid": "5cd527f90aede584dc4dcc9139afb91b63234d24"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2178, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}