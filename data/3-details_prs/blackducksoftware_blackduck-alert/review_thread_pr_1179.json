{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMTUzODUx", "number": 1179, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTo0Mzo0NFrOEmPPug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDowOToxMFrOEmPxYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTMxMTMwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureCustomFieldManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTo0Mzo0NFrOHWJs9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTo0Mzo0NFrOHWJs9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4OTY4NQ==", "bodyText": "Can we extract this into its own method?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#discussion_r492989685", "createdAt": "2020-09-22T19:43:44Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureCustomFieldManager.java", "diffHunk": "@@ -194,12 +197,22 @@ private String getProjectPropertyValue(TeamProjectReferenceResponseModel project\n     private String getWorkItemTypeRefName(String processId, String workItemTypeName) throws AlertException {\n         try {\n             AzureArrayResponseModel<ProcessWorkItemTypesResponseModel> processWorkItemTypes = processService.getWorkItemTypes(organizationName, processId);\n-            return processWorkItemTypes.getValue()\n-                       .stream()\n-                       .filter(workItemType -> workItemType.getName().equals(workItemTypeName))\n-                       .map(ProcessWorkItemTypesResponseModel::getReferenceName)\n-                       .findFirst()\n-                       .orElseThrow(() -> new AlertException(String.format(\"No work item type '%s' exists for the Azure process with id: '%s'\", workItemTypeName, processId)));\n+            ProcessWorkItemTypesResponseModel matchingWorkItemType = processWorkItemTypes.getValue()\n+                                                                         .stream()\n+                                                                         .filter(workItemType -> workItemType.getName().equals(workItemTypeName))\n+                                                                         .findFirst()\n+                                                                         .orElseThrow(\n+                                                                             () -> new AlertException(String.format(\"No work item type '%s' exists for the Azure process with id: '%s'\", workItemTypeName, processId)));\n+\n+            if (matchingWorkItemType.getReferenceName().startsWith(UNMODIFIABLE_WORK_ITEM_PREFIX)) {\n+                // if the reference name starts with this prefix, we know it is a system default so it can not be modified and fields can not be added to it, so we need to create a \"copy\" of it\n+                try {\n+                    matchingWorkItemType = processService.createWorkItemType(organizationName, processId, ProcessWorkItemTypeRequestModel.copyWorkItem(matchingWorkItemType));\n+                } catch (IOException e) {\n+                    throw new AlertException(String.format(\"There was a problem creating a modifiable work item from % in the Azure process with id: %s\", matchingWorkItemType.getReferenceName(), processId), e);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16621f01530b12d420d42025e001ec881bf4ed17"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NTM5NzQ1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureCustomFieldManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDowOToxMFrOHWKh7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDowOToxMFrOHWKh7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwMzI0NQ==", "bodyText": "can you just return here?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#discussion_r493003245", "createdAt": "2020-09-22T20:09:10Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureCustomFieldManager.java", "diffHunk": "@@ -191,15 +194,31 @@ private String getProjectPropertyValue(TeamProjectReferenceResponseModel project\n         }\n     }\n \n+    private ProcessWorkItemTypesResponseModel copyWorkItem(String processId, ProcessWorkItemTypesResponseModel workItemType) throws AlertException {\n+        ProcessWorkItemTypesResponseModel newWorkItemType;\n+        try {\n+            newWorkItemType = processService.createWorkItemType(organizationName, processId, ProcessWorkItemTypeRequestModel.copyWorkItem(workItemType));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a52717f014761ca8d93dc6198d7d98d1189637"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1769, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}