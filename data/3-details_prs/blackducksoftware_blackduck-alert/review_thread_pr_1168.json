{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3OTc4MDQ0", "number": 1168, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzoxMToxM1rOEkDDGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNToxMDo0NlrOEkGhVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjM0MTM3OnYy", "diffSide": "RIGHT", "path": "src/main/js/dynamic/DistributionConfiguration.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzoxMToxM1rOHSwGXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzoxMToxM1rOHSwGXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQyNDQ3Ng==", "bodyText": "This ensures validation happens before saving the job.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489424476", "createdAt": "2020-09-16T13:11:13Z", "author": {"login": "psantos1113"}, "path": "src/main/js/dynamic/DistributionConfiguration.js", "diffHunk": "@@ -107,66 +106,73 @@ class DistributionConfiguration extends Component {\n             const keepFrequency = Object.assign(keepName, FieldModelUtilities.updateFieldModelSingleValue(updatedChannelConfig, KEY_FREQUENCY, frequency));\n             const keepProvider = Object.assign(keepFrequency, FieldModelUtilities.updateFieldModelSingleValue(updatedChannelConfig, KEY_PROVIDER_NAME, provider));\n \n-            this.props.checkDescriptorForGlobalConfig(KEY_CHANNEL_NAME, newChannel.name);\n+            validateDescriptorForGlobalConfig(KEY_CHANNEL_NAME, newChannel.name);\n             this.setState({\n                 channelConfig: keepProvider,\n                 currentChannel: newChannel\n             });\n         }\n-        const selectedProviderOption = FieldModelUtilities.getFieldModelSingleValue(this.state.channelConfig, KEY_PROVIDER_NAME);\n+        const selectedProviderOption = FieldModelUtilities.getFieldModelSingleValue(channelConfig, KEY_PROVIDER_NAME);\n         const prevProviderName = currentProvider ? currentProvider.name : '';\n \n         if (selectedProviderOption && prevProviderName !== selectedProviderOption) {\n-            const newProvider = this.props.descriptors.find((descriptor) => descriptor.name === selectedProviderOption && descriptor.context === DescriptorUtilities.CONTEXT_TYPE.DISTRIBUTION);\n+            const newProvider = descriptors.find((descriptor) => descriptor.name === selectedProviderOption && descriptor.context === DescriptorUtilities.CONTEXT_TYPE.DISTRIBUTION);\n             const emptyProviderConfig = FieldModelUtilities.createFieldModelWithDefaults(newProvider.fields, newProvider.context, newProvider.name);\n-            this.props.checkDescriptorForGlobalConfig(KEY_PROVIDER_NAME, newProvider.name);\n+            validateDescriptorForGlobalConfig(KEY_PROVIDER_NAME, newProvider.name);\n             this.setState({\n                 providerConfig: emptyProviderConfig,\n                 currentProvider: newProvider\n             });\n         }\n+\n+        if (prevProps.status === 'VALIDATING' && status === 'VALIDATED') {\n+            const jsonBody = this.buildJsonBody();\n+            if (isUpdatingJob) {\n+                updateDistribution(jsonBody);\n+            } else {\n+                saveDistribution(jsonBody);\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d423bc1d9f327d96e1d69a11bce5023c932c115d"}, "originalPosition": 117}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjM0Njg3OnYy", "diffSide": "RIGHT", "path": "src/main/js/dynamic/DistributionConfiguration.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzoxMjoyOVrOHSwJpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzoxMjoyOVrOHSwJpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQyNTMxOQ==", "bodyText": "Moved the code that checked the job id into this function instead of having the check in multiple places.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489425319", "createdAt": "2020-09-16T13:12:29Z", "author": {"login": "psantos1113"}, "path": "src/main/js/dynamic/DistributionConfiguration.js", "diffHunk": "@@ -107,66 +106,73 @@ class DistributionConfiguration extends Component {\n             const keepFrequency = Object.assign(keepName, FieldModelUtilities.updateFieldModelSingleValue(updatedChannelConfig, KEY_FREQUENCY, frequency));\n             const keepProvider = Object.assign(keepFrequency, FieldModelUtilities.updateFieldModelSingleValue(updatedChannelConfig, KEY_PROVIDER_NAME, provider));\n \n-            this.props.checkDescriptorForGlobalConfig(KEY_CHANNEL_NAME, newChannel.name);\n+            validateDescriptorForGlobalConfig(KEY_CHANNEL_NAME, newChannel.name);\n             this.setState({\n                 channelConfig: keepProvider,\n                 currentChannel: newChannel\n             });\n         }\n-        const selectedProviderOption = FieldModelUtilities.getFieldModelSingleValue(this.state.channelConfig, KEY_PROVIDER_NAME);\n+        const selectedProviderOption = FieldModelUtilities.getFieldModelSingleValue(channelConfig, KEY_PROVIDER_NAME);\n         const prevProviderName = currentProvider ? currentProvider.name : '';\n \n         if (selectedProviderOption && prevProviderName !== selectedProviderOption) {\n-            const newProvider = this.props.descriptors.find((descriptor) => descriptor.name === selectedProviderOption && descriptor.context === DescriptorUtilities.CONTEXT_TYPE.DISTRIBUTION);\n+            const newProvider = descriptors.find((descriptor) => descriptor.name === selectedProviderOption && descriptor.context === DescriptorUtilities.CONTEXT_TYPE.DISTRIBUTION);\n             const emptyProviderConfig = FieldModelUtilities.createFieldModelWithDefaults(newProvider.fields, newProvider.context, newProvider.name);\n-            this.props.checkDescriptorForGlobalConfig(KEY_PROVIDER_NAME, newProvider.name);\n+            validateDescriptorForGlobalConfig(KEY_PROVIDER_NAME, newProvider.name);\n             this.setState({\n                 providerConfig: emptyProviderConfig,\n                 currentProvider: newProvider\n             });\n         }\n+\n+        if (prevProps.status === 'VALIDATING' && status === 'VALIDATED') {\n+            const jsonBody = this.buildJsonBody();\n+            if (isUpdatingJob) {\n+                updateDistribution(jsonBody);\n+            } else {\n+                saveDistribution(jsonBody);\n+            }\n+        }\n     }\n \n-    handleClose() {\n-        this.setState({ show: false });\n-        this.props.onModalClose();\n-        this.props.handleCancel();\n+    setSendMessageVisible(visible) {\n+        this.setState({\n+            showSendMessage: visible\n+        });\n+    }\n+\n+    handleTestSubmit(event) {\n+        event.preventDefault();\n+        const { testDistribution } = this.props;\n+        const jsonBody = this.buildJsonBody();\n+        testDistribution(jsonBody);\n     }\n \n     buildJsonBody() {\n         const { channelConfig, providerConfig } = this.state;\n+        const { jobId } = this.props;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d423bc1d9f327d96e1d69a11bce5023c932c115d"}, "originalPosition": 139}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjM1MTQ4OnYy", "diffSide": "RIGHT", "path": "src/main/js/dynamic/DistributionConfiguration.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzoxMzozM1rOHSwMeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzoxMzozM1rOHSwMeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQyNjA0MQ==", "bodyText": "Most of the changes in this class are for linting issues.  I have commented on the changes that actually were made to get distribution job validation to work.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489426041", "createdAt": "2020-09-16T13:13:33Z", "author": {"login": "psantos1113"}, "path": "src/main/js/dynamic/DistributionConfiguration.js", "diffHunk": "@@ -6,11 +6,7 @@ import * as DescriptorUtilities from 'util/descriptorUtilities';\n import { OPERATIONS } from 'util/descriptorUtilities';\n import FieldsPanel from 'field/FieldsPanel';\n import {\n-    checkDescriptorForGlobalConfig,\n-    getDistributionJob,\n-    saveDistributionJob,\n-    testDistributionJob,\n-    updateDistributionJob\n+    checkDescriptorForGlobalConfig, getDistributionJob, saveDistributionJob, testDistributionJob, updateDistributionJob, validateDistributionJob", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d423bc1d9f327d96e1d69a11bce5023c932c115d"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjQyOTA3OnYy", "diffSide": "RIGHT", "path": "src/main/js/store/actions/distributionConfigs.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzozMDoxNlrOHSw8VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzo1NzozM1rOHSyL2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQzODI5Mg==", "bodyText": "What's the difference among these three calls? It seems like we should be able to drop the else-if and else to just call dispatch(handler(response.status));", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489438292", "createdAt": "2020-09-16T13:30:16Z", "author": {"login": "gkillough"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -206,11 +238,19 @@ export function testDistributionJob(config) {\n         request.then((response) => {\n             response.json()\n                 .then((responseData) => {\n-                    if (response.ok) {\n+                    const defaultHandler = () => jobError({\n+                        type: DISTRIBUTION_JOB_TEST_FAILURE,\n+                        ...responseData\n+                    });\n+                    const handler = createErrorHandler(DISTRIBUTION_JOB_TEST_FAILURE, defaultHandler);\n+                    if (responseData.errors && !Object.keys(responseData.errors).length) {\n                         dispatch(testJobSuccess(responseData.message));\n+                    } else if (!response.ok) {\n+                        dispatch(handler(response.status));\n                     } else {\n-                        handleFailureResponse(DISTRIBUTION_JOB_TEST_FAILURE, dispatch, responseData, response.status);\n+                        dispatch(handler(400));\n                     }\n+                    dispatch(handler(response.status));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b5c39cf513474e45148c300821acc58cb30aa16"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ1ODY0OA==", "bodyText": "the dispatch at the end I need to remove", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489458648", "createdAt": "2020-09-16T13:57:33Z", "author": {"login": "psantos1113"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -206,11 +238,19 @@ export function testDistributionJob(config) {\n         request.then((response) => {\n             response.json()\n                 .then((responseData) => {\n-                    if (response.ok) {\n+                    const defaultHandler = () => jobError({\n+                        type: DISTRIBUTION_JOB_TEST_FAILURE,\n+                        ...responseData\n+                    });\n+                    const handler = createErrorHandler(DISTRIBUTION_JOB_TEST_FAILURE, defaultHandler);\n+                    if (responseData.errors && !Object.keys(responseData.errors).length) {\n                         dispatch(testJobSuccess(responseData.message));\n+                    } else if (!response.ok) {\n+                        dispatch(handler(response.status));\n                     } else {\n-                        handleFailureResponse(DISTRIBUTION_JOB_TEST_FAILURE, dispatch, responseData, response.status);\n+                        dispatch(handler(400));\n                     }\n+                    dispatch(handler(response.status));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQzODI5Mg=="}, "originalCommit": {"oid": "7b5c39cf513474e45148c300821acc58cb30aa16"}, "originalPosition": 130}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjQzNDEyOnYy", "diffSide": "RIGHT", "path": "src/main/js/store/actions/distributionConfigs.js", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzozMToyMlrOHSw_Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzo1Njo0MVrOHSyJbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQzOTA3NQ==", "bodyText": "When will the else be called, but not the else-if?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489439075", "createdAt": "2020-09-16T13:31:22Z", "author": {"login": "gkillough"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -241,3 +281,24 @@ export function checkDescriptorForGlobalConfig(errorFieldName, descriptorName) {\n         }).catch(console.error);\n     };\n }\n+\n+export function validateDistributionJob(config) {\n+    return (dispatch, getState) => {\n+        dispatch(validatingJob());\n+        const { csrfToken } = getState().session;\n+        const request = ConfigRequestBuilder.createValidateRequest(ConfigRequestBuilder.JOB_API_URL, csrfToken, config);\n+        request.then((response) => {\n+            response.json()\n+                .then((responseData) => {\n+                    const handler = createErrorHandler(DISTRIBUTION_JOB_VALIDATE_ERROR, () => validateJobError(responseData));\n+                    if (responseData.errors && !Object.keys(responseData.errors).length) {\n+                        dispatch(validatedJob());\n+                    } else if (!response.ok) {\n+                        dispatch(handler(response.status));\n+                    } else {\n+                        dispatch(handler(400));\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b5c39cf513474e45148c300821acc58cb30aa16"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ1NTMyNQ==", "bodyText": "The else will be called when we have validation errors.  The controller has to return an OK response to contain the validation errors.  We check to see if there are errors and  we then handle it like a bad request which updates the UI with the field validation errors.  If we had a 401 or 403 or another unexpected error like 500 then the else if case will be used. Otherwise there are field validation errors and we end up in the else case.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489455325", "createdAt": "2020-09-16T13:53:06Z", "author": {"login": "psantos1113"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -241,3 +281,24 @@ export function checkDescriptorForGlobalConfig(errorFieldName, descriptorName) {\n         }).catch(console.error);\n     };\n }\n+\n+export function validateDistributionJob(config) {\n+    return (dispatch, getState) => {\n+        dispatch(validatingJob());\n+        const { csrfToken } = getState().session;\n+        const request = ConfigRequestBuilder.createValidateRequest(ConfigRequestBuilder.JOB_API_URL, csrfToken, config);\n+        request.then((response) => {\n+            response.json()\n+                .then((responseData) => {\n+                    const handler = createErrorHandler(DISTRIBUTION_JOB_VALIDATE_ERROR, () => validateJobError(responseData));\n+                    if (responseData.errors && !Object.keys(responseData.errors).length) {\n+                        dispatch(validatedJob());\n+                    } else if (!response.ok) {\n+                        dispatch(handler(response.status));\n+                    } else {\n+                        dispatch(handler(400));\n+                    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQzOTA3NQ=="}, "originalCommit": {"oid": "7b5c39cf513474e45148c300821acc58cb30aa16"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ1ODAyOA==", "bodyText": "Ah yes, that makes sense.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489458028", "createdAt": "2020-09-16T13:56:41Z", "author": {"login": "gkillough"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -241,3 +281,24 @@ export function checkDescriptorForGlobalConfig(errorFieldName, descriptorName) {\n         }).catch(console.error);\n     };\n }\n+\n+export function validateDistributionJob(config) {\n+    return (dispatch, getState) => {\n+        dispatch(validatingJob());\n+        const { csrfToken } = getState().session;\n+        const request = ConfigRequestBuilder.createValidateRequest(ConfigRequestBuilder.JOB_API_URL, csrfToken, config);\n+        request.then((response) => {\n+            response.json()\n+                .then((responseData) => {\n+                    const handler = createErrorHandler(DISTRIBUTION_JOB_VALIDATE_ERROR, () => validateJobError(responseData));\n+                    if (responseData.errors && !Object.keys(responseData.errors).length) {\n+                        dispatch(validatedJob());\n+                    } else if (!response.ok) {\n+                        dispatch(handler(response.status));\n+                    } else {\n+                        dispatch(handler(400));\n+                    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQzOTA3NQ=="}, "originalCommit": {"oid": "7b5c39cf513474e45148c300821acc58cb30aa16"}, "originalPosition": 154}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjQ0ODAwOnYy", "diffSide": "RIGHT", "path": "src/main/js/store/actions/distributionConfigs.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzozNDoyNFrOHSxHyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzozNDoyNFrOHSxHyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ0MTIyNA==", "bodyText": "This should be moved above the promise for responseData", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489441224", "createdAt": "2020-09-16T13:34:24Z", "author": {"login": "ChomickiM"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -173,7 +195,12 @@ export function saveDistributionJob(config) {\n                     if (response.ok) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b5c39cf513474e45148c300821acc58cb30aa16"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjUwMTU1OnYy", "diffSide": "RIGHT", "path": "src/main/js/store/actions/distributionConfigs.js", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzo0NTozMVrOHSxoaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDowMToyNlrOHSyXoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ0OTU3Ng==", "bodyText": "It seems like we are checking does the field \"errors\" have any values and if it does then do the dispatch but we are not passing the errors along. Is this expected? Are the errors that we checked for being ignored/lost?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489449576", "createdAt": "2020-09-16T13:45:31Z", "author": {"login": "jamesrichard91"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -241,3 +281,24 @@ export function checkDescriptorForGlobalConfig(errorFieldName, descriptorName) {\n         }).catch(console.error);\n     };\n }\n+\n+export function validateDistributionJob(config) {\n+    return (dispatch, getState) => {\n+        dispatch(validatingJob());\n+        const { csrfToken } = getState().session;\n+        const request = ConfigRequestBuilder.createValidateRequest(ConfigRequestBuilder.JOB_API_URL, csrfToken, config);\n+        request.then((response) => {\n+            response.json()\n+                .then((responseData) => {\n+                    const handler = createErrorHandler(DISTRIBUTION_JOB_VALIDATE_ERROR, () => validateJobError(responseData));\n+                    if (responseData.errors && !Object.keys(responseData.errors).length) {\n+                        dispatch(validatedJob());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b5c39cf513474e45148c300821acc58cb30aa16"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ1ODU1Nw==", "bodyText": "Notice the ! (NOT) operator prefixing the second condition.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489458557", "createdAt": "2020-09-16T13:57:24Z", "author": {"login": "gkillough"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -241,3 +281,24 @@ export function checkDescriptorForGlobalConfig(errorFieldName, descriptorName) {\n         }).catch(console.error);\n     };\n }\n+\n+export function validateDistributionJob(config) {\n+    return (dispatch, getState) => {\n+        dispatch(validatingJob());\n+        const { csrfToken } = getState().session;\n+        const request = ConfigRequestBuilder.createValidateRequest(ConfigRequestBuilder.JOB_API_URL, csrfToken, config);\n+        request.then((response) => {\n+            response.json()\n+                .then((responseData) => {\n+                    const handler = createErrorHandler(DISTRIBUTION_JOB_VALIDATE_ERROR, () => validateJobError(responseData));\n+                    if (responseData.errors && !Object.keys(responseData.errors).length) {\n+                        dispatch(validatedJob());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ0OTU3Ng=="}, "originalCommit": {"oid": "7b5c39cf513474e45148c300821acc58cb30aa16"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ2MTY2NQ==", "bodyText": "yes the errors are passed in the else case.  the dispatch of the validatedJob() sets the state that signifies the data is valid. The else called handler(400) meaning bad request so the  default handler will call validateJobError which takes the responseData that contains the message and the errors and set the status to ERROR so a save will never be called.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489461665", "createdAt": "2020-09-16T14:01:26Z", "author": {"login": "psantos1113"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -241,3 +281,24 @@ export function checkDescriptorForGlobalConfig(errorFieldName, descriptorName) {\n         }).catch(console.error);\n     };\n }\n+\n+export function validateDistributionJob(config) {\n+    return (dispatch, getState) => {\n+        dispatch(validatingJob());\n+        const { csrfToken } = getState().session;\n+        const request = ConfigRequestBuilder.createValidateRequest(ConfigRequestBuilder.JOB_API_URL, csrfToken, config);\n+        request.then((response) => {\n+            response.json()\n+                .then((responseData) => {\n+                    const handler = createErrorHandler(DISTRIBUTION_JOB_VALIDATE_ERROR, () => validateJobError(responseData));\n+                    if (responseData.errors && !Object.keys(responseData.errors).length) {\n+                        dispatch(validatedJob());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ0OTU3Ng=="}, "originalCommit": {"oid": "7b5c39cf513474e45148c300821acc58cb30aa16"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjUxMjc0OnYy", "diffSide": "RIGHT", "path": "src/main/js/store/actions/distributionConfigs.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxMzo0Nzo1M1rOHSxvWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDowMzo0OFrOHSyeOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ1MTM1NA==", "bodyText": "It seems odd to me that we are checking for values in the \"errors\" field and then passing along the \"message\" field.  Is this check  looking for errors? or is it looking for the absence of errors?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489451354", "createdAt": "2020-09-16T13:47:53Z", "author": {"login": "jamesrichard91"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -206,11 +238,19 @@ export function testDistributionJob(config) {\n         request.then((response) => {\n             response.json()\n                 .then((responseData) => {\n-                    if (response.ok) {\n+                    const defaultHandler = () => jobError({\n+                        type: DISTRIBUTION_JOB_TEST_FAILURE,\n+                        ...responseData\n+                    });\n+                    const handler = createErrorHandler(DISTRIBUTION_JOB_TEST_FAILURE, defaultHandler);\n+                    if (responseData.errors && !Object.keys(responseData.errors).length) {\n                         dispatch(testJobSuccess(responseData.message));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b5c39cf513474e45148c300821acc58cb30aa16"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ2MzM1Mw==", "bodyText": "looking for the absence of errors.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489463353", "createdAt": "2020-09-16T14:03:48Z", "author": {"login": "psantos1113"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -206,11 +238,19 @@ export function testDistributionJob(config) {\n         request.then((response) => {\n             response.json()\n                 .then((responseData) => {\n-                    if (response.ok) {\n+                    const defaultHandler = () => jobError({\n+                        type: DISTRIBUTION_JOB_TEST_FAILURE,\n+                        ...responseData\n+                    });\n+                    const handler = createErrorHandler(DISTRIBUTION_JOB_TEST_FAILURE, defaultHandler);\n+                    if (responseData.errors && !Object.keys(responseData.errors).length) {\n                         dispatch(testJobSuccess(responseData.message));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ1MTM1NA=="}, "originalCommit": {"oid": "7b5c39cf513474e45148c300821acc58cb30aa16"}, "originalPosition": 123}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjgyNDUzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigController.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNDo1Mjo1MlrOHS0x4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNToxNjoxN1rOHS13sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUwMTE1Mw==", "bodyText": "If we're ok returning null, then why do we work with an optional as Content?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489501153", "createdAt": "2020-09-16T14:52:52Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigController.java", "diffHunk": "@@ -100,6 +100,7 @@ public ValidationResponseModel validate(JobFieldModel requestBody) {\n \n     @Override\n     public ValidationResponseModel test(JobFieldModel resource) {\n-        return ResponseFactory.createContentResponseFromAction(jobConfigActions.test(resource));\n+        ValidationActionResponse response = jobConfigActions.test(resource);\n+        return ResponseFactory.createContentResponseFromAction(new ValidationActionResponse(HttpStatus.OK, response.getContent().orElse(null)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8db117a41bc6b0cf1d9f29e0709de9aa5a5b592f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUwMzE3NA==", "bodyText": "I brought this same issue up in the video code review. It shouldn't ever actually return null, but we should have a static initializer for validation responses anyway.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489503174", "createdAt": "2020-09-16T14:55:26Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigController.java", "diffHunk": "@@ -100,6 +100,7 @@ public ValidationResponseModel validate(JobFieldModel requestBody) {\n \n     @Override\n     public ValidationResponseModel test(JobFieldModel resource) {\n-        return ResponseFactory.createContentResponseFromAction(jobConfigActions.test(resource));\n+        ValidationActionResponse response = jobConfigActions.test(resource);\n+        return ResponseFactory.createContentResponseFromAction(new ValidationActionResponse(HttpStatus.OK, response.getContent().orElse(null)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUwMTE1Mw=="}, "originalCommit": {"oid": "8db117a41bc6b0cf1d9f29e0709de9aa5a5b592f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUxOTAyNg==", "bodyText": "ActionResponse has the getContent() method and in some cases there is no content to return it can be null you just want the http status code and/or message with no content. So because content can be null we return an Optional to indicate to other users of the API that the content can be null and avoid NullPointerExceptions.  The Optional allows you to know you need to check if it is present otherwise you would need to have special code to check for null otherwise you would have NullPointerExceptions.  ValidationActionResponse extends ActionResponse. Because we are wrapping the ValidationActionResponse with a new ValidationActionResponse with an OK status to represent validation or test execution, we need to get the content with getContent() which is an Optional.  So to work with the Optional API i have the orElse(null) for the empty optional case.\nIt's a little beyond the scope of this PR but we might be able to refactor the API to make it a clearer if there's confusion.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489519026", "createdAt": "2020-09-16T15:16:17Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/job/JobConfigController.java", "diffHunk": "@@ -100,6 +100,7 @@ public ValidationResponseModel validate(JobFieldModel requestBody) {\n \n     @Override\n     public ValidationResponseModel test(JobFieldModel resource) {\n-        return ResponseFactory.createContentResponseFromAction(jobConfigActions.test(resource));\n+        ValidationActionResponse response = jobConfigActions.test(resource);\n+        return ResponseFactory.createContentResponseFromAction(new ValidationActionResponse(HttpStatus.OK, response.getContent().orElse(null)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUwMTE1Mw=="}, "originalCommit": {"oid": "8db117a41bc6b0cf1d9f29e0709de9aa5a5b592f"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA2MjkxMDMxOnYy", "diffSide": "RIGHT", "path": "src/main/js/store/actions/distributionConfigs.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNToxMDo0NlrOHS1n7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNToxMzo0M1rOHS1wOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUxNDk4OQ==", "bodyText": "is handler a function here? We're passing a status to handler but it doesn't look like handler expects anything passed to it.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489514989", "createdAt": "2020-09-16T15:10:46Z", "author": {"login": "bamandel"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -173,7 +195,12 @@ export function saveDistributionJob(config) {\n                     if (response.ok) {\n                         dispatch(saveJobSuccess(responseData.message));\n                     } else {\n-                        handleFailureResponse(DISTRIBUTION_JOB_SAVE_ERROR, dispatch, responseData, response.status);\n+                        const defaultHandler = () => jobError({\n+                            type: DISTRIBUTION_JOB_SAVE_ERROR,\n+                            ...responseData\n+                        });\n+                        const handler = createErrorHandler(DISTRIBUTION_JOB_SAVE_ERROR, defaultHandler);\n+                        dispatch(handler(response.status));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8db117a41bc6b0cf1d9f29e0709de9aa5a5b592f"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUxNzExNA==", "bodyText": "createErrroHandler creates a function reference like a lambda expression.  We are assigning handler to the function that is returned by createErrorHandler.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1168#discussion_r489517114", "createdAt": "2020-09-16T15:13:43Z", "author": {"login": "psantos1113"}, "path": "src/main/js/store/actions/distributionConfigs.js", "diffHunk": "@@ -173,7 +195,12 @@ export function saveDistributionJob(config) {\n                     if (response.ok) {\n                         dispatch(saveJobSuccess(responseData.message));\n                     } else {\n-                        handleFailureResponse(DISTRIBUTION_JOB_SAVE_ERROR, dispatch, responseData, response.status);\n+                        const defaultHandler = () => jobError({\n+                            type: DISTRIBUTION_JOB_SAVE_ERROR,\n+                            ...responseData\n+                        });\n+                        const handler = createErrorHandler(DISTRIBUTION_JOB_SAVE_ERROR, defaultHandler);\n+                        dispatch(handler(response.status));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTUxNDk4OQ=="}, "originalCommit": {"oid": "8db117a41bc6b0cf1d9f29e0709de9aa5a5b592f"}, "originalPosition": 80}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1750, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}