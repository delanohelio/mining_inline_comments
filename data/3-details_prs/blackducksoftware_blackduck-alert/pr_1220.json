{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxODIyNjE0", "number": 1220, "title": " saml init disable", "bodyText": "Disable SAML if the configuration is found to be invalid on startup.\nUpdate the test functionality to check the entity id as well.", "createdAt": "2020-10-12T21:14:48Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1220", "merged": true, "mergeCommit": {"oid": "2d9c4b6096704ae33beb9991f41a2e6f84f6afd4"}, "closed": true, "closedAt": "2020-10-13T16:51:02Z", "author": {"login": "psantos1113"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP4yCLAH2gAyNTAxODIyNjE0OjMzOTk5MGVmZTM4MzFkOTM1OTJmMDRjOTMyYzRmOTEwOWFiNDhmOWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSK-kiAH2gAyNTAxODIyNjE0OjI0YTYyYmRhNWZhM2IyYjk0ZGZiMjRmNWM2MzNjNjQ3MTk0MzQ2Mjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "339990efe3831d93592f04c932c4f9109ab48f9e", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/339990efe3831d93592f04c932c4f9109ab48f9e", "committedDate": "2020-10-06T13:55:26Z", "message": "feat: Validate SAML config and disable if invalid."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03c9fb7d407695f11927379e259350102c62d26e", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/03c9fb7d407695f11927379e259350102c62d26e", "committedDate": "2020-10-12T12:17:54Z", "message": "Merge remote-tracking branch 'origin/master' into ps_saml_init_disable_merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4278973f1d051fcdbf878947a03057697be38b5", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/a4278973f1d051fcdbf878947a03057697be38b5", "committedDate": "2020-10-12T13:23:55Z", "message": "Merge remote-tracking branch 'origin/master' into ps_saml_init_disable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daf4433006165503f24ae8a9a395caa7287e93d7", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/daf4433006165503f24ae8a9a395caa7287e93d7", "committedDate": "2020-10-12T21:10:56Z", "message": "refactor: Update to disable SAML if configuration is invalid."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f495a8764339bec89f435c712362b3a9829255b9", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f495a8764339bec89f435c712362b3a9829255b9", "committedDate": "2020-10-12T21:11:18Z", "message": "Merge remote-tracking branch 'origin/master' into ps_saml_init_disable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NDE4MzI3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1220#pullrequestreview-507418327", "createdAt": "2020-10-13T13:12:44Z", "commit": {"oid": "f495a8764339bec89f435c712362b3a9829255b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoxMjo0NFrOHgl9SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzoxMjo0NFrOHgl9SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkzODM3Ng==", "bodyText": "This could be simplified to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (null != enabledField) {\n          \n          \n            \n                            enabledField.setFieldValue(String.valueOf(false));\n          \n          \n            \n                        } else {\n          \n          \n            \n                            enabledField = ConfigurationFieldModel.create(AuthenticationDescriptor.KEY_SAML_ENABLED);\n          \n          \n            \n                            enabledField.setFieldValue(String.valueOf(false));\n          \n          \n            \n                            fields.put(AuthenticationDescriptor.KEY_SAML_ENABLED, enabledField);\n          \n          \n            \n                        }\n          \n          \n            \n                        if (null == enabledField) {\n          \n          \n            \n                            enabledField = ConfigurationFieldModel.create(AuthenticationDescriptor.KEY_SAML_ENABLED);\n          \n          \n            \n                            fields.put(AuthenticationDescriptor.KEY_SAML_ENABLED, enabledField);\n          \n          \n            \n                        }\n          \n          \n            \n                        enabledField.setFieldValue(String.valueOf(false));\n          \n      \n    \n    \n  \n\nIf it feels weird to modify the reference after the fields.put(...) call, you could call fields.put(...) after the last line without any significant performance impact.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1220#discussion_r503938376", "createdAt": "2020-10-13T13:12:44Z", "author": {"login": "gkillough"}, "path": "component/src/main/java/com/synopsys/integration/alert/component/authentication/security/saml/SAMLContext.java", "diffHunk": "@@ -69,6 +70,24 @@ public boolean isSAMLEnabled() {\n         return false;\n     }\n \n+    public void disableSAML() {\n+        try {\n+            ConfigurationModel configurationModel = getCurrentConfiguration();\n+            Map<String, ConfigurationFieldModel> fields = configurationModel.getCopyOfKeyToFieldMap();\n+            ConfigurationFieldModel enabledField = fields.get(AuthenticationDescriptor.KEY_SAML_ENABLED);\n+            if (null != enabledField) {\n+                enabledField.setFieldValue(String.valueOf(false));\n+            } else {\n+                enabledField = ConfigurationFieldModel.create(AuthenticationDescriptor.KEY_SAML_ENABLED);\n+                enabledField.setFieldValue(String.valueOf(false));\n+                fields.put(AuthenticationDescriptor.KEY_SAML_ENABLED, enabledField);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f495a8764339bec89f435c712362b3a9829255b9"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NDY0OTMy", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1220#pullrequestreview-507464932", "createdAt": "2020-10-13T13:57:35Z", "commit": {"oid": "f495a8764339bec89f435c712362b3a9829255b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzo1NzozNVrOHgoJaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzo1NzozNVrOHgoJaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk3NDI0OQ==", "bodyText": "Should we be handling such broad exceptions here?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1220#discussion_r503974249", "createdAt": "2020-10-13T13:57:35Z", "author": {"login": "bamandel"}, "path": "component/src/main/java/com/synopsys/integration/alert/component/authentication/security/saml/SAMLManager.java", "diffHunk": "@@ -166,4 +173,33 @@ private ExtendedMetadataDelegate createDelegate(MetadataProvider provider) {\n     private HttpClient httpClient() {\n         return new HttpClient(new MultiThreadedHttpConnectionManager());\n     }\n+\n+    private boolean checkMetadataProvidersValid(String metaDataUrl, String entityId) {\n+        boolean httpProviderValid = false;\n+        boolean fileProviderValid = false;\n+        boolean entityIdValid = StringUtils.isNotBlank(entityId);\n+        if (!entityIdValid) {\n+            logger.error(\"Validated SAML entity id missing.\");\n+        }\n+        try {\n+            Optional<ExtendedMetadataDelegate> provider = createHttpProvider(metaDataUrl);\n+            if (provider.isPresent()) {\n+                provider.get().initialize();\n+                httpProviderValid = true;\n+            }\n+        } catch (Exception ex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f495a8764339bec89f435c712362b3a9829255b9"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NDY1MTkz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1220#pullrequestreview-507465193", "createdAt": "2020-10-13T13:57:49Z", "commit": {"oid": "f495a8764339bec89f435c712362b3a9829255b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzo1Nzo1MFrOHgoKLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMzo1Nzo1MFrOHgoKLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk3NDQ0Ng==", "bodyText": "Another very broad exception handling", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1220#discussion_r503974446", "createdAt": "2020-10-13T13:57:50Z", "author": {"login": "bamandel"}, "path": "component/src/main/java/com/synopsys/integration/alert/component/authentication/security/saml/SAMLManager.java", "diffHunk": "@@ -166,4 +173,33 @@ private ExtendedMetadataDelegate createDelegate(MetadataProvider provider) {\n     private HttpClient httpClient() {\n         return new HttpClient(new MultiThreadedHttpConnectionManager());\n     }\n+\n+    private boolean checkMetadataProvidersValid(String metaDataUrl, String entityId) {\n+        boolean httpProviderValid = false;\n+        boolean fileProviderValid = false;\n+        boolean entityIdValid = StringUtils.isNotBlank(entityId);\n+        if (!entityIdValid) {\n+            logger.error(\"Validated SAML entity id missing.\");\n+        }\n+        try {\n+            Optional<ExtendedMetadataDelegate> provider = createHttpProvider(metaDataUrl);\n+            if (provider.isPresent()) {\n+                provider.get().initialize();\n+                httpProviderValid = true;\n+            }\n+        } catch (Exception ex) {\n+            logger.error(\"Validating SAML Metadata URL error: \", ex);\n+        }\n+\n+        try {\n+            Optional<ExtendedMetadataDelegate> provider = createFileProvider();\n+            if (provider.isPresent()) {\n+                provider.get().initialize();\n+                fileProviderValid = true;\n+            }\n+        } catch (Exception ex) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f495a8764339bec89f435c712362b3a9829255b9"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NDY2MDY0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1220#pullrequestreview-507466064", "createdAt": "2020-10-13T13:58:38Z", "commit": {"oid": "f495a8764339bec89f435c712362b3a9829255b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NDk0OTY0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1220#pullrequestreview-507494964", "createdAt": "2020-10-13T14:26:02Z", "commit": {"oid": "f495a8764339bec89f435c712362b3a9829255b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3af60d03f6dd2d32d946f420230ad3a5721df965", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/3af60d03f6dd2d32d946f420230ad3a5721df965", "committedDate": "2020-10-13T14:30:05Z", "message": "test: Add more test cases for SAMLManager."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NTAwOTc0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1220#pullrequestreview-507500974", "createdAt": "2020-10-13T14:31:39Z", "commit": {"oid": "f495a8764339bec89f435c712362b3a9829255b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "162980035eab3d3afc508c7cd6742246dbb653a1", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/162980035eab3d3afc508c7cd6742246dbb653a1", "committedDate": "2020-10-13T14:45:38Z", "message": "refactor: Update based on PR feedback."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24a62bda5fa3b2b94dfb24f5c633c64719434627", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/24a62bda5fa3b2b94dfb24f5c633c64719434627", "committedDate": "2020-10-13T16:15:16Z", "message": "test: Fix the startup component test."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3003, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}