{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NTIyMDY0", "number": 1112, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1NzozNlrOEYK6ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowNjoyOVrOEYLHag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNzgwMDY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1NzozNlrOHAXRRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODoxODoxMVrOHAX_7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MzMwMw==", "bodyText": "This is done in multiple places, we should add a method that performs this check and throws the exception to the MessageResult object.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470143303", "createdAt": "2020-08-13T17:57:36Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -129,8 +131,13 @@ public void deleteJobById(UUID id) throws AlertException {\n     }\n \n     public JobFieldModel saveJob(JobFieldModel jobFieldModel) throws AlertException {\n-        validateJob(jobFieldModel);\n+        MessageResult validationResult = validateJob(jobFieldModel);\n+        List<AlertFieldStatus> fieldStatuses = validationResult.getFieldStatuses();\n+        if (!fieldStatuses.isEmpty()) {\n+            throw new AlertFieldException(fieldStatuses);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b402e4b54f679cae942b5e6ef352c75539e2e915"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1NDU4NQ==", "bodyText": "I was hesitant to do this because I eventually want to get rid of AlertFieldException and just return the results object.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470154585", "createdAt": "2020-08-13T18:17:00Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -129,8 +131,13 @@ public void deleteJobById(UUID id) throws AlertException {\n     }\n \n     public JobFieldModel saveJob(JobFieldModel jobFieldModel) throws AlertException {\n-        validateJob(jobFieldModel);\n+        MessageResult validationResult = validateJob(jobFieldModel);\n+        List<AlertFieldStatus> fieldStatuses = validationResult.getFieldStatuses();\n+        if (!fieldStatuses.isEmpty()) {\n+            throw new AlertFieldException(fieldStatuses);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MzMwMw=="}, "originalCommit": {"oid": "b402e4b54f679cae942b5e6ef352c75539e2e915"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1NTI0NQ==", "bodyText": "I agree with that sentiment, but it doesn't hurt to have the method right now then remove it when it's no longer needed", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470155245", "createdAt": "2020-08-13T18:18:11Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -129,8 +131,13 @@ public void deleteJobById(UUID id) throws AlertException {\n     }\n \n     public JobFieldModel saveJob(JobFieldModel jobFieldModel) throws AlertException {\n-        validateJob(jobFieldModel);\n+        MessageResult validationResult = validateJob(jobFieldModel);\n+        List<AlertFieldStatus> fieldStatuses = validationResult.getFieldStatuses();\n+        if (!fieldStatuses.isEmpty()) {\n+            throw new AlertFieldException(fieldStatuses);\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MzMwMw=="}, "originalCommit": {"oid": "b402e4b54f679cae942b5e6ef352c75539e2e915"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNzgwNTg2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1ODo1NVrOHAXUcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1ODo1NVrOHAXUcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NDExMg==", "bodyText": "Another example of the exception throwing.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470144112", "createdAt": "2020-08-13T17:58:55Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -152,7 +159,11 @@ public JobFieldModel saveJob(JobFieldModel jobFieldModel) throws AlertException\n     }\n \n     public JobFieldModel updateJob(UUID id, JobFieldModel jobFieldModel) throws AlertException {\n-        validateJob(jobFieldModel);\n+        MessageResult validationResult = validateJob(jobFieldModel);\n+        List<AlertFieldStatus> fieldStatuses = validationResult.getFieldStatuses();\n+        if (!fieldStatuses.isEmpty()) {\n+            throw new AlertFieldException(fieldStatuses);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNzgyMDQzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowMjoyMFrOHAXc7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowMjoyMFrOHAXc7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NjI4NQ==", "bodyText": "I think this could be converted into a stream.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470146285", "createdAt": "2020-08-13T18:02:20Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -226,37 +237,41 @@ private boolean filterOutMatchingJobs(@Nullable UUID currentJobId, Configuration\n         }\n     }\n \n-    public String validateJob(JobFieldModel jobFieldModel) throws AlertFieldException {\n-        List<AlertFieldStatus> fieldErrors = new ArrayList<>();\n+    public MessageResult validateJob(JobFieldModel jobFieldModel) {\n+        List<AlertFieldStatus> fieldStatuses = new ArrayList<>();\n         for (FieldModel fieldModel : jobFieldModel.getFieldModels()) {\n-            fieldErrors.addAll(fieldModelProcessor.validateFieldModel(fieldModel));\n+            fieldStatuses.addAll(fieldModelProcessor.validateFieldModel(fieldModel));\n         }\n \n-        if (!fieldErrors.isEmpty()) {\n-            throw new AlertFieldException(fieldErrors);\n+        if (!fieldStatuses.isEmpty()) {\n+            return new MessageResult(\"Invalid\", fieldStatuses);\n         }\n-        return \"Valid\";\n+        return new MessageResult(\"Valid\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNzgyODM0OnYy", "diffSide": "RIGHT", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/message/model/MessageResult.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowNDo0OVrOHAXiEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODo1NDoyOVrOHAZQ1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NzYwMA==", "bodyText": "Should this field be an instance of JobFieldStatuses? and the helper methods moved into the JobFieldStatuses class?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470147600", "createdAt": "2020-08-13T18:04:49Z", "author": {"login": "jamesrichard91"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/message/model/MessageResult.java", "diffHunk": "@@ -22,21 +22,63 @@\n  */\n package com.synopsys.integration.alert.common.message.model;\n \n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.FieldStatusSeverity;\n import com.synopsys.integration.alert.common.rest.model.AlertSerializableModel;\n \n public class MessageResult extends AlertSerializableModel {\n-    private String statusMessage;\n+    private final String statusMessage;\n+    private final List<AlertFieldStatus> fieldStatuses;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3NTk1OQ==", "bodyText": "JobFieldStatues would be a subset of the use case intended for this class.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470175959", "createdAt": "2020-08-13T18:54:29Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/message/model/MessageResult.java", "diffHunk": "@@ -22,21 +22,63 @@\n  */\n package com.synopsys.integration.alert.common.message.model;\n \n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.FieldStatusSeverity;\n import com.synopsys.integration.alert.common.rest.model.AlertSerializableModel;\n \n public class MessageResult extends AlertSerializableModel {\n-    private String statusMessage;\n+    private final String statusMessage;\n+    private final List<AlertFieldStatus> fieldStatuses;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NzYwMA=="}, "originalCommit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNzgzNDAyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/actions/BlackDuckDistributionTestAction.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowNjoyOVrOHAXljg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowNjoyOVrOHAXljg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0ODQ5NA==", "bodyText": "This could be confusing to handle further down the line, since the message will say success but there could be errors", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470148494", "createdAt": "2020-08-13T18:06:29Z", "author": {"login": "jamesrichard91"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/actions/BlackDuckDistributionTestAction.java", "diffHunk": "@@ -78,22 +79,22 @@ public MessageResult testConfig(String configId, FieldModel fieldModel, FieldAcc\n \n                 BlackDuckApiTokenValidator blackDuckAPITokenValidator = new BlackDuckApiTokenValidator(blackDuckProperties);\n                 if (!blackDuckAPITokenValidator.isApiTokenValid()) {\n-                    throw AlertFieldException.singleFieldError(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"User permission failed, cannot read notifications from Black Duck.\");\n+                    fieldStatuses.add(AlertFieldStatus.error(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"User permission failed, cannot read notifications from Black Duck.\"));\n                 }\n             }\n         } else {\n-            throw AlertFieldException.singleFieldError(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"A provider configuration is required\");\n+            fieldStatuses.add(AlertFieldStatus.error(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"A provider configuration is required\"));\n         }\n-\n-        return new MessageResult(\"Successfully tested BlackDuck provider fields\");\n+        return new MessageResult(\"Successfully tested BlackDuck provider fields\", fieldStatuses);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "originalPosition": 50}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1675, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}