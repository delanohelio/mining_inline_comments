{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczODg3NjE1", "number": 850, "title": "Updating the vulnerability handling, we no longer need to make a request per vulnerability.", "bodyText": "", "createdAt": "2020-02-11T21:20:43Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850", "merged": true, "mergeCommit": {"oid": "e3cd8a6d4609cbcc458a3ebc21e7f2d6aad24c90"}, "closed": true, "closedAt": "2020-02-12T15:39:08Z", "author": {"login": "jamesrichard91"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDYeLEAH2gAyMzczODg3NjE1OmY1YTQ0NWQ4MTZhZDBkOTU2NTBkMWE5MzdiYzFkMTNiOGU0ZWMwNDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDoKrJgH2gAyMzczODg3NjE1Ojk0NWFkNWY5NTBhMjY1ZGM2MWRkZmQ4MjI0M2UwZWU5N2Y4OTg2ZTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f5a445d816ad0d95650d1a937bc1d13b8e4ec048", "committedDate": "2020-02-11T21:18:32Z", "message": "Refactor: Updating the vulnerability handling, we no longer need to make a request per vulnerability."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MDA1NTE1", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850#pullrequestreview-357005515", "createdAt": "2020-02-11T21:23:20Z", "commit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMToyMzoyMFrOFoZnPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMToyMzoyMFrOFoZnPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkwNzAwNQ==", "bodyText": "The BlackDuckServicesFactory constructor now requires MediaTypeDiscovery", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850#discussion_r377907005", "createdAt": "2020-02-11T21:23:20Z", "author": {"login": "jamesrichard91"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/BlackDuckProperties.java", "diffHunk": "@@ -81,49 +81,50 @@ public Integer getBlackDuckTimeout() {\n         return retrieveGlobalConfig();\n     }\n \n-    public BlackDuckServicesFactory createBlackDuckServicesFactory(final BlackDuckHttpClient blackDuckHttpClient, final IntLogger logger) {\n-        return new BlackDuckServicesFactory(new IntEnvironmentVariables(), gson, BlackDuckServicesFactory.createDefaultObjectMapper(), new NoThreadExecutorService(), blackDuckHttpClient, logger);\n+    public BlackDuckServicesFactory createBlackDuckServicesFactory(BlackDuckHttpClient blackDuckHttpClient, IntLogger logger) {\n+        return new BlackDuckServicesFactory(new IntEnvironmentVariables(), gson, BlackDuckServicesFactory.createDefaultObjectMapper(), new NoThreadExecutorService(), blackDuckHttpClient, logger,\n+            BlackDuckServicesFactory.createDefaultMediaTypeDiscovery());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MDA2MTk2", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850#pullrequestreview-357006196", "createdAt": "2020-02-11T21:24:27Z", "commit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMToyNDoyN1rOFoZpXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMToyNDoyN1rOFoZpXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkwNzU0OA==", "bodyText": "Moving the comment here from BlackDuckResponseCache  because the comment only applies to the Bom Edit notifications", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850#discussion_r377907548", "createdAt": "2020-02-11T21:24:27Z", "author": {"login": "jamesrichard91"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/collector/builder/BomEditMessageBuilder.java", "diffHunk": "@@ -90,6 +90,9 @@ public String getNotificationType() {\n         BlackDuckResponseCache responseCache = new BlackDuckResponseCache(bucketService, blackDuckBucket, timeout);\n         BomEditNotificationContent bomEditContent = notificationView.getContent();\n         Optional<ProjectVersionComponentView> bomComponent = responseCache.getBomComponentView(bomEditContent.getBomComponent());\n+\n+        // TODO Stop using this when Black Duck supports going back to the project-version\n+        // blackduck-common-api 2019.12.0.4+ should have the project version link in the BomEditNotificationContent", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MDE0MDU4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850#pullrequestreview-357014058", "createdAt": "2020-02-11T21:36:42Z", "commit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDU4NTk4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850#pullrequestreview-357458598", "createdAt": "2020-02-12T13:41:56Z", "commit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMzo0MTo1NlrOFou7_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMzo0MTo1NlrOFou7_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI1NjM4MA==", "bodyText": "We could do Objects.requireNonNullElse(vulnerabilityItem.getSeverity(), \"UNKNOWN\")", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850#discussion_r378256380", "createdAt": "2020-02-12T13:41:56Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/collector/builder/VulnerabilityNotificationMessageBuilder.java", "diffHunk": "@@ -148,14 +148,13 @@ public String getNotificationType() {\n         for (VulnerabilitySourceQualifiedId vulnerabilityItem : vulnerabilityList) {\n             String vulnerabilityId = vulnerabilityItem.getVulnerabilityId();\n             String vulnerabilityUrl = vulnerabilityItem.getVulnerability();\n-\n             LinkableItem vulnIdItem = new LinkableItem(MessageBuilderConstants.LABEL_VULNERABILITIES, vulnerabilityId, vulnerabilityUrl);\n-            // TODO in blackduck-common:45.1.2+ the VulnerabilitySourceQualifiedId includes the severity so we don't need to make a request to get it\n-            String notificationSeverity = blackDuckResponseCache.getSeverity(vulnerabilityUrl);\n-            if (vulnerabilityFilters.isEmpty() || vulnerabilityFilters.contains(notificationSeverity)) {\n+\n+            String notificationSeverity = vulnerabilityItem.getSeverity();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDU5OTA3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850#pullrequestreview-357459907", "createdAt": "2020-02-12T13:43:49Z", "commit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMzo0Mzo0OVrOFovAHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMzo0Mzo0OVrOFovAHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI1NzQzNg==", "bodyText": "We might want to add something with a null severity.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850#discussion_r378257436", "createdAt": "2020-02-12T13:43:49Z", "author": {"login": "gkillough"}, "path": "src/test/resources/json/vulnerabilityNotificationComplex.json", "diffHunk": "@@ -10,81 +10,96 @@\n       {\n         \"source\": \"NVD\",\n         \"vulnerabilityId\": \"CVE-2018-0001\",\n-        \"vulnerability\": \"https://a-hub-server.blackduck.com/api/vulnerabilities/CVE-2018-0001\"\n+        \"vulnerability\": \"https://a-hub-server.blackduck.com/api/vulnerabilities/CVE-2018-0001\",\n+        \"severity\": \"HIGH\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDYwMDMx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850#pullrequestreview-357460031", "createdAt": "2020-02-12T13:44:01Z", "commit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDYyNTE0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/850#pullrequestreview-357462514", "createdAt": "2020-02-12T13:47:28Z", "commit": {"oid": "f5a445d816ad0d95650d1a937bc1d13b8e4ec048"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fdc82fe13ef105027af392aee27591b0388de8f", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/1fdc82fe13ef105027af392aee27591b0388de8f", "committedDate": "2020-02-12T15:19:42Z", "message": "Refactor: Updating null check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "945ad5f950a265dc61ddfd82243e0ee97f8986e7", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/945ad5f950a265dc61ddfd82243e0ee97f8986e7", "committedDate": "2020-02-12T15:35:43Z", "message": "Refactor: Updating the vulnerabilityNotificationComplex test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2804, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}