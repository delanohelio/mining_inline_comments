{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NjU4Nzkw", "number": 905, "title": "Fix: compare existing job name with all other jobs to prevent duplicate names", "bodyText": "", "createdAt": "2020-03-09T15:33:48Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/905", "merged": true, "mergeCommit": {"oid": "3f82ef616e0f591ce453a2d9538722d153008c90"}, "closed": true, "closedAt": "2020-03-09T17:32:14Z", "author": {"login": "jamesrichard91"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcL_sLDgH2gAyMzg1NjU4NzkwOjBkNzJkZWFkZmEyMTdhYTQwMGQ1NjE2N2UyMjkxMDZkZmMyYWIyOTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMBWY6AH2gAyMzg1NjU4NzkwOmU1ZDQzMDdkYjI1ZTNlYWEyOTBjYzdkMGQ4YmFkZGE4MThhZjM3YjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0d72deadfa217aa400d56167e229106dfc2ab290", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/0d72deadfa217aa400d56167e229106dfc2ab290", "committedDate": "2020-03-09T15:31:31Z", "message": "Fix: compare existing job name with all other jobs to prevent duplicate names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzEwOTgz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/905#pullrequestreview-371310983", "createdAt": "2020-03-09T15:58:50Z", "commit": {"oid": "0d72deadfa217aa400d56167e229106dfc2ab290"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzUxNDgx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/905#pullrequestreview-371351481", "createdAt": "2020-03-09T16:48:00Z", "commit": {"oid": "0d72deadfa217aa400d56167e229106dfc2ab290"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNjo0ODowMVrOFzwsuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNjo0ODowMVrOFzwsuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTgxOTU3Ng==", "bodyText": "Either abstract this into its own method, or do the check before this stream. This is a little to cluttered IMO.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/905#discussion_r389819576", "createdAt": "2020-03-09T16:48:01Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -172,20 +174,28 @@ public JobFieldModel updateJob(UUID id, JobFieldModel jobFieldModel) throws Aler\n         return savedJobFieldModel;\n     }\n \n-    private void validateJobNameUnique(JobFieldModel jobFieldModel) throws AlertFieldException {\n+    private void validateJobNameUnique(@Nullable UUID currentJobId, JobFieldModel jobFieldModel) throws AlertFieldException {\n         for (FieldModel fieldModel : jobFieldModel.getFieldModels()) {\n-            validateJobNameUnique(fieldModel);\n+            validateJobNameUnique(currentJobId, fieldModel);\n         }\n     }\n \n-    private void validateJobNameUnique(FieldModel fieldModel) throws AlertFieldException {\n+    private void validateJobNameUnique(@Nullable UUID currentJobId, FieldModel fieldModel) throws AlertFieldException {\n         Optional<FieldValueModel> jobNameFieldOptional = fieldModel.getFieldValueModel(ChannelDistributionUIConfig.KEY_NAME);\n         String error = \"\";\n         if (jobNameFieldOptional.isPresent()) {\n             String jobName = jobNameFieldOptional.get().getValue().orElse(null);\n             if (StringUtils.isNotBlank(jobName)) {\n                 List<ConfigurationJobModel> jobs = configurationAccessor.getAllJobs();\n+\n                 boolean foundDuplicateName = jobs.stream()\n+                                                 .filter(job -> {\n+                                                     if (null != currentJobId) {\n+                                                         return !job.getJobId().equals(currentJobId);\n+                                                     } else {\n+                                                         return true;\n+                                                     }\n+                                                 })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d72deadfa217aa400d56167e229106dfc2ab290"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cba61270080539c6a9a13974be80bbecfa73edd", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/4cba61270080539c6a9a13974be80bbecfa73edd", "committedDate": "2020-03-09T17:17:21Z", "message": "Refactor: moving filter logic out into its own method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5d4307db25e3eaa290cc7d0d8badda818af37b1", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/e5d4307db25e3eaa290cc7d0d8badda818af37b1", "committedDate": "2020-03-09T17:27:32Z", "message": "Refactor: Removing unnecessary null check"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2631, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}