{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1MTM0MTQ5", "number": 1163, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNjo0NToxNVrOEinarw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo1MDo1MlrOEjtGKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NzMyODQ3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/web/api/user/UserController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNjo0NToxNVrOHQmMSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNjo0NToxNVrOHQmMSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE2NTAwMQ==", "bodyText": "Should this return NO_CONTENT here?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1163#discussion_r487165001", "createdAt": "2020-09-11T16:45:15Z", "author": {"login": "psantos1113"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/user/UserController.java", "diffHunk": "@@ -51,76 +55,80 @@\n     public static final String USER_BASE_PATH = ConfigController.CONFIGURATION_PATH + \"/user\";\n \n     private final Logger logger = LoggerFactory.getLogger(UserController.class);\n-    private final ContentConverter contentConverter;\n-    private final ResponseFactory responseFactory;\n     private final AuthorizationManager authorizationManager;\n     private final UserActions userActions;\n     private final UserManagementDescriptorKey descriptorKey;\n \n     @Autowired\n-    public UserController(ContentConverter contentConverter, ResponseFactory responseFactory, AuthorizationManager authorizationManager, UserActions userActions,\n+    public UserController(AuthorizationManager authorizationManager, UserActions userActions,\n         UserManagementDescriptorKey descriptorKey) {\n-        this.contentConverter = contentConverter;\n-        this.responseFactory = responseFactory;\n         this.authorizationManager = authorizationManager;\n         this.userActions = userActions;\n         this.descriptorKey = descriptorKey;\n     }\n \n     @GetMapping\n-    public ResponseEntity<String> getAllUsers() {\n+    public List<UserConfig> getAllUsers() {\n+        if (!hasGlobalPermission(authorizationManager::hasReadPermission, descriptorKey)) {\n+            throw ResponseFactory.createForbiddenException();\n+        }\n+        return userActions.getUsers();\n+    }\n+\n+    @PostMapping(\"/validate\")\n+    public ValidationResponseModel validateUserModel(@RequestBody UserConfig userConfig) {\n         if (!hasGlobalPermission(authorizationManager::hasReadPermission, descriptorKey)) {\n-            return responseFactory.createForbiddenResponse();\n+            throw ResponseFactory.createForbiddenException();\n         }\n-        return responseFactory.createOkContentResponse(contentConverter.getJsonString(userActions.getUsers()));\n+        return userActions.validateUser(userConfig);\n     }\n \n     @PostMapping\n-    public ResponseEntity<String> createUser(@RequestBody UserConfig userModel) {\n+    public UserConfig createUser(@RequestBody UserConfig userModel) {\n         if (!hasGlobalPermission(authorizationManager::hasCreatePermission, descriptorKey)) {\n-            return responseFactory.createForbiddenResponse();\n+            throw ResponseFactory.createForbiddenException();\n         }\n         try {\n-            UserConfig newUser = userActions.createUser(userModel);\n-            return responseFactory.createCreatedResponse(newUser.getId(), \"User Created.\");\n+            return userActions.createUser(userModel);\n         } catch (AlertDatabaseConstraintException e) {\n             logger.error(\"There was an issue with the DB: {}\", e.getMessage());\n             logger.debug(\"Cause\", e);\n-            return responseFactory.createInternalServerErrorResponse(\"\", \"There was an issue with the DB\");\n-        } catch (AlertFieldException e) {\n-            return responseFactory.createFieldErrorResponse(ResponseFactory.EMPTY_ID, \"There were errors with the configuration.\", e.getFieldErrors());\n+            throw ResponseFactory.createInternalServerErrorException(\"There was an issue with the DB\");\n+        } catch (AlertFieldException fieldException) {\n+            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, String.format(\"There were errors with the configuration: %s\", fieldException.getFlattenedErrorMessages()));\n         }\n \n     }\n \n     @PutMapping(value = \"/{userId}\")\n-    public ResponseEntity<String> updateUser(@PathVariable Long userId, @RequestBody UserConfig userModel) {\n+    public UserConfig updateUser(@PathVariable Long userId, @RequestBody UserConfig userModel) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8a7a24bbd7002ec5c2263a119da7cb1d1d0072f"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NzM5NTMwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/web/api/user/UserActions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNzowNDo1NFrOHQm1cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNzowNDo1NFrOHQm1cA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3NTUzNg==", "bodyText": "This looks wrong. If I am validating a user exists, why is there a list of statuses all saying the same thing being returned? Shouldn't it just be a single item returned?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1163#discussion_r487175536", "createdAt": "2020-09-11T17:04:54Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/user/UserActions.java", "diffHunk": "@@ -187,11 +199,12 @@ private void validateUserExistsByName(List<AlertFieldStatus> fieldErrors, String\n         userModel.ifPresent(user -> fieldErrors.add(AlertFieldStatus.error(FIELD_KEY_USER_MGMT_USERNAME, \"A user with that username already exists.\")));\n     }\n \n-    private void validateUserExistsById(List<AlertFieldStatus> fieldErrors, Long userId, String userName) {\n-        validateRequiredField(FIELD_KEY_USER_MGMT_USERNAME, fieldErrors, userName);\n+    private List<AlertFieldStatus> validateUserExistsById(Long userId, String userName) {\n         Optional<UserModel> userModel = userAccessor.getUser(userName);\n-        userModel.filter(user -> !user.getId().equals(userId))\n-            .ifPresent(user -> fieldErrors.add(AlertFieldStatus.error(FIELD_KEY_USER_MGMT_USERNAME, \"A user with that username already exists.\")));\n+        return userModel.filter(user -> !user.getId().equals(userId))\n+                   .map(user -> AlertFieldStatus.error(FIELD_KEY_USER_MGMT_USERNAME, \"A user with that username already exists.\"))\n+                   .stream()\n+                   .collect(Collectors.toList());\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8a7a24bbd7002ec5c2263a119da7cb1d1d0072f"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NzQ4NzY5OnYy", "diffSide": "RIGHT", "path": "src/main/js/util/configurationRequestBuilder.js", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNzozNDoxOVrOHQnvKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxODoxODowMFrOHQpFSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE5MDMxNA==", "bodyText": "Should usage of \"accept\" be quoted like the other headers?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1163#discussion_r487190314", "createdAt": "2020-09-11T17:34:19Z", "author": {"login": "gkillough"}, "path": "src/main/js/util/configurationRequestBuilder.js", "diffHunk": "@@ -65,6 +65,7 @@ export function createUpdateRequest(apiUrl, csrfToken, configurationId, fieldMod\n         method: 'PUT',\n         body: JSON.stringify(fieldModel),\n         headers: {\n+            accept: 'application/json',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8a7a24bbd7002ec5c2263a119da7cb1d1d0072f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE5MTc0OA==", "bodyText": "I'm not entirely sure, I was basing this on export functions just above this one where the accept: 'application/json' wasn't in quotes either", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1163#discussion_r487191748", "createdAt": "2020-09-11T17:37:11Z", "author": {"login": "ChomickiM"}, "path": "src/main/js/util/configurationRequestBuilder.js", "diffHunk": "@@ -65,6 +65,7 @@ export function createUpdateRequest(apiUrl, csrfToken, configurationId, fieldMod\n         method: 'PUT',\n         body: JSON.stringify(fieldModel),\n         headers: {\n+            accept: 'application/json',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE5MDMxNA=="}, "originalCommit": {"oid": "c8a7a24bbd7002ec5c2263a119da7cb1d1d0072f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE5MzgzMg==", "bodyText": "RequestUtilities also seems to have the accept outside of quotes, so I think this may be intended", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1163#discussion_r487193832", "createdAt": "2020-09-11T17:41:09Z", "author": {"login": "ChomickiM"}, "path": "src/main/js/util/configurationRequestBuilder.js", "diffHunk": "@@ -65,6 +65,7 @@ export function createUpdateRequest(apiUrl, csrfToken, configurationId, fieldMod\n         method: 'PUT',\n         body: JSON.stringify(fieldModel),\n         headers: {\n+            accept: 'application/json',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE5MDMxNA=="}, "originalCommit": {"oid": "c8a7a24bbd7002ec5c2263a119da7cb1d1d0072f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIxMDc5OA==", "bodyText": "Our linting rules declare the quotes as unnecessary for the accept header.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1163#discussion_r487210798", "createdAt": "2020-09-11T18:14:42Z", "author": {"login": "psantos1113"}, "path": "src/main/js/util/configurationRequestBuilder.js", "diffHunk": "@@ -65,6 +65,7 @@ export function createUpdateRequest(apiUrl, csrfToken, configurationId, fieldMod\n         method: 'PUT',\n         body: JSON.stringify(fieldModel),\n         headers: {\n+            accept: 'application/json',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE5MDMxNA=="}, "originalCommit": {"oid": "c8a7a24bbd7002ec5c2263a119da7cb1d1d0072f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIxMjM2Mg==", "bodyText": "We should probably refactor this code to use the Headers object and append the headers. I would probably write up an enhancement ticket for that.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1163#discussion_r487212362", "createdAt": "2020-09-11T18:18:00Z", "author": {"login": "psantos1113"}, "path": "src/main/js/util/configurationRequestBuilder.js", "diffHunk": "@@ -65,6 +65,7 @@ export function createUpdateRequest(apiUrl, csrfToken, configurationId, fieldMod\n         method: 'PUT',\n         body: JSON.stringify(fieldModel),\n         headers: {\n+            accept: 'application/json',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE5MDMxNA=="}, "originalCommit": {"oid": "c8a7a24bbd7002ec5c2263a119da7cb1d1d0072f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NzY2NDg4OnYy", "diffSide": "RIGHT", "path": "src/main/js/store/actions/users.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxODozMDoxM1rOHQpdFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMjo0OToyMFrOHRSJyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIxODQ1Mw==", "bodyText": "We also need to make sure we update the deleteUser errors.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1163#discussion_r487218453", "createdAt": "2020-09-11T18:30:13Z", "author": {"login": "gkillough"}, "path": "src/main/js/store/actions/users.js", "diffHunk": "@@ -95,6 +98,33 @@ function clearFieldErrors() {\n     };\n }\n \n+function validatingUser() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8a7a24bbd7002ec5c2263a119da7cb1d1d0072f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg4NTI1Nw==", "bodyText": "Take a look at #1165 for an example of this.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1163#discussion_r487885257", "createdAt": "2020-09-14T12:49:20Z", "author": {"login": "gkillough"}, "path": "src/main/js/store/actions/users.js", "diffHunk": "@@ -95,6 +98,33 @@ function clearFieldErrors() {\n     };\n }\n \n+function validatingUser() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIxODQ1Mw=="}, "originalCommit": {"oid": "c8a7a24bbd7002ec5c2263a119da7cb1d1d0072f"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODc0NDc1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/synopsys/integration/alert/web/api/user/UserController.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo1MDo1MlrOHSNaSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo1Njo0NVrOHSNn-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1NjEzNw==", "bodyText": "Can we wrap this List in an object?\nFor exmaple:\npublic class MultiUserConfigResponseModel {\n    private List<UserConfig> users;\n    .\n    .\n    .\n}", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1163#discussion_r488856137", "createdAt": "2020-09-15T17:50:52Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/user/UserController.java", "diffHunk": "@@ -51,76 +55,81 @@\n     public static final String USER_BASE_PATH = ConfigController.CONFIGURATION_PATH + \"/user\";\n \n     private final Logger logger = LoggerFactory.getLogger(UserController.class);\n-    private final ContentConverter contentConverter;\n-    private final ResponseFactory responseFactory;\n     private final AuthorizationManager authorizationManager;\n     private final UserActions userActions;\n     private final UserManagementDescriptorKey descriptorKey;\n \n     @Autowired\n-    public UserController(ContentConverter contentConverter, ResponseFactory responseFactory, AuthorizationManager authorizationManager, UserActions userActions,\n+    public UserController(AuthorizationManager authorizationManager, UserActions userActions,\n         UserManagementDescriptorKey descriptorKey) {\n-        this.contentConverter = contentConverter;\n-        this.responseFactory = responseFactory;\n         this.authorizationManager = authorizationManager;\n         this.userActions = userActions;\n         this.descriptorKey = descriptorKey;\n     }\n \n     @GetMapping\n-    public ResponseEntity<String> getAllUsers() {\n+    public List<UserConfig> getAllUsers() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d404aa0be2eab81f12f9cd8906423029f34da433"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1OTY0MQ==", "bodyText": "Sure, something similar to MultiRolePermissionModel.java that just has methods to get the UserConfig list?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1163#discussion_r488859641", "createdAt": "2020-09-15T17:56:45Z", "author": {"login": "ChomickiM"}, "path": "src/main/java/com/synopsys/integration/alert/web/api/user/UserController.java", "diffHunk": "@@ -51,76 +55,81 @@\n     public static final String USER_BASE_PATH = ConfigController.CONFIGURATION_PATH + \"/user\";\n \n     private final Logger logger = LoggerFactory.getLogger(UserController.class);\n-    private final ContentConverter contentConverter;\n-    private final ResponseFactory responseFactory;\n     private final AuthorizationManager authorizationManager;\n     private final UserActions userActions;\n     private final UserManagementDescriptorKey descriptorKey;\n \n     @Autowired\n-    public UserController(ContentConverter contentConverter, ResponseFactory responseFactory, AuthorizationManager authorizationManager, UserActions userActions,\n+    public UserController(AuthorizationManager authorizationManager, UserActions userActions,\n         UserManagementDescriptorKey descriptorKey) {\n-        this.contentConverter = contentConverter;\n-        this.responseFactory = responseFactory;\n         this.authorizationManager = authorizationManager;\n         this.userActions = userActions;\n         this.descriptorKey = descriptorKey;\n     }\n \n     @GetMapping\n-    public ResponseEntity<String> getAllUsers() {\n+    public List<UserConfig> getAllUsers() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1NjEzNw=="}, "originalCommit": {"oid": "d404aa0be2eab81f12f9cd8906423029f34da433"}, "originalPosition": 54}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1739, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}