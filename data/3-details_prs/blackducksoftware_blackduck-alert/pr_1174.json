{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5NDEyNTg2", "number": 1174, "title": "Fix Provider Config reference strategy in Jobs", "bodyText": "", "createdAt": "2020-09-18T16:12:56Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1174", "merged": true, "mergeCommit": {"oid": "8ae6535ccff5591c0bb4af7b3ee82b187f12059d"}, "closed": true, "closedAt": "2020-09-18T16:57:25Z", "author": {"login": "gkillough"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdI3fvwgH2gAyNDg5NDEyNTg2OjYxMmE0OTk2ZjM2YTA5ZmY0NzA4MWUyNmJmNzE4MGQyMzI5ZjdkNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKIlrCAH2gAyNDg5NDEyNTg2OmZmYzA1OGI4NjZkMGI2ZjQ2YTYyMjUyNTNjYWNkNGFmNGRmNzUxYmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "612a4996f36a09ff47081e26bf7180d2329f7d78", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/612a4996f36a09ff47081e26bf7180d2329f7d78", "committedDate": "2020-09-14T18:28:05Z", "message": "Feat(Liquibase): Add provider config id field for distribution jobs and migrate id based on provider name field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "853cc123008a4f8570e3166f8a4be093dc8f8c9e", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/853cc123008a4f8570e3166f8a4be093dc8f8c9e", "committedDate": "2020-09-14T18:47:38Z", "message": "Feat(ProviderDescriptor): Add provider config id key constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65ed8e215213f018a01abf1449b62e2bbdea0489", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/65ed8e215213f018a01abf1449b62e2bbdea0489", "committedDate": "2020-09-14T19:40:19Z", "message": "Fix(Test): Update tests to use Long for provider id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "538674728cc612a4270e22c7fc13495dccc7daf6", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/538674728cc612a4270e22c7fc13495dccc7daf6", "committedDate": "2020-09-15T16:02:57Z", "message": "Feat(Liquibase): Delete provider config name field from distribution jobs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91715ea0580dd0cc6428130b71a825ef5698e976", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/91715ea0580dd0cc6428130b71a825ef5698e976", "committedDate": "2020-09-16T17:45:55Z", "message": "Fix(Provider): Remove cascading update for ditribution jobs in Black Duck global API action"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "266f2384fb9851bd120b695e721eb7ff345d61f5", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/266f2384fb9851bd120b695e721eb7ff345d61f5", "committedDate": "2020-09-18T12:16:24Z", "message": "Merge branch 'master' into gk_fix_provider_config_reference"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62e4035d0df62c06e1b974175d9f8c66082b202c", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/62e4035d0df62c06e1b974175d9f8c66082b202c", "committedDate": "2020-09-18T14:44:21Z", "message": "Feat(Provider Fields): Migrate from provider config name to id in UI fields and custom endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dadb2fbc980220b83898cd35c13b916f58be0df", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/5dadb2fbc980220b83898cd35c13b916f58be0df", "committedDate": "2020-09-18T16:11:51Z", "message": "Fix(Liquibase): Add provider config id field to provider_blackduck's descriptor fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjA1NjM1", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1174#pullrequestreview-491605635", "createdAt": "2020-09-18T16:16:05Z", "commit": {"oid": "5dadb2fbc980220b83898cd35c13b916f58be0df"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjoxNjowNVrOHUTnKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjoxNjowNVrOHUTnKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA1NDg5MQ==", "bodyText": "Why did this get a field suffix and no others did?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1174#discussion_r491054891", "createdAt": "2020-09-18T16:16:05Z", "author": {"login": "bamandel"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/ProviderDescriptor.java", "diffHunk": "@@ -22,22 +22,23 @@\n  */\n package com.synopsys.integration.alert.common.descriptor;\n \n+import com.synopsys.integration.alert.common.descriptor.config.ui.ProviderDistributionUIConfig;\n import com.synopsys.integration.alert.common.descriptor.config.ui.ProviderGlobalUIConfig;\n-import com.synopsys.integration.alert.common.descriptor.config.ui.UIConfig;\n import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n import com.synopsys.integration.alert.common.provider.ProviderKey;\n \n public abstract class ProviderDescriptor extends Descriptor {\n     public static final String KEY_COMMON_PROVIDER_PREFIX = \"provider.common.\";\n     public static final String KEY_PROVIDER_CONFIG_NAME = KEY_COMMON_PROVIDER_PREFIX + \"config.name\";\n+    public static final String KEY_PROVIDER_CONFIG_ID = KEY_COMMON_PROVIDER_PREFIX + \"config.id\";\n     public static final String KEY_PROVIDER_CONFIG_ENABLED = KEY_COMMON_PROVIDER_PREFIX + \"config.enabled\";\n     public static final String LABEL_PROVIDER_CONFIG_ENABLED = \"Enabled\";\n-    public static final String LABEL_PROVIDER_CONFIG_NAME = \"Provider Configuration\";\n+    public static final String LABEL_PROVIDER_CONFIG_FIELD = \"Provider Configuration\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dadb2fbc980220b83898cd35c13b916f58be0df"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b920eb7eba35a3e38da1aa5ea1f67292c0a72b32", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b920eb7eba35a3e38da1aa5ea1f67292c0a72b32", "committedDate": "2020-09-18T16:18:30Z", "message": "Fix(Provider Fields): Update provider field variable names and update the provider config id field description"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjA3NzEz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1174#pullrequestreview-491607713", "createdAt": "2020-09-18T16:19:04Z", "commit": {"oid": "5dadb2fbc980220b83898cd35c13b916f58be0df"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjoxOTowNFrOHUTs5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjoxOTowNFrOHUTs5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA1NjM1Nw==", "bodyText": "Could the optional mapping be used here instead of this if check? We start with an optional and end with one. I feel there's a cleaner way to do this.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1174#discussion_r491056357", "createdAt": "2020-09-18T16:19:04Z", "author": {"login": "bamandel"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/config/ui/ProviderConfigSelectCustomFunctionAction.java", "diffHunk": "@@ -66,14 +66,21 @@ public ProviderConfigSelectCustomFunctionAction(AuthorizationManager authorizati\n         if (descriptorKey.isPresent()) {\n             List<ConfigurationModel> configurationModels = configurationAccessor.getConfigurationsByDescriptorKeyAndContext(descriptorKey.get(), ConfigContextEnum.GLOBAL);\n             options = configurationModels.stream()\n-                          .map(ConfigurationModel::getCopyOfKeyToFieldMap)\n-                          .map(FieldAccessor::new)\n-                          .map(accessor -> accessor.getString(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME))\n+                          .map(this::createNameToIdOption)\n                           .flatMap(Optional::stream)\n-                          .map(LabelValueSelectOption::new)\n                           .collect(Collectors.toList());\n         }\n         LabelValueSelectOptions optionList = new LabelValueSelectOptions(options);\n         return new ActionResponse<>(HttpStatus.OK, optionList);\n     }\n+\n+    private Optional<LabelValueSelectOption> createNameToIdOption(ConfigurationModel configurationModel) {\n+        Optional<String> providerConfigName = configurationModel.getField(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME).flatMap(ConfigurationFieldModel::getFieldValue);\n+        if (providerConfigName.isPresent()) {\n+            LabelValueSelectOption providerConfigOption = new LabelValueSelectOption(providerConfigName.get(), configurationModel.getConfigurationId().toString());\n+            return Optional.of(providerConfigOption);\n+        }\n+        return Optional.empty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dadb2fbc980220b83898cd35c13b916f58be0df"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjI0ODc4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1174#pullrequestreview-491624878", "createdAt": "2020-09-18T16:44:25Z", "commit": {"oid": "b920eb7eba35a3e38da1aa5ea1f67292c0a72b32"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjo0NDoyNVrOHUUhog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNjo0NDoyNVrOHUUhog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA2OTg1OA==", "bodyText": "Just something to note, if we successfully remove AlertDatabaseConstraintException we'll be able to collapse this call into the previous Optional.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1174#discussion_r491069858", "createdAt": "2020-09-18T16:44:25Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/web/PolicyNotificationFilterCustomFunctionAction.java", "diffHunk": "@@ -138,16 +138,14 @@ private boolean isFilterablePolicy(Collection<String> notificationTypes) {\n \n     private Optional<BlackDuckProperties> createBlackDuckProperties(FieldModel fieldModel) throws IntegrationException {\n         FieldAccessor fieldAccessor = fieldModelConverter.convertToFieldAccessor(fieldModel);\n-        Optional<ConfigurationModel> configurationModel = configurationAccessor.getProviderConfigurationByName(fieldAccessor.getStringOrNull(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME));\n-        Optional<FieldAccessor> providerFieldAccessor = configurationModel\n-                                                            .map(ConfigurationModel::getCopyOfKeyToFieldMap)\n-                                                            .map(FieldAccessor::new);\n-\n-        if (configurationModel.isPresent() && providerFieldAccessor.isPresent()) {\n-            ConfigurationModel configModel = configurationModel.get();\n-            return Optional.of(blackDuckPropertiesFactory.createProperties(configModel.getConfigurationId(), providerFieldAccessor.get()));\n+        Long providerConfigId = fieldAccessor.getLong(ProviderDescriptor.KEY_PROVIDER_CONFIG_ID).orElse(null);\n+        if (null == providerConfigId) {\n+            return Optional.empty();\n         }\n-        return Optional.empty();\n+        return configurationAccessor.getConfigurationById(providerConfigId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b920eb7eba35a3e38da1aa5ea1f67292c0a72b32"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjI1Mjcx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1174#pullrequestreview-491625271", "createdAt": "2020-09-18T16:45:01Z", "commit": {"oid": "b920eb7eba35a3e38da1aa5ea1f67292c0a72b32"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjI4MTk3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1174#pullrequestreview-491628197", "createdAt": "2020-09-18T16:49:19Z", "commit": {"oid": "b920eb7eba35a3e38da1aa5ea1f67292c0a72b32"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffc058b866d0b6f46a6225253cacd4af4df751ba", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ffc058b866d0b6f46a6225253cacd4af4df751ba", "committedDate": "2020-09-18T16:56:52Z", "message": "Fix(Provider Custom Function): Collapse if-else into existing optional pipeline"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3492, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}