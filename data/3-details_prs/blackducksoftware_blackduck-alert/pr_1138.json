{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0Nzg2NTc2", "number": 1138, "title": "Add project version into the subject line of the emails", "bodyText": "", "createdAt": "2020-08-27T15:37:45Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138", "merged": true, "mergeCommit": {"oid": "b6c269790fc13854f1c5bf3cb7155e9ed6d3c3f6"}, "closed": true, "closedAt": "2020-08-28T12:54:10Z", "author": {"login": "ChomickiM"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCv6ixAH2gAyNDc0Nzg2NTc2OjE1Zjk4ZTUyYzcyZDI5MWI3ZGMzNjhkZWRlNDU2Mjk4YjRiYTJjYzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDUgidgFqTQ3NzcwMTk1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15f98e52c72d291b7dc368dede456298b4ba2cc5", "author": {"user": {"login": "ChomickiM", "name": "Martin"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/15f98e52c72d291b7dc368dede456298b4ba2cc5", "committedDate": "2020-08-26T18:14:34Z", "message": "refactor: Update EmailChannel to include project version in email subject line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fea6f8753c06ef066d2f6317c4f55c048c94a360", "author": {"user": {"login": "ChomickiM", "name": "Martin"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/fea6f8753c06ef066d2f6317c4f55c048c94a360", "committedDate": "2020-08-26T20:34:07Z", "message": "Merge branch 'master' into mc_project_version_subjectline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9", "author": {"user": {"login": "ChomickiM", "name": "Martin"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/9fef348a4df2f50175f61d9b91d14953f7d333a9", "committedDate": "2020-08-27T15:36:06Z", "message": "refactor: Handle test case where SubTopic is null"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2ODQ5NjE2", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#pullrequestreview-476849616", "createdAt": "2020-08-27T15:41:01Z", "commit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0MTowMVrOHIWRWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0MTowMVrOHIWRWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxNTU0NA==", "bodyText": "I don't think we need to check this. We know that the sub-topic is the project-version for Black Duck and if there is ever another provider, it will be likely that we need to include this for feature parity.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#discussion_r478515544", "createdAt": "2020-08-27T15:41:01Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "diffHunk": "@@ -98,8 +100,16 @@ public void distributeMessage(DistributionEvent event) throws IntegrationExcepti\n \n     public void sendMessage(EmailProperties emailProperties, Set<String> emailAddresses, String subjectLine, String formatType, EmailAttachmentFormat attachmentFormat, MessageContentGroup messageContent) throws IntegrationException {\n         String topicValue = null;\n+        Optional<String> subTopicValue = Optional.empty();\n         if (!messageContent.isEmpty()) {\n             topicValue = messageContent.getCommonTopic().getValue();\n+            subTopicValue = messageContent.getSubContent()\n+                                .stream()\n+                                .map(ProviderMessageContent::getSubTopic)\n+                                .flatMap(Optional::stream)\n+                                .filter(linkableItem -> MessageBuilderConstants.LABEL_PROJECT_VERSION_NAME.equals(linkableItem.getName()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2ODUwOTY0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#pullrequestreview-476850964", "createdAt": "2020-08-27T15:42:36Z", "commit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0MjozNlrOHIWVYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0MjozNlrOHIWVYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxNjU3OQ==", "bodyText": "Because there can be multiple project-versions, we should return a joined list of them.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            .findFirst();\n          \n          \n            \n                                            .collect(Collectors.joining(\", \"));", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#discussion_r478516579", "createdAt": "2020-08-27T15:42:36Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "diffHunk": "@@ -98,8 +100,16 @@ public void distributeMessage(DistributionEvent event) throws IntegrationExcepti\n \n     public void sendMessage(EmailProperties emailProperties, Set<String> emailAddresses, String subjectLine, String formatType, EmailAttachmentFormat attachmentFormat, MessageContentGroup messageContent) throws IntegrationException {\n         String topicValue = null;\n+        Optional<String> subTopicValue = Optional.empty();\n         if (!messageContent.isEmpty()) {\n             topicValue = messageContent.getCommonTopic().getValue();\n+            subTopicValue = messageContent.getSubContent()\n+                                .stream()\n+                                .map(ProviderMessageContent::getSubTopic)\n+                                .flatMap(Optional::stream)\n+                                .filter(linkableItem -> MessageBuilderConstants.LABEL_PROJECT_VERSION_NAME.equals(linkableItem.getName()))\n+                                .map(LinkableItem::getValue)\n+                                .findFirst();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2ODU0NjE5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#pullrequestreview-476854619", "createdAt": "2020-08-27T15:46:49Z", "commit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0Njo0OVrOHIWglQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0Njo0OVrOHIWglQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxOTQ0NQ==", "bodyText": "We might want to consider truncating this if it exceeds a certain number of characters.\n78 is the suggested number of RCF 2822 https://tools.ietf.org/html/rfc2822#section-2.1.1", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#discussion_r478519445", "createdAt": "2020-08-27T15:46:49Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/email/EmailChannel.java", "diffHunk": "@@ -146,9 +156,13 @@ public void sendMessage(EmailProperties emailProperties, Set<String> emailAddres\n         return optionalAttachmentFile;\n     }\n \n-    private String createEnhancedSubjectLine(String originalSubjectLine, String providerProjectName) {\n+    private String createEnhancedSubjectLine(String originalSubjectLine, String providerProjectName, Optional<String> providerProjectVersionName) {\n         if (StringUtils.isNotBlank(providerProjectName)) {\n-            return String.format(\"%s | For: %s\", originalSubjectLine, providerProjectName);\n+            String subjectLine = String.format(\"%s | For: %s\", originalSubjectLine, providerProjectName);\n+            if (providerProjectVersionName.isPresent()) {\n+                subjectLine += String.format(\" %s\", providerProjectVersionName.get());\n+            }\n+            return subjectLine;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fef348a4df2f50175f61d9b91d14953f7d333a9"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39b0427ec699af8df9c459580d1644a4975d6c8a", "author": {"user": {"login": "ChomickiM", "name": "Martin"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/39b0427ec699af8df9c459580d1644a4975d6c8a", "committedDate": "2020-08-27T18:19:36Z", "message": "refactor: Modify subTopic stream to collect into a string and handle in createEnhancedSubjectLine"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTc1MTI5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#pullrequestreview-476975129", "createdAt": "2020-08-27T18:24:39Z", "commit": {"oid": "39b0427ec699af8df9c459580d1644a4975d6c8a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTgwNjgx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#pullrequestreview-476980681", "createdAt": "2020-08-27T18:32:51Z", "commit": {"oid": "39b0427ec699af8df9c459580d1644a4975d6c8a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3NzAxOTU5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1138#pullrequestreview-477701959", "createdAt": "2020-08-28T12:52:39Z", "commit": {"oid": "39b0427ec699af8df9c459580d1644a4975d6c8a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3427, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}