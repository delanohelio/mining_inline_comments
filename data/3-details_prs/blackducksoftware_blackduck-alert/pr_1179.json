{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMTUzODUx", "number": 1179, "title": "Create a copy of the Microsoft work item", "bodyText": "Create a copy of the Microsoft work item so it can be modified and we can add custom fields to it", "createdAt": "2020-09-22T19:39:43Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179", "merged": true, "mergeCommit": {"oid": "981379f4c955f35422cbb10fd98bbb08132eeba3"}, "closed": true, "closedAt": "2020-09-22T20:17:46Z", "author": {"login": "jamesrichard91"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLdLz6gH2gAyNDkxMTUzODUxOjE2NjIxZjAxNTMwYjEyZDQyMGQ0MjAyNWUwMDFlYzg4MWJmNGVkMTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLdybmAFqTQ5MzgxMDEzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "16621f01530b12d420d42025e001ec881bf4ed17", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/16621f01530b12d420d42025e001ec881bf4ed17", "committedDate": "2020-09-22T19:30:33Z", "message": "Fix: Create a copy of the Microsoft work item so it can be modified and we can add custom fields to it"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNzkwNTE5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#pullrequestreview-493790519", "createdAt": "2020-09-22T19:43:44Z", "commit": {"oid": "16621f01530b12d420d42025e001ec881bf4ed17"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTo0Mzo0NFrOHWJs9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxOTo0Mzo0NFrOHWJs9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk4OTY4NQ==", "bodyText": "Can we extract this into its own method?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#discussion_r492989685", "createdAt": "2020-09-22T19:43:44Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureCustomFieldManager.java", "diffHunk": "@@ -194,12 +197,22 @@ private String getProjectPropertyValue(TeamProjectReferenceResponseModel project\n     private String getWorkItemTypeRefName(String processId, String workItemTypeName) throws AlertException {\n         try {\n             AzureArrayResponseModel<ProcessWorkItemTypesResponseModel> processWorkItemTypes = processService.getWorkItemTypes(organizationName, processId);\n-            return processWorkItemTypes.getValue()\n-                       .stream()\n-                       .filter(workItemType -> workItemType.getName().equals(workItemTypeName))\n-                       .map(ProcessWorkItemTypesResponseModel::getReferenceName)\n-                       .findFirst()\n-                       .orElseThrow(() -> new AlertException(String.format(\"No work item type '%s' exists for the Azure process with id: '%s'\", workItemTypeName, processId)));\n+            ProcessWorkItemTypesResponseModel matchingWorkItemType = processWorkItemTypes.getValue()\n+                                                                         .stream()\n+                                                                         .filter(workItemType -> workItemType.getName().equals(workItemTypeName))\n+                                                                         .findFirst()\n+                                                                         .orElseThrow(\n+                                                                             () -> new AlertException(String.format(\"No work item type '%s' exists for the Azure process with id: '%s'\", workItemTypeName, processId)));\n+\n+            if (matchingWorkItemType.getReferenceName().startsWith(UNMODIFIABLE_WORK_ITEM_PREFIX)) {\n+                // if the reference name starts with this prefix, we know it is a system default so it can not be modified and fields can not be added to it, so we need to create a \"copy\" of it\n+                try {\n+                    matchingWorkItemType = processService.createWorkItemType(organizationName, processId, ProcessWorkItemTypeRequestModel.copyWorkItem(matchingWorkItemType));\n+                } catch (IOException e) {\n+                    throw new AlertException(String.format(\"There was a problem creating a modifiable work item from % in the Azure process with id: %s\", matchingWorkItemType.getReferenceName(), processId), e);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16621f01530b12d420d42025e001ec881bf4ed17"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNzkxOTgw", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#pullrequestreview-493791980", "createdAt": "2020-09-22T19:45:50Z", "commit": {"oid": "16621f01530b12d420d42025e001ec881bf4ed17"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77a4e1d09ed00b7984b2d6818c5f477604b6e168", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/77a4e1d09ed00b7984b2d6818c5f477604b6e168", "committedDate": "2020-09-22T19:50:39Z", "message": "Refactor: Moving code into a separate method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNzk2MDY1", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#pullrequestreview-493796065", "createdAt": "2020-09-22T19:51:43Z", "commit": {"oid": "16621f01530b12d420d42025e001ec881bf4ed17"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5a52717f014761ca8d93dc6198d7d98d1189637", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/d5a52717f014761ca8d93dc6198d7d98d1189637", "committedDate": "2020-09-22T20:07:56Z", "message": "Refactor: Changing the code back to the original style with the try/catch for copying moved into a new method."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzODA3Nzgy", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#pullrequestreview-493807782", "createdAt": "2020-09-22T20:09:10Z", "commit": {"oid": "d5a52717f014761ca8d93dc6198d7d98d1189637"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDowOToxMFrOHWKh7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMDowOToxMFrOHWKh7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwMzI0NQ==", "bodyText": "can you just return here?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#discussion_r493003245", "createdAt": "2020-09-22T20:09:10Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/service/AzureCustomFieldManager.java", "diffHunk": "@@ -191,15 +194,31 @@ private String getProjectPropertyValue(TeamProjectReferenceResponseModel project\n         }\n     }\n \n+    private ProcessWorkItemTypesResponseModel copyWorkItem(String processId, ProcessWorkItemTypesResponseModel workItemType) throws AlertException {\n+        ProcessWorkItemTypesResponseModel newWorkItemType;\n+        try {\n+            newWorkItemType = processService.createWorkItemType(organizationName, processId, ProcessWorkItemTypeRequestModel.copyWorkItem(workItemType));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a52717f014761ca8d93dc6198d7d98d1189637"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzODA4MzY3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#pullrequestreview-493808367", "createdAt": "2020-09-22T20:10:03Z", "commit": {"oid": "d5a52717f014761ca8d93dc6198d7d98d1189637"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "825f77d4c3e761655afb3cedf80961eab142e0bc", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/825f77d4c3e761655afb3cedf80961eab142e0bc", "committedDate": "2020-09-22T20:11:46Z", "message": "Refactor: simplifying the copyWorkItem method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzODEwMTM4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1179#pullrequestreview-493810138", "createdAt": "2020-09-22T20:12:44Z", "commit": {"oid": "825f77d4c3e761655afb3cedf80961eab142e0bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3498, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}