{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NTIyMDY0", "number": 1112, "title": "Enhance MessageResult", "bodyText": "Include field statuses in MessageResult to allow channels to expose more granular error/warning messages.\nImplement combined usage of MessageResult in JobConfigActions for job validation, provider validation, and test messages", "createdAt": "2020-08-13T17:03:37Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112", "merged": true, "mergeCommit": {"oid": "df3b9f9fa8bfaccc5b79f83e33dd4e6802f9aa9a"}, "closed": true, "closedAt": "2020-08-13T19:40:25Z", "author": {"login": "gkillough"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-guS9gH2gAyNDY3NTIyMDY0OjZkMDY0OTk0NDA5MDBkNThhYWIzMzE4ODNkOWQ4Y2YwZTY3ZWEwZGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-lU_UAH2gAyNDY3NTIyMDY0Ojg0OTZkZTA1ZTAzMWVkZjYyZWU0YTcxYzEzOTZmYzEwZTMzYjg2NjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6d06499440900d58aab331883d9d8cf0e67ea0de", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/6d06499440900d58aab331883d9d8cf0e67ea0de", "committedDate": "2020-08-13T14:16:55Z", "message": "Feat(MessageResult): Include field statuses in message result rather than exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "957a7b54e319b809ccbc481a3c2ad6a9b7e4d11f", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/957a7b54e319b809ccbc481a3c2ad6a9b7e4d11f", "committedDate": "2020-08-13T15:37:22Z", "message": "Feat(MessageResult): Update JobConfigActions to utilize MessageResult fieldStatuses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b402e4b54f679cae942b5e6ef352c75539e2e915", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b402e4b54f679cae942b5e6ef352c75539e2e915", "committedDate": "2020-08-13T16:59:22Z", "message": "Feat(JobConfigActions): Combine field statuses when testing job config to maximize feedback per request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/1e427afa86e9a0bd2794fc2630e8d3713a4be233", "committedDate": "2020-08-13T17:52:17Z", "message": "Fix(MessageResult): Remove unnecessary static initializer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDA0NDMw", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#pullrequestreview-467004430", "createdAt": "2020-08-13T17:57:36Z", "commit": {"oid": "b402e4b54f679cae942b5e6ef352c75539e2e915"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1NzozNlrOHAXRRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1NzozNlrOHAXRRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MzMwMw==", "bodyText": "This is done in multiple places, we should add a method that performs this check and throws the exception to the MessageResult object.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470143303", "createdAt": "2020-08-13T17:57:36Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -129,8 +131,13 @@ public void deleteJobById(UUID id) throws AlertException {\n     }\n \n     public JobFieldModel saveJob(JobFieldModel jobFieldModel) throws AlertException {\n-        validateJob(jobFieldModel);\n+        MessageResult validationResult = validateJob(jobFieldModel);\n+        List<AlertFieldStatus> fieldStatuses = validationResult.getFieldStatuses();\n+        if (!fieldStatuses.isEmpty()) {\n+            throw new AlertFieldException(fieldStatuses);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b402e4b54f679cae942b5e6ef352c75539e2e915"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDA1NDg4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#pullrequestreview-467005488", "createdAt": "2020-08-13T17:58:55Z", "commit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1ODo1NVrOHAXUcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzo1ODo1NVrOHAXUcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NDExMg==", "bodyText": "Another example of the exception throwing.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470144112", "createdAt": "2020-08-13T17:58:55Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -152,7 +159,11 @@ public JobFieldModel saveJob(JobFieldModel jobFieldModel) throws AlertException\n     }\n \n     public JobFieldModel updateJob(UUID id, JobFieldModel jobFieldModel) throws AlertException {\n-        validateJob(jobFieldModel);\n+        MessageResult validationResult = validateJob(jobFieldModel);\n+        List<AlertFieldStatus> fieldStatuses = validationResult.getFieldStatuses();\n+        if (!fieldStatuses.isEmpty()) {\n+            throw new AlertFieldException(fieldStatuses);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDA4MDA0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#pullrequestreview-467008004", "createdAt": "2020-08-13T18:02:20Z", "commit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowMjoyMFrOHAXc7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowMjoyMFrOHAXc7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NjI4NQ==", "bodyText": "I think this could be converted into a stream.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470146285", "createdAt": "2020-08-13T18:02:20Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -226,37 +237,41 @@ private boolean filterOutMatchingJobs(@Nullable UUID currentJobId, Configuration\n         }\n     }\n \n-    public String validateJob(JobFieldModel jobFieldModel) throws AlertFieldException {\n-        List<AlertFieldStatus> fieldErrors = new ArrayList<>();\n+    public MessageResult validateJob(JobFieldModel jobFieldModel) {\n+        List<AlertFieldStatus> fieldStatuses = new ArrayList<>();\n         for (FieldModel fieldModel : jobFieldModel.getFieldModels()) {\n-            fieldErrors.addAll(fieldModelProcessor.validateFieldModel(fieldModel));\n+            fieldStatuses.addAll(fieldModelProcessor.validateFieldModel(fieldModel));\n         }\n \n-        if (!fieldErrors.isEmpty()) {\n-            throw new AlertFieldException(fieldErrors);\n+        if (!fieldStatuses.isEmpty()) {\n+            return new MessageResult(\"Invalid\", fieldStatuses);\n         }\n-        return \"Valid\";\n+        return new MessageResult(\"Valid\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDA5NzY4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#pullrequestreview-467009768", "createdAt": "2020-08-13T18:04:49Z", "commit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowNDo0OVrOHAXiEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowNDo0OVrOHAXiEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NzYwMA==", "bodyText": "Should this field be an instance of JobFieldStatuses? and the helper methods moved into the JobFieldStatuses class?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470147600", "createdAt": "2020-08-13T18:04:49Z", "author": {"login": "jamesrichard91"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/message/model/MessageResult.java", "diffHunk": "@@ -22,21 +22,63 @@\n  */\n package com.synopsys.integration.alert.common.message.model;\n \n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.FieldStatusSeverity;\n import com.synopsys.integration.alert.common.rest.model.AlertSerializableModel;\n \n public class MessageResult extends AlertSerializableModel {\n-    private String statusMessage;\n+    private final String statusMessage;\n+    private final List<AlertFieldStatus> fieldStatuses;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDEwODkw", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#pullrequestreview-467010890", "createdAt": "2020-08-13T18:06:29Z", "commit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowNjoyOVrOHAXljg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxODowNjoyOVrOHAXljg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0ODQ5NA==", "bodyText": "This could be confusing to handle further down the line, since the message will say success but there could be errors", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470148494", "createdAt": "2020-08-13T18:06:29Z", "author": {"login": "jamesrichard91"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/actions/BlackDuckDistributionTestAction.java", "diffHunk": "@@ -78,22 +79,22 @@ public MessageResult testConfig(String configId, FieldModel fieldModel, FieldAcc\n \n                 BlackDuckApiTokenValidator blackDuckAPITokenValidator = new BlackDuckApiTokenValidator(blackDuckProperties);\n                 if (!blackDuckAPITokenValidator.isApiTokenValid()) {\n-                    throw AlertFieldException.singleFieldError(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"User permission failed, cannot read notifications from Black Duck.\");\n+                    fieldStatuses.add(AlertFieldStatus.error(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"User permission failed, cannot read notifications from Black Duck.\"));\n                 }\n             }\n         } else {\n-            throw AlertFieldException.singleFieldError(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"A provider configuration is required\");\n+            fieldStatuses.add(AlertFieldStatus.error(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"A provider configuration is required\"));\n         }\n-\n-        return new MessageResult(\"Successfully tested BlackDuck provider fields\");\n+        return new MessageResult(\"Successfully tested BlackDuck provider fields\", fieldStatuses);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDExOTM5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#pullrequestreview-467011939", "createdAt": "2020-08-13T18:07:59Z", "commit": {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40d5d2c90a625cff7af93551738f7e3b1025a53a", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/40d5d2c90a625cff7af93551738f7e3b1025a53a", "committedDate": "2020-08-13T18:53:47Z", "message": "Fix(JobConfigActions): Replace duplicate code with helper method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDQ3Nzgx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#pullrequestreview-467047781", "createdAt": "2020-08-13T18:58:36Z", "commit": {"oid": "40d5d2c90a625cff7af93551738f7e3b1025a53a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MDU5OTI4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#pullrequestreview-467059928", "createdAt": "2020-08-13T19:16:59Z", "commit": {"oid": "40d5d2c90a625cff7af93551738f7e3b1025a53a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec649384f011be49d17891929a72ed820599156d", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ec649384f011be49d17891929a72ed820599156d", "committedDate": "2020-08-13T19:17:26Z", "message": "Fix(BlackDuckDistributionTestAction): Change result message if fieldStatuses contain errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8496de05e031edf62ee4a71c1396fc10e33b8666", "author": {"user": {"login": "gkillough", "name": "Gavin Killough"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/8496de05e031edf62ee4a71c1396fc10e33b8666", "committedDate": "2020-08-13T19:38:48Z", "message": "Merge branch '6.2.0' into gk_enhance_message_result"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3395, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}