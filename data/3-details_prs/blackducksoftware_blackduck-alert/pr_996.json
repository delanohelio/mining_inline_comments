{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NzQyMjIw", "number": 996, "title": "ldap password fix", "bodyText": "For sensitive fields read the values from the database and use the value if the value from the field model isn't set.\nWe were writing the empty string as the LDAP password each time Alert starts up. Read if the value is saved in the database and use that if the field isn't set in the new configuration to be saved.", "createdAt": "2020-05-28T21:21:38Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/996", "merged": true, "mergeCommit": {"oid": "e3b7a60dbc39ba186d481e0a360c7f643228f0f2"}, "closed": true, "closedAt": "2020-05-29T15:22:01Z", "author": {"login": "psantos1113"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcl0gqOgH2gAyNDI0NzQyMjIwOjZiZTBhMTkwOTRjM2RjNWRiNGU3NzU4MTMxZTRlMmFjMjUyZWZhNjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmDOZtgFqTQyMTAwMDgyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6be0a19094c3dc5db4e7758131e4e2ac252efa68", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/6be0a19094c3dc5db4e7758131e4e2ac252efa68", "committedDate": "2020-05-28T21:12:01Z", "message": "fix: Read existing saved sensitive fields from the database on update."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5c91cf55491292b48c549c83cab71bf1b4c1449", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b5c91cf55491292b48c549c83cab71bf1b4c1449", "committedDate": "2020-05-28T21:20:38Z", "message": "refactor: Clean up the code on update to be more consistent."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwODc2OTY3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/996#pullrequestreview-420876967", "createdAt": "2020-05-29T11:42:39Z", "commit": {"oid": "b5c91cf55491292b48c549c83cab71bf1b4c1449"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMTo0MjozOVrOGcZWWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMTo0MjozOVrOGcZWWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQyODYzMg==", "bodyText": "I'm surprised we don't have a utility for this. We should probably add a TODO here and an issue for 6.1.0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/996#discussion_r432428632", "createdAt": "2020-05-29T11:42:39Z", "author": {"login": "gkillough"}, "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/descriptor/accessor/DefaultDescriptorGlobalConfigUtility.java", "diffHunk": "@@ -96,9 +98,33 @@ public FieldModel save(FieldModel fieldModel) throws AlertException {\n \n     public FieldModel update(Long id, FieldModel fieldModel) throws AlertException {\n         FieldModel beforeUpdateAction = apiAction.beforeUpdateAction(fieldModel);\n-        Collection<ConfigurationFieldModel> values = configurationFieldModelConverter.convertToConfigurationFieldModelMap(beforeUpdateAction).values();\n-        ConfigurationModel configurationModel = configurationAccessor.updateConfiguration(id, values);\n+        Map<String, ConfigurationFieldModel> valueMap = configurationFieldModelConverter.convertToConfigurationFieldModelMap(beforeUpdateAction);\n+        Optional<ConfigurationModel> existingConfig = configurationAccessor.getConfigurationById(id);\n+        ConfigurationModel configurationModel;\n+        if (existingConfig.isPresent()) {\n+            Map<String, ConfigurationFieldModel> updatedValues = updateSensitiveFields(valueMap, existingConfig.get());\n+            configurationModel = configurationAccessor.updateConfiguration(id, updatedValues.values());\n+        } else {\n+            configurationModel = configurationAccessor.createConfiguration(key, context, valueMap.values());\n+        }\n         FieldModel convertedFieldModel = configurationFieldModelConverter.convertToFieldModel(configurationModel);\n         return apiAction.afterUpdateAction(convertedFieldModel);\n     }\n+\n+    private Map<String, ConfigurationFieldModel> updateSensitiveFields(Map<String, ConfigurationFieldModel> values, ConfigurationModel existingConfig) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5c91cf55491292b48c549c83cab71bf1b4c1449"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97e473b250f915648fc3fd365e5df826bf81e5d1", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/97e473b250f915648fc3fd365e5df826bf81e5d1", "committedDate": "2020-05-29T12:57:30Z", "message": "refactor: Add a TODO comment."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwOTc0NDI3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/996#pullrequestreview-420974427", "createdAt": "2020-05-29T13:58:13Z", "commit": {"oid": "97e473b250f915648fc3fd365e5df826bf81e5d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwOTc2MDQ0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/996#pullrequestreview-420976044", "createdAt": "2020-05-29T14:00:05Z", "commit": {"oid": "97e473b250f915648fc3fd365e5df826bf81e5d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMDAwODIz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/996#pullrequestreview-421000823", "createdAt": "2020-05-29T14:20:39Z", "commit": {"oid": "97e473b250f915648fc3fd365e5df826bf81e5d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2747, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}