{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3NjM0MTg2", "number": 829, "title": "Update black duck response cache with api object", "bodyText": "Pull Request template\nIf nothing above, what is your reason for this pull request:\n\nNoticed TODO in BlackDuckResponseCache to replace Json object with API object\n\nChanges proposed in this pull request:\n\nUpdating cvss3Severity to its new (and very wordy) equivalent", "createdAt": "2020-01-27T18:18:17Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829", "merged": true, "mergeCommit": {"oid": "f7c1c2199cba194467532bc16da7a463448d85cd"}, "closed": true, "closedAt": "2020-01-30T17:43:10Z", "author": {"login": "crowleySynopsys"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9lx1pAH2gAyMzY3NjM0MTg2OjM2MjIwNjI2OWQ4NzE5NDMwZWI4NDFmNDczMGY5YzYzYzY4OWYzMjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_eLAgAH2gAyMzY3NjM0MTg2OmM2NGVhNjdlZDhiMDU4YTVjYWJiNDYwNmUxZmFhNTA3ZmJhODg5OTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "362206269d8719430eb841f4730f9c63c689f329", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/362206269d8719430eb841f4730f9c63c689f329", "committedDate": "2020-01-24T21:25:14Z", "message": "Fix(API): Update BlackDuckResponseCache.getSeverity to use API object"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4ODc0OTQ0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#pullrequestreview-348874944", "createdAt": "2020-01-27T18:20:23Z", "commit": {"oid": "362206269d8719430eb841f4730f9c63c689f329"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoyMDoyNFrOFiMqAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoyMDoyNFrOFiMqAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQwMzI2NA==", "bodyText": "Do we want a snapshot for now?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#discussion_r371403264", "createdAt": "2020-01-27T18:20:24Z", "author": {"login": "bamandel"}, "path": "alert-common/build.gradle", "diffHunk": "@@ -2,7 +2,7 @@ ext.moduleName = 'com.synopsys.integration.alert.common'\n \n dependencies {\n     api 'com.synopsys.integration:issuetracker-jira:0.0.3'\n-    api 'com.blackducksoftware.integration:blackduck-common:45.0.6'\n+    api 'com.synopsys.integration:blackduck-common:45.1.1-SNAPSHOT'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "362206269d8719430eb841f4730f9c63c689f329"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4ODgyMjQ0", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#pullrequestreview-348882244", "createdAt": "2020-01-27T18:32:06Z", "commit": {"oid": "362206269d8719430eb841f4730f9c63c689f329"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODozMjowNlrOFiNAfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODozMjowNlrOFiNAfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQwOTAyMA==", "bodyText": "Can you change this to Optional.ofNullable(severity) ? Just in case the severity is null", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#discussion_r371409020", "createdAt": "2020-01-27T18:32:06Z", "author": {"login": "jamesrichard91"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/collector/util/BlackDuckResponseCache.java", "diffHunk": "@@ -145,19 +146,9 @@ public String getSeverity(String vulnerabilityUrl) {\n     }\n \n     // TODO update this code with an Object from blackduck-common-api when available\n-    private Optional<String> getCvss3Severity(VulnerabilityView vulnerabilityView) {\n-        Boolean useCvss3 = vulnerabilityView.getUseCvss3();\n-        if (null != useCvss3 && useCvss3) {\n-            JsonObject vulnJsonObject = vulnerabilityView.getJsonElement().getAsJsonObject();\n-            JsonElement cvss3 = vulnJsonObject.get(\"cvss3\");\n-            if (null != cvss3) {\n-                JsonElement cvss3Severity = cvss3.getAsJsonObject().get(\"severity\");\n-                if (null != cvss3Severity) {\n-                    return Optional.of(cvss3Severity.getAsString());\n-                }\n-            }\n-        }\n-        return Optional.empty();\n+    private Optional<ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType> getCvss3Severity(VulnerabilityView vulnerabilityView) {\n+        ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType severity = vulnerabilityView.getCvss3().getSeverity();\n+        return Optional.of(severity);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "362206269d8719430eb841f4730f9c63c689f329"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4ODgzNTEx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#pullrequestreview-348883511", "createdAt": "2020-01-27T18:34:14Z", "commit": {"oid": "362206269d8719430eb841f4730f9c63c689f329"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODozNDoxNFrOFiNEOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODozNDoxNFrOFiNEOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQwOTk3OQ==", "bodyText": "Why did we change the return type from String to ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType?  Instead of the users of the method calling the name() method on the response why dont we do that at the end of this method?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#discussion_r371409979", "createdAt": "2020-01-27T18:34:14Z", "author": {"login": "jamesrichard91"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/collector/util/BlackDuckResponseCache.java", "diffHunk": "@@ -105,14 +106,14 @@ public String getProjectComponentQueryLink(String projectLink, String componentN\n         return Optional.empty();\n     }\n \n-    public String getSeverity(String vulnerabilityUrl) {\n-        String severity = \"UNKNOWN\";\n+    public ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType getSeverity(String vulnerabilityUrl) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "362206269d8719430eb841f4730f9c63c689f329"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4ODg2ODc1", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#pullrequestreview-348886875", "createdAt": "2020-01-27T18:39:47Z", "commit": {"oid": "362206269d8719430eb841f4730f9c63c689f329"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODozOTo0N1rOFiNOlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODozOTo0N1rOFiNOlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQxMjYzMQ==", "bodyText": "Based on the TODO, it looks like the item the loop is on (VulnerabilitySourceQualifiedId vulnerabilityItem) should now have the severity. Can we replace the line getting it from the blackDuckResponseCache? If so, let's remove the TODO.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#discussion_r371412631", "createdAt": "2020-01-27T18:39:47Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/collector/builder/VulnerabilityNotificationMessageBuilder.java", "diffHunk": "@@ -151,9 +152,9 @@ public String getNotificationType() {\n \n             LinkableItem vulnIdItem = new LinkableItem(MessageBuilderConstants.LABEL_VULNERABILITIES, vulnerabilityId, vulnerabilityUrl);\n             // TODO in Black Duck 2019.10.0, the VulnerabilitySourceQualifiedId includes the severity so we don't need to make a request to get it\n-            String notificationSeverity = blackDuckResponseCache.getSeverity(vulnerabilityUrl);\n+            ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType notificationSeverity = blackDuckResponseCache.getSeverity(vulnerabilityUrl);\n             if (vulnerabilityFilters.isEmpty() || vulnerabilityFilters.contains(notificationSeverity)) {\n-                LinkableItem severity = new LinkableItem(MessageBuilderConstants.LABEL_VULNERABILITY_SEVERITY, notificationSeverity);\n+                LinkableItem severity = new LinkableItem(MessageBuilderConstants.LABEL_VULNERABILITY_SEVERITY, notificationSeverity.name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "362206269d8719430eb841f4730f9c63c689f329"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4ODkwMzcz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#pullrequestreview-348890373", "createdAt": "2020-01-27T18:45:45Z", "commit": {"oid": "362206269d8719430eb841f4730f9c63c689f329"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48cb4dabb56b4cc559ebf204784c7f1c774aa672", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/48cb4dabb56b4cc559ebf204784c7f1c774aa672", "committedDate": "2020-01-28T20:04:40Z", "message": "fix(API): Suggested edits in PR comments.  Edited TODO in VulnerabilityNotificationMessageBuilder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Njg0MjM3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#pullrequestreview-349684237", "createdAt": "2020-01-28T20:37:16Z", "commit": {"oid": "48cb4dabb56b4cc559ebf204784c7f1c774aa672"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMDozNzoxNlrOFizp7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMDozNzoxNlrOFizp7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA0MjIyMQ==", "bodyText": "We can remove this TODO now.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#discussion_r372042221", "createdAt": "2020-01-28T20:37:16Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/collector/util/BlackDuckResponseCache.java", "diffHunk": "@@ -145,17 +148,10 @@ public String getSeverity(String vulnerabilityUrl) {\n     }\n \n     // TODO update this code with an Object from blackduck-common-api when available", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48cb4dabb56b4cc559ebf204784c7f1c774aa672"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Njg1MDcw", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#pullrequestreview-349685070", "createdAt": "2020-01-28T20:38:46Z", "commit": {"oid": "48cb4dabb56b4cc559ebf204784c7f1c774aa672"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMDozODo0NlrOFizsSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMDozODo0NlrOFizsSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA0MjgyNw==", "bodyText": "Could this throw an NPE?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#discussion_r372042827", "createdAt": "2020-01-28T20:38:46Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/collector/util/BlackDuckResponseCache.java", "diffHunk": "@@ -121,7 +124,7 @@ public String getSeverity(String vulnerabilityUrl) {\n             logger.debug(\"Error fetching vulnerability view\", e);\n         }\n \n-        return severity;\n+        return severity.name();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48cb4dabb56b4cc559ebf204784c7f1c774aa672"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9dc96e7e943aae85067c389522428b5b2192cbd", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f9dc96e7e943aae85067c389522428b5b2192cbd", "committedDate": "2020-01-28T20:39:12Z", "message": "fix(API): Removed TODO in BlackDuckResponseCache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e4fdde6b883deadb00466c4012fa175f44a2ccd", "author": {"user": {"login": "crowleySynopsys", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/4e4fdde6b883deadb00466c4012fa175f44a2ccd", "committedDate": "2020-01-28T21:03:22Z", "message": "fix(API): Handle NPE in getSeverity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMTk2ODM4", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#pullrequestreview-350196838", "createdAt": "2020-01-29T15:29:50Z", "commit": {"oid": "4e4fdde6b883deadb00466c4012fa175f44a2ccd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwOTA0ODQw", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/829#pullrequestreview-350904840", "createdAt": "2020-01-30T15:19:34Z", "commit": {"oid": "4e4fdde6b883deadb00466c4012fa175f44a2ccd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c64ea67ed8b058a5cabb4606e1faa507fba88994", "author": {"user": {"login": "jamesrichard91", "name": "James Richard"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/c64ea67ed8b058a5cabb4606e1faa507fba88994", "committedDate": "2020-01-30T17:41:20Z", "message": "Merge branch 'testNewApi' into updateBlackDuckResponseCacheWithApiObject"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2775, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}