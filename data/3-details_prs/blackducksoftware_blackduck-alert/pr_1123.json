{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMDQ5MDg3", "number": 1123, "title": "Add validator for OAuth ", "bodyText": "Was going to add this in 6.2.0 but the warnings are treated as errors and would prevent saving.  This will allow pushing the save and test button and having the UI display a warning message.\nFixed the cause of a circular dependency in the ConfigurationFieldModelConverter.  The class uses the descriptor keys.  If we use the DescriptorMap it needs all the descriptors which is where the validator is getting used.  So it can't autowire the objects correctly.", "createdAt": "2020-08-20T16:27:04Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1123", "merged": true, "mergeCommit": {"oid": "2518055861c421d5723214112ab283188aba09b3"}, "closed": true, "closedAt": "2020-08-24T12:25:38Z", "author": {"login": "psantos1113"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAytNQAH2gAyNDcxMDQ5MDg3OjA5NmRiNGIxOGVkNmNjZGY0YzY0NmVlMGQxNGYxZTA1ZDgzZGYxOGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCBmFLgH2gAyNDcxMDQ5MDg3OmE2YmE1YjI4YzY4ZThiODliNWY5MzYzZDQwNDVmZDdiYzAwNTBlOGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "096db4b18ed6ccdf4c646ee0d14f1e05d83df18c", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/096db4b18ed6ccdf4c646ee0d14f1e05d83df18c", "committedDate": "2020-08-20T16:21:52Z", "message": "feat: Add validator for OAuth but need the common response objects to contain field status."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTI5Nzc5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1123#pullrequestreview-471929779", "createdAt": "2020-08-20T19:38:37Z", "commit": {"oid": "096db4b18ed6ccdf4c646ee0d14f1e05d83df18c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxOTozODozOFrOHEQiQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxOTozODozOFrOHEQiQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIyNzI2Ng==", "bodyText": "Incomplete sentence?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1123#discussion_r474227266", "createdAt": "2020-08-20T19:38:38Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/AzureRedirectUtil.java", "diffHunk": "@@ -38,6 +38,10 @@ public AzureRedirectUtil(AlertProperties alertProperties) {\n         this.alertProperties = alertProperties;\n     }\n \n+    /**\n+     * The OAuth callback controller will redirect back to the Alert UI and is the only place where this method.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "096db4b18ed6ccdf4c646ee0d14f1e05d83df18c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTM0NDQ3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1123#pullrequestreview-471934447", "createdAt": "2020-08-20T19:46:00Z", "commit": {"oid": "096db4b18ed6ccdf4c646ee0d14f1e05d83df18c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxOTo0NjowMFrOHEQ3YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxOTo0NjowMFrOHEQ3YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIzMjY3Mg==", "bodyText": "is/will this method be used? I'm not really sure what the point of it is.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1123#discussion_r474232672", "createdAt": "2020-08-20T19:46:00Z", "author": {"login": "bamandel"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/oauth/AzureOAuthTokenValidator.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/**\n+ * blackduck-alert\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.channel.azure.boards.oauth;\n+\n+import java.net.Proxy;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+import com.synopsys.integration.alert.channel.azure.boards.AzureRedirectUtil;\n+import com.synopsys.integration.alert.channel.azure.boards.oauth.storage.AzureBoardsCredentialDataStoreFactory;\n+import com.synopsys.integration.alert.channel.azure.boards.service.AzureBoardsProperties;\n+import com.synopsys.integration.alert.common.descriptor.config.field.validators.ConfigValidationFunction;\n+import com.synopsys.integration.alert.common.descriptor.config.field.validators.ValidationResult;\n+import com.synopsys.integration.alert.common.persistence.accessor.FieldAccessor;\n+import com.synopsys.integration.alert.common.persistence.util.ConfigurationFieldModelConverter;\n+import com.synopsys.integration.alert.common.rest.ProxyManager;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n+\n+@Component\n+public class AzureOAuthTokenValidator implements ConfigValidationFunction {\n+    private final AzureRedirectUtil azureRedirectUtil;\n+    private final AzureBoardsCredentialDataStoreFactory azureBoardsCredentialDataStoreFactory;\n+    private final ConfigurationFieldModelConverter configurationFieldModelConverter;\n+    private final ProxyManager proxyManager;\n+\n+    @Autowired\n+    public AzureOAuthTokenValidator(AzureRedirectUtil azureRedirectUtil, AzureBoardsCredentialDataStoreFactory azureBoardsCredentialDataStoreFactory,\n+        ConfigurationFieldModelConverter configurationFieldModelConverter, ProxyManager proxyManager) {\n+        this.azureRedirectUtil = azureRedirectUtil;\n+        this.azureBoardsCredentialDataStoreFactory = azureBoardsCredentialDataStoreFactory;\n+        this.configurationFieldModelConverter = configurationFieldModelConverter;\n+        this.proxyManager = proxyManager;\n+    }\n+\n+    public ValidationResult validate(FieldValueModel fieldValueModel, FieldModel fieldModel) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "096db4b18ed6ccdf4c646ee0d14f1e05d83df18c"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTM0NTYw", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1123#pullrequestreview-471934560", "createdAt": "2020-08-20T19:46:11Z", "commit": {"oid": "096db4b18ed6ccdf4c646ee0d14f1e05d83df18c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxOTQxOTQx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1123#pullrequestreview-471941941", "createdAt": "2020-08-20T19:57:26Z", "commit": {"oid": "096db4b18ed6ccdf4c646ee0d14f1e05d83df18c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21178530880d3abcc751afd429caa915e522a231", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/21178530880d3abcc751afd429caa915e522a231", "committedDate": "2020-08-21T11:44:36Z", "message": "refactor: Implemented PR feedback."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNDMwMjQ3", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1123#pullrequestreview-472430247", "createdAt": "2020-08-21T12:00:05Z", "commit": {"oid": "21178530880d3abcc751afd429caa915e522a231"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjowMDowNVrOHEqeww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMjowMDowNVrOHEqeww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY1MjM1NQ==", "bodyText": "What are your thoughts on automatically saving whatever is in the config fields before redirecting to the Microsoft OAuth Login? When the button is pressed, if the current config is valid and no OAuth config already exists, we save.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1123#discussion_r474652355", "createdAt": "2020-08-21T12:00:05Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/channel/azure/boards/oauth/AzureOAuthTokenValidator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/**\n+ * blackduck-alert\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.channel.azure.boards.oauth;\n+\n+import java.net.Proxy;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+import com.synopsys.integration.alert.channel.azure.boards.AzureRedirectUtil;\n+import com.synopsys.integration.alert.channel.azure.boards.oauth.storage.AzureBoardsCredentialDataStoreFactory;\n+import com.synopsys.integration.alert.channel.azure.boards.service.AzureBoardsProperties;\n+import com.synopsys.integration.alert.common.descriptor.config.field.validators.ConfigValidationFunction;\n+import com.synopsys.integration.alert.common.descriptor.config.field.validators.ValidationResult;\n+import com.synopsys.integration.alert.common.persistence.accessor.FieldAccessor;\n+import com.synopsys.integration.alert.common.persistence.util.ConfigurationFieldModelConverter;\n+import com.synopsys.integration.alert.common.rest.ProxyManager;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n+\n+@Component\n+public class AzureOAuthTokenValidator implements ConfigValidationFunction {\n+    private final AzureRedirectUtil azureRedirectUtil;\n+    private final AzureBoardsCredentialDataStoreFactory azureBoardsCredentialDataStoreFactory;\n+    private final ConfigurationFieldModelConverter configurationFieldModelConverter;\n+    private final ProxyManager proxyManager;\n+\n+    @Autowired\n+    public AzureOAuthTokenValidator(AzureRedirectUtil azureRedirectUtil, AzureBoardsCredentialDataStoreFactory azureBoardsCredentialDataStoreFactory,\n+        ConfigurationFieldModelConverter configurationFieldModelConverter, ProxyManager proxyManager) {\n+        this.azureRedirectUtil = azureRedirectUtil;\n+        this.azureBoardsCredentialDataStoreFactory = azureBoardsCredentialDataStoreFactory;\n+        this.configurationFieldModelConverter = configurationFieldModelConverter;\n+        this.proxyManager = proxyManager;\n+    }\n+\n+    @Override\n+    public ValidationResult apply(FieldValueModel fieldValueModel, FieldModel fieldModel) {\n+        ValidationResult result = ValidationResult.success();\n+        try {\n+            Proxy proxy = proxyManager.createProxy();\n+            FieldAccessor fieldAccessor = configurationFieldModelConverter.convertToFieldAccessor(fieldModel);\n+            String oAuthRedirectUri = azureRedirectUtil.createOAuthRedirectUri();\n+            AzureBoardsProperties properties = AzureBoardsProperties.fromFieldAccessor(azureBoardsCredentialDataStoreFactory, oAuthRedirectUri, fieldAccessor);\n+            if (!properties.hasOAuthCredentials(proxy)) {\n+                result = ValidationResult.warnings(\"OAuth token credentials missing. Please save then authenticate.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21178530880d3abcc751afd429caa915e522a231"}, "originalPosition": 66}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNDMwNTM5", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1123#pullrequestreview-472430539", "createdAt": "2020-08-21T12:00:35Z", "commit": {"oid": "21178530880d3abcc751afd429caa915e522a231"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6ba5b28c68e8b89b5f9363d4045fd7bc0050e8b", "author": {"user": {"login": "psantos1113", "name": null}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/a6ba5b28c68e8b89b5f9363d4045fd7bc0050e8b", "committedDate": "2020-08-24T12:16:35Z", "message": "Merge remote-tracking branch 'origin/master' into ps_oauth_authenticator"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3411, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}