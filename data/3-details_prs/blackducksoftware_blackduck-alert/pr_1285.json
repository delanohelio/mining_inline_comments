{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMDA4MTYz", "number": 1285, "title": "Refactored PhoneHomeTask to use new JobAccessor", "bodyText": "", "createdAt": "2020-12-03T18:56:18Z", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285", "merged": true, "mergeCommit": {"oid": "9c432b0097367805760796583ef498a870b4ffc3"}, "closed": true, "closedAt": "2020-12-03T20:17:45Z", "author": {"login": "JakeMathews"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdin1QuAH2gAyNTMyMDA4MTYzOjdhY2VjZWIxYTRhZjEwZjIwN2M2ZGEzNTAwMGFlY2NhNjU5ZmE2OTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdipAkDgH2gAyNTMyMDA4MTYzOmI0ZWJhNzJjNmUxOGM4MjFjYWNkMjk5OWVkZGVjZThmMDU2MjlmMmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7aceceb1a4af10f207c6da35000aecca659fa697", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7aceceb1a4af10f207c6da35000aecca659fa697", "committedDate": "2020-12-03T18:55:08Z", "message": "refactor(phone-home): Refactored PhoneHomeTask to use new JobAccessor."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Mjc5ODQ1", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#pullrequestreview-544279845", "createdAt": "2020-12-03T18:56:45Z", "commit": {"oid": "7aceceb1a4af10f207c6da35000aecca659fa697"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxODo1Njo0NlrOH-sMAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxODo1Njo0NlrOH-sMAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ5NzczMQ==", "bodyText": "I was unsure if this is still necessary.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#discussion_r535497731", "createdAt": "2020-12-03T18:56:46Z", "author": {"login": "JakeMathews"}, "path": "src/main/java/com/synopsys/integration/alert/workflow/scheduled/PhoneHomeTask.java", "diffHunk": "@@ -182,26 +181,24 @@ private PhoneHomeService createPhoneHomeService(ExecutorService phoneHomeExecuto\n         return channelMetadata.toArray(String[]::new);\n     }\n \n-    private Set<String> retrieveChannelMetadataForJobs(List<ConfigurationJobModel> jobs) {\n+    private Set<String> retrieveChannelMetadataForJobs(List<DistributionJobModel> jobs) {\n         Map<String, Integer> createdDistributions = new HashMap<>();\n         String successKeyPart = \"::Successes\";\n-        for (ConfigurationJobModel job : jobs) {\n-            for (ConfigurationModel configuration : job.getCopyOfConfigurations()) {\n-                String channelName = configuration.getField(ChannelDistributionUIConfig.KEY_CHANNEL_NAME).flatMap(ConfigurationFieldModel::getFieldValue).orElse(\"\");\n-                String providerName = configuration.getField(ChannelDistributionUIConfig.KEY_PROVIDER_NAME).flatMap(ConfigurationFieldModel::getFieldValue).orElse(\"\");\n-\n-                if (StringUtils.isBlank(channelName) || StringUtils.isBlank(providerName)) {\n-                    // We want to specifically get the channel configuration here and the only way to determine that is if it has these fields.\n-                    continue;\n-                }\n+        for (DistributionJobModel job : jobs) {\n+            String channelName = job.getChannelDescriptorName();\n+            String providerName = new BlackDuckProviderKey().getUniversalKey();\n+\n+            if (StringUtils.isBlank(channelName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aceceb1a4af10f207c6da35000aecca659fa697"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MzAwNzcw", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#pullrequestreview-544300770", "createdAt": "2020-12-03T19:18:08Z", "commit": {"oid": "7aceceb1a4af10f207c6da35000aecca659fa697"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxOToxODowOFrOH-tEdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxOToxODowOFrOH-tEdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUxMjE4MQ==", "bodyText": "Since this class is a component, you can autowire BlackDuckProviderKey.", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#discussion_r535512181", "createdAt": "2020-12-03T19:18:08Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/workflow/scheduled/PhoneHomeTask.java", "diffHunk": "@@ -182,26 +181,24 @@ private PhoneHomeService createPhoneHomeService(ExecutorService phoneHomeExecuto\n         return channelMetadata.toArray(String[]::new);\n     }\n \n-    private Set<String> retrieveChannelMetadataForJobs(List<ConfigurationJobModel> jobs) {\n+    private Set<String> retrieveChannelMetadataForJobs(List<DistributionJobModel> jobs) {\n         Map<String, Integer> createdDistributions = new HashMap<>();\n         String successKeyPart = \"::Successes\";\n-        for (ConfigurationJobModel job : jobs) {\n-            for (ConfigurationModel configuration : job.getCopyOfConfigurations()) {\n-                String channelName = configuration.getField(ChannelDistributionUIConfig.KEY_CHANNEL_NAME).flatMap(ConfigurationFieldModel::getFieldValue).orElse(\"\");\n-                String providerName = configuration.getField(ChannelDistributionUIConfig.KEY_PROVIDER_NAME).flatMap(ConfigurationFieldModel::getFieldValue).orElse(\"\");\n-\n-                if (StringUtils.isBlank(channelName) || StringUtils.isBlank(providerName)) {\n-                    // We want to specifically get the channel configuration here and the only way to determine that is if it has these fields.\n-                    continue;\n-                }\n+        for (DistributionJobModel job : jobs) {\n+            String channelName = job.getChannelDescriptorName();\n+            String providerName = new BlackDuckProviderKey().getUniversalKey();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aceceb1a4af10f207c6da35000aecca659fa697"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53a8dfb190a8b49d1617d67084512315fa0e6b58", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/53a8dfb190a8b49d1617d67084512315fa0e6b58", "committedDate": "2020-12-03T19:26:49Z", "message": "refactor(phone-home): PhoneHomeTask now has an autowired ProviderKey."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be8eb4913b005bfbba31c56104aaf17c6701f063", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/be8eb4913b005bfbba31c56104aaf17c6701f063", "committedDate": "2020-12-03T19:27:37Z", "message": "refactor(phone-home): Removed check for already validated data."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MzE4NjEz", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#pullrequestreview-544318613", "createdAt": "2020-12-03T19:35:58Z", "commit": {"oid": "be8eb4913b005bfbba31c56104aaf17c6701f063"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxOTozNTo1OFrOH-uCoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxOTozNTo1OFrOH-uCoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUyODA5Nw==", "bodyText": "While you're in here, can you make this a constant?", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#discussion_r535528097", "createdAt": "2020-12-03T19:35:58Z", "author": {"login": "gkillough"}, "path": "src/main/java/com/synopsys/integration/alert/workflow/scheduled/PhoneHomeTask.java", "diffHunk": "@@ -182,26 +182,19 @@ private PhoneHomeService createPhoneHomeService(ExecutorService phoneHomeExecuto\n         return channelMetadata.toArray(String[]::new);\n     }\n \n-    private Set<String> retrieveChannelMetadataForJobs(List<ConfigurationJobModel> jobs) {\n+    private Set<String> retrieveChannelMetadataForJobs(List<DistributionJobModel> jobs) {\n         Map<String, Integer> createdDistributions = new HashMap<>();\n         String successKeyPart = \"::Successes\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be8eb4913b005bfbba31c56104aaf17c6701f063"}, "originalPosition": 89}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MzE4NzQx", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1285#pullrequestreview-544318741", "createdAt": "2020-12-03T19:36:01Z", "commit": {"oid": "be8eb4913b005bfbba31c56104aaf17c6701f063"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4eba72c6e18c821cacd2999eddece8f05629f2e", "author": {"user": {"login": "JakeMathews", "name": "Jake Mathews"}}, "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b4eba72c6e18c821cacd2999eddece8f05629f2e", "committedDate": "2020-12-03T20:17:23Z", "message": "refactor(phone-home): Made success String a constant."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2936, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}